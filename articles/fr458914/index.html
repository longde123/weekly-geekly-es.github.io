<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüé® üõåüèæ üíÇ Ce que vous devez savoir (pas) pour cr√©er des jeux sur Unity üë©‚Äçüåæ üåÜ üçù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unity est un moteur de jeu avec un seuil d'entr√©e loin de z√©ro (en comparaison avec le m√™me Game Maker Studio), et dans cet article, je vais vous dire...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ce que vous devez savoir (pas) pour cr√©er des jeux sur Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458914/"><img width="100%" src="https://habrastorage.org/webt/tf/uv/8n/tfuv8nnybrkzyxholyzuoaasafo.png"><br><br>  Unity est un moteur de jeu avec un seuil d'entr√©e loin de z√©ro (en comparaison avec le m√™me Game Maker Studio), et dans cet article, je vais vous dire quels probl√®mes j'ai rencontr√©s en commen√ßant √† l'√©tudier et quelles solutions j'ai trouv√©es.  Je d√©crirai ces moments avec l'exemple de mon jeu de puzzle 2d pour Android (qui j'esp√®re sera bient√¥t publi√© sur le Play Market). <a name="habracut"></a><br><br>  Je ne pr√©tends pas √™tre vrai, et je ne vous exhorte pas √† r√©p√©ter apr√®s vous-m√™me, si vous connaissez la meilleure fa√ßon, je vais juste vous montrer comment le faire vous-m√™me, et peut-√™tre que quelqu'un qui commence tout juste √† se familiariser avec Unity cr√©era son propre chef-d'≈ìuvre ind√©pendant avec moins de travail. <br><br>  Je suis ing√©nieur en conception de centrales √©lectriques, mais j'ai toujours √©t√© int√©ress√© par le codage et je connais certains langages de programmation.  Par cons√©quent, nous convenons que pour cr√©er des jeux sur Unity: <br><ul><li>  Vous devez conna√Ætre un peu C # ou JavaScript (au moins la syntaxe en forme de C). <br></li></ul><br>  Tout ce qui sera √©crit ci-dessous n'est pas un tutoriel Unity, dont suffisamment ont √©t√© cr√©√©s sur le r√©seau sans moi.  Vous trouverez ci-dessous les moments difficiles qui peuvent survenir lors de la cr√©ation de votre premier projet sur Unity. <br><br>  Il convient de signaler que les scripts fournis omettent la majeure partie de la logique du jeu (repr√©sentant des "secrets commerciaux"), mais leurs performances en tant qu'exemples ont √©t√© v√©rifi√©es. <br><br><h3>  Probl√®me 1 - Orientation </h3><br><img align="left" width="40%" src="https://habrastorage.org/webt/-f/za/hw/-fzahwdptbht2vwe1qm4xswgqkm.png"><br>  <b>Verrou d'orientation</b> <br>  La premi√®re difficult√© qui est apparue en moi est que je n'ai pas accord√© l'attention voulue √† l'optimisation de l'interface visuelle pour l'orientation de l'√©cran.  La solution est la plus simple - si vous n'avez pas besoin de changer l'orientation de l'√©cran pour le gameplay, il est pr√©f√©rable de le bloquer.  Pas besoin d'une flexibilit√© excessive, vous √©crivez un jeu ind√©pendant, pas un projet de l'autre c√¥t√© d'un million de dollars.  Pourquoi des tonnes de transitions conditionnelles et des changements d'ancrage si le jeu est plus beau dans Portrait (par exemple).  Vous pouvez verrouiller l'orientation de l'√©cran ici: <br>  <b>√âdition&gt; Param√®tres du projet&gt; Lecteur</b> <br clear="all"><br clear="all"><img align="right" width="40%" src="https://habrastorage.org/webt/jb/3u/ot/jb3uotkehyw_t2pa2e__yw0n2ng.png"><br>  <b>Diff√©rentes autorisations</b> <br>  Il est √©galement important de tester l'interface visuelle √† diff√©rentes r√©solutions dans l'orientation s√©lectionn√©e, et lors du test, n'oubliez pas l'existence d'appareils avec des proportions de 4: 3 (enfin, ou 3: 4), afin que nous puissions ajouter en toute s√©curit√© 768x1024 (ou 1024x768). <br><br>  <b>Un meilleur positionnement</b> <br>  Il est pr√©f√©rable d'utiliser Rect Transform pour ajuster le positionnement et l'√©chelle des objets du jeu. <img align="left" width="40%" src="https://habrastorage.org/webt/rm/gk/ao/rmgkao3ttyvdkj3dbs8zmtxrm2o.png"><br><br clear="all"><br clear="all"><h3>  Deuxi√®me probl√®me - COMMUNICATION </h3><br>  J'ai eu un probl√®me similaire en raison du fait que j'ai fait la premi√®re connaissance avec le d√©veloppeur de jeu en utilisant Game Maker Studio, o√π le script est une partie √† part enti√®re de l'objet de jeu, et il a imm√©diatement un acc√®s complet √† tous les composants de l'objet.  Unity a des scripts communs et seules leurs instances sont ajout√©es √† l'objet.  Parlant de mani√®re simpliste et figur√©e, le script ne sait pas directement sur quel objet il s'ex√©cute actuellement.  Par cons√©quent, lors de l'√©criture de scripts, vous devez prendre en compte l'initialisation des interfaces pour travailler avec les composants d'un objet ou avec les composants d'autres objets. <br><br>  <b>Nous nous entra√Ænons sur les chats</b> <br>  Dans mon jeu, il y a un objet GameField, sur la sc√®ne, il n'y en a qu'une seule instance, il y a aussi un script du m√™me nom.  L'objet est charg√© d'afficher la partition du jeu et de reproduire l'int√©gralit√© du son du jeu, donc √† mon avis, il est plus √©conomique pour la m√©moire (en g√©n√©ral, le jeu n'a que trois sources audio - une musique de fond, deux autres effets sonores).  Le script r√©sout les probl√®mes de stockage d'un compte de jeu, de choix d'AudioClip pour la lecture du son et d'une certaine logique de jeu. <br><br>  Arr√™tons-nous plus en d√©tail sur le son, car cet exemple montre facilement l'interaction du script avec les composants de l'objet. <br><br><img width="40%" align="left" src="https://habrastorage.org/webt/2y/ll/ab/2yllabokihsyqwabiwnod3tiqyc.png">  Naturellement, l'objet doit avoir le script GameField.cs lui-m√™me et le composant AudioSource, dans mon cas deux entiers (plus tard, il sera clair pourquoi). <br clear="all"><br clear="all">  Comme mentionn√© pr√©c√©demment, le script n'est ¬´pas au courant¬ª que l'objet a un composant AudioSource, donc nous d√©clarons et initialisons l'interface (pour l'instant, nous consid√©rons qu'il n'y a qu'une seule AudioSource): <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource Sound; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ Sound = GetComponent&lt;AudioSource&gt; (); }</code> </pre> <br>  La m√©thode GetComponent &lt;component_type&gt; () renvoie le premier composant du type sp√©cifi√© √† partir de l'objet. <br><br>  En plus d'AudioSource, vous aurez besoin de plusieurs AudioClip: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Header (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Audio clips"</span></span></span><span class="hljs-meta">)</span></span>] [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnStart; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnEfScore; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnHighScore; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnMainTimer; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnBubbMarker; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioClip OnScoreUp;</code> </pre><br>  Ci-apr√®s, les commandes entre crochets sont n√©cessaires pour Inspector`a, plus de d√©tails <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><img width="40%" align="left" src="https://habrastorage.org/webt/wk/t-/k7/wkt-k7spezw5hanfme5xchxexzk.png"><br><br>  Maintenant, le script dans Inspector a de nouveaux champs dans lesquels nous glissons les sons n√©cessaires. <br><br clear="all"><br clear="all">  Ensuite, cr√©ez une m√©thode SoundPlay dans le script qui prend en AudioClip: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySound</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AudioClip Clip = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>{ Sound.clip = Clip; Sound.Play (); }</code> </pre><br>  Pour jouer du son dans le jeu, nous appelons au bon moment cette m√©thode avec le clip. <br><br>  Il y a un inconv√©nient majeur √† cette approche, un seul son peut √™tre jou√© √† la fois, mais pendant le jeu, il peut √™tre n√©cessaire de jouer deux sons ou plus, √† l'exception de la musique de fond jou√©e en permanence. <br><br>  Pour √©viter la cacophonie, je recommande d'√©viter la possibilit√© de lecture simultan√©e de plus de 4-5 sons (de pr√©f√©rence un maximum de 2-3), je veux dire des sons courts de premier ordre (saut, pi√®ce, coup de joueur ...), pour le bruit de fond, il est pr√©f√©rable de cr√©er votre propre source son sur l'objet qui fait ce bruit (si vous avez besoin d'un son 2d-3d) ou un objet responsable de tout le bruit de fond (si le "volume" n'est pas n√©cessaire). <br><br>  Dans mon jeu, il n'est pas n√©cessaire de jouer simultan√©ment plus de deux AudioClips.  Pour une lecture garantie des deux sons hypoth√©tiques, j'ai ajout√© deux AudioSource √† l'objet GameField.  Pour d√©terminer les composants du script, nous utilisons la m√©thode <br><pre> <code class="cs hljs">GetComponents&lt;_&gt;()</code> </pre><br>  qui renvoie un tableau de tous les composants du type sp√©cifi√© √† partir de l'objet. <br><br>  Le code ressemblera √† ceci: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource[] Sound; <span class="hljs-comment"><span class="hljs-comment">//    void Start(){ Sound = GetComponents&lt;AudioSource&gt; (); //  GetComponents }</span></span></code> </pre><br>  La plupart des modifications affecteront la m√©thode PlaySound.  Je vois deux versions de cette m√©thode: ¬´universelle¬ª (pour n'importe quel nombre d'AudioSource dans un objet) et ¬´maladroite¬ª (pour 2-3 AudioSource, pas la plus √©l√©gante mais moins gourmande en ressources). <br><br>  L'option "maladroite" pour deux AudioSource (je l'ai utilis√©) <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySound</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AudioClip Clip = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Sound [<span class="hljs-number"><span class="hljs-number">0</span></span>].isPlaying) { Sound [<span class="hljs-number"><span class="hljs-number">0</span></span>].clip = Clip; Sound [<span class="hljs-number"><span class="hljs-number">0</span></span>].Play (); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Sound [<span class="hljs-number"><span class="hljs-number">1</span></span>].clip = Clip; Sound [<span class="hljs-number"><span class="hljs-number">1</span></span>].Play (); } }</code> </pre><br>  Vous pouvez √©tirer jusqu'√† trois AudioSource ou plus, mais le nombre de conditions d√©vorera toutes les √©conomies de performances. <br><br>  Option "universelle" <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySound</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AudioClip Clip = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (AudioSource _Sound <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Sound) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_Sound.isPlaying) { _Sound.clip = Clip; _Sound.Play (); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } }</code> </pre><br><br>  <b>Acc√®s √† une composante √©trang√®re</b> <br>  Sur le terrain de jeu, il existe plusieurs exemples du pr√©fabriqu√© Fishka, comme une puce de jeu.  Il est construit comme ceci: <br><ul><li>  Objet parent avec son SpriteRenderer; <ul><li>  Objets enfants avec leur SpriteRenderer. </li></ul></li></ul><br>  Les objets enfants sont charg√©s de dessiner le corps de la puce, sa couleur, les √©l√©ments mutables suppl√©mentaires.  Le parent trace une bordure de marqueur autour de la puce (la puce active doit √™tre mise en surbrillance dans le jeu).  Le script se trouve uniquement sur l'objet parent.  Ainsi, pour g√©rer les sprites enfants, le script parent doit sp√©cifier ces sprites.  Je l'ai organis√© comme ceci - dans le script, j'ai cr√©√© des interfaces pour acc√©der aux enfants SpriteRenderer: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Header (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Graphic objects"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SpriteRenderer Marker; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteRenderer Base; [Space] [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteRenderer Center_Red; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteRenderer Center_Green; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteRenderer Center_Blue;</code> </pre><br>  Maintenant, le script dans Inspector a des champs suppl√©mentaires: <br><img src="https://habrastorage.org/webt/mq/w9/kp/mqw9kpst-fen-bkdtgp_8jycpck.png"><br><br clear="all">  Faire glisser et d√©poser des enfants dans les champs correspondants nous donne acc√®s √† eux dans le script. <br><br clear="all">  Exemple d'utilisation: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnMouseDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        Marker.enabled = !Marker.enabled; }</span></span></code> </pre><br><br clear="all">  <b>Appel du script de quelqu'un d'autre</b> <br>  En plus de manipuler des composants √©trangers, vous pouvez √©galement acc√©der au script d'un objet tiers, travailler avec ses variables, m√©thodes et sous-classes publiques. <br><br>  Je vais donner un exemple sur l'objet GameField d√©j√† bien connu. <br><br>  Le script GameField a une m√©thode publique FishkiMarkerDisabled (), qui est n√©cessaire pour "supprimer" un marqueur de toutes les puces sur le terrain et est utilis√© dans le processus de d√©finition d'un marqueur lorsque vous cliquez sur une puce, car il ne peut y avoir qu'un seul actif. <br><br>  Dans le script Fishka.cs, ‚Äã‚ÄãSpriteRenderer Marker est public, c'est-√†-dire qu'il est accessible √† partir d'un autre script.  Pour ce faire, ajoutez la d√©claration et l'initialisation des interfaces pour toutes les instances de la classe Fishka dans le script GameField.cs (lors de la cr√©ation d'un script, la classe du m√™me nom y est cr√©√©e) de la m√™me mani√®re que pour plusieurs AudioSource: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Fishka[] Fishki; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ Fishki = GameObject.FindObjectsOfType (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Fishka)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Fishka[]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FishkiMarkerDisabled</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Fishka _Fishka <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Fishki) { _Fishka .Marker.enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre><br>  Dans le script Fishka.cs, ‚Äã‚Äãajoutez la d√©claration et l'initialisation de l'interface de l'instance de classe GameField, et lorsque nous cliquons sur l'objet, nous appelons la m√©thode FishkiMarkerDisabled () de cette classe: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GameField gf; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ gf = GameObject.FindObjectOfType (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(GameField)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> GameField; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnMouseDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ gf.FishkiMarkerDisabled(); Marker.enabled = !Marker.enabled; }</code> </pre><br>  Ainsi, vous pouvez interagir entre des scripts (ou plut√¥t des classes) de diff√©rents objets. <br><br clear="all"><br clear="all"><h3>  Troisi√®me probl√®me - GARDEURS </h3><br>  <b>Tenue de compte</b> <br>  D√®s que quelque chose comme un compte appara√Æt dans le jeu, le probl√®me imm√©diat est son stockage, √† la fois pendant le jeu et en dehors de celui-ci, je veux aussi garder un record afin d'encourager le joueur √† le d√©passer. <br><br>  Je ne consid√©rerai pas les options lorsque tout le jeu (menu, jeu, retrait de compte) est construit en une seule sc√®ne, car, premi√®rement, ce n'est pas la meilleure fa√ßon de construire le premier projet, et deuxi√®mement, √† mon avis, la sc√®ne de chargement initiale devrait √™tre .  Par cons√©quent, nous convenons qu'il y a quatre sc√®nes dans le projet: <br><ol><li>  chargeur - une sc√®ne dans laquelle l'objet de musique de fond est initialis√© (plus sera plus tard), et chargement des param√®tres √† partir de la sauvegarde; <br></li><li>  menu - une sc√®ne avec un menu; <br></li><li>  jeu - sc√®ne de jeu; <br></li><li>  score - la sc√®ne du score, du record, du classement. <br></li></ol><br><img width="40%" align="right" src="https://habrastorage.org/webt/dy/yl/4t/dyyl4tkmtx6a0ijbnjiy1jgkr9q.png"><br>  <i>Remarque: L'ordre de chargement des sc√®nes est d√©fini dans Fichier&gt; Param√®tres de construction.</i> <br clear="all"><br clear="all">  Les points accumul√©s pendant le jeu sont stock√©s dans la variable Score de la classe GameField.  Pour avoir acc√®s aux donn√©es lors de l'acc√®s √† la sc√®ne des scores, nous allons cr√©er une classe statique publique ScoreHolder, dans laquelle nous d√©clarons une variable pour stocker la valeur et une propri√©t√© pour obtenir et d√©finir la valeur de cette variable (la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">espionne</a> les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">apocatastas</a> ): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ScoreHolder</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _Score = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Score { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _Score; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>{ _Score = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } }</code> </pre><br>  Une classe statique publique n'a besoin d'√™tre ajout√©e √† aucun objet, elle est imm√©diatement disponible dans n'importe quelle sc√®ne √† partir de n'importe quel script. <br><br>  Exemple d'utilisation dans la classe GameField dans les scores de la m√©thode de transition de sc√®ne: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.SceneManagement; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GameField</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Score = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     ,         Scores void GotoScores(){ ScoreHolder.Score = Score; //   ScoreHolder.Score   SceneManager.LoadScene (‚Äúscores‚Äù); } }</span></span></code> </pre><br>  De la m√™me mani√®re, vous pouvez ajouter un compte d'enregistrement au ScoreHolder pendant le jeu, mais il ne sera pas enregistr√© √† la sortie. <br><br clear="all">  <b>Gardien des param√®tres</b> <br>  Prenons l'exemple de l'enregistrement de la valeur de la variable bool√©enne SoundEffectsMute, selon l'√©tat dans lequel le jeu a ou non des effets sonores. <br><br>  La variable elle-m√™me est stock√©e dans la classe statique publique SettingsHolder: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SettingsHolder</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _SoundEffectsMute = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> SoundEffectsMute{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _SoundEffectsMute; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>{ _SoundEffectsMute = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } }</code> </pre><br>  La classe est similaire √† ScoreHolder, vous pouvez m√™me les combiner en un seul, mais √† mon avis, ce sont de mauvaises mani√®res. <br><br>  Comme vous pouvez le voir dans le script, par d√©faut _SoundEffectsMute est d√©clar√© faux, donc chaque fois que le jeu d√©marre, SettingsHolder.SoundEffectsMute retournera faux, que l'utilisateur l'ait modifi√© ou non auparavant (il est modifi√© √† l'aide du bouton sur la sc√®ne du menu). <br><br clear="all">  <b>Enregistrement de variables</b> <br>  Le plus optimal pour une application Android sera d'utiliser la m√©thode PlayerPrefs.SetInt pour la sauvegarde (pour plus de d√©tails voir la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation officielle</a> ).  Il existe deux options pour conserver la valeur de SettingsHolder.SoundEffectsMute dans PlayerPrefs, appelons-les ¬´simples¬ª et ¬´√©l√©gantes¬ª. <br><br clear="all">  La fa√ßon ¬´simple¬ª (pour moi comme √ßa) est dans la m√©thode OnMouseDown () de la classe du bouton susmentionn√©.  La valeur stock√©e est charg√©e dans la m√™me classe mais dans la m√©thode Start (): <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ButtonSoundMute</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    ,  PlayerPrefs    bool switch (PlayerPrefs.GetInt ("SoundEffectsMute")) { case 0: SettingsHolder.SoundEffectsMute = false; break; case 1: SettingsHolder.SoundEffectsMute = true; break; default: //    default SettingsHolder.SoundEffectsMute = true; break; } } void OnMouseDown(){ SettingsHolder.SoundEffectsMute = !SettingsHolder.SoundEffectsMute; //    ,  PlayerPrefs    bool if (SettingsHolder.SoundEffectsMute) PlayerPrefs.SetInt ("SoundEffectsMute", 1); else PlayerPrefs.SetInt ("SoundEffectsMute", 0); } }</span></span></code> </pre><br><br clear="all">  La m√©thode "√©l√©gante", √† mon avis, n'est pas la plus correcte, car  compliquer la maintenance du code, mais il y a quelque chose dedans, et je ne peux pas m'emp√™cher de le partager.  Une caract√©ristique de cette m√©thode est que le setter de la propri√©t√© SettingsHolder.SoundEffectsMute est appel√© √† un moment qui ne n√©cessite pas de hautes performances, et il peut √™tre charg√© (oh, horreur) √† l'aide de PlayerPrefs (lecture - √©criture dans un fichier).  Modifiez la classe statique publique SettingsHolder: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SettingsHolder</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _SoundEffectsMute = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> SoundEffectsMute{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _SoundEffectsMute; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>{ _SoundEffectsMute = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_SoundEffectsMute) PlayerPrefs.SetInt (<span class="hljs-string"><span class="hljs-string">"SoundEffectsMute"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> PlayerPrefs.SetInt (<span class="hljs-string"><span class="hljs-string">"SoundEffectsMute"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } }</code> </pre><br>  La m√©thode OnMouseDown de la classe ButtonSoundMute se simplifiera pour: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnMouseDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ SettingsHolder.SoundEffectsMute = !SettingsHolder.SoundEffectsMute; }</code> </pre><br><br clear="all">  Cela ne vaut pas la peine de charger le getter avec la lecture d'un fichier, car il est impliqu√© dans un processus critique pour les performances - dans la m√©thode PlaySound () de la classe GameField: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySound</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AudioClip Clip = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!SettingsHolder.SoundEffectsMute) { <span class="hljs-comment"><span class="hljs-comment">//      ‚Äú‚Äù  (. ) if (!Sound [0].isPlaying) { Sound [0].clip = Clip; Sound [0].Play (); } else { Sound [1].clip = Clip; Sound [1].Play (); } } }</span></span></code> </pre><br><br clear="all">  De la mani√®re ci-dessus, vous pouvez organiser le stockage dans le jeu de toutes les variables. <br><br clear="all"><br clear="all"><h3>  Cinqui√®me probl√®me - UN POUR TOUS </h3><br>  <b>Cette musique sera √©ternelle</b> <br>  T√¥t ou tard, tout le monde fait face √† un tel probl√®me, et je n'ai pas fait exception.  Comme pr√©vu, la musique de fond commence √† jouer m√™me dans la sc√®ne du menu, et si elle n'est pas d√©sactiv√©e, elle joue le menu, le jeu et les partitions sur les sc√®nes sans interruption.  Mais si l'objet "jouant" de la musique de fond est install√© sur la sc√®ne de menu, lorsque vous acc√©dez √† la sc√®ne de jeu, il est d√©truit et le son dispara√Æt, et si vous placez le m√™me objet sur la sc√®ne de jeu, puis apr√®s la transition, la musique joue en premier.  La solution s'est av√©r√©e √™tre l'utilisation de la m√©thode DontDestroyOnLoad (Object target) plac√©e dans la m√©thode Start () de la classe dont l'instance de script a l'objet ¬´music¬ª.  Pour ce faire, cr√©ez le script DontDestroyThis.cs: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DontDestroyThis</span></span>: <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ DontDestroyOnLoad(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.gameObject); } }</code> </pre><br><img width="40%" align="left" src="https://habrastorage.org/webt/ee/cj/hn/eecjhn5uyzoclq7ywnqztl1untu.png">  Pour que tout fonctionne, l'objet ¬´musical¬ª doit √™tre root (au m√™me niveau de hi√©rarchie que la cam√©ra principale). <br clear="all"><br clear="all">  <b>Pourquoi la musique de fond dans le chargeur</b> <br>  La capture d'√©cran montre que l'objet ¬´musical¬ª ne se trouve pas sur la sc√®ne du menu mais sur la sc√®ne du chargeur.  Il s'agit d'une mesure caus√©e par le fait que la sc√®ne de menu peut √™tre charg√©e plus d'une fois (apr√®s la sc√®ne de partitions, la transition vers la sc√®ne de menu), et chaque fois qu'elle est charg√©e, un autre objet ¬´musical¬ª sera cr√©√© et l'ancien ne sera pas supprim√©.  Cela peut √™tre fait comme dans l'exemple de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la documentation officielle</a> , mais j'ai d√©cid√© de profiter du fait que la sc√®ne du chargeur ne sera charg√©e qu'une seule fois. <br><br>  Sur ce point, les probl√®mes cl√©s que j'ai rencontr√©s lors du d√©veloppement de mon premier jeu sur Unity, avant de t√©l√©charger sur le Play Market (je n'ai pas encore enregistr√© de compte d√©veloppeur), se sont termin√©s avec succ√®s. <br><br>  <b>PS</b> <br>  <i>Si les informations vous ont √©t√© utiles, vous pouvez soutenir l'auteur, et il enregistrera enfin un compte de d√©veloppeur Android.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458914/">https://habr.com/ru/post/fr458914/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458904/index.html">Visualisation du nombre de victoires pour les √©quipes NBA √† l'aide de graphiques √† barres anim√©es en R</a></li>
<li><a href="../fr458906/index.html">[Iekaterinbourg, annonce] Flutteron - un atelier sur le d√©veloppement de Flutter</a></li>
<li><a href="../fr458908/index.html">Num√©risation de documents sur le r√©seau</a></li>
<li><a href="../fr458910/index.html">Benchmarking PostgreSQL avec de grandes pages Linux</a></li>
<li><a href="../fr458912/index.html">Migration vers Zimbra avec imapsync</a></li>
<li><a href="../fr458916/index.html">Sous le capot de React. Nous √©crivons notre impl√©mentation √† partir de z√©ro</a></li>
<li><a href="../fr458918/index.html">Ce que vous pouvez apprendre de la conception de jeux hyper-occasionnels</a></li>
<li><a href="../fr458920/index.html">Conf√©rence pour les fans de DevOps</a></li>
<li><a href="../fr458922/index.html">Comment passer d'ESXi √† KVM / LXD et ne pas perdre la t√™te</a></li>
<li><a href="../fr458924/index.html">Les accidents vous aident √† apprendre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>