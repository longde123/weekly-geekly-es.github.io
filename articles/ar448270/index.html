<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😠 👩🏼‍🚀 🍥 تغيير إعدادات البرنامج مع الحفاظ على الإعدادات الشخصية 🍜 👩‍🏫 🚴🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="قبل التاريخ 
 في مؤسسة طبية واحدة ، قاموا بتنفيذ حلول تعتمد على خوادم Orthanc PACS وعملاء DICOM من Radiant. أثناء الإعداد ، اكتشفنا أن كل عميل DICOM ي...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>تغيير إعدادات البرنامج مع الحفاظ على الإعدادات الشخصية</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448270/" style=";text-align:right;direction:rtl"><h2 style=";text-align:right;direction:rtl">  قبل التاريخ </h2><br>  في مؤسسة طبية واحدة ، قاموا بتنفيذ حلول تعتمد على خوادم Orthanc PACS وعملاء DICOM من Radiant.  أثناء الإعداد ، اكتشفنا أن كل عميل DICOM يجب أن يوصف في خوادم PACS كما يلي: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  اسم العميل </li><li style=";text-align:right;direction:rtl">  اسم AE (يجب أن يكون فريدًا) </li><li style=";text-align:right;direction:rtl">  منفذ TCP يفتح تلقائيًا من جانب العميل ويستقبل اختبارات DICOM من خادم PACS (أي يدفعها الخادم نحو العميل ، كما لو كان بدء الاتصال أولاً) </li><li style=";text-align:right;direction:rtl">  عنوان IP </li></ul><br>  بعد إعداد عملاء Radiant ، تلقى المعلومات التالية للنظر فيها - بالنسبة لكل عميل ، أدى إعداد البرنامج باستخدام المعلمات أعلاه إلى ملء ملف <b>pacs.xml</b> ، والذي كان موجودًا في ملف تعريف المستخدم (المسار: <b>٪ APPDATA٪ \ RadiantViewer \ pacs.xml</b> ).  في الوقت نفسه ، اختلف تكوين عميل واحد عن الآخر من خلال معلمتين على الأقل (اسم AE مختلف بالنسبة للجميع ، والمنفذ هو نفسه بشكل أساسي ، باستثناء عملاء الأجهزة الطرفية التي تعمل على نفس الخادم - كان عليك أيضًا تعيين المنافذ المختلفة). <br><br>  مثال على ملف pacs.xml من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الرابط</a> : <br><br>  لمدة نصف عام كان كل شيء على ما يرام ، نجح النظام ... وبعد ذلك وصلت إلى " <b>المزالق</b> ": <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  نحتاج إلى تشغيل العديد من خوادم PACS الجديدة ، والتي ستحل محل الخوادم القديمة (حيث بدأت مساحة القرص تنفد).  خوادم PACS في الأجهزة الافتراضية ، ولكن هذا لا يتعلق بذلك ؛ </li><li style=";text-align:right;direction:rtl">  نحتاج إلى تغيير التكوينات الفريدة بطريقة أو بأخرى مركزيًا (بمعلمتين مختلفتين) على 200 جهاز (يتم زيادة عددها بانتظام) ؛ </li><li style=";text-align:right;direction:rtl">  بالنظر إلى معدل نمو حجم الامتحانات ، فإن الحل ليس مرة واحدة ، ولكن يتم تكرارها ومنتظم (على سبيل المثال ، مرة واحدة كل 3-5 أشهر). </li></ul><br>  الحل هو أدناه. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  اختيار الأدوات لحل المشكلة </h2><br>  في البداية ، كانت هناك محاولات لإيجاد بعض الحلول التي غيرت ملف pacs.xml من جانب العميل وأجرت تغييرات على قائمة خوادم PACS دون لمس اسم AE وإعدادات منفذ TCP.  كان عملاء Windows في ذلك الوقت يعتمدون على نظامي التشغيل Windows XP و Windows 7 - لذا كانت هناك محاولات لكتابة شيء من هذا القبيل على VBScript.  لكن للأسف ، لم يكن من الممكن التغلب على هذه المهمة ، بالنظر إلى الافتقار الكامل إلى الخبرة في كتابة أي شيء معقد ومعقد بهذه اللغة.  لم تنجح محاولات العثور على وإعادة الكتابة (تجدر الإشارة إلى أن هناك بالفعل خطة مختلفة في رأسي ، لذلك لم أزعج VBScript لأكثر من 3-4 ساعات). <br><br>  في النهاية ، استقرت على الحل التالي: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  جمع جميع ملفات pacs.xml حسب سياسة المجموعة في مكان واحد على أي خادم في مشاركة عبر شبكة ؛ </li><li style=";text-align:right;direction:rtl">  تعديل الملفات بكميات كبيرة (هناك بالفعل خبرة في حل مثل هذه المشكلات - باستخدام Perl) ؛ </li><li style=";text-align:right;direction:rtl">  أيضًا ، استخدم سياسات المجموعة لتحديث إعدادات العميل. </li></ul><br><h3 style=";text-align:right;direction:rtl">  جمع الملفات باستخدام نهج المجموعة </h3><br>  أبسط جزء هو أنه عندما يقوم العميل بتسجيل الدخول إلى ملفه الشخصي ، فإنه يقوم بحقوقه بتشغيل ملف .bat معين مكتوب فيه: <br><br><pre style=";text-align:right;direction:rtl"><code class="vbscript hljs">echo off <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> exist %APPDATA%\RadiantViewer\pacs.xml copy %APPDATA%\RadiantViewer\pacs.xml \\srv.test.local\pconfigs$\pacs-%COMPUTERNAME%-%USERNAME%.xml</code> </pre> <br>  وبالتالي ، سيتم تجميع ملفات pacs.xml على الخادم في مورد مخفي ، يحتوي اسمه على معلومات من جهاز الكمبيوتر ومن المستخدم الذي تم نسخ هذا التكوين منه. <br><br>  كان أصعب شيء هو انتظار جميع المستخدمين لإكمال هذه السياسة. <br><br><h3 style=";text-align:right;direction:rtl">  تغيير التكوينات باستخدام برنامج نصي Perl </h3><br>  نحتاج إلى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Active Perl</a> لـ Windows من ActiveState ، بالإضافة إلى وحدة XML :: Writer ، والتي يمكن تثبيتها باستخدام الأمر <b>ppm install XML-Writer</b> . <br><br>  البرنامج النصي نفسه تبين أنه بسيط للغاية: <br><br><pre style=";text-align:right;direction:rtl"> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> XML::Writer; <span class="hljs-comment"><span class="hljs-comment">#    ,   ( ): $report_dir = "C:\\Perl64\\WORK\\PACS-xml3\\"; opendir(DIR, "$report_dir") or die "     !"; @report_files = readdir DIR; shift (@report_files); #      (.) shift (@report_files); #       (..) # print "@report_files"; closedir(DIR); #    -    .    AET     . foreach $analiz_file (@report_files) { $full_path_to_file="C:\\Perl64\\WORK\\PACS-xml3\\".$analiz_file; open (INFO, $full_path_to_file); while ($line = &lt;INFO&gt;) { #  $aet  $port      XML : my ($other1, $aet, $other2, $port, $other3) = split /\"/, $line, 5; #    listener -           XML: if ($other1 =~ 'listener') { #   XML c    : my $writer = XML::Writer-&gt;new(OUTPUT =&gt; 'self', DATA_MODE =&gt; 1, DATA_INDENT =&gt; 2, ); $writer-&gt;xmlDecl('utf-8'); $writer-&gt;startTag('pacs'); $writer-&gt;startTag('listener', ae =&gt; $aet, port =&gt; $port); $writer-&gt;endTag(); $writer-&gt;startTag('hosts'); $writer-&gt;startTag('host', name =&gt; 'MRT', ae =&gt; 'ORTHANC', ip =&gt; 'XX.YY.214.17', ts =&gt; '1.2.840.10008.1.2.1', port =&gt; '4242', maxassoc =&gt; '1', allpres =&gt; '0', search =&gt; '1', protocol =&gt; '1', searchcharset =&gt; '', wildcards =&gt; '3', carets =&gt; '0'); $writer-&gt;endTag(); $writer-&gt;startTag('host', name =&gt; 'KT', ae =&gt; 'ORTHANC2', ip =&gt; 'XX.YY.215.253', ts =&gt; '1.2.840.10008.1.2.1', port =&gt; '4242', maxassoc =&gt; '1', allpres =&gt; '0', search =&gt; '1', protocol =&gt; '1', searchcharset =&gt; '', wildcards =&gt; '3', carets =&gt; '0'); $writer-&gt;endTag(); $writer-&gt;startTag('host', name =&gt; 'R', ae =&gt; 'ORTHANC3', ip =&gt; 'XX.YY.215.252', ts =&gt; '1.2.840.10008.1.2.1', port =&gt; '4242', maxassoc =&gt; '1', allpres =&gt; '0', search =&gt; '1', protocol =&gt; '1', searchcharset =&gt; '', wildcards =&gt; '3', carets =&gt; '0'); $writer-&gt;endTag(); $writer-&gt;startTag('host', name =&gt; 'KT-20180501-20180831', ae =&gt; 'ORTHANC4', ip =&gt; 'XX.YY.215.251', ts =&gt; '1.2.840.10008.1.2.1', port =&gt; '4242', maxassoc =&gt; '1', allpres =&gt; '0', search =&gt; '1', protocol =&gt; '1', searchcharset =&gt; '', wildcards =&gt; '3', carets =&gt; '0'); $writer-&gt;endTag(); $writer-&gt;startTag('host', name =&gt; 'KT-20180901-20181130', ae =&gt; 'ORTHANC5', ip =&gt; 'XX.YY.215.250', ts =&gt; '1.2.840.10008.1.2.1', port =&gt; '4242', maxassoc =&gt; '1', allpres =&gt; '0', search =&gt; '1', protocol =&gt; '1', searchcharset =&gt; '', wildcards =&gt; '3', carets =&gt; '0'); $writer-&gt;endTag(); $writer-&gt;endTag('hosts'); $writer-&gt;startTag('presets'); $writer-&gt;endTag(); $writer-&gt;startTag('lastsearch', dt =&gt; '4', mfid =&gt; '1048592'); $writer-&gt;endTag(); $writer-&gt;endTag('pacs'); #   XML  : my $xml = $writer-&gt;end(); #    : $rewritexml = $full_path_to_file; #  XML   : open (NEWXML, "&gt;$rewritexml"); print NEWXML $xml; close (NEWXML); } } }</span></span></code> </pre><br>  مبدأ عملها: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  نفتح الدليل الذي جمعنا فيه تكوينات pacs.xml من العملاء ونضع قائمة الملفات في مجموعة من المقاييس (report_files) ؛ </li><li style=";text-align:right;direction:rtl">  في حلقة ، نقوم بمعالجة ملف واحد في وقت واحد وقراءته سطرا سطرا. </li><li style=";text-align:right;direction:rtl">  باستخدام الانقسام ، قم بتقسيم كل سطر إلى 5 أجزاء ، باستخدام علامات الاقتباس كفاصل ؛ </li><li style=";text-align:right;direction:rtl">  نجد السطر مع مستمع الكلمات ونضع في متغيرين بيانات فريدة لكل ملف (اسم العميل AE ورقم منفذ TCP) ؛ </li><li style=";text-align:right;direction:rtl">  بعد ذلك ، نقوم ببساطة بإنشاء ملف XML جديد ، وإدخال معلمات فريدة فيه ، ثم إدخال العدد المطلوب من خوادم PACS مع معلماتها - <b>أي</b>  <b>شيء بدأ كل شيء فيه</b> ) </li><li style=";text-align:right;direction:rtl">  أعد كتابة ملف XML الجديد أعلى الملف القديم. </li></ul><br>  تجدر الإشارة إلى أنه في الواقع لا أستخدم هذا البرنامج النصي تلقائيًا بالكامل - في الواقع ، أقوم بنسخ التكوينات المجمعة إلى دليل منفصل ثم قم بتشغيل البرنامج النصي وتغييرها جميعًا معًا.  ثم فحص عشوائي - ويمكن سكب التكوينات مرة أخرى في الآلات. <br><br><h3 style=";text-align:right;direction:rtl">  توزيع ملفات pacs.xml المعدلة للعملاء </h3><br>  إن أبسط شيء حدث لي هو إجراء تغييرات على ملف .bat يعمل بالفعل والذي يجمع التكوينات من العملاء وإضافة سطر: <br><br><pre style=";text-align:right;direction:rtl"> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">If</span></span> exist %APPDATA%\RadiantViewer\pacs.xml copy /Y \\srv.test.local\pconfigsnew$\pacs-%COMPUTERNAME%-%USERNAME%.xml %APPDATA%\RadiantViewer\pacs.xml</code> </pre><br>  ملف .bat الناتج يشبه هذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="vbscript hljs">@echo off <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> exist %APPDATA%\RadiantViewer\pacs.xml copy %APPDATA%\RadiantViewer\pacs.xml \\srv.test.local\pconfigs$\pacs-%COMPUTERNAME%-%USERNAME%.xml <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> exist %APPDATA%\RadiantViewer\pacs.xml copy /Y \\srv.test.local\pconfigsnew$\pacs-%COMPUTERNAME%-%USERNAME%.xml %APPDATA%\RadiantViewer\pacs.xml</code> </pre><br><h3 style=";text-align:right;direction:rtl">  استنتاج </h3><br>  هذا هو الحل " <b>العالي في الركبة</b> ".  لقد اختبرناه مرتين بالفعل (في سبتمبر 2018 وفي فبراير 2019) ، بينما كانت الرحلة عادية.  بالطبع ، لا يتم تحديث 100٪ من العملاء ، لكن قريبًا من هذه القيمة - ننهي البقية عن بُعد.  النصي حسب <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">المرجع</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar448270/">https://habr.com/ru/post/ar448270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar448260/index.html">قم بتكوين Visual Studio في مؤسستك باستخدام .vsconfig</a></li>
<li><a href="../ar448262/index.html">كيفية لعب Speedgate ، أول رياضة تم إنشاؤها بواسطة AI</a></li>
<li><a href="../ar448264/index.html">الدهون الباردة لا شيء: منع تبلور الماء في -263 درجة مئوية</a></li>
<li><a href="../ar448266/index.html">اتصل! كيفية تجميع طالب الويب الخاص بك في غضون ساعة</a></li>
<li><a href="../ar448268/index.html">أنظمة الهاتف المعبأة</a></li>
<li><a href="../ar448272/index.html">لماذا صممت الطائرة على وجه التحديد قبل المغادرة ، وماذا سيحدث إذا لم يتم ذلك؟</a></li>
<li><a href="../ar448274/index.html">رصد الرسائل القصيرة من وزن ثلاث خلايا مقابل 35 دولار</a></li>
<li><a href="../ar448276/index.html">كيف يعيش ألفا بنك في فترة من التغيير وما تمكنا من فعله عند الجمع بين تطوير تكنولوجيا المعلومات ومختبر ألفا</a></li>
<li><a href="../ar448278/index.html">رهن تقني: مدين ولمن يدين الفريق</a></li>
<li><a href="../ar448280/index.html">اختبار محرك nanoCAD SPDS Metalwork 1.2. الجزء 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>