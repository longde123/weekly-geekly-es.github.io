<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüíª üç± üíÄ Cr√©ation d'un graphique lin√©aire moyen anim√© anim√© dans R. R√©cup√©ration de donn√©es via l'API NBA üè£ üöª üéüÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous continuons d'analyser les donn√©es de basket-ball en utilisant R. 


 Contrairement √† l' article pr√©c√©dent, qui √©tait exclusivement de nature dive...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cr√©ation d'un graphique lin√©aire moyen anim√© anim√© dans R. R√©cup√©ration de donn√©es via l'API NBA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459142/"><p>  Nous continuons d'analyser les donn√©es de basket-ball en utilisant R. </p><br><p>  Contrairement √† l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> pr√©c√©dent, qui √©tait exclusivement de nature divertissante, les graphiques qui seront construits dans cet article peuvent √™tre int√©ressants du point de vue de l'analyse du jeu d'√©quipe de la campagne de la saison. </p><br><p>  Et nous allons construire des graphiques de moyenne mobile pour trois types de notes d'√©quipe NBA: attaquant, d√©fensif et net (c'est-√†-dire la diff√©rence entre les deux premiers).  En bref √† leur sujet.  Les notes offensives et d√©fensives sont le nombre de points marqu√©s / manqu√©s par une √©quipe pour 100 possessions.  Note NET - c'est leur diff√©rence pour cent possessions.  Toute personne int√©ress√©e √† en savoir plus √† leur sujet peut lire le glossaire sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">basket-r√©f√©rence</a> .  Il existe une formule de calcul, que j'ai √©galement impl√©ment√©e √† l'aide de R, mais je n'ai pas encore publi√© d'article √† ce sujet. </p><a name="habracut"></a><br><p>  Je vais √©galement expliquer pourquoi je vais construire le graphique de la moyenne mobile.  Dans chaque match individuel, la proportion d'al√©atoire est trop √©lev√©e, les indicateurs passent de 70 √† 150, ce qui rend l'analyse des donn√©es inutile, et le graphique lui-m√™me ressemble plus √† un cardiogramme.  Si nous prenons la moyenne cumulative, nous obtenons alors un autre extr√™me: le calendrier est similaire aux fluctuations amorties et les matchs √† la fin de la saison, lorsqu'ils sont ajout√©s aux 70-75 matchs d√©j√† organis√©s, n'affectent pratiquement pas l'indicateur global.  En gros, ils ne sont "pas visibles".  La moyenne mobile dans ce cas est le moyen de sortir de l'impasse.  D'une part, l'influence du hasard diminue, d'autre part, il n'y a pas d'accumulation excessive de r√©sultats.  Dans les statistiques de basket-ball, ils font g√©n√©ralement une moyenne mobile de 10 matchs. </p><br><h2 id="ispolzuemye-biblioteki">  Biblioth√®ques utilis√©es </h2><br><pre><code class="plaintext hljs">library(httr) library(jsonlite) library(tidyverse) library(lubridate) library(zoo) library(ggthemes) library(gganimate)</code> </pre> <br><h2 id="poluchenie-dannyh-s-pomoschyu-nba-api">  R√©cup√©ration de donn√©es √† l'aide de l'API NBA </h2><br><p>  La derni√®re fois, j'ai r√©cup√©r√© des donn√©es √† l'aide de l'extension <strong>NBA Data Retriever</strong> .  Cette fois, j'utiliserai l'API NBA pour charger directement les donn√©es requises dans R. </p><br><p>  Nous d√©couvrons d'abord o√π obtenir ces donn√©es.  Pour ce faire, ouvrez la page dont nous avons besoin sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stats.nba.com</a> et acc√©dez aux outils de d√©veloppement.  Ouvrez ensuite R√©seau -&gt; XHR et appuyez sur F5.  Dans la liste qui appara√Æt, nous trouvons un fichier avec un nom similaire au nom de la page.  Nous avons besoin de lui.  Apr√®s vous √™tre assur√© que vous avez s√©lectionn√© le bon fichier, copiez son adresse dans R. Dans les images, il ressemble √† ceci. </p><br><p>  <em>ouvrez le fichier souhait√©</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ce/6cf/41f/3ce6cf41f2cb07bcd73b757b311c9c80.png"></p><br><p>  <em>le fichier devrait ressembler √† ceci</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7c8/9c4/aca/7c89c4aca8872754cdb2212bdeba85df.png"></p><br><p>  <em>copie √† l'adresse R</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a43/06c/c65/a4306cc65e873df80d9501bb329cc3ca.png"></p><br><p>  Maintenant, allons travailler dans <strong>R Studio</strong> .  Pour obtenir les informations dont nous avons besoin, nous utilisons la fonction <code>GET</code> du package <code>http</code> .  Cependant, pour que la demande soit ex√©cut√©e correctement (cela peut √™tre v√©rifi√© par la fonction <code>status_code</code> , elle doit √™tre 200), vous devez ajouter des en-t√™tes pour d√©terminer les param√®tres de travail de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">transaction HTTP</a> </p><br><pre> <code class="plaintext hljs">##Adding headers request_headers &lt;- c( "accept-encoding" = "gzip, deflate, sdch", "accept-language" = "en-US,en;q=0.8", "cache-control" = "no-cache", "connection" = "keep-alive", "host" = "stats.nba.com", "pragma" = "no-cache", "upgrade-insecure-requests" = "1", "user-agent" = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601.3.9 (KHTML, like Gecko) Version/9.0.2 Safari/601.3.9" ) #Getting a response request &lt;- GET(adv_box_team, add_headers(request_headers))</code> </pre> <br><p>  Nous obtenons une r√©ponse comme celle-ci: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d08/a37/841/d08a378417726a4e7ae4c535dec57836.png"></p><br><p>  Mais alors que les donn√©es dont nous avons besoin ne sont pas visibles.  Pour les obtenir, nous extrayons d'abord le <code>content</code> la demande par le <code>content</code> de la fonction dans un fichier json, puis le convertissons en une liste avec une fonction du package <code>jsonlite</code> avec le nom parlant de <code>fromJSON</code> </p><br><pre> <code class="plaintext hljs">boxscore_data &lt;- fromJSON(content(request, as = "text"))</code> </pre> <br><p>  En cons√©quence, nous obtenons une liste qui contient d√©j√† toutes les informations dont nous avons besoin, puis nous la mettons simplement sous la forme n√©cessaire pour le travail. </p><br><h2 id="podgotovka-dannyh">  Pr√©paration des donn√©es </h2><br><p>  Pour ce faire, cr√©ez un tableau de donn√©es au lieu d'une liste, puis ajoutez des en-t√™tes de colonne. </p><br><pre> <code class="plaintext hljs">#Convert to tibble data and assigning column names table &lt;- tbl_df(data.frame(boxscore_data$resultSets$rowSet[[1]], stringsAsFactors = FALSE)) names(table) &lt;- toupper(boxscore_data$resultSets$headers[[1]])</code> </pre> <br><p>  <code>toupper</code> est une fonction qui remplace tous les caract√®res par des majuscules.  Apr√®s cela, nous devrions obtenir un tableau avec 2460 lignes et 46 colonnes.  En principe, vous pouvez travailler avec le tableau sous cette forme, mais il est pr√©f√©rable d'exclure les informations inutiles, pour un travail plus pratique et plus rapide. </p><br><pre> <code class="plaintext hljs">##Select the columns you want to analyze rating &lt;- table %&gt;% select(TEAM_ID, TEAM_ABBREVIATION, TEAM_NAME, GAME_ID, GAME_DATE, MATCHUP, WL, E_OFF_RATING, E_DEF_RATING, E_NET_RATING)</code> </pre> <br><p>  Si vous regardez le tableau source, vous pouvez voir deux types de m√™me classement: ¬´normal¬ª et avec le pr√©fixe E. Sans entrer dans les d√©tails, le classement E prend en compte le rythme du jeu, il est donc plus pr√©cis.  Nous le prenons. </p><br><p>  Ensuite, je veux simplifier les noms des √©valuations.  Ils devront √™tre introduits dans les arguments de la fonction et il est pr√©f√©rable d'utiliser la notation plus famili√®re √† un large √©ventail d'utilisateurs: ORTG, DRTG, NRTG.  Ici, vous pouvez "vous perdre" en √©crivant une expression r√©guli√®re et en la rempla√ßant par <code>str_replace</code> , mais les √©crire est toujours un plaisir et ici nous pouvons nous en passer parfaitement.  Il suffit d'extraire les 3, 7, 9 et 12 caract√®res des noms actuels, de les combiner et de remplacer les noms de colonnes par le vecteur de caract√®res r√©sultant.  Tout cela se fait en utilisant les fonctions du package <code>stringr</code> : <code>str_sub</code> et <code>str_c</code> (un analogue de la base <code>paste0</code> ). </p><br><pre> <code class="plaintext hljs">## Renaming columns with E_OFF_RATING on ORTG rating1 &lt;- rating %&gt;% rename_at(vars(starts_with("E_")), list(~str_c(str_sub(., start = 3, end = 3), str_sub(., start = 7, end = 7), str_sub(., start = 9, end = 9), str_sub(., start = 12, end = 12))))</code> </pre> <br><p>  <strong>at</strong> dans les fonctions de package <code>dplyr</code> a la m√™me propri√©t√© que la construction <code>dt[, lapply(.SD, func), .SDols = col1]</code> dans le package <code>data.table</code> : l'action est appliqu√©e √† plusieurs colonnes en m√™me temps.  Ici, nous s√©lectionnons toutes les colonnes dont le nom commence par "E_". </p><br><p>  En cons√©quence, nous obtenons une telle table, avec laquelle nous continuerons √† travailler avec: </p><br><div class="scrollable-table"><table><thead><tr><th>  TEAM_ID </th><th>  TEAM_ABBREVIATION </th><th>  TEAM_NAME </th><th>  GAME_ID </th><th>  GAME_DATE </th><th>  MATCHUP </th><th>  Wl </th><th>  ORTG </th><th>  DRTG </th><th>  NRTG </th></tr></thead><tbody><tr><td>  1610612749 </td><td>  Mil </td><td>  Milwaukee dollars </td><td>  0021801226 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIL vs  Okc </td><td>  L </td><td>  102,4 </td><td>  116,8 </td><td>  -14,4 </td></tr><tr><td>  1610612766 </td><td>  Cha </td><td>  Frelons Charlotte </td><td>  0021801222 </td><td>  2019-04-10T00: 00: 00 </td><td>  CHA vs.  ORL </td><td>  L </td><td>  121,4 </td><td>  130,1 </td><td>  -8,6 </td></tr><tr><td>  1610612758 </td><td>  SAC </td><td>  Rois de Sacramento </td><td>  0021801230 </td><td>  2019-04-10T00: 00: 00 </td><td>  SAC @ POR </td><td>  L </td><td>  129,7 </td><td>  136,4 </td><td>  -6,8 </td></tr><tr><td>  1610612748 </td><td>  MIA </td><td>  Miami Heat </td><td>  0021801221 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIA @ BKN </td><td>  L </td><td>  84,2 </td><td>  103,6 </td><td>  -19,4 </td></tr><tr><td>  1610612750 </td><td>  MIN </td><td>  Loups de bois du Minnesota </td><td>  0021801228 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIN @ DEN </td><td>  L </td><td>  98,3 </td><td>  103,7 </td><td>  -5,4 </td></tr></tbody></table></div><br><h2 id="funkciya-rolling_offnet_rating_nba-dlya-postroeniya-grafika-i-animacii-skolzyaschego-srednego">  La fonction <strong><em>rolling_offnet_rating_nba</em></strong> pour tracer et animer une moyenne mobile. </h2><br><p>  Encore une fois, comme la derni√®re fois, cr√©ons une fonction pour effectuer des changements minimes dans les calculs. </p><br><p>  La fonction <code>rolling_offnet_rating_nba</code> √† ceci: </p><br><pre> <code class="plaintext hljs">rolling_offnet_rating_nba &lt;- function(table, name, variable, col1 = col1, col2 = col2)</code> </pre> <br><p>  <strong>table</strong> est le nom de la table de donn√©es, <br>  <strong>nom</strong> - l'abr√©viation de l'√©quipe pour laquelle les graphiques seront r√©alis√©s ("BOS", "LAL", etc.). <br>  <strong>variable</strong> - la cote qui sera calcul√©e (voici deux options, ORTG ou NRTG, pour la cote de protection j'ai fait une fonction distincte) <br>  <strong>col1</strong> et <strong>col2</strong> - couleur de ligne √† une valeur sup√©rieure / inf√©rieure √† la moyenne. </p><br><p>  La plupart des fonctions <code>dplyr</code> utilisent <em>une √©valuation non standard (NSE</em> ).  Il s'agit d'un terme g√©n√©ral signifiant que leur √©valuation diff√®re de l'√©valuation habituelle en R. Cela nous permet de simplifier l'√©criture de code et de travailler avec des bases de donn√©es SQL, mais le moins est que nous ne pouvons pas remplacer la valeur par un objet √©quivalent d√©fini ailleurs. </p><br><p>  <em>Dplyr</em> utilise l' <strong>√©valuation Tidy</strong> .  Par cons√©quent, il est n√©cessaire d'utiliser des outils sp√©ciaux (fonctions de citation, op√©rateur !!) pour r√©soudre les probl√®mes rencontr√©s lors de la programmation.  Vous pouvez en savoir plus √† ce sujet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , et voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  Le code suivant prend le nom de l'argument de fonction et √©crit l'expression qui lui a √©t√© pr√©sent√©e.  (Pour comprendre comment <code>enquo</code> et ses fonctions similaires fonctionnent, il est utile d'imprimer la sortie de cette fonction) </p><br><pre> <code class="plaintext hljs">##Return the entered value in the function argument in the type quosure quo_rating &lt;- enquo(variable) quo_col1 &lt;- enquo(col1) quo_col2 &lt;- enquo(col2)</code> </pre> <br><p>  Ensuite, nous changeons le format de donn√©es de certaines colonnes: nous faisons du <strong>GAME_DATE</strong> du caract√®re une colonne au format Date, et nous rendons les colonnes de notation num√©riques.  Parce que  nous appliquons la fonction <code>as.numeric</code> √† trois colonnes, puis <code>mutate_at</code> utilis√© √† la place de <code>mutate</code> .  Et nous trions tout par ordre croissant de date. </p><br><pre> <code class="plaintext hljs">##Changing the data type of multiple columns test1 &lt;- table %&gt;% mutate(GAME_DATE = as.Date(ymd_hms(GAME_DATE))) %&gt;% mutate_at(vars(ORTG:NRTG), list(~as.numeric)) %&gt;% arrange(GAME_DATE)</code> </pre> <br><p>  Et puis nous calculons la moyenne mobile de 10 matchs de l'√©quipe dont nous avons besoin.  Pour ce faire, utilisez la fonction <code>rollmeanr</code> du package <code>zoo</code> .  r √† la fin du nom signifie que le r√©sultat doit √™tre align√© √† droite.  Pour les neuf premiers matchs de la saison, une moyenne mobile de 10 matches est tout simplement impossible √† calculer, nous laissons donc ces champs inchang√©s en les remplissant en NA √† l'aide de l'argument fill.  <code>na.omit</code> supprime du tableau les lignes dans lesquelles ces NA se produisent. </p><br><pre> <code class="plaintext hljs">##The calculation of the moving average team &lt;- test1 %&gt;% filter(TEAM_ABBREVIATION == "DAL") %&gt;% mutate(RATING = rollmeanr(ORTG, k = 10, fill= NA)) %&gt;% na.omit(test1)</code> </pre> <br><p>  La table d'√©quipe ressemble √† ceci: </p><br><div class="scrollable-table"><table><thead><tr><th>  TEAM_ID </th><th>  TEAM_ABBREVIATION </th><th>  TEAM_NAME </th><th>  GAME_ID </th><th>  GAME_DATE </th><th>  MATCHUP </th><th>  Wl </th><th>  ORTG </th><th>  DRTG </th><th>  NRTG </th><th>  √âvaluation </th></tr></thead><tbody><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas mavericks </td><td>  0021800150 </td><td>  2018-11-06 </td><td>  DAL contre  √âtait </td><td>  W </td><td>  116,8 </td><td>  99,2 </td><td>  17,6 </td><td>  105,51 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas mavericks </td><td>  0021800160 </td><td>  2018-11-07 </td><td>  DAL @ UTA </td><td>  L </td><td>  98,5 </td><td>  112,0 </td><td>  -13,6 </td><td>  104,92 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas mavericks </td><td>  0021800181 </td><td>  2018-11-10 </td><td>  DAL contre  Okc </td><td>  W </td><td>  115,0 </td><td>  101,1 </td><td>  13,9 </td><td>  104,13 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas mavericks </td><td>  0021800193 </td><td>  2018-11-12 </td><td>  DAL @ CHI </td><td>  W </td><td>  98,3 </td><td>  91,0 </td><td>  7.3 </td><td>  103.03 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas mavericks </td><td>  0021800210 </td><td>  2018-11-14 </td><td>  DAL contre  UTA </td><td>  W </td><td>  117,3 </td><td>  65,8 </td><td>  51,6 </td><td>  105,34 </td></tr></tbody></table></div><br><p>  En principe, nous avons d√©j√† re√ßu les informations dont nous avons besoin.  √Ä l'aide de deux lignes de code, vous pouvez cr√©er un graphique lin√©aire.  Mais la ligne noire sur fond blanc pr√©sente peu d'int√©r√™t d'un point de vue √† la fois esth√©tique et informatif.  Une autre partie du "corps de fonction" corrige cela. </p><br><p>  Pour commencer, nous ajoutons les donn√©es sur la valeur moyenne, 10e et 21e (dixi√®me √† partir du bas), ainsi que la date 10 du match par √©quipe (c'est-√†-dire la premi√®re pour laquelle la moyenne mobile est calcul√©e et qui est rest√©e dans le tableau d'√©quipe apr√®s avoir supprim√© les lignes de NA) . </p><br><pre> <code class="plaintext hljs">##The average, 10 and 21 ratings in the entire League. average &lt;- league %&gt;% mutate(average = mean(!! quo_rating)) %&gt;% select(average) %&gt;% unique() %&gt;% .$average top10 &lt;- league %&gt;% arrange(desc(!! quo_rating)) %&gt;% select(!! quo_rating) %&gt;% slice(10) top10 &lt;- top10[[1]] bottom10 &lt;- league %&gt;% arrange(desc(!! quo_rating)) %&gt;% select(!! quo_rating) %&gt;% slice(21) bottom10 &lt;- bottom10[[1]] ##Getting the date of the first rollaverage data &lt;- team %&gt;% select(GAME_DATE) %&gt;% arrange(GAME_DATE) data &lt;- data[[1,1]]</code> </pre> <br><p>  √Ä partir des fonctions pr√©c√©demment inutilis√©es, la fonction <code>slice</code> appara√Æt ici, qui s√©lectionne les lignes par leur num√©ro de s√©rie. </p><br><p>  Ensuite, nous s√©lectionnons 2 couleurs et leur nom.  Les donn√©es, comme la derni√®re fois, sont <code>table_color</code> de la table <code>table_color</code> .  Le nom sera utilis√© dans l'en-t√™te du graphique pour expliquer laquelle des couleurs correspond √† des valeurs inf√©rieures √† la moyenne et laquelle est sup√©rieure. </p><br><pre> <code class="plaintext hljs">##Getting color and color_name selected color color1 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(!! quo_col1) color1 &lt;- color1[[1]] color2 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(!! quo_col2) color2 &lt;- color2[[1]] name1 &lt;- paste0("name_", quo_name(quo_col1)) name2 &lt;- paste0("name_", quo_name(quo_col2)) name_color1 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(name1) name_color1 &lt;- name_color1[[1]] name_color2 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(name2) name_color2 &lt;- name_color2[[1]]</code> </pre> <br><p>  Les arguments de la fonction sont par d√©faut col1 et col2, ce sont les premi√®re et deuxi√®me couleurs des commandes.  Dans la plupart des cas (plus pr√©cis√©ment dans 26), ces valeurs n'ont pas besoin d'√™tre modifi√©es, cependant, pour quatre √©quipes, la couleur suivante doit √™tre utilis√©e dans leur palette de couleurs.  √Ä Dallas et au Minnesota, les premi√®re et deuxi√®me couleurs sont trop similaires, tandis qu'√† Milwaukee et Brooklyn, elles ne sont pas visibles sur fond blanc.  √Ä la fois cela, et un autre complique la lecture du calendrier, il vaut donc la peine d'utiliser l'argument col2 = col3 pour eux. </p><br><p>  Ensuite, nous obtenons la note maximale pour l'√©quipe.  Nous aurons besoin de cette valeur pour organiser le texte avec la valeur de notation sur le graphique.  Je veux faire attention √† la derni√®re ligne de code.  Il se trouve que les fonctions ont parfaitement trac√© les graphiques dans 89 des 90 cas, mais lors de la construction d'un indice de protection, Milwaukee a donn√© une erreur.  Il s'est av√©r√© que la valeur nominale maximale √† Milwaukee est atteinte deux fois et <code>ggplot2</code> commence naturellement √† jurer que l'esth√©tique devrait √™tre, dans notre cas, 1 ou 73. Par cons√©quent, nous avons besoin d'une seule valeur nominale maximale. </p><br><pre> <code class="plaintext hljs">##The maximum value of the rating max &lt;- team %&gt;% filter(RATING == max(RATING)) %&gt;% select(RATING) max &lt;- max[[1]]</code> </pre> <br><h2 id="postroenie-statichnogo-grafika-v-ggplot2">  Construire un graphe statique dans <code>ggplot2</code> </h2><br><pre> <code class="plaintext hljs">##Building and save a static chart Sys.setlocale("LC_ALL", "C") gg &lt;- ggplot(team, aes(GAME_DATE, RATING)) + geom_hline(yintercept = c(top10, bottom10), col = c("red", "blue")) + annotate(geom = "text", x = as.Date(data) + 2, y = top10 - 0.2, label = "TOP 10", col = "red") + annotate(geom = "text", x = as.Date(data) + 2, y = bottom10 + 0.2, label = "BOTTOM 10", col = "blue") + geom_line(size = 2, col = if_else(team$RATING &gt; average, color1, color2)) + theme_tufte() + labs(title = paste0(team$TEAM_NAME, " 10-Game Rolling ", quo_name(quo_rating)), subtitle = paste0(paste0(name_color1, " - above average ", quo_name(quo_rating)), "\n", paste0(name_color2, " - below average ", quo_name(quo_rating))), caption = "Source: BBall Index Data &amp; Tools\nTelegram: @NBAatlantic, twitter: @vshufinskiy") theme(plot.title = element_text(size = 12, hjust = 0.5), plot.caption = element_text(size = 10), plot.subtitle = element_text(size = 9)) ggsave(paste0(unique(team$TEAM_NAME), quo_name(quo_rating), ".jpeg"), gg, width = 8, units = "in")</code> </pre> <br><p>  Parmi les nouveaut√©s ici, l'utilisation de la fonction <code>if_else</code> pour changer la couleur de la ligne selon que la note moyenne de la ligue est sup√©rieure ou inf√©rieure, ainsi que la premi√®re ligne qui modifie les param√®tres r√©gionaux.  Ceci est fait de sorte que les abr√©viations des noms des mois le long de l'axe X soient √©crites en anglais. <br><img src="https://habrastorage.org/webt/3b/yv/la/3byvlasu52uwfin6f8prdwipms0.jpeg"></p><br><h2 id="postroenie-animacii-10-matchevogo-skolzyaschego-srednego">  Animation d'une moyenne mobile de 10 correspondances. </h2><br><p>  Dans la construction de l'animation, j'ai ajout√© plusieurs lotions qui ne sont pas possibles dans la version statique.  Tout d'abord, la date de changement (similaire √† la fa√ßon dont l'ann√©e a chang√© dans le dernier article), ainsi que la valeur de la notation √† un moment donn√©.  Il change √©galement de couleur selon qu'il est sup√©rieur ou inf√©rieur √† la moyenne. </p><br><pre> <code class="plaintext hljs">##Building animations anim &lt;- gg + theme(plot.title = element_text(hjust = 0.5, size = 25), plot.subtitle = element_text(size = 15), plot.caption = element_text(size = 15), axis.text = element_text(size = 15), axis.title = element_text(size = 18)) + geom_text(aes(x = as.Date(data), y = max + 0.5), label = paste0(quo_name(quo_rating)," ", round(team$RATING, digits = 1)), size = 6, col = if_else(team$RATING &gt; average, color1, color2)) + transition_reveal(GAME_DATE) + labs(title = paste0(team$TEAM_NAME, " 10-Game Rolling ", quo_name(quo_rating)), subtitle = paste0(paste0(name_color1, " - above average ",quo_name(quo_rating)), "\n", paste0(name_color2, " - below average ",quo_name(quo_rating)), "\n", "Date: {frame_along}"), caption = paste0("Source: stats.nba.com\nTelegram: @NBAatlantic, twitter: @vshufinskiy"))</code> </pre> <br><h2 id="rezultat">  R√©sultat </h2><br><p><img src="https://habrastorage.org/webt/do/b-/hy/dob-hyqopjihkywk9kaq4jsrihg.gif"></p><br><p>  Sur le graphique, il est assez √©vident que Dallas a plong√© dans la seconde moiti√© de f√©vrier-mars.  L'explication est tr√®s simple: c'est √† ce moment de la saison que les Mavericks ont √©chang√© 4 joueurs sur 5 dans leurs cinq premiers et le principal atout entrant, le letton Kristaps Porzingis, n'a pas jou√© pendant une minute en raison de la rupture des ligaments crois√©s. </p><br><p>  Ici, je ne vais pas me plonger dans la composante sportive, donc si quelqu'un est int√©ress√© √† voir les 89 autres graphiques de la saison 2018-19, alors vous √™tes les bienvenus sur mon blog sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sports.ru</a> , o√π j'ai l'intention d'√©crire un article avec un aper√ßu des plus int√©ressants d'entre eux ou dans mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©gramme canal</a> sur la NBA, o√π je vais tous les poster. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©p√¥t GitHub</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459142/">https://habr.com/ru/post/fr459142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459130/index.html">Traitement des erreurs en douceur dans les microservices</a></li>
<li><a href="../fr459134/index.html">Exp√©rience avec BDD</a></li>
<li><a href="../fr459136/index.html">Fausse pilule bleue</a></li>
<li><a href="../fr459138/index.html">Comment la cl√© secr√®te Huawei est entr√©e dans le firmware des routeurs Cisco</a></li>
<li><a href="../fr459140/index.html">Pose d'implants: comment cela se fait-il?</a></li>
<li><a href="../fr459144/index.html">Frontend Weekly Digest (1-7 juillet 2019)</a></li>
<li><a href="../fr459146/index.html">Food Design Digest juin 2019</a></li>
<li><a href="../fr459150/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 372 (1 - 7 juillet 2019)</a></li>
<li><a href="../fr459152/index.html">Remplissez des documents dans Microsoft Word √† l'aide de Python. 2e partie</a></li>
<li><a href="../fr459154/index.html">R√©seau pour les petites entreprises utilisant des √©quipements Cisco. Partie 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>