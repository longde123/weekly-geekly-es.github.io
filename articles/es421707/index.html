<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📫 👧🏼 🤳🏽 FB2D - Marco 2D para Linux Frame Buffer (Rust) 🖖🏽 🎐 💌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Así que decidí contar sobre la biblioteca que escribí recientemente. Quizás alguien sea útil. 
 Este es un marco Rust 2D para renderizar directamente ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>FB2D - Marco 2D para Linux Frame Buffer (Rust)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421707/"><p>  Así que decidí contar sobre la biblioteca que escribí recientemente.  Quizás alguien sea útil. <br>  Este es un marco Rust 2D para renderizar directamente en Linux Frame Buffer / dev / fb0. </p><br><p>  La tarea consistía en mostrar escenas 2D simples en la pantalla / TV en la Raspberry Pi.  El Raspberry Pi se ejecuta bajo el control del Linux sin cabeza personalizado compilado con YoctoProject.  Faltan administradores de ventanas, al igual que OpenGL.  Solo queda el Frame Buffer. </p><br><p>  En el caso de Frame Buffer, cada píxel debe ser procesado.  Como escribo principalmente para GoLang para Raspberry Pi, decidí escribir una biblioteca en Go.  Rápidamente me di cuenta de que Go no era adecuado para mi rendimiento.  No podía realizar operaciones masivas con memoria en un tiempo razonable. </p><br><p>  Entonces noté Rust, que realizó pruebas similares mucho más rápido. </p><a name="habracut"></a><br><p>  Entonces, la biblioteca está desarrollada en Rust.  Como este es mi primer proyecto en Rust, no pateo mucho, pero los comentarios son bienvenidos. </p><br><p>  Como en cualquier biblioteca 2D, hay tres entidades principales: escenas, nodos y sprites. <br>  Una escena es un contenedor para objetos visuales.  Un nodo es un objeto virtual dotado de ciertas propiedades, como ubicación, tamaño, etc.  Los nodos pueden estar anidados. <br>  Cada nodo contiene un objeto visual, el llamado sprite.  Los sprites vienen en varias formas.  Ahora se admiten sprites como RectSprite, TextureSprite, TextSprite. </p><br><p>  <strong>RectSprite</strong> : un rectángulo de cierto color.  RectSprite incoloro se usa generalmente para agrupar otros nodos secundarios.  RectSprite coincide con la etiqueta XML &lt; <strong>box</strong> &gt; </p><br><p>  <strong>TextureSprite</strong> : un objeto para representar una imagen.  Actualmente solo se admite PNG (RGBA).  TextureSprite coincide con la etiqueta XML &lt; <strong>imagen</strong> &gt; </p><br><p>  <strong>TechSprite</strong> : un objeto para representar una línea de texto en la fuente y el tamaño seleccionados.  Hay soporte automático para RTL.  TechSprite corresponde a la etiqueta XML &lt; <strong>texto</strong> &gt; </p><br><p>  Además de los atributos de ubicación y tamaño, cada nodo tiene atributos de gravedad y anclaje.  Esto ayuda a colocar con precisión el objeto dentro de otro objeto.  Todos los atributos relacionados con el tamaño y la ubicación se configuran como un porcentaje del nodo principal.  Este enfoque le permite lograr la mejor escala en pantallas de diferentes tamaños y proporciones. </p><br><p>  Es posible crear una escena, ya sea mediante programación o creando un archivo xml que describa la escena. </p><br><ol><li><p>  Una forma de software para crear y ejecutar una escena. </p><br><pre><code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> fb = fb2d::screen_writer_for_framebuffer(<span class="hljs-string"><span class="hljs-string">"/dev/fb0"</span></span>)?; fb2d::set_graphics_mode(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> scene = fb2d::scene::Scene::new(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> background_sprite = RectSprite::new(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> background_node = Node::new_rect_node(FLOAT_RECT_FULL, background_sprite); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sprite1 = RectSprite::new(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> node1 = Node::new_rect_node( FloatRect { pos: FLOAT_POS_ZERO, size: FLOAT_SIZE_HALF, }, sprite1, ); node1.anchor_point = ANCHOR_POINT_TOP_LEFT; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sprite2 = TextureSprite::new_for_texture(<span class="hljs-string"><span class="hljs-string">"image.png"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> node2 = Node::new_texture_node( FloatRect { pos: FLOAT_POS_ZERO, size: FloatSize { width: <span class="hljs-number"><span class="hljs-number">0.7</span></span>, height: <span class="hljs-number"><span class="hljs-number">0.7</span></span>, }, }, sprite2, ); node2.anchor_point = ANCHOR_POINT_CENTER; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> sprite3 = TextSprite::new(); sprite3.text = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from(<span class="hljs-string"><span class="hljs-string">"Hello, World !!!"</span></span>); sprite3.gravity = GRAVITY_CENTER; sprite3.height = <span class="hljs-number"><span class="hljs-number">0.2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> node3 = Node::new_text_node( FloatRect { pos: FLOAT_POS_ZERO, size: FLOAT_SIZE_FULL, }, sprite3, ); scene.add_node(node2, node1.key); scene.add_node(node1, background_node.key); scene.add_node(node3, background_node.key); scene.set_root_node(background_node); scene.writer = <span class="hljs-literal"><span class="hljs-literal">Some</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Box</span></span>::new(fb)); scene.run();</code> </pre> <br></li><li>  Crear una escena usando un archivo XML. </li></ol><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scene</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#ffa500"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">box</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pos</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"95% 95%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">anchor-point</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.5 0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#F0C0C0C0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pos</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0 -40%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100% 10%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">anchor-point</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.5 0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"שלום Hello "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">font</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Times New Roman.ttf"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">box</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">box</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pos</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25% 25%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">anchor-point</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0 1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"olive"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alpha</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.5"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pos</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100% 100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">anchor-point</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0 1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">image</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image1.png"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">box</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scene</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><p>  Una escena se crea apuntando a un directorio o archivo zip que contiene scene.xml.  Los archivos de imágenes y fuentes dependientes deben ubicarse en este directorio o archivo zip. </p><br><pre> <code class="rust hljs"> <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> fb2d::scene::Scene::new_from_bundle(<span class="hljs-string"><span class="hljs-string">"assets/scene1"</span></span>) { <span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> scene) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> fb = fb2d::screen_writer_for_framebuffer(<span class="hljs-string"><span class="hljs-string">"/dev/fb0"</span></span>)?; fb2d::set_graphics_mode(); scene.writer = <span class="hljs-literal"><span class="hljs-literal">Some</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Box</span></span>::new(fb)); scene.run(); } <span class="hljs-literal"><span class="hljs-literal">Err</span></span>(e) =&gt; eprintln!(<span class="hljs-string"><span class="hljs-string">"Error: {:?}"</span></span>, e), }</code> </pre> <br><p>  Un ejemplo de la imagen resultante. <br>  Es posible renderizar un marco en un archivo PNG para la depuración. </p><br><p><img src="https://habrastorage.org/webt/k4/hl/pd/k4hlpd_wjx5ynhqyirrc-0cksho.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Repositorio de GitHub.</strong></a> </p><br><p>  Cualquier ayuda (Contribución) es apreciada.  Hay mucho trabajo para optimizar el renderizado y agregar nuevas características como la animación. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421707/">https://habr.com/ru/post/es421707/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421695/index.html">[No] redes convencionales: cómo detectar agua en una bolsa usando Wi-Fi</a></li>
<li><a href="../es421699/index.html">Cómo deshacerse de los errores con las tablas de objetos activos al restaurar Jira desde la copia de seguridad</a></li>
<li><a href="../es421701/index.html">Python Learning Sandbox y Cheat Sheet</a></li>
<li><a href="../es421703/index.html">Linux en casa o ...</a></li>
<li><a href="../es421705/index.html">Automatización contra el caos</a></li>
<li><a href="../es421709/index.html">Unidades CSS nuevas (y antiguas) de las que apenas oyó hablar</a></li>
<li><a href="../es421711/index.html">Análisis de solicitudes de servicio utilizando machine learning</a></li>
<li><a href="../es421713/index.html">Cómo encontrar bots en YouTube: patrones de interacción de comentaristas externos</a></li>
<li><a href="../es421717/index.html">¿Dónde estudian los analistas?</a></li>
<li><a href="../es421719/index.html">Impresora 3D a color Da Vinci. Reportaje fotográfico de la empresa XYZprinting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>