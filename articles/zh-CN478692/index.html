<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¿â€ğŸ« ğŸ˜ª ğŸ™†ğŸ» Androidå¦‚ä½•æ”¯æŒJava 8 ğŸ¦… ğŸ‘¨â€âœˆï¸ ğŸ¥‘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼ æˆ‘æè¯·æ‚¨æ³¨æ„ï¼Œ è‡­åæ˜­è‘—çš„æ°å…‹Â·æ²ƒé¡¿ï¼ˆJake Wortonï¼‰æ’°å†™çš„ä¸€ç³»åˆ—ç²¾å½©æ–‡ç« çš„ç¿»è¯‘ï¼Œå†…å®¹æ¶‰åŠJavaå¦‚ä½•æ”¯æŒAndroid 8ã€‚ 



 åŸå§‹æ–‡ç« åœ¨è¿™é‡Œ 

 æˆ‘åœ¨å®¶å·¥ä½œäº†å‡ å¹´ï¼Œç»å¸¸å¬åˆ°åŒäº‹æŠ±æ€¨Androidæ”¯æŒä¸åŒç‰ˆæœ¬çš„Javaã€‚ 

 è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„è¯é¢˜ã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦ç¡®å®š...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Androidå¦‚ä½•æ”¯æŒJava 8</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/478692/"> å“ˆHaï¼ æˆ‘æè¯·æ‚¨æ³¨æ„ï¼Œ <a href="https://twitter.com/JakeWharton%3Flang%3Den">è‡­åæ˜­è‘—çš„æ°å…‹Â·æ²ƒé¡¿ï¼ˆJake Wortonï¼‰</a>æ’°å†™çš„ä¸€ç³»åˆ—ç²¾å½©æ–‡ç« çš„ç¿»è¯‘ï¼Œå†…å®¹æ¶‰åŠJavaå¦‚ä½•æ”¯æŒAndroid 8ã€‚ <br><br><img src="https://habrastorage.org/webt/ho/ap/qe/hoapqe-nhkwts3ekeettjbuiao8.png"><br><br>  <font color="#0000ff"><a href="https://jakewharton.com/androids-java-8-support/">åŸå§‹æ–‡ç« åœ¨è¿™é‡Œ</a></font> <br><a name="habracut"></a><br> æˆ‘åœ¨å®¶å·¥ä½œäº†å‡ å¹´ï¼Œç»å¸¸å¬åˆ°åŒäº‹æŠ±æ€¨Androidæ”¯æŒä¸åŒç‰ˆæœ¬çš„Javaã€‚ <br><br> è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„è¯é¢˜ã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦ç¡®å®šâ€œ Androidä¸­çš„Javaæ”¯æŒâ€çš„å«ä¹‰ï¼Œå› ä¸ºåœ¨è¯¥è¯­è¨€çš„ä¸€ä¸ªç‰ˆæœ¬ä¸­ï¼Œå¯èƒ½æœ‰å¾ˆå¤šä¸œè¥¿ï¼šåŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œlambdaï¼‰ï¼Œå­—èŠ‚ç ï¼Œå·¥å…·ï¼ŒAPIï¼ŒJVMç­‰ã€‚ <br><br> å½“ä»–ä»¬è°ˆè®ºAndroidä¸­å¯¹Java 8çš„æ”¯æŒæ—¶ï¼Œé€šå¸¸æ˜¯æŒ‡è¯­è¨€åŠŸèƒ½çš„æ”¯æŒã€‚ å› æ­¤ï¼Œè®©æˆ‘ä»¬ä»å®ƒä»¬å¼€å§‹ã€‚ <br><br><h2>  Lambdas </h2><br>  lambdaæ˜¯Java 8çš„ä¸»è¦åˆ›æ–°ä¹‹ä¸€ã€‚ <br> ä»£ç å˜å¾—æ›´åŠ ç®€æ´æ˜äº†ï¼Œlambdaä½¿æˆ‘ä»¬ä¸å†éœ€è¦ä½¿ç”¨å¸¦æœ‰å•ä¸ªæ–¹æ³•çš„æ¥å£ç¼–å†™åºå¤§çš„åŒ¿åç±»ã€‚ <br><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Java8</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... args)</span></span></span><span class="hljs-function"> </span></span>{ sayHi(s -&gt; System.out.println(s)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayHi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Logger logger)</span></span></span><span class="hljs-function"> </span></span>{ logger.log(<span class="hljs-string"><span class="hljs-string">"Hello!"</span></span>); } }</code> </pre> <br> ä½¿ç”¨javacå’Œlegacy <code>dx tool</code>å¯¹æ­¤è¿›è¡Œç¼–è¯‘åï¼Œä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š <br><br><pre> <code class="plaintext hljs">$ javac *.java $ ls Java8.java Java8.class Java8$Logger.class $ $ANDROID_HOME/build-tools/28.0.2/dx --dex --output . *.class Uncaught translation error: com.android.dx.cf.code.SimException: ERROR in Java8.main:([Ljava/lang/String;)V: invalid opcode ba - invokedynamic requires --min-sdk-version &gt;= 26 (currently 13) 1 error; aborting</code> </pre> <br> å‘ç”Ÿæ­¤é”™è¯¯æ˜¯ç”±äºlambdaä½¿ç”¨Java 7ä¸­æ·»åŠ çš„å­—èŠ‚ç <code>invokedynamic</code>çš„æ–°æŒ‡ä»¤è¿™ä¸€äº‹å®ã€‚ä»é”™è¯¯æ–‡æœ¬ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°Androidä»…ä»26 APIï¼ˆAndroid 8ï¼‰å¼€å§‹æ”¯æŒå®ƒã€‚ <br><br> å¬èµ·æ¥ä¸å¤ªå¥½ï¼Œå› ä¸ºå‡ ä¹æ²¡æœ‰äººä¼šå‘å¸ƒå…·æœ‰26 minApiçš„åº”ç”¨ç¨‹åºã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨äº†æ‰€è°“çš„<i>desugaring</i>æµç¨‹ï¼Œè¯¥æµç¨‹ä½¿lambdaæ”¯æŒåœ¨æ‰€æœ‰ç‰ˆæœ¬çš„APIä¸Šéƒ½å¯ä»¥å®ç°ã€‚ <br><br><h2> ç³–åŒ–å†å² </h2><br> å¥¹åœ¨Androidä¸–ç•Œä¸­éå¸¸ä¸°å¯Œå¤šå½©ã€‚ è„±ç³–çš„ç›®æ ‡å§‹ç»ˆæ˜¯ç›¸åŒçš„-å…è®¸æ–°çš„è¯­è¨€åŠŸèƒ½åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šéƒ½èƒ½ä½¿ç”¨ã€‚ <br><br> æœ€åˆï¼Œä¾‹å¦‚ï¼Œä¸ºäº†åœ¨Androidä¸­æ”¯æŒlambdaï¼Œå¼€å‘äººå‘˜è¿æ¥äº†<a href="https://github.com/evant/gradle-retrolambda">Retrolambda</a>æ’ä»¶ã€‚ ä»–ä½¿ç”¨äº†ä¸JVMç›¸åŒçš„å†…ç½®æœºåˆ¶ï¼Œå°†lambdaè½¬æ¢ä¸ºç±»ï¼Œä½†æ˜¯ä»–æ˜¯åœ¨è¿è¡Œæ—¶è€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶æ‰§è¡Œçš„ã€‚ å°±æ–¹æ³•çš„æ•°é‡è€Œè¨€ï¼Œç”Ÿæˆçš„ç±»éå¸¸æ˜‚è´µï¼Œä½†æ˜¯éšç€æ—¶é—´çš„æµé€ï¼Œç»è¿‡ä¸æ–­çš„æ”¹è¿›å’Œæ”¹è¿›ï¼Œè¯¥æŒ‡æ ‡æˆ–å¤šæˆ–å°‘åœ°å˜å¾—åˆç†ã€‚ <br><br> ç„¶åï¼ŒAndroidå›¢é˜Ÿ<a href="https://android-developers.googleblog.com/2014/12/hello-world-meet-our-new-experimental.html">å®£å¸ƒäº†ä¸€ä¸ª</a>æ”¯æŒæ‰€æœ‰Java 8åŠŸèƒ½ä¸”ç”Ÿäº§ç‡æ›´é«˜<a href="https://android-developers.googleblog.com/2014/12/hello-world-meet-our-new-experimental.html">çš„æ–°ç¼–è¯‘å™¨</a> ã€‚ å®ƒå»ºç«‹åœ¨Eclipse Javaç¼–è¯‘å™¨çš„åŸºç¡€ä¸Šï¼Œä½†æ˜¯æ²¡æœ‰ç”ŸæˆJavaå­—èŠ‚ç ï¼Œè€Œæ˜¯ç”Ÿæˆäº†Dalvikå­—èŠ‚ç ã€‚ ä½†æ˜¯ï¼Œå…¶æ€§èƒ½ä»ç„¶æœ‰å¾ˆå¤šä¸è¶³ä¹‹å¤„ã€‚ <br><br> å¹¸è¿çš„æ˜¯ï¼Œå½“æ–°çš„ç¼–è¯‘å™¨è¢«æ”¾å¼ƒæ—¶ï¼Œè´Ÿè´£å¤„ç†çš„Javaå­—èŠ‚ç ä¸­çš„Javaå­—èŠ‚ç è½¬æ¢å™¨å·²ä»Googleçš„æ„å»ºç³»ç»Ÿ<a href="https://docs.bazel.build/versions/master/bazel-and-android.html">Bazel</a> <a href="https://android-developers.googleblog.com/2017/04/java-8-language-features-support-update.html">é›†æˆåˆ°Android Gradleæ’ä»¶ä¸­</a> ã€‚ è€Œä¸”å®ƒçš„æ€§èƒ½ä»ç„¶å¾ˆä½ï¼Œå› æ­¤å¹¶è¡Œå¯»æ±‚æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚ <br><br> ç°åœ¨æˆ‘ä»¬çœ‹åˆ°<a href="https://android-developers.googleblog.com/2017/08/next-generation-dex-compiler-now-in.html"><code>  dexer</code></a> - <i>D8</i> ï¼Œå®ƒåº”è¯¥å¯ä»¥ä»£æ›¿<code>dx tool</code> ã€‚ ç°åœ¨ï¼Œåœ¨å°†å·²ç¼–è¯‘çš„JARæ–‡ä»¶è½¬æ¢ä¸º<code>.dex</code> ï¼ˆdexingï¼‰çš„è¿‡ç¨‹ä¸­æ‰§è¡Œäº†è„±ç³–æ“ä½œã€‚ ä¸<code>dx</code>ç›¸æ¯”ï¼ŒD8çš„æ€§èƒ½è¦å¥½å¾—å¤šï¼Œå¹¶ä¸”ç”±äºAndroid Gradle Plugin 3.1ï¼Œå®ƒå·²æˆä¸ºé»˜è®¤çš„dexerã€‚ <br><br><h2>  D8 </h2><br> ç°åœ¨ï¼Œä½¿ç”¨D8ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¯‘ä¸Šé¢çš„ä»£ç ã€‚ <br><br><pre> <code class="plaintext hljs">$ java -jar d8.jar \ --lib $ANDROID_HOME/platforms/android-28/android.jar \ --release \ --output . \ *.class $ ls Java8.java Java8.class Java8$Logger.class classes.dex</code> </pre> <br> è¦æŸ¥çœ‹D8å¦‚ä½•è½¬æ¢lambdaï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Android SDKä¸­éšé™„çš„<code>dexdump tool</code> ã€‚ å®ƒä¼šæ˜¾ç¤ºå¾ˆå¤šä¸œè¥¿ï¼Œä½†æ˜¯æˆ‘ä»¬å°†åªå…³æ³¨äºæ­¤ï¼š <br><br><pre> <code class="plaintext hljs">$ $ANDROID_HOME/build-tools/28.0.2/dexdump -d classes.dex [0002d8] Java8.main:([Ljava/lang/String;)V 0000: sget-object v0, LJava8$1;.INSTANCE:LJava8$1; 0002: invoke-static {v0}, LJava8;.sayHi:(LJava8$Logger;)V 0005: return-void [0002a8] Java8.sayHi:(LJava8$Logger;)V 0000: const-string v0, "Hello" 0002: invoke-interface {v1, v0}, LJava8$Logger;.log:(Ljava/lang/String;)V 0005: return-void â€¦</code> </pre> <br> å¦‚æœæ‚¨è¿˜æ²¡æœ‰é˜…è¯»å­—èŠ‚ç ï¼Œè¯·ä¸è¦æ‹…å¿ƒï¼šè¿™é‡Œå†™çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½å¯ä»¥ç›´è§‚åœ°ç†è§£ã€‚ <br><br> åœ¨ç¬¬ä¸€ä¸ªå—ä¸­ï¼Œç´¢å¼•ä¸º<code>0000</code> <code>main</code>æ–¹æ³•ä»<code>INSTANCE</code>å­—æ®µè·å–å¯¹<code>INSTANCE</code>ç±»<code>Java8$1</code>çš„å¼•ç”¨ã€‚ è¯¥ç±»æ˜¯åœ¨<code></code>è¿‡ç¨‹ä¸­ç”Ÿæˆçš„ã€‚  mainæ–¹æ³•å­—èŠ‚ç ä¹Ÿæ²¡æœ‰åŒ…å«æˆ‘ä»¬çš„lambdaçš„ä»»ä½•å†…å®¹ï¼Œå› æ­¤ï¼Œå¾ˆå¯èƒ½ä¸<code>Java8$1</code>ç±»ç›¸å…³è”ã€‚ ç´¢å¼•<code>0002</code>ç„¶åä½¿ç”¨åˆ°<code>INSTANCE</code>çš„é“¾æ¥è°ƒç”¨<code>sayHi</code>é™æ€æ–¹æ³•ã€‚  <code>sayHi</code>éœ€è¦<code>Java8$Logger</code> ï¼Œå› æ­¤ä¼¼ä¹<code>Java8$1</code>å®ç°äº†æ­¤æ¥å£ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡ŒéªŒè¯ï¼š <br><br><pre> <code class="plaintext hljs">Class #2 - Class descriptor : 'LJava8$1;' Access flags : 0x1011 (PUBLIC FINAL SYNTHETIC) Superclass : 'Ljava/lang/Object;' Interfaces - #0 : 'LJava8$Logger;'</code> </pre> <br>  <code>SYNTHETIC</code>æ ‡å¿—æ„å‘³ç€å·²ç»ç”Ÿæˆ<code>Java8$1</code>ç±»ï¼Œå¹¶ä¸”å®ƒåŒ…å«çš„æ¥å£åˆ—è¡¨åŒ…å«<code>Java8$Logger</code> ã€‚ <br> æ­¤ç±»è¡¨ç¤ºæˆ‘ä»¬çš„lambdaã€‚ å¦‚æœæŸ¥çœ‹<code>log</code>æ–¹æ³•çš„å®ç°ï¼Œæ‚¨å°†çœ‹ä¸åˆ°lambdaçš„ä¸»ä½“ã€‚ <br><br><pre> <code class="plaintext hljs">â€¦ [00026c] Java8$1.log:(Ljava/lang/String;)V 0000: invoke-static {v1}, LJava8;.lambda$main$0:(Ljava/lang/String;)V 0003: return-void â€¦</code> </pre> <br> ç›¸åï¼Œ <code>Java8</code>ç±»çš„<code>static</code>æ–¹æ³•<code>Java8</code> <code>lambda$main$0</code> ã€‚ æˆ‘é‡å¤ä¸€éï¼Œæ­¤æ–¹æ³•ä»…ä»¥å­—èŠ‚ç è¡¨ç¤ºã€‚ <br><br><pre> <code class="plaintext hljs">â€¦ #1 : (in LJava8;) name : 'lambda$main$0' type : '(Ljava/lang/String;)V' access : 0x1008 (STATIC SYNTHETIC) [0002a0] Java8.lambda$main$0:(Ljava/lang/String;)V 0000: sget-object v0, Ljava/lang/System;.out:Ljava/io/PrintStream; 0002: invoke-virtual {v0, v1}, Ljava/io/PrintStream;.println:(Ljava/lang/String;)V 0005: return-void</code> </pre> <br>  <code>SYNTHETIC</code>æ ‡å¿—å†æ¬¡å‘Šè¯‰æˆ‘ä»¬è¯¥æ–¹æ³•å·²ç”Ÿæˆï¼Œå…¶å­—èŠ‚ç ä»…åŒ…å«lambdaä¸»ä½“ï¼šå¯¹<code>System.out.println</code>çš„è°ƒç”¨ã€‚  lambdaä¸»ä½“ä½äº<i>Java8.class</i>å†…çš„<i>åŸå› </i>å¾ˆç®€å•-å®ƒå¯èƒ½éœ€è¦è®¿é—®è¯¥ç±»çš„<code>private</code>æˆå‘˜ï¼Œç”Ÿæˆçš„ç±»å°†æ— æ³•è®¿é—®è¯¥<code>private</code>æˆå‘˜ã€‚ <br><br> ä¸Šé¢ä»‹ç»äº†äº†<i>è§£è„±ç³–</i>å·¥ä½œåŸç†æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ã€‚ ä½†æ˜¯ï¼Œåœ¨Dalvikå­—èŠ‚ç ä¸­æŸ¥çœ‹å®ƒï¼Œæ‚¨ä¼šå‘ç°ä¸€åˆ‡éƒ½å˜å¾—æ›´åŠ å¤æ‚å’Œä»¤äººææƒ§ã€‚ <br><br><h2> æºè½¬æ¢ </h2><br> ä¸ºäº†æ›´å¥½åœ°äº†è§£å¦‚ä½•è¿›è¡Œ<i>ç³–åŒ–</i> ï¼Œè®©æˆ‘ä»¬é€æ­¥å°è¯•å°†ç±»è½¬æ¢ä¸ºå¯åœ¨æ‰€æœ‰ç‰ˆæœ¬çš„APIä¸Šä½¿ç”¨çš„ç±»ã€‚ <br><br> è®©æˆ‘ä»¬ä»¥lambdaä¸ºåŸºç¡€æ¥è®¨è®ºåŒä¸€ç±»ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Java8</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... args)</span></span></span><span class="hljs-function"> </span></span>{ sayHi(s -&gt; System.out.println(s)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayHi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Logger logger)</span></span></span><span class="hljs-function"> </span></span>{ logger.log(<span class="hljs-string"><span class="hljs-string">"Hello!"</span></span>); } }</code> </pre> <br> é¦–å…ˆï¼Œå°†lambdaä¸»ä½“ç§»è‡³<code>package private</code>æ–¹æ³•ã€‚ <br><br><pre> <code class="diff hljs"> public static void main(String... args) { - sayHi(s -&gt; System.out.println(s)); + sayHi(s -&gt; lambda$main$0(s)); } + + static void lambda$main$0(String s) { + System.out.println(s); + }</code> </pre> <br> ç„¶åï¼Œå®ç°ä¸€ä¸ªå®ç°<code>Logger</code>æ¥å£çš„ç±»ï¼Œåœ¨å…¶ä¸­æ‰§è¡Œæ¥è‡ªlambdaä¸»ä½“çš„ä»£ç å—ã€‚ <br><br><pre> <code class="diff hljs"> public static void main(String... args) { - sayHi(s -&gt; lambda$main$0(s)); + sayHi(new Java8$1()); } @@ } + +class Java8$1 implements Java8.Logger { + @Override public void log(String s) { + Java8.lambda$main$0(s); + } +}</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œ <code>Java8$1</code>çš„å•ä¾‹å®ä¾‹ï¼Œè¯¥å®ä¾‹å­˜å‚¨åœ¨<code>static</code>å˜é‡<code>INSTANCE</code> ã€‚ <br><br><pre> <code class="diff hljs"> public static void main(String... args) { - sayHi(new Java8$1()); + sayHi(Java8$1.INSTANCE); } @@ class Java8$1 implements Java8.Logger { + static final Java8$1 INSTANCE = new Java8$1(); + @Override public void log(String s) {</code> </pre> <br> è¿™æ˜¯å¯ä»¥åœ¨æ‰€æœ‰ç‰ˆæœ¬çš„APIä¸Šä½¿ç”¨çš„æœ€ç»ˆ<i>é…éŸ³</i>ç±»ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Java8</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... args)</span></span></span><span class="hljs-function"> </span></span>{ sayHi(Java8$<span class="hljs-number"><span class="hljs-number">1</span></span>.INSTANCE); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> lambda$main$<span class="hljs-number"><span class="hljs-number">0</span></span>(String s) { System.out.println(s); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayHi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Logger logger)</span></span></span><span class="hljs-function"> </span></span>{ logger.log(<span class="hljs-string"><span class="hljs-string">"Hello!"</span></span>); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Java8</span></span></span><span class="hljs-class">$1 </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Java8</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Java8$<span class="hljs-number"><span class="hljs-number">1</span></span> INSTANCE = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Java8$<span class="hljs-number"><span class="hljs-number">1</span></span>(); <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span><span class="hljs-function"> </span></span>{ Java8.lambda$main$<span class="hljs-number"><span class="hljs-number">0</span></span>(s); } }</code> </pre> <br> å¦‚æœæ‚¨åœ¨Dalvikå­—èŠ‚ç ä¸­æŸ¥çœ‹ç”Ÿæˆçš„ç±»ï¼Œå°†ä¸ä¼šæ‰¾åˆ°ç±»ä¼¼Java8 $ 1çš„åç§°-ä¼šæœ‰ç±»ä¼¼<code>-$$Lambda$Java8$QkyWJ8jlAksLjYziID4cZLvHwoY</code> ã€‚ ä¸ºè¯¥ç±»ç”Ÿæˆæ­¤ç±»å‘½åçš„åŸå› åŠå…¶ä¼˜ç‚¹æ˜¯å¸å¼•åˆ°å•ç‹¬çš„æ–‡ç« ä¸­ã€‚ <br><br><h2> æœ¬æœºLambdaæ”¯æŒ </h2><br> å½“æˆ‘ä»¬ä½¿ç”¨<code>dx tool</code>ç¼–è¯‘åŒ…å«lambdaçš„ç±»æ—¶ï¼Œå‡ºç°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼ŒæŒ‡å‡ºä»…é€‚ç”¨äº26ä¸ªAPIã€‚ <br><br><pre> <code class="plaintext hljs">$ $ANDROID_HOME/build-tools/28.0.2/dx --dex --output . *.class Uncaught translation error: com.android.dx.cf.code.SimException: ERROR in Java8.main:([Ljava/lang/String;)V: invalid opcode ba - invokedynamic requires --min-sdk-version &gt;= 26 (currently 13) 1 error; aborting</code> </pre> <br> å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•ä½¿ç”¨<code>â€”min-api 26</code>æ ‡å¿—è¿›è¡Œç¼–è¯‘ï¼Œè¿™ä¼¼ä¹æ˜¯åˆä¹é€»è¾‘çš„ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿè„±ç³–ä½œç”¨ã€‚ <br><br><pre> <code class="bash hljs">$ java -jar d8.jar \ --lib <span class="hljs-variable"><span class="hljs-variable">$ANDROID_HOME</span></span>/platforms/android-28/android.jar \ --release \ --min-api 26 \ --output . \ *.class</code> </pre> <br> ä½†æ˜¯ï¼Œå¦‚æœè½¬å‚¨<code>.dex</code>æ–‡ä»¶ï¼Œåˆ™ä»å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°å®ƒ<code>-$$Lambda$Java8$QkyWJ8jlAksLjYziID4cZLvHwoY</code> ã€‚ ä¸ºä»€ä¹ˆè¿™æ · è¿™æ˜¯D8é”™è¯¯å—ï¼Ÿ <br><br> ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œä»¥åŠä¸ºä»€ä¹ˆ<i>æ€»æ˜¯å‘ç”Ÿ</i>è„±ç³–<i>ä½œç”¨</i> ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹<code>Java8</code>ç±»çš„Javaå­—èŠ‚ç ã€‚ <br><br><pre> <code class="bash hljs">$ javap -v Java8.class class Java8 { public static void main(java.lang.String...); Code: 0: invokedynamic <span class="hljs-comment"><span class="hljs-comment">#2, 0 // InvokeDynamic #0:log:()LJava8$Logger; 5: invokestatic #3 // Method sayHi:(LJava8$Logger;)V 8: return } â€¦</span></span></code> </pre> <br> åœ¨<code>main</code>æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬å†æ¬¡åœ¨ç´¢å¼•<code>0</code>å¤„çœ‹åˆ°<i>invokedynamic</i> ã€‚ è°ƒç”¨ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°ä¸º<code>0</code>ä¸ä¹‹å…³è”çš„<a href="https://stackoverflow.com/questions/30733557/what-is-a-bootstrap-method">å¼•å¯¼</a>æ–¹æ³•çš„ç´¢å¼•ã€‚ <br><br> è¿™æ˜¯<i>å¼•å¯¼</i>æ–¹æ³•çš„åˆ—è¡¨ï¼š <br><br><pre> <code class="plaintext hljs">â€¦ BootstrapMethods: 0: #27 invokestatic java/lang/invoke/LambdaMetafactory.metafactory:( Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String; Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType; Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;) Ljava/lang/invoke/CallSite; Method arguments: #28 (Ljava/lang/String;)V #29 invokestatic Java8.lambda$main$0:(Ljava/lang/String;)V #28 (Ljava/lang/String;)V</code> </pre> <br> è¿™é‡Œçš„<i>bootstrap</i>æ–¹æ³•åœ¨<code>java.lang.invoke.LambdaMetafactory</code>ç±»ä¸­ç§°ä¸º<code>metafactory</code> ã€‚ ä»–<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/invoke/LambdaMetafactory.html">ä½åœ¨JDKä¸­ï¼Œ</a>å¹¶åœ¨è¿è¡Œæ—¶ä¸ºlambdaåˆ›å»ºåŒ¿åçš„å³æ—¶ç±»ï¼Œå°±åƒD8åœ¨è®¡ç®—æ—¶ç”Ÿæˆå®ƒä»¬ä¸€æ ·ã€‚ <br><br> å¦‚æœæ‚¨æŸ¥çœ‹<a href="https://developer.android.com/reference/java/lang/invoke/package-summary"><code> Android  java.lang.invoke</code></a>çš„<a href="https://developer.android.com/reference/java/lang/invoke/package-summary"><code> Android  java.lang.invoke</code></a> <br> æˆ–<a href="https://android.googlesource.com/platform/libcore/%2B/master/ojluni/src/main/java/java/lang/invoke/"><code> AOSP  java.lang.invoke</code></a>çš„<a href="https://android.googlesource.com/platform/libcore/%2B/master/ojluni/src/main/java/java/lang/invoke/"><code> AOSP  java.lang.invoke</code></a> ï¼Œæˆ‘ä»¬çœ‹åˆ°æ­¤ç±»ä¸åœ¨è¿è¡Œæ—¶ä¸­ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ— è®ºæ‚¨æ‹¥æœ‰ä»€ä¹ˆminApiï¼Œéƒ½æ€»æ˜¯åœ¨ç¼–è¯‘æ—¶è¿›è¡Œå»æ‚è€ã€‚  VMæ”¯æŒç±»ä¼¼äº<code>invokedynamic</code>å­—èŠ‚ç æŒ‡ä»¤ï¼Œä½†æ˜¯JDKå†…ç½®çš„<code>invokedynamic</code>æ— æ³•ä½¿ç”¨ã€‚ <br><br><h2> æ–¹æ³•å‚è€ƒ </h2><br>  Java 8ä¸lambdaä¸€èµ·æ·»åŠ äº†æ–¹æ³•å¼•ç”¨-è¿™æ˜¯åˆ›å»ºå…¶lambdaä¸»ä½“å¼•ç”¨ç°æœ‰æ–¹æ³•çš„æœ‰æ•ˆæ–¹æ³•ã€‚ <br><br> æˆ‘ä»¬çš„<code>Logger</code>ç•Œé¢å°±æ˜¯è¿™æ ·ä¸€ä¸ªä¾‹å­ã€‚  lambdaä¸»ä½“å¼•ç”¨åˆ°<code>System.out.println</code> ã€‚ è®©æˆ‘ä»¬å°†lambdaè½¬æ¢ä¸ºå¼•ç”¨æ–¹æ³•ï¼š <br><br><pre> <code class="diff hljs"> public static void main(String... args) { - sayHi(s -&gt; System.out.println(s)); + sayHi(System.out::println); }</code> </pre> <br> å½“æˆ‘ä»¬ç¼–è¯‘å®ƒå¹¶æŸ¥çœ‹å­—èŠ‚ç æ—¶ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä¸å…ˆå‰ç‰ˆæœ¬çš„ä¸åŒä¹‹å¤„ï¼š <br><br><pre> <code class="plaintext hljs">[000268] -$$Lambda$1Osqr2Z9OSwjseX_0FMQJcCG_uM.log:(Ljava/lang/String;)V 0000: iget-object v0, v1, L-$$Lambda$1Osqr2Z9OSwjseX_0FMQJcCG_uM;.f$0:Ljava/io/PrintStream; 0002: invoke-virtual {v0, v2}, Ljava/io/PrintStream;.println:(Ljava/lang/String;)V 0005: return-void</code> </pre> <br> è€Œä¸æ˜¯è°ƒç”¨ç”Ÿæˆçš„<code>Java8.lambda$main$0</code> ï¼ˆå…¶ä¸­åŒ…å«å¯¹<code>System.out.println</code>çš„è°ƒç”¨ï¼‰ï¼Œç°åœ¨ç›´æ¥è°ƒç”¨<code>System.out.println</code> ã€‚ <br><br> å…·æœ‰lambdaçš„ç±»ä¸å†æ˜¯<code>static</code>å•ä¾‹ï¼Œè€Œæ˜¯é€šè¿‡å­—èŠ‚ç ä¸­çš„ç´¢å¼•<code>0000</code> ï¼Œæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬è·å¾—äº†æŒ‡å‘<code>PrintStream</code> - <code>System.out</code>çš„é“¾æ¥ï¼Œè¯¥é“¾æ¥éšåç”¨äºå¯¹å…¶è°ƒç”¨<code>println</code> ã€‚ <br><br> ç»“æœï¼Œæˆ‘ä»¬çš„ç­çº§å˜æˆäº†è¿™æ ·ï¼š <br><br><pre> <code class="diff hljs"> public static void main(String... args) { - sayHi(System.out::println); + sayHi(new -$$Lambda$1Osqr2Z9OSwjseX_0FMQJcCG_uM(System.out)); } @@ } + +class -$$Lambda$1Osqr2Z9OSwjseX_0FMQJcCG_uM implements Java8.Logger { + private final PrintStream ps; + + -$$Lambda$1Osqr2Z9OSwjseX_0FMQJcCG_uM(PrintStream ps) { + this.ps = ps; + } + + @Override public void log(String s) { + ps.println(s); + } +}</code> </pre> <br><h2> æ¥å£ä¸­çš„<code>Default</code>æ–¹æ³•å’Œ<code>static</code>æ–¹æ³• </h2><br>  Java 8å¸¦æ¥çš„å¦ä¸€ä¸ªé‡è¦è€Œé‡è¦çš„å˜åŒ–æ˜¯èƒ½å¤Ÿåœ¨æ¥å£ä¸­å£°æ˜<code>default</code>æ–¹æ³•å’Œ<code>static</code>æ–¹æ³•ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String tag, String s)</span></span></span><span class="hljs-function"> </span></span>{ log(tag + <span class="hljs-string"><span class="hljs-string">": "</span></span> + s); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Logger </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">systemOut</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> System.out::println; } }</code> </pre> <br>  D8ä¹Ÿæ”¯æŒæ‰€æœ‰è¿™äº›ã€‚ ä½¿ç”¨ä¸ä»¥å‰ç›¸åŒçš„å·¥å…·ï¼Œå¾ˆå®¹æ˜“çœ‹åˆ°å…·æœ‰<code>default</code>æ–¹æ³•å’Œ<code>static</code>æ–¹æ³•çš„Loggerçš„ç™»å½•ç‰ˆæœ¬ã€‚  lambdaå’Œ<code>method references</code>çš„åŒºåˆ«ä¹‹ä¸€æ˜¯ï¼Œé»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•æ˜¯åœ¨Android VMä¸­å®ç°çš„ï¼Œå¹¶ä¸”ä»24ä¸ªAPIå¼€å§‹ï¼ŒD8ä¸ä¼š<i>å°†</i>å®ƒä»¬<i>è§£è€¦</i> ã€‚ <br><br><h2> ä¹Ÿè®¸åªç”¨Kotlinï¼Ÿ </h2><br> é˜…è¯»æœ¬æ–‡æ—¶ï¼Œå¤§å¤šæ•°äººå¯èƒ½ä¼šæƒ³åˆ°Kotlinã€‚ æ˜¯çš„ï¼Œå®ƒæ”¯æŒæ‰€æœ‰Java 8åŠŸèƒ½ï¼Œä½†æ˜¯é™¤äº†ä¸€äº›ç»†èŠ‚å¤–ï¼Œå®ƒä»¬ç”±<code>kotlinc</code>ä»¥ä¸D8ç›¸åŒçš„æ–¹å¼å®ç°ã€‚ <br><br> å› æ­¤ï¼Œå³ä½¿æ‚¨çš„é¡¹ç›®æ˜¯100ï¼…ç”¨Kotlinç¼–å†™çš„ï¼ŒAndroidå¯¹Javaæ–°ç‰ˆæœ¬çš„æ”¯æŒä»ç„¶éå¸¸é‡è¦ã€‚ <br><br> å°†æ¥Kotlinå¯èƒ½ä¼šåœæ­¢æ”¯æŒJava 6å’ŒJava 7å­—èŠ‚ç ï¼Œ <a href="https://blog.jetbrains.com/idea/2015/12/intellij-idea-16-eap-144-2608-is-out/">IntelliJ IDEA</a>å°†ä»Gradle 5.0åˆ‡æ¢åˆ°Java8ã€‚è¿è¡Œåœ¨è¾ƒæ—©JVMä¸Šçš„å¹³å°æ•°é‡æ­£åœ¨å‡å°‘ã€‚ <br><br><h2> è„±ç³–API </h2><br> ä¸€ç›´ä»¥æ¥ï¼Œæˆ‘éƒ½åœ¨è°ˆè®ºJava 8åŠŸèƒ½ï¼Œä½†æ²¡æœ‰å¯¹æ–°çš„APIè¿›è¡Œä»»ä½•è¯´æ˜-æµï¼Œ <code>CompletableFuture</code> ï¼Œæ—¥æœŸ/æ—¶é—´ç­‰ã€‚ <br><br> å›åˆ°Loggerç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–°çš„æ—¥æœŸ/æ—¶é—´APIæ¥æŸ¥æ‰¾å‘é€æ¶ˆæ¯çš„æ—¶é—´ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.time.*; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Java8</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LocalDateTime time, String s)</span></span></span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... args)</span></span></span><span class="hljs-function"> </span></span>{ sayHi((time, s) -&gt; System.out.println(time + <span class="hljs-string"><span class="hljs-string">" "</span></span> + s)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayHi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Logger logger)</span></span></span><span class="hljs-function"> </span></span>{ logger.log(LocalDateTime.now(), <span class="hljs-string"><span class="hljs-string">"Hello!"</span></span>); } }</code> </pre> <br> å†æ¬¡ä½¿ç”¨<code>javac</code>å¯¹å…¶è¿›è¡Œ<code>javac</code>å¹¶ä½¿ç”¨D8å°†å…¶è½¬æ¢ä¸ºDalvikå­—èŠ‚ç ï¼Œä»è€Œ<i>å°†</i>å…¶<i>è§£è€¦</i>ä»¥æ”¯æŒæ‰€æœ‰ç‰ˆæœ¬çš„APIã€‚ <br><br><pre> <code class="plaintext hljs">$ javac *.java $ java -jar d8.jar \ --lib $ANDROID_HOME/platforms/android-28/android.jar \ --release \ --output . \ *.class</code> </pre> <br> æ‚¨ç”šè‡³å¯ä»¥åœ¨è®¾å¤‡ä¸Šè¿è¡Œæ­¤ç¨‹åºä»¥ç¡®ä¿å…¶æ­£å¸¸è¿è¡Œã€‚ <br><br><pre> <code class="plaintext hljs">$ adb push classes.dex /sdcard classes.dex: 1 file pushed. 0.5 MB/s (1620 bytes in 0.003s) $ adb shell dalvikvm -cp /sdcard/classes.dex Java8 2018-11-19T21:38:23.761 Hello</code> </pre> <br> å¦‚æœæ­¤è®¾å¤‡ä¸Šä½¿ç”¨APIâ€‹â€‹ 26åŠæ›´é«˜ç‰ˆæœ¬ï¼Œåˆ™ä¼šæ˜¾ç¤ºHelloæ¶ˆæ¯ã€‚ å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š <br><br><pre> <code class="plaintext hljs">java.lang.NoClassDefFoundError: Failed resolution of: Ljava/time/LocalDateTime; at Java8.sayHi(Java8.java:13) at Java8.main(Java8.java:9)</code> </pre> <br>  D8å¤„ç†äº†lambdasï¼ˆä¸€ç§å‚è€ƒæ–¹æ³•ï¼‰ï¼Œä½†ä¸<code>LocalDateTime</code>æ— å…³ï¼Œè¿™å¾ˆå¯æ‚²ã€‚ <br><br> å¼€å‘äººå‘˜å¿…é¡»åœ¨æ—¥æœŸ/æ—¶é—´apiä¸Šä½¿ç”¨è‡ªå·±çš„å®ç°æˆ–åŒ…è£…å™¨ï¼Œæˆ–è€…ä½¿ç”¨<code>ThreeTenBP</code>ç±»çš„<code>ThreeTenBP</code>æ¥å¤„ç†æ—¶é—´ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆä¸èƒ½ç”¨è‡ªå·±çš„åŒæ‰‹åšD8ï¼Ÿ <br><br><h2> ç»“è¯­ </h2><br> ç¼ºå°‘å¯¹æ‰€æœ‰æ–°Java 8 APIçš„æ”¯æŒä»ç„¶æ˜¯Androidç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªå¤§é—®é¢˜ã€‚ æ¯•ç«Ÿï¼Œæˆ‘ä»¬æ¯ä¸ªäººä¸å¤ªå¯èƒ½å…è®¸æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æŒ‡å®š26åˆ†é’Ÿçš„APIã€‚ åŒæ—¶æ”¯æŒAndroidå’ŒJVMçš„åº“æ— æ³•ä½¿ç”¨5å¹´å‰å¼•å…¥çš„APIï¼ <br><br> å³ä½¿ç°åœ¨Java 8æ”¯æŒå·²æˆä¸ºD8çš„ä¸€éƒ¨åˆ†ï¼Œæ¯ä¸ªå¼€å‘äººå‘˜ä»åº”åœ¨Java 8ä¸­æ˜ç¡®æŒ‡å®šæºå’Œç›®æ ‡å…¼å®¹æ€§ã€‚å¦‚æœç¼–å†™è‡ªå·±çš„åº“ï¼Œåˆ™å¯ä»¥é€šè¿‡å¸ƒå±€ä½¿ç”¨Java 8å­—èŠ‚ç çš„åº“æ¥åŠ å¼ºè¿™ç§è¶‹åŠ¿ã€‚ ï¼ˆå³ä½¿æ‚¨æ²¡æœ‰ä½¿ç”¨æ–°çš„è¯­è¨€åŠŸèƒ½ï¼‰ã€‚ <br><br> åœ¨D8ä¸Šæ­£åœ¨è¿›è¡Œè®¸å¤šå·¥ä½œï¼Œå› æ­¤åœ¨æ”¯æŒè¯­è¨€åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œä¼¼ä¹ä»¥åä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ã€‚ å³ä½¿æ‚¨ä»…åœ¨Kotlinä¸Šç¼–å†™ä»£ç ï¼Œå¼ºåˆ¶Androidå¼€å‘å›¢é˜Ÿæ”¯æŒæ‰€æœ‰æ–°ç‰ˆæœ¬çš„Javaï¼Œæ”¹è¿›å­—èŠ‚ç å’Œæ–°çš„APIä¹Ÿéå¸¸é‡è¦ã€‚ <br><br> è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘çš„æ¼”è®²â€œ <a href="https://jakewharton.com/digging-into-d8-and-r8/">æ·±å…¥ç ”ç©¶D8å’ŒR8â€</a>çš„ä¹¦é¢ç‰ˆæœ¬ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN478692/">https://habr.com/ru/post/zh-CN478692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN478666/index.html">YM3812ä¸Šçš„USBå£°å¡</a></li>
<li><a href="../zh-CN478672/index.html">äººå·¥æ™ºèƒ½æµ‹è¯•å’Œå¯åŠ¨ï¼šAdam Carmiè®¿è°ˆï¼ˆApplitoolsï¼‰</a></li>
<li><a href="../zh-CN478684/index.html">SSDç®€ä»‹ã€‚ ç¬¬2éƒ¨åˆ†ã€‚ç•Œé¢</a></li>
<li><a href="../zh-CN478688/index.html">2019å¹´å­¦ä¹ æ•°æ®ç§‘å­¦çš„æ„Ÿè§‰</a></li>
<li><a href="../zh-CN478690/index.html">ä½¿ç”¨ç‰ˆæœ¬åŒ–æ–‡æ¡£çš„ç¤ºä¾‹ç«™ç‚¹ä½¿ç”¨werfåŠ¨æ€ç»„è£…å’Œéƒ¨ç½²Dockeræ˜ åƒ</a></li>
<li><a href="../zh-CN478694/index.html">æ­£å¦‚æˆ‘ä»¬åœ¨iviåœ¨çº¿ç”µå½±é™¢ä¸­æ¨èçš„æœ€æ–°ç›®å½•ï¼ˆ+ Pythonä»£ç ï¼‰</a></li>
<li><a href="../zh-CN478696/index.html">æˆ‘å¦‚ä½•å‚è§‚Urban Tech2019ã€‚æ´»åŠ¨æŠ¥å‘Š</a></li>
<li><a href="../zh-CN478698/index.html">æˆ‘ä»¬åœ¨15åˆ†é’Ÿå†…åˆ¶å®šäº†äº’åŠ¨åœ°å½¢å›¾</a></li>
<li><a href="../zh-CN478702/index.html">Kapacitorä¸­çš„åº¦é‡å¤„ç†æŠ€å·§</a></li>
<li><a href="../zh-CN478704/index.html">å¦‚æœé‚®ä»¶å·²ç»åˆ°è¾¾åƒåœ¾é‚®ä»¶è¯¥æ€ä¹ˆåŠï¼š5ä¸ªå®é™…æ­¥éª¤</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>