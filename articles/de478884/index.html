<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§æüèª üê™ üìÜ Wie man RTSP auf der Baustelle im Jahr 2020 vorbereitet oder warum Eber keine Zeit haben zu entkommen ü§æüèæ üèûÔ∏è ‚ôçÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="RTSP ist ein einfaches Signalisierungsprotokoll, das sie viele Jahre lang nicht durch irgendetwas ersetzen k√∂nnen, und wir m√ºssen zugeben, dass sie es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie man RTSP auf der Baustelle im Jahr 2020 vorbereitet oder warum Eber keine Zeit haben zu entkommen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flashphoner/blog/478884/"><p><img src="https://habrastorage.org/webt/0o/qj/i7/0oqji7xkok-ssze_oqdnr2kmfcg.jpeg"></p><br><p>  RTSP ist ein einfaches Signalisierungsprotokoll, das sie viele Jahre lang nicht durch irgendetwas ersetzen k√∂nnen, und wir m√ºssen zugeben, dass sie es nicht wirklich versuchen. </p><br><p>  Nehmen wir an, wir haben eine IP-Kamera mit RTSP-Unterst√ºtzung.  Jeder, der den Datenverkehr mit einem Haikabel gesp√ºrt hat, wird Ihnen sagen, dass zuerst DESCRIBE, dann PLAY und dann der Datenverkehr direkt √ºber RTP eingespeist oder in denselben TCP-Kanal eingepackt wird. </p><a name="habracut"></a><br><p>  Ein typischer RTSP-Verbindungsaufbau sieht wie folgt aus: </p><br><p><img src="https://habrastorage.org/webt/yi/i9/kw/yii9kwulxpxxz1dywpppxqdy0ko.png"></p><br><p>  Es ist klar, dass die Unterst√ºtzung des RTSP-Protokolls f√ºr Browser √ºberfl√ºssig ist und ein f√ºnftes Bein wie ein Hund ben√∂tigt. Daher haben Browser es nicht eilig, es massiv zu implementieren, und es ist unwahrscheinlich, dass sie jemals dazu kommen.  Auf der anderen Seite k√∂nnten Browser direkte TCP-Verbindungen herstellen, und dies w√ºrde das Problem l√∂sen, aber hier h√§ngt alles von der Sicherheit ab - wo haben Sie den Browser gesehen, der es dem Skript erm√∂glicht, Transportprotokolle direkt zu verwenden? </p><br><p>  Die Benutzer ben√∂tigen jedoch einen Stream in "jedem Browser ohne Installation zus√§tzlicher Software", und Startups schreiben auf ihre Websites "Sie m√ºssen nichts installieren - das funktioniert in allen Browsern sofort", wenn sie den Stream von der IP-Kamera anzeigen m√∂chten. </p><br><p>  In diesem Artikel werden wir herausfinden, wie dies erreicht werden kann.  Und da es auf dem Hof ‚Äã‚Äãeine runde Nummer gibt, geben wir dem Artikel Relevanz und h√§ngen das 2020-Label auf, umso mehr, wie es ist. </p><br><p>  Welche Technologien zum Anzeigen von Videos auf einer Webseite sollten 2020 also vergessen werden?  Flash im Browser.  Er ist gestorben.  Er ist nicht mehr - streichen. </p><br><h3 id="tri-godnyh-sposoba">  Drei gute Wege </h3><br><p>  Die Tools, mit denen Sie den Videostream heute im Browser anzeigen k√∂nnen, sind: </p><br><ol><li>  WebRTC </li><li>  Hls </li><li>  Websocket + MSE </li></ol><br><h4 id="chto-ne-tak-s-webrtc">  Was ist los mit WebRTC </h4><br><p>  Zwei W√∂rter: ressourcenintensiv und komplex. </p><br><p> Nun, wie hoch ist die Ressourcenintensit√§t?  - Sie winken ab, denn heute sind die Prozessoren leistungsstark, der Speicher ist billig, was ist das Problem?  Nun, erstens wird die Verschl√ºsselung des gesamten Datenverkehrs erzwungen, auch wenn Sie ihn nicht ben√∂tigen.  Zweitens ist WebRTC eine komplexe wechselseitige Kommunikation und ein Austausch von R√ºckmeldungen zur Qualit√§t des Kanals zwischen dem Peer und dem Peer (in diesem Fall zwischen dem Peer und dem Server). Bei jeder Berechnung der Bitrate werden Paketverluste nachverfolgt und Entscheidungen zum Senden getroffen Insgesamt wird die Synchronisation von Audio und Video, der sogenannte Lipsync, so berechnet, dass die Lippen des Sprechers nicht von seinen Worten abweichen.  All diese Berechnungen sowie der Datenverkehr, der auf den Server gelangt, stellen in Echtzeit Gigabyte RAM zur Verf√ºgung, und wenn etwas schief geht, kann ein 256-Gigabyte-Server mit 48 CPU-Kernen trotz aller Gigahertz-, Nanometer- und DDR 10-Werte schnell ins Trudeln geraten an Bord. </p><br><p>  Es stellte sich heraus, dass auf Spatzen vom Iskander geschossen wurde.  Wir m√ºssen nur den RTSP-Stream heraussaugen und zeigen, und WebRTC sagt: Ja, mach weiter, aber du musst daf√ºr bezahlen. </p><br><h3 id="chem-horosh-webrtc">  Was ist gut an WebRTC? </h3><br><p>  Verz√∂gerung  Sie ist wirklich niedrig.  Wenn Sie bereit sind, f√ºr niedrige Latenzzeiten mit Leistung und Komplexit√§t zu bezahlen, ist WebRTC die beste Option. </p><br><h4 id="chem-horosh-hls">  Was ist gut an HLS? </h4><br><p>  Zwei Worte: Funktioniert √ºberall </p><br><p>  HLS ist das langsamste Gel√§ndefahrzeug der Welt f√ºr die Anzeige von Live-Inhalten.  √úberall funktioniert es dank zweier Dinge: HTTP-Transport und Apple-Patronat.  In der Tat ist das HTTP-Protokoll allgegenw√§rtig, ich sp√ºre seine Anwesenheit, auch wenn ich diese Zeilen schreibe.  Egal, wo Sie sich gerade befinden und wie alt das Tablet auch ist, HLS (HTTP Live Streaming) erreicht Sie und liefert das Video auf Ihren Bildschirm. </p><br><p>  Und alles w√§re gut, aber. </p><br><h4 id="chem-ploh-hls">  Als schlechtes HLS </h4><br><p>  Verz√∂gerung  Es gibt zum Beispiel Video√ºberwachungsprojekte f√ºr die Baustelle.  Das Objekt befindet sich seit Jahren im Bau und zu diesem Zeitpunkt verl√§sst eine ungl√ºckliche Kammer Tag und Nacht rund um die Uhr die Baustelle.  Dies ist ein Beispiel daf√ºr, dass keine niedrige Latenz erforderlich ist. </p><br><p>  Ein anderes Beispiel sind Wildschweine.  Echte Eber.  Die Bauern in Ohio leiden unter der Invasion von Wildschweinen, die wie Heuschrecken Getreide fressen und mit F√º√üen treten und so das finanzielle Wohlergehen der Wirtschaft gef√§hrden.  Firmengr√ºnder haben ein Video√ºberwachungssystem mit RTSP-Kameras auf den Markt gebracht, das in Echtzeit das Land √ºberwacht und die Falle senkt, wenn ungebetene G√§ste in das Land eindringen.  In diesem Fall ist die niedrige Verz√∂gerung kritisch und bei Verwendung von HLS (mit einer Verz√∂gerung von 15 Sekunden) laufen die Eber weg, bevor die Falle aktiviert wird. </p><br><p><img src="https://habrastorage.org/webt/g4/ha/iw/g4haiwkwu7jqrhh65c804phjt-q.jpeg"></p><br><p>  Ein weiteres Beispiel: Videopr√§sentationen, in denen Sie das Produkt demonstrieren und eine schnelle Reaktion erwarten.  Bei gro√üer Versp√§tung zeigen sie Ihnen die Ware in der Kamera, dann fragen sie ‚Äûwie?‚Äú Und dies in nur 15 Sekunden.  In 15 Sekunden kann das Signal 12 Mal zum Mond und zur√ºck gefahren werden.  Nein, wir brauchen keine solche Verz√∂gerung.  Es sieht eher so aus, als ob Sie ein aufgezeichnetes Video zeigen w√ºrden, als wenn Sie es in Live sehen w√ºrden.  Es ist jedoch nicht verwunderlich, dass HLS folgenderma√üen funktioniert: Es schreibt Videost√ºcke auf die Festplatte oder in den Speicher des Servers, und der Player l√§dt die aufgezeichneten St√ºcke herunter.  Das Ergebnis ist HTTP Live, das √ºberhaupt nicht live ist. </p><br><p>  Warum passiert das?  Die Allgegenwart des HTTP-Protokolls und seine Einfachheit f√ºhren letztendlich zu einer Hemmung - HTTP sollte nicht zum schnellen Herunterladen und Anzeigen Tausender gro√üer Videodateien (HLS-Segmente) verwendet werden.  Nat√ºrlich laden sie herunter und spielen mit guter Qualit√§t, aber sehr langsam - w√§hrend sie herunterladen, w√§hrend sie puffern, gehen sie zum Decoder, die gleichen 15 Sekunden oder mehr vergehen. </p><br><p>  Es ist anzumerken, dass Apple im Herbst 2019 die HLS Low Latency angek√ºndigt hat, aber das ist eine andere Geschichte.  Wir werden uns sp√§ter genauer ansehen, was passiert ist.  Und wir haben immer noch MSE auf Lager. </p><br><h4 id="chem-horosh-mse">  Was ist gut MSE </h4><br><p>  Media Source Extension ist eine native Unterst√ºtzung f√ºr die Wiedergabe von Batch-Videos in einem Browser.  Wir k√∂nnen sagen, ein nativer Player f√ºr H.264 und AAC, der im Gegensatz zu HLS Videosegmente f√ºttern kann und nicht an das Transportprotokoll gebunden ist.  Aus diesem Grund kann der Transport √ºber das Websockets-Protokoll ausgew√§hlt werden.  Mit anderen Worten, Segmente werden nicht mehr mithilfe der alten HTTP-Technologie (Request-Response) heruntergeladen, sondern der Spa√ü flie√üt √ºber eine Websockets-Verbindung - ein fast direkter TCP-Kanal.  Dies hilft sehr bei der Reduzierung von Verz√∂gerungen, die auf 3-5 Sekunden reduziert werden k√∂nnen.  Die Verz√∂gerung ist nicht super, aber f√ºr die meisten Projekte geeignet, die keine harte Echtzeit erfordern.  Die Komplexit√§t und der Ressourcenverbrauch sind ebenfalls relativ gering: Ein TCP-Kanal wird ge√∂ffnet, und es flie√üen fast dieselben HLS-Segmente, die vom Player erfasst und f√ºr die Wiedergabe bereitgestellt werden. </p><br><h4 id="chem-ploh-mse">  Was ist schlecht MSE </h4><br><p>  Es funktioniert nicht √ºberall.  Wie bei WebRTC ist die Browserpenetration geringer.  IP-Telefone (iOS) sind besonders daran beteiligt, MSE nicht zu spielen, weshalb MSE als einzige L√∂sung f√ºr Starts ungeeignet ist. </p><br><p>  Vollst√§ndig verf√ºgbar in den Browsern: Edge, Firefox, Chrome, Safari, Android-Browser, Opera Mobile, Chrome f√ºr Android, Firefox f√ºr Android, UC-Browser f√ºr Android </p><br><p><img src="https://habrastorage.org/webt/xt/oq/wn/xtoqwnjdoosqb6fhopu9rvoxsxy.png"></p><br><p>  IOS Safari unterst√ºtzt MSE seit Version 13 von iOS nur noch eingeschr√§nkt. </p><br><p><img src="https://habrastorage.org/webt/fl/wd/-n/flwd-nksnux1tlprjriupeajyvm.png"></p><br><h3 id="rtsp-noga">  Rtsp-Bein </h3><br><p>  Wir haben den Versand zum Videoserver&gt; Browser besprochen.  Dar√ºber hinaus sind zwei weitere Dinge erforderlich: </p><br><p>  1) Video von der IP-Kamera an den Server senden. </p><br><p>  2) Konvertieren Sie das empfangene Video in eines der oben genannten Formate / Protokolle. </p><br><p>  Hier betritt die Serverseite die Szene. </p><br><p>  TaTam ... Web Call Server 5 (f√ºr Bekannte nur WCS).  Jemand sollte RTSP-Verkehr empfangen, das Video ordnungsgem√§√ü entpacken, es in WebRTC, HLS oder MSE konvertieren, vorzugsweise ohne von einem Transcoder gequetscht zu werden, und es der Browserseite in einem anst√§ndigen, nicht durch Artefakte und Einfrierungen verderbten Zustand geben. </p><br><p>  Die Aufgabe ist auf den ersten Blick nicht schwierig, aber es gibt so viele Fallen, chinesische Kameras und die Nuancen der Konvertierung, die schrecklich sind.  Im Allgemeinen nicht ohne Hacks, aber es funktioniert und funktioniert gut.  In der Produktion. </p><br><h4 id="shema-dostavki">  Lieferschema </h4><br><p>  Als Ergebnis entsteht ein ganzheitliches Schema f√ºr die Bereitstellung von RTSP-Inhalten mit Konvertierung auf einem Zwischenserver. </p><br><p><img src="https://habrastorage.org/webt/jm/7e/oj/jm7eojlfeztudqtrwzjebgu4t9e.png"></p><br><p>  Eine der h√§ufigsten Anfragen unserer indischen Kollegen ‚ÄûIst das m√∂glich?  Direkt ohne Server? "  Nein, das ist unm√∂glich. Sie ben√∂tigen einen Serverteil, der diese Aufgabe √ºbernimmt.  In der Wolke, auf dem St√ºck Eisen, auf Corei7 auf dem Balkon, aber ohne es in irgendeiner Weise. </p><br><h4 id="vernemsya-k-nashemu-2020-godu">  Zur√ºck zu unserem 2020 </h4><br><p>  Also das Rezept f√ºr RTSP im Browser: </p><br><ol><li>  Holen Sie sich ein frisches WCS (Web Call Server). </li><li>  Nach Geschmack hinzuf√ºgen: WebRTC, HLS oder MSE. </li><li><p>  Auf einer Webseite auslegen. </p><br><p>  Guten Appetit! </p><br></li></ol><br><h3 id="net-esche-ne-vse">  Nein, noch nicht alles </h3><br><p>  Neugierige Neuronen werden sicherlich die Frage "Wie?" Haben.  Na wie geht das?  Wie wird es in einem Browser aussehen? ‚Äú  Ihre Aufmerksamkeit ist der minimale WebRTC-Spieler, der auf dem Knie gemacht wird: </p><br><p>  1) Wir verbinden das flashphoner.js-Skript und das my_player.js-Skript mit der Webseite der Haupt-API, die wir etwas sp√§ter erstellen werden. </p><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../../../flashphoner.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">my_player.js</span></span></span><span class="hljs-tag">"&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  2) Wir initialisieren die API im Hauptteil der Webseite </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"init_api()"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  3) Wir werfen auf die Seite div, die ein Container f√ºr das Video sein wird.  Wir werden ihm die Gr√∂√üe und den Rand zeigen. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:320px;height:240px;border: solid 1px"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  4) F√ºgen Sie eine Wiedergabetaste hinzu. Klicken Sie auf, um eine Verbindung zum Server herzustellen und die Wiedergabe zu starten </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"connect()"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PLAY"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><p>  5) Erstellen Sie nun das Skript my_player.js, das den Hauptcode unseres Players enth√§lt.  Wir beschreiben Konstanten und Variablen </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> SESSION_STATUS = Flashphoner.constants.SESSION_STATUS; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> STREAM_STATUS = Flashphoner.constants.STREAM_STATUS; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> session;</code> </pre> <br><p>  6) Wir initialisieren die API beim Laden der HTML-Seite </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init_api</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"init api"</span></span>); Flashphoner.init({ }); }</code> </pre> <br><p>  7) Stellen Sie √ºber WebSocket eine Verbindung zum WCS-Server her.  Ersetzen Sie "wss: //demo.flashphoner.com" durch Ihr WCS, damit alles ordnungsgem√§√ü funktioniert </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ session = Flashphoner.createSession({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>: <span class="hljs-string"><span class="hljs-string">"wss://demo.flashphoner.com"</span></span>}).on(SESSION_STATUS.ESTABLISHED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">session</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"connection established"</span></span>); playStream(session); }); }</code> </pre> <br><p>  8) Als N√§chstes √ºbergeben wir zwei Parameter: name und display: name - RTSP-URL des wiedergegebenen Streams.  display - das myVideo-Element, in das unser Player eingebunden wird.  Geben Sie hier auch die URL des Streams an, den Sie anstelle unserer Streams ben√∂tigen. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = {<span class="hljs-attr"><span class="hljs-attr">name</span></span>:<span class="hljs-string"><span class="hljs-string">"rtsp://b1.dnsdojo.com:1935/live/sys2.stream"</span></span>,<span class="hljs-attr"><span class="hljs-attr">display</span></span>:<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"myVideo"</span></span>)}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = session.createStream(options).on(STREAM_STATUS.PLAYING, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"playing"</span></span>); }); stream.play(); }</code> </pre> <br><p>  Wir speichern die Dateien und versuchen den Player zu starten.  Wird Ihr RTSP-Stream abgespielt? </p><br><p>  Beim Testen haben wir Folgendes gespielt: rtsp: //b1.dnsdojo.com: 1935 / live / sys2.stream. </p><br><p>  Und so sieht es aus: </p><br><p>  Spieler vor dem Dr√ºcken der "Play" -Taste </p><br><p><img src="https://habrastorage.org/webt/pe/ej/6n/peej6nfw2lthkmmnsrypojl6bzq.png"></p><br><p>  Player mit laufendem Video </p><br><p><img src="https://habrastorage.org/webt/w3/h8/yo/w3h8yozn6madl2tolxx_xg3yljs.png"></p><br><p>  Es gibt sehr wenig Code: </p><br><p>  HTML </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"../../../../flashphoner.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">my_player.js</span></span></span><span class="hljs-tag">"&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"init_api()"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:320px;height:240px;border: solid 1px"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"connect()"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PLAY"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Javascript </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//Status constants var SESSION_STATUS = Flashphoner.constants.SESSION_STATUS; var STREAM_STATUS = Flashphoner.constants.STREAM_STATUS; //Websocket session var session; //Init Flashphoner API on page load function init_api() { console.log("init api"); Flashphoner.init({ }); } //Connect to WCS server over websockets function connect() { session = Flashphoner.createSession({urlServer: "wss://demo.flashphoner.com"}).on(SESSION_STATUS.ESTABLISHED, function(session){ console.log("connection established"); playStream(session); }); } //Playing stream with given name and mount the stream into myVideo div element function playStream() { var options = {"rtsp://b1.dnsdojo.com:1935/live/sys2.stream",display:document.getElementById("myVideo")}; var stream = session.createStream(options).on(STREAM_STATUS.PLAYING, function(stream) { console.log("playing"); }); stream.play(); }</span></span></code> </pre> <br><p>  Die Serverseite ist demo.flashphoner.com.  Der vollst√§ndige Beispielcode ist unten im Keller mit Links verf√ºgbar.  Viel Spa√ü beim Streamen! </p><br><h3 id="ssylki">  Referenzen </h3><br><p>  <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/streaming/player">Spielercode auf Github</a> </p><br><p>  <a href="https://flashphoner.com/translyaciya-rtsp-kontenta-na-web-brauzery-cher/%3Flang%3Dru">Integration eines RTSP-Players in eine Webseite oder eine mobile Anwendung</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de478884/">https://habr.com/ru/post/de478884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de478862/index.html">Wie ist der Frontend-Test in Yandex.Market aufgebaut und warum lehnen wir w√∂chentliche Releases ab?</a></li>
<li><a href="../de478866/index.html">Meet Space - Neues Produkt von JetBrains</a></li>
<li><a href="../de478872/index.html">DIY: Wie wir die Lager√ºberwachung automatisieren</a></li>
<li><a href="../de478874/index.html">Toshiba hat zwei neue Festplattenreihen mit einer Kapazit√§t von bis zu 6 TB angek√ºndigt und seine Ausrichtung auf das Unternehmenssegment seit 2020 angek√ºndigt</a></li>
<li><a href="../de478878/index.html">Das beliebteste St√ºck Code in der Geschichte von StackOverflow hat einen Fehler!</a></li>
<li><a href="../de478886/index.html">Winkelkomponenten mit Inline-Inhalt</a></li>
<li><a href="../de478888/index.html">Einige Gedanken zu modularen CSS- und Code-Support-Problemen</a></li>
<li><a href="../de478890/index.html">Wo ist mein Paket? KI erleichtert die Zustellung</a></li>
<li><a href="../de478892/index.html">Freiwilligenarbeit als Lebensform</a></li>
<li><a href="../de478894/index.html">Lerne Azure in einem Monat des Mittagessens - unser neues kostenloses E-Book</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>