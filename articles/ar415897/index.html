<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐น ๐ ูุธุงุฆู ูุชูุซูู ููุงุนุฏ ุจูุงูุงุช PostgreSQL. ุงูุฌุฒุก ุงูุซุงูู ๐๐ฟ ๐จ๐ฝโ๐จ ๐จ๐ปโ๐ซ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฐุง ูู ุงูุฌุฒุก ุงูุซุงูู ูู ุงูููุงูุฉ ุงูุฐู ูุตู ุงููุธุงุฆู ุงููุนุฑูุฉ ูู ูุจู ุงููุณุชุฎุฏู ููุนูู ูุน ุฏูุงุฆู ุงููุธุงู: pg_class ุ pg_attribute ุ pg_constictions ุ ุฅูุฎ. 

 ููุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุธุงุฆู ูุชูุซูู ููุงุนุฏ ุจูุงูุงุช PostgreSQL. ุงูุฌุฒุก ุงูุซุงูู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415897/" style=";text-align:right;direction:rtl">  ูุฐุง ูู ุงูุฌุฒุก ุงูุซุงูู ูู ุงูููุงูุฉ ุงูุฐู ูุตู ุงููุธุงุฆู ุงููุนุฑูุฉ ูู ูุจู ุงููุณุชุฎุฏู ููุนูู ูุน ุฏูุงุฆู ุงููุธุงู: pg_class ุ pg_attribute ุ pg_constictions ุ ุฅูุฎ. <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zc/rx/ta/zcrxta08dnfat5cqpgid4lyq7by.png"></div><br>  ููุงูุด ูุฐุง ุงูุฌุฒุก ูู ุงูููุงูุฉ ุงููุธุงุฆู ุงูุชู <b>ุชูุฑุฌุน ุฎุตุงุฆุต ุงููููุฏ ูุงูููุงุฑุณ</b> . <br><a name="habracut"></a><br>  ููุฏู ุงููุตู ุงูุฃูู ูู ุงูููุงูุฉ ุชุนูููุงุช ุนูู ุชูููุฐ ุงููุธุงุฆู.  ูุงูุซุงูู ูู ุฑูุฒ ุงููุตุฏุฑ ูููุธุงุฆู.  ุจุงููุณุจุฉ ูููุฑุงุก ุงูููุชููู ููุท ุจุงููุตูุต ุงููุตุฏุฑ ุ ููุชุฑุญ ุงููุชุงุจุนุฉ ุงูููุฑูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููููุญู</a> . <br><p style=";text-align:right;direction:rtl">  <b>ุงูุธุฑ ุฃูุถูุง</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธุงุฆู ูุชูุซูู ููุงุนุฏ ุจูุงูุงุช PostgreSQL.</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก ุงูุฃูู</a></b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธุงุฆู ูุชูุซูู ููุงุนุฏ ุจูุงูุงุช PostgreSQL.</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก ุงูุซุงูุซ</a> .</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธุงุฆู ูุชูุซูู ููุงุนุฏ ุจูุงูุงุช PostgreSQL.</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ (ุงูุฌุฒุก ุงูุฑุงุจุน)</a> .</b> <br><br></p><h3 style=";text-align:right;direction:rtl">  ูุงุฆูุฉ admtf_Table_Constraintes ููููุฏ ุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฎุตุงุฆุตูุง </h3><br><a name="tfTableC_def"></a><br><p style=";text-align:right;direction:rtl">  ุชุนุฑุถ ุงูุฏุงูุฉ admtf_Table_Constraintes ูุงุฆูุฉ ุจุงููููุฏ (CONSTRAINT) ูุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฎุตุงุฆุตูุง.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู ุนุฑุถ ููุฏ ุงููุตุฏุฑ ูุชูุฒููู ููุง</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุง ูุณุฎุฉ ูู ูุธููุฉ ูุง ุชุณุชุฎุฏู ุงููุคุดุฑ</a> . </p><br><br>  ููุนููุงุช ุ ุชุฃุฎุฐ ุงูุฏุงูุฉ ุงุณู ุงูุฌุฏูู ุงููุตุฏุฑ ( <b>a_TableName</b> ) ูุงุณู ุงููุฎุทุท ุงูุฐู ูุชู ุฅูุดุงุก ุงูุฌุฏูู <b>ุฏุงุฎูู</b> ( <b>a_SchemaName</b> ). <br><br><p style=";text-align:right;direction:rtl">  ูุตู ููุฏ ูุนูู ูู ูุฒูุฌ ูู ุงูุณุฌู ูู <b>pg_class</b> ูุตูู ุจุฃูู ุนูุงูุฉ ูุงุฏูุฉ ูุงูุณุฌู ูู <b>pg_constraint</b> ูุญุชูู ุนูู ุจูุงูุงุช ุนู ุงูุฎุตุงุฆุต ุงููุญุฏุฏุฉ <b>ููููุฏ</b> . </p><br><br><img src="https://habrastorage.org/webt/q8/xc/ll/q8xcllhdjgtvndtzraq2ofsssti.png"><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุฏ ุงููุตุฏุฑ ููุนุงูู ูู ุงูุดูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tbl.OID,con.conname,con.contype,con.conkey,reftbl.OID, reftbl.relname,con.confkey,con.consrc <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_constraint con <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> con.connamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> con.conrelid=tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class reftbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> con.confrelid=reftbl.oid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableOID) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> con.contype <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>,con.conname;</code> </pre> <br></div></div><br><p style=";text-align:right;direction:rtl">  ูุชู ุงุณุชุฑุฏุงุฏ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ (ุงุณู ูููุน ุงูุชูููุฏ) ูู <b>ุฅุฏุฎุงู</b> ุฏููู <b>pg_constraint</b> .  ูุชู ุงุณุชุฎุฑุงุฌ ุฎุตุงุฆุต ูู ููุฏ ูู ููุณ ุงููุชุงููุฌ ุ ูุงูุชู ูุชู ุชูุฏูููุง ูู ุดูู ุฌุฏุงูู OID ( <b>conrelid</b> ุ <b>confrelid</b> ) ุฃู ุตูุงุฆู ูู ุงูุฃุฑูุงู ุงูุชุณูุณููุฉ <b>ููุณูุงุช</b> ( <b>conkey</b> ุ <b>confkey</b> ) ุงููุดุงุฑูุฉ ูู ุงูููุฏ. </p><br><br><p style=";text-align:right;direction:rtl">  ุชููู ุงูุฏุงูุฉ ุจุฅุฑุฌุงุน ุฎุตุงุฆุต ุงูููุฏ ูู ุดูู ุฃุณูุงุก ุงูุฌุฏูู ูุงูุณูุงุช.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุชู ุงุณุชุฎุฑุงุฌ ุฃุณูุงุก ุงูุฌุฏุงูู ูู <b>ุฅุฏุฎุงู</b> ูุชุงููุฌ <b>pg_class</b> ุญุณุจ ุงููุนุฑู (OID) ุ ูุฃุณูุงุก ุงูุณูุงุช ูู <b>ุฅุฏุฎุงูุงุช</b> ูุชุงููุฌ <b>pg_attribute</b> ุจูุงุณุทุฉ ูุนุฑู ุงูุฌุฏูู ูุงูุฑูู ุงูุชุณูุณูู ููุณูุฉ.  ูุฃู  ูุธุฑูุง ูุฃูู ูุชู ุชุฎุฒูู ุงูุฃุฑูุงู ุงูุชุณูุณููุฉ ูู ุงูุฏููู ุงูุฑุฆูุณู ูู ุดูู ูุตูููุฉ (ูุงุฆูุฉ) ุ ูุฅู ููุงุฆู ุฃุณูุงุก ุงูุณูุงุช ูุชู ุชุดููููุง ุฏุงุฎู ุงููุธููุฉ ุจุงุณุชุฎุฏุงู ุญููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุชููู ุงูุฏุงูุฉ ุจุฅุฑุฌุงุน ุฎุงุตูุฉ ุฎุงุตุฉ ูุงุญุฏุฉ - ุงููุงุนุฏุฉ ููุชุญูู ูู ููู ุงูุญููู ูู ุฅุฏุฎุงูุงุช ุงูุฌุฏูู (ุชูููุฏ ุงูุชุญูู).  ูุชู ุชุฎุฒูู ูุฐู ุงูุฎุงุตูุฉ ููููุฉ ูุตูุฉ ูู ุญูู <b>ูููู</b> ููุฏููู <b>pg_constraint</b> . </p><br>  <strong>ุงูุฌุฏูู 7. ูุชูุฌุฉ ุชูููุฐ ุงููุธููุฉ admtf_Table_Constraintes ("public" ุ "Street").</strong> <br><img src="https://habrastorage.org/webt/gd/x6/ny/gdx6ny5rnukyvjntf4bjirkwlye.png"><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุณุฎุฉ ุงููุต ูู ุงูุฌุฏูู ูู ุงูุดูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><table width="80" border="1" style=";text-align:right;direction:rtl"><tbody><tr><th width="15">  ุงูุนููุงู </th><th width="5">  ุงูุชุจ </th><th width="20">  ุณูุงุช ุฌุฏูู ุงููุตุฏุฑ </th><th width="10">  ุงุณู ุงูุฌุฏูู ุงูุฎุงุฑุฌู </th><th width="15">  ุณูุงุช ุงูุฌุฏูู ุงูุฎุงุฑุฌู </th><th width="15">  ูุงุนุฏุฉ ุงูุชุญูู </th></tr><tr><td width="15">  xpkstreet </td><td width="5">  ุต </td><td width="20">  wcrccode ุ localityid ุ streetid </td><td width="10"></td><td width="15"></td><td width="15"></td></tr><tr><td width="15">  fk_street_locality </td><td width="5">  ู </td><td width="20">  wcrccode ุ localityid </td><td width="10">  ูุญูุฉ </td><td width="15">  wcrccode ุ localityid </td><td width="15"></td></tr><tr><td width="15">  fk_street_streettype </td><td width="5">  ู </td><td width="20">  streettypeacrm </td><td width="10">  ููุน ุงูุดุงุฑุน </td><td width="15">  streettypeacrm </td><td width="15"></td></tr><tr><td width="15">  ck_street_streetname </td><td width="5">  ุฌ </td><td width="20">  ุงุณู ุงูุดุงุฑุน </td><td width="10"></td><td width="15"></td><td width="15">  ((ุงุณู ุงูุดุงุฑุน) :: text! ~ * '[az]' :: text) </td></tr><tr><td width="15">  ck_street_streettypeacrm </td><td width="5">  ุฌ </td><td width="20">  streettypeacrm </td><td width="10"></td><td width="15"></td><td width="15">  ((streettypeacrm) :: bpchar! ~ * '[az]' :: text) </td></tr></tbody></table><br></div></div><br><a name="tfTableC_woc_def"></a><br><h4 style=";text-align:right;direction:rtl">  ุฅุตุฏุงุฑ ุจุฏูู ูุคุดุฑ </h4><br><p style=";text-align:right;direction:rtl">  ุฃุชููุน ุฃุณุฆูุฉ ูุชุนูููุงุช ุญูู ุงุณุชุฎุฏุงู ุงููุคุดุฑ ูู ุงููุณุฎุฉ ุงูุฑุฆูุณูุฉ ูู ุงููุธููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฃุฌูุจ - ูุง ููุฌุฏ ุฑูุงู ููุทุนู ูุงูููู.  ูููู ุณุฃุนุทู ูุณุฎุฉ ูู ุงููุธููุฉ ุจุฏูู ูุคุดุฑ.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู ุงูุงุทูุงุน ุนูู ูุณุฎุฉ ุชูููุฐ ุงููุธููุฉ ุจุฏูู ุงุณุชุฎุฏุงู ุงููุคุดุฑ ูุชูุฒูููุง ููุง</a> . </p><br><p style=";text-align:right;direction:rtl">  ูุชุชูุซู ุงูุตุนูุจุฉ ุงูุฑุฆูุณูุฉ ูู ุชูุธูู ุงูุตูุฉ (JOIN) ููุฌุฏุงูู ููููุง ููููู ุงูููุฌูุฏุฉ ูู ููุน ุณูุฉ ุตููู ุฃุญุฏูุง.  ูุซู ูุฐู ุงููุตูููุงุช ูู ูุฐู ุงูุญุงูุฉ ูู <b>ููููู</b> <b>ูููููู</b> . </p><br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.conname,c.contype,c.conkey::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[], GENERATE_SUBSCRIPTS(c.conkey, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_constraint c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.conname=<span class="hljs-string"><span class="hljs-string">'fk_street_locality'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span>;</code> </pre><br><p style=";text-align:right;direction:rtl">  ูุญู ูุฐู ุงููุดููุฉ ุ ูุญุชูู PostgrSQL ุนูู ุฏุงูุงุช ุชุฑุฌุน ุฌุฏูู ููู ุงููุคุดุฑุงุช ุฅูู ุนูุงุตุฑ ุงูุตููู.  ูู ุญุงูุชูุง ุ ุณูุชู ุงุณุชุฎุฏุงู ูุธููุฉ gener_subscripts.  ููู ูุง ูููุฏ ุงููุซูุฑ ูู ุงููุคุดุฑุงุช ุฅูู ููุถุน ุงููุตูููุฉ ุงูุชู ุชู ุชูุฑูุฑูุง ุฅููู ููุนููุฉ ูุญุณุจ ุ ุจู ูุญูู ุฃูุถูุง ุณุฌููุง ูุงุญุฏูุง ูุญุชูู ุนูู ุงููุตูููุฉ ุฅูู ุนุฏุฉ ุนูุงุตุฑ ุจุนุฏุฏ ุงูุนูุงุตุฑ ูู ุงููุตูููุฉ.  ูุญุชูู ูู ุณุฌู ููุฐุง ุงูุฌุฏูู ุนูู ูููุฉ ูุฑูุฏุฉ ูุงุญุฏุฉ - ููุถุน ุงูุตููู. </p><br><br>  <strong>ุงูุฌุฏูู 8. ูุดุฑ ุงูุณูุณูุฉ ุงูุฃุตููุฉ ุจุงุณุชุฎุฏุงู <b>gener_subscripts</b> .</strong> <br><br><table width="95" border="1" style=";text-align:right;direction:rtl"><tbody><tr><th width="15">  ุงุณู ุงูุชูููุฏ </th><th width="5">  ุงูุชุจ </th><th width="10">  ุตููู ูู ุฃุฑูุงู ุงูุณูุงุช </th><th width="10">  ุงููุคุดุฑ ุฅูู ููุถุน ุตููู </th></tr><tr><td width="15">  fk_street_locality </td><td width="5">  ู </td><td width="10">  {1} {2} </td><td width="10">  1 </td></tr><tr><td width="15">  fk_street_locality </td><td width="5">  ู </td><td width="10">  {1} {2} </td><td width="10">  2 </td></tr></tbody></table><br><br><img src="https://habrastorage.org/webt/0t/yn/9_/0tyn9__z3p-g8knkavap0aluta8.png"><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุฏ ุงููุตุฏุฑ ููุนุงูู ูู ุงูุดูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> con.conname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ConstraintName,con.contype::<span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ConstraintType, STRING_AGG(attr.attname, <span class="hljs-string"><span class="hljs-string">', '</span></span><span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> con.No) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_ConstraintKeyNames, reftbl.relname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> RefTableName, STRING_AGG(rattr.attname,<span class="hljs-string"><span class="hljs-string">', '</span></span><span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> con.No) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_RefTableKeyNames, con.consrc <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ConstraintSource <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> c.oid, c.conrelid,c.confrelid,c.conname,c.contype, c.conkey::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],c.consrc, c.confkey::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[], generate_subscripts(c.conkey, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_constraint c) con <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> con.conrelid=tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_attribute <span class="hljs-keyword"><span class="hljs-keyword">attr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> attr.attrelid=tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> attr.attnum=con.conkey[con.No] <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class reftbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> con.confrelid=reftbl.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_attribute rattr <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rattr.attrelid=reftbl.oid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rattr.attnum=con.confkey[con.No] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableName) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> con.conname,con.contype,reftbl.relname,con.consrc <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> con.contype <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>,con.conname;</code> </pre><br></div></div><br><p style=";text-align:right;direction:rtl">  ูููู ุฑุจุท ูุฐุง ุงูุฌุฏูู ุจููุฑุณ ุงูุณูุงุช <b>pg_attribute</b> ุ ูุงุณุชุฎุฑุงุฌ ุฃุณูุงุก ุงูุณูุงุช ููู ุจุงูุญุงูุฉ <b>attr.attrelid = tbl.oid AND attr.attnum = con.conkey [con.No]</b> . <br>  ุงูุขู ูุจูู ุฅุฒุงูุฉ ุงูุณุฌูุงุช ุบูุฑ ุงูุถุฑูุฑูุฉ ุนู ุทุฑูู ุชุฌููุน ุงูุณุฌูุงุช ุ ูุฅูุดุงุก ุณูุณูุฉ ูู ุฃุณูุงุก ุงูุณูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุฅูุดุงุก ุตู ุจุงุณุชุฎุฏุงู ูุธููุฉ ุงูุชุฌููุน <b>STRING_AGG</b> ุ ุญูุซ ูุฌุจ ุนููู ุชุญุฏูุฏ ุฎูุงุฑ ุงููุฑุฒ (ORDER BY) ุ ูุฅูุง ูุฏ ูุง ูููู ุชุฑุชูุจ ุงูุณูุงุช ููููุง ูุชุฑุชูุจ ุงูุฅุนูุงู ุนู ุงูุณูุงุช ูู ุงูููุฑุณ. </p><br><br><p style=";text-align:right;direction:rtl">  ุชุฒุงูู ููุช ุชูููุฐ ููุง ุงูุฅุตุฏุงุฑูู ูู ุงูุฏุงูุงุช.  ุงุณุชุบุฑู ุงูุฃูุฑ 20 ูููู ุซุงููุฉ ูุฅุฎุฑุงุฌ ุงูุจูุงูุงุช ูู ุฌุฏูู ุงููุชุงุฆุฌ. </p><br><h3 style=";text-align:right;direction:rtl">  ูุงุฆูุฉ ูุธุงุฆู Admtf_Table_Indexes ูููุงุฑุณ ุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฎุตุงุฆุตูุง </h3><br><a name="tfTableI_def"></a><br><p style=";text-align:right;direction:rtl">  ุชุนุฑุถ ุงูุฏุงูุฉ admtf_Table_Indexes ูุงุฆูุฉ ุจุงูููุงุฑุณ (INDEX) ูุฌุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฎุตุงุฆุตูุง.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู ุนุฑุถ ููุฏ ุงููุตุฏุฑ ูุชูุฒููู ููุง</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุง ูุณุฎุฉ ูู ูุธููุฉ ูุง ุชุณุชุฎุฏู ุงููุคุดุฑ</a> . </p><br>  ููุนููุงุช ุ ุชุฃุฎุฐ ุงูุฏุงูุฉ ุงุณู ุงูุฌุฏูู ุงููุตุฏุฑ ( <b>a_TableName</b> ) ูุงุณู ุงููุฎุทุท ุงูุฐู ูุชู ุฅูุดุงุก ุงูุฌุฏูู <b>ุฏุงุฎูู</b> ( <b>a_SchemaName</b> ). <br><img src="https://habrastorage.org/webt/fb/wv/jm/fbwvjmsipergemhoi8u1dyf8z3m.png"><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุฏ ุงููุตุฏุฑ ููุนุงูู ูู ุงูุดูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> tbl.oid,inxcls.relname,inxam.amname,inx.indisunique,inx.indisprimary, inx.indkey::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],inx.indoption::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],inxam.amcanorder <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_index inx <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class inxcls <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inx.indexrelid=inxcls.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace inxnsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inxcls.relnamespace=inxnsp.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_am inxam <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inxcls.relam=inxam.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inx.indrelid=tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableOID) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> inxam.amname, inxcls.relname;</code> </pre><br></div></div><br><p style=";text-align:right;direction:rtl">  ูุตู ููุฑุณ ูุงุญุฏ ูู ูุฒูุฌ ูู ุณุฌู ูู <b>pg_class</b> ูุตูู ุจุฃูู ุนูุงูุฉ ูุงุฏูุฉ ูุณุฌู ูู <b>pg_index</b> ูุญุชูู ุนูู ุจูุงูุงุช ุนู ุงูุฎุตุงุฆุต ุงููุญุฏุฏุฉ ููููุฑุณ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุชู ุชุฎุฒูู ุงููุนูููุงุช ุญูู ุทุฑู ุงููุตูู ุฅูู ุงูููุฑุณ ูู ุฏููู ูุธุงู pg_am. </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">CASE inxam.amcanorder WHEN true THEN CASE inx.indoption[inx.No] &amp; 1 WHEN 1 THEN ' DESC' ELSE ' ASC' <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;</code> </pre><br><p style=";text-align:right;direction:rtl">  ุณูุฉ ุชูุฑุฏ ุงูููุฑุณ ( <b>indisunique</b> ) ุ ุฅุดุงุฑุฉ ุฅูู ุฃู ุงูููุฑุณ ุชู ุฅูุดุงุคู ููููุง ููุตู ุงูููุชุงุญ ุงูุฃุณุงุณู (ุบูุฑ <b>ุถุฑูุฑู</b> ) ุ ุจุงูุฅุถุงูุฉ ุฅูู ุตูุงุฆู ุงูุฃุฑูุงู ุงูุชุณูุณููุฉ ูุณูุงุช ุงูุฌุฏูู ุ ุจูุงุกู ุนูู ุงูููู ุงูุชู ูุชู ุงุณุชุฎุฑุงุฌ ุงูููุฑุณ ( <b>indkey</b> ) ูุนูุงูุงุช ุชุฑุชูุจ ูุฑุฒ ููู ุงูุณูุงุช ูู <b>ุฅุฏุฎุงู</b> ููุฑุณ <b>pg_index ุ</b> ูู ุงูููุฑุณ ( <b>indoption</b> ). </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฏุฎู ุงููุชุงููุฌ ุงูุฐู ูุตู ุทุฑููุฉ ุงููุตูู ุฅูู ููุฑุณ <b>pg_am</b> ุ ูุชู <b>ุงุณุชุฎุฑุงุฌ</b> ุณูุฉ ููุงุกูุฉ ุงูุจูุงูุงุช ุงูุชู ุชู ูุฑุฒูุง ุงููุฏุฑุฌุฉ ูู ุงูููุฑุณ ( <b>amcanorder</b> ) ูุงุณู ุฃู ููุน ุทุฑููุฉ ุงููุตูู ุฅูู ุงูููุฑุณ ( <b>amname</b> ). </p><p style=";text-align:right;direction:rtl"></p><p style=";text-align:right;direction:rtl">  ุจูุนูู ุขุฎุฑ ุ ุชุดูุฑ ุงูุณูุฉ amcanorder ุฅูู ูุง ุฅุฐุง ูุงู ูู ุงููููู ุฅูุดุงุก ุชุฑุชูุจ ูุฑุฒ ูููู ุงูุณูุงุช ุงููุถููุฉ ูู ุงูููุฑุณ.  ุฅุฐุง ูุงูุช <b>amcanorder = true</b> ุ ููููู ุชุญุฏูุฏ ุชุฑุชูุจ ุงููุฑุฒ ุ ูุฅูุง ููุง.  ูู ููุณ ุงูุดูู ุ ูููู ูุนูู ููู ุตููู <b>indoption ูุฑุฆููุง</b> - ุฅุฐุง ูุงูุช ุงูุจุชุฉ ุงููููู <b>ููุตูุบุฉ</b> ุงูุซูุงุฆูุฉ ูููููุฉ ุชุญุชูู ุนูู 1B ุ ุซู ูุชู ูุฑุฒ ูููุฉ ุงูุณูุฉ ุงูููุงุจูุฉ ุจุชุฑุชูุจ ุชูุงุฒูู ุ ูุฅูุง - ุจุชุฑุชูุจ ุชุตุงุนุฏู. </p><br><p style=";text-align:right;direction:rtl">  ูุชู ุชูููู ููุงุฆู ุฃุณูุงุก ุงูุณูุงุช ุงููุถููุฉ ูู ุงูููุฑุณ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุนูุงูุงุช ุชุฑุชูุจ ููู ุงูุณูุงุช ุ ุฏุงุฎู ุงูุฏุงูุฉ ุจุงุณุชุฎุฏุงู ุฏูุฑุฉ. </p><br><br>  <strong>ุงูุฌุฏูู 9. ูุชูุฌุฉ ุชูููุฐ ุงููุธููุฉ admtf_Table_Indexes ("public"ุ "Street").</strong> <strong><br></strong> <br><img src="https://habrastorage.org/webt/u0/ft/uz/u0ftuzwae5ew1anmkqwjgvqlrbg.png"><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุณุฎุฉ ุงููุต ูู ุงูุฌุฏูู ูู ุงูุดูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><table width="95" border="1" style=";text-align:right;direction:rtl"><tbody><tr><th width="15">  ุงุณู ุงูููุฑุณ </th><th width="5">  ุงูุทุฑููุฉ </th><th width="5">  ุุุ  ูุฑูุฏ </th><th width="5">  ุุุ  ุงูููุชุงุญ ุงูุฃุณุงุณู </th><th width="20">  ุงูุณูุงุช ูู ุงูููุฑุณ </th></tr><tr><td width="15">  xie1street </td><td width="5">  btree </td><td width="5">  ู </td><td width="5">  ู </td><td width="20">  wcrccode ASC ู localityid ASC ู streettypeacrm ASC ู streetname ASC </td></tr><tr><td width="15">  xie2stree </td><td width="5">  btree </td><td width="5">  ู </td><td width="5">  ู </td><td width="20">  wcrccode ASC ู localityid ASC ู streetname ASC </td></tr><tr><td width="15">  xie3street </td><td width="5">  btree </td><td width="5">  ู </td><td width="5">  ู </td><td width="20">  ุงุณู ุงูุดุงุฑุน ASC </td></tr><tr><td width="15">  xie9street </td><td width="5">  btree </td><td width="5">  ู </td><td width="5">  ู </td><td width="20">  wcrccode ASC ู localityid ASC ู streetname DESC </td></tr><tr><td width="15">  xpkstreet </td><td width="5">  btree </td><td width="5">  ุฑ </td><td width="5">  ุฑ </td><td width="20">  wcrccode ASC ู localityid ASC ู streetid ASC </td></tr><tr><td width="15">  xts1street </td><td width="5">  ุงูุฌู </td><td width="5">  ู </td><td width="5">  ู </td><td width="20">  ุณุชุฑูุชุณูููุชูุฑ </td></tr><tr><td width="15">  xts2street </td><td width="5">  ุงูุฌู </td><td width="5">  ู </td><td width="5">  ู </td><td width="5">  ุณุชุฑูุชุณูููุชูุฑ </td></tr></tbody></table><br></div></div><br><h4 style=";text-align:right;direction:rtl">  ุฅุตุฏุงุฑ ุจุฏูู ูุคุดุฑ </h4><br><p style=";text-align:right;direction:rtl">  ููุฌ ุฅูุดุงุก ูุณุฎุฉ ูู ุฏุงูุฉ ุจุฏูู ูุคุดุฑ ูู ุจุงูุถุจุท ููุณ ูุง ูู ููุถุญ ูู ุงููุณู ุงูุณุงุจู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุณุชูุณุงุฎ ุงูุณุฌูุงุช ุจุงุณุชุฎุฏุงู ุชูููุฏ_ุงูุงุดุชุฑุงูุงุช ุ </li><li style=";text-align:right;direction:rtl">  ุชุฌููุน ุงูุณุฌูุงุช ุงููุงุญูุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุงุฆูุฉ ุจุณูุงุช ุงูููุฑุณ ุจุงุณุชุฎุฏุงู ุงูุฏุงูุฉ STRING_AGG ูุน ุฎูุงุฑ ORDER BY. </li></ul><br><img src="https://habrastorage.org/webt/7f/3y/bm/7f3ybmq5e8bd7auydle70utg8-k.png"><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุฏ ุงููุตุฏุฑ ููุนุงูู ูู ุงูุดูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> inxcls.relname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_IndexName ,inxam.amname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_IndexType, inx.indisunique <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_isUnique,inx.indisprimary <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> r_isPrimary, STRING_AGG(attr.attname|| <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> inxam.amcanorder <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> inx.indoption[inx.No] &amp; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">' DESC'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">' ASC'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>, c_Delimiter <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> inx.No) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> i.indrelid, i.indexrelid,i.indisunique,i.indisprimary, i.indkey::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],i.indoption::<span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[], generate_subscripts(i.indkey, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_index i) inx <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class inxcls <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inx.indexrelid=inxcls.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_am inxam <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inxcls.relam=inxam.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> inx.indrelid=tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_attribute <span class="hljs-keyword"><span class="hljs-keyword">attr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> attr.attrelid=tbl.OID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> attr.attnum=inx.indkey[inx.No] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableName) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> inxcls.relname,inxam.amname,inx.indisunique,inx.indisprimary <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> inxcls.relname;</code> </pre><br></div></div><br><br><p style=";text-align:right;direction:rtl">  ุชุฒุงูู ููุช ุชูููุฐ ููุง ุงูุฅุตุฏุงุฑูู ูู ุงูุฏุงูุงุช ุ ูุงุณุชุบุฑู ุงูุฃูุฑ 20 ูููู ุซุงููุฉ ูุฅุฎุฑุงุฌ ุงูุจูุงูุงุช ูู ุฌุฏูู ุงููุชุงุฆุฌ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูู ุฃูุชุฌ ุจุนุฏ ุงูุขู ุฅุตุฏุงุฑุงุช ุฏุงูุฉ ุ ูุซู  ุจุงููุณุจุฉ ูุฃููุฆู ุงูุฐูู ูุฑุบุจูู ูู ุฅุนุงุฏุฉ ุชุดููููุง ููุง ูุญูู ููู ุฃู <b>ุงูุงุชุตุงู ุจู ุ ุณุฃุฑุณู ูุณุฎุฉ ูุนุฏูุฉ ูุฌุงููุง</b> . </p><p style=";text-align:right;direction:rtl">  <b>ุงูุธุฑ ุฃูุถูุง</b> ุงูุฃุฌุฒุงุก <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃููู</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุซุงูุซุฉ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุฑุงุจุนุฉ</a> ูู ุงูููุงูุฉ. </p><br><a name="Script2"></a><br><h2 style=";text-align:right;direction:rtl">  ุงูููุญู 1. ุงููุตูุต </h2><br><a name="tfTableC"></a><br><h3 style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุธููุฉ admtf_Table_Constraintes </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู ุงูุนุซูุฑ ุนูู ุงูุชุนูููุงุช ุนูู ุฑูุฒ ูุตุฏุฑ ุงููุธููุฉ ููุง.</a> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฑูุฒ ูุตุฏุฑ ุงููุธููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Constraintes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Constraintes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_ConstraintName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_ConstraintType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_ConstraintKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>,r_RefTableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_RefTableKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>,r_ConstraintSource <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_Scale <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_ConstraintRec RECORD; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TableOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_ConstraintOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_ConstraintKeyNos SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> v_ConstraintName name; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_ConstraintType name; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_isUnique BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_isPrimary BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">/*      Primary KEY */</span></span> v_AttributeNum INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_AttributeName name; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_ConstraintKeyNames TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_RefTableOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID ,     */</span></span> v_RefTableName name;<span class="hljs-comment"><span class="hljs-comment">/*  ,     */</span></span> v_RefTableKeyNos SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> v_RefTableKeyNames TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     ,    */</span></span> v_ConstraintSource TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     CHECK*/</span></span> c_Delimiter CONSTANT VARCHAR(2):=','; <span class="hljs-comment"><span class="hljs-comment">--****************************************************************************************************** BEGIN FOR v_ConstraintRec IN SELECT con.oid AS ConstraintOID ,tbl.OID AS TableOID, con.conname AS ConstraintName, con.contype AS ConstraintType, con.conkey AS ConstraintKeyNos, reftbl.OID AS RefTableOID, reftbl.relname AS RefTableName, con.confkey AS RefTableKeyNos, con.consrc AS ConstraintSource FROM pg_constraint con INNER JOIN pg_class tbl ON con.conrelid=tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid LEFT OUTER JOIN pg_class reftbl ON con.confrelid=reftbl.oid WHERE LOWER(nsp.nspname)=LOWER(a_SchemaName) AND LOWER(tbl.relname)=LOWER(a_TableName) ORDER BY con.contype DESC,con.conname LOOP v_ConstraintOID:=v_ConstraintRec.ConstraintOID; v_TableOID:=v_ConstraintRec.TableOID; v_ConstraintName:=v_ConstraintRec.ConstraintName; v_ConstraintType:=v_ConstraintRec.ConstraintType; v_ConstraintKeyNos:=v_ConstraintRec.ConstraintKeyNos; v_RefTableOID:=v_ConstraintRec.RefTableOID; v_RefTableName:=v_ConstraintRec.RefTableName; v_RefTableKeyNos:=v_ConstraintRec.RefTableKeyNos; v_ConstraintSource:=v_ConstraintRec.ConstraintSource; v_ConstraintKeyNames:=''; FOREACH v_AttributeNum IN ARRAY v_ConstraintKeyNos LOOP SELECT INTO v_AttributeName attr.attname::VARCHAR(100) AS r_AttributeName FROM pg_attribute attr WHERE attr.attrelid=v_TableOID AND attr.attnum=v_AttributeNum; v_ConstraintKeyNames:=v_ConstraintKeyNames|| CASE WHEN v_ConstraintKeyNames='' THEN '' ELSE c_Delimiter END ||v_AttributeName; END LOOP; v_RefTableKeyNames:=''; IF v_RefTableKeyNos IS NOT NULL THEN FOREACH v_AttributeNum IN ARRAY v_RefTableKeyNos LOOP SELECT INTO v_AttributeName attr.attname::VARCHAR(100) AS r_AttributeName FROM pg_attribute attr WHERE attr.attrelid=v_RefTableOID AND attr.attnum=v_AttributeNum; v_RefTableKeyNames:=v_RefTableKeyNames|| CASE WHEN v_RefTableKeyNames='' THEN '' ELSE c_Delimiter END ||v_AttributeName; END LOOP; END IF; RETURN QUERY SELECT v_ConstraintName,v_ConstraintType,v_ConstraintKeyNames, v_RefTableName,v_RefTableKeyNames, v_ConstraintSource; END LOOP; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Constraintes(a_SchemaName NAME, a_TableName NAME) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Constraintes (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /********************************************************************************************************/ /*      */ /********************************************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Constraintes (a_SchemaName VARCHAR(256) default 'public', /*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_ConstraintName VARCHAR(256),r_ConstraintType VARCHAR(256),r_ConstraintKeyNames Text,r_RefTableName VARCHAR(256),r_RefTableKeyNames Text,r_ConstraintSource Text) AS $BODY$ DECLARE --****************************************************************************************************** BEGIN RETURN QUERY SELECT tc.r_ConstraintName::VARCHAR(256), tc.r_ConstraintType::VARCHAR(256),tc.r_ConstraintKeyNames::TEXT, tc.r_RefTableName::VARCHAR(256),tc.r_RefTableKeyNames::TEXT, tc.r_ConstraintSource::TEXT FROM admtf_Table_Constraintes(a_SchemaName::NAME,a_TableName::NAME) tc; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Constraintes(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Constraintes('public'::VARCHAR(256),'Street'::VARCHAR(256)); SELECT * FROM admtf_Table_Constraintes('public'::name,'Street'::name);</span></span></code> </pre><br></div></div><br><a name="tfTableC_woc"></a><br><h3 style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุณุฎุฉ ูู admtf_Table_Constraintes ุจุฏูู ูุคุดุฑ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู ุงูุนุซูุฑ ุนูู ุงูุชุนูููุงุช ุนูู ุฑูุฒ ูุตุฏุฑ ุงููุธููุฉ ููุง.</a> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฑูุฒ ูุตุฏุฑ ุงููุธููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Constraintes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Constraintes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_ConstraintName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_ConstraintType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_ConstraintKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>,r_RefTableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_RefTableKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>,r_ConstraintSource <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_Scale <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_ConstraintRec RECORD; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TableOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_ConstraintOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_ConstraintKeyNos SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> v_ConstraintName name; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_ConstraintType name; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_isUnique BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_isPrimary BOOLEAN;<span class="hljs-comment"><span class="hljs-comment">/*      Primary KEY */</span></span> v_AttributeNum INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_AttributeName name; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_ConstraintKeyNames TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_RefTableOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID ,     */</span></span> v_RefTableName name;<span class="hljs-comment"><span class="hljs-comment">/*  ,     */</span></span> v_RefTableKeyNos SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> v_RefTableKeyNames TEXT;<span class="hljs-comment"><span class="hljs-comment">/*     ,    */</span></span> v_ConstraintSource TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     CHECK*/</span></span> c_Delimiter CONSTANT VARCHAR(2):=','; <span class="hljs-comment"><span class="hljs-comment">--****************************************************************************************************** BEGIN FOR v_ConstraintRec IN SELECT con.oid AS ConstraintOID , tbl.OID AS TableOID, con.conname AS ConstraintName, con.contype AS ConstraintType, con.conkey AS ConstraintKeyNos, reftbl.OID AS RefTableOID, reftbl.relname AS RefTableName, con.confkey AS RefTableKeyNos, con.consrc AS ConstraintSource FROM pg_constraint con INNER JOIN pg_class tbl ON con.conrelid=tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid LEFT OUTER JOIN pg_class reftbl ON con.confrelid=reftbl.oid WHERE LOWER(nsp.nspname)=LOWER(a_SchemaName) AND LOWER(tbl.relname)=LOWER(a_TableName) ORDER BY con.contype DESC,con.conname LOOP v_ConstraintOID:=v_ConstraintRec.ConstraintOID; v_TableOID:=v_ConstraintRec.TableOID; v_ConstraintName:=v_ConstraintRec.ConstraintName; v_ConstraintType:=v_ConstraintRec.ConstraintType; v_ConstraintKeyNos:=v_ConstraintRec.ConstraintKeyNos; v_RefTableOID:=v_ConstraintRec.RefTableOID; v_RefTableName:=v_ConstraintRec.RefTableName; v_RefTableKeyNos:=v_ConstraintRec.RefTableKeyNos; v_ConstraintSource:=v_ConstraintRec.ConstraintSource; v_ConstraintKeyNames:=''; FOREACH v_AttributeNum IN ARRAY v_ConstraintKeyNos LOOP SELECT INTO v_AttributeName attr.attname::VARCHAR(100) AS r_AttributeName FROM pg_attribute attr WHERE attr.attrelid=v_TableOID AND attr.attnum=v_AttributeNum; v_ConstraintKeyNames:=v_ConstraintKeyNames|| CASE WHEN v_ConstraintKeyNames='' THEN '' ELSE c_Delimiter END ||v_AttributeName; END LOOP; v_RefTableKeyNames:=''; IF v_RefTableKeyNos IS NOT NULL THEN FOREACH v_AttributeNum IN ARRAY v_RefTableKeyNos LOOP SELECT INTO v_AttributeName attr.attname::VARCHAR(100) AS r_AttributeName FROM pg_attribute attr WHERE attr.attrelid=v_RefTableOID AND attr.attnum=v_AttributeNum; v_RefTableKeyNames:=v_RefTableKeyNames|| CASE WHEN v_RefTableKeyNames='' THEN '' ELSE c_Delimiter END ||v_AttributeName; END LOOP; END IF; RETURN QUERY SELECT v_ConstraintName,v_ConstraintType,v_ConstraintKeyNames, v_RefTableName,v_RefTableKeyNames, v_ConstraintSource; END LOOP; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Constraintes(a_SchemaName NAME, a_TableName NAME) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Constraintes (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /********************************************************************************************************/ /*      */ /********************************************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Constraintes (a_SchemaName VARCHAR(256) default 'public', /*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_ConstraintName VARCHAR(256),r_ConstraintType VARCHAR(256),r_ConstraintKeyNames Text,r_RefTableName VARCHAR(256),r_RefTableKeyNames Text,r_ConstraintSource Text) AS $BODY$ DECLARE --****************************************************************************************************** BEGIN RETURN QUERY SELECT tc.r_ConstraintName::VARCHAR(256), tc.r_ConstraintType::VARCHAR(256), tc.r_ConstraintKeyNames::TEXT, tc.r_RefTableName::VARCHAR(256), tc.r_RefTableKeyNames::TEXT, tc.r_ConstraintSource::TEXT FROM admtf_Table_Constraintes(a_SchemaName::NAME,a_TableName::NAME) tc; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Constraintes(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Constraintes('public'::VARCHAR(256),'Street'::VARCHAR(256)); SELECT * FROM admtf_Table_Constraintes('public'::name,'Street'::name);</span></span></code> </pre><br></div></div><br><a name="tfTableI"></a><br><h3 style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุฏุงูุฉ admtf_Table_Indexes </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู ุงูุนุซูุฑ ุนูู ุงูุชุนูููุงุช ุนูู ุฑูุฒ ูุตุฏุฑ ุงููุธููุฉ ููุง.</a> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฑูุฒ ูุตุฏุฑ ุงููุธููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Indexes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Indexes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_IndexName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_IndexType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_isUnique <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,r_isPrimary <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>, r_IndexKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_IndexKind <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>:=<span class="hljs-string"><span class="hljs-string">'i'</span></span>; v_IndexRec RECORD; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_Scale INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TableOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_IndexOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_IndexKeyNos SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> v_IndexName NAME; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_IndexAMName NAME; <span class="hljs-comment"><span class="hljs-comment">/*    ( ) */</span></span> v_isUnique BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_isPrimary BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">/*      Primary KEY */</span></span> v_AttributeNum INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_AttributeName NAME; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_IndexKeyNames TEXT; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> c_Delimiter CONSTANT VARCHAR(2):=','; <span class="hljs-comment"><span class="hljs-comment">--****************************************************************************************************** BEGIN FOR v_IndexRec IN SELECT inxcls.oid AS IndexOID,tbl.oid AS TableOID, inxcls.relname AS IndexName,inxam.amname AS IndexAMName, inx.indisunique AS isUnique,inx.indisprimary isPrimary, inx.indkey::SMALLINT[] AS IndexKeyNos FROM pg_index inx INNER JOIN pg_class inxcls ON inx.indexrelid=inxcls.oid INNER JOIN pg_am inxam ON inxcls.relam=inxam.oid INNER JOIN pg_class tbl ON inx.indrelid=tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid WHERE LOWER(nsp.nspname)=LOWER(a_SchemaName) AND inxcls.relkind=c_IndexKind AND tbl.relname=LOWER(a_TableName) ORDER BY inxam.amname, inxcls.relname LOOP v_IndexOID:=v_IndexRec.IndexOID; v_TableOID:=v_IndexRec.TableOID; v_IndexName:=v_IndexRec.IndexName; v_IndexAMName:=v_IndexRec.IndexAMName; v_isUnique:=v_IndexRec.isUnique; v_isPrimary:=v_IndexRec.isPrimary; v_IndexKeyNos:=v_IndexRec.IndexKeyNos; v_IndexKeyNames:=''; FOREACH v_AttributeNum IN ARRAY v_IndexKeyNos LOOP SELECT INTO v_AttributeName attr.attname::VARCHAR(100) AS r_AttributeName FROM pg_attribute attr WHERE attr.attrelid=v_TableOID AND attr.attnum=v_AttributeNum; v_IndexKeyNames:=v_IndexKeyNames|| CASE WHEN v_IndexKeyNames='' THEN '' ELSE c_Delimiter||' ' END || v_AttributeName; END LOOP; RETURN QUERY SELECT v_IndexName,v_IndexAMName,v_isUnique, v_isPrimary,v_IndexKeyNames; END LOOP; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Indexes(a_SchemaName NAME, a_TableName NAME) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Indexes (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /********************************************************************************************************/ /*      */ /********************************************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Indexes (a_SchemaName VARCHAR(256) default 'public', /*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_IndexName VARCHAR(256),r_IndexType VARCHAR(256),r_isUnique BOOLEAN,r_isPrimary BOOLEAN, r_IndexKeyNames TEXT) AS $BODY$ DECLARE --****************************************************************************************************** BEGIN RETURN QUERY SELECT ti.r_IndexName::VARCHAR(256), ti.r_IndexType::VARCHAR(256), ti.r_isUnique::BOOLEAN, ti.r_isPrimary::BOOLEAN, ti.r_IndexKeyNames::TEXT FROM admtf_Table_Indexes(a_SchemaName::NAME,a_TableName::NAME) ti; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Indexes(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Indexes('public'::NAME,'Street'::NAME); SELECT * FROM admtf_Table_Indexes('public'::VARCHAR(256),'Street'::VARCHAR(256));</span></span></code> </pre><br></div></div><br><a name="tfTableI_woc"></a><br><h3 style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุณุฎุฉ ูู admtf_Table_Indexes ุจุฏูู ูุคุดุฑ </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">       .</a> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title">  </b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Indexes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/********************************************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Indexes (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_IndexName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_IndexType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_isUnique <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,r_isPrimary <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>, r_IndexKeyNames <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_IndexKind <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>:=<span class="hljs-string"><span class="hljs-string">'i'</span></span>; c_Delimiter CONSTANT VARCHAR(2):=', '; <span class="hljs-comment"><span class="hljs-comment">--****************************************************************************************************** BEGIN RETURN QUERY SELECT inxcls.relname AS r_IndexName, inxam.amname AS r_IndexType, inx.indisunique AS r_isUnique, inx.indisprimary r_isPrimary, STRING_AGG(attr.attname||CASE inxam.amcanorder WHEN true THEN CASE inx.indoption[inx.No] &amp; 1 WHEN 1 THEN ' DESC' ELSE ' ASC' END ELSE '' END, c_Delimiter ORDER BY inx.No) FROM (SELECT i.indrelid, i.indexrelid,i.indisunique, i.indisprimary,i.indkey::SMALLINT[], i.indoption::SMALLINT[], generate_subscripts(i.indkey, 1) as No FROM pg_index i) inx INNER JOIN pg_class inxcls ON inx.indexrelid=inxcls.oid INNER JOIN pg_am inxam ON inxcls.relam=inxam.oid INNER JOIN pg_class tbl ON inx.indrelid=tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid INNER JOIN pg_attribute attr ON attr.attrelid=tbl.OID AND attr.attnum=inx.indkey[inx.No] WHERE LOWER(nsp.nspname)=LOWER(a_SchemaName) AND inxcls.relkind=c_IndexKind AND tbl.relname=LOWER(a_TableName) GROUP BY inxcls.relname,inxam.amname,inx.indisunique,inx.indisprimary ORDER BY inxcls.relname; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Indexes(a_SchemaName NAME, a_TableName NAME) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Indexes (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /********************************************************************************************************/ /*      */ /********************************************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Indexes (a_SchemaName VARCHAR(256) default 'public', /*    */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_IndexName VARCHAR(256),r_IndexType VARCHAR(256),r_isUnique BOOLEAN,r_isPrimary BOOLEAN, r_IndexKeyNames TEXT) AS $BODY$ DECLARE --****************************************************************************************************** BEGIN RETURN QUERY SELECT ti.r_IndexName::VARCHAR(256), ti.r_IndexType::VARCHAR(256), ti.r_isUnique::BOOLEAN, ti.r_isPrimary::BOOLEAN, ti.r_IndexKeyNames::TEXT FROM admtf_Table_Indexes(a_SchemaName::NAME,a_TableName::NAME) ti; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Indexes(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Indexes('public'::NAME,'Street'::NAME); SELECT * FROM admtf_Table_Indexes('public'::VARCHAR(256),'Street'::VARCHAR(256));</span></span></code> </pre><br></div></div><br><h3 style=";text-align:right;direction:rtl">  ุงูุธุฑ ุฃูุถูุง </h3><br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">     PostgreSQL.  </a> ;</b> <br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">     PostgreSQL.  </a> .</b> <br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">     PostgreSQL. ( )</a> .</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar415897/">https://habr.com/ru/post/ar415897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar415881/index.html">ููู ูุนูู JS: ุชูููุฉ Shadow DOM ูููููุงุช ุงูููุจ</a></li>
<li><a href="../ar415887/index.html">ูุง ูู ููุน ุงูุฑูุจูุชุงุช ุงูุนููุจูุชูุฉ ุงูุชู ุชุทูุฑ ููู ุงูููุงุนุจ ูุชุทูู ุงููุงุฑ ุนูู ูุฑุฉ ุงููุฏู. ููุงุจูุฉ ูุน ููุดุฆ Robycam</a></li>
<li><a href="../ar415891/index.html">ูุง ูู ุฃูุนุงุจ ุชุชูุฉ ุจุงุฑุฏุฉุ</a></li>
<li><a href="../ar415893/index.html">ููููุฉ ุฌุนู ุนูููุงุช Java ุชุนูู ุนูู Linux / Docker ุจุณูุทุฉ ููุจุงุดุฑุฉ</a></li>
<li><a href="../ar415895/index.html">ุฃูู ููุท ูู ุงูุจุฑูุฌุฉ</a></li>
<li><a href="../ar415899/index.html">ุนุซุฑ Office 365 Outlook ุนูู ูุงุฌูุงุช ุจุฑูุฌุฉ ุชุทุจููุงุช ุบูุฑ ููุซูุฉ ูุน ุณุฌูุงุช ูุดุงุท ุงููุณุชุฎุฏู ุงูุชูุตูููุฉ</a></li>
<li><a href="../ar415901/index.html">ุฏุนูุช ูุฌูุฉ ูุฌูุณ ุงูุงุชุญุงุฏ ููุฑุฉ ุฅูุดุงุก ูุงุนุฏุฉ IMEI ูุฌููุน ุงูููุงุชู ุงูุจูุถุงุก</a></li>
<li><a href="../ar415903/index.html">ูุฑุญุจูุง ุจูู ูู ููุงุก DIYorDIE ุงูุตููู ูู 7 ููููู</a></li>
<li><a href="../ar415905/index.html">ููููุฉ ุฒุฑุงุนุฉ ููุชุฌ ุตุญู (ูุซุงู ุฌููู)</a></li>
<li><a href="../ar415907/index.html">ููููุฉ ูุตู ุงูููุธููู ุฏูู ุงููุฎุงุทุฑุฉ ุจุตูุฑุฉ ุงูุดุฑูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>