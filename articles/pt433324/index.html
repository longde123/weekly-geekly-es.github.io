<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüöí üë®üèæ‚Äçüé§ üÄÑÔ∏è Coletando o pacote de sonhos com o Webpack üëéüèæ üë©üèø‚Äç‚öñÔ∏è üåí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aplicativos JS, sites e outros recursos est√£o se tornando mais complexos e as ferramentas de constru√ß√£o s√£o a realidade do desenvolvimento da web. Os ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Coletando o pacote de sonhos com o Webpack</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/433324/">  Aplicativos JS, sites e outros recursos est√£o se tornando mais complexos e as ferramentas de constru√ß√£o s√£o a realidade do desenvolvimento da web.  Os empacotadores ajudam a empacotar, compilar e organizar bibliotecas.  Uma das ferramentas de c√≥digo aberto poderosas e flex√≠veis que podem ser perfeitamente personalizadas para criar o aplicativo cliente √© o Webpack. <br><br>  Maxim <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Sosnov</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">crazymax11</a> ) - O l√≠der de front-end no N1.RU introduziu o Webpack em v√°rios projetos grandes que anteriormente tinham sua pr√≥pria cria√ß√£o personalizada e contribuiu com v√°rios projetos.  Maxim sabe como criar um pacote de sonhos com o Webpack, faz√™-lo rapidamente e configur√°-lo para que a configura√ß√£o permane√ßa limpa, mantida e modular. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/4ClK_0fxsVM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  A interpreta√ß√£o √© diferente do relat√≥rio - √© uma vers√£o bastante aprimorada dos links de prof.  Ao longo da transcri√ß√£o, os ovos de P√°scoa s√£o espalhados em artigos, plugins, minifiers, op√ß√µes, transpilers e provas das palavras do orador, links para os quais simplesmente n√£o podem ser colocados em um discurso.  Se voc√™ coletar tudo, o n√≠vel de b√¥nus no Webpack ser√° aberto :-) <br><a name="habracut"></a><br><h2>  Integra√ß√£o do Webpack em um projeto t√≠pico </h2><br>  Geralmente, o procedimento de implementa√ß√£o √© o seguinte: o desenvolvedor, em algum lugar, l√™ um artigo sobre o Webpack, decide conect√°-lo, come√ßa a constru√≠-lo, de alguma forma funciona, tudo come√ßa e por algum tempo o webpack-config funciona - por seis meses, um ano, dois.  Localmente, est√° tudo bem - o sol, o arco-√≠ris e as borboletas.  E ent√£o usu√°rios reais v√™m: <br><br>  <em>- Em dispositivos m√≥veis, seu site n√£o carrega.</em> <em><br></em>  <em>- Tudo funciona para n√≥s.</em>  <em>Localmente, est√° tudo bem!</em> <br><br>  Por precau√ß√£o, o desenvolvedor analisa tudo e v√™ que, para dispositivos m√≥veis, o <strong>pacote pesa 7 MB e leva 30 segundos para carregar</strong> .  Isso n√£o combina com ningu√©m e o desenvolvedor come√ßa a procurar como resolver o problema - ele pode conectar um carregador ou encontrar um plug-in m√°gico que resolver√° todos os problemas.  Milagrosamente, esse plug-in est√° localizado.  Nosso desenvolvedor acessa o webpack-config, tenta instalar, mas a linha de c√≥digo interfere: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'production'</span></span>) { config.module.rules[<span class="hljs-number"><span class="hljs-number">7</span></span>].options.magic = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  A linha √© traduzida da seguinte forma: "Se a configura√ß√£o estiver sendo montada para produ√ß√£o, siga a s√©tima regra e coloque a op√ß√£o <code>magic = true</code> ".  O desenvolvedor n√£o sabe o que fazer com isso e como resolv√™-lo.  Esta √© uma situa√ß√£o em que voc√™ precisa de um pacote de sonhos. <br><br><h2>  Como coletar um pacote de sonhos? </h2><br>  Primeiro, vamos definir o que √©.  Primeiro de tudo, o pacote dos sonhos tem duas caracter√≠sticas principais: <br><br><ul><li>  <strong>Pesa um pouco</strong> .  Quanto menor o peso - mais r√°pido o usu√°rio obter√° um aplicativo funcional.  Voc√™ n√£o deseja que seu site seja aberto por 15 segundos. </li><li>  O usu√°rio <strong>baixa apenas o que precisa ser</strong> baixado para exibir a p√°gina atual do site, e n√£o mais um byte! </li></ul><br>  E para reduzir o tamanho do pacote configur√°vel, voc√™ deve primeiro avaliar seu tamanho. <br><br><h3>  Avaliar tamanho do pacote </h3><br>  A solu√ß√£o mais popular √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug-</a> in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WebpackBundleAnalyzer</a> .  Ele coleta estat√≠sticas de cria√ß√£o de aplicativos e renderiza uma p√°gina interativa onde voc√™ pode ver a localiza√ß√£o e o peso de cada m√≥dulo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/27a/803/6b9/27a8036b994a09b7371c567b6df6cd82.png" alt="imagem"><br><br>  Se isso n√£o for suficiente, voc√™ pode criar um <strong>gr√°fico de depend√™ncia</strong> usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">outro plug-in</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c3/900/24a/7c390024a9d902ca99e3d00c0d8081b3.png" alt="imagem"><br><br>  Ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um gr√°fico de pizza</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/350/14a/ec4/35014aec45623d06972bca310b3f8edf.png" alt="imagem"><br><br>  Se isso n√£o for suficiente, e voc√™ quiser vender o Webpack para profissionais de marketing, poder√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">criar um universo inteiro em</a> que cada ponto seja um m√≥dulo, como uma estrela no Universo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45b/a6e/2d2/45ba6e2d2daff144c69df2a43e8ef53a.png" alt="imagem"><br><br>  Existem muitas ferramentas que avaliam o tamanho do pacote e o monitoram.  H√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uma op√ß√£o na configura√ß√£o do Webpack</a> que trava a montagem se o pacote pesar muito, por exemplo.  Existe um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug-in duplicado-pacote-verificador-webpack-plugin</a> que impedir√° a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cria√ß√£o de um</a> pacote se voc√™ tiver pacotes de 2 npm de vers√µes diferentes, por exemplo, Lodash 4.15 e Lodash 4.14. <br><br><h3>  Como reduzir o pacote </h3><br><ul><li>  O mais √≥bvio √© conectar o <strong>UglifyJS</strong> para <strong>reduzir</strong> o JavaScript. </li><li>  Use <strong>carregadores e plug-ins especiais</strong> que compactam e otimizam um recurso espec√≠fico.  Por exemplo, <strong>css-nano</strong> para css ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SVGO</a> , que otimiza o SVG. </li><li>  Compacte todos os arquivos diretamente no Webpack atrav√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plugins gzip / brotli</a> . </li><li>  Outras ferramentas </li></ul><br>  Agora vamos entender como jogar o excesso do pacote. <br><br><h3>  Jogue fora o excesso </h3><br>  Considere isso em um exemplo popular com <strong>moment.js</strong> : <code>import moment from 'moment'</code> .  Se voc√™ pegar um aplicativo vazio, importe moment.js e <strong>ReactDOM</strong> para ele e passe-o pelo <strong>WebpackBundleAnalyzer</strong> , voc√™ ver√° a seguinte imagem. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/105/e0f/833/105e0f8334a83c529077c693fda3d3de.png" alt="imagem"><br><br>  Acontece que quando voc√™ adiciona um dia, uma hora a uma data ou apenas deseja colocar o link "em 15 minutos" usando moment.js, voc√™ conecta <strong>230 Kbytes de c√≥digo</strong> !  Por que isso est√° acontecendo e como √© resolvido? <br><br><h4>  Carregamento de local no momento </h4><br>  H√° uma fun√ß√£o no momento.js que define os c√≥digos de idioma: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLocale</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">locale</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> localePath = <span class="hljs-string"><span class="hljs-string">'locale/'</span></span> + locale + <span class="hljs-string"><span class="hljs-string">'.js'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._currentLocale = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(localePath); }</code> </pre><br>  Pode ser visto a partir do c√≥digo que o c√≥digo do idioma √© carregado ao longo do caminho din√¢mico, ou seja,  calculado em tempo de execu√ß√£o.  O Webpack age de maneira inteligente e tenta garantir que seu pacote n√£o trava durante a execu√ß√£o do c√≥digo: ele encontra todos os locais poss√≠veis no projeto e os agrupa.  Portanto, o aplicativo pesa muito. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a03/4cc/b3f/a034ccb3fc36dd03b916b0bc28acb057.png" alt="imagem"><br><br>  A solu√ß√£o √© muito simples - pegamos um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">in padr√£o</a> do Webpack e dizemos: "Se voc√™ v√™ que algu√©m quer fazer o download de muitos locais, porque n√£o pode determinar qual deles, basta usar o russo!" <br><br><img src="https://habrastorage.org/getpro/habr/post_images/587/fe6/e38/587fe6e38333e8b482fed615e3c00ee1.png" alt="imagem"><br><br>  O Webpack aceita apenas o russo e o WebpackBundleAnalyzer mostra 54 Kb, o que j√° √© 200 Kb mais f√°cil. <br><br><h3>  Elimina√ß√£o de c√≥digo morto </h3><br>  A pr√≥xima otimiza√ß√£o que nos interessa √© a <strong>elimina√ß√£o do c√≥digo morto</strong> .  Considere o seguinte c√≥digo. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cond = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cond) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; someFunction(<span class="hljs-number"><span class="hljs-number">42</span></span>);</code> </pre><br>  A maioria das linhas desse c√≥digo n√£o √© necess√°ria no pacote final - o bloco com a condi√ß√£o n√£o ser√° executado, a fun√ß√£o ap√≥s o retorno tamb√©m.  Tudo que voc√™ precisa √© <code>return true</code> .  √â exatamente isso que a elimina√ß√£o do c√≥digo morto √©: a ferramenta de constru√ß√£o detecta o c√≥digo que n√£o pode ser executado e o corta.  H√° um recurso interessante que o UglifyJS pode fazer isso. <br><br>  Agora vamos para a mais avan√ßada elimina√ß√£o de c√≥digo morto - <strong>m√©todo de agita√ß√£o de √°rvore</strong> . <br><br><h3>  √Årvore tremendo </h3><br>  Digamos que temos um aplicativo que usa o <strong>Lodash</strong> .  Duvido muito que algu√©m esteja usando o Lodash inteiro.  Provavelmente, v√°rias fun√ß√µes como <strong>get</strong> , <strong>IsEmpty</strong> , <strong>unionBy</strong> ou similares s√£o <strong>exploradas</strong> . <br><br>  Quando fazemos o tremor em √°rvore, queremos que o Webpack ‚Äúagite‚Äù os m√≥dulos desnecess√°rios e jogue-os fora, e s√≥ temos os necess√°rios.  Esta √© a √°rvore tremendo. <br><br><h4>  Como o tremido de √°rvore funciona no Webpack </h4><br>  Digamos que voc√™ tenha um c√≥digo como este: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { a } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./a.js'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(a);</code> </pre><br>  O c√≥digo √© muito simples: de algum m√≥dulo, importe a vari√°vel a e fa√ßa a sa√≠da.  Mas existem duas vari√°veis ‚Äã‚Äãneste m√≥dulo: <strong>a</strong> e <strong>b</strong> .  N√£o precisamos da vari√°vel <b>be</b> queremos remov√™-la. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> b = <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre><br>  Quando o Webpack chega, ele converte o c√≥digo de importa√ß√£o para isso: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(d[<span class="hljs-string"><span class="hljs-string">"a"</span></span>]);</code> </pre><br>  Nossa <code>import</code> transformou em <code>require</code> , mas o <code>console.log</code> n√£o mudou. <br><br>  A depend√™ncia do Webpack √© convertida no seguinte c√≥digo: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports[<span class="hljs-string"><span class="hljs-string">"a¬´] = a; /* unused harmony export b */ var b = 4;</span></span></code> </pre><br><br>  O Webpack saiu da exporta√ß√£o da vari√°vel <b>a</b> e removeu a exporta√ß√£o da vari√°vel <b>b</b> , mas deixou a pr√≥pria vari√°vel, marcando-a com um coment√°rio especial.  No c√≥digo convertido, a vari√°vel <b>b</b> n√£o <b>√©</b> usada e o UglifyJS pode exclu√≠-la. <br><br><blockquote>  A agita√ß√£o da √°rvore do Webpack funciona apenas se voc√™ tiver algum tipo de minificador de c√≥digo, como UglifyJS ou <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">babel-minify</a></b> . </blockquote><br>  Vamos considerar casos mais interessantes - quando o tremor em √°rvore n√£o funciona. <br><br><h4>  Quando Tree Shaking n√£o funciona </h4><br>  Caso n¬∫ 1. Voc√™ escreve o c√≥digo: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.a = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.b = <span class="hljs-number"><span class="hljs-number">4</span></span>;</code> </pre><br>  Execute o c√≥digo no Webpack e ele permanece o mesmo.  Isso ocorre porque o bundler organiza a agita√ß√£o da √°rvore somente se voc√™ usar os m√≥dulos ES6.  Se voc√™ usar os m√≥dulos CommonJS, o Tree shake n√£o funcionar√°. <br><br>  Caso No. 2. Voc√™ escreve c√≥digo com m√≥dulos ES6 e nomeou exporta√ß√µes. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> b = <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre><br>  Se o seu c√≥digo for executado atrav√©s do Babel e voc√™ n√£o definiu a op√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√≥dulos como false</a> , o Babel levar√° seus m√≥dulos para o CommonJS e o Webpack n√£o poder√° executar novamente o agita√ß√£o da √°rvore, porque ele funciona apenas com os m√≥dulos ES6. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.a = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.b = <span class="hljs-number"><span class="hljs-number">4</span></span>;</code> </pre><br>  Portanto, precisamos ter certeza de que ningu√©m em nosso plano de montagem transsipar√° os m√≥dulos ES6. <br><br>  Caso n¬∫ 3. Suponha que tenhamos uma classe t√£o in√∫til que n√£o fa√ßa nada: <code>export class ShakeMe {}</code> .  Al√©m disso, ainda n√£o o usamos.  Quando o Webpack passa pela importa√ß√£o e exporta√ß√£o, o Babel transforma a classe em uma fun√ß√£o e o bundler observa que a fun√ß√£o n√£o √© usada: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* unused harmony e[port b */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ShakeMe = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShakeMe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ babelHelpers.classCallCheck(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, ShakeMe); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ShakeMe; }();</code> </pre><br>  Parece que tudo deve ficar bem, mas se dermos uma olhada mais de perto, veremos que dentro dessa fun√ß√£o existe uma vari√°vel global <code>babelHelpers</code> , da qual alguma fun√ß√£o √© chamada.  Este √© um <b>efeito colateral</b> : o UglifyJS v√™ que alguma fun√ß√£o global est√° sendo chamada e n√£o corta o c√≥digo, porque tem medo de que algo seja interrompido. <br><br>  Quando voc√™ escreve classes e as executa no Babel, elas nunca s√£o cortadas.  Como isso √© corrigido?  Existe um hack padronizado - adicione um coment√°rio <code>/*#__PURE__*/</code> antes da fun√ß√£o: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* unused harmony export b */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ShakeMe = <span class="hljs-comment"><span class="hljs-comment">/*#__PURE__*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShakeMe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ babelHelpers.classCallCheck(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, ShakeMe); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ShakeMe; }();</code> </pre><br>  Ent√£o o UglifyJS acreditar√° na palavra que a pr√≥xima fun√ß√£o √© pura.  Felizmente, o <b><a href="">Babel 7</a></b> est√° fazendo isso agora e, no Babel 6, nada foi removido at√© o momento. <br><br><blockquote>  Regra: se voc√™ tiver um efeito colateral em algum lugar, o UglifyJS n√£o far√° nada. </blockquote><br>  Para resumir: <br><br><ul><li>  <b>A trepida√ß√£o de √°rvores n√£o funciona para a maioria das bibliotecas do npm</b> , porque todas elas s√£o do CommonJS e s√£o constru√≠das pelo antigo Babel. </li><li>  Provavelmente, o <b>tremor em √°rvore funcionar√° adequadamente para as bibliotecas que j√° est√£o preparadas para isso</b> , por exemplo, Lodash-es, Date-fns e seu c√≥digo ou bibliotecas. </li><li>  O UglifyJS est√° envolvido na montagem. </li><li>  M√≥dulos ES6 usados. </li><li>  Sem efeitos colaterais. </li></ul><br>  N√≥s descobrimos como reduzir o peso do pacote e agora vamos ensin√°-lo a carregar apenas a funcionalidade necess√°ria. <br><br><h3>  Carregamos apenas a funcionalidade necess√°ria </h3><br>  Dividimos essa parte em duas.  Na primeira parte, <b>apenas o c√≥digo exigido pelo usu√°rio √© carregado</b> : se o usu√°rio visitar a p√°gina principal do seu site, ele n√£o carregar√° as p√°ginas da conta pessoal.  No segundo, as <b>altera√ß√µes no c√≥digo levam ao menor recarregamento poss√≠vel de recursos</b> . <br><br><h4>  Carregamos apenas o c√≥digo necess√°rio </h4><br>  Considere a estrutura de um aplicativo imagin√°rio.  Tem: <br><br><ul><li>  Ponto de entrada - APP. </li><li>  Tr√™s p√°ginas: home, pesquisa e cart√£o. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/872/142/14e/87214214e5fc6514a1a72cb20f6be4b2.png" alt="imagem"><br><br>  O primeiro problema que queremos resolver √© <b>emitir um c√≥digo comum</b> .  Vamos denotar o c√≥digo vermelho como o c√≥digo comum para todas as p√°ginas, o c√≠rculo verde para a p√°gina principal e a p√°gina de pesquisa.  Os n√∫meros restantes n√£o s√£o particularmente importantes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/854/ec8/80f/854ec880feff7813d267ca834209db71.png" alt="imagem"><br><br>  Quando o usu√°rio acessa a pesquisa na p√°gina principal, ele recarrega a caixa e o c√≠rculo uma segunda vez, embora ele j√° os possua.  Idealmente, gostar√≠amos de ver algo assim. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b75/290/36d/b7529036de4cf6923a279666d00ca297.png" alt="imagem"><br><br>  √â bom que o Webpack 4 j√° tenha um plug-in embutido que fa√ßa isso por n√≥s - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SplitChunksPlugin</a> .  O plug-in retira o c√≥digo do aplicativo ou o c√≥digo dos m√≥dulos do n√≥, que √© usado por v√°rios trechos em um trecho separado, garantindo que o trecho com o c√≥digo comum seja superior a 30 Kb e para carregar a p√°gina, √© necess√°rio fazer o download de n√£o mais que 5 trechos.  A estrat√©gia √© ideal: carregar blocos muito pequenos n√£o √© rent√°vel, e carregar muitos blocos √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=http://engineering.khanacademy.org/posts/js-packaging-">longo e n√£o √© t√£o eficiente</a> quanto fazer o download de menos blocos, mesmo no http2.  Para repetir esse comportamento em 2 ou 3 vers√µes do Webpack, tive que escrever 20 a 30 linhas com recursos n√£o documentados.  Agora isso est√° sendo resolvido em uma linha. <br><br><h4>  Takeaway de CSS </h4><br>  Seria √≥timo se ainda retir√°ssemos o CSS para cada bloco em um arquivo separado.  Existe uma solu√ß√£o pronta para isso - <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mini-Css-Extract-Plugin</a></b> .  O plug-in apareceu apenas no Webpack 4 e, antes dele, n√£o havia solu√ß√µes adequadas para essa tarefa - apenas hacks, dor e ferimentos nas pernas.  O plug-in <b>remove o CSS de partes ass√≠ncronas</b> e foi criado <b>especificamente para esta tarefa</b> , que executa perfeitamente. <br><br><h4>  Recarga m√≠nima poss√≠vel de recursos </h4><br>  Vamos descobrir como garantir que, ao liberar, por exemplo, um novo bloco promocional na p√°gina principal, o usu√°rio <b>recarregue a menor parte poss√≠vel do c√≥digo</b> . <br><br>  Se tiv√©ssemos versionamento, tudo ficaria bem.  Aqui temos a p√°gina principal da vers√£o N e ap√≥s o lan√ßamento do bloco promocional - vers√£o N + 1.  O Webpack fornece um mecanismo semelhante imediatamente, usando hash.  Depois que o Webpack coleta todos os ativos, nesse caso, app.js, ele calcula o hash do conte√∫do e o adiciona ao nome do arquivo para obter o app. [Hash] .js.  Este √© o <b>controle de vers√£o</b> que precisamos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd1/3f2/1a9/fd13f21a9daeddd3a1af9083b8134257.png" alt="imagem"><br><br>  Vamos verificar como funciona.  Ligue os hashes, fa√ßa altera√ß√µes na p√°gina principal e veja se o c√≥digo da p√°gina principal realmente mudou.Vamos ver que dois arquivos foram alterados: main e app.js. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a2/bc0/b44/2a2bc0b447b7baf927ac729e28ace633.png" alt="imagem"><br><br>  Por que isso aconteceu, porque √© il√≥gico?  Para entender o porqu√™, vamos dar uma <b>olhada no app.js.</b>  Consiste em tr√™s partes: <br><br><ul><li>  c√≥digo da aplica√ß√£o </li><li>  tempo de execu√ß√£o do webpack; </li><li>  links para peda√ßos ass√≠ncronos. </li></ul><br>  Quando alteramos o c√≥digo principal, o conte√∫do e o hash s√£o alterados, o que significa que o <b>link</b> para ele tamb√©m muda no aplicativo.  O aplicativo em si tamb√©m mudar√° e precisa ser reiniciado.  A solu√ß√£o para esse problema √© <b>dividir o</b> app.js em dois trechos: c√≥digo do aplicativo e tempo de execu√ß√£o do webpack e links para trechos ass√≠ncronos.  O Webpack 4 faz tudo por n√≥s com uma op√ß√£o <b>runtimeChunk</b> , que pesa muito pouco - menos de 2 KB em gzip.  A reinicializa√ß√£o para o usu√°rio √© praticamente in√∫til.  RuntimeChunk est√° ativado com apenas uma op√ß√£o: <br><br><pre> <code class="javascript hljs">optimization: { <span class="hljs-attr"><span class="hljs-attr">runtimeChunk</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre><br>  No Webpack 3 e 2, escrever√≠amos 5-6 linhas, em vez de uma.  Isso n√£o √© muito mais, mas ainda √© um inconveniente desnecess√°rio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e4/125/5d8/6e41255d837ac2a5c4bb8a6e9b74f686.png" alt="imagem"><br><br>  Tudo est√° √≥timo, aprendemos a criar links e tempo de execu√ß√£o!  Vamos escrever um novo m√≥dulo no main, liber√°-lo e - op!  - agora, em geral, tudo reinicia. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc7/8f6/a5f/cc78f6a5f6ffcd8b2da956d5463fefc8.png" alt="imagem"><br><br>  Porque  Vamos ver como os m√≥dulos funcionam no webpack. <br><br><h4>  M√≥dulos Webpack </h4><br>  Suponha que exista um c√≥digo no qual voc√™ adicione os m√≥dulos <b>a</b> , <b>b</b> , <b>d</b> e <b>e</b> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'b'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'d'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'e'</span></span>;</code> </pre><br>  O Webpack converte as importa√ß√µes para exigir: <b>a</b> , <b>b</b> , <b>d</b> e <b>e s√£o</b> substitu√≠dos por require (0), require (1), require (2) e requere (3). <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>);</code> </pre><br>  Imagine uma imagem que acontece com muita frequ√™ncia: voc√™ escreve um novo m√≥dulo c <code>import c from 'c';</code>  e cole em algum lugar no meio: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'a'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'b'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'c'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'d'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'e'</span></span>;</code> </pre><br>  Quando o Webpack processa tudo, converte a importa√ß√£o do novo m√≥dulo em require (2): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>);</code> </pre><br>  Os m√≥dulos <b>d</b> e <b>e</b> , que eram 2 e 3, receber√£o os n√∫meros 3 e 4 - o novo ID.  Uma conclus√£o simples √© a seguinte: usar n√∫meros de s√©rie como id √© um pouco tolo, mas o Webpack faz isso. <br><br><blockquote>  N√£o use o n√∫mero de s√©rie como identifica√ß√£o exclusiva </blockquote><br>  Para corrigir o problema, existe uma solu√ß√£o interna do Webpack - <b>HashedModuleIdsPlugin</b> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webpack.HashedModuleIdsPlugin({ <span class="hljs-attr"><span class="hljs-attr">hashFunction</span></span>: <span class="hljs-string"><span class="hljs-string">'md4‚Ä≤, hashDigest:'</span></span>base64‚Ä≤, <span class="hljs-attr"><span class="hljs-attr">hashDigestLength</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, }),</code> </pre><br>  Este plug-in usa 4 caracteres de <b>hash md4 em</b> vez de identifica√ß√£o digital do caminho absoluto para o arquivo.  Com isso, nossa exig√™ncia se tornar√°: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'YmRl'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'N2Fl'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'OWE4‚Ä≤); var d = require('</span></span>NWQz<span class="hljs-string"><span class="hljs-string">'); var e = require('</span></span>YWVj<span class="hljs-string"><span class="hljs-string">');</span></span></code> </pre><br>  Em vez de n√∫meros, as letras apareceram.  Obviamente, h√° um problema oculto - √© uma <b>colis√£o de hashes</b> .  N√≥s deparamos com isso uma vez e podemos aconselh√°-lo a usar 8 caracteres em vez de 4. Depois de configurar os hashes corretamente, tudo funcionar√° da maneira que originalmente quer√≠amos. <br><br>  Agora sabemos como coletar pacotes de sonhos. <br><br><ul><li>  <b>Minify</b> . </li><li>  <b>Use a divis√£o de c√≥digo</b> . </li><li>  <b>Configure hashes</b> . </li></ul><br>  Aprendemos a colecionar e agora trabalharemos com velocidade. <br><br><h2>  Como montar um pacote de sonho <b>rapidamente</b> ? </h2><br>  Em nosso N1.RU, o maior aplicativo consiste em 10.000 m√≥dulos e, sem otimiza√ß√µes, leva 28 minutos.  Conseguimos acelerar a montagem para dois minutos!  Como fizemos isso?  Existem tr√™s maneiras de acelerar qualquer c√°lculo, e todas as tr√™s s√£o aplic√°veis ‚Äã‚Äãao Webpack. <br><br><h3>  Paraleliza√ß√£o de montagem </h3><br>  A primeira coisa que fizemos foi <b>paralelizar a assembl√©ia</b> .  Para isso, temos: <br><br><ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O HappyPackPlugin</a></b> , que envolve seus carregadores em outros carregadores, e realiza todos os c√°lculos <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">agrupados</a></b> em processos separados.  Isso permite, por exemplo, paralelizar Babel e node-sass. </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">carregador de linha</a></b> .  Executa aproximadamente o mesmo que o HappyPackPlugin, usa n√£o apenas processos, mas o conjunto de encadeamentos.  Alternar para um encadeamento separado √© uma opera√ß√£o dispendiosa, use-a com cuidado e somente se voc√™ desejar agrupar opera√ß√µes pesadas e que consomem muitos recursos, como babel ou node-sass.  Para carregar o json, por exemplo, a paraleliza√ß√£o n√£o √© necess√°ria, porque carrega rapidamente. </li><li>  Os plug-ins e carregadores que voc√™ usa provavelmente j√° possuem <b>ferramentas de paraleliza√ß√£o integradas</b> - basta olhar.  Por exemplo, esta op√ß√£o est√° no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">UglifyJS</a> . </li></ul><br><h3>  Armazenando em cache os resultados da constru√ß√£o </h3><br>  <b>O armazenamento em cache dos resultados da montagem</b> √© a maneira mais eficiente de acelerar a montagem do Webpack. <br><br>  A primeira solu√ß√£o que temos √© o <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cache-loader</a></b> .  Este √© um carregador que entra em uma cadeia de carregadores e salva o resultado da constru√ß√£o de um arquivo espec√≠fico para uma cadeia espec√≠fica de carregadores no sistema de arquivos.  Na pr√≥xima montagem do pacote configur√°vel, se esse arquivo estiver no sistema de arquivos e j√° tiver sido processado com essa cadeia, o cache-loader receber√° os resultados e n√£o chamar√° os carregadores que est√£o por tr√°s deles, por exemplo, Babel-loader ou node-sass. <br><br>  O gr√°fico mostra o tempo de montagem.  Barra azul - 100% de tempo de compila√ß√£o, sem cache-loader e com ela - 7% mais lento.  Isso ocorre porque o carregador de cache gasta um tempo extra salvando caches no sistema de arquivos.  J√° na segunda montagem, recebemos um lucro tang√≠vel - a montagem foi duas vezes mais r√°pida. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6bc/e73/210/6bce732104fda8263464528d91d1a8a1.png" alt="imagem"><br><br>  A segunda solu√ß√£o √© mais <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sofisticada</a></b> - <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HardSourcePlugin</a></b> .  A principal diferen√ßa: o cache-loader √© apenas um carregador que pode operar apenas em uma cadeia de carregadores com c√≥digo ou arquivos, e o HardSourcePlugin tem acesso quase total ao ecossistema Webpack, pode operar com outros plugins e carregadores e amplia o ecossistema para armazenar um pouco em cache.  O gr√°fico acima mostra que, no primeiro lan√ßamento, o tempo de cria√ß√£o aumentou 37%, mas no segundo lan√ßamento com todos os caches, aceleramos 5 vezes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb6/acf/d36/cb6acfd36adbaaadffd68af19889f960.png" alt="imagem"><br><br>  A melhor parte √© que voc√™ pode usar as duas solu√ß√µes juntas, o que fazemos no N1.RU.  Tenha cuidado, porque h√° problemas com caches, que discutirei um pouco mais adiante. <br><br>  Os plugins / carregadores que voc√™ j√° usa podem ter <b>mecanismos de cache internos</b> .  Por exemplo, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">babel-loader possui um</a> sistema de cache muito eficiente, mas por algum motivo est√° desativado por padr√£o.  A mesma funcionalidade est√° no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">carregador de scripts do tipo impressionante</a> .  O plugin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">UglifyJS</a> tamb√©m possui armazenamento em cache, o que funciona muito bem.  Ele nos acelerou por v√°rios minutos. <br><br>  E agora os problemas. <br><br><h4>  Problemas de armazenamento em cache </h4><br><ul><li>  O cache pode <b>n√£o ser validado corretamente</b> . </li><li>  As solu√ß√µes aplicadas podem <b>n√£o funcionar com plug-ins, carregadores, seu c√≥digo ou entre si</b> .  Nesse sentido, o cache-loader √© uma solu√ß√£o simples e sem complica√ß√µes.  Mas com o HardSourcePlugin, voc√™ precisa ter mais cuidado. </li><li>  <b>√â dif√≠cil estrear se tudo estiver quebrado</b> .  Quando o cache n√£o funciona corretamente e ocorre um erro incompreens√≠vel, ser√° muito dif√≠cil descobrir qual √© o problema. </li></ul><br><h3>  Como economizar na produ√ß√£o? </h3><br>  A √∫ltima maneira de acelerar um processo √© n√£o fazer parte do processo.  Vamos pensar em como voc√™ pode economizar na produ√ß√£o?  O que n√£o podemos fazer?  A resposta √© curta - <b>n√£o podemos fazer nada</b> !  N√£o temos o direito de recusar algo na produ√ß√£o, mas podemos economizar muito no desenvolvimento. <br><br>  Em que economizar: <br><br><ul><li>  <b>N√£o colete o mapa de origem</b> at√© precisarmos deles. </li><li>  <b>Use o style-loader em</b> vez de um esquema interessante com remo√ß√£o e processamento de css atrav√©s de css loaders.  O carregador de estilos em si √© muito r√°pido, porque pega a linha css e a empurra para uma fun√ß√£o que insere essa linha na marca de estilo. </li><li>  <b>Voc√™ pode deixar na lista de navegadores apenas o navegador usado especificamente - provavelmente este √© o √∫ltimo chrome</b> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Isso ir√° acelerar bastante</a> . </li><li>  Abandone <b>completamente qualquer otimiza√ß√£o de recursos</b> : de UglifyJS, css-nano, gzip / brotli. </li></ul><br><blockquote>  A acelera√ß√£o de compila√ß√£o √© paraleliza√ß√£o, armazenamento em cache e recusa de c√°lculos.  Seguindo estas tr√™s etapas simples, voc√™ pode acelerar muito. </blockquote><br><h2>  Como configurar o webpack? </h2><br>  N√≥s descobrimos como montar um pacote de sonhos e como mont√°-lo rapidamente, e agora vamos descobrir como configurar o Webpack para n√£o nos dar um tiro na perna toda vez que voc√™ alterar a configura√ß√£o. <br><br><h3>  Configura√ß√£o da evolu√ß√£o no projeto </h3><br>  Um caminho t√≠pico do webpack-config em um projeto come√ßa com uma configura√ß√£o <b>simples</b> .  Inicialmente, basta inserir o Webpack, o Babel-loader, o sass-loader e tudo est√° bem.  Inesperadamente, algumas <b>condi√ß√µes</b> aparecem <b>em process.env</b> e voc√™ as insere.  Um, segundo, terceiro, mais e mais, at√© que uma condi√ß√£o com uma op√ß√£o "m√°gica" seja adicionada.  Voc√™ entende que tudo j√° est√° muito ruim, e √© melhor <b>duplicar as configura√ß√µes</b> para dev e produ√ß√£o e fazer as corre√ß√µes duas vezes.  Tudo ficar√° mais claro.  Se voc√™ pensou: ‚ÄúAlgo est√° errado aqui?‚Äù, O √∫nico conselho de trabalho √© <b>manter a configura√ß√£o em ordem</b> .  Vou te dizer como fazemos. <br><br><h3>  Mantenha a configura√ß√£o em ordem </h3><br>  Usamos o pacote <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">webpack-merge</a></b> .  Este √© um pacote npm criado para combinar v√°rias configura√ß√µes em uma.  Se voc√™ n√£o estiver familiarizado com a estrat√©gia de mesclagem padr√£o, poder√° personaliz√°-la. <br><br><h3>     </h3><br>    4  : <br><br><ul><li> Loaders. </li><li> Plugins. </li><li> Presets. </li><li> Parts. </li></ul><br>    . <br><br><h4> Plugin/Loader </h4><br>  ,        ,       API,  ,      . <br><br>  Parece algo como isto: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** *  JSdoc * @param {Object} options * @see    */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createPlugin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Plugin(options); };</code> </pre><br>  ,   ,   ,   .    ,       url-loader  : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * url-loader    file-loader.        * * @example * -   some-image.png.     url-loader,  url-loader    * 1.    ,  url-loader    base64  * 2. , url-loader    outputPath + name     ,     . *    some-image.png,     outputPath/images/some-image.12345678hash.png,  url-loader  * publicPath/images/some-image.12345678hash.png * * @param {string} prefix    * @param {number} limit    ,    * @return {Object} loader   * @see https://www.npmjs.com/package/url-loader */</span></span></code> </pre><br>     ,   ,  , ,    ,   ,     .  ,  ,   ,  ,   url-loader.    : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">urlLoader</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'assets'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, limit = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">100</span></span></span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'url-loader'</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { limit, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">/[name].[hash].[ext]`</span></span> } }; };</code> </pre><br>         .    ,   Loader         . <br><br><h4> Preset </h4><br>    webpack.     ,      ,    ,   webpack,    .    ‚Äî  ,  ,    scss-: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.scss$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [cssLoader, postCssLoader, scssLoader] }</code> </pre><br>     . <br><br><h4> Part </h4><br>  ‚Äî  ,      .        ,       ,   .  ,       : <br><br><pre> <code class="javascript hljs">entry: { <span class="hljs-attr"><span class="hljs-attr">app</span></span>: <span class="hljs-string"><span class="hljs-string">'./src/Frontend/app.js'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">publicPath</span></span>: <span class="hljs-string"><span class="hljs-string">'/static/cabinet/app/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: path.resolve(<span class="hljs-string"><span class="hljs-string">'www/static/app'</span></span>) },</code> </pre><br>     : <br><br><ul><li> <b> </b> ,   ,   , json,     , , splitChunks. </li><li> <b>  dev</b> ,  ,    js/css     </li><li> <b>Part</b> ,   output, publicPath, entry-point    , ,    source map. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/7ee/20f/fa6/7ee20ffa6f453c35f11d92e3583d8caf.png" alt="imagem"><br><br> <b>Webpack-merge</b>     .          ,     .  webpack-merge     3-7 ,    Babel-loader,            .    ,   . <br><br><h3>   </h3><br>  . <b>  </b> ,    . <b> </b> ,   webpack       ‚Äî     . <b>  </b> ,  . <br><br>   ,    ! <br><br><blockquote>   ‚Äî     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Frontend Conf</a> . ,    ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> ,           ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Frontend Conf ++</a>  . <br><br>    -      ?    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">FrontenConf ++</a> ,   27  28   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>  27 ,   15          .     ‚Äî ! </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433324/">https://habr.com/ru/post/pt433324/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433308/index.html">Transferindo a configura√ß√£o do PBX para o servi√ßo 3CX PBX Express</a></li>
<li><a href="../pt433316/index.html">Resumo do projeto: integra√ß√£o, feedback, busca de id√©ias e tomada de decis√£o</a></li>
<li><a href="../pt433318/index.html">garbage.collect ()</a></li>
<li><a href="../pt433320/index.html">Layout da grade como base dos layouts modernos</a></li>
<li><a href="../pt433322/index.html">API JSON - trabalhamos de acordo com a especifica√ß√£o</a></li>
<li><a href="../pt433326/index.html">Qualidade do c√≥digo</a></li>
<li><a href="../pt433328/index.html">Melhor perder um dia</a></li>
<li><a href="../pt433330/index.html">Resolver palavras cruzadas em japon√™s com o SAT Solver</a></li>
<li><a href="../pt433332/index.html">Suporte de Python nas fun√ß√µes do Azure</a></li>
<li><a href="../pt433334/index.html">Comportamentos XAML para WPF agora √© Open Source</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>