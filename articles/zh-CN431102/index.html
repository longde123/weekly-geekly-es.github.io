<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌊 🌼 🗄️ 物理地址如何显示在DRAM字符串和存储区中 💻 🐮 ☁️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在上一篇文章中，我们讨论了Intel Sandy Bridge处理器如何映射L3缓存中的物理地址。 

 现在，我将告诉您这些处理器的内存控制器如何将物理地址映射到DRAM中的某个位置，尤其是DRAM模块中的行号，存储区和列号。 称之为DRAM地址映射 。 我以一台测试机为例。 

 动机：Rowh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>物理地址如何显示在DRAM字符串和存储区中</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431102/"> 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上一篇文章中，</a>我们讨论了Intel Sandy Bridge处理器如何映射L3缓存中的物理地址。 <br><br> 现在，我将告诉您这些处理器的内存控制器如何将物理地址映射到DRAM中的某个位置，尤其是DRAM模块中的行号，存储区和列号。 称之为<i>DRAM地址映射</i> 。 我以一台测试机为例。 <br><br><h4> 动机：Rowhammer错误 </h4><br> 我对映射DRAM地址感兴趣，因为它与<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rowhammer错误有关</a> 。 <br><br>  Rowhammer是某些DRAM模块的问题，其中某些最坏情况的内存访问模型可能导致内存损坏。 在这些DRAM中，存储线的多次激活（“线阻塞”）会导致电噪声，从而改变相邻线易受攻击的单元中的位。 <br><a name="habracut"></a><br> 这些重复的线路激活可能是由于多次访问同一DRAM组不同线路上的一对DRAM地址引起的。 知道DRAM地址的映射很有用，因为它表明哪些地址对满足此“一个存储体，不同的行”（相同存储体，不同的行； SBDR）属性。 <br><br><h4> 猜测和检查地址映射 </h4><br> 为了进行测试，我有一台带有DRAM模块且容易受到Rowhammer错误影响的机器。 在此计算机上运行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">rowhammer_test会</a>显示一些变化。 <br><br> 我想知道这台机器的DRAM地址映射方案，但尚未公开记录：这是Sandy Bridge处理器，但是Intel没有记录这些处理器的内存控制器使用的地址映射。 <br><br> 实际上， <code>rowhammer_test</code>测试不需要知道SBDR地址对。 他只是尝试几次敲击随机选择的地址对。 通常，其中的1/8或1/16是SBDR对，因为在我们的汽车中，每个DIMM中有8个存储区（总共16个存储区）。 因此，我们不需要知道DRAM地址的映射就不​​会引起存储器中的位更改，但是这种知识将有助于更有目的地进行测试。 <br><br> 尽管没有记录地址映射，但是我发现我可以基于DRAM几何结构对其进行合理假设，然后根据<code>rowhammer_test</code>报告的物理地址检查该假设。 该测试报告位更改的物理地址（ <i>“受害者”</i> ）和进行这些更改的物理地址对（ <i>“攻击者”</i> ）。 由于这些对必须是SBDR对，因此我们可以验证地址到该经验数据的假设映射。 <br><br><h4> 记忆体几何 </h4><br> 第一步：检查机器中安装了多少个DIMM，以及它们的内部组织方式。 <br><br> 我可以使用Linux上<code>decode-dimms</code>请求DIMM信息（在Ubuntu上，它位于<code>I2C-tools</code>软件包中）。 此工具解码DIMM中的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SPD（串行状态检测）</a>元数据。 <br><br> 在我的测试机上，有两个4 GB的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SO-DIMM</a> ，可提供8 GB的内存。 <br><br>  <code>decode-dimms</code>为每个模块报告以下信息： <br><br><pre> 大小4096 MB
银行x行x列x位8 x 15 x 10 x 64
排名2 </pre><br> 这意味着两个DIMM： <br><br><ul><li> 每个库具有2 ^ 15行（32768行）。 </li><li> 每行包含2 ^ 10 * 64位= 2 ^ 16位= 2 ^ 13字节= 8 KB。 </li></ul><br> 每个DIMM有2个等级和8个存储体。 交叉检查DIMM的容量可以得到预期的大小： <br><br> 每行8 KB * 32768行* 2等级* 8个存储库= 4096 MB = 4 GB <br><br><h4> 映射DRAM地址 </h4><br> 在我的测试计算机上，如下使用物理地址： <br><br><ul><li>  <b>位0-5</b> ：这些是字符串中字节索引的低6位（即64字节高速缓存行的6位索引）。 </li><li>  <b>位6</b> ：这是一个在两个DIMM之间选择的1位通道号。 </li><li>  <b>位7-13</b> ：一行中索引的高7位（即列号的高位）。 </li><li>  <b>位14-16</b> ：与行号的低3位进行XOR，得到3位的存储体编号。 </li><li>  <b>位17</b> ：1位等级编号，可在两个DIMM等级（通常是DIMM芯片的两侧）之间进行选择。 </li><li>  <b>位18-32</b> ：15位行号。 </li><li>  <b>位33+</b> ：可以设置它们是因为物理内存以大于0的物理地址开头。 </li></ul><br><h4> 为什么要这样显示？ </h4><br> 这种映射<code>rowhammer_test</code>的结果（请参见下文），但是我们也可以解释地址位的映射方式，以便为典型的内存访问模式（如顺序访问和分步或分步访问）提供良好的性能（跨步访问）： <br><br><ul><li>  <b>并发渠道</b> 。 在第6位中放置一个通道号意味着高速缓存行将在两个可以并行访问的通道（即两个DIMM）之间交替。 这意味着，如果我们顺序访问地址，则负载将分布在两个通道上。 <br><br> 顺便说一句， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ivy Bridge</a> （Sandy Bridge的继任者）似乎使频道号的显示复杂化。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">英特尔的演示文稿</a>提到“通道散列”，并指出“它允许您基于多个地址位选择通道。” 历史上，它是“ A [6]”。 这样可以确保在通道之间更均匀地分配内存访问。” </li><li>  <b>银行滑倒</b> ：通常，列号，银行和行的排列应尽量减少银行活动行的频繁更改（银行颠簸）。 <br><br> 一个简短的介绍：DRAM模块被组织成存储体，而存储体又被组织成行。 每个存储区都有一个“当前激活的行”：其内容被复制到<i>行缓冲区中</i> ，该<i>行缓冲区</i>充当高速缓存，可以快速访问。 访问另一条线需要更长的时间，因为需要先将其激活。 因此，在映射DRAM地址时，SBDR对在物理地址空间中尽可能地携带。 <br><br> 当交替激活两条特定的线（可能是故意的）时，追逐线（行锤）是滑行的一种特殊情况。 </li><li>  <b>银行并行性</b> ：可以并行访问银行（尽管程度比通道小），因此随着地址的增加，银行编号在行号之前更改。 </li><li>  <b>XOR方案</b> ：将行号的最低有效位与Bank号进行<b>XOR运算</b>是避免在大步访问数组时避免bank滑落的技巧。 例如，在上面的显示中，XOR'ing强制X和X + 256k地址位于不同的存储体中，而不形成SBDR对。 <br><br> 银行/行的异或方案在各种文献中都有描述，例如： <br><ul><li>  David Tavei Wang的博士学位论文<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“现代DRAM系统：性能分析和规划算法”</a> ，2005年。请参见第5.3.5节“库地址平滑（步冲突）”。 总体上，您还可以找到有关DRAM技术的出色背景信息。 </li><li> 文章<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“通过集成内存层次结构减少DRAM延迟”</a> ，2001年。见图。  3。 </li></ul></li></ul><br><h4> 与rowhammer_test对帐 </h4><br> 在测试机上运行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">rowhammer_test_ext</a> （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">rowhammer_test</a>的扩展版本）6小时，发现22位中的位重复更改。  （请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">源数据和分析代码</a> ）。 <br><br> 铸造字符串的测试生成三个地址（A1，A2，V）的集合： <br><br><ul><li>  V是受害者的地址，在这里我们可以看到位的变化。 </li><li>  A1和A2是我们发现的攻击者的地址。 </li><li> 对A1和A2进行排序，以使A1比A2更接近V。 我们暂时假定较近的地址A1实际上会引起位变化（尽管如果使用更复杂的DRAM地址映射，则不一定是正确的）。 </li></ul><br> 对于所有这些结果，我们期望完成以下三个属性： <br><br><ul><li>  <b>行</b> ： <b>行</b>号A1和V必须相差1，即 它们应该在相邻的行中。  （A2可以有任何行号）。 <br><br> 此属性使确定行号最低位在物理地址中的位置变得容易。 <br><br> 测试表明，除了两个结果外，此属性均成立。 在这两个结果中，行号相差3而不是1。 </li><li>  <b>银行</b> ：V，A1和A2必须具有相同的银行号码。 确实，该属性在所有22个结果中均得到体现。 仅在应用行/库的XOR'ing方案时保存。 </li><li>  <b>通道</b> ：V，A1和A2必须具有相同的通道号。 所有结果都是如此。 碰巧所有结果的通道都为0，因为<code>rowhammer_test</code>仅选择以4k对齐的地址，因此仅测试一个通道（也许可以认为是错误）。 </li></ul><br><h4> 可能的进一步测试 </h4><br> 将来，您可以再运行两个实验来检查DRAM地址映射是否正确评估了SBDR属性： <br><br><ul><li>  <b>时间的度量</b> ：对SBDR地址对的多次访问应比对不带SBDR的地址对的多次访问慢，因为前者导致线路激活，而后者则不会激活。 </li><li>  <b>详尽的Rowhammer测试</b> ：一旦我们发现<b>攻击者</b> A1的地址，该地址会导致位的重复更改，我们就可以在A2的许多值上进行检查。 造币（A1，A2）的效果只有在为一对SBDR时才会改变。 </li></ul><br> 另外，从系统单元中删除一个DIMM应该从DRAM地址映射中删除通道位，并相应地更改攻击者和受害者地址。 也可以检查。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN431102/">https://habr.com/ru/post/zh-CN431102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN431090/index.html">一个VK机器人，一个C＃和一个橙色</a></li>
<li><a href="../zh-CN431092/index.html">ROS：Raspberry Pi“低血”的深度图</a></li>
<li><a href="../zh-CN431094/index.html">纸牌排序</a></li>
<li><a href="../zh-CN431096/index.html">如何构建聊天机器人产品</a></li>
<li><a href="../zh-CN431098/index.html">即使是火灾也不是障碍，也不是灾难发生后的Zimbra Speed Recovery</a></li>
<li><a href="../zh-CN431104/index.html">我们Neoflex如何开发DevOps专业知识</a></li>
<li><a href="../zh-CN431106/index.html">美国人在这个黑色星期五花了多少钱，智能手机与它有什么关系？</a></li>
<li><a href="../zh-CN431108/index.html">如何将卫星图像变成地图。 Yandex中的计算机视觉</a></li>
<li><a href="../zh-CN431110/index.html">停止喂食发布者。 欧盟正在制定强制性免费获取研究的规则</a></li>
<li><a href="../zh-CN431112/index.html">如何使用最小二乘法来评估资源和监视Oracle数据库</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>