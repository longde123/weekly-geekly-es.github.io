<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñï üë®üèø‚Äçüîß üõë Proveedor de Terraforma Selectel üëèüèª ‚ñ∂Ô∏è üï∫üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lanzamos el proveedor oficial de Terraform para trabajar con Selectel. Este producto permite a los usuarios implementar completamente la gesti√≥n de re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Proveedor de Terraforma Selectel</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/445162/"><img src="https://habrastorage.org/webt/yf/si/pf/yfsipfz7j0lfweuvzxwwqzqr94a.png"><br><br>  Lanzamos el proveedor oficial de Terraform para trabajar con Selectel.  Este producto permite a los usuarios implementar completamente la gesti√≥n de recursos a trav√©s de la metodolog√≠a de Infraestructura como c√≥digo. <br><a name="habracut"></a><br>  Actualmente, el proveedor admite la gesti√≥n de recursos del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">servicio Virtual Private Cloud</a> (en lo sucesivo, VPC).  En el futuro, planeamos agregarle la gesti√≥n de recursos de otros servicios proporcionados por Selectel. <br><br>  Como ya sabe, el servicio VPC se basa en OpenStack.  Sin embargo, debido al hecho de que OpenStack no proporciona herramientas nativas para el servicio de la nube p√∫blica, hemos implementado la funcionalidad que falta en un conjunto de API adicionales que simplifican la administraci√≥n de objetos compuestos complejos y hacen que el trabajo sea m√°s conveniente.  Parte de la funcionalidad disponible en OpenStack est√° cerrada por el uso directo, pero es accesible a trav√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">nuestra API</a> . <br><br>  El proveedor de Selectel Terraform ahora ofrece la capacidad de administrar los siguientes recursos de VPC: <br><br><ul><li>  proyectos y sus cuotas; </li><li>  usuarios, sus roles y tokens; </li><li>  subredes p√∫blicas, incluidas las regionales y VRRP; </li><li>  licencias de software </li></ul><br>  El proveedor utiliza nuestra biblioteca p√∫blica Go para trabajar con la API VPC.  Tanto la biblioteca como el proveedor en s√≠ son de c√≥digo abierto, se est√°n desarrollando en Github: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">Repositorio de la</a> biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">Go-selvpcclient</a> , </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">Terraform-provider Selectel</a> repositorio de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">proveedores</a> . </li></ul><br>  Para administrar otros recursos en la nube, como m√°quinas virtuales, discos, cl√∫steres de Kubernetes, puede usar el proveedor OpenStack Terraform.  La documentaci√≥n oficial de ambos proveedores est√° disponible en los siguientes enlaces: <br><br><ul><li>  Documentaci√≥n de recursos de Selectel: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">Selectel</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">proveedor de Terraform</a> , </li><li>  Documentaci√≥n de recursos de OpenStack: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow noopener noreferrer">proveedor de Terraform OpenStack</a> . </li></ul><br><h2>  Empezando </h2><br>  Para comenzar, debe instalar Terraform (las instrucciones y los enlaces a los paquetes de instalaci√≥n se pueden encontrar en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow noopener noreferrer">sitio web oficial</a> ). <br><br>  Para funcionar, el proveedor requiere la clave API Selectel, que se crea en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">el panel de control de la cuenta</a> . <br><br>  Los manifiestos para trabajar con Selectel se crean usando Terraform o usando un conjunto de ejemplos listos que est√°n disponibles en nuestro repositorio de Github: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">terraform-examples</a> . <br><br>  El repositorio con ejemplos se divide en dos directorios: <br><br><ul><li>  <strong>m√≥dulos</strong> , que contienen peque√±os m√≥dulos reutilizables que toman un conjunto de par√°metros como entrada y administran un peque√±o conjunto de recursos; </li><li>  <strong>ejemplos</strong> , que contienen ejemplos de un conjunto completo de m√≥dulos interconectados. </li></ul><br>  Despu√©s de instalar Terraform, crear una clave de API Selectel y familiarizarse con los ejemplos, pasamos a ejemplos pr√°cticos. <br><br><h2>  Ejemplo de crear un servidor con un disco local </h2><br>  Considere el ejemplo de crear un proyecto, un usuario con un rol y una m√°quina virtual con un disco local: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk</a> . <br><br>  El archivo <strong>vars.tf</strong> describe todos los par√°metros que se usar√°n al llamar a los m√≥dulos.  Algunos de ellos tienen valores predeterminados, por ejemplo, el servidor se crear√° en la zona <strong>ru-3a</strong> con la siguiente configuraci√≥n: <br><br><pre><code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"server_vcpus"</span></span> { default = 4 } variable <span class="hljs-string"><span class="hljs-string">"server_ram_mb"</span></span> { default = 8192 } variable <span class="hljs-string"><span class="hljs-string">"server_root_disk_gb"</span></span> { default = 8 } variable <span class="hljs-string"><span class="hljs-string">"server_image_name"</span></span> { default = <span class="hljs-string"><span class="hljs-string">"Ubuntu 18.04 LTS 64-bit"</span></span> }</code> </pre> <br>  En el archivo <b>main.tf</b> , el proveedor Selectel se inicializa: <br><br><pre> <code class="bash hljs">provider <span class="hljs-string"><span class="hljs-string">"selectel"</span></span> { token = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.sel_token}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br>  Este archivo tambi√©n contiene el valor predeterminado para la clave SSH que se instalar√° en el servidor: <br><br><pre> <code class="bash hljs">module <span class="hljs-string"><span class="hljs-string">"server_local_root_disk"</span></span> { ... server_ssh_key = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${file("~/.ssh/id_rsa.pub")}</span></span></span><span class="hljs-string">"</span></span> }</code> </pre><br>  Si es necesario, puede especificar una clave p√∫blica diferente.  La clave no tiene que especificarse como una ruta al archivo; tambi√©n puede agregar un valor como una cadena. <br><br>  Adem√°s en este archivo se <strong>lanzan los</strong> m√≥dulos <strong>project_with_user</strong> y <strong>server_local_root_disk</strong> , que administran los recursos necesarios. <br><br>  Analizaremos estos m√≥dulos con m√°s detalle. <br><br><h3>  Crear un proyecto y usuario con un rol </h3><br>  El primer m√≥dulo crea un proyecto y un usuario con un rol en este proyecto: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">terraform-examples / modules / vpc / project_with_user</a> . <br><br>  El usuario creado podr√° iniciar sesi√≥n en OpenStack y administrar sus recursos.  El m√≥dulo es simple y gestiona solo tres entidades: <br><br><ul><li>  selectel_vpc_project_v2, </li><li>  selectel_vpc_user_v2, </li><li>  selectel_vpc_role_v2. </li></ul><br><h3>  Crear un servidor virtual con un disco local </h3><br>  El segundo m√≥dulo gestiona los objetos OpenStack necesarios para crear un servidor con un disco local. <br><br>  Debe prestar atenci√≥n a algunos de los argumentos que se especifican en este m√≥dulo para el recurso <strong>openstack_compute_instance_v2</strong> : <br><br><pre> <code class="bash hljs">resource <span class="hljs-string"><span class="hljs-string">"openstack_compute_instance_v2"</span></span> <span class="hljs-string"><span class="hljs-string">"instance_1"</span></span> { ... lifecycle { ignore_changes = [<span class="hljs-string"><span class="hljs-string">"image_id"</span></span>] } vendor_options { ignore_resize_confirmation = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre><br>  El argumento <strong>ignore_changes le</strong> permite ignorar el cambio del atributo <strong>id</strong> para la imagen utilizada para crear la m√°quina virtual.  En el servicio VPC, la mayor√≠a de las im√°genes p√∫blicas se actualizan autom√°ticamente una vez por semana, y su <strong>identificaci√≥n</strong> tambi√©n cambia.  Esto se debe a las caracter√≠sticas del componente OpenStack - Glance, en el que las im√°genes se consideran entidades inmutables. <br><br>  Si se crea o modifica un servidor o disco existente, que utiliza la <strong>identificaci√≥n de la</strong> imagen p√∫blica como argumento <strong>image_id</strong> , luego de actualizar esta imagen, reiniciar el manifiesto de Terraform recrear√° el servidor o el disco.  El uso del argumento <strong>ignore_changes</strong> evita esta situaci√≥n. <br><br>  <em>Nota: el argumento</em> <strong><em>ignore_changes</em></strong> <em>apareci√≥ en Terraform hace mucho tiempo:</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">pull # 2525</a> <em>.</em> <br><br>  El argumento <strong>ignore_resize_confirmation es</strong> necesario para redimensionar con √©xito el disco local, los n√∫cleos o la memoria del servidor.  Dichos cambios se realizan a trav√©s del componente OpenStack Nova utilizando la solicitud de cambio de <b>tama√±o</b> .  De manera predeterminada, Nova despu√©s de una solicitud de cambio de <b>tama√±o</b> coloca al servidor en el estado <b>verificar_resize</b> y espera la confirmaci√≥n adicional del usuario.  Sin embargo, este comportamiento se puede cambiar para que Nova no espere acciones adicionales del usuario. <br><br>  El argumento especificado permite que Terraform no espere el estado <b>generate_resize</b> para el servidor y est√© preparado para que el servidor est√© en el estado activo despu√©s de cambiar sus par√°metros.  El argumento est√° disponible en la versi√≥n 1.10.0 del proveedor de OpenStack Terraform: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">pull # 422</a> . <br><br><h3>  Creaci√≥n de recursos </h3><br>  Antes de lanzar manifiestos, debe tenerse en cuenta que en nuestro ejemplo se lanzan dos proveedores diferentes, y el proveedor OpenStack depende de los recursos del proveedor Selectel, ya que es imposible administrar los objetos que pertenecen a √©l sin crear un usuario en el proyecto.  Desafortunadamente, por la misma raz√≥n, no podemos simplemente ejecutar el <strong>comando terraform apply</strong> dentro de nuestro ejemplo.  Primero tendremos que <strong>solicitar</strong> el m√≥dulo <strong>project_with_user</strong> y luego todo lo dem√°s. <br><br>  <em>Nota: este problema a√∫n no se ha resuelto en Terraform, puede seguir su discusi√≥n sobre Github en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">n√∫mero 2430</a> y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">n√∫mero 4149</a> .</em> <br><br>  Para crear recursos, iremos al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">directorio terraform-examples / examples / vpc / server_local_root_disk</a> , su contenido deber√≠a ser as√≠: <br><br><pre> <code class="bash hljs">$ ls README.md main.tf vars.tf</code> </pre><br>  Inicializamos los m√≥dulos usando el comando: <br><br><pre> <code class="bash hljs">$ terraform init</code> </pre><br>  El resultado muestra que Terraform descarga las √∫ltimas versiones de los proveedores utilizados y verifica todos los m√≥dulos descritos en el ejemplo. <br><br>  Primero, aplique el m√≥dulo <strong>project_with_user</strong> .  En este caso, debe transferir manualmente los valores para las variables que no se han establecido: <br><br><ul><li>  <strong>sel_account</strong> con su n√∫mero de cuenta Selectel; </li><li>  <strong>sel_token</strong> con su clave para la API Selectel; </li><li>  contrase√±a_usuario con contrase√±a para el usuario de OpenStack. </li></ul><br>  Los valores para las dos primeras variables deben tomarse del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">panel de control</a> . <br><br>  Para la √∫ltima variable, puede pensar en cualquier contrase√±a. <br><br>  Para usar el m√≥dulo, es necesario reemplazar los valores <strong>SEL_ACCOUNT</strong> , <strong>SEL_TOKEN</strong> y <strong>USER_PASSWORD</strong> ejecutando el comando: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user</code> </pre><br>  Despu√©s de ejecutar el comando Terraform, mostrar√° qu√© recursos desea crear y requerir√° confirmaci√≥n: <br><br><pre> <code class="bash hljs">Plan: 3 to add, 0 to change, 0 to destroy. Do you want to perform these actions? Terraform will perform the actions described above. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to approve. Enter a value: yes</code> </pre><br>  Una vez que se crean el proyecto, el usuario y el rol, puede comenzar a crear los recursos restantes: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Al crear recursos, preste atenci√≥n a la salida de Terraform con una direcci√≥n IP externa a la que se podr√° acceder al servidor creado: <br><br><pre> <code class="bash hljs">module.server_local_root_disk.openstack_networking_floatingip_associate_v2.association_1: Creating... floating_ip: <span class="hljs-string"><span class="hljs-string">""</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"xxxx"</span></span></code> </pre><br>  Puede trabajar con la m√°quina virtual creada a trav√©s de SSH en la IP especificada. <br><br><h3>  Edici√≥n de recursos </h3><br>  Adem√°s de crear recursos a trav√©s de Terraform, tambi√©n se pueden modificar. <br><br>  Por ejemplo, aumente el n√∫mero de n√∫cleos y memoria para nuestro servidor cambiando los valores de los <strong>par√°metros</strong> <strong>server_vcpus</strong> y <strong>server_ram_mb</strong> en el <strong>archivo examples / vpc / server_local_root_disk / main.tf</strong> : <br><br><pre> <code class="bash hljs">- server_vcpus = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_vcpus}</span></span></span><span class="hljs-string">"</span></span> - server_ram_mb = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.server_ram_mb}</span></span></span><span class="hljs-string">"</span></span> + server_vcpus = 8 + server_ram_mb = 10240</code> </pre><br>  Despu√©s de eso, verificamos qu√© cambios esto conducir√° al uso del siguiente comando: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform plan</code> </pre><br>  Como resultado, Terraform realiz√≥ cambios en los recursos <strong>openstack_compute_instance_v2</strong> y <strong>openstack_compute_flavor_v2</strong> . <br><br>  <em>Tenga en cuenta que esto provocar√° un reinicio de la m√°quina virtual creada.</em> <br><br>  Para aplicar la nueva configuraci√≥n de m√°quina virtual, use el <strong>comando terraform apply</strong> , que ya ejecutamos anteriormente. <br><br>  Todos los objetos creados se mostrar√°n en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">el panel de control de VPC</a> : <br><br><img src="https://habrastorage.org/webt/eq/e5/3a/eqe53anrxqpnpd6qn7hlcrnuxec.png"><br><br>  En nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">repositorio de ejemplo,</a> tambi√©n puede ver manifiestos para crear m√°quinas virtuales con unidades de red. <br><br><h2>  Ejemplo de cl√∫ster de Kubernetes </h2><br>  Antes de continuar con el siguiente ejemplo, borraremos los recursos creados anteriormente.  Para hacer esto, en la ra√≠z del proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">terraform-examples / examples / vpc / server_local_root_disk,</a> ejecute el comando para eliminar objetos OpenStack: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.server_local_root_disk</code> </pre><br>  A continuaci√≥n, ejecute el comando Selectel VPC API Object Cleanup: <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform destroy -target=module.project_with_user</code> </pre><br>  En ambos casos, deber√° confirmar la eliminaci√≥n de todos los objetos: <br><br><pre> <code class="bash hljs">Do you really want to destroy all resources? Terraform will destroy all your managed infrastructure, as shown above. There is no undo. Only <span class="hljs-string"><span class="hljs-string">'yes'</span></span> will be accepted to confirm. Enter a value: yes</code> </pre><br>  El siguiente ejemplo se encuentra en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">directorio terraform-examples / examples / vpc / kubernetes_cluster</a> . <br><br>  Este ejemplo crea un proyecto, un usuario con un rol en el proyecto y genera un cl√∫ster de Kubernetes.  En el archivo <strong>vars.tf</strong> , puede ver los valores predeterminados, como el n√∫mero de nodos, sus caracter√≠sticas, la versi√≥n de Kubernetes y m√°s. <br><br>  Para crear recursos, de manera similar al primer ejemplo, primero que nada, inicializaremos los m√≥dulos y crearemos los recursos del m√≥dulo <strong>project_with_user</strong> , y luego crearemos el resto: <br><br><pre> <code class="bash hljs">$ terraform init $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply -target=module.project_with_user $ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Transmitimos la creaci√≥n y gesti√≥n de cl√∫steres de Kubernetes a trav√©s del componente OpenStack Magnum.  Puede obtener m√°s informaci√≥n sobre c√≥mo trabajar con un cl√∫ster en uno de nuestros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">art√≠culos anteriores</a> , as√≠ como en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">la base de conocimientos</a> . <br><br>  Durante la preparaci√≥n del cl√∫ster, se crear√°n discos, m√°quinas virtuales y se instalar√°n todos los componentes necesarios.  La preparaci√≥n dura aproximadamente 4 minutos, momento en el que Terraform mostrar√° mensajes del formulario: <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Still creating... (3m0s elapsed)</code> </pre><br>  Una vez completada la instalaci√≥n, Terraform le informar√° que el cl√∫ster est√° listo y mostrar√° su identificador: <br><br><pre> <code class="bash hljs">module.kubernetes_cluster.openstack_containerinfra_cluster_v1.cluster_1: Creation complete after 4m20s (ID: 3c8...) Apply complete! Resources: 6 added, 0 changed, 0 destroyed.</code> </pre><br>  Para administrar el cl√∫ster Kubernetes creado a trav√©s de la utilidad kubectl, debe obtener el archivo de acceso al cl√∫ster.  Para hacer esto, vaya al proyecto creado a trav√©s de Terraform en la lista de proyectos en su cuenta: <br><br><img src="https://habrastorage.org/webt/pp/7y/rt/pp7yrtw_q-79pkx1j6mr5ebbsyi.png"><br><br>  A continuaci√≥n, siga el enlace del formulario <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">xxxxxx.selvpc.ru</a> , que se muestra debajo del nombre del proyecto: <br><br><img src="https://habrastorage.org/webt/yr/in/wk/yrinwkfne83cenropq9t3szxt6c.png"><br><br>  Use el nombre de usuario y la contrase√±a que se crearon a trav√©s de Terraform como informaci√≥n de inicio de sesi√≥n.  Si no cambi√≥ <strong>vars.tf</strong> o <strong>main.tf</strong> para nuestro ejemplo, entonces el usuario tendr√° el nombre <strong>tf_user</strong> .  Como contrase√±a, use el valor de la variable <strong>TF_VAR_user_password</strong> , que se especific√≥ cuando <strong>se</strong> ejecut√≥ <strong>Terraform Apply</strong> anteriormente. <br><br>  Dentro del proyecto, debe ir a la pesta√±a <strong>Kubernetes</strong> : <br><br><img src="https://habrastorage.org/webt/ft/bp/dj/ftbpdjhjrgxkgzomuxegaujj3wu.png"><br><br>  Aqu√≠ hay un cl√∫ster creado a trav√©s de Terraform.  Puede descargar el archivo para <strong>kubectl</strong> en la pesta√±a "Acceso": <br><br><img src="https://habrastorage.org/webt/y_/pe/ov/y_peovkv0kjznzx95c_vw4wc-4e.png"><br><br>  La misma pesta√±a contiene instrucciones para instalar <strong>kubectl</strong> y usar el <strong>archivo config.yaml</strong> descargado. <br><br>  Despu√©s de iniciar <strong>kubectl</strong> y configurar la variable de entorno <strong>KUBECONFIG,</strong> puede usar Kubernetes: <br><br><pre> <code class="bash hljs">$ kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-9578f5c87-g6bjf 1/1 Running 0 8m kube-system coredns-9578f5c87-rvkgd 1/1 Running 0 6m kube-system heapster-866fcbc879-b6998 1/1 Running 0 8m kube-system kube-dns-autoscaler-689688988f-8cxhf 1/1 Running 0 8m kube-system kubernetes-dashboard-7bdb5d4cd7-jcjq9 1/1 Running 0 8m kube-system monitoring-grafana-84c97bb64d-tc64b 1/1 Running 0 8m kube-system monitoring-influxdb-7c8ccc75c6-dzk5f 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-0 1/1 Running 0 8m kube-system node-exporter-tf-cluster-rz6nggvs4va7-minion-1 1/1 Running 0 8m kube-system openstack-cloud-controller-manager-8vrmp 1/1 Running 3 8m prometeus-monitoring grafana-76bcb7ffb8-4tm7t 1/1 Running 0 8m prometeus-monitoring prometheus-75cdd77c5c-w29gb 1/1 Running 0 8m</code> </pre><br>  El n√∫mero de nodos del cl√∫ster se cambia f√°cilmente a trav√©s de Terraform. <br>  El siguiente valor se especifica en el archivo <strong>main.tf</strong> : <br><br><pre> <code class="bash hljs">cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span></code> </pre><br><p>  Este valor se sustituye de <strong>vars.tf</strong> : </p><br><br><pre> <code class="bash hljs">variable <span class="hljs-string"><span class="hljs-string">"cluster_node_count"</span></span> { default = 2 }</code> </pre><br>  Puede cambiar el valor predeterminado en <strong>vars.tf</strong> o especificar el valor requerido directamente en <strong>main.tf</strong> : <br><br><pre> <code class="bash hljs">- cluster_node_count = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${var.cluster_node_count}</span></span></span><span class="hljs-string">"</span></span> + cluster_node_count = 3</code> </pre><br>  Para aplicar los cambios, como en el caso del primer ejemplo, use el <strong>comando terraform apply</strong> : <br><br><pre> <code class="bash hljs">$ env \ TF_VAR_sel_account=SEL_ACCOUNT \ TF_VAR_sel_token=SEL_TOKEN \ TF_VAR_user_password=USER_PASSWORD \ terraform apply</code> </pre><br>  Cuando cambia el n√∫mero de nodos, el cl√∫ster permanecer√° disponible.  Despu√©s de agregar un nodo a trav√©s de Terraform, puede usarlo sin configuraci√≥n adicional: <br><br><pre> <code class="bash hljs">$ kubectl get nodes NAME STATUS ROLES AGE VERSION tf-cluster-rz6nggvs4va7-master-0 Ready,SchedulingDisabled master 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-0 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-1 Ready &lt;none&gt; 8m v1.12.4 tf-cluster-rz6nggvs4va7-minion-2 Ready &lt;none&gt; 3m v1.12.4</code> </pre><br><h2>  Conclusi√≥n </h2><br>  En este art√≠culo, aprendimos sobre las formas b√°sicas de trabajar con la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">"Nube privada virtual" a</a> trav√©s de Terraform.  Estaremos encantados si utiliza el proveedor oficial de Terraform Selectel y proporciona comentarios. <br><br>  Todos los errores encontrados del proveedor de Terraform, Selectel, se pueden informar a trav√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="noopener noreferrer">Github Issues</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/445162/">https://habr.com/ru/post/445162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445152/index.html">¬øQu√© m√°s se puede hacer en la b√∫squeda? Informe Yandex</a></li>
<li><a href="../445154/index.html">Eventos digitales en Mosc√∫ del 25 al 31 de marzo</a></li>
<li><a href="../445156/index.html">Nebulizador compacto Glenmark: algo √∫til en la vida cotidiana</a></li>
<li><a href="../445158/index.html">√ìptima orientaci√≥n de piezas y configuraci√≥n de soporte en impresora 3D</a></li>
<li><a href="../445160/index.html">Desarrollamos firmware de pedal para aprender a tocar la balalaika</a></li>
<li><a href="../445164/index.html">Rendimiento equilibrado del sitio. Parte 5: usabilidad</a></li>
<li><a href="../445166/index.html">Todo lo que necesita saber sobre la separaci√≥n autom√°tica de guiones CSS</a></li>
<li><a href="../445168/index.html">Un curr√≠culum ideal que ser√° bienvenido por un reclutador y empleador</a></li>
<li><a href="../445170/index.html">Tres grandes mentiras sobre JavaScript</a></li>
<li><a href="../445172/index.html">Los navegadores Edge con Chromium aparecieron en los servicios de alojamiento de archivos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>