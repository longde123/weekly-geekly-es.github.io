<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçü§ù‚Äçüë®üèº üñêüèø üåì Transf√©rer un backend PHP vers le bus de flux Redis et choisir une biblioth√®que ind√©pendante des frameworks üòí üö¥üèΩ üëçüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©face 
 Mon site, que je fais comme passe-temps, est con√ßu pour stocker des pages d'accueil et des sites personnels int√©ressants. Ce sujet a commenc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Transf√©rer un backend PHP vers le bus de flux Redis et choisir une biblioth√®que ind√©pendante des frameworks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483584/"><img src="https://habrastorage.org/webt/wk/hw/mm/wkhwmmingyzwy7-r1esz_9vna54.png"><br><br><h2>  Pr√©face </h2><br>  Mon site, que je fais comme passe-temps, est con√ßu pour stocker des pages d'accueil et des sites personnels int√©ressants.  Ce sujet a commenc√© √† m'int√©resser au tout d√©but de mon parcours en programmation, √† ce moment-l√† j'√©tais ravi de trouver de grands professionnels qui √©crivent sur eux-m√™mes, leurs hobbies et projets.  L'habitude de les d√©couvrir est rest√©e pour l'instant: sur quasiment tous les sites commerciaux et peu nombreux, je continue de fouiller le pied de page √† la recherche de liens vers les auteurs. <br><a name="habracut"></a><br><h2>  Mise en ≈ìuvre de l'id√©e </h2><br>  La premi√®re version √©tait juste une page html sur mon site personnel, o√π je mettais des liens avec des signatures dans une liste ul.  Ayant tap√© 20 pages pendant un certain temps, j'ai commenc√© √† penser que ce n'√©tait pas tr√®s efficace et j'ai d√©cid√© d'essayer d'automatiser le processus.  Sur stackoverflow, j'ai remarqu√© que beaucoup indiquent des sites dans leurs profils, j'ai donc √©crit un analyseur php qui vient de parcourir les profils, en commen√ßant par le premier (adresse sur SO et jusqu'√† ce jour comme ceci: `/ users / 1`), extrait les liens √† partir de la balise souhait√©e et empil√©s dans SQLite. <br><br>  Cela peut √™tre appel√© la deuxi√®me version: une collection de dizaines de milliers d'URL dans une plaque SQLite qui a remplac√© la liste statique en html.  J'ai fait une recherche simple sur cette liste.  Parce que  il n'y avait que des URL, alors la recherche √©tait juste pour eux. <br><br>  √Ä ce stade, j'ai abandonn√© le projet et y suis retourn√©, apr√®s une longue p√©riode.  √Ä ce stade, mon exp√©rience de travail d√©passait d√©j√† trois ans et je sentais que je pouvais faire quelque chose de plus s√©rieux.  De plus, il y avait un grand d√©sir de ma√Ætriser par eux-m√™mes des technologies relativement nouvelles. <br><br><h2>  Version moderne </h2><br>  <a href="https://hpdb.ru/">Le projet a √©t√©</a> d√©ploy√© dans docker, la base de donn√©es a √©t√© transf√©r√©e vers mongoDb et, relativement r√©cemment, des radis ont √©t√© ajout√©s, ce qui √©tait au d√©part juste pour la mise en cache.  Comme base, une des microframes PHP est utilis√©e. <br><br><h4>  Le probl√®me </h4><br>  De nouveaux sites sont ajout√©s par une commande de console qui effectue de mani√®re synchrone ce qui suit: <br><br><ul><li>  T√©l√©charger du contenu par URL <br></li><li>  Indique si HTTPS √©tait disponible <br></li><li>  Pr√©serve l'essence du site Web <br></li><li>  HTML source et en-t√™tes enregistr√©s dans l'historique d'indexation <br></li><li>  Analyse le contenu, r√©cup√®re le titre et la description <br></li><li>  Enregistre les donn√©es dans une collection distincte. <br></li></ul><br>  C'√©tait suffisant pour simplement stocker des sites et les afficher dans une liste: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a4/914/0f8/5a49140f8a7a27eac0e22c21b24ada69.png"><br><br>  Mais l'id√©e d'indexer, de cat√©goriser et de classer automatiquement tout, de tout garder √† jour, convient mal √† ce paradigme.  M√™me l'ajout d'une m√©thode Web pour ajouter des pages a n√©cessit√© la duplication et le blocage de code pour √©viter les DDoS potentiels. <br><br>  En g√©n√©ral, bien s√ªr, tout peut √™tre fait de mani√®re synchrone, et dans la m√©thode Web, enregistrez simplement l'URL pour vous assurer que le d√©mon monstrueux effectue toutes les t√¢ches pour les URL de la liste.  Mais tout de m√™me, m√™me ici, le mot ¬´tour¬ª supplie.  Et si la file d'attente est impl√©ment√©e, toutes les t√¢ches peuvent √™tre divis√©es et ex√©cut√©es au moins de mani√®re asynchrone. <br><br><h4>  Solution </h4><br>  Introduisez des files d'attente et cr√©ez un syst√®me de traitement bas√© sur les √©v√©nements pour toutes les t√¢ches.  Et pendant longtemps, j'ai voulu essayer Redis Streams. <br><br><h2>  Utilisation des flux Redis en PHP </h2><br>  Parce que  Je n'ai pas de framework des trois g√©ants Symfony, Laravel, Yii, et j'aimerais trouver une biblioth√®que ind√©pendante.  Mais, comme il s'est av√©r√© (au premier examen), il est impossible de trouver des biblioth√®ques s√©rieuses individuelles.  Tout ce qui est associ√© aux files d'attente est soit une projection de 3 commits d'il y a cinq ans, soit li√© √† un cadre. <br><br>  J'ai entendu parler de Symfony en tant que fournisseur de certains composants utiles, et j'en utilise d√©j√† certains.  Et aussi depuis Laravel, quelque chose peut aussi √™tre utilis√©, par exemple, leur ORM, sans la pr√©sence du framework lui-m√™me. <br><br><h4>  symfony / messenger </h4><br>  Le premier candidat me parut imm√©diatement id√©al, et sans aucun doute je l'ai install√©.  Mais il √©tait plus difficile de rechercher sur Google des exemples d'utilisation en dehors de Symfony.  Comment collecter √† partir d'un tas de classes avec des noms universels, sans parler, un bus pour envoyer des messages, et m√™me sur Redis? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2b/1bf/ac0/f2b1bfac07a1e307d7b5826a1b191e3d.png"><br><br>  La documentation sur le site officiel √©tait assez d√©taill√©e, mais l'initialisation n'a √©t√© d√©crite que pour Symfony en utilisant leur YML pr√©f√©r√© et d'autres m√©thodes magiques pour un non-symphoniste.  Je n'avais aucun int√©r√™t pour le processus d'installation, surtout pendant les vacances du Nouvel An.  Mais j'ai d√ª le faire pendant une dur√©e inattendue. <br><br>  Essayer de comprendre comment instancier un syst√®me √† l'aide de sources Symfony n'est pas non plus la t√¢che la plus triviale pour des d√©lais serr√©s: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc7/de8/991/bc7de89919463a8e7e4bfc5adec9df27.png"><br><br>  En fouillant dans cela et en essayant de faire quelque chose avec mes mains, je suis arriv√© √† la conclusion que je faisais une sorte de b√©quilles et j'ai d√©cid√© d'essayer autre chose. <br><br><h4>  illuminer / faire la queue </h4><br>  Il s'est av√©r√© que cette biblioth√®que √©tait √©troitement li√©e √† l'infrastructure Laravel et √† un tas d'autres d√©pendances, donc je n'y ai pas pass√© beaucoup de temps: install√©, regard√©, vu les d√©pendances et supprim√©. <br><br><h4>  file d'attente yiisoft / yii2 </h4><br>  Eh bien, ici, il a √©t√© imm√©diatement suppos√© du nom, encore une fois une liaison √©troite √† Yii2.  J'ai d√ª utiliser cette biblioth√®que et ce n'√©tait pas mal, mais je ne pensais pas que cela d√©pendait compl√®tement de Yii2. <br><br><h4>  Le reste </h4><br>  Tout le reste que j'ai trouv√© sur le github √©tait des projections obsol√®tes et abandonn√©es non fiables sans √©toiles, fourches et un grand nombre de commits. <br><br><h2>  Retour √† symfony / messenger, d√©tails techniques </h2><br>  J'ai d√ª m'occuper de cette biblioth√®que et apr√®s avoir pass√© un peu plus de temps, j'ai pu.  Il s'est av√©r√© que tout est assez concis et simple.  Pour l'instanciation du bus, j'ai fait une petite usine, car  J'ai eu plusieurs pneus avec diff√©rents gestionnaires. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/970/723/ab2/970723ab2c86a6b4adfb35f32208fa76.png"><br><br>  Quelques √©tapes: <br><br><ul><li>  Cr√©ez des gestionnaires de messages qui devraient simplement √™tre appelables <br></li><li>  Enveloppez-les dans HandlerDescriptor (classe de la biblioth√®que) <br></li><li>  Nous encapsulons ces ¬´Descripteurs¬ª dans l'instance HandlersLocator. <br></li><li>  Ajouter HandlersLocator √† l'instance MessageBus <br></li><li>  Nous passons √† SendersLocator un ensemble de `SenderInterface`, dans mon cas, les instances des classes` RedisTransport`, qui sont configur√©es de mani√®re √©vidente <br></li><li>  Ajouter SendersLocator √† l'instance MessageBus <br></li></ul><br>  MessageBus a une m√©thode `-&gt; dispatch ()`, qui recherche les gestionnaires appropri√©s dans HandlersLocator et leur transmet le message, en utilisant le `SenderInterface` correspondant pour envoyer via le bus (flux Redis). <br><br>  Dans la configuration du conteneur (dans ce cas php-di), tout ce groupe peut √™tre configur√© comme suit: <br><br><pre><code class="php hljs">CONTAINER_REDIS_TRANSPORT_SECRET =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisTransport( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_SECRET), $c-&gt;get(CONTAINER_SERIALIZER)) ; }, CONTAINER_REDIS_TRANSPORT_LOG =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisTransport( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_LOG), $c-&gt;get(CONTAINER_SERIALIZER)) ; }, CONTAINER_REDIS_STREAM_RECEIVER_SECRET =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisReceiver( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_SECRET), $c-&gt;get(CONTAINER_SERIALIZER) ); }, CONTAINER_REDIS_STREAM_RECEIVER_LOG =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisReceiver( $c-&gt;get(CONTAINER_REDIS_STREAM_CONNECTION_LOG), $c-&gt;get(CONTAINER_SERIALIZER) ); }, CONTAINER_REDIS_STREAM_BUS =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ $sendersLocator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendersLocator([ \App\Messages\SecretJsonMessages::class =&gt; [CONTAINER_REDIS_TRANSPORT_SECRET], \App\Messages\DaemonLogMessage::class =&gt; [CONTAINER_REDIS_TRANSPORT_LOG], ], $c); $middleware[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessageMiddleware($sendersLocator); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageBus($middleware); }, CONTAINER_REDIS_STREAM_CONNECTION_SECRET =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ $host = <span class="hljs-string"><span class="hljs-string">'bu-02-redis'</span></span>; $port = <span class="hljs-number"><span class="hljs-number">6379</span></span>; $dsn = <span class="hljs-string"><span class="hljs-string">"redis://$host:$port"</span></span>; $options = [ <span class="hljs-string"><span class="hljs-string">'stream'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'secret'</span></span>, <span class="hljs-string"><span class="hljs-string">'group'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'consumer'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Connection::fromDsn($dsn, $options); }, CONTAINER_REDIS_STREAM_CONNECTION_LOG =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ContainerInterface $c)</span></span></span><span class="hljs-function"> </span></span>{ $host = <span class="hljs-string"><span class="hljs-string">'bu-02-redis'</span></span>; $port = <span class="hljs-number"><span class="hljs-number">6379</span></span>; $dsn = <span class="hljs-string"><span class="hljs-string">"redis://$host:$port"</span></span>; $options = [ <span class="hljs-string"><span class="hljs-string">'stream'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'log'</span></span>, <span class="hljs-string"><span class="hljs-string">'group'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'consumer'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Connection::fromDsn($dsn, $options); },</code> </pre> <br>  On peut voir que dans SendersLocator, nous avons attribu√© un ¬´transport¬ª diff√©rent pour deux messages diff√©rents, chacun ayant sa propre connexion aux flux correspondants. <br><br>  J'ai fait un projet de d√©monstration s√©par√© d√©montrant une application de trois d√©mons communiquant entre eux √† l'aide d'un tel bus: <a href="https://github.com/backend-university/products/tree/master/products/02-redis-streams-bus">https://github.com/backend-university/products/tree/master/products/02-redis-streams-bus</a> . <br><br>  Mais je vais vous montrer comment organiser un consommateur: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">DaemonLogMessage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>\<span class="hljs-title"><span class="hljs-title">HandlerDescriptor</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>\<span class="hljs-title"><span class="hljs-title">HandlersLocator</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">MessageBus</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Middleware</span></span>\<span class="hljs-title"><span class="hljs-title">HandleMessageMiddleware</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Middleware</span></span>\<span class="hljs-title"><span class="hljs-title">SendMessageMiddleware</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Messenger</span></span>\<span class="hljs-title"><span class="hljs-title">Transport</span></span>\<span class="hljs-title"><span class="hljs-title">Sender</span></span>\<span class="hljs-title"><span class="hljs-title">SendersLocator</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../vendor/autoload.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \Psr\Container\ContainerInterface $container */</span></span> $container = <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'config/container.php'</span></span>); $handlers = [ DaemonLogMessage::class =&gt; [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlerDescriptor( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DaemonLogMessage $m)</span></span></span><span class="hljs-function"> </span></span>{ \error_log(<span class="hljs-string"><span class="hljs-string">'DaemonLogHandler: message handled: / '</span></span> . $m-&gt;getMessage()); }, [<span class="hljs-string"><span class="hljs-string">'from_transport'</span></span> =&gt; CONTAINER_REDIS_TRANSPORT_LOG] ) ], ]; $middleware = []; $middleware[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandleMessageMiddleware(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlersLocator($handlers)); $sendersLocator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendersLocator([<span class="hljs-string"><span class="hljs-string">'*'</span></span> =&gt; [CONTAINER_REDIS_TRANSPORT_LOG]], $container); $middleware[] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SendMessageMiddleware($sendersLocator); $bus = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MessageBus($middleware); $receivers = [ CONTAINER_REDIS_TRANSPORT_LOG =&gt; $container-&gt;get(CONTAINER_REDIS_STREAM_RECEIVER_LOG), ]; $w = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Symfony\Component\Messenger\Worker($receivers, $bus, $container-&gt;get(CONTAINER_EVENT_DISPATCHER)); $w-&gt;run();</code> </pre><br><h2>  Utilisation de cette infrastructure dans une application </h2><br>  Apr√®s avoir impl√©ment√© le bus dans mon backend, j'ai s√©lectionn√© des √©tapes individuelles de l'ancienne √©quipe synchrone et cr√©√© des gestionnaires distincts, chacun √©tant engag√© dans sa propre entreprise. <br><br>  Le pipeline pour ajouter un nouveau site √† la base de donn√©es est le suivant: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1a/ccf/202/f1accf2020c51b0ae5e5c39033d7d375.png"><br><br>  Et juste apr√®s cela, il est devenu beaucoup plus facile pour moi d'ajouter de nouvelles fonctionnalit√©s, par exemple, l'extraction et l'analyse de Rss.  Parce que  √âtant donn√© que ce processus n√©cessite √©galement du contenu source, le gestionnaire-extracteur du lien rss, ainsi que WebsiteIndexHistoryPersistor, s'abonne au message "Content / HtmlContent", le traite et transmet le message souhait√© sur son pipeline. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8cc/641/d52/8cc641d52b4a394c5381967360187ab0.png"><br><br>  En fin de compte, il s'est av√©r√© que plusieurs d√©mons, chacun ne d√©tenant des connexions qu'aux ressources n√©cessaires.  Par exemple, le d√©mon des <i>robots d'indexation</i> contient tous les gestionnaires qui n√©cessitent d'aller sur Internet pour le contenu, et le d√©mon <i>persistant</i> conserve une connexion √† la base de donn√©es. <br><br>  Maintenant, au lieu de s√©lectionner dans la base de donn√©es, l'ID requis apr√®s avoir √©t√© ins√©r√© par la persistance est simplement transmis via le bus √† tous les gestionnaires int√©ress√©s. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483584/">https://habr.com/ru/post/fr483584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483568/index.html">Cr√©er un ordinateur primitif √† partir de z√©ro</a></li>
<li><a href="../fr483570/index.html">Mais que faire si la terre est plate?</a></li>
<li><a href="../fr483574/index.html">Analyse de fiabilit√© des √©quipements √©lectroniques de choc et de vibration - Aper√ßu</a></li>
<li><a href="../fr483578/index.html">Nouvelles du monde d'OpenStreetMap n ¬∞ 493 (12.24.2019 - 12.30.2019)</a></li>
<li><a href="../fr483580/index.html">VIM - Ce n'est pas seulement un √©diteur, c'est une int√©gration avec tout votre environnement de travail</a></li>
<li><a href="../fr483586/index.html">Les bases de l'utilisation de zmq en python, la cr√©ation d'un simple magasin cl√© / valeur</a></li>
<li><a href="../fr483588/index.html">Comment essayer de bloquer n'importe quel site en utilisant ILV</a></li>
<li><a href="../fr483590/index.html">Rechercher une erreur FDCAN qui n'est pas</a></li>
<li><a href="../fr483594/index.html">√âconomie future pour les physiciens</a></li>
<li><a href="../fr483598/index.html">Des oeufs de P√¢ques encore plus musicaux: on continue de parler de cadeaux pour des auditeurs attentifs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>