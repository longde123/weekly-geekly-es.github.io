<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåø üßóüèª ü§Ωüèª Blockchain sans interm√©diaires: comment nous avons envoy√© des titres √† un registre distribu√© üß• üë∏üèº üåù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Historiquement, toute activit√© √©conomique repose sur des interm√©diaires. Toute transaction, m√™me simple, entre les deux parties s'accompagne de l'impl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Blockchain sans interm√©diaires: comment nous avons envoy√© des titres √† un registre distribu√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/442692/">  Historiquement, toute activit√© √©conomique repose sur des interm√©diaires.  Toute transaction, m√™me simple, entre les deux parties s'accompagne de l'implication de diff√©rents interm√©diaires - banques, bourses, chambres de compensation, etc.  L'exclusion des interm√©diaires rendrait probablement l'interaction plus efficace.  Alors pourquoi ne pas essayer de construire une nouvelle infrastructure d√©centralis√©e sur la base de la blockchain, o√π les participants √† la transaction peuvent travailler directement?  Dans cet article, nous parlerons de la fa√ßon dont nous avons commenc√© notre voyage vers une telle infrastructure: nous avons d√©velopp√© des transactions blockchain et, par cons√©quent, effectu√© des repos - emprunter de l'argent contre des titres. <br><br><img src="https://habrastorage.org/webt/5y/08/en/5y08enodezvkfd1qngslkh-pl4y.png"><br><a name="habracut"></a><br><h2>  Obligations √† court terme </h2><br>  Notre premi√®re transaction financi√®re de gr√© √† gr√© sur la blockchain a √©t√© l'√©mission d'une obligation √† court terme de l'op√©rateur mobile MTS avec la participation du National Settlement Depository (NSD).  Il s'agit d'une sorte de ¬´banque centrale¬ª de tous les d√©positaires.  Les d√©positaires sont des interm√©diaires d'infrastructure qui tiennent des registres des propri√©taires de titres et les √©mettent. <br><br>  Dans cette transaction, MTS, en appelant la fonction du contrat intelligent, a enregistr√© dans la blockchain une expression de volont√© de vendre des titres √† Sberbank, et a confirm√© dans la blockchain son accord avec les termes de la transaction.  Les contre-ordres sign√©s par les deux parties ont √©t√© re√ßus par NSD, qui les a ex√©cut√©s dans leurs syst√®mes comptables.  De plus, la blockchain affichait les comptes des participants √† la transaction en titres et en argent. <br><br>  Dans ce projet, nous avons s√©lectionn√© la plateforme open source <i>Hyperledger Fabric 1.1</i> , con√ßue pour cr√©er des solutions de blockchain d'entreprise ferm√©es.  Les cha√Ænes de blocs publiques ne conviennent pas ici, car nous devons garantir la confidentialit√© des donn√©es.  Nous avons rencontr√© de telles limitations dans le pilote d'affacturage de Sberbank avec M. Video, qui a √©t√© impl√©ment√© sur la blockchain Ethereum.  En revanche, Hyperledger Fabric vous permet de placer tous les participants √† une transaction dans un canal d√©di√©, o√π ils peuvent √©changer toutes les informations n√©cessaires et les traiter avec des contrats intelligents complets. <br><br>  Le code source du projet d'√©mission d'obligations MTS a √©t√© t√©l√©charg√© publiquement sur GitHub.  Sans m√™me entrer dans l'algorithme de travail, vous pouvez comprendre que dans le cycle de vie d'une transaction, la blockchain s'est vu confier un r√¥le plut√¥t modeste de transport des ordres de compensation.  En revanche, sur la base de ces instructions, les soldes des comptes ont chang√© - du point de vue de la logique m√©tier, cela √©tait plus int√©ressant qu'un simple service de gestion √©lectronique de documents. <br><br>  Le principal avantage de la solution √©tait sa polyvalence.  Le r√©gime ¬´deux contreparties et un registraire¬ª couvre presque toutes les transactions sur le march√© de gr√© √† gr√© et avec des modifications mineures - la plupart des transactions commerciales en g√©n√©ral. <br><br><h2>  REPO 1.0 </h2><br>  Dans un nouveau projet sur la blockchain, nous avons d√©cid√© de montrer comment mettre en ≈ìuvre un accord de rachat dans un syst√®me d√©centralis√© - un pr√™t d'argent contre des titres.  En r√®gle g√©n√©rale, ces transactions et d'autres transactions de gr√© √† gr√© passent par des interm√©diaires - d√©positaire, chambres de compensation, courtiers. <br><br>  Dans ce projet, nous avons conclu un accord de rachat entre Sberbank et un partenaire √©tranger.  Il utilisait d√©j√† Hyperledger Fabric version 1.2.  Par rapport aux obligations MTS, nous avions deux diff√©rences: <br><br><ul><li>  Seuls deux participants √† la transaction li√©s √† la blockchain, dont les d√©positaires - Euroclear et Clearstream - ont re√ßu toutes les commandes via les canaux de transmission de donn√©es traditionnels des back-offices de Sberbank et de sa contrepartie. <br></li><li>  Dans le contrat intelligent, nous avons mis en ≈ìuvre une logique commerciale complexe: des devis quotidiens de la s√©curit√© qui ont servi de garantie pour le pr√™t ont √©t√© t√©l√©charg√©s dans la blockchain, et le contrat intelligent a calcul√© le besoin et le montant du remboursement anticip√©, en tenant compte du co√ªt modifi√© de la garantie, de l'escompte, du calendrier des √©changes de sortie et d'autres param√®tres.  Une telle synchronisation P2P des algorithmes de calcul entre les participants ne peut pas √™tre obtenue sans un registre distribu√©.  Ceci est beaucoup plus pratique qu'un calcul ind√©pendant des obligations et des montants de chaque c√¥t√© - pas de rapprochements longs, pas de confirmations. <br></li></ul><br>  Entre les contreparties ont organis√© un chat et un workflow au sein du canal.  Les donn√©es les concernant ont √©t√© stock√©es dans la blockchain.  Apr√®s chaque modification du registre distribu√©, les membres du canal ont re√ßu une alerte par e-mail. <br><br>  ¬´REPO 1.0¬ª, nous avons travaill√© du c√¥t√© juridique.  Avec l'aide d'un grand cabinet d'avocats, une analyse des affaires de la Haute Cour de Londres a √©t√© r√©alis√©e.  De plus, l'EDS de la banque et de sa contrepartie a utilis√© diff√©rents algorithmes cryptographiques. <br><br><h3>  Comment fonctionne REPO 1.0? </h3><br>  Chaque partie √† la transaction a son propre n≈ìud de cha√Æne de blocs.  Tous les n≈ìuds sont connect√©s les uns aux autres dans un r√©seau P2P.  Supposons que vous deviez conclure un accord.  Nous d√©ployons un contrat intelligent entre les parties √† la transaction, o√π l'instrument financier est enti√®rement d√©crit. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f42/e38/b7e/f42e38b7e23eac1217952790f217a4e9.png"><br><br>  Apr√®s la cr√©ation du contrat de notre c√¥t√©, il est sign√© par le commer√ßant.  Le client examine et signe √©galement le contrat.  Ensuite, les signatures sont examin√©es et v√©rifi√©es.  Dans ce cas, la transaction a √©t√© effectu√©e en vertu du droit anglais, les donn√©es sur la signature num√©rique √©lectronique ont √©t√© saisies dans le document GMRA.  Pour la signature du client, la v√©rification est n√©cessaire qu'une personne autoris√©e soit pr√©sente dans le certificat de signature.  Enfin, le client accepte le contrat et accepte toutes les conditions.  Vous pouvez joindre n'importe quel nombre de documents √† un contrat sign√©. <br><br>  Apr√®s cela, le contrat re√ßoit le statut "en activit√©".  Le contrat ¬´en cours¬ª est automatiquement recalcul√© lors du chargement des nouveaux prix du march√©.  S'il y a un titre dans le contrat, le prix du march√© est pris, le Loan-To-Value (LTV) est recalcul√© - le rapport entre le montant du pr√™t et la valeur du titre en titres.  LTV est l'un des termes cl√©s d'une op√©ration de mise en pension, sa signification est prescrite dans le contrat.  Le cours de l'action a fortement augment√© - et le LTV devient inf√©rieur √† celui indiqu√© dans le GMRA (en ce qui concerne la loi anglaise).  En cons√©quence, la banque rend les titres au client (comme l'une des options), car compte tenu des nouveaux prix, il s'av√®re que la banque d√©tient une s√©curit√© plus √©lev√©e. <br><br>  Mais si LTV devient plus grand, le programme vous permet d'imprimer un avis de garantie - une notification au client sur la n√©cessit√© de faire une s√©curit√© suppl√©mentaire (actions ou argent) afin que la valeur LTV revienne √† celle initiale.  Auparavant, l'avis de garantie ne pouvait √™tre envoy√© que par courrier, des documents distincts √©taient cr√©√©s √† cet effet et lors de la cr√©ation de ces documents, LTV pouvait √† nouveau changer.  Maintenant, nous voyons les m√™mes calculs avec le client en ligne, nous pouvons facilement interagir. <br><br>  De plus, le programme fixe chaque jour le prix du rachat de titres en tenant compte des int√©r√™ts.  Si le client est en d√©saccord lors du chargement du prix du march√©, il regarde le journal de recalcul complet - ce qui √©tait, ce qui est devenu, quel prix a √©t√© charg√©, d'o√π il vient.  Et puis la discussion par chat commence. <br><br><h2>  REPO 2.0 </h2><br>  Nous voulions que notre REPO sur la blockchain puisse initier le mouvement des actifs r√©els sur la base de notre logique interne.  Mais dans REPO 1.0, en raison de difficult√©s organisationnelles avec la connexion des d√©positaires occidentaux, nous n'avons pas encore pu y parvenir.  Nous avons donc commenc√© le nouveau pilote Repo 2.0.  Il avait deux buts: <br><br><ul><li>  La transaction devrait √™tre r√©alis√©e avec la participation de deux parties et du d√©positaire, afin de tirer le meilleur parti de l'infrastructure du projet obligataire MTS. <br></li><li>  La blockchain doit √™tre habilit√©e √† r√©√©valuer les garanties et √† mettre en place un appel de marge qui pourrait √™tre automatiquement ex√©cut√© par un d√©positaire connect√© √† un r√©seau distribu√©. <br></li></ul><br>  NSD a imm√©diatement voulu se connecter au projet.  Afin de d√©crocher une transaction initi√©e dans la blockchain sur le domaine conservateur des lois f√©d√©rales r√©gissant le march√© financier national, nous avons travaill√© avec des avocats pour un accord compl√©mentaire de cinq pages √† l'accord de gestion √©lectronique des documents.  Il a √©t√© sign√© par toutes les parties √† la transaction et NSD. <br><br>  NSD a agi comme chambre de compensation dans cette transaction.  Il a ex√©cut√© toutes les instructions sur le mouvement des fonds et des titres.  Cette transaction a √©t√© conclue en vertu du droit russe. <br><br>  Le client a accept√© le contrat avec une signature √©lectronique.  Ensuite, l'accord a √©t√© accept√© par Sberbank avec sa signature - il a v√©rifi√© la conformit√© de tous les param√®tres avec les valeurs n√©cessaires et l'autorit√© de la personne qui a accept√© du client.  Apr√®s cela, le contrat est entr√© en vigueur.  NSD a t√©l√©charg√© les donn√©es du march√©, le contrat intelligent recalcul√©. <br><br><h3>  Comment fonctionne REPO 2.0? </h3><br>  Pour d√©ployer le r√©seau et interagir avec l'interface client avec le code de cha√Æne, nous avons utilis√© la solution <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fabric Starter</a> .  Au lieu de l'interface grpc standard pour HLF, il fournit une API REST, qui dans notre cas a consid√©rablement r√©duit la complexit√© de l'int√©gration. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07a/86a/997/07a86a997c7017a122b03aad7995f6ad.png"><br><br>  Le r√©seau a augment√© comme suit.  Apr√®s la pr√©-installation sur le serveur Docker, chacun des trois c√¥t√©s a lanc√© Fabric Starter, qui a cr√©√© des conteneurs avec les composants du n≈ìud.  Ces composants comprenaient un homologue externe pour interagir avec d'autres organisations et un service d'API REST via lequel le n≈ìud interagissait avec l'application cliente.  Lors du d√©marrage de Starter, le r√©seau de la cha√Æne de blocs a √©galement √©t√© configur√© et un canal priv√© a √©t√© cr√©√© dans lequel le code de cha√Æne avec la politique d'approbation a √©t√© install√©.  Dans notre cas, chaque transaction doit avoir la signature des trois participants. <br><br>  Au cours de la phase de test, Docker Swarm a √©t√© utilis√© pour organiser la connexion des serveurs des participants, mais dans le but de conclure un accord r√©el, ils sont pass√©s au DNS.  La plateforme elle-m√™me est responsable du transport des messages; les donn√©es sont transmises sur Internet avec le cryptage TLS. <br><br><h2>  Le c√¥t√© technique du probl√®me </h2><br>  Le processus de d√©veloppement d'une application distribu√©e sur HLF commence assez traditionnellement - avec des structures de donn√©es et un code de cha√Æne (en fait, un ensemble de proc√©dures stock√©es), dont l'appel conduit √† la conservation, la modification ou la lecture de ces structures depuis le grand livre.  La plate-forme permet l'utilisation de divers langages de programmation pour le d√©veloppement de codes de cha√Æne et de SGBD pour le stockage local.  Nous pr√©f√©rons Go et CouchDB, respectivement. <br><br>  L'essence centrale des projets de mise en pension dans notre mod√®le de donn√©es est le contrat lui-m√™me et ses obligations subsidiaires.  Ils ont √©t√© cr√©√©s pour chacun des deux pilotes, ainsi que pour les appels de marge.  Cette architecture √©tait un pas en avant par rapport au mod√®le obligataire MTS, qui √©tait bas√© sur l'essence de l '¬´Ordre¬ª.  Des objets ind√©pendants ont √©galement √©t√© cr√©√©s pour les titres, qui ont ainsi √©t√© partiellement symbolis√©s.  Mais le d√©veloppement de l'exp√©rience avec la gestion des comptes et la tokenisation virtuelle de l'argent, nous avons d√©cid√© de reporter √† l'une des prochaines versions de la solution. <br><br>  Les principales fonctions de notre solution: <br><br><ul><li>  Cr√©ez un contrat. <br></li><li>  Signez un contrat avec votre EDS confirmant l'acceptation des termes du contrat. <br></li><li>  T√©l√©chargez les prix du march√© et commencez √† recalculer la valeur des garanties.  Son √©cart par rapport au seuil fix√© a entra√Æn√© la cr√©ation d'une nouvelle obligation d'appel de marge. <br></li><li>  Refl√©ter le statut de l'obligation. <br></li></ul><br>  Sur le plan technique, la proc√©dure de r√©√©valuation est ici la plus int√©ressante.  Analysons-le plus en d√©tail. <br><br>  Dans le processus op√©rationnel, la proc√©dure devrait √™tre lanc√©e une fois par jour, apr√®s que l'Oracle (dans le pilote de ¬´REPO 2.0¬ª ex√©cut√© par NSD) ait t√©l√©charg√© les cotations mises √† jour des titres dans le syst√®me. <br><br><pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *CIBContract)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">recalculationData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stub shim.ChaincodeStubInterface, loadData *loadDataType, curDay </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pb</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Response</span></span></span></span> {...}</code> </pre> <br>  Le cycle principal de la proc√©dure passe par tous les titres pour lesquels les cotations ont √©t√© mises √† jour. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, securities := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> loadData.Securities {...}</code> </pre> <br>  Ensuite, plusieurs contr√¥les sont effectu√©s.  Par exemple, si l'√©change avec lequel les donn√©es du march√© ont √©t√© re√ßues est aujourd'hui un jour de cong√©, le recomptage ne devrait pas avoir lieu. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> t.checkHoliday(stub, contract.Settings.Calendars) == <span class="hljs-string"><span class="hljs-string">"yes"</span></span> { hisYes := historyType{curDay, <span class="hljs-string"><span class="hljs-string">"LoadData. Calendar"</span></span>, <span class="hljs-string"><span class="hljs-string">"System"</span></span>, <span class="hljs-string"><span class="hljs-string">"LoadData. Today is holiday ! No load market data to contract !"</span></span>} ... contract.History = <span class="hljs-built_in"><span class="hljs-built_in">append</span></span>(contract.History, hisYes) ‚Ä¶ err = stub.PutState(contrID, contractJSONasBytes) }</code> </pre><br>  Pour calculer le prix de l'obligation mis √† jour, le rendement du coupon couru (NDC) est ajout√© au prix net charg√©.  Le pilote a mis en ≈ìuvre la prise en charge du sch√©ma 30/360 pour le calcul des NKD. <br><br><pre> <code class="go hljs">priceIzm = <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>(securities.Price + <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>(securities.CouponRate)*<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(settlementDate.Year()) - <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(dateStart.Year()))*<span class="hljs-number"><span class="hljs-number">360</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(settlementDate.Month()) - <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(dateStart.Month()))*<span class="hljs-number"><span class="hljs-number">30</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(settlementDate.Day()) - <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(dateStart.Day())))*<span class="hljs-number"><span class="hljs-number">100</span></span>/<span class="hljs-number"><span class="hljs-number">360</span></span>/<span class="hljs-number"><span class="hljs-number">100</span></span>) curCurrVal = priceIzm</code> </pre><br>  Si la devise de transaction est diff√©rente de la devise dans laquelle le titre est cot√©, une conversion de change est effectu√©e. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> contract.GeneralTerms.PurchasePrice.Currency != securities.Currency { curCurrName = securities.Currency + <span class="hljs-string"><span class="hljs-string">"-"</span></span> + contract.GeneralTerms.PurchasePrice.Currency               <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, currency := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> loadData.Currencies {              <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> currency.Name == curCurrName {                           curCurrVal = priceIzm * currency.Value } } }</code> </pre><br>  Maintenant, nous devons calculer LTV.  Conservez l'ancienne valeur du coefficient pour l'histoire. <br><br><pre> <code class="go hljs">oldCurLTV := contract.MarginingTerms.CurrentLTV</code> </pre> <br>  Il est n√©cessaire de prendre en compte les appels de marge ex√©cut√©s pendant la dur√©e de la transaction.  Les exigences peuvent provenir des deux c√¥t√©s et sous deux formes: <br><br><ul><li>  Valeurs mobili√®res.  L'emprunteur apporte une garantie suppl√©mentaire en cas de baisse du prix de march√© de la garantie.  Le cr√©ancier retourne une partie de la garantie en cas d'augmentation de prix. <br></li><li>  L'argent.  L'emprunteur rembourse √† l'avance la partie du pr√™t qui a cess√© d'√™tre couverte par des garanties moins ch√®res.  Le pr√™teur augmente le montant du pr√™t en r√©ponse √† une augmentation de la valeur de la garantie. <br></li></ul><br>  Dans le premier cas, le montant des titres de la garantie est simplement mis √† jour.  Et en cas de gagner de l'argent sur eux, il est √©galement n√©cessaire d'accumuler la rentabilit√© sp√©cifi√©e dans les conditions suppl√©mentaires de la transaction. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, addCollateral := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> contract.MarginingTerms.AddCollateral { currSumCollateral := addCollateral.Sum + (addCollateral.Sum*contract.MarginingTerms.RateOnCashMargin*<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>(deltaColDate) / <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>(contract.MarginingTerms.Basis))/<span class="hljs-number"><span class="hljs-number">100</span></span> ... allSumCollateral = allSumCollateral + currSumCollateral ... ht := historyType{curDay, System<span class="hljs-string"><span class="hljs-string">", "</span></span>LoadData. Recalculation data(addCollateral) Contract <span class="hljs-string"><span class="hljs-string">" + contrID + "</span></span> - currSumCollateral: <span class="hljs-string"><span class="hljs-string">" + strconv.FormatFloat(float64(currSumCollateral), 'f', 2, 64) ... }        ... contract.History = append(contract.History, ht) }</span></span></code> </pre> <br>  Nous calculons le montant total du rachat - en fait, c'est le montant du pr√™t avec int√©r√™t, que nous devons rembourser. <br><br><pre> <code class="go hljs">rePurchasePriceCur := contract.GeneralTerms.PurchasePrice.Sum + (contract.GeneralTerms.PurchasePrice.Sum*contract.GeneralTerms.RepoRate*<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>(deltaSigningDate)/<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>(contract.MarginingTerms.Basis))/<span class="hljs-number"><span class="hljs-number">100</span></span></code> </pre><br>  Maintenant, nous calculons le coefficient LTV.  Pour ce faire, soustrayez le titre en esp√®ces du prix de rachat et divisez la valeur r√©sultante par la valeur totale des titres du titre.  Les montants cr√©dit√©s par le cr√©ancier sont marqu√©s d'un ¬´-¬ª et seront ajout√©s au prix de rachat. <br><br><pre> <code class="go hljs">contract.MarginingTerms.CurrentLTV = (rePurchasePriceCur - allSumCollateral) * <span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) / (<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>(contract.GeneralTerms.PurchasedSecurities.Quantity) * curCurrVal)</code> </pre><br>  Enfin, nous calculons les d√©clencheurs du contrat.  La m√™me proc√©dure cr√©e des objets d'ordre d'appel de marge si la valeur LTV s'√©carte du couloir sp√©cifi√©. <br><br><pre> <code class="go hljs">contract = t.checkTriggerEvents(stub, <span class="hljs-string"><span class="hljs-string">"LoadData"</span></span>, contract, curDay, securities)</code> </pre><br>  Et √©crivez des informations dans l'historique pour les afficher sur l'interface utilisateur. <br><br><pre> <code class="go hljs">ht := historyType{curDay, <span class="hljs-string"><span class="hljs-string">"System"</span></span>, <span class="hljs-string"><span class="hljs-string">"LoadData. Recalculation data(change curLTV, ADTV) Contract "</span></span> + contrID + <span class="hljs-string"><span class="hljs-string">" - oldCurLTV: "</span></span> + strconv.FormatFloat(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>(oldCurLTV), <span class="hljs-string"><span class="hljs-string">'f'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>) + <span class="hljs-string"><span class="hljs-string">", newCurLTV: "</span></span> + strconv.FormatFloat(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>(contract.MarginingTerms.CurrentLTV), <span class="hljs-string"><span class="hljs-string">'f'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>)...} contract.History = <span class="hljs-built_in"><span class="hljs-built_in">append</span></span>(contract.History, ht)</code> </pre> <br><h2>  Pour r√©sumer </h2><br>  Un tel r√©gime peut fonctionner non seulement avec des titres et des contrats, mais aussi dans d'autres sc√©narios.  Par exemple, avec les approvisionnements en √©lectricit√©, o√π il y a diff√©rents tarifs, diff√©rentes connexions √† diff√©rents moments.  Ou avec l'affacturage - pr√™t aux fournisseurs par des signaux d'exp√©dition de marchandises.  Il existe de nombreux cas d'utilisation en √©conomie, lorsque chacun utilise ses propres sources de donn√©es qui doivent √™tre v√©rifi√©es. <br><br>  Notre objectif est de cr√©er un r√©seau qui relie les banques entre elles et leurs clients √† l'√©chelle nationale, et en utilisant des contrats intelligents pour y d√©crire des contrats non pas de crypto, mais de l'√©conomie traditionnelle - les instruments financiers.  Un tel r√©seau sera stable, ouvert et, comme il devrait l'√™tre dans un r√©seau P2P, personne ici n'aura un statut sp√©cial. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442692/">https://habr.com/ru/post/fr442692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442680/index.html">Les technologies de remplacement sensoriel vous permettront de voir le monde √† l'aide des sons: comment fonctionne la neuroplasticit√© du cerveau humain</a></li>
<li><a href="../fr442684/index.html">Performance du site √©quilibr√©e. Partie 3: Contenu</a></li>
<li><a href="../fr442686/index.html">Tutoriel DataPower</a></li>
<li><a href="../fr442688/index.html">L'analyse des donn√©es Scala - un besoin urgent ou une opportunit√© agr√©able?</a></li>
<li><a href="../fr442690/index.html">Mission lunaire "Bereshit" - selfie sur le fond de la Terre</a></li>
<li><a href="../fr442694/index.html">L'un des g√©ants du streaming lanc√© en Inde et a attir√© un million d'utilisateurs en une semaine</a></li>
<li><a href="../fr442696/index.html">S for Security: Internet Security of Things and reports at InoThings ++ 2019</a></li>
<li><a href="../fr442698/index.html">Application du m√©tro de Moscou pour le Windows Store</a></li>
<li><a href="../fr442700/index.html">Cela vaut-il la peine de traiter avec des centrales solaires mobiles?</a></li>
<li><a href="../fr442702/index.html">√Ä propos de la magistrature Tinkoff.ru au MIPT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>