<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯТЯ тШБя╕П ЁЯЧгя╕П рдПрдВрдбреНрд░реЙрдпрдбред рд╕рддрд╣ ЁЯОБ тЩВя╕П ЁЯЪ│</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рддреНрдпрд╛рдЧ 


 рдпрд╣ рд▓реЗрдЦ рд╢реБрд░реБрдЖрддреА рдПрдВрдбреНрд░реЙрдЗрдб рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рд▓рд┐рдП рдЗрд░рд╛рджрд╛ рд╣реИ, рдЬреЛ рд╡реАрдбрд┐рдпреЛ рдФрд░ / рдпрд╛ рдХреИрдорд░реЗ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдереЛрдбрд╝реЗ рд╕реЗ рдЕрдиреБрднрд╡ рдХреЗ рд╕рд╛рде рд╣реИрдВ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЬрд┐рдиреНрд╣...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдПрдВрдбреНрд░реЙрдпрдбред рд╕рддрд╣</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480878/"><h2 id="diskleymer">  рддреНрдпрд╛рдЧ </h2><br><p>  рдпрд╣ рд▓реЗрдЦ рд╢реБрд░реБрдЖрддреА рдПрдВрдбреНрд░реЙрдЗрдб рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рд▓рд┐рдП рдЗрд░рд╛рджрд╛ рд╣реИ, рдЬреЛ рд╡реАрдбрд┐рдпреЛ рдФрд░ / рдпрд╛ рдХреИрдорд░реЗ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдереЛрдбрд╝реЗ рд╕реЗ рдЕрдиреБрднрд╡ рдХреЗ рд╕рд╛рде рд╣реИрдВ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ <a href="https://github.com/google/grafika" rel="nofollow">рдЧреНрд░рд╛рдлрд┐рдХрд╛</a> рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛ рд╣реИ рдФрд░ рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ рдЙрдиреНрд╣реЗрдВ рдореБрд╢реНрдХрд┐рд▓ рдкрд╛рдпрд╛, рдпрд╣рд╛рдВ рд╣рдо рдЗрд╕реА рддрд░рд╣ рдХреЗ рдХреЛрдб рдХреЛ рджреЗрдЦреЗрдВрдЧреЗ, рдЬреЛ рдХрд┐ <a href="https://github.com/google/grafika" rel="nofollow">рд╕реНрдЯреЗрдЯреНрд╕ рдХрд┐рд▓реЛрдЧреНрд░рд╛рдо</a> рджреНрд╡рд╛рд░рд╛ рдЪрд┐рддреНрд░рд┐рдд рдмреБрдирд┐рдпрд╛рджреА рдЪрд░рдгреЛрдВ рдХреЗ рд╕рд░рд▓реАрдХреГрдд рд╡рд┐рд╡рд░рдг рдХреЗ рд╕рд╛рде рд╣реЛрдЧрд╛ред </p><br><p>  рд╣реЗрдбрд░ рдореЗрдВ рд╕рд░рдлреЗрд╕ рдХреНрд▓рд╛рд╕ рдХрд╛ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреНрдпреЛрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ?  рдПрдВрдбреНрд░реЙрдЗрдб рдореЗрдВ, рдХрдИ рд╡рд░реНрдЧреЛрдВ рдореЗрдВ рдЙрдирдХреЗ рдирд╛рдо рдореЗрдВ <em>рд╕рд░рдлреЗрд╕</em> рд╢рдмреНрдж рд╣реЛрддрд╛ рд╣реИ (рд╕рд░рдлреЗрд╕, рд╕рд░рдлреЗрд╕рд╣реЙрд▓реНрдбрд░, рд╕рд░рдлреЗрд╕рдЯреЗрдХреНрд╕реНрдЯ, рд╕рд░реНрдлреЗрд╕ рд╡реНрдпреВ, GLSurfaceView), рд╡реЗ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдкрджрд╛рдиреБрдХреНрд░рдо рд╕реЗ рдЬреБрдбрд╝реЗ рдирд╣реАрдВ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╡реЗ рдЫрд╡рд┐ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рдореНрди-рд╕реНрддрд░реАрдп рддрд░реНрдХ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдпреБрдХреНрдд рд╣реИрдВред  рдПрд╕рдбреАрдХреЗ рдХреЗ рдЗрд╕ рд╡рд┐рд╢реЗрд╖ рднрд╛рдЧ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд╛ рдЦреБрд▓рд╛рд╕рд╛ рдХрд░рдиреЗ рдХреЗ рдкреНрд░рдпрд╛рд╕ рдкрд░ рдЬреЛрд░ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╢реАрд░реНрд╖рдХ рдореЗрдВ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдореБрдЭреЗ рдЙрдЪрд┐рдд рд▓рдЧрд╛ред </p><a name="habracut"></a><br><h2 id="primer-ispolzovaniya-s-raznym-api">  рд╡рд┐рднрд┐рдиреНрди рдПрдкреАрдЖрдИ рдХреЗ рд╕рд╛рде рдЙрджрд╛рд╣рд░рдг рдЙрдкрдпреЛрдЧ </h2><br><p>  рдЖрдЗрдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рд▓рд┐рдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ: <strong>рд╣рдо рдХреИрдорд░реЗ рд╕реЗ рдПрдХ рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рд▓реЗрдВрдЧреЗ, рдЙрд╕ рдкрд░ рдПрдХ рдПрдирд┐рдореЗрдЯреЗрдб рдбреНрд░реЙрдмрд▓ рдУрд╡рд░рд▓реЗ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕реЗ рд╕реНрдХреНрд░реАрди рдкрд░ рд╕рднреА рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдВрдЧреЗ рдФрд░ рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдЗрд╕реЗ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдкрд░ рд▓рд┐рдЦреЗрдВред</strong>  рдкреВрд░рд╛ рдХреЛрдб <a href="https://github.com/tttzof351/AndroidSurfaceExample/" rel="nofollow">https://github.com/tttzof351/AndroidSurfaceExample/</a> рд╣реЛрдЧрд╛ </p><br><p>  рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП, рд╣рдо <a href="https://developer.android.com/reference/android/opengl/GLSurfaceView" rel="nofollow">рдореАрдбрд┐рдпрд╛рдХреЛрдб</a> рдФрд░ <a href="https://developer.android.com/reference/android/opengl/EGLSurface" rel="nofollow">рдИрдЬреАрдПрд▓рдПрд╕рдпреВрдЖрд░рдПрд╕рдлреЗрд╕ рдХрдХреНрд╖рд╛рдУрдВ рдХреЗ</a> рд╕рд╛рде рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП <a href="https://developer.android.com/reference/android/opengl/GLSurfaceView" rel="nofollow">GLSurfaceView</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдФрд░ <a href="https://developer.android.com/reference/android/hardware/camera2/package-summary" rel="nofollow">рдПрдкреАрдЖрдИ V2 рдХреЗ</a> рдорд╛рдзреНрдпрдо рд╕реЗ рдХреИрдорд░реЗ рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░реЗрдВрдЧреЗред  рд╕рд╛рдорд╛рдиреНрдп рдпреЛрдЬрдирд╛ рд▓рдЧрднрдЧ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/9o/rc/o5/9orco54m0chpg_og4db_qppsrjm.png"></p><br><h2 id="nalozhenie-neskolkih-surface">  рдорд▓реНрдЯреАрдкрд▓ рд╕рд░рдлреЗрд╕ рдУрд╡рд░рд▓реЗ </h2><br><p>  рд╕рддрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕реНрдореГрддрд┐ рдореЗрдВ рдЙрд╕ рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдПрдХ рд╣реИрдВрдбрд▓ рд╣реИ рдЬрд┐рд╕реЗ рдЫрд╡рд┐ рд╕реЗ рднрд░рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ, рд╣рдо рдЗрд╕реЗ рд╕реНрдХреНрд░реАрди рдкрд░ рдпрд╛ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдбреЗрдЯрд╛ рдмрдирд╛рдиреЗ рд╡рд╛рд▓реА рдХреБрдЫ "рдкреНрд░рдХреНрд░рд┐рдпрд╛" рдХреЗ рд▓рд┐рдП рдмрдлрд░ рдХреА рддрд░рд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдХрдИ рд╕рд░реНрдлреЗрд╕ рд╕реЗ рдУрд╡рд░рд▓реЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рдУрдкрдирдЬреАрдПрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br>  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рджреЛ рд╡рд░реНрдЧ рдмрд╛рд╣рд░реА рдмрдирд╛рд╡рдЯ рдмрдирд╛рдПрдВрдЧреЗ рдФрд░ рдЙрдирд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗ </p><br><p>  рдХреЛрдб рдореЗрдВ, рдпрд╣ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛: </p><br><p>  <a href="" rel="nofollow">OpenGLExtarnalTexture.kt</a> </p><br><pre><code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> textures = IntArray(<span class="hljs-number"><span class="hljs-number">1</span></span>) GLES20.glGenTextures(<span class="hljs-number"><span class="hljs-number">1</span></span>, textures, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> textureId = textures[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-comment"><span class="hljs-comment">//    val textureWidth = ... val textureHeight = ... //  val surfaceTexture = SurfaceTexture(textureId) surfaceTexture.setDefaultBufferSize(textureWidth, textureHeight) //, surface  ""    val surface = Surface(surfaceTexture)</span></span></code> </pre> <br><p>  <strong>XYZ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ</strong> </p><br><p>  рдЕрдм рд╣рдореЗрдВ рдпрд╣ рд╕рдордЭрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдмрдирд╛рд╡рдЯ рдХреИрд╕реЗ рдмрдирд╛рдПрдВ рдФрд░ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░реЗрдВ, рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдпрд╣ рдпрд╛рдж рд░рдЦрдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдУрдкреЗрдирдЧреНрд▓ рдореЗрдВ рд╕рдордиреНрд╡рд┐рдд рдЧреНрд░рд┐рдб рдХреИрд╕реЗ рд╕рдВрд░рдЪрд┐рдд рд╣реИ: рдЗрд╕рдХрд╛ рдХреЗрдВрджреНрд░ рджреГрд╢реНрдп (рдЦрд┐рдбрд╝рдХреА) рдХреЗ рдХреЗрдВрджреНрд░ рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рдФрд░ рд╕реАрдорд╛рдПрдВ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд╣реИрдВ, рдЕрд░реНрдерд╛рддреН -1 рд╕реЗ 1 рддрдХред </p><br><p>  рдЗрд╕ рджреГрд╢реНрдп рдореЗрдВ, рд╣рдо рджреЛ рдЖрдпрддреЗрдВ рд╕реЗрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ (рдХрд╛рдо рд╡рд┐рдорд╛рди рдкрд░ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рднреА z рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рддрд╛рд░реНрдХрд┐рдХ рд░реВрдк рд╕реЗ 0f рдкрд░ рд╕реЗрдЯ рд╣реИрдВ) - рд▓рд╛рд▓ рд░рдВрдЧ рдореЗрдВ рд╣рдо рдПрдХ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдВрдЧреЗ рдЬрд╣рд╛рдВ рд╣рдо рдХреИрдорд░реЗ рдХреЗ рд▓рд┐рдП рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдПрдирд┐рдореЗрдЯреЗрдб рдбреНрд░рд╛ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдХреЗ рд▓рд┐рдП рдиреАрд▓реЗ рд░рдВрдЧ рдореЗрдВ: </p><br><p>  рд╣рдо рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЕрдкрдиреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд▓рд┐рдЦрддреЗ рд╣реИрдВ: </p><br><p><img src="https://habrastorage.org/webt/mu/fj/kr/mufjkrznafatofs4lsn-ywm_h7i.png"></p><br><pre> <code class="kotlin hljs">fullscreenTexture = floatArrayOf( <span class="hljs-comment"><span class="hljs-comment">// X, Y, Z -1.0f, -1.0f, 0.0f, 1.0f, -1.0f, 0.0f, -1.0f, 1.0f, 0.0f, 1.0f, 1.0f, 0.0f, ) smallTexture = floatArrayOf( // X, Y, Z 0.3f, 0.3f, 0.0f, 0.8f, 0.3f, 0.0f, 0.3f, 0.8f, 0.0f, 0.8f, 0.8f, 0.0f )</span></span></code> </pre> <br><p>  <strong>рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ</strong> </p><br><p>  рдХреНрдпрд╛ рдпрд╣ рдкрд░реНрдпрд╛рдкреНрдд рд╣реИ?  рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рд╣реИ рдХрд┐ рдирд╣реАрдВ :( </p><br><p>  рдПрдХ рдмрдирд╛рд╡рдЯ рдПрдХ рджреГрд╢реНрдп рдХреНрд╖реЗрддреНрд░ рдХреА рддрд╕реНрд╡реАрд░ рдХрд╛ рдорд╛рдирдЪрд┐рддреНрд░рдг рд╣реИ рдФрд░ рдЗрд╕реЗ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдЪрд┐рддреНрд░ рдХреЗ рдмрд┐рдВрджреБ рдЗрд╕ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдХрд╣рд╛рдВ рдЧрд┐рд░реЗрдВрдЧреЗ - рдЗрд╕рдХреЗ рд▓рд┐рдП, рдУрдкрдирдЬреАрдПрд▓ <strong>рдпреВрд╡реА</strong> рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ - рд╡реЗ рдирд┐рдЪрд▓реЗ рдмрд╛рдПрдВ рдХреЛрдиреЗ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд▓рд┐рдП 0 рд╕реЗ 1 рддрдХ рдХреА рд╕реАрдорд╛рдПрдБ рд╣реЛрддреА рд╣реИрдВред рдХреБрд▓реНрд╣рд╛рдбрд╝рд┐рдпреЛрдВред </p><br><p>  рдпрд╣ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ - рд╣рдо рдЕрдкрдиреЗ рдХреНрд╖реЗрддреНрд░ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╢реАрд░реНрд╖ рдХреЗ рд▓рд┐рдП <strong>рдпреВрд╡реА</strong> рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдЫрд╡рд┐ рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рдмрд┐рдВрджреБрдУрдВ рдХреА рддрд▓рд╛рд╢ рдХрд░реЗрдВрдЧреЗ, рдпрд╣ рдорд╛рдирддреЗ рд╣реБрдП рдХрд┐ рдЪреМрдбрд╝рд╛рдИ рдФрд░ рдКрдВрдЪрд╛рдИ 1 рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред </p><br><p>  рдПрдХ рдЙрджрд╛рд╣рд░рдг рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ - рд╣рдо рдорд╛рди рд▓реЗрдВрдЧреЗ рдХрд┐ рдХреИрдорд░рд╛ рд╣рдореЗрдВ рдПрдХ рдЙрд▓реНрдЯреЗ рдФрд░ рдкрд░рд┐рд▓рдХреНрд╖рд┐рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЫрд╡рд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рд╕рд╛рде рд╣реА рд╣рдо рдХреЗрд╡рд▓ рд╕рд╣реА-рдКрдкрд░реА рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рджрд┐рдЦрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рддреН рдЫрд╡рд┐ рдХреЗ рдЕрдХреНрд╖рд╛рдВрд╢ рдФрд░ рдКрдВрдЪрд╛рдИ рдореЗрдВ 0.8 рд▓реЗрддреЗ рд╣реИрдВред </p><br><p>  рд╕реВрдХреНрд╖реНрдо рдмрд┐рдВрджреБ - рдЗрд╕ рд╕реНрддрд░ рдкрд░ рд╣рдо рд╕реНрдХреНрд░реАрди рдкрд░ рдХреНрд╖реЗрддреНрд░ рдХреЗ рдкрд╣рд▓реВ рдЕрдиреБрдкрд╛рдд рдХреЛ рдирд╣реАрдВ рдЬрд╛рдирддреЗ рд╣реИрдВ - рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ рд╕рд╛рдкреЗрдХреНрд╖ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рдПрдХ рд╡рд░реНрдЧ рд╣реИ, рдЬреЛ рдкреВрд░реЗ рджреГрд╢реНрдп рдХреЛ рднрд░ рджреЗрдЧрд╛ рдФрд░ рддрджрдиреБрд╕рд╛рд░ рдЦрд┐рдВрдЪрд╛рд╡ рдХрд░реЗрдЧрд╛ред  рдпрджрд┐ рд╣рдо рдПрдХ рдлреБрд▓рд╕реНрдХреНрд░реАрди рдХреИрдорд░рд╛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдереЗ, рддреЛ рд╣рдорд╛рд░реЗ рд╕рд╛рдкреЗрдХреНрд╖ рдЖрдХрд╛рд░ (рдкреНрд░рддреНрдпреЗрдХ рддрд░рдл 2) рдкрд╛рд░рдВрдкрд░рд┐рдХ 1080x1920 рддрдХ рдлреИрд▓ рдЬрд╛рдПрдВрдЧреЗред  рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рджреГрд╢реНрдп рдХреЗ рдЖрдпрд╛рдореЛрдВ рдХреЛ рдРрд╕реЗ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдЙрдирдХрд╛ рдЕрдиреБрдкрд╛рдд рдХреИрдорд░реЗ рдХреЗ рдЕрдиреБрдкрд╛рдд рдХреЗ рдмрд░рд╛рдмрд░ рд╣реЛрдЧрд╛ред <br>  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╣рд╛рдВ рдЬрд╛рддреЗ рд╣реИрдВ - рд╣рдорд╛рд░реЗ рдХреНрд╖реЗрддреНрд░ рдХреЗ рдКрдкрд░реА рджрд╛рдПрдВ рдмрд┐рдВрджреБ (1, 1, 0) рдХреЛ рдпреВрд╡реА рд╕рдордиреНрд╡рдп (0, 0) рдкрд░ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдирд┐рдЪрд▓реЗ рдмрд╛рдПрдВ рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ (0.8f, 0.8f), рдЖрджрд┐ред </p><br><p><img src="https://habrastorage.org/webt/fk/ur/ig/fkurigpfo4l_hnl1fonbgj1dao0.png"></p><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо XYZ рдФрд░ рдпреВрд╡реА рдХреЗ рдкрддреНрд░рд╛рдЪрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// X, Y, Z, U, V -1.0f, -1.0f, 0.0f, 0.8f, 0.8f, 1.0f, -1.0f, 0.0f, 0.8f, 0.0f, -1.0f, 1.0f, 0.0f, 0.0f, 0.8f, 1.0f, 1.0f, 0.0f, 0.0f, 0.0f</span></span></code> </pre> <br><p>  рдпрджрд┐ рдХреИрдорд░реЗ рд╕реЗ рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рдФрд░ рд╕реНрдХреНрд░реАрди рдкрд░ рдХреНрд╖реЗрддреНрд░ рдХреЗ рдмреАрдЪ рдкрд╣рд▓реВ рдЕрдиреБрдкрд╛рдд рд╢реБрд░реВ рдореЗрдВ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдирд╛ рдЬрд╛рд░реА рд░рд╣реЗрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдо рд╕рд┐рд░реНрдл 0.8f рд╕реЗ рдЧреБрдгрд╛ рдХрд░рддреЗ рд╣реИрдВред <br>  рдФрд░ рд╣рдо рдХреНрдпрд╛ рдЦрд╛рдПрдВрдЧреЗ рд╣рдо 1 рд╕реЗ рдЕрдзрд┐рдХ рдореВрд▓реНрдп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВрдЧреЗ?  рд╣рдордиреЗ рдУрдкрдирдЬреАрдПрд▓ рдХреЛ рдЬреЛ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдкрд╛рд╕ рдХреА рд╣реИрдВ, рдЙрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рд╣рдореЗрдВ рдЫрд╡рд┐ рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рдЕрдВрдХ рдорд┐рд▓реЗрдВрдЧреЗред  рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдЕрдВрддрд┐рдо рдкрдВрдХреНрддрд┐ рдХреЛ рдЗрд╕реА рдЕрдХреНрд╖ рдкрд░ рджреЛрд╣рд░рд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рд╣рдо "рдзрд╛рд░рд┐рдпреЛрдВ" рдХреЗ рд░реВрдк рдореЗрдВ рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦреЗрдВрдЧреЗред </p><br><p>  <strong>рдиреАрдЪреЗ рдкрдВрдХреНрддрд┐: рдпрджрд┐ рд╣рдо рд╕реНрдХреНрд░реАрди рдкрд░ рдХреНрд╖реЗрддреНрд░ рдХреА рд╕реНрдерд┐рддрд┐ рдмрдирд╛рдП рд░рдЦрддреЗ рд╣реБрдП рдЫрд╡рд┐ рдХреЛ рд╕рдВрдкреАрдбрд╝рд┐рдд / рдХрд╛рдЯ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╣рдорд╛рд░реА рдкрд╕рдВрдж рд╣реИрдВ!</strong> </p><br><p>  <strong>рд╣рдорд╛рд░реЗ рдмрдирд╛рд╡рдЯ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╕реЗрдЯ рдХрд░реЗрдВред</strong> </p><br><p><img src="https://habrastorage.org/webt/au/wp/zx/auwpzx9wgczhb79_4bbfu9nyk_a.png"></p><br><pre> <code class="kotlin hljs">fullscreenTexture = floatArrayOf( <span class="hljs-comment"><span class="hljs-comment">// X, Y, Z, U, V -1.0f, -1.0f, 0.0f, 1f, 0f, 1.0f, -1.0f, 0.0f, 0f, 0f, -1.0f, 1.0f, 0.0f, 1f, 1f, 1.0f, 1.0f, 0.0f, 0f, 1f ) smallTexture = floatArrayOf( // X, Y, Z, U, V 0.3f, 0.3f, 0.0f, 0f, 0f, 0.8f, 0.3f, 0.0f, 1f, 0f, 0.3f, 0.8f, 0.0f, 0f, 1f, 0.8f, 0.8f, 0.0f, 1f, 1f )</span></span></code> </pre> <br><p>  <strong>shaders</strong> </p><br><p>  рд╕реНрдерд┐рд░ XYZ рдФрд░ UV рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╣реЛрдирд╛ рдмрд╣реБрдд рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдирд╣реАрдВ рд╣реИ - рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрд╢рд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рдмрдирд╛рд╡рдЯ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдФрд░ рд╕реНрдХреЗрд▓ рдХрд░рдирд╛ рдЪрд╛рд╣ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрдиреНрд╣реЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо <strong>рдХреНрд░рдорд╢рдГ</strong> рдкреНрд░рддреНрдпреЗрдХ рдмрдирд╛рд╡рдЯ рдХреЗ рд▓рд┐рдП рджреЛ рдореИрдЯреНрд░рд┐рдХреНрд╕ <strong>рдмрдирд╛рдПрдВрдЧреЗ</strong> : рдПрдХреНрд╕рд╡рд╛рдИрдЬреЗрдб рдФрд░ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЗ рд▓рд┐рдП <strong>рдПрдорд╡реАрдкреАрдореИрдЯреНрд░рд┐рдХреНрд╕</strong> рдФрд░ <strong>рдЯреЗрдХреНрд╕рдореИрдЯреНрд░рд┐рдХреНрд╕</strong> ред </p><br><p>  рдкреНрд░рддреНрдпреЗрдХ OpenGL2 рдореЗрдВ рд╕реНрдХреНрд░реАрди рдкрд░ рдХреБрдЫ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реЗрдб рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдПред  рдмреЗрд╢рдХ, рдпрд╣ рдПрдХ рд╡рд┐рд╖рдп рдирд╣реАрдВ рд╣реИ рдЬрд┐рд╕реЗ рдПрдХ рдкреИрд░рд╛рдЧреНрд░рд╛рдл рдореЗрдВ рдЦреБрд▓рд╛рд╕рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╡реЗ рддреБрдЪреНрдЫ рд╣реЛрдВрдЧреЗ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЖрдк рдЬрд▓реНрджреА рд╕реЗ рд╕рдордЭ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╡реЗ рдХреНрдпрд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рд╕рд╛рдордЧреНрд░реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдмрд┐рдирд╛ред </p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рджреЛ рд╢реЗрдб рд╣реИрдВ - рд╡рд░реНрдЯреЗрдХреНрд╕ рдФрд░ рдЯреБрдХрдбрд╝рд╛ред </p><br><p>  рдкрд╣рд▓рд╛ (рд╡рд░реНрдЯреЗрдХреНрд╕) рд╣рдорд╛рд░реЗ рд╕рд┐рд░реЛрдВ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░реЗрдЧрд╛, рдЕрд░реНрдерд╛рддреН, рд╣рдорд╛рд░реЗ рдПрдХреНрд╕рд╡рд╛рдИрдЬреЗрдб / рдпреВрд╡реА рдХреЛ рдЙрдирдХреЗ рд╕рдВрдмрдВрдзрд┐рдд рдореЗрдЯреНрд░рд┐рд╕реЗрд╕ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдУрдкрдирдЬреАрдПрд▓ рд╡реЗрд░рд┐рдПрдмрд▓ <strong>gl_Position рдореЗрдВ рднрд░рддрд╛ рд╣реИ</strong> рдЬреЛ рд╕реНрдХреНрд░реАрди рдкрд░ рд╣рдорд╛рд░реА рдмрдирд╛рд╡рдЯ рдХреА рдЕрдВрддрд┐рдо рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдмрд┐рд▓реНрдХреБрд▓ рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред </p><br><p>  рджреВрд╕рд░рд╛ (рдЯреБрдХрдбрд╝рд╛) рдЫрд╡рд┐ рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ <strong>рд╕рд╛рде gl_FragColor</strong> рднрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </p><br><p>  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреБрд▓: рд╡рд░реНрдЯрд┐рдХрд▓ рд╢реЗрдбрд░ рдХреЗ рдЕрдВрджрд░ рдХреЗ рд╡реИрд░рд┐рдПрдмрд▓ рд╣рдореЗрдВ рдЕрдкрдиреЗ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдЦреЗрддреЛрдВ рдореЗрдВ рднрд░рдиреЗ рдЪрд╛рд╣рд┐рдП, рдЕрд░реНрдерд╛рддреН: </p><br><ul><li>  MVPMatrix -&gt; <strong>uMVPMatrix</strong> </li><li>  <strong>рдЯреЗрдХреНрд╕рдореИрдЯреНрд░рд┐рдХреНрд╕ -&gt; рдпреВрдЯреЗрдХреНрд╕рдореИрдЯреНрд░рд┐рдХреНрд╕</strong> </li><li>  рд╣рдорд╛рд░реЗ XYZ рд╢реАрд░реНрд╖ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ -&gt; <strong>aPosition</strong> </li><li>  рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ -&gt; <strong>aTextureCoord</strong> </li></ul><br><p>  <strong>vTextureCoord</strong> - <strong>рд╡рд░реНрдЯреЗрдХреНрд╕ рд╢реИрдбрд░</strong> рд╕реЗ рдЯреБрдХрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдЕрдЧреНрд░реЗрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ <br>  рдЦрдВрдб рдЫрд╛рдпрд╛рджрд╛рд░ рдореЗрдВ, рд╣рдо рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд▓реЗрддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдмрдирд╛рд╡рдЯ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЫрд╡рд┐ рдкрд┐рдХреНрд╕реЗрд▓ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> vertexShader = <span class="hljs-string"><span class="hljs-string">""" uniform mat4 uMVPMatrix; uniform mat4 uTexMatrix; attribute vec4 aPosition; attribute vec4 aTextureCoord; varying vec2 vTextureCoord; void main() { gl_Position = uMVPMatrix * aPosition; vTextureCoord = (uTexMatrix * aTextureCoord).xy; } """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fragmentShader = <span class="hljs-string"><span class="hljs-string">""" #extension GL_OES_EGL_image_external : require precision mediump float; varying vec2 vTextureCoord; uniform samplerExternalOES sTexture; void main() { gl_FragColor = texture2D(sTexture, vTextureCoord); } """</span></span></code> </pre> <br><p>  рд╕рдВрджрд░реНрдн рдХреЗ рд▓рд┐рдП, рд╣рдо рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВ: </p><br><ul><li>  рд╡рд░реНрджреА - рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдПрдХ рдЪрд░ рджреЛрд╣рд░рд╛рдпрд╛ рдХреЙрд▓ рдХреЗ рджреМрд░рд╛рди рдореВрд▓реНрдпреЛрдВ рдХреЛ рдмрдирд╛рдП рд░рдЦреЗрдЧрд╛, рд╣рдо рдПрдХ shader рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рджреЛ рдмрдирд╛рд╡рдЯ рдХреЗ рд▓рд┐рдП рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЕрднреА рднреА рдкреНрд░рддреНрдпреЗрдХ рд░реЗрдВрдбрд░рд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдЗрд╕реЗ рдЕрдзрд┐рд▓реЗрдЦрд┐рдд рдХрд░реЗрдВрдЧреЗ </li><li>  рд╡рд┐рд╢реЗрд╖рддрд╛ - рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рд╡рд░реНрдЯреЗрдХреНрд╕ рдмрдлрд░ рд╕реЗ рдкрдврд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкрд░ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ </li><li>  рдЕрд▓рдЧ - рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╢реАрд░реНрд╖ shader рд╕реЗ рдбреЗрдЯрд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ </li></ul><br><p>  рдХреИрд╕реЗ рдПрдХ shader рдХреЗ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП?  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╡реЗрд░рд┐рдПрдмрд▓ рдХреА рдЖрдИрдбреА (рдкреЙрдЗрдВрдЯрд░) рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреА рд╣реЛрдЧреА: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> aPositionHandle = GLES20.glGetAttribLocation(programId, <span class="hljs-string"><span class="hljs-string">"aPosition"</span></span>)</code> </pre> <br><p>  рдЕрдм рдЗрд╕ рдЖрдИрдбреА рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдирд╛ рд╣реЛрдЧрд╛: </p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">//      floatbuffer val verticesBuffer = ByteBuffer.allocateDirect( fullscreenTexture.size * FLOAT_SIZE_BYTES ).order( ByteOrder.nativeOrder() ).asFloatBuffer() verticesBuffer.put(fullscreenTexture).position(0) /*    -  XYZ   0 .       id      ,     ,               - 5  - XYZUV,  4 - -   float */ verticesBuffer.position(0) GLES20.glVertexAttribPointer( aPositionHandle, 3, GLES20.GL_FLOAT, false, 5 * 4, verticesBuffer )</span></span></code> </pre> <br><p>  <strong>рд╕реАрдзреА рдбреНрд░рд╛рдЗрдВрдЧ</strong> </p><br><p>  рдЬрдм рд╣рдордиреЗ рд╕рднреА рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдЕрдкрдиреЗ рд╢реЗрдбреНрд╕ рдХреЛ рднрд░ рджрд┐рдпрд╛, рддреЛ рд╣рдореЗрдВ рдмрдирд╛рд╡рдЯ рдХреЛ рдЫрд╡рд┐ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдУрдкрдирдЬреАрдПрд▓ рдХреЛ рдЕрдкрдирд╛ рд╕рд┐рд░рд╛ рдЦреАрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП: </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span></span> { ... surfaceTexture.updateTexImage() GLES20.glDrawArrays(GLES20.GL_TRIANGLE_STRIP, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) }</code> </pre> <br><p>  рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдо рдУрдкрдирдЬреАрдПрд▓ рджреГрд╢реНрдп рдХреЗ рд╕рд╛рде рджреЛ рд╡рд░реНрдЧреЛрдВ рдореЗрдВ рдХрд╛рдо рдХреЛ рддреЛрдбрд╝ рджреЗрдВрдЧреЗ - рд╕реАрдзреЗ рджреГрд╢реНрдп рдФрд░ рдмрдирд╛рд╡рдЯ: </p><br><p>  <a href="https://github.com/tttzof351/AndroidSurfaceExample/blob/master/app/src/main/java/com/example/surfaces/helpers/OpenGLExternalTexture.kt/" rel="nofollow">OpenGLExternalTexture.kt</a> </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenGLExternalTexture</span></span></span></span>(verticesData: FloatArray, ...) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surfaceTexture: SurfaceTexture <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surface: Surface <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ,    . } ... fun updateFrame(aPositionHandle: Int, ...) {...} // ,   fun release() {...} //   }</span></span></code> </pre> <br><p>  <a href="" rel="nofollow">OpenGLScene.kt</a> </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenGLScene</span></span></span></span>( sceneWidth: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, sceneHeight: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, ... ) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fullscreenTexture = OpenGLExternalTexture(...) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> smallTexture = OpenGLExternalTexture(..) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> aPositionHandle: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ,        . } fun updateFrame() { ... fullscreenTexture.updateFrame(aPositionHandle, ...) smallTexture.updateFrame(aPositionHandle, ...) } fun release() { fullscreenTexture.release() smallTexture.release() } }</span></span></code> </pre> <br><h2 id="statemachine--mashina-sostoyaniy--konechnyy-avtomat">  StateMachine / рд░рд╛рдЬреНрдп рдорд╢реАрди / рд░рд╛рдЬреНрдп рдорд╢реАрди </h2><br><p>  рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдЗрд░рд╛рджрд╛ рд░рдЦрдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдПрдкреАрдЖрдИ рдореВрд▓ рд░реВрдк рд╕реЗ рдЕрддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ (рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ, рдПрдирд┐рдореЗрдЯреЗрдб рдбреНрд░рд┐рдмрд▓ рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде) рд╣реИрдВред  рд╣рдо рдЗрд╕ рддрд░рд╣ рдХреЗ рдХреЙрд▓ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реНрдЯреЗрдЯрдорд╛рдЗрдВрд╕ рдореЗрдВ рд▓рдкреЗрдЯреЗрдВрдЧреЗ, рдПрдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЬрд╣рд╛рдВ рд╕рд┐рд╕реНрдЯрдо рдХреА рд╕реНрдерд┐рддрд┐ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд▓рд┐рдЦреА рдЧрдИ рд╣реИ, рдФрд░ рдЙрдирдХреЗ рдмреАрдЪ рд╕рдВрдХреНрд░рдордг рдШрдЯрдирд╛рдУрдВ рдХреЗ рднреЗрдЬрдиреЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛрддрд╛ рд╣реИред </p><br><p>  рдЖрдЗрдП рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ рдХрд┐ рдпрд╣ рдХреИрд╕рд╛ рджрд┐рдЦреЗрдЧрд╛, рдорд╛рди рд▓реАрдЬрд┐рдП рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдпрд╣ рдХреЛрдб рд╣реИ: </p><br><pre> <code class="kotlin hljs">imageView.setOnClickListener { loadImage { bitmap -&gt; imageView.setBitmap(bitmap) } }</code> </pre> <br><p>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рд╕рдм рдХреБрдЫ рдареАрдХ рд╣реИ - рд╕реБрдВрджрд░ рдФрд░ рдХреЙрдореНрдкреИрдХреНрдЯ, рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЗ рд╕реЗ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВрдЧреЗ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> uiMachine = UIMachine() imageView.setOnClickListener { uiMachine.send(Click(imageView)) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIMachine</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state: State = WaitClick() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = transition(action) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> state = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { state <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> WaitingClick &amp;&amp; action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Click -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = WaitBitmap(imageView = action.imageView) loadImage { send(BitmapIsReady(bitmap = it)) } } state <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> WaitingBitmap &amp;&amp; action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> BitmapIsReady -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = WaitClick state.imageView.setImageBitmap(action.bitmap) } } } } <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> WaitingClick : State() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaitingBitmap</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> imageView: ImageView): State() } <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Click</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> imageView: ImageView): Action() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BitmapIsReady</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bitmap: Bitmap): Action() }</code> </pre> <br><p>  рдПрдХ рддрд░рдл, рдпрд╣ <strong><em>рдмрд╣реБрдд</em></strong> рдЕрдзрд┐рдХ рдирд┐рдХрд▓рд╛, рдлрд┐рд░ рднреА, рдХрдИ рдирд┐рд╣рд┐рдд рд▓реЗрдХрд┐рди рдЙрдкрдпреЛрдЧреА рдЧреБрдг рджрд┐рдЦрд╛рдИ рджрд┐рдП: рдЕрдм рдмрд╛рд░-рдмрд╛рд░ рджрдмрд╛рдиреЗ рд╕реЗ рдЕрдирд╛рд╡рд╢реНрдпрдХ <strong>рд▓реЛрдб</strong> рд╢реБрд░реВ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ <strong>,</strong> рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдЗрд╕ рддрд░рд╣ рдХреА рдорд╛рддреНрд░рд╛ рдХреЗ рд╕рд╛рде рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдиреЗрд╕реНрдЯреЗрдб рдХреЙрд▓рдмреИрдХ рдХреЙрд▓ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдорд┐рд▓ рдЧрдпрд╛, рдЬрд┐рд╕реЗ рд╣рдо рдмрд╛рдж рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ , рдФрд░ рд╕рдВрдХреНрд░рдордг рд╡рд┐рдзрд┐ рдХреА рд▓реЗрдЦрди рд╢реИрд▓реА рдЖрдкрдХреЛ рдПрдХ рд╕рдВрдХреНрд░рдордг рдЖрд░реЗрдЦ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдЬреЛ рдХреЛрдб рд╡рди-рдСрди-рд╡рди, рдЕрд░реНрдерд╛рддреН рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рджреЛрд╣рд░рд╛рддрд╛ рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/-n/2p/mq/-n2pmqdwfsps932me0wfsrvyj_q.png"><br>  рдЧреНрд░реЗ рдЙрди рдмрджрд▓рд╛рд╡реЛрдВ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдмрд╛рд╣рд░ рдирд╣реАрдВ рд▓рд┐рдЦреЗ рдЧрдП рд╣реИрдВред  рдЕрдХреНрд╕рд░ рдЙрдиреНрд╣реЗрдВ рд▓реЙрдЧ рдпрд╛ рдПрдХ рдЕрдкрд╡рд╛рдж рдлреЗрдВрдХ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕реЗ рддреНрд░реБрдЯрд┐ рдХрд╛ рд╕рдВрдХреЗрдд рдорд╛рдирддреЗ рд╣реБрдПред  рдЕрднреА рдХреЗ рд▓рд┐рдП, рд╣рдо рдХреЗрд╡рд▓ рдЗрд╕реЗ рдЕрдирджреЗрдЦрд╛ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░реЗрдВрдЧреЗ рдФрд░ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рд╣рдо рдЖрд░реЗрдЦреЛрдВ рдХреЛ рдЗрдВрдЧрд┐рдд рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред </p><br><p>  StateMachine рдХреЗ рд▓рд┐рдП рдЖрдзрд╛рд░ рдЗрдВрдЯрд░рдлреЗрд╕ рдмрдирд╛рдПрдБ: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StateMachine</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">S : State, A : Action</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state: S <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">A</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">A</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre> <br><h2 id="glsurfaceview">  GLSurfaceView </h2><br><p>  Android рдореЗрдВ OpenGL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреБрдЫ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ GLSurfaceView рд╡рд░реНрдЧ рд╣реИ - рдпрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдбреНрд░рд╛рдЗрдВрдЧ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдИ рд╕реНрдЯреНрд░реАрдо рдмрдирд╛рддрд╛ рд╣реИ, рдЬреЛ GLSurfaceView :: onResume / onPause рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рд╛рд░рдВрдн / рд░реЛрдХ рджреЗрддрд╛ рд╣реИред </p><br><p>  рд╕рд╛рджрдЧреА рдХреЗ рд▓рд┐рдП, рд╣рдо рдЕрдкрдиреЗ рд╡рд┐рдЪрд╛рд░ рдХреЛ 16: 9 рдХреЗ рдЕрдиреБрдкрд╛рдд рдореЗрдВ рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗ </p><br><p>  рд░реЗрдВрдбрд░рд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реА рдПрдХ рдЕрд▓рдЧ рдХреЙрд▓рдмреИрдХ - GLSurfaceView.Renderer рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рд╣реЛ рдЬрд╛рддреА рд╣реИред <br>  StateMachine рдореЗрдВ рд▓рдкреЗрдЯрдХрд░, рд╣рдореЗрдВ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдорд┐рд▓рддрд╛ рд╣реИ: </p><br><p>  <a href="" rel="nofollow">GLSurfaceMachine.kt</a> </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GLSurfaceMachine</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">StateMachine</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GLSurfaceState, GLSurfaceAction</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state: GLSurfaceState = WaitCreate() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">GLSurfaceAction</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = transition(action) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">GLSurfaceAction</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> state = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { state <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> WaitCreate &amp;&amp; action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Create -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = WaitSurfaceReady(...) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.glSurfaceView?.setRenderer(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> :Renderer { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSurfaceChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gl: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">GL10</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, width: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, height: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> send(SurfaceReady(width, height, gl)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSurfaceCreated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gl: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">GL10</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, config: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EGLConfig</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDrawFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gl: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">GL10</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { send(Draw) } }) } state <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> WaitSurfaceReady &amp;&amp; action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> SurfaceReady -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> openGLScene = OpenGLScene(width, height) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = DrawingAvailable(openGLScene, ...) } state <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> DrawingAvailable &amp;&amp; action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Draw -&gt; { state.openGLScene.updateFrame() } state !<span class="hljs-keyword"><span class="hljs-keyword">is</span></span> WaitCreate &amp;&amp; action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Stop -&gt; { state.uiHolder.glSurfaceView?.onPause() state.uiHolder.openGLScene?.release() <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = WaitSurfaceReady() } state <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> WaitSurfaceReady &amp;&amp; action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Start -&gt; { state.uiHolder.glSurfaceView?.onResume() } } } } ... <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> glSurfaceMachine = GLSurfaceMachine() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> glSurfaceView = findViewById(R.id.gl_view) glSurfaceView.layoutParams.width = width glSurfaceView.layoutParams.height = ((<span class="hljs-number"><span class="hljs-number">16f</span></span>/<span class="hljs-number"><span class="hljs-number">9f</span></span>) * width).toInt() glSurfaceMachine.send(GLSurfaceAction.Create(glSurfaceView, ...))</code> </pre> <br><p>  рдЖрдЗрдП рдПрдХ рд╕рдВрдХреНрд░рдордг рдЪрд┐рддреНрд░ рдмрдирд╛рддреЗ рд╣реИрдВ: </p><br><p><img src="https://habrastorage.org/webt/mx/5i/xb/mx5ixbssfaqci1ktsmumu94jbz0.png"></p><br><p>  рдЕрдм рд╣рдорд╛рд░рд╛ рдХреЛрдб рд╕реНрдХреНрд░реАрди рдкрд░ рдХреБрдЫ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣рд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЕрдм рдпрд╣ рдЦрд░рд╛рдм рддрд░реАрдХреЗ рд╕реЗ рдХрд░рддрд╛ рд╣реИ - рд╣рдо рдХрд╛рд▓реА рд╕реНрдХреНрд░реАрди рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХреБрдЫ рднреА рдирд╣реАрдВ рджреЗрдЦреЗрдВрдЧреЗред  рдЗрд╕ рддрдереНрдп рдХрд╛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдЕрдм рд╣рдорд╛рд░реЗ рд╕рд░рдлреЗрд╕ рдореЗрдВ рдХреБрдЫ рднреА рдирд╣реАрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдордиреЗ рдЕрднреА рддрдХ рдЫрд╡рд┐ рд╕реНрд░реЛрддреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИред  рдЪрд▓рд┐рдП рдЗрд╕реЗ рдареАрдХ рдХрд░рддреЗ рд╣реИрдВ - рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдПрдХ CanrawDrawable рдмрдирд╛рдПрдВ: </p><br><p>  <a href="" rel="nofollow">CanvasDrawable.kt</a> </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CanvasDrawable</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Drawable</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> backgroundPaint = Paint().apply { ... } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> circlePaint = Paint().apply { ... } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { canvas.drawRect(bounds, backgroundPaint) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> width = bounds.width() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> height = bounds.height() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> posX = ... <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> posY = ... canvas.drawCircle(posX, posY, <span class="hljs-number"><span class="hljs-number">0.1f</span></span> * width, circlePaint) } ... }</code> </pre> <br><p>  рдЕрдм рд╣рдо GLSurfaceMachine рдореЗрдВ рдХреИрдирд╡рд╛рд╕ рдкрд░ рдкреНрд░рддрд┐рдкрд╛рджрди рдХрд░рдХреЗ рдЕрдиреБрднрд╛рдЧ рдХреЛ рдкреВрд░рдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХреИрдирд╡рд╛рд╕ рдкрд░ рд╕рдВрдЧрдд рд╣реИ рдЬреЛ рдЗрд╕реА рдмрдирд╛рд╡рдЯ рдХреА рд╕рддрд╣ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ: </p><br><pre> <code class="kotlin hljs">state <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> DrawingAvailable &amp;&amp; action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Draw -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> canvasDrawable = state.canvasDrawable <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> smallTexture = state.openGLScene.smallTexture <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bounds = canvasDrawable.bounds <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> canvas = smallSurface.lockCanvas(bounds) canvasDrawable.draw(canvas) smallSurface.unlockCanvasAndPost(canvas) state.openGLScene.updateFrame() }</code> </pre> <br><p>  рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рд╣рдореЗрдВ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛: </p><br><p><img src="https://habrastorage.org/webt/vo/4r/-d/vo4r-dgpynjvynvxdomy2fezp9y.png"></p><br><h2 id="camera-api-v2">  рдХреИрдорд░рд╛ рдПрдкреАрдЖрдИ V2 </h2><br><p>  рд╣рд░реЗ рд░рдВрдЧ рдХреА рдЖрдпрдд рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдордЬреЗрджрд╛рд░ рдФрд░ рдкреЗрдЪреАрджрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХреИрдорд░реЗ рд╕реЗ рд╢реЗрд╖ рд╕рддрд╣ рдкрд░ рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рд▓рд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рд╣реИред </p><br><p>  рдЖрдЗрдП рдХреИрдорд░реЗ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдЪрд░рдгреЛрдВ рдХреЛ рд▓рд┐рдЦреЗрдВ: </p><br><ul><li>  рд╣рдо рдЕрдиреБрдорддрд┐ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдпрд╣ рд░рд╛рдЬреНрдп <strong>рд╡реЗрдЯрд┐рдВрдЧрд╕реНрдЯрд╛рд░реНрдЯ рд╣реЛрдЧрд╛</strong> </li><li>  рд╣рдо рдХреИрдорд░рд╛ рдореИрдиреЗрдЬрд░ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рд╣рдо рддрд╛рд░реНрдХрд┐рдХ рдЖрдИрдбреА рдкрд╛рддреЗ рд╣реИрдВ (рдЖрдорддреМрд░ рдкрд░ рдЙрдирдореЗрдВ рд╕реЗ рджреЛ рд╣реИрдВ - рдкреАрдЫреЗ рдФрд░ рд╕рд╛рдордиреЗ рдХреЗ рд▓рд┐рдП, рдФрд░ рддрд╛рд░реНрдХрд┐рдХ рдПрдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдХреИрдорд░рд╛ рд╡рд╛рдВрдЫрд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдЖрдзреБрдирд┐рдХ рдЙрдкрдХрд░рдгреЛрдВ рдкрд░ рдХрдИ рд╕реЗрдВрд╕рд░ рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реИ), рдЙрдкрдпреБрдХреНрдд рдЖрдХрд╛рд░ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ, рдХреИрдорд░рд╛ рдЦреЛрд▓реЗрдВ, рд╣рдореЗрдВ рдХреИрдорд░рд╛рдбреЗрд╡рд┐рд╕ рдорд┐рд▓рддрд╛ рд╣реИред  рд╕реНрдерд┐рддрд┐ <strong>WaitingOpen</strong> </li></ul><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> manager = getSystemService(Context.CAMERA_SERVICE) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> CameraManager <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resultCameraId: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resultSize: Size? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (cameraId <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> manager.cameraIdList) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> chars = manager.getCameraCharacteristics(cameraId) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> facing = chars.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(CameraCharacteristics.LENS_FACING) ?: -<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (facing == LENS_FACING_BACK) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> confMap = chars.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>( CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sizes = confMap?.getOutputSizes(SurfaceTexture::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resultSize</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">findSize</span></span></span></span>(sizes) resultCameraId = cameraId <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } } resultCameraId?.let { cameraId -&gt; manager.openCamera(cameraId, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : CameraDevice.StateCallback() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpened</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(camera: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CameraDevice</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//Success open camera ... } }) }</span></span></code> </pre> <br><ul><li>  рдПрдХ рдЦреБрд▓рд╛ рдХреИрдорд░рд╛ рд╣реЛрдиреЗ рд╕реЗ, рд╣рдо рдЫрд╡рд┐ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рддрд╣ рдХреЗ рд▓рд┐рдП рдЖрд╡реЗрджрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдбрд╝рддреЗ рд╣реИрдВред  <strong>WaitingSurface</strong> рд╕реНрдерд┐рддрд┐ </li><li>  рдЕрдм рдЬрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ CameraDevice рд╣реИ, рд╕рд░рдлреЗрд╕, рд╣рдореЗрдВ рдПрдХ рд╕рддреНрд░ рдЦреЛрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдХреИрдорд░рд╛ рдЕрдВрддрддрдГ рдбреЗрдЯрд╛ рднреЗрдЬрдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗред  <strong>WaitingSession</strong> рд╕реНрдерд┐рддрд┐ </li></ul><br><pre> <code class="kotlin hljs">cameraDevice.createCaptureSession( arrayListOf(surface), <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : CameraCaptureSession.StateCallback() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConfigured</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(session: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CameraCaptureSession</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { send(CameraAction.SessionReady(session)) } }, handler )</code> </pre> <br><ul><li>  рдЕрдм рд╣рдо рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди рдкрд░ рдХрдмреНрдЬрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  <strong>рдкреНрд░рд╛рд░рдВрднрд┐рдХ</strong> рд╕реНрдерд┐рддрд┐ </li></ul><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> request = cameraDevice.createCaptureRequest( CameraDevice.TEMPLATE_PREVIEW ).apply { addTarget(surface) } session.setRepeatingRequest( request.build(), <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : CameraCaptureSession.CaptureCallback() {...} handler )</code> </pre> <br><p>  рд╣рдо рдЕрдкрдиреА рд╡рд░реНрддрдорд╛рди рдпреЛрдЬрдирд╛ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВ: </p><br><p>  <a href="" rel="nofollow">CameraMachine.kt</a> </p><br><p><img src="https://habrastorage.org/webt/i6/tj/q1/i6tjq12xls77hudocvpnt0m6qy0.png"></p><br><p><img src="https://habrastorage.org/webt/6w/ad/fp/6wadfpayduldvtqwcrjggkoce6y.png"></p><br><h2 id="mediacodec">  MediaCodec </h2><br><p>  MediaCodec рд╕рд┐рд╕реНрдЯрдо рдХреЛрдбреЗрдХреНрд╕ рдХреЗ рд╕рд╛рде рдирд┐рдореНрди-рд╕реНрддрд░ рдХреЗ рдХрд╛рдо рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд░реНрдЧ рд╣реИ, рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдЗрд╕рдХрд╛ рдПрдкреАрдЖрдИ рдЗрдирдкреБрдЯ / рдЖрдЙрдЯрдкреБрдЯ рдмрдлрд╝рд░реНрд╕ (рдпрд╣ рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рдЖрд╕рд╛рди рд▓рдЧрддрд╛ рд╣реИ) рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдбреЗрдЯрд╛ (рдХрдЪреНрдЪрд╛ рдпрд╛ рдПрдиреНрдХреЛрдбреЗрдб, рдПрдирдХреЛрдбрд░ / рдбрд┐рдХреЛрдбрд░ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреЗ рдореЛрдб рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ), рдФрд░ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рд╣рдореЗрдВ рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓рддрд╛ рд╣реИред </p><br><p>  рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ рдмрд╛рдЗрдЯрдмрдлрд╝рд░ рдЖрдорддреМрд░ рдкрд░ рдмрдлрд╝рд░реНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдЖрдк рд╡реАрдбрд┐рдпреЛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд░рдлреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ MediaCodec :: createInputSurface рд╣рдореЗрдВ рд▓реМрдЯрд╛рдПрдЧрд╛, рдЗрд╕ рдкрд░ рд╣рдореЗрдВ рдЙрди рдлрд╝реНрд░реЗрдореЛрдВ рдХреЛ рдЦреАрдВрдЪрдирд╛ рд╣реЛрдЧрд╛ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдо рд░рд┐рдХреЙрд░реНрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ (рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде, рдкреНрд░рд▓реЗрдЦрди рд╣рдореЗрдВ gpu рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рддреЗрдЬреА рд╕реЗ рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдХрд╛ рд╡рд╛рджрд╛ рдХрд░рддрд╛ рд╣реИред )ред </p><br><p>  рдЦреИрд░, рдЕрдм рд╣рдореЗрдВ рдпрд╣ рд╕реАрдЦрдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдХрд┐ рдореМрдЬреВрджрд╛ рд╕рд░рдлреЗрд╕ рдХреЛ рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдП рдЬрд┐рд╕реЗ рд╣рдордиреЗ GLSurfaceMachine рдореЗрдВ рд╕рд░реНрдлреЗрд╕ рдСрди рдореАрдбрд┐рдпрд╛рдХреЛрдб рд╕реЗ рдмрдирд╛рдпрд╛ рд╣реИред  рдпрд╣ рдпрд╛рдж рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ: рднреВрддрд▓ рдПрдХ рдРрд╕реА рд╡рд╕реНрддреБ рд╣реИ рдЬреЛ рдПрдХ рдЙрдкрднреЛрдХреНрддрд╛ рдмрдирд╛рддрд╛ рд╣реИ, рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░ рдЗрд╕рд╕реЗ рдХреБрдЫ рдкрдврд╝рдирд╛ рдЕрд╕рдВрднрд╡ рд╣реИ, рдЕрд░реНрдерд╛рдд рдЗрд╕рдореЗрдВ рдХреЛрдИ рд╕рд╢рд░реНрдд рд╡рд┐рдзрд┐ рдирд╣реАрдВ рдорд┐рд▓рддреА рд╣реИ getBitmap / readImage / ... </p><br><p>  рд╣рдо рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдЖрдЧреЗ рдмрдврд╝реЗрдВрдЧреЗ: рдореМрдЬреВрджрд╛ рдЬреАрдПрд▓ рд╕рдВрджрд░реНрдн рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рд╣рдо рдПрдХ рдирдпрд╛ рдмрдирд╛рдпреЗрдВрдЧреЗ, рдЬрд┐рд╕рдореЗрдВ рдЗрд╕рдХреЗ рд╕рд╛рде рдПрдХ рдЖрдо рдореЗрдореЛрд░реА рд╣реЛрдЧреА, рдФрд░ рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЙрди рдмрдирд╛рд╡рдЯреЛрдВ рдХреЗ рдЖрдИрдбреА-рд╢реЗрдХрд┐рдиреНрд╕ рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╣рдордиреЗ рдкрд╣рд▓реЗ рдмрдирд╛рдП рдереЗред  рдлрд┐рд░ MediaCodec рд╕реЗ рдирдП GL рд╕рдВрджрд░реНрдн рдФрд░ рд╕рд░рдлреЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдПрдХ EGLSurface - рдПрдХ рдСрдл-рд╕реНрдХреНрд░реАрди рдмрдлрд░ рдмрдирд╛рдПрдВрдЧреЗ, рдЬрд┐рд╕ рдкрд░ рд╣рдо рдЕрдкрдиреА OpenGLScene рдХреНрд▓рд╛рд╕ рднреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдлрд┐рд░, рдкреНрд░рддреНрдпреЗрдХ рдлреНрд░реЗрдо рд░реЗрдВрдбрд░рд┐рдВрдЧ рдореЗрдВ, рд╣рдо рдлреНрд░реЗрдо рдХреЛ рдлрд╛рдЗрд▓ рдХреЗ рд╕рдорд╛рдирд╛рдВрддрд░ рд▓рд┐рдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВрдЧреЗред </p><br><p>  рдИрдЬреАрдПрд▓ рдХрд╛ рдЕрд░реНрде рд╣реИ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдХреА рд╡рд┐рдВрдбреЛ рд╕рдмрд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рд╛рде рдУрдкрдирдЬреАрдПрд▓ рдПрдкреАрдЖрдИ рдХреА рдмрд╛рддрдЪреАрдд рдХрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕, рд╣рдо рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХреЛ рдЪреБрд░рд╛ рд▓реЗрдВрдЧреЗред  рдореИрдВ рд╕реАрдзреЗ рддреМрд░ рдкрд░ MediaCodec рдХреЗ рд╕рд╛рде рдХрдиреНрд╡реЗрдпрд░ (рдПрдирдХреЛрдбрд░ рд╣реЗрд▓реНрдкрд░) рдХрд╛ рд╡рд░реНрдгрди рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛, рдореИрдВ рдХреЗрд╡рд▓ рд╣рдорд╛рд░реЗ рдШрдЯрдХреЛрдВ рдХреЗ рдмреАрдЪ рдмрд╛рддрдЪреАрдд рдХреА рдЕрдВрддрд┐рдо рдпреЛрдЬрдирд╛ рджреВрдВрдЧрд╛: </p><br><p>  <a href="" rel="nofollow">EncoderMachine.kt</a> <br>  <a href="" rel="nofollow">EncoderHelper.kt</a> </p><br><p><img src="https://habrastorage.org/webt/d1/gc/kf/d1gckfqligsrwynmmkq_bb2yzoy.png"></p><br><h2 id="itog">  рдкрд░рд┐рдгрд╛рдо: </h2><br><ul><li>  рд╡реАрдбрд┐рдпреЛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП OpenGL рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рдмреБрдирд┐рдпрд╛рджреА рдХреМрд╢рд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ </li><li>  Android Media API рдХрд╛рдлреА рдирд┐рдореНрди-рд╕реНрддрд░ рдХрд╛ рд╣реИ, рдЬреЛ рд▓рдЪреАрд▓рд╛рдкрди рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдХрднреА-рдХрднреА рдпрд╣ рдЖрдкрдХреЛ рдХреБрдЫ рдФрд░ рдХреЛрдб рд▓рд┐рдЦрддрд╛ рд╣реИ рдЬреЛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ </li><li>  рдПрд╕рд┐рдВрдХреНрд░реЛрдирд╕ API рдХреЛ StateMachines рдореЗрдВ рд▓рдкреЗрдЯрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi480878/">https://habr.com/ru/post/hi480878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi480860/index.html">Antirust рдХрд╛ рд╕рд┐рджреНрдзрд╛рдВрдд</a></li>
<li><a href="../hi480870/index.html">рджрд╢рдХ рдкрд░рд┐рдгрд╛рдо</a></li>
<li><a href="../hi480872/index.html">рдЗрдВрдЯреЗрд▓ рдиреЗ рдЫрд╣ рдорд╣реАрдиреЗ рдкрд╣рд▓реЗ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдЫреЗрдж рдХреЛ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛</a></li>
<li><a href="../hi480874/index.html">рдиреНрдпреВрдЯреНрд░рд┐рдиреЛ рдХреЗ рдЕрдзреНрдпрдпрди рд╕реЗ рдЧрдгрд┐рдд рдореЗрдВ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдЦреЛрдЬ рд╣реБрдИ</a></li>
<li><a href="../hi480876/index.html">рд╣рдо рдбреЙрдХ рдХреЛ рд╕рд╛рдл рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдПрдХреНрд╕рдХреЛрдб рдХреЗ рдмрд┐рдирд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi480884/index.html">5 рдорд┐рдирдЯ рдореЗрдВ рдкрд╛рдпрдерди рдЬреАрдпреВрдЖрдИ</a></li>
<li><a href="../hi480886/index.html">рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдФрд░ рд╕реБрдирд╣рд░рд╛ рдЕрдиреБрдкрд╛рдд: рджреВрд╕рд░рд╛ рд░рди</a></li>
<li><a href="../hi480888/index.html">DIY Coroutinesред рднрд╛рдЧ 1. рдЖрд▓рд╕реА рдЬреЗрдирд░реЗрдЯрд░</a></li>
<li><a href="../hi480890/index.html">рдПрдХреНрд╕рдкреНрд░реЗрд╕ рдкреИрдирд▓ рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ рд╕рд░реНрд╡реЗрдХреНрд╖рдг рдХреЗ рдкрд░рд┐рдгрд╛рдо</a></li>
<li><a href="../hi480892/index.html">рдЧреБрдмреНрдмрд╛рд░рд╛ рдЗрдВрдЯрд░рдиреЗрдЯ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>