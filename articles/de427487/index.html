<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•Å ü¶ë üòé Konfigurationstests f√ºr Java-Entwickler: Praktische Erfahrung üßÄ üóΩ üôãüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bei den Tests f√ºr den Code ist alles klar (zumindest die Tatsache, dass sie geschrieben werden m√ºssen). Bei Konfigurationstests ist alles viel weniger...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Konfigurationstests f√ºr Java-Entwickler: Praktische Erfahrung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/427487/"><img src="https://habrastorage.org/webt/9o/r3/24/9or324raqccmfaeghrlyaagxmja.jpeg"><br><br>  Bei den Tests f√ºr den Code ist alles klar (zumindest die Tatsache, dass sie geschrieben werden m√ºssen).  Bei Konfigurationstests ist alles viel weniger offensichtlich, beginnend mit ihrer Existenz.  Schreibt jemand sie?  Ist es wichtig  Ist es schwer  Welche Ergebnisse k√∂nnen mit ihrer Hilfe erzielt werden? <br><br>  Es stellt sich heraus, dass dies auch sehr n√ºtzlich ist. Es ist sehr einfach, damit zu beginnen, und gleichzeitig gibt es viele Nuancen beim Testen der Konfiguration.  Welche - gemalt unter dem Schnitt basierend auf praktischen Erfahrungen. <br><a name="habracut"></a><br>  <i>Das Material basiert auf einer Abschrift eines Berichts von <b>Ruslan- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Zeremin</a> Cheremin</b> (einem Java-Entwickler bei der Deutschen Bank).</i>  <i>Als n√§chstes kommt die Rede aus der ersten Person.</i> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Tk_nmV-mWOA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Mein Name ist Ruslan, ich arbeite f√ºr die Deutsche Bank.  Wir beginnen damit: <br><br><img src="https://habrastorage.org/webt/vg/xr/rq/vgxrrqh1taa98cujjske1r5usa4.jpeg"><br><br>  Es gibt viel Text, von weitem scheint es, dass es russisch ist.  Das stimmt aber nicht.  Dies ist eine sehr alte und gef√§hrliche Sprache.  Ich habe eine √úbersetzung ins einfache Russisch gemacht: <br><br><ul><li>  Alle Charaktere sind erfunden </li><li>  Mit Vorsicht verwenden </li><li>  Beerdigung auf eigene Kosten </li></ul><br><br>  Ich werde kurz beschreiben, wor√ºber ich heute sprechen werde.  Angenommen, wir haben einen Code: <br><br><img src="https://habrastorage.org/webt/qv/ip/gd/qvipgdp4a8n1bjo79z29aicqmik.jpeg"><br><br>  Das hei√üt, anfangs hatten wir eine Aufgabe, wir schreiben einen Code, um sie zu l√∂sen, und er verdient uns angeblich Geld.  Wenn dieser Code aus irgendeinem Grund nicht richtig funktioniert, l√∂st er die falsche Aufgabe und bringt uns das falsche Geld ein.  Unternehmen m√∂gen diese Art von Geld nicht - sie sehen im Jahresabschluss schlecht aus. <br><br>  Daher haben wir f√ºr unseren wichtigen Code Tests: <br><br><img src="https://habrastorage.org/webt/0e/9g/-k/0e9g-klbunmtoyvlhf9q0-vl-4o.jpeg"><br><br>  Normalerweise dort.  Jetzt hat es wahrscheinlich fast jeder.  Tests best√§tigen, dass der Code das richtige Problem l√∂st und das richtige Geld verdient.  Der Dienst ist jedoch nicht auf Code beschr√§nkt, und neben dem Code gibt es auch eine Konfiguration: <br><br><img src="https://habrastorage.org/webt/z7/75/sq/z775sqxlsy1nha5hrclznn6biq0.jpeg"><br><br>  Zumindest in fast allen Projekten, an denen ich teilgenommen habe, war diese Konfiguration in der einen oder anderen Form.  (Ich kann mich nur an einige F√§lle aus meinen fr√ºhen UI-Jahren erinnern, in denen es keine Konfigurationsdateien gab, aber alles √ºber die UI konfiguriert wurde.) In dieser Konfiguration gibt es Ports, Adressen und Algorithmusparameter. <br><br><h2>  Warum ist die Konfiguration zum Testen wichtig? </h2><br>  Hier ist der Trick: Fehler in der Konfiguration beeintr√§chtigen die Programmausf√ºhrung nicht weniger als Fehler im Code.  Auch sie k√∂nnen dazu f√ºhren, dass der Code die falsche Aufgabe ausf√ºhrt - und siehe oben. <br><br>  Das Auffinden von Fehlern in der Konfiguration ist noch schwieriger als im Code, da die Konfiguration normalerweise nicht kompiliert wird.  Ich habe die Eigenschaftendateien als Beispiel angef√ºhrt, im Allgemeinen gibt es verschiedene Optionen (JSON, XML, jemand speichert in YAML), aber es ist wichtig, dass nichts davon kompiliert und dementsprechend nicht √ºberpr√ºft wird.  Wenn Sie versehentlich eine Java-Datei versiegelt haben, wird die Kompilierung h√∂chstwahrscheinlich nicht bestanden.  Ein zuf√§lliger Tippfehler in der Eigenschaft wird niemanden erregen, er wird zur Arbeit gehen. <br><br>  Und die IDE hebt den Fehler auch in der Konfiguration nicht hervor, da sie nur das primitivste √ºber das Format (zum Beispiel) von Eigenschaftendateien wei√ü: dass es einen Schl√ºssel und einen Wert geben sollte und zwischen ihnen "gleich", ein Doppelpunkt oder ein Leerzeichen steht.  Aber die Tatsache, dass der Wert eine Nummer, ein Netzwerkport oder eine Adresse sein muss - die IDE wei√ü nichts. <br><br>  Und selbst wenn Sie die Anwendung in einer UAT oder in einer Staging-Umgebung testen, garantiert dies nichts.  Da die Konfiguration in der Regel in jeder Umgebung unterschiedlich ist und Sie in der UAT nur die UAT-Konfiguration getestet haben. <br><br>  Eine weitere Feinheit ist, dass selbst in der Produktion Konfigurationsfehler manchmal nicht sofort auftreten.  Ein Dienst wird m√∂glicherweise √ºberhaupt nicht gestartet - und dies ist ein gutes Szenario.  Aber es kann starten und sehr lange funktionieren - bis zu dem Moment X, in dem genau der Parameter ben√∂tigt wird, in dem der Fehler auftritt.  Und hier stellen Sie fest, dass ein Dienst, der sich in letzter Zeit nicht viel ge√§ndert hat, pl√∂tzlich nicht mehr funktioniert. <br><br>  Nach all dem, was ich gesagt habe, scheint es, dass das Testen von Konfigurationen ein hei√ües Thema sein sollte.  Aber in der Praxis sieht es ungef√§hr so ‚Äã‚Äãaus: <br><br><img src="https://habrastorage.org/webt/9o/r3/24/9or324raqccmfaeghrlyaagxmja.jpeg"><br><br>  Zumindest war das bei uns der Fall - bis zu einem gewissen Punkt.  Und eine der Aufgaben meines Berichts ist es, auch f√ºr Sie nicht mehr so ‚Äã‚Äãauszusehen.  Ich hoffe, dass ich Sie dazu dr√§ngen kann. <br><br>  Vor drei Jahren arbeitete Andrei Satarin in unserer Deutschen Bank in meinem Team als QS-Leiter.  Er brachte die Idee auf, Konfigurationen zu testen - das hei√üt, er hat einfach den ersten solchen Test gemacht und durchgef√ºhrt.  Vor sechs Monaten hielt er beim vorherigen Heisenbug einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vortrag</a> √ºber das Testen der Konfiguration, wie er sie sieht.  Ich empfehle Ihnen einen Blick darauf zu werfen, da er dort einen umfassenden √úberblick √ºber das Problem gab: sowohl von der Seite wissenschaftlicher Artikel als auch von der Erfahrung gro√üer Unternehmen, die auf Konfigurationsfehler und deren Folgen gesto√üen sind. <br><br>  Mein Bericht wird enger gefasst sein - √ºber praktische Erfahrungen.  Ich werde dar√ºber sprechen, auf welche Probleme ich als Entwickler beim Schreiben von Konfigurationstests gesto√üen bin und wie ich diese Probleme gel√∂st habe.  Meine Entscheidungen sind m√∂glicherweise nicht die besten Entscheidungen, dies sind nicht die besten Praktiken - dies ist meine pers√∂nliche Erfahrung, ich habe versucht, keine umfassenden Verallgemeinerungen vorzunehmen. <br><br>  Allgemeiner √úberblick √ºber den Bericht: <br><br><ul><li>  ‚ÄûWas Sie vor Montagnachmittag tun k√∂nnen‚Äú: Einfache, n√ºtzliche Beispiele. </li><li>  "Montag, zwei Jahre sp√§ter": wo und wie man es besser macht. </li><li>  Unterst√ºtzung f√ºr das Refactoring der Konfiguration: Wie erreicht man eine dichte Abdeckung?  Softwarekonfigurationsmodell. </li></ul><br><br>  Der erste Teil ist motivierend: Ich werde die einfachsten Tests beschreiben, mit denen alles bei uns begann.  Es wird eine Vielzahl von Beispielen geben.  Ich hoffe, dass mindestens einer von ihnen mit Ihnen in Resonanz steht, das hei√üt, Sie werden ein √§hnliches Problem und dessen L√∂sung sehen. <br><br>  Die Tests selbst im ersten Teil sind einfach, sogar primitiv - aus technischer Sicht gibt es keine Raketenwissenschaft.  Aber nur dass sie schnell erledigt werden k√∂nnen, ist besonders wertvoll.  Dies ist ein so einfacher Einstieg in Konfigurationstests, und er ist wichtig, da das Schreiben dieser Tests eine psychologische Barriere darstellt.  Und ich m√∂chte zeigen, dass "Sie das k√∂nnen": Jetzt haben wir es gut f√ºr uns geklappt, und obwohl niemand gestorben ist, leben wir jetzt seit drei Jahren. <br><br>  Im zweiten Teil geht es darum, was danach zu tun ist.  Wenn Sie viele einfache Tests geschrieben haben, stellt sich die Frage nach der Unterst√ºtzung.  Einige von ihnen beginnen zu fallen, Sie verstehen die Fehler, die sie angeblich hervorgehoben haben.  Es stellt sich heraus, dass dies nicht immer bequem ist.  Und es stellt sich die Frage, komplexere Tests zu schreiben - schlie√ülich haben Sie bereits einfache F√§lle behandelt, ich m√∂chte etwas Interessanteres.  Auch hier gibt es keine Best Practices. Ich beschreibe nur einige der L√∂sungen, die f√ºr uns funktioniert haben. <br><br>  Im dritten Teil geht es darum, wie das Testen das Refactoring einer ziemlich komplexen und verwirrenden Konfiguration unterst√ºtzen kann.  Wieder eine Fallstudie - wie wir es gemacht haben.  Aus meiner Sicht ist dies ein Beispiel daf√ºr, wie Konfigurationstests skaliert werden k√∂nnen, um gr√∂√üere Aufgaben zu l√∂sen und nicht nur kleine L√∂cher zu schlie√üen. <br><br><h2>  Teil 1. "Du kannst es so machen" </h2><br>  Jetzt ist es schwer zu verstehen, was der erste Konfigurationstest bei uns war.  Andrei sitzt im Flur, er kann sagen, dass ich gelogen habe.  Aber es scheint mir, dass alles damit begann: <br><br><img src="https://habrastorage.org/webt/6t/dr/d8/6tdrd8-mwyj8otcngbcjsjqi3ge.jpeg"><br><br>  Die Situation ist folgende: Wir haben n Dienste auf demselben Host, jeder von ihnen hebt seinen eigenen JMX-Server an seinem Port an und exportiert einige √úberwachungs-JMXs.  Ports f√ºr alle Dienste sind in der Datei konfiguriert.  Die Datei nimmt jedoch mehrere Seiten ein, und es gibt viele andere Eigenschaften. Oft stellt sich heraus, dass die Ports verschiedener Dienste in Konflikt stehen.  Es ist leicht, einen Fehler zu machen.  Dann ist alles trivial: Einige Dienste steigen nicht, danach steigen sie nicht f√ºr diejenigen, die davon abh√§ngig sind - Tester sind w√ºtend. <br><br>  Dieses Problem wird in mehreren Zeilen gel√∂st.  Dieser Test, der (wie mir scheint) unser erster war, sah folgenderma√üen aus: <br><br><img src="https://habrastorage.org/webt/ka/ln/51/kaln51onx8-1yzdr2vq0ltcmegq.jpeg"><br><br>  Es ist nichts Kompliziertes: Wir gehen den Ordner durch, in dem sich die Konfigurationsdateien befinden, laden sie, analysieren sie als Eigenschaften, filtern die Werte heraus, deren Name "jmx.port" enth√§lt, und √ºberpr√ºfen, ob alle Werte eindeutig sind.  Es ist nicht erforderlich, Werte in Ganzzahlen umzuwandeln.  Vermutlich gibt es nur Ports. <br><br>  Meine erste Reaktion, als ich das sah, war gemischt: <br><br><img src="https://habrastorage.org/webt/ka/ln/51/kaln51onx8-1yzdr2vq0ltcmegq.jpeg"><br><br>  Erster Eindruck: Was ist es in meinen sch√∂nen Unit-Tests?  Warum sind wir in das Dateisystem geklettert? <br><br>  Und dann kam die √úberraschung: "Was, k√∂nnte das sein?" <br><br>  Ich spreche dar√ºber, weil es eine Art psychologische Barriere zu geben scheint, die es schwierig macht, solche Tests zu schreiben.  Seitdem sind drei Jahre vergangen, das Projekt ist voll von solchen Tests, aber ich sehe oft, dass meine Kollegen, die auf einen Fehler in der Konfiguration sto√üen, keine Tests darauf schreiben.  F√ºr den Code ist jeder bereits daran gew√∂hnt, Regressionstests zu schreiben, damit der gefundene Fehler nicht mehr reproduziert wird.  Aber sie tun es nicht f√ºr die Konfiguration, etwas st√∂rt.  Es gibt eine Art psychologische Barriere, die behandelt werden muss - deshalb erw√§hne ich eine solche Reaktion, damit Sie sie an sich selbst erkennen, wenn sie auftritt. <br><br><img src="https://habrastorage.org/webt/ka/ln/51/kaln51onx8-1yzdr2vq0ltcmegq.jpeg"><br><br>  Das folgende Beispiel ist fast das gleiche, aber leicht modifiziert - ich habe alle "jmx" entfernt.  Dieses Mal √ºberpr√ºfen wir alle Eigenschaften, die als "Something-There-Port" bezeichnet werden.  Sie m√ºssen ganzzahlige Werte sein und ein g√ºltiger Netzwerkport sein.  Matcher validNetworkPort () verbirgt unseren benutzerdefinierten Hamcrest Matcher, der √ºberpr√ºft, ob der Wert √ºber dem Bereich der Systemports und unter dem Bereich der kurzlebigen Ports liegt. Wir wissen, dass einige Ports auf unseren Servern bereits belegt sind. Hier ist auch die gesamte Liste dieser Ports versteckt Das ist Matcher. <br><br>  Dieser Test ist immer noch sehr primitiv.  Beachten Sie, dass darin kein Hinweis darauf enthalten ist, welche bestimmte Eigenschaft wir √ºberpr√ºfen - sie ist massiv.  Ein einziger solcher Test kann 500 Eigenschaften mit dem Namen "... port" √ºberpr√ºfen und sicherstellen, dass sie alle Ganzzahlen im gew√ºnschten Bereich sind, unter allen erforderlichen Bedingungen.  Sobald sie geschrieben haben, ein Dutzend Zeilen - und das war's.  Dies ist eine sehr praktische Funktion, da die Konfiguration ein einfaches Format hat: zwei Spalten, einen Schl√ºssel und einen Wert.  Daher kann es so massenverarbeitet werden. <br><br>  Ein weiteres Testbeispiel.  Was √ºberpr√ºfen wir hier? <br><br><img src="https://habrastorage.org/webt/7j/wt/wr/7jwtwr0zn93gy0fhfaqykbeyeyy.jpeg"><br><br>  Er pr√ºft, ob echte Passw√∂rter nicht in die Produktion gelangen.  Alle Passw√∂rter sollten ungef√§hr so ‚Äã‚Äãaussehen: <br><br><img src="https://habrastorage.org/webt/yg/4_/ft/yg4_ftjvkm_bhqqzmdxppafoaii.jpeg"><br><br>  Sie k√∂nnen viele Tests f√ºr Eigenschaftendateien schreiben.  Ich werde keine weiteren Beispiele nennen - ich m√∂chte mich nicht wiederholen, die Idee ist sehr einfach, dann sollte alles klar sein. <br><br>  ... und nachdem wir genug von diesen Tests geschrieben haben, taucht eine interessante Frage auf: Was meinen wir mit Konfiguration, wo ist ihre Grenze?  Wir betrachten die Eigenschaftendatei als Konfiguration, wir haben sie behandelt - und was kann noch im selben Stil behandelt werden? <br><br><h2>  Was ist eine Konfiguration zu beachten? </h2><br>  Es stellt sich heraus, dass das Projekt viele Textdateien enth√§lt, die nicht kompiliert wurden - zumindest im normalen Erstellungsprozess.  Sie werden in keiner Weise √ºberpr√ºft, bis sie auf dem Server ausgef√ºhrt werden, dh Fehler in ihnen erscheinen zu sp√§t.  Alle diese Dateien k√∂nnen - mit etwas Dehnung - als Konfiguration bezeichnet werden.  Zumindest werden sie ungef√§hr gleich getestet. <br><br>  Zum Beispiel haben wir ein System von SQL-Patches, die w√§hrend des Bereitstellungsprozesses in die Datenbank gerollt werden. <br><br><img src="https://habrastorage.org/webt/jz/bk/c7/jzbkc7m5zo0k6phy-9kuzvkqkam.jpeg"><br><br>  Sie sind f√ºr SQL * Plus geschrieben.  SQL * Plus ist ein Tool aus den 60er Jahren und erfordert alle m√∂glichen seltsamen Dinge: Zum Beispiel, um sicherzustellen, dass sich das Ende der Datei in einer neuen Zeile befindet.  Nat√ºrlich vergessen die Leute regelm√§√üig, das Ende der Linie dort zu setzen, weil sie nicht in den 60ern geboren wurden. <br><br><img src="https://habrastorage.org/webt/nr/oj/3w/nroj3wxkhriqqeqa-iwxwus0a0a.jpeg"><br><br>  Und wieder wird es durch dasselbe Dutzend Zeilen gel√∂st: Wir w√§hlen alle SQL-Dateien aus und pr√ºfen, ob am Ende ein abschlie√üender Schr√§gstrich steht.  Einfach, bequem, schnell. <br><br>  Ein weiteres Beispiel f√ºr "wie eine Textdatei" sind Crontabs.  Unsere Crontab-Services starten und stoppen.  Sie verursachen meistens zwei Fehler: <br><br><img src="https://habrastorage.org/webt/02/i0/ch/02i0chpobgao-lexobckwr5ffd4.jpeg"><br><br>  Erstens das Format des Zeitplanausdrucks.  Es ist nicht so kompliziert, aber niemand √ºberpr√ºft es vor dem Start, so dass es einfach ist, ein zus√§tzliches Leerzeichen, Komma und dergleichen einzuf√ºgen. <br><br>  Zweitens muss sich das Ende der Datei wie im vorherigen Beispiel in einer neuen Zeile befinden. <br><br>  Und das alles ist ziemlich einfach zu √ºberpr√ºfen.  Das Ende der Datei ist verst√§ndlich, aber um den Zeitplan zu √ºberpr√ºfen, finden Sie vorgefertigte Bibliotheken, die den Cron-Ausdruck analysieren.  Vor dem Bericht habe ich gegoogelt: Es waren mindestens sechs.  Ich habe sechs gefunden, aber im Allgemeinen kann es mehr geben.  Als wir geschrieben haben, haben wir die einfachste der gefundenen genommen, da wir nicht den Inhalt des Ausdrucks √ºberpr√ºfen mussten, sondern nur seine syntaktische Korrektheit, damit cron ihn erfolgreich geladen hat. <br><br>  Grunds√§tzlich k√∂nnen Sie mehr Schecks abwickeln - stellen Sie sicher, dass Sie am richtigen Wochentag beginnen und die Dienste nicht mitten am Arbeitstag einstellen.  Dies stellte sich jedoch als nicht so n√ºtzlich f√ºr uns heraus, und wir haben uns nicht darum gek√ºmmert. <br><br>  Eine andere Idee, die gro√üartig funktioniert, sind Shell-Skripte.  Nat√ºrlich ist das Schreiben eines vollwertigen Parsers von Bash-Skripten in Java ein Vergn√ºgen f√ºr die Mutigen.  Das Fazit ist jedoch, dass eine gro√üe Anzahl dieser Skripte keine vollst√§ndige Bash ist.  Ja, es gibt Bash-Skripte, bei denen der Code direkt ist, H√∂lle und H√∂lle, bei denen sie einmal im Jahr vorbeischauen und fluchend davonlaufen.  Viele Bash-Skripte sind jedoch dieselben Konfigurationen.  Es gibt eine Reihe von Systemvariablen und Umgebungsvariablen, die auf den gew√ºnschten Wert eingestellt sind, wodurch andere Skripts konfiguriert werden, die diese Variablen verwenden.  Und solche Variablen lassen sich leicht aus dieser Bash-Datei abrufen und etwas √ºber sie √ºberpr√ºfen. <br><br><img src="https://habrastorage.org/webt/5s/4d/z_/5s4dz_wtejguewyqrat5ipxa7by.jpeg"><br><br>  √úberpr√ºfen Sie beispielsweise, ob JAVA_HOME in jeder Umgebung installiert ist oder ob in LD_LIBRARY_PATH eine JNI-Bibliothek vorhanden ist.  Irgendwie sind wir von einer Java-Version zu einer anderen gewechselt und haben den Test erweitert: Wir haben √ºberpr√ºft, ob JAVA_HOME f√ºr genau diese Teilmenge der Umgebung ‚Äû1.8‚Äú enth√§lt, die wir schrittweise auf die neue Version √ºbertragen haben. <br><br>  Hier einige Beispiele.  Lassen Sie mich den ersten Teil der Schlussfolgerungen zusammenfassen: <br><br><ul><li>  Konfigurationstests sind zun√§chst verwirrend, es gibt eine psychologische Barriere.  Aber nach der √úberwindung gibt es viele Stellen in der Anwendung, die nicht durch Schecks abgedeckt sind und abgedeckt werden k√∂nnen. </li><li>  Dann werden sie <b>leicht und fr√∂hlich geschrieben</b> : Es gibt viele ‚Äûniedrig h√§ngende Fr√ºchte‚Äú, die schnell gro√üe Vorteile bringen. </li><li>  Reduzieren Sie die <b>Kosten f√ºr das</b> Erkennen und Korrigieren von Konfigurationsfehlern.  Da es sich tats√§chlich um Komponententests handelt, k√∂nnen Sie diese bereits vor dem Festschreiben auf Ihrem Computer ausf√ºhren - dies reduziert die R√ºckkopplungsschleife erheblich.  Viele von ihnen w√§ren nat√ºrlich beispielsweise in der Testbereitstellungsphase getestet worden.  Und viele w√ºrden nicht getestet - wenn dies eine Produktionskonfiguration ist.  Und so werden sie direkt auf dem lokalen Computer √ºberpr√ºft. </li><li>  Sie geben eine zweite Jugend.  In dem Sinne, dass man das Gef√ºhl hat, noch viele interessante Dinge testen zu k√∂nnen.  In der Tat ist es im Code nicht mehr so ‚Äã‚Äãeinfach zu finden, was Sie testen k√∂nnen. </li></ul><br><br><h2>  Teil 2. Komplexere F√§lle </h2><br>  Fahren wir mit komplexeren Tests fort.  Nachdem die meisten trivialen √úberpr√ºfungen, wie die hier gezeigten, behandelt wurden, stellt sich die Frage: Ist es m√∂glich, etwas Komplizierteres zu √ºberpr√ºfen? <br><br>  Was bedeutet es "schwerer"?  Die Tests, die ich gerade beschrieben habe, haben ungef√§hr die folgende Struktur: <br><br><img src="https://habrastorage.org/webt/er/an/sx/eransxujnuprewkr1lcrk1nweui.jpeg"><br><br>  Sie √ºberpr√ºfen etwas gegen eine bestimmte Datei.  Das hei√üt, wir gehen die Dateien durch und wenden auf jede eine bestimmte Bedingungspr√ºfung an.  Somit kann vieles √ºberpr√ºft werden, aber es gibt n√ºtzlichere Szenarien: <br><br><ul><li>  Die UI-Anwendung stellt eine Verbindung zum Server <b>ihrer</b> Umgebung her. </li><li>  Alle Dienste derselben Umgebung stellen eine Verbindung zu <b>demselben</b> Verwaltungsserver her. </li><li>  Alle Dienste in derselben Umgebung verwenden <b>dieselbe</b> Datenbank. </li></ul><br><br>  Eine UI-Anwendung stellt beispielsweise eine Verbindung zu ihrem Umgebungsserver her.  H√∂chstwahrscheinlich sind die Benutzeroberfl√§che und der Server unterschiedliche Module, wenn √ºberhaupt keine Projekte, und sie haben unterschiedliche Konfigurationen. Es ist unwahrscheinlich, dass sie dieselben Konfigurationsdateien verwenden.  Daher m√ºssen Sie sie verkn√ºpfen, damit alle Dienste einer Umgebung mit einem Schl√ºsselverwaltungsserver verbunden sind, √ºber den Befehle verteilt werden.  Auch dies sind h√∂chstwahrscheinlich unterschiedliche Module, unterschiedliche Dienste und im Allgemeinen unterschiedliche Teams, die sie entwickeln. <br><br>  Oder alle Dienste verwenden dieselbe Datenbank, dasselbe - Dienste in verschiedenen Modulen. <br><br>  In der Tat gibt es ein solches Bild: Viele Dienste, jeder von ihnen hat seine eigene Struktur von Konfigurationen, Sie m√ºssen einige von ihnen reduzieren und etwas an der Kreuzung √ºberpr√ºfen: <br><br><img src="https://habrastorage.org/webt/tw/et/op/twetop-jheecrf02felhlhchnvi.jpeg"><br><br>  Nat√ºrlich k√∂nnen Sie genau das tun: Laden Sie eines herunter, das zweite, ziehen Sie irgendwo etwas heraus, kleben Sie den Testcode ein.  Aber Sie k√∂nnen sich vorstellen, wie gro√ü der Code sein wird und wie lesbar er sein wird.  Wir haben damit angefangen, aber dann haben wir gemerkt, wie schwierig es ist.  Wie kann man es besser machen? <br><br>  Wenn Sie tr√§umen, w√§re es bequemer, dann tr√§umte ich, dass der Test so aussehen w√ºrde, als w√ºrde ich ihn in menschlicher Sprache erkl√§ren: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Theory</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eachEnvironmentIsXXX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Environment environment )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( Server server : environment.servers() ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( Service service : server.services() ) { Properties config = buildConfigFor( environment, server, service ); <span class="hljs-comment"><span class="hljs-comment">//‚Ä¶ check {something} about config } } }</span></span></code> </pre> <br>  F√ºr jede Umgebung ist eine Bedingung erf√ºllt.  Um dies zu √ºberpr√ºfen, ben√∂tigen Sie aus der Umgebung eine Liste der Server und eine Liste der Dienste.  Laden Sie dann die Konfigurationen und √ºberpr√ºfen Sie etwas an der Kreuzung.  Dementsprechend brauche ich so etwas, ich nannte es Bereitstellungslayout. <br><br><img src="https://habrastorage.org/webt/cs/um/3u/csum3u7sucokbnlydgulc18cdhs.jpeg"><br><br>  Wir ben√∂tigen eine M√∂glichkeit aus dem Code, um Zugriff auf die Bereitstellung der Anwendung zu erhalten: Auf welchen Servern, welche Dienste, in welcher Umgebung, um diese Datenstruktur abzurufen.  Und von dort aus beginne ich, die Konfiguration zu laden und zu verarbeiten. <br><br>  Das Bereitstellungslayout ist f√ºr jedes Team und jedes Projekt spezifisch.  Ich habe gezeichnet - dies ist ein allgemeiner Fall: Normalerweise gibt es eine Reihe von Servern, Diensten, ein Dienst hat manchmal eine Reihe von Konfigurationsdateien und nicht nur eine.  Manchmal sind zus√§tzliche Parameter erforderlich, die f√ºr Tests n√ºtzlich sind. Sie m√ºssen hinzugef√ºgt werden.  Beispielsweise kann das Rack wichtig sein, in dem sich der Server befindet.  Andrey gab in seinem Bericht ein Beispiel, als es f√ºr ihre Dienste wichtig war, dass sich Backup- / Prim√§rdienste in verschiedenen Racks befinden m√ºssen. In seinem Fall m√ºsste er im Bereitstellungslayout einen Verweis auf das Rack beibehalten: <br><br><img src="https://habrastorage.org/webt/gj/oh/ip/gjohipszob-edpgkekfr1zvdfp0.jpeg"><br><br>  F√ºr unsere Zwecke ist die Serverregion wichtig, im Prinzip auch das spezifische Rechenzentrum, damit sich Backup / Primary in verschiedenen Rechenzentren befinden.  Dies sind alles zus√§tzliche Servereigenschaften, sie sind projektspezifisch, aber auf der Folie ist dies ein gemeinsamer Nenner. <br><br>  Wo bekomme ich das Bereitstellungslayout?  Es scheint, dass es in jedem gro√üen Unternehmen ein Infrastruktur-Management-System gibt, alles wird dort beschrieben, es ist zuverl√§ssig, zuverl√§ssig und all das ... eigentlich nicht. <br><br>  Zumindest hat meine Praxis in zwei Projekten gezeigt, dass es einfacher ist, zuerst fest zu codieren und dann nach drei Jahren ... harth√§utig zu bleiben. <br><br>  Wir leben jetzt seit drei Jahren mit diesem Projekt.  Im zweiten Fall scheinen wir uns in einem Jahr noch in das Infrastrukturmanagement zu integrieren, aber all diese Jahre haben wir so gelebt.  Aus Erfahrung ist es sinnvoll, die Aufgabe der Integration in IM zu verschieben, um so schnell wie m√∂glich vorgefertigte Tests zu erhalten, die zeigen, dass sie funktionieren und n√ºtzlich sind.  Und dann kann sich herausstellen, dass diese Integration m√∂glicherweise nicht so notwendig ist, da die Verteilung der Dienste auf die Server nicht so h√§ufig ge√§ndert wird. <br><br>  Hardcode kann buchst√§blich so sein: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Environment { PROD( PROD_UK_PRIMARY, PROD_UK_BACKUP, PROD_US_PRIMARY, PROD_US_BACKUP, PROD_SG_PRIMARY, PROD_SG_BACKUP ) ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Server[] servers() {‚Ä¶} } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Server { PROD_UK_PRIMARY(‚Äúrflx-ldn-<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">"), PROD_UK_BACKUP("</span></span>rflx-ldn-<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">"), PROD_US_PRIMARY(‚Äúrflx-nyc-1"</span></span>), PROD_US_BACKUP(<span class="hljs-string"><span class="hljs-string">"rflx-nyc-2"</span></span>), PROD_SG_PRIMARY(‚Äúrflx-sng-<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">"), PROD_SG_BACKUP("</span></span>rflx-sng-<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-string"><span class="hljs-string">"), public Service[] services() {‚Ä¶} }</span></span></code> </pre><br>  Der einfachste Weg, den wir in unserem ersten Projekt verwenden, besteht darin, Environment mit einer Liste von Servern in jedem von ihnen aufzulisten.  Es gibt eine Liste von Servern und anscheinend sollte es eine Liste von Diensten geben, aber wir haben betrogen: Wir haben Startskripte (die auch Teil der Konfiguration sind). <br><br><img src="https://habrastorage.org/webt/m0/ww/jw/m0wwjwoo1xhqahbdppfbf8q5rno.jpeg"><br><br>  Sie f√ºhren Dienste f√ºr jede Umgebung aus.  Und die services () -Methode greift einfach alle Dienste aus der Datei ihres Servers auf.  Dies geschieht, weil es nicht so viele Umgebungen gibt und Server auch selten hinzugef√ºgt oder gel√∂scht werden - aber es gibt viele Dienste, und sie werden ziemlich oft gemischt.  Es war sinnvoll, das eigentliche Layout von Diensten aus Skripten zu laden, um das fest codierte Layout nicht zu oft zu √§ndern. <br><br>  Nach dem Erstellen eines solchen Softwarekonfigurationsmodells erscheinen angenehme Boni.  Sie k√∂nnen beispielsweise einen Test wie folgt schreiben: <br><br><img src="https://habrastorage.org/webt/ht/-o/lk/ht-olkpuql9rl2jhdkpm23yfnlm.jpeg"><br><br>  Der Test ist, dass in jeder Umgebung alle wichtigen Dienste vorhanden sind.  Angenommen, es gibt vier Schl√ºsseldienste, und der Rest kann oder kann nicht sein, aber ohne diese vier macht es keinen Sinn.  Sie k√∂nnen √ºberpr√ºfen, ob Sie sie nirgendwo vergessen haben und ob sie alle Backups in derselben Umgebung haben.  In den meisten F√§llen treten solche Fehler beim Konfigurieren der UAT dieser Instanzen auf, sie k√∂nnen jedoch auch in PROD √ºbertragen werden.  Letztendlich verschwenden Fehler in der UAT auch Zeit und Nerven der Tester. <br><br>  Es stellt sich die Frage, ob die Relevanz des Konfigurationsmodells erhalten bleibt.  Sie k√∂nnen auch einen Test daf√ºr schreiben. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HardCodedLayoutConsistencyTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Theory</span></span> eachHardCodedEnvironmentHasConfigFiles(Environment env){ ‚Ä¶ } <span class="hljs-meta"><span class="hljs-meta">@Theory</span></span> eachConfigFileHasHardCodedEnvironment(File configFile){ ‚Ä¶ } }</code> </pre><br>  Es gibt Konfigurationsdateien und ein Bereitstellungslayout im Code.  Und Sie k√∂nnen dies f√ºr jede Umgebung / jeden Server / usw. √ºberpr√ºfen.  Es gibt eine entsprechende Konfigurationsdatei und f√ºr jede Datei des erforderlichen Formats die entsprechende Umgebung.  Sobald Sie vergessen haben, etwas an einer Stelle hinzuzuf√ºgen, wird der Test fallen. <br><br>  Das Endergebnis ist das Bereitstellungslayout: <br><br><ul><li>  Vereinfacht das Schreiben komplexer Tests, bei denen Konfigurationen aus verschiedenen Teilen der Anwendung zusammengef√ºhrt werden. </li><li>  Macht sie klarer und lesbarer.  Sie sehen so aus, wie Sie auf hohem Niveau √ºber sie denken, und nicht so, wie sie Konfigurationen durchlaufen. </li><li>  Wenn Leute w√§hrend der Erstellung Fragen stellen, werden viele interessante Dinge √ºber die Bereitstellung herausgestellt.  Einschr√§nkungen, implizites heiliges Wissen, ergeben sich beispielsweise hinsichtlich der M√∂glichkeit, zwei Umgebungen auf einem Server zu hosten.  Es stellt sich heraus, dass die Entwickler anders denken und ihre Dienste entsprechend schreiben.  Und solche Momente sind n√ºtzlich, um sich zwischen den Entwicklern zu einigen. </li><li>  Erg√§nzt die Dokumentation gut (besonders wenn dies nicht der Fall ist).  Selbst wenn dies der Fall ist, ist es f√ºr mich als Entwickler angenehmer, dies im Code zu sehen.  Au√üerdem k√∂nnen Sie dort Kommentare schreiben, die mir wichtig sind, und nicht jemand anderem.  Und Sie k√∂nnen auch fest codieren.  Wenn Sie also entscheiden, dass sich nicht zwei Umgebungen auf demselben Server befinden k√∂nnen, k√∂nnen Sie eine Pr√ºfung einf√ºgen, die jetzt nicht mehr ausgef√ºhrt wird.  Zumindest werden Sie herausfinden, ob es jemand versucht.  Das hei√üt, dies ist eine Dokumentation mit der F√§higkeit, sie durchzusetzen.  Das ist sehr hilfreich. </li></ul><br>  Lass uns weitermachen.  Nachdem die Tests geschrieben wurden, haben sie sich ein Jahr lang ‚Äûniedergelassen‚Äú, einige beginnen zu fallen.  Einige beginnen fr√ºher zu fallen, aber es ist nicht so be√§ngstigend.  Es ist be√§ngstigend, wenn ein vor einem Jahr geschriebener Test f√§llt, Sie sich die Fehlermeldung ansehen und nicht verstehen. <br><img src="https://habrastorage.org/webt/gm/e1/kb/gme1kb6jzdvbvfpfxlxydbxbktw.jpeg"><br><br>  Angenommen, ich verstehe und stimme zu, dass dies ein ung√ºltiger Netzwerkport ist - aber wo ist er?  Vor dem Vortrag habe ich mir die Tatsache angesehen, dass das Projekt 1.200 Eigenschaftendateien enth√§lt, die auf 90 Module verteilt sind und insgesamt 24.000 Zeilen enthalten.  (Ich war zwar √ºberrascht, aber wenn Sie z√§hlen, dann ist dies keine so gro√üe Zahl - f√ºr einen Dienst f√ºr 4 Dateien.) Wo ist dieser Port? <br><br>  Es ist klar, dass assertThat () ein Nachrichtenargument enth√§lt. Sie k√∂nnen etwas eingeben, das zur Identifizierung des Ortes beitr√§gt.  Aber wenn Sie einen Test schreiben, denken Sie nicht dar√ºber nach.  Und selbst wenn Sie denken, m√ºssen Sie noch raten, welche Beschreibung detailliert genug ist, um in einem Jahr verstanden zu werden.  Ich m√∂chte diesen Moment automatisieren, damit es eine M√∂glichkeit gibt, Tests mit automatischer Generierung einer mehr oder weniger klaren Beschreibung zu schreiben, anhand derer Sie einen Fehler finden k√∂nnen. <br><br>  Wieder tr√§umte und tr√§umte ich von so etwas: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> environment, <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>, component, configLocation, propertyName, propertyValue <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> configuration(environment, <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>, component) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> propertyName <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> ‚Äú%.port%‚Äù <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> propertyValue <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> validNetworkPort()</code> </pre><br>  Das ist so ein Pseudo-SQL - nun, ich kenne nur SQL, und das Gehirn hat die L√∂sung aus dem Vertrauten herausgeworfen.  Die Idee ist, dass die meisten Konfigurationstests aus mehreren Teilen desselben Typs bestehen.  Zun√§chst wird eine Teilmenge von Parametern durch die Bedingung ausgew√§hlt: <br><br><img src="https://habrastorage.org/webt/ig/om/g_/igomg_lacmbr2w7xdnuqtxgrnoc.jpeg"><br><br>  In Bezug auf diese Teilmenge √ºberpr√ºfen wir dann etwas in Bezug auf den Wert: <br><br><img src="https://habrastorage.org/webt/xm/zr/1p/xmzr1p3brb_ixbgiafqteeiltgg.jpeg"><br><br>  Und wenn es Eigenschaften gibt, deren Werte den Wunsch nicht erf√ºllen, ist dies das ‚ÄûBlatt‚Äú, das wir in der Fehlermeldung erhalten m√∂chten: <br><br><img src="https://habrastorage.org/webt/6d/ci/jr/6dcijrp9yesvndnn6hq2udo5fw8.jpeg"><br><br>  Einmal dachte ich sogar, ich k√∂nnte einen Parser wie SQL schreiben, da es jetzt nicht schwierig ist.  Aber dann wurde mir klar, dass die IDE dies nicht unterst√ºtzt und vorschl√§gt, sodass die Leute blind auf dieses selbst erstellte ‚ÄûSQL‚Äú schreiben m√ºssen, ohne IDE-Eingabeaufforderungen, ohne Kompilierung, ohne √úberpr√ºfung - dies ist nicht sehr praktisch.  Daher musste ich nach L√∂sungen suchen, die von unserer Programmiersprache unterst√ºtzt werden.  Wenn wir .NET h√§tten, w√ºrde LINQ helfen, es ist fast SQL-√§hnlich. <br><br>  In Java gibt es keinen LINQ, so nah wie m√∂glich an Streams.  So sollte dieser Test in Streams aussehen: <br><br><pre> <code class="java hljs">ValueWithContext[] incorrectPorts = flattenedProperties( environment ) .filter( propertyNameContains( <span class="hljs-string"><span class="hljs-string">".port"</span></span> ) ) .filter( !isInteger( propertyValue ) || !isValidNetworkPort( propertyValue ) ) .toArray(); assertThat( incorrectPorts, emptyArray() );</code> </pre><br>  flattenedProperties () √ºbernimmt alle Konfigurationen dieser Umgebung, alle Dateien f√ºr alle Server, Dienste und erweitert sie zu einer gro√üen Tabelle.  Dies ist im Wesentlichen eine SQL-√§hnliche Tabelle, jedoch in Form einer Reihe von Java-Objekten.  Und flattenedProperties () gibt diesen Satz von Zeichenfolgen als Stream zur√ºck. <br><br><img src="https://habrastorage.org/webt/8b/ep/jb/8bepjbpkln50gcn1hlgdizwxkxe.jpeg"><br><br>  Anschlie√üend f√ºgen Sie einige Bedingungen f√ºr diesen Satz von Java-Objekten hinzu.  In diesem Beispiel: Wir w√§hlen diejenigen aus, die "property" im propertyName enthalten, und filtern diejenigen, bei denen die Werte nicht in Integer konvertiert werden oder nicht aus dem g√ºltigen Bereich.  Dies sind fehlerhafte Werte, und theoretisch sollten sie eine leere Menge sein. <br><br><img src="https://habrastorage.org/webt/4z/8i/db/4z8idb1t_vtoprcjg3f23ct0aeq.jpeg"><br><br>  Wenn es sich nicht um eine leere Menge handelt, wird ein Fehler ausgegeben, der folgenderma√üen aussieht: <br><br><img src="https://habrastorage.org/webt/ia/wq/wy/iawqwytklkjtldsc-afzmw7-cui.jpeg"><br><br><h2>  Teil 3. Testen als Unterst√ºtzung f√ºr das Refactoring </h2><br>  In der Regel ist das Testen von Code eine der leistungsst√§rksten Refactoring-Unterst√ºtzungen.  Refactoring ist ein gef√§hrlicher Prozess, viel Wiederherstellen, und ich m√∂chte sicherstellen, dass die Anwendung danach noch funktionsf√§hig ist.  Eine M√∂glichkeit, dies sicherzustellen, besteht darin, zuerst alles mit Tests auf allen Seiten zu √ºberlagern und dann damit umzugestalten. <br><br>  Und jetzt war vor mir die Aufgabe, die Konfiguration zu √ºberarbeiten.  Es gibt eine Anwendung, die vor sieben Jahren von einer klugen Person geschrieben wurde.  Die Konfiguration dieser Anwendung sieht ungef√§hr so ‚Äã‚Äãaus: <br><br><img src="https://habrastorage.org/webt/d4/vc/wz/d4vcwzxtgvecd-be0n51ysi9mho.jpeg"><br><br>  Dies ist ein Beispiel, es gibt noch viel mehr.  Dreifache Verschachtelungspermutationen, die in der gesamten Konfiguration verwendet werden: <br><br><img src="https://habrastorage.org/webt/ua/gt/t7/uagtt7xt289h6xfpc0swrmfztca.jpeg"><br><br>  Die Konfiguration selbst enth√§lt nur wenige Dateien, die jedoch ineinander enthalten sind.  Es verwendet eine kleine Erweiterung von iu Properties - Apache Commons Configuration, die nur Einschl√ºsse und Berechtigungen in geschweiften Klammern unterst√ºtzt. <br><br>  Und der Autor hat mit genau diesen beiden Dingen einen fantastischen Job gemacht.  Ich glaube, er hat dort eine Turing-Maschine gebaut.  An einigen Stellen scheint es wirklich so, als w√ºrde er versuchen, Berechnungen mit Einschl√ºssen und Substitutionen durchzuf√ºhren.  Ich wei√ü nicht, ob dieses Turing-System vollst√§ndig ist, aber er hat meiner Meinung nach versucht, dies zu beweisen. <br><br>  Und der Mann ging.  Schrieb, die Anwendung funktioniert, und er verlie√ü die Bank.  Alles funktioniert, nur niemand versteht die Konfiguration vollst√§ndig. <br><br>  Wenn wir einen separaten Service in Anspruch nehmen, ergeben sich 10 Einschl√ºsse mit dreifacher Tiefe und insgesamt 450 Parameter, wenn alles erweitert wird.  Tats√§chlich verwendet dieser bestimmte Dienst 10-15% von ihnen, der Rest der Parameter bezieht sich auf andere Dienste, da die Dateien gemeinsam genutzt werden und von mehreren Diensten verwendet werden.  Aber was genau 10-15% diesen speziellen Service nutzen, ist nicht so einfach zu verstehen.  Der Autor hat anscheinend verstanden.  Sehr kluge Person, sehr. <br><br>  Die Aufgabe bestand jeweils darin, die Konfiguration und das Refactoring zu vereinfachen.  Gleichzeitig wollte ich die Anwendung am Laufen halten, da in dieser Situation die Chancen daf√ºr gering sind.  Ich m√∂chte: <br><br><ul><li>  Vereinfachen Sie die Konfiguration. </li><li>  Damit hat jeder Service nach dem Refactoring noch alle notwendigen Parameter. </li><li>  Damit er keine zus√§tzlichen Parameter hat.  85% derjenigen, die nichts damit zu tun haben, sollten die Seite nicht √ºberladen. </li><li>  Diese Dienste waren immer noch erfolgreich in Clustern verbunden und f√ºhrten eine Zusammenarbeit durch. </li></ul><br>  Das Problem ist, dass nicht bekannt ist, wie gut sie sich jetzt verbinden, da das System hochredundant ist.  Mit Blick auf die Zukunft: W√§hrend des Refactorings stellte sich heraus, dass in einer der Produktionskonfigurationen vier Server im Sicherungsclip enthalten sein sollten, tats√§chlich waren es jedoch zwei.  Aufgrund des hohen Redundanzniveaus bemerkte dies niemand - der Fehler trat versehentlich auf, aber tats√§chlich war das Redundanzniveau lange Zeit niedriger als erwartet.  Der Punkt ist, dass wir uns nicht darauf verlassen k√∂nnen, dass die aktuelle Konfiguration √ºberall korrekt ist. <br><br>  Ich f√ºhre dazu, dass Sie die neue Konfiguration nicht einfach mit der alten vergleichen k√∂nnen.  Es mag gleichwertig sein, bleibt aber gleichzeitig irgendwo falsch.  Es ist notwendig, den logischen Inhalt zu √ºberpr√ºfen. <br><br>  Minimales Programm: Isolieren Sie jeden einzelnen Parameter jedes ben√∂tigten Dienstes und √ºberpr√ºfen Sie die Richtigkeit, ob Port ein Port ist, Adresse eine Adresse ist, TTL eine positive Zahl ist usw.  √úberpr√ºfen Sie auch die Schl√ºsselbeziehungen, die Dienste im Wesentlichen an den Hauptendpunkten verbinden.  Zumindest wollte ich das erreichen.  Das hei√üt, im Gegensatz zu den vorherigen Beispielen besteht die Aufgabe hier nicht darin, einzelne Parameter zu √ºberpr√ºfen, sondern die gesamte Konfiguration mit einem vollst√§ndigen Netzwerk von √úberpr√ºfungen abzudecken. <br><br>  Wie teste ich es? <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleComponent</span></span></span><span class="hljs-class"> </span></span>{ ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Configuration conf )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port = conf.getInt( <span class="hljs-string"><span class="hljs-string">"Port"</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( port &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationException(); String ip = conf.getString( <span class="hljs-string"><span class="hljs-string">"Address"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ip == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationException(); ‚Ä¶ } ‚Ä¶ }</code> </pre><br>  Wie habe ich dieses Problem gel√∂st?  Es gibt eine einfache Komponente, im Beispiel ist sie maximal vereinfacht.  (F√ºr diejenigen, die nicht auf Apache Commons Configuration gesto√üen sind: Das Konfigurationsobjekt ist wie Eigenschaften, nur hat es noch die typisierten Methoden getInt (), getLong () usw .; Wir k√∂nnen davon ausgehen, dass dies juProperties f√ºr kleine Steroide sind.) Angenommen, eine Komponente ben√∂tigt zwei Parameter: beispielsweise eine TCP-Adresse und einen TCP-Port.  Wir ziehen sie heraus und √ºberpr√ºfen.  Was sind die vier gemeinsamen Teile hier? <br><br><img src="https://habrastorage.org/webt/ou/s0/0k/ous00k4owrh8kqvf20fqqpzrfg0.jpeg"><br><br>  Dies sind der Parametername, der Typ, die Standardwerte (hier sind sie trivial: null und -1, manchmal gibt es vern√ºnftige Werte) und einige Validierungen.  Der Port hier wird zu einfach und unvollst√§ndig validiert. Sie k√∂nnen den Port angeben, der ihn passieren soll, aber kein g√ºltiger Netzwerkport ist.  Deshalb m√∂chte ich auch diesen Moment verbessern.  Aber zuerst m√∂chte ich diese vier Dinge in eine Sache verwandeln.  Zum Beispiel: <br><br><pre> <code class="java hljs">IProperty&lt;Integer&gt; PORT_PROPERTY = intProperty( <span class="hljs-string"><span class="hljs-string">"Port"</span></span> ) .withDefaultValue( -<span class="hljs-number"><span class="hljs-number">1</span></span> ) .matchedWith( validNetworkPort() ); IProperty&lt;String&gt; ADDRESS_PROPERTY = stringProperty( <span class="hljs-string"><span class="hljs-string">"Address"</span></span> ) .withDefaultValue( <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ) .matchedWith( validIPAddress() );</code> </pre><br>  Ein solches zusammengesetztes Objekt ist eine Beschreibung einer Eigenschaft, deren Name und Standardwert eine Validierung durchf√ºhren k√∂nnen (hier verwende ich erneut den Hamcrest-Matcher).  Und dieses Objekt hat so etwas wie diese Schnittstelle: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IProperty</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* (name, defaultValue, matcher‚Ä¶) */</span></span> <span class="hljs-comment"><span class="hljs-comment">/** lookup (or use default), * convert type, * validate value against matcher */</span></span> <span class="hljs-function"><span class="hljs-function">FetchedValue&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Configuration config )</span></span></span><span class="hljs-function"> } class FetchedValue&lt;T&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String propertyName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> T propertyValue; ‚Ä¶ }</code> </pre><br>  Das hei√üt, nachdem Sie ein f√ºr eine bestimmte Implementierung spezifisches Objekt erstellt haben, k√∂nnen Sie ihn bitten, den von ihm dargestellten Parameter aus der Konfiguration zu extrahieren.  Und er wird diesen Parameter herausziehen, den Prozess √ºberpr√ºfen, wenn es keinen Parameter gibt, wird er einen Standardwert angeben, zum gew√ºnschten Typ f√ºhren und ihn sofort mit dem Namen zur√ºckgeben. <br><br>  Das hei√üt, hier ist der Name des Parameters und ein solcher tats√§chlicher Wert, dass der Dienst sieht, ob er von dieser Konfiguration anfordert.  Auf diese Weise k√∂nnen Sie mehrere Codezeilen in eine Entit√§t einschlie√üen. Dies ist die erste Vereinfachung, die ich ben√∂tige. <br><br>  Die zweite Vereinfachung, die ich zur L√∂sung des Problems ben√∂tigte, bestand darin, eine Komponente einzuf√ºhren, die f√ºr ihre Konfiguration mehrere Eigenschaften ben√∂tigt.  Komponentenkonfigurationsmodell: <br><br><img src="https://habrastorage.org/webt/gf/rr/ku/gfrrkugkjdimk8kcunvu4vijrsu.jpeg"><br><br>  Wir hatten eine Komponente, die diese beiden Eigenschaften verwendete. Es gibt ein Modell f√ºr ihre Konfiguration - die IConfigurationModel-Schnittstelle, die diese Klasse implementiert.  IConfigurationModel erledigt alles, was die Komponente tut, aber nur den Teil, der sich auf die Konfiguration bezieht.  Wenn die Komponente Parameter in einer bestimmten Reihenfolge mit bestimmten Standardwerten ben√∂tigt, kombiniert IConfigurationModel diese Informationen in sich selbst und kapselt sie.  Alle anderen Aktionen der Komponente sind f√ºr ihn nicht wichtig.  Dies ist ein Komponentenmodell f√ºr den Konfigurationszugriff. <br><br><img src="https://habrastorage.org/webt/1v/-b/0d/1v-b0dpycb6qscw_n5sul8tbzec.jpeg"><br><br>  Der Trick dieser Ansicht ist, dass die Modelle kombinierbar sind.  Wenn es eine Komponente gibt, die andere Komponenten verwendet und diese dort kombiniert werden, kann das Modell dieser komplexen Komponente auf die gleiche Weise die Ergebnisse von Aufrufen zweier Unterkomponenten zusammenf√ºhren. <br><br>  Das hei√üt, es ist m√∂glich, eine Hierarchie von Konfigurationsmodellen parallel zur Hierarchie der Komponenten selbst zu erstellen.  Rufen Sie im oberen Modell fetch () auf, um das Blatt aus den Parametern zur√ºckzugeben, die er aus der Konfiguration mit ihren Namen abgerufen hat - genau die, die die entsprechende Komponente in Echtzeit ben√∂tigt.  Wenn wir alle Modelle richtig geschrieben haben, nat√ºrlich. <br><br>  Das hei√üt, die Aufgabe besteht darin, solche Modelle f√ºr jede Komponente in der Anwendung zu schreiben, die Zugriff auf die Konfiguration hat.  In meiner Anwendung gab es einige solcher Komponenten: Die Anwendung selbst ist ziemlich belaubt, verwendet den Code jedoch aktiv wieder, sodass nur 70 Hauptklassen konfiguriert sind.  F√ºr sie musste ich 70 Modelle schreiben. <br><br>  Was es gekostet hat: <br><br><ul><li>  12 Dienstleistungen </li><li>  70 konfigurierbare Klassen </li><li>  =&gt; 70 Konfigurationsmodelle (~ 60 sind trivial); </li><li>  1-2 Personenwochen. </li></ul><br>  Ich habe einfach den Bildschirm mit dem Komponentencode ge√∂ffnet, der sich selbst konfiguriert, und auf dem n√§chsten Bildschirm habe ich den Code f√ºr das entsprechende Konfigurationsmodell geschrieben.  Die meisten von ihnen sind trivial, wie das gezeigte Beispiel.  In einigen F√§llen gibt es Verzweigungen und bedingte √úberg√§nge - dort wird der Code verzweigter, aber alles ist auch gel√∂st.  In anderthalb bis zwei Wochen habe ich dieses Problem gel√∂st, f√ºr alle 70 Komponenten habe ich die Modelle beschrieben. <br><br>  Wenn wir alles zusammenf√ºgen, erhalten wir den folgenden Code: <br><br><img src="https://habrastorage.org/webt/dq/ab/vf/dqabvfz99qwfnortpempmtvaalm.jpeg"><br><br>  F√ºr jeden Service / jede Umgebung / etc.  Wir nehmen das Konfigurationsmodell, dh den obersten Knoten dieses Baums, und bitten darum, alles aus der Konfiguration zu erhalten.  Zu diesem Zeitpunkt werden alle √úberpr√ºfungen durchgef√ºhrt. Wenn sich eine der Eigenschaften aus der Konfiguration herauszieht, √ºberpr√ºft sie ihren Wert auf Richtigkeit.  Wenn mindestens einer nicht bestanden wird, wird eine Ausnahme ausgel√∂st.  Der gesamte Code wird erhalten, indem √ºberpr√ºft wird, ob alle Werte isoliert g√ºltig sind. <br><br><h2>  Service-Abh√§ngigkeiten </h2><br>  Wir hatten immer noch eine Frage, wie die gegenseitige Abh√§ngigkeit von Diensten √ºberpr√ºft werden kann.  Dies ist etwas komplizierter. Sie m√ºssen sich ansehen, welche Art von gegenseitiger Abh√§ngigkeit es gibt.  Es stellte sich f√ºr mich heraus, dass die gegenseitigen Abh√§ngigkeiten darauf zur√ºckzuf√ºhren sind, dass sich Dienste auf Netzwerkendpunkten ‚Äûtreffen‚Äú sollten.  Dienst A sollte genau die Adresse abh√∂ren, an die Dienst B Pakete sendet, und umgekehrt.  In meinem Beispiel sind alle Abh√§ngigkeiten zwischen den Konfigurationen verschiedener Dienste darauf zur√ºckzuf√ºhren.  Es war m√∂glich, dieses Problem auf so einfache Weise zu l√∂sen: Ports und Adressen von verschiedenen Diensten abrufen und √ºberpr√ºfen.  Es w√ºrde viele Tests geben, sie w√§ren sperrig.  Ich bin eine faule Person und ich wollte das nicht.  Deshalb habe ich es anders gemacht. <br><br>  Erstens wollte ich diesen Netzwerkendpunkt selbst irgendwie abstrahieren.  F√ºr eine TCP-Verbindung ben√∂tigen Sie beispielsweise nur zwei Parameter: Adresse und Port.  F√ºr eine Multicast-Verbindung vier Parameter.  Ich w√ºrde es gerne in eine Art Objekt zusammenbrechen lassen.  Ich habe dies im Endpoint-Objekt getan, das alles verbirgt, was Sie brauchen.  Die Folie ist ein Beispiel f√ºr OutcomingTCPEndpoint, eine ausgehende TCP-Netzwerkverbindung. <br><br><pre> <code class="java hljs">IProperty&lt;IEndpoint&gt; TCP_REQUEST = outcomingTCP( <span class="hljs-comment"><span class="hljs-comment">// (+matchers, +default values) ‚ÄúTCP.Request.Address‚Äù, ‚ÄúTCP.Request.Port¬ª ); class OutcomingTCPEndpoint implements IEndpoint { //(localInterface, localAddress, multicastGroup, port) @Override boolean matches( IEndpoint other); }</span></span></code> </pre><br>    Endpoint    matches(),      Endpoint,  ,           . <br><br>  ¬´ ¬ª?     ,    : , ,  -   ,          ‚Äî        .   ,     ,  /  . ,  ,          . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dementsprechend haben wir anstelle primitiver Eigenschaftswerte, Portadressen-Multicast-Gruppen jetzt eine komplexe Eigenschaft, die Endpoint zur√ºckgibt. Und in allen ConfigurationModels gibt es anstelle separater Eigenschaften so komplexe. Was gibt uns das? Dies gibt uns diese Art der Cluster-Konnektivit√§tspr√ºfung:</font></font><br><br><pre> <code class="java hljs">ValueWithContext[] allEndpoints = flattenedConfigurationValues(environment) .filter( valueIsEndpoint() ) .toArray(); ValueWithContext[] unpairedEndpoints = Arrays.stream( allEndpoints ) .filter( e -&gt; !hasMatchedEndpoint(e, allEndpoints) ) .toArray(); assertThat( unpairedEndpoints, emptyArray() );</code> </pre><br>      environment'  endpoint',    ,   ,      ,     .          .     ¬´  ¬ª  O(n^2),     ,   endpoint'  ,    . <br><br>      Endpoint      ,   ,    .     ,        ,  -     . <br><br> ,  ,     ,   ¬´¬ª ‚Äî     ,   .      .  ,          ,       .  ,       . <br><br>      .   , ,   .        , ,      ,   c,  ,        . <br><br>    ConfigurationModel : <br><br><ul><li>     </li><li>     (‚Äú udp-,     ‚Äù) </li><li>        . </li></ul><br>          ,       .         ,     ,   ,    ‚Äî   .    :          ,      .        ,      ,      ,     ,  . <br><br>  Das reicht aber nicht.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit diesem Konstrukt kann ich mithilfe von ConfigurationModels Konfigurationsanforderungen ausf√ºhren. </font><font style="vertical-align: inherit;">Heben Sie es in den Speicher und finden Sie heraus, welche bestimmten UDP-Ports auf diesem Server von verschiedenen Diensten verwendet werden. Fordern Sie eine Liste der verwendeten Ports mit den Anweisungen der Dienste an. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dar√ºber hinaus kann ich die Dienste auf Endpunkten verbinden und in Form eines Diagramms anzeigen, nach .dot exportieren. </font><font style="vertical-align: inherit;">Und andere √§hnliche Anfragen sind leicht zu stellen. </font><font style="vertical-align: inherit;">Das Ergebnis war ein solches Schweizer Messer - die Baukosten haben sich recht gut ausgezahlt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier h√∂re ich auf.</font></font> Schlussfolgerungen: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Meiner Meinung nach ist das Testen der Konfiguration wichtig und macht Spa√ü. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt viele niedrig h√§ngende Fr√ºchte, die Eintrittsschwelle f√ºr einen Start ist niedrig. </font><font style="vertical-align: inherit;">Sie k√∂nnen komplexe Probleme l√∂sen, aber es gibt auch viele einfache.</font></font></li><li>    ,    ,     ,       . </li></ul><br><blockquote>     Heisenbug 2018 Piter ,  : <b>6-7   </b>   <b>Heisenbug</b> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>      .   1     ‚Äî        . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de427487/">https://habr.com/ru/post/de427487/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de427477/index.html">Wir bereiten hierarchisches Clustering vor oder wie ich Spezialisierungen im Lebenslauf identifiziert habe</a></li>
<li><a href="../de427479/index.html">Die Verwendung von Benutzerdaten und der Verkauf von Big Data sollen legitimiert werden</a></li>
<li><a href="../de427481/index.html">Merkmale des Aufbaus eines Wi-Fi-Netzwerks in der innovativen Lebensmittelproduktion</a></li>
<li><a href="../de427483/index.html">Schule f√ºr K√ºnstliche Intelligenz im Bin√§rbezirk</a></li>
<li><a href="../de427485/index.html">Das Problem mit Windows ist nicht die Aktualisierungsrate, sondern der Entwicklungsprozess</a></li>
<li><a href="../de427489/index.html">HomeData: Wie Datenanalyse in Architektur und St√§dtebau eingesetzt wird</a></li>
<li><a href="../de427491/index.html">vDud auf Englisch: 7 westliche Interviewer, von denen jeder ein Beispiel nimmt</a></li>
<li><a href="../de427493/index.html">Verst√§rker der Niederfrequenzklassen: A, B, AB, D, G, H.</a></li>
<li><a href="../de427495/index.html">Wie viel unterrichtet Habr +, um herauszufinden, wie viel andere Unternehmen verdienen</a></li>
<li><a href="../de427499/index.html">Wor√ºber schreiben sie im technischen Support des Video-Streamers?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>