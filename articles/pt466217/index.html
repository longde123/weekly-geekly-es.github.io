<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙃 🚳 👩🏼‍🎤 Gerando documentos usando o ONLYOFFICE DocumentBuilder 🌍 💃🏿 🌰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Habr. 


 Quero falar sobre um utilitário chamado DocumentBuilder, que permite gerar documentos, tabelas e apresentações e também mostrar como você...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gerando documentos usando o ONLYOFFICE DocumentBuilder</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466217/"><p><img src="https://habrastorage.org/webt/i8/j3/kd/i8j3kdtzriyrkwbhkbqbbpozbik.png"></p><br><p>  Oi Habr. </p><br><p>  Quero falar sobre um utilitário chamado DocumentBuilder, que permite gerar documentos, tabelas e apresentações e também mostrar como você pode usá-lo para resolver seus problemas, usando o exemplo da criação de um currículo a partir de modelos. </p><br><p>  O construtor funciona da seguinte maneira: você escreve código em js usando métodos especiais da documentação, fornece-o ao utilitário e ele coleta o documento.  Ou não coleta se houver erros. </p><a name="habracut"></a><br><p>  É recomendável usar um construtor se você deseja resolver tarefas do seguinte tipo: </p><br><ul><li>  Você precisa criar muitos documentos com pequenas variações ou documentos com base em muitos dados. </li><li>  Você precisa integrar a geração de documentos em qualquer serviço. </li></ul><br><p>  Existem serviços que permitem criar um currículo: o usuário preenche os campos necessários e o sistema gera um documento e o entrega ao usuário.  Este será um exemplo de como usar o construtor. </p><br><p>  Como ferramentas, usarei o Node.js (express). </p><br><p>  Plano: </p><br><ol><li>  O usuário insere dados no formulário na página do navegador, o formulário é enviado ao servidor. </li><li>  No servidor Node.js, ele cria um script para o construtor com base nos dados do usuário. </li><li>  O Node.js fornece o script para o construtor. </li><li>  O construtor cria um documento usando um script. </li><li>  Node.js retorna o link para o documento para o usuário. </li></ol><br><h2 id="sozdanie-formy">  Criação de formulário </h2><br><p>  Primeiro, crie um formulário no qual o usuário insira seus dados.  O formulário terá 8 campos: "Nome completo", "Número de telefone", "E-mail", "Perfil", "Diploma", "Universidade", "Localização", "Ano", "Habilidade".  O campo de habilidade pode ser clonado. </p><br><p>  Crie um arquivo index.html e adicione o código do modelo. </p><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill-name"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill-name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"full name"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phone-number"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phone-number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phone number"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"email"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"profile"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"profile"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Insert a brief description of yourself"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"education"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"degree"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"degree"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"university"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"university"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"location"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"location"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"date"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"year"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"year"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"skills"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"skill"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"new-skill"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"skill"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onkeyup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"add_skill_by_enter(event)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"add_skill()"</span></span></span><span class="hljs-tag">&gt;</span></span>+<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Aqui eu uso duas funções: add_skill_by_enter (event) e add_skill ().  Eles são necessários para adicionar vários campos pressionando o botão + ou Enter.  Descreverei essas funções um pouco mais tarde. </p><br><p>  Adicione um botão para enviar o formulário ao servidor: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sendForm()"</span></span></span><span class="hljs-tag">&gt;</span></span>Send<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Agora vamos escrever funções para trabalhar com o formulário. </p><br><p>  A primeira função é add_skill () </p><br><pre> <code class="javascript hljs">add_skill = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newSkill = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"new-skill"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newSkill.value === <span class="hljs-string"><span class="hljs-string">''</span></span>) {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//   ,       const div = document.createElement("div"); .// div const span = document.createElement("span"); //   const button = document.createElement("button"); //    span.innerText += newSkill.value; //   span   newSkill.value = ''; //      newSkill.focus(); //        button.innerText += "-"; button.onclick = () =&gt; { //      div.remove(); }; div.appendChild(span); //  span  div div.appendChild(button); //   document.getElementsByClassName('skills')[0].appendChild(div); //     }; add_skill_by_enter() add_skill_by_enter = (event) =&gt; { if (event.code === "Enter") { //  ,      enter add_skill(); } };</span></span></code> </pre> <br><p>  Adicionamos uma função simples para coletar dados dos campos e enviá-los para o servidor. </p><br><pre> <code class="javascript hljs"> get_skill_values = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> skills = []; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'new-skill'</span></span>).value !== <span class="hljs-string"><span class="hljs-string">''</span></span>) { skills.push(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'new-skill'</span></span>).value); } <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.from(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByClassName(<span class="hljs-string"><span class="hljs-string">'skillfield'</span></span>)).forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">current_element</span></span></span><span class="hljs-function"> =&gt;</span></span> { skills.push(current_element.innerHTML); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> skills; }; sendForm() sendForm = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { fetch(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({ <span class="hljs-attr"><span class="hljs-attr">userData</span></span>: { <span class="hljs-attr"><span class="hljs-attr">fillName</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'fill-name'</span></span>).value, <span class="hljs-attr"><span class="hljs-attr">phoneNumber</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'phone-number'</span></span>).value, <span class="hljs-attr"><span class="hljs-attr">email</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'email'</span></span>).value, <span class="hljs-attr"><span class="hljs-attr">profile</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'profile'</span></span>).value, <span class="hljs-attr"><span class="hljs-attr">education</span></span>: { <span class="hljs-attr"><span class="hljs-attr">degree</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'degree'</span></span>).value, <span class="hljs-attr"><span class="hljs-attr">university</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'university'</span></span>).value, <span class="hljs-attr"><span class="hljs-attr">location</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'location'</span></span>).value, <span class="hljs-attr"><span class="hljs-attr">year</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'year'</span></span>).value, }, <span class="hljs-attr"><span class="hljs-attr">skills</span></span>: get_skill_values() } }) }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> res.json()) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { location.replace(<span class="hljs-string"><span class="hljs-string">'/'</span></span> + response.filename); <span class="hljs-comment"><span class="hljs-comment">//  ,       }) .catch(error =&gt; console.error('Error:', error)); };</span></span></code> </pre> <br><h2 id="servernaya-chast-dlya-raboty-s-formoy">  O lado do servidor para trabalhar com o formulário </h2><br><p>  Eu escrevo a parte do servidor no express.  A conexão de todas as bibliotecas, a configuração do servidor e a descrição dos métodos get e post são assim: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bodyParser = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'body-parser'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express(); app.use(bodyParser.json()); app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, (req, res) =&gt; { res.sendFile(path.join(__dirname + <span class="hljs-string"><span class="hljs-string">'/index.html'</span></span>)); }); app.post(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, (req, res) =&gt; { <span class="hljs-comment"><span class="hljs-comment">//        }); app.listen(3000, () =&gt; console.log(`Example app listening on port ${3000}!`));</span></span></code> </pre> <br><p>  Execute express: <br> <code>node main.js</code> </p> <br><p>  Abra o endereço no navegador: <br> <code>http:localhost:3000</code> </p> <br><p>  Vemos o formulário criado.  Nós a preenchemos com dados arbitrários: <br><img src="https://habrastorage.org/webt/v9/qo/sq/v9qosqh3l4ppxfrt-zulcv1fyce.png"></p><br><p>  Temos o seguinte json: </p><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"userData"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"fillName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Rotatyy Dmitryi"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"phoneNumber"</span></span>:<span class="hljs-string"><span class="hljs-string">"89879879898"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"email"</span></span>:<span class="hljs-string"><span class="hljs-string">"flamine@list.ru"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"profile"</span></span>:<span class="hljs-string"><span class="hljs-string">"Hi, my name is Joe\nAnd I work in a button factory\nI got a wife and two kids\nOne day, my boss says, “Joe, are you busy?”\nI said, “no”\n“Then push this button with your right hand”"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"country"</span></span>:<span class="hljs-string"><span class="hljs-string">"Russia"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"city"</span></span>:<span class="hljs-string"><span class="hljs-string">"Nizhniy Novgorod"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"education"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"degree"</span></span>:<span class="hljs-string"><span class="hljs-string">"Master of Pupets"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"university"</span></span>:<span class="hljs-string"><span class="hljs-string">"Nizhny novgorod state technical university"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"location"</span></span>:<span class="hljs-string"><span class="hljs-string">"Nizhniy Novgorod"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"year"</span></span>:<span class="hljs-string"><span class="hljs-string">"2015-05-02"</span></span>},<span class="hljs-attr"><span class="hljs-attr">"skills"</span></span>:[<span class="hljs-string"><span class="hljs-string">"apple.js"</span></span>,<span class="hljs-string"><span class="hljs-string">"vintage.js"</span></span>,<span class="hljs-string"><span class="hljs-string">"zerg.js"</span></span>,<span class="hljs-string"><span class="hljs-string">"css"</span></span>,<span class="hljs-string"><span class="hljs-string">"html"</span></span>,<span class="hljs-string"><span class="hljs-string">"linux"</span></span>]}};</code> </pre> <br><p>  Agora você precisa escrever um script para o construtor.  Tomei como base o modelo que o Google Docs oferece (modelo de currículo). </p><br><p>  Este modelo é assim: <br><img src="https://habrastorage.org/getpro/habr/post_images/0a0/488/bbe/0a0488bbe082407d850b2fe37bd5704f.png" alt="imagem"></p><br><p>  Usando esses dados e o modelo, é necessário criar um script com o qual o construtor criará o documento. </p><br><p>  Existem várias opções de como fazer isso, e a mais simples é baixar a versão para desktop dos editores do ONLYOFFICE e escrever uma macro que criará o documento usando os dados.  E depois adicione à macro a criação e o salvamento do arquivo - você obtém um script para o construtor.  Isso funcionará porque as macros e o construtor usam a mesma API. <br><img src="https://habrastorage.org/webt/0n/qo/ee/0nqoeewn2so-cv6gvwwdlvpywls.png"></p><br><h2 id="sozdanie-skripta-dlya-bildera">  Criando um script para um construtor </h2><br><p>  Começamos inicializando o objeto de página e adicionando os dados que vieram do usuário: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Document = Api.GetDocument(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = {<span class="hljs-string"><span class="hljs-string">"userData"</span></span>:{<span class="hljs-string"><span class="hljs-string">"fillName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Rotatyy Dmitryi"</span></span>,<span class="hljs-string"><span class="hljs-string">"phoneNumber"</span></span>:<span class="hljs-string"><span class="hljs-string">"89879879898"</span></span>,<span class="hljs-string"><span class="hljs-string">"email"</span></span>:<span class="hljs-string"><span class="hljs-string">"flamine@list.ru"</span></span>,<span class="hljs-string"><span class="hljs-string">"profile"</span></span>:<span class="hljs-string"><span class="hljs-string">"Hi, my name is Joe\nAnd I work in a button factory\nI got a wife and two kids\nOne day, my boss says, “Joe, are you busy?”\nI said, “no”\n“Then push this button with your right hand”"</span></span>,<span class="hljs-string"><span class="hljs-string">"country"</span></span>:<span class="hljs-string"><span class="hljs-string">"Russia"</span></span>,<span class="hljs-string"><span class="hljs-string">"city"</span></span>:<span class="hljs-string"><span class="hljs-string">"Nizhniy Novgorod"</span></span>,<span class="hljs-string"><span class="hljs-string">"education"</span></span>:{<span class="hljs-string"><span class="hljs-string">"degree"</span></span>:<span class="hljs-string"><span class="hljs-string">"Master of Pupets"</span></span>,<span class="hljs-string"><span class="hljs-string">"university"</span></span>:<span class="hljs-string"><span class="hljs-string">"Nizhny novgorod state technical university"</span></span>,<span class="hljs-string"><span class="hljs-string">"location"</span></span>:<span class="hljs-string"><span class="hljs-string">"Nizhniy Novgorod"</span></span>,<span class="hljs-string"><span class="hljs-string">"year"</span></span>:<span class="hljs-string"><span class="hljs-string">"2015-05-02"</span></span>},<span class="hljs-string"><span class="hljs-string">"skills"</span></span>:[<span class="hljs-string"><span class="hljs-string">"apple.js"</span></span>,<span class="hljs-string"><span class="hljs-string">"vintage.js"</span></span>,<span class="hljs-string"><span class="hljs-string">"zerg.js"</span></span>,<span class="hljs-string"><span class="hljs-string">"css"</span></span>,<span class="hljs-string"><span class="hljs-string">"html"</span></span>,<span class="hljs-string"><span class="hljs-string">"linux"</span></span>]}};</code> </pre> <br><p>  Agora você precisa adicionar o parágrafo com o nome de usuário completo.  Está escrito em negrito e este parágrafo tem um espaçamento entre linhas de 1,15. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> paragraph = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.GetElement(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       FullName_style = Document.CreateStyle("FullName"); //    FullName_style.GetTextPr().SetFontSize(28); //    FullName_style.GetTextPr().SetBold(true); //  bold paragraph.SetStyle(FullName_style); //      paragraph.SetSpacingLine(1.15 * 240, "auto"); //    paragraph.AddText(data.userData.fillName); //    </span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Também adicionamos os parágrafos restantes:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Country and city const CountryCity_style = Document.CreateStyle("CountryCity"); CountryCity_style.GetTextPr().SetFontSize(20); CountryCity_style.GetTextPr().SetCaps(true); CountryCity_style.GetTextPr().SetBold(true); paragraph = Api.CreateParagraph(); paragraph.AddText(data.userData.country + ', ' + data.userData.city); paragraph.SetStyle(CountryCity_style); paragraph.SetSpacingAfter(0); Document.Push(paragraph); // phone number const PhoneNumber_style = Document.CreateStyle("PhoneNumber"); PhoneNumber_style.GetTextPr().SetFontSize(20); PhoneNumber_style.GetParaPr().SetSpacingAfter(0); PhoneNumber_style.GetTextPr().SetBold(true); paragraph = Api.CreateParagraph(); paragraph.AddText(data.userData.phoneNumber); paragraph.SetStyle(PhoneNumber_style); Document.Push(paragraph); // email const Email_style = Document.CreateStyle("Email"); Email_style.GetTextPr().SetFontSize(18); Email_style.GetParaPr().SetSpacingAfter(0); Email_style.GetTextPr().SetBold(true); paragraph = Api.CreateParagraph(); paragraph.AddText(data.userData.email); paragraph.SetStyle(Email_style); Document.Push(paragraph); // SectionHeader style const SectionHeader = Document.CreateStyle("SectionHeader"); SectionHeader.GetTextPr().SetBold(true); SectionHeader.GetTextPr().SetColor(247, 93, 93, false); SectionHeader.GetTextPr().SetFontSize(28); SectionHeader.GetParaPr().SetSpacingBefore(1.33 * 240); SectionHeader.GetParaPr().SetSpacingLine(1 * 240, "auto"); // add header Profile: paragraph = Api.CreateParagraph(); paragraph.AddText("Profile:") paragraph.SetStyle(SectionHeader); Document.Push(paragraph); // add profile text: paragraph = Api.CreateParagraph(); paragraph.AddText(data.userData.profile) Document.Push(paragraph); // add header Education: paragraph = Api.CreateParagraph(); paragraph.AddText("Education:") paragraph.SetStyle(SectionHeader); Document.Push(paragraph); // add education year: const EducationYear_style = Document.CreateStyle("EducationYear"); EducationYear_style.GetTextPr().SetColor(102, 102, 102); EducationYear_style.GetTextPr().SetFontSize(18); EducationYear_style.GetParaPr().SetSpacingAfter(0); paragraph = Api.CreateParagraph(); paragraph.SetStyle(EducationYear_style); paragraph.AddText(data.userData.education.year) Document.Push(paragraph); // add education university: paragraph = Api.CreateParagraph(); run = Api.CreateRun(); run.AddText(data.userData.education.university) run.AddText(', ') run.AddText(data.userData.education.location) run.SetBold(true); paragraph.AddElement(run); run = Api.CreateRun(); run.AddText(' – ' + data.userData.education.degree) paragraph.AddElement(run); Document.Push(paragraph); // add header Skills: paragraph = Api.CreateParagraph(); paragraph.AddText("Skills:") paragraph.SetStyle(SectionHeader); Document.Push(paragraph); // add skills text: paragraph = Api.CreateParagraph(); const skills = data.userData.skills.map(x =&gt; ' ' + x).toString(); paragraph.AddText(skills) Document.Push(paragraph);</span></span></code> </pre> </div></div><br><p>  Ao executar este script, obtemos o seguinte documento: <br><img src="https://habrastorage.org/webt/jt/bu/c3/jtbuc3bitzmanxfyvddrmrohi_8.png"></p><br><p>  Agora é hora de adicionar recursos para escrever código de script em um arquivo e gerar um documento. </p><br><p>  Geramos o script -&gt; escrevemos no arquivo -&gt; entregamos o arquivo ao construtor -&gt; retornamos o link ao arquivo para o usuário. </p><br><p>  Adicionamos uma conexão de complementos para trabalhar com arquivos e executar comandos usando o Node.js, além de criar uma pasta "pública" e torná-la pública: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {exec} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'child_process'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); app.use(express.static(<span class="hljs-string"><span class="hljs-string">'public'</span></span>));</code> </pre> <br><p>  A função para gerar texto com um script será muito simples - ela simplesmente retornará uma sequência com todo o código do construtor, enquanto adiciona dados do usuário.  É importante adicionar um caractere de quebra de linha no final de cada linha, caso contrário nada funcionará. </p><br><pre> <code class="javascript hljs">generate_script = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> first_template = <span class="hljs-string"><span class="hljs-string">'builder.CreateFile("docx");\n'</span></span> + <span class="hljs-string"><span class="hljs-string">'const Document = Api.GetDocument();\n'</span></span>; first_template += <span class="hljs-string"><span class="hljs-string">'const data = '</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(data) + <span class="hljs-string"><span class="hljs-string">';\n'</span></span>; first_template += <span class="hljs-string"><span class="hljs-string">'let paragraph = Document.GetElement(0);\n'</span></span> + <span class="hljs-string"><span class="hljs-string">'FullName_style = Document.CreateStyle("FullName");\n'</span></span> + ....   ~~~~~~~~~~~ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> first_template; };</code> </pre> <br><p>  Agora você precisa gravar o script em um arquivo e entregá-lo ao construtor.  De fato, todo o trabalho com o construtor será reduzido ao fato de que precisamos executar o comando <code>documentbuilder path/script.js   Node.js</code> </p><br><p>  Escrevemos uma função de compilação que fará isso: </p><br><pre> <code class="javascript hljs">build = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, res</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filename = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random().toString(<span class="hljs-number"><span class="hljs-number">36</span></span>).substring(<span class="hljs-number"><span class="hljs-number">7</span></span>) + <span class="hljs-string"><span class="hljs-string">'.docx'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    let script = generate_script(data); script += 'builder.SaveFile("docx", "' + __dirname + '/public/' + filename + '");\n' + 'builder.CloseFile();'; fs.writeFile('public/' + filename + 'js', script, () =&gt; { exec('documentbuilder ' + 'public/' + filename + 'js', () =&gt; { res.send({'filename': filename }); }); }); };</span></span></code> </pre> <br><p>  Adicione uma chamada ao método build (req.body, res);  quando pedido pós </p><br><pre> <code class="javascript hljs">app.post(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, (req, res) =&gt; { build(req.body, res); });</code> </pre> <br><p>  E você terminou.  Por precaução, publiquei o código de exemplo completo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  Assim, você pode incorporar o ONLYOFFICE DocumentBuilder em um aplicativo da web. </p><br><p>  Espero que, apesar de um grande número de simplificações, tudo esteja claro.  Usei apenas o código mínimo necessário para mostrar como tudo funciona. </p><br><p>  No momento, há pensamentos para concluir a utilidade e expandir a gama de problemas a serem resolvidos.  Ficaria muito grato se você compartilhar os casos reais de geração de documentos (bem, de tabelas com apresentações, é claro também) nos comentários ou no PM. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt466217/">https://habr.com/ru/post/pt466217/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt466201/index.html">Como deixar a ciência em TI e se tornar um testador: a história de uma carreira</a></li>
<li><a href="../pt466203/index.html">Dia Techdir em São Petersburgo. Cerveja, pizza, dois microfones</a></li>
<li><a href="../pt466211/index.html">Linha principal do projeto no Android 10</a></li>
<li><a href="../pt466213/index.html">4 etapas para criar um perfil de candidato</a></li>
<li><a href="../pt466215/index.html">Projeto orientado a modelo. Criação de um modelo confiável, usando o exemplo de um trocador de calor para aviação</a></li>
<li><a href="../pt466223/index.html">Decomposição limpa</a></li>
<li><a href="../pt466227/index.html">Programação Orientada a Nós</a></li>
<li><a href="../pt466229/index.html">Como comprar dez caixas de algodão e não cometer erros</a></li>
<li><a href="../pt466231/index.html">ShIoTiny e o mundo ao redor: conectando sensores a entradas binárias, rejeição de contato e outros problemas</a></li>
<li><a href="../pt466235/index.html">Munch em uma varredura equidistante e Meyerhold, que destruiu a Praça Vermelha - Denis Semenov sobre VR art</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>