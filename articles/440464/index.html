<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÇ ü•à üë©‚Äçüíª Trabaje con el servicio de bases de datos administradas de Digital Ocean en .NET Core üêò üë®‚Äç‚öïÔ∏è üë®üèº‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mientras que otras plataformas en la nube han tenido sus propias soluciones de bases de datos, Digital Ocean no ha ofrecido nada en este segmento hast...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trabaje con el servicio de bases de datos administradas de Digital Ocean en .NET Core</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440464/"><img src="https://habrastorage.org/webt/e_/bj/jo/e_bjjoivkrya5lta7gyiwloplfm.jpeg"><br><br>  Mientras que otras plataformas en la nube han tenido sus propias soluciones de bases de datos, Digital Ocean no ha ofrecido nada en este segmento hasta hoy.  Pero el 14 de febrero, el d√≠a de todos los amantes, la compa√±√≠a decidi√≥ hacer un regalo a sus clientes y lanz√≥ el servicio de bases de datos administradas en modo de disponibilidad limitada. <br><br>  Dado que Digital Ocean es ahora una plataforma bastante popular para alojar peque√±os proyectos en .NET Core, no podr√≠a ignorar este evento. <br><br>  C√≥mo describir√© en esta publicaci√≥n c√≥mo funcionan los servicios y cu√°les son los matices cuando se conecta a la base de datos cuando se usa .NET Core. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/fj/d5/pa/fjd5pa3g_lhtwaqg-ze79tysb5k.png"><br><br>  Hoy en d√≠a, est√°n disponibles las bases de datos PostrgeSQL versi√≥n 10 y 11. MySQL y Redis son las siguientes. <br><br>  Seg√∫n Digital Ocean, el servicio de base de datos administrada resuelve los problemas comunes que enfrentan muchas empresas y desarrolladores al crear un cl√∫ster desde cero: <br><br><ul><li>  Determinando la infraestructura √≥ptima </li><li>  Escale la infraestructura a medida que crecen sus requisitos comerciales y de datos </li><li>  Dise√±e y administre infraestructura de alta disponibilidad y procesos de conmutaci√≥n por error </li><li>  Implementaci√≥n de una estrategia de respaldo y recuperaci√≥n </li><li>  Pronosticar y mantener los costos de mantenimiento de la infraestructura. </li></ul><br>  Hoy, la creaci√≥n de la base m√°s compacta le costar√° $ 15.  La configuraci√≥n m√°s cara puede costar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√°s de dos mil d√≥lares al mes</a> . <br><br><h2>  Piscinas de conexi√≥n </h2><br>  Cuando un cliente se conecta directamente a una base de datos PostgreSQL, el servidor crea un proceso para manejar esta conexi√≥n.  Cada conexi√≥n individual requiere aproximadamente 10 MB de RAM y usa esta memoria hasta que se cierra.  Adem√°s, el n√∫mero total de conexiones es fijo, y cuando se utilizan todas las conexiones, los nuevos clientes ya no podr√°n conectarse. <br><br>  Digital Ocean le permite crear grupos de conexiones que se ejecutan sobre la base de PgBouncer.  El grupo de conexiones reduce los problemas de rendimiento al dirigir las conexiones del cliente a la aplicaci√≥n del grupo, lo que reduce la cantidad de procesos que la base de datos necesita procesar.  La aplicaci√≥n de grupo transfiere parte de las conexiones a la base de datos y coloca el resto en la cola donde est√°n hasta que la base de datos est√© libre para nuevas conexiones. <br><br>  Cuando se usa el grupo de conexiones, las aplicaciones no necesitan administrar la conexi√≥n real.  Solo necesitar√°n conectarse al grupo y desconectarse despu√©s de completar la tarea. <br><br><h3>  Creaci√≥n de piscina </h3><br>  Crear un grupo de conexiones es muy simple: debe abrir un cl√∫ster e ir a la pesta√±a Grupos de conexiones.  DigitalOcean admite tres tipos de agrupaci√≥n: <br><br><img src="https://habrastorage.org/webt/0o/_v/lh/0o_vlhubgsfv5uqpejugwocpzdm.png"><br><br>  <b>Transacci√≥n</b> <br><br>  Este modo permite que cada cliente use el grupo simult√°neamente para una transacci√≥n.  Si se env√≠an m√°s transacciones de las que est√°n disponibles en el grupo, las transacciones adicionales se ponen en cola y se procesan despu√©s de que las conexiones est√©n disponibles.  El modo de transacci√≥n es adecuado cuando tiene una gran cantidad de clientes que usan conexiones inactivas.  Estos clientes mantendr√°n su conexi√≥n al grupo sin establecer una conexi√≥n a PostgreSQL. <br><br>  <b>Sesi√≥n</b> <br><br>  Este modo permite al cliente procesar solicitudes hasta que se desconecte de la base de datos, manteniendo una conexi√≥n con este cliente todo el tiempo.  Si se conectan m√°s clientes de los que no se puede procesar en el grupo, estos clientes se ponen en cola y se conectan despu√©s de desconectar un cliente existente. <br><br>  <b>Declaraci√≥n</b> <br><br>  Este modo es el m√°s estricto y permite solo un operador a la vez antes de pasar al siguiente cliente en la cola.  Esto significa que las solicitudes con m√∫ltiples operadores no est√°n permitidas y no se ejecutar√°n.  Este modo es principalmente √∫til en situaciones donde cada transacci√≥n est√° limitada a un operador.  Las transacciones con m√∫ltiples agentes ser√°n rechazadas por el grupo. <br><br>  Despu√©s de crear el grupo, debe usar los par√°metros del grupo para conectarse a la base de datos.  Puede verlos haciendo clic en el enlace Detalles de conexi√≥n: <br><br><img src="https://habrastorage.org/webt/bi/ir/oj/biiroja_tdy2ls-vvvt3mzeeni4.png"><br><br><h3>  Conexi√≥n de piscina </h3><br><img src="https://habrastorage.org/webt/ji/uu/5g/jiuu5gu944d13dsuc7shpb016u0.png"><br><br>  En mis proyectos utilizo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Npgsql</a> , por lo que otros ejemplos implicar√°n el uso de este controlador. <br><br>  La cadena de conexi√≥n se ver√° as√≠: <br><br><pre><code class="plaintext hljs">User ID=xxx;Password=xxxx;Host=xxx.db.ondigitalocean.com;Port=xxx;Database=pool_name;Pooling=false;SslMode=Require;Server Compatibility Mode=Redshift;</code> </pre> <br><br>  A qu√© debe prestar atenci√≥n: <br><br><ul><li>  El par√°metro <b>Base de datos</b> no contendr√° el nombre de la base de datos, sino el nombre del grupo a trav√©s del cual se realizar√° la conexi√≥n a la base de datos. </li><li>  <b>La agrupaci√≥n</b> se establecer√° en falso.  El grupo de conexiones ser√° administrado por PgBouncer, no por el controlador. </li><li>  El par√°metro <b>SslMode</b> debe establecerse en Requerir, ya que se requerir√° un certificado para abrir la conexi√≥n. </li><li>  El par√°metro del <b>modo de compatibilidad del servidor</b> debe inicializarse al valor de <i>Redshift</i> .  Esto evitar√° una serie de problemas al usar el controlador npgsql a trav√©s de PgBouncer. </li></ul><br>  El m√©todo de preparaci√≥n de la conexi√≥n se ver√° as√≠: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IDbConnection&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateConnection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> connection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NpgsqlConnection(_connectionString) { ProvideClientCertificatesCallback = certificates =&gt; { certificates.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> X509Certificate2(_cert)); }, UserCertificateValidationCallback = CertificateValidation() }; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> connection.OpenAsync(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> connection; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> RemoteCertificateValidationCallback </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CertificateValidation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; (sender, certificate, chain, errors) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (errors == SslPolicyErrors.None) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((errors &amp; SslPolicyErrors.RemoteCertificateChainErrors) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> allErrorsIsUntrustedRoot = chain? .ChainStatus .All(o =&gt; o.Status == X509ChainStatusFlags.UntrustedRoot); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> allErrorsIsUntrustedRoot ?? <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; };</code> </pre> <br>  Aqu√≠ vale la pena prestar atenci√≥n a dos puntos. <br><br><ul><li>  <b>El primero</b>  Al crear una conexi√≥n, debe usar un certificado.  Se puede descargar en el cuadro de di√°logo para ver los par√°metros de conexi√≥n al grupo.  La conexi√≥n del certificado se configura a trav√©s de <b><i>ProvideClientCertificatesCallback</i></b> . </li><li>  <b>Segunda</b> .  El procedimiento de verificaci√≥n del certificado de grupo, que se configura a trav√©s de RemoteCertificateValidationCallback.  En mi ejemplo, se utiliza un peque√±o truco que le permite ignorar el error que ocurre debido al hecho de que la verificaci√≥n del certificado ra√≠z no funciona. </li></ul><br>  No olvide que el servicio se proporciona actualmente en modo de DISPONIBILIDAD LIMITADA, lo que significa que parte de la funcionalidad todav√≠a se puede ampliar y pueden surgir problemas al trabajar con servicios que el equipo de DO a√∫n no ha podido solucionar. <br><br><h2>  Referencias </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Notas de compatibilidad de Npgsql</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Pgbouncer</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo administrar grupos de conexiones</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440464/">https://habr.com/ru/post/440464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440450/index.html">Hay un rublo para la entrada, pero no hay salida: c√≥mo entran los archivos de terceros en la cadena de bloques y qu√© hacer al respecto</a></li>
<li><a href="../440454/index.html">Paul Graham: Lo que aprend√≠ de Hacker News</a></li>
<li><a href="../440458/index.html">Predicci√≥n del estado de la red VoIP basada en archivos de registro de texto del servidor de aplicaciones SIP</a></li>
<li><a href="../440460/index.html">C√≥mo los siete modders de Mount y Blade crearon un estudio de juegos</a></li>
<li><a href="../440462/index.html">Las 7 mejores estrategias de marketing de contenidos que no debe perderse en 2019</a></li>
<li><a href="../440466/index.html">Control remoto web UART</a></li>
<li><a href="../440468/index.html">2 veces m√°s, 10 veces m√°s r√°pido, durante todo el d√≠a, todo por el bien de las personas</a></li>
<li><a href="../440470/index.html">Incruste un int√©rprete de Python en una aplicaci√≥n Java utilizando el proyecto Panam√°</a></li>
<li><a href="../440472/index.html">Implementaci√≥n de modelos seq2seq en Tensorflow</a></li>
<li><a href="../440474/index.html">Efectos de filtrado SVG. Parte 4. Im√°genes a dos colores con feComponentTransfer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>