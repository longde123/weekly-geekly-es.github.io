<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧒 🐴 🎍 Cómo soportar el aumento de las cargas del sistema: hable sobre los preparativos a gran escala para el Black Friday 🛷 📃 👎🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 

 En 2017, durante el Black Friday, la carga aumentó casi una vez y media, y nuestros servidores estaban al límite de posibilidades. A lo ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cómo soportar el aumento de las cargas del sistema: hable sobre los preparativos a gran escala para el Black Friday</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/retailrocket/blog/445900/">  Hola Habr! <br><br>  En 2017, durante el Black Friday, la carga aumentó casi una vez y media, y nuestros servidores estaban al límite de posibilidades.  A lo largo del año, el número de clientes ha crecido significativamente, y quedó claro que sin una preparación preliminar exhaustiva, la plataforma podría simplemente no soportar las cargas de 2018. <br><br>  El objetivo se estableció de la manera más ambiciosa posible: queríamos estar completamente preparados para cualquier actividad, incluso la más poderosa, y comenzamos a retirar nuevas capacidades de antemano durante el año. <br><br>  Nuestro CTO Andrei Chizh ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">chizh_andrey</a> ) cuenta cómo nos preparamos para el Black Friday 2018, qué medidas tomamos para evitar caídas y, por supuesto, los resultados de una preparación tan cuidadosa. <br><br><img src="https://habrastorage.org/webt/nv/pg/sq/nvpgsqdi4auhsvdmclno1upgvju.jpeg"><br><a name="habracut"></a><br>  Hoy quiero hablar sobre los preparativos para el Black Friday 2018. ¿Por qué ahora, cuando la mayoría de las principales ventas están detrás?  Comenzamos a prepararnos aproximadamente un año antes de los eventos a gran escala, y por ensayo y error encontramos la solución óptima.  Le recomendamos que se encargue de las estaciones cálidas con anticipación y evite los fakaps que puedan surgir en el momento más inoportuno. <br>  El material será útil para todos los que quieran exprimir el máximo beneficio de tales acciones, como  El aspecto técnico del problema no es inferior al de marketing. <br><br><h2>  Características del tráfico en grandes ventas. </h2><br>  Contrariamente a la creencia popular, el Black Friday no es un día al año, sino casi una semana entera: las primeras ofertas de descuento llegan entre 7 y 8 días antes de la venta.  El tráfico del sitio web comienza a crecer sin problemas durante toda la semana, alcanza su punto máximo el viernes y cae bastante el sábado a los indicadores regulares de la tienda. <br><br><img src="https://habrastorage.org/webt/fp/gg/zh/fpggzhkt6td7vbzkbmw7k5ljo6u.jpeg"><br><br>  Es importante tener esto en cuenta: las tiendas en línea se vuelven especialmente sensibles a cualquier "desaceleración" en el sistema.  Además, nuestro boletín por correo electrónico también experimentó un aumento significativo en el número de envíos. <br><br>  Es estratégicamente importante para nosotros pasar el Black Friday sin caídas, ya que  La funcionalidad más importante de los sitios y las listas de correo de las tiendas depende de la operación de la plataforma, a saber: <br><br><ul><li>  Seguimiento y emisión de recomendaciones de productos, </li><li>  La emisión de materiales relacionados (por ejemplo, bloques de recomendaciones de diseño de imágenes, como flechas, logotipos, iconos y otros elementos visuales), </li><li>  Emisión de imágenes de productos del tamaño correcto (para este propósito tenemos "ImageResizer", un subsistema que descarga una imagen del servidor de la tienda, la comprime al tamaño deseado y, a través de servidores de almacenamiento en caché, proporciona imágenes del tamaño correcto para cada producto en cada bloque de recomendación). </li></ul><br>  De hecho, durante el Black Friday 2019, la carga del servicio aumentó en un 40%, es decir.  La cantidad de eventos que el sistema Retail Rocket monitorea y procesa en los sitios de las tiendas en línea ha aumentado de 5 a 8 mil solicitudes por segundo.  Debido al hecho de que nos estábamos preparando para cargas más serias, experimentamos tal aumento fácilmente. <br><br><img src="https://habrastorage.org/webt/hj/rf/yi/hjrfyizrdasmrzna_e2yv26s7x4.png"><br><br><h2>  Preparación general </h2><br><br>  El Black Friday es un momento caluroso para todos los minoristas y para el comercio electrónico en particular.  El número de usuarios y su actividad en este momento está creciendo a veces, por lo que, como siempre, estamos completamente preparados para este tiempo ocupado.  Agregamos aquí el hecho de que muchas tiendas en línea están conectadas con nosotros, no solo en Rusia sino también en Europa, donde la exageración es mucho mayor, y tenemos un nivel de pasiones peor que la serie brasileña.  ¿Qué se debe hacer para estar completamente preparado para cargas mayores? <br><br><h3>  Trabajar con servidores </h3><br>  Para empezar, era necesario descubrir qué es exactamente lo que nos falta para aumentar la capacidad de los servidores.  Ya en agosto, comenzamos a pedir nuevos servidores específicamente para Black Friday: se agregaron un total de 10 máquinas adicionales.  Para noviembre, ya estaban completamente en batalla. <br><br>  Al mismo tiempo, parte de las máquinas de compilación se reinstaló para su uso como servidores de aplicaciones.  Los preparamos de inmediato para usar diferentes funciones: tanto para emitir recomendaciones como para el servicio ImageResizer, de modo que, según el tipo de carga, cada uno de ellos podría usarse para uno de estos roles.  En el modo normal, los servidores de Application y ImageResizer tienen funciones claramente definidas: los primeros están involucrados en la emisión de recomendaciones, los segundos entregan imágenes para cartas y bloques de recomendación en el sitio web de las tiendas en línea.  En preparación para el Black Friday, se decidió hacer todos los servidores de doble propósito para equilibrar el tráfico entre ellos dependiendo del tipo de carga. <br><br>  Luego agregamos dos servidores grandes para Kafka (Apache Kafka) y obtuvimos un grupo de 5 máquinas potentes.  Desafortunadamente, todo no salió tan bien como quisiéramos: en el proceso de sincronización de datos, dos máquinas nuevas ocuparon todo el ancho del canal de red, y tuvimos que encontrar urgentemente cómo llevar a cabo el proceso de agregar de manera rápida y segura para toda la infraestructura.  Para resolver este problema, nuestros administradores tuvieron que sacrificar valientemente el fin de semana. <br><br><h3>  Trabajar con datos </h3><br>  Además de los servidores, decidimos optimizar los archivos para facilitar la carga, y un gran paso para nosotros fue la traducción de archivos estáticos.  Todos los archivos estáticos que anteriormente estaban alojados en los servidores se llevaron a S3 + Cloudfront.  Habían querido hacer esto durante mucho tiempo, ya que la carga en el servidor estaba cerca de los valores límite, y ahora apareció una excelente razón. <br><br>  Una semana antes del Black Friday, aumentamos el tiempo de almacenamiento en caché de las imágenes a 3 días, de modo que en caso de una caída en ImageResizer, las imágenes almacenadas previamente en caché se obtuvieron de cdn.  También redujo la carga en nuestros servidores, porque cuanto más tiempo se almacena la imagen, menos a menudo necesitamos gastar recursos en cambiar el tamaño. <br><br>  Y por último, pero no menos importante: 5 días antes del Viernes Negro, se anunció una moratoria sobre el despliegue de cualquier nueva funcionalidad, así como sobre cualquier trabajo con la infraestructura; toda la atención se dirigió a hacer frente al aumento de las cargas. <br><br><h2>  Planes de respuesta a emergencias </h2><br>  No importa cuán buena sea la preparación, las fakapy siempre son posibles.  Y hemos desarrollado 3 planes de respuesta para posibles situaciones críticas: <br><br><ul><li>  reducción de carga </li><li>  deshabilitar algunos servicios, </li><li>  cierre completo del servicio. </li></ul><br>  <b>Plan A: reducción de carga.</b>  Debería haber estado involucrado si, debido a un aumento en la carga, nuestros servidores van más allá de los tiempos de respuesta aceptables.  En este caso, preparamos mecanismos para reducir gradualmente la carga cambiando parte del tráfico a los servidores de Amazon, lo que simplemente daría "200 OK" a todas las solicitudes y daría una respuesta vacía.  Entendimos que esto es una degradación de la calidad del servicio, pero la elección entre el hecho de que el servicio no funciona en absoluto o no muestra recomendaciones para aproximadamente el 10% del tráfico es obvia. <br><br>  <b>Plan B: Servicios de desactivación.</b>  Implica una degradación parcial del servicio.  Por ejemplo, reducir la velocidad de cálculo de recomendaciones personales en aras de descargar algunas bases de datos y canales de comunicación.  En el modo normal, las recomendaciones se calculan en tiempo real, creando una versión de la tienda en línea para cada visitante, pero en condiciones de cargas crecientes, una disminución en la velocidad permite que otros servicios centrales continúen funcionando. <br><br>  <b>Plan C: para el Armagedón.</b>  Si ocurre una falla completa del sistema, hemos preparado un plan que nos desconectará de manera segura de los clientes.  Los compradores simplemente dejarán de ver recomendaciones; el rendimiento de una tienda en línea no se verá afectado.  Para hacer esto, tendríamos que restablecer nuestro archivo de integración para que los nuevos usuarios dejaran de interactuar con el servicio.  Es decir, deshabilitaríamos el trabajo de nuestro código de seguimiento principal, el servicio dejaría de recopilar datos y calcularía recomendaciones, y el usuario simplemente vería una página sin bloques de recomendación.  Para todos aquellos que han recibido previamente el archivo de integración, hemos proporcionado la opción de cambiar los registros DNS a Amazon y un código auxiliar de 200 OK. <br><br><h2>  Resumen </h2><br>  Sobrellevamos toda la carga, incluso sin la necesidad de utilizar máquinas de construcción adicionales.  Y gracias a la preparación previa, no necesitábamos ninguno de los planes de respuesta desarrollados.  Pero todo el trabajo realizado es una experiencia invaluable que nos ayudará a hacer frente a los flujos de tráfico más inesperados y enormes. <br>  Al igual que en 2017, la carga del servicio aumentó en un 40%, y el número de usuarios en las tiendas en línea para Black Friday aumentó en un 60%.  Todas las dificultades y errores ocurrieron durante el período preparatorio, lo que nos salvó a nosotros y a nuestros clientes de situaciones imprevistas. <br><br>  ¿Cómo te sientes acerca del Black Friday?  ¿Cómo prepararse para cargas críticas? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/445900/">https://habr.com/ru/post/445900/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445890/index.html">PyTest Neo</a></li>
<li><a href="../445892/index.html">Teoría de las explosiones grandes y pequeñas</a></li>
<li><a href="../445894/index.html">[Izhevsk y Perm, anuncio] Cálido y transistor transmisión en línea CodeFest X</a></li>
<li><a href="../445896/index.html">¿Por qué los escáneres 3D económicos no son adecuados para tareas profesionales?</a></li>
<li><a href="../445898/index.html">Sobre nuevas ideas, opiniones limitadas y boca a boca</a></li>
<li><a href="../445904/index.html">Tipos de infinitos y tallo cerebral</a></li>
<li><a href="../445906/index.html">No comer aspirina</a></li>
<li><a href="../445908/index.html">Golang y la evolución de la interacción de la base de datos.</a></li>
<li><a href="../445910/index.html">Cómo nos hicimos amigos de EF 6 MSSQL y PostgresSQL</a></li>
<li><a href="../445912/index.html">Hola, Habr, somos Advantech.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>