<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游 游냢 游꿄 C칩mo soportar el aumento de las cargas del sistema: hable sobre los preparativos a gran escala para el Black Friday 游띵 游늮 游녩游</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 

 En 2017, durante el Black Friday, la carga aument칩 casi una vez y media, y nuestros servidores estaban al l칤mite de posibilidades. A lo ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C칩mo soportar el aumento de las cargas del sistema: hable sobre los preparativos a gran escala para el Black Friday</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/retailrocket/blog/445900/">  Hola Habr! <br><br>  En 2017, durante el Black Friday, la carga aument칩 casi una vez y media, y nuestros servidores estaban al l칤mite de posibilidades.  A lo largo del a침o, el n칰mero de clientes ha crecido significativamente, y qued칩 claro que sin una preparaci칩n preliminar exhaustiva, la plataforma podr칤a simplemente no soportar las cargas de 2018. <br><br>  El objetivo se estableci칩 de la manera m치s ambiciosa posible: quer칤amos estar completamente preparados para cualquier actividad, incluso la m치s poderosa, y comenzamos a retirar nuevas capacidades de antemano durante el a침o. <br><br>  Nuestro CTO Andrei Chizh ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">chizh_andrey</a> ) cuenta c칩mo nos preparamos para el Black Friday 2018, qu칠 medidas tomamos para evitar ca칤das y, por supuesto, los resultados de una preparaci칩n tan cuidadosa. <br><br><img src="https://habrastorage.org/webt/nv/pg/sq/nvpgsqdi4auhsvdmclno1upgvju.jpeg"><br><a name="habracut"></a><br>  Hoy quiero hablar sobre los preparativos para el Black Friday 2018. 쯇or qu칠 ahora, cuando la mayor칤a de las principales ventas est치n detr치s?  Comenzamos a prepararnos aproximadamente un a침o antes de los eventos a gran escala, y por ensayo y error encontramos la soluci칩n 칩ptima.  Le recomendamos que se encargue de las estaciones c치lidas con anticipaci칩n y evite los fakaps que puedan surgir en el momento m치s inoportuno. <br>  El material ser치 칰til para todos los que quieran exprimir el m치ximo beneficio de tales acciones, como  El aspecto t칠cnico del problema no es inferior al de marketing. <br><br><h2>  Caracter칤sticas del tr치fico en grandes ventas. </h2><br>  Contrariamente a la creencia popular, el Black Friday no es un d칤a al a침o, sino casi una semana entera: las primeras ofertas de descuento llegan entre 7 y 8 d칤as antes de la venta.  El tr치fico del sitio web comienza a crecer sin problemas durante toda la semana, alcanza su punto m치ximo el viernes y cae bastante el s치bado a los indicadores regulares de la tienda. <br><br><img src="https://habrastorage.org/webt/fp/gg/zh/fpggzhkt6td7vbzkbmw7k5ljo6u.jpeg"><br><br>  Es importante tener esto en cuenta: las tiendas en l칤nea se vuelven especialmente sensibles a cualquier "desaceleraci칩n" en el sistema.  Adem치s, nuestro bolet칤n por correo electr칩nico tambi칠n experiment칩 un aumento significativo en el n칰mero de env칤os. <br><br>  Es estrat칠gicamente importante para nosotros pasar el Black Friday sin ca칤das, ya que  La funcionalidad m치s importante de los sitios y las listas de correo de las tiendas depende de la operaci칩n de la plataforma, a saber: <br><br><ul><li>  Seguimiento y emisi칩n de recomendaciones de productos, </li><li>  La emisi칩n de materiales relacionados (por ejemplo, bloques de recomendaciones de dise침o de im치genes, como flechas, logotipos, iconos y otros elementos visuales), </li><li>  Emisi칩n de im치genes de productos del tama침o correcto (para este prop칩sito tenemos "ImageResizer", un subsistema que descarga una imagen del servidor de la tienda, la comprime al tama침o deseado y, a trav칠s de servidores de almacenamiento en cach칠, proporciona im치genes del tama침o correcto para cada producto en cada bloque de recomendaci칩n). </li></ul><br>  De hecho, durante el Black Friday 2019, la carga del servicio aument칩 en un 40%, es decir.  La cantidad de eventos que el sistema Retail Rocket monitorea y procesa en los sitios de las tiendas en l칤nea ha aumentado de 5 a 8 mil solicitudes por segundo.  Debido al hecho de que nos est치bamos preparando para cargas m치s serias, experimentamos tal aumento f치cilmente. <br><br><img src="https://habrastorage.org/webt/hj/rf/yi/hjrfyizrdasmrzna_e2yv26s7x4.png"><br><br><h2>  Preparaci칩n general </h2><br><br>  El Black Friday es un momento caluroso para todos los minoristas y para el comercio electr칩nico en particular.  El n칰mero de usuarios y su actividad en este momento est치 creciendo a veces, por lo que, como siempre, estamos completamente preparados para este tiempo ocupado.  Agregamos aqu칤 el hecho de que muchas tiendas en l칤nea est치n conectadas con nosotros, no solo en Rusia sino tambi칠n en Europa, donde la exageraci칩n es mucho mayor, y tenemos un nivel de pasiones peor que la serie brasile침a.  쯈u칠 se debe hacer para estar completamente preparado para cargas mayores? <br><br><h3>  Trabajar con servidores </h3><br>  Para empezar, era necesario descubrir qu칠 es exactamente lo que nos falta para aumentar la capacidad de los servidores.  Ya en agosto, comenzamos a pedir nuevos servidores espec칤ficamente para Black Friday: se agregaron un total de 10 m치quinas adicionales.  Para noviembre, ya estaban completamente en batalla. <br><br>  Al mismo tiempo, parte de las m치quinas de compilaci칩n se reinstal칩 para su uso como servidores de aplicaciones.  Los preparamos de inmediato para usar diferentes funciones: tanto para emitir recomendaciones como para el servicio ImageResizer, de modo que, seg칰n el tipo de carga, cada uno de ellos podr칤a usarse para uno de estos roles.  En el modo normal, los servidores de Application y ImageResizer tienen funciones claramente definidas: los primeros est치n involucrados en la emisi칩n de recomendaciones, los segundos entregan im치genes para cartas y bloques de recomendaci칩n en el sitio web de las tiendas en l칤nea.  En preparaci칩n para el Black Friday, se decidi칩 hacer todos los servidores de doble prop칩sito para equilibrar el tr치fico entre ellos dependiendo del tipo de carga. <br><br>  Luego agregamos dos servidores grandes para Kafka (Apache Kafka) y obtuvimos un grupo de 5 m치quinas potentes.  Desafortunadamente, todo no sali칩 tan bien como quisi칠ramos: en el proceso de sincronizaci칩n de datos, dos m치quinas nuevas ocuparon todo el ancho del canal de red, y tuvimos que encontrar urgentemente c칩mo llevar a cabo el proceso de agregar de manera r치pida y segura para toda la infraestructura.  Para resolver este problema, nuestros administradores tuvieron que sacrificar valientemente el fin de semana. <br><br><h3>  Trabajar con datos </h3><br>  Adem치s de los servidores, decidimos optimizar los archivos para facilitar la carga, y un gran paso para nosotros fue la traducci칩n de archivos est치ticos.  Todos los archivos est치ticos que anteriormente estaban alojados en los servidores se llevaron a S3 + Cloudfront.  Hab칤an querido hacer esto durante mucho tiempo, ya que la carga en el servidor estaba cerca de los valores l칤mite, y ahora apareci칩 una excelente raz칩n. <br><br>  Una semana antes del Black Friday, aumentamos el tiempo de almacenamiento en cach칠 de las im치genes a 3 d칤as, de modo que en caso de una ca칤da en ImageResizer, las im치genes almacenadas previamente en cach칠 se obtuvieron de cdn.  Tambi칠n redujo la carga en nuestros servidores, porque cuanto m치s tiempo se almacena la imagen, menos a menudo necesitamos gastar recursos en cambiar el tama침o. <br><br>  Y por 칰ltimo, pero no menos importante: 5 d칤as antes del Viernes Negro, se anunci칩 una moratoria sobre el despliegue de cualquier nueva funcionalidad, as칤 como sobre cualquier trabajo con la infraestructura; toda la atenci칩n se dirigi칩 a hacer frente al aumento de las cargas. <br><br><h2>  Planes de respuesta a emergencias </h2><br>  No importa cu치n buena sea la preparaci칩n, las fakapy siempre son posibles.  Y hemos desarrollado 3 planes de respuesta para posibles situaciones cr칤ticas: <br><br><ul><li>  reducci칩n de carga </li><li>  deshabilitar algunos servicios, </li><li>  cierre completo del servicio. </li></ul><br>  <b>Plan A: reducci칩n de carga.</b>  Deber칤a haber estado involucrado si, debido a un aumento en la carga, nuestros servidores van m치s all치 de los tiempos de respuesta aceptables.  En este caso, preparamos mecanismos para reducir gradualmente la carga cambiando parte del tr치fico a los servidores de Amazon, lo que simplemente dar칤a "200 OK" a todas las solicitudes y dar칤a una respuesta vac칤a.  Entendimos que esto es una degradaci칩n de la calidad del servicio, pero la elecci칩n entre el hecho de que el servicio no funciona en absoluto o no muestra recomendaciones para aproximadamente el 10% del tr치fico es obvia. <br><br>  <b>Plan B: Servicios de desactivaci칩n.</b>  Implica una degradaci칩n parcial del servicio.  Por ejemplo, reducir la velocidad de c치lculo de recomendaciones personales en aras de descargar algunas bases de datos y canales de comunicaci칩n.  En el modo normal, las recomendaciones se calculan en tiempo real, creando una versi칩n de la tienda en l칤nea para cada visitante, pero en condiciones de cargas crecientes, una disminuci칩n en la velocidad permite que otros servicios centrales contin칰en funcionando. <br><br>  <b>Plan C: para el Armaged칩n.</b>  Si ocurre una falla completa del sistema, hemos preparado un plan que nos desconectar치 de manera segura de los clientes.  Los compradores simplemente dejar치n de ver recomendaciones; el rendimiento de una tienda en l칤nea no se ver치 afectado.  Para hacer esto, tendr칤amos que restablecer nuestro archivo de integraci칩n para que los nuevos usuarios dejaran de interactuar con el servicio.  Es decir, deshabilitar칤amos el trabajo de nuestro c칩digo de seguimiento principal, el servicio dejar칤a de recopilar datos y calcular칤a recomendaciones, y el usuario simplemente ver칤a una p치gina sin bloques de recomendaci칩n.  Para todos aquellos que han recibido previamente el archivo de integraci칩n, hemos proporcionado la opci칩n de cambiar los registros DNS a Amazon y un c칩digo auxiliar de 200 OK. <br><br><h2>  Resumen </h2><br>  Sobrellevamos toda la carga, incluso sin la necesidad de utilizar m치quinas de construcci칩n adicionales.  Y gracias a la preparaci칩n previa, no necesit치bamos ninguno de los planes de respuesta desarrollados.  Pero todo el trabajo realizado es una experiencia invaluable que nos ayudar치 a hacer frente a los flujos de tr치fico m치s inesperados y enormes. <br>  Al igual que en 2017, la carga del servicio aument칩 en un 40%, y el n칰mero de usuarios en las tiendas en l칤nea para Black Friday aument칩 en un 60%.  Todas las dificultades y errores ocurrieron durante el per칤odo preparatorio, lo que nos salv칩 a nosotros y a nuestros clientes de situaciones imprevistas. <br><br>  쮺칩mo te sientes acerca del Black Friday?  쮺칩mo prepararse para cargas cr칤ticas? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/445900/">https://habr.com/ru/post/445900/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445890/index.html">PyTest Neo</a></li>
<li><a href="../445892/index.html">Teor칤a de las explosiones grandes y peque침as</a></li>
<li><a href="../445894/index.html">[Izhevsk y Perm, anuncio] C치lido y transistor transmisi칩n en l칤nea CodeFest X</a></li>
<li><a href="../445896/index.html">쯇or qu칠 los esc치neres 3D econ칩micos no son adecuados para tareas profesionales?</a></li>
<li><a href="../445898/index.html">Sobre nuevas ideas, opiniones limitadas y boca a boca</a></li>
<li><a href="../445904/index.html">Tipos de infinitos y tallo cerebral</a></li>
<li><a href="../445906/index.html">No comer aspirina</a></li>
<li><a href="../445908/index.html">Golang y la evoluci칩n de la interacci칩n de la base de datos.</a></li>
<li><a href="../445910/index.html">C칩mo nos hicimos amigos de EF 6 MSSQL y PostgresSQL</a></li>
<li><a href="../445912/index.html">Hola, Habr, somos Advantech.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>