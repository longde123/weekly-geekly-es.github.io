<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍✈️ 👩🏿‍🎓 🎩 Rubik's Cube Machine auf FAC-Basis 🔚 🚴🏼 🥐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor nicht allzu langer Zeit haben wir zusammen mit Wilbert Swinkels die Arbeit an einer Maschine beendet, die den Zauberwürfel sammelt. Sie schrieb üb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Rubik's Cube Machine auf FAC-Basis</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384503/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor nicht allzu langer Zeit haben </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wir</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zusammen mit </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Wilbert Swinkels</font></a><font style="vertical-align: inherit;"> die Arbeit an einer Maschine beendet, die den Zauberwürfel sammelt. </font><font style="vertical-align: inherit;">Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">schrieb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> über uns </font><font style="vertical-align: inherit;">auf der offiziellen Raspberry Pi - </font><font style="vertical-align: inherit;">Blog und wir erhielten viele begeisterte Kritiken. </font><font style="vertical-align: inherit;">Trotzdem blieb das Projekt im russischen Segment des Netzwerks irgendwie unbemerkt. </font><font style="vertical-align: inherit;">Deshalb habe ich beschlossen, dieses Versäumnis zu korrigieren, indem ich hier eine übersetzte und erweiterte Version des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ursprünglichen Beitrags veröffentlichte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/vpAKfSYueMI%3Ffeature%3Doembed&amp;usg=ALkJrhjtT8Eyn-_mjEbbhHulwNYmaybvtA" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter dem Schnitt werden wir (hauptsächlich) über den Software-Teil dieser Maschine sprechen, der mechanische Teil kann auf der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offiziellen Seite des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Projekts </font><font style="vertical-align: inherit;">gelesen werden </font><font style="vertical-align: inherit;">(ja, wir wissen, dass es eine kleine "alte Schule" ist)</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TL; DR</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für die Ungeduldigen ein paar Links:</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offizielle Projektseite</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementierungen des Kotsemba-Zweiphasenalgorithmus (Python und C)</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andere Werke von Wilbert</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wilbert FAC Website</font></font></a></li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offizielle Seite des FAC-Systems</font></font></a></li>
</ul><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einführung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alles begann damit, dass ich im Mai dieses Jahres versehentlich Wilbert Swinkels getroffen habe. Ich war einfach schockiert, als ich seine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kreationen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sah </font><font style="vertical-align: inherit;">: Jeder dieser Mechanismen, von klein bis groß, kann sicher als Kunstwerk bezeichnet werden. Und je genauer Sie sich ihr Gerät ansehen, desto mehr beeindruckt Sie ihre Schönheit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Natürlich, wenn Wilbert mich eingeladen , </font><font style="vertical-align: inherit;">ihn mit dem Zauberwürfel Montagemaschine zu helfen, zögerte ich keine Sekunde lang, zumal bis zu </font><font style="vertical-align: inherit;">diesem Zeitpunkt hatte ich schon </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">entdeckt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Leidenschaft für farbige Würfel. Zu diesem Zeitpunkt hatte er bereits mehr als 4 (!) Jahre an der Maschine gearbeitet, aber der Software-Teil musste noch geschrieben werden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hatte keine Erfahrung mit der Programmierung für Raspberry Pi und Arduino, aber im Großen und Ganzen schien mir die Aufgabe ziemlich einfach zu sein. </font><font style="vertical-align: inherit;">Natürlich habe ich mich geirrt :)</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardware</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Maschine selbst besteht aus einem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modularen FAC-System</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dies ist so etwas wie ein sowjetischer Designer, aber geschaffen, um ernsthafte und komplexe Mechanismen zu prototypisieren. </font><font style="vertical-align: inherit;">In der zweiten Hälfte des letzten Jahrhunderts wurde es in den Labors von Philips und anderen Unternehmen und Universitäten sehr aktiv eingesetzt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als ich Wilbert traf, hatte er bereits zweimal versucht, das Auto wiederzubeleben. </font><font style="vertical-align: inherit;">Beide Male haben Studenten der Universität Amsterdam den Fall aufgegriffen und leider beide Male nach mehreren erfolglosen Versuchen das Interesse an dem Projekt verloren. </font><font style="vertical-align: inherit;">Einer von ihnen verteidigte sogar ein Bachelor-Diplom zu diesem Thema, obwohl die Maschine den Würfel nicht einsammeln konnte (heben Sie Ihre Hand zu denen, die sich hier wiedererkennen).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikrocontroller</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst haben wir uns für den Raspberry Pi anstelle des Arduino entschieden. </font><font style="vertical-align: inherit;">Dies ist hauptsächlich auf die Tatsache zurückzuführen, dass „intelligente“ Algorithmen zum Lösen des Rubik's Cube eine erhebliche Menge an Speicher und Prozessorleistung erfordern. </font><font style="vertical-align: inherit;">In früheren Versuchen wurde ein primitiver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dreischichtiger Algorithmus verwendet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , diesmal haben wir uns jedoch für </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den Kotsemba-Algorithmus entschieden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Außerdem wollte ich nicht wirklich alles in C schreiben (obwohl ich es teilweise musste). </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/53b/142/5d4/53b1425d42fca6feb8f98819c3f4ff39.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Standardversion des Raspberry Pi hatten wir nicht genügend Stifte, um alle verfügbaren Motoren anzuschließen, und bestellten daher das </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Development Kit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Übrigens rate ich dringend: nicht nur mehr Stifte, sondern sie sind meiner Meinung nach logischer voneinander getrennt. </font><font style="vertical-align: inherit;">Darüber hinaus verfügt diese Karte über zwei Anschlüsse für die Kamera anstelle von einem.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die erste Version des Scanners</font></font></h3><br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/465/d0e/05d/465d0e05d87cd5c11a732f3d448ac6b4.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Lesen der Erstkonfiguration des Cubes wurde ein Scan-Gerät benötigt. Die Idee ist sehr einfach: Wir beleuchten wiederum die Oberfläche des Würfels mit drei LEDs: rot, grün und blau. Jedes Mal messen wir das reflektierte Licht mit einem lichtempfindlichen Widerstand. Theoretisch sollten wir RGB-Werte erhalten, mit denen die Farbe des Quadrats erkannt werden kann. Von früheren Programmierern haben wir noch Proof-of-Concept-Code für Arduino, der anscheinend sogar unter bestimmten Bedingungen funktioniert hat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das erste Problem, auf das wir stießen, war eine Spannungsfehlanpassung. Wie Sie wissen, beträgt die logische Einheit an den Arduino-Pins 5 V, während der Raspberry Pi 3,3 V beträgt. Glücklicherweise arbeiteten die von uns verwendeten Schrittmotortreibersteuerungen trotz Änderung der Impulsamplitude weiter. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es stellte sich als viel kritischer heraus, dass der Raspberry Pi keine analogen Eingänge hat. Aus diesem Grund kann die Himbeere die Spannung am Fotowiderstand nicht einfach messen und ablesen. Dies ist wahrscheinlich für diejenigen offensichtlich, die mindestens einmal darauf gestoßen sind, aber zuerst habe ich nicht einmal darüber nachgedacht. Bei der Suche im Internet nach einer Lösung sind wir auf </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">diesen Artikel</font></a><font style="vertical-align: inherit;"> gestoßen</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Kurz gesagt, wir fügen der Schaltung einen Kondensator hinzu und messen die Zeit, während der er von Null auf eine logische Einheit geladen wird (wir können dies mithilfe eines digitalen Pins erkennen). </font><font style="vertical-align: inherit;">Die Ladezeit ist proportional zum Widerstand des Fotowiderstands, sodass wir die Lichtmenge beurteilen können. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/40a/8d9/d2b/40a8d9d2b30365e9e4fd4c3cf3615798.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dieser Ansatz ist nicht nur furchtbar unzuverlässig (es ist undankbar, sich Zeit in einem Python Python-Skript unter Linux mit einer Reihe von Hintergrundprozessen zu nehmen), sondern es ist auch unmöglich, zu lange zu dauern. </font><font style="vertical-align: inherit;">Um zufällige Abweichungen in den Messwerten auszugleichen, mussten wir mehrmals lesen, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ausreißer entfernen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und die verbleibenden Werte mitteln. </font><font style="vertical-align: inherit;">Wir haben es jedoch trotzdem geschafft, diesen Scanner zum Laufen zu bringen:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/z4iJ0hNQulo%3Ffeature%3Doembed&amp;usg=ALkJrhgP9xFUe0OMP7cwb6vwJ9FdYf7UoA" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die zweite (endgültige) Version des Scanners</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Kondensatorscanner funktionierte ziemlich gut, war aber sehr langsam. Das Scannen des gesamten Zauberwürfels dauerte ungefähr zwei Minuten, und als der Scan abgeschlossen war, hatte der Betrachter jegliches Interesse verloren. Aus diesem Grund haben wir uns entschlossen, zum Arduino zurückzukehren und einen kleinen Arduino Mini speziell für die Steuerung des Scanners gekauft. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/21a/9e5/775/21a9e5775f5e15affb6792ae5f67b984.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es erwies sich als unglaublich einfach, Arduino mit dem Raspberry Pi </font><font style="vertical-align: inherit;">anzufreunden </font><font style="vertical-align: inherit;">: zwei Drähte, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ein Spannungswandler</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zwischen ihnen und voila - wir haben eine serielle Schnittstelle. Und wenn Sie ein einfaches </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Min-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Protokoll anschrauben </font><font style="vertical-align: inherit;">, ist das Programmieren dieses Geschäfts ein Vergnügen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe die gesamte Scannersteuerlogik auf das Arduino übertragen. </font><font style="vertical-align: inherit;">Die Scangeschwindigkeit hat erheblich zugenommen. </font><font style="vertical-align: inherit;">Dank der analogen Eingänge können wir die Spannung direkt von den Fotowiderständen ablesen, und diese Werte sind sehr genau. </font><font style="vertical-align: inherit;">Da der Arduino direkt am Scanner montiert ist, benötigen wir außerdem viel weniger Kabel vom Scanner zum Raspberry Pi!</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algorithmus erstellen</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Zusammensetzen des Zauberwürfels aus mathematischer Sicht ist eine ziemlich </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mühsame Aufgabe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Natürlich geht es darum, die optimale Lösung zu finden, und nicht um "einige". Ich war überrascht, als ich herausfand, dass die Anzahl Gottes (die genaue Untergrenze für die Anzahl der Bewegungen, die zum Lösen eines beliebigen Würfels erforderlich sind) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erst 2010 gefunden wurde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Projekt wollten wir die Gesamtzeit reduzieren, die für die Berechnung der Lösung und das Zusammensetzen erforderlich ist. Daher kam weder ein einfacher </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dreischichtiger Algorithmus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf uns zu </font><font style="vertical-align: inherit;">(er funktioniert schnell, liefert aber Lösungen mit einer Länge von hundert Zügen), noch ein </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimaler Algorithmus</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Lösungen sind kurz, aber der Renderprozess auf Raspberry Pi würde ewig dauern). Infolgedessen haben wir uns für den großartigen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Zwei-Phasen" -Algorithmus entschieden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deutscher Mathematiker Herbert Kociemba. Er ist in der Lage, suboptimale Entscheidungen zu treffen (durchschnittlich 20 Züge), während er die angemessene Zeit einhält. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der Website des Autors finden Sie die Implementierung des Algorithmus in Java. Als erstes habe ich diesen Code in Python übersetzt. Es war überhaupt nicht schwierig, da der größte Teil des Programms aus mathematischen Operationen und der Aufzählung von Optionen besteht. Ich habe jedoch nicht berücksichtigt, dass der Algorithmus </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wirklich viele</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ressourcen benötigt. Das Finden einer Lösung beim ersten Start dauerte mehr als eine Minute (!) Auf meinem Laptop. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Unter </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pypy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei aktiviertem JIT dauerte die Lösung auf dem Laptop 1 Sekunde, auf dem Raspberry Pi jedoch noch etwa eine Minute. </font><font style="vertical-align: inherit;">Nach mehreren Versuchen, die Arbeit des Python-Programms zu beschleunigen (Numpy, Multiprocessing), entschied ich mich, den Algorithmus auf C umzuschreiben. Trotzdem dauert die Lösung jetzt 1-2 Sekunden, sogar auf Raspberry. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe beide Implementierungen des Algorithmus auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gepostet </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maschinensteuerung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der nächste Schritt bestand darin, ein Programm zu schreiben, das den mechanischen Teil steuert: Bewegen Sie die Motoren unter Berücksichtigung der Übersetzungsverhältnisse und Einschränkungen des Mechanismus (z. B. können Seitenhalter nur gedreht werden, wenn sich der Boden in einer bestimmten Position befindet, da er sonst stört). </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/b89/c9b/3e0/b89c9b3e0780fae3e7dd5b28a8aa209d.png" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusätzlich zum Hauptprogramm habe ich eine interaktive Shell erstellt, die mir beim Debuggen viel Zeit gespart hat. </font><font style="vertical-align: inherit;">Im Allgemeinen war dieser Teil in Bezug auf die Programmierung nicht ungewöhnlich. </font><font style="vertical-align: inherit;">Um den Scan zu debuggen, habe ich die Ergebnisse als Bilder generiert.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scan- und Farberkennung</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bis zu diesem Punkt war alles interessant, aber nicht schwierig. </font><font style="vertical-align: inherit;">Zwei Wochen nach Arbeitsbeginn konnte die Maschine bereits einen Würfel aus einem bestimmten Zustand sammeln. </font><font style="vertical-align: inherit;">Es blieb nur zu lernen, wie man die anfängliche Konfiguration des Würfels mit einem Scanner liest. </font><font style="vertical-align: inherit;">Wir hatten bereits ein "funktionierendes" Programm für Arduino, daher hatten wir keine Überraschungen erwartet. </font><font style="vertical-align: inherit;">Dieser Teil des Projekts erwies sich jedoch als der schwierigste, und wir brauchten weitere zwei Monate Arbeit.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fotowiderstandsanzeigen</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie ich oben geschrieben habe, haben wir mit einer Scannerschaltung mit Kondensatoren begonnen. Der Fehler dieses Ansatzes war schrecklich. Um brauchbare Werte zu erhalten, musste ich mehrmals Messungen durchführen und dann die Emissionen beseitigen. Danach haben wir so etwas bekommen (dies ist das Ergebnis des Scannens des zusammengesetzten Würfels in einem dunklen Raum): </font></font><br>
<br>
<img src="https://habrastorage.org/files/d0d/0eb/467/d0d0eb4676f54a8c9319882658278664.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen können, ist das Ergebnis alles andere als ideal. Erstens sind die Werte für dieselbe Farbe an verschiedenen Positionen unterschiedlich, da Fotowiderstände und LEDs in leicht unterschiedliche Richtungen „schauen“. Zweitens sind einige Farben im Farbraum sehr nahe beieinander, und manchmal überlappen sich die Wertebereiche (z. B. ergeben Orange und Rot manchmal den gleichen Wert). Und schließlich hängen die Messwerte stark von der Außenbeleuchtung ab.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Visuell ist der Fehler des Scanners an den Kondensatoren in der folgenden Abbildung zu sehen (im Allgemeinen gibt es hier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine interaktive Version</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ): </font></font><br>
<br>
<img src="https://habrastorage.org/files/8a6/489/4fd/8a64894fd9a249a1a297ac2743930120.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Rückblickend frage ich mich, wie wir es geschafft haben, den Scan mit solchen Ergebnissen zum Laufen zu bringen, obwohl dies eine sorgfältige und schwierige Kalibrierung der fraglichen Werte erforderte wird etwas tiefer gehen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie gesagt, der Kondensatorscanner hat funktioniert, war aber sehr langsam. </font><font style="vertical-align: inherit;">Als wir es durch ein anderes ersetzten, mit dem eingebauten Arduino, wurden die Messwerte viel „überfüllter“ (die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interaktive Version ist hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br>
<br>
<img src="https://habrastorage.org/files/c6e/0a8/8b5/c6e0a88b595747aa87ef2c35bdf634fe.png"><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kalibrierung und Clustering von Messwerten</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem wir die rohen RGB-Werte von den Fotowiderständen erhalten hatten, mussten wir die Farben selbst identifizieren, um die Würfelkonfiguration dem Erstellungsalgorithmus zuzuführen. Hier wurden sofort zwei verschiedene Ansätze vorgeschlagen: die Verwendung von Farbintervallen und der Clustering-Algorithmus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der erste Ansatz ist eine „frontale“ Lösung: Es war möglich, die Werteintervalle für jede Seite des Würfels experimentell zu bestimmen (um den Farbraum in disjunkte Bereiche zu unterteilen) und die Werte dann einfach entsprechend ihrer Zugehörigkeit zu einem bestimmten Intervall zu kombinieren. In diesem Fall sollte jede der 9 möglichen Positionen am Rand des Würfels separat betrachtet werden. Diese Methode ist sehr einfach zu programmieren, weist jedoch zwei wesentliche Nachteile auf. Erstens bindet es uns an bestimmte Farben, was bedeutet, dass wir nur einen genau definierten Zauberwürfel sammeln können. Und zweitens hängen die Intervalle möglicher Werte stark von der Außenbeleuchtung ab. Darüber hinaus haben wir festgestellt, dass je nach Umgebungslicht derselbe Messwert unterschiedlichen Farben entsprechen kann.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der zweite Ansatz erfordert eine vorläufige Kalibrierung der Werte, sodass dieselbe Farbe an allen 9 Positionen am Rand des Würfels zu denselben Ergebnissen führt. </font><font style="vertical-align: inherit;">In diesem Fall können wir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den Clustering-Algorithmus verwenden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um die Werte in 6 Gruppen zu kombinieren. </font><font style="vertical-align: inherit;">Gleichzeitig spielt es keine Rolle, in welche Farben der Würfel gemalt wird, wenn sie nur unterschiedlich sind. </font><font style="vertical-align: inherit;">Leider musste diese Methode auch wegen der Wahrscheinlichkeit von Clustering-Algorithmen "abgelehnt" werden: Sie können ein "gutes" Ergebnis liefern, garantieren jedoch nicht deren Genauigkeit. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beide Ansätze haben ihre Vor- und Nachteile. Daher haben wir etwas dazwischen verwendet:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zunächst führen wir eine künstliche Kalibrierung der Scannerwerte durch, um die Werte zu normalisieren. </font><font style="vertical-align: inherit;">Die Koeffizienten werden experimentell erhalten.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konvertieren Sie die resultierenden RGB-Werte in HSV</font></font></li>
<li>   ,    S ()</li>
<li>     </li>
<li>    ,     .</li>
</ol><br>
<br>
<h3>   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selbst mit einem guten Clustering-Algorithmus schlug das Scannen häufig aufgrund von Umgebungsbedingungen fehl. </font><font style="vertical-align: inherit;">Der in einem dunklen Raum kalibrierte Algorithmus konnte die Aufgabe bei Tagesbedingungen nicht bewältigen und umgekehrt. </font><font style="vertical-align: inherit;">Wenn die Außenbeleuchtung sehr hell war (direktes Sonnenlicht), funktionierte der Scanner im Allgemeinen nicht mehr, da der Einfluss der LEDs kaum spürbar wurde. </font><font style="vertical-align: inherit;">Wilbert hat sehr mühsam den Scanner vom Umgebungslicht isoliert. </font><font style="vertical-align: inherit;">Ich musste drei Iterationen durchlaufen: jedes Mal, wenn wir dachten, dass dies ausreichen würde, und jedes Mal fanden wir eine weitere Lücke, durch die die externe Beleuchtung auf den Fotowiderstand fiel.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/d4c/a1e/795/d4ca1e795ba1c28d27a3fa8ebbc8c5cb.jpg" alt="Bild"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Arbeit an diesem Projekt war unglaublich aufregend. Es ist großartig zu sehen, wie das Auto vor Ihren Augen zum Leben erweckt wird, und es ist besonders cool zu sehen, wie es funktioniert, was all Ihre Bemühungen rechtfertigt. Dies kann jedoch nicht mit dem Wissensspeicher verglichen werden, den wir dabei gewonnen haben. Ich hätte mir nicht vorstellen können, dass ich eine Reihe von Materialien zu Elektronik, Mechanik, Algebra und sogar mathematischer Statistik studieren und auf dem Weg ein Dutzend nützlicher Dienstprogramme und Bibliotheken finden müsste. Deshalb bin ich so froh, dass ich die Gelegenheit hatte, an diesem Projekt zu arbeiten.</font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/238/e22/a67/238e22a6758025d7fbda1f52441b75a2.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie dem auch sei, dieses Auto ist nur ein Prototyp. </font><font style="vertical-align: inherit;">Wir haben uns nicht das Ziel gesetzt, den Geschwindigkeitsrekord zu brechen, und sicherlich haben wir nicht das volle Potenzial der mechanischen Teile ausgeschöpft. </font><font style="vertical-align: inherit;">Aber wir werden auf jeden Fall versuchen, dies in der nächsten Version der Maschine zu tun, an der wir bereits mit der Arbeit begonnen haben. </font><font style="vertical-align: inherit;">Dort werden wir die Kamera zum Scannen verwenden, und das Design der Manipulatoren hat wesentliche Änderungen erfahren. </font><font style="vertical-align: inherit;">Und wenn Sie Fragen, Anregungen oder Tipps haben, würde ich mich freuen, diese in den Kommentaren zu hören.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de384503/">https://habr.com/ru/post/de384503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de384487/index.html">Song "Happy Birthday To You" per Gerichtsbeschluss öffentlich bekannt gegeben</a></li>
<li><a href="../de384491/index.html">Roboter parken besser als Menschen</a></li>
<li><a href="../de384493/index.html">Elektronische Uhr im Qlocktwo-Stil</a></li>
<li><a href="../de384499/index.html">Acer Revo One: Ein Miniaturcomputer mit einem breiten Aktionsspektrum</a></li>
<li><a href="../de384501/index.html">Sound in der Tasche für 500 000r: Astell & Kern AK380 + Astell & Kern Layla</a></li>
<li><a href="../de384505/index.html">Kopfhörer mit Knochenleitungs-Technologie: Was sind sie, warum werden sie benötigt und wo können sie gekauft werden?</a></li>
<li><a href="../de384507/index.html">Простой дата-центра Amazon повлек за собой сбой в работе Netflix, Heroku и других сервисов</a></li>
<li><a href="../de384509/index.html">NVIDIA wird seine Top-GeForce GTX 980-Onboard-Laptop-Grafikkarte installieren</a></li>
<li><a href="../de384511/index.html">Startharken - wie wir den Spielplatz geöffnet haben</a></li>
<li><a href="../de384513/index.html">Mobile Solartankstellen EV ARC - Realitäten und Perspektiven</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>