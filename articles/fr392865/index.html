<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐩 🛑 🤽🏼 IHM FLProg + Nextion. Leçon 3 ⛳️ 👆🏻 🈴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans les leçons précédentes ( leçon 1 , leçon 2 ), j'ai expliqué comment dessiner l'interface d'un panneau IHM Nextion et comment contrôler un panneau...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IHM FLProg + Nextion. Leçon 3</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flprog/blog/392865/"><img src="https://habrastorage.org/files/221/5cc/315/2215cc315ef044008bfbc77b0a9b6a9a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les leçons précédentes ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leçon 1</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">leçon 2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), j'ai expliqué comment dessiner l'interface d'un panneau IHM Nextion et comment contrôler un panneau à l'aide d'Arduino. Dans ce didacticiel, je vais vous montrer comment résoudre le problème inverse du contrôle de la carte Arduino à l'aide du panneau IHM Nextion. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la leçon, nous développerons le projet de la leçon précédente, ajouterons le contrôle du ventilateur, qui s'activera lorsque la température dépassera la limite spécifiée et s'éteindra lorsque la température descendra en dessous de la deuxième limite. Les paramètres seront définis à partir du panneau et stockés dans la mémoire non volatile du contrôleur Arduino. De plus, nous allons faire un interrupteur d'éclairage (marche-arrêt) sur le panneau et un bouton avec lequel nous allumerons la lampe de poche (par exemple, pour donner un signal aux extraterrestres).</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schéma modifié de la dernière leçon. </font><font style="vertical-align: inherit;">La lampe de poche, la lumière et le ventilateur simuleront les LED. </font></font><br>
<img src="https://habrastorage.org/files/108/887/fc9/108887fc97124f3aa2597671e1fc523c.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La conception du panneau a également été finalisée. </font><font style="vertical-align: inherit;">Deux pages ajoutées. </font><font style="vertical-align: inherit;">De plus, la police chargée dans le panneau a été remplacée. </font><font style="vertical-align: inherit;">Le projet du panel est dans les archives, dont un lien est donné à la fin de l'article. </font><font style="vertical-align: inherit;">Dans les commentaires de la dernière leçon, ils m'ont critiqué à juste titre pour le manque de talent de designer. </font><font style="vertical-align: inherit;">Je suis entièrement d'accord avec cela, donc les nouvelles pages n'ont pas de design, de pure fonctionnalité. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérez les nouvelles pages. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Page de gestion («page3», ID = 3). </font></font></b><br>
 <img src="https://habrastorage.org/files/f53/475/3e3/f534753e34d541b0a519e9d63ba3ca8a.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérez les éléments de la page.</font></font><br>
<br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Juste des champs de texte. </font><font style="vertical-align: inherit;">Rien d'intéressant.</font></font></li>
<li>    .    ,       .    .       .  .<br>
<img src="https://habrastorage.org/files/413/8a4/81d/4138a481d6b34b849c9f1c3181800186.PNG"><br>
        ,    ( “vscope”  “global”).           .    “Touch Press Event”   .<br>
<img src="https://habrastorage.org/files/3d5/dec/ee6/3d5decee64374165a29854797e74f286.PNG"><br>
           4   .<br>
<pre><code class="hljs">page4.evtemp.txt=onV.txt</code></pre><br>
         4   ,   .<br>
<pre><code class="hljs scala">page4.varN.<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span></code></pre><br>
      .<br>
<pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">page</span></span> page4</code></pre><br>
<br>
</li>
<li>    .    .  .<br>
<img src="https://habrastorage.org/files/b4a/e51/538/b4ae51538bef45bfb53ce2ae154a46ca.PNG"><br>
   “Touch Press Event”.<br>
<img src="https://habrastorage.org/files/9ef/379/001/9ef379001eed40578b7c421a88f8993e.PNG"><br>
         .<br>
<pre><code class="hljs scala">page4.varN.<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span></code></pre><br>
<br>
</li>
<li> .    .  .<br>
<img src="https://habrastorage.org/files/e89/e52/5af/e89e525af96248868f8506c259f05fec.PNG"><br>
   “Touch Press Event”.<br>
<img src="https://habrastorage.org/files/72f/15a/e66/72f15ae66eac437e84eca112fc64e1b0.PNG"><br>
<br>
</li>
<li>    (“Dual-state button”) –  . <br>
 .<br>
<img src="https://habrastorage.org/files/6c3/8a4/341/6c38a43413f4435a8292add512061f4f.PNG"><br>
       ,    ( “vscope”  “global”).         ( “sta”  “image”).     “pic0”   0  “pic1”   1.<br>
<br>
</li>
<li> (“Button”) –  .  .<br>
<img src="https://habrastorage.org/files/8c5/5e3/e8b/8c55e3e8b7394171adb4436992cc2d2e.PNG"><br>
  .        ,   .  ,  Arduino        UART (  ,  ).              (7  8).      ,      ,    (     ).     (“Touch Press Event”)   .<br>
<img src="https://habrastorage.org/files/68f/4e8/233/68f4e82332df4f54ab4a757174a78369.PNG"><br>
     (“Touch Release Event”) .<br>
<img src="https://habrastorage.org/files/c04/25f/66d/c0425f66d38244288a707c3f47a0cd87.PNG"><br>
          FLProg.<br>
<br>
</li>
</ol><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fenêtre d'édition des valeurs («page4», ID = 4). </font></font></b><br>
<img src="https://habrastorage.org/files/93e/87e/629/93e87e629fd44572a6116bfa7549578c.PNG"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Considérez ce qui y est inclus.</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Champ de valeur modifiable. </font><font style="vertical-align: inherit;">Paramètres de l'élément. </font></font><br>
<img src="https://habrastorage.org/files/cdc/34f/371/cdc34f3719d044ee9f4fc2e1bd69268d.PNG"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons lire la valeur de ce champ à partir du contrôleur, respectivement, le rendre global (l'attribut "vscope" est défini sur "global").</font></font><br>
<br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boutons de saisie de valeur. </font><font style="vertical-align: inherit;">Tous ces boutons sont presque identiques et diffèrent par l'inscription et le code dans le gestionnaire d'événements «Touch Press Event». </font><font style="vertical-align: inherit;">Lorsque vous cliquez sur l'un de ces boutons, le symbole correspondant est ajouté à la valeur actuelle du champ de la valeur éditée.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code dans le «Touch Press Event» pour chacun des boutons.</font></font></b><div class="spoiler_text">“0” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"0"</span></span></code></pre><br>
“1” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"1"</span></span></code></pre><br>
“2” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"2"</span></span></code></pre><br>
“3” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"3"</span></span></code></pre><br>
“4” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"4"</span></span></code></pre><br>
“5” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"5"</span></span></code></pre><br>
“6” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"6"</span></span></code></pre><br>
“7” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"7"</span></span></code></pre><br>
“8” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"8"</span></span></code></pre><br>
“9” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"9"</span></span></code></pre><br>
“.” <br>
<pre><code class="hljs objectivec">evtemp.txt=evtemp.txt+<span class="hljs-string"><span class="hljs-string">"."</span></span></code></pre><br>
</div></div><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bouton pour effacer le champ. </font><font style="vertical-align: inherit;">Lorsque vous appuyez dessus, la valeur du champ est supprimée. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Code dans le «Touch Press Event»</font></font><br>
<pre><code class="hljs objectivec">evtemp.txt=<span class="hljs-string"><span class="hljs-string">""</span></span></code></pre><br>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bouton pour supprimer le dernier caractère. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Code dans le «Touch Press Event»</font></font><br>
<pre><code class="hljs powershell">evtemp.txt=evtemp.txt<span class="hljs-literal"><span class="hljs-literal">-1</span></span></code></pre><br>
   .      .          .             . <br>
<br>
</li>
<li>   .<br>
      ,        (“endPress”  “ endRel”)      .<br>
   “Touch Press Event” <br>
<pre><code class="hljs scala">page4.endPress.<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span></code></pre><br>
   “Touch Release Event”<br>
<pre><code class="hljs scala">page4.endRel.<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span></code></pre><br>
<br>
</li>
<li>  .          .<br>
   “Touch Press Event” <br>
<pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">page</span></span> page3</code></pre><br>
<br>
</li>
</ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois le panneau terminé, accédez au programme FLProg. Il utilise également le projet de la dernière leçon, légèrement modifié. Le fichier du projet est dans l'archive, un lien vers lequel est donné à la fin de l'article. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme dans la dernière leçon, je vais montrer les circuits imprimés prêts à l'emploi et dire ce qui se passe sur eux. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau 7 - «Gestion des lanternes»</font></font></b><br>
<br>
<img src="https://habrastorage.org/files/20c/561/619/20c561619b51414fbb0c0fdb36da2d1b.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ici, tout est simple. Bloc B46 - «Click Tracking» (bibliothèque d'éléments, dossier «Nextion HMI Panel»). A sa sortie, il correspond à l'état du bouton surveillé ou autre élément des événements «Touch Press Event» et «Touch Release Event» sur le panneau. Cette valeur est directement écrite dans la sortie liée à la lampe. Le bloc est paramétré à l'aide de l'éditeur de blocs.</font></font><br>
 <br>
<img src="https://habrastorage.org/files/082/eab/5de/082eab5dedc34570a35e925aa8993a55.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans l'éditeur de blocs, sélectionnez le panneau, puis créez une nouvelle page et écrivez-y les éléments nécessaires. J'ai expliqué comment procéder dans une leçon précédente. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b3f/94f/ea2/b3f94fea2181418aa75de4462c9f4206.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une telle image devrait se révéler. </font></font><br>
<br>
<img src="https://habrastorage.org/files/fbd/252/df3/fbd252df3fcb4f3c97317d06d8237a49.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En tant que variable de pression, nous sélectionnons la variable dans laquelle nous écrivons l'unité dans le bouton «Touch Press Event», et comme variable de libération, la variable du bouton «Touch Release Event». </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau 8 - "Light Control".</font></font></b><br>
<br>
<img src="https://habrastorage.org/files/884/fdb/e32/884fdbe3225b4449aca906a410ae234e.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Même planche très simple. Ici, nous lisons la position du commutateur à l'aide du bloc B47 - «Get parameter» (bibliothèque d'éléments -&gt; dossier «Nextion HMI Panel» -&gt; dossier «Elements»). Cette valeur est ensuite envoyée directement à l'unité de sortie, attachée à l'éclairage. Le bloc est paramétré à l'aide de l'éditeur de blocs.</font></font><br>
<br>
<img src="https://habrastorage.org/files/210/53e/646/21053e6461ea4a86a2d518bfd0f8a3ba.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour réduire la charge sur le contrôleur, nous demanderons une fois par seconde l'état de l'interrupteur. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau 9 - «Fin des paramètres d'édition».</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sur cette carte, nous traiterons le clic du bouton «Terminer» sur la page d'édition des paramètres. </font></font><br>
<br>
<img src="https://habrastorage.org/files/848/9d8/c85/8489d8c852da426aa4f88e0fca493e44.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A l'aide du bloc B48 - «Suivi des clics» (bibliothèque d'éléments, le dossier «Nextion HMI Panel») nous déterminons le moment de pressage. Dans l'éditeur de ce bloc, nous allons créer la page 4 et la remplir avec les éléments qui nous intéressent. </font></font><br>
<br>
<img src="https://habrastorage.org/files/2f7/818/f29/2f7818f298d34f609971a64c09053c10.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et configurez le bloc. </font></font><br>
<br>
<img src="https://habrastorage.org/files/379/1d2/3c6/3791d23c667f416d82bff16ca6c4f37a.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A l'aide du bloc B49 - «Rtrig» (bibliothèque d'éléments, dossier «Déclencheurs»), sélectionnez le bord d'attaque du signal lorsque vous appuyez sur le bouton «Terminer» et écrivez-le dans la variable «Fin d'édition».</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur ce front également, nous lirons la valeur de la variable stockant l'identifiant du champ édité à l'aide du bloc B54 - «Get Parameter» (bibliothèque d'éléments -&gt; dossier «Nextion HMI Panel» -&gt; dossier «Elements»). Bloquer les paramètres. </font></font><br>
<br>
<img src="https://habrastorage.org/files/bd2/bc1/c66/bd2bc1c66daf4ba19e8424d74648463b.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous mettons la valeur obtenue dans la variable «Numéro du champ édité». </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et par la même impulsion, nous lirons directement la nouvelle valeur du champ de texte en utilisant le bloc B50 - «Get Parameter» (bibliothèque d'éléments -&gt; dossier «Nextion HMI Panel» -&gt; dossier «Elements»). Bloquer les paramètres. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b46/3a0/32b/b463a032bde0419da9d26ca913e8bc2c.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous transformons la nouvelle valeur de la chaîne en un nombre au format Float en utilisant le bloc B51 - "Conversion de chaîne" (bibliothèque d'éléments, dossier "Type Conversion"). Bloquer les paramètres.</font></font><br>
 <br>
<img src="https://habrastorage.org/files/6a7/516/598/6a7516598acf4c6c83c8512b19841b5f.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous multiplions le nombre par 10 en utilisant le bloc B52 - "MUL (*)" (bibliothèque d'éléments, dossier "Mathématiques"), changez le type en Entier en utilisant le bloc B53 - "Convertir Float en Entier" (bibliothèque d'éléments, dossier "Type Conversion") et insérez la variable "Nouvelle valeur". </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau 10 - "Traitement des résultats de la modification de la valeur"</font></font></b><br>
<br>
<img src="https://habrastorage.org/files/1e9/970/39c/1e997039cc3c4537bbd4aefe2e5a8e87.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A l'aide du bloc B55 - «Comparateur» (bibliothèque d'éléments, dossier «Comparaison») nous déterminons quel champ a été édité, et en fonction du résultat, écrivez la valeur de la variable «Nouvelle valeur» par le momentum de la variable «Fin d'édition» dans l'une des deux variables, dans «Point de consigne pour l'arrêt du ventilateur x10» ou dans «Point de consigne pour l'allumage du ventilateur x10». Toujours par la même impulsion, nous donnons la commande du panneau pour aller à la page de contrôle en utilisant le bloc B58 - «Aller à la page» (bibliothèque d'éléments, dossier «Nextion HMI Panel» -&gt; dossier «Page»). Bloquer les paramètres. </font></font><br>
<br>
<img src="https://habrastorage.org/files/f67/1e9/03c/f671e903cfc34abcb725e0e241b3c797.PNG"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tableau 11 - «Écriture des valeurs de réglage sur le panneau et EEProm»</font></font></b><br>
<br>
<img src="https://habrastorage.org/files/3f4/c77/146/3f4c77146fe9469bb9d6fdc7f7df14b6.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A l'aide du bloc B59 - «Détecteur de modification du nombre» (bibliothèque d'éléments, dossier «Eléments de base»), nous déterminons le fait de modifier la valeur par la variable «Fan On Setpoint x10». Une impulsion courte se forme à la sortie du bloc au moment de la modification de la valeur à l'entrée «Value». Par cette impulsion, la valeur est écrite dans la mémoire non volatile du contrôleur. Cela peut être fait à l'aide du bloc B65 - «Ecrire dans l'EEPROM» (bibliothèque d'éléments, dossier «EEPROM»). Le bloc est configuré à l'aide de l'éditeur de blocs. </font></font><br>
 <br>
<img src="https://habrastorage.org/files/2da/162/bf6/2da162bf62144c4a864c8aabd1ad309f.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avant d'écrire une variable dans l'EEPROM, vous devez la créer à cet endroit. Pour ce faire, cliquez sur le bouton "Créer" dans l'éditeur de blocs. La fenêtre de création d'une variable s'ouvre. </font></font><br>
<br>
<img src="https://habrastorage.org/files/755/94e/c4c/75594ec4cb8243b5a88a7eb857a4b1d6.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous y définissons le nom de la variable et son type. Après avoir cliqué sur le bouton prêt, le bloc sera attaché à cette variable.</font></font><br>
<br>
<img src="https://habrastorage.org/files/e80/76c/4bd/e8076c4bd256488290502c409775024b.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, par un signal de changement de variable, sa valeur est divisée par une constante de type Float égale à 10 en utilisant le bloc B61 - "DIV (/)" (bibliothèque d'éléments, dossier "Mathématiques"), se transforme en chaîne en utilisant le bloc B62 - "Conversion de chaîne" (bibliothèque d'éléments, dossier «conversion de type»), et envoyée au panneau dans le champ correspondant à l'aide du bloc B63 - «Définir paramètre» (bibliothèque d'éléments, dossier «Nextion HMI Panel» -&gt; dossier «Éléments»). Paramètres de ce bloc. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b4c/ee8/803/b4cee88034a54492a5441d394b2678d1.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La logique de contrôle par la variable «Fan off setting x10» est la même, les réglages de bloc sont les suivants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bloc B65. </font></font><br>
<br>
<img src="https://habrastorage.org/files/c1d/543/faf/c1d543faf0a0479eb0dea94b12b9e30d.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bloc B68.</font></font><br>
<br>
<img src="https://habrastorage.org/files/77d/c88/6c5/77dc886c54cb4c9981dfed2416a2a397.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous allons maintenant nous assurer que les paramètres sont lus à partir de l'EEPROM au moment où le contrôleur démarre. Pour ce faire, insérez une nouvelle carte tout en haut du projet afin que le circuit qui s'y trouve soit exécuté en premier. Pour ce faire, sélectionnez le premier plan et cliquez sur le bouton «Insérer une carte devant celle sélectionnée». </font></font><br>
<br>
<img src="https://habrastorage.org/files/981/31f/ca6/98131fca63f940659d73bd8adf398b80.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Appelons la nouvelle carte «Lecture des paramètres de l'EEPROM». </font><font style="vertical-align: inherit;">
Carte </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.</font></font></b><br>
<br>
<img src="https://habrastorage.org/files/141/f9d/23a/141f9d23ac12428397de261516f52fb2.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En utilisant le bloc Â72 - «Rtrig» (bibliothèque d'éléments, dossier «Déclencheurs»), nous créons une impulsion courte lorsque le contrôleur est allumé. Selon cette impulsion, les valeurs lues dans la mémoire non volatile sont enregistrées dans les variables «Consigne pour allumer le ventilateur x10» et «Consigne pour éteindre le ventilateur x10». Cela se produit à l'aide des blocs B71 et B73 - «Lecture depuis l'EEPROM» (bibliothèque d'éléments, dossier «EEPROM»). Les blocs sont paramétrés à l'aide de l'éditeur de blocs.</font></font><br>
<br>
<img src="https://habrastorage.org/files/2da/48a/e59/2da48ae5964a45768b2983e24b7faf63.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paramètres du bloc B71. </font></font><br>
<br>
<img src="https://habrastorage.org/files/377/ce7/122/377ce71220fd460982eea7fbbe704d7f.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La variable lue est sélectionnée dans l'EEPROM en appuyant sur le bouton "Sélectionner". </font><font style="vertical-align: inherit;">La fenêtre de sélection des variables s'ouvre. </font></font><br>
<br>
<img src="https://habrastorage.org/files/5d5/b01/d35/5d5b01d35ef74968a8a18367cb27548a.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Paramètres du bloc B73. </font></font><br>
<br>
<img src="https://habrastorage.org/files/518/a99/862/518a998626ad4583ba0f6587a3d4b309.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eh bien, le dernier conseil d'administration du projet. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carte 12. «Contrôle du ventilateur»</font></font></b><br>
<br>
<img src="https://habrastorage.org/files/336/979/a52/336979a526da49e7b457edfcb70c98a0.PNG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Si la température actuelle a dépassé le paramètre «Point de consigne du ventilateur x10», cela sera détecté par l'unité de comparaison B69 et mettre le déclencheur B70 à l'état 1, et lorsque la température descendra en dessous du paramètre «Point de consigne d'arrêt du ventilateur x10», elle sera détectée par le bloc B71, qui met le déclencheur B70 à l'état 0. L'état de déclenchement est fourni à l'unité de sortie associée au ventilateur. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Archive avec les codes sources des projets. </font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Démo vidéo</font></font><br>
<br>
<iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/j8ZimsAfq8k%3Ffeature%3Doembed&amp;usg=ALkJrhgXfln9STFyLjK3Jqye7erT8HIaKw" frameborder="0" allowfullscreen=""></iframe></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr392865/">https://habr.com/ru/post/fr392865/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr392855/index.html">Будущее систем хранения данных</a></li>
<li><a href="../fr392857/index.html">Conversion d'un commutateur radio à bouton-poussoir en une touche</a></li>
<li><a href="../fr392859/index.html">Des robots volent de l'argent des cartes bancaires russes</a></li>
<li><a href="../fr392861/index.html">Nous brassons de la bière dans une cafetière goutte à goutte</a></li>
<li><a href="../fr392863/index.html">Petit secret de l'artiste Alexei Leonov</a></li>
<li><a href="../fr392867/index.html">Les Chinois ont édité l'ADN d'un embryon humain une deuxième fois</a></li>
<li><a href="../fr392869/index.html">Airbus et Siemens créeront des moteurs d'avion électriques et hybrides</a></li>
<li><a href="../fr392873/index.html">Détecteur de CO (monoxyde de carbone). Qu'est-ce que c'est et pourquoi est-ce nécessaire?</a></li>
<li><a href="../fr392875/index.html">Inventions automatiques pour le domaine public</a></li>
<li><a href="../fr392877/index.html">Adieu au blog FLProg (UPD - adieu annulé, nous travaillons plus loin)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>