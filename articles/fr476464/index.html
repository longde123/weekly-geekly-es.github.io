<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèø üë©‚Äçüëß‚Äçüë¶ ‚ûñ Probl√®mes de journalisation des √©v√©nements de s√©curit√© du syst√®me Windows üóÑÔ∏è üõÄüèΩ ü¶á</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les syst√®mes d'exploitation Windows ont un assez bon syst√®me de journalisation des √©v√©nements de s√©curit√©. Beaucoup de bonnes choses ont √©t√© √©crites √†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Probl√®mes de journalisation des √©v√©nements de s√©curit√© du syst√®me Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476464/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/r3/ka/al/r3kaaljcd70px_fvggsc4jmu4es.jpeg"></a> <br><br>  Les syst√®mes d'exploitation Windows ont un assez bon syst√®me de journalisation des √©v√©nements de s√©curit√©.  Beaucoup de bonnes choses ont √©t√© √©crites √† son sujet dans diverses publications et revues, mais cet article portera sur autre chose.  Ici, nous parlons des probl√®mes et des lacunes de ce syst√®me.  Certains des probl√®mes consid√©r√©s ne seront pas critiques, ne faisant que compliquer les proc√©dures d'analyse des √©v√©nements, tandis que d'autres constitueront de tr√®s graves menaces pour la s√©curit√©. <br><br>  Les probl√®mes identifi√©s ont √©t√© test√©s sur Windows 7 Maximum (version russe), Windows 7 Professionnel (version anglaise), Windows 10 Pro (version russe), Windows Server 2019 Datacenter (version russe).  Tous les syst√®mes d'exploitation ont √©t√© compl√®tement mis √† jour. <br><a name="habracut"></a><br><h2>  Probl√®me n ¬∞ 1. √âchec du syst√®me de gestion des param√®tres d'audit </h2><br>  <i>Le probl√®me est confirm√© sur Windows 7/10 / Server 2019.</i> <br><br><h3>  Description du probl√®me </h3><br>  Prenez Windows 7 et installez-le avec les param√®tres par d√©faut.  Nous n'entrerons pas dans le domaine.  Voyons les param√®tres d'audit des √©v√©nements de s√©curit√©.  Pour ce faire, ouvrez le composant logiciel enfichable Strat√©gies de s√©curit√© locales (secpol.msc ou Panneau de configuration -&gt; Outils d'administration -&gt; Strat√©gies de s√©curit√© locales) et examinez les param√®tres d'audit de base (Param√®tres de s√©curit√© -&gt; Strat√©gies locales -&gt; Strat√©gies d'audit) ) <br><br><img src="https://habrastorage.org/webt/bd/sm/cw/bdsmcwohkqtxgp9dzcac8p63daw.jpeg"><br><br>  Comme vous pouvez le voir, l'audit n'est pas configur√©.  Voyons maintenant les strat√©gies d'audit avanc√©es ("Param√®tres de s√©curit√© -&gt; Configuration avanc√©e des strat√©gies d'audit -&gt; Strat√©gies d'audit syst√®me - Objet de strat√©gie de groupe locale"). <br><br><img src="https://habrastorage.org/webt/om/oy/po/omoypoc15q9ynn0osefv-gawd4i.jpeg"><br><br>  Ici, l'audit n'est pas configur√© non plus.  Si c'est le cas, alors en th√©orie, il ne devrait pas y avoir d'√©v√©nements de s√©curit√© dans les journaux.  Nous v√©rifions.  Ouvrez le journal de s√©curit√© (eventvwr.exe ou "Panneau de configuration -&gt; Outils d'administration -&gt; Afficher les √©v√©nements"). <br><br><img src="https://habrastorage.org/webt/j0/s4/ot/j0s4otidlwtntmyx-s02-kom3uk.jpeg"><br><br>  <b>Question: "D'o√π vient l'√©v√©nement dans le journal de s√©curit√© si l'audit n'est pas configur√© du tout?!"</b> <br><br><h3>  Explication </h3><br>  Pour comprendre la raison de ce comportement, vous devez vous mettre "sous le capot" du syst√®me d'exploitation.  Pour commencer, nous traiterons des politiques d'audit de base et avanc√©es. <br><br>  Avant Windows Vista, il n'y avait qu'une seule strat√©gie d'audit, qui est maintenant appel√©e de base.  Le probl√®me √©tait que la granularit√© de la gestion de l'audit √† cette √©poque √©tait tr√®s faible.  Ainsi, s'il √©tait n√©cessaire de suivre l'acc√®s aux fichiers, ils incluaient alors la cat√©gorie de politique de base ¬´Audit de l'acc√®s aux objets¬ª.  En cons√©quence, en plus des op√©rations sur les fichiers, un tas d'autres √©v√©nements "de bruit" se sont d√©vers√©s dans le journal de s√©curit√©.  Cela a grandement compliqu√© le traitement des journaux et des utilisateurs √©nerv√©s. <br><br>  Microsoft a entendu cette ¬´douleur¬ª et a d√©cid√© d'aider.  Le probl√®me est que Windows est construit sur le concept de compatibilit√© descendante, et apporter des modifications au m√©canisme de gestion d'audit existant aurait tu√© cette compatibilit√©.  Par cons√©quent, le vendeur est all√© dans l'autre sens.  Il a cr√©√© un nouvel outil et l'a appel√© Strat√©gies d'audit avanc√©es. <br><br>  L'essence de l'outil r√©side dans le fait que les cat√©gories de politiques avanc√©es ont √©t√© cr√©√©es √† partir des cat√©gories de politiques d'audit de base, et celles-ci, √† leur tour, ont √©t√© divis√©es en sous-cat√©gories qui peuvent √™tre activ√©es et d√©sactiv√©es individuellement.  Maintenant, si vous devez suivre l'acc√®s aux fichiers dans les politiques d'audit avanc√©es, vous devez activer uniquement la sous-cat√©gorie "Syst√®me de fichiers", qui est incluse dans la cat√©gorie "Acc√®s aux objets".  Dans le m√™me temps, les √©v√©nements de ¬´bruit¬ª li√©s √† l'acc√®s au registre ou au filtrage du trafic r√©seau ne seront pas inclus dans le journal de s√©curit√©. <br><br>  Une √©norme confusion dans tout ce sch√©ma est que les noms des cat√©gories de politiques d'audit de base et avanc√©es ne co√Øncident pas, et au premier abord, il peut sembler que ce sont des choses compl√®tement diff√©rentes, mais ce n'est pas le cas. <br><br>  Voici un tableau de conformit√© des noms des cat√©gories de base et avanc√©es de la gestion de l'audit <br><div class="scrollable-table"><table><tbody><tr><td>  <b>Nom des politiques d'audit de base</b> </td><td>  <b>Nom de la politique d'audit √©tendue</b> </td></tr><tr><td>  Audit d'acc√®s au service d'annuaire </td><td>  Acc√®s au service d'annuaire (DS) </td></tr><tr><td>  Audit d'acc√®s aux objets </td><td>  Acc√®s aux installations </td></tr><tr><td>  Audit de privil√®ge </td><td>  Utilisation des droits </td></tr><tr><td>  Audit de connexion </td><td>  Entr√©e / sortie </td></tr><tr><td>  Audit des √©v√©nements de connexion </td><td>  Connexion au compte </td></tr><tr><td>  Modifications de la politique d'audit </td><td>  Changement de politique </td></tr><tr><td>  √âv√©nements du syst√®me d'audit </td><td>  Le syst√®me </td></tr><tr><td>  Audit de gestion des comptes </td><td>  Gestion de compte </td></tr><tr><td>  Audit de suivi des processus </td><td>  Suivi d√©taill√© </td></tr></tbody></table></div><br>  Il est important de comprendre que les cat√©gories de base et avanc√©es contr√¥lent essentiellement la m√™me chose.  L'inclusion d'une cat√©gorie de politique d'audit de base entra√Æne l'inclusion de la cat√©gorie de politique d'audit √©tendue correspondante et, par cons√©quent, de toutes ses sous-cat√©gories.  Pour √©viter des cons√©quences impr√©vues, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Microsoft ne recommande pas l'</a> utilisation de strat√©gies d'audit de base et avanc√©es en m√™me temps. <br><br>  Il est maintenant temps de d√©terminer o√π les param√®tres d'audit sont stock√©s.  Pour commencer, nous introduisons un certain nombre de concepts: <br><br><ol><li>  <i>Strat√©gies d'audit efficaces</i> - informations stock√©es dans la RAM qui d√©terminent les param√®tres de fonctionnement actuels des modules du syst√®me d'exploitation qui impl√©mentent les fonctions d'audit. </li><li>  <i>Strat√©gies d'audit enregistr√©es</i> - informations stock√©es dans le registre sous HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv et utilis√©es pour d√©terminer les strat√©gies d'audit efficaces apr√®s un red√©marrage du syst√®me. </li></ol><br>  Nous prendrons en consid√©ration divers outils administratifs et indiquerons les param√®tres d'audit qu'ils affichent et ceux qui sont d√©finis.  Les donn√©es du tableau sont bas√©es sur des exp√©riences. <br><div class="scrollable-table"><table><tbody><tr><td>  <b>Nom des fonds</b> </td><td>  <b>Strat√©gies d'audit affich√©es</b> </td><td>  <b>Strat√©gies d'audit persistantes</b> </td></tr><tr><td>  Strat√©gies d'audit de base du composant logiciel enfichable Strat√©gies de s√©curit√© locales </td><td>  Politiques d'audit efficaces </td><td>  Strat√©gies d'audit efficaces, politiques d'audit enregistr√©es </td></tr><tr><td>  Strat√©gies d'audit avanc√©es du composant logiciel enfichable Strat√©gies de s√©curit√© locales </td><td colspan="2"> Fichier <code>%SystemRoot%\System32\GroupPolicy\Machine\Microsoft\Windows NT\Audit\audit.csv</code> </td></tr><tr><td>  Utilitaire Auditpol </td><td>  Param√®tres d'audit enregistr√©s </td><td>  Param√®tres d'audit efficaces, param√®tres d'audit enregistr√©s </td></tr></tbody></table></div><br>  Expliquons le tableau avec des exemples. <br><br>  <b>Exemple 1</b> <br><br>  Si vous ex√©cutez auditpol pour afficher les param√®tres d'audit: <br>  <code>auditpol /get /category:*</code> , les param√®tres d'audit enregistr√©s seront affich√©s, c'est-√†-dire ceux stock√©s dans le registre √† HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv. <br><br>  <b>Exemple 2</b> <br><br>  Si vous ex√©cutez le m√™me utilitaire, mais d√©j√† pour d√©finir les param√®tres: <br>  <code>auditpol /set /category:*</code> , les param√®tres d'audit effectifs et les param√®tres d'audit enregistr√©s seront modifi√©s. <br><br>  Un commentaire distinct requiert l'ordre dans lequel les param√®tres d'audit sont affich√©s dans les "Strat√©gies d'audit de base" du composant logiciel enfichable "Strat√©gies de s√©curit√© locales".  La cat√©gorie de la strat√©gie d'audit de base s'affiche comme d√©finie si toutes les sous-cat√©gories de la strat√©gie d'audit √©tendue correspondante sont install√©es.  Si au moins l'un d'entre eux n'est pas install√©, la strat√©gie sera affich√©e comme non install√©e. <br><br>  <b>Exemple 3</b> <br><br>  √Ä l'aide de la commande <code>auditpol /set /category:*</code> , l' <code>auditpol /set /category:*</code> d√©fini toutes les sous-cat√©gories d'audit en mode de r√©ussite d'audit.  De plus, si vous acc√©dez aux ¬´Strat√©gies d'audit de base¬ª du composant logiciel enfichable ¬´Strat√©gies de s√©curit√© locales¬ª, un audit de r√©ussite sera install√© en face de chaque cat√©gorie. <br><br>  <b>Exemple 4</b> <br><br>  L'administrateur a maintenant <code>auditpol /clear</code> commande <code>auditpol /clear</code> et r√©initialis√© tous les param√®tres d'audit.  Il a ensuite configur√© l'audit du syst√®me de fichiers en ex√©cutant <code>auditpol /set /subcategory:" "</code> .  Maintenant, si vous acc√©dez aux ¬´Strat√©gies d'audit de base¬ª du composant logiciel enfichable ¬´Strat√©gies de s√©curit√© locales¬ª, toutes les cat√©gories seront d√©finies dans l'√©tat ¬´Aucun audit¬ª, car aucune cat√©gorie de la strat√©gie d'audit √©tendue n'est enti√®rement d√©finie. <br><br>  Maintenant, enfin, nous pouvons r√©pondre √† la question de savoir d'o√π viennent les journaux dans le syst√®me d'exploitation fra√Æchement install√©.  Le fait est qu'apr√®s l'installation, l'audit sous Windows est configur√© et d√©fini dans les param√®tres d'audit enregistr√©s.  Vous pouvez le v√©rifier en ex√©cutant la commande <code>auditpol /get /category:*</code> . <br><br><img src="https://habrastorage.org/webt/dx/ot/1s/dxot1swbotmghm7jxzo0zuafvcy.jpeg"><br><br>  Dans les strat√©gies d'audit de base du composant logiciel enfichable Strat√©gies de s√©curit√© locales, ces informations d'audit ne sont pas affich√©es, car toutes les cat√©gories n'ont pas d√©fini une ou plusieurs sous-cat√©gories.  Dans les strat√©gies d'audit avanc√©es du composant logiciel enfichable Strat√©gies de s√©curit√© locales, ces informations ne s'affichent pas car le composant logiciel enfichable fonctionne uniquement avec les param√®tres d'audit stock√©s dans le fichier% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv. <br><br><h3>  Quelle est l'essence du probl√®me? </h3><br>  Au d√©but, il peut sembler que tout cela n'est pas du tout un probl√®me, mais ce n'est pas le cas.  Le fait que tous les outils affichent les param√®tres d'audit de diff√©rentes mani√®res cr√©e la possibilit√© d'une manipulation malveillante des strat√©gies et, par cons√©quent, des r√©sultats d'audit. <br><br>  <b>Consid√©rez le sc√©nario probable</b> <br><br>  Laissez un poste de travail technologique bas√© sur Windows 7 fonctionner dans le r√©seau d'entreprise. <br><br>  La machine n'est pas incluse dans le domaine et remplit les fonctions d'un robot qui envoie quotidiennement des rapports aux autorit√©s r√©glementaires.  Les attaquants d'une mani√®re ou d'une autre y ont eu acc√®s √† distance avec des droits d'administrateur.  Dans le m√™me temps, l'objectif principal des attaquants est l'espionnage et la t√¢che est de rester non d√©tect√© dans le syst√®me.  Les attaquants ont secr√®tement d√©cid√© afin qu'il n'y ait aucun √©v√©nement avec le code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4719 ¬´Audit policy changes¬ª</a> dans le journal de s√©curit√©, d√©sactivez l'audit d'acc√®s aux fichiers, mais en m√™me temps que tous les outils d'administration disent que l'audit est activ√©.  Pour r√©aliser la t√¢che, ils ont effectu√© les actions suivantes: <br><br><ol><li>  Sur le poste de travail attaqu√©, ils se sont accord√©s des autorisations d'√©criture sur la cl√© de registre HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv et ont export√© cette cl√© dans un fichier nomm√© "+ fs.reg". </li><li>  Ce fichier a √©t√© import√© sur un autre ordinateur, red√©marr√©, puis auditpol a d√©sactiv√© l'audit du syst√®me de fichiers, apr√®s quoi la cl√© de registre ci-dessus a √©t√© export√©e dans le fichier "-fs.reg". </li><li>  Sur la machine attaqu√©e, le fichier "-fs.reg" a √©t√© import√© dans le registre. </li><li>  Nous avons effectu√© une copie de sauvegarde du fichier% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv situ√© sur la machine attaqu√©e, puis supprim√© la sous-cat√©gorie du syst√®me de fichiers. </li><li>  Nous avons red√©marr√© le poste de travail attaqu√©, puis remplac√© le fichier% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv par une copie de sauvegarde pr√©c√©demment enregistr√©e et nous avons √©galement import√© le fichier "+ fs.reg" </li></ol><br>  √Ä la suite de toutes ces manipulations, il n'y a aucune entr√©e de changement de politique dans le journal de s√©curit√©, tous les outils montrent que l'audit est activ√©, mais en fait cela ne fonctionne pas. <br><br><h2>  Probl√®me n ¬∞ 2. Enregistrement des op√©rations infructueux pour supprimer des fichiers, des r√©pertoires et des cl√©s de registre </h2><br>  <i>Le probl√®me est confirm√© sur Windows 7/10 / Server 2019.</i> <br><br><h3>  Description du probl√®me </h3><br>  Pour qu'une op√©ration supprime un fichier, un r√©pertoire ou une cl√© de registre, le syst√®me d'exploitation g√©n√®re une s√©quence d'√©v√©nements avec les codes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4663</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4660</a> .  Le probl√®me est que de tout le flux d'√©v√©nements, ce couple n'est pas si facile de se connecter.  Pour ce faire, les √©v√©nements analys√©s doivent avoir les param√®tres suivants: <br><br>  <i>√âv√©nement 1. Code 4663 "Une tentative d'acc√®s √† l'objet a √©t√© effectu√©e."</i>  Param√®tres d'√©v√©nement: <br>  "ObjectType" = Fichier. <br>  "ObjectName" = nom du fichier ou du r√©pertoire √† supprimer. <br>  "HandleId" = g√©rer le fichier √† supprimer. <br>  "AcessMask" = 0x10000 (Ce code correspond √† l'op√©ration DELETE. Vous pouvez trouver le d√©chiffrement de tous les codes d'op√©ration <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le site Web de Microsoft</a> ). <br><br><img src="https://habrastorage.org/webt/ez/it/6z/ezit6zapdorhyh5blpomzppv1dc.jpeg"><br><br>  <i>√âv√©nement 2. Code 4660 "Objet supprim√©."</i> <br>  Param√®tres d'√©v√©nement: <br><br>  "HandleId" = "Ev√©nements HandleId 1" <br>  "System \ EventRecordID" = "System \ EventRecordID de l'√©v√©nement 1" + 1. <br><br><img src="https://habrastorage.org/webt/qy/bj/6a/qybj6a3724rrph9wsqki1bpcntm.jpeg"><br><br>  Avec la suppression de la cl√© de registre (cl√©), tout est pareil, seulement dans le premier √©v√©nement avec le code 4663, le param√®tre "ObjectType" = Key. <br><br>  Notez que la suppression de valeurs dans le Registre est d√©crite par un autre √©v√©nement (code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4657</a> ) et ne provoque pas de tels probl√®mes. <br><br><h3>  Fonctionnalit√©s de suppression de fichiers dans Windows 10 et Server 2019 </h3><br>  Dans Windows 10 / Server 2019, il existe deux fa√ßons de supprimer un fichier. <br><br><ol><li>  Si le fichier est supprim√© dans la corbeille, alors, comme pr√©c√©demment, la s√©quence des √©v√©nements 4663 et 4660. </li><li>  Si le fichier est supprim√© d√©finitivement (pass√© la corbeille), alors avec un seul √©v√©nement avec le code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4659</a> . </li></ol><br>  Une chose √©trange s'est produite.  Si auparavant, pour d√©terminer les fichiers supprim√©s, il √©tait n√©cessaire de surveiller la totalit√© des √©v√©nements 4663 et 4660, maintenant Microsoft est ¬´all√© √† la rencontre des utilisateurs¬ª, et au lieu de deux √©v√©nements, nous devons maintenant en surveiller trois.  Il convient √©galement de noter que la proc√©dure de suppression des r√©pertoires n'a pas chang√©; elle se compose, comme pr√©c√©demment, de deux √©v√©nements 4663 et 4660. <br><br><h3>  Quelle est l'essence du probl√®me? </h3><br>  Le probl√®me est que d√©couvrir qui a supprim√© le fichier ou le r√©pertoire devient une t√¢che non triviale.  Au lieu de rechercher banalement l'√©v√©nement correspondant dans le journal de s√©curit√©, il est n√©cessaire d'analyser la s√©quence des √©v√©nements, ce qui est plut√¥t difficile √† faire manuellement.  Sur habr m√™me √† ce sujet, il y avait un article: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Auditer la suppression et l'acc√®s aux fichiers et enregistrer les √©v√©nements dans un fichier journal √† l'aide de Powershell</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> <br><br><h2>  Probl√®me num√©ro 3 (critique).  Enregistrement infructueux de l'op√©ration de changement de nom pour les fichiers, les r√©pertoires et les cl√©s de registre </h2><br>  <i>Le probl√®me est confirm√© sur Windows 7/10 / Server 2019.</i> <br><br><h3>  Description du probl√®me </h3><br>  Ce probl√®me a deux sous-probl√®mes: <br><br><ol><li>  Dans les √©v√©nements g√©n√©r√©s par le syst√®me lors du changement de nom, le nouveau nom d'objet n'est fix√© nulle part. </li><li>  La proc√©dure de changement de nom est tr√®s similaire √† la suppression.  Il ne peut √™tre distingu√© que par le fait que le premier √©v√©nement avec le code 4663, avec le param√®tre "AcessMask" = 0x10000 (DELETE) <b>ne passe pas √† l'</b> √©v√©nement 4660. </li></ol><br>  Il convient de noter qu'en ce qui concerne le registre, ce probl√®me ne s'applique qu'aux cl√©s.  Renommer des valeurs dans le registre est d√©crit par une s√©quence d'√©v√©nements 4657 et ne provoque pas de telles plaintes, bien que, bien s√ªr, il serait beaucoup plus pratique s'il n'y avait qu'un seul √©v√©nement. <br><br><h3>  Quelle est l'essence du probl√®me? </h3><br>  Outre la difficult√© de rechercher des op√©rations de changement de nom de fichier, cette fonction de journalisation ne permet pas de suivre le cycle de vie complet des objets du syst√®me de fichiers ou des cl√©s de registre.  Par cons√©quent, il devient extr√™mement difficile de d√©terminer l'historique d'un fichier qui a √©t√© renomm√© plusieurs fois sur un serveur de fichiers utilis√© activement. <br><br><h2>  Probl√®me num√©ro 4 (critique).  Impossible de suivre la cr√©ation des r√©pertoires et des cl√©s de registre </h2><br>  <i>Le probl√®me est confirm√© sur Windows 7/10 / Server 2019.</i> <br><br><h3>  Description du probl√®me </h3><br>  Windows ne suit pas la cr√©ation d'un r√©pertoire de syst√®me de fichiers et d'une cl√© de registre.  Cela consiste dans le fait que le syst√®me d'exploitation ne g√©n√®re pas d'√©v√©nement qui contiendrait le nom du r√©pertoire ou de la cl√© de registre cr√©√© et dont les param√®tres indiqueraient qu'il s'agit de l'op√©ration de cr√©ation. <br><br>  Th√©oriquement, par des signes indirects, le fait de cr√©er un catalogue est possible.  Par exemple, s'il a √©t√© cr√©√© via "l'Explorateur", pendant le processus de cr√©ation, des √©v√©nements d'interrogation pour les attributs du nouveau r√©pertoire seront g√©n√©r√©s.  Le probl√®me est que si vous cr√©ez un r√©pertoire via la commande <code>mkdir</code> , aucun √©v√©nement n'est g√©n√©r√© du tout.  Il en est de m√™me pour la cr√©ation de cl√©s dans le registre. <br><br><h3>  Quelle est l'essence du probl√®me? </h3><br>  Ce probl√®me rend tr√®s difficile les enqu√™tes sur les incidents de s√©curit√© des informations.  Il n'y a aucune explication raisonnable au fait que ces informations ne sont pas enregistr√©es dans les journaux. <br><br><h2>  Probl√®me num√©ro 5 (critique).  Param√®tres d'audit incorrects dans les versions russes de Windows </h2><br>  <i>La pr√©sence du probl√®me est confirm√©e sur les √©ditions russes de Windows 7/10 / Server 2019.</i> <br><br><h3>  Description du probl√®me </h3><br>  Il y a une erreur dans les versions russes de Windows qui rend le syst√®me de gestion des audits de s√©curit√© inop√©rant. <br><br><h3>  Sympt√¥mes </h3><br>  La modification des politiques de s√©curit√© avanc√©es n'affecte pas les param√®tres d'audit effectifs ou, en d'autres termes, les politiques ne sont pas appliqu√©es.  Par exemple, l'administrateur a activ√© la sous-cat√©gorie "Connexion", red√©marr√© le syst√®me, ex√©cut√© la commande <code>auditpol /get /category:*</code> , et cette sous-cat√©gorie reste <code>auditpol /get /category:*</code> .  Le probl√®me concerne √† la fois les ordinateurs de domaine g√©r√©s via des strat√©gies de groupe et les ordinateurs hors domaine g√©r√©s √† l'aide d'un objet de strat√©gie de groupe local configur√© via le composant logiciel enfichable Strat√©gies de s√©curit√© locales. <br><br><h3>  Raisons </h3><br>  Le probl√®me se produit si l'administrateur a activ√© au moins une des sous-cat√©gories ¬´d√©faillantes¬ª des strat√©gies d'audit avanc√©es.  Ces cat√©gories ayant √©chou√©, en particulier, comprennent: <br><br><ol><li>  Utilisation des droits -&gt; Auditer l'utilisation des droits affectant les donn√©es confidentielles.  GUID: {0cce9228-69ae-11d9-bed3-505054503030}. </li><li>  Utilisation des droits -&gt; Auditez l'utilisation des droits qui n'affectent pas les donn√©es confidentielles.  GUID: {0cce9229-69ae-11d9-bed3-505054503030}. </li><li>  Acc√®s aux objets -&gt; Auditer les √©v√©nements cr√©√©s par les applications.  GUID: {0cce9222-69ae-11d9-bed3-505054503030}. </li></ol><br><h3>  Recommandations pour r√©soudre le probl√®me </h3><br>  Si le probl√®me ne s'est pas encore produit, n'activez pas les sous-cat√©gories ¬´√©chou√©es¬ª indiqu√©es.  Si les √©v√©nements de ces sous-cat√©gories sont tr√®s n√©cessaires, utilisez l'utilitaire auditpol pour les activer ou g√©rez l'audit √† l'aide de strat√©gies de base. <br><br>  En cas de probl√®me, vous devez: <br><br><ol><li>  Dans le r√©pertoire de strat√©gie de groupe de domaine, supprimez le fichier \ Machine \ microsoft \ windows nt \ Audit \ audit.csv </li><li>  Sur tous les ordinateurs qui rencontrent des probl√®mes d'audit, supprimez les fichiers:% SystemRoot% \ security \ audit \ audit.csv,% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv </li></ol><br><h3>  Quelle est l'essence du probl√®me? </h3><br>  La pr√©sence de ce probl√®me r√©duit le nombre d'√©v√©nements de s√©curit√© qui peuvent √™tre surveill√©s r√©guli√®rement gr√¢ce √† des strat√©gies d'audit avanc√©es, et cr√©e √©galement des menaces de d√©connexion, de blocage et de d√©stabilisation de la gestion du syst√®me d'audit dans le r√©seau d'entreprise. <br><br><h2>  Probl√®me num√©ro 6 (critique).  Merde "Nouveau texte document.txt ... ainsi que Nouveau bitmap.bmp" </h2><br>  <i>Le probl√®me a √©t√© confirm√© sur Windows 7. Le probl√®me est manquant dans Windows 10 / Server 2019.</i> <br><br><h3>  Description du probl√®me </h3><br>  Il s'agit d'un probl√®me tr√®s √©trange d√©couvert par accident.  L'essence du probl√®me est que le syst√®me d'exploitation a une faille qui vous permet de contourner l'audit de la cr√©ation de fichiers. <br><br>  <b>Partie pr√©paratoire:</b> <br><br><ol><li>  Prenez un Windows 7 fra√Æchement install√©. </li><li>  R√©initialisez tous les param√®tres d'audit √† l'aide de la commande <code>auditpol /clear</code> .  Cet √©l√©ment est facultatif et ne sert qu'√† l'analyse des magazines. </li><li>  Nous configurons l'audit du syst√®me de fichiers en ex√©cutant <code>auditpol /set /subcategory:" "</code> . </li><li>  Cr√©ons le r√©pertoire C: \ TEST et assignons des param√®tres d'audit pour le compte ¬´Everything¬ª: ¬´Create Files / Write Data¬ª, ¬´Create Folders / Write Data¬ª, ¬´Write Attributes¬ª, ¬´Write Additional Attributes¬ª, ¬´Delete Subfolders and fichiers "," Supprimer "," Changement d'autorisations "," Changement de propri√©taire ", c'est-√†-dire tout ce qui concerne l'√©criture de donn√©es dans le syst√®me de fichiers. </li></ol><br>  Pour plus de clart√©, avant chaque exp√©rience, nous effacerons le journal de s√©curit√© du syst√®me d'exploitation. <br><br>  <b>Exp√©rience 1.</b> <br>  <b>Nous faisons:</b> <br><br>  √Ä partir de la ligne de commande, ex√©cutez la commande: <code>echo &gt; "c:\test\  .txt"</code> <br>  <b>On observe:</b> <br><br>  Lors de la cr√©ation du fichier, un √©v√©nement avec le code 4663 est apparu dans le journal de s√©curit√©, contenant le nom du fichier en cours de cr√©ation dans le champ "ObjectName" et 0x2 dans le champ "AccessMask" ("Ecriture de donn√©es ou ajout d'un fichier"). <br><br><img src="https://habrastorage.org/webt/k3/cn/6l/k3cn6ltuqg-gclek4pgtn7u_tea.jpeg"><br><br>  Pour effectuer les exp√©riences suivantes, nous effa√ßons le dossier et le journal des √©v√©nements. <br><br>  <b>Exp√©rience 2.</b> <br>  <b>Nous faisons:</b> <br><br>  Ouvrez le dossier C: \ TEST via l '"Explorateur" et utilisez le menu contextuel "Cr√©er -&gt; Document texte", appel√© par un clic droit, cr√©ez le fichier "Nouveau document texte.txt". <br><br><img src="https://habrastorage.org/webt/cc/nh/gj/ccnhgj_6_2xrciyj4m6ubv9hmpk.jpeg"><br><br>  <b>On observe:</b> <br><br>  Cette action n'√©tait pas refl√©t√©e dans le journal des √©v√©nements !!!  De plus, il n'y aura aucune entr√©e si vous utilisez le m√™me menu contextuel pour cr√©er un ¬´bitmap¬ª. <br><br><img src="https://habrastorage.org/webt/-y/52/4b/-y524b96wuzs9eszx5cybyrwsdk.jpeg"><br><br>  <b>Exp√©rience 3.</b> <br>  <b>Nous faisons:</b> <br><br>  A l'aide de l'Explorateur, ouvrez le dossier C: \ TEST et √† l'aide du menu contextuel "Cr√©er -&gt; Document au format RTF", appel√© par un clic droit, cr√©ez le fichier "Nouveau document au format RTF.rtf". <br><br>  <b>On observe:</b> <br><br>  Comme dans le cas de la cr√©ation du fichier via la ligne de commande, un √©v√©nement avec le code 4663 et le contenu correspondant est apparu dans le journal. <br><br><img src="https://habrastorage.org/webt/de/pf/wq/depfwqhwv1umoii77gpofddmoro.jpeg"><br><br><h3>  Quelle est l'essence du probl√®me? </h3><br>  Bien s√ªr, la cr√©ation de documents texte ou d'images n'est pas particuli√®rement nuisible.  Cependant, si l '"Explorateur" est capable de contourner la journalisation des op√©rations sur les fichiers, les logiciels malveillants pourront le faire. <br><br>  Ce probl√®me est peut-√™tre le plus important de tous, car il porte gravement atteinte √† la cr√©dibilit√© des r√©sultats de l'audit des op√©rations sur les fichiers. <br><br><h2>  Conclusion </h2><br>  La liste de probl√®mes ci-dessus n'est pas exhaustive.  Dans le processus, j'ai r√©ussi √† tomber sur un nombre encore assez important de diverses failles mineures, qui incluent l'utilisation de constantes localis√©es comme valeurs de param√®tres pour un certain nombre d'√©v√©nements, ce qui nous oblige √† √©crire nos scripts d'analyse pour chaque localisation du syst√®me d'exploitation, la division illogique des codes d'√©v√©nements en op√©rations qui ont une signification proche, par exemple, la suppression d'une cl√© de registre est une s√©quence d'√©v√©nements 4663 et 4660, et la suppression d'une valeur dans le registre est 4657, et aussi de petites choses ... <br><br>  En toute honn√™tet√©, nous notons que malgr√© toutes les lacunes, le syst√®me d'enregistrement des √©v√©nements de s√©curit√© dans Windows pr√©sente un grand nombre d'aspects positifs.  La r√©solution des probl√®mes critiques r√©pertori√©s ici pourrait remettre la couronne √† une meilleure solution pour la journalisation des √©v√©nements de s√©curit√© hors de la bo√Æte. <br><br>  FAITES DE PLUS EN PLUS LA CONNEXION DES √âV√âNEMENTS DE S√âCURIT√â WINDOWS! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476464/">https://habr.com/ru/post/fr476464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476450/index.html">Pr√©sentation de cPanel - une console Web pour la gestion des sites et l'h√©bergement</a></li>
<li><a href="../fr476452/index.html">Stockage de valeur-cl√© ou comment nos applications sont devenues plus pratiques</a></li>
<li><a href="../fr476454/index.html">La 5G arrive: quelles entreprises assureront l'introduction de nouvelles technologies en 2020</a></li>
<li><a href="../fr476456/index.html">Le syst√®me chinois de cr√©dit social n'est tout d'abord pas un syst√®me d'√©valuation des citoyens, mais une API massive</a></li>
<li><a href="../fr476460/index.html">Le premier format de fichier √† succ√®s sur Internet n'√©tait pas MP3, mais MIDI</a></li>
<li><a href="../fr476466/index.html">Le livre "Les architectes de l'intelligence"</a></li>
<li><a href="../fr476468/index.html">Nouveau cours gratuit d'analyse de texte en ligne sur le r√©seau neuronal de Samsung</a></li>
<li><a href="../fr476474/index.html">Nous renvoyons Keenetic au support KN-1310 du modem USB</a></li>
<li><a href="../fr476476/index.html">Afficher Gmail en html uniquement</a></li>
<li><a href="../fr476478/index.html">√âtapes de l'introduction de mod√®les d'apprentissage automatique dans les grandes entreprises</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>