<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóø üê∞ üõï Ein Ged√§chtnistest, bei dem Laptops get√∂tet werden, ist fast eine Detektivgeschichte üõÉ üëàüèª üö†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(UPD: Zus√§tzlich zu den Schemata wird ein Foto der Tafel hinzugef√ºgt.) 
 (UPD2: Informationen vom libreboot IRC-Kanal) 


- RINKAN hat einen Stromschu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ein Ged√§chtnistest, bei dem Laptops get√∂tet werden, ist fast eine Detektivgeschichte</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413469/"><p>  <strong>(UPD: Zus√§tzlich zu den Schemata wird ein Foto der Tafel hinzugef√ºgt.)</strong> <br>  <strong>(UPD2: Informationen vom libreboot IRC-Kanal)</strong> </p><br><ul><li>  RINKAN hat einen Stromschutz von 55mA, die Funktionalit√§t finden Sie in der Beschreibung auf TB62501F. </li><li>  PMH7 ist eine Reihe von Gates ("das gleiche wie FPGA, das gerade mit bis zu 3 Metallschichten programmiert wurde, ein bisschen wie Maskrom"), f√ºr Toshiba hie√ü es TC-200G </li><li>  PMH7 ist nicht nur √ºber den LPC-Bus mit dem EC, sondern auch mit dem ICH verbunden und sieht aus Sicht des Hosts als GPIO-Extender aus. </li><li>  Sie sind sicher, dass nicht verwendete PMH-Stifte wirklich in der Luft h√§ngen und ein Stiftverschluss wahrscheinlich nur PMH-Ausg√§nge verbrennt, nicht jedoch LDO </li><li>  Sie deuten auf das spontane Versagen von zwei RINKANs aus voneinander unabh√§ngigen Gr√ºnden hin (m√∂glicherweise durch die Erw√§rmung des Motherboards w√§hrend des Mems-Tests hervorgerufen). </li><li>  Sie empfehlen, RINKAN von ROHM auf denselben Chip zu √§ndern: BD4175KVT-BD4176KVT-BD41760KVT, kostet etwa 2 USD </li><li>  Wir sind uns einig, dass Sie ein Experiment durchf√ºhren m√ºssen, um memtest mit einer aktuellen Grenze auszuf√ºhren </li></ul><br><p>  K√ºrzlich hatten wir eine herzzerrei√üende Geschichte - zwei Lenovo T500-Laptops starben an einem Morgen.  Man w√§re gestorben - niemand begann zu verstehen.  Aber zwei an einem Morgen - das ist zu viel!  Dar√ºber hinaus arbeitete mindestens einer von ihnen (und dies wird von drei Benutzern best√§tigt!) Normal bis zur letzten Minute, wurde durch den Netzschalter ausgeschaltet, 100 Meter in den Gespr√§chsraum √ºbertragen und ... nicht eingeschaltet. </p><br><p>  Zun√§chst wurden nat√ºrlich alle handwerklichen Wiederbelebungsmethoden getestet: Batterie austauschen, Netzteil austauschen ... Batterie entfernen und Strom trennen, CMOS zur√ºcksetzen usw. Ergebnis?  Genau null - Laptops befanden sich weiterhin in einem Zustand der Ziegel. </p><br><p>  Sie begannen, das Bild der Ereignisse zu rekonstruieren, um zumindest einen Hinweis zu finden.  Es stellte sich Folgendes heraus: </p><a name="habracut"></a><br><ul><li>  Auf D-1 wurde beiden Laptops Speicher hinzugef√ºgt.  Nach dem Ersetzen der Speicherlatten wurden beide eingeschaltet und funktionierten bis zum Abend ordnungsgem√§√ü </li><li>  In der Nacht des D-Day wurde memtest auf beiden Computern gestartet (genauer gesagt memtest86 + 5.01-3 aus der Debian-Distribution). </li><li>  Am Morgen des Tages "D" wurden beide Computer √ºber den Netzschalter ausgeschaltet und nicht eingeschaltet </li><li>  Au√üerdem wurden sie kurz √ºber den VGA-Anschluss an denselben Projektor und an dasselbe Netzteil im Raum angeschlossen </li></ul><br><p>  Offensichtlich sollte der Tod von Laptops mit einem von drei Dingen zusammenh√§ngen: einem Netzteil, einem Projektor oder einem Memtest.  Aber womit genau? </p><br><p>  Zuerst haben wir den Projektor √ºberpr√ºft.  Sie fanden das Verbrechen nicht, fanden aber auch heraus, dass an diesem Tag (aber sp√§ter) andere Laptops damit verbunden waren, die lebendig und gesund blieben.  Zweitens haben wir das Netzteil √ºberpr√ºft - es schien die Spannung zu untersch√§tzen und es wurde unter Quarant√§ne gestellt. </p><br><p>  Die Laptops wurden an den Dienst √ºbergeben, der sie mit folgendem Ergebnis zur√ºckgab: "Ausfall des Motherboards, Ersatzteile fehlen!".  Ich musste den Kadaver selbst √∂ffnen (der Vorteil im Netzwerk liegt sowohl in den Schemata als auch in den Servicehandb√ºchern f√ºr die alte Thinkpad-Serie). </p><br><p>  Zu diesem Zeitpunkt begannen alle (ausnahmsweise), den Tod von memtest-Laptops zu vermuten.  Aber es war v√∂llig nicht offensichtlich - wie genau?  Am Ende bestand die M√∂glichkeit, dass der Tod von Laptops ein seltener, unangenehmer, aber dennoch zuf√§lliger Zufall ist.  Aber nein!  Oder ja ... Im Allgemeinen wissen wir es noch nicht genau. </p><br><p>  Hier sollten Sie einen Exkurs zum Aufbau eines Energieverwaltungssystems auf Buche IBM / Lenovo (zumindest der √§lteren Serie) machen.  Bei einfacheren Ger√§ten erfolgt die Energieverwaltung entweder √ºber den Prozessor / Chipsatz oder √ºber einen speziellen Motherboard-Controller (System-Controller, auch bekannt als Embedded-Controller).  Relativ gesehen ist dieses Ding f√ºr die Reflex- und Wirbels√§ulenfunktionen des Laptops verantwortlich: Umschalten der Stromquellen, Batterieleistung, Batterieidentifikation / Lieferantenbindung und dergleichen.  Aber nicht bei IBM / Lenovo! </p><br><p>  Anscheinend dachten IBM-Ingenieure, dass die EC-Firmware Fehler enthalten k√∂nnte oder der Controller selbst pl√∂tzlich einfrieren w√ºrde.  Nat√ºrlich hat die EG einen eigenen Wachhund, aber es ist auch kein Allheilmittel.  Daher liegt die Verantwortung der EG nur darin, Leistungssteuersignale auf hoher Ebene zu erzeugen.  Ein- / Aus-Schl√ºssel entriegeln und verriegeln zwei spezialisierte Mikrokreise (und zwar nicht gedankenlos, sondern durch Vergleichen der W√ºnsche der EC mit den Messwerten von Temperatursensoren, dem Vorhandensein der f√ºr den n√§chsten Schritt an den Reifen erforderlichen Spannung usw.).  Diese Chips sind: RINKAN (Entschl√ºsselung unbekannt) und PMH_7 (Power Management Hub rev7) </p><br><div class="spoiler">  <b class="spoiler_title">RINKAN im Innenraum</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/nu/bg/ox/nubgoxpbrihy0iguhtguefcnu44.png" alt="Bild"></p></div></div><br><p>  Bitte beachten Sie, dass RINKAN keine Ausg√§nge zu den CPU-Bussen hat - im Prinzip ist dies f√ºr den Prozessor nicht erreichbar.  Eine der wichtigen (und nicht offensichtlichen) Funktionen von RINKAN ist die Erzeugung einer stabilen 3,3-V-Spannung am VCC3SW-Bus (nennen wir es den Startbus).  Da sich keine Drosseln in der N√§he befinden, kann davon ausgegangen werden, dass dieser Regler in einem einfachen linearen Schema aufgebaut ist.  Das hei√üt, irgendwo drinnen sitzt ein Transistor mit einer Umreifung und mit seinem aktiven Widerstand speist er Strom und hinterl√§sst nur 3,3 V.  Dieser Regler wird vom VREGIN20-Bein gespeist, an das alle Stromquellen des Laptops (Dockingstation, Netzteil, Hauptakku und Ultrabay-Akku) √ºber Dioden angeschlossen sind.  Das hei√üt, es funktioniert im Allgemeinen immer (daher stromsparend - Sie ben√∂tigen einen sehr kleinen Strom f√ºr Ihren eigenen Verbrauch!) </p><br><div class="spoiler">  <b class="spoiler_title">PMH_7 in der Arbeitsumgebung</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ne/rz/03/nerz03znxcvwq7q6fvmhm7ig5qm.png" alt="Bild"></p></div></div><br><p>  PMH ist ein intelligenterer Chip.  Zumindest hat sie √ºber den SPI-Bus eine Verbindung zur EC.  Dar√ºber hinaus werden eine ganze Reihe von Spannungen und Taktsignalen auf dem Laptop-Motherboard ein- oder ausgeschaltet.  Beide Chips sind Sonderanfertigungen ohne Datenblatt.  Da Lenovo / IBM dieselben benutzerdefinierten Chips f√ºr verschiedene Produktlinien verwendet, werden einige der PMH-Beine im T500 nicht verwendet.  Es war jedoch unwahrscheinlich, dass sie in der Luft h√§ngen blieben.  Typische Empfehlungen empfehlen, nicht verwendete Kabel entweder zum Stromkreis oder zur Erde zu ziehen.  Denken Sie daran. </p><br><p>  Trotz fehlender Dokumentation hat das Coreboot-Projektteam (Vergleich der Notebook-Schaltkreise der T60-, T40- und √§lteren Laptop-Serien - bei denen die RINKAN / PMH-Funktionen noch auf die Mikroschaltungen mit geringerem Integrationsgrad aufgeteilt waren) etwas Interessantes angesammelt.  PMH ist im Adressraum der CPU verf√ºgbar. <del>  Nat√ºrlich nicht direkt, sondern √ºber die EU - aber immer noch verf√ºgbar! </del>  <strong>UPD: √ºber den LPC-Bus mit ICH verbunden (niedrige Pinanzahl - analog zu ISA).</strong>  Zum Anheben oder Absenken des PMH-Beins verwenden sie die folgende Abfolge von Operationen ( <a href="">pmh7.c</a> ): </p><br><pre><code class="cpp hljs">outb(reg, EC_LENOVO_PMH7_ADDR); val = inb(EC_LENOVO_PMH7_DATA); outb(reg, EC_LENOVO_PMH7_ADDR); outb(val | (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; bit), EC_LENOVO_PMH7_DATA);</code> </pre> <br><p>  Das hei√üt, wir schreiben zuerst den PMH-Registercode in das EC-Register (dem CPU-Adressraum zugeordnet) und k√∂nnen dann dessen Inhalt lesen oder schreiben.  Zum Beispiel wollen wir die Hintergrundbeleuchtung einschalten (55 PMH Fu√ü): Wir schreiben in Register 0x55 Bit 2 - alles ist einfach. </p><br><p>  <strong>UPD: Kollegen aus dem Libreboot-Projekt halten das beschriebene Kurzschlussszenario durch PMH au√üerdem f√ºr unwahrscheinlich - der aktuelle Schutz in RINKAN h√§tte bei 55 mA funktionieren sollen</strong> </p><br><p>  Leider macht memtest ungef√§hr dasselbe - es liest und schreibt verschiedene Werte in verschiedene Speicherbereiche.  Theoretisch sollte das BIOS die f√ºr E / A-Ger√§te reservierten Speicherbereiche beschreiben.  Und memtest sollte dort nichts aufschreiben - aber ... aufschreiben!  Und anscheinend hob oder senkte er irgendwann sein erfolgloses PMH-Bein.  Dementsprechend wurde durch den Ausgangsfu√ütransistor PMH der Leistungsbus VCC3SW gegen Masse kurzgeschlossen ... </p><br><p>  Was ist als n√§chstes passiert?  Dann begann sich RINKAN zu aalen.  Da der Strom zunahm, zog ihn der PMH im Schl√ºsselmodus problemlos und der halboffene Transistor im LDO RINKAN wurde schlechter.  √Ñu√üerlich zeigte sich dies jedoch in keiner Weise: In einem eingeschalteten Laptop isst niemand von einer stromsparenden 3,3-V-Quelle, und die Stromversorgung erfolgt √ºber einen besonders leistungsstarken Gleichstrom / Gleichstrom, der die Hauptbusse mit 3,3 bzw. 5 Volt versorgt. </p><br><p>  Nun, als der Netzschalter gedr√ºckt wurde, waren die Hauptbusse stromlos.  Der 3,3-V-Startbus war nicht mehr mit Strom versorgt!  Und aus dem Laptop wurde <del>  K√ºrbis </del>  Ziegel. </p><br><p>  <strong>UPD: Alternative Theorie (omz + libreboot)</strong> </p><br><p>  In Service-Centern ist die RINKAN-Crashtendenz bekannt.  Kollegen von Libreboot argumentieren weiter, dass dies insbesondere f√ºr Toshiba-Controller gilt (und ROHM wird besser sein).  Dementsprechend war memtest den ganzen Weg unschuldig und es kam fast gleichzeitig zum Ausfall von zwei Laptops: </p><br><ul><li><p>  Oder aus voneinander unabh√§ngigen Gr√ºnden (m√∂glicherweise durch das Erhitzen des Motherboards unter einem langen Memtest provoziert) </p><br></li><li>  Oder eine Fehlfunktion (Rauschen) in der Leistungsabgabe des Adapters, an die (wenn auch nur f√ºr kurze Zeit) beide Laptops angeschlossen waren. </li></ul><br><p>  Diagnoseergebnisse: </p><br><p>  Der erste Laptop ist eine COR5SOPV3-Dual-Grafikkarte.  Auf dem VCC3SW-Bus statt 3,3 nur 1,2 Volt.  Der Erdungswiderstand betr√§gt ca. 400 Ohm.  Den Ausgang des RINKAN-Spannungswandlers vorsichtig verl√∂tet und angehoben.  Der Buswiderstand stieg sofort auf Hunderte von Kilo-Ohm.  Sie legten 3,3 V von einer externen Quelle an - die Buche wurde lebendig. </p><br><div class="spoiler">  <b class="spoiler_title">Board in Reparatur</b> <div class="spoiler_text"><p>  Der Chip mit einem wei√üen Aufkleber ist ein eingebetteter Controller, in der Mitte mit Dr√§hten - RINKAN, der letzte ohne Aufkleber - PMH. </p><br><p><img src="https://habrastorage.org/webt/1e/pl/j8/1eplj83_3g7qj5diwndcnm4hawq.jpeg" alt="Bild"></p></div></div><br><p>  Aus diesem Grund haben wir ein externes LDO mit geringem Stromverbrauch (LP2930-3.3) ausgew√§hlt, das anstelle von RINKAN den Startbus speist.  Den Testergebnissen zufolge wurde festgestellt, dass der verschobene klinische Tod einen Eindruck auf die Art des Ger√§ts hinterlassen hat - der Laptop l√§sst sich nicht einschalten, wenn der Akku eingelegt ist, der Adapter jedoch nicht eingelegt ist.  Wenn Sie es einschalten m√∂chten - entfernen Sie den Akku, schalten Sie das Netzteil ein und danach kann der Akku wieder eingelegt werden.  Alle anderen Funktionen (Aufladen, Akkulaufzeit, Ruhezustand usw.) sind kein Problem und nur so k√∂nnen Sie sie einschalten.  Sie haben sich nicht darum gek√ºmmert - sie haben die Frage administrativ entschieden: Verwenden Sie Sleep oder Neustart, anstatt herunterzufahren.  Der erste Betroffene hatte Gl√ºck! </p><br><p>  Und die zweite - nein ... Es gibt eine C5ISOVP-Karte mit integrierter Grafik - es liegt √ºberhaupt keine Spannung am Bus an und der Widerstand gegen Erde betr√§gt mehrere zehn Ohm.  Nach dem Abrei√üen des Beines wurde der VCC3SW nicht besser - der gleiche niedrige Widerstand laut VREGIN20.  Sie rissen es auch ab, schalteten die externe Stromversorgung des Startbusses ein - sie sahen 3,3 und 5 Volt am Hauptbus.  Trotz des ermutigenden Starts wurden am PMH / RINKAN-Ausgang keine Power-Good-Signale angezeigt, und das System konnte nicht gestartet werden.  Anscheinend ist die interne Logik der Mikroschaltungen besch√§digt, und dies wird nicht behandelt ... </p><br><p><del>  Es ist sehr wahrscheinlich, dass memtest Laptops auf diese Weise von der T6x-Serie bis einschlie√ülich der T420 / 520-Serie t√∂ten kann.  Ab T430 / 530 wurde die Art der Kommunikation mit der EU ge√§ndert, und das Schreiben in die PMH-Register ist grunds√§tzlich nicht m√∂glich.  M√∂glicherweise sind nur bestimmte BIOS- oder EC-Firmware-Versionen betroffen.  Ein Fehlerbericht wurde an Debian-Paket-Betreuer geschrieben, vielleicht k√∂nnen sie etwas mit Upstream finden ... </del></p><br><p>  Der genaue Grund f√ºr den Ausfall der beiden Laptops nach dem Start von memtest ist nicht bekannt.  Ein Experiment, mit dem festgestellt werden kann, ob memtest einen Stromverbrauch au√üerhalb des Entwurfs vom Startleistungsbus verursacht, ist geplant, das Datum wurde jedoch noch nicht festgelegt.  Wir werden zus√§tzlich √ºber die Ergebnisse berichten. </p><br><p>  Wenn Sie memtest auf Laptops der Lenovo T6x-Serie bis einschlie√ülich T420 / 520 starten, sollten Sie die potenziellen Risiken und Vorteile dieses Ereignisses ber√ºcksichtigen.  Falls Sie den Test ausgef√ºhrt haben und der Laptop nicht zugemauert wurde oder aufgeh√§ngt wurde, schreiben Sie bitte einen Kommentar in den Kommentar, der das Laptop-Modell und die Testlaufzeit angibt. </p><br><p>  Das ist alles - viel Gl√ºck! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413469/">https://habr.com/ru/post/de413469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413459/index.html">Das Talent eines IT-Personalvermittlers - wie unterscheiden sich Entwickler von Handwerkern?</a></li>
<li><a href="../de413461/index.html">ReactOS wurde im Jahr seines 21. Jubil√§ums autark</a></li>
<li><a href="../de413463/index.html">Magento 2 REST API am Beispiel eines einfachen Moduls</a></li>
<li><a href="../de413465/index.html">AMD k√ºndigt 32-Core Threadripper 2 an</a></li>
<li><a href="../de413467/index.html">Schnelle und zuverl√§ssige Datensicherung in der Cloud</a></li>
<li><a href="../de413471/index.html">Freitag Mini Tomy Fancy Toy Retrospektive</a></li>
<li><a href="../de413473/index.html">Entwicklung eines Touch-Z-Wave-Schalters am Akku mit Leuchttasten</a></li>
<li><a href="../de413479/index.html">Wir schreiben unser Protokoll √ºber UDP</a></li>
<li><a href="../de413481/index.html">Exportieren Sie den Testbaum von JMeter in Text</a></li>
<li><a href="../de413485/index.html">GitLab 10.8 ver√∂ffentlicht: Open-Source-Push-Spiegelung und inkrementelle Bereitstellung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>