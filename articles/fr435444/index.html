<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì† üõ¢Ô∏è üíÖüèª Nous impl√©mentons OSGI sur la plateforme Karaf ü§° üêÑ üë©üèø‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OSGI n'est pas difficile 
 J'ai rencontr√© √† plusieurs reprises que l'OSGI est difficile. Et d'ailleurs, lui-m√™me avait une fois une telle opinion. Ann...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous impl√©mentons OSGI sur la plateforme Karaf</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435444/"><h2>  OSGI n'est pas difficile </h2><br>  J'ai rencontr√© √† plusieurs reprises que l'OSGI est difficile.  Et d'ailleurs, lui-m√™me avait une fois une telle opinion.  Ann√©e en 2009, pour √™tre exact.  √Ä cette √©poque, nous avons collect√© des projets √† l'aide de Maven Tycho et les avons d√©ploy√©s sur Equinox.  Et c'√©tait vraiment plus difficile que de d√©velopper et d'assembler des projets pour JavaEE (√† ce moment, la version d'EJB 3 vient d'appara√Ætre, vers laquelle nous sommes pass√©s).  Equinox √©tait beaucoup moins pratique que Weblogic, par exemple, et les avantages d'OSGI n'√©taient pas alors √©vidents pour moi. <br><br>  Mais ensuite, apr√®s de nombreuses ann√©es, j'ai d√ª d√©marrer un projet dans un nouvel emploi, qui a √©t√© con√ßu sur la base d'Apache Camel et Apache Karaf.  Ce n'√©tait pas mon id√©e, je connaissais Camel depuis longtemps et j'ai d√©cid√© de lire sur Karaf, m√™me sans offre.  Je l'ai lu un soir et j'ai r√©alis√© - la voici, simple et pr√™te √† l'emploi, presque la m√™me solution √† certains probl√®mes d'un JavaEE typique, similaire √† ce que j'ai fait une fois √† genoux en utilisant Weblogic WLST, Jython et Maven Aether. <br><br>  Supposons donc que vous d√©cidiez d'essayer OSGI sur la plate-forme Karaf.  Par o√π commencer? <br><a name="habracut"></a><br><h3>  Si vous voulez une compr√©hension plus profonde </h3><br>  Vous pouvez bien s√ªr commencer par lire la documentation.  Et c'est possible avec Habr√© - il y avait de tr√®s bons articles ici, disons il y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">si</a> longtemps.  Mais en g√©n√©ral, le karaf a re√ßu jusqu'√† pr√©sent, sans le m√©riter, peu d'attention.  Il y avait quelques autres commentaires <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ceci</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cela</a> .  Il vaut mieux ignorer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette</a> mention de karaf.  Comme on dit, ne lisez pas les journaux sovi√©tiques pour la nuit ... car ils vous diront que le karaf est un cadre OSGI - donc vous n'y croyez pas.  Les frameworks OSGI sont Apache Felix ou Eclipse Equinox, sur la base desquels karaf fonctionne.  Vous pouvez choisir n'importe lequel d'entre eux. <br><br>  Il convient de noter que lorsque Jboss Fuse ou Apache ServiceMix est mentionn√©, il doit √™tre lu comme ¬´Karaf, avec des composants pr√©install√©s¬ª, c'est-√†-dire  en fait - la m√™me chose, collect√©e uniquement par le vendeur.  Je ne recommanderais pas de commencer par cela dans la pratique, mais il est tout √† fait possible de lire des articles de revue sur ServiceMix, par exemple. <br><br>  Pour commencer, je vais essayer de d√©terminer ici tr√®s bri√®vement ce qu'est l'OSGI et √† quoi il peut servir. <br><br>  Dans l'ensemble, OSGI est un outil pour cr√©er des applications Java √† partir de modules.  Un analogue proche peut √™tre consid√©r√©, par exemple, JavaEE, et dans une certaine mesure, les conteneurs OSGI peuvent ex√©cuter des modules JavaEE (par exemple, des applications Web sous la forme de War), et d'autre part, de nombreux conteneurs JavaEE contiennent OSGI √† l'int√©rieur comme moyen de mettre en ≈ìuvre la modularit√© "pour eux-m√™mes" ".  Autrement dit, JavaEE et OSGI sont des choses similaires √† la compatibilit√© et compl√©mentaires avec succ√®s. <br><br>  Une partie importante de tout syst√®me modulaire est la d√©finition du module lui-m√™me.  Dans le cas d'OSGI, le module est appel√© un bundle, et c'est une archive jar bien connue de tous les d√©veloppeurs avec quelques ajouts (c'est-√†-dire qu'elle est tr√®s similaire ici, par exemple, √† war ou ear).  Par analogie avec JavaEE, les bundles peuvent exporter et importer des services, qui sont essentiellement des m√©thodes de classe (c'est-√†-dire qu'un service est une interface ou toutes les m√©thodes publiques d'une classe). <br><br>  Les m√©tadonn√©es du bundle sont famili√®res √† tout le monde META-INF / MANIFEST.MF.  Les en-t√™tes du manifeste OSGI ne se croisent pas avec les en-t√™tes pour le JRE, respectivement, en dehors du bundle de conteneur OSGI est un bocal ordinaire.  Il est significatif que parmi les m√©tadonn√©es, il y ait toujours: <br><br><pre><code class="plaintext hljs">Bundle-SymbolicName: com.example.myosgi Bundle-Version: 1.0.0</code> </pre> <br>  Ce sont les ¬´coordonn√©es¬ª du bundle, et le fait que nous pouvons avoir deux ou plusieurs versions simultan√©ment install√©es et fonctionnelles du m√™me bundle dans un conteneur est important. <br><br>  Comme pour JavaEE, les bundles ont un cycle de vie qui ressemble √† ceci: <img src="https://habrastorage.org/getpro/habr/post_images/b71/a55/263/b71a5526390ea0fd4eaf02a3d5edc67a.png" alt="image">  En plus des services, les bundles peuvent √©galement importer et exporter des packages (packages, au sens habituel du terme pour java).  Les packages export√©s sont d√©finis √† l'int√©rieur du bundle et sont mis √† la disposition des autres composants lorsque le bundle est install√© sur le syst√®me.  Ceux import√©s sont d√©finis quelque part de l'ext√©rieur, doivent √™tre export√©s par quelqu'un et fournis au bundle par le conteneur avant qu'il puisse commencer √† fonctionner. <br><br>  Les importations de packages peuvent √™tre d√©clar√©es facultatives, ainsi que les importations de services.  Et il est assez important que l'importation et l'exportation contiennent une indication de la version (ou de la plage de versions). <br><br><h4>  Diff√©rences avec JavaEE </h4><br>  Eh bien, c'est bien qu'ils se ressemblent - nous avons compris.  Et en quoi diff√®rent-ils? <br><br>  √Ä mon avis, la principale diff√©rence est que l'OSGI nous donne beaucoup plus de flexibilit√©.  Une fois que le bundle est √† l'√©tat D√âMARR√â, les possibilit√©s ne sont limit√©es que par votre imagination.  Disons que vous pouvez facilement cr√©er des threads (oui, oui, je connais ManagedExecutorService), des pools de connexions aux bases de donn√©es, etc.  Un conteneur ne prend pas le contr√¥le de toutes les ressources dans la m√™me mesure que JavaEE. <br><br>  Vous pouvez exporter de nouveaux services dans le processus.  Essayez de dire en JavaEE cr√©er dynamiquement un nouveau servlet?  Et ici, il est tout √† fait possible, en outre, que le conteneur de servlet karaf cr√©√© sur la base de jetty soit imm√©diatement d√©tect√© par votre servlet cr√©√© et qu'il soit disponible pour les clients √† une URL sp√©cifique. <br><br>  Bien que ce soit une l√©g√®re simplification, mais si l'application JavaEE dans sa forme classique se compose principalement de composants: <br><br><ul><li>  passif, en attente d'un appel du client </li><li>  d√©finis statiquement, c'est-√†-dire au moment du d√©ploiement de l'application. </li></ul><br>  En revanche, une application bas√©e sur OSGI peut contenir: <br><br><ul><li>  composants programm√©s actifs et passifs, ex√©cution de sondages, enfin, √©coute d'une socket, etc. </li><li>  les services peuvent √™tre d√©finis et publi√©s dynamiquement </li><li>  Vous pouvez vous abonner √† des √©v√©nements de cadre, par exemple, √©couter l'enregistrement des services, des bundles, etc., recevoir des liens vers d'autres bundles et services, et faire bien plus encore. </li></ul><br>  Oui, sur JavaEE, une grande partie de cela est √©galement partiellement possible (par exemple, via JNDI), mais dans le cas d'OSGI, dans la pratique, cela est rendu plus facile.  Bien qu'il y ait probablement quelques risques suppl√©mentaires ici. <br><br><h4>  Diff√©rences entre karaf et OSGI pur </h4><br>  En plus du framework karaf, il y a beaucoup de choses utiles.  Essentiellement, karaf est un outil pour g√©rer facilement le cadre OSGI - y installer des bundles (y compris des groupes), les configurer, surveiller, d√©crire le mod√®le de r√¥le et assurer la s√©curit√©, etc. <br><br><h2>  Et pratiquons d√©j√†? </h2><br>  Eh bien, commen√ßons tout de suite avec l'installation.  Il n'y a pas grand-chose √† √©crire ici - allez sur karaf.apache.org, t√©l√©chargez le package de distribution, d√©compressez-le.  Les versions de karaf diff√®rent dans la prise en charge des diff√©rentes sp√©cifications OSGI (4, 5 ou 6) et des versions Java.  Je ne recommande pas la famille 2.x, mais 3 (si vous avez Java 8, comme le mien) et 4 peuvent √™tre utilis√©s, bien qu'aujourd'hui seule la famille 4.x se d√©veloppe (version actuelle 4.2.2, elle prend en charge OSGI 6 et Java jusqu'√† 10). <br><br>  Karaf fonctionne bien sous Windows et Linux, tout ce dont vous avez besoin pour cr√©er un service et l'ex√©cution automatique est disponible.  La prise en charge de MacOS et de nombreux autres types d'Unix est √©galement d√©clar√©e. <br><br>  Vous pouvez g√©n√©ralement d√©marrer karaf imm√©diatement si vous √™tes sur Internet.  Sinon, cela vaut g√©n√©ralement la peine de corriger le fichier de configuration, en indiquant o√π vous avez le ou les r√©f√©rentiels maven.  Habituellement, ce sera un Nexus d'entreprise, ou disons Artifactory, qui aime quoi.  La configuration karaf se trouve dans le dossier etc de la distribution.  Les noms des fichiers de configuration ne sont pas tr√®s √©vidents, mais dans ce cas, vous avez besoin du fichier org.ops4j.pax.url.mvn.cfg.  Le format de ce fichier est les propri√©t√©s java. <br><br>  Vous pouvez sp√©cifier le (s) r√©f√©rentiel (s) √† la fois dans le fichier de configuration lui-m√™me, en r√©pertoriant la liste des URL dans les param√®tres ou simplement en montrant o√π se trouve votre fichier settings.xml.  L√†, le karaf prendra l'emplacement de votre proxy, ce qui est g√©n√©ralement n√©cessaire de conna√Ætre sur l'intranet. <br><br>  Kafar a besoin de plusieurs ports, ce sont HTTP, HTTPS (si le web est configur√©, par d√©faut non), SSH, RMI, JMX.  S'ils sont occup√©s avec vous ou si vous souhaitez ex√©cuter plusieurs copies sur le m√™me h√¥te, vous devrez √©galement les modifier.  Il y a environ cinq de ces ports. <br><br>  Ports tels que jmx et rmi - ici: org.apache.karaf.management.cfg, ssh - org.apache.karaf.shell.cfg, pour changer les ports http / https, vous devrez cr√©er (tr√®s probablement pas) le fichier etc / org.ops4j.pax.web.cfg et √©crivez la valeur org.osgi.service.http.port = port dont vous avez besoin. <br><br>  Ensuite, vous pouvez certainement le d√©marrer, et en r√®gle g√©n√©rale, tout commencera.  Pour une utilisation industrielle, vous devrez √©videmment apporter des modifications au fichier bin / setenv ou bin / setenv.bat, par exemple, pour allouer la quantit√© de m√©moire requise, mais d'abord, pour voir, ce n'est pas n√©cessaire. <br><br>  Vous pouvez d√©marrer Karaf imm√©diatement avec la console, la commande karaf, ou vous pouvez l'ex√©cuter en arri√®re-plan avec la commande start server, puis vous y connecter via SSH.  Il s'agit d'un SSH enti√®rement standard, avec prise en charge de SCP et SFTP.  Vous pouvez ex√©cuter des commandes et copier des fichiers dans les deux sens.  Il est possible de se connecter avec n'importe quel client, par exemple, mon outil pr√©f√©r√© est Far NetBox.  La connexion est disponible par identifiant et mot de passe, ainsi que par cl√©s.  Dans les abats jsch, avec tout ce que cela implique. <br><br>  Je recommande d'avoir une fen√™tre de console suppl√©mentaire imm√©diatement pour afficher les journaux qui se trouvent dans data / log / karaf.log (et d'autres fichiers sont g√©n√©ralement l√†, bien que cela soit personnalisable).  Les journaux vous sont utiles, √† partir de messages courts dans la console, tout n'est pas clair. <br><br>  Je conseillerais d'installer imm√©diatement le Web et la console Web hawtio.  Ces deux choses vous permettront de naviguer plus facilement dans ce qui se passe dans le conteneur et de diriger le processus √† partir de l√† dans une large mesure (en bonus, vous obtiendrez du jolokia et la possibilit√© de surveiller via http).  L'installation de hawtio se fait par deux commandes depuis la console karaf ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme d√©crit ici</a> ), et h√©las, aujourd'hui la version de karaf 3.x n'est plus support√©e (vous devrez chercher des versions plus anciennes de hawtio). <br><br>  Hors de la bo√Æte, https ne sera pas imm√©diatement, pour cela, vous devez faire des efforts tels que la g√©n√©ration de certificats, etc. L'impl√©mentation est bas√©e sur Jetty, donc tous ces efforts sont principalement effectu√©s de la m√™me mani√®re. <br><br><h2>  OK, √ßa a commenc√©, quelle est la prochaine √©tape? </h2><br><img src="https://habrastorage.org/webt/lh/ty/ge/lhtygefalzjfywb-3lr088qvrha.png"><br><br>  En fait, √† quoi vous attendiez-vous?  J'ai dit que ce sera ssh.  Tab fonctionne, si cela. <br><br>  Il est temps d'installer une application.  Une application pour OSGI est soit un bundle, soit se compose de plusieurs bundles.  Karaf peut d√©ployer des applications dans plusieurs formats: <br><br><ul><li>  Un ensemble de pots, avec ou sans manifeste OSGI </li><li>  xml contenant Spring DM ou Blueprint </li><li>  xml contenant la soi-disant fonctionnalit√©, qui est une collection de bundles, d'autres fonctionnalit√©s et de ressources (fichiers de configuration) </li><li>  Archive .kar contenant plusieurs fonctionnalit√©s et un r√©f√©rentiel maven avec des d√©pendances </li><li>  Applications JavaEE (sous certaines conditions suppl√©mentaires), par exemple .war </li></ul><br>  Il existe plusieurs fa√ßons de proc√©der: <br><br><ul><li>  mettre l'application dans le dossier de d√©ploiement </li><li>  installez √† partir de la console avec la commande install </li><li>  installer la fonctionnalit√© avec la commande de la fonctionnalit√©: installer la console </li><li>  kar: installer </li></ul><br>  Eh bien, en g√©n√©ral, c'est assez similaire √† ce qu'un conteneur JavaEE typique peut faire, mais c'est un peu plus pratique (je dirais que c'est beaucoup plus pratique). <br><br><h3>  Pot simple </h3><br>  L'option la plus simple consiste √† installer un bocal ordinaire.  Si vous l'avez dans le r√©f√©rentiel maven, alors la commande suffit pour installer: <br><br><pre> <code class="bash hljs">install mvn:groupId/artifactId/version</code> </pre> <br>  Dans le m√™me temps, Karaf se rend compte qu'il a un pot r√©gulier devant lui et le traite, cr√©ant un emballage de paquet √† la vol√©e, le soi-disant  wrapper, g√©n√©rant un manifeste par d√©faut, avec les importations et les exportations de packages. <br><br>  Le sentiment d'installer juste un bocal n'est g√©n√©ralement pas beaucoup, car ce bundle sera passif - il exporte uniquement les classes qui seront disponibles pour d'autres bundles. <br><br>  Cette m√©thode est utilis√©e pour installer des composants comme Apache Commons Lang, par exemple: <br><br><pre> <code class="bash hljs">install mvn:org.apache.commons.lang3/commons-lang/3.8.1</code> </pre> <br>  Mais cela n'a pas fonctionn√© :) Voici les coordonn√©es correctes: <br><br><pre> <code class="bash hljs">install mvn:org.apache.commons/commons-lang3/3.8.1</code> </pre> <br>  Voyons ce qui s'est pass√©: list -u nous montrera les bundles et leurs sources: <br><br><pre> <code class="bash hljs">karaf@root()&gt; list -u START LEVEL 100 , List Threshold: 50 ID | State | Lvl | Version | Name | Update location ------------------------------------------------------------------------------------------------- 87 | Installed | 80 | 3.8.1 | Apache Commons Lang | mvn:org.apache.commons/commons-lang3/3.8.1 88 | Installed | 80 | 3.6.0 | Apache Commons Lang | mvn:org.apache.commons/commons-lang3/3.6</code> </pre> <br>  Comme vous pouvez le voir, il est tout √† fait possible d'installer deux versions d'un composant.  Emplacement de mise √† jour - c'est l√† que nous avons obtenu le bundle et o√π il peut √™tre mis √† jour si n√©cessaire. <br><br><h3>  Contexte Jar et Spring </h3><br>  S'il y a un contexte printanier √† l'int√©rieur de votre pot, les choses deviennent plus int√©ressantes.  Karaf Deployer recherche automatiquement les contextes xml dans le dossier META-INF / spring et les cr√©e si tous les bundles externes n√©cessaires au bundle ont √©t√© trouv√©s avec succ√®s. <br><br>  Ainsi, tous les services qui √©taient √† l'int√©rieur des contextes d√©marreront d√©j√†.  Si vous aviez Camel Spring l√†-bas, par exemple, les itin√©raires Camel commenceront √©galement.  Cela signifie que nous disons un service REST, ou un service d'√©coute sur un port TCP, vous pouvez d√©j√† d√©marrer.  Bien s√ªr, lancer plusieurs services en √©coutant sur un port ne fonctionnera pas de cette fa√ßon. <br><br><h3>  Contexte XML Just Spring </h3><br>  Si, par exemple, vous disposiez de d√©finitions JDBC DataSources dans Spring Context, vous pouvez les installer s√©par√©ment dans Karaf.  C'est-√†-dire  prendre un fichier xml contenant uniquement un DataSource sous la forme de &lt;bean&gt;, ou tout autre ensemble de composants, vous pouvez le placer dans le dossier de d√©ploiement.  Le contexte sera lanc√© de mani√®re standard.  Le seul probl√®me est que les DataSources cr√©√©es de cette mani√®re ne seront pas visibles par les autres bundles.  Ils doivent √™tre export√©s vers OSGI en tant que services.  √Ä ce sujet - un peu plus tard. <br><br><h3>  Printemps dm </h3><br>  Quelle est la diff√©rence entre Spring DM (version compatible OSGI) et Spring classique?  Ainsi, dans le cas classique, tous les beans du contexte sont cr√©√©s au stade de l'initialisation du contexte.  Les nouveaux ne peuvent pas appara√Ætre, les anciens n'iront nulle part.  Dans le cas d'OSGI, de nouveaux bundles peuvent √™tre install√©s et les anciens bundles supprim√©s.  L'environnement devient plus dynamique, vous devez en quelque sorte r√©agir. <br><br>  La m√©thode de r√©ponse est appel√©e services.  Un service est g√©n√©ralement une certaine interface, avec ses propres m√©thodes, qui est publi√©e par un ensemble.  Un service a des m√©tadonn√©es qui lui permettent d'√™tre recherch√© et distingu√© d'un autre service qui impl√©mente une interface similaire (√©videmment, √† partir d'une autre DataSource).  Les m√©tadonn√©es sont un simple ensemble de propri√©t√©s de valeur-cl√©. <br><br>  √âtant donn√© que les services peuvent appara√Ætre et dispara√Ætre, ceux qui en ont besoin peuvent souscrire √† des services au d√©marrage ou √©couter des √©v√©nements pour conna√Ætre leur apparition ou leur disparition.  Au niveau de Spring DM, en XML, cela est impl√©ment√© en deux √©l√©ments, service et r√©f√©rence, dont le but de base est assez simple: publier le bean existant √† partir du contexte en tant que service, et s'abonner √† un service externe en le publiant dans le contexte Spring actuel. <br><br>  Par cons√©quent, lors de l'initialisation d'un tel bundle, le conteneur trouvera les services externes dont il a besoin pour lui et publiera les bundles impl√©ment√©s √† l'int√©rieur, les rendant accessibles de l'ext√©rieur.  Un bundle ne d√©marre qu'apr√®s la r√©solution des liens de service. <br><br>  En fait, tout est un peu plus compliqu√©, car le bundle peut utiliser une liste de services similaires et s'abonner imm√©diatement √† la liste.  C'est-√†-dire  un service, en g√©n√©ral, a une propri√©t√© telle que la cardinalit√©, qui prend la valeur 0..N.  Dans ce cas, l'abonnement, o√π 0..1 est indiqu√©, d√©crit un service facultatif, et dans ce cas, le bundle d√©marre correctement m√™me s'il n'y a pas un tel service dans le syst√®me (et au lieu d'un lien vers celui-ci, il obtiendra un talon). <br><br>  Je note qu'un service est n'importe quelle interface (ou vous pouvez publier uniquement des classes), vous pouvez donc bien publier java.util.Map avec des donn√©es en tant que service. <br><br>  Entre autres choses, le service vous permet de sp√©cifier des m√©tadonn√©es et la r√©f√©rence vous permet de rechercher un service par ces m√©tadonn√©es. <br><br><h3>  Blueprint </h3><br>  Blueprint est la nouvelle incarnation de Spring DM, qui est un peu plus simple.  √Ä savoir, si au printemps vous avez des √©l√©ments XML personnalis√©s, ils ne sont pas l√†, car ils ne sont pas n√©cessaires.  Parfois, cela cause toujours des d√©sagr√©ments, mais franchement - rarement.  Si vous ne migrez pas un projet √† partir de Spring, vous pouvez commencer imm√©diatement avec Blueprint. <br><br>  L'essence ici est la m√™me - c'est XML, qui d√©crit les composants √† partir desquels le contexte du bundle est assembl√©.  Pour ceux qui connaissent le printemps, rien n'est inconnu du tout. <br><br>  Voici un exemple de description d'un DataSource et de son exportation en tant que service: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blueprint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"oracle.jdbc.pool.OracleDataSource"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"URL"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"URL"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"USER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PASSWORD"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javax.sql.DataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ds"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service-properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entry</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"osgi.jndi.service.name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jdbc/ds"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service-properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blueprint</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Eh bien, nous avons d√©ploy√© ce fichier dans le dossier de d√©ploiement et examin√© les r√©sultats de la commande list.  Ils ont vu que le paquet n'a pas commenc√© - dans le statut Indtalled.  Nous essayons de d√©marrer et nous obtenons un message d'erreur. <br><br>  Maintenant dans la liste des bundles au statut Echec.  Quoi de neuf?  √âvidemment, il a √©galement besoin de d√©pendances, dans ce cas, un Jar avec des classes Oracle JDBC, ou plus pr√©cis√©ment, le package oracle.jdbc.pool. <br>  Nous trouvons le fichier jar n√©cessaire dans le r√©f√©rentiel, ou t√©l√©chargeable √† partir du site Oracle, et installons, comme d√©crit pr√©c√©demment.  Notre DataSource a d√©marr√©. <br><br>  Comment utiliser tout √ßa?  Le lien de service est appel√© dans la r√©f√©rence Blueprint (quelque part, dans le contexte d'un autre bundle): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javax.sql.DataSource"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  Ensuite, ce bean devient, comme d'habitude, une d√©pendance pour d'autres beans (dans l'exemple camel-sql): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sql"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.apache.camel.component.sql.SqlComponent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  Pot et activateur </h3><br>  La mani√®re canonique d'initialiser des bundles consiste √† utiliser une classe qui impl√©mente l'interface Activator.  Il s'agit d'une interface de cycle de vie typique contenant des m√©thodes de d√©marrage et d'arr√™t qui passent le <i>contexte</i> .  √Ä l'int√©rieur, le bundle d√©marre g√©n√©ralement ses threads, si n√©cessaire, commence √† √©couter les ports, s'abonne √† des services externes √† l'aide de l'API OSGI, etc.  C'est peut-√™tre la mani√®re la plus complexe, la plus √©l√©mentaire et la plus flexible.  Depuis trois ans, je n'en ai jamais eu besoin. <br><br><h2>  Param√®tres et configuration </h2><br>  Il est clair qu'une telle configuration de DataSource, comme le montre l'exemple, n√©cessite peu de personnes.  Login, mot de passe et plus encore, tout est cod√© en dur dans XML.  Il est n√©cessaire de supprimer ces param√®tres. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"url"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${oracle.ds.url}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${oracle.ds.user}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${oracle.ds.password}"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  La solution est assez simple et similaire √† celle utilis√©e dans le Spring classique: √† un certain point du cycle de vie du contexte, les valeurs des propri√©t√©s sont substitu√©es √† partir de diverses sources. <br><br>  Sur ce, nous terminerons la premi√®re partie.  S'il y a un int√©r√™t pour ce sujet, alors continuez.  Nous verrons comment assembler des applications √† partir de bundles, configurer, surveiller et d√©ployer automatiquement des syst√®mes sur cette plate-forme. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435444/">https://habr.com/ru/post/fr435444/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435430/index.html">Les nouvelles les plus cool CES 2019</a></li>
<li><a href="../fr435432/index.html">Nouvelle ann√©e, nouveau GitHub: d√©p√¥ts priv√©s gratuits illimit√©s</a></li>
<li><a href="../fr435436/index.html">5 tendances de l'infrastructure informatique: pr√©visions pour 2019</a></li>
<li><a href="../fr435438/index.html">PHP: changer la structure de la base de donn√©es dans le d√©veloppement d'√©quipe</a></li>
<li><a href="../fr435442/index.html">Entonnoir de changement</a></li>
<li><a href="../fr435446/index.html">Algorithme de Verhuff pour un syst√®me de nombres pairs arbitraires</a></li>
<li><a href="../fr435448/index.html">√Ä propos de l'exp√©rience de la communication avec un g√©n√©rateur de signaux via QTcpSocket et SCPI</a></li>
<li><a href="../fr435450/index.html">Bonne ann√©e, bonne nouvelle MQTT / UDP</a></li>
<li><a href="../fr435452/index.html">Test de bout en bout des microservices avec Catcher</a></li>
<li><a href="../fr435454/index.html">AOP vs fonctionnalit√©s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>