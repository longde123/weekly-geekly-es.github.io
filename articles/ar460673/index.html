<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥪 🍧 🙇🏾 فضح سحر DiffUtil ✍🏾 🚶🏽 🏠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="استخدم كل مطور لنظام Android RecyclerView لعرض القوائم ، وواجه كل منهم مشكلة تحديث البيانات في القائمة حتى ظهرت فئة DiffUtil السحرية في عام 2016. سأشر...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>فضح سحر DiffUtil</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redmadrobot/blog/460673/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/lg/xj/ot/lgxjoteaa7iefogsefpk7jdbzty.png"></p><br><p style=";text-align:right;direction:rtl"> استخدم كل مطور لنظام Android <code>RecyclerView</code> لعرض القوائم ، وواجه كل منهم مشكلة تحديث البيانات في القائمة حتى ظهرت فئة <code>DiffUtil</code> السحرية في عام 2016.  سأشرح على الأصابع كيف يعمل بالفعل ، وأحاول تبديد سحره. </p><a name="habracut"></a><br><h2 id="nemnogo-istorii" style=";text-align:right;direction:rtl">  قليلا من التاريخ </h2><br><p style=";text-align:right;direction:rtl">  واحدة من العناصر الأكثر شيوعا في تطبيقات الهاتف المحمول هي القائمة ، في حالتنا <code>RecyclerView</code> .  يمكن أن تكون هذه قوائم لأي شيء: عناوين المكاتب ، وقوائم الأصدقاء في الشبكات الاجتماعية.  الشبكات ، سجل الطلبات في تطبيقات سيارات الأجرة ، إلخ.  يتم توحيد كل هذه الحالات بضرورة تغيير البيانات في القائمة باستمرار إلى أخرى جديدة ، على سبيل المثال ، عندما قام المستخدم بتمرير سريع لتحديث القائمة أو تصفيتها أو بأي طريقة أخرى تلقي حزمة من البيانات الجديدة من الخلف. </p><br><p style=";text-align:right;direction:rtl">  لتنفيذ هذا السلوك ، اختار سلف مطور Android الحديث ما هي البيانات وكيف تغيرت ، ودعا الأساليب المناسبة من <code>RecyclerView</code> .  ومع ذلك ، تغير كل شيء عندما أصدرت Google إصدار مكتبة الدعم 25.1.0 ، مضيفة <code>DiffUtil</code> هناك ، مما سمح لك بتحويل القائمة القديمة بطريقة سحرية إلى قائمة جديدة دون إعادة إنشاء <code>RecyclerView</code> بالكامل.  في هذه المقالة ، سوف <code>DiffUtil</code> سحر <code>DiffUtil</code> وأشرح كيف يعمل. </p><br><h2 id="kak-rabotat-s-diffutil" style=";text-align:right;direction:rtl">  كيفية العمل مع DiffUtil؟ </h2><br><p style=";text-align:right;direction:rtl">  للعمل مع <code>DiffUtil</code> يجب تطبيق <code>DiffUtil.Callback</code> ، استدعاء الأسلوب <code>calculateDiff(@NonNull Callback cb)</code> وتطبيق <code>DiffResult</code> المستلمة على <code>RecyclerView</code> باستخدام أسلوب <code>dispatchUpdatesTo()</code> .  ماذا يحدث عندما <code>calucalteDiff(@NonNull Callback cd)</code> طريقة <code>calucalteDiff(@NonNull Callback cd)</code> ؟  تُرجع هذه الطريقة <code>DiffResult</code> ، والتي تحتوي على مجموعة من العمليات لتحويل القائمة الأصلية إلى قائمة جديدة.  يتم تطبيق التحديثات عن طريق المكالمات إلى <code>notifyItemRangeInserted</code> <code>notifyItemRangeRemoved</code> ، و <code>notifyItemMoved</code> و <code>notifyItemRangeChanged</code> <code>notifyItemMoved</code> و <code>notifyItemRangeChanged</code> .  الأساليب الثلاثة الأولى تغيير بنية القائمة ، وهي مواضع العناصر ، دون تغيير العناصر نفسها وعدم استدعاء <code>onBindViewHolder()</code> عليها (باستثناء العنصر الذي تتم إضافته).  الأخير يغير العنصر نفسه ويستدعي <code>onBindViewHolder()</code> لتغيير طريقة عرض العنصر. </p><br><p style=";text-align:right;direction:rtl">  يتحقق <code>DiffUtil</code> من قائمتين بحثًا عن الاختلافات باستخدام خوارزمية مايرز ، والتي تحدد فقط وجود / عدم وجود تغييرات ، ولكنها لا تعرف كيفية العثور على حركة العناصر.  للقيام بذلك ، <code>DiffUtil</code> عبر <code>DiffUtil</code> التي تم إنشاؤها بواسطة خوارزمية مايرز (المزيد حول هذا لاحقًا) ، ثم يبحث عن الحركات.  يتم تشكيل <code>DiffResult</code> ل <img src="https://habrastorage.org/webt/z6/hn/vb/z6hnvbb9bcc7w4b3mfwnzj1wtbo.png">  إذا كانت الخوارزمية لا تتحقق من حركة العناصر و <img src="https://habrastorage.org/webt/tn/fx/g8/tnfxg8lolvfn7w3vsg_qeeca8j8.png">  ، حيث P هو عدد العناصر المضافة والمحذوفة. </p><br><h2 id="algoritm-mayersa" style=";text-align:right;direction:rtl">  مايرز خوارزمية </h2><br><p style=";text-align:right;direction:rtl">  بعد ذلك ، سيتم النظر في شرح لخوارزمية مايرز على الأصابع ، وستكون روابط إلى تفسيرات رياضية للخوارزمية (بالإضافة إلى مقالات رائعة أخرى حول الموضوع) في نهاية المقالة.  النظر في تسلسلين: BACAAC و CBCBAB.  من الضروري كتابة سلسلة من التحولات على التسلسل الأول ، وبعدها نحصل على الثانية.  نكتب التسلسلات في الجدول كما يلي: ستشير القائمة القديمة إلى العناصر الأولى للأعمدة ، وستكون القائمة الجديدة هي العناصر الأولى في الصفوف. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/q_/he/bo/q_hebo-jkbim5c6hgsnwreitho0.png"></p><br><p style=";text-align:right;direction:rtl">  شطب الخلايا التي تتقاطع فيها عناصر متطابقة من كلا التسلسلين: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rz/a9/6n/rza96n3gxa6natmxygxvbl6-swo.png"></p><br><p style=";text-align:right;direction:rtl">  تتمثل المهمة الأخرى في الانتقال من الركن الأيسر العلوي من المصفوفة إلى الزاوية اليمنى السفلى بأقل عدد من الخطوات.  يمكنك التحرك على طول الوجوه الأفقية والرأسية.  إذا وصلت إلى النقطة التي يبدأ فيها الخط المائل ، فيجب عليك التحرك على طوله ، لكن تكلفة مثل هذه الخطوة هي 0. وبناءً على ذلك ، تكون تكلفة الخطوة على الحواف هي 1. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jd/ka/hj/jdkahj5crdjy1txsnoduq4gtpic.png"></p><br><p style=";text-align:right;direction:rtl">  من النقطة (0 ؛ 0) يمكننا الانتقال إلى اليمين وإلى الأسفل.  عند الانتقال لأسفل ، يجب أن تذهب قطريًا بشكل إضافي.  تسمى الحركة التي تم إجراؤها في خطوة واحدة الأفعى ، وفي هذه الحالة تلقى 2 ثعبان: (0؛ 0) -&gt; (0؛ 1) و (0؛ 0) -&gt; (1؛ 2).  يشير السهم إلى نهاية الثعبان ، أي  إذا كانت هناك خطوة إلزامية على طول المائل بعد الخطوة العمودي / الأفقي ، فسيكون السهم في الخطوة على طول القطر.  يظهر البناء الكامل للثعابين من نقطة البداية إلى النهاية أدناه.  تم حذف بعض المسارات على الفيديو بسبب  من الواضح أنها ليست الأقصر. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/b8/js/0y/b8js0y2qxyadd28chcvfeowmnlc.gif"></p><br><p style=";text-align:right;direction:rtl">  نتيجة لذلك ، نحصل على العديد من المسارات الأقصر الممكنة ، وبعضها معروض أدناه. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6k/qp/7e/6kqp7epya7ggz63crot9nlji5nu.png"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vj/nu/n3/vjnun3ra3mqqczon9hoqazejzr4.png"></p><br><p style=";text-align:right;direction:rtl">  كيف يمكن أن يساعد تمرير مصفوفة من أقصى اليسار إلى أقصى اليمين في تحديد تسلسل الإجراءات (البرنامج النصي) لتحويل تسلسل واحد إلى آخر؟  ماذا تعني الخطوات الأفقية والرأسية والقطرية؟  الخطوة على طول المصفوفة في أحد الاتجاهات المحتملة هي الإجراءات على السطر القديم: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الخطوة الأفقية - حذف من الخط القديم </li><li style=";text-align:right;direction:rtl">  الخطوة العمودية - إضافة إلى الخط القديم </li><li style=";text-align:right;direction:rtl">  خطوة قطرية - لا تغيير </li></ul><br><p style=";text-align:right;direction:rtl">  باستخدام المسار الثاني كمثال ، نقارن المسار والنص الناتج.  الخطوة الأولى عمودية ، مما يعني أننا نضيف الحرف "C" إلى الموضع 0 في السطر القديم. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/1v/jr/56/1vjr56ttvtw8f4zrqgq_eibhnue.png"></p><br><p style=";text-align:right;direction:rtl">  ومع ذلك ، ليس هذا هو الثعبان كله.  بعد ذلك ، يجب أن نتحرك قطريا.  عند التحرك قطريًا ، يظل العنصر B بدون تغيير.  نتيجة لذلك ، يتكون الثعبان من حركة رأسية + حركة قطرية. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/iy/6k/-a/iy6k-aqdo6tby-j3l8ba8dhdhim.png"></p><br><p style=";text-align:right;direction:rtl">  بعد ذلك ، ثعبان أفقيا - إزالة العنصر A. من السطر القديم </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ol/-w/lw/ol-wlww56idbnouwjfdimzgarnu.png"></p><br><p style=";text-align:right;direction:rtl">  يُظهر الفيديو المسار بالكامل من البداية إلى النهاية مع تغيير في السلسلة المصدر حتى يتم تحويله إلى الأخير. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/q3/na/bv/q3nabvb19527df3mm590pz-vd88.gif"></p><br><p style=";text-align:right;direction:rtl">  نتيجة خوارزمية مايرز هي برنامج نصي مع مجموعة من الحد الأدنى لعدد الإجراءات التي يجب القيام بها لتحويل تسلسل واحد إلى آخر.  في <code>DiffUtil</code> يتم استخدام خوارزمية مايرز للبحث عن العناصر المختلفة التي تحددها طريقة <code>areItemsTheSame()</code> .  بالإضافة إلى تكوين قائمة من الثعابين ، عند المرور عبر القوائم ، تقوم خوارزمية مايرز بإنشاء قوائم لحالات عناصر عناصر القوائم القديمة والجديدة.  يتم تمرير كل هذه البيانات ، بالإضافة إلى <code>detectMoves</code> و رد الاتصال الذي تم تنفيذه بواسطة المستخدم ، إلى مُنشئ <code>DiffResult(Callback callback, List&lt;Snake&gt; snakes, int[] oldItemStatuses, int[] newItemStatuses, boolean detectMoves)</code> . </p><br><p style=";text-align:right;direction:rtl">  أثناء كتابة هذا المقال ، تمكنت من اكتشاف ما يحدث بالضبط في <code>DiffResult</code> : الخوارزمية تمر عبر الثعابين وتعيين العلامات على العناصر (في قوائم الحالة) ، والتي تحدد ما حدث بالضبط للعنصر.  باستخدام هذه العلامات ، عند تطبيق التغييرات على <code>RecyclerView</code> يتم تحديد الطريقة التي يتم بها تطبيق التحديثات على: <code>notifyItemRangeInserted, notifyItemRangeRemoved, notifyItemMoved  notifyItemRangeChanged</code> .  بمزيد من التفصيل سأتحدث عن هذا في المرة القادمة. </p><br><h2 id="ssylki" style=";text-align:right;direction:rtl">  مراجع </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">خوارزمية Myers Diff و Kotlin للملاحظة</a> - بالإضافة إلى التعرف على خوارزمية مايرز ، إليك بعض ميزات Kotlin المثيرة للاهتمام لتبسيط العمل مع <code>DiffUtil</code> . </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">جزء 1 من Myers Diff Algorithm</a> عبارة عن سلسلة من المقالات التي تبدأ في شرح خوارزمية Myers على الأصابع وترجمتها تدريجيًا إلى لغة رياضية. </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">خوارزمية الفرق (ND) وتغيراتها</a> هي المقالة العلمية الرسمية لخوارزمية مايرز. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar460673/">https://habr.com/ru/post/ar460673/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar460661/index.html">كل ما تحتاج لمعرفته حول Node.js</a></li>
<li><a href="../ar460665/index.html">مسودة الأسئلة الشائعة: لماذا تظهر معايير C ++ كل ثلاث سنوات؟</a></li>
<li><a href="../ar460667/index.html">أتمتة اختبار الخدمات المدفوعة على iOS</a></li>
<li><a href="../ar460669/index.html">كيفية ضمان سلامة التنمية ، وتوفير الوقت والأعصاب</a></li>
<li><a href="../ar460671/index.html">الملكية والاقتراض في د</a></li>
<li><a href="../ar460675/index.html">آلة التعلم استخراج البيانات</a></li>
<li><a href="../ar460683/index.html">Laravel الحدث العارض ومفهوم الجيل الحدث</a></li>
<li><a href="../ar460685/index.html">نقوم بتوزيع الملفات من Google Drive باستخدام nginx</a></li>
<li><a href="../ar460687/index.html">كيف تبدو العلب من الداخل</a></li>
<li><a href="../ar460695/index.html">ما هو DAA ، وكيف يساعد هذا النظام الطائرات بدون طيار؟</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>