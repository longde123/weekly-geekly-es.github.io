<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐼 🔂 👟 Imagens minúsculas do Docker que acreditavam em si * 🖌️ 👩🏼‍🤝‍👨🏾 🌻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[referência ao conto de fadas infantil americano "O pequeno motor que poderia" - aprox. por.] * 





 Como criar automaticamente imagens minúsculas d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Imagens minúsculas do Docker que acreditavam em si *</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/469947/"><p>  [referência ao conto de fadas infantil americano "O pequeno motor que poderia" - aprox.  por.] * </p><br><p><img src="https://habrastorage.org/webt/dh/gb/qd/dhgbqdfhxud0uidunstrjj2cj1e.jpeg"></p><br><p>  <strong>Como criar automaticamente imagens minúsculas de janela de encaixe para suas necessidades</strong> </p><br><h3 id="neobychnaya-oderzhimost">  Obsessão incomum </h3><br><p>  Nos últimos dois meses, fiquei obcecado por uma obsessão: quanto posso reduzir a imagem do Docker para que o aplicativo funcione? </p><br><p>  Eu entendo que a ideia é estranha. </p><br><p>  Antes de me aprofundar nos detalhes e nos conhecimentos técnicos, gostaria de explicar por que esse problema me enganou tanto e como isso o preocupa. </p><br><h3 id="pochemu-razmer-imeet-znachenie">  Por que o tamanho importa </h3><br><p>  Ao diminuir o conteúdo da imagem do Docker, reduzimos a lista de vulnerabilidades.  Além disso, tornamos as imagens mais limpas, porque elas contêm apenas o que você precisa para executar aplicativos. </p><a name="habracut"></a><br><p>  Há outra pequena vantagem - as imagens baixam um pouco mais rápido, mas, quanto a mim, isso não é tão importante. </p><br><blockquote>  Observação: se você se preocupa com o tamanho, a aparência do Alpine é pequena e provavelmente será adequada para você. </blockquote><br><h3 id="distroless-obrazy">  Imagens Distroless </h3><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O projeto Distroless</a> oferece uma seleção de imagens "distroless" básicas; elas não contêm os gerenciadores de pacotes, shells ou outros utilitários que você está acostumado a ver na linha de comando.  Como resultado, o uso de gerenciadores de pacotes como <code>pip</code> e <code>apt</code> falhará: </p><br><pre> <code class="plaintext hljs">FROM gcr.io/distroless/python3 RUN pip3 install numpy</code> </pre> <br><p>  <em>Dockerfile usando uma imagem distroless do Python 3</em> </p><br><pre> <code class="plaintext hljs">Sending build context to Docker daemon 2.048kB Step 1/2 : FROM gcr.io/distroless/python3 ---&gt; 556d570d5c53 Step 2/2 : RUN pip3 install numpy ---&gt; Running in dbfe5623f125 /bin/sh: 1: pip3: not found</code> </pre> <br><p>  <em>Nenhum pip na imagem</em> </p><br><p>  Normalmente, esse problema é resolvido por uma compilação de vários estágios: </p><br><pre> <code class="plaintext hljs">FROM python:3 as builder RUN pip3 install numpy FROM gcr.io/distroless/python3 COPY --from=builder /usr/local/lib/python3.7/site-packages /usr/local/lib/python3.5/</code> </pre> <br><p>  <em>Montagem em várias etapas</em> </p><br><p>  O resultado é uma imagem de tamanho 130MB.  Não é tão ruim!  Para comparação: a imagem Python, por padrão, pesa 929 MB, e a “mais fina” ( <code>3,7-slim</code> polegadas) - 179 MB, a imagem alpina ( <code>3,7-alpine</code> polegadas) - 98,6 MB, enquanto a imagem básica sem distração usada no exemplo é 50,9MB. </p><br><p>  Podemos apontar corretamente que, no exemplo anterior, estamos copiando todo o diretório <code>/usr/local/lib/python3.7/site-packages</code> , que pode conter dependências desnecessárias para nós.  Embora esteja claro que a diferença de tamanho de todas as imagens base existentes do Python varia. </p><br><blockquote>  No momento em que escrevemos essas linhas, o Google distroless não suporta muitas imagens: Java e Python ainda estão em fase experimental e o Python existe apenas para 2.7 e 3.5. </blockquote><br><h3 id="krohotnye-obrazy">  Imagens minúsculas </h3><br><p>  Vamos voltar à minha obsessão em criar pequenas imagens. </p><br><p>  Na verdade, eu queria ver como as imagens sem distração funcionam.  O projeto distroless usa a <code>bazel</code> criação do bazel do Google.  No entanto, para instalar o Bazel e escrever suas próprias imagens, eu tive que suar (e para ser completamente honesto, reinventar a roda é divertido e informativo).  Queria simplificar a criação de imagens reduzidas: o ato de criar uma imagem deve ser extremamente simples, <em>banal</em> .  Para que você não tenha arquivos de configuração, apenas uma linha no console: <code>    &lt;&gt;</code> . </p><br><p>  Portanto, se você deseja criar suas próprias imagens, saiba: existe uma imagem de janela de encaixe única, <code>scratch</code> .  Scratch é uma imagem "vazia", ​​não possui arquivos, embora pesa por padrão - uau!  - 77 bytes. </p><br><pre> <code class="plaintext hljs">FROM scratch</code> </pre> <br><p>  <em>Imagem zero</em> </p><br><p>  A idéia de uma imagem de rascunho é que você pode copiar quaisquer dependências para ela da máquina host e usá-las dentro do Dockerfile (é como copiá-las para o <code>apt</code> e instalar a partir do zero) ou mais tarde, quando a imagem do Docker for materializada.  Isso permite controlar totalmente o conteúdo do contêiner do Docker e, assim, controlar completamente o tamanho da imagem. </p><br><p>  E agora precisamos, de alguma forma, coletar essas dependências.  Ferramentas existentes, como o <code>apt</code> permitem baixar pacotes, mas estão vinculadas à máquina atual e, no final, não suportam Windows ou MacOS. </p><br><p>  Por isso, comprometi-me a montar minha própria ferramenta, que montaria automaticamente a imagem básica do menor tamanho possível e, assim, ainda lançaria qualquer aplicativo.  Eu usei pacotes Ubuntu / Debian, fiz uma seleção (obtendo pacotes diretamente dos repositórios) e encontrei recursivamente suas dependências.  O programa deve baixar automaticamente a versão estável mais recente do pacote, minimizando os riscos de segurança. </p><br><p>  Chamei a <code>fetchy</code> , porque ... encontra e traz ... o que você precisa [ <em>do inglês.</em>  <em>"buscar", "trazer" - aprox.</em>  <em>trans.</em>  ]  A ferramenta funciona através da interface da linha de comandos, mas ao mesmo tempo oferece uma API. </p><br><p>  Para construir uma imagem usando o <code>fetchy</code> (vamos pegar uma imagem do Python desta vez), você só precisa usar a CLI assim: <code>fetchy dockerize python</code> .  Você pode ser solicitado pelo sistema operacional de destino e pelo nome do código, pois o <code>fetchy</code> usa apenas pacotes baseados no Debian e Ubuntu até agora. </p><br><p>  Agora você pode escolher quais dependências não são necessárias (no nosso contexto) e excluí-las.  Por exemplo, o Python depende do perl, embora funcione muito bem sem o Perl instalado. </p><br><h3 id="rezultaty">  Resultados </h3><br><p>  A imagem Python criada com o <code>fetchy dockerize python3.5</code> pesa apenas 35 MB (tenho mais certeza de que poderá ser ainda mais fácil no futuro).  Acontece que, com uma imagem sem distração, conseguimos "raspar" outros 15 MB. </p><br><p>  Todas as imagens coletadas atualmente podem ser visualizadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  O projeto está <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  Se você não tiver funções suficientes, basta criar um aplicativo - ficarei feliz em ajudar :) Ainda mais, atualmente estou trabalhando na integração de outros gerenciadores de pacotes ao fetchy, para que a necessidade de compilações em vários estágios não seja mais necessária. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt469947/">https://habr.com/ru/post/pt469947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt469933/index.html">Como medir a eficácia e resolver os problemas dos desenvolvedores, se você tiver cem</a></li>
<li><a href="../pt469935/index.html">Curso "Fundamentos do trabalho eficaz com a Wolfram Technologies": mais de 13 horas de vídeo aulas, teoria e problemas</a></li>
<li><a href="../pt469939/index.html">Roteador CNC doméstico como alternativa a uma impressora 3D, parte quatro. Conceitos gerais de processamento</a></li>
<li><a href="../pt469941/index.html">Nematóides extremos do lago Mono: nadar em arsênico e sobreviver</a></li>
<li><a href="../pt469945/index.html">É importante que computadores e pessoas vejam o mundo de maneira diferente?</a></li>
<li><a href="../pt469949/index.html">No aniversário de Yuri Knorozov: estudamos o básico da escrita maia</a></li>
<li><a href="../pt469951/index.html">Controle segmentado DIY, como no iOS 13.0 e posterior</a></li>
<li><a href="../pt469955/index.html">Custdev, serviços sofisticados e a arte da apresentação: o que ensinamos aos participantes do acelerador VTB</a></li>
<li><a href="../pt469961/index.html">Confie na Microsoft (ou na criação do Security Daemon Azure IoT Edge)</a></li>
<li><a href="../pt469963/index.html">SonarQube e IntelliJ IDEA: integração correta</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>