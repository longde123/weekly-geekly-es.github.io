<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â™Œï¸ ğŸ‘¶ğŸ» ğŸ© ImplÃ©mentation de l'arbre C de prÃ©fixe C ğŸ¼ ğŸ¤¦ğŸ¼ ğŸ˜¦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PrÃ©sentation 
 Quatre mois se sont Ã©coulÃ©s depuis la publication de l'article sur ma tentative d'implÃ©mentation de bas niveau de l' arborescence des p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ImplÃ©mentation de l'arbre C de prÃ©fixe C</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428175/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2cf/e02/c47/2cfe02c47506426be25fb36004a78b1d.jpg" alt="image"></div><br><h2>  PrÃ©sentation </h2><br>  Quatre mois se sont Ã©coulÃ©s depuis la publication de l'article sur ma tentative d'implÃ©mentation de bas niveau de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">arborescence des prÃ©fixes</a> .  MalgrÃ© tous mes efforts, le plafond sur lequel ma mise en Å“uvre prÃ©cÃ©dente de l'arborescence des prÃ©fixes s'est avÃ©rÃ© Ãªtre d'environ 80 000 mots par seconde.  J'ai ensuite passÃ© beaucoup de temps et d'Ã©nergie, mais le rÃ©sultat ne conviendrait que comme travail de laboratoire en informatique. <br><br>  Beaucoup m'ont alors dit: Â«N'inventez pas un vÃ©lo que nous avons dÃ©jÃ  inventÃ©!  Utilisez la solution clÃ© en main. "  La difficultÃ© est que je ne pouvais pas utiliser quelque chose que je ne comprends pas au moins en termes gÃ©nÃ©raux. <br><br>  Je pense avoir compris l'arborescence des prÃ©fixes, et c'est ce que j'ai rÃ©ussi Ã  rÃ©aliser. <br><a name="habracut"></a><br><h2>  Principe de fonctionnement </h2><br>  Je ne connais pas trÃ¨s bien l'anglais, donc parmi les nombreux articles que j'ai lus sur le thÃ¨me des arborescences de prÃ©fixes, certaines informations ne m'ont probablement pas atteint.  Par consÃ©quent, j'ai trouvÃ© comment tout arranger, en ne comprenant que le principe de base de l'arbre des prÃ©fixes.  Pour ceux qui ne le savent pas, je vais essayer de le dÃ©crire plus clairement qu'il n'est Ã©crit sur WikipÃ©dia.  J'ai donc expliquÃ© ce que je faisais Ã  ma femme. <br><br>  L'arbre des prÃ©fixes est une structure logique pour stocker des donnÃ©es qui peuvent Ãªtre reprÃ©sentÃ©es comme un index de cartes de livres dans une bibliothÃ¨que.  Chaque case a un numÃ©ro.  Chaque case correspond Ã  une lettre spÃ©cifique de l'alphabet.  A l'intÃ©rieur se trouvent les numÃ©ros des tiroirs suivants, ouverture que vous pouvez dÃ©couvrir les suivants et ainsi de suite.  Quand il n'y a rien Ã  l'intÃ©rieur de la boÃ®te, cela signifie que la lettre de cette boÃ®te est la derniÃ¨re du mot.  Le problÃ¨me est que certaines cases restent presque vides, car elles contiennent 1 ou 2 chiffres, et l'espace restant est vide. <br><br>  Pour rÃ©soudre ce problÃ¨me, de nombreuses variÃ©tÃ©s d'arbres de prÃ©fixes sont apparues, y compris: HAT-trie, double-array trie, tripple-array trie.  C'est prÃ©cisÃ©ment le fait que je n'ai pas pu comprendre Ã  fond le principe de leur travail qui m'a poussÃ© Ã  un arbre aussi simple qu'un fichier de carte de bibliothÃ¨que. <br><br>  La derniÃ¨re fois, j'ai rÃ©ussi Ã  implÃ©menter une implÃ©mentation de consommation de mÃ©moire plutÃ´t Ã©conomique d'un simple arbre de prÃ©fixe.  Poursuivant cette mÃ©taphore avec un classeur de bibliothÃ¨que, j'ai fait des tiroirs dans mon classeur de diffÃ©rentes tailles, pour l'alphabet complet la boÃ®te est la plus grande, pour 1 lettre la plus petite. <br><br>  J'ai rÃ©ussi Ã  implÃ©menter exactement le mÃªme schÃ©ma PHP en C. <br><br>  <b>1.</b> Chaque lettre du mot selon le tableau Ã©tabli est codÃ©e avec un nombre de 2 Ã  95. Par exemple, le mot Â«abvÂ» est codÃ© avec trois nombres: 11, 12, 13. Pour des performances maximales, un tableau bidimensionnel de nombres de 1 octet de <code>uint8_t abc[256][256] = {};</code>  Pour convertir un programme, il lit une ligne d'un octet, il essaie de prendre la valeur de chaque octet de notre tableau.  Par exemple, le code numÃ©rique est 1 = 49, donc nous regardons <code>abc[49][0];</code>  .  S'il y a une valeur autre que '\ 0', alors c'est le code de notre lettre, souvenez-vous-en et passez Ã  l'octet suivant.  Dans notre cas, le mot Â«abvÂ» consiste en une sÃ©quence de 6 octets, deux octets par lettre: 208, 176, 208, 177, 208, 178. Puisque le codage utf-8 est conÃ§u pour que les premiers octets de caractÃ¨res Ã  un octet ne coÃ¯ncident jamais avec les premiers octets de plusieurs octets , dans notre tableau <code>abc[208][0] = 0;</code>  . <br><br>  Cependant, pour les paires d'octets, il existe des correspondances: <br><br><pre> <code class="hljs markdown">/<span class="hljs-bullet"><span class="hljs-bullet">*  [11] *</span></span>/ abc[<span class="hljs-string"><span class="hljs-string">208</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">176</span></span>] = 11; /<span class="hljs-bullet"><span class="hljs-bullet">*  [12] *</span></span>/ abc[<span class="hljs-string"><span class="hljs-string">208</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">177</span></span>] = 12; /<span class="hljs-bullet"><span class="hljs-bullet">*  [13] *</span></span>/ abc[<span class="hljs-string"><span class="hljs-string">208</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">178</span></span>] = 13;</code> </pre><br>  <b>2.</b> Maintenant, nous devons noter les nombres 11, 12 et 13 dans les cases de notre arbre.  L'arbre se compose de 2 blocs de mÃ©moire non explosifs sÃ©parÃ©s, le premier est un bloc de nÅ“uds, le second est un bloc de liens, ainsi que deux compteurs de nÅ“uds occupÃ©s et des cellules occupÃ©es d'un bloc de liens.  Chaque nÅ“ud d'arborescence se compose de 16 octets, 12 octets d'un masque de bits et 4 octets pour stocker l'ID du bloc de liaison.  Le masque vous permet de stocker des nombres de 2 Ã  96 bits.  Le premier bit du masque est utilisÃ© pour marquer la fin du mot sur ce nÅ“ud.  Chaque nÅ“ud peut correspondre Ã  l'id du bloc de liaison si au moins 1 lettre est Ã©crite dans ce nÅ“ud, ou ne pas correspondre si le nÅ“ud est une Â«feuilleÂ» en termes d'arbres, c'est-Ã -dire qu'un mot se termine simplement dessus.  ExprimÃ© dans une bibliothÃ¨que, un tiroir vide. <br><br>  <b>3.</b> Prenez le masque du premier nÅ“ud (racine).  trie-&gt; nÅ“uds [0] .mask;  Nous comptons les bits levÃ©s dans ce masque, Ã  partir du second (le premier pour le drapeau de fin de mot).  Si aucun bit du masque n'est relevÃ©, c'est-Ã -dire  Ã‰tant donnÃ© que le nÅ“ud est vide, nous avons besoin d'un bloc de liens de taille 1 pour stocker notre numÃ©ro 11, prenez le numÃ©ro du compteur de rÃ©fÃ©rences de liens du bloc et augmentez l'ancienne valeur d'un (car nous avons besoin de la taille 1).  Nous prenons le nombre du compteur de nÅ“uds et augmentons Ã©galement l'ancienne valeur de 1. Nous Ã©crivons l'ID du bloc de liens, qui est le nombre obtenu du compteur de blocs de liens, dans notre nÅ“ud racine.  Et dans cet identifiant du bloc de liaison, Ã©crivez l'identifiant du nouveau nÅ“ud, c'est-Ã -dire le nombre obtenu Ã  partir du compteur de nÅ“uds.  Maintenant, en plus du nÅ“ud racine (id 0), nous avons un nÅ“ud de la lettre Â«aÂ» (id 1).  Pour Ã©crire le nombre 12 correspondant Ã  la lettre Â«bÂ», on fait de mÃªme, mais avec le nÅ“ud de la lettre Â«aÂ». <br><br>  <b>4.</b> Sur la derniÃ¨re lettre Â«cÂ», nous n'avons pas besoin de place dans le bloc de liens, car nous aurons le dernier nÅ“ud sur la branche ou la feuille de nÅ“ud.  Un tel nÅ“ud n'a que 1 bit dans le masque relevÃ©. <br><br>  <b>5.</b> La partie la plus difficile du travail d'un arbre se produit lorsqu'il est Ã©crit dans un nÅ“ud dans lequel certaines lettres ont dÃ©jÃ  Ã©tÃ© Ã©crites.  Dans ce cas, le schÃ©ma de fonctionnement est le suivant: <br><br>  Supposons que nous voulions ajouter le mot Â«bvgÂ» (12, 13, 14) Ã  notre arbre, dans lequel le mot Â«abvÂ» (11, 12, 13) est dÃ©jÃ  Ã©crit.  Nous comptons les bits du masque du nÅ“ud racine jusqu'au bit de la lettre qui nous intÃ©resse.  Nous avons la lettre Â«bÂ» avec le code 12, ce qui signifie que le bit de cette lettre est 12, dans le masque de 1 Ã  12 bits le bit 11 de la lettre Â«aÂ» a dÃ©jÃ  Ã©tÃ© soulevÃ©.  Nous avons donc la taille actuelle du bloc de liens pour le nÅ“ud racine 1. Nous Ã©crivons la deuxiÃ¨me lettre, nous avons donc maintenant besoin d'un bloc de liens de taille 2. Ici, le registre des blocs libÃ©rÃ©s entre en jeu, dans lequel l'id et la taille des sections du bloc de liens ne sont plus utilisÃ©s par les nÅ“uds arbre.  Notre ancien identifiant du bloc de liaison pour le nÅ“ud racine de taille 1 vient juste d'entrer dans le registre des sections libres de taille 1, car notre nÅ“ud racine a besoin d'une plus grande taille.  Notre registre n'a pas de section appropriÃ©e de taille 2 et nous prenons Ã  nouveau la valeur du compteur du bloc de liaison comme nouvel identifiant du bloc de liaison, augmentant le compteur de 2. Ã€ la nouvelle adresse du bloc de liaison dans le mÃªme ordre dans lequel les bits sont situÃ©s dans le masque de nÅ“ud, nous Ã©crivons la valeur id noeud de l'ancien bloc de liens pour la lettre "a" du premier mot et la valeur du noeud qui vient d'Ãªtre crÃ©Ã© de la lettre "b" du second mot. <br><img src="https://habrastorage.org/webt/nx/cr/md/nxcrmdtlm8gezn4zkxk2_5vni_m.png"><br><br><h2>  Vitesse de travail </h2><br>  Le roulement de tambour sonne ... Vous vous souvenez du dernier rÃ©sultat?  Environ 80 mille mots par seconde.  L'arbre a Ã©tÃ© crÃ©Ã© Ã  partir du dictionnaire de tous les mots russes OpenCorpora 3 039 982 mots.  Et voici ce qui s'est passÃ© maintenant: <br><br><pre> <code class="hljs pgsql">yatrie creation <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">4.588216</span></span>s (<span class="hljs-number"><span class="hljs-number">666</span></span>k wps) yatrie <span class="hljs-keyword"><span class="hljs-keyword">search</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mln. rounds: <span class="hljs-number"><span class="hljs-number">0.565618</span></span>s (<span class="hljs-number"><span class="hljs-number">1.76</span></span>m wps)</code> </pre> <br>  <b>MISE Ã€ JOUR 11/01/2018:</b> <br>  Dans la version 0.0.2, il Ã©tait possible d'augmenter la vitesse de prÃ¨s de 2 fois en remplaÃ§ant les fonctions Ã  part entiÃ¨re par des fonctions macro, ainsi qu'en changeant la structure du masque de nÅ“ud en masque uint32_t [3], auparavant c'Ã©tait le masque uint8_t [12]. <br>  Ajout de macros LIKELY () UNLIKELY () pour prÃ©dire les rÃ©sultats attendus dans ces blocs if (), si possible. <br>  <b>MISE Ã€ JOUR 11/05/2018:</b> <br>  Tordu un peu plus.  J'ai rÃ©ussi Ã  le faire fonctionner correctement mÃªme lors de la compilation de -O3 et -Ofast.  La vitesse de recherche dans l'arbre est de ~ 0,2 Î¼s ou 0,2c pour 1 million de rÃ©pÃ©titions.  Apparemment, cette vitesse a Ã©tÃ© obtenue en raison de la transition vers un format diffÃ©rent du masque.  Auparavant, il y avait 12 octets de 8 bits, et maintenant 3 int32 et une fonction trÃ¨s rapide pour compter les bits en int32. <br><br><h3>  Est-ce compact? </h3><br>  Le dictionnaire OpenCorpora spÃ©cifiÃ© prend ~ 84 Mo, ce qui n'est pas bien pire que libdatrie, qui donne ~ 80 Mo. <br><br>  â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Code source</a> <br><br>  Bienvenue </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428175/">https://habr.com/ru/post/fr428175/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428161/index.html">Les rÃ©formes visant Ã  subventionner les combustibles fossiles qui ont Ã©tÃ© rÃ©alisÃ©es grÃ¢ce Ã  un travail acharnÃ© sont en danger</a></li>
<li><a href="../fr428165/index.html">Podcast du noyau Linux avec Open Source Summit Europe 2018</a></li>
<li><a href="../fr428167/index.html">La premiÃ¨re usine de robots en Russie et qu'est-ce que la saucisse a Ã  voir avec Ã§a?</a></li>
<li><a href="../fr428169/index.html">DJI annonce Mavic 2 Enterprise - un outil puissant pour les professionnels</a></li>
<li><a href="../fr428173/index.html">Prettier, ESLint, Husky, Lint-Staged et EditorConfig: outils pour Ã©crire du code ordonnÃ©</a></li>
<li><a href="../fr428177/index.html">Alors, quel est le problÃ¨me avec la recherche d'emploi / les travailleurs en informatique?</a></li>
<li><a href="../fr428179/index.html">Lors d'une vente aux enchÃ¨res japonaise, un prototype de manette Wii, dÃ©veloppÃ© pour le GameCube</a></li>
<li><a href="../fr428181/index.html">Machine morale: impitoyable ou vide de sens?</a></li>
<li><a href="../fr428183/index.html">ImplÃ©mentation de l'algorithme de Levenberg-Marquardt pour l'optimisation des rÃ©seaux de neurones sur TensorFlow</a></li>
<li><a href="../fr428187/index.html">Comment Ã©crire une extension pour GNOME Shell: mode Ne pas dÃ©ranger</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>