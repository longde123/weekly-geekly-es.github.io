<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÇÔ∏è üë©üèª‚Äçü§ù‚Äçüë®üèΩ üïé Trabaje con nRF51822 utilizando ST-Link y Clion + OpenOCD üìÉ ü§µüèº ü§∑üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buenas tardes, comunidad Habr! 


 As√≠ que ha llegado el momento de los estudiantes en las universidades t√©cnicas. Entonces, es hora de proyectos en e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trabaje con nRF51822 utilizando ST-Link y Clion + OpenOCD</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439148/"><p>  Buenas tardes, comunidad Habr! </p><br><p>  As√≠ que ha llegado el momento de los estudiantes en las universidades t√©cnicas.  Entonces, es hora de proyectos en el hogar y conquistar nuevas alturas de tecnolog√≠a microelectr√≥nica.  Hoy hablar√© sobre mi investigaci√≥n con placas basadas en el chip NRF51822, que es un m√≥dulo Bluetooth algo anticuado de Nordic Semiconductor.  Esta compa√±√≠a es famosa por sus m√≥dulos de radio de bajo consumo de corriente y el chip NRF51822 no es una excepci√≥n. <a name="habracut"></a>  Pero no nos distraeremos del tema.  Hablemos de hierro. </p><br><h1 id="sozdanie-otladochnogo-stenda">  Crear un soporte de depuraci√≥n </h1><br><p>  En octubre, se <strong>ordenaron</strong> tableros <strong>yj-14015-nrf51822</strong> para experimentos con Bluetoth.  Fue una mala idea comprar placas sin cableado a los conectores de clavija para cables est√°ndar para los amantes de la electr√≥nica. </p><br><div class="spoiler">  <b class="spoiler_title">yj-14015-nrf51822</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/y3/ng/mv/y3ngmvstxvcodfs_8v77tznew4c.jpeg" alt="yj-14015-nrf51822"></p></div></div><br><p>  La distancia entre los contactos de menos de 1 mm cre√≥ grandes dificultades para m√≠, una persona con una experiencia de soldadura extremadamente modesta.  Las salidas en el tablero no fueron dise√±adas para soldar a cables y fueron f√°ciles de cortar.  Este destino le ocurri√≥ a la √∫nica fuente de alimentaci√≥n VDD.  Pero con la ayuda de los esfuerzos del vecino, fue posible soldar el cable a la salida del condensador en la placa.  Juntos, se soldaron las salidas GND, SWDIO, SWCLK y algunas otras GPIO.  El resultado es algo similar en apariencia a Frankenstein: </p><br><div class="spoiler">  <b class="spoiler_title">Tablero soldado</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/iq/vi/3c/iqvi3c2ya0c0rtg1glk2eetijnm.jpeg" alt="Tablero soldado"></p></div></div><br><p>  Vamos a depurar y flashear nuestro dispositivo usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ST-Link V2.</a> El diagrama de conexi√≥n es extremadamente simple y l√≥gico: </p><br><table><thead><tr><th>  ST-Link V2 </th><th>  nrf51822 </th></tr></thead><tbody><tr><td>  3.3V </td><td>  Vdd </td></tr><tr><td>  GND </td><td>  GND </td></tr><tr><td>  SWDIO </td><td>  SWDIO </td></tr><tr><td>  SWDCLK </td><td>  SCLK </td></tr></tbody></table><br><p>  A diferencia de Frankenstein, una sola descarga de corriente no fue suficiente para revivir este m√≥dulo.  En primer lugar, intent√© leer la memoria nrf51822 utilizando la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">utilidad STM32 ST-LINK</a> .  Con algunas advertencias, esto funcion√≥ con placas STM32, pero no con nrf.  En esto, mi trabajo con el tablero se detuvo temporalmente.  Un poco m√°s tarde encontr√© el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo 1</a> y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo 2</a> sobre trabajar con nrf51822.  Conten√≠a enlaces al SDK y una descripci√≥n detallada de c√≥mo se organiza la memoria nrf.  El autor de los art√≠culos utiliz√≥ el depurador JLink m√°s caro, a diferencia de nosotros.  Las soluciones baratas son muy importantes si eres un estudiante pobre :). </p><br><h1 id="izuchenie-sdk">  SDK de aprendizaje </h1><br><p>  Si desea utilizar la funcionalidad bluetooth, <del>  lo cual es bastante l√≥gico para un chip bluetooth, </del>  Tendr√° que colocar el llamado "dispositivo suave" al comienzo de la memoria programable nrf5.  Viene en forma de firmware y contiene funcionalidad bluetooth.  El resto de la memoria se escribe en su firmware.  Desde all√≠, puede llamar a procedimientos de dispositivo suave para configurar bluetooth. </p><br><p>  Hay varios dispositivos blandos diferentes.  Para nrf51, puede usar s110 (para aplicaciones de servidor) y s130 (para aplicaciones de servidor y cliente).  Para comprender la compatibilidad de las versiones de SDK y el dispositivo virtual, hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">una matriz de compatibilidad</a> .  Se puede ver que los SDK hasta la versi√≥n 12.3.0 son adecuados para nuestra placa.  Pero nos detendremos en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SDK 10.0.0</a> desde  Es compatible con s110 y s130. </p><br><h1 id="nastroyka-openocd">  Configurar OpenOCD </h1><br><p>  En los ejemplos del SDK y en los art√≠culos, la utilidad nrfjprog se utiliza para el firmware a trav√©s de JLink, y necesitamos actualizar a trav√©s de ST-Link V2.  En su lugar, utilizaremos el genial programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OpenOCD</a> , <a href="">descarga para Windows</a> .  Te permite flashear y depurar <del>  tuyevu hoo </del>  Una gran cantidad de diferentes placas y microcircuitos.  Hay una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">configuraci√≥n</a> para el chip nrf51.  Para forzar a OpenOCD a flashear nuestra placa, es necesario ejecutar el comando del formato presentado a continuaci√≥n (despu√©s de agregar la carpeta OpenOCD / bin a Path).  Puede leer m√°s sobre los comandos de OpenOCD en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> . </p><br><pre><code class="plaintext hljs">openocd -f interface/stlink.cfg -f target/nrf51.cfg -c init -c "reset halt" ^ -c "nrf51 mass_erase 0" -c "flash write_image &lt;PATH_TO_HEX&gt; &lt;OFFSET&gt;" ^ -c reset -c exit</code> </pre> <br><p>  El diablo, como siempre, est√° en los detalles: </p><br><ul><li>  "reset halt" env√≠a un comando de reinicio de chip y detiene el dispositivo.  En este estado, el firmware se puede borrar / escribir </li><li>  "nrf51 mass_erase 0" permite escribir en la secci√≥n del gestor de arranque y borra toda la memoria programable del microcircuito (en algunos casos ayudar√° a evitar un error de descarga de firmware) </li><li>  en lugar de &lt;PATH_TO_HEX&gt; necesita sustituir la ruta al archivo hexadecimal </li><li>  &lt;OFFSET&gt; establece el desplazamiento de la direcci√≥n de escritura del firmware.  Este par√°metro es √∫til si desea actualizar su firmware por separado del dispositivo suave.  Si desea escribir firmware comenzando desde el principio de la memoria (desde la direcci√≥n 0x0), puede descartar este par√°metro </li><li>  reset restablece el chip para que funcione con el nuevo firmware </li></ul><br><p>  El SDK incluye archivos hexadecimales para software suave.  Para llenar s130 en el tablero, puede usar la siguiente secuencia de comandos: </p><br><pre> <code class="plaintext hljs">set file=&lt;nRF5_SDK&gt;/components/softdevice/s130/hex/s130_nrf51_1.0.0_softdevice.hex openocd -f interface/stlink.cfg -f target/nrf51.cfg -c init -c "reset halt" ^ -c "nrf51 mass_erase 0" -c "flash write_image %file%" -c reset -c exit</code> </pre> <br><p>  Entonces puedes subir nuestro firmware.  Es importante que elimine el "nrf51 mass_erase 0" para que el dispositivo no se borre.  Y tampoco te olvides del offset.  Para s130, el desplazamiento es 0x1c000, y para s110 es 0x18000.  Estos valores se pueden encontrar en las especificaciones para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">s130</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">s110</a> . </p><br><pre> <code class="plaintext hljs">set file=&lt;PATH_TO_HEX&gt; openocd -f interface/stlink.cfg -f target/nrf51.cfg -c init -c "reset halt" ^ -c "flash write_image %file% 0x1c000" -c reset -c exit</code> </pre> <br><p>  Ahora en la memoria del programa nrf51822 debe estar el firmware del dispositivo y el nuestro.  Para las pruebas, utilic√© un ejemplo de la carpeta &lt;nRF5_SDK&gt; / examples / ble_peripheral / ble_app_beacon y una aplicaci√≥n de Android llamada "nRF Connect".  Despu√©s de ejecutar los comandos, comenc√© a ver un dispositivo llamado nRF.  Esto es lo que buscamos. </p><br><h1 id="nastroyka-proekta-clion">  Configurar un proyecto CLion </h1><br><p>  El SDK nrf51 contiene ejemplos basados ‚Äã‚Äãen archivos MAKE.  Para trabajar con CLion, es necesario describir el ensamblaje del proyecto utilizando archivos CMake.  Google mostr√≥ que el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">proyecto CMake para nrf51</a> ya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">est√°</a> en el github.  Fue escrito para usar con el SDK 12.XX. Debido a esto, algunas rutas de archivo para nuestro SDK 10.0.0 resultaron ser incorrectas.  Adem√°s, la utilidad nrfjprog tambi√©n se usa en el proyecto.  Por lo tanto, tuve que jugar con la configuraci√≥n del proyecto y reescribir los objetivos del firmware usando OpenOCD.  El resultado de mi trabajo se puede encontrar en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> .  El archivo L√©ame describe instrucciones para configurar un proyecto y depurar en CLion. </p><br><h1 id="ps">  PS </h1><br><p>  Muchos detalles t√©cnicos relacionados con las caracter√≠sticas de nrf51822 eludieron mi narrativa.  Espero que alg√∫n d√≠a llene los vac√≠os agregando un art√≠culo o escribiendo uno nuevo. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439148/">https://habr.com/ru/post/439148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439132/index.html">Vejez inolvidable</a></li>
<li><a href="../439136/index.html">¬øCu√°l es la diferencia entre 4G y 5G?</a></li>
<li><a href="../439138/index.html">Trabajar con devoluciones de llamada en React</a></li>
<li><a href="../439140/index.html">Publicaci√≥n importante sobre invitaciones de perfil</a></li>
<li><a href="../439142/index.html">Dise√±ar modelos de madurez</a></li>
<li><a href="../439150/index.html">¬øQui√©n debe pagar los costos de transacci√≥n?</a></li>
<li><a href="../439152/index.html">Salarios en TI en la segunda mitad de 2018: seg√∫n la calculadora de salarios "My Circle"</a></li>
<li><a href="../439154/index.html">C√≥mo viven los freelancers: dise√±o de portadas de libros, producci√≥n propia de mochilas y viajes</a></li>
<li><a href="../439156/index.html">t1ha = Hash positivo r√°pido</a></li>
<li><a href="../439158/index.html">DataArt lanza el servicio gratuito de mejora de curr√≠culum CV Duck</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>