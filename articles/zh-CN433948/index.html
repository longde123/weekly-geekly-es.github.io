<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤚 🆎 🧑‍🤝‍🧑 如何使付款更方便：IaaS提供商的经验 🥪 ➿ 🤸🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="使用IaaS提供商的服务时的重要问题之一是付款的便利性。 从项目开始的第一天起，我们就尝试简化使用银行卡付款的过程，并继续改进这种机制。 今天，我们决定谈论我们的起点，并分享我们的经验。 

  
 / Flickr / 穆罕默德·阿希克 / CC BY-SA 

 背景知识 
 自2012年以来，...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何使付款更方便：IaaS提供商的经验</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/1cloud/blog/433948/"> 使用IaaS提供商的服务时的重要问题之一是付款的便利性。 从项目开始的第一天起，我们就尝试简化使用银行卡付款的过程，并继续改进这种机制。 今天，我们决定谈论我们的起点，并分享我们的经验。 <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/iy/6k/pv/iy6kpvrzewuk4mudc9nkfwiadu8.jpeg"></a> <a name="habracut"></a><br>  <font color="#A9A9A9"><i>/ Flickr / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">穆罕默德·阿希克</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CC BY-SA</a></i></font> <br><br><h2> 背景知识 </h2><br> 自2012年以来，我们<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一直</a>在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1cloud</a>提供IaaS服务。 在这段时间里，我们<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">设法</a>使用了大量的支付网关。 第一个是Money Online。 我们与他合作了两年，然后开始在潜在技术困难的情况下连接替代服务。 <br><br> 作为替代方案，可以考虑使用PayPal和Robocassa。 结果，两个平台都连接了，尽管<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这样做有些困难</a> 。 在第一种情况下，要将客户ID导入付款表单，我们必须调整CSS规则并修改网页上的标准元素。 在Robocassa的情况下，API中的许多请求与它的描述不匹配，但是在技术支持的帮助下，情况也得到了解决。 我们没有停止这些决定，而是考虑了潜在合作伙伴为我们提供的其他选择。 <br><br> 因此，我们开始使用PayMaster付款系统（它取代了“ Money Online”），为我们提供了优惠的佣金条件和便捷的API。 长期以来，这个支付网关一直是主要的支付网关。 但是，最近我们决定重新设计服务的可用性，并简化通过银行卡为个人支付服务费用的过程。 为了使UX满足我们的要求，我们集成了另一个支付网关CloudPayments。 <br><br><h2> 如何改善UX付款流程？ </h2><br> 我们正在研究预付款模式。 客户在其个人帐户中补充其帐户，然后随着IaaS服务的使用（每10分钟从帐户中扣除）从该帐户中扣除资金。 <br><br> 要使用信用卡补充余额，对于PayMaster，客户必须经历四个步骤： <br><br><ol><li> 在控制台中的表单中输入付款金额，点击“付款”按钮，然后转到付款网关页面。 </li><li> 指明要接收支票的电话或电子邮件地址，然后单击继续。 </li><li> 输入卡的详细信息，然后再次按“支付”按钮。 </li><li> 指示银行作为3D安全程序的一部分发送的交易确认代码。 </li></ol><blockquote>  <i><b>免责声明：</b>上述算法适用于个人进行的银行卡付款。</i>  <i>法人实体通过账单支付IaaS提供商的服务。</i>  <i>在提高可用性的同时，我们最终确定了自动开具此类发票的机制，但是由于法律实体不与支付网关进行交互，因此我们不会在本材料的框架内考虑它们。</i> </blockquote><br> 我们决定简化用户的付款流程，并总体上改善用于填写银行卡数据的表格的外观和可用性。 为此，我们为自己确定了两个任务，我们将在下面讨论。 <br><br><h5> 任务1：排除进入支付网关页面的内容 </h5><br> 如上文所述，当用户为我们的服务付费时，为了填写卡的详细信息，他被迫前往支付网关的站点。 因此，一个人必须按下许多确认按钮，然后等待加载包含有关帐户充值信息的页面。 <br><br> 在这种情况下，出现了另一个问题-用户将钱存入帐户后，他一直停留在支付网关页面上，直到他单击特殊链接返回1cloud.ru为止。 例如，如果用户付款后想要增加其IT基础架构的容量，则这将使我们难以使用控制面板。 <br><br><blockquote>  <i>“根据分析，只有少数客户跟随该链接返回到我们的网站，” 1cloud.ru的开发主管<b>Sergey Belkin</b>说。</i>  <i>-部分原因是客户必须点击“返回在线商店”链接。</i>  <i>尽管事实上我们的服务不是在线商店。”</i> </blockquote><br> 另外，我们希望将用户填写的字段数量减少到最少，仅保留操作真正需要的字段。 为了完成此任务，我们选择了CloudPayments支付网关，其员工最初以快速而完整的技术支持响应引起了我们的关注。 <br><br> 此外，该支付网关在哈萨克斯坦设有代表处。 这样就可以为我们的托管服务<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">oblako.kz</a>实施一种新的付款方式。 否则，我们从哈萨克斯坦到俄罗斯的所有转账（反之亦然）将受到额外的佣金。 <br><br>  CloudPayments建议使用特殊的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">chekout脚本</a> 。 它使您可以直接在我们的控制面板中实施付款表格，并将完成的数据传输到付款网关，而无需将其保存在我们这边。 <br><br> 要实施该脚本，我们必须在一个认可的组织中进行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PCI DSS</a>安全扫描-这是CloudPayments的要求。 必须进行扫描以确认技术是否符合标准，并排除在现场填写表格时盗窃用户数据的可能性。 <br><br>  PCI DSS合规性审核由ARinteg进行。 我们向他们发送了一份申请，其中我们表示希望进行审核，填写调查表并设定验证日期。 在ARinteg方面，准备扫描大约需要半天（也就是说，您几乎可以立即进行扫描），但是我们又花了四到五天的时间来仔细准备我们的基础架构。 <br><br> 扫描持续了大约15个小时，尽管恰好扫描需要几天。  ARinteg的专家在我们的网站上检查了SSL并防止注入请求和其他漏洞。 <br><br> 我们没有通过初始测试，因此得到了需要解决的一系列问题。 所有这些都无关紧要，例如，当用户在站点上评估我们的分步说明时，使用了后方法。 我们删除了所有评论，第二次审核尝试成功。 接下来，我们可以继续执行chekout脚本。 <br><br> 该脚本已在我们的网站上注册，从指定的表格中收集卡数据，并从中编写密码以通过CloudPayments API进行付款。 看起来像这样： <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createCryptogram = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = checkout.createCryptogramPacket(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.success) { <span class="hljs-comment"><span class="hljs-comment">//   alert(result.packet); } else { //     ,  `result.messages` : // { name: "      ", cardNumber: "  " } //  `name`, `cardNumber`    `&lt;input ... data-cp="cardNumber"&gt;` for (var msgName in result.messages) { alert(result.messages[msgName]); } } }; $(function () { /*  checkout */ checkout = new cp.Checkout( // public id    "test_api_00000000000000000000001", // ,     document.getElementById("paymentFormSample")); });</span></span></code> </pre> <br> 输入银行卡数据的表格如下所示： <br><br><img src="https://habrastorage.org/webt/yi/vl/yt/yivlyttyhrz8mgmikdhnr9_8mys.png"><br><br> 在脚本和表单的实现过程中，我们能够将用户填写的字段数量减少到最少。 他们只留下了手术真正必要的那些东西。 例如，字段“名字”和“姓氏”被删除。 正如付款网关的代表向我们解释的那样，银行不会检查此数据（只有卡号，日期和CVV很重要），因此我们决定省略它们并简化整个过程。 <br><br> 此外，我们更清楚地显示了有关<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">折扣计划</a>的信息：一次性充值金额为5000卢布起，其中10％以赠金的形式存入，从10000卢布-20％，超过100000卢布-25％。 我们还添加了为用户保存地图数据的功能。 所有这些信息都以加密形式存储在CloudPayments支付网关的一侧。 <br><br><h5> 任务2：实现自动付款 </h5><br> 这是在某些情况下自动发生的付款。 订阅服务经常使用此功能。 但是，大多数付款网关仅在按计划（在给定日期）进行自动补货时才提供该选项。 对我们而言，重要的是，当客户帐户中的资金用完时（因为我们采用预付款方式），可以随时自动补充帐户。 因此，为了实现自动付款，我们使用了从“记住的”卡（使用临时令牌）付款时使用的方法。 <br><br> 它的工作方式如下：在用户首次成功付款后，网关会为服务卡对生成令牌，并在回发响应中发送令牌。 该令牌已保存，并且在重复付款后已被传输，而不是卡数据。 事实证明，我们向网关发送了一个请求，其中指出了我们的API密钥（标识该请求来自1cloud），令牌和金额。 网关检查是否创建了这样的令牌，并且如果一切正常，它将处理指定金额的付款。 <br><br> 需要自动付款的日期，我们会根据用户当前的服务使用量和帐户余额来动态计算。 假设客户的资产负债表上有1000卢布，并且在最后10分钟的间隔内消耗了2卢布。 显然，归零的大概日期将以五百一十分钟为间隔-这大约是34天。 因此，我们可以在资金用完前几天自动付款。 客户独立选择自动付款大小。 <br><br><h2> 接下来是什么 </h2><br> 现在，我们正在测试这些解决方案并评估实施结果。 根据客户的投票，大多数都是可变的。 我们将更深入地研究有关系统的反馈，分析数据，并在必要时进行调整。 <br><br><h5>  PS我们公司博客中的新鲜材料： </h5><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">以1cloud.ru为例的云服务中的DevOps</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">您需要了解的有关数字签名的知识</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">风险最小化：如何不丢失数据</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433948/">https://habr.com/ru/post/zh-CN433948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433936/index.html">在寻找给孩子的高科技礼物吗？ 想想一个游乐场，而不是一个围栏</a></li>
<li><a href="../zh-CN433938/index.html">Yandex和Google如何总结年度</a></li>
<li><a href="../zh-CN433940/index.html">AppStore中的Review多少钱</a></li>
<li><a href="../zh-CN433944/index.html">毁灭性的例外</a></li>
<li><a href="../zh-CN433946/index.html">人工智能备忘单-丢弃多余的东西，教主要知识。 训练序列处理技术</a></li>
<li><a href="../zh-CN433952/index.html">从HPE选择SAP HANA解决方案的10个理由。 第二部分</a></li>
<li><a href="../zh-CN433954/index.html">八种音频技术和音频小工具将于2019年进入TECnology名人堂</a></li>
<li><a href="../zh-CN433956/index.html">Modders使用AI改善了游戏的质感</a></li>
<li><a href="../zh-CN433958/index.html">Spring Boot上的TDD应用程序：使用数据库</a></li>
<li><a href="../zh-CN433964/index.html">Node.js中的ECMAScript模块：新计划</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>