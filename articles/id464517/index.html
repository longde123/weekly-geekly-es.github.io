<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõüèø üêå ü§µüèº Kartu CUBA Baru ü§õüèº üîµ üìò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bekerja dengan data geospasial dan peta pemetaan adalah bagian integral dari banyak aplikasi bisnis. Ini dapat berupa sistem informasi kota dan region...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kartu CUBA Baru</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/464517/"><p><img src="https://habrastorage.org/getpro/habr/post_images/2b4/8ca/a70/2b48caa7053d14a2edd9cfaecc6b6fb8.png" alt="peta"></p><br><p>  Bekerja dengan data geospasial dan peta pemetaan adalah bagian integral dari banyak aplikasi bisnis.  Ini dapat berupa sistem informasi kota dan regional, aplikasi untuk industri minyak dan gas, sistem manajemen infrastruktur transportasi, serta layanan pengiriman dan banyak lainnya.  Di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Platform CUBA</a> kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">,</a> untuk membangun aplikasi seperti itu, di samping fitur dasar yang disediakan di luar kotak, ada satu set <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tambahan dan komponen yang</a> agak luas.  Salah satunya adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grafik dan Peta</a> , yang, selain menampilkan grafik, memungkinkan Anda untuk mengintegrasikan peta Google ke dalam bagian visual dari aplikasi.  Tahun lalu, Google memperbarui persyaratan penggunaan layanan peta, yang menyebabkan peningkatan biaya, dan juga memperkenalkan kondisi untuk keberadaan wajib profil pembayaran untuk menggunakan API.  Keadaan ini membuat sebagian besar pelanggan berpikir tentang penyedia kartu alternatif, dan kami diminta untuk mengembangkan komponen kartu baru. </p><a name="habracut"></a><br><p>  Sekarang kami senang memperkenalkan komponen yang sama sekali baru - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CUBA Maps</a></strong> .  CUBA Maps melengkapi fungsionalitas aplikasi dengan representasi visual dan alat intuitif untuk mengedit data geospasial.  Komponen bekerja dengan data raster dan vektor.  Anda dapat menggunakan penyedia peta apa pun yang kompatibel dengan protokol Layanan Peta Web atau memberikan ubin dalam format XYZ sebagai data raster.  Untuk bekerja dengan data vektor, komponen menggunakan tipe data geometris (titik, polyline, poligon) dari perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">JTS Topology Suite (JTS)</a> - perpustakaan Java paling populer untuk bekerja dengan data geospasial.  Komponen ini menyediakan semua alat yang diperlukan untuk membuat sistem informasi geografis yang komprehensif berdasarkan CUBA. </p><br><p>  Pada artikel ini, kita akan berbicara tentang fitur-fitur baru yang ditawarkan oleh komponen Maps, dan juga membandingkannya dengan komponen peta kita sebelumnya. </p><br><h2 id="struktura-osnovannaya-na-sloyah">  Struktur berbasis lapisan </h2><br><p>  Komponen ini mendukung struktur multilayer tradisional yang banyak digunakan dalam sistem informasi geografis profesional.  Lapisan terutama dibagi menjadi raster dan vektor.  <em>Lapisan raster</em> terdiri dari gambar raster, sedangkan <em>lapisan</em> vektor berisi geometri vektor. </p><br><p>  Komponen mendukung jenis lapisan berikut: </p><br><ul><li>  <em>Lapisan ubin</em> menampilkan ubin yang disediakan oleh layanan ubin dalam format XYZ. </li><li>  <em>Lapisan Layanan Peta Web (WMS)</em> menampilkan gambar yang disediakan oleh layanan WMS. </li><li>  <em>Lapisan vektor</em> berisi objek-geo (entitas dengan atribut geometris). </li></ul><br><p>  Lapisan-lapisan ini adalah elemen struktural dari peta.  Misalnya, lapisan bawah dapat berupa peta dasar yang terdiri dari ubin, lapisan kedua mungkin berisi poligon yang menggambarkan unit teritorial, misalnya, wilayah, dan lapisan atas dapat berisi titik geografis (lokasi pelanggan, toko, dll.).  Dengan menempatkan lapisan-lapisan ini di atas satu sama lain, kita mendapatkan peta terakhir: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b16/3b2/5f7/b163b25f702af4f76363340b899139b4.png" alt="lapisan"></p><br><p>  Berkat pendekatan ini, Anda dapat membuat peta terstruktur dengan jelas dengan konten apa pun. </p><br><p> CUBA Maps menyediakan komponen visual baru - <code>GeoMap</code> .  Dalam deskriptor XML komponen, Anda dapat mengatur parameter dasar peta, serta seperangkat lapisan yang ditampilkan.  Contoh konfigurasi seperti itu: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tiles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tileProvider</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maps_OpenStreetMap"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Pendekatan ini memungkinkan Anda untuk mencapai lebih banyak fleksibilitas yang kurang dalam <strong>Bagan dan Peta</strong> : </p><br><ul><li>  <em>Layering</em>  Struktur ini memungkinkan Anda membuat kartu dengan konten apa pun, misalnya, menggabungkan ubin yang disediakan oleh berbagai layanan. </li><li>  <em>Lapisan memberikan abstraksi yang menyatukan benda-benda homogen.</em>  Dalam komponen <strong>Bagan dan Peta</strong> , semua konten peta (misalnya, titik, poligon, dll.) Dibuang ke tumpukan umum di komponen UI.  Dalam rangka untuk entah bagaimana menyusun objek-objek ini, tim proyek harus menulis logika tambahan. </li><li>  <em>Metode deklaratif untuk menggambarkan lapisan.</em>  Seperti yang ditunjukkan pada contoh di atas, Anda dapat sepenuhnya menentukan struktur peta (kumpulan layer) di deskriptor XML.  Dalam banyak kasus, ini cukup untuk tidak menerapkan logika tambahan apa pun pada pengontrol layar.  Dengan menggunakan <strong>Bagan dan Peta</strong> , hampir tidak mungkin dilakukan tanpa menulis logika tambahan. </li></ul><br><p>  Menggunakan lapisan petak atau WMS memungkinkan Anda untuk bekerja dengan penyedia peta yang disukai.  Anda tidak terikat dengan penyedia tertentu, seperti di <strong>Bagan dan Peta</strong> . </p><br><p>  Lapisan vektor sangat menyederhanakan tampilan, pengeditan interaktif dan menggambar objek geo di peta. </p><br><p>  Perlu juga dicatat bahwa komponen visual <code>GeoMap</code> secara default memiliki lapisan tambahan khusus - <strong>Kanvas</strong> .  Canvas menyediakan API yang nyaman untuk menampilkan dan menggambar geometri (titik, polyline, poligon) di peta.  Kami akan membahas contoh penggunaan Kanvas di artikel selanjutnya. </p><br><h2 id="geo-obekty">  Objek geo </h2><br><p>  Misalkan kita memiliki entitas yang berisi atribut yang terkait dengan geometri (titik, polyline, poligon).  Kami akan menyebut entitas ini sebagai objek <em>geografis</em> .  Jadi, komponen tersebut sangat menyederhanakan pekerjaan dengan objek-geo. </p><br><p>  Misalnya, pertimbangkan <strong>Alamat</strong> objek geografis: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LOCATION"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Convert</span></span>(converter = CubaPointWKTConverter.class) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Point location; ... }</code> </pre> <br><p>  Ini memiliki atribut <code>location</code> tipe <code>org.locationtech.jts.geom.Point</code> dari <code>org.locationtech.jts.geom.Point</code> JTS Topology Suite (JTS).  Komponen mendukung tipe geometris berikut dari JTS: </p><br><ul><li>  <code>org.locationtech.jts.geom.Point</code> - titik. </li><li>  <code>org.locationtech.jts.geom.LineString</code> - polyline. </li><li>  <code>org.locationtech.jts.geom.Polygon</code> - poligon. </li></ul><br><p>  Atribut <code>location</code> ditandai dengan penjelasan <code>@Geometry</code> .  Anotasi ini mengumumkan bahwa nilai atribut ini harus digunakan saat menampilkan objek geo di peta.  Atribut juga ditandai dengan penjelasan berikut: </p><br><ul><li>  <code>@MetaProperty</code> - dalam hal ini, digunakan untuk menunjukkan atribut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">datatype</a> .  Antarmuka <code>Datatype</code> digunakan oleh kerangka kerja CUBA untuk mengkonversi nilai ke dan dari string. </li><li>  <code>@Convert</code> - Menentukan konverter JPA untuk atribut persisten.  Konverter JPA mengubah nilai atribut antara representasi dalam database dan kode Java.  Komponen menyediakan seperangkat tipe data spasial dan konverter JPA.  Informasi lebih lanjut tersedia dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> komponen.  Anda juga dapat menggunakan implementasi Anda sendiri dari konverter JPA, yang memungkinkan untuk bekerja dengan berbagai sumber data spasial (misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PostGIS</a> ). </li></ul><br><p>  Jadi, untuk mengubah entitas menjadi geo-objek, Anda perlu mendefinisikan atribut tipe geometri JTS dan membubuhi keterangan dengan <code>@Geometry</code> .  Ada pilihan lain - membuat atribut non-persisten dengan menyediakan metode pengambil / penyetel.  Ini bisa bermanfaat jika Anda tidak ingin membuat perubahan pada model data dan membuat ulang skrip DDL. </p><br><p>  Misalnya, pertimbangkan <strong>Alamat</strong> entitas dengan atribut terpisah untuk lintang dan bujur: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.addon.maps.gis.utils.GeometryUtils; ... <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LATITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double latitude; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LONGITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double longitude; ... <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>, related = {<span class="hljs-string"><span class="hljs-string">"latitude"</span></span>, <span class="hljs-string"><span class="hljs-string">"longitude"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Point </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getLatitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getLongitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GeometryUtils.createPoint(getLongitude(), getLatitude()); } <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Point point)</span></span></span><span class="hljs-function"> </span></span>{ Point prevValue = getLocation(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { setLatitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); setLongitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { setLatitude(point.getY()); setLongitude(point.getX()); } propertyChanged(<span class="hljs-string"><span class="hljs-string">"location"</span></span>, prevValue, point); } ... }</code> </pre> <br><p>  Jika Anda memutuskan untuk menggunakan pendekatan ini, pastikan bahwa metode <code>propertyChanged</code> dipanggil dalam setter, karena komponen merespons acara ini dengan memperbarui geometri di peta. </p><br><p>  Sekarang kita telah menyiapkan kelas objek-geo kita, kita dapat menambahkan instance kelas ini ke layer vektor.  <em>Lapisan vektor</em> pada dasarnya adalah elemen penghubung antara data (objek geo) dan peta.  Untuk menghubungkan objek-geo dengan layer, Anda perlu mentransfer wadah data atau, dalam kasus layar usang (hingga versi 7 dari CUBA), sumber data ke layer vektor.  Ini bisa dilakukan dalam deskriptor XML: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Akibatnya, instance kelas <code>Address</code> terkandung dalam wadah addressDc akan ditampilkan pada peta. </p><br><p>  Mari kita pertimbangkan tugas dasar: membuat layar untuk mengedit objek geo dengan peta, tempat Anda dapat mengedit geometri objek.  Untuk mengatasi masalah, Anda perlu mendeklarasikan komponen visual <code>GeoMap</code> di deskriptor XML layar edit dan menambahkan lapisan vektor yang terkait dengan wadah yang berisi objek-geografis yang diedit: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag">"/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Jika Anda menandai layer vektor sebagai dapat diedit, pengeditan interaktif objek geografis pada peta diaktifkan.  Jika geometri objek kosong, peta akan secara otomatis beralih ke mode menggambar.  Seperti yang Anda lihat, untuk menyelesaikan masalah, cukup mendeklarasikan layer vektor pada peta dan meneruskannya dengan data container / sumber data. </p><br><p>  Itu saja.  Jika kami menggunakan <strong>Bagan dan Peta</strong> untuk menyelesaikan masalah yang sama, kami harus menulis cukup banyak kode di pengontrol layar untuk menyediakan fungsionalitas yang serupa.  Dengan komponen baru <strong>Maps,</strong> pemecahan masalah seperti itu jauh lebih sederhana. </p><br><h2 id="canvas">  Kanvas </h2><br><p>  Ada kalanya Anda harus bekerja bukan dengan entitas.  Alih-alih, Anda ingin API sederhana untuk menambah dan menggambar geometri di peta, seperti di <strong>Bagan dan Peta</strong> .  Untuk ini, komponen visual <code>GeoMap</code> memiliki lapisan khusus - <em>Kanvas</em> .  Ini adalah lapisan bantu, yang ada di peta secara default dan yang menyediakan API sederhana untuk menambah dan menggambar geometri di peta.  Anda bisa <code>map.getCanvas()</code> peta <code>map.getCanvas()</code> dengan memanggil metode <code>map.getCanvas()</code> . </p><br><p>  Selanjutnya, kita akan melihat beberapa tugas sederhana, bagaimana mereka diselesaikan di <strong>Bagan dan Peta</strong> dan bagaimana melakukan hal yang sama menggunakan Kanvas. </p><br><h3 id="otobrazhenie-geometriy-na-karte">  Tampilkan geometri di peta </h3><br><p>  Di <strong>Bagan dan Peta,</strong> objek geometri dibuat menggunakan komponen visual peta, digunakan sebagai pabrik, dan kemudian ditambahkan ke peta: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); map.addMarker(marker);</code> </pre> <br><p>  Komponen <strong>Maps</strong> baru bekerja secara langsung dengan kelas-kelas dari perpustakaan JTS: </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); Point point = address.getLocation(); canvasLayer.addPoint(point);</code> </pre> <br><h3 id="redaktirovanie-geometriy">  Pengeditan Geometri </h3><br><p>  Di <strong>Bagan dan Peta,</strong> Anda dapat menetapkan geometri sebagai dapat diedit.  Ketika geometri tersebut diubah melalui UI, peristiwa yang sesuai disebut: </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); marker.setDraggable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); map.addMarker(marker); map.addMarkerDragListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">// do something });</span></span></code> </pre> <br><p>  Dalam komponen <strong>Maps</strong> , saat menambahkan geometri JTS ke Canvas, metode yang sesuai mengembalikan objek khusus yang merupakan representasi dari geometri ini di peta: <code>CanvasLayer.Point</code> , <code>CanvasLayer.Polyline</code> atau <code>CanvasLayer.Polygon</code> .  Objek ini memiliki antarmuka yang lancar untuk mengatur berbagai parameter geometri, juga dapat digunakan untuk berlangganan acara yang terkait dengan geometri, atau untuk menghapus geometri dari Kanvas. </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); CanvasLayer.Point location = canvasLayer.addPoint(address.getLocation()); location.setEditable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setPopupContent(address.getName()) .addModifiedListener(modifiedEvent -&gt; address.setLocation(modifiedEvent.getGeometry()));</code> </pre> <br><h3 id="risovanie-geometriy">  Gambar geometri </h3><br><p>  Di add-on <strong>Charts dan Maps lama</strong> ada komponen tambahan - <code>DrawingOptions</code> .  Itu digunakan untuk mengaktifkan kemampuan menggambar di peta.  Setelah geometri digambar, peristiwa yang sesuai muncul: </p><br><pre> <code class="java hljs">DrawingOptions options = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DrawingOptions(); PolygonOptions polygonOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PolygonOptions(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"#993366"</span></span>, <span class="hljs-number"><span class="hljs-number">0.6</span></span>); ControlOptions controlOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ControlOptions( Position.TOP_CENTER, Arrays.asList(OverlayType.POLYGON)); options.setEnableDrawingControl(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); options.setPolygonOptions(polygonOptions); options.setDrawingControlOptions(controlOptions); options.setInitialDrawingMode(OverlayType.POLYGON); map.setDrawingOptions(options); map.addPolygonCompleteListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">//do something });</span></span></code> </pre> <br><p>  Komponen Maps membuat hal yang sama lebih mudah.  Kanvas <strong>Peta</strong> baru berisi sekumpulan metode untuk menggambar geometri.  Misalnya, untuk menggambar poligon, gunakan metode <code>canvas.drawPolygon()</code> .  Setelah memanggil metode ini, peta akan beralih ke mode menggambar poligon.  Metode ini menerima fungsi <code>Consumer&lt;CanvasLayer.Polygon&gt;</code> , di mana Anda dapat melakukan tindakan tambahan dengan poligon yang ditarik. </p><br><pre> <code class="java hljs">canvasLayer.drawPolygon(polygon -&gt; { territory.setPolygon(polygon.getGeometry()); });</code> </pre> <br><h2 id="instrumenty-dlya-geo-analiza">  Alat Analisis Geo </h2><br><h3 id="klasterizaciya">  Clustering </h3><br><p>  Alat lain yang bermanfaat yang ada dalam komponen Maps baru adalah pengelompokan titik.  Jika layer terdiri dari sejumlah besar titik, Anda dapat mengaktifkan pengelompokan untuk mengelompokkan titik-titik terdekat ke dalam cluster sehingga peta terlihat lebih rapi dan lebih baik: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6c/166/4d7/e6c1664d7e9092880dfcf13cc4dca58c.jpg" alt="gugus"></p><br><p>  Clustering diaktifkan dengan menambahkan tag <code>cluster</code> di dalam tag <code>vector</code> di deskriptor XML: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locations"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locationsDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Anda juga dapat mengaktifkan pengelompokan berdasarkan bobot titik.  Bobot titik adalah nilai atribut yang ditentukan dalam parameter <code>weightProperty</code> . </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"orders"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ordersDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weightProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"amount"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="teplovye-karty">  Heatmaps </h3><br><p>  Heatmaps adalah representasi visual dari kepadatan data di berbagai lokasi geografis.  Komponen visual GeoMap berisi metode untuk menambahkan peta panas: <code>addHeatMap(Map&lt;Point, Double&gt; intensityMap)</code> . </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/722/10b/289/72210b289dd04fcf41cc4ebec062c2d5.jpg" alt="peta panas"></p><br><h2 id="zaklyuchenie">  Kesimpulan </h2><br><p>  Pemrosesan, analisis, dan visualisasi data geospasial adalah elemen penting dari banyak aplikasi bisnis.  Komponen <strong>CUBA Maps</strong> akan menyediakan aplikasi CUBA Anda dengan semua alat yang diperlukan untuk mengimplementasikan fungsi ini. </p><br><p>  Struktur berbasis layer membantu membangun peta dengan konten apa pun.  Dengan lapisan ubin / WMS, Anda dapat menggunakan penyedia apa pun yang Anda butuhkan sebagai kartu dasar.  Lapisan vektor memungkinkan Anda untuk bekerja secara efektif dengan set objek geo yang homogen.  Canvas menyediakan API sederhana untuk menampilkan dan menggambar geometri di peta. </p><br><p>  Komponen ini bekerja dengan tipe spasial dari perpustakaan JTS, yang membuatnya kompatibel dengan banyak kerangka kerja lainnya (misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GeoTools</a> ) untuk menyelesaikan berbagai tugas terkait dengan pemrosesan dan analisis data geografis. </p><br><p>  Kami harap Anda menikmati komponennya.  Menunggu tanggapan Anda! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id464517/">https://habr.com/ru/post/id464517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id464503/index.html">Kata sandi Wi-Fi cocok dengan aircrack-ng</a></li>
<li><a href="../id464509/index.html">Buku "Belajar mendalam Grok"</a></li>
<li><a href="../id464511/index.html">Cara mengumpulkan kohort pengguna dalam bentuk grafik di Grafana [+ buruh pelabuhan gambar dengan contoh]</a></li>
<li><a href="../id464513/index.html">Duffle: Transformer dari XD Design</a></li>
<li><a href="../id464515/index.html">Cara Membuat Email dan Tidak Mengacaukan: Kiat Praktis</a></li>
<li><a href="../id464523/index.html">Sistem Pembayaran (PSP) untuk bisnis TI: kami bermain besar</a></li>
<li><a href="../id464525/index.html">Konverter JSON Anda sendiri atau lebih banyak tentang ExpressionTrees</a></li>
<li><a href="../id464529/index.html">Untuk iklan kontekstual dengan nama pesaing sekarang dapat didenda 500.000 rubel</a></li>
<li><a href="../id464535/index.html">Detail tentang perangkat dan fungsi skuter listrik KickScooter T60</a></li>
<li><a href="../id464537/index.html">Arduino DIY Carousel Iblis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>