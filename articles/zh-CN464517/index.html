<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍⚕️ 👩🏽‍🎓 🍜 新的CUBA卡 🕑 🍣 🏩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="处理地理空间数据和地图是许多业务应用程序不可或缺的部分。 它可以是城市和区域信息系统，石油和天然气行业的应用程序，运输基础设施管理系统以及交付服务等。 在我们的CUBA平台中，除了开箱即用提供的基本功能之外，要构建此类应用程序，还提供了相当广泛的附加组件和组件 。 其中之一是Charts and M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>新的CUBA卡</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/464517/"><p><img src="https://habrastorage.org/getpro/habr/post_images/2b4/8ca/a70/2b48caa7053d14a2edd9cfaecc6b6fb8.png" alt="地图"></p><br><p> 处理地理空间数据和地图是许多业务应用程序不可或缺的部分。 它可以是城市和区域信息系统，石油和天然气行业的应用程序，运输基础设施管理系统以及交付服务等。 在我们的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBA平台中，</a>除了开箱即用提供的基本功能之外<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">，</a>要构建此类应用程序，还提供了相当广泛<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的附加组件和组件</a> 。 其中之一是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Charts and Maps</a> ，除了显示图表外，还可以将Google Maps集成到应用程序的可视部分。 去年，谷歌更新了其地图服务的使用条款，这导致成本增加，并且还引入了强制使用API​​的付款资料必须存在的条件。 这些情况导致大多数客户考虑使用替代卡提供商，因此系统提示我们开发新的卡组件。 </p><a name="habracut"></a><br><p> 现在，我们很高兴地介绍一个全新的组件<strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-CUBA Maps</a></strong> 。  CUBA Maps以可视化表示和直观的工具来补充应用程序功能，以编辑地理空间数据。 该组件可同时处理栅格数据和矢量数据。 您可以使用任何与Web Map Service协议兼容的地图提供程序，也可以使用XYZ格式的图块作为栅格数据。 为了处理矢量数据，该组件使用来自<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JTS拓扑套件（JTS）</a>库的几何数据类型（点，折线，多边形）-最流行的Java库，用于处理地理空间数据。 该组件提供了用于创建基于CUBA的全面地理信息系统的所有必要工具。 </p><br><p> 在本文中，我们将讨论Maps组件提供的新功能，并将其与我们以前的map组件进行比较。 </p><br><h2 id="struktura-osnovannaya-na-sloyah"> 基于层的结构 </h2><br><p> 该组件支持在专业地理信息系统中广泛使用的传统多层结构。 图层主要分为栅格和矢量。  <em>栅格图层</em>由栅格图像组成，而<em>矢量图层</em>包含矢量几何。 </p><br><p> 该组件支持以下类型的层： </p><br><ul><li> 切片<em>层</em>以XYZ格式显示切片服务提供的切片。 </li><li>  <em>Web地图服务（WMS）层</em>显示WMS服务提供的图像。 </li><li>  <em>向量层</em>包含地理对象（具有几何属性的实体）。 </li></ul><br><p> 这些图层是地图的结构元素。 例如，下层可以是由图块组成的底图，第二层可以包含描述领土单位（例如区域）的多边形，而上层可以包含地理位置（客户，商店等的位置）。 将这些图层叠加在一起，我们得到最终的地图： </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b16/3b2/5f7/b163b25f702af4f76363340b899139b4.png" alt="层数"></p><br><p> 通过这种方法，您可以创建包含任何内容的结构清晰的地图。 </p><br><p> CUBA Maps提供了一个新的可视组件<code>GeoMap</code> 。 在组件的XML描述符中，您可以设置地图的基本参数以及一组显示的图层。 这种配置的示例： </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tiles"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tileProvider</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maps_OpenStreetMap"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"territoryDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> 这种方法可让您获得<strong>图表和地图</strong>所缺乏的更多灵活性： </p><br><ul><li>  <em>分层。</em> 这种结构允许您构建具有任何内容的卡，例如，结合各种服务提供的图块。 </li><li>  <em>层提供了将同类对象聚集在一起的抽象。</em> 在“ <strong>图表和地图”</strong>组件中，所有地图内容（例如点，多边形等）都被转储到UI组件的公共堆中。 为了以某种方式构造这些对象，项目团队必须编写其他逻辑。 </li><li>  <em>一种描述层的声明方法。</em> 如上面的示例所示，您可以在XML描述符中完全指定地图结构（图层集）。 在许多情况下，这足以在屏幕控制器中不实现任何其他逻辑。 如果不使用其他逻辑，使用<strong>图表和地图</strong>几乎是不可能的。 </li></ul><br><p> 使用图块图层或WMS，可以与任何首选的地图提供程序一起使用。 您不受限于特定提供者，就像在<strong>Charts和Maps中那样</strong> 。 </p><br><p> 矢量图层极大地简化了地理对象在地图上的显示，交互式编辑和绘制。 </p><br><p> 还要注意的是，默认情况下， <code>GeoMap</code>的可视组件具有特殊的辅助层<strong>Canvas</strong> 。  Canvas提供了一个方便的API，用于在地图上显示和绘制几何图形（点，折线，多边形）。 我们将在本文后面介绍使用Canvas的示例。 </p><br><h2 id="geo-obekty"> 地理对象 </h2><br><p> 假设我们有一个实体，其中包含与几何相关的属性（点，折线，多边形）。 我们将这个实体称为<em>geo-object</em> 。 因此，该组件极大地简化了地理对象的工作。 </p><br><p> 例如，考虑地理对象<strong>Address</strong> ： </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LOCATION"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Convert</span></span>(converter = CubaPointWKTConverter.class) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Point location; ... }</code> </pre> <br><p> 它具有JTS拓扑套件（JTS）库中的<code>org.locationtech.jts.geom.Point</code>类型的<code>location</code>属性。 该组件支持JTS中的以下几何类型： </p><br><ul><li>  <code>org.locationtech.jts.geom.Point</code>时间段。 </li><li>  <code>org.locationtech.jts.geom.LineString</code>折线。 </li><li>  <code>org.locationtech.jts.geom.Polygon</code>多边形。 </li></ul><br><p> 用<code>@Geometry</code>注释标记<code>location</code>属性。 此注释宣布在地图上显示地理对象时应使用此属性的值。 该属性还标有以下注释： </p><br><ul><li>  <code>@MetaProperty</code>在这种情况下，用于指示<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">数据类型</a>属性。  CUBA框架使用<code>Datatype</code>接口在字符串之间来回转换值。 </li><li>  <code>@Convert</code>为持久属性定义JPA转换器。  JPA转换器在数据库和Java代码的表示形式之间转换属性值。 该组件提供了一组空间数据类型和JPA转换器。 组件<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档中</a>提供了更多信息。 您还可以使用自己的JPA转换器实现，这使得可以处理各种空间数据源（例如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PostGIS</a> ）。 </li></ul><br><p> 因此，为了将一个实体变成一个地理对象，您需要定义一个JTS几何类型的属性，并使用<code>@Geometry</code>对其进行<code>@Geometry</code> 。 还有另一种选择-通过提供getter / setter方法来创建非持久属性。 如果您不想更改数据模型并重新生成DDL脚本，这将很有用。 </p><br><p> 例如，考虑具有单独的纬度和经度属性的实体<strong>地址</strong> ： </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.haulmont.addon.maps.gis.utils.GeometryUtils; ... <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LATITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double latitude; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"LONGITUDE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Double longitude; ... <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>, related = {<span class="hljs-string"><span class="hljs-string">"latitude"</span></span>, <span class="hljs-string"><span class="hljs-string">"longitude"</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Point </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getLatitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getLongitude() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GeometryUtils.createPoint(getLongitude(), getLatitude()); } <span class="hljs-meta"><span class="hljs-meta">@Geometry</span></span> <span class="hljs-meta"><span class="hljs-meta">@MetaProperty</span></span>(datatype = <span class="hljs-string"><span class="hljs-string">"GeoPoint"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Point point)</span></span></span><span class="hljs-function"> </span></span>{ Point prevValue = getLocation(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { setLatitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); setLongitude(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { setLatitude(point.getY()); setLongitude(point.getX()); } propertyChanged(<span class="hljs-string"><span class="hljs-string">"location"</span></span>, prevValue, point); } ... }</code> </pre> <br><p> 如果决定使用此方法，请确保在setter中调用<code>propertyChanged</code>方法，因为组件通过更新地图上的几何来响应此事件。 </p><br><p> 现在，我们已经准备好地理对象的类，可以将此类的实例添加到矢量层。  <em>向量层</em>本质上是数据（地理对象）和地图之间的连接元素。 要将地理对象与图层连​​接，您需要传输数据容器，或者在屏幕陈旧（CUBA的版本7以下）的情况下，将数据源传输到矢量层。 这可以在XML描述符中完成： </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressesDc"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> 结果，包含在<code>addressesDc</code>容器中的<code>Address</code>类实例将显示在地图上。 </p><br><p> 考虑一下基本任务：创建一个用于编辑带有地图的地理对象的屏幕，您可以在其中编辑对象的几何形状。 要解决该问题，您需要在编辑屏幕的XML描述符中声明GeoMap的可视组件，并添加一个与包含已编辑地理对象的容器关联的矢量层： </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">center</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"37.615, 55.752"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">zoom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selectedLayer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:tile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span><span class="hljs-tag">"/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressLayer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"addressDc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">editable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:layers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:geoMap</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> 如果将矢量图层标记为可编辑，则将激活对地图上地理对象的交互式编辑。 如果对象的几何形状为空，则地图将自动切换到绘图模式。 如您所见，要解决此问题，在地图上声明一个矢量层并将其传递给数据容器/数据源就足够了。 </p><br><p> 仅此而已。 如果我们使用“ <strong>图表”和“地图”</strong>解决相同的问题，则必须在屏幕控制器中编写大量代码才能提供类似的功能。 使用<strong>Maps</strong>的新组件<strong>，</strong>解决这些问题变得更加简单。 </p><br><h2 id="canvas"> 帆布 </h2><br><p> 有时您需要不使用实体。 相反，您想要一个简单的API在地图上添加和绘制几何图形，就像在<strong>Charts和Maps中一样</strong> 。 为此， <code>GeoMap</code>视觉组件具有特殊的图层<em>-Canvas</em> 。 这是一个辅助层，默认情况下位于地图上，并提供用于在地图上添加和绘制几何图形的简单API。 您可以通过调用<code>map.getCanvas()</code>方法<code>map.getCanvas()</code>地图。 </p><br><p> 接下来，我们将看一些简单的任务，如何在“ <strong>图表”和“地图”</strong>中解决它们，以及如何使用Canvas来完成这些任务。 </p><br><h3 id="otobrazhenie-geometriy-na-karte"> 在地图上显示几何 </h3><br><p> 在“ <strong>图表和地图”中，</strong>使用地图的可视组件创建几何对象，并用作工厂，然后将其添加到地图中： </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); map.addMarker(marker);</code> </pre> <br><p> 新的<strong>Maps</strong>组件可直接与JTS库中的类一起使用： </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); Point point = address.getLocation(); canvasLayer.addPoint(point);</code> </pre> <br><h3 id="redaktirovanie-geometriy"> 几何编辑 </h3><br><p> 在“ <strong>图表和地图”中，</strong>可以将几何指定为可编辑的。 当通过UI更改此类几何时，相应的事件称为： </p><br><pre> <code class="java hljs">Marker marker = map.createMarker(); GeoPoint position = map.createGeoPoint(lat, lon); marker.setPosition(position); marker.setDraggable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); map.addMarker(marker); map.addMarkerDragListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">// do something });</span></span></code> </pre> <br><p> 在<strong>Maps</strong>组件中，将JTS几何体添加到Canvas时，相应的方法将返回一个特殊对象，该对象是该几何体在地图上的表示形式： <code>CanvasLayer.Point</code> ， <code>CanvasLayer.Polyline</code>或<code>CanvasLayer.Polygon</code> 。 该对象具有用于设置各种几何参数的流畅接口，也可以用于订阅与几何相关的事件，或从“画布”中删除几何。 </p><br><pre> <code class="java hljs">CanvasLayer canvasLayer = map.getCanvas(); CanvasLayer.Point location = canvasLayer.addPoint(address.getLocation()); location.setEditable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setPopupContent(address.getName()) .addModifiedListener(modifiedEvent -&gt; address.setLocation(modifiedEvent.getGeometry()));</code> </pre> <br><h3 id="risovanie-geometriy"> 几何图 </h3><br><p> 在旧的附加<strong>图表和地图中，</strong>有一个辅助组件<code>DrawingOptions</code> 。 它用于激活在地图上绘制的功能。 绘制几何图形后，引发相应的事件： </p><br><pre> <code class="java hljs">DrawingOptions options = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DrawingOptions(); PolygonOptions polygonOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PolygonOptions(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"#993366"</span></span>, <span class="hljs-number"><span class="hljs-number">0.6</span></span>); ControlOptions controlOptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ControlOptions( Position.TOP_CENTER, Arrays.asList(OverlayType.POLYGON)); options.setEnableDrawingControl(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); options.setPolygonOptions(polygonOptions); options.setDrawingControlOptions(controlOptions); options.setInitialDrawingMode(OverlayType.POLYGON); map.setDrawingOptions(options); map.addPolygonCompleteListener(event -&gt; { <span class="hljs-comment"><span class="hljs-comment">//do something });</span></span></code> </pre> <br><p> 地图组件使操作变得更加容易。 新的“ <strong>地图</strong>画布”包含一组用于绘制几何图形的方法。 例如，要绘制多边形，请使用<code>canvas.drawPolygon()</code>方法。 调用此方法后，地图将切换到多边形绘制模式。 该方法接受<code>Consumer&lt;CanvasLayer.Polygon&gt;</code>函数，您可以在其中对绘制的多边形执行其他操作。 </p><br><pre> <code class="java hljs">canvasLayer.drawPolygon(polygon -&gt; { territory.setPolygon(polygon.getGeometry()); });</code> </pre> <br><h2 id="instrumenty-dlya-geo-analiza"> 地理分析工具 </h2><br><h3 id="klasterizaciya"> 聚类 </h3><br><p> 新的Maps组件中存在的另一个有用工具是点聚类。 如果图层由大量点组成，则可以启用聚类，将附近的点分组为聚类，以使地图看起来更整洁，更易于感知： </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6c/166/4d7/e6c1664d7e9092880dfcf13cc4dca58c.jpg" alt="集群"></p><br><p> 通过在XML描述符的<code>vector</code>标签内添加<code>cluster</code>标签来启用<code>cluster</code> ： </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locations"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"locationsDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> 您还可以基于点权重启用聚类。 点的权重是<code>weightProperty</code>参数中指定的属性的值。 </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"orders"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ordersDc"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:cluster</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">weightProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"amount"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maps:vector</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="teplovye-karty"> 热图 </h3><br><p> 热图是跨多个地理位置的数据密度的直观表示。  <code>addHeatMap(Map&lt;Point, Double&gt; intensityMap)</code>的可视化组件包含一种添加热图的方法： <code>addHeatMap(Map&lt;Point, Double&gt; intensityMap)</code> 。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/722/10b/289/72210b289dd04fcf41cc4ebec062c2d5.jpg" alt="热图"></p><br><h2 id="zaklyuchenie"> 结论 </h2><br><p> 地理空间数据的处理，分析和可视化是许多业务应用程序的基本要素。  <strong>CUBA Maps</strong>组件将为您的CUBA应用程序提供实现此功能所需的所有必要工具。 </p><br><p> 基于图层的结构有助于构建具有任何内容的地图。 使用tile / WMS图层，您可以将所需的任何提供程序用作基础卡。 向量图层可让您有效地处理同类的地理对象集。  Canvas提供了一个简单的API，用于在地图上显示和绘制几何图形。 </p><br><p> 该组件可与JTS库中的空间类型配合使用，从而使其与许多其他框架（例如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GeoTools</a> ）兼容，以解决与地理数据处理和分析有关的各种任务。 </p><br><p> 我们希望您喜欢该组件。 等待您的反馈！ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464517/">https://habr.com/ru/post/zh-CN464517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464503/index.html">与aircrack-ng匹配的Wi-Fi密码</a></li>
<li><a href="../zh-CN464509/index.html">《希腊语深度学习》一书</a></li>
<li><a href="../zh-CN464511/index.html">如何在Grafana中以图表的形式收集用户群组[+带有示例的docker图像]</a></li>
<li><a href="../zh-CN464513/index.html">Duffle：XD Design的变形金刚</a></li>
<li><a href="../zh-CN464515/index.html">如何制作电子邮件而不是一团糟：实用技巧</a></li>
<li><a href="../zh-CN464523/index.html">IT业务的支付系统（PSP）：我们发挥重要作用</a></li>
<li><a href="../zh-CN464525/index.html">您自己的JSON转换器或有关ExpressionTrees的更多内容</a></li>
<li><a href="../zh-CN464529/index.html">对于竞争对手的名字进行的上下文广告，现在可以被罚款500,000卢布。</a></li>
<li><a href="../zh-CN464535/index.html">KickScooter T60电动滑板车的设备和功能的详细信息</a></li>
<li><a href="../zh-CN464537/index.html">Arduino DIY恶魔轮播</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>