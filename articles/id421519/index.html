<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👌🏻 🤛🏻 ❔ Buku "Apache Kafka. Pemrosesan aliran dan analisis data ” ✌🏼 🐖 🤸🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selama pekerjaan aplikasi perusahaan apa pun, data dihasilkan: ini adalah file log, metrik, informasi tentang aktivitas pengguna, pesan keluar, dll. M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Buku "Apache Kafka. Pemrosesan aliran dan analisis data ”</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/421519/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/t6/ej/tx/t6ejtxboknf_ha_u7radv1gzrls.jpeg" align="left" alt="gambar"></a>  Selama pekerjaan aplikasi perusahaan apa pun, data dihasilkan: ini adalah file log, metrik, informasi tentang aktivitas pengguna, pesan keluar, dll. Manipulasi yang tepat dari semua data ini tidak kalah pentingnya daripada data itu sendiri.  Jika Anda seorang arsitek, pengembang, atau insinyur lulusan yang ingin menyelesaikan masalah seperti itu, tetapi belum mengenal Apache Kafka, maka dari buku yang luar biasa ini Anda akan belajar cara bekerja dengan platform streaming gratis ini yang memungkinkan Anda memproses antrian data secara real time. <br><br><h3>  Untuk siapa buku ini? </h3><br>  “Apache Kafka.  Pemrosesan aliran dan analisis data ”ditulis untuk pengembang yang menggunakan Kafka API dalam pekerjaan mereka, serta insinyur proses (juga disebut SRE, DevOps atau administrator sistem) yang terlibat dalam pemasangan, konfigurasi, konfigurasi, dan pemantauan operasinya selama operasi industri.  Kami juga tidak melupakan arsitek data dan insinyur analitik - mereka yang bertanggung jawab atas desain dan pembuatan seluruh infrastruktur data perusahaan.  Beberapa bab, khususnya 3, 4 dan 11, ditujukan untuk pengembang Java.  Untuk memahaminya, penting bagi pembaca untuk memahami dasar-dasar bahasa pemrograman Java, termasuk masalah-masalah seperti penanganan pengecualian dan kompetisi. <br><a name="habracut"></a><br>  Bab-bab lain, terutama 2, 8, 9, dan 10, mengasumsikan bahwa pembaca memiliki pengalaman dengan Linux dan terbiasa dengan pengaturan jaringan dan penyimpanan Linux.  Sisa dari arsitektur buku dan perangkat lunak Kafka dibahas secara umum, sehingga tidak diperlukan pengetahuan khusus dari pembaca. <br><br>  Kategori lain dari orang yang mungkin tertarik dengan buku ini adalah manajer dan arsitek yang bekerja tidak secara langsung dengan Kafka, tetapi dengan mereka yang bekerja dengannya.  Tidak kalah penting bahwa mereka memahami apa jaminan platform dan apa kompromi yang harus dilakukan bawahan dan kolega mereka ketika membuat sistem berbasis Kafka.  Buku ini akan berguna bagi para manajer yang ingin melatih karyawan mereka untuk bekerja dengan Kafka atau untuk memastikan bahwa tim pengembangan memiliki informasi yang diperlukan. <br><br><h3>  Bab 2. Memasang Kafka </h3><br>  Apache Kafka adalah aplikasi Java yang dapat berjalan di banyak sistem operasi, termasuk Windows, MacOS, Linux, dan lainnya. Dalam bab ini, kita akan fokus pada pemasangan Kafka di Linux, karena itu adalah platform yang paling sering diinstal pada sistem operasi ini.  Linux juga merupakan sistem operasi yang direkomendasikan untuk penyebaran Kafka untuk tujuan umum.  Untuk informasi tentang menginstal Kafka di Windows dan MacOS, lihat Lampiran A. <br><br>  <b>Instal java</b> <br><br>  Sebelum menginstal ZooKeeper atau Kafka, Anda harus menginstal dan mengkonfigurasi lingkungan Java.  Disarankan agar Anda menggunakan Java 8, dan ini mungkin versi, baik yang termasuk dalam sistem operasi Anda atau langsung diunduh dari java.com.  Meskipun ZooKeeper dan Kafka akan bekerja dengan Java Runtime Edition, lebih nyaman menggunakan Java Development Kit (JDK) penuh saat mengembangkan utilitas dan aplikasi.  Langkah-langkah instalasi ini mengasumsikan bahwa Anda memiliki JDK versi 8.0.51 diinstal di direktori /usr/java/jdk1.8.0_51. <br><br>  <b>Instal ZooKeeper</b> <br><br>  Apache Kafka menggunakan ZooKeeper untuk menyimpan metadata tentang cluster Kafka, serta detail tentang klien konsumen (Gbr. 2.1).  Meskipun ZooKeeper juga dapat diluncurkan menggunakan skrip yang termasuk dalam distribusi Kafka, menginstal versi lengkap dari repositori ZooKeeper dari distribusinya sangat sederhana. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/a-/ye/ed/a-yeeda4ysojxtp4kcwlnmufwlc.png" alt="gambar"></div><br>  Kafka telah diuji secara menyeluruh dengan versi stabil dari repositori ZooKeeper, yang dapat diunduh dari apache.org. <br><br>  <b>Server mandiri</b> <br><br>  Contoh berikut menunjukkan menginstal ZooKeeper dengan pengaturan dasar di direktori / usr / local / zookeeper dan menyimpan data di direktori / var / lib / zookeeper: <br><br><pre><code class="hljs delphi"># tar -zxf zookeeper-<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span>.tar.gz # mv zookeeper-<span class="hljs-number"><span class="hljs-number">3.4</span></span>.<span class="hljs-number"><span class="hljs-number">6</span></span> /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/zookeeper # mkdir -p /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/zookeeper # cat &gt; /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/zookeeper/conf/zoo.cfg &lt;&lt; EOF &gt; tickTime=<span class="hljs-number"><span class="hljs-number">2000</span></span> &gt; dataDir=/<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/zookeeper &gt; clientPort=<span class="hljs-number"><span class="hljs-number">2181</span></span> &gt; EOF # /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/zookeeper/bin/zkServer.sh start JMX enabled by <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Using config: /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/zookeeper/bin/../conf/zoo.cfg Starting zookeeper ... STARTED # <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> JAVA_HOME=/usr/java/jdk1.<span class="hljs-number"><span class="hljs-number">8.0</span></span>_51 # /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/zookeeper/bin/zkServer.sh start JMX enabled by <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Using config: /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/zookeeper/bin/../conf/zoo.cfg Starting zookeeper ... STARTED #</code> </pre> <br>  Sekarang Anda dapat memverifikasi bahwa ZooKeeper seharusnya bekerja offline dengan menghubungkan ke port klien dan mengirim perintah srvr empat huruf: <br><br><pre> <code class="hljs pgsql"># telnet localhost <span class="hljs-number"><span class="hljs-number">2181</span></span> Trying ::<span class="hljs-number"><span class="hljs-number">1.</span></span>.. Connected <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> localhost. <span class="hljs-keyword"><span class="hljs-keyword">Escape</span></span> <span class="hljs-type"><span class="hljs-type">character</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-string"><span class="hljs-string">'^]'</span></span>. srvr Zookeeper <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>: <span class="hljs-number"><span class="hljs-number">3.4</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span><span class="hljs-number"><span class="hljs-number">-1569965</span></span>, built <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>/<span class="hljs-number"><span class="hljs-number">2014</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span> GMT Latency min/avg/max: <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> Received: <span class="hljs-number"><span class="hljs-number">1</span></span> Sent: <span class="hljs-number"><span class="hljs-number">0</span></span> Connections: <span class="hljs-number"><span class="hljs-number">1</span></span> Outstanding: <span class="hljs-number"><span class="hljs-number">0</span></span> Zxid: <span class="hljs-number"><span class="hljs-number">0x0</span></span> Mode: standalone Node count: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span> closed <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreign</span></span> host. #</code> </pre> <br>  <b>Ensemble ZooKeeper</b> <br><br>  Cluster ZooKeeper disebut ansambel.  Karena sifat algoritme itu sendiri, disarankan agar ansambel menyertakan jumlah server ganjil, misalnya, 3, 5, dll., Karena agar ZooKeeper dapat menanggapi permintaan, mayoritas anggota ansambel harus berfungsi (kuorum).  Ini berarti bahwa ansambel tiga node dapat bekerja dengan satu node idle.  Jika ensembel memiliki tiga node, mungkin ada dua. <br><br>  Untuk mengkonfigurasi operasi server ZooKeeper di ensemble, mereka harus memiliki konfigurasi tunggal dengan daftar semua server, dan setiap server dalam direktori data harus memiliki file myid dengan pengidentifikasi server ini.  Jika host di ensemble diberi nama zoo1.example.com, zoo2.example.com dan zoo3.example.com, maka file konfigurasi mungkin terlihat seperti ini: <br><br><pre> <code class="hljs pgsql">tickTime=<span class="hljs-number"><span class="hljs-number">2000</span></span> dataDir=/var/lib/zookeeper clientPort=<span class="hljs-number"><span class="hljs-number">2181</span></span> initLimit=<span class="hljs-number"><span class="hljs-number">20</span></span> syncLimit=<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>=zoo1.example.com:<span class="hljs-number"><span class="hljs-number">2888</span></span>:<span class="hljs-number"><span class="hljs-number">3888</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>=zoo2.example.com:<span class="hljs-number"><span class="hljs-number">2888</span></span>:<span class="hljs-number"><span class="hljs-number">3888</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>=zoo3.example.com:<span class="hljs-number"><span class="hljs-number">2888</span></span>:<span class="hljs-number"><span class="hljs-number">3888</span></span></code> </pre> <br>  Dalam konfigurasi ini, initLimit adalah jumlah waktu yang dapat dihubungkan oleh slave node ke master.  Nilai syncLimit membatasi kelambatan node slave dari master.  Kedua nilai ditentukan dalam satuan tickTime, mis. InitLimit = 20 · 2000 ms = 40 dtk.  Konfigurasi ini juga mencantumkan semua server ensemble.  Mereka berada dalam format server.X = hostname: peerPort: leaderPort dengan parameter berikut: <br><br><ul><li>  X adalah pengidentifikasi server.  Itu harus bilangan bulat, tetapi hitungannya mungkin bukan dari nol dan tidak berurutan; </li><li>  hostname - nama host atau alamat IP server; </li><li>  peerPort - port TCP di mana server ensemble berkomunikasi satu sama lain; </li><li>  leaderPort - port TCP di mana host dipilih. </li></ul><br>  Sudah cukup bahwa klien dapat terhubung ke ensemble melalui port clientPort, tetapi anggota ensemble harus dapat bertukar pesan satu sama lain di ketiga port. <br><br>  Selain file konfigurasi tunggal, setiap server di direktori dataDir harus memiliki file myid.  Seharusnya berisi pengidentifikasi server yang sesuai dengan yang diberikan dalam file konfigurasi.  Setelah menyelesaikan langkah-langkah ini, Anda dapat memulai server dan mereka akan berinteraksi satu sama lain dalam ansambel. <br><br><h3>  Menginstal Kafka Broker </h3><br>  Setelah menyelesaikan konfigurasi Java dan ZooKeeper, Anda dapat melanjutkan dengan instalasi Apache Kafka.  Rilis terbaru Apache Kafka dapat diunduh di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kafka.apache.org/downloads.html</a> . <br><br>  Pada contoh berikut, instal platform Kafka di direktori / usr / local / kafka, konfigurasikan untuk menggunakan server ZooKeeper yang diluncurkan sebelumnya dan simpan segmen log pesan di direktori / tmp / kafka-logs: <br><br><pre> <code class="hljs pgsql"># tar -zxf kafka_2<span class="hljs-number"><span class="hljs-number">.11</span></span><span class="hljs-number"><span class="hljs-number">-0.9</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>.tgz # mv kafka_2<span class="hljs-number"><span class="hljs-number">.11</span></span><span class="hljs-number"><span class="hljs-number">-0.9</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/kafka # mkdir /tmp/kafka-logs # export JAVA_HOME=/usr/java/jdk1<span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>_51 # /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/kafka/bin/kafka-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>.sh -daemon /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/kafka/config/<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.properties #</code> </pre> <br>  Setelah meluncurkan pialang Kafka, Anda dapat menguji fungsinya dengan melakukan operasi sederhana apa pun dengan cluster, termasuk membuat topik pengujian, membuat pesan, dan menggunakannya. <br><br>  Membuat dan memeriksa utas: <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta"># /usr/local/kafka/bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test Created topic </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"test"</span></span></span><span class="hljs-meta">. # /usr/local/kafka/bin/kafka-topics.sh --zookeeper localhost:2181 --describe --topic test Topic:test PartitionCount:1 ReplicationFactor:1 Configs: Topic: test Partition: 0 Leader: 0 Replicas: 0 Isr: 0 #</span></span></code> </pre> <br>  Membuat pesan untuk topik pengujian: <br><br><pre> <code class="hljs delphi"># /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/kafka/bin/kafka-console-producer.sh --broker-list localhost:<span class="hljs-number"><span class="hljs-number">9092</span></span> --topic test Test <span class="hljs-keyword"><span class="hljs-keyword">Message</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Test <span class="hljs-keyword"><span class="hljs-keyword">Message</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ^D #</code> </pre> <br>  Mengkonsumsi pesan dari topik tes: <br><br><pre> <code class="hljs delphi"># /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/kafka/bin/kafka-console-consumer.sh --zookeeper localhost:<span class="hljs-number"><span class="hljs-number">2181</span></span> --topic test --from-beginning Test <span class="hljs-keyword"><span class="hljs-keyword">Message</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> Test <span class="hljs-keyword"><span class="hljs-keyword">Message</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ^C Consumed <span class="hljs-number"><span class="hljs-number">2</span></span> messages #</code> </pre> <br><h3>  Konfigurasi broker </h3><br>  Contoh konfigurasi broker yang disertakan dengan distribusi Kafka sangat cocok untuk uji coba server yang berdiri sendiri, tetapi untuk sebagian besar instalasi itu tidak akan cukup.  Ada banyak opsi konfigurasi Kafka yang mengatur semua aspek instalasi dan konfigurasi.  Anda dapat meninggalkan nilai default untuk banyak dari mereka, karena mereka berhubungan dengan nuansa mendirikan broker Kafka yang tidak berlaku sampai Anda bekerja dengan skenario tertentu yang mengharuskan mereka untuk digunakan. <br><br><h3>  Pengaturan broker dasar </h3><br>  Ada beberapa pengaturan broker Kafka yang harus Anda pertimbangkan ketika memasang platform di lingkungan apa pun, kecuali untuk broker yang berdiri sendiri di server terpisah.  Parameter ini berhubungan dengan pengaturan utama broker, dan sebagian besar dari mereka harus diubah sehingga broker dapat bekerja dalam satu cluster dengan broker lain. <br><br>  <b>broker.id</b> <br><br>  Setiap broker Kafka harus memiliki pengenal integer yang ditentukan oleh parameter broker.id.  Secara default, nilai ini adalah 0, tetapi dapat berupa angka berapa pun.  Hal utama adalah bahwa itu tidak terulang dalam cluster Kafka yang sama.  Pilihan nomor dapat arbitrer, dan jika perlu, untuk kenyamanan perawatan, dapat ditransfer dari satu broker ke broker lainnya.  Diharapkan bahwa nomor ini entah bagaimana terhubung dengan host, maka korespondensi pengenal broker dengan host dengan pelacakan akan lebih transparan.  Misalnya, jika nama host Anda berisi angka unik (misalnya, host1.example.com, host2.example.com, dll.), Angka-angka ini akan menjadi pilihan yang baik untuk nilai-nilai broker.id. <br><br>  <b>pelabuhan</b> <br><br>  File konfigurasi tipikal memulai Kafka dengan pendengar pada port TCP 9092. Port ini dapat diubah ke yang lain dengan mengubah port parameter konfigurasi.  Perlu diingat bahwa ketika memilih port dengan nomor kurang dari 1024, Kafka harus dijalankan sebagai root.  Menjalankan Kafka sebagai root tidak dianjurkan. <br><br>  <b>zookeeper.connect</b> <br><br>  Jalur yang digunakan ZooKeeper untuk menyimpan metadata broker diatur menggunakan parameter konfigurasi zookeeper.connect.  Dalam konfigurasi sampel, ZooKeeper berjalan pada port 2181 pada host lokal, yang ditunjukkan sebagai localhost: 2181.  Format parameter ini adalah daftar baris yang dipisahkan titik koma dari bentuk hostname: port / path, termasuk: <br><br><ul><li>  hostname - hostname atau alamat IP dari server ZooKeeper; </li><li>  port - nomor port klien untuk server; </li><li>  / path - path opsional ZooKeeper yang digunakan sebagai path root (chroot) baru dari cluster Kafka.  Jika tidak ditentukan, path root digunakan. </li></ul><br>  Jika jalur chroot yang ditentukan tidak ada, itu akan dibuat ketika broker memulai. <br><br>  <b>log.dirs</b> <br><br>  Kafka menyimpan semua pesan ke hard drive, dan segmen log ini disimpan dalam direktori yang ditentukan dalam pengaturan log.dirs.  Ini adalah daftar jalur yang dipisahkan koma di sistem lokal.  Jika beberapa jalur ditentukan, broker akan menyimpan bagian di dalamnya sesuai dengan prinsip yang paling sedikit digunakan, dengan mempertahankan segmen log dari satu bagian di sepanjang satu jalur.  Perhatikan bahwa broker akan menempatkan bagian baru dalam direktori di mana saat ini partisi paling sedikit disimpan, dan bukan ruang paling sedikit digunakan, sehingga distribusi data yang seragam di antara bagian tidak dijamin. <br><br>  <b>num.recovery.threads.per.data.dir</b> <br><br>  Kafka menggunakan kumpulan utas khusus untuk memproses segmen log.  Saat ini diterapkan: <br><br><ul><li>  selama startup normal - untuk membuka segmen log dari setiap bagian; </li><li>  mulai setelah kegagalan - untuk memeriksa dan memotong segmen log dari setiap bagian; </li><li>  Stop - untuk menutup segmen log dengan lembut. </li></ul><br>  Secara default, hanya satu utas yang digunakan per direktori log.  Karena ini hanya terjadi ketika memulai dan menghentikan, masuk akal untuk menggunakan lebih banyak dari mereka untuk memparalelkan operasi.  Ketika pulih dari shutdown yang salah, manfaat menggunakan pendekatan ini dapat mencapai beberapa jam jika broker dengan sejumlah besar partisi dimulai kembali!  Ingat bahwa nilai parameter ini ditentukan berdasarkan satu direktori log dari jumlah yang ditentukan menggunakan log.dirs.  Yaitu, jika nilai parameter num.recovery.threads.per.data.dir adalah 8, dan tiga jalur ditentukan dalam log.dirs, maka jumlah total utas adalah 24. <br><br>  <b>auto.create.topics.enable</b> <br><br>  Menurut konfigurasi default Kafka, broker harus secara otomatis membuat tema ketika: <br><br><ul><li>  pabrikan mulai menulis di baris subjek; </li><li>  konsumen mulai membaca dari topik pesan; </li><li>  klien meminta metadata topik. </li></ul><br>  Dalam banyak kasus, perilaku ini mungkin tidak diinginkan, terutama karena kenyataan bahwa tidak ada cara untuk memeriksa keberadaan suatu topik menggunakan protokol Kafka tanpa menyebabkannya dibuat.  Jika Anda mengontrol pembuatan itu secara eksplisit, manual atau melalui sistem inisialisasi, Anda dapat mengatur parameter auto.create.topics.enable menjadi false. <br><br><h3>  Pengaturan Tema Default </h3><br>  Konfigurasi server Kafka menetapkan banyak pengaturan default untuk tema yang dibuat.  Beberapa parameter ini, termasuk jumlah bagian dan parameter penyimpanan pesan, dapat diatur untuk setiap topik secara terpisah menggunakan alat administrator (dibahas pada Bab 9).  Nilai default dalam konfigurasi server harus ditetapkan sama dengan nilai referensi yang cocok untuk sebagian besar topik klaster. <br><br>  <b>num.partitions</b> <br><br>  Parameter num.partitions menentukan dengan berapa banyak bagian topik baru dibuat, terutama ketika pembuatan otomatis berdasarkan tema diaktifkan (yang merupakan perilaku default).  Nilai default dari parameter ini adalah 1. Ingatlah bahwa jumlah bagian untuk suatu topik hanya dapat ditingkatkan, tetapi tidak dikurangi.  Ini berarti bahwa jika membutuhkan lebih sedikit partisi daripada yang ditunjukkan dalam num.partitions, Anda harus membuatnya secara manual (ini dibahas pada Bab 9). <br><br>  Seperti dibahas di Bab 1, bagian adalah cara untuk menskala topik dalam sebuah cluster Kafka, jadi penting bahwa Anda memiliki sebanyak yang Anda butuhkan untuk menyeimbangkan beban pesan di seluruh cluster saat broker ditambahkan.  Banyak pengguna lebih suka bahwa jumlah partisi sama dengan atau jumlah broker di kluster.  Hal ini memungkinkan untuk mendistribusikan bagian secara merata di antara broker, yang akan mengarah pada distribusi beban yang merata di seluruh pesan.  Namun, ini bukan persyaratan wajib, karena keberadaan beberapa topik memungkinkan Anda untuk menyeimbangkan beban. <br><br>  <b>log.retention.ms</b> <br><br>  Lebih sering daripada tidak, penyimpanan pesan di Kafka terbatas dalam waktu.  Nilai default ditentukan dalam file konfigurasi menggunakan parameter log.retention.hours dan sama dengan 168 jam, atau 1 minggu.  Namun, Anda dapat menggunakan dua parameter lain - log.retention.minutes dan log.retention.ms.  Ketiga parameter ini menentukan hal yang sama - periode waktu setelah pesan dihapus.  Tetapi disarankan untuk menggunakan parameter log.retention.ms, karena jika beberapa parameter ditentukan, prioritas menjadi unit ukuran terkecil, sehingga nilai log.retention.ms akan selalu digunakan. <br><br>  <b>log.retention.bytes</b> <br><br>  Cara lain untuk membatasi validitas pesan didasarkan pada ukuran total (dalam byte) dari pesan yang disimpan.  Nilai diatur menggunakan parameter log.retention.bytes dan diterapkan secara terpisah.  Ini berarti bahwa dalam kasus topik delapan bagian dan sama dengan 1 GB nilai log.retention.bytes, jumlah maksimum data yang disimpan untuk topik ini adalah 8 GB.  Perhatikan bahwa jumlah penyimpanan tergantung pada masing-masing bagian, dan bukan pada topik.  Ini berarti bahwa jika jumlah bagian untuk topik meningkat, jumlah maksimum data yang disimpan saat menggunakan log.retention.bytes juga akan meningkat. <br><br>  <b>log.segment.bytes</b> <br><br>  Pengaturan logging menyebutkan segmen log yang diperhatikan, bukan pesan individual.  Karena pesan dihasilkan oleh broker Kafka, pesan tersebut ditambahkan ke akhir segmen jurnal saat ini pada bagian yang sesuai.  Ketika segmen log mencapai ukuran yang ditentukan oleh parameter log.segment.bytes dan sama dengan 1 GB secara default, segmen ini ditutup dan yang baru terbuka.  Setelah ditutup, segmen jurnal dapat dihentikan.  Semakin kecil ukuran segmen log, semakin sering Anda harus menutup file dan membuat yang baru, yang mengurangi efisiensi keseluruhan penulisan disk. <br><br>  Mengukur segmen log adalah penting ketika topik dikarakterisasi oleh frekuensi rendah dari pembuatan pesan.  Misalnya, jika suatu topik hanya menerima 100 MB pesan per hari, dan parameter log.segment.bytes diatur ke nilai default, dibutuhkan 10 hari untuk mengisi satu segmen.  Dan karena pesan tidak dapat dinyatakan tidak valid hingga segmen log ditutup, maka dengan nilai 604,8 juta (1 minggu) parameter log.retention.ms, pesan dapat terakumulasi dalam 17 hari sebelum segmen log tertutup ditarik dari peredaran.  Ini karena ketika Anda menutup segmen dengan pesan yang terakumulasi lebih dari 10 hari, Anda harus menyimpannya selama 7 hari sebelum Anda dapat menghentikannya sesuai dengan aturan sementara yang diadopsi, karena segmen tersebut tidak dapat dihapus sebelum pesan terakhir di dalamnya berakhir. . <br><br>  <b>log.segment.ms</b> <br><br>  Cara lain untuk mengontrol penutupan segmen log adalah dengan menggunakan parameter log.segment.ms, yang menentukan lamanya waktu setelah segmen log ditutup.  Seperti parameter log.retention.bytes dan log.retention.ms, parameter log.segment.bytes dan log.segment.ms tidak saling eksklusif.  Kafka menutup segmen log ketika waktu habis atau batas ukuran yang ditentukan tercapai, tergantung pada peristiwa mana yang terjadi terlebih dahulu.  Secara default, nilai parameter log.segment.ms tidak disetel, akibatnya penutupan segmen log ditentukan oleh ukurannya. <br><br>  <b>message.max.bytes</b> <br><br>  Pialang Kafka memungkinkan penggunaan parameter message.max.bytes untuk membatasi ukuran maksimum pesan yang dihasilkan.  Nilai default untuk parameter ini adalah 1.000.000 (1 MB).  Pabrikan yang mencoba mengirim pesan yang lebih besar akan menerima pemberitahuan kesalahan dari broker, tetapi pesan itu tidak akan diterima.  Seperti halnya semua ukuran lain dalam byte yang ditentukan dalam pengaturan broker, kita berbicara tentang ukuran pesan terkompresi, sehingga produsen dapat mengirim pesan yang ukurannya dalam bentuk yang tidak terkompresi jauh lebih besar jika mereka dapat dikompresi hingga batas yang ditentukan oleh parameter message.max.bytes . <br><br>  Meningkatkan ukuran pesan dapat secara serius memengaruhi kinerja.  Ukuran pesan yang lebih besar berarti bahwa utas pialang yang memproses koneksi dan permintaan jaringan akan memakan waktu lebih lama untuk setiap permintaan.  Pesan yang lebih besar juga meningkatkan jumlah data yang ditulis ke disk, yang memengaruhi throughput I / O. <br><br><h3>  Pemilihan perangkat keras </h3><br>  Memilih perangkat keras yang tepat untuk broker Kafka lebih merupakan seni daripada sains.  Platform Kafka itu sendiri tidak memiliki persyaratan perangkat keras yang ketat, itu akan bekerja tanpa masalah pada sistem apa pun.  Tetapi jika kita berbicara tentang kinerja, maka itu dipengaruhi oleh beberapa faktor: kapasitas dan throughput disk, RAM, jaringan dan CPU. <br><br>  Pertama, Anda perlu memutuskan jenis kinerja yang paling penting untuk sistem Anda, setelah itu Anda dapat memilih konfigurasi perangkat keras optimal yang sesuai dengan anggaran. <br><br><h3>  Throughput disk </h3><br>  Throughput disk broker, yang digunakan untuk menyimpan segmen log, secara langsung mempengaruhi kinerja pelanggan manufaktur.  Pesan Kafka harus dikomit ke penyimpanan lokal yang mengkonfirmasi rekaman mereka.  Hanya dengan begitu operasi pengiriman dapat dianggap berhasil.  Ini berarti bahwa semakin cepat operasi penulisan ke disk dilakukan, semakin sedikit penundaan dalam pembuatan pesan. <br><br>  Tindakan nyata jika terjadi masalah dengan bandwidth disk adalah menggunakan hard drive dengan pelat pemintalan (HDD) atau drive solid-state drive (SSD).  SSD memiliki pesanan lebih besar, waktu pencarian / akses lebih rendah, dan kinerja lebih tinggi.  HDD lebih ekonomis dan memiliki kapasitas relatif lebih tinggi.  Kinerja HDD dapat ditingkatkan karena jumlahnya yang lebih besar di broker, atau dengan menggunakan beberapa direktori data, atau dengan memasang disk dalam array disk independen dengan redundansi (redundansi array disk independen, RAID).  Faktor-faktor lain mempengaruhi throughput, misalnya, teknologi pembuatan hard disk (misalnya, SAS atau SATA), serta karakteristik pengontrol hard disk. <br><br><h3>  Kapasitas disk </h3><br>  Kapasitas adalah aspek lain dari penyimpanan.  Jumlah ruang disk yang diperlukan ditentukan oleh berapa banyak pesan yang perlu disimpan pada saat bersamaan.  Jika broker diharapkan menerima 1 TB lalu lintas per hari, maka dengan penyimpanan 7 hari, ia akan membutuhkan penyimpanan yang tersedia untuk segmen log setidaknya 7 TB.  Anda juga harus mempertimbangkan kelebihan setidaknya 10% untuk file lain, tidak termasuk buffer untuk fluktuasi lalu lintas yang mungkin atau pertumbuhannya dari waktu ke waktu. <br><br>  Kapasitas penyimpanan adalah salah satu faktor yang harus dipertimbangkan ketika menentukan ukuran cluster Kafka yang optimal dan memutuskan ekspansi.  Total traffic cluster dapat diseimbangkan dengan beberapa bagian untuk setiap topik, yang memungkinkan Anda untuk menggunakan broker tambahan untuk meningkatkan kapasitas yang tersedia dalam kasus di mana kepadatan data per broker tidak cukup.  Keputusan tentang berapa banyak ruang disk yang dibutuhkan juga ditentukan oleh strategi replikasi yang dipilih untuk cluster (dibahas lebih rinci dalam Bab 6). <br><br><h3>  Memori </h3><br>  Dalam mode operasi normal, konsumen Kafka membaca dari akhir bagian, dan konsumen terus-menerus mengganti waktu yang hilang dan hanya sedikit di belakang produsen, jika ada.            ,      ,         . ,         ,    -. <br><br>   Kafka     JVM      .  ,   X        X   ,      5 .             Kafka        .      Kafka  ,      ,       ,     Kafka. <br><br><h3>     </h3><br>   ,    Kafka,     .    (    )    .     Kafka (   )       .    1       ,       ,      .       ,     (.  6)    (   8).          ,     . <br><br><h3>  CPU </h3><br>     ,      ,           .             .  Kafka, ,              .            .    Kafka  '   .            . <br><br><h3> Kafka    </h3><br> Kafka      , , Amazon Web Services (AWS). AWS     ,     CPU,     .              Kafka.       ,      .                /      SSD.         (, AWS Elastic Block Store).            CPU   . <br>    ,     AWS      m4  r3.    m4    ,        ,      .      r3      SSD-,        .            i2  d2. <br><br><h3>  Kafka </h3><br>   Kafka         ,             (. 2.2).     —      .    —            .         Kafka        .         Kafka.           6. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vo/c-/cc/voc-cc5ywmwoh4ttiidnzt1gdk4.png" alt="gambar"></div><br><br><h3>    ? </h3><br>   Kafka   .    —              .     10  ,      2 ,     —  .  ,          100 % (    ) (.  6).  ,              . <br><br>   ,   , —     . ,                        (         ).        80 %   ,    ,             .     ,      ,   .        ,     ,          . <br><br><h3>   </h3><br>               Kafka.  —          zookeeper.connect.    ZooKeeper     .  —           broker.id.       broker.id    ,            .      ,    ,      ,    . <br><br><h3>     </h3><br>     Linux      ,       ,           Kafka.          ,    ,        .       /etc/sysctl.conf,        Linux,       . <br><br><h3>   </h3><br>     Linux     .           ,    «»  ,        Kafka. <br>     ,  ,    ,    ()  . ,      ,       Kafka.  , Kafka     ,         ,       . <br><br>      —        .  —   ,      -   .            .      vm.swappiness  ,  1.      ( ) ,            .     ,   . <br><br>  ,      «» ,      ,   .   Kafka       /.         :        (, SSD),       NVRAM   (, RAID).       «» ,         .       vm.dirty_background_ratio ,     ( 10).       ( ),         5.       0,                           . <br><br>   «» ,               ,      vm.dirty_ratio  ,     — 20 (        ).       ,      60  80.               ,       /       .       vm.dirty_ratio       Kafka,     . <br><br>          «»      Kafka        .        /proc/vmstat: <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta"># cat /proc/vmstat | egrep </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"dirty|writeback"</span></span></span><span class="hljs-meta"> nr_dirty 3875 nr_writeback 29 nr_writeback_temp 0 #</span></span></code> </pre> <br><h3>  Berkendara </h3><br>         ,    RAID-    ,           .     ,        EXT4 (fourth extended file system —    )  XFS (Extents File System —     ). EXT4   ,       .       ,     (5),       .  EXT4     ,            .    XFS     ,   ,   EXT4.  XFS    Kafka  ,        ,    .         ,       /. <br><br>     ,        ,     noatime.      /:   (ctime),    (mtime)       (atime).     atime     .        .  atime    ,   ,      ,         (      realtime). Kafka     atime,      .   noatime       /,        ctime  mtime. <br><br><h3>     </h3><br>       Linux —     ,    ,             .     Kafka     ,    -    .     (   ) ,         .          .              net.core.wmem_default  net.core.rmem_default ,      2 097 152 (2 ).   ,           ,       . <br><br>              TCP    net.ipv4.tcp_wmem  net.ipv4.tcp_rmem.        ,   ,       .    — 4096 65536 2048000 — ,     4 ,    — 64 ,   — 2 .      ,      net.core.wmem_max  net.core.rmem_max.        Kafka           . <br><br>      .     TCP    1  net.ipv4.tcp_window_scaling,               .   net.ipv4.tcp_max_syn_backlog ,     1024,     .   net.core.netdev_max_backlog,     1000,       ,       ,    ,       . <br><br><h3>   </h3><br>      Kafka      ,             . <br><br><h3>    </h3><br>     Java      ,           ,   .  ,     Java 7     Garbage First (G1). G1                    .         ,       ,           . <br><br>         G1   .       . <br><br><ul><li> MaxGCPauseMillis.         .     —   G1    .      200 .  ,  G1       ,    ,    , ,      200 . </li><li> InitiatingHeapOccupancyPercent.        ,       .     45.  ,  G1       ,    45 % ,       (Eden),    . </li></ul><br>  Kafka         ,         .               64   ,  Kafka     5 .       20  MaxGCPauseMillis.    InitiatingHeapOccupancyPercent   35,       ,     . <br><br>   Kafka       G1,            .       .       : <br><br><pre> <code class="hljs pgsql"># export JAVA_HOME=/usr/java/jdk1<span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>_51 # export KAFKA_JVM_PERFORMANCE_OPTS="-server -XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+DisableExplicitGC -Djava.awt.headless=true" # /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/kafka/bin/kafka-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>.sh -daemon /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/kafka/config/<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.properties #</code> </pre> <br><h3>   </h3><br>          Kafka      ,                 .             -    ,     .         Kafka (.  6),         .        Kafka,       . <br><br>  Kafka             ,  ,                     (    , , AWS),           ,            .          .  ,   «»             (.    6). <br><br>  :    Kafka      ,   ,       ,     .             (     )                   .               , ,     . <br><br><h3>    ZooKeeper </h3><br> Kafka  ZooKeeper     ,   .   ZooKeeper              Kafka.     ,      ZooKeeper    Kafka  .      ZooKeeper      Kafka (     ZooKeeper   ,      ). <br><br>      ZooKeeper     .        ZooKeeper,  Kafka,      .    ZooKeeper  ,        ZooKeeper        .       — 1 ,               .        ZooKeeper,      ,     .   ZooKeeper      ,     .  ,      Kafka   Kafka        ZooKeeper. <br><br>         Kafka,       ,    . Kafka         ZooKeeper,          .              ZooKeeper,     .        ,            , ,     .    ,            ,   . <br><br><h3>  Ringkasan </h3><br>       ,     Apache Kafka. ,       ,         . ,   Kafka,         Kafka.             Kafka ( 3),       ( 4). <br><br>  »Informasi lebih lanjut tentang buku ini dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">situs web penerbit</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Isi</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kutipan</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><br></a> <br>    20%   — <b>Apache Kafka</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id421519/">https://habr.com/ru/post/id421519/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id421501/index.html">Hacker telah menemukan cara untuk melacak pengunjung ke situs pesaing</a></li>
<li><a href="../id421503/index.html">Cara menulis instruksi agar dipahami</a></li>
<li><a href="../id421505/index.html">Hack kehidupan mini untuk bekerja dengan Yandex.Direct</a></li>
<li><a href="../id421507/index.html">Apa tukang las untuk optik</a></li>
<li><a href="../id421513/index.html">Pengenalan scrum halus oleh pengembang sendiri (kami menyelesaikan kontradiksi, mengatur tim, menghindari konflik)</a></li>
<li><a href="../id421521/index.html">Monster setelah liburan: AMD Threadripper 2990WX 32-Core dan 2950X 16-Core (bagian 3 - tes)</a></li>
<li><a href="../id421523/index.html">Unity: mengenal Objek Skrip</a></li>
<li><a href="../id421525/index.html">Sedikit tentang perbedaan antara tuan rumah Rusia dan asing</a></li>
<li><a href="../id421527/index.html">Siaran peluncuran proyek "Server di awan"</a></li>
<li><a href="../id421529/index.html">Netflix, Uber, Google dan Anda di MBLT DEV 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>