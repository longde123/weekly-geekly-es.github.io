<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèØ üèîÔ∏è üçÉ Puertas traseras de microc√≥digo ensambladas con procesador X86 ‚ô•Ô∏è üéÖüèΩ üßú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No confiamos en el software durante mucho tiempo y, por lo tanto, llevamos a cabo su auditor√≠a, realizamos ingenier√≠a inversa, lo ejecutamos en un mod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Puertas traseras de microc√≥digo ensambladas con procesador X86</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427757/"><p> No confiamos en el software durante mucho tiempo y, por lo tanto, llevamos a cabo su auditor√≠a, realizamos ingenier√≠a inversa, lo ejecutamos en un modo paso a paso, lo ejecutamos en el sandbox.  ¬øQu√© pasa con el procesador en el que se ejecuta nuestro software?  - Confiamos ciega y sinceramente en esta peque√±a pieza de silicio.  Sin embargo, el hardware moderno tiene los mismos problemas que el software: secreto, funcionalidad indocumentada, errores, vulnerabilidades, malware, troyanos, rootkits, puertas traseras. </p><br><p><img src="https://habrastorage.org/webt/ip/yi/6i/ipyi6itjefhde2aetsgvqabmbwo.jpeg"></p><br><p>  ISA (Arquitectura de conjunto de instrucciones) x86 es una de las "arquitecturas de conjunto de instrucciones" m√°s cambiantes de la historia.  Comenzando con el dise√±o 8086 desarrollado en 1976, ISA est√° experimentando continuos cambios y actualizaciones;  manteniendo la compatibilidad con versiones anteriores y el soporte para la especificaci√≥n original.  M√°s de 40 a√±os de crecimiento, la arquitectura ISA ha crecido y contin√∫a creciendo con muchos modos y conjuntos de instrucciones nuevos, cada uno de los cuales agrega una nueva capa al dise√±o anterior, que ya est√° sobrecargado.  Debido a la pol√≠tica de compatibilidad con versiones anteriores, los procesadores x86 modernos incluso contienen instrucciones y modos que ya est√°n completamente olvidados.  Como resultado, tenemos una arquitectura de procesador, que es un complejo laberinto de tecnolog√≠as nuevas y antiguas.  Un entorno tan extremadamente complejo: causa muchos problemas con la ciberseguridad del procesador.  Por lo tanto, los procesadores x86 no pueden afirmar ser la ra√≠z confiable de la infraestructura cibern√©tica cr√≠tica. </p><a name="habracut"></a><br><h2 id="vy-vsyo-eschyo-doveryaete-svoemu-processoru">  ¬øTodav√≠a conf√≠as en tu procesador? </h2><br><p>  Seguridad de programas y sistema operativo: se basa en la seguridad del hardware en el que se implementan.  Como regla general, los desarrolladores de software no tienen en cuenta el hecho de que el hardware en el que se implementa su software puede ser no confiable, malicioso.  Cuando el hardware se comporta err√≥neamente (ya sea intencionalmente o no), los mecanismos de seguridad del software se vuelven completamente in√∫tiles.  Durante muchos a√±os, se han ofrecido varios modelos de procesadores seguros: Intel SGX, AMD Pacifica, etc. Sin embargo, la regularidad envidiable con la que se publica la informaci√≥n sobre fallas cr√≠ticas (de las recientes, por ejemplo Meltdown y Spectre) y las funciones de "depuraci√≥n" no documentadas detectadas - conduce a La idea de que nuestra confianza incondicional en los procesadores no tiene fundamento. </p><br><p>  Los procesadores x86 modernos son un entretejido muy complejo e intrincado de las tecnolog√≠as m√°s recientes y antiguas.  8086 ten√≠a 29 mil transistores, Pentium 3 millones, Broadwell 3.2 mil millones, Cannonlake m√°s de 10 mil millones. </p><br><p><img src="https://habrastorage.org/webt/tn/p-/_2/tnp-_2qkl0ubruapqvdv-57kcko.png"></p><br><p>  Con tantos transistores, no es sorprendente que los procesadores x86 modernos est√©n plagados de instrucciones indocumentadas y vulnerabilidades de hardware.  Entre los indocumentados, que fueron descubiertos casi por accidente, las instrucciones: ICEBP (0xF1), LOADALL (0x0F07), apicall (0x0FFFF0) [1], que permiten desbloquear el procesador para el acceso no autorizado a √°reas de memoria protegidas. </p><br><p>  En cuanto a las numerosas vulnerabilidades de hardware de los procesadores (ver dos figuras a continuaci√≥n), permiten a un ciber-atacante escalar privilegios [3], extraer claves criptogr√°ficas [4], crear nuevas instrucciones de ensamblador [2], cambiar la funcionalidad de las instrucciones de ensamblador ya existentes [2] , instale ganchos en las instrucciones del ensamblador [2], tome el control de la "virtualizaci√≥n acelerada por hardware" [7], intervenga en "c√°lculos criptogr√°ficos at√≥micos" [7] y, finalmente, dulce, ingrese al "modo dios":  ive usted mismo un hardware de Intel ME leg√≠tima de puerta trasera (que le permite recibir acceso remoto incluso el ordenador apagado). [8]  Y todo esto, sin dejar rastros digitales. </p><br><p><img src="https://habrastorage.org/webt/8b/7r/hu/8b7rhuqyqipkayzqgoa-dvxximu.png"><br><img src="https://habrastorage.org/webt/v9/hi/pk/v9hipk3k6e1n8krpm22zz8j_0uk.png"></p><br><h2 id="sovremennye-processory--eto-bolshe-soft-chem-zhelezo">  Los procesadores modernos son m√°s software que hardware </h2><br><p>  Estrictamente hablando, los procesadores modernos ni siquiera pueden llamarse "hardware" en el sentido completo de la palabra.  Porque su funcionalidad m√°s cr√≠tica (incluida ISA) es proporcionada por microc√≥digo intermitente.  Inicialmente, el microc√≥digo era el principal responsable de controlar la decodificaci√≥n y la ejecuci√≥n de instrucciones complejas de ensamblador: operaciones de punto flotante, primitivas MMX, manejadores de l√≠nea con el prefijo REP, etc.  Sin embargo, con el tiempo, se asigna m√°s y m√°s responsabilidad al microc√≥digo para procesar las operaciones dentro del procesador.  Por ejemplo, las extensiones modernas de procesadores Intel, como AVX (Advanced Vector Extensions) y VT-d (virtualizaci√≥n de hardware) se implementan en microc√≥digo. </p><br><p>  Adem√°s, hoy el microc√≥digo es responsable, entre otras cosas, de mantener el estado del procesador, de administrar el cach√© y tambi√©n de administrar el ahorro de energ√≠a.  Para ahorrar energ√≠a, el microc√≥digo implementa un mecanismo de interrupci√≥n que procesa estados de energ√≠a: estado C (grado de suspensi√≥n de ahorro de energ√≠a: desde el estado activo hasta la suspensi√≥n profunda) y estado P (diferentes combinaciones de voltaje y frecuencia).  Entonces, por ejemplo, el microc√≥digo es responsable de restablecer el cach√© L2 al ingresar al estado C4, as√≠ como al salir de √©l. </p><br><h2 id="zachem-proizvoditeli-processorov-polzuyutsya-mikrokodom">  ¬øPor qu√© los fabricantes de procesadores usan microc√≥digo? </h2><br><p>  Los fabricantes de procesadores x86 usan microc√≥digo para descomponer instrucciones de ensamblaje complejas (que pueden tener hasta 15 bytes de largo) en una cadena de microinstrucciones simples, para simplificar la arquitectura del hardware y facilitar el diagn√≥stico.  De hecho, el microc√≥digo es un int√©rprete entre la arquitectura CISC externa (visible para el usuario) y la arquitectura RISC interna (hardware). </p><br><p>  Si se detectan errores en la arquitectura CISC (principalmente en ISA), los fabricantes publican una actualizaci√≥n de microc√≥digo que se puede descargar al procesador a trav√©s del BIOS / UEFI de la placa base o del sistema operativo (durante el proceso de arranque).  Gracias a este sistema de actualizaci√≥n basado en microc√≥digos, los fabricantes de procesadores se proporcionan flexibilidad y reducci√≥n de costos, al tiempo que corrigen errores en sus equipos.  El error sensacional con fdiv, que derrib√≥ severamente los procesadores Intel Pentium en 1994, hizo que el hecho de que el software de alta tecnolog√≠a sea propenso a errores como el software lo hace a√∫n m√°s obvio.  Este incidente ha dado a los fabricantes a√∫n m√°s inter√©s en la arquitectura de los procesadores basados ‚Äã‚Äãen microc√≥digo.  Por lo tanto, Intel y AMD comenzaron a construir sus procesadores utilizando la tecnolog√≠a de microc√≥digo.  Intel: comenzando con el Pentium Pro (P6), lanzado en 1995.  AMD: comenzando con el K7, lanzado en 1999. </p><br><h2 id="vsyo-taynoe-stanovitsya-yavnym">  Todo secreto queda claro </h2><br><p>  A pesar de que los fabricantes de procesadores est√°n tratando de mantener la arquitectura de los microc√≥digos y el mecanismo para actualizarlos con la m√°s estricta confidencialidad, el enemigo no est√° dormido.  Los fragmentos de informaci√≥n fragmentada (principalmente de patentes, como AMD RISC86 [5]) y la reversi√≥n reflexiva de las actualizaciones oficiales del BIOS (como sucedi√≥ con K8 [6]), arrojan luz gradualmente sobre el secreto del microc√≥digo (ver, por ejemplo, en la figura a continuaci√≥n " Mecanismo de actualizaci√≥n del microc√≥digo del procesador AMD ").  Y gracias a la constante evoluci√≥n de las herramientas de inversi√≥n (tanto de software como de hardware) [2], las prometedoras t√©cnicas de fuzzing [1] y la aparici√≥n de herramientas OpenSource como Microparse [9] y Sandsifter [10]: un ciber-atacante puede aprender todo sobre un microc√≥digo que es necesario para tener que escribir malware de microc√≥digo en √©l. </p><br><p><img src="https://habrastorage.org/webt/rp/ko/yc/rpkoycfyygkkxhvcyxe4poffqri.png"></p><br><p>  Entonces, por ejemplo, en [2] como "¬°Hola mundo!"  (el primer paso para trojanizar el microc√≥digo) se desarroll√≥ un "micro gancho" (programa de microc√≥digo que intercepta la instrucci√≥n del ensamblador), que cuenta cu√°ntas veces el procesador accedi√≥ al comando div.  Este microenganche es una inyecci√≥n en el controlador del div de instrucciones del ensamblador. </p><br><p><img src="https://habrastorage.org/webt/rn/kv/os/rnkvos_2xlvug2sjpyxjkif2h5a.png"></p><br><p>  Ibid [2] presenta un microenganche m√°s avanzado, que se ubica silenciosamente en las instrucciones del ensamblador del div ebx, sin dar presencia, y se activa solo cuando se cumplen condiciones espec√≠ficas al acceder al ebx div: el registro ebx contiene el valor B y el registro eax contiene el valor A. Cuando se activa, este micro gancho aumenta el valor del registro eip (puntero de instrucci√≥n actual) en uno.  Como resultado, la ejecuci√≥n del programa (que tuvo el coraje de referirse a la instrucci√≥n div ebx) contin√∫a con un desplazamiento: no desde el primer byte del comando que sigue al div ebx, sino desde su segundo byte.  Si se especifican otros valores en los registros eax y ebx, entonces el div ebx funciona como de costumbre.  ¬øCu√°l es el valor pr√°ctico en esto?  Por ejemplo, para activar silenciosamente una cadena oculta de instrucciones de ensamblador cuando se utilizan t√©cnicas de ofuscaci√≥n con "instrucciones superpuestas" [11]. </p><br><p><img src="https://habrastorage.org/webt/gx/af/w9/gxafw9lfzweuvhrirvuwf_qfbu0.png"></p><br><p>  Estos dos ejemplos demuestran c√≥mo las instrucciones leg√≠timas de ensamblador se pueden usar para ocultar c√≥digo troyano arbitrario en ellas. </p><br><p>  Al mismo tiempo, un atacante cibern√©tico puede activar su carga maliciosa, incluso de forma remota.  Por ejemplo, cuando se cumple la condici√≥n necesaria para la activaci√≥n en una p√°gina web controlada por un atacante.  Esto es posible gracias a los compiladores Just-in-Time (JIT) y Ahead-of-Time (AOT) integrados en los navegadores web modernos.  Estos compiladores le permiten emitir una secuencia predefinida de instrucciones de ensamblador para el c√≥digo de m√°quina, incluso si escribe el programa exclusivamente en JavaScript de alto nivel (consulte la √∫ltima lista, justo arriba). </p><br><div class="spoiler">  <b class="spoiler_title">Bibliografia</b> <div class="spoiler_text"><ol><li>  <em>Christopher Domas</em> .  Rompiendo el x86 ISA // DEFCON 25.07.2017. </li><li>  <em>Philipp Koppe</em> .  Ingenier√≠a inversa Microc√≥digo del procesador x86 // Actas del 26¬∫ Simposio de seguridad USENIX.  2017. pp.  1163-1180. </li><li>  <em>Matthew Hicks</em> .  ESPECIFICACIONES: un mecanismo de tiempo de ejecuci√≥n ligero para proteger el software de errores cr√≠ticos del procesador de seguridad // Actas de la 28¬™ Conferencia internacional sobre soporte arquitect√≥nico para lenguajes de programaci√≥n y sistemas operativos (ASPLOS).  2015. pp.  517-529. </li><li>  <em>Adi Shamir</em> .  Bug Attacks // Actas de la 28¬™ Conferencia anual sobre criptograf√≠a: avances en criptolog√≠a.  2008. pp.  221‚Äì240. </li><li>  <em>John Favor</em>  Conjunto de instrucciones RISC86 // Patente de EE. UU. 6336178. 2002. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Opteron expuesto: actualizaciones de microc√≥digo de ingenier√≠a inversa AMD K8</a> .  2004 </li><li>  <em>Saming Chen</em> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">An√°lisis de seguridad del microc√≥digo del procesador x86</a> .2014. </li><li>  <em>Catalin Cimpanu</em> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El malware utiliza la caracter√≠stica oculta de la CPU Intel para robar datos y evitar firewalls</a> .  2017 </li><li>  <em>Daming Chen</em> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Microparse: analizador de microc√≥digo para procesadores AMD, Intel y VIA</a> // GitHub.  2014. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sandsifter: el procesador fuzzer x86</a> // GitHib.  2017 </li><li>  <em>Karev V.M.</em>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥mo escribir un programa ensamblador con instrucciones superpuestas (otra t√©cnica para ofuscar el c√≥digo de bytes)</a> // Habrahabr.  2018. URL: (Fecha de acceso: 25 de octubre de 2018). </li></ol></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es427757/">https://habr.com/ru/post/es427757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es427745/index.html">Consejos y trucos de Kubernetes: acceso a sitios de desarrollo</a></li>
<li><a href="../es427747/index.html">A qui√©n aplastar un auto no tripulado: resultados del experimento Moral Machine</a></li>
<li><a href="../es427749/index.html">Apple y Samsung multados por primera vez por ralentizar tel√©fonos viejos</a></li>
<li><a href="../es427751/index.html">Ideas sublimes de CudaText</a></li>
<li><a href="../es427755/index.html">Nueva versi√≥n de GitLab 11.4 con revisi√≥n por pares de solicitudes de fusi√≥n y marcas de funciones</a></li>
<li><a href="../es427759/index.html">Sobre la solvencia de los problemas de circunvalaci√≥n en tiempo polin√≥mico</a></li>
<li><a href="../es427761/index.html">Implementaci√≥n del algoritmo k-means (k-means) usando el ejemplo de trabajar con p√≠xeles</a></li>
<li><a href="../es427763/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 13: Protocolos de red, Parte 1</a></li>
<li><a href="../es427767/index.html">Situaci√≥n: en Canad√° propusieron introducir un impuesto a la transmisi√≥n; estamos discutiendo cu√°l es el problema</a></li>
<li><a href="../es427771/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 13: Protocolos de red, parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>