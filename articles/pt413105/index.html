<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∫ üôãüèº üëçüèª Notas do provedor de IoT. Ativa√ß√£o e seguran√ßa no LoraWAN ü§πüèæ üìü ‚úçüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° queridos amantes da Internet das Coisas. Notas de continua√ß√£o Provedor de IoT. 
 A primeira parte > || > Segunda parte > || > Terceira parte > || ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Notas do provedor de IoT. Ativa√ß√£o e seguran√ßa no LoraWAN</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413105/"><p>  Ol√° queridos amantes da Internet das Coisas.  Notas de continua√ß√£o Provedor de IoT. </p><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A primeira parte</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Segunda parte</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Terceira parte</a> &gt; ||  &gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A quarta parte</a> <br><br><p>  Hoje √© hora de falar sobre seguran√ßa na LoRaWAN.  Existem muitos rumores e lendas.  Vamos tentar descobrir como isso funciona e quais s√£o os riscos. <br><br>  Para passar ao t√≥pico de seguran√ßa, voc√™ ter√° que fazer uma pequena introdu√ß√£o e falar sobre a inicializa√ß√£o do m√≥dulo de r√°dio na rede.  Esse processo no LoRaWAN √© chamado de ativa√ß√£o. </p><br><p>  Por uma quest√£o de brevidade, listarei abaixo os termos de que precisamos.  Se voc√™ ficar um pouco confuso - pode voltar aqui e conferir.  Voc√™ provavelmente tem que voltar, porque  abrevia√ß√µes de muitos termos s√£o muito semelhantes.  Al√©m disso, nesta descri√ß√£o, darei analogias para que voc√™ entenda mais ou menos com o que esse ou aquele termo pode ser comparado.  Nem sempre √© poss√≠vel selecionar analogias exatas; portanto, n√£o julgue esta coluna com muito rigor. </p><br><img src="https://habrastorage.org/webt/z4/v-/68/z4v-68a8ov1o-2rz2chxuprmpto.png"><br><a name="habracut"></a><p>  Portanto, a ativa√ß√£o no LoRaWAN pode ser feita por via a√©rea (OTAA) ou predefinida (ABP). </p><br><h2>  OTAA (Ativa√ß√£o Over the Air) </h2><br><p>  No caso de ativa√ß√£o por via a√©rea, tr√™s par√¢metros devem ser definidos em nosso m√≥dulo de r√°dio.  Seu identificador exclusivo (DevEUI), identificador do servidor (AppEUI) e chave do servidor (AppKey). </p><br><p>  No lado do servidor, o identificador do m√≥dulo de r√°dio, o identificador do servidor e a chave tamb√©m devem ser registrados.  I.e.  o servidor deve conhecer inicialmente o dispositivo que tentar√° ingressar nele.  Se conhecermos os identificadores e as chaves do servidor, mas nosso DevEUI n√£o estiver registrado em seu banco de dados, a conex√£o falhar√°. </p><br><p>  Ap√≥s a inicializa√ß√£o, o r√°dio envia o pacote join_request ao ar em uma das tr√™s frequ√™ncias de jun√ß√£o predefinidas.  Com este pacote, ele pergunta se existe uma rede pr√≥xima que o "reconhe√ßa".  A seguir, √© apresentada a composi√ß√£o do pacote join_request.  Como voc√™ pode ver, ele cont√©m o pr√≥prio DevEUI e AppEUI, al√©m do DevNonce. </p><br><img src="https://habrastorage.org/webt/6p/gh/kd/6pghkd5kbylskdzbcasmwylqdnq.png"><br><p>  DevNonce √© uma vari√°vel aleat√≥ria.  O servidor a armazena na mem√≥ria por algum tempo e, se join_request chegar com o mesmo DevNonce que um dos anteriores, o servidor ignorar√° essa solicita√ß√£o.  Isso √© para proteger contra um ataque repetido quando um invasor pode anotar uma solicita√ß√£o de ativa√ß√£o e depois repeti-la em seu dispositivo.  A prop√≥sito, nem todos os padr√µes da IoT podem se orgulhar de prote√ß√£o contra esse ataque. </p><br><p>  O AppKey n√£o √© usado diretamente nesta mensagem, mas atrav√©s dele √© considerada a soma de verifica√ß√£o MIC no final do quadro. <br>  Vamos precisar dessa chave um pouco mais, na mensagem de resposta do servidor join_accept. </p><br><p>  Join_request √© transmitido sem criptografia. </p><br><p>  O Join_accept ser√° recebido se o servidor conhecer AppEUI e DevEUI, assim como n√£o houver correspond√™ncia no campo DevNonce e n√£o houver problemas com o MIC.  Caso contr√°rio, n√£o haver√° resposta.Se todas as verifica√ß√µes forem aprovadas, o servidor gerar√° uma mensagem de resposta join_accept.  Sua composi√ß√£o √© mostrada na figura abaixo. </p><br><img src="https://habrastorage.org/webt/w7/tv/j7/w7tvj7iwfjeynonywqmtqlrwmac.png"><br><p>  De fato, duas chaves de sess√£o s√£o geradas - o servidor de rede (NwkSKey) e o servidor de aplicativos (AppSKey).  Essas chaves, juntamente com outras informa√ß√µes, s√£o criptografadas pelo AppKey e enviadas ao m√≥dulo de r√°dio.  Al√©m disso, todas as mensagens ocorrem com criptografia dupla com chaves de sess√£o (com exce√ß√£o dos pacotes com comandos MAC, eles n√£o s√£o criptografados com a chave do servidor de aplicativos).  O NwkSKey n√£o participa da criptografia de pacote apenas com dados (sem comandos), mas uma soma de verifica√ß√£o √© considerada atrav√©s dele. <br>  NwkSkey e AppSKey s√£o exclusivos para cada m√≥dulo de r√°dio individual. </p><br><p>  Duas chaves s√£o usadas para prote√ß√£o adicional de informa√ß√µes.  Cada vez que um pacote do m√≥dulo de r√°dio chega ao nosso sistema, ele √© parcialmente criptografado para o servidor de rede e parcialmente para o servidor de aplicativos.  I.e.  o servidor de rede poder√° descriptografar apenas as mensagens endere√ßadas a ele (v√°rias mensagens de servi√ßo).  O servidor de aplicativos ver√° apenas o componente √∫til dos pacotes (na verdade os dados sendo encaminhados).  Isso √© necess√°rio porque o servidor de rede com uma probabilidade de 99% estar√° no provedor.  Mas o servidor de aplicativos pode muito bem ser hospedado pelo cliente.  A criptografia dupla torna dif√≠cil para o provedor descobrir o conte√∫do do pacote. </p><br><p>  Al√©m das duas teclas, h√° outra coisa importante a ser aceita no OTAA - a lista de frequ√™ncia estendida (CFList).  Deixe-me lembr√°-lo que, inicialmente, um m√≥dulo de r√°dio conhece apenas tr√™s frequ√™ncias nas quais pode operar.  Ap√≥s a ativa√ß√£o, freq√º√™ncias adicionais s√£o registradas para a comunica√ß√£o. <br><br>  Isso √© muito conveniente se n√£o se sabe exatamente em qual rede o dispositivo funcionar√°.  Podemos concordar que em todas as redes 3 frequ√™ncias (+ RX2) sempre coincidem, e as cinco restantes ficam a crit√©rio do provedor. <br><br>  Al√©m disso, para o futuro, trabalhar com um grande n√∫mero de dispositivos CFList pode ser usado para armazenamento em cluster <br><br>  √â quando voc√™ divide a rede em clusters e dentro dos clusters existe um planejamento de frequ√™ncia.  Digamos que nosso m√≥dulo de r√°dio conhe√ßa as tr√™s frequ√™ncias F1, F2 e F3.  Ele √© ativado em uma das frequ√™ncias e, se estiver no cluster1, recebe uma tabela de frequ√™ncias adicional na forma de F4-1, F5-1 e F6-1.  Para o cluster 2, ele obter√° F4-2, F5-2, F6-2 completamente diferentes.  Ao mesmo tempo, podemos configurar todos os m√≥dulos de r√°dio da mesma maneira e realmente n√£o pensamos qual deles cair√° em qual cluster.  E em aglomerados vizinhos, a probabilidade de colis√µes diminuir√° drasticamente. </p><br><h2>  ABP (Ativa√ß√£o por Personaliza√ß√£o) </h2><br><p>  Um procedimento simplificado quando as chaves da sess√£o s√£o conectadas imediatamente no m√≥dulo de r√°dio e s√£o inicialmente registradas no lado do servidor.  Conveniente, pois voc√™ n√£o precisa ativar, o m√≥dulo de r√°dio est√° imediatamente pronto para uso.  Nada mais conveniente, porque  seguran√ßa neste caso √© mais ou menos.  Al√©m disso, voc√™ n√£o pode obter frequ√™ncias do servidor.  Eu nunca vi nenhum caso de uso real.  N√£o o consideraremos e todos os itens a seguir s√£o sobre a OTAA. </p><br><h2>  E quanto √† seguran√ßa? </h2><br><p>  Portanto, em ess√™ncia, temos a principal carga de criptografia nas chaves de sess√£o do servidor de rede e do servidor de aplicativos. <br><br>  Considere-os um pouco mais cuidadosamente. </p><br><p>  A principal reclama√ß√£o dos cr√≠ticos do padr√£o LoRaWAN √© que, quando o dispositivo √© ativado na rede, temos duas chaves, que n√£o podem ser alteradas por meses.  Mais precisamente, eles podem n√£o mudar por anos at√© que o dispositivo seja reativado.  Em condi√ß√µes normais, ativamos e esquecemos o m√≥dulo de r√°dio; portanto, uma vida √∫til de tr√™s a quatro anos √© uma perspectiva muito realista.  Na verdade, desde a instala√ß√£o at√© deixar a bateria em zero. <br>  Qu√£o confi√°veis ‚Äã‚Äãs√£o nossas chaves? </p><br><p>  A especifica√ß√£o diz que eles est√£o em conformidade com o misterioso RFC4493. <br>  O que √© isso  Este √© um algoritmo de criptografia, mais conhecido como AES-CMAC. <br><br>  N√£o vamos nos arrastar para a natureza da criptografia e nos restringir a um entendimento comum da imagem.  √â apresentado na figura abaixo. </p><br><img src="https://habrastorage.org/webt/kv/zs/7k/kvzs7k4joixbwltc1wkfxkpmotw.png"><br><p>  O princ√≠pio do AES-CMAC √© aproximadamente o seguinte: a mensagem criptografada √© dividida em blocos de 128 bits.  Cada bloco √© criptografado separadamente com uma chave AES.  Al√©m disso, ao criptografar o segundo bloco, al√©m da chave, o resultado da criptografia do primeiro √© usado.  E ao criptografar o terceiro - o resultado do segundo e (indiretamente) o primeiro.  Tal cadeia de complica√ß√µes. </p><br><p>  Qu√£o confi√°vel √© esse princ√≠pio? </p><br><p>  Muito confi√°vel.  O algoritmo saiu mais de dez anos atr√°s.  Desde ent√£o, ele foi atacado por muitos ataques diferentes e, no final, em teoria, eles provaram que ele pode ser hackeado.O problema √© que uma grande amostra de pacotes, v√°rios milhares, ser√° necess√°ria para quebr√°-lo.  Depois, h√° uma chance de entender o que h√° dentro dos blocos criptografados. </p><br><p>  Um invasor com o conhecimento necess√°rio pode obter esse exemplo se estivermos falando sobre interceptar pacotes LoRaWAN?  Vamos estimar.  Deixe os pacotes irem uma vez por hora.  Em um m√™s, 720 pacotes sair√£o do m√≥dulo de r√°dio.  N√£o chega. <br><br>  Para uma amea√ßa real, precisamos de um paciente muito paciente que estar√° escrevendo pacotes por meses.  E n√£o √© fato que ele ainda possa decifrar o algoritmo e obter as chaves preciosas.  N√£o esque√ßa que essa paci√™ncia precisar√° ser demonstrada em rela√ß√£o a cada m√≥dulo de r√°dio separadamente.  E lembre-se de que o envio de pacotes uma vez por hora √© MUITO frequente.  Na pr√°tica, os intervalos s√£o muito mais longos - seis horas ou at√© um dia. </p><br><p>  Mas mesmo essa oportunidade fantasmag√≥rica agora est√° fechada ap√≥s o lan√ßamento da especifica√ß√£o 1.1, onde os comandos de reativa√ß√£o e ingresso no servidor s√£o implementados.  Vamos falar sobre essa especifica√ß√£o de alguma forma.  Por enquanto, recordo meu pensamento do artigo anterior: quando o padr√£o √© aberto e tem uma comunidade, todos os seus buracos s√£o vis√≠veis.  Durante a atualiza√ß√£o, os desenvolvedores sabem exatamente o que procurar primeiro. </p><br><p>  Como resultado, descobrimos que a amea√ßa √† seguran√ßa √© bastante ilus√≥ria.  Em algum lugar da teoria profunda, o hacking pode ser feito, mas na pr√°tica ele praticamente n√£o √© realista.  Agora multiplique pelo valor das informa√ß√µes recebidas.  Nosso atacante come√ßar√° a escrever pacotes por meses para descobrir o contador?  Improv√°vel. <br><br>  O LoRaWAN atende a essa rela√ß√£o pre√ßo-desempenho razo√°vel.  Entendemos que a prote√ß√£o pode ser aprimorada.  Mas esse √© o poder de computa√ß√£o do final, √© uma carga adicional na bateria, √© poss√≠vel aumentar o tamanho dos pacotes ou reduzir a carga √∫til. <br><br>  Para mim, √© mais do que uma tarefa de telemetria. </p><br><p>  Nos coment√°rios, terei prazer em ouvir meus oponentes e torcedores.  Lembre-se de que o t√≥pico seguran√ßa sempre requer discuss√£o e nunca deve se basear na opini√£o de uma pessoa. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413105/">https://habr.com/ru/post/pt413105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413095/index.html">Aplica√ß√£o de tecnologias de rede neural: desenvolvimento de software</a></li>
<li><a href="../pt413097/index.html">Baseado em software de n√≠vel empresarial, testado milh√µes de vezes: lan√ßado o openSUSE Leap 15</a></li>
<li><a href="../pt413099/index.html">RAM para downclocking no macbook</a></li>
<li><a href="../pt413101/index.html">Placa de depura√ß√£o STM32F4 no fator de forma do Raspberry Pi</a></li>
<li><a href="../pt413103/index.html">Lan√ßamento do 3CX v15.5 Update 5 Beta e REST com AmoCRM</a></li>
<li><a href="../pt413107/index.html">Tradu√ß√£o do wiki do projeto Svelto.ECS. Estrutura do ECS para Unity3D</a></li>
<li><a href="../pt413109/index.html">Como criar uma plataforma de integra√ß√£o de produtos SaaS: experi√™ncia de checkout na nuvem de p√¥steres</a></li>
<li><a href="../pt413111/index.html">STM32 + NetBeans =?</a></li>
<li><a href="../pt413113/index.html">Classe JavaScript Suporte √† serializa√ß√£o de JavaScript</a></li>
<li><a href="../pt413117/index.html">Como programar com seguran√ßa no bash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>