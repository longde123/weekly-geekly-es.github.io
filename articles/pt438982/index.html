<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëåüèª ‚è±Ô∏è ü¶Ä Guia Kubernetes, Parte 1: Aplicativos, Microsservi√ßos e Cont√™ineres üåù ‚öΩÔ∏è üë©‚Äçüë©‚Äçüëß‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A nosso pedido, a Habr criou o hub Kubernetes e temos o prazer de publicar a primeira publica√ß√£o nele. Inscreva-se! 
 Kubernetes √© f√°cil. Por que os b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guia Kubernetes, Parte 1: Aplicativos, Microsservi√ßos e Cont√™ineres</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/438982/"><blockquote>  A nosso pedido, a Habr criou o hub <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kubernetes</a> e temos o prazer de publicar a primeira publica√ß√£o nele.  Inscreva-se! </blockquote><br>  Kubernetes √© f√°cil.  Por que os bancos me pagam muito dinheiro por trabalhar nesta √°rea, enquanto algu√©m pode dominar essa tecnologia em apenas algumas horas? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/d3/4l/ic/d34licaikjsxfxisetkc9arcpdi.jpeg"></a> <br><a name="habracut"></a><br>  Se voc√™ duvida que o Kubernetes possa ser aprendido t√£o rapidamente, sugiro que tente fazer isso sozinho.  Ou seja, depois de dominar este material, voc√™ poder√° executar o aplicativo com base em microsservi√ßos no cluster Kubernetes.  Eu posso garantir isso, porque √© exatamente pela metodologia usada aqui que eu treino o Kubernetes para trabalhar com nossos clientes.  O que distingue este manual dos outros?  De fato - muitas coisas.  Portanto, a maioria desses materiais come√ßa com uma explica√ß√£o de coisas simples - conceitos do Kubernetes e recursos da equipe do kubectl.  Os autores desses materiais acreditam que seus leitores est√£o familiarizados com o desenvolvimento de aplicativos, microsservi√ßos e cont√™ineres do Docker.  Vamos para o outro lado.  Primeiro, vamos falar sobre como executar um aplicativo com base em microsservi√ßos em um computador.  Em seguida, considere a montagem de imagens de cont√™iner para cada microsservi√ßo.  Depois disso, conheceremos o Kubernetes e analisaremos a implanta√ß√£o de um aplicativo baseado em microsservi√ßo em um cluster gerenciado pelo Kubernetes. <br><br>  Essa abordagem, com uma abordagem gradual ao Kubernetes, fornecer√° a profundidade do entendimento que est√° acontecendo com uma pessoa comum, a fim de entender como tudo √© organizado de maneira simples no Kubernetes.  O Kubernetes √©, √© claro, uma tecnologia simples, desde que quem queira aprender saiba onde e como √© usado. <br><br>  Agora, sem mais delongas, vamos trabalhar e falar sobre o aplicativo com o qual iremos trabalhar. <br><br><h2>  <font color="#3AC1EF">Aplica√ß√£o experimental</font> </h2><br>  Nossa aplica√ß√£o executar√° apenas uma fun√ß√£o.  Ele aceita, como entrada, uma senten√ßa e, usando os meios de an√°lise de texto, realiza uma an√°lise de sentimentos dessa senten√ßa, recebendo uma estimativa da atitude emocional do autor da senten√ßa em rela√ß√£o a um determinado objeto. <br><br>  √â assim que a janela principal deste aplicativo se parece. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/674/7e1/415/6747e14151585819867c880f52fa9d21.gif"></div><br>  <i><font color="#999999">Aplicativo da Web para an√°lise de sentimentos de texto</font></i> <br><br>  Do ponto de vista t√©cnico, o aplicativo consiste em tr√™s microsservi√ßos, cada um dos quais resolve um determinado conjunto de tarefas: <br><br><ul><li>  O SA-Frontend √© um servidor da web Nginx que serve arquivos est√°ticos do React. </li><li>  O SA-WebApp √© um aplicativo da web baseado em Java que processa solicita√ß√µes do front-end. </li><li>  O SA-Logic √© um aplicativo Python que executa an√°lise de sentimentos de texto. </li></ul><br>  √â importante observar que os microsservi√ßos n√£o existem isoladamente.  Eles implementam a id√©ia de "separa√ß√£o de tarefas", mas, no entanto, precisam interagir entre si. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94b/f93/0c0/94bf930c03220c1eec6957a0f7308046.gif"></div><br>  <i><font color="#999999">Fluxos de dados do aplicativo</font></i> <br><br>  No diagrama acima, voc√™ pode ver os est√°gios numerados do sistema, ilustrando os fluxos de dados no aplicativo.  Vamos analis√°-los: <br><br><ol><li> O navegador solicita o arquivo <code>index.html</code> do servidor (que, por sua vez, baixa o pacote do aplicativo React). </li><li>  O usu√°rio interage com o aplicativo, isso causa uma chamada para um aplicativo Web baseado no Spring. </li><li>  O aplicativo da Web redireciona a solicita√ß√£o de an√°lise de texto para o aplicativo Python. </li><li>  O aplicativo Python analisa a tonalidade do texto e retorna o resultado como uma resposta √† solicita√ß√£o. </li><li>  O aplicativo Spring envia uma resposta ao aplicativo React (e, por sua vez, mostra o resultado da an√°lise de texto ao usu√°rio). </li></ol><br>  O c√≥digo para todos esses aplicativos pode ser encontrado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Eu recomendo que voc√™ agora copie esse reposit√≥rio para si mesmo, pois h√° muitas experi√™ncias interessantes √† sua frente. <br><br><h2>  <font color="#3AC1EF">Iniciando um aplicativo baseado em microsservi√ßo em um computador local</font> </h2><br>  Para que o aplicativo funcione, precisamos executar todos os tr√™s microsservi√ßos.  Vamos come√ßar com o mais bonito deles - com o aplicativo front-end. <br><br><h3>  <font color="#3AC1EF">ReaConfigurando o React para o desenvolvimento local</font> </h3><br>  Para executar o aplicativo React, voc√™ precisa instalar as plataformas Node.js e NPM no seu computador.  Depois de instalar tudo isso, passe pelo terminal at√© a pasta do projeto <code>sa-frontend</code> e execute o seguinte comando: <br><br><pre> <code class="plaintext hljs">npm install</code> </pre> <br>  Gra√ßas √† execu√ß√£o deste comando, as depend√™ncias do aplicativo React, entradas sobre as quais est√£o no arquivo <code>package.json</code> , ser√£o carregadas na pasta <code>node_modules</code> .  Ap√≥s o download das depend√™ncias na mesma pasta, execute o seguinte comando: <br><br><pre> <code class="plaintext hljs">npm start</code> </pre> <br>  Isso √© tudo.  Agora, o aplicativo React est√° em execu√ß√£o. O acesso a ele pode ser obtido acessando o endere√ßo <code>localhost:3000</code> no navegador.  Voc√™ pode mudar algo no c√≥digo dele.  Voc√™ ver√° imediatamente o efeito dessas altera√ß√µes no navegador.  Isso √© poss√≠vel gra√ßas √† chamada substitui√ß√£o "quente" de m√≥dulos.  Gra√ßas a isso, o desenvolvimento do front-end se torna uma tarefa simples e agrad√°vel. <br><br><h3>  <font color="#3AC1EF">‚ñç Prepara√ß√£o de um aplicativo React para sa√≠da para produ√ß√£o</font> </h3><br>  Para o uso real do aplicativo React, precisamos convert√™-lo em um conjunto de arquivos est√°ticos e entreg√°-los aos clientes usando um servidor da web. <br><br>  Para criar o aplicativo React, novamente, usando o terminal, v√° para a pasta <code>sa-frontend</code> e execute o seguinte comando: <br><br><pre> <code class="plaintext hljs">npm run build</code> </pre> <br>  Isso criar√° um diret√≥rio de <code>build</code> na pasta do projeto.  Ele conter√° todos os arquivos est√°ticos necess√°rios para o aplicativo React funcionar. <br><br><h3>  <font color="#3AC1EF">ErvServindo arquivos est√°ticos usando as ferramentas Nginx</font> </h3><br>  Primeiro, voc√™ precisa instalar e executar o servidor da web Nginx.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aqui</a> voc√™ pode baix√°-lo e encontrar instru√ß√µes de instala√ß√£o e inicializa√ß√£o.  Em seguida, voc√™ precisa copiar o conte√∫do da pasta <code>sa-frontend/build</code> para a pasta <code>[your_nginx_installation_dir]/html</code> . <br><br>  Com essa abordagem, o arquivo <code>index.html</code> gerado durante a compila√ß√£o do aplicativo React estar√° dispon√≠vel em <code>[your_nginx_installation_dir]/html/index.html</code> .  Esse √© o arquivo que, por padr√£o, o servidor Nginx emite ao acess√°-lo.  O servidor est√° configurado para escutar na porta <code>80</code> , mas voc√™ pode configur√°-lo conforme necess√°rio editando o arquivo <code>[your_nginx_installation_dir]/conf/nginx.conf</code> . <br><br>  Agora abra seu navegador e v√° para <code>localhost:80</code> .  Voc√™ ver√° a p√°gina do aplicativo React. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a50/b83/f39/a50b83f390ff0434ef817f357a041941.png"></div><br>  <i><font color="#999999">React Application Served by Nginx Server</font></i> <br><br>  Se voc√™ digitar algo no campo <code>Type your sentence</code> agora e clicar no bot√£o <code>Send</code> , nada acontecer√°.  Mas, se voc√™ olhar para o console, poder√° ver mensagens de erro l√°.  Para entender exatamente onde esses erros ocorrem, vamos analisar o c√≥digo do aplicativo. <br><br><h3>  <font color="#3AC1EF">‚ñçAn√°lise do c√≥digo do aplicativo front-end</font> </h3><br>  <code>App.js</code> analisado o c√≥digo do arquivo <code>App.js</code> , podemos ver que clicar no bot√£o <code>Send</code> chama o m√©todo <code>analyzeSentence()</code> .  O c√≥digo para este m√©todo √© fornecido abaixo.  Ao mesmo tempo, preste aten√ß√£o ao fato de que, para cada linha para a qual h√° um coment√°rio no formul√°rio <code># </code> , h√° uma explica√ß√£o fornecida abaixo do c√≥digo.  Da mesma forma, analisaremos outras partes do c√≥digo. <br><br><pre> <code class="plaintext hljs">analyzeSentence() {   fetch('http://localhost:8080/sentiment', {  // #1       method: 'POST',       headers: {           'Content-Type': 'application/json'       },       body: JSON.stringify({                      sentence: this.textField.getValue()})// #2   })       .then(response =&gt; response.json())       .then(data =&gt; this.setState(data));  // #3 }</code> </pre> <br>  <b>1.</b> URL em que a solicita√ß√£o POST √© executada.  Entende-se que este endere√ßo cont√©m um aplicativo que est√° aguardando tais solicita√ß√µes. <br><br>  <b>2.</b> O corpo da solicita√ß√£o enviado ao aplicativo.  Aqui est√° um exemplo de corpo de solicita√ß√£o: <br><br><pre> <code class="plaintext hljs">{   sentence: "I like yogobella!" }</code> </pre> <br>  <b>3.</b> Ap√≥s o recebimento de uma resposta √† solicita√ß√£o, o estado do componente √© atualizado.  Isso faz com que o componente seja renderizado novamente.  Se recebermos dados (ou seja, um objeto JSON contendo os dados inseridos e a pontua√ß√£o calculada do texto), produziremos o componente <code>Polarity</code> , pois as condi√ß√µes correspondentes ser√£o atendidas.  √â assim que descrevemos o componente: <br><br><pre> <code class="plaintext hljs">const polarityComponent = this.state.polarity !== undefined ?   &lt;Polarity sentence={this.state.sentence}             polarity={this.state.polarity}/&gt; :   null;</code> </pre> <br>  O c√≥digo parece estar funcionando muito bem.  O que h√° de errado aqui, afinal?  Se voc√™ presumir que no endere√ßo em que o aplicativo est√° tentando enviar uma solicita√ß√£o POST, at√© o momento n√£o h√° nada que possa aceitar e processar essa solicita√ß√£o, voc√™ estar√° absolutamente certo.  Ou seja, para processar solicita√ß√µes que chegam ao endere√ßo <code>http://localhost:8080/sentiment</code> , precisamos executar um aplicativo Web baseado no Spring. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/848/f16/5a3/848f165a308f9ae73ffd3f8186b23aee.png"></div><br>  <i><font color="#999999">Precisamos de um aplicativo Spring que possa aceitar uma solicita√ß√£o POST.</font></i> <br><br><h3>  <font color="#3AC1EF">ApplicationConfigurar o aplicativo Web baseado em Spring</font> </h3><br>  Para implantar o aplicativo Spring, voc√™ precisar√° de JDK8 e Maven e vari√°veis ‚Äã‚Äãde ambiente adequadamente configuradas.  Depois de instalar tudo isso, voc√™ pode continuar trabalhando no nosso projeto. <br><br><h3>  <font color="#3AC1EF">AckEmbalando o aplicativo em um arquivo jar</font> </h3><br>  V√°, usando o terminal, para a pasta <code>sa-webapp</code> e digite o seguinte comando: <br><br><pre> <code class="plaintext hljs">mvn install</code> </pre> <br>  Ap√≥s executar este comando, o diret√≥rio de <code>target</code> ser√° criado na pasta <code>sa-webapp</code> .  Haver√° um aplicativo Java empacotado em um arquivo jar representado por <code>sentiment-analysis-web-0.0.1-SNAPSHOT.jar</code> . <br><br><h3>  <font color="#3AC1EF">‚ñçInicie o aplicativo Java</font> </h3><br>  V√° para a pasta de <code>target</code> e inicie o aplicativo com o seguinte comando: <br><br><pre> <code class="plaintext hljs">java -jar sentiment-analysis-web-0.0.1-SNAPSHOT.jar</code> </pre> <br>  Ocorrer√° um erro durante a execu√ß√£o deste comando.  Para come√ßar a corrigi-lo, podemos analisar as informa√ß√µes de exce√ß√£o nos dados de rastreamento da pilha: <br><br><pre> <code class="plaintext hljs">Error creating bean with name 'sentimentController': Injection of autowired dependencies failed; nested exception is java.lang.IllegalArgumentException: Could not resolve placeholder 'sa.logic.api.url' in value "${sa.logic.api.url}"</code> </pre> <br>  Para n√≥s, o mais importante aqui √© a men√ß√£o da impossibilidade de determinar o significado de <code>sa.logic.api.url</code> .  Vamos analisar o c√≥digo no qual o erro ocorre. <br><br><h3>  <font color="#3AC1EF">Analysis An√°lise de c√≥digo de aplicativo Java</font> </h3><br>  Aqui est√° o trecho de c√≥digo em que o erro ocorre. <br><br><pre> <code class="plaintext hljs">@CrossOrigin(origins = "*") @RestController public class SentimentController {   @Value("${sa.logic.api.url}")    // #1   private String saLogicApiUrl;   @PostMapping("/sentiment")   public SentimentDto sentimentAnalysis(       @RequestBody SentenceDto sentenceDto)   {       RestTemplate restTemplate = new RestTemplate();       return restTemplate.postForEntity(               saLogicApiUrl + "/analyse/sentiment",    // #2               sentenceDto, SentimentDto.class)               .getBody();   } }</code> </pre> <br><ol><li>  S <code>entimentController</code> possui um campo <code>saLogicApiUrl</code> .  Seu valor √© definido pela propriedade <code>sa.logic.api.url</code> . </li><li>  A cadeia <code>saLogicApiUrl</code> concatenada com o valor <code>/analyse/sentiment</code> .  Juntos, eles formam um endere√ßo para acessar um microsservi√ßo que executa an√°lise de texto. </li></ol><br><h3>  <font color="#3AC1EF">Definir valor da propriedade</font> </h3><br>  No Spring, a fonte padr√£o de valores de propriedade √© o arquivo <code>application.properties</code> , que pode ser encontrado em <code>sa-webapp/src/main/resources</code> .  Mas seu uso n√£o √© a √∫nica maneira de definir valores de propriedade.  Voc√™ pode fazer isso com um comando como o seguinte: <br><br><pre> <code class="plaintext hljs">java -jar sentiment-analysis-web-0.0.1-SNAPSHOT.jar --sa.logic.api.url=WHAT.IS.THE.SA.LOGIC.API.URL</code> </pre> <br>  O valor dessa propriedade deve apontar para o endere√ßo do nosso aplicativo Python. <br><br>  Ao configur√°-lo, informamos ao aplicativo da Web Spring para onde ele deve ir para executar solicita√ß√µes de an√°lise de texto. <br><br>  Para n√£o complicar nossas vidas, decidimos que o aplicativo Python estar√° dispon√≠vel no <code>localhost:5000</code> e tentamos n√£o esquec√™-lo.  Como resultado, o comando para iniciar o aplicativo Spring ficar√° assim: <br><br><pre> <code class="plaintext hljs">java -jar sentiment-analysis-web-0.0.1-SNAPSHOT.jar --sa.logic.api.url=http://localhost:5000</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30d/445/815/30d44581533865907366e867c029124e.png"></div><br>  <i><font color="#999999">Nosso sistema n√£o possui um aplicativo Python</font></i> <br><br>  Agora basta iniciar o aplicativo Python e o sistema funcionar√° conforme o esperado. <br><br><h3>  <font color="#3AC1EF">‚ñçConfigurando um aplicativo Python</font> </h3><br>  Para executar um aplicativo Python, voc√™ deve ter o Python 3 e o Pip instalados e definir as vari√°veis ‚Äã‚Äãde ambiente apropriadas corretamente. <br><br><h3>  <font color="#3AC1EF">Instala√ß√£o de depend√™ncias</font> </h3><br>  V√° para a pasta do projeto <code>sa-logic/sa</code> e execute os seguintes comandos: <br><br><pre> <code class="plaintext hljs">python -m pip install -r requirements.txt python -m textblob.download_corpora</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçIniciar aplica√ß√£o</font> </h3><br>  Depois de instalar as depend√™ncias, estamos prontos para iniciar o aplicativo: <br><br><pre> <code class="plaintext hljs">python sentiment_analysis.py</code> </pre> <br>  Ap√≥s executar este comando, seremos informados do seguinte: <br><br><pre> <code class="plaintext hljs">* Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</code> </pre> <br>  Isso significa que o aplicativo est√° em execu√ß√£o e aguarda solicita√ß√µes no <code>localhost:5000/</code> <br><br><h3>  <font color="#3AC1EF">‚ñç Pesquisa de c√≥digo</font> </h3><br>  Considere o c√≥digo do aplicativo Python para entender como ele responde √†s solicita√ß√µes: <br><br><pre> <code class="plaintext hljs">from textblob import TextBlob from flask import Flask, request, jsonify app = Flask(__name__)                                   #1 @app.route("/analyse/sentiment", methods=['POST'])      #2 def analyse_sentiment():   sentence = request.get_json()['sentence']           #3   polarity = TextBlob(sentence).sentences[0].polarity #4   return jsonify(                                     #5       sentence=sentence,       polarity=polarity   ) if __name__ == '__main__':   app.run(host='0.0.0.0', port=5000)                #6</code> </pre> <br><ol><li>  Inicializando um objeto <code>Flask</code> . </li><li>  Configurando o endere√ßo para executar solicita√ß√µes POST. </li><li>  Recuperando a propriedade da <code>sentence</code> do corpo da solicita√ß√£o. </li><li>  Inicializando o objeto <code>TextBlob</code> an√¥nimo e obtendo o valor de <code>polarity</code> para a primeira senten√ßa no corpo da solicita√ß√£o (no nosso caso, esta √© a √∫nica senten√ßa passada para an√°lise). </li><li>  O retorno da resposta, no corpo da qual cont√©m o texto da proposta e o √≠ndice de <code>polarity</code> calculado para ela. </li><li>  Ativando o aplicativo Flask, que estar√° dispon√≠vel em <code>0.0.0.0:5000</code> (voc√™ tamb√©m pode acess√°-lo usando uma constru√ß√£o <code>localhost:5000</code> ). </li></ol><br>  Agora, os microsservi√ßos que comp√µem o aplicativo est√£o em execu√ß√£o.  Eles est√£o configurados para interagir entre si.  √â assim que o diagrama do aplicativo se parece nesta fase do trabalho. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75a/fcc/135/75afcc1352ed237efaf0a2280c2df295.png"></div><br>  <i><font color="#999999">Todos os microsservi√ßos que comp√µem o aplicativo s√£o trazidos para um estado √≠ntegro.</font></i> <br><br>  Agora, antes de continuar, abra o aplicativo React em um navegador e tente analisar algumas sugest√µes usando-o.  Se tudo for feito corretamente, depois de clicar no bot√£o <code>Send</code> , voc√™ ver√° os resultados da an√°lise na caixa de texto. <br><br>  Na pr√≥xima se√ß√£o, falaremos sobre como executar nossos microsservi√ßos em cont√™ineres do Docker.  Isso √© necess√°rio para preparar o aplicativo para o lan√ßamento no cluster Kubernetes. <br><br><h2>  <font color="#3AC1EF">Docker Containers</font> </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Kubernetes</a> √© um sistema para automatizar a implanta√ß√£o, dimensionamento e gerenciamento de aplicativos em cont√™iner.  √â tamb√©m chamado de "orquestrador de cont√™ineres".  Se o Kubernetes trabalha com cont√™ineres, primeiro precisamos adquiri-los antes de usar este sistema.  Mas primeiro, vamos falar sobre o que s√£o cont√™ineres.  Talvez a melhor resposta para a pergunta sobre o que √© possa ser encontrada na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> do Docker: <br><br>  <i>Uma imagem de cont√™iner √© um pacote execut√°vel leve, independente, contendo algum tipo de aplicativo que inclui tudo o que voc√™ precisa para execut√°-lo: c√≥digo do aplicativo, tempo de execu√ß√£o, ferramentas e bibliotecas do sistema, configura√ß√µes.</i>  <i>Programas em cont√™ineres podem ser usados ‚Äã‚Äãem ambientes Linux e Windows e sempre funcionar√£o da mesma maneira, independentemente da infraestrutura.</i> <br><br>  Isso significa que os cont√™ineres podem ser executados em qualquer computador, incluindo servidores de produ√ß√£o, e em qualquer ambiente que os aplicativos contidos neles funcionem da mesma maneira. <br><br>  Para explorar os recursos dos cont√™ineres e compar√°-los com outras maneiras de iniciar aplicativos, considere um exemplo de veicula√ß√£o de um aplicativo React usando uma m√°quina virtual e um cont√™iner. <br><br><h3>  <font color="#3AC1EF">ErvServindo Arquivos est√°ticos do aplicativo React usando m√°quina virtual</font> </h3><br>  Tentando organizar a manuten√ß√£o de arquivos est√°ticos por meio de m√°quinas virtuais, encontraremos as seguintes desvantagens: <br><br><ol><li>  Uso ineficiente de recursos, pois cada m√°quina virtual √© um sistema operacional completo. </li><li>  Depende da plataforma.  O que funciona em um determinado computador local pode n√£o funcionar em um servidor de produ√ß√£o. </li><li>  Escala lenta e com muitos recursos de uma solu√ß√£o baseada em m√°quina virtual. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c26/927/523/c26927523b6072ce65bfaf8b01a1e330.png"></div><br>  <i><font color="#999999">Servidor da Web do servidor est√°tico Nginx em execu√ß√£o em uma m√°quina virtual</font></i> <br><br>  Se os cont√™ineres s√£o usados ‚Äã‚Äãpara resolver um problema semelhante, ent√£o, em compara√ß√£o com as m√°quinas virtuais, podem ser observados os seguintes pontos fortes: <br><br><ol><li>  Uso eficiente de recursos: trabalhando com o sistema operacional usando o Docker. </li><li>  Independ√™ncia da plataforma.  Um cont√™iner que um desenvolvedor possa executar em seu computador funcionar√° em qualquer lugar. </li><li>  Implanta√ß√£o leve atrav√©s do uso de camadas de imagem. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28b/593/b01/28b593b01ce003c246843d9c9f2bd05f.png"></div><br>  <i><font color="#999999">Servidor da Web do servidor est√°tico Nginx em execu√ß√£o em um cont√™iner</font></i> <br><br>  Comparamos m√°quinas virtuais e cont√™ineres em apenas alguns pontos, mas mesmo isso √© suficiente para sentir a for√ßa dos cont√™ineres.  Saiba mais sobre os cont√™ineres do Docker aqui. <br><br><h3>  <font color="#3AC1EF">‚ñç Montando uma imagem de cont√™iner para um aplicativo React</font> </h3><br>  O principal <code>Dockerfile</code> do cont√™iner do Docker √© o <code>Dockerfile</code> .  No in√≠cio deste arquivo, fa√ßa um registro da imagem b√°sica do cont√™iner e, em seguida, inclua uma sequ√™ncia de instru√ß√µes que indica a ordem em que o cont√™iner ser√° criado para atender √†s necessidades de um determinado aplicativo. <br><br>  Antes de come√ßarmos a trabalhar com o arquivo <code>Dockerfile</code> , lembremos o que fizemos para preparar os arquivos do aplicativo React para upload no servidor Nginx: <br><br><ol><li>  Crie um pacote de aplicativos React ( <code>npm run build</code> ). </li><li>  Iniciando o servidor Nginx. </li><li>  Copie o conte√∫do do diret√≥rio de <code>build</code> da pasta do projeto <code>sa-frontend</code> para a pasta do servidor <code>nginx/html</code> . </li></ol><br>  Abaixo, voc√™ pode ver os paralelos entre a cria√ß√£o do cont√™iner e as a√ß√µes acima, executadas no computador local. <br><br><h3>  <font color="#3AC1EF">RePreparando um Dockerfile para SA-Frontend</font> </h3><br>  As instru√ß√µes que estar√£o contidas no <code>Dockerfile</code> para o aplicativo <code>SA-Frontend</code> consistem em apenas dois comandos.  O fato √© que a equipe de desenvolvimento do Nginx preparou uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">imagem</a> b√°sica para o Nginx, que usaremos para criar nossa imagem.  Aqui est√£o as duas etapas que precisamos descrever: <br><br><ol><li>  A base da imagem que voc√™ precisa para criar uma imagem Nginx. </li><li>  O conte√∫do da pasta <code>sa-frontend/build</code> deve ser copiado para a pasta de imagem <code>nginx/html</code> . </li></ol><br>  Se passarmos desta descri√ß√£o para o <code>Dockerfile</code> , ser√° semelhante a este: <br><br><pre> <code class="plaintext hljs">FROM nginx COPY build /usr/share/nginx/html</code> </pre> <br>  Como voc√™ pode ver, tudo aqui √© muito simples, enquanto o conte√∫do do arquivo acaba sendo bastante leg√≠vel e compreens√≠vel.  Esse arquivo informa ao sistema para levar a imagem <code>nginx</code> com tudo o que j√° possui e copiar o conte√∫do do diret√≥rio de <code>build</code> para o diret√≥rio <code>nginx/html</code> . <br><br>  Aqui voc√™ pode ter uma pergunta sobre onde eu sei exatamente onde eu preciso copiar arquivos da pasta de <code>build</code> , ou seja, de onde veio o caminho <code>/usr/share/nginx/html</code> .  De fato, e n√£o h√° nada complicado.  O fato √© que as informa√ß√µes relevantes podem ser encontradas na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descri√ß√£o da</a> imagem. <br><br><h3>  <font color="#3AC1EF">UildConstruindo uma imagem e enviando-a para o reposit√≥rio</font> </h3><br>  Antes de podermos trabalhar com a imagem final, precisamos envi√°-la para o reposit√≥rio de imagens.  Para fazer isso, usaremos a plataforma de nuvem gratuita para hospedar imagens do Docker Hub.  Nesta fase do trabalho, voc√™ precisa fazer o seguinte: <br><br><ol><li>  Instale o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Docker</a> . </li><li>  Registre-se no site do Docker Hub. </li><li>  Efetue login na conta executando o seguinte comando no terminal: <br><br><pre> <code class="plaintext hljs">docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"</code> </pre> </li></ol><br>  Agora voc√™ precisa usar o terminal para acessar o diret√≥rio <code>sa-frontend</code> e executar o seguinte comando: <br><br><pre> <code class="plaintext hljs">docker build -f Dockerfile -t $DOCKER_USER_ID/sentiment-analysis-frontend .</code> </pre> <br>  A seguir, em comandos semelhantes, <code>$DOCKER_USER_ID</code> precisa ser substitu√≠do pelo seu nome de usu√°rio no Docker Hub.  Por exemplo, esta parte do comando pode ser assim: <code>rinormaloku/sentiment-analysis-frontend</code> . <br><br>  Ao mesmo tempo, esse comando pode ser abreviado removendo <code>-f Dockerfile</code> , pois esse arquivo j√° existe na pasta em que executamos esse comando. <br><br>  Para enviar a imagem finalizada para o reposit√≥rio, precisamos do seguinte comando: <br><br><pre> <code class="plaintext hljs">docker push $DOCKER_USER_ID/sentiment-analysis-frontend</code> </pre> <br>  Ap√≥s sua execu√ß√£o, verifique a lista de seus reposit√≥rios no Docker Hub para entender se a imagem foi enviada para a nuvem com sucesso. <br><br><h3>  <font color="#3AC1EF">ContainerIniciar o cont√™iner</font> </h3><br>  Agora qualquer pessoa pode baixar e executar uma imagem conhecida como <code>$DOCKER_USER_ID/sentiment-analysis-frontend</code> .  Para fazer isso, voc√™ precisa executar a seguinte sequ√™ncia de comandos: <br><br><pre> <code class="plaintext hljs">docker pull $DOCKER_USER_ID/sentiment-analysis-frontend docker run -d -p 80:80 $DOCKER_USER_ID/sentiment-analysis-frontend</code> </pre> <br>  Agora o cont√™iner foi lan√ßado e podemos continuar trabalhando, criando as outras imagens de que precisamos.  Mas, antes de continuar, vejamos <code>80:80</code> constru√ß√£o <code>80:80</code> , encontrada no comando de inicializa√ß√£o da imagem e pode parecer incompreens√≠vel. <br><br><ul><li>  O primeiro n√∫mero <code>80</code> √© o n√∫mero da porta do host (ou seja, o computador local). </li><li>  O segundo n√∫mero <code>80</code> √© a porta do cont√™iner para o qual a solicita√ß√£o deve ser redirecionada. </li></ul><br>  Considere a seguinte ilustra√ß√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/775/394/6cd/7753946cde3287113b82f00921ced889.png"></div><br>  <i><font color="#999999">Encaminhamento de porta</font></i> <br><br>  O sistema redireciona solicita√ß√µes da porta <code>&lt;hostPort&gt;</code> para a porta <code>&lt;containerPort&gt;</code> .  Ou seja, o acesso √† porta <code>80</code> computador √© redirecionado para a porta <code>80</code> cont√™iner. <br><br>  Como a porta <code>80</code> aberta no computador local, voc√™ pode acessar o aplicativo neste computador em <code>localhost:80</code> .  Se o seu sistema n√£o suportar o Docker, voc√™ poder√° executar o aplicativo na m√°quina virtual do Docker, cujo endere√ßo ser√° semelhante a <code>&lt;docker-machine ip&gt;:80</code> .  Para descobrir o endere√ßo IP da m√°quina virtual do Docker, voc√™ pode usar o <code>docker-machine ip</code> . <br><br>  Nesse est√°gio, ap√≥s iniciar com √™xito o cont√™iner do aplicativo frontend, voc√™ poder√° abrir sua p√°gina em um navegador. <br><br><h3>  <font color="#3AC1EF">‚ñç arquivo .dockerignore</font> </h3><br>  Coletando a imagem do aplicativo <code>SA-Frontend</code> , podemos observar que esse processo √© extremamente lento.  Isso acontece devido ao fato de que o contexto de constru√ß√£o da imagem deve ser enviado ao daemon do Docker.  O diret√≥rio que representa o contexto de constru√ß√£o √© especificado pelo √∫ltimo argumento para o <code>docker build</code> .  No nosso caso, no final deste comando, h√° um per√≠odo.  Isso resulta na inclus√£o da seguinte estrutura no contexto da montagem: <br><br><pre> <code class="plaintext hljs">sa-frontend: |   .dockerignore |   Dockerfile |   package.json |   README.md +---build +---node_modules +---public \---src</code> </pre> <br>  Mas de todas as pastas presentes aqui, precisamos apenas da pasta de <code>build</code> .  Baixar qualquer outra coisa √© uma perda de tempo.  As compila√ß√µes podem ser aceleradas, informando ao Docker quais diret√≥rios devem ser ignorados.  √â para fazer isso que precisamos de um arquivo <code>.dockerignore</code> .  Se voc√™ estiver familiarizado com o arquivo <code>.gitignore</code> , a estrutura desse arquivo certamente parecer√° familiar.  Ele lista os diret√≥rios que o sistema de montagem de imagens pode ignorar.  No nosso caso, o conte√∫do deste arquivo se parece com o seguinte: <br><br><pre> <code class="plaintext hljs">node_modules src public</code> </pre> <br>  O arquivo <code>.dockerignore</code> deve estar na mesma pasta que o <code>Dockerfile</code> .  Agora, a montagem da imagem levar√° alguns segundos. <br><br>  Agora vamos dar uma olhada no aplicativo Java. <br><br><h3> <font color="#3AC1EF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UildConstruindo uma imagem de cont√™iner para um aplicativo Java</font></font></font> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ sabe o que, mas voc√™ j√° aprendeu tudo o que precisa para criar imagens de cont√™iner. </font><font style="vertical-align: inherit;">√â por isso que esta se√ß√£o ser√° muito curta. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra o arquivo </font></font><code>Dockerfile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localizado na pasta do projeto </font></font><code>sa-webapp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se voc√™ ler o texto deste arquivo, nele encontrar√° apenas duas novas constru√ß√µes come√ßando com palavras-chave </font></font><code>ENV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>EXPOSE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="plaintext hljs">ENV SA_LOGIC_API_URL http://localhost:5000 ‚Ä¶ EXPOSE 8080</code> </pre> <br>   <code>ENV</code>       Docker.  ,       URL    API ,   . <br><br>   <code>EXPOSE</code>   Docker  ,    .          .   ,   <code>Dockerfile</code>   <code>SA-Frontend</code>   .      ,  ,     ,    <code>Dockerfile</code> . <br><br>           ,    .           ‚Äî       <code>README.md</code>   <code>sa-webapp</code> . <br><br><h3> <font color="#3AC1EF">‚ñç    Python-</font> </h3><br>       <code>Dockerfile</code>   <code>sa-logic</code> ,         .               ,  ,        ,     <code>README.md</code>   <code>sa-logic</code> . <br><br><h3> <font color="#3AC1EF">‚ñç  </font> </h3><br>     - ,    ?    .   . <br><br><ol><li>    <code>sa-logic</code>       <code>5050</code> : <br><br><pre> <code class="plaintext hljs">docker run -d -p 5050:5000 $DOCKER_USER_ID/sentiment-analysis-logic</code> </pre> </li><li>    <code>sa-webapp</code>       <code>8080</code> .  ,    ,   Python-     Java-,    <code>SA_LOGIC_API_URL</code> : <br><br><pre> <code class="plaintext hljs">$ docker run -d -p 8080:8080 -e SA_LOGIC_API_URL='http://&lt;container_ip or docker machine ip&gt;:5000' $DOCKER_USER_ID/sentiment-analysis-web-app</code> </pre> </li></ol><br>      ,   IP-     Docker ‚Äî    <a href="">README</a> . <br><br>    <code>sa-frontend</code> : <br><br><pre> <code class="plaintext hljs">docker run -d -p 80:80 $DOCKER_USER_ID/sentiment-analysis-frontend</code> </pre> <br>     ,       <code>localhost:80</code>   . <br><br>    ,       <code>sa-webapp</code> ,        Docker,     <code>App.js</code>   <code>sa-frontend</code> ,  IP-      <code>analyzeSentence()</code> ,      .         . <br><br>       . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/71e/87a/79671e87adea76c8873cac180e2fe8c0.png"></div><br> <i><font color="#999999">   </font></i> <br><br><h2> <font color="#3AC1EF">:    Kubernetes?</font> </h2><br>      <code>Dockerfile</code> ,   ,         Docker.  ,     ,   <code>.dockerignore</code> .         Docker.          ,   Kubernetes.          .      : <br> ,   -      .       .  ,   <code>sa-webapp</code>  <code>sa-logic</code>     .   ,    ? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt438982/">https://habr.com/ru/post/pt438982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt438972/index.html">O c√©rebro por dentro (visualiza√ß√£o da passagem do padr√£o atrav√©s do modelo de rede neural artificial)</a></li>
<li><a href="../pt438974/index.html">Realidade virtual ajuda a lidar com transtornos mentais</a></li>
<li><a href="../pt438976/index.html">O livro "Primavera. Todos os padr√µes de design ¬ª</a></li>
<li><a href="../pt438978/index.html">Aprendendo sempre e em qualquer lugar! Podcasts para desenvolvedores em ingl√™s</a></li>
<li><a href="../pt438980/index.html">Spring Boot 2: o que h√° de novo?</a></li>
<li><a href="../pt438984/index.html">Guia Kubernetes, Parte 2: Criando e trabalhando com um cluster</a></li>
<li><a href="../pt438986/index.html">Tutorial Reagir Parte 14: Workshop sobre componentes baseados em classe, status do componente</a></li>
<li><a href="../pt438988/index.html">Tutorial Reagir Parte 15: Workshops sobre o estado dos componentes</a></li>
<li><a href="../pt438992/index.html">Di√°rio do desenvolvedor ou decis√µes incorretas</a></li>
<li><a href="../pt438994/index.html">Intel Xeon W-3175X, um baterista quente. Teste</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>