<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôæ üî∏ üßëüèø‚Äçü§ù‚ÄçüßëüèΩ Princ√≠pios PIM üå´Ô∏è üë† üö≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O protocolo PIM √© um conjunto de protocolos para transmitir multicast em uma rede entre roteadores. Os relacionamentos de vizinhan√ßa s√£o criados da me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Princ√≠pios PIM</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450582/"> O protocolo PIM √© um conjunto de protocolos para transmitir multicast em uma rede entre roteadores.  Os relacionamentos de vizinhan√ßa s√£o criados da mesma maneira que no caso de protocolos de roteamento din√¢mico.  O PIMv2 envia mensagens Hello a cada 30 segundos para o endere√ßo multicast reservado 224.0.0.13 (Todos os roteadores PIM).  A mensagem cont√©m temporizadores de espera - geralmente 3,5 * Hello Timer, ou seja, 105 segundos por padr√£o. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e67/8a0/1fc/e678a01fc7879ecf22bc6f9a3825f9a6.jpg" alt="Minha imagem"></a> <br>  O PIM usa dois modos principais de opera√ß√£o - modo Denso e Esparso.  Vamos come√ßar com o modo denso. <a name="habracut"></a><br>  <b>√Årvores de distribui√ß√£o baseadas na fonte.</b> <br>  √â aconselh√°vel usar o modo denso no caso de um grande n√∫mero de clientes de v√°rios grupos multicast.  Quando um roteador recebe tr√°fego multicast, a primeira coisa que faz √© verificar a regra RPF.  RPF - esta regra √© usada para verificar a origem de um multicast com uma tabela de roteamento unicast.  √â necess√°rio que o tr√°fego chegue √† interface atr√°s da qual esse host est√° oculto, de acordo com a vers√£o da tabela de roteamento unicast.  Esse mecanismo resolve o problema de ocorr√™ncia de loop durante a transmiss√£o multicast. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/6cd/08c/fb6/6cd08cfb6842680447d56860334af52c.png" alt="Minha imagem"></a> <br>  O R3 da mensagem multicast reconhecer√° a origem do multicast (IP de origem) e verificar√° os dois fluxos R1 e R2 de sua tabela unicast.  O fluxo da interface indicada pela tabela (R1 a R3) ser√° transferido ainda mais e o fluxo do R2 ser√° descartado, porque, para chegar √† fonte do multicast, √© necess√°rio enviar pacotes via S0 / 1. <br>  A quest√£o √©: o que acontece se voc√™ tiver duas rotas equivalentes com a mesma m√©trica?  Nesse caso, o roteador escolher√° o pr√≥ximo salto para essas rotas.  Quem tem um endere√ßo IP mais alto, ele ganhou.  Se voc√™ precisar alterar esse comportamento, poder√° usar o ECMP.  Mais detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br>  Ap√≥s verificar a regra RPF, o roteador envia um pacote multicast a todos os seus vizinhos do PIM, exceto aquele de quem o pacote foi recebido.  Outros roteadores PIM repetem esse processo.  O caminho que um pacote multicast passou da origem para os destinat√°rios finais forma uma √°rvore chamada - √°rvore de distribui√ß√£o baseada na fonte, √°rvore de caminho mais curto (SPT), √°rvore de origem.  Tr√™s nomes diferentes, escolha qualquer. <br>  Como resolver o problema com o fato de alguns roteadores n√£o desistirem de um fluxo multicast e n√£o haver ningu√©m para quem envi√°-lo, e o roteador de n√≠vel superior o envia.  Para isso, o mecanismo de Prune foi inventado. <br>  <b>Remover mensagem.</b> <br>  Por exemplo, o R2 continuar√° enviando R3 multicast, embora o R3 pela regra do RPF o elimine.  Por que carregar o canal?  O R3 envia uma mensagem de remo√ß√£o do PIM e o R2, ao receber essa mensagem, remove a interface S0 / 1 da lista de interfaces de sa√≠da desse fluxo, a lista de interfaces das quais esse tr√°fego deve ser enviado. <br><blockquote>  A seguir, uma defini√ß√£o mais formal de uma mensagem de remo√ß√£o do PIM: <br>  A mensagem PIM Prune √© enviada por um roteador para um segundo roteador para fazer com que o segundo roteador remova o link no qual a Prune √© recebida de um SPT (S, G) espec√≠fico. </blockquote><br>  Ap√≥s receber a mensagem de remo√ß√£o, o R2 define o timer de remo√ß√£o para 3 minutos.  Ap√≥s tr√™s minutos, ele come√ßar√° a enviar o tr√°fego novamente at√© receber a pr√≥xima mensagem de remo√ß√£o.  Isso est√° no PIMv1. <br>  E no PIMv2, o timer de atualiza√ß√£o de estado √© adicionado (por padr√£o, 60 segundos).  Assim que uma mensagem de remo√ß√£o for enviada do R3, esse timer inicia no R3.  Depois que esse timer expirar, o R3 enviar√° uma mensagem de atualiza√ß√£o de estado que redefinir√° o temporizador de remo√ß√£o de 3 minutos para R2 para este grupo. <br>  Raz√µes para enviar uma mensagem de remo√ß√£o: <br><ul><li>  Quando um pacote multicast falhou em uma verifica√ß√£o RPF. </li><li>  Quando n√£o h√° clientes conectados localmente que solicitaram um grupo multicast (jun√ß√£o IGMP) e nenhum vizinho PIM para quem o tr√°fego multicast pode ser enviado (interface sem remo√ß√£o). </li></ul><br>  <b>Mensagem de enxerto.</b> <br>  Imagine que o R3 n√£o quisesse tr√°fego do R2, enviou o Prune e recebeu multicast do R1.  Mas de repente, o canal caiu entre R1-R3 e R3 ficou sem multicast.  Voc√™ pode esperar 3 minutos at√© que o Prune Timer expire no R2.  3 minutos para esperar muito tempo, para n√£o esperar, voc√™ precisa enviar uma mensagem que exiba instantaneamente essa interface S0 / 1 no R2 a partir do estado podado.  Esta mensagem ser√° uma mensagem de enxerto.  Ap√≥s receber a mensagem Graft, o R2 enviar√° um Graft-ACK em resposta. <br>  <b>Substitui√ß√£o de remo√ß√£o de poda.</b> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/bc7/1d0/e9f/bc71d0e9f81b292e75d4a016a9b657ef.png" alt="Minha imagem"></a> <br>  Vamos olhar para este esquema.  O R1 transmite multicast em um segmento com dois roteadores.  R3 recebe e transmite tr√°fego, R2 recebe, mas n√£o tem ningu√©m para transmitir tr√°fego.  Ele envia uma mensagem de remo√ß√£o para R1 neste segmento.  O R1 deve remover Fa0 / 0 da lista e parar de transmitir neste segmento, mas o que acontecer√° com o R3?  E R3 est√° no mesmo segmento, ele tamb√©m recebeu essa mensagem da Prune e percebeu a trag√©dia da situa√ß√£o.  Antes de R1 parar de transmitir, ele define o temporizador para 3 segundos e para de transmitir ap√≥s 3 segundos.  3 segundos - tanto tempo para o R3, para n√£o perder o multicast.  Portanto, o R3, assim que poss√≠vel, envia uma mensagem Pim Join para esse grupo e o R1 n√£o pensa mais em interromper a transmiss√£o.  Sobre Participe das postagens abaixo. <br>  <b>Afirmar mensagem.</b> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f1d/9d1/d68/f1d9d1d6855fdc188deb28c75bde2d0d.png" alt="Minha imagem"></a> <br>  Imagine esta situa√ß√£o: dois roteadores transmitem para a mesma rede ao mesmo tempo.  Eles recebem o mesmo fluxo da fonte e os transmitem para a mesma rede atr√°s da interface e0.  Portanto, eles precisam determinar quem ser√° o √∫nico transmissor √∫nico para esta rede.  As mensagens de afirma√ß√£o s√£o usadas para isso.  Quando o R2 e o R3 detectam a duplica√ß√£o do tr√°fego multicast, ou seja, o multicast que eles transmitem no R2 e R3, que eles mesmos transmitem, os roteadores entendem que algo est√° errado aqui.  Nesse caso, os roteadores enviam mensagens Assert, que incluem a Dist√¢ncia administrativa e a m√©trica da rota pela qual a fonte multicast √© alcan√ßada - 10.1.1.10.  O vencedor √© determinado da seguinte forma: <br><ol><li>  Aquele com AD mais baixo. </li><li>  Se o AD for igual, quem tem a m√©trica mais baixa. </li><li>  Se houver igualdade, aquele com um IP mais alto na rede para a qual eles transmitem esse multicast. </li></ol><br>  Ganhando este voto, o roteador se torna o roteador designado.  O Pim Hello tamb√©m √© usado para selecionar DR.  No in√≠cio do artigo, uma mensagem Hello do PIM era exibida; √© poss√≠vel observar o campo DR.  O vencedor √© aquele com um endere√ßo IP mais alto neste link. <br>  Prato √∫til: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/3de/e1a/c84/3dee1ac8448b1fceaa9f1972eff802b7.png" alt="Minha imagem"></a> <br>  <b>Tabela MROUTE.</b> <br>  Ap√≥s a revis√£o inicial da opera√ß√£o do protocolo PIM, precisamos descobrir como trabalhar com a tabela de roteamento multicast.  A tabela mroute armazena informa√ß√µes sobre quais fluxos foram solicitados pelos clientes e quais fluxos fluem de servidores multicast. <br>  Por exemplo, ao receber um Relat√≥rio de Associa√ß√£o IGMP ou Jun√ß√£o PIM em alguma interface, uma entrada do tipo (*, G) √© adicionada √† tabela de roteamento: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/afd/3ed/52c/afd3ed52cef0f9f105a0b58dff18edee.jpg" alt="Minha imagem"></a> <br>  Esta entrada significa que uma solicita√ß√£o de tr√°fego foi recebida com o endere√ßo 238.38.38.38.  O sinalizador DC significa que o multicast funcionar√° no modo Denso e C significa que o destinat√°rio est√° diretamente conectado ao roteador, ou seja, o roteador recebeu o Relat√≥rio de Associa√ß√£o IGMP e a Ingresso no PIM. <br>  Se houver um registro como (S, G) significa que temos um fluxo multicast: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a78/cf2/332/a78cf23325ddc6e0c3d65322340d7ff6.jpg" alt="Minha imagem"></a> <br>  No campo S - 192.168.1.11, registramos o endere√ßo IP da fonte multicast, que ser√° verificado pela regra RPF.  Em caso de problemas, a primeira coisa a fazer √© verificar a tabela Unicast para a rota para a origem.  No campo Interface de entrada indica a interface √† qual o multicast chega.  Na tabela de roteamento unicast, a rota para a fonte deve se referir √† interface especificada aqui.  A interface de sa√≠da indica para onde o multicast ser√° redirecionado.  Se estiver vazio, n√£o houve solicita√ß√µes para esse tr√°fego para o roteador.  Mais informa√ß√µes sobre todas as bandeiras podem ser encontradas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br>  <b>Modo PIM Esparso.</b> <br>  A estrat√©gia do modo esparso √© o oposto do modo denso.  Quando o modo Sparse recebe tr√°fego multicast, ele envia tr√°fego somente atrav√©s das interfaces em que houve solicita√ß√µes para esse fluxo, por exemplo, mensagens Pim Join ou IGMP Report solicitando esse tr√°fego. <br>  Elementos semelhantes para SM e DM: <br><ul><li>  Os relacionamentos de vizinhan√ßa s√£o constru√≠dos da mesma maneira que no PIM DM. </li><li>  A regra RPF funciona. </li><li>  A escolha do DR √© semelhante. </li><li>  O mecanismo Substitui√ß√µes de exclus√£o e mensagens Assert s√£o semelhantes. </li></ul><br>  Para controlar quem precisa de onde, onde e qual tr√°fego multicast √© necess√°rio na rede, √© necess√°rio um centro de informa√ß√µes comum.  Nesse centro, teremos o Ponto de Encontro (RP).  Quem quiser algum tipo de tr√°fego multicast ou algu√©m come√ßar a receber tr√°fego multicast da origem, ele o envia ao RP. <br>  Quando o RP recebe tr√°fego multicast, ele ser√° enviado aos roteadores que solicitaram esse tr√°fego anteriormente. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/025/d45/651/025d4565117dce5f8da07609c823c63e.jpg" alt="Minha imagem"></a> <br>  Imagine uma topologia em que RP √© R3.  Assim que o R1 recebe o tr√°fego do S1, ele encapsula esse pacote multicast em uma mensagem de registro PIM unicast e o envia ao RP.  Como ele sabe quem √© RP?  Nesse caso, ele √© configurado estaticamente, e falaremos sobre o ajuste din√¢mico de RP posteriormente. <br><blockquote>  ip pim rp-address 3.3.3.3 </blockquote><br>  O RP procurar√° - houve alguma informa√ß√£o de algu√©m que gostaria de receber esse tr√°fego?  Suponha que n√£o fosse.  Em seguida, o RP enviar√° ao R1 uma mensagem PIM Register-Stop, o que significa que ningu√©m precisa desse multicast, o registro √© negado.  R1 n√£o enviar√° multicasts.  Mas a fonte multicast o enviar√°, ent√£o R1, depois de receber o registro-parada, iniciar√° o timer de registro-supress√£o, que √© de 60 segundos.  5 segundos antes do tempo expirar, o R1 enviar√° uma mensagem de registro vazia com um bit de registro nulo (ou seja, sem um pacote multicast encapsulado) para o lado do RP.  O RP, por sua vez, agir√° assim: <br><ul><li>  Se n√£o houver e nenhum destinat√°rio, ele responder√° com uma mensagem de parada de registro. </li><li>  Se os destinat√°rios aparecerem, ele n√£o responder√° de forma alguma.  O R1, n√£o tendo recebido uma recusa em seu registro dentro de 5 segundos, ficar√° encantado e enviar√° ao RP uma mensagem com o multicast encapsulado para registrar. </li></ul><br>  √Ä medida que o multicast atinge o RP, parece ser resolvido, agora vamos tentar responder √† pergunta de como o RP traz tr√°fego para os destinat√°rios.  Aqui voc√™ precisa introduzir um novo conceito - √°rvore do caminho raiz (RPT).  Um RPT √© uma √°rvore com uma raiz no RP crescendo para os destinat√°rios que se ramificam em cada roteador PIM-SM.  O RP o cria recebendo mensagens de ingresso no PIM e adiciona um novo ramo √† √°rvore.  E o mesmo acontece com todos os roteadores a jusante.  A regra geral √© assim: <br><ul><li>  Quando um roteador PIM-SM recebe uma mensagem de PIM Join em qualquer interface, exceto na interface na qual o RP est√° oculto, ele adiciona uma nova ramifica√ß√£o √† √°rvore. </li><li>  Uma filial tamb√©m √© adicionada quando o roteador PIM-SM recebe um Relat√≥rio de Associa√ß√£o IGMP de um host conectado diretamente. </li></ul><br>  Imagine que temos um cliente multicast no roteador R5 para o grupo 228.8.8.8.  Assim que o R5 recebe um relat√≥rio de associa√ß√£o IGMP do host, o R5 envia uma jun√ß√£o PIM na dire√ß√£o do RP e ele pr√≥prio adiciona uma interface que olha o host na √°rvore.  Em seguida, o R4 recebe uma jun√ß√£o PIM do R5, adiciona a interface Gi0 / 1 √† √°rvore e envia a jun√ß√£o PIM na dire√ß√£o do RP.  Finalmente, o RP (R3) recebe uma jun√ß√£o PIM e adiciona Gi0 / 0 √† √°rvore.  Assim, √© obtido o registro do destinat√°rio multicast.  Estamos construindo uma √°rvore com a raiz R3-Gi0 / 0 ‚Üí R4-Gi0 / 1 ‚Üí R5-Gi0 / 0. <br>  Depois disso, a jun√ß√£o do PIM ser√° enviada para o R1 e o R1 come√ßar√° a enviar o tr√°fego multicast.  √â importante observar que, se o host solicitou tr√°fego antes do in√≠cio da transmiss√£o multicast, o RP n√£o enviar√° a jun√ß√£o ao PIM e n√£o enviar√° nada para o lado R1. <br>  Se de repente, enquanto um multicast estiver sendo enviado, o host parar de desejar receb√™-lo, assim que o RP receber o PIM Prune na interface Gi0 / 0, ele envia imediatamente o PIM Register-Stop diretamente para R1 e, em seguida, a mensagem PIM Prune atrav√©s da interface Gi0 / 1.  A parada e registro do PIM √© enviada pelo Unicast para o endere√ßo de onde o registro PIM chegou. <br>  Como dissemos antes, assim que o roteador envia um PIM Join para outro, por exemplo, R5 no R4, uma entrada √© adicionada ao R4: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/9f7/730/678/9f7730678743efb4e9670d18fcd54525.jpg" alt="Minha imagem"></a> <br>  E o cron√¥metro inicia que, para redefinir esse cron√¥metro, o R5 deve constantemente entrar no PIM constantemente com as mensagens, caso contr√°rio o R4 ser√° exclu√≠do da lista de sa√≠da.  O R5 enviar√° a cada 60 mensagens de ingresso no PIM. <br>  <b>Troca de √°rvore de caminho mais curto.</b> <br>  Adicionaremos uma interface entre R1 e R5, ver como o tr√°fego fluir√° com essa topologia. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/afd/113/eb0/afd113eb01e7deda4c389fbb1a02060a.jpg" alt="Minha imagem"></a> <br>  Digamos que o tr√°fego foi enviado e recebido de acordo com o antigo esquema R1-R2-R3-R4-R5 e aqui conectamos e configuramos a interface entre R1 e R5. <br>  Primeiro, precisamos reconstruir a tabela de roteamento unicast no R5 e agora a rede 192.168.1.0/24 √© alcan√ßada atrav√©s da interface R5 Gi0 / 2.  Agora, quando o R5 recebe um multicast na interface Gi0 / 1, ele entende que a regra RPF n√£o √© satisfeita e seria mais l√≥gico receber um multicast no Gi0 / 2.  Ele deve se desconectar do RPT e criar uma √°rvore mais curta chamada SPT (Shortest-Path Tree).  Para fazer isso, atrav√©s do Gi0 / 2, ele envia uma jun√ß√£o PIM para o R1 e o R1 come√ßa a enviar multicasts tamb√©m pelo Gi0 / 2.  Agora o R5 deve cancelar a inscri√ß√£o no RPT, para n√£o obter duas c√≥pias.  Para isso, ele envia uma mensagem de remo√ß√£o indicando o endere√ßo IP da fonte e inserindo um bit especial - RPT-bit.  Isso significa que n√£o preciso enviar tr√°fego, tenho uma √°rvore melhor aqui.  O RP tamb√©m envia mensagens para o lado R1 PIM Prune, mas n√£o envia uma mensagem Register-Stop.  Outro recurso: o R5 agora envia constantemente o PIM Prune para o RP, pois o R1 continua a enviar o PIM Register para o RP a cada minuto.  RP at√© que novas pessoas desejem que esse tr√°fego o recuse.  O R5 notifica o RP de que continua recebendo multicast via SPT. <br>  <b>Pesquisa din√¢mica de RP.</b> <b><br></b>  <b>Auto-RP</b> <br>  Essa tecnologia √© propriet√°ria da Cisco e n√£o √© particularmente popular, mas ainda est√° viva.  O Auto-RP consiste em duas etapas principais: <br>  1) O RP envia mensagens RP-Announce para o endere√ßo reservado - 224.0.1.39, declarando-se RP para todos ou para determinados grupos.  Esta mensagem √© enviada a cada minuto. <br>  2) √â necess√°rio um agente de mapeamento de RP que envie mensagens de descoberta de RP indicando para quais grupos RP ouvir.  √â a partir dessa mensagem que os roteadores PIM comuns determinam o RP para eles mesmos.  O Mapping Agent pode ser o pr√≥prio roteador RP ou qualquer roteador PIM separado.  O RP-Discovery √© enviado para o endere√ßo 224.0.1.40 com um timer de um minuto. <br>  Vejamos o processo com mais detalhes: <br>  Defina R3 como RP: <br><blockquote>  IP pim enviar-rp-anunciar loopback 0 escopo 10 </blockquote><br>  R2 como um agente de mapeamento: <br><blockquote>  escopo de loopback 0 do ip pim send-rp-discovery 0 </blockquote><br>  E em todos os outros, esperaremos o RP atrav√©s do Auto-RP: <br><blockquote>  ouvinte do autorp do ip pim </blockquote><br>  Depois de configurar o R3, ele come√ßar√° a enviar o RP-Announce: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/aae/ae2/565/aaeae25659fbacd4ba49ae4c5486f46f.jpg" alt="Minha imagem"></a> <br>  E o R2, depois de configurar o agente de mapeamento, aguardar√° a mensagem RP-Announce.  Somente quando ele encontrar pelo menos um RP, ele come√ßar√° a enviar o RP-Discovery: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/fb8/e44/7c2/fb8e447c26e33ecda18cb82c5f05c938.jpg" alt="Minha imagem"></a> <br>  Portanto, assim que os roteadores comuns (PIM RP Listener) receberem essa mensagem, eles saber√£o onde procurar o RP. <br>  Um dos principais problemas do Auto-RP √© que, para receber as mensagens RP-Announce e RP-Discovery, voc√™ precisa enviar a PIM Join para os endere√ßos 224.0.1.39-40 e, para envi√°-lo, √© necess√°rio saber onde est√° o RP.  O problema cl√°ssico de frango e ovos.  Para resolver esse problema, o PIM Sparse-Dense-Mode foi inventado.  Se o roteador n√£o conhece o RP, ele funciona no modo denso, se souber, no modo esparso.  Quando o modo PIM Sparse e o comando ip pim autorp listener est√£o configurados nas interfaces de roteadores comuns, o roteador funcionar√° no modo Denso apenas para o protocolo Auto-RP multicast diretamente (224.0.1.39-40). <br>  <b>Roteador BootStrap (BSR).</b> <br>  Esta fun√ß√£o funciona de maneira semelhante ao Auto-RP.  Cada RP envia uma mensagem do agente de mapeamento, que coleta informa√ß√µes de mapeamento e informa a todos os outros roteadores.  Descrevemos o processo de maneira semelhante ao Auto-RP: <br>  1) Depois de configurar o R3 como candidato a ser um RP, o comando: <br><blockquote>  loopback 0 do candidato do rp do ip pim </blockquote><br>  Como o R3 n√£o far√° nada, para come√ßar a enviar mensagens especiais, ele, para come√ßar, precisa encontrar um agente de mapeamento.  Assim, passamos para o segundo passo. <br>  2) Configure o R2 como um agente de mapeamento: <br><blockquote>  loopback 0 do pim bsr-candidato do ip </blockquote><br>  O R2 come√ßa a enviar mensagens do PIM Bootstrap, onde se indica como um agente de mapeamento: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/729/3a4/ad1/7293a4ad164ed8342ff42ceffee9a32b.jpg" alt="Minha imagem"></a> <br>  Esta mensagem √© enviada para o endere√ßo 224.0.013, que o protocolo PIM usa para suas outras mensagens.  Ele os envia em todas as dire√ß√µes e, portanto, n√£o h√° problema de frango e ovos, como foi o caso do Auto-RP. <br>  3) Assim que o RP receber uma mensagem do BSR do roteador, ele enviar√° imediatamente uma mensagem unicast para o endere√ßo do BSR do roteador: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5ed/217/8c1/5ed2178c151886f79c1e6197b9b5385b.jpg" alt="Minha imagem"></a> <br>  Depois disso, quando o BSR receber informa√ß√µes sobre o RP, ele ser√° enviado com multicast para o endere√ßo 224.0.0.13, que todos os roteadores PIM escutam.  Portanto, n√£o h√° um an√°logo do <i>comando ip pim autorp listener</i> para roteadores regulares no BSR. <br>  <b>Anycast RP com MSDP (Multicast Source Discovery Protocol).</b> <br>  O Auto-RP e o BSR nos permitem distribuir a carga no RP da seguinte maneira: Cada grupo multicast possui apenas um RP ativo.  N√£o funcionar√° para tornar a distribui√ß√£o de carga para um grupo multicast RP m√∫ltiplo.  O MSDP faz isso emitindo aos roteadores RP o mesmo endere√ßo IP com uma m√°scara 255.255.255.255.  O MSDP reconhece as informa√ß√µes usando um dos m√©todos: est√°tico, Auto-RP ou BSR. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/406/51a/032/40651a032dadaaf6e0c51cbf06c3fbf3.png" alt="Minha imagem"></a> <br>  Na figura, temos uma configura√ß√£o Auto-RP com MSDP.  Ambos os RPs s√£o configurados com o endere√ßo IP 172.16.1.1/32 na interface Loopback 1 e s√£o usados ‚Äã‚Äãpara todos os grupos.  Quando o RP-Announce, os dois roteadores falam sobre si mesmos, referindo-se a este endere√ßo.  Ap√≥s receber as informa√ß√µes, o agente de mapeamento do Auto-RP envia o RP-Discovery sobre o RP com o endere√ßo 172.16.1.1/32.  Sobre a rede 172.16.1.1/32, informamos aos roteadores usando IGP e, respectivamente.  Assim, os roteadores PIM solicitam ou registram fluxos do RP indicado como pr√≥ximo salto na rota para a rede 172.16.1.1/32.  O pr√≥prio protocolo MSDP foi projetado para os pr√≥prios RPs trocarem mensagens de informa√ß√µes multicast. <br>  Considere a seguinte topologia: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/2ba/f2d/dc4/2baf2ddc4deb54ebb671a6fb52282a41.jpg" alt="Minha imagem"></a> <br>  O Switch6 transmite o tr√°fego para o endere√ßo 238.38.38.38 e at√© agora apenas o RP-R1 sabe disso.  Aqui, Switch7 e Switch8 solicitaram esse grupo.  Os roteadores R5 e R4 enviar√£o o PIM Join para R1 e R3, respectivamente.  Porque  A rota at√© 13.13.13.13 no R5 far√° refer√™ncia ao R1 de acordo com a m√©trica IGP, como no R4. <br>  O RP-R1 conhece o fluxo e come√ßa a transmiti-lo para o R5, mas o R4 n√£o sabe nada sobre isso, pois o R1 simplesmente n√£o o envia.  Portanto, o MSDP √© necess√°rio.  N√≥s o configuramos em R1 e R5: <br><blockquote>  ponto de conex√£o 3.3d do ip msdp loopback1 de origem na R1 </blockquote><br><blockquote>  ponto de conex√£o 1.1.1.1 do msdp do ip loopback3 na fonte R3 </blockquote><br>  Eles criar√£o uma sess√£o entre si e, ao receberem qualquer fluxo, a reportar√£o ao seu vizinho RP. <br>  RP-R1, assim que receber o fluxo do Switch6, ele enviar√° imediatamente uma mensagem ativa de origem Unicast MSDP que conter√° informa√ß√µes como (S, G) - informa√ß√µes sobre a origem e o destino do multicast.  Agora, quando o RP-R3 souber que uma fonte como o Switch6, ele enviar√° uma jun√ß√£o do PIM ao Switch6 ao receber uma solicita√ß√£o do R4 para esse fluxo, sendo guiado pela tabela de roteamento.  Portanto, o R1 que recebeu uma jun√ß√£o PIM, come√ßar√° a enviar tr√°fego para o RP-R3. <br>  O MSDP √© executado sobre o TCP, os RPs enviam mensagens de manuten√ß√£o permanente para verificar a viabilidade.  O temporizador √© de 60 segundos. <br>     MSDP    ,     Keepalive  SA    - .           ‚Äî     . <br>  -   ,     . <br><br>     .     ,  : <br><ol><li> CCIE Routing and Switching v5.0 Official Cert Guide, Volume 2, Fifth Edition, Narbik Kocharians, Terry Vinson. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   .  . </a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt450582/">https://habr.com/ru/post/pt450582/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt450568/index.html">Cada veneno tem seu pr√≥prio ant√≠doto. Como salvar ou pelo menos tentar (atual: sobre ant√≠dotos para intoxica√ß√£o dom√©stica)</a></li>
<li><a href="../pt450572/index.html">Samba DC como um segundo controlador no dom√≠nio AD do Windows 2012R2 e pastas m√≥veis para clientes no Windows e Linux</a></li>
<li><a href="../pt450574/index.html">Crie um jogo na web para m√∫ltiplos jogadores .io</a></li>
<li><a href="../pt450576/index.html">Novas regras para o anonimato do messenger</a></li>
<li><a href="../pt450578/index.html">O que √© ouvido no ar? Recebemos e decodificamos os sinais mais interessantes. Parte 2, VHF</a></li>
<li><a href="../pt450586/index.html">Fish Redux - Nova Biblioteca Redux para Flutter</a></li>
<li><a href="../pt450592/index.html">Na Alemanha, o custo de viajar em um carro el√©trico pode ser maior do que em um carro a diesel</a></li>
<li><a href="../pt450594/index.html">N√∫meros pares de Fibonacci</a></li>
<li><a href="../pt450596/index.html">11. Introdu√ß√£o ao Ponto de Verifica√ß√£o R80.20. Pol√≠tica de preven√ß√£o de amea√ßas</a></li>
<li><a href="../pt450598/index.html">Sobre a "chuva amarela" e o "agente laranja"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>