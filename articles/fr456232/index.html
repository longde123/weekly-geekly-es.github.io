<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👩‍👧‍👧 ✊🏼 🧓🏼 Guide: mise à jour des interfaces avec les membres par défaut dans C # 8.0 👩🏽‍🏫 🤾 🧑🏿‍🤝‍🧑🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="À partir de C # 8.0 sur .NET Core 3.0, lors de la création d'un membre d'une interface, vous pouvez déterminer son implémentation. Le scénario le plus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guide: mise à jour des interfaces avec les membres par défaut dans C # 8.0</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/456232/">  À partir de C # 8.0 sur .NET Core 3.0, lors de la création d'un membre d'une interface, vous pouvez déterminer son implémentation.  Le scénario le plus courant consiste à ajouter en toute sécurité des membres à une interface déjà publiée et utilisée par d'innombrables clients. <br><br><p>  Dans ce guide, vous apprendrez à: </p><br><ul><li>  Il est sûr d'étendre les interfaces en ajoutant des méthodes avec des implémentations. </li><li>  Créez des implémentations paramétrées pour une plus grande flexibilité. </li><li>  Obtenir le droit d'implémenter des implémentations plus spécifiques avec la possibilité d'un contrôle manuel. </li></ul><br><img src="https://habrastorage.org/webt/ol/gr/ie/olgriec_2o-qik7jkltm_pxyo34.jpeg"><a name="habracut"></a><br><br><h2>  Par où commencer? </h2><br><p>  Vous devez d'abord configurer la machine pour qu'elle fonctionne avec .NET Core, y compris le compilateur de l'aperçu C # 8.0.  Un tel compilateur est disponible à partir de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Visual Studio 2019</a> ou du plus récent <a href="">SDK d'aperçu .NET Core 3.0</a> .  Les membres de l'interface par défaut sont disponibles à partir de .NET Core 3.0 (aperçu 4). </p><br><h2>  Présentation du scénario </h2><br><p>  Ce didacticiel commence par la première version de la bibliothèque de relations clients.  Vous pouvez obtenir l'application de démarrage dans notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référentiel sur GitHub</a> .  L'entreprise qui a créé cette bibliothèque a supposé que les clients avec des applications existantes les adapteraient à cette bibliothèque.  Les utilisateurs ont été présentés avec les définitions d'interface minimales pour la mise en œuvre: </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICustomer</span></span> { IEnumerable&lt;IOrder&gt; PreviousOrders { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } DateTime DateJoined { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } DateTime? LastOrder { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IDictionary&lt;DateTime, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; Reminders { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><p>  Une deuxième interface a également été définie qui montre l'ordre: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IOrder</span></span> { DateTime Purchased { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> Cost { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><p>  Sur la base de ces interfaces, l'équipe peut créer une bibliothèque pour ses utilisateurs afin de créer la meilleure expérience pour les clients.  L'objectif de l'équipe était d'augmenter le niveau d'interaction avec les clients existants et de développer des relations avec de nouveaux clients. </p><br><p>  Il est temps de mettre à jour la bibliothèque pour la prochaine version.  L'une des fonctionnalités les plus populaires est l'ajout de remises aux clients fidèles qui passent un grand nombre de commandes.  Cette nouvelle remise individuelle est appliquée chaque fois qu'un client passe une commande. Pour chaque implémentation de ICustomer, différentes règles de remise fidélité peuvent être définies. <br></p><p>  La façon la plus pratique d'ajouter cette fonctionnalité est d'étendre l'interface <code>ICustomer</code> avec des remises.  Cette proposition a inquiété les développeurs expérimentés.  «Les interfaces sont immuables après la sortie!  C'est un changement critique! »  Dans C # 8.0, des implémentations d'interface par défaut pour la mise à jour des interfaces ont été ajoutées.  Les auteurs de bibliothèque peuvent ajouter de nouveaux membres et les implémenter par défaut </p><br><p>  L'implémentation par défaut des interfaces permet aux développeurs de mettre à jour l'interface, tout en permettant aux autres développeurs de remplacer cette implémentation.  Les utilisateurs de bibliothèque peuvent accepter l'implémentation par défaut comme une modification non critique. </p><br><h2>  Mettre à jour à l'aide des membres de l'interface par défaut </h2><br><p>  L'équipe a approuvé l'implémentation par défaut la plus probable: une remise sur la fidélité des clients. </p><br><p>  La mise à jour doit être fonctionnelle pour définir deux propriétés: le nombre de commandes nécessaires pour bénéficier d'une remise et le pourcentage de la remise.  Cela en fait un script idéal pour les membres de l'interface par défaut.  Vous pouvez ajouter une méthode à l'interface ICustomer et fournir son implémentation la plus probable.  Toutes les implémentations existantes et nouvelles peuvent être implémentées par défaut ou avoir leurs propres paramètres. </p><br><p>  Ajoutez d'abord une nouvelle méthode à l'implémentation: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  1: public decimal ComputeLoyaltyDiscount() { DateTime TwoYearsAgo = DateTime.Now.AddYears(-2); if ((DateJoined &lt; TwoYearsAgo) &amp;&amp; (PreviousOrders.Count() &gt; 10)) { return 0.10m; } return 0; }</span></span></code> </pre> <br><p>  L'auteur de la bibliothèque a écrit le premier test pour vérifier l'implémentation: </p><br><pre> <code class="cs hljs">SampleCustomer c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SampleCustomer(<span class="hljs-string"><span class="hljs-string">"customer one"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">2010</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>)) { Reminders = { { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">2010</span></span>, <span class="hljs-number"><span class="hljs-number">08</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>), <span class="hljs-string"><span class="hljs-string">"childs's birthday"</span></span> }, { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">1012</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>), <span class="hljs-string"><span class="hljs-string">"anniversary"</span></span> } } }; SampleOrder o = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SampleOrder(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">2012</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">5</span></span>m); c.AddOrder(o); o = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SampleOrder(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">2103</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-number"><span class="hljs-number">25</span></span>m); c.AddOrder(o); <span class="hljs-comment"><span class="hljs-comment">//  : ICustomer theCustomer = c; Console.WriteLine($"Current discount: {theCustomer.ComputeLoyaltyDiscount()}");</span></span></code> </pre> <br><p>  Faites attention à la partie suivante du test: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  : ICustomer theCustomer = c; Console.WriteLine($"Current discount: {theCustomer.ComputeLoyaltyDiscount()}");</span></span></code> </pre> <br><p>  Cette partie, de <code>SampleCustomer</code> à <code>ICustomer</code> est importante.  La classe <code>SampleCustomer</code> ne <code>SampleCustomer</code> pas fournir d'implémentation pour <code>ComputeLoyaltyDiscount</code> ;  cela est fourni par l'interface <code>ICustomer</code> .  Cependant, la classe <code>SampleCustomer</code> n'hérite pas des membres de ses interfaces.  Cette règle n'a pas changé.  Pour appeler une méthode implémentée dans une interface, la variable doit être un type d'interface, dans cet exemple <code>ICustomer</code> . </p><br><h2>  Paramétrisation </h2><br><p>  C’est un bon début.  Mais l'implémentation par défaut est trop limitée.  De nombreux consommateurs de ce système peuvent choisir différents seuils pour le nombre d'achats, différentes durées d'adhésion ou différentes remises en pourcentage. Vous pouvez améliorer le processus de mise à niveau pour davantage de clients en fournissant un moyen de définir ces paramètres.  Ajoutons une méthode statique qui définit ces trois paramètres qui contrôlent l'implémentation par défaut: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  2: public static void SetLoyaltyThresholds( TimeSpan ago, int minimumOrders = 10, decimal percentageDiscount = 0.10m) { length = ago; orderCount = minimumOrders; discountPercent = percentageDiscount; } private static TimeSpan length = new TimeSpan(365 * 2, 0,0,0); // two years private static int orderCount = 10; private static decimal discountPercent = 0.10m; public decimal ComputeLoyaltyDiscount() { DateTime start = DateTime.Now - length; if ((DateJoined &lt; start) &amp;&amp; (PreviousOrders.Count() &gt; orderCount)) { return discountPercent; } return 0; }</span></span></code> </pre> <br><p>  Ce petit morceau de code montre beaucoup de nouvelles fonctionnalités de langage.  Les interfaces peuvent désormais inclure des membres statiques, y compris des champs et des méthodes.  Divers modificateurs d'accès sont également inclus.  Les champs supplémentaires sont privés et la nouvelle méthode est publique.  Tous les modificateurs sont autorisés pour les membres de l'interface. </p><br><p>  Les applications qui utilisent la formule générale pour calculer les remises de fidélité, mais avec des paramètres différents, ne doivent pas fournir une implémentation personnalisée;  ils peuvent définir des arguments par la méthode statique.  Par exemple, le code suivant configure «l'appréciation du client», qui récompense tout client avec un abonnement de plus d'un mois: </p><br><pre> <code class="cs hljs">ICustomer.SetLoyaltyThresholds(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeSpan(<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.25</span></span>m); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"Current discount: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{theCustomer.ComputeLoyaltyDiscount()}</span></span></span><span class="hljs-string">"</span></span>);</code> </pre> <br><h2>  Étendre l'implémentation par défaut </h2><br><p>  Le code que vous avez ajouté précédemment fournissait une implémentation pratique pour les scénarios où les utilisateurs veulent quelque chose comme l'implémentation par défaut ou fournissent un ensemble de règles sans rapport.  Pour la version finale, réorganisons un peu le code pour inclure des scénarios dans lesquels les utilisateurs peuvent vouloir s'appuyer sur l'implémentation par défaut. </p><br><p>  Considérez une startup qui veut attirer de nouveaux clients.  Ils offrent une remise de 50% sur la première commande d'un nouveau client.  Les clients existants bénéficient d'une remise standard.  L'auteur de la bibliothèque doit déplacer l'implémentation par défaut vers la méthode <code>protected static</code> afin que toute classe qui implémente cette interface puisse réutiliser le code dans son implémentation.  L'implémentation par défaut d'un membre d'interface appelle également cette méthode générique: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeLoyaltyDiscount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; DefaultLoyaltyDiscount(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DefaultLoyaltyDiscount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ICustomer c</span></span></span><span class="hljs-function">)</span></span> { DateTime start = DateTime.Now - length; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((c.DateJoined &lt; start) &amp;&amp; (c.PreviousOrders.Count() &gt; orderCount)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> discountPercent; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  Dans l'implémentation de la classe qui implémente cette interface, vous pouvez appeler manuellement la méthode d'assistance statique et étendre cette logique pour fournir une remise au «nouveau client»: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeLoyaltyDiscount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PreviousOrders.Any() == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0.50</span></span>m; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ICustomer.DefaultLoyaltyDiscount(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre> <br><p>  Vous pouvez voir tout le code fini dans notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référentiel sur GitHub</a> . </p><br><p>  Ces nouvelles fonctionnalités signifient que les interfaces peuvent être mises à jour en toute sécurité s'il existe une implémentation par défaut acceptable pour les nouveaux membres.  Concevez soigneusement les interfaces pour exprimer des idées fonctionnelles individuelles qui peuvent être mises en œuvre par plusieurs classes.  Cela facilite la mise à jour de ces définitions d'interface lorsque de nouvelles exigences sont trouvées pour la même idée fonctionnelle. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456232/">https://habr.com/ru/post/fr456232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456220/index.html">Généralisation du problème Brokar</a></li>
<li><a href="../fr456222/index.html">Le génie génétique des embryons humains deviendra sûr et efficace dans deux ans</a></li>
<li><a href="../fr456224/index.html">Annonce de l'aperçu 6 de .NET Core 3.0</a></li>
<li><a href="../fr456226/index.html">Prédiction des résultats du football</a></li>
<li><a href="../fr456230/index.html">Iobroker quest for quests in reality games</a></li>
<li><a href="../fr456234/index.html">Pourquoi Cisco n'achète-t-il pas Splunk ou une discussion sur le fonctionnement de la plate-forme Cisco pour la chasse aux menaces</a></li>
<li><a href="../fr456236/index.html">Peter - Insider Dev Tour: Conférence Insider pour les développeurs de Microsoft</a></li>
<li><a href="../fr456238/index.html">Tutoriel: Mettre à jour les interfaces avec les membres d'interface par défaut dans C # 8.0</a></li>
<li><a href="../fr456240/index.html">Développement de chatbot (laravel + botman)</a></li>
<li><a href="../fr456242/index.html">Un peu plus sur le multitâche dans les microcontrôleurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>