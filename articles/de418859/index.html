<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📘 🌀 👋🏻 Einige PowerShell-Funktionen bei Verwendung von Benutzerkonten 🤞🏽 🔼 📋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich dachte, ich wäre ziemlich gut in Powershell, aber ich musste nie mit Benutzeranmeldeinformationen arbeiten. Jetzt bin ich jedoch auf Jobsuche und ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Einige PowerShell-Funktionen bei Verwendung von Benutzerkonten</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418859/">  Ich dachte, ich wäre ziemlich gut in Powershell, aber ich musste nie mit Benutzeranmeldeinformationen arbeiten.  Jetzt bin ich jedoch auf Jobsuche und bei einem der Interviews erhielt ich eine Testaufgabe, um ein Skript zu schreiben, das: <br><br><ol><li>  Überprüfen Sie die Verfügbarkeit und den Status (aktiviert / deaktiviert) des Benutzerkontos. </li><li>  Überprüfen Sie, ob das Konto in der Gruppe Administratoren enthalten ist </li><li>  Wenn kein Konto vorhanden ist, erstellen Sie ein Konto und fügen Sie es der Administratorgruppe hinzu. Aktivieren Sie die Kontrollkästchen "Kennwortänderung durch Benutzer verweigern" und "Kennwort ist nicht abgelaufen". </li><li>  Wenn das Konto vorhanden ist, aber deaktiviert ist oder nicht in der Gruppe Administratoren enthalten ist, aktivieren Sie das Konto und fügen Sie es der Gruppe Administratoren hinzu. Aktivieren Sie die Kontrollkästchen neben "Kennwortänderung durch Benutzer verweigern" und "Kennwort ist nicht abgelaufen". </li><li>  Das Skript sollte nicht von der Sprache des Betriebssystems abhängen. </li></ol><br><a name="habracut"></a><br>  Ich dachte, dass es nichts Kompliziertes gibt, und das erste, was ich überprüfen wollte, war der Admin-Benutzer auf meinem Computer.  Ohne nachzudenken, fuhr ich einen Befehl: <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">User</span></span> <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span></code> </pre> <br>  Und dann habe ich einen Fehler bekommen <br><br> <font color="#ff0000"><code>Get-User :  "Get-User"     , ,     .</code></font> <br> <br>  Ein wenig überrascht, weil ich einen so nützlichen Befehl nicht erkannt habe und festgestellt habe, dass der Befehl <b>Get-User</b> nur in der Powershell-Konsole für Exchange funktioniert.  Um mit lokalen Benutzern arbeiten zu können, müssen Sie <b>Get-Localuser</b> und für Domänenbenutzer <b>Get-Aduser verwenden</b> .  Als ich meinen Fehler erkannte, fuhr ich hinein: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-Localuser <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span></code> </pre> <br>  Und bekam eine Antwort <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">Name</span></span> Enabled Description <span class="hljs-comment"><span class="hljs-comment">---- ------- ----------- Admin True     /</span></span></code> </pre> <br>  Nun, jetzt ist es keine große Sache zu überprüfen, ob der Benutzer da ist oder nicht, aber auch hier habe ich auf einen weiteren Fang gewartet.  Die Verwendung der bedingten if else-Anweisung erwies sich als nicht so einfach. <br><br>  Tatsache ist, dass, wenn sich der Benutzer im System befindet, die Ausgabe nicht der Wert true ist, sondern eine ganze Reihe von Daten mit dem Namen und der Beschreibung des Benutzers dieses Konto aktiviert ist oder nicht.  Und wenn es keinen Benutzer gibt, gibt Powershell einen Fehler aus.  Nachdem ich mich im Internet umgesehen hatte, stellte ich fest, dass es für diese Zwecke besser ist, den Operator <b>try catch zu verwenden</b> . <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'admin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-ErrorAction</span></span> Stop | <span class="hljs-built_in"><span class="hljs-built_in">Out-Null</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>  <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">Catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>  <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red }</code> </pre> <br>  Ich habe die Variable $ user hinzugefügt, um das Ändern von Benutzernamen im gesamten Skript zu vereinfachen.  ErrorAction Stop ist erforderlich, damit das Skript bei diesem Schritt nicht aufgrund eines Fehlers unterbrochen wird.  Zeichen |  trennt die Pipeline-Schritte und Out-Null blendet die Fehlertextausgabe aus.  Ich habe auch eine Textausgabe mit Hervorhebung hinzugefügt, um das Skript bequem überprüfen zu können. <br><br>  Als nächstes wollte ich überprüfen, ob das Konto aktiviert oder deaktiviert ist.  Wie bereits erwähnt, erzeugt der Befehl Get-LocalUser eine ganze Reihe von Daten. Zur Überprüfung musste ich nur einen Enabled-Parameter mit dem Wert true oder false auswählen.  Dazu habe ich den folgenden Befehl verwendet: <br><br><pre> <code class="hljs powershell">(<span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span>).enabled</code> </pre> <br>  Nachdem ich sichergestellt hatte, dass es funktioniert, habe ich die folgende Überprüfung durchgeführt und einen Befehl zum Aktivieren des Benutzers hinzugefügt. <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'admin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span>).enabled <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-string"><span class="hljs-string">"True"</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">Enable-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green }</code> </pre> <br>  Um den Benutzer zu aktivieren, muss die Konsole natürlich unter Administratorrechten ausgeführt werden. <br><br>  Im zweiten Absatz der Aufgabe musste festgestellt werden, ob der Benutzer Mitglied der Administratorgruppe ist.  Um zu überprüfen, ob sich ein Benutzer in einer bestimmten Gruppe befindet, gibt es einen Befehl Get-LocalGroupMember.  Der Name der Gruppe von Administratoren hängt jedoch von der Sprache des Betriebssystems ab.  Daher musste ich die Standard-SID S-1-5-32-544 verwenden.  Ich habe auch einen Versuchsfang durchgesehen. <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'admin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-ErrorAction</span></span> Stop | <span class="hljs-built_in"><span class="hljs-built_in">Out-Null</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">Catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">Add-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green }</code> </pre> <br>  Wenn der Benutzer kein Mitglied der Gruppe ist, werden Administratoren hinzugefügt. <br>  In der nächsten Phase musste ich feststellen, ob für den Benutzer die Einstellung zur Kennwortänderung deaktiviert ist oder nicht.  Dann bin ich auf weitere Fallstricke gestoßen.  Tatsache ist, dass der Parameter PasswordExpires keine Werte zurückgibt, wenn der Benutzer ein unbegrenztes Kennwort hat.  Wenn dieses Kontrollkästchen deaktiviert ist, haben verschiedene Benutzer ein anderes Kennwortänderungsdatum.  Ich habe mir immer noch einen Ausweg aus dieser Situation ausgedacht: <br><br><pre> <code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span>).PasswordExpires <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-variable"><span class="hljs-variable">$null</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">set-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-PasswordNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green }</code> </pre> <br>  Als nächstes musste ich einen Benutzer erstellen.  Ich hatte auch hier nicht erwartet, dass ein Fang auf mich warten würde.  Beim Erstellen eines Benutzers mit dem Befehl <br><br><pre> <code class="hljs powershell"><span class="hljs-built_in"><span class="hljs-built_in">new-LocalUser</span></span> <span class="hljs-literal"><span class="hljs-literal">-User</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-password</span></span> P@ssW0rD!</code> </pre> <br>  Fehler zurückgegeben: <br><br> <font color="#ff0000"><code>    "Password".     "P@ssW0rD!"  "System.String"   "System.Security.SecureString".</code></font> <br> <br>  Tatsache ist, dass der Parameter -password SecureString anstelle der üblichen Textzeichenfolge verwenden sollte.  Zu diesem Zweck habe ich die Variable $ password erstellt und in securestring konvertiert. <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$password</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">convertto-securestring</span></span> <span class="hljs-string"><span class="hljs-string">"P@ssW0rD!"</span></span> <span class="hljs-literal"><span class="hljs-literal">-asplaintext</span></span> <span class="hljs-literal"><span class="hljs-literal">-force</span></span></code> </pre> <br>  Und das Skript selbst, um einen Benutzer zu erstellen und ihn der Gruppe der Administratoren hinzuzufügen <br><br><pre> <code class="hljs powershell"><span class="hljs-built_in"><span class="hljs-built_in">new-LocalUser</span></span> <span class="hljs-literal"><span class="hljs-literal">-User</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-password</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> <span class="hljs-literal"><span class="hljs-literal">-PasswordNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-literal"><span class="hljs-literal">-AccountNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Add-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span></code> </pre> <br>  Das fertige Skript, das alle Bedingungen berücksichtigt, die ich auf diese Weise erhalten habe: <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'admin'</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">convertto-securestring</span></span> <span class="hljs-string"><span class="hljs-string">"P@ssW0rD!"</span></span> <span class="hljs-literal"><span class="hljs-literal">-asplaintext</span></span> <span class="hljs-literal"><span class="hljs-literal">-force</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-ErrorAction</span></span> Stop | <span class="hljs-built_in"><span class="hljs-built_in">Out-Null</span></span> cls <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>  <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span>).enabled <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-string"><span class="hljs-string">"True"</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">Enable-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>    <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span>).PasswordExpires <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-variable"><span class="hljs-variable">$null</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">set-LocalUser</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-PasswordNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">Get-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-ErrorAction</span></span> Stop | <span class="hljs-built_in"><span class="hljs-built_in">Out-Null</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } <span class="hljs-keyword"><span class="hljs-keyword">Catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>      <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">Add-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>     <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green } } <span class="hljs-keyword"><span class="hljs-keyword">Catch</span></span> { cls <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>  <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Red <span class="hljs-built_in"><span class="hljs-built_in">new-LocalUser</span></span> <span class="hljs-literal"><span class="hljs-literal">-User</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-password</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> <span class="hljs-literal"><span class="hljs-literal">-PasswordNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-literal"><span class="hljs-literal">-AccountNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Add-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-built_in"><span class="hljs-built_in">write-host</span></span>  <span class="hljs-variable"><span class="hljs-variable">$user</span></span>       <span class="hljs-literal"><span class="hljs-literal">-foregroundcolor</span></span> Green }</code> </pre> <br>  Post scriptum <br><br>  Das Speichern des Administratorkennworts in einem Skript ist jedoch nicht die beste Sicherheitspraxis.  Dazu können Sie den Passwort-Hash verwenden, nicht das Passwort selbst. <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$user</span></span> = <span class="hljs-string"><span class="hljs-string">'admin1'</span></span> <span class="hljs-variable"><span class="hljs-variable">$hash</span></span> = <span class="hljs-string"><span class="hljs-string">"01000000d08c9ddf0115d1118c7a00c04fc297eb0100000048baf1b47a72d845b4eeda8659da9fd70000000002000000000010660000000100002000000004d2a3bf03aac92c2e172dc002d1fe8759da4655850462aface5c25f52921e05000000000e8000000002000020000000bfa652b6f7cc6845e3cee1831b54ab93dc272d0b2203024c3de8bc4789a2698a10000000923fb50dcf01125913534d0c1ba6d827400000002757df7d8a8b39c8e84b81323acff1d72419580a0022cf610926e5f081a2e895320088d482eb407f8157aad82f091abee7427b357e871d12238a8f74131238e7"</span></span> <span class="hljs-variable"><span class="hljs-variable">$hash</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">ConvertTo-SecureString</span></span> <span class="hljs-literal"><span class="hljs-literal">-String</span></span> <span class="hljs-variable"><span class="hljs-variable">$hash</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new-LocalUser</span></span> <span class="hljs-literal"><span class="hljs-literal">-User</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span> <span class="hljs-literal"><span class="hljs-literal">-password</span></span> <span class="hljs-variable"><span class="hljs-variable">$password</span></span> <span class="hljs-literal"><span class="hljs-literal">-PasswordNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-literal"><span class="hljs-literal">-AccountNeverExpires</span></span>:<span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Add-LocalGroupMember</span></span> <span class="hljs-literal"><span class="hljs-literal">-SID</span></span> S<span class="hljs-literal"><span class="hljs-literal">-1</span></span><span class="hljs-literal"><span class="hljs-literal">-5</span></span><span class="hljs-literal"><span class="hljs-literal">-32</span></span><span class="hljs-literal"><span class="hljs-literal">-544</span></span> <span class="hljs-literal"><span class="hljs-literal">-Member</span></span> <span class="hljs-variable"><span class="hljs-variable">$user</span></span></code> </pre><br>  Um einen Passwort-Hash zu erhalten, können Sie das folgende Skript verwenden <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$Secure</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">Read-Host</span></span> <span class="hljs-literal"><span class="hljs-literal">-AsSecureString</span></span> <span class="hljs-variable"><span class="hljs-variable">$Secure</span></span> <span class="hljs-variable"><span class="hljs-variable">$hash</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">ConvertFrom-SecureString</span></span> <span class="hljs-literal"><span class="hljs-literal">-SecureString</span></span> <span class="hljs-variable"><span class="hljs-variable">$Secure</span></span> <span class="hljs-variable"><span class="hljs-variable">$hash</span></span></code> </pre> <br>  Welches fragt nach einem Passwort von der Tastatur. <br><br>  Und ein kleiner Bonus, um alle deaktivierten Datensätze anzuzeigen <br><br><pre> <code class="hljs powershell"><span class="hljs-built_in"><span class="hljs-built_in">Get-LocalUser</span></span> | <span class="hljs-built_in"><span class="hljs-built_in">Where-Object</span></span> {<span class="hljs-variable"><span class="hljs-variable">$_</span></span>.enabled <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-variable"><span class="hljs-variable">$false</span></span>}</code> </pre> <br>  Ich hoffe, die Zeit, die ich verbracht habe, hilft jemandem bei seiner Arbeit.  Und für Sie selbst wird es nützlich sein, diese unschätzbare Erfahrung nicht zu vergessen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418859/">https://habr.com/ru/post/de418859/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418849/index.html">Die Zusammenfassung der Ereignisse für HR-Fachkräfte im Bereich IT für August 2018</a></li>
<li><a href="../de418851/index.html">Wie man die Illusion von Sicherheit in Form von intelligenten Kinderuhren kauft</a></li>
<li><a href="../de418853/index.html">Details zur Aktualisierung von Segregated Witness und den Konsequenzen seiner Einführung in Bitcoin</a></li>
<li><a href="../de418855/index.html">Öffnen Sie das Webinar „Erstellen einer Anwendung in Webpack + React + Express“.</a></li>
<li><a href="../de418857/index.html">Vorbereiten von SSL-Zertifikaten für die Installation</a></li>
<li><a href="../de418861/index.html">ReactOS startet jetzt mit einer BTRFS-Partition</a></li>
<li><a href="../de418863/index.html">Grundlegendes zu Render-Requisiten anhand eines Beispiels</a></li>
<li><a href="../de418867/index.html">Dynamische Programmierung bei Olympiadenproblemen</a></li>
<li><a href="../de418869/index.html">Einfacher als es klingt. Kapitel 9-10</a></li>
<li><a href="../de418871/index.html">Kegel Elvie Smart Trainer zur Stärkung der intimen Muskeln - warum Sie es brauchen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>