<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👋🏼 🤦🏽 🕑 Rendre la base de données disponible pour une connexion à distance 🍛 🚺 💫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour commencer, il y a des moments où vous devez créer une application avec une connexion à la base de données. Ceci est fait pour ne pas plonger dans...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Rendre la base de données disponible pour une connexion à distance</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461503/"> Pour commencer, il y a des moments où vous devez créer une application avec une connexion à la base de données.  Ceci est fait pour ne pas plonger dans le développement du backend et se concentrer sur le frontend en raison du manque de mains et de compétences.  Je ne prétends pas dire que ma solution sera sûre, mais ça marche. <br><br>  Comme je n'aime pas payer pour l'hébergement, j'ai utilisé le réseau à mon travail, il y a une IP blanche là-bas.  Voici sa structure: <br><br><img src="https://habrastorage.org/webt/uq/mk/6p/uqmk6plxi-kwn_kcow5frbi7ndk.jpeg"><br><br>  J'ai accès à plusieurs ordinateurs plus précisément à 192.168.1.2 (alias 192.168.0.2) Linux est là et à 192.168.0.3 avec Windows.  En général, pour mon application, j'ai choisi mysql et regardé ce qui est sous Linux.  Il y était déjà installé, mais personne ne connaît le mot de passe, et ceux qui le savaient ont oublié (ceux qui travaillaient avant moi).  Ayant découvert que personne n'avait besoin de lui, je l'ai supprimé et j'ai essayé de le réinstaller.  Il n'y avait pas assez de mémoire, et comme je devais y connecter un moniteur et un clavier avec une souris pour corriger cette erreur, j'ai décidé de quitter cette entreprise.  De plus, une machine Windows est beaucoup plus puissante et en plus de tout, je l'ai moi-même sur mon ordinateur portable.  En principe, je ne décrirai pas l'installation elle-même, il y a un tas de manuels et de vidéos à ce sujet.  Ayant installé mysql sur une machine Windows, j'ai décidé de sauvegarder les tables de l'ordinateur portable sur le poste de travail. <br><br>  Cela se fait comme ceci (dans mon cas): <br><br><pre><code class="bash hljs">mysqldump -uroot -p your_base &gt; dump_file.sql</code> </pre> <br>  Ensuite, dans la nouvelle base de données, nous créons la base de données et restaurons la sauvegarde sur la «nouvelle» machine. <br><br><pre> <code class="bash hljs">mysql -h localhost -u root -p</code> </pre><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> your_base; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> your_base;</code> </pre><br><pre> <code class="bash hljs">mysql -uroot -p your_base &lt; dump_file.sql</code> </pre><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>;</code> </pre><br><a name="habracut"></a><br>  Le fichier de sauvegarde doit être placé sur une nouvelle machine et éventuellement si ce n'est pas dans le répertoire des utilitaires, puis le chemin complet vers celui-ci.  (Je viens de télécharger une sauvegarde sur le github et de la cloner sur une nouvelle machine).  J'ajouterais comment les tableaux eux-mêmes sont créés, mais je n'ai pas enregistré les captures d'écran, et je pense que ce n'est pas difficile, même pour un étudiant de 2-3 ans. <br><br>  Lorsque j'ai restauré toutes les tables, il est temps de rendre l'accès à distance à la base de données accessible.  En général, ces commandes n'ont pas abouti (seules les autorisations de lecture ont été émises à sélectionner) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-string"><span class="hljs-string">'client'</span></span>@<span class="hljs-string"><span class="hljs-string">'%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTIFIED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-string"><span class="hljs-string">'client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">grant</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> your_base . * <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-string"><span class="hljs-string">'client'</span></span>@<span class="hljs-string"><span class="hljs-string">'%'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">flush</span></span> <span class="hljs-keyword"><span class="hljs-keyword">privileges</span></span>;</code> </pre><br>  Plus précisément, je ne pouvais me connecter à la base de données qu'avec une équipe, <br><br><pre> <code class="bash hljs">mysql -h localhost -u client -pclient</code> </pre><br>  mais celui-ci ne pouvait pas <br><br><pre> <code class="sql hljs">mysql -h 192.168.0.3 -u client -pclient</code> </pre><br>  cela ne me convenait pas et ne pouvait pas se connecter via cette adresse et depuis root. <br><br>  Le programme mysql workbench a aidé dans les paramètres, changer localhost en% et cela fonctionne, même si le client ne l'a pas aidé.  Vous pouvez maintenant vous connecter à la base de données depuis la console ou depuis le code depuis n'importe quelle adresse. <br><br><img src="https://habrastorage.org/webt/jk/ys/cs/jkyscs1lcvbpljzkxh14oqwkiiu.jpeg"><br><br>  Vous devez également créer un réseau domestique ou d'entreprise et désactiver le pare-feu Windows, sinon vous ne pourrez même pas envoyer de ping à cette machine (pas qu'elle se connecte à la base de données). <br><br>  La moitié du travail est fait, alors je dois pouvoir me connecter à la base de données depuis chez moi. <br><br>  Comme vous pouvez le voir sur le schéma du réseau, vous devez alors passer de 192.168.0.3 à 192.168.1.1 (routeur) à Internet, allons dans le sens opposé.  Configurez l'itinéraire de 192.168.1.1 à 192.168.1.2 comme ceci: <br><br><img src="https://habrastorage.org/5d/37/4d/5d374de1038ee757922449.jpeg"><br><br>  En général, l'image ne montre pas - j'écrirai avec mes mains: <br><br><pre> <code class="bash hljs">route add 192.168.0.0 mask 255.255.255.0 gateway 192.168.1.2</code> </pre><br>  Cela ne peut être fait que sur un seul sous-réseau, c'est-à-dire que vous ne pouvez pas le transmettre immédiatement à l'adresse 192.168.0.2 ou 192.168.0.3 <br><br>  Ceci est nécessaire pour que le routeur sache où se trouve le sous-réseau 192.168.0.0/24 (découvrez les bases des réseaux, cela est utile). <br><br>  Ajoutez maintenant le port probros 3306 (port mysql par défaut (si vous ne l'avez pas modifié lors de l'installation)) à l'adresse 192.168.1.2 <br><br><img src="https://habrastorage.org/webt/es/av/3b/esav3bmwqprghssdh6oeslgo4ik.jpeg"><br><br>  Il reste à faire le plus difficile est de faire le transfert sur une machine Linux (il y a deux cartes réseau 192.168.1.2 dessus (interface enp3s1) et 192.168.0.2 (interface enp3s0) pour que les cartes réseau sachent quoi les transférer de 192.168.1.2 à 192.168.0.2, puis à notre machine Windows avec mysql. <br><br><pre> <code class="bash hljs">sudo iptables -A FORWARD -i enp3s1 -o enp3s0 -p tcp --syn --dport 3306 -m conntrack --ctstate NEW -j ACCEPT sudo iptables -A FORWARD -i enp3s1 -o enp3s0 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT sudo iptables -A FORWARD -i enp3s0 -o enp3s1 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT sudo iptables -t nat -A PREROUTING -i enp3s1 -p tcp --dport 3306 -j DNAT --to-destination 192.168.0.3 sudo iptables -t nat -A POSTROUTING -o enp3s0 -p tcp --dport 3306 -d 192.168.0.3 -j SNAT --to-source 192.168.1.2              sudo service iptables-persistent save</code> </pre><br>  C'est-à-dire  1ère ligne signifie que nous acceptons la première connexion, 2ème et 3ème que vous pouvez démarrer des paquets des deux côtés, 4ème et 5ème signifie remplacer l'adresse de destination et la source.  Et voila, vous pouvez vous connecter depuis chez vous via mysql.  Et enfin, mon code C ++ qui fait ceci: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//DataBaseConnection.cpp #include "DataBaseConnection.h" DataBaseConnection::DataBaseConnection() { } void DataBaseConnection::Connect() { //    conn = mysql_init(NULL); if (conn == NULL) { //     –     fprintf(stderr, "Error: can'tcreate MySQL-descriptor\n"); //exit(1); //    } //    if (!mysql_real_connect(conn, "192.168.0.3", "root", "password", "your_base", NULL, NULL, 0)) { //        //       fprintf(stderr, "Error: can't connect to database: %s\n", mysql_error(conn)); } else { //       - "Success!" fprintf(stdout, "Success!\n"); } } std::vector&lt;std::string&gt; DataBaseConnection::Query() { vectordrum.clear(); std::string query = "SELECT * FROM drum where id=0"; const char * q = query.c_str(); qstate = mysql_query(conn, q); if (!qstate) { res = mysql_store_result(conn); while (row = mysql_fetch_row(res)) { //printf("ID: %s,Position: %s, Image: %s\n", row[0], row[1], row[2]); vectordrum.push_back(row[2]); } } else { std::cout &lt;&lt; "Query failed:" &lt;&lt; mysql_error(conn) &lt;&lt; std::endl; } return vectordrum; } void DataBaseConnection::Close() { //       mysql_close(conn); } DataBaseConnection::~DataBaseConnection() { vectordrum.clear(); } //DataBaseConnection.h #pragma once #include &lt;iostream&gt; #include &lt;mysql.h&gt; #include &lt;vector&gt; #pragma comment(lib,"mysqlcppconn.lib") #pragma comment(lib,"libmysql.lib") class DataBaseConnection { public: DataBaseConnection(); void Connect(); std::vector&lt;std::string&gt; Query(); void Close(); ~DataBaseConnection(); MYSQL *conn; MYSQL_ROW row; MYSQL_RES *res; int qstate; std::vector&lt;std::string&gt; vectordrum; };</span></span></code> </pre><br>  Vous pouvez maintenant déposer ce programme en toute sécurité et ne pas avoir à le réécrire pour qu'il fonctionne localement. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461503/">https://habr.com/ru/post/fr461503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461487/index.html">Mini tâches CTF</a></li>
<li><a href="../fr461493/index.html">Django 3.0 sera asynchrone</a></li>
<li><a href="../fr461497/index.html">Rendu de texte moderne sous Linux: partie 1</a></li>
<li><a href="../fr461499/index.html">Quelles langues traduire votre jeu en 2019</a></li>
<li><a href="../fr461501/index.html">Pourquoi aux États-Unis, ils enquêtent sur le travail des grandes entreprises informatiques</a></li>
<li><a href="../fr461505/index.html">8 bugs de développeurs JavaScript novices qui vous empêchent de devenir un professionnel</a></li>
<li><a href="../fr461507/index.html">Pourquoi avons-nous décidé de lancer l'accélérateur d'entreprise Gazprom Neft StartupDrive, et qui l'a déjà adopté</a></li>
<li><a href="../fr461509/index.html">Assistants de voyage: une sélection de gadgets et accessoires</a></li>
<li><a href="../fr461511/index.html">Gestion des dépendances Python: une comparaison des approches</a></li>
<li><a href="../fr461517/index.html">Meilleurs algorithmes de copier-coller pour C et C ++. Haiku OS Cookbook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>