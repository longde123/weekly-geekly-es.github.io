<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÜüèΩ üç® üë®üèª‚Äçüé® Conseils pratiques, exemples et tunnels SSH üîï üôà ü•§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Des exemples pratiques de SSH qui feront passer vos comp√©tences d'administrateur syst√®me √† distance au niveau sup√©rieur. Les commandes et les conseils...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conseils pratiques, exemples et tunnels SSH</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435546/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/oz/pn/4x/ozpn4xuna3odpakxmdgnlwqxwto.jpeg"></div><br>  Des exemples pratiques de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SSH</a> qui feront passer vos comp√©tences d'administrateur syst√®me √† distance au niveau sup√©rieur.  Les commandes et les conseils vous aideront non seulement √† utiliser <code>SSH</code> , mais √©galement √† naviguer plus efficacement sur le r√©seau. <br><br>  Conna√Ætre quelques astuces <code>ssh</code> est utile √† tout administrateur syst√®me, ing√©nieur r√©seau ou sp√©cialiste de la s√©curit√©. <br><a name="habracut"></a><br><h3>  Exemples pratiques SSH </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chaussettes SSH proxy</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tunnel SSH (redirection de port)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tunnel SSH vers le troisi√®me h√¥te</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tunnel invers√© SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Proxy inverse SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Installation de VPN sur SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Copier la cl√© SSH (ssh-copy-id)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ex√©cution de commandes √† distance (non interactive)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Capture et visualisation √† distance des paquets dans Wireshark</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Copie d'un dossier local sur un serveur distant via SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Applications GUI de transfert SSH X11 √† distance</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Copie de fichiers √† distance √† l'aide de rsync et SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SSH sur le r√©seau Tor</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Instance SSH vers EC2</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Modification de fichiers texte √† l'aide de VIM via ssh / scp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Montage de SSH distant en tant que dossier local avec SSHFS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Multiplexage SSH avec ControlPath</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Streaming vid√©o SSH en utilisant VLC et SFTP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Authentification √† deux facteurs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Host Jumping avec SSH et -J</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bloquer les tentatives de force brute SSH avec iptables</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SSH Escape pour modifier la redirection de port</a> </li></ol><br><h1>  Les bases d'abord </h1><br><h4>  Analyse de la ligne de commande SSH </h4><br>  L'exemple suivant utilise les param√®tres habituels que l'on trouve souvent lors de la connexion √† un serveur <code>SSH</code> distant. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -p 22 -C neo@remoteserver</code> </pre> <br><ul><li>  <code>-v</code> : la sortie de d√©bogage est particuli√®rement utile lors de l'analyse des probl√®mes d'authentification.  Vous pouvez l'utiliser plusieurs fois pour afficher des informations suppl√©mentaires. </li><li>  <code>- p 22</code> : <b>port de connexion</b> √† un serveur SSH distant.  22 n'est pas n√©cessaire √† sp√©cifier, car il s'agit de la valeur par d√©faut, mais si le protocole est sur un autre port, nous le <code>-p</code> l'aide du param√®tre <code>-p</code> .  Le port d'√©coute est sp√©cifi√© dans le fichier <code>sshd_config</code> au format <code>Port 2222</code> . </li><li>  <code>-C</code> : compression pour la connexion.  Si vous avez un flux lent ou que vous consultez beaucoup de texte, cela peut acc√©l√©rer la connexion. </li><li>  <code>neo@</code> : la ligne pr√©c√©dant le symbole @ indique le nom d'utilisateur pour l'authentification sur le serveur distant.  Si vous ne le sp√©cifiez pas, par d√©faut, le nom d'utilisateur du compte auquel vous √™tes actuellement connect√© sera utilis√© (~ $ whoami).  L'utilisateur peut √©galement √™tre sp√©cifi√© avec l'option <code>-l</code> . </li><li>  <code>remoteserver</code> : le nom d'h√¥te auquel <code>ssh</code> connecte, il peut s'agir d'un nom de domaine complet, d'une adresse IP ou de tout h√¥te du fichier d'h√¥tes local.  Pour vous connecter √† un h√¥te qui prend en charge IPv4 et IPv6, vous pouvez ajouter l'option <code>-4</code> ou <code>-6</code> √† la ligne de commande pour une r√©solution correcte. </li></ul><br>  Toutes les options ci-dessus sont facultatives √† l'exception du <code>remoteserver</code> . <br><br><h4>  Utilisation du fichier de configuration </h4><br>  Bien que beaucoup connaissent le fichier <code>sshd_config</code> , il existe √©galement un fichier de configuration client pour la commande <code>ssh</code> .  La valeur par d√©faut est <code>~/.ssh/config</code> , mais elle peut √™tre d√©finie comme param√®tre pour l'option <code>-F</code> . <br><br><pre> <code class="bash hljs">Host * Port 2222 Host remoteserver HostName remoteserver.thematrix.io User neo Port 2112 IdentityFile /home/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/.ssh/remoteserver.private_key</code> </pre> <br>  L'exemple de fichier de configuration ssh ci-dessus a deux entr√©es d'h√¥te.  Le premier indique tous les h√¥tes, le param√®tre de configuration du port 2222 est utilis√© pour tous. Le second indique que pour l'h√¥te du serveur <b>distant</b> , utilisez un nom d'utilisateur, un port, un FQDN et un IdentityFile diff√©rents. <br><br>  Un fichier de configuration peut √©conomiser beaucoup de temps √† taper des caract√®res, ce qui vous permet d'appliquer automatiquement une configuration avanc√©e lors de la connexion √† des h√¥tes sp√©cifiques. <br><br><h4>  Copiez des fichiers sur SSH √† l'aide de SCP </h4><br>  Le client SSH est livr√© avec deux autres outils tr√®s pratiques pour copier des fichiers sur une <b>connexion ssh chiffr√©e</b> .  Voir ci-dessous pour un exemple d'utilisation standard des commandes scp et sftp.  Notez que de nombreuses options pour ssh s'appliquent √©galement √† ces commandes. <br><br><pre> <code class="bash hljs">localhost:~$ scp mypic.png neo@remoteserver:/media/data/mypic_2.png</code> </pre> <br>  Dans cet exemple, le fichier <b>mypic.png est</b> copi√© sur le <b>serveur distant</b> dans le dossier <b>/ media / data</b> et renomm√© en <b>mypic_2.png</b> . <br><br>  N'oubliez pas la diff√©rence de param√®tre de port.  Cela rencontre de nombreux utilisateurs qui ex√©cutent <code>scp</code> partir de la ligne de commande.  Ici, le param√®tre de port est <code>-P</code> , pas <code>-p</code> , comme dans le client ssh!  Vous oublierez, mais ne vous inqui√©tez pas, tout le monde oubliera. <br><br>  Pour ceux qui connaissent le <code>ftp</code> console, la plupart des commandes sont similaires dans <code>sftp</code> .  Vous pouvez faire <b>pousser</b> , <b>mettre</b> et <b>ls</b> comme votre coeur le d√©sire. <br><br><pre> <code class="bash hljs">sftp neo@remoteserver</code> </pre> <br><h1>  Exemples pratiques </h1><br>  Dans beaucoup de ces exemples, le r√©sultat peut √™tre obtenu par diff√©rentes m√©thodes.  Comme pour tous nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manuels</a> et exemples, la pr√©f√©rence est donn√©e aux exemples pratiques qui font tout simplement leur travail. <br><br><a name="1"></a><h3>  1. proxy chaussettes SSH </h3><br>  SSH Proxy au num√©ro 1 pour une bonne raison.  Il est plus puissant que beaucoup ne le pensent et vous donne acc√®s √† n'importe quel syst√®me auquel un serveur distant a acc√®s en utilisant presque toutes les applications.  Le client ssh peut tunneliser le trafic via le proxy SOCKS avec une seule commande simple.  Il est important de comprendre que le trafic vers les syst√®mes distants proviendra d'un serveur distant, comme indiqu√© dans les journaux du serveur Web. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -D 8888 user@remoteserver localhost:~$ netstat -pan | grep 8888 tcp 0 0 127.0.0.1:8888 0.0.0.0:* LISTEN 23880/ssh</code> </pre> <br>  Ici, nous ex√©cutons le proxy socks sur le port TCP 8888, la deuxi√®me commande v√©rifie que le port est actif en mode √©coute.  127.0.0.1 indique que le service s'ex√©cute uniquement sur localhost.  Nous pouvons utiliser une commande l√©g√®rement diff√©rente pour √©couter toutes les interfaces, y compris ethernet ou wifi, cela permettra √† d'autres applications (navigateurs, etc.) sur notre r√©seau de se connecter au service proxy via le proxy ssh socks. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -D 0.0.0.0:8888 user@remoteserver</code> </pre> <br>  Nous pouvons maintenant configurer le navigateur pour qu'il se connecte au proxy socks.  Dans Firefox, s√©lectionnez <b>Param√®tres |</b>  <b>Faits saillants |</b>  <b>Param√®tres r√©seau</b>  Sp√©cifiez l'adresse IP et le port √† connecter. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/daa/f8b/545/daaf8b54515ce6eee864c8416d41eef9.png"><br><br>  Faites attention √† l'option au bas du formulaire afin que les requ√™tes DNS du navigateur passent √©galement par les proxys SOCKS.  Si vous utilisez un serveur proxy pour crypter le trafic Web sur le r√©seau local, vous souhaiterez probablement s√©lectionner cette option afin que les requ√™tes DNS soient tunnelis√©es via une connexion SSH. <br><br><h4>  Activation du proxy de chaussettes dans Chrome </h4><br>  L'ex√©cution de Chrome avec certaines options de ligne de commande active les proxys de chaussettes, ainsi que le tunneling des requ√™tes DNS √† partir du navigateur.  Faites confiance, mais v√©rifiez.  Utilisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tcpdump</a> pour v√©rifier que les requ√™tes DNS ne sont plus visibles. <br><br><pre> <code class="bash hljs">localhost:~$ google-chrome --proxy-server=<span class="hljs-string"><span class="hljs-string">"socks5://192.168.1.10:8888"</span></span></code> </pre> <br><h4>  Utilisation d'autres applications proxy </h4><br>  Gardez √† l'esprit que de nombreuses autres applications peuvent √©galement utiliser des proxys de chaussettes.  Un navigateur Web est tout simplement le plus populaire d'entre eux.  Certaines applications ont des options de configuration pour activer un serveur proxy.  D'autres ont besoin d'un peu d'aide avec le programme d'aide.  Par exemple, les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">proxychains vous</a> permettent d'ex√©cuter Microsoft RDP, etc. via des chaussettes-proxies. <br><br><pre> <code class="bash hljs">localhost:~$ proxychains rdesktop <span class="hljs-variable"><span class="hljs-variable">$RemoteWindowsServer</span></span></code> </pre> <br>  Les param√®tres de configuration du proxy socks sont d√©finis dans le fichier de configuration proxychains. <br><br><blockquote>  Astuce: si vous utilisez le bureau √† distance depuis Linux sur Windows?  Essayez le client <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FreeRDP</a> .  Il s'agit d'une impl√©mentation plus moderne que <code>rdesktop</code> , avec une interaction beaucoup plus fluide. </blockquote><br><h4>  Option SSH via proxy de chaussettes </h4><br>  Vous √™tes assis dans un caf√© ou un h√¥tel et √™tes oblig√© d'utiliser une connexion Wi-Fi peu fiable.  Depuis l'ordinateur portable, lancez localement le proxy ssh et installez le tunnel ssh dans le r√©seau domestique sur le Rasberry Pi local.  √Ä l'aide d'un navigateur ou d'autres applications configur√©es pour les proxys de chaussettes, nous pouvons acc√©der √† tous les services r√©seau sur notre r√©seau domestique ou acc√©der √† Internet via une connexion domestique.  Tout entre votre ordinateur portable et votre serveur domestique (via Wi-Fi et Internet √† votre domicile) est crypt√© dans le tunnel SSH. <br><br><a name="2"></a><h3>  2. Tunnel SSH (redirection de port) </h3><br>  Dans sa forme la plus simple, un tunnel SSH ouvre simplement un port sur votre syst√®me local qui se connecte √† un autre port √† l'autre extr√©mit√© du tunnel. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 9999:127.0.0.1:80 user@remoteserver</code> </pre> <br>  Examinons l'option <code>-L</code> .  Il peut √™tre repr√©sent√© comme le c√¥t√© local de l'√©coute.  Ainsi, dans l'exemple ci-dessus, le port 9999 est √©cout√© du c√¥t√© de l'h√¥te local et est transmis via le port 80 au serveur distant.  Veuillez noter que 127.0.0.1 fait r√©f√©rence √† localhost sur le serveur distant! <br><br>  Montons une √©tape.  Dans l'exemple suivant, les ports d'√©coute communiquent avec d'autres n≈ìuds du r√©seau local. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 0.0.0.0:9999:127.0.0.1:80 user@remoteserver</code> </pre> <br>  Dans ces exemples, nous nous connectons au port du serveur Web, mais il peut s'agir d'un serveur proxy ou de tout autre service TCP. <br><br><a name="3"></a><h3>  3. Tunnel SSH vers un h√¥te tiers </h3><br>  Nous pouvons utiliser les m√™mes param√®tres pour connecter un tunnel d'un serveur distant √† un autre service fonctionnant sur un troisi√®me syst√®me. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 0.0.0.0:9999:10.10.10.10:80 user@remoteserver</code> </pre> <br>  Dans cet exemple, nous redirige le tunnel de remoteserver vers un serveur web fonctionnant sur 10.10.10.10.  Le trafic avec remoteserver par 10.10.10.10 <b>n'est plus dans le tunnel SSH</b> .  Le 10.10.10.10, le serveur Web consid√©rera remoteserver comme source de requ√™tes Web. <br><br><a name="4"></a><h3>  4. Tunnel SSH invers√© </h3><br>  Ici, nous configurons le port d'√©coute sur le serveur distant, qui se connectera √† nouveau au port local sur notre h√¥te local (ou un autre syst√®me). <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -R 0.0.0.0:1999:127.0.0.1:902 192.168.1.100 user@remoteserver</code> </pre> <br>  Dans cette session SSH, une connexion est √©tablie du port 1999 sur le serveur distant au port 902 sur notre client local. <br><br><a name="5"></a><h3>  5. Proxy SSH invers√© </h3><br>  Dans ce cas, nous installons le proxy socks sur notre connexion ssh, cependant, le proxy √©coute sur l'extr√©mit√© distante du serveur.  Les connexions √† ce proxy distant apparaissent d√©sormais √† partir du tunnel en tant que trafic provenant de notre h√¥te local. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -R 0.0.0.0:1999 192.168.1.100 user@remoteserver</code> </pre> <br><h4>  D√©pannage des tunnels SSH distants </h4><br>  Si vous avez des probl√®mes avec les options SSH distantes, v√©rifiez avec <code>netstat</code> quelles autres interfaces le port d'√©coute est connect√©.  Bien que nous ayons sp√©cifi√© 0.0.0.0 dans les exemples, mais si la valeur <b>GatewayPorts</b> dans <b>sshd_config est</b> d√©finie sur <b>no</b> , l'√©couteur sera uniquement li√© √† localhost (127.0.0.1). <br><br><blockquote><h4>  Avertissement de s√©curit√© </h4><br>  Veuillez noter que lors de l'ouverture de tunnels et de proxys de chaussettes, des ressources r√©seau internes peuvent √™tre disponibles pour des r√©seaux non approuv√©s (par exemple, Internet!).  Cela peut repr√©senter un grave risque pour la s√©curit√©, alors assurez-vous de bien comprendre ce qu'est l'auditeur et ce √† quoi il a acc√®s. </blockquote><br><a name="6"></a><h3>  6. Installation de VPN sur SSH </h3><br>  Le terme g√©n√©ral parmi les sp√©cialistes des m√©thodes d'attaque (pentesters, etc.) est ¬´le pivot du r√©seau¬ª.  Apr√®s avoir √©tabli une connexion dans un syst√®me, ce syst√®me devient une passerelle pour un acc√®s ult√©rieur au r√©seau.  Le point d'appui qui vous permet de vous d√©placer en largeur. <br><br>  Pour un tel point d'appui, nous pouvons utiliser des proxys SSH et des <b>proxychains</b> , mais il y a quelques limitations.  Par exemple, vous ne pourrez pas travailler directement avec les sockets, nous ne pourrons donc pas analyser les ports √† l'int√©rieur du r√©seau via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nmap</a> <code>SYN</code> . <br><br>  En utilisant cette option VPN plus avanc√©e, la connexion tombe au <b>niveau 3</b> .  Ensuite, nous pouvons simplement acheminer le trafic √† travers le tunnel en utilisant le routage r√©seau standard. <br><br>  La m√©thode utilise <code>ssh</code> , <code>iptables</code> , les <code>tun interfaces</code> et le routage. <br><br>  Vous devez d'abord d√©finir ces param√®tres dans <code>sshd_config</code> .  Comme nous apportons des modifications aux interfaces des syst√®mes distant et client, nous avons <b>besoin des privil√®ges root des deux c√¥t√©s</b> . <br><br><pre> <code class="bash hljs">PermitRootLogin yes PermitTunnel yes</code> </pre> <br>  √âtablissez ensuite une connexion ssh √† l'aide d'un param√®tre qui demande l'initialisation des p√©riph√©riques tun. <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># ssh -v -w any root@remoteserver</span></span></code> </pre> <br>  Maintenant, nous devrions avoir un p√©riph√©rique tun lors de l'affichage des interfaces ( <code># ip a</code> ).  L'√©tape suivante ajoutera des adresses IP aux interfaces de tunnel. <br><br>  C√¥t√© client SSH: <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># ip addr add 10.10.10.2/32 peer 10.10.10.10 dev tun0 localhost:~# ip tun0 up</span></span></code> </pre> <br>  C√¥t√© serveur SSH: <br><br><pre> <code class="bash hljs">remoteserver:~<span class="hljs-comment"><span class="hljs-comment"># ip addr add 10.10.10.10/32 peer 10.10.10.2 dev tun0 remoteserver:~# ip tun0 up</span></span></code> </pre> <br>  Nous avons maintenant une route directe vers un autre h√¥te ( <code>route -n</code> et <code>ping 10.10.10.10</code> ). <br><br>  Vous pouvez router n'importe quel sous-r√©seau via l'h√¥te de l'autre c√¥t√©. <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># route add -net 10.10.10.0 netmask 255.255.255.0 dev tun0</span></span></code> </pre> <br>  Sur le c√¥t√© distant, vous devez activer <code>ip_forward</code> et <code>iptables</code> . <br><br><pre> <code class="bash hljs">remoteserver:~<span class="hljs-comment"><span class="hljs-comment"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward remoteserver:~# iptables -t nat -A POSTROUTING -s 10.10.10.2 -o enp7s0 -j MASQUERADE</span></span></code> </pre> <br>  Boum!  <b>VPN sur tunnel SSH au niveau de la couche r√©seau 3</b> .  C'est d√©j√† une victoire. <br><br>  Si vous rencontrez des probl√®mes, utilisez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tcpdump</a> et <code>ping</code> pour d√©terminer la cause.  Puisque nous jouons au niveau 3, nos paquets icmp passeront par ce tunnel. <br><br><a name="7"></a><h3>  7. Copie de la cl√© SSH (ssh-copy-id) </h3><br>  Il existe plusieurs fa√ßons, mais cette commande permet de gagner du temps afin de ne pas copier les fichiers manuellement.  Il copie simplement ~ / .ssh / id_rsa.pub (ou la cl√© par d√©faut) de votre syst√®me vers <code>~/.ssh/authorized_keys</code> sur le serveur distant. <br><br><pre> <code class="bash hljs">localhost:~$ ssh-copy-id user@remoteserver</code> </pre> <br><a name="8"></a><h3>  8. Ex√©cution de commandes √† distance (non interactive) </h3><br>  La commande <code>ssh</code> peut √™tre associ√©e √† d'autres commandes pour l'interface conviviale habituelle.  Ajoutez simplement la commande que vous souhaitez ex√©cuter sur l'h√¥te distant comme dernier param√®tre entre guillemets. <br><br><pre> <code class="bash hljs">localhost:~$ ssh remoteserver <span class="hljs-string"><span class="hljs-string">"cat /var/log/nginx/access.log"</span></span> | grep badstuff.php</code> </pre> <br>  Dans cet exemple, <code>grep</code> s'ex√©cute sur le syst√®me local apr√®s le t√©l√©chargement du journal via le canal ssh.  Si le fichier est volumineux, il est plus pratique d'ex√©cuter <code>grep</code> du c√¥t√© distant, en pla√ßant simplement les deux commandes entre guillemets. <br><br>  Un autre exemple remplit la m√™me fonction que <code>ssh-copy-id</code> de l'exemple 7. <br><br><pre> <code class="bash hljs">localhost:~$ cat ~/.ssh/id_rsa.pub | ssh remoteserver <span class="hljs-string"><span class="hljs-string">'cat &gt;&gt; .ssh/authorized_keys'</span></span></code> </pre> <br><a name="9"></a><h3>  9. Capture et visualisation de paquets √† distance dans Wireshark </h3><br>  J'ai pris l'un de nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemples tcpdump</a> .  Utilisez-le pour intercepter √† distance des paquets avec le r√©sultat directement dans l'interface graphique du Wireshark local. <br><br><pre> <code class="bash hljs">:~$ ssh root@remoteserver <span class="hljs-string"><span class="hljs-string">'tcpdump -c 1000 -nn -w - not port 22'</span></span> | wireshark -k -i -</code> </pre> <br><a name="10"></a><h3>  10. Copie d'un dossier local sur un serveur distant via SSH </h3><br>  Une belle astuce qui comprime un dossier en utilisant <code>bzip2</code> (c'est l'option -j dans la commande <code>tar</code> ) puis extrait le flux <code>bzip2</code> de l'autre c√¥t√©, cr√©ant un doublon du dossier sur le serveur distant. <br><br><pre> <code class="bash hljs">localhost:~$ tar -cvj /datafolder | ssh remoteserver <span class="hljs-string"><span class="hljs-string">"tar -xj -C /datafolder"</span></span></code> </pre> <br><a name="11"></a><h3>  11. Applications GUI de transfert SSH X11 √† distance </h3><br>  Si le client et le serveur distant ont install√© X, vous pouvez ex√©cuter √† distance la commande GUI, avec une fen√™tre sur votre bureau local.  Cette fonctionnalit√© existe depuis longtemps, mais est toujours tr√®s utile.  Lancez un navigateur Web distant ou m√™me la console VMWawre Workstation, comme je le fais dans cet exemple. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -X remoteserver vmware</code> </pre> <br>  N√©cessite la ligne <code>X11Forwarding yes</code> dans le fichier <code>sshd_config</code> . <br><br><a name="12"></a><h3>  12. Copie de fichiers √† distance √† l'aide de rsync et SSH </h3><br>  <code>rsync</code> est beaucoup plus pratique que <code>scp</code> si vous devez sauvegarder p√©riodiquement un r√©pertoire, un grand nombre de fichiers ou de tr√®s gros fichiers.  Il existe une fonction pour r√©cup√©rer de l'√©chec de transmission et copier uniquement les fichiers modifi√©s, ce qui √©conomise du trafic et du temps. <br><br>  Cet exemple utilise la compression <code>gzip</code> (-z) et le mode archive (-a), qui permet la copie r√©cursive. <br><br><pre> <code class="bash hljs">:~$ rsync -az /home/testuser/data remoteserver:backup/</code> </pre> <br><a name="13"></a><h3>  13. SSH sur le r√©seau Tor </h3><br>  Un r√©seau Tor anonyme peut <code>torsocks</code> le trafic SSH √† l'aide de la <code>torsocks</code> .  La commande suivante lancera un proxy ssh via Tor. <br><br><pre> <code class="bash hljs">localhost:~$ torsocks ssh myuntracableuser@remoteserver</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Torsocks</a> utilisera le port 9050 pour le proxy sur localhost.  Comme toujours, lorsque vous utilisez Tor, vous devez v√©rifier s√©rieusement quel trafic est tunnel√© et autres probl√®mes de s√©curit√© op√©rationnelle (opsec).  <b>O√π vont vos requ√™tes DNS?</b> <br><br><a name="14"></a><h3>  14. Instance SSH vers EC2 </h3><br>  Une cl√© priv√©e est requise pour se connecter √† une instance EC2.  T√©l√©chargez-le (extension .pem) √† partir du panneau de configuration Amazon EC2 et modifiez les autorisations ( <code>chmod 400 my-ec2-ssh-key.pem</code> ).  Conservez la cl√© dans un endroit s√ªr ou placez-la dans votre dossier <code>~/.ssh/</code> . <br><br><pre> <code class="bash hljs">localhost:~$ ssh -i ~/.ssh/my-ec2-key.pem ubuntu@my-ec2-public</code> </pre> <br>  L' <b>option -i</b> indique simplement au client ssh d'utiliser ce commutateur.  Le fichier <code>~/.ssh/config</code> est id√©al pour configurer automatiquement l'utilisation des cl√©s lors de la connexion √† l'h√¥te ec2. <br><br><pre> <code class="bash hljs">Host my-ec2-public Hostname ec2???.compute-1.amazonaws.com User ubuntu IdentityFile ~/.ssh/my-ec2-key.pem</code> </pre> <br><a name="15"></a><h3>  15. √âdition de fichiers texte √† l'aide de VIM via ssh / scp </h3><br>  Pour tous les amateurs de <code>vim</code> , cette astuce vous fera gagner un peu de temps.  √Ä l'aide de <code>vim</code> fichiers sont modifi√©s √† l'aide de scp avec une seule commande.  Cette m√©thode cr√©e simplement le fichier localement dans <code>/tmp</code> puis le recopie une fois que nous l'avons enregistr√© √† partir de <code>vim</code> . <br><br><pre> <code class="bash hljs">localhost:~$ vim scp://user@remoteserver//etc/hosts</code> </pre> <br>  Remarque: le format est l√©g√®rement diff√©rent du <code>scp</code> standard.  Apr√®s l'h√¥te, nous avons double <code>//</code> .  Ceci est un lien vers le chemin absolu.  Une barre oblique signifiera le chemin d'acc√®s par rapport au dossier de d√©part des <code>users</code> . <br><br><pre> <code class="bash hljs">**warning** (netrw) cannot determine method (format: protocol://[user@]hostname[:port]/[path])</code> </pre> <br>  Si vous voyez cette erreur, rev√©rifiez le format de la commande.  Cela signifie g√©n√©ralement une erreur de syntaxe. <br><br><a name="16"></a><h3>  16. Montage de SSH distant en tant que dossier local avec SSHFS </h3><br>  En utilisant <code>sshfs</code> , le client du syst√®me de fichiers <code>ssh</code> , nous pouvons connecter le r√©pertoire local √† un emplacement distant avec toutes les interactions de fichiers dans une session <code>ssh</code> chiffr√©e. <br><br><pre> <code class="bash hljs">localhost:~$ apt install sshfs</code> </pre> <br>  Nous installons le paquet <code>sshfs</code> sur Ubuntu et Debian, puis <code>sshfs</code> simplement l'emplacement distant sur notre syst√®me. <br><br><pre> <code class="bash hljs">localhost:~$ sshfs user@remoteserver:/media/data ~/data/</code> </pre> <br><a name="17"></a><h3>  17. Multiplexage SSH avec ControlPath </h3><br>  Par d√©faut, si vous disposez d'une connexion existante au serveur distant √† l'aide de <code>ssh</code> deuxi√®me connexion √† l'aide de <code>ssh</code> ou <code>scp</code> √©tablit une nouvelle session avec une authentification suppl√©mentaire.  L'option <code>ControlPath</code> vous permet d'utiliser une session existante pour toutes les connexions suivantes.  Cela acc√©l√©rera consid√©rablement le processus: l'effet est perceptible m√™me sur le r√©seau local, et encore plus lorsqu'il est connect√© √† des ressources distantes. <br><br><pre> <code class="bash hljs">Host remoteserver HostName remoteserver.example.org ControlMaster auto ControlPath ~/.ssh/control/%r@%h:%p ControlPersist 10m</code> </pre> <br>  ControlPath indique au socket de v√©rifier les nouvelles connexions pour une session <code>ssh</code> active.  La derni√®re option signifie que m√™me apr√®s avoir quitt√© la console, la session existante restera ouverte pendant 10 minutes, donc pendant ce temps, vous pourrez vous reconnecter au socket existant.  Voir l' <code>ssh_config man</code> pour plus d'informations. <br><br><a name="18"></a><h3>  18. Streaming vid√©o sur SSH en utilisant VLC et SFTP </h3><br>  M√™me les utilisateurs de longue date de <code>ssh</code> et <code>vlc</code> (Video Lan Client) ne connaissent pas toujours cette option pratique lorsque vous avez vraiment besoin de regarder des vid√©os sur le r√©seau.  Dans les param√®tres <b>Fichier |</b>  <b>Le programme Open Network Stream</b> <code>vlc</code> peut entrer l'emplacement comme <code>sftp://</code> .  Si un mot de passe est requis, une invite appara√Æt. <br><br><pre> <code class="bash hljs">sftp://remoteserver//media/uploads/myvideo.mkv</code> </pre> <br><a name="19"></a><h3>  19. Authentification √† deux facteurs </h3><br>  La m√™me authentification √† deux facteurs que votre compte bancaire ou votre compte Google s'applique au service SSH. <br><br>  Bien s√ªr, <code>ssh</code> initialement une fonction d'authentification √† deux facteurs, ce qui signifie le mot de passe et la cl√© SSH.  L'avantage d'un jeton mat√©riel ou d'une application Google Authenticator est qu'il s'agit g√©n√©ralement d'un p√©riph√©rique physique diff√©rent. <br><br>  Consultez notre guide de 8 minutes sur l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilisation de Google Authenticator et SSH</a> . <br><br><a name="20"></a><h3>  20. H√¥te sautant avec ssh et -J </h3><br>  Si, en raison de la segmentation du r√©seau, vous devez traverser plusieurs h√¥tes ssh pour atteindre le r√©seau de destination finale, le raccourci -J vous fera gagner du temps. <br><br><pre> <code class="bash hljs">localhost:~$ ssh -J host1,host2,host3 user@host4.internal</code> </pre> <br>  La principale chose √† comprendre ici est que cela n'est pas analogue √† la <code>ssh host1</code> , alors <code>user@host1:~$ ssh host2</code> , etc. Le param√®tre -J utilise astucieusement le transfert pour que localhost √©tablisse une session avec le prochain h√¥te de la cha√Æne.  Ainsi, dans l'exemple ci-dessus, notre h√¥te local s'authentifie aupr√®s de host4.  Autrement dit, nos cl√©s localhost sont utilis√©es et la session de localhost √† host4 est enti√®rement crypt√©e. <br><br>  Pour ce faire, sp√©cifiez l'option de configuration <b>proxyJump</b> dans <b>ssh_config</b> .  Si vous devez r√©guli√®rement passer par plusieurs h√¥tes, l'automatisation via la configuration vous fera gagner beaucoup de temps. <br><br><a name="21"></a><h3>  21. Blocage des tentatives de force brute SSH √† l'aide d'iptables </h3><br>  Quiconque a ex√©cut√© le service SSH et parcouru les journaux conna√Æt le nombre de tentatives de force brute qui se produisent chaque heure chaque jour.  Un moyen rapide de r√©duire le bruit dans les journaux consiste √† migrer SSH vers un port non standard.  Apportez des modifications au fichier <code>sshd_config</code> √† l'aide du param√®tre de configuration <b>Port ##</b> . <br><br>  En utilisant <code>iptables</code> , vous pouvez √©galement facilement bloquer les tentatives de connexion √† un port apr√®s avoir atteint un certain seuil.     ‚Äî  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OSSEC</a> ,      SSH,             (HIDS). <br><br><a name="22"></a><h3> 22. SSH Escape     </h3><br>     <code>ssh</code>            <code>ssh</code> .   .    ; ,            ,    Microsoft SMB   Windows 2003 (-  ms08-67?). <br><br>  <code>enter</code> ,     <code>~C</code> .     ,      . <br><br><pre> <code class="bash hljs">localhost:~$ ~C ssh&gt; -h Commands: -L[bind_address:]port:host:hostport Request <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> forward -R[bind_address:]port:host:hostport Request remote forward -D[bind_address:]port Request dynamic forward -KL[bind_address:]port Cancel <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> forward -KR[bind_address:]port Cancel remote forward -KD[bind_address:]port Cancel dynamic forward ssh&gt; -L 1445:remote-win2k3:445 Forwarding port.</code> </pre> <br>    ,       1445   Windows 2003,     .    <code>msfconsole</code> ,     (,      ). <br><br><h1>  Ach√®vement </h1><br>  ,    <code>ssh</code>    ;             ( <code>man ssh</code> , <code>man ssh_config</code> , <code>man sshd_config</code> ). <br><br>              .         <code>ssh</code>       ,   . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435546/">https://habr.com/ru/post/fr435546/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435536/index.html">Robots humano√Ødes: avantages et probl√®mes des m√©canismes anthropomorphes</a></li>
<li><a href="../fr435538/index.html">En 2018, plus d'√©nergie ¬´verte¬ª a √©t√© re√ßue en Allemagne que l'√©lectricit√© issue de la combustion du charbon</a></li>
<li><a href="../fr435540/index.html">Nouveaux mots cl√©s en Java</a></li>
<li><a href="../fr435542/index.html">D√©veloppement du jeu et d√©fense d'un dipl√¥me ou "Comment j'ai tu√© deux oiseaux avec une premi√®re galette de pierre"</a></li>
<li><a href="../fr435544/index.html">Un employ√© de l'Universit√© Innopolis a re√ßu une subvention Facebook</a></li>
<li><a href="../fr435548/index.html">Piratage des services publics - possible, si vraiment n√©cessaire</a></li>
<li><a href="../fr435550/index.html">GitLab 11.6 publi√© avec des fonctionnalit√©s sans serveur et des clusters Kubernetes pour les groupes</a></li>
<li><a href="../fr435552/index.html">Substitution √† l'importation - √©pitaphe de la num√©risation</a></li>
<li><a href="../fr435556/index.html">Passer au centre de donn√©es: comment c'√©tait</a></li>
<li><a href="../fr435558/index.html">Test de PostgreSQL avec HugePages sous Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>