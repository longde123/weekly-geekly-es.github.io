<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò¥ üîå üê¥ PG12: Uma d√∫zia de patches do Postgres Professional üôÑ üà≥ üëßüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√â bom ver nomes conhecidos na lista de Agradecimentos da vers√£o oficial do PostgreSQL 12. Decidimos reunir as inova√ß√µes e algumas corre√ß√µes de bugs na...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PG12: Uma d√∫zia de patches do Postgres Professional</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/472072/">  <i>√â bom ver nomes conhecidos na lista de Agradecimentos da vers√£o oficial do PostgreSQL 12. Decidimos reunir as inova√ß√µes e algumas corre√ß√µes de bugs nas quais nossos desenvolvedores trabalhavam.</i> <br><br><h3>  1. Suporte ao JSONPath </h3><br>  (Nas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">notas de vers√£o,</a> isso soa como <i>Adicionar suporte √† linguagem de caminho SQL / JSON (Nikita Glukhov, Teodor Sigaev, Alexander Korotkov, Oleg Bartunov, Liudmila Mantrova)</i> <br><br>  Esse patch em si, os recursos JSONPath e o hist√≥rico do problema foram discutidos em detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em um artigo separado</a> aqui no hub  O JSONPath √© uma grande conquista do Postgres Professional e uma das principais inova√ß√µes do PostgreSQL 12 em geral. <br><br>  Em 2014, A. Korotkov, O. Bartunov e F. Sigaev desenvolveram a extens√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jsquery</a> , que foi inclu√≠da como resultado no Postgres Pro Standard 9.5 (e em vers√µes posteriores do Standard e Enterprise).  Ele fornece recursos adicionais muito amplos para trabalhar com o json (b). <br><br>  Quando o SQL: 2016 padr√£o apareceu, descobriu-se que sua sem√¢ntica n√£o √© t√£o diferente da nossa na extens√£o jsquery.  √â poss√≠vel que os autores do padr√£o tenham olhado para jsquery, inventando o JSONPath.  Nossa equipe teve que implementar um pouco diferente do que j√° t√≠nhamos e, √© claro, muitas coisas novas tamb√©m. <br><br>  Embora um patch especial com fun√ß√µes ainda n√£o tenha sido confirmado, o patch JSONPath j√° possui fun√ß√µes importantes para trabalhar com JSON (B), por exemplo: <br><br><pre><code class="pgsql hljs">jsonb_path_query(<span class="hljs-string"><span class="hljs-string">'{"a": [1,2,3,4,5]}'</span></span>, <span class="hljs-string"><span class="hljs-string">'$.a[*] ? (@ &gt; 2)'</span></span>)  <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span> jsonb_path_query(<span class="hljs-string"><span class="hljs-string">'{"a": [1,2,3,4,5]}'</span></span>, <span class="hljs-string"><span class="hljs-string">'$.a[*] ? (@ &gt; 5)'</span></span>)  <span class="hljs-number"><span class="hljs-number">0</span></span> </code> </pre> <br>  Al√©m disso, algumas fun√ß√µes que j√° tinham trabalhado com JSON antes <a href="">foram otimizadas</a> .  Isso foi feito com sucesso por Nikita Glukhov. <br><br>  Por exemplo, o operador <code>#&gt;&gt;</code> , correspondente √†s fun√ß√µes <code>jsonb_each_text()</code> e <code>jsonb_array_elements_text()</code> , usado para converter rapidamente JsonbValue em texto, mas trabalhou lentamente com outros tipos.  Agora tudo est√° funcionando r√°pido. <br><a name="habracut"></a><br><h3>  2. Suporte para pesquisa r√°pida de vizinhos mais pr√≥ximos nos √≠ndices SP-GiST (KNN) </h3><br>  <i>(Adicione suporte para pesquisas do vizinho mais pr√≥ximo (KNN) dos √≠ndices SP-GiST. Nikita Glukhov, Alexander Korotkov, Vlad Sterzhanov)</i> <br><br>  Nikita Glukhov e Alexander Korotkov da nossa empresa continuaram o trabalho iniciado por Vlad Sterzhanov de Minsk (tamb√©m conhecido como Quadrocube).  O Postgres foi o primeiro DBMS a procurar seus vizinhos mais pr√≥ximos - anteriormente Oracle e MS, e de uma maneira muito mais direta e conveniente - e esse foi o m√©rito de Oleg Bartunov e sua equipe.  A id√©ia dessa pesquisa est√° no algoritmo de passagem em √°rvore original, que na maioria dos casos fornece um enorme ganho.  A busca por vizinhos mais pr√≥ximos √© muito usada onde, mas no GIS √© especialmente comum. <br><br>  Vlad fez um patch de pesquisa KNN para trabalhar com √≠ndices espaciais SP-GiST para √°rvores qu√°druplas, quando o avi√£o √© dividido em quadrados de tamanho fixo, e para √°rvores KD, ou seja, √°rvores k-dimensionais. <br><br>  Alexander Korotkov, mentor do GSoC de Vlad (Google Summer of Code), continuou o desenvolvimento com uma colega da Nikita Glukhov, profissional do Postgres.  A funcionalidade foi seriamente enriquecida: o cache interno de dados foi aprimorado ao percorrer a √°rvore, foram adicionadas classes de operador para c√≠rculos e pol√≠gonos com ordena√ß√£o por dist√¢ncia. <br><br>  Para usar o algoritmo de busca do vizinho mais pr√≥ximo, basta escrever <code>ORDER BY [,   ]</code> e o otimizador conectar√° automaticamente esse algoritmo.  Por exemplo <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> polygons <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> poly &lt;-&gt; <span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-string"><span class="hljs-string">'(0,0)'</span></span>;</code> </pre><br>  Patches de Nikita Glukhov podem ser vistos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no github</a> . <br><br><h3>  3. Otimiza√ß√£o de bloqueios para acelerar a inser√ß√£o nos √≠ndices da √Årvore B </h3><br>  <i>(Nas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">notas de vers√£o,</a> isso √© Melhore a velocidade das inser√ß√µes de √≠ndice btree reduzindo a sobrecarga do bloqueio. Alexander Korotkov)</i> <br><br>  Alexander Korotkov, arquiteto-chefe de sistemas do Postgres Professional, conseguiu criar um algoritmo de bloqueio mais razo√°vel ao inserir nos √≠ndices da √°rvore B.  O ganho ap√≥s a aplica√ß√£o desse patch √© percept√≠vel nos casos em que a inser√ß√£o ocorre mais ou menos "em uma linha".  As medi√ß√µes em um servidor de 72 n√∫cleos mostraram que, nesse caso, o ganho chega a 50%.  Com uma inser√ß√£o ca√≥tica, o ganho n√£o √© t√£o percept√≠vel. <br><br><h3>  4. WAL econ√¥mico </h3><br>  <i>(Reduza a sobrecarga de grava√ß√£o do WAL da cria√ß√£o do √≠ndice GiST, GIN e SP-GiST. Anastasia Lubennikova, Andrey V. Lepikhov)</i> <br><br>  Essa s√©rie de corre√ß√µes <a href="">reduz o tr√°fego WAL</a> gerado ao criar √≠ndices GiST, GIN e SP-GiST.  Agora voc√™ pode registrar p√°ginas desses √≠ndices apenas uma vez - no final, quando o √≠ndice j√° estiver criado.  E, no caso de um erro ao criar o √≠ndice de entradas no WAL, as tentativas com falha n√£o aparecer√£o.  Anteriormente, isso s√≥ era poss√≠vel ao criar uma √°rvore B e um RUM.  Os patches usam o mecanismo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">WAL gen√©rico</a> . <br><br>  Scripts est√£o <code>xlog</code> para verificar o tamanho do <code>xlog</code> .  Os testes no banco de dados IMDB (formato JSON), no qual 4M + registros ocupando 4GB, mostraram: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> imdb <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> gin(jb jsonb_path_ops);</code> </pre> <br>  a maneira antiga executada 205 segundos, WAL 3,2 GB, e o novo algoritmo deu 133 segundos, e WAL 0,4 GB. <br><br><h3>  5. Otimiza√ß√£o da varredura apenas de √≠ndice no caso de muitas colunas. </h3><br>  <i>(Permita que as verifica√ß√µes apenas de √≠ndice sejam mais eficientes em √≠ndices com muitas colunas. Konstantin Knizhnik)</i> <br><br>  Ao analisar a opera√ß√£o do banco de dados de um dos clientes de nossa empresa, verificou- <a href="">se</a> que a mesma consulta √© executada em alguns casos em mais de 25% com varredura apenas de √≠ndice do que com varredura de √≠ndice (enable_indexonlyscan = off). <br>  Isso aconteceu quando o SELECT foi realizado em muitos campos, principalmente do tipo <code>bytea</code> , e seu deslocamento n√£o foi armazenado em cache, pois esses campos n√£o t√™m um deslocamento fixo (consulte tamb√©m o relat√≥rio de Nikolai Shaplov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúWhat's Inside It‚Äù</a> ).  Para descompactar o atributo k-th, voc√™ deve descompactar o k-1 anterior.  Descompactar um registro por um atributo requer tempo O (N * N), em que N √© o n√∫mero de campos.  Esses 25% j√° aconteceram em 10 campos. <br><br>  Konstantin Knizhnik usou o algoritmo usado ao trabalhar com quadril: ao acessar o atributo k-√©simo, os k-1s anteriores s√£o tomados e lembrados, o tempo cresce linearmente com o n√∫mero de campos.  Ap√≥s a aplica√ß√£o do patch, o tempo de execu√ß√£o com varredura de √≠ndice e varredura apenas de √≠ndice √© praticamente o mesmo. <br><br><h3>  6. Controle de dumping de segmentos WAL para o disco </h3><br>  <i>(Adicione um evento de espera para fsync dos segmentos WAL. Konstantin Knizhnik)</i> <br><br>  O kernel do PostgreSQL monitora a grava√ß√£o no WAL, mas n√£o monitora a libera√ß√£o dos segmentos WAL da mem√≥ria para o disco, ou seja, <code>fsync</code> .  K. Knizhnik fez um patch que cria um novo tipo de evento, agora √© chamado WALSync (o nome interno da vari√°vel √© WAIT_EVENT_WAL_SYNC).  Voc√™ pode v√™-lo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">r√≥tulo do evento PG</a> com a explica√ß√£o ‚ÄúAguardando que o arquivo WAL seja despejado em um armazenamento confi√°vel‚Äù.  Esse problema foi <a href="">discutido</a> na lista de <i>hackers</i> . <br><br>  Quanto tempo a redefini√ß√£o leva geralmente √© desconhecida: o PostgreSQL padr√£o n√£o sabe como agregar essas estat√≠sticas.  Mas h√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uma extens√£o pg_wait_sampling</a> escrita no Postgres Professional.  Ele pode falar sobre quais eventos o Postgres gasta tempo.  Agora que o evento foi adicionado, voc√™ pode seguir o <code>fsync</code> . <br><br><h3>  7. Suporte para novos idiomas em dicion√°rios stemmer </h3><br>  <i>(Atualize os dicion√°rios stemball do Snowball com suporte para novos idiomas. Arthur Zakirov)</i> <br><br>  Como as confer√™ncias do Postgres est√£o sendo realizadas no Nepal, √© muito mais natural <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">adicionar o</a> Nepali ao banco de dados!  Isso foi feito.  Gra√ßas aos esfor√ßos de Arthur Zakirov, agora voc√™ pode usar o dicion√°rio nepal√™s sobre <i>bola</i> de <i>neve</i> . <br><br><h3>  8. As fun√ß√µes to_timestamp () / to_date () tornaram-se mais tolerantes com os dados </h3><br>  <i>(Ajuste as fun√ß√µes to_timestamp () / to_date () para perdoar melhor as diferen√ßas de modelo, Artur Zakirov, Alexander Korotkov, Liudmila Mantrova)</i> <br><br>  A fun√ß√£o <code>to_timestamp()</code> n√£o funcionaria se a cadeia de formato fosse processada com espa√ßos extras.  A discuss√£o do bug em <code>to_timestamp()</code> resultou em uma <a href="">longa discuss√£o</a> sobre qual comportamento das fun√ß√µes <code>to_timestamp()</code> e, ao mesmo tempo, <code>to_date()</code> ser considerado correto.  Para benef√≠cio de todos, ambas as fun√ß√µes tornaram-se mais tolerantes a espa√ßos extras na linha de formato e na linha de entrada. <br><br><h3>  9. Os logs podem ser rotacionados via pg_ctl </h3><br>  <i>(Permite o controle da rota√ß√£o do arquivo de log via pg_ctl. Kyotaro Horiguchi, Alexander Kuzmenkov, Alexander Korotkov)</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Em outras palavras, o</a> utilit√°rio <code>pg_ctl</code> adquiriu uma nova op√ß√£o: <br><br><pre> <code class="plaintext hljs">pg_ctl logrotate [-D _] [-s]</code> </pre> <br>  Quando esse comando √© executado, o servidor alterna para um novo arquivo de log ou reabre o existente, dependendo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">da configura√ß√£o do log</a> .  Isso pode ser necess√°rio em situa√ß√µes de emerg√™ncia, especialmente quando grandes arquivos de log de r√°pido crescimento precisam, digamos, ser transferidos para diagn√≥stico. <br><br><h3>  10. A capacidade de criar novos tipos de tabelas (armazenamento conect√°vel) </h3><br>  <i>(Adicione o comando CREATE ACCESS METHOD para criar novos tipos de tabela. Andr√©s Freund, Haribabu Kommi, √Ålvaro Herrera, Alexander Korotkov, Dmitry Dolgov)</i> <br><br>  Esse patch importante √© uma parte essencial da infraestrutura da API de armazenamento plug√°vel, portanto, a composi√ß√£o internacional dos desenvolvedores de patch.  O comando CREATE ACCESS METHOD est√° em execu√ß√£o no Postgres desde a vers√£o 9.6.  Mas at√© o dia 12, voc√™ s√≥ podia criar m√©todos de acesso ao √≠ndice.  Aqui est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a documenta√ß√£o para a 11¬™ vers√£o</a> : <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACCESS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">METHOD</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> __ <span class="hljs-keyword"><span class="hljs-keyword">HANDLER</span></span> _ &lt; ... &gt; __       .      <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span>.</code> </pre> <br>  E na documenta√ß√£o do dia 12 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">j√° lida</a> : <i>atualmente apenas TABLE e INDEX s√£o suportados.</i>  Ali√°s, no 11¬∫ comando CREATE ACCESS METHOD foi fornecido pela extens√£o do Postgres Pro, e no 12¬∫ j√° PostgreSQL. <br><br>  A execu√ß√£o da opera√ß√£o depende do tipo de m√©todo de acesso;  se for do tipo TABLE, o <code>table_am_handler</code> o <code>table_am_handler</code> e, se for do tipo INDEX, <code>index_am_handler</code> (anteriormente: para m√©todos de acesso do tipo INDEX, deve ser <code>index_am_handler</code> ).  Um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cap√≠tulo</a> inteiro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">apareceu na documenta√ß√£o</a> sobre m√©todos de tabela. <br><br>  Ao criar uma tabela, agora voc√™ pode especificar seu tipo: <br><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> [ [ <span class="hljs-keyword"><span class="hljs-keyword">GLOBAL</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> ] { <span class="hljs-keyword"><span class="hljs-keyword">TEMPORARY</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">TEMP</span></span> } | <span class="hljs-keyword"><span class="hljs-keyword">UNLOGGED</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [ <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> ] _ ( [ &lt; ... &gt; [ <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span>  ]</code> </pre> <br>  <i>o m√©todo</i> √© do tipo TABLE - esta √© uma refer√™ncia ao armazenamento conect√°vel.  Agora √© <code>heap</code> por padr√£o, e antes do outro, de fato, n√£o era.  Sobre as classes de operadores <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> <br><br> <code>default_table_access_method (string)</code> <br> <br>  Este par√¢metro define o m√©todo de acesso √† tabela padr√£o que ser√° usado ao criar tabelas ou visualiza√ß√µes materializadas se o m√©todo de acesso n√£o for especificado explicitamente no comando CREATE ou ao executar o comando SELECT ... INTO, no qual o m√©todo de acesso n√£o pode ser definido explicitamente.  O valor padr√£o √© <code>heap</code> .  A grande discuss√£o dos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hackers</a> ajuda a divulgar os detalhes. <br><br>  At√© o momento, conversamos sobre inova√ß√µes.  Mas as corre√ß√µes de erros tamb√©m consomem os recursos do tempo dos programadores.  Os principais s√£o: <br><br><h3>  11. Bug: um erro em uma das estruturas </h3><br>  <i>Quote_all_identifiers extras em _dumpOptions.</i>  <i>Arthur Zakirov)</i> <br><br>  Em geral, nada de especial, um erro foi encontrado em uma das estruturas que o <code>pg_dump</code> usa - foi perdido pelo compilador.  Mas o pr√≥prio Bruce Momjyan <a href="">elogiou</a> a descoberta. <br><br>  Outros problemas com o <code>DumpOptions</code> podem ser encontrados <a href="">aqui</a> . <br><br><h3>  12. Erro na replica√ß√£o: </h3><br>  <i>(xlogreader: n√£o leia um bloco de arquivos duas vezes. Arthur Zakirov)</i> <br><br>  Outro funcion√°rio de nossa empresa, o desenvolvedor do pg_probackup, Grigory Smolkin, descobriu que um de nossos utilit√°rios fica mais lento quando o xlogreader l√™ os arquivos zlib.  Acontece que √†s vezes ele l√™ blocos de arquivos WAL duas vezes. <br><br>  Se os arquivos forem lidos inconsistentemente, o desempenho ser√° ruim.  A leitura repetida do bloco √© sempre inconsistente, pois voc√™ precisa retornar √† posi√ß√£o passada chamando a fun√ß√£o <code>gzseek()</code> .  <a href="">Agora,</a> releitura desnecess√°ria n√£o ocorre. <br><br>  <i>PS: N√£o vou dissimular: uma d√∫zia de patches (falando estritamente uma s√©rie de patches) n√£o s√£o apenas uma coincid√™ncia acidental com o n√∫mero da vers√£o do Postgres.</i>  <i>A lista poderia muito bem ser uma d√∫zia ou mais de uma d√∫zia.</i>  <i>Eu pensei que seria mais bonito, e a beleza √© em parte o motor da programa√ß√£o, sem mencionar outras √°reas da atividade humana.</i> <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt472072/">https://habr.com/ru/post/pt472072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt472054/index.html">Organizadores e assistentes de ensino sobre os programas online do CS Center</a></li>
<li><a href="../pt472060/index.html">A pol√≠cia alem√£ invadiu um bunker militar, que abrigava o rec√©m-declarado data center</a></li>
<li><a href="../pt472062/index.html">Monitoramento + teste de estresse = previs√£o e sem falhas</a></li>
<li><a href="../pt472064/index.html">Ansible + auto git pull no cluster de m√°quina virtual na nuvem</a></li>
<li><a href="../pt472068/index.html">Usando o NVME SSD como uma unidade do sistema em computadores com BIOS antigo e SO Linux</a></li>
<li><a href="../pt472076/index.html">O livro "Java para todos"</a></li>
<li><a href="../pt472078/index.html">Riscos Banc√°rios Abertos</a></li>
<li><a href="../pt472084/index.html">Vulnerabilidades em smartphones</a></li>
<li><a href="../pt472086/index.html">Usando as leis da psicologia da gestalt no design de interface do usu√°rio</a></li>
<li><a href="../pt472088/index.html">Como escolhemos o ServiceDesk. Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>