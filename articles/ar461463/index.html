<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๐ป ๐ง ๐ด ุงูุนูููุงุช ุงูุชุฌุงุฑูุฉ ูู ุดุฑูุงุช ุงููุดุงุฑูุน: ุงููุถุงุฑุจุฉ ูุงููุงูุน. ุฅููุงุก ุงูุถูุก ูุน R ๐จโ๐ง ๐ ๐ด๐พ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุงู ููุฌุฒ ุนู ุชุนุฏูู ุงูุนูููุงุช ุงูุชุฌุงุฑูุฉ ูู ุณูุงู ุงูุงูุชูุงู ุงููุชุฒุงูุฏ ุจููููู "ุงูุชูุฃู ุงูุฑููู". ูุธุฑูุง ููุธููุฑ ุงูุฏูุฑู ููุฐุง ุงูููุถูุน ุ ูุฃูุง ุฃุนุชุจุฑ ุฃูู ูู ุงูููุงุณุจ ูุด...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุนูููุงุช ุงูุชุฌุงุฑูุฉ ูู ุดุฑูุงุช ุงููุดุงุฑูุน: ุงููุถุงุฑุจุฉ ูุงููุงูุน. ุฅููุงุก ุงูุถูุก ูุน R</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461463/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ููุงู ููุฌุฒ ุนู ุชุนุฏูู ุงูุนูููุงุช ุงูุชุฌุงุฑูุฉ ูู ุณูุงู ุงูุงูุชูุงู ุงููุชุฒุงูุฏ ุจููููู "ุงูุชูุฃู ุงูุฑููู".  ูุธุฑูุง ููุธููุฑ ุงูุฏูุฑู ููุฐุง ุงูููุถูุน ุ ูุฃูุง ุฃุนุชุจุฑ ุฃูู ูู ุงูููุงุณุจ ูุดุงุฑูุฉ ุงูููุฌ ูู ุงูุญู. </p><br><h1 id="postanovka-zadachi" style=";text-align:right;direction:rtl">  ุจูุงู ุงููุดููุฉ </h1><br><p style=";text-align:right;direction:rtl">  ุงููุถุน ุจุณูุท ููุบุงูุฉ. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุงู ุดุฑูุฉ X (Y ุ Z ุ ...). </li><li style=";text-align:right;direction:rtl">  ูุชูุชูู ุงูุดุฑูุฉ ุงูุนูููุงุช ุงูุชุฌุงุฑูุฉ ุงูุขูู ูู ูุจู ุฃูุธูุฉ ุชูููููุฌูุง ุงููุนูููุงุช ุงููุฎุชููุฉ. </li><li style=";text-align:right;direction:rtl">  ููุงู ูุญููู ุงูุฃุนูุงู ุงูุฐูู ุฑุณููุง ูุฎุทุทุงุช bpmn ููุฐู ุงูุนูููุงุช.  ุจุดูู ุฃูุซุฑ ุชุญุฏูุฏูุง ุ "ููุฑุฉ bpmn" ุงูุฎุงุตุฉ ุจูู ุญูู ููููุฉ ุงููุธุฑ ูู ูุฐู ุงูุนูููุงุช. </li><li style=";text-align:right;direction:rtl">  ูุฑูุฏ ูุณุชุฎุฏูู ุงูุฃุนูุงู ุงูุญุตูู ุนูู ููุน ูู ุงูุชูุซูู (KPI) ููุฐู ุงูุนูููุงุช. </li></ul><br><p style=";text-align:right;direction:rtl">  ููู ุชุตู ุฅูู ุงูุญูููุฉ ูุนุฏ ูุฐู ุงูููุงููุณุ </p><br><p style=";text-align:right;direction:rtl">  ุฅูู ุงุณุชูุฑุงุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">ููููุดูุฑุงุช ุงูุณุงุจูุฉ</a> . <a name="habracut"></a></p><br><h1 id="formuliruem-zadachu-v-ponyatnyh-dlya-kompyutera-trebovaniyah" style=";text-align:right;direction:rtl">  ูุญู ุตูุงุบุฉ ุงููููุฉ ูู ูุชุทูุจุงุช ุงูููุจููุชุฑ ูุฏูุฉ </h1><br><p style=";text-align:right;direction:rtl"> ุงููุณููุงุช ุงูุฃุณุงุณูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุฌุฏ ุณุฌู ุฃุญุฏุงุซ ูุคูุช (ุณุฌูุงุช ูุฎุชููุฉ ูุฃูุธูุฉ ุชูููุฉ ุงููุนูููุงุช ุ cdr \ xdr ุ ุณุฌูุงุช ุงูุฃุญุฏุงุซ ููุท ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช) ุจุฏุฑุฌุงุช ูุชูุงูุชุฉ ูู ุงูููุงุก ูุงูุงูุชูุงู ูุงูุงุชุณุงู. </li><li style=";text-align:right;direction:rtl">  ุชุนูู ุฃูุธูุฉ ุชูููููุฌูุง ุงููุนูููุงุช ูุขูุฉ ุญููููุฉ ู "ุชูุดู" ุจูู ุงูููุงูุงุช ุงููุฎุชููุฉ ููููุง ูุฅุฌุฑุงุกุงุช ุงููุณุชุฎุฏููู ูููุทู ุงูุฃุนูุงู ุงูุฐู ูุถุนู ุงููุจุฑูุฌูู ููู. </li><li style=";text-align:right;direction:rtl">  ูุชู ุชูุงุนู ุงููุณุชุฎุฏู ูู ุดูู ูุนุงููุงุช. </li></ul><br><p style=";text-align:right;direction:rtl">  ุชุตุญูุญุงุช ุงูุนุงูู ุงููุงุฏู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅู ุนุฏุฏ ุงูุชุบููุฑุงุช ุงูุชู ุชู ุฅุฌุฑุงุคูุง ุนูู ูุธุงู ุชูููููุฌูุง ุงููุนูููุงุช ูู ุฃู ุงูุฑุณูู ุงูุจูุงููุฉ bpmn ููุญููู ุงูุฃุนูุงู ูุง ุนูุงูุฉ ููุง ุจุงููุงูุน ุชูุฑูุจูุง. </li><li style=";text-align:right;direction:rtl">  ูููู ุฃู ุชููู ุงูุจูุงูุงุช ุบูุฑ ููุธูุฉ ููุบุงูุฉ (ุนูู ุณุจูู ุงููุซุงู ุ ุณุฌูุงุช ุงูุชุทุจูู). </li><li style=";text-align:right;direction:rtl">  "ุงููุนุงููุงุช" ูู ููููู ููุทูู.  ุชุญุชูู ุณุฌูุงุช ุงูุฃุญุฏุงุซ ููุณูุง ุนูู ุณูุงุช ูุชุฃุตูุฉ ูู ูุฐู ุงูุญุงูุฉ ููุง ููุฌุฏ ููุนุฑูู ูุนุงููุฉ ูู ุทุฑู ุฅูู ุทุฑู. </li><li style=";text-align:right;direction:rtl">  ุนุฏุฏ ุงูุณุฌูุงุช ูู ุงูููู ูู <strong>ุนุดุฑุงุช ุ ูุฆุงุช ุ ุขูุงู ุงูููุงููู ูู ุงููุทุน</strong> . </li></ul><br><h1 id="reshenie-postavil-poschital" style=";text-align:right;direction:rtl">  ูุฌููุนุฉ ุงูุนุฏ ุงูุญู </h1><br><p style=";text-align:right;direction:rtl">  ูุญู ูุฐู ุงููุดุงูู ุ ูู ุงูุถุฑูุฑู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุจูุงุก ุงููุนุงููุงุช </li><li style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุจูุงุก ุงูุนูููุงุช ุงูุชุฌุงุฑูุฉ ุงูุญููููุฉ </li><li style=";text-align:right;direction:rtl">  ุนูู ุญุณุงุจุงุช </li><li style=";text-align:right;direction:rtl">  ุชูููุฏ ูุชุงุฆุฌ ูู ุดูู ูุงุจู ูููุฑุงุกุฉ ุงูุฅูุณุงู. </li></ul><br><p style=";text-align:right;direction:rtl">  ููููู ุงูุจุฏุก ูู ุงูุจุญุซ ุนู ุญููู ุงูุจุงุฆุนูู ูุฏูุน ุงูููุงููู.  ููู ูุฏููุง R. ูู ุฃูุฏููุง ุ ููู ูุชูุญ ููุง ุญู ูุฐู ุงููุดููุฉ ุชูุงููุง.  ุงุนุชุจุงุฑุงุช ููุฌุฒุฉ ุฃุฏูุงู. </p><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ูู ุดูุก ุจุณูุทูุง ููุญุชูู R ุนูู ูุฌููุนุฉ ุฌูุฏุฉ ููุชูุงุณูุฉ ูู ุญุฒู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">bupaR</a> .  ููู ุงูุฐุจุงุจุฉ ูู ุงููุฑูู ููุฌูุฏุฉ ูุชุณูู ูู ุดูุก.  ูุฐู ุงููุฌููุนุฉ ูู ููุช ููุจูู ูุง ูููููุง ุณูู ุงูุชุนุงูู ูุน ุนุฏุฏ ุตุบูุฑ ูู ุงูุฃุญุฏุงุซ (ูุฆุงุช ุงูุขูุงู - ุนุฏุฉ ููุงููู). <br>  ุจุงููุณุจุฉ ูููููุงุช ุงููุจูุฑุฉ ุ ูุฌุจ ุงุณุชุฎุฏุงู ุทุฑู ุฃุฎุฑู. </p><br><h1 id="dobavlyaem-skorosti" style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ุงูุณุฑุนุฉ! </h1><br><h2 id="emuliruem-vhodnoy-nabor-dannyh" style=";text-align:right;direction:rtl">  ูุญุงูุงุฉ ูุฌููุนุฉ ุจูุงูุงุช ุงูุฅุฏุฎุงู </h2><br><p style=";text-align:right;direction:rtl">  ูุฅุธูุงุฑ ุงูุฃููุงุฑ ุ ูู ุงูุถุฑูุฑู ุชูููู ููุน ูู ูุฌููุนุฉ ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ.  ููุฃุฎุฐ ูุซุงูุงู ุนูู ุณูุณูุฉ ูุชุงุฌุฑ ููุฏุฑุงููุฉ ููุตุฏุฑ ูุงุฏู ููููุฐุฌ ุฑูุงุถู ุ ููุญุณู ุงูุญุธ ุ ูุฐุง ูุงุถุญ ููุฌููุน.  ุนูู ุงูุฑุบู ูู ุงููุฌุงุญ ููุณู ุ ูููู ุฃู ุชููู ุฃุฌูุฒุฉ ุงูุตุฑุงู ุงูุขูู ููุฑุงูุฒ ุงูุงุชุตุงู ููุณุงุฆู ุงูููู ุงูุนุงู ูุฅูุฏุงุฏุงุช ุงูููุงู ูุบูุฑูุง. </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุงู ูุญูุงุช ูู ูุฎุชูู ุงูุฃุญุฌุงู (ุงูุตุบูุฑุฉ ูุงููุชูุณุทุฉ ูุงููุจูุฑุฉ). </li><li style=";text-align:right;direction:rtl">  ูู ุงููุชุงุฌุฑ ููุงู ููุงุชุจ ููุฏูุฉ (ููุงุท ุงูุจูุน). </li><li style=";text-align:right;direction:rtl">  ูููู ุฃู ุชููู ุฃุฑูุงู ุงููุชุฌุฑ ุฃุจุฌุฏูุฉ ุฑูููุฉ ุ ููููู ุฃู ุชููู ุงูุฃุฑูุงู ุงูุทุฑููุฉ ุฑูููุฉ. </li><li style=";text-align:right;direction:rtl">  ูุฐูุจ ุงููุชุณูููู ุฅูู ุงููุชุงุฌุฑ ููููููู ุจุดุฑุงุก ุดูุก ุฃุซูุงุก ุงูุฏูุน ุจุจุทุงูุฉ. </li><li style=";text-align:right;direction:rtl">  ูุชู ูุตู ุชูุงุนู ูุญุทุฉ ููุงุท ุงูุจูุน ูุน ุงูุจุทุงูุฉ ูุงูุจูู ูู ูุจู ูุฌููุนุฉ ูุนููุฉ ูู ุงูุฏูู ูููุงุนุฏ ุงูุงูุชูุงู ุจููููุง. </li><li style=";text-align:right;direction:rtl">  ุงููุนุงููุงุช ูุงุฌุญุฉ ุ ุบูุฑ ูุงุฌุญุฉ ุ ูุคุฌูุฉ ูุบูุฑ ููุชููุฉ (ุงูุจูู ุบูุฑ ูุชููุฑ ุ ุนูู ุณุจูู ุงููุซุงู). </li><li style=";text-align:right;direction:rtl">  ุงููุนุงููุงุช ููุง ูููุงุช. </li></ul><br><p style=";text-align:right;direction:rtl">  ุฎุฐ ุงููุฌููุนุฉ ุงูุชุงููุฉ ูู ุฃููุงุท ุงููุนุงููุงุช ุงูุชุฌุงุฑูุฉ: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">"INIT-REQUEST-RESPONSE-SUCCESS" "INIT-REQUEST-RESPONSE-ERROR" "INIT-REQUEST-RESPONSE-DEFFERED" "INIT-REQUEST" "INIT"</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฅุธูุงุฑ ุงูููุฌ ุ ุณููุดุฆ ุนููุฉ ุตุบูุฑุฉ ุ ููู ูู ุดูุก ูุนูู ุจุดูู ุฌูุฏ ุนูู ูููุงุฑุงุช ุงูุณุฌูุงุช (ุจุงููุณุจุฉ ููุซู ูุฐุง ุงููุฌูุฏ ุฏูู ุงูุชุญุณูู ุงููุงุฆู ุ <strong>ูุชู ููุงุณ ุงูููุช ุงููููุฒ ุจูุฆุงุช ุงูุซูุงูู ููุท</strong> ุนูู ุฎุงุฏู ูุงุญุฏ ุฐู ุฃุฏุงุก ูุชูุงุถุน ููุบุงูุฉ). </p><br><p style=";text-align:right;direction:rtl">  ุงูููุณุฏ ุงููุจุงุดุฑ ูููููุงุช ุงููุจูุฑุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ูุซูุฑ ูู ุงูุฃูุงูู ุ ุชุนูู ูููุฉ <code>tidyverse</code> ูุง ููููู ุงูุญุตูู ุนูู ุฅุฌุงุจุฉ ุ </li><li style=";text-align:right;direction:rtl">  ูุนุฏ ุชุญุณูู ุงูุฎุทูุงุช ุงูุฏูููุฉ ุญุชู ูููุฏูุง ููููู ุฃู ููุฏู ูุณุงููุฉ ูุจูุฑุฉ. </li></ul><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูููุฐุฌ ุฑูุฒ ุงููุญุงูุงุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">library(tidyverse) library(datapasta) library(tictoc) library(data.table) library(stringi) library(anytime) library(rTRNG) data.table::setDTthreads(0) #      data.table data.table::getDTthreads() #     set.seed(46572) RcppParallel::setThreadOptions(numThreads = parallel::detectCores() - 1) #   --   -,     #  5   -, 2  --   bo_pattern &lt;- tibble::tribble( #  ,    ,    ~pattern, ~prob, ~mean_duration, "INIT-REQUEST-RESPONSE-SUCCESS", 0.7, 5, "INIT-REQUEST-RESPONSE-ERROR", 0.15, 5, "INIT-REQUEST-RESPONSE-DEFFERED", 0.07, 8, "INIT-REQUEST", 0.05, 2, "INIT", 0.03, 0.5 ) #    +     checkmate::assertTRUE(sum(bo_pattern$prob) == 1) df &lt;- bo_pattern %&gt;% separate_rows(pattern) %&gt;% #   mutate(coeff = sum(prob)) %&gt;% group_by(pattern) %&gt;% #    summarise(event_prob = sum(prob/coeff)*100) %&gt;% ungroup() checkmate::assertTRUE(sum(df$event_prob) == 100) #   3  :  (4 ),  (12 ),  (30 ) df1 &lt;- tribble( ~type, ~n_pos, ~n_store, "small", 4, 10, "medium", 12, 5, "large", 30, 2 ) %&gt;% #       mutate(store = map2(row_number(), n_store, ~sample(x = .x * 1000 + 1:.y, size = .y, replace = FALSE))) %&gt;% unnest(store) %&gt;% #       mutate(pos = map(n_pos, ~sample(x = .x, size = .x, replace = FALSE))) %&gt;% unnest(pos) %&gt;% mutate(pattern = sample(bo_pattern$pattern, n(), replace = TRUE, prob = bo_pattern$prob)) tic("Generate transactions") #     ,      #         ,       df2 &lt;- df1 %&gt;% #         select(-matches("duration")) %&gt;% left_join(bo_pattern, by = "pattern") %&gt;% #   sample_frac(size = 200, replace = TRUE) %&gt;% mutate(duration = rnorm(n(), mean = mean_duration, sd = mean_duration * .25)) %&gt;% select(-prob, -mean_duration) %&gt;% #   ,      &gt;  #    30  filter(duration &gt; 0.5 &amp; duration &lt; 30) %&gt;% #    POS       mutate(session_id = row_number()) %&gt;% #     ,       separate_rows(pattern) %&gt;% rename(event = pattern) toc() tic("Generate time markers, data.table way") samples_tbl &lt;- data.table::as.data.table(df2) %&gt;% # setkey(session_id, duration, physical = FALSE) %&gt;% #           # 1-       , ,      5  # .[, ticks := base::sort(runif(.N, 5, 5 + duration)), by = .(session_id, duration)] %&gt;% #          match.arg   base::order!! #     #       0  1     #     # .[, tshift := runif(.N, 0, 1)] %&gt;% #    trng     (    ) # ,           .[, trand := runif_trng(.N, 0, 1, parallelGrain = 100L) * duration] %&gt;% #      ,      # .[, ticks := sort(tshift), by = .(session_id)] %&gt;% #  ,     session_id,   ,     .[, t_idx := session_id + trand / max(trand)/10] %&gt;% #         # session_id            .  .[, tshift := (sort(t_idx) - session_id) * 10 * max(trand)] %&gt;% #   ,     POS     (60 ) .[event == "INIT", tshift := tshift + runif_trng(.N, 0, 60, parallelGrain = 100L)] %&gt;% #     .[, `:=`(duration = NULL, trand = NULL, t_idx = NULL, n_store = NULL, n_pos = NULL, timestamp = as.numeric(anytime("2019-03-11 08:00:00 MSK")))] %&gt;% #     ,   01.03.2019     .[, timestamp := timestamp + cumsum(tshift), by = .(store, pos)] %&gt;% #      .[timestamp &lt;= as.numeric(anytime("2019-04-11 23:00:00 MSK")), ] %&gt;% #           .[, timestamp := anytime(timestamp, tz = "Europe/Moscow")] %&gt;% as_tibble() %&gt;% select(store, pos, event, timestamp, session_id) toc()</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูู ุฃุฌู ููุงุก ุงูุชุฌุฑุจุฉ ุ ูุชุฑู ููุท ุงููุนููุงุช ุงููุงูุฉ ููุฎูุท ูู ุดูุก.  ูู ุงูุญูุงุฉ ุงููุงูุนูุฉ ุ ูุง ูุฒุงู ูู ุงูุถุฑูุฑู ุงูุชุฎูุต ุจุดูู ุนุดูุงุฆู ูู ุฌุฒุก ูู ุงูุฃุฌุฒุงุก (ุฑุจูุง ูู ูุชู ุฒูููุฉ ูููุตูุฉ) ุ ูุจุงูุชุงูู ูุญุงูุงุฉ ุงูุฎุณุงุฆุฑ ูู ุชููู ุงูุจูุงูุงุช. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#   log_tbl &lt;- samples_tbl %&gt;% select(store, pos, state = event, timestamp_msk = timestamp) %&gt;% sample_n(n()) #   log_tbl %&gt;% mutate(timegroup = lubridate::ceiling_date(timestamp_msk, unit = "10 mins")) %&gt;% ggplot(aes(timegroup)) + # geom_bar(width = 0.7*600) + geom_bar(colour = "white", size = 1.3) + theme_bw()</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/lu/ik/kz/luikkzek29sujmfr3ggbbiabuh8.png"></p><br><p style=";text-align:right;direction:rtl">  ููุถุญ ูุฎุทุท ุงูุนูููุฉ ูุน ุตูุฑุฉ </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/3g/i1/j3/3gi1j3yiclbsbu-knj8vuv7cas4.png" alt="ุญุณุงุจ ุนูู `data.frame` ุงูุฃุตูู"></p><br><p style=";text-align:right;direction:rtl">  ูุชูุฒูุน ุงูุฏููุฉ <br><img src="https://habrastorage.org/webt/5h/rw/uu/5hrwuuvmrqcgbsretr65g98epyy.png" alt="ุงูุชุตูุฑ ุจุงุณุชุฎุฏุงู `bupaR`"></p><br><p style=";text-align:right;direction:rtl">  ูุฑุฌุน ุงูุชููุจุงุช ุงูุทูููุฉ ุฅูู ุญูููุฉ ุฃู ุงูุฌุฏูู ูุชู ุงุนุชุจุงุฑู ูู ุงูุจุฏุงูุฉ (ูุชู ุชุถูููู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ) ุ ููุฏ ุนููุช <code>bupaR::process_map</code> ูู ุงูููุงูุฉ ุนูุฏูุง ุชู ูุทุน ุจุนุถ ุงูุจูุงูุงุช ุงูุชู ุชู ุฅูุดุงุคูุง ุนุดูุงุฆููุง ูุงูุชู ูุง ุชุชูุงุณุจ ูุน ุงููููุฏ ุงููุชูุงููุฉ ุนู ุทุฑูู ุชุตููุฉ ุงูุนูุงุตุฑ. </p><br><h2 id="rekonstrukciya-tranzakciy" style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุจูุงุก ุงููุนุงููุงุช </h2><br><p style=";text-align:right;direction:rtl">  ุฃูู ูุง ูุชู ุชูุฏููู ุนุงุฏุฉู ุนูุฏูุง ูุชุนูู ุนููู ุฌูุน / ุชูููู / ููุงุฑูุฉ ุงูุณูุงุณู ุงูุฒูููุฉ ูู ุงูุชุฌูุนุงุช ูุฏูุฑุงุช ุงูููุงุฑูุฉ.  ูู ุงูุนุฑูุถ ุงูุชูุถูุญูุฉ ุงูุชู ุชุญุชูู ุนูู 100 ุฅุฏุฎุงู ุ ุณุชุนูู ูุฐู ุงูุฒูุงุฏุฉ ุ ููู ููุงููู ุงูููุงุฆู ูู ุชูุฌุญ.  ููุชุนุงูู ูุน ูุฐู ุงููููุฉ ุ ุชุญุชุงุฌ ุฅูู ุชูุทูู ููุงุท ููุฏุงู ุงูููุช (ุงูุญููุงุช ุงูุฏุงุฎููุฉ ูุชุฎุตูุตุงุช ุงูุฐุงูุฑุฉ ุงููุณูุทุฉ ูุงููุณุฎ) ููุญุงููุฉ ุงููุถุงุก ุนูููุง ุฅูู ุงูุญุฏ ุงูุฃุฏูู. </p><br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ูุฐูู ุ ูููู ุชูููู ูุฐู ุงููุดููุฉ ุฅูู ุนุดุฑุฉ ุฎุทูุท. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุฏ ุงุนุงุฏุฉ ุจูุงุก ุงููุนุงููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">clean_dt &lt;- as.data.table(log_tbl) %&gt;% #     INIT .[, start := (state == "INIT")] %&gt;% #  session_id      ,  #             .[, event_date := lubridate::as_date(timestamp_msk)] %&gt;% .[, date_str := format(.BY[[1]], "%y%m%d"), by = event_date] %&gt;% #            # timestamp_msk    setorder(store, pos, timestamp_msk) %&gt;% #     --              .[, session_id := paste(date_str, store, pos, cumsum(start), sep = "_")] %&gt;% #        ( 30 ) # .[, time_shift := timestamp_msk - shift(timestamp_msk), by = .(store, pos)] %&gt;% #        ,   INIT .[, time_locf := cummax(as.numeric(timestamp_msk) * as.numeric(start)), by = .(store, pos)] %&gt;% .[, time_shift := as.numeric(timestamp_msk) - time_locf] %&gt;% #   ,       30  .[, lost_chain := time_shift &gt; 30] %&gt;% # .[, time_shift := as.numeric(!start) * as.numeric(timestamp_msk - shift(timestamp_msk, fill = 0))] %&gt;% # INIT    # .[, time_accu := cumsum(time_shift)] %&gt;% .[, date_str := NULL] #          #    tidyverse  ,      dt &lt;- as.data.table(clean_dt) %&gt;% #     !!! .[lost_chain != TRUE] %&gt;% #        1-    .[order(timestamp_msk, store, pos)] %&gt;% .[, bp_pattern := stri_join(state, collapse = "-"), by = session_id] #     as_tibble(dt) %&gt;% distinct(session_id, bp_pattern) %&gt;% count(session_id, sort = TRUE)</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูู ุจุถุน ุซูุงู ุ ูุฏููุง ุตูุฑุฉ ุฃุนูุฏ ุจูุงุคูุง ูู ุงูุนูููุงุช ุงูุชุฌุงุฑูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ู (ูู ูุงู ูุธู !!!) ูู ุงููุงูุน ุ ุงุชุถุญ ุฃู ุงูุนูููุงุช ุงูุชุฌุงุฑูุฉ ุงูุขููุฉ ูู ุฃูุธูุฉ ุชูููููุฌูุง ุงููุนูููุงุช ุชุนูู ุจุดูู ูุฎุชูู ููุนูุง ูุง (ุฃู ูุง ุชุนูู ุนูู ุงูุฅุทูุงู) ููุง ุฃููุน ูุญููู ุงูุฃุนูุงู ุงูุฌููุน.  ุนุฌุงุฆุจ ูุญุฌุฌ "ุฃุตุญุงุจ ุงูุนูููุฉ" ุณุชุฑุงูู ุฏุฑุงุณุฉ ุงูุตูุฑุฉ ุงูููุงุฆูุฉ. </p><br><h1 id="aktivno-primenyaem-tryuki" style=";text-align:right;direction:rtl">  ุชุทุจูู ุจูุดุงุท ุงูุญูู </h1><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ุชุตุจุญ ุณุฑุนุฉ ุงูุญูุณุจุฉ ูููุฉ ูููุฉ ุ ูุฅู ูุชุงุจุฉ ุฑูุฒ ุงูุนูู ูุง ูููู.  ูู ุงูุถุฑูุฑู ุงูุงูุชุจุงู ุฅูู ุฌููุน ุงููุณุชููุงุช.  ููุงู ุฃูุถูุง ุนุฏุฏ ูู ุงูุญูู ุงูุญุณุงุจูุฉ ุงูุชู ูููู ุฃู ุชููู ุจุดูู ูุจูุฑ ูู ููุช ุงูุชูููุฐ. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ูุฌู ุงูุฎุตูุต ุ ูู ูุฐู ุงููููุฉ ูููู ุฃู ูุฐูุฑ ูุง ููู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูููุนุงูุฌุฉ ุงูุฑุฆูุณูุฉ ุ ููุท <code>data.table</code> (ุงูุณุฑุนุฉ ุ ุงูุนูู ุนูู ุงูุฑูุงุจุท) ุ + ูุญุงุณุจุฉ ุชุญุณูู ุงูุงุณุชุนูุงู ุงูุฏุงุฎูู. </li><li style=";text-align:right;direction:rtl">  ูููู ุฃู ุชุญุชูู <code>POSIXct</code> ุนูู ุฃุฌุฒุงุก ูู ุงูุซุงููุฉ (ุนูู ุงูุฑุบู ูู ุฃููุง ูุง ุชุธูุฑ ุจุดูู ุทุจูุนู ุ ูููู ูููู ุชุตุญูุญูุง ุจุงุณุชุฎุฏุงู <code>options(digits.secs=X)</code> ) ุ ูุฅููุง <code>options(digits.secs=X)</code> ููุงู ุ ูุณูููู ูู ุงูุณูู ุงูููุงุฑูุฉ ูุงููุฑุฒ. </li><li style=";text-align:right;direction:rtl">  ุชุฌูุจ ุงููุฑุฒ ุงูุจุฏูู ุฏุงุฎู ุงููุฌููุนุงุช!  ูุถูู ุงููุฑุฒ ุงููุงุฏู ุงููุฑุฏู ูููุงูู ุจุฃูููู ูุฑุฒ ุงูุจูุงูุงุช ูู ูุฌููุนุงุช. </li><li style=";text-align:right;direction:rtl">  ุชุฌูุจ ุงูุญูุณุจุฉ ุฏุงุฎู ุงููุฌููุนุงุช.  ูุญุงูู ุฃู ููุนู ูู ูุง ูู ูููู ุนูู ุงูุจูุงูุงุช ุงููุตุฏุฑ (ูุทุจู ุงูุชูุฌูู ุ ูุฎูุถ ููุงุชูุฑ ุงูููุงููุงุช ุงููุธูููุฉ). </li><li style=";text-align:right;direction:rtl">  ูุญู ูุณุชุฎุฏู ูููุฉ ูุนุงููุฉ ููุชุนุงูู ูุน ุงููุฌูุงุช ุงูุฒูููุฉ. </li><li style=";text-align:right;direction:rtl">  ุฃุณุงููุจ locf (Last Observation Carward Forward) ุจุทูุฆุฉ.  ูููู ุงูุฎุตุงุฆุต ุนูู ุฌุฏูู ุฒููู ุ ุงุณุชุฎุฏู <code>cumsum</code> ุ <code>cummax</code> . </li><li style=";text-align:right;direction:rtl">  ุงูุนูููุงุช ุงููุณุชูููุฉ ููููุช ุ ูุซู POSIX -&gt; ุชุญููู ุงูุณูุณูุฉ ุ ุงูุจุญุซ ุงูููุชุธู ุ ุฅูุฎ.  ูุญู ูุง ููุนู ุฐูู ุนูุตุฑ ุชูู ุงูุขุฎุฑ ุ ูููู ุนูู ุชูุงููู.  ุงููููุงุช ุงูุนุงูุฉ ุนูู ุงูููุฑุณุฉ ุงูุฏุงุฎููุฉ ูุชุฌููุน ุงูุญูู ุงููุญูู ุฃุตุบุฑ ุจุดูู ูุง ูุถุงูู. </li><li style=";text-align:right;direction:rtl">  ูุญู ูุณุชุฎุฏู ุจูุดุงุท multithreading (ุจูุง ูู ุฐูู ุฏุงุฎู ุงูุญุฒูุฉ). </li><li style=";text-align:right;direction:rtl">  ูุง ุชููู microoptimization.  ุนูู ุณุจูู ุงููุซุงู ุ <code>stri_c</code> ุฃุณุฑุน ุนุฏุฉ ูุฑุงุช ูู <code>paste0</code> . </li></ol><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#  1 log &lt;- getLog(fileName) bench::mark( paste0 = paste0(log$value, collapse = "\n"), stringi = stri_c(log$value, collapse = "\n") ) # # A tibble: 2 x 13 # expression min median `itr/sec` mem_alloc `gc/sec` n_itr n_gc total_time # &lt;bch:expr&gt; &lt;bch:&gt; &lt;bch:&gt; &lt;dbl&gt; &lt;bch:byt&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;bch:tm&gt; # 1 paste0 58ms 59.1ms 16.9 496KB 0 9 0 533ms # 2 stringi 16.9ms 17.5ms 57.1 0B 0 29 0 508ms</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุธููุฉ ุงูุณุงุจูุฉ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณููู ูุนุงูุฌุฉ json ุงูุณููุณุฑู</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar461463/">https://habr.com/ru/post/ar461463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar461451/index.html">ูููู ุงูุซุงูู ูุน ูุงููู: ูุณุฑูุฑ ุ ููู ููุณ ูุณุชุนุฏูุง ููุฐูุงุจ ุจุนุฏ</a></li>
<li><a href="../ar461455/index.html">Habr Weekly # 11 / ููุงุฐุง ูุญุชุงุฌ ุฅูู ุฌุงูุนุงุช ุงูุขู ุ ูุง ูู ูุธููุฉ "ุญููููุฉ" ุ ุชู ุงูุงูุชูุงุก ูู Galaxy Fold</a></li>
<li><a href="../ar461457/index.html">ูุง ูู ุงูุนูุงูู ุงูุชู ูููู ุฃู ุชุชูุจุฃ ุจูุฌุงุญ ุงููุนุจุฉ ุนูู Steamุ</a></li>
<li><a href="../ar461459/index.html">ููู ุณุนูุฏ ูุณุคูู ุงููุธุงู</a></li>
<li><a href="../ar461461/index.html">ุชุฒุฏูุฑ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ูู ุนุตุฑ ุงูุณุญุงุจุฉ ุ ููู ุจูุฑุงุช ุงูุดุฑูุท ูุง ุชููุณู. ูุญุงุฏุซุฉ ูุน Veeam</a></li>
<li><a href="../ar461465/index.html">ุฏููู ุงูููุงุณ</a></li>
<li><a href="../ar461467/index.html">ูุซุงู ุนูู ุฅูุดุงุก ุชุทุจููุงุช Makefile ูู Go</a></li>
<li><a href="../ar461469/index.html">ูุง ูุดุจู ุงูุงุณุชูุงุน ุฅูู ุฑูุฒ ูู 1000 ูููุฉ ูู ุงูุฏูููุฉ ุงููุงุญุฏุฉ</a></li>
<li><a href="../ar461471/index.html">. NET - ุฃุฏูุงุช ููุนูู ูุน ุชุนุฏุฏ ุงูุนูููุงุช ูุชุฒุงูู - ุงูุฌุฒุก 2</a></li>
<li><a href="../ar461473/index.html">ุฎูุงุฑุฒููุงุช ุงูุชุตุญูุญ ุนูู ุงูุฑุณูู ุงูุจูุงููุฉ - ุงูุขู ูุน ุงูุตูุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>