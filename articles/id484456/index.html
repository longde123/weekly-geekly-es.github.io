<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😠 🐔 👐🏼 ReactJS, rendering Sisi Server dan beberapa seluk-beluk pemrosesan tag meta halaman ⏭️ 🚑 📹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salah satu masalah yang harus Anda selesaikan saat menulis aplikasi rendering Sisi Server adalah bekerja dengan tag meta yang harus dimiliki setiap ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ReactJS, rendering Sisi Server dan beberapa seluk-beluk pemrosesan tag meta halaman</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484456/"> Salah satu masalah yang harus Anda selesaikan saat menulis aplikasi rendering Sisi Server adalah bekerja dengan tag meta yang harus dimiliki setiap halaman, yang membantu mengindeksnya dengan mesin pencari. <br><br>  Mulai dari google, solusi pertama yang akan Anda <a href="https://github.com/nfl/react-helmet" rel="nofollow">tuju adalah</a> kemungkinan besar <a href="https://github.com/nfl/react-helmet" rel="nofollow">React Helmet</a> . <br><br>  Salah satu kelebihan perpustakaan adalah dapat dianggap isomorfis dalam beberapa cara dan dapat digunakan dengan sempurna baik di sisi klien maupun di sisi server. <br><a name="habracut"></a><br><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Page</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Helmet</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Turbo Todo</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"theme-color"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"#008f68"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Helmet</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {/* ... */} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); } }</span></span></code> </pre> <br>  Di server, router akan terlihat seperti ini: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/*'</span></span>, (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> html = renderToString(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">App</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">); const helmet = Helmet.renderStatic(); res.send(` </span><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!doctype html&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag"> ${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">helmet.htmlAttributes.toString</span></span></span></span><span class="xml"><span class="hljs-tag">()}&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ${helmet.title.toString()} ${helmet.meta.toString()} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag"> ${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">helmet.bodyAttributes.toString</span></span></span></span><span class="xml"><span class="hljs-tag">()}&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">${html}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> `); });</span></span></code> </pre> <br>  Kedua cuplikan ini sepenuhnya benar dan efisien, tetapi ada satu TETAPI, kode di atas untuk server sepenuhnya sinkron dan karena itu benar-benar aman, tetapi jika menjadi asinkron, ia akan menyembunyikan bug yang sulit di-debug sendiri: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/*'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; { <span class="hljs-comment"><span class="hljs-comment">// .... await anyAsyncAction(); //.... const helmet = Helmet.renderStatic(); // ... });</span></span></code> </pre><br>  Masalahnya di sini terutama di perpustakaan React Helmet itu sendiri dan, khususnya, di mana ia mengumpulkan semua tag di dalam Pohon React dan menempatkannya pada kenyataannya menjadi variabel global, dan karena kode tersebut telah menjadi tidak sinkron, kode tersebut dapat mencampur permintaan yang diproses secara simultan dari pengguna yang berbeda. <br><br>  Kabar baiknya di sini adalah bahwa garpu dibuat atas dasar perpustakaan ini dan sekarang lebih baik untuk memberikan preferensi ke perpustakaan <a href="https://github.com/staylor/react-helmet-async" rel="nofollow">bereaksi-helm-async</a> .  Paradigma utama di dalamnya adalah bahwa dalam kasus ini, konteks helm reaksi akan diisolasi dalam kerangka permintaan tunggal dengan merangkum aplikasi Pohon React di HelmetProvider: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Helmet, HelmetProvider } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-helmet-async'</span></span>; app.get(<span class="hljs-string"><span class="hljs-string">'/*'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; {​ <span class="hljs-comment"><span class="hljs-comment">// ... code may content any async actions const helmetContext = {}; const app = ( &lt;HelmetProvider context={helmetContext}&gt; &lt;App/&gt; &lt;/HelmetProvider&gt; ); // ...code may content any async actions const html = renderToString(app); const { helmet } = helmetContext; // ...code may content any async actions });</span></span></code> </pre><br>  Ini bisa selesai, tetapi mungkin Anda akan melangkah lebih jauh dalam upaya untuk memeras kinerja maksimum dan meningkatkan beberapa metrik SEO.  Misalnya, Anda dapat meningkatkan metrik Time To First Byte (TTFB) - ketika server dapat mengirim tata letak halaman dengan potongan saat dihitung, alih-alih menunggu hingga dihitung sepenuhnya.  Untuk melakukan ini, Anda akan mulai melihat ke arah menggunakan <i>renderToNodeStream</i> alih-alih <i>renderToString</i> . <br><br>  Di sini kita dihadapkan dengan masalah kecil.  Untuk mendapatkan semua tag meta yang dibutuhkan halaman, kita harus melalui seluruh pohon reaksi aplikasi, tetapi masalahnya adalah bahwa tag meta harus dikirim sebelum saat kita mulai streaming konten menggunakan renderToNodeStream.  Bahkan, kita perlu menghitung React Tree dua kali dan terlihat seperti ini: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/*'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; {​ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> helmetContext = {}; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> app = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;HelmetProvider context={helmetContext}&gt; &lt;App</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/&gt; &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">HelmetProvider&gt; </span></span></span><span class="hljs-function">); // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">do</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">first</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pass</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">render</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">so</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">that</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">react</span></span></span><span class="hljs-function">-</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">helmet</span></span></span><span class="hljs-function">-</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">async</span></span></span><span class="hljs-function"> // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">can</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">see</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">what</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">meta</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tags</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">to</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">render</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReactDOMServer</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">helmet</span></span></span><span class="hljs-function"> } = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">helmetContext</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">write</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">` &lt;html&gt; &lt;head&gt; </span></span></span><span class="hljs-subst"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string"><span class="hljs-subst">${helmet.title.toString()}</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">​ </span></span></span><span class="hljs-subst"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string"><span class="hljs-subst">${helmet.meta.toString()}</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-string"> &lt;/head&gt; &lt;body&gt; `</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ReactDOMServer</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderToNodeStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pipe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response, { end: </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> }</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">on</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'end'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, (</span></span></span><span class="hljs-function">) =&gt;</span></span> response.end(<span class="hljs-string"><span class="hljs-string">'&lt;/body&gt;&lt;/html&gt;'</span></span>)); });</code> </pre><br>  Dengan pendekatan seperti itu, kebutuhan untuk optimasi seperti itu pada prinsipnya menjadi pertanyaan besar dan tidak mungkin kita akan meningkatkan metrik TTFB yang ingin kita capai. <br><br>  Di sini kita bisa memainkan sedikit optimasi dan ada beberapa opsi <br><br><ul><li>  alih-alih penggunaan renderToString renderToStaticMarkup, yang mungkin akan membantu sampai batas tertentu memenangkan waktu </li><li>  alih-alih menggunakan penyaji yang ditawarkan oleh reaksi dari kotak, buat versi cahaya Anda sendiri dari bagian melalui pohon reaksi, misalnya, berdasarkan perpustakaan <a href="https://github.com/ctrlplusb/react-tree-walker" rel="nofollow">reaksi-tree-walker</a> , atau menolak untuk membuat pohon sepenuhnya dan hanya melihat pada tingkat pertama pohon, tidak memperhatikan komponen yang disematkan, jadi katakan rendering dangkal </li><li>  pertimbangkan sistem caching yang kadang-kadang mungkin melewatkan jalan pertama melalui pohon reaksi </li></ul><br>  Tetapi bagaimanapun juga, segala sesuatu yang digambarkan terdengar terlalu canggih dan, pada prinsipnya, meragukan perlombaan ini untuk efisiensi, ketika beberapa arsitektur kompleks yang abnormal dibangun dalam beberapa milidetik. <br><br>  Bagi saya, dalam hal ini, bagi mereka yang terbiasa dengan cara mengekstrak data untuk rendering untuk RSK (dan jika seseorang tidak tahu, maka ini adalah <a href="https://alligator.io/react/react-router-ssr/" rel="nofollow">artikel yang</a> sangat baik tentang topik ini), kami akan membantu dengan cara yang sama mengekstraksi meta tag untuk halaman. <br><br>  Konsep umum adalah bahwa kita memiliki file konfigurasi untuk router - ini adalah struktur JS biasa, yang merupakan array objek, masing-masing berisi beberapa bidang tipe <i>komponen</i> , <i>path</i> .  Berdasarkan url permintaan, kami menemukan router dan komponen yang terkait dengannya dari file konfigurasi.  Untuk komponen-komponen ini, kami mendefinisikan sekumpulan metode statis seperti <i>loadData</i> dan, misalnya, <i>buat</i> Tag Tag untuk meta tag kami. <br><br>  Dengan demikian, komponen halaman itu sendiri akan menjadi seperti ini: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductPage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> createMetatags(store, request){ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> item = selectItem(store, request.params.product_id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [] .concat({<span class="hljs-attr"><span class="hljs-attr">property</span></span>: <span class="hljs-string"><span class="hljs-string">'og:description'</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: item.desc}) .concat({<span class="hljs-attr"><span class="hljs-attr">property</span></span>: <span class="hljs-string"><span class="hljs-string">'og:title'</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: item.title}) } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> loadData(store, request){ <span class="hljs-comment"><span class="hljs-comment">// extract external data for SSR and return Promise } // the rest of component }</span></span></code> </pre> <br>  Kami telah mendefinisikan metode createMetatags statis yang membuat set meta tag yang diperlukan.  Dengan mengingat hal ini, kode pada server akan menjadi seperti ini: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/*'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; {​​ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> matchedRoutes = matchRoutes(routes, request.path); <span class="hljs-comment"><span class="hljs-comment">// load app state await Promise.all( matchedRoutes.reduce((promises, { route }) =&gt; { return route.component.loadData ? promises.concat(route.component.loadData(store, req)) : promises; }, []) ); // to get metatags const metaTags = matchedRoutes.reduce((tags, {route}) =&gt; { return route.component.createMetatags ? tags.concat(route.component.createMetatags(store, req)): tags }); res.write(`​ &lt;html&gt;​ &lt;head&gt;​ ${ReactDOMServer.renderToString(() =&gt; metaTags.map(tag =&gt; &lt;meta {...tag}/&gt;) )}​​ &lt;/head&gt;​ &lt;body&gt;​ `);​ const stream = ReactDOMServer.renderToNodeStream(app);​ stream.pipe(response, { end: false });​ stream.on('end', () =&gt; response.end('&lt;/body&gt;&lt;/html&gt;'));​ });</span></span></code> </pre> <br>  Yaitu  Sekarang kita tidak perlu merender pohon Bereaksi dua kali - kita dapat segera mengekstraksi semua yang kita butuhkan untuk bekerja dari aplikasi isomorfik, dengan analogi dengan ekstraksi data untuk rute. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id484456/">https://habr.com/ru/post/id484456/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id484442/index.html">Contoh SNMPv3</a></li>
<li><a href="../id484444/index.html">Bagaimana kondisi operasi mempengaruhi baterai, atau kisah kebangkitan yang ajaib</a></li>
<li><a href="../id484446/index.html">Python 3.5 Menerapkan Concurrency Menggunakan asyncio</a></li>
<li><a href="../id484448/index.html">Konferensi DEFCON 27. Peretasan polisi. Bagian 1</a></li>
<li><a href="../id484454/index.html">Detektif Habra: fotomu hilang</a></li>
<li><a href="../id484458/index.html">Pekerja lepas ini rusak - beri saya yang berikutnya</a></li>
<li><a href="../id484462/index.html">Scraping Github: Mencari "Rahasia" untuk Dikembangkan</a></li>
<li><a href="../id484464/index.html">Lelang motor Jepang, bagaimana semua itu terjadi</a></li>
<li><a href="../id484466/index.html">Common JavaScript Menjanjikan Hal-Hal yang Harus Diketahui Semua Orang</a></li>
<li><a href="../id484468/index.html">Budaya perusahaan merah adalah masalah utama bisnis Rusia (Bagian 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>