<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õπüèΩ üíÜ üîÑ Aprendizaje autom√°tico para su caza plana. Parte 1 üçä ü§≥üèæ üë≤üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øAlguna vez has buscado un piso? ¬øLe gustar√≠a agregar algo de aprendizaje autom√°tico y hacer que un proceso sea m√°s interesante? 



 Hoy considerarem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprendizaje autom√°tico para su caza plana. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468053/"><p>  ¬øAlguna vez has buscado un piso?  ¬øLe gustar√≠a agregar algo de aprendizaje autom√°tico y hacer que un proceso sea m√°s interesante? </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/af/w7/7e/afw77esq32gd2e0admnmjfby4kk.png" alt="Apartamentos en Ekaterimburgo"></div><a name="habracut"></a><br><p>  Hoy consideraremos aplicar Machine Learning para encontrar un piso √≥ptimo. </p><br><h2 id="introduction">  Introduccion </h2><br><p> En primer lugar, quiero aclarar este momento y explicar qu√© significa "un piso √≥ptimo".  Es un piso con un conjunto de caracter√≠sticas diferentes como "√°rea", "distrito", "n√∫mero de balcones", etc.  Y para estas caracter√≠sticas del piso, esperamos un precio espec√≠fico.  Parece una funci√≥n que toma varios par√°metros y devuelve un n√∫mero.  O tal vez una caja negra que proporciona algo de magia. </p><br><p>  Pero ... hay un gran "pero", a veces puedes enfrentar un piso que es demasiado caro debido a una serie de razones, como una buena posici√≥n geogr√°fica.  Adem√°s, hay distritos m√°s prestigiosos en el centro de una ciudad y distritos fuera de la ciudad.  O ... a veces la gente quiere vender sus apartamentos porque se mudan a otro punto de la Tierra.  En otras palabras, hay muchos factores que pueden afectar el precio.  ¬øTe suena familiar? </p><br><h2 id="little-stepaside">  Peque√±o paso a un lado </h2><br><p>  Antes de continuar, d√©jame hacer una peque√±a digresi√≥n l√≠rica. <br>  Viv√≠ en Ekaterimburgo (la ciudad entre Europa y Asia, una de las ciudades que hab√≠a celebrado el Campeonato Mundial de F√∫tbol en 2018) durante 5 a√±os. </p><br><p>  Estaba enamorado de estas selvas de hormig√≥n.  Y odiaba esa ciudad por el invierno y el transporte p√∫blico.  Es una ciudad en crecimiento y cada mes se venden miles y miles de pisos. </p><br><p>  S√≠, es una ciudad superpoblada y contaminada.  Al mismo tiempo, es un buen lugar para analizar un mercado inmobiliario.  Recib√≠ muchos anuncios de pisos, de Internet.  Y utilizar√© esa informaci√≥n en mayor medida. </p><br><p>  Adem√°s, trat√© de visualizar diferentes ofertas en el mapa de Ekaterimburgo.  S√≠, es la imagen llamativa de habracut, hecha en Kepler.gl </p><br><p><img src="https://habrastorage.org/webt/af/w7/7e/afw77esq32gd2e0admnmjfby4kk.png" alt="imagen"></p><br><p>  Hay m√°s de 2 mil apartamentos de 1 habitaci√≥n que se vendieron en julio de 2019 en Ekaterimburgo.  Ten√≠an un precio diferente, de menos de un mill√≥n a casi 14 millones de rublos. </p><br><p>  Estos puntos se refieren a su posici√≥n geogr√°fica.  El color de los puntos en el mapa representa el precio, cuanto menor es el precio cercano al color azul, mayor es el precio cercano al rojo.  Puede considerarlo como una analog√≠a con colores fr√≠os y c√°lidos, el color m√°s c√°lido es el precio m√°s grande. <br>  Por favor, recuerda ese momento, cuanto m√°s rojo es el color, m√°s alto es el valor de algo.  La misma idea funciona para el azul pero en la direcci√≥n del precio m√°s bajo. </p><br><p>  Ahora tiene una visi√≥n <em>general</em> de la imagen y se acerca el momento de analizar. </p><br><h3 id="goal">  Gol </h3><br><p>  ¬øQu√© quer√≠a cuando viv√≠a en Ekaterimburgo?  Busqu√© un piso lo suficientemente bueno, o si hablamos en t√©rminos de ML, quer√≠a construir un modelo que me diera una recomendaci√≥n sobre la compra. </p><br><p>  Por un lado, si un piso tiene un precio excesivo, el modelo deber√≠a recomendar esperar a que disminuya el precio mostrando el precio esperado para ese piso. <br>  Por otro lado, si un precio es lo suficientemente bueno, seg√∫n el estado del mercado, tal vez deber√≠a considerar esa oferta. </p><br><p>  Por supuesto, no hay nada ideal y estaba listo para aceptar un error en los c√°lculos.  Por lo general, para este tipo de tarea, use el error medio de predicci√≥n y estaba listo para un error del 10%.  Por ejemplo, si tiene 2-3 millones de rublos rusos, puede ignorar el error en 200-300 mil, puede permit√≠rselo.  Como me pareci√≥ a m√≠. </p><br><h2 id="preparing">  Preparar </h2><br><p>  Como mencion√© antes, hab√≠a muchos apartamentos, echemos un vistazo de cerca. <br>  importar pandas como pd </p><br><pre><code class="python hljs">df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'flats.csv'</span></span>) df.shape</code> </pre> <br><p><img src="https://habrastorage.org/webt/qx/_0/qg/qx_0qgrsiuprxgsbno2ccihjdia.png" alt="imagen"></p><br><p>  2310 pisos por un mes, podr√≠amos extraer algo √∫til de eso.  ¬øQu√© pasa con una descripci√≥n general de datos? </p><br><pre> <code class="python hljs">df.describe()</code> </pre> <br><p><img src="https://habrastorage.org/webt/is/pi/tj/ispitjyk3gpg-cbkhwfwnrayloa.png" alt="imagen"><br>  No hay algo extraordinario: longitud, latitud, precio de un piso (la etiqueta " <em>costo</em> "), etc.  S√≠, para ese momento us√© " <em>costo</em> " en lugar de " <em>precio</em> ", espero que no conduzca a malentendidos, consid√©relos como iguales. </p><br><h2 id="cleaning">  Limpieza </h2><br><p>  ¬øTodos los registros tienen el mismo significado?  Algunos de ellos son pisos representados como un cub√≠culo, puedes trabajar all√≠, pero no te gustar√≠a vivir all√≠.  Son habitaciones peque√±as y estrechas, no un piso real.  Deja eliminarlos. </p><br><pre> <code class="python hljs">df = df[df.total_area &gt;= <span class="hljs-number"><span class="hljs-number">20</span></span>]</code> </pre> <br><p>  El precio de predicci√≥n de piso proviene de los problemas m√°s antiguos en econom√≠a y campos relacionados.  No hab√≠a nada relacionado con el t√©rmino "ML" y la gente trat√≥ de adivinar el precio basado en metros cuadrados / pies. <br>  Entonces, miramos estas columnas / etiquetas e intentamos obtener la distribuci√≥n de ellas. </p><br><pre> <code class="python hljs">numerical_fields = [<span class="hljs-string"><span class="hljs-string">'total_area'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> numerical_fields: mask = ~np.isnan(df[col]) sns.distplot(df[col][mask], color=<span class="hljs-string"><span class="hljs-string">"r"</span></span>,label=col) plot.show()</code> </pre> <br><p><img src="https://habrastorage.org/webt/w2/kj/eq/w2kjeqg-gr-qzcum6hcgqnoz6eo.png" alt="imagen"></p><br><p>  Bueno ... no hay nada especial, parece una distribuci√≥n normal.  Tal vez tenemos que ir m√°s profundo? </p><br><pre> <code class="python hljs">sns.pairplot(df[numerical_fields])</code> </pre> <br><p><img src="https://habrastorage.org/webt/df/fw/lg/dffwlggd_vemlbfl96qdw-0h3fw.png" alt="imagen"></p><br><p>  Vaya ... hay algo mal ah√≠.  Limpie los valores at√≠picos en estos campos e intente analizar nuestros datos nuevamente. </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#Remove outliers df = df[abs(df.total_area - df.total_area.mean()) &lt;= (3 * df.total_area.std())] df = df[abs(df.cost - df.cost.mean()) &lt;= (3 * df.cost.std())] #Redraw our data sns.pairplot(df[numerical_fields])</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/uu/zp/ok/uuzpokfgmae_4d2bxqvsmp53jns.png" alt="imagen"></p><br><p>  Los valores at√≠picos se han ido, y ahora se ve mejor. </p><br><h2 id="transformation">  Transformaci√≥n </h2><br><p>  La etiqueta "a√±o", que apunta a un a√±o de construcci√≥n, debe transformarse en algo m√°s informativo.  Que sea la edad de la construcci√≥n, en otras palabras, la antig√ºedad de una casa espec√≠fica. </p><br><pre> <code class="python hljs">df[<span class="hljs-string"><span class="hljs-string">'age'</span></span>] = <span class="hljs-number"><span class="hljs-number">2019</span></span> -df[<span class="hljs-string"><span class="hljs-string">'year'</span></span>]</code> </pre> <br><p>  Echemos un vistazo al resultado. </p><br><pre> <code class="python hljs">df.head()</code> </pre> <br><p><img src="https://habrastorage.org/webt/wq/j_/h-/wqj_h-w8jwshp3fi0ofyhhuanca.png" alt="imagen"></p><br><p>  Hay todo tipo de datos, categ√≥ricos, valores nanom√©tricos, descripciones de texto y cierta informaci√≥n geogr√°fica (longitud y latitud).  Dejemos a un lado los √∫ltimos porque en ese escenario son in√∫tiles.  Volveremos a ellos m√°s tarde. </p><br><pre> <code class="python hljs">df.drop(columns=[<span class="hljs-string"><span class="hljs-string">"lon"</span></span>,<span class="hljs-string"><span class="hljs-string">"lat"</span></span>,<span class="hljs-string"><span class="hljs-string">"description"</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><h3 id="categorical-data">  Datos categ√≥ricos </h3><br><p>  Por lo general, para los datos categ√≥ricos, las personas usan diferentes tipos de codificaci√≥n o cosas como CatBoost que brindan la oportunidad de trabajar con ellos como con variables num√©ricas. <br>  Pero, ¬øpodr√≠amos usar algo m√°s l√≥gico y m√°s intuitivo?  Ahora es el momento de hacer que nuestros datos sean m√°s comprensibles sin perder el significado de ellos. </p><br><h3 id="districts">  Distritos </h3><br><p>  Bueno, hay m√°s de veinte distritos posibles, ¬øpodr√≠amos agregar m√°s de 20 variables adicionales en nuestro modelo?  Por supuesto, podr√≠amos, pero ... ¬ødeber√≠amos?  Somos personas y podr√≠amos comparar cosas, ¬øno? <br>  En primer lugar, no todos los distritos son equivalentes a otros.  En el centro de la ciudad, los precios de un metro cuadrado son m√°s altos, m√°s lejos del centro de la ciudad, se vuelve a bajar.  ¬øSuena l√≥gico?  ¬øPodr√≠amos usar eso? <br>  S√≠, definitivamente podr√≠amos igualar cualquier distrito con un coeficiente espec√≠fico y el distrito adicional es el de los pisos m√°s baratos. </p><br><p>  Despu√©s de hacer coincidir la ciudad y usar otro mapa de servicios web (ArcGIS Online) cambi√≥ y tiene una vista similar <br><img src="https://habrastorage.org/webt/ji/a6/sw/jia6swan_kxipvxp4y2p1ycfqk4.png" alt="imagen"></p><br><p>  Us√© la misma idea que para la visualizaci√≥n de flat.  El distrito m√°s "prestigioso" y "caro" coloreado en rojo y el menos azul.  Una temperatura de color, ¬ølo recuerdas? <br>  Adem√°s, deber√≠amos hacer alguna manipulaci√≥n sobre nuestro marco de datos. </p><br><pre> <code class="python hljs">district_map = {<span class="hljs-string"><span class="hljs-string">'alpha'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'beta'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, ... <span class="hljs-string"><span class="hljs-string">'delta'</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>, ... <span class="hljs-string"><span class="hljs-string">'epsilon'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} df.district = df.district.str.lower() df.replace({<span class="hljs-string"><span class="hljs-string">"district"</span></span>: district_map}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Se utilizar√° el mismo enfoque para describir la calidad interna del piso.  A veces necesita alguna reparaci√≥n, a veces el piso est√° bastante bien y listo para vivir.  Y en otros casos, debe gastar dinero adicional para que se vea mejor (cambiar grifos, pintar paredes).  Tambi√©n podr√≠a haber coeficientes de uso. </p><br><pre> <code class="python hljs">repair = {<span class="hljs-string"><span class="hljs-string">'A'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>: <span class="hljs-number"><span class="hljs-number">0.6</span></span>, <span class="hljs-string"><span class="hljs-string">'C'</span></span>: <span class="hljs-number"><span class="hljs-number">0.7</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>} df.repair.fillna(<span class="hljs-string"><span class="hljs-string">'D'</span></span>, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df.replace({<span class="hljs-string"><span class="hljs-string">"repair"</span></span>: repair}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Por cierto, sobre muros.  Por supuesto, tambi√©n influye en el precio del piso.  El material moderno es mejor que el anterior, el ladrillo es mejor que el concreto.  Las paredes de madera son un momento bastante controvertido, quiz√°s sea una buena opci√≥n para el campo, pero no tan bueno para la vida urbana. </p><br><p>  Usamos el mismo enfoque que antes, adem√°s de hacer una sugerencia sobre filas que no sabemos nada.  S√≠, a veces las personas no proporcionan toda la informaci√≥n sobre su piso.  Adem√°s, seg√∫n la historia, podemos intentar adivinar el material de las paredes.  En un per√≠odo de tiempo espec√≠fico (por ejemplo, el per√≠odo de liderazgo de Jruschov), conocemos el material t√≠pico para la construcci√≥n. </p><br><pre> <code class="python hljs">walls_map = {<span class="hljs-string"><span class="hljs-string">'brick'</span></span>: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, ... <span class="hljs-string"><span class="hljs-string">'concrete'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, <span class="hljs-string"><span class="hljs-string">'block'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, ... <span class="hljs-string"><span class="hljs-string">'monolith'</span></span>: <span class="hljs-number"><span class="hljs-number">0.9</span></span>, <span class="hljs-string"><span class="hljs-string">'wood'</span></span>: <span class="hljs-number"><span class="hljs-number">0.4</span></span>} mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">2010</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'monolith'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">2000</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'concrete'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">1990</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'block'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'block'</span></span> df.replace({<span class="hljs-string"><span class="hljs-string">"walls"</span></span>: walls_map}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'year'</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Adem√°s, hay informaci√≥n sobre el balc√≥n.  En mi humilde opini√≥n, el balc√≥n es algo realmente √∫til, por lo que no pude evitar considerarlo. <br>  Desafortunadamente, hay algunos valores nulos.  Si el autor de un anuncio hubiera verificado la informaci√≥n al respecto, tendr√≠amos informaci√≥n m√°s realista. <br>  Bueno, si no hay informaci√≥n significar√° "no hay un balc√≥n". </p><br><pre> <code class="python hljs">df.balcony.fillna(<span class="hljs-number"><span class="hljs-number">0</span></span>,inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Despu√©s de eso, soltamos columnas con informaci√≥n sobre el a√±o de construcci√≥n (tenemos una buena alternativa para ello).  Adem√°s, eliminamos la columna con informaci√≥n sobre el tipo de edificio porque tiene muchos valores de NaN y no he encontrado ninguna oportunidad para llenar estos vac√≠os.  Y soltamos todas las filas con NaN que tenemos. </p><br><pre> <code class="python hljs">df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'type_house'</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df = df.astype(np.float64) df.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><h2 id="checking">  Comprobando </h2><br><p>  Entonces ... usamos un enfoque no est√°ndar y reemplazamos los valores categ√≥ricos a su representaci√≥n num√©rica.  Y ahora terminamos con una transformaci√≥n de nuestros datos. <br>  Se ha descartado una parte de los datos, pero en general es un conjunto de datos bastante bueno.  Veamos la correlaci√≥n entre variables independientes. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show_correlation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(df)</span></span></span><span class="hljs-function">:</span></span> sns.set(style=<span class="hljs-string"><span class="hljs-string">"whitegrid"</span></span>) corr = df.corr() * <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-comment"><span class="hljs-comment"># Select upper triangle of correlation matrix mask = np.zeros_like(corr, dtype=np.bool) mask[np.triu_indices_from(mask)] = True # Set up the matplotlib figure f, ax = plt.subplots(figsize=(15, 11)) # Generate a custom diverging colormap cmap = sns.diverging_palette(220, 10) # Draw the heatmap with the mask and correct aspect ratio sns.heatmap(corr, mask=mask, cmap=cmap, center=0, linewidths=1, cbar_kws={"shrink": .7}, annot=True, fmt=".2f") plot.show() # df[columns] = scale(df[columns]) return df df1 = show_correlation(df.drop(columns=['cost']))</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/ht/dv/ir/htdvirxheiytace3nmaujf3wet8.png" alt="imagen"></p><br><p>  Erm ... se volvi√≥ muy interesante. <br>  <strong>Correlaci√≥n positiva</strong> <br>  <em>√Årea total - balcones</em> .  Por que no  Si nuestro piso es grande habr√° un balc√≥n. <br>  <strong>Correlaci√≥n negativa</strong> <br>  <em>√Årea total - edad</em> .  Cuanto m√°s nuevo es plano, m√°s grande es un √°rea para vivir.  Suena l√≥gico, los nuevos son planos m√°s espaciosos que los antiguos. <br>  <em>Edad - balc√≥n</em> .  Cuanto m√°s viejo es plano, menos balcones tiene.  Parece una correlaci√≥n a trav√©s de otra variable.  Quiz√°s es un tri√°ngulo Edad-Balc√≥n-√Årea donde una variable tiene una influencia impl√≠cita sobre otra.  Poner eso en espera por un tiempo. <br>  <em>Edad - distrito.</em>  El piso m√°s antiguo es la gran probabilidad que se colocar√° en los distritos m√°s prestigiosos.  ¬øPodr√≠a estar relacionado con un precio m√°s alto cerca del centro? </p><br><p>  Adem√°s, pudimos ver la correlaci√≥n con la variable dependiente </p><br><pre> <code class="python hljs">plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>)) corr = df.corr()*<span class="hljs-number"><span class="hljs-number">100.0</span></span> sns.heatmap(corr[[<span class="hljs-string"><span class="hljs-string">'cost'</span></span>]], cmap= sns.diverging_palette(<span class="hljs-number"><span class="hljs-number">220</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), center=<span class="hljs-number"><span class="hljs-number">0</span></span>, linewidths=<span class="hljs-number"><span class="hljs-number">1</span></span>, cbar_kws={<span class="hljs-string"><span class="hljs-string">"shrink"</span></span>: <span class="hljs-number"><span class="hljs-number">.7</span></span>}, annot=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, fmt=<span class="hljs-string"><span class="hljs-string">".2f"</span></span>)</code> </pre> <br><p><img src="https://habrastorage.org/webt/o7/ax/m1/o7axm1zph-x3eterypsfcod38zo.png" alt="imagen"></p><br><p>  Aqu√≠ vamos ... </p><br><p>  La correlaci√≥n muy fuerte entre el √°rea de piso y el precio.  Si desea tener un lugar m√°s grande para vivir, necesitar√° m√°s dinero. <br>  Existe una correlaci√≥n negativa entre los pares " <em>edad / costo</em> " y " <em>distrito / costo</em> ".  Un piso en una casa m√°s nueva menos accesible que la anterior.  Y en el campo los pisos son m√°s baratos. <br>  De todos modos, parece claro y comprensible, as√≠ que decid√≠ ir con eso. </p><br><h2 id="model">  Modelo </h2><br><p>  Para tareas relacionadas con el precio de la predicci√≥n plana, usualmente, use la regresi√≥n lineal.  Seg√∫n una correlaci√≥n significativa de una etapa anterior, podr√≠amos intentar usarla tambi√©n.  Es un caballo de batalla adecuado para muchas tareas. <br>  Prepare nuestros datos para las pr√≥ximas acciones. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split y = df.cost X = df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'cost'</span></span>]) X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number"><span class="hljs-number">0.2</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">42</span></span>)</code> </pre> <br><p>  Adem√°s, creamos algunas funciones simples para la predicci√≥n y evaluaci√≥n del resultado.  ¬°Hagamos nuestro primer intento de predecir el precio! </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y_test, model)</span></span></span><span class="hljs-function">:</span></span> y = model.predict(X) score = round((r2_score(y_test, y) * <span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>) print(<span class="hljs-string"><span class="hljs-string">f'Score on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{model.__class__.__name__}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{score}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y, regressor)</span></span></span><span class="hljs-function">:</span></span> model = regressor.fit(X, y) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.linear_model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LinearRegression regressor = LinearRegression() model = train_model(X_train, y_train, regressor) predict(X_test, y_test, model)</code> </pre> <br><p><img src="https://habrastorage.org/webt/ak/v3/_a/akv3_antf7wwaxndcpjwx90rvju.png" alt="imagen"></p><br><p>  Bueno ... 76,67% de precisi√≥n.  ¬øEs un gran n√∫mero o no?  Seg√∫n mi punto de vista, no est√° mal.  Adem√°s, es un buen punto de partida.  Por supuesto, no es lo ideal, y existe un potencial de mejora. </p><br><p>  Al mismo tiempo, tratamos de predecir solo una parte de los datos.  ¬øQu√© pasa con la aplicaci√≥n de la misma estrategia para otros datos?  S√≠, hora de validaci√≥n cruzada. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_cross_validation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y, model)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> KFold, cross_val_score regressor_name = model.__class__.__name__ fold = KFold(n_splits=<span class="hljs-number"><span class="hljs-number">10</span></span>, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">0</span></span>) scores_on_this_split = cross_val_score(estimator=model, X=X, y=y, cv=fold, scoring=<span class="hljs-string"><span class="hljs-string">'r2'</span></span>) scores_on_this_split = np.round(scores_on_this_split * <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) mean_accuracy = scores_on_this_split.mean() print(<span class="hljs-string"><span class="hljs-string">f'Crossvaladaion accuracy on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{model.__class__.__name__}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{mean_accuracy}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mean_accuracy do_cross_validation(X, y, model)</code> </pre> <br><p><img src="https://habrastorage.org/webt/yn/uf/3y/ynuf3yr9ew4kgjrvnb-nifevbnq.png" alt="imagen"></p><br><p>  El resultado de la validaci√≥n cruzada Ahora tomamos otro resultado.  73 es menor que 76. Pero tambi√©n es un buen candidato hasta el momento en que tengamos uno mejor.  Adem√°s, significa que una regresi√≥n lineal funciona bastante estable en nuestro conjunto de datos. </p><br><p>  Y ahora es el momento del √∫ltimo paso. </p><br><p>  Veremos la mejor caracter√≠stica de la regresi√≥n lineal: la <strong>interpretabilidad</strong> . <br>  Esta familia de modelos, a diferencia de los m√°s complejos, tiene una mejor capacidad de comprensi√≥n.  Solo hay algunos n√∫meros con coeficientes y puedes poner tus n√∫meros en la ecuaci√≥n, hacer algunas matem√°ticas simples y obtener un resultado. </p><br><p>  Tratemos de interpretar nuestro modelo. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">estimate_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(model)</span></span></span><span class="hljs-function">:</span></span> sns.set(style=<span class="hljs-string"><span class="hljs-string">"white"</span></span>, context=<span class="hljs-string"><span class="hljs-string">"talk"</span></span>) f, ax = plot.subplots(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), sharex=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) sns.barplot(x=model.coef_, y=X.columns, palette=<span class="hljs-string"><span class="hljs-string">"vlag"</span></span>, ax=ax) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(model.coef_.astype(int)): ax.text(v + <span class="hljs-number"><span class="hljs-number">3</span></span>, i + <span class="hljs-number"><span class="hljs-number">.25</span></span>, str(v), color=<span class="hljs-string"><span class="hljs-string">'black'</span></span>) ax.set_title(<span class="hljs-string"><span class="hljs-string">f"Coefficients"</span></span>) estimate_model(regressor)</code> </pre> <br><p><img src="https://habrastorage.org/webt/1j/bc/_a/1jbc_apacascsr3cakmwz4qbnu8.png" alt="Los coeficientes de nuestro modelo"></p><br><p>  La imagen se ve bastante l√≥gica.  <em>Balc√≥n / Paredes / √Årea / Reparaci√≥n</em> dan una contribuci√≥n <strong>positiva</strong> a un precio fijo. <br>  Cuanto m√°s plano es, mayor es una <strong>contribuci√≥n negativa</strong> .  Tambi√©n aplicable para la edad.  El piso m√°s antiguo es el precio m√°s bajo. </p><br><p>  Entonces, fue un viaje fascinante. <br>  Comenzamos desde cero, usamos el enfoque at√≠pico para la transformaci√≥n de datos basado en el punto de vista humano (n√∫meros en lugar de variables ficticias), variables verificadas y su relaci√≥n entre s√≠.  Despu√©s de eso, creamos nuestro modelo simple, utilizamos la validaci√≥n cruzada para probarlo.  Y como guinda del pastel: mire las partes internas del modelo, lo que nos da confianza sobre nuestro camino. </p><br><p>  Pero!  No es el final de nuestro viaje, sino solo un descanso.  Intentaremos cambiar nuestro modelo en el futuro y tal vez (solo tal vez) aumente la precisi√≥n de la predicci√≥n. </p><br><p>  <strong>Gracias por leer!</strong> </p><br><blockquote>  La segunda parte esta <br></blockquote><p>  PD Los datos de origen y el port√°til Ipython se encuentran <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">all√≠.</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/468053/">https://habr.com/ru/post/468053/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../468041/index.html">Anuncio de la interfaz web de Kubernetes Web View (y una breve descripci√≥n de otras IU web para Kubernetes)</a></li>
<li><a href="../468043/index.html">C√≥mo crear un kit de interfaz de usuario que est√© a la venta. Etapas del desarrollo de un sistema de dise√±o comercial.</a></li>
<li><a href="../468047/index.html">Trabajando con jerarqu√≠as en lsFusion</a></li>
<li><a href="../468049/index.html">Uso de werf para desplegar gr√°ficos complejos de Helm</a></li>
<li><a href="../468051/index.html">VDS con Windows Server con licencia por 100 rublos: ¬ømito o realidad?</a></li>
<li><a href="../468057/index.html">Desarrollo de sistema operativo tipo Unix: multitarea y llamadas al sistema (7)</a></li>
<li><a href="../468059/index.html">Mi segunda semana con Haiku: muchos diamantes escondidos y sorpresas agradables, as√≠ como algunos problemas</a></li>
<li><a href="../468061/index.html">Cron en Linux: historia, uso y dispositivo</a></li>
<li><a href="../468063/index.html">Angulareact</a></li>
<li><a href="../468065/index.html">Modelos de gesti√≥n mental de productos para todos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>