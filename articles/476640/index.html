<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëßüèΩ üë∏üèæ üí£ Protecci√≥n de Zimbra OSE de la fuerza bruta y los ataques DoS üë©üèΩ‚Äçü§ù‚Äçüë®üèª üõ†Ô∏è üé©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zimbra Collaboration Suite Open-Source Edition tiene en su arsenal varias herramientas poderosas para garantizar la seguridad de la informaci√≥n. Entre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Protecci√≥n de Zimbra OSE de la fuerza bruta y los ataques DoS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/zimbra/blog/476640/">  Zimbra Collaboration Suite Open-Source Edition tiene en su arsenal varias herramientas poderosas para garantizar la seguridad de la informaci√≥n.  Entre ellos, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Postscreen</a> es una soluci√≥n para proteger el servidor de correo de ataques de botnets, ClamAV es un antivirus que puede escanear archivos entrantes y cartas en busca de infecciones de malware, y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SpamAssassin</a> es uno de los mejores filtros de spam hasta la fecha.  Sin embargo, estas herramientas no pueden proteger el OSE de Zimbra de una forma de ataque como la fuerza bruta.  No es la enumeraci√≥n de contrase√±as m√°s elegante, pero a√∫n bastante efectiva, en un diccionario especial est√° cargada no solo con la probabilidad de un pirateo exitoso con todas las consecuencias resultantes, sino tambi√©n con la creaci√≥n de una carga significativa en el servidor, que procesa todos los intentos fallidos de piratear el servidor con Zimbra OSE. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e98/93d/7d9/e9893d7d9f995c2a24dce02df7fa5d51.png" alt="imagen"><br><a name="habracut"></a><br>  En principio, puede protegerse de la fuerza bruta utilizando las herramientas est√°ndar de Zimbra OSE.  La configuraci√≥n de la pol√≠tica de seguridad de contrase√±a le permite establecer el n√∫mero de intentos fallidos de contrase√±a, despu√©s de lo cual se bloquea la cuenta potencialmente atacada.  El principal problema con este enfoque es que surgen situaciones en las que las cuentas de uno o m√°s empleados pueden bloquearse debido a un ataque de fuerza bruta, a lo que no tienen nada que hacer, y el trabajo simple resultante de los empleados puede traer grandes p√©rdidas a la empresa.  Es por eso que esta opci√≥n de protecci√≥n contra la fuerza bruta es mejor no aplicar. <br><br><img src="https://habrastorage.org/webt/gz/cn/kg/gzcnkguoq2isuxplbgetg-y1ft4.png"><br><br>  Para protegerse contra la fuerza bruta, una herramienta especial llamada DoSFilter es mucho mejor, que est√° integrada en Zimbra OSE y puede desconectarse autom√°ticamente de Zimbra OSE a trav√©s de HTTP.  En otras palabras, el principio de funcionamiento de DoSFilter es similar al principio de funcionamiento de PostScreen, que solo se utiliza para otro protocolo.  Originalmente dise√±ado para limitar el n√∫mero de acciones que puede realizar un solo usuario, DoSFilter tambi√©n puede proporcionar protecci√≥n contra la fuerza bruta.  Su diferencia clave con la herramienta incorporada en Zimbra es que despu√©s de un cierto n√∫mero de intentos fallidos, no bloquea al usuario, sino la direcci√≥n IP desde la cual se realizan m√∫ltiples intentos para iniciar sesi√≥n en una u otra cuenta.  Gracias a esto, el administrador del sistema no solo puede protegerse de la fuerza bruta, sino tambi√©n evitar bloquear a los empleados de la compa√±√≠a simplemente agregando la red interna de su compa√±√≠a a la lista de direcciones IP y subredes de confianza. <br><br>  La gran ventaja de DoSFilter es que, adem√°s de los numerosos intentos de iniciar sesi√≥n en una u otra cuenta, con esta herramienta puede bloquear autom√°ticamente a los ciberdelincuentes que tomaron posesi√≥n de los datos de autenticaci√≥n del empleado, y luego inici√≥ sesi√≥n con √©xito en su cuenta y comenz√≥ a enviar cientos de solicitudes al servidor. <br><br>  Puede configurar DoSFilter utilizando los siguientes comandos de la consola: <br><br><ul><li>  <b>zimbraHttpDosFilterMaxRequestsPerSec</b> : con este comando puede establecer el n√∫mero m√°ximo de conexiones permitidas para un usuario.  Por defecto, este valor es de 30 conexiones. </li><li>  <b>zimbraHttpDosFilterDelayMillis</b> : con este comando, puede establecer el retraso en milisegundos para las conexiones que exceden el l√≠mite establecido por el comando anterior.  Adem√°s de los valores enteros, el administrador puede especificar 0 para que no haya ning√∫n retraso, y tambi√©n -1 para que todas las conexiones que excedan el l√≠mite especificado simplemente se interrumpan.  Por defecto, este valor es -1. </li><li>  <b>zimbraHttpThrottleSafeIPs</b> : con este comando, el administrador puede especificar direcciones IP y subredes confiables que no se ver√°n afectadas por las restricciones anteriores.  Tenga en cuenta que la sintaxis de este comando puede variar seg√∫n el resultado deseado.  Entonces, por ejemplo, al ingresar el comando <b>zmprov mcf zimbraHttpThrottleSafeIPs 127.0.0.1</b> , reescribe completamente la lista completa y deja solo una direcci√≥n IP en ella.  Si ingresa el comando <b>zmprov mcf + zimbraHttpThrottleSafeIPs 127.0.0.1</b> , la direcci√≥n IP que ingres√≥ se agregar√° a la lista blanca.  Del mismo modo, utilizando un signo de resta, puede eliminar cualquier IP de la lista de permitidos. </li></ul><br>  Tenga en cuenta que DoSFilter puede causar una serie de problemas al usar las extensiones de Zextras Suite Pro.  Para evitarlos, recomendamos aumentar el n√∫mero de conexiones simult√°neas de 30 a 100 utilizando el comando <b>zmprov mcf zimbraHttpDosFilterMaxRequestsPerSec 100</b> .  Adem√°s, recomendamos agregar la red interna de la empresa a la lista de permitidos.  Esto se puede hacer usando el comando <b>zmprov mcf + zimbraHttpThrottleSafeIPs 192.168.0.0/24</b> .  Despu√©s de realizar cualquier cambio en DoSFilter, aseg√∫rese de reiniciar el servidor de correo utilizando el comando <b>zmmailboxdctl restart</b> . <br><br>  La principal desventaja de DoSFilter es que funciona a nivel de aplicaci√≥n y, por lo tanto, solo puede limitar la capacidad de los atacantes para realizar diversas acciones en el servidor, sin limitar la capacidad de conectarse al norte.  Debido a esto, las solicitudes de autenticaci√≥n o env√≠o de cartas enviadas al servidor, aunque obviamente son fallas, seguir√°n siendo un buen ataque DoS antiguo, que no se puede detener a un nivel tan alto. <br><br>  Para asegurar completamente su servidor corporativo con Zimbra OSE, puede usar una soluci√≥n como Fail2ban, que es un marco capaz de monitorear constantemente los registros del sistema de informaci√≥n para acciones repetidas y bloquear al atacante cambiando la configuraci√≥n del firewall.  El bloqueo a un nivel tan bajo le permite deshabilitar a los atacantes justo en la etapa de conexi√≥n IP al servidor.  Por lo tanto, Fail2Ban puede complementar perfectamente la protecci√≥n construida con DoSFilter.  Veamos c√≥mo puede hacerse amigo de Fail2Ban con Zimbra OSE y, de este modo, aumentar la seguridad de la infraestructura de TI de su empresa. <br><br>  Al igual que cualquier otra aplicaci√≥n de clase empresarial, Zimbra Collaboration Suite Open-Source Edition mantiene registros detallados de su trabajo.  La mayor√≠a de ellos se almacenan en la carpeta <b>/ opt / zimbra / log /</b> como archivos.  Estos son solo algunos de ellos: <br><br><ul><li>  buz√≥n.log - Registros del servicio de correo Jetty </li><li>  audit.log - registros de autenticaci√≥n </li><li>  clamd.log - registros de antivirus </li><li>  freshclam.log - registros de actualizaciones de antivirus </li><li>  convertd.log - registros del convertidor de archivos adjuntos </li><li>  zimbrastats.csv - registros de rendimiento del servidor </li></ul><br>  Los registros de Zimbra tambi√©n se pueden encontrar en el archivo <b>/var/log/zimbra.log</b> , donde se mantienen los registros de Postfix y Zimbra. <br><br>  Para proteger nuestro sistema de la fuerza bruta, supervisaremos <b>buz√≥n.log</b> , <b>audit.log</b> y <b>zimbra.log</b> . <br><br>  Para que todo funcione, es necesario que Fail2Ban e iptables est√©n instalados en su servidor con Zimbra OSE.  Si usa Ubuntu, puede hacerlo usando los <b>comandos dpkg -s fail2ban</b> , pero si usa CentOS, puede verificar esto usando los <b>comandos de fail2ban instalados en la lista yum</b> .  En el caso de que no tenga instalado Fail2Ban, instalarlo no ser√° un problema, ya que este paquete se encuentra en casi todos los repositorios est√°ndar. <br><br>  Despu√©s de instalar todo el software necesario, puede proceder a configurar Fail2Ban.  Para hacer esto, cree un archivo de configuraci√≥n <b>/etc/fail2ban/filter.d/zimbra.conf</b> , en el que escribamos expresiones regulares para los registros de Zimbra OSE que corresponder√°n a intentos de inicio de sesi√≥n incorrectos y activar√°n mecanismos Fail2Ban.  Aqu√≠ hay un ejemplo del contenido de zimbra.conf con un conjunto de expresiones regulares correspondientes a varios errores generados por Zimbra OSE cuando falla un intento de autenticaci√≥n: <br><br><pre><code class="plaintext hljs"># Fail2Ban configuration file [Definition] failregex = \[ip=&lt;HOST&gt;;\] account - authentication failed for .* \(no such account\)$ \[ip=&lt;HOST&gt;;\] security - cmd=Auth; .* error=authentication failed for .*, invalid password;$ ;oip=&lt;HOST&gt;;.* security - cmd=Auth; .* protocol=soap; error=authentication failed for .* invalid password;$ ;oip=&lt;HOST&gt;;.* security - cmd=Auth; .* protocol=imap; error=authentication failed for .* invalid password;$ \[oip=&lt;HOST&gt;;.* SoapEngine - handler exception: authentication failed for .*, account not found$ WARN .*;ip=&lt;HOST&gt;;ua=ZimbraWebClient .* security - cmd=AdminAuth; .* error=authentication failed for .*;$ ignoreregex =</code> </pre> <br>  Despu√©s de compilar las expresiones regulares para Zimbra OSE, es hora de comenzar a editar la configuraci√≥n de Fail2ban.  La configuraci√≥n de esta utilidad se encuentra en el archivo <b>/etc/fail2ban/jail.conf</b> .  Por si acaso, lo haremos con el comando <b>cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.conf.bak</b> .  Despu√©s de eso, llevemos este archivo al siguiente formulario: <br><br><pre> <code class="plaintext hljs"># Fail2Ban configuration file [DEFAULT] ignoreip = 192.168.0.1/24 bantime = 600 findtime = 600 maxretry = 5 backend = auto [ssh-iptables] enabled = false filter = sshd action = iptables[name=SSH, port=ssh, protocol=tcp] sendmail-whois[name=SSH, dest=admin@company.ru, sender=fail2ban@company.ru] logpath = /var/log/messages maxretry = 5 [sasl-iptables] enabled = false filter = sasl backend = polling action = iptables[name=sasl, port=smtp, protocol=tcp] sendmail-whois[name=sasl, dest=support@company.ru] logpath = /var/log/zimbra.log [ssh-tcpwrapper] enabled = false filter = sshd action = hostsdeny sendmail-whois[name=SSH, dest=support@ company.ru] ignoreregex = for myuser from logpath = /var/log/messages [zimbra-account] enabled = true filter = zimbra action = iptables-allports[name=zimbra-account] sendmail[name=zimbra-account, dest=support@company.ru ] logpath = /opt/zimbra/log/mailbox.log bantime = 600 maxretry = 5 [zimbra-audit] enabled = true filter = zimbra action = iptables-allports[name=zimbra-audit] sendmail[name=Zimbra-audit, dest=support@company.ru] logpath = /opt/zimbra/log/audit.log bantime = 600 maxretry = 5 [zimbra-recipient] enabled = true filter = zimbra action = iptables-allports[name=zimbra-recipient] sendmail[name=Zimbra-recipient, dest=support@company.ru] logpath = /var/log/zimbra.log bantime = 172800 maxretry = 5 [postfix] enabled = true filter = postfix action = iptables-multiport[name=postfix, port=smtp, protocol=tcp] sendmail-buffered[name=Postfix, dest=support@company.ru] logpath = /var/log/zimbra.log bantime = -1 maxretry = 5</code> </pre> <br>  Aunque este ejemplo es bastante universal, vale la pena explicar algunos par√°metros que quiz√°s desee cambiar al configurar Fail2Ban usted mismo: <br><br><ul><li>  <b>Ignoreip</b> : con este par√°metro puede especificar una IP o subred espec√≠fica, la direcci√≥n desde la cual Fail2Ban no debe verificar.  Por lo general, la red interna de la empresa y otras direcciones confiables se agregan a la lista ignorada. </li><li>  <b>Bantime</b> : el tiempo durante el cual el intruso prohibir√°.  Medido en segundos.  Un valor de -1 significa una prohibici√≥n ilimitada. </li><li>  <b>Maxretry</b> : la cantidad m√°xima de veces que una direcci√≥n IP puede intentar acceder al servidor. </li><li>  <b>Sendmail</b> : una configuraci√≥n que le permite enviar autom√°ticamente alertas por correo electr√≥nico sobre el funcionamiento de Fail2Ban. </li><li>  <b>Findtime</b> : una configuraci√≥n que le permite establecer el intervalo de tiempo despu√©s del cual la direcci√≥n IP puede volver a intentar acceder al servidor despu√©s de que se haya agotado el n√∫mero m√°ximo de intentos fallidos (par√°metro maxretry) </li></ul><br>  Despu√©s de guardar el archivo con la configuraci√≥n de Fail2Ban, solo queda reiniciar esta utilidad con el <b>comando service fail2ban restart</b> .  Despu√©s del reinicio, los registros principales de Zimbra comenzar√°n a monitorearse constantemente para verificar el cumplimiento de las expresiones regulares.  Gracias a esto, el administrador podr√° eliminar virtualmente cualquier posibilidad de que un atacante penetre no solo en los buzones de Zimbra Collaboration Suite Open-Source Edition, sino que tambi√©n proteja todos los servicios que se ejecutan dentro del Zimbra OSE, as√≠ como tambi√©n estar√° al tanto de cualquier intento de obtener acceso no autorizado. <br><br>  Para todas las preguntas relacionadas con la Suite Zextras, puede contactar al representante de la empresa "Zextras" Ekaterina Triandafilidi por correo electr√≥nico katerina@zextras.com </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/476640/">https://habr.com/ru/post/476640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../476620/index.html">SP701 + PCAM-5C + 15 minutos + VITIS = MIPI f√°cil en FPGA</a></li>
<li><a href="../476624/index.html">Canalizaciones de calidad en desarrollo m√≥vil, parte 1: Android</a></li>
<li><a href="../476626/index.html">PVS-Studio en las nubes: GitLab CI / CD</a></li>
<li><a href="../476628/index.html">PVS-Studio va a las nubes: GitLab CI / CD</a></li>
<li><a href="../476636/index.html">Ajuste de Firebird y Linux para una base de datos de 691 GB de tama√±o con m√°s de 1000 usuarios</a></li>
<li><a href="../476644/index.html">Capas de lenguaje</a></li>
<li><a href="../476646/index.html">Fusi√≥n de 3 v√≠as en werf: despliegue en Kubernetes con Helm "con esteroides"</a></li>
<li><a href="../476648/index.html">Lenovo en FINOPOLIS 2019</a></li>
<li><a href="../476650/index.html">El lugar de la enumeraci√≥n en el mundo cambiante de hoy</a></li>
<li><a href="../476656/index.html">26 de noviembre, Mosc√∫ - Alfa JS MeetUP # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>