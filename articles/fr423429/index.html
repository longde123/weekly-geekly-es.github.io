<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ùé üéØ ü§±üèª Mise √† jour de la base de donn√©es et d√©ploiement sans interruption de service üõ∂ ü§∑üèø üöó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nombreux articles ont √©t√© √©crits sur la mise √† jour des syst√®mes √† la vol√©e sans les arr√™ter (d√©ploiement sans temps d'arr√™t) et de nombreux aspect...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mise √† jour de la base de donn√©es et d√©ploiement sans interruption de service</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423429/">  De nombreux articles ont √©t√© √©crits sur la mise √† jour des syst√®mes √† la vol√©e sans les arr√™ter (d√©ploiement sans temps d'arr√™t) et de nombreux aspects de cette approche sont assez √©vidents.  √Ä mon avis, la partie la plus difficile du d√©ploiement dans ce cas est la mise √† jour des entrep√¥ts de donn√©es si leur contrat (sch√©ma) a chang√©.  C'est cet aspect que je voudrais consid√©rer dans cet article. <br><a name="habracut"></a><br>  Quelle que soit la base de donn√©es - avec un sch√©ma de donn√©es explicite comme relationnel ou arbitraire comme NoSQL - le sch√©ma de donn√©es est toujours pr√©sent, m√™me au niveau de l'application.  Les donn√©es lues dans la base de donn√©es doivent √™tre compr√©hensibles pour le client, m√™me si le r√©f√©rentiel lui-m√™me n'impose aucune restriction √† sa structure. <br><br>  Supposons qu'un syst√®me avec une structure de donn√©es sp√©cifique et des t√©raoctets de donn√©es dans la base de donn√©es fonctionne d√©j√† en production.  Dans la nouvelle version du syst√®me, nous devons l√©g√®rement modifier la structure pour impl√©menter de nouvelles fonctionnalit√©s ou am√©liorer les performances.  Consid√©rez quels changements dans le circuit peuvent se produire: <br><br><ul><li>  Ajout d'un nouveau champ </li><li>  Suppression de champs </li><li>  Renommer le champ </li><li>  Modifications du type de champ </li><li>  Transfert d'un champ vers une autre structure de donn√©es (par exemple, en cas de d√©normalisation) </li></ul><br>  L'ajout d'un nouveau champ ainsi que l'ajout de tout autre objet de base de donn√©es est une modification r√©trocompatible et ne n√©cessite aucune √©tape suppl√©mentaire en termes de mise en ≈ìuvre du d√©ploiement sans interruption (avec une mise en garde - si ce nouveau champ ou objet ne d√©pend pas fonctionnellement des autres d√©j√† stock√©s dans la base de donn√©es donn√©es).  Appliquez simplement les modifications √† la base de donn√©es √† la vol√©e, puis d√©ployez une nouvelle version du code qui utilise les nouveaux objets de base de donn√©es. <br><br>  La suppression d'un champ ou de tout autre objet de base de donn√©es n'est pas une modification r√©trocompatible, mais l'approche de sa mise en ≈ìuvre est tr√®s simple - les objets de base de donn√©es inutiles doivent √™tre supprim√©s uniquement apr√®s que la nouvelle version du syst√®me est compl√®tement bloqu√©e. <br><br>  Les trois autres types de modifications sont plus complexes en termes de d√©ploiement sans interruption de service.  En g√©n√©ral, tous peuvent √™tre effectu√©s en copiant des donn√©es vers d'autres champs / entit√©s et en supprimant les ¬´anciens¬ª apr√®s une migration r√©ussie des donn√©es: pour renommer, vous pouvez copier les donn√©es de l'ancien champ vers un champ avec un nouveau nom, puis supprimer l'ancien champ, changer le type de donn√©es peut √™tre fait avec renommer, etc.  D'une mani√®re ou d'une autre, sur une p√©riode de temps, la base de donn√©es doit prendre en charge les anciens et les nouveaux contrats.  Il existe au moins deux fa√ßons d'effectuer de telles modifications √† la vol√©e: <br><br><h3>  Si la base de donn√©es prend en charge les d√©clencheurs </h3><br><ol><li>  Cr√©ez des d√©clencheurs qui copient les donn√©es de l'ancien emplacement vers le nouveau lors de tout changement / ajout et d√©finissez-les en production. </li><li>  Appliquez un utilitaire de conversion de donn√©es qui fait de m√™me, mais pour tous les enregistrements de la base de donn√©es.  Comme les d√©clencheurs sont d√©j√† install√©s, l'utilitaire ne peut rien faire de plus compliqu√© qu'une simple mise √† jour ¬´fictive¬ª de chaque enregistrement (UPDATE table SET champ = champ ...).  Un point tr√®s important ici est que l'action de lire les donn√©es de l'ancien endroit et d'√©crire dans le nouveau doit √™tre atomique et prot√©g√©e des changements perdus.  Selon la structure de la base de donn√©es, vous pouvez utiliser un verrouillage pessimiste via SELECT FOR UPDATE ou ses analogues, ou optimiste si la table a un champ avec une version d'enregistrement. </li><li>  Une fois que l'utilitaire a termin√© son travail (selon la quantit√© de donn√©es et la complexit√© de la mise √† jour, le temps d'ex√©cution peut prendre des jours), il est d√©j√† possible d'installer une nouvelle version du syst√®me qui prend en charge le nouveau sch√©ma de donn√©es.  √Ä ce stade, tous les enregistrements de la base de donn√©es qui existaient au moment du lancement de l'utilitaire seront convertis avec succ√®s, et tous les nouveaux qui sont apparus pendant son fonctionnement seront √©galement convertis par des d√©clencheurs. </li><li>  Supprimez les d√©clencheurs et tous les champs (ou autres objets de base de donn√©es) qui ne sont plus n√©cessaires. </li></ol><br><h3>  S'il n'est pas possible d'utiliser des d√©clencheurs (comme c'est le cas avec de nombreuses solutions NoSQL) </h3><br><img src="https://habrastorage.org/webt/y2/09/6c/y2096cri-hcwq7p5caokazzy6dq.png"><br><br><ol><li>  Cr√©ez et d√©ployez une nouvelle version de l'application (version temporaire 1 sur la figure), qui lit toujours √† partir de l'ancien champ, mais lors de l'√©criture dans ce champ, elle met √† jour √† la fois l'ancien et le nouvel emplacement correspondant (dans la figure ¬´C¬ª - l'ancien, ¬´H¬ª - nouveau).  Zadeplit cette version sur tous les n≈ìuds sur lesquels les instances d'application s'ex√©cutent. </li><li>  Appliquez un utilitaire qui copie les donn√©es de l'ancien emplacement vers le nouveau.  Comme pour les d√©clencheurs, vous devez prendre des mesures pour √©viter les modifications perdues. </li><li>  Cr√©ez et, une fois l'utilitaire termin√©, installez une autre version de l'application (version temporaire 2), qui lit les donn√©es d'un nouveau champ, mais √©crit toujours √† deux endroits.  Cette √©tape est n√©cessaire, car lors de la mise √† jour s√©quentielle de chacun des n≈ìuds, il y aura toujours un √©cart lorsque les instances de la version pr√©c√©dente de l'application lisant l'ancien champ fonctionneront simultan√©ment avec la nouvelle. </li><li>  Cr√©ez et √† la fin du balayage complet de la pr√©c√©dente d√©ployez la version finale, qui n'interagit d√©j√† pas avec l'ancien champ. </li><li>  Supprimez les anciens champs. </li></ol><br>  La deuxi√®me approche n√©cessite la cr√©ation et l'installation de trois versions diff√©rentes de l'application, ce qui peut √™tre tr√®s g√™nant et encombrant.  Au lieu de cela, vous pouvez utiliser le basculement des fonctionnalit√©s - pour regrouper la logique des trois versions en une seule, mais changez de mode en fonction du param√®tre de configuration, qui pourrait id√©alement √™tre activ√© √† la vol√©e.  Ainsi, au lieu d'installer chaque version suivante, il suffira de changer la valeur du param√®tre (et de red√©marrer le service si la mise √† jour de la configuration √† la vol√©e n'est pas fournie).  Une fois l'installation de la version finale termin√©e avec succ√®s, tout le code relatif √† la migration des donn√©es doit √™tre compl√®tement supprim√© de la branche de travail, m√™me s'il "vivra" en production jusqu'√† la prochaine mise √† jour du syst√®me. <br><br>  Il est facile de remarquer que garantir un temps d'indisponibilit√© nul lors de la mise √† jour du syst√®me est une proc√©dure lourde et fragile, il est donc logique de ne s'en pr√©occuper que s'il existe une exigence correspondante de la part de l'entreprise.  Mais m√™me si les exigences de disponibilit√© du syst√®me sont assez faibles (par exemple, 99% par an et que la fen√™tre de mise √† jour du syst√®me pr√©vue est de 24 heures), la conversion des donn√©es requise pour installer la nouvelle version peut encore prendre plus de temps.  Par cons√©quent, vous devez √™tre pr√©par√© √† l'avance pour l'utilisation de ces solutions si vous pr√©voyez de stocker de grandes quantit√©s de donn√©es. <br><br>  Une autre approche peut √™tre le rejet intentionnel de modifications incompatibles en amont dans le sch√©ma de la base de donn√©es, mais, malheureusement, dans la pratique, ce n'est pas toujours r√©alisable, car souvent le moyen le plus efficace d'am√©liorer les performances d'acc√®s aux donn√©es est de restructurer le sch√©ma. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423429/">https://habr.com/ru/post/fr423429/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423419/index.html">Client HTML5 pour VMware vSphere √† para√Ætre cet automne - Ce que vous devez savoir</a></li>
<li><a href="../fr423421/index.html">Pourquoi l'herbe √©tait plus verte pour les ind√©pendants</a></li>
<li><a href="../fr423423/index.html">Cours MIT "S√©curit√© des syst√®mes informatiques". Conf√©rence 8: Mod√®le de s√©curit√© r√©seau, partie 3</a></li>
<li><a href="../fr423425/index.html">Old school: quels √©taient les jeux qui sortent - nous discutons de m√©dias inhabituels</a></li>
<li><a href="../fr423427/index.html">IndieVisible est une communaut√© ind√© en ligne open source</a></li>
<li><a href="../fr423431/index.html">Profondeurs SIEM: corr√©lations pr√™tes √† l'emploi. Partie 1: Marketing pur ou probl√®me insoluble?</a></li>
<li><a href="../fr423437/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 270 (du 10 au 16 septembre)</a></li>
<li><a href="../fr423439/index.html">Rapport du Club de Rome 2018, chapitre 2.6: ¬´Erreurs philosophiques de la doctrine du march√©¬ª</a></li>
<li><a href="../fr423441/index.html">Premi√®re liaison pour Exonum: pourquoi nous avons choisi Java</a></li>
<li><a href="../fr423445/index.html">Cr√©ation d'une structure de boutique en ligne: sch√©ma de cat√©gories</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>