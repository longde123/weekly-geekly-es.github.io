<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ´ ‚ö±Ô∏è üë©üèª‚Äçüíª Prueba de carga con langosta. Parte 2 üë®üèΩ‚Äçüé® üõ§Ô∏è ü§ôüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Para aquellos a quienes les gust√≥ mi art√≠culo anterior , sigo compartiendo mis impresiones sobre la herramienta de prueba de estr√©s Locust. 

 Tratar√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Prueba de carga con langosta. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/infopulse/blog/430810/">  Para aquellos a quienes les gust√≥ mi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo anterior</a> , sigo compartiendo mis impresiones sobre la herramienta de prueba de estr√©s Locust. <br><br>  Tratar√© de demostrar claramente las ventajas de escribir un python de prueba de carga con c√≥digo en el que pueda preparar convenientemente cualquier dato para la prueba y procesar los resultados. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/decfhwQPd9E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><h2>  Procesamiento de respuesta del servidor </h2><br>  A veces, en las pruebas de carga, no es suficiente simplemente obtener 200 OK del servidor HTTP.  Sucede que debe verificar el contenido de la respuesta para asegurarse de que, bajo carga, el servidor emite los datos correctos o realiza c√°lculos precisos.  Solo para tales casos, Locust agreg√≥ la capacidad de anular los par√°metros de √©xito de respuesta del servidor.  Considere el siguiente ejemplo: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> rnd <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_albums</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> photo_id = rnd.randint(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">f'/photos/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{photo_id}</span></span></span><span class="hljs-string">'</span></span>, catch_response=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, name=<span class="hljs-string"><span class="hljs-string">'/photos/[id]'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> response: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: album_id = response.json().get(<span class="hljs-string"><span class="hljs-string">'albumId'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> album_id % <span class="hljs-number"><span class="hljs-number">10</span></span> != <span class="hljs-number"><span class="hljs-number">0</span></span>: response.success() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: response.failure(<span class="hljs-string"><span class="hljs-string">f'album id cannot be </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{album_id}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: response.failure(<span class="hljs-string"><span class="hljs-string">f'status code is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{response.status_code}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  Solo tiene una solicitud, lo que crear√° una carga en el siguiente escenario: <br><blockquote>  Desde el servidor, solicitamos fotos de objetos con una identificaci√≥n aleatoria en el rango de 1 a 5000 y verificamos la identificaci√≥n del √°lbum en este objeto, asumiendo que no puede ser un m√∫ltiplo de 10 <br></blockquote>  Aqu√≠ puede dar algunas explicaciones de inmediato: <br><br><ul><li>  la incre√≠ble construcci√≥n <i>con request () como respuesta:</i> puede reemplazarlo con √©xito con <i>response = request ()</i> y trabajar en silencio con el objeto de respuesta </li><li>  La URL se forma usando la sintaxis de formato de cadena agregada en Python 3.6, si no me equivoco: <i>f '/ photos / {photo_id}'</i> .  ¬°En versiones anteriores, este dise√±o no funcionar√°! </li><li>  Un nuevo argumento que no hab√≠amos usado antes, <i>catch_response = True</i> , le dice a Locust que nosotros mismos determinaremos el √©xito de la respuesta del servidor.  Si no lo especifica, recibiremos el objeto de respuesta de la misma manera y podremos procesar sus datos, pero no redefiniremos el resultado.  A continuaci√≥n se muestra un ejemplo detallado. </li><li>  Otro argumento <i>name = '/ photos / [id]'</i> .  Es necesario agrupar las solicitudes en estad√≠sticas.  El nombre puede ser cualquier texto, no es necesario repetir la URL.  Sin ella, cada solicitud con una direcci√≥n o par√°metros √∫nicos se registrar√° por separado.  As√≠ es como funciona: <br></li></ul><br><img src="https://habrastorage.org/webt/ai/fm/ca/aifmcaycbzv9khpohj5sxjcohgo.png"><br>  Con el mismo argumento, puede realizar otro truco: a veces sucede que un servicio con diferentes par√°metros (por ejemplo, diferentes contenidos de solicitudes POST) realiza una l√≥gica diferente.  Para que los resultados de la prueba no se mezclen, puede escribir varias tareas separadas, especificando para cada una su propio <i>nombre de</i> argumento. <br><br>  A continuaci√≥n hacemos los controles.  Tengo 2 de ellos. Primero, verificamos que el servidor devolvi√≥ una respuesta if <i>response.status_code == 200</i> : <br><br>  En caso afirmativo, verifique si la identificaci√≥n del √°lbum es un m√∫ltiplo de 10. Si no es un m√∫ltiplo, marque esta respuesta como una <i>respuesta</i> exitosa <i>.</i> <br><br>  En otros casos, indicamos por qu√© la respuesta fall√≥ <i>response.failure ('texto de error')</i> .  Este texto se mostrar√° en la p√°gina Fallos durante la prueba. <br><br><img src="https://habrastorage.org/webt/52/se/dt/52sedt-fqe0jhasmdnq3k94ia7m.png"><br><br>  Adem√°s, los lectores atentos podr√≠an notar la ausencia de excepciones que son caracter√≠sticas del c√≥digo que funciona con las interfaces de red.  De hecho, en el caso de tiempo de espera, error de conexi√≥n y otros incidentes imprevistos, Locust manejar√° los errores y a√∫n devolver√° una respuesta, indicando, sin embargo, que el estado del c√≥digo de respuesta es 0. <br><br>  Si el c√≥digo a√∫n arroja una excepci√≥n, se escribir√° en la pesta√±a Excepciones en tiempo de ejecuci√≥n para que podamos manejarlo.  La situaci√≥n m√°s t√≠pica es que el json'e de la respuesta no devolvi√≥ el valor que est√°bamos buscando, pero ya estamos realizando las siguientes operaciones. <br><br>  Antes de cerrar el tema, en el ejemplo utilizo el servidor json para mayor claridad, ya que es m√°s f√°cil procesar las respuestas.  Pero puede trabajar con el mismo √©xito con HTML, XML, FormData, archivos adjuntos y otros datos utilizados por los protocolos basados ‚Äã‚Äãen HTTP. <br><br><h2>  Trabaja con escenarios complejos. </h2><br>  Casi cada vez que la tarea es realizar pruebas de carga de una aplicaci√≥n web, r√°pidamente queda claro que es imposible proporcionar una cobertura decente solo con los servicios GET, que simplemente devuelven datos. <br><br>  Ejemplo cl√°sico: para probar una tienda en l√≠nea, es deseable que el usuario <br><br><ol><li>  Abri√≥ la tienda principal </li><li>  Estaba buscando bienes </li><li>  Detalles del art√≠culo abierto </li><li>  Art√≠culo agregado al carrito </li><li>  Pagado </li></ol><br>  Del ejemplo, podemos suponer que los servicios de llamadas en orden aleatorio no funcionar√°n, solo secuencialmente.  Adem√°s, los bienes, cestas y formas de pago pueden tener identificadores √∫nicos para cada usuario. <br><br>  Usando el ejemplo anterior, con modificaciones menores, puede implementar f√°cilmente la prueba de tal escenario.  Adaptamos el ejemplo para nuestro servidor de prueba: <br><br><ol><li>  El usuario est√° escribiendo una nueva publicaci√≥n. </li><li>  El usuario escribe un comentario en la nueva publicaci√≥n. </li><li>  El usuario lee el comentario </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlowException</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Exception)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_flow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># step 1 new_post = {'userId': 1, 'title': 'my shiny new post', 'body': 'hello everybody'} post_response = self.client.post('/posts', json=new_post) if post_response.status_code != 201: raise FlowException('post not created') post_id = post_response.json().get('id') # step 2 new_comment = { "postId": post_id, "name": "my comment", "email": "test@user.habr", "body": "Author is cool. Some text. Hello world!" } comment_response = self.client.post('/comments', json=new_comment) if comment_response.status_code != 201: raise FlowException('comment not created') comment_id = comment_response.json().get('id') # step 3 self.client.get(f'/comments/{comment_id}', name='/comments/[id]') if comment_response.status_code != 200: raise FlowException('comment not read') class WebsiteUser(HttpLocust): task_set = UserBehavior min_wait = 1000 max_wait = 2000</span></span></code> </pre> <br>  En este ejemplo, agregu√© una nueva clase <b>FlowException</b> .  Despu√©s de cada paso, si no sali√≥ como se esperaba, lanzo esta clase de excepci√≥n para interrumpir el script; si la publicaci√≥n no funcion√≥, entonces no habr√° nada que comentar, etc.  Si lo desea, la construcci√≥n se puede reemplazar con el <b>retorno</b> habitual, pero en este caso, durante la ejecuci√≥n y al analizar los resultados, no quedar√° tan claro d√≥nde cae el script ejecutado en la pesta√±a Excepciones.  Por la misma raz√≥n, no uso el <b>intento ... excepto</b> construir. <br><br><h2>  Hacer que la carga sea realista </h2><br>  Ahora me pueden reprochar, en el caso de la tienda todo es realmente lineal, pero el ejemplo con publicaciones y comentarios es demasiado descabellado: leen las publicaciones 10 veces m√°s a menudo de lo que crean.  Razonablemente, hagamos que el ejemplo sea m√°s viable.  Y hay al menos 2 enfoques: <br><br><ol><li>  Puede "codificar" la lista de publicaciones que los usuarios leen y simplificar el c√≥digo de prueba si existe tal posibilidad y la funcionalidad del backend no depende de publicaciones espec√≠ficas </li><li>  Guarde las publicaciones creadas y l√©alas si no es posible preestablecer la lista de publicaciones o la carga realista depende de las publicaciones que se leen (elimin√© la creaci√≥n de comentarios del ejemplo para hacer su c√≥digo m√°s peque√±o y m√°s visual) </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> r <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> created_posts = [] @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> new_post = {<span class="hljs-string"><span class="hljs-string">'userId'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>: <span class="hljs-string"><span class="hljs-string">'my shiny new post'</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-string"><span class="hljs-string">'hello everybody'</span></span>} post_response = self.client.post(<span class="hljs-string"><span class="hljs-string">'/posts'</span></span>, json=new_post) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post_response.status_code != <span class="hljs-number"><span class="hljs-number">201</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> post_id = post_response.json().get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) self.created_posts.append(post_id) @task(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.created_posts) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> post_id = r.choice(self.created_posts) self.client.get(<span class="hljs-string"><span class="hljs-string">f'/posts/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{post_id}</span></span></span><span class="hljs-string">'</span></span>, name=<span class="hljs-string"><span class="hljs-string">'read post'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  En la clase <b>UserBehavior,</b> cre√© una lista <b>created_posts</b> .  Preste especial atenci√≥n: este es un objeto y no se cre√≥ en el constructor de la <b>clase __init __ (),</b> por lo tanto, a diferencia de la sesi√≥n del cliente, esta lista es com√∫n para todos los usuarios.  La primera tarea crea una publicaci√≥n y escribe su identificaci√≥n en la lista.  El segundo, 10 veces m√°s seguido, lee una publicaci√≥n seleccionada al azar de la lista.  Una condici√≥n adicional de la segunda tarea es verificar si hay publicaciones creadas. <br><br>  Si queremos que cada usuario opere solo con sus propios datos, podemos declararlos en el constructor de la siguiente manera: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parent)</span></span></span><span class="hljs-function">:</span></span> super(UserBehavior, self).__init__(parent) self.created_posts = list()</code> </pre> <br><h2>  Algunas caracter√≠sticas m√°s </h2><br>  Para el lanzamiento secuencial de tareas, la documentaci√≥n oficial sugiere que tambi√©n usemos la anotaci√≥n de tarea @seq_task (1), especificando el n√∫mero de serie de la tarea en el argumento <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTaskSequence</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSequence)</span></span></span><span class="hljs-class">:</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">3</span></span>) @task(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">third_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br>  En este ejemplo, cada usuario ejecutar√° primero <b>first_task</b> , luego <b>second_task</b> , luego 10 veces <b>third_task</b> . <br><br>  Francamente, la disponibilidad de tal oportunidad agrada, pero, a diferencia de los ejemplos anteriores, no est√° claro c√≥mo transferir los resultados de la primera tarea a la segunda si es necesario. <br><br>  Adem√°s, para escenarios particularmente complejos, es posible crear conjuntos de tareas anidadas, de hecho, crear varias clases de TaskSet y conectarse entre s√≠. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Todo</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/todos"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.interrupt() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> tasks = {Todo: <span class="hljs-number"><span class="hljs-number">1</span></span>} @task(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/posts"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  En el ejemplo anterior, con una probabilidad de 1 a 6, se iniciar√° el script <b>Todo</b> y se ejecutar√° hasta que, con una probabilidad de 1 a 4, regrese al script <b>UserBehavior</b> .  Es muy importante que tenga una llamada a <b>self.interrupt ()</b> : sin ella, las pruebas se centrar√°n en la subtarea. <br><br>  Gracias por leer  En el art√≠culo final escribir√© sobre pruebas distribuidas y pruebas sin una interfaz de usuario, as√≠ como sobre las dificultades que encontr√© durante las pruebas con Locust y c√≥mo solucionarlas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es430810/">https://habr.com/ru/post/es430810/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es430800/index.html">Creaci√≥n del juego "Like Coins" en Godot Engine. Parte 2</a></li>
<li><a href="../es430802/index.html">PMI RU: Estudio de los salarios de los gerentes de proyecto en Rusia para 2017</a></li>
<li><a href="../es430804/index.html">Las bater√≠as Tesla / Panasonic son las bater√≠as de veh√≠culos el√©ctricos m√°s asequibles del mercado.</a></li>
<li><a href="../es430806/index.html">Comenzamos a aprender ingl√©s - escribimos una aplicaci√≥n: EWM - experiencia en la creaci√≥n de un proyecto de capacitaci√≥n</a></li>
<li><a href="../es430808/index.html">Teor√≠a del orador: 16 materiales sobre c√≥mo funcionan los oradores y los oradores</a></li>
<li><a href="../es430812/index.html">Lo que developer.android.com est√° hablando de RecyclerView</a></li>
<li><a href="../es430818/index.html">SQLAlchemy Acceleration for Architectural Astronauts</a></li>
<li><a href="../es430820/index.html">Black Friday 2018 - VDS en Mosc√∫ y Amsterdam</a></li>
<li><a href="../es430822/index.html">Seguridad de la informaci√≥n de Internet de las cosas: ¬øqui√©n es la cosa y qui√©n es el maestro?</a></li>
<li><a href="../es430824/index.html">Buscar objetos da√±ados por n√∫mero de p√°gina da√±ado en MS SQL Server 2005</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>