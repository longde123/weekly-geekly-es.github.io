<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÆ üë©‚Äçüé§ üë®‚Äçüë®‚Äçüë¶ Refatorando um programa em movimento: acelera√ß√£o 23 vezes ü§© ‚òùüèø üë©‚Äçüë©‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Meu nome √© Marco, trabalho no Badoo no departamento de Plataforma. Temos muitas coisas escritas no Go, e muitas vezes s√£o cr√≠ticas para o desempenh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Refatorando um programa em movimento: acelera√ß√£o 23 vezes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/415919/"><img src="https://habrastorage.org/webt/fw/oq/ji/fwoqjijc84e50kqfhpyzqfl-oay.jpeg"><br><br>  <i>Oi</i>  <i>Meu nome √© Marco, trabalho no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Badoo</a> no departamento de Plataforma.</i>  <i>Temos muitas coisas escritas no Go, e muitas vezes s√£o cr√≠ticas para o desempenho do sistema.</i>  <i>√â por isso que hoje ofere√ßo uma tradu√ß√£o de um artigo que realmente gostei e, tenho certeza, ser√° muito √∫til para voc√™.</i>  <i>O autor mostra passo a passo como ele abordou os problemas de desempenho e como eles os resolveram.</i>  <i>Incluindo voc√™ se familiarizar√° com as ferramentas avan√ßadas dispon√≠veis no Go para esse trabalho.</i>  <i>Boa leitura!</i> <br><br>  Algumas semanas atr√°s, li o artigo ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bom c√≥digo contra c√≥digo incorreto no Go</a> ‚Äù <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">, em</a> que o autor, passo a passo, demonstra a refatora√ß√£o de um aplicativo real que resolve problemas reais de neg√≥cios.  Ele se concentra em transformar "c√≥digo incorreto" em "c√≥digo v√°lido": mais idiom√°tico, mais compreens√≠vel, utilizando totalmente as especificidades do Go.  Mas o autor tamb√©m afirmou a import√¢ncia do desempenho do aplicativo em quest√£o.  A curiosidade surgiu em mim: vamos tentar acelerar! <br><a name="habracut"></a><br>  O programa, grosso modo, l√™ o arquivo de entrada, analisa-o linha por linha e preenche os objetos na mem√≥ria. <br><br><img src="https://habrastorage.org/webt/q0/ar/rr/q0arrrwx11e7qz627mj4ttz1r7y.png"><br><br>  O autor n√£o apenas postou o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">c√≥digo fonte no GitHub</a> , mas tamb√©m escreveu uma refer√™ncia.  Essa √© uma √≥tima ideia.  De fato, o autor convidou todos a brincar com o c√≥digo e tentar aceler√°-lo.  Para reproduzir os resultados do autor, use o seguinte comando: <br><br><pre><code class="go hljs">$ <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> test -bench=.</code> </pre> <br><img src="https://habrastorage.org/webt/jw/x2/6w/jwx26wyngj_sqokfhrbk-3u3yeo.png"><br>  <i>Œºs por chamada (menos - melhor)</i> <br><br>  Acontece que no meu computador o ‚Äúc√≥digo bom‚Äù √© 16% mais r√°pido.  Podemos acelerar? <br><br>  Na minha experi√™ncia, h√° uma correla√ß√£o entre qualidade e desempenho do c√≥digo.  Se voc√™ refatorou o c√≥digo com sucesso, o tornou mais limpo e menos conectado, provavelmente o tornou mais r√°pido porque ficou menos confuso (e n√£o h√° mais instru√ß√µes desnecess√°rias que foram executadas em v√£o).  Talvez durante a refatora√ß√£o voc√™ tenha notado algumas oportunidades de otimiza√ß√£o ou agora tenha apenas a oportunidade de cri√°-las.  Mas, por outro lado, se voc√™ quiser tornar o c√≥digo ainda mais produtivo, provavelmente precisar√° se afastar da simplicidade e adicionar v√°rios hacks.  Voc√™ realmente economiza milissegundos, mas a qualidade do c√≥digo sofrer√°: ficar√° mais dif√≠cil l√™-lo e falar sobre ele, ficar√° mais fr√°gil e flex√≠vel. <br><br><img src="https://habrastorage.org/webt/c9/lz/zd/c9lzzdc9yi73nsxn6cm93vwbvei.gif"><br>  <i>Subimos a montanha da Simplicidade e depois descemos dela</i> <br><br>  Esta √© uma troca: at√© onde voc√™ est√° disposto a ir? <br><br>  Para priorizar adequadamente o trabalho de acelera√ß√£o, a estrat√©gia ideal √© encontrar gargalos e focar neles.  Para fazer isso, use as ferramentas de cria√ß√£o de perfil.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pprof</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">trace</a> s√£o seus amigos: <br><br><pre> <code class="go hljs">$ <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> test -bench=. -cpuprofile cpu.prof $ <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> tool pprof -svg cpu.prof &gt; cpu.svg</code> </pre> <br> <a href=""><img src="https://habrastorage.org/webt/dc/j4/vf/dcj4vfmpccf5k2gjyxumvbtxj-k.png"></a> <br>  <i>Um gr√°fico bastante amplo do uso da CPU (clique para SVG)</i> <br><br><pre> <code class="go hljs">$ <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> test -bench=. -trace trace.out $ <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> tool trace trace.out</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/dd/tf/pk/ddtfpkssk98xhs_6o2ncqbxkucq.png"></a> <br>  <i>Rastreamento do arco-√≠ris: muitas tarefas pequenas (clique para abrir, funciona apenas no Google Chrome)</i> <br><br>  O rastreamento confirma que todos os n√∫cleos do processador est√£o ocupados (linhas abaixo de 0, 1 etc.) e, √† primeira vista, isso √© bom.  Mas ela tamb√©m mostra milhares de pequenos c√°lculos de cores e v√°rias √°reas vazias onde os n√∫cleos estavam ociosos.  Vamos ampliar: <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/h3/-w/qe/h3-wqeqyb3xiiwyyvott4cwywg4.png"></a> <br>  <i>"Janela" em 3 ms (clique para abrir, funciona apenas no Google Chrome)</i> <br><br>  Cada n√∫cleo fica ocioso por um bom tempo e tamb√©m ‚Äúsalta‚Äù entre micro-tarefas o tempo todo.  Parece que a granularidade dessas tarefas n√£o √© √≥tima, o que leva a um grande n√∫mero de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">altern√¢ncias</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">contexto</a> e √† concorr√™ncia devido √† sincroniza√ß√£o. <br><br>  Vamos ver o que o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">detector de v√¥o</a> nos diz.  Existem problemas no acesso s√≠ncrono aos dados (se houver algum, temos problemas muito maiores que o desempenho)? <br><br><pre> <code class="go hljs">$ <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> test -race PASS</code> </pre> <br>  √ìtimo!  Tudo est√° correto.  N√£o foram encontrados voos.  Fun√ß√µes de teste e fun√ß√µes de benchmark s√£o fun√ß√µes diferentes ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">consulte a documenta√ß√£o</a> ), mas aqui elas chamam a mesma fun√ß√£o <i>ParseAdexpMessage</i> ; portanto, o que verificamos para v√¥os de dados por testes √© bom. <br><br>  O modelo competitivo na vers√£o ‚Äúboa‚Äù consiste em processar cada linha do arquivo de entrada em uma goroutine separada (para usar todos os n√∫cleos).  A intui√ß√£o do autor aqui funcionou bem, pois as goroutines t√™m uma reputa√ß√£o de recursos f√°ceis e baratos.  Mas quanto ganhamos com a execu√ß√£o paralela?  Vamos comparar com o mesmo c√≥digo, mas sem usar goroutines (basta remover a palavra go que vem antes da chamada da fun√ß√£o): <br><br><img src="https://habrastorage.org/webt/up/1q/0f/up1q0fy6bggo-62uevoioyo0huq.png"><br><img src="https://habrastorage.org/webt/ae/v3/go/aev3gocqbxle0pa3_lmeeyyczrg.png"><br><br>  Ops, parece que o c√≥digo se tornou mais r√°pido sem o uso de simultaneidade.  Isso significa que a sobrecarga (diferente de zero) para o lan√ßamento de goroutines excede o tempo que ganhamos usando v√°rios n√∫cleos ao mesmo tempo.  O pr√≥ximo passo natural deve ser remover a sobrecarga (diferente de zero) para usar canais para enviar os resultados.  Vamos substitu√≠-lo por uma fatia regular: <br><br><img src="https://habrastorage.org/webt/p_/sm/dl/p_smdl6hi439zezi4dygfvuyvtc.png"><br>  <i>Œºs por chamada (menos √© melhor)</i> <br><br>  Obtivemos cerca de 40% de acelera√ß√£o em rela√ß√£o √† vers√£o ‚Äúboa‚Äù, simplificando o c√≥digo e removendo a concorr√™ncia ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">diff</a> ). <br><br><img src="https://habrastorage.org/webt/qr/in/pi/qrinpifpqvwgdb65z1yflyywjhg.png"><br>  <i>Com uma goroutine, apenas um n√∫cleo funciona por vez</i> <br><br>  Vamos agora ver as fun√ß√µes importantes no gr√°fico pprof: <br><br> <a href=""><img src="https://habrastorage.org/webt/89/sd/bk/89sdbk8fhme8ixv37a2hmnxpj54.png"></a> <br>  <i>Procurando gargalos</i> <br><br>  A refer√™ncia da vers√£o atual (opera√ß√£o sequencial, fatias) gasta 86% do tempo analisando as mensagens, e isso √© normal.  Mas notamos rapidamente que 43% do tempo √© gasto no uso de express√µes regulares e da fun√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">(* Regexp) .FindAll</a> . <br><br>  Apesar de as express√µes regulares serem uma maneira conveniente e flex√≠vel de obter dados de texto sem formata√ß√£o, elas t√™m desvantagens, incluindo o uso de um grande n√∫mero de recursos, processador e mem√≥ria.  Eles s√£o uma ferramenta poderosa, mas geralmente seu uso √© desnecess√°rio. <br><br>  Em nosso programa, um modelo <br><br><pre> <code class="go hljs">patternSubfield = <span class="hljs-string"><span class="hljs-string">"-.[^-]*"</span></span></code> </pre> <br>  Destina-se principalmente a destacar comandos come√ßando com um tra√ßo (-), e pode haver v√°rios na linha.  Depois de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">extrair</a> um pequeno c√≥digo, isso pode ser feito usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bytes.Split</a> .  Vamos adaptar o c√≥digo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">confirmar</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">confirmar</a> ) para alterar as express√µes regulares para Split: <br><br><img src="https://habrastorage.org/webt/ks/8l/s2/ks8ls2upltp-tnqnpinp2tauqkc.png"><br>  <i>Œºs por chamada (menos</i> √© <i>melhor)</i> <br><br>  Uau!  C√≥digo 40% mais produtivo!  O gr√°fico de consumo da CPU agora fica assim: <br><br> <a href=""><img src="https://habrastorage.org/webt/be/ux/dy/beuxdy132ncb8resbitn2gndy1a.png"></a> <br><br>  N√£o h√° mais tempo perdido em express√µes regulares.  Uma parte significativa (40%) vai para a aloca√ß√£o de mem√≥ria de cinco fun√ß√µes diferentes.  Curiosamente, agora 21% do tempo √© gasto na fun√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bytes.Trim</a> : <br><br><img src="https://habrastorage.org/webt/8f/if/md/8fifmdma-hteqqu_p85umbyo1ly.png"><br>  <i>Esse recurso me intriga.</i>  <i>O que podemos fazer aqui?</i> <i><br><br></i>  <i>bytes.Trim</i> espera uma string com caracteres que "corta" como argumento, mas como essa string passamos uma string com apenas um caractere - um espa√ßo.  Este √© apenas um exemplo de como voc√™ pode obter acelera√ß√£o devido √† complexidade: vamos criar nossa fun√ß√£o de apara em vez da fun√ß√£o padr√£o.  Nossa fun√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ajuste</a> personalizado funcionar√° com um √∫nico byte em vez de uma linha inteira: <br><br><img src="https://habrastorage.org/webt/xs/cv/np/xscvnpnpkjo9ml4yq8chimeimv4.png"><br><img src="https://habrastorage.org/webt/h-/is/7x/h-is7xreexvfn_s537mdqtdkmrc.png"><br>  <i>Œºs por chamada (menos √© melhor)</i> <br><br>  Viva, mais 20% de desconto!  A vers√£o atual √© quatro vezes mais r√°pida que a original ‚Äúruim‚Äù e, ao mesmo tempo, usa apenas um n√∫cleo.  Nada mal! <br><br><hr><br><br>  Anteriormente, abandonamos a competitividade no n√≠vel de processamento de linha, mas eu argumento que a acelera√ß√£o pode ser alcan√ßada usando a competitividade em um n√≠vel superior.  Por exemplo, o processamento de 6.000 arquivos (6.000 mensagens) √© mais r√°pido no meu computador se cada arquivo for processado em sua pr√≥pria goroutine: <br><br><img src="https://habrastorage.org/webt/r0/lf/oo/r0lfoof3kljocawz0tjcmogrww4.png"><br>  <i>Œºs por chamada (menos √© melhor; roxo √© uma solu√ß√£o competitiva)</i> <br><br>  O ganho √© de 66% (ou seja, acelera√ß√£o tr√™s vezes).  Isso √© bom, mas n√£o muito, considerando que todos os 12 n√∫cleos de processador que tenho s√£o usados.  Isso pode significar que o novo c√≥digo otimizado que processa o arquivo inteiro ainda √© uma "pequena tarefa", para a qual a sobrecarga para a cria√ß√£o de goroutines e o custo da sincroniza√ß√£o n√£o s√£o insignificantes.  Curiosamente, aumentar o n√∫mero de mensagens de 6.000 para 120.000 n√£o afeta a vers√£o de thread √∫nico e reduz o desempenho na vers√£o "uma goroutine por mensagem".  Isso ocorre porque, apesar de criar uma quantidade t√£o grande de goroutines ser poss√≠vel e √†s vezes √∫til, ele traz sua pr√≥pria sobrecarga na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√°rea</a> do programador de tempo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">execu√ß√£o</a> . <br><br>  Podemos reduzir ainda mais o tempo de execu√ß√£o (n√£o em 12 vezes, mas ainda assim) criando apenas alguns trabalhadores.  Por exemplo, 12 goroutines de longa dura√ß√£o, cada uma das quais processar√° parte das mensagens: <br><br><img src="https://habrastorage.org/webt/re/v2/wf/rev2wf-q7cfgvhxsfj15n30l6xa.png"><br>  <i>Œºs por chamada (menos √© melhor; roxo √© uma solu√ß√£o competitiva)</i> <br><br>  Esta op√ß√£o reduz o tempo de execu√ß√£o em 79% em compara√ß√£o com a vers√£o de thread √∫nico.  Observe que essa estrat√©gia s√≥ faz sentido se voc√™ tiver muitos arquivos para processar. <br><br>  O uso ideal de todos os n√∫cleos do processador √© usar v√°rias goroutines, cada uma das quais processa uma quantidade significativa de dados sem nenhuma intera√ß√£o ou sincroniza√ß√£o antes que o trabalho seja conclu√≠do. <br><br>  Geralmente eles levam tantos processos (goroutine) quanto os n√∫cleos do processador, mas essa nem sempre √© a melhor op√ß√£o: tudo depende da tarefa espec√≠fica.  Por exemplo, se voc√™ estiver lendo algo do sistema de arquivos ou fazendo muitas chamadas de rede, para obter mais desempenho, use mais goroutines que seus n√∫cleos. <br><br><img src="https://habrastorage.org/webt/gd/m-/ic/gdm-icxpy5qq_n2fw5-zru20gu4.png"><br>  <i>Œºs por chamada (menos √© melhor; roxo √© uma solu√ß√£o competitiva)</i> <br><br>  Chegamos ao ponto em que √© dif√≠cil aumentar o desempenho da an√°lise com algumas altera√ß√µes localizadas.  O tempo de execu√ß√£o √© dominado pelo tempo para aloca√ß√£o de mem√≥ria e coleta de lixo.  Isso parece l√≥gico, pois as fun√ß√µes de gerenciamento de mem√≥ria s√£o bastante lentas.  Uma otimiza√ß√£o adicional dos processos associados √†s aloca√ß√µes permanece como uma li√ß√£o de casa para os leitores. <br><br><hr><br><br>  O uso de outros algoritmos tamb√©m pode levar a um grande ganho de desempenho. <br><br>  Aqui eu fui inspirado por uma palestra da Lexical Scanning em Go from Rob Pike, <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/HxaD_trXwRE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  para criar um lexer personalizado ( <a href="">origem</a> ) e um analisador personalizado ( <a href="">origem</a> ).  Esse c√≥digo ainda n√£o est√° pronto (n√£o processo muitos casos de canto), √© menos claro que o algoritmo original e, √†s vezes, √© dif√≠cil escrever o tratamento de erros correto.  Mas √© pequeno e 30% mais r√°pido que a vers√£o mais otimizada. <br><br><img src="https://habrastorage.org/webt/ey/c3/n7/eyc3n7fnc1lu_szlyn2fnn0lzti.png"><br>  <i>Œºs por chamada (menos √© melhor; roxo √© uma solu√ß√£o competitiva)</i> <br><br>  Sim  Como resultado, obtivemos uma acelera√ß√£o de 23 vezes em compara√ß√£o com o c√≥digo fonte. <br><br><hr><br><br>  Isso √© tudo por hoje.  Espero que voc√™ tenha gostado dessa aventura.  Aqui est√£o algumas notas e conclus√µes: <br><br><ul><li>  A produtividade pode ser melhorada em v√°rios n√≠veis de abstra√ß√£o, usando diferentes t√©cnicas, e o ganho √© frequentemente aumentado. <br></li><li>  O ajuste precisa come√ßar com abstra√ß√µes de alto n√≠vel: estruturas de dados, algoritmos, o desacoplamento correto dos m√≥dulos.  Adote abstra√ß√µes de baixo n√≠vel mais tarde: E / S, lotes, competitividade, usando a biblioteca padr√£o, trabalhando com mem√≥ria, alocando mem√≥ria. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A</a> an√°lise do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Big O</a> √© muito importante, mas geralmente n√£o √© a ferramenta mais adequada para acelerar um programa. <br></li><li>  Escrever benchmarks √© um trabalho √°rduo.  Use perfis e refer√™ncias para encontrar gargalos e obter uma compreens√£o mais ampla do que est√° acontecendo no programa.  Lembre-se de que os resultados de refer√™ncia n√£o s√£o os mesmos que os usu√°rios experimentar√£o no trabalho da vida real. <br></li><li>  Felizmente, um conjunto de ferramentas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bench</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pprof</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">trace</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Race Detector</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cover</a> ) torna a pesquisa sobre o desempenho do c√≥digo acess√≠vel e interessante. <br></li><li>  Escrever testes bons e relevantes n√£o √© uma tarefa trivial.  Mas eles s√£o extremamente importantes para n√£o se aventurar na natureza.  Voc√™ pode refatorar, certificando-se de que o c√≥digo permane√ßa correto. <br></li><li>  Pare e pergunte-se o qu√£o r√°pido √© "r√°pido o suficiente".  N√£o perca seu tempo otimizando alguns scripts √∫nicos.  N√£o se esque√ßa que a otimiza√ß√£o n√£o √© gratuita: tempo, complexidade, erros e d√≠vida t√©cnica do engenheiro. <br></li><li>  Pense duas vezes antes de complicar o c√≥digo. <br></li><li>  Algoritmos com complexidade <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Œ©</a> (n¬≤) e acima geralmente s√£o muito caros. <br></li><li>  Algoritmos com complexidade O (n) ou O (n log n) e abaixo geralmente est√£o ok. <br></li><li>  V√°rios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fatores ocultos</a> n√£o podem ser ignorados.  Por exemplo, todas as melhorias no artigo foram feitas reduzindo esses fatores e n√£o alterando a classe de complexidade do algoritmo. <br></li><li>  A E / S geralmente √© um gargalo: consultas de rede, consultas de banco de dados, sistema de arquivos. <br></li><li>  Express√µes regulares geralmente s√£o muito caras e desnecess√°rias. <br></li><li>  As aloca√ß√µes de mem√≥ria s√£o mais caras que os c√°lculos. <br></li><li>  Um objeto alocado na pilha √© mais barato que um objeto alocado no heap. <br></li><li>  As fatias s√£o √∫teis como uma alternativa √†s movimenta√ß√µes caras de mem√≥ria. <br></li><li>  As seq√º√™ncias de caracteres s√£o eficazes quando somente leitura (incluindo nova segmenta√ß√£o).  Em todos os outros casos, [] byte s√£o mais eficazes. <br></li><li>  √â muito importante que os dados que voc√™ processa estejam pr√≥ximos (caches do processador). <br></li><li>  Competitividade e paralelismo s√£o muito √∫teis, mas dif√≠ceis de preparar. <br></li><li>  Ao cavar fundo e fundo, lembre-se do "piso de vidro" que voc√™ n√£o deseja invadir o Go.  Se suas m√£os est√£o ansiosas para tentar instru√ß√µes de montagem, instru√ß√µes SIMD, pode ser necess√°rio usar o Go apenas para prototipagem e depois mudar para um idioma de n√≠vel inferior para obter o controle total do hardware e a cada nanossegundo! <br></li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt415919/">https://habr.com/ru/post/pt415919/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt415909/index.html">Extens√£o da Web entre navegadores para scripts personalizados Parte 2</a></li>
<li><a href="../pt415911/index.html">Acesso a um √≠ndice de matriz inexistente</a></li>
<li><a href="../pt415913/index.html">Aquecer para quem pode em Python</a></li>
<li><a href="../pt415915/index.html">Pr√°tica severa: que tipo de conex√£o sem fio temos para os hoteleiros</a></li>
<li><a href="../pt415917/index.html">A "Lei da Primavera" entrou em vigor: o que vem a seguir?</a></li>
<li><a href="../pt415923/index.html">A unidade √© lenta? Cuidado LINQ</a></li>
<li><a href="../pt415925/index.html">MasterCard patenteada tecnologia blockchain an√¥nima</a></li>
<li><a href="../pt415927/index.html">L√¢mpada industrial Breeze 50</a></li>
<li><a href="../pt415929/index.html">Otimiza√ß√£o da arquitetura de intelig√™ncia artificial: a corrida come√ßa</a></li>
<li><a href="../pt415933/index.html">Como construir uma arquitetura IIoT fa√ßa voc√™ mesmo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>