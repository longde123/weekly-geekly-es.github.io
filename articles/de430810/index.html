<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≥üèΩ üöû üò≥ Lastpr√ºfung mit Heuschrecke. Teil 2 üå•Ô∏è üïã üë¶üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="F√ºr diejenigen, denen mein vorheriger Artikel gefallen hat, teile ich weiterhin meine Eindr√ºcke vom Locust-Stresstest-Tool. 

 Ich werde versuchen, di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lastpr√ºfung mit Heuschrecke. Teil 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/infopulse/blog/430810/">  F√ºr diejenigen, denen mein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorheriger Artikel</a> gefallen hat, teile ich weiterhin meine Eindr√ºcke vom Locust-Stresstest-Tool. <br><br>  Ich werde versuchen, die Vorteile des Schreibens einer Lasttest-Python mit Code klar zu demonstrieren, in dem Sie bequem alle Daten f√ºr den Test vorbereiten und die Ergebnisse verarbeiten k√∂nnen. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/decfhwQPd9E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><h2>  Serverantwortverarbeitung </h2><br>  Manchmal reicht es beim Auslastungstest nicht aus, einfach 200 OK vom HTTP-Server zu erhalten.  Es kommt vor, dass Sie den Inhalt der Antwort √ºberpr√ºfen m√ºssen, um sicherzustellen, dass der Server unter Last die richtigen Daten ausgibt oder genaue Berechnungen durchf√ºhrt.  Nur f√ºr solche F√§lle hat Locust die M√∂glichkeit hinzugef√ºgt, die Erfolgsparameter der Serverantwort zu √ºberschreiben.  Betrachten Sie das folgende Beispiel: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> rnd <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_albums</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> photo_id = rnd.randint(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">f'/photos/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{photo_id}</span></span></span><span class="hljs-string">'</span></span>, catch_response=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, name=<span class="hljs-string"><span class="hljs-string">'/photos/[id]'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> response: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: album_id = response.json().get(<span class="hljs-string"><span class="hljs-string">'albumId'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> album_id % <span class="hljs-number"><span class="hljs-number">10</span></span> != <span class="hljs-number"><span class="hljs-number">0</span></span>: response.success() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: response.failure(<span class="hljs-string"><span class="hljs-string">f'album id cannot be </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{album_id}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: response.failure(<span class="hljs-string"><span class="hljs-string">f'status code is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{response.status_code}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  Es gibt nur eine Anforderung, die im folgenden Szenario eine Last erzeugt: <br><blockquote>  Vom Server fordern wir Fotoobjekte mit einer zuf√§lligen ID im Bereich von 1 bis 5000 an und √ºberpr√ºfen die Album-ID in diesem Objekt, vorausgesetzt, es kann kein Vielfaches von 10 sein <br></blockquote>  Hier k√∂nnen Sie sofort einige Erkl√§rungen geben: <br><br><ul><li>  Die gro√üartige Konstruktion <i>mit request () als Antwort:</i> Sie k√∂nnen sie erfolgreich durch <i>response = request ()</i> ersetzen und leise mit dem Antwortobjekt arbeiten </li><li>  Die URL wird mithilfe der in Python 3.6 hinzugef√ºgten Syntax des Zeichenfolgenformats gebildet, wenn ich mich nicht irre - <i>f '/ photos / {photo_id}'</i> .  In fr√ºheren Versionen funktioniert dieses Design nicht! </li><li>  Ein neues Argument, das wir zuvor nicht verwendet hatten, <i>catch_response = True</i> , teilt Locust mit, dass wir selbst den Erfolg der Serverantwort bestimmen werden.  Wenn Sie es nicht angeben, erhalten wir das Antwortobjekt auf die gleiche Weise und k√∂nnen seine Daten verarbeiten, aber das Ergebnis nicht neu definieren.  Unten finden Sie ein detailliertes Beispiel. </li><li>  Ein anderes Argument <i>name = '/ photos / [id]'</i> .  Es wird ben√∂tigt, um Anforderungen in Statistiken zu gruppieren.  Der Name kann ein beliebiger Text sein, eine Wiederholung der URL ist nicht erforderlich.  Ohne diese Option wird jede Anforderung mit einer eindeutigen Adresse oder Parametern separat aufgezeichnet.  So funktioniert es: <br></li></ul><br><img src="https://habrastorage.org/webt/ai/fm/ca/aifmcaycbzv9khpohj5sxjcohgo.png"><br>  Mit demselben Argument k√∂nnen Sie einen anderen Trick ausf√ºhren. Manchmal f√ºhrt ein Dienst mit unterschiedlichen Parametern (z. B. unterschiedlichen Inhalten von POST-Anforderungen) eine andere Logik aus.  Damit die Testergebnisse nicht verwechselt werden, k√∂nnen Sie mehrere separate Aufgaben schreiben und f√ºr jede ihren eigenen Argumentnamen <i>angeben</i> . <br><br>  Als n√§chstes machen wir die Kontrollen.  Ich habe zwei davon. Zuerst √ºberpr√ºfen wir, ob der Server eine Antwort zur√ºckgegeben hat, wenn <i>response.status_code == 200</i> : <br><br>  Wenn ja, √ºberpr√ºfen Sie, ob die ID des Albums ein Vielfaches von 10 ist. Wenn nicht ein Vielfaches, markieren Sie diese Antwort als erfolgreiche <i>Antwort. Success ()</i> <br><br>  In anderen F√§llen geben wir an, warum die Antwort fehlgeschlagen ist. <i>Response.failure ('Fehlertext')</i> .  Dieser Text wird w√§hrend des Tests auf der Seite Fehler angezeigt. <br><br><img src="https://habrastorage.org/webt/52/se/dt/52sedt-fqe0jhasmdnq3k94ia7m.png"><br><br>  Aufmerksame Leser k√∂nnten auch das Fehlen von Ausnahmen bemerken, die f√ºr Code charakteristisch sind, der mit Netzwerkschnittstellen funktioniert.  Im Fall von Zeit√ºberschreitung, Verbindungsfehlern und anderen unvorhergesehenen Vorf√§llen behandelt Locust die Fehler und gibt dennoch eine Antwort zur√ºck, wobei jedoch angezeigt wird, dass der Status des Antwortcodes 0 ist. <br><br>  Wenn der Code immer noch eine Ausnahme ausl√∂st, wird diese zur Laufzeit auf die Registerkarte Ausnahmen geschrieben, damit wir damit umgehen k√∂nnen.  Die typischste Situation ist, dass der json'e der Antwort nicht den gesuchten Wert zur√ºckgegeben hat, aber wir f√ºhren bereits die folgenden Operationen daran durch. <br><br>  Vor dem Schlie√üen des Themas - im Beispiel verwende ich aus Gr√ºnden der √úbersichtlichkeit den JSON-Server, da es einfacher ist, die Antworten zu verarbeiten.  Mit HTML, XML, FormData, Dateianh√§ngen und anderen Daten, die von HTTP-basierten Protokollen verwendet werden, k√∂nnen Sie jedoch mit demselben Erfolg arbeiten. <br><br><h2>  Arbeiten Sie mit komplexen Szenarien </h2><br>  Fast jedes Mal, wenn die Aufgabe darin besteht, Lasttests f√ºr eine Webanwendung durchzuf√ºhren, wird schnell klar, dass es unm√∂glich ist, eine angemessene Abdeckung mit GET-Diensten allein bereitzustellen, die einfach Daten zur√ºckgeben. <br><br>  Klassisches Beispiel: Um einen Online-Shop zu testen, ist es w√ºnschenswert, dass der Benutzer <br><br><ol><li>  √ñffnete den Hauptladen </li><li>  Ich habe nach Waren gesucht </li><li>  Details zum ge√∂ffneten Artikel </li><li>  Artikel in den Warenkorb gelegt </li><li>  Bezahlt </li></ol><br>  Aus dem Beispiel k√∂nnen wir annehmen, dass das Aufrufen von Diensten in zuf√§lliger Reihenfolge nicht funktioniert, sondern nur nacheinander.  Dar√ºber hinaus k√∂nnen Waren, K√∂rbe und Zahlungsarten f√ºr jeden Benutzer eindeutige Kennungen aufweisen. <br><br>  Mit dem vorherigen Beispiel k√∂nnen Sie mit geringf√ºgigen √Ñnderungen das Testen eines solchen Szenarios problemlos implementieren.  Wir passen das Beispiel f√ºr unseren Testserver an: <br><br><ol><li>  Benutzer schreibt einen neuen Beitrag </li><li>  Der Benutzer schreibt einen Kommentar zu dem neuen Beitrag </li><li>  Benutzer liest Kommentar </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlowException</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Exception)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_flow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># step 1 new_post = {'userId': 1, 'title': 'my shiny new post', 'body': 'hello everybody'} post_response = self.client.post('/posts', json=new_post) if post_response.status_code != 201: raise FlowException('post not created') post_id = post_response.json().get('id') # step 2 new_comment = { "postId": post_id, "name": "my comment", "email": "test@user.habr", "body": "Author is cool. Some text. Hello world!" } comment_response = self.client.post('/comments', json=new_comment) if comment_response.status_code != 201: raise FlowException('comment not created') comment_id = comment_response.json().get('id') # step 3 self.client.get(f'/comments/{comment_id}', name='/comments/[id]') if comment_response.status_code != 200: raise FlowException('comment not read') class WebsiteUser(HttpLocust): task_set = UserBehavior min_wait = 1000 max_wait = 2000</span></span></code> </pre> <br>  In diesem Beispiel habe ich eine neue <b>FlowException-</b> Klasse hinzugef√ºgt.  Wenn es nach jedem Schritt nicht wie erwartet gelaufen ist, habe ich diese Ausnahmeklasse ausgel√∂st, um das Skript abzubrechen. Wenn der Beitrag nicht funktioniert hat, gibt es nichts zu kommentieren usw.  Falls gew√ºnscht, kann die Konstruktion durch die √ºbliche <b>R√ºckgabe ersetzt</b> werden. In diesem Fall ist jedoch zur Laufzeit und bei der Analyse der Ergebnisse nicht klar, wo das ausgef√ºhrte Skript auf die Registerkarte Ausnahmen f√§llt.  Aus dem gleichen Grund verwende ich den <b>Versuch nicht ... au√üer</b> Konstrukt. <br><br><h2>  Die Last realistisch machen </h2><br>  Jetzt kann ich mir Vorw√ºrfe machen - im Fall des Gesch√§fts ist alles wirklich linear, aber das Beispiel mit Posts und Kommentaren ist zu weit hergeholt - sie lesen Posts zehnmal h√§ufiger als sie erstellen.  Lassen Sie uns das Beispiel vern√ºnftigerweise praktikabler machen.  Und es gibt mindestens zwei Ans√§tze: <br><br><ol><li>  Sie k√∂nnen die Liste der von Benutzern gelesenen Beitr√§ge ‚Äûfest codieren‚Äú und den Testcode vereinfachen, wenn eine solche M√∂glichkeit besteht und die Funktionalit√§t des Backends nicht von bestimmten Beitr√§gen abh√§ngt </li><li>  Speichern Sie erstellte Beitr√§ge und lesen Sie sie, wenn die Liste der Beitr√§ge nicht voreingestellt werden kann oder die realistische Belastung davon abh√§ngt, welche Beitr√§ge gelesen werden (ich habe die Erstellung von Kommentaren aus dem Beispiel entfernt, um den Code kleiner und visueller zu gestalten). </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> r <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> created_posts = [] @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> new_post = {<span class="hljs-string"><span class="hljs-string">'userId'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>: <span class="hljs-string"><span class="hljs-string">'my shiny new post'</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-string"><span class="hljs-string">'hello everybody'</span></span>} post_response = self.client.post(<span class="hljs-string"><span class="hljs-string">'/posts'</span></span>, json=new_post) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post_response.status_code != <span class="hljs-number"><span class="hljs-number">201</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> post_id = post_response.json().get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) self.created_posts.append(post_id) @task(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.created_posts) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> post_id = r.choice(self.created_posts) self.client.get(<span class="hljs-string"><span class="hljs-string">f'/posts/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{post_id}</span></span></span><span class="hljs-string">'</span></span>, name=<span class="hljs-string"><span class="hljs-string">'read post'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  In der <b>UserBehavior-</b> Klasse habe ich eine Liste mit erstellten <b>Posts erstellt</b> .  Achten Sie besonders darauf - dies ist ein Objekt, das nicht im Konstruktor der Klasse <b>__init __ () erstellt wurde.</b> Daher ist diese Liste im Gegensatz zur <b>Clientsitzung</b> f√ºr alle Benutzer gleich.  Die erste Aufgabe erstellt einen Beitrag und schreibt seine ID in die Liste.  Der zweite - zehnmal h√§ufiger - liest einen zuf√§llig ausgew√§hlten Beitrag aus der Liste.  Eine zus√§tzliche Bedingung f√ºr die zweite Aufgabe ist die √úberpr√ºfung, ob Beitr√§ge erstellt wurden. <br><br>  Wenn jeder Benutzer nur mit seinen eigenen Daten arbeiten soll, k√∂nnen wir diese im Konstruktor wie folgt deklarieren: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parent)</span></span></span><span class="hljs-function">:</span></span> super(UserBehavior, self).__init__(parent) self.created_posts = list()</code> </pre> <br><h2>  Einige weitere Funktionen </h2><br>  F√ºr das sequentielle Starten von Aufgaben wird in der offiziellen Dokumentation vorgeschlagen, dass wir auch die Aufgabenanmerkung @seq_task (1) verwenden und die Seriennummer der Aufgabe im Argument angeben <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTaskSequence</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSequence)</span></span></span><span class="hljs-class">:</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">3</span></span>) @task(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">third_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br>  In diesem Beispiel f√ºhrt jeder Benutzer zuerst die erste <b>Aufgabe</b> , dann die <b>zweite</b> <b>Aufgabe</b> und dann die <b>zehnfache</b> <b>dritte Aufgabe aus</b> . <br><br>  Ehrlich gesagt ist die Verf√ºgbarkeit einer solchen Gelegenheit erfreulich, aber im Gegensatz zu den vorherigen Beispielen ist nicht klar, wie die Ergebnisse der ersten Aufgabe bei Bedarf auf die zweite √ºbertragen werden sollen. <br><br>  In besonders komplexen Szenarien ist es auch m√∂glich, verschachtelte Task-Sets zu erstellen, indem mehrere TaskSet-Klassen erstellt und eine Verbindung hergestellt werden. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Todo</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/todos"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.interrupt() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> tasks = {Todo: <span class="hljs-number"><span class="hljs-number">1</span></span>} @task(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/posts"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  Im obigen Beispiel wird das <b>Todo-</b> Skript mit einer Wahrscheinlichkeit von 1 bis 6 gestartet und ausgef√ºhrt, bis es mit einer Wahrscheinlichkeit von 1 bis 4 zum <b>UserBehavior-</b> Skript zur√ºckkehrt.  Es ist sehr wichtig, dass Sie einen Aufruf von <b>self.interrupt () haben.</b> Ohne diesen Aufruf <b>konzentrieren sich die</b> Tests auf die Unteraufgabe. <br><br>  Danke f√ºrs Lesen.  Im letzten Artikel werde ich √ºber verteilte Tests und Tests ohne Benutzeroberfl√§che sowie √ºber die Schwierigkeiten, die ich beim Testen mit Locust hatte, und dar√ºber, wie ich sie umgehen kann, schreiben. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de430810/">https://habr.com/ru/post/de430810/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de430800/index.html">Erstellung des Spiels "Like Coins" auf Godot Engine. Teil 2</a></li>
<li><a href="../de430802/index.html">PMI RU: Studie √ºber die Geh√§lter von Projektmanagern in Russland f√ºr 2017</a></li>
<li><a href="../de430804/index.html">Tesla / Panasonic-Batterien sind die g√ºnstigsten Batterien f√ºr Elektrofahrzeuge auf dem Markt</a></li>
<li><a href="../de430806/index.html">Wir haben angefangen Englisch zu lernen - haben eine Anwendung geschrieben: EWM - Erfahrung bei der Erstellung eines Schulungsprojekts</a></li>
<li><a href="../de430808/index.html">Sprechertheorie: 16 Materialien zur Funktionsweise von Sprechern und Sprechern</a></li>
<li><a href="../de430812/index.html">Was developer.android.com √ºber RecyclerView spricht</a></li>
<li><a href="../de430818/index.html">SQLAlchemy-Beschleunigung f√ºr Architekturastronauten</a></li>
<li><a href="../de430820/index.html">Schwarzer Freitag 2018 - VDS in Moskau und Amsterdam</a></li>
<li><a href="../de430822/index.html">Informationssicherheit im Internet der Dinge: Wer ist das Ding und wer ist der Meister?</a></li>
<li><a href="../de430824/index.html">Suchen Sie in MS SQL Server 2005 nach besch√§digtem Objekt anhand der besch√§digten Seitenzahl</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>