<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÖ ‚§µÔ∏è üïµüèΩ "Sugar" hecho en casa para un proyecto de Android o "C√≥mo no hacerlo" üë©üèº‚Äçüöí üíÉüèª üéÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo es un conjunto de peque√±os cubos de az√∫car para un proyecto de Android, que encontr√© a su debido tiempo y que fue √∫til. Algunas cosas pu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Sugar" hecho en casa para un proyecto de Android o "C√≥mo no hacerlo"</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472196/">  Este art√≠culo es un conjunto de peque√±os cubos de az√∫car para un proyecto de Android, que encontr√© a su debido tiempo y que fue √∫til.  Algunas cosas pueden no ser soluciones ideales, pero pueden serle √∫tiles de la misma manera que me fueron √∫tiles alguna vez. <br><a name="habracut"></a><br><h3>  Aplicaci√≥n y tostadas </h3><br>  Lo primero que siempre puede ser √∫til y que a veces se necesita en cualquier punto del programa es un enlace a la Aplicaci√≥n.  Esto se resuelve mediante una clase simple, cuyo enlace est√° registrado en AndroidManifest. <br><br><pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { APP = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> APP: App } }</code> </pre> <br>  Gracias a esto, siempre hay acceso al contexto de toda la aplicaci√≥n y puede obtener l√≠neas / recursos desde cualquier lugar.  Y al menos esto es necesario para el siguiente grano de az√∫car: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(messageId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { Toast.makeText(App.APP, messageId, Toast.LENGTH_LONG).show() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { Toast.makeText(App.APP, message, Toast.LENGTH_LONG).show() }</code> </pre> <br>  Un poco, pero gracias a Kotlin y al hecho de que tenemos acceso al contexto, ahora puede llamar a Toast de forma breve y concisa desde cualquier lugar de la aplicaci√≥n.  Para que el m√©todo sea accesible en todas partes, se puede marcar en un archivo sin especificar la clase ra√≠z. <br><br><h3>  ¬øQui√©n est√° en la pantalla? </h3><br>  Los programas con una actividad est√°n ganando popularidad.  Pero para nuestra arquitectura, se decidi√≥ utilizar varias actividades.  Al menos para separar la l√≥gica de autorizaci√≥n y la parte principal de la aplicaci√≥n.  Con el tiempo, era necesario comprender si la pantalla es visible y qu√© parte de la aplicaci√≥n es.  Y en el futuro, tambi√©n era necesario obtener cadenas en la configuraci√≥n regional de la aplicaci√≥n.  Pero lo primero es lo primero.  Para que nuestro valor de APP no se aburra solo, la compa√±√≠a lo har√°: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> screenActivity: AppCompatActivity? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> onScreen: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  Y luego, creamos nuestra clase base, heredada de AppCompatActivity: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppCompatActivity</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onStart() App.onScreen = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onStop() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (App.screenActivity == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { App.onScreen = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFinishing()) App.screenActivity = <span class="hljs-literal"><span class="hljs-literal">null</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDestroy() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (App.screenActivity == <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) App.screenActivity = <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { App.screenActivity = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRestart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onRestart() App.screenActivity = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } }</code> </pre> <br>  S√≠, para las nuevas gu√≠as, puede suscribirse a Lifecycle with Activity en los lugares necesarios.  Pero tenemos lo que tenemos. <br><br><h3>  Cadenas localizadas </h3><br>  Existen funcionalidades de dudosa utilidad, pero TK es TK.  A dicha funcionalidad, atribuir√≠a la elecci√≥n del idioma en la aplicaci√≥n en lugar del sistema.  Durante mucho tiempo, hay un c√≥digo que le permite reemplazar el lenguaje mediante programaci√≥n.  Pero nos enfrentamos a un error, que probablemente solo se repite con nosotros.  La esencia del error es que si lleva la l√≠nea a trav√©s del contexto de la aplicaci√≥n, y no a trav√©s del contexto de Actividad, la l√≠nea vuelve a las configuraciones regionales del sistema.  Y no siempre es conveniente lanzar el contexto de una Actividad.  Los siguientes m√©todos vinieron al rescate: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Resources = screenActivity?.resources ?: APP.resources <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocalizedString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stringId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String = getRes().getString(stringId) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLocalizedString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stringId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">vararg</span></span></span></span><span class="hljs-function"><span class="hljs-params"> formatArgs: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: String = getRes().getString(stringId, *formatArgs)</code> </pre> <br>  Y ahora, desde cualquier lugar de la aplicaci√≥n, podemos obtener la cadena en la configuraci√≥n regional correcta. <br><br><h3>  Preferencias compartidas </h3><br>  Como con todas las aplicaciones, la nuestra tiene que almacenar algunas configuraciones en SharedPreferences.  Y para simplificar la vida, se invent√≥ una clase que oculta un poco de l√≥gica en s√≠ misma.  Para comenzar, se agreg√≥ un nuevo amigo para la variable APP: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> settings: SharedPreferences</code> </pre><br>  Se inicializa cuando se inicia la aplicaci√≥n y siempre est√° disponible para nosotros. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PreferenceString</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> def: String = <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> store: SharedPreferences = App.settings, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> listener: ModifyListener? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value: String <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() { listener?.customGet() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.getString(key, def) ?: def } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(value) { store.edit().putString(key, value).apply() listener?.customSet() } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModifyListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">customGet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">customSet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {} }</code> </pre><br>  Por supuesto, tendr√° que generar una clase de este tipo para cada tipo de variable, pero puede reemplazar singleton con todas las configuraciones necesarias, por ejemplo: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> PREF_LANGUAGE = PreferenceString(<span class="hljs-string"><span class="hljs-string">"pref_language"</span></span>, <span class="hljs-string"><span class="hljs-string">"ru"</span></span>)</code> </pre> <br>  Y ahora siempre puede referirse a la configuraci√≥n como un campo, y la carga / guardado y la comunicaci√≥n a trav√©s del oyente estar√°n ocultos. <br><br><h3>  Orientaci√≥n y Tableta </h3><br>  ¬øHas tenido que apoyar ambas orientaciones?  ¬øY c√≥mo determinaste en qu√© orientaci√≥n est√°s ahora?  Tenemos un m√©todo conveniente para esto, que nuevamente se puede llamar desde cualquier lugar y no importa el contexto: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isLandscape</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getRes().configuration.orientation == Configuration.ORIENTATION_LANDSCAPE }</code> </pre> <br>  Si pones valores / dimen.xml: <br><br><pre> <code class="kotlin hljs">&lt;bool name=<span class="hljs-string"><span class="hljs-string">"isTablet"</span></span>&gt;<span class="hljs-literal"><span class="hljs-literal">false</span></span>&lt;/bool&gt;</code> </pre> <br>  Y en valores-large / dimen.xml: <br><br><pre> <code class="kotlin hljs">&lt;bool name=<span class="hljs-string"><span class="hljs-string">"isTablet"</span></span>&gt;<span class="hljs-literal"><span class="hljs-literal">true</span></span>&lt;/bool&gt;</code> </pre> <br>  Entonces tambi√©n puedes crear un m√©todo: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isTablet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getRes().getBoolean(R.bool.isTablet) }</code> </pre><br><h3>  Formato de fecha </h3><br>  Multithreading.  A veces es una palabra aterradora.  Una vez atrapamos un error muy extra√±o cuando formamos l√≠neas de fechas en el fondo.  Result√≥ que SimpleDateFormat no es seguro para subprocesos.  Por lo tanto, naci√≥ lo siguiente: <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThreadSafeDateFormat</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pattern: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> isUTC: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locale: Locale = DEFAULT_LOCALE){ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dateFormatThreadLocal = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : ThreadLocal&lt;SimpleDateFormat&gt;(){ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: SimpleDateFormat? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SimpleDateFormat(pattern, locale) } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> formatter: SimpleDateFormat <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dateFormat = dateFormatThreadLocal.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() ?: SimpleDateFormat(pattern, locale) dateFormat.timeZone = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isUTC) TimeZone.getTimeZone(<span class="hljs-string"><span class="hljs-string">"UTC"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> timeZone <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dateFormat } }</code> </pre><br>  Y un ejemplo de uso (s√≠, esto se usa nuevamente dentro del singleton): <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> utcDateSendSafeFormat = ThreadSafeDateFormat(<span class="hljs-string"><span class="hljs-string">"yyyy-MM-dd"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> utcDateSendFormat: SimpleDateFormat <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = utcDateSendSafeFormat.formatter</code> </pre><br>  Para toda la aplicaci√≥n, nada ha cambiado y el problema con los hilos ha sido resuelto. <br><br><h3>  Textwatcher </h3><br>  Y nunca se molest√≥ en que si necesita capturar el texto que se ingresa en EditText, entonces debe usar TextWatcher e implementar 3 (!) M√©todos.  No es cr√≠tico, pero no conveniente.  Y todo lo decide la clase: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TextWatcherObject</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TextWatcher{ override fun afterTextChanged</span></span></span></span>(p0: Editable?) {} <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeTextChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p0: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CharSequence</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, p1: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, p2: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, p3: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTextChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p0: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CharSequence</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, p1: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, p2: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, p3: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> {} }</code> </pre><br><h3>  Teclado </h3><br>  Lo que siempre se necesita.  Debe mostrar inmediatamente el teclado, luego, en alg√∫n momento, debe ocultarlo.  Y luego se necesitan los siguientes dos m√©todos.  En el segundo caso, debe pasar la vista ra√≠z. <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showKeyboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EditText</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ view.requestFocus(); (App.APP.getSystemService(Context.INPUT_METHOD_SERVICE) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> InputMethodManager?) ?.toggleSoftInput(InputMethodManager.SHOW_FORCED, InputMethodManager.HIDE_IMPLICIT_ONLY) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideKeyboardFrom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { (App.APP.getSystemService(Activity.INPUT_METHOD_SERVICE) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> InputMethodManager?) ?.hideSoftInputFromWindow(view.windowToken, <span class="hljs-number"><span class="hljs-number">0</span></span>) }</code> </pre> <br>  Y, tal vez alguien sea √∫til, una funci√≥n para copiar cualquier l√≠nea en un portapapeles con tostadas mostrando: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> String.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toClipboard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(toast: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clip = ClipData.newPlainText(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) (App.APP.getSystemService(Context.CLIPBOARD_SERVICE) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ClipboardManager?)?.setPrimaryClip(clip) Toast(toast) }</code> </pre> <br><h3>  RecyclerView y TableLayout </h3><br>  Y al final de este peque√±o art√≠culo, quiero compartir lo que recientemente tuve que resolver.  Tal vez alguien sea √∫til. <br><br>  Los datos iniciales son los siguientes: <br><br><ol><li>  1k + datos para mostrar. </li><li>  Cada "celda" consta de aproximadamente 10 campos. </li><li>  es necesario capturar deslizar, hacer clic, doble clic, clic largo. </li><li>  y ...  los datos se actualizan cada 300 a 500 milisegundos. </li></ol><br>  Si te olvidas del primer punto.  entonces la soluci√≥n m√°s funcional es TableLayout.  ¬øPor qu√© no RecyclerView?  Y por 3 y 4 puntos.  Hay optimizaciones dentro de la hoja y reutiliza la vista, pero no siempre.  Y al momento de crear una nueva vista, no existen controladores t√°ctiles.  Y bueno, si solo afect√≥ el deslizamiento, pero de vez en cuando el problema se reproduce con el toque habitual.  Incluso actualizar los datos directamente en la Vista no ayuda, y no a trav√©s de notificar.  Por lo tanto, se decidi√≥ usar TableLayout.  Y todo estuvo bien, hasta que los datos no fueron m√°s de 100. Y luego, bienvenidos al mundo de las congelaciones. <br><br>  Vi 2 formas de resolver, o ense√±arle a TableLayout a reutilizar celdas y hacer magia al desplazarse.  O intente hacer amigos RecyclerView y actualizaciones frecuentes.  Y fui por el segundo camino.  Dado que los toques y deslizamientos (principalmente debido a deslizamientos) fueron procesados ‚Äã‚Äãpor una clase autoescrita basada en View.OnTouchListener, result√≥ ser una soluci√≥n efectiva para mover el procesamiento t√°ctil al nivel RecyclerView al anular el m√©todo dispatchTouchEvent. <br><br>  El algoritmo es simple: <br><br><ul><li>  coger toque </li><li>  determinar qu√© ni√±o vuela el toque con findChildViewUnder (x, y) </li><li>  obtener la posici√≥n del elemento del LayoutManager </li><li>  si es MotionEvent.ACTION_MOVE, entonces verificamos con la misma posici√≥n en la que trabajamos que antes o no </li><li>  realizar la l√≥gica incrustada para tocar </li></ul><br>  Quiz√°s en el futuro todav√≠a habr√° problemas con este m√©todo, pero en este momento todo est√° funcionando y esto es bueno. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/472196/">https://habr.com/ru/post/472196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../472182/index.html">Anuncio de .NET Core 3.1 Preview 1</a></li>
<li><a href="../472184/index.html">SSH remoto: consejos y trucos</a></li>
<li><a href="../472186/index.html">Principio abierto-cerrado</a></li>
<li><a href="../472188/index.html">Lo que necesita saber sobre la verificaci√≥n de cheques de la tienda de aplicaciones (recibo de la tienda de aplicaciones)</a></li>
<li><a href="../472190/index.html">Ejecute scripts PHP a trav√©s de php-fpm sin un servidor web. O su cliente FastCGI (bajo el cap√≥)</a></li>
<li><a href="../472198/index.html">Localizaci√≥n de mensajes push en aplicaciones m√≥viles.</a></li>
<li><a href="../472200/index.html">Modernizaci√≥n de la clase de inform√°tica en una escuela rusa sobre frambuesa: barata y alegre</a></li>
<li><a href="../472202/index.html">Windows 10 + Python = C√≥digo VS + WSL</a></li>
<li><a href="../472204/index.html">Experimentos simples con el microcontrolador STM32F103 (Blue Tablet)</a></li>
<li><a href="../472208/index.html">Pantallas OLED de tel√©fonos inteligentes Android y c√≥mo lidiar con ellos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>