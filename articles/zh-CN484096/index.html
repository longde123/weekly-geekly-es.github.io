<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§•ğŸ¿ ğŸ‘’ ğŸ‘¨ğŸ¿â€ğŸš’ ä¸¤ä¸ªYakozunä¹‹æˆ˜ï¼Œæˆ–Cassandraä¸HBaseã€‚ Sberbankå›¢é˜Ÿç»éªŒ ğŸ¥  ğŸŒ· âœğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¿™ç”šè‡³ä¸æ˜¯åœ¨å¼€ç©ç¬‘ï¼Œä¼¼ä¹è¿™å¼ ç‰¹å®šçš„å›¾ç‰‡æœ€å‡†ç¡®åœ°åæ˜ äº†è¿™äº›æ•°æ®åº“çš„æœ¬è´¨ï¼Œæœ€åå°†æ¸…æ¥šä¸ºä»€ä¹ˆï¼š 



 æ ¹æ®DB-Enginesæ’åï¼Œä¸¤ä¸ªæœ€å—æ¬¢è¿çš„NoSQLåˆ—åŸºç¡€æ˜¯Cassandraï¼ˆä»¥ä¸‹ç®€ç§°CSï¼‰å’ŒHBaseï¼ˆHBï¼‰ã€‚ 



 ä¾ç…§å‘½è¿çš„æ„æ„¿ï¼Œæˆ‘ä»¬ä½äºSberbankçš„æ•°æ®åŠ è½½ç®¡ç†å›¢é˜Ÿä¸HB é•¿æœŸ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä¸¤ä¸ªYakozunä¹‹æˆ˜ï¼Œæˆ–Cassandraä¸HBaseã€‚ Sberbankå›¢é˜Ÿç»éªŒ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/484096/"> è¿™ç”šè‡³ä¸æ˜¯åœ¨å¼€ç©ç¬‘ï¼Œä¼¼ä¹è¿™å¼ ç‰¹å®šçš„å›¾ç‰‡æœ€å‡†ç¡®åœ°åæ˜ äº†è¿™äº›æ•°æ®åº“çš„æœ¬è´¨ï¼Œæœ€åå°†æ¸…æ¥šä¸ºä»€ä¹ˆï¼š <br><br><img src="https://habrastorage.org/webt/i2/lk/zo/i2lkzo9tq7zpeprcbtgm3-mufk4.png"><br><br> æ ¹æ®DB-Enginesæ’åï¼Œä¸¤ä¸ªæœ€å—æ¬¢è¿çš„NoSQLåˆ—åŸºç¡€æ˜¯Cassandraï¼ˆä»¥ä¸‹ç®€ç§°CSï¼‰å’ŒHBaseï¼ˆHBï¼‰ã€‚ <br><br><img src="https://habrastorage.org/webt/su/rd/39/surd39n7bmrbnxgpn0512tnxamm.png"><br><br> ä¾ç…§å‘½è¿çš„æ„æ„¿ï¼Œæˆ‘ä»¬ä½äºSberbankçš„æ•°æ®åŠ è½½ç®¡ç†å›¢é˜Ÿä¸HB <a href="https://habr.com/ru/company/sberbank/blog/420425/">é•¿æœŸ</a>åˆä½œå¯†åˆ‡ã€‚ åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæˆ‘ä»¬å¾ˆå¥½åœ°ç ”ç©¶äº†å®ƒçš„ä¼˜ç¼ºç‚¹ï¼Œå¹¶å­¦ä¼šäº†å¦‚ä½•çƒ¹é¥ªã€‚ ä½†æ˜¯ï¼Œä¸€ç›´ä»¥æ¥ï¼Œä»¥CSå½¢å¼å‡ºç°çš„æ›¿ä»£æ–¹æ¡ˆä½¿æˆ‘æ„Ÿåˆ°ç–‘æƒ‘ï¼šæˆ‘ä»¬æ˜¯å¦åšå‡ºäº†æ­£ç¡®çš„é€‰æ‹©ï¼Ÿ æ­¤å¤–ï¼ŒDataStaxè¿›è¡Œçš„<a href="https://www.datastax.com/products/compare/nosql-performance-benchmarks">æ¯”è¾ƒ</a>ç»“æœè¡¨æ˜ï¼ŒCSå‡ ä¹å¯ä»¥å‡»ç¢å¾—åˆ†ï¼Œè½»æ¾å‡»è´¥HBã€‚ å¦ä¸€æ–¹é¢ï¼ŒDataStaxæ˜¯ä¸€ä¸ªæœ‰å…´è¶£çš„äººï¼Œæ‚¨ä¸è¦åœ¨è¿™é‡Œè¯´ä»€ä¹ˆã€‚ è€Œä¸”ï¼Œå…³äºæµ‹è¯•æ¡ä»¶çš„ç›¸å½“å°‘çš„ä¿¡æ¯ä»¤äººå°´å°¬ï¼Œå› æ­¤æˆ‘ä»¬å†³å®šç‹¬ç«‹æ‰¾å‡ºè°æ˜¯BigData NoSqlçš„ç‹è€…ï¼Œç»“æœéå¸¸æœ‰è¶£ã€‚ <br><a name="habracut"></a><br> ä½†æ˜¯ï¼Œåœ¨ç»§ç»­è¿›è¡Œæµ‹è¯•çš„ç»“æœä¹‹å‰ï¼Œæœ‰å¿…è¦æè¿°ç¯å¢ƒé…ç½®çš„åŸºæœ¬æ–¹é¢ã€‚ äº‹å®æ˜¯CSå¯ä»¥åœ¨æ•°æ®ä¸¢å¤±å®¹å¿æ¨¡å¼ä¸‹ä½¿ç”¨ã€‚ å³ è¿™æ˜¯å½“åªæœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼ˆèŠ‚ç‚¹ï¼‰è´Ÿè´£æŸä¸ªé”®çš„æ•°æ®æ—¶ï¼Œå¦‚æœç”±äºæŸç§åŸå› å®ƒæ‰çº¿äº†ï¼Œåˆ™è¯¥é”®çš„å€¼å°†ä¸¢å¤±ã€‚ å¯¹äºè®¸å¤šä»»åŠ¡è€Œè¨€ï¼Œè¿™å¹¶ä¸é‡è¦ï¼Œä½†å¯¹äºé“¶è¡Œä¸šè€Œè¨€ï¼Œè¿™æ˜¯ä¾‹å¤–è€Œä¸æ˜¯è§„åˆ™ã€‚ åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œé‡è¦çš„æ˜¯è¦æ‹¥æœ‰å¤šä¸ªæ•°æ®å‰¯æœ¬ä»¥è¿›è¡Œå¯é çš„å­˜å‚¨ã€‚ <br><br> å› æ­¤ï¼Œä»…è€ƒè™‘ä¸‰é‡å¤åˆ¶çš„CSæ¨¡å¼ï¼Œå³ã€‚ ç”¨ä»¥ä¸‹å‚æ•°åˆ›å»ºæ¡ˆä¾‹ï¼š <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> KEYSPACE ks <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLICATION</span></span> = {<span class="hljs-string"><span class="hljs-string">'class'</span></span> : <span class="hljs-string"><span class="hljs-string">'NetworkTopologyStrategy'</span></span>, <span class="hljs-string"><span class="hljs-string">'datacenter1'</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>};</code> </pre> <br> æ­¤å¤–ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ç¡®ä¿æ‰€éœ€çš„ä¸€è‡´æ€§ã€‚ ä¸€èˆ¬è§„åˆ™ï¼š <br>  NW + NR&gt;å°„é¢‘ <br><br> è¿™æ„å‘³ç€å†™å…¥æ—¶æ¥è‡ªèŠ‚ç‚¹çš„ç¡®è®¤æ•°ï¼ˆNWï¼‰åŠ ä¸Šè¯»å–æ—¶æ¥è‡ªèŠ‚ç‚¹çš„ç¡®è®¤æ•°ï¼ˆNRï¼‰å¿…é¡»å¤§äºå¤åˆ¶å› å­ã€‚ åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼ŒRF = 3ï¼Œå› æ­¤ä»¥ä¸‹é€‰é¡¹é€‚ç”¨ï¼š <br>  2 + 2&gt; 3 <br>  3 +1&gt; 3 <br><br> ç”±äºå¯¹æˆ‘ä»¬è€Œè¨€ï¼Œä¿æŒæ•°æ®å°½å¯èƒ½å¯é è‡³å…³é‡è¦ï¼Œå› æ­¤é€‰æ‹©äº†3 + 1æ–¹æ¡ˆã€‚ æ­¤å¤–ï¼ŒHBåœ¨ç±»ä¼¼çš„åŸºç¡€ä¸Šå·¥ä½œï¼Œå³ è¿™æ ·çš„æ¯”è¾ƒä¼šæ›´è¯šå®ã€‚ <br><br> åº”å½“æŒ‡å‡ºï¼ŒDataStaxåœ¨ä»–ä»¬çš„ç ”ç©¶ä¸­åšçš„æ˜¯ç›¸åçš„ï¼Œä»–ä»¬ä¸ºCSå’ŒHBéƒ½è®¾ç½®äº†RF = 1ï¼ˆå¯¹äºåè€…ï¼Œé€šè¿‡æ›´æ”¹HDFSè®¾ç½®ï¼‰ã€‚ è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹é¢ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹CSæ€§èƒ½çš„å½±å“å¾ˆå¤§ã€‚ ä¾‹å¦‚ï¼Œä¸‹å›¾æ˜¾ç¤ºäº†å°†æ•°æ®åŠ è½½åˆ°CSä¸­æ‰€éœ€çš„æ—¶é—´å¢åŠ ï¼š <br><br><img src="https://habrastorage.org/webt/fw/az/r9/fwazr9muypegpgjpyaq4rnagg8u.png"><br><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼Œç«äº‰è¶Šå¤šçš„çº¿ç¨‹å†™å…¥æ•°æ®ï¼ŒèŠ±è´¹çš„æ—¶é—´è¶Šé•¿ã€‚ è¿™æ˜¯è‡ªç„¶çš„ï¼Œä½†é‡è¦çš„æ˜¯RF = 3çš„æ€§èƒ½ä¸‹é™è¦é«˜å¾—å¤šã€‚ æ¢å¥è¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬åœ¨5ä¸ªæµä¸­çš„æ¯ä¸ªæµä¸­å†™å…¥4ä¸ªè¡¨ï¼ˆæ€»è®¡20ä¸ªï¼‰ï¼Œåˆ™RF = 3æŸå¤±å¤§çº¦2å€ï¼ˆ150ç§’RF = 3ï¼Œè€ŒRF = 1åˆ™ä¸º75ï¼‰ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡å°†æ•°æ®åŠ è½½åˆ°5ä¸ªæµä¸­çš„æ¯ä¸ªæµä¸­çš„8ä¸ªè¡¨ä¸­æ¥å¢åŠ è´Ÿè½½ï¼ˆæ€»è®¡40ä¸ªï¼‰ï¼Œé‚£ä¹ˆä¸¢å¤±RF = 3å·²ç»æ˜¯2.7å€ï¼ˆ375ç§’å¯¹138ç§’ï¼‰ã€‚ <br><br> è¿™ä¹Ÿè®¸éƒ¨åˆ†æ˜¯æˆåŠŸè¿›è¡ŒCSè´Ÿè½½æµ‹è¯•çš„DataStaxæµ‹è¯•çš„ç§˜å¯†ï¼Œå› ä¸ºå¯¹äºæˆ‘ä»¬å…¬å¸çš„HBè€Œè¨€ï¼Œå°†å¤åˆ¶å› å­ä»2æ›´æ”¹ä¸º3æ— æ•ˆã€‚ å³ å¯¹äºæˆ‘ä»¬çš„é…ç½®ï¼Œå…‰ç›˜ä¸æ˜¯HBçš„ç“¶é¢ˆã€‚ ä½†æ˜¯ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–é™·é˜±ï¼Œå› ä¸ºåº”è¯¥æ³¨æ„ï¼Œæˆ‘ä»¬çš„HBç‰ˆæœ¬â€‹â€‹ç•¥æœ‰æ‰“è¡¥ä¸å’Œæ¨¡ç³Šä¸æ¸…ï¼Œç¯å¢ƒå®Œå…¨ä¸åŒï¼Œç­‰ç­‰ã€‚ è¿˜è¦æŒ‡å‡ºçš„æ˜¯ï¼Œä¹Ÿè®¸æˆ‘åªæ˜¯ä¸çŸ¥é“å¦‚ä½•æ­£ç¡®å‡†å¤‡CSï¼Œå¹¶ä¸”æœ‰ä¸€äº›æ›´æœ‰æ•ˆçš„å¤„ç†æ–¹å¼ï¼Œå¸Œæœ›æˆ‘èƒ½åœ¨è¯„è®ºä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚ ä½†æ˜¯é¦–å…ˆæ˜¯ç¬¬ä¸€ä»¶äº‹ã€‚ <br><br> æ‰€æœ‰æµ‹è¯•éƒ½æ˜¯åœ¨ç”±4ä¸ªæœåŠ¡å™¨ç»„æˆçš„é“ç¾¤é›†ä¸Šæ‰§è¡Œçš„ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½å…·æœ‰ä»¥ä¸‹é…ç½®ï¼š <br><br>  <i>CPUï¼šXeon E5-2680 v4 @ 2.40GHz 64çº¿ç¨‹</i> <i><br></i>  <i>ç£ç›˜ï¼š12ä¸ªSATA HDD</i> <i><br></i>  <i>Javaç‰ˆæœ¬ï¼š1.8.0_111</i> <i><br></i> <br><br>  CSç‰ˆæœ¬ï¼š3.11.5 <br><br><div class="spoiler">  <b class="spoiler_title">å‚æ•°cassandra.yml</b> <div class="spoiler_text">  num_tokensï¼š256 <br>  hinted_handoff_enabledï¼šæ˜¯ <br>  hinted_handoff_throttle_in_kbï¼š1024 <br>  max_hints_delivery_threadsï¼š2 <br>  hints_directoryï¼š/ data10 / cassandra /æç¤º <br>  hints_flush_period_in_msï¼š10000 <br>  max_hints_file_size_in_mbï¼š128 <br>  batchlog_replay_throttle_in_kbï¼š1024 <br> èº«ä»½éªŒè¯å™¨ï¼šAllowAllAuthenticator <br> æˆæƒè€…ï¼šAllowAllAuthorizer <br> è§’è‰²ç®¡ç†å™¨ï¼šCassandraRoleManager <br>  role_validity_in_msï¼š2000 <br>  Permissions_validity_in_msï¼š2000 <br>  certificate_validity_in_msï¼š2000 <br> åˆ†åŒºç¨‹åºï¼šorg.apache.cassandra.dht.Murmur3Partitioner <br>  data_file_directoriesï¼š <br>  -/ data1 / cassandra / dataï¼ƒæ¯ä¸ªdataNç›®å½•æ˜¯ä¸€ä¸ªå•ç‹¬çš„é©±åŠ¨å™¨ <br>  -/ data2 / cassandra /æ•°æ® <br>  -/ data3 / cassandra /æ•°æ® <br>  -/ data4 /å¡æ¡‘å¾·æ‹‰/æ•°æ® <br>  -/ data5 / cassandra /æ•°æ® <br>  -/ data6 / cassandra /æ•°æ® <br>  -/ data7 /å¡æ¡‘å¾·æ‹‰/æ•°æ® <br>  -/ data8 / cassandra /æ•°æ® <br>  commitlog_directoryï¼š/ data9 / cassandra / commitlog <br>  cdc_enabledï¼šå¦ <br>  disk_failure_policyï¼šåœæ­¢ <br>  commit_failure_policyï¼šåœæ­¢ <br>  prepare_statements_cache_size_mbï¼š <br>  thrift_prepared_statements_cache_size_mbï¼š <br>  key_cache_size_in_mbï¼š <br>  key_cache_save_periodï¼š14400 <br>  row_cache_size_in_mbï¼š0 <br>  row_cache_save_periodï¼š0 <br>  counter_cache_size_in_mbï¼š <br>  counter_cache_save_periodï¼š7200 <br>  saved_caches_directoryï¼š/ data10 / cassandra / saved_caches <br>  commitlog_syncï¼šå®šæœŸ <br>  commitlog_sync_period_in_msï¼š10000 <br>  commitlog_segment_size_in_mbï¼š32 <br>  seed_providerï¼š <br>  -ç±»åˆ«åç§°ï¼šorg.apache.cassandra.locator.SimpleSeedProvider <br> å‚æ•°ï¼š <br>  -ç§å­ï¼šâ€œ *ï¼Œ*â€ <br>  parallel_readsï¼š256ï¼ƒå·²å°è¯•64-æœªå‘ç°å·®å¼‚ <br>  parallel_writesï¼š256ï¼ƒå·²å°è¯•64-æœªå‘ç°å·®å¼‚ <br>  parallel_counter_writesï¼š256ï¼ƒå·²å°è¯•64-æœªå‘ç°å·®å¼‚ <br>  parallel_materialized_view_writesï¼š32 <br>  memtable_heap_space_in_mbï¼š2048ï¼ƒå°è¯•äº†16 GB-é€Ÿåº¦è¾ƒæ…¢ <br>  memtable_allocation_typeï¼šheap_buffers <br>  index_summary_capacity_in_mbï¼š <br>  index_summary_resize_interval_in_minutesï¼š60 <br>  tickle_fsyncï¼šå¦ <br>  rickle_fsync_interval_in_kbï¼š10240 <br>  storage_portï¼š7000 <br>  ssl_storage_portï¼š7001 <br>  listen_addressï¼š* <br>  broadcast_addressï¼š* <br>  listen_on_broadcast_addressï¼šä¸ºtrue <br>  internode_authenticatorï¼šorg.apache.cassandra.auth.AllowAllInternodeAuthenticator <br>  start_native_transportï¼šæ­£ç¡® <br>  native_transport_portï¼š9042 <br>  start_rpcï¼šæ˜¯ <br>  rpc_addressï¼š* <br>  rpc_portï¼š9160 <br>  rpc_keepaliveï¼šæ­£ç¡® <br>  rpc_server_typeï¼šåŒæ­¥ <br>  thrift_framed_transport_size_in_mbï¼š15 <br> å¢é‡å¤‡ä»½ï¼šfalse <br>  snapshot_before_compactionï¼šå¦ <br>  auto_snapshotï¼šä¸ºtrue <br>  column_index_size_in_kbï¼š64 <br>  column_index_cache_size_in_kbï¼š2 <br>  parallel_compactorsï¼š4ä¸ª <br>  compaction_throughput_mb_per_secï¼š1600 <br>  sstable_preemptive_open_interval_in_mbï¼š50 <br>  read_request_timeout_in_msï¼š100000 <br>  range_request_timeout_in_msï¼š200000 <br>  write_request_timeout_in_msï¼š40000 <br>  counter_write_request_timeout_in_msï¼š100000 <br>  cas_contention_timeout_in_msï¼š20000 <br>  truncate_request_timeout_in_msï¼š60000 <br>  request_timeout_in_msï¼š200000 <br>  slow_query_log_timeout_in_msï¼š500 <br>  cross_node_timeoutï¼šå¦ <br>  endpoint_snitchï¼šGossipingPropertyFileSnitch <br>  dynamic_snitch_update_interval_in_msï¼š100 <br>  dynamic_snitch_reset_interval_in_msï¼š600000 <br>  dynamic_snitch_badness_thresholdï¼š0.1 <br>  request_schedulerï¼šorg.apache.cassandra.scheduler.NoScheduler <br>  server_encryption_optionsï¼š <br>  internode_encryptionï¼šæ—  <br>  client_encryption_optionsï¼š <br> å¯ç”¨ï¼šfalse <br>  internode_compressionï¼šç›´æµ <br>  inter_dc_tcp_nodelayï¼šå‡ <br>  tracetype_query_ttlï¼š86400 <br>  tracetype_repair_ttlï¼š604800 <br>  enable_user_defined_functionsï¼šå¦ <br>  enable_scripted_user_defined_functionsï¼šå¦ <br>  windows_timer_intervalï¼š1 <br>  transparent_data_encryption_optionsï¼š <br> å¯ç”¨ï¼šfalse <br>  tombstone_warn_thresholdï¼š1000 <br>  tombstone_failure_thresholdï¼š100000 <br>  batch_size_warn_threshold_in_kbï¼š200 <br>  batch_size_fail_threshold_in_kbï¼š250 <br>  unlogged_batch_across_partitions_warn_thresholdï¼š10 <br>  compaction_large_partition_warning_threshold_mbï¼š100 <br>  gc_warn_threshold_in_msï¼š1000 <br>  back_pressure_enabledï¼šå¦ <br>  enable_materialized_viewsï¼štrue <br>  enable_sasi_indexesï¼šæ˜¯ <br></div></div><br>  GCè®¾ç½®ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">### CMSè®¾ç½®</b> <div class="spoiler_text">  -XXï¼š+ UseParNewGC <br>  -XXï¼š+ UseConcMarkSweepGC <br>  -XXï¼š+ CMSParallelRemarkEnabled <br>  -XXï¼šSurvivorRatio = 8 <br>  -XXï¼šMaxTenuringThreshold = 1 <br>  -XXï¼šCMSInitiatingOccupancyFraction = 75 <br>  -XXï¼š+ä»…ä½¿ç”¨CMSInitiatingOccupancy <br>  -XXï¼šCMSWaitDuration = 10000 <br>  -XXï¼š+ CMSParallelInitialMarkEnabled <br>  -XXï¼š+ CMSEdenChunksRecordAlways <br>  -XXï¼š+ CMSClassUnloadingEnabled <br><br></div></div><br> å†…å­˜jvm.optionsåˆ†é…äº†16 Gbï¼ˆä»å°è¯•32 Gbï¼Œæœªå‘ç°å·®å¼‚ï¼‰ã€‚ <br><br> åˆ›å»ºè¡¨æ˜¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œçš„ï¼š <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> ks.t1 (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, title <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> compression = {<span class="hljs-string"><span class="hljs-string">'sstable_compression'</span></span>: <span class="hljs-string"><span class="hljs-string">'LZ4Compressor'</span></span>, <span class="hljs-string"><span class="hljs-string">'chunk_length_kb'</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span>};</code> </pre> <br>  HBç‰ˆæœ¬ï¼š1.2.0-cdh5.14.2ï¼ˆåœ¨org.apache.hadoop.hbase.regionserver.HRegionç±»ä¸­ï¼Œæˆ‘ä»¬æ’é™¤äº†MetricsRegionï¼Œå®ƒå¯¼è‡´RegionServerä¸Šå…·æœ‰1000å¤šä¸ªåŒºåŸŸçš„GCï¼‰ <br><br><div class="spoiler">  <b class="spoiler_title">éé»˜è®¤HBaseé€‰é¡¹</b> <div class="spoiler_text">  zookeeper.session.timeoutï¼š120000 <br>  hbase.rpc.timeoutï¼š2åˆ†é’Ÿï¼ˆç§’ï¼‰ <br>  hbase.client.scanner.timeout.periodï¼š2åˆ†é’Ÿï¼ˆç§’ï¼‰ <br>  hbase.master.handler.countï¼š10 <br>  hbase.regionserver.lease.periodï¼Œhbase.client.scanner.timeout.periodï¼š2åˆ†é’Ÿ <br>  hbase.regionserver.handler.countï¼š160 <br>  hbase.regionserver.metahandler.countï¼š30 <br>  hbase.regionserver.logroll.periodï¼š4å°æ—¶ <br>  hbase.regionserver.maxlogsï¼š200 <br>  hbase.hregion.memstore.flush.sizeï¼š1 GiB <br>  hbase.hregion.memstore.block.multiplierï¼š6 <br>  hbase.hstore.compactionThresholdï¼š5 <br>  hbase.hstore.blockingStoreFilesï¼š200 <br>  hbase.hregion.majorcompactionï¼š1å¤©ï¼ˆsï¼‰ <br> ç”¨äºhbase-site.xmlçš„HBaseæœåŠ¡é«˜çº§é…ç½®ä»£ç æ®µï¼ˆå®‰å…¨é˜€ï¼‰ï¼š <br>  hbase.regionserver.wal.codecorg.apache.hadoop.hbase.regionserver.wal.IndexedWALEditCodec <br>  hbase.master.namespace.init.timeout3600000 <br>  hbase.regionserver.optionalcacheflushinterval18000000 <br>  hbase.regionserver.thread.compaction.large12 <br>  hbase.regionserver.wal.enablecompressiontrue <br>  hbase.hstore.compaction.max.size1073741824 <br>  hbase.server.compactchecker.interval.multiplier200 <br>  HBase RegionServerçš„Javaé…ç½®é€‰é¡¹ï¼š <br>  -XXï¼š+ UseParNewGC -XXï¼š+ UseConcMarkSweepGC -XXï¼šCMSInitiatingOccupancyFraction = 70 -XXï¼š+ CMSParallelRemarkEnabled -XXï¼šReservedCodeCacheSize = 256m <br>  hbase.snapshot.master.timeoutMillisï¼š2åˆ†é’Ÿï¼ˆç§’ï¼‰ <br>  hbase.snapshot.region.timeoutï¼š2åˆ†é’Ÿï¼ˆç§’ï¼‰ <br>  hbase.snapshot.master.timeout.millisï¼š2åˆ†é’Ÿï¼ˆç§’ï¼‰ <br>  HBase REST Serveræœ€å¤§æ—¥å¿—å¤§å°ï¼š100 MiB <br>  HBase REST Serveræœ€å¤§æ—¥å¿—æ–‡ä»¶å¤‡ä»½ï¼š5 <br>  HBase Thrift Serveræœ€å¤§æ—¥å¿—å¤§å°ï¼š100 MiB <br>  HBase Thrift Serverçš„æœ€å¤§æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•°ï¼š5 <br> ä¸»æœ€å¤§æ—¥å¿—å¤§å°ï¼š100 MiB <br> ä¸»æœ€å¤§æ—¥å¿—æ–‡ä»¶å¤‡ä»½ï¼š5 <br>  RegionServeræœ€å¤§æ—¥å¿—å¤§å°ï¼š100 MiB <br>  RegionServeræ—¥å¿—æ–‡ä»¶æœ€å¤§å¤‡ä»½æ•°ï¼š5 <br>  HBase Active Masteræ£€æµ‹çª—å£ï¼š4åˆ†é’Ÿ <br>  dfs.client.hedged.read.threadpool.sizeï¼š40 <br>  dfs.client.hedged.read.threshold.millisï¼š10æ¯«ç§’ <br>  hbase.rest.threads.minï¼š8 <br>  hbase.rest.threads.maxï¼š150 <br> æœ€å¤§è¿›ç¨‹æ–‡ä»¶æè¿°ç¬¦ï¼š180,000 <br>  hbase.thrift.minWorkerThreadsï¼š200 <br>  hbase.master.executor.openregion.threadsï¼š30 <br>  hbase.master.executor.closeregion.threadsï¼š30 <br>  hbase.master.executor.serverops.threadsï¼š60 <br>  hbase.regionserver.thread.compaction.smallï¼š6 <br>  hbase.ipc.server.read.threadpool.sizeï¼š20 <br> åŒºåŸŸç§»åŠ¨çº¿ç¨‹ï¼š6 <br> å®¢æˆ·ç«¯Javaå †å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼š1 GiB <br>  HBase REST Serveré»˜è®¤ç»„ï¼š3 GiB <br>  HBase Thrift Serveré»˜è®¤ç»„ï¼š3 GiB <br>  HBaseä¸»ç«™çš„Javaå †å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼š16 GiB <br>  HBase RegionServerçš„Javaå †å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼š32 GiB <br><br>  + ZooKeeper <br>  maxClientCnxnsï¼š601 <br>  maxSessionTimeoutï¼š120000 </div></div><br> åˆ›å»ºè¡¨ï¼š <br>  <i>hbase org.apache.hadoop.hbase.util.RegionSplitter nsï¼št1 UniformSplit -c 64 -f cf</i> <i><br></i>  <i>alter'nsï¼št1'ï¼Œ{NAME =&gt;'cf'ï¼ŒDATA_BLOCK_ENCODING =&gt;'FAST_DIFF'ï¼ŒCOMPRESSION =&gt;'GZ'}</i> <br><br> æœ‰ä¸€ç‚¹å¾ˆé‡è¦-DataStaxæè¿°æ²¡æœ‰è¯´æ˜åˆ›å»ºHBè¡¨ä½¿ç”¨äº†å¤šå°‘ä¸ªåŒºåŸŸï¼Œå°½ç®¡è¿™å¯¹äºå¤§å®¹é‡è‡³å…³é‡è¦ã€‚ å› æ­¤ï¼Œå¯¹äºæµ‹è¯•ï¼Œé€‰æ‹©äº†æ•°å­—= 64ï¼Œè¿™å¯ä»¥å­˜å‚¨å¤šè¾¾640 GBçš„æ•°æ®ï¼Œå³ ä¸­å‹æ¡Œå­ã€‚ <br><br> åœ¨æµ‹è¯•æ—¶ï¼ŒHBaseæœ‰22,000ä¸ªè¡¨å’Œ67,000ä¸ªåŒºåŸŸï¼ˆå¦‚æœæ²¡æœ‰ä¸Šè¿°è¡¥ä¸ï¼Œè¿™å¯¹äº1.2.0ç‰ˆå°†æ˜¯è‡´å‘½çš„ï¼‰ã€‚ <br><br> ç°åœ¨è·å–ä»£ç ã€‚ ç”±äºå°šä¸æ¸…æ¥šå“ªç§é…ç½®å¯¹ç‰¹å®šæ•°æ®åº“æ›´æœ‰åˆ©ï¼Œå› æ­¤ä»¥å„ç§ç»„åˆæ–¹å¼è¿›è¡Œäº†æµ‹è¯•ã€‚ å³ åœ¨æŸäº›æµ‹è¯•ä¸­ï¼Œè´Ÿè½½åŒæ—¶ä¼ é€’åˆ°4ä¸ªè¡¨ï¼ˆæ‰€æœ‰4ä¸ªèŠ‚ç‚¹éƒ½ç”¨äºè¿æ¥ï¼‰ã€‚ åœ¨å…¶ä»–æµ‹è¯•ä¸­ï¼Œä»–ä»¬ä½¿ç”¨8ä¸ªä¸åŒçš„è¡¨ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‰¹å¤„ç†å¤§å°ä¸º100ï¼Œåœ¨å…¶ä»–æƒ…å†µä¸‹ä¸º200ï¼ˆæ‰¹å¤„ç†å‚æ•°-è¯·å‚è§ä¸‹é¢çš„ä»£ç ï¼‰ã€‚ å€¼çš„æ•°æ®å¤§å°ä¸º10å­—èŠ‚æˆ–100å­—èŠ‚ï¼ˆdataSizeï¼‰ã€‚ åœ¨æ¯ä¸ªè¡¨ä¸­ï¼Œæ€»å…±å†™å…¥å¹¶å‡å»500ä¸‡æ¡è®°å½•ã€‚ åŒæ—¶ï¼Œå‘æ¯ä¸ªè¡¨ä¸­å†™å…¥/è¯»å–äº†5ä¸ªæµï¼ˆæµå·ä¸ºthNumï¼‰ï¼Œæ¯ä¸ªæµéƒ½ä½¿ç”¨è‡ªå·±çš„é”®èŒƒå›´ï¼ˆè®¡æ•°= 1ç™¾ä¸‡ï¼‰ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (opType.equals(<span class="hljs-string"><span class="hljs-string">"insert"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Long key = count * thNum; key &lt; count * (thNum + <span class="hljs-number"><span class="hljs-number">1</span></span>); key += <span class="hljs-number"><span class="hljs-number">0</span></span>) { StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"BEGIN BATCH "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; batch; i++) { String value = RandomStringUtils.random(dataSize, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); sb.append(<span class="hljs-string"><span class="hljs-string">"INSERT INTO "</span></span>) .append(tableName) .append(<span class="hljs-string"><span class="hljs-string">"(id, title) "</span></span>) .append(<span class="hljs-string"><span class="hljs-string">"VALUES ("</span></span>) .append(key) .append(<span class="hljs-string"><span class="hljs-string">", '"</span></span>) .append(value) .append(<span class="hljs-string"><span class="hljs-string">"');"</span></span>); key++; } sb.append(<span class="hljs-string"><span class="hljs-string">"APPLY BATCH;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String query = sb.toString(); session.execute(query); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Long key = count * thNum; key &lt; count * (thNum + <span class="hljs-number"><span class="hljs-number">1</span></span>); key += <span class="hljs-number"><span class="hljs-number">0</span></span>) { StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM "</span></span>).append(tableName).append(<span class="hljs-string"><span class="hljs-string">" WHERE id IN ("</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; batch; i++) { sb = sb.append(key); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i+<span class="hljs-number"><span class="hljs-number">1</span></span> &lt; batch) sb.append(<span class="hljs-string"><span class="hljs-string">","</span></span>); key++; } sb = sb.append(<span class="hljs-string"><span class="hljs-string">");"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String query = sb.toString(); ResultSet rs = session.execute(query); } }</code> </pre><br> å› æ­¤ï¼Œä¸ºHBæä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼š <br><br><pre> <code class="java hljs">Configuration conf = getConf(); HTable table = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HTable(conf, keyspace + <span class="hljs-string"><span class="hljs-string">":"</span></span> + tableName); table.setAutoFlush(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); List&lt;Get&gt; lGet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); List&lt;Put&gt; lPut = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] cf = Bytes.toBytes(<span class="hljs-string"><span class="hljs-string">"cf"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] qf = Bytes.toBytes(<span class="hljs-string"><span class="hljs-string">"value"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (opType.equals(<span class="hljs-string"><span class="hljs-string">"insert"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Long key = count * thNum; key &lt; count * (thNum + <span class="hljs-number"><span class="hljs-number">1</span></span>); key += <span class="hljs-number"><span class="hljs-number">0</span></span>) { lPut.clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; batch; i++) { Put p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Put(makeHbaseRowKey(key)); String value = RandomStringUtils.random(dataSize, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); p.addColumn(cf, qf, value.getBytes()); lPut.add(p); key++; } table.put(lPut); table.flushCommits(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Long key = count * thNum; key &lt; count * (thNum + <span class="hljs-number"><span class="hljs-number">1</span></span>); key += <span class="hljs-number"><span class="hljs-number">0</span></span>) { lGet.clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; batch; i++) { Get g = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Get(makeHbaseRowKey(key)); lGet.add(g); key++; } Result[] rs = table.get(lGet); } }</code> </pre><br> ç”±äºå®¢æˆ·ç«¯å¿…é¡»æ³¨æ„HBä¸­æ•°æ®çš„å‡åŒ€åˆ†å¸ƒï¼Œå› æ­¤å…³é”®çš„ç›è…ŒåŠŸèƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] makeHbaseRowKey(<span class="hljs-keyword"><span class="hljs-keyword">long</span></span> key) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] nonSaltedRowKey = Bytes.toBytes(key); CRC32 crc32 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CRC32(); crc32.update(nonSaltedRowKey); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> crc32Value = crc32.getValue(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] salt = Arrays.copyOfRange(Bytes.toBytes(crc32Value), <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ArrayUtils.addAll(salt, nonSaltedRowKey); }</code> </pre><br> ç°åœ¨æœ€æœ‰è¶£çš„æ˜¯ç»“æœï¼š <br><br><img src="https://habrastorage.org/webt/id/yd/pc/idydpc9plsmulsycf0i-wqy3c3c.png"><br><br> ä¸å›¾ç›¸åŒï¼š <br><br><img src="https://habrastorage.org/webt/72/ag/o1/72ago1u2gdnlufjanqwavk5p1jk.png"><br><br>  HBçš„ä¼˜åŠ¿æ˜¯å¦‚æ­¤æƒŠäººï¼Œä»¥è‡³äºCSè®¾ç½®ä¸­å­˜åœ¨æŸç§ç“¶é¢ˆã€‚ ä½†æ˜¯ï¼Œæœ€æ˜æ˜¾å‚æ•°çš„è°·æ­Œæœç´¢å’Œæ‰­æ›²ï¼ˆä¾‹å¦‚parallel_writesæˆ–memtable_heap_space_in_mbï¼‰æ²¡æœ‰æä¾›åŠ é€Ÿã€‚ åŒæ—¶ï¼ŒåŸæœ¨æ˜¯å¹²å‡€çš„ï¼Œä¸è¦å‘èª“ã€‚ <br><br> æ•°æ®å‡åŒ€åˆ†å¸ƒåœ¨èŠ‚ç‚¹ä¹‹é—´ï¼Œæ¥è‡ªæ‰€æœ‰èŠ‚ç‚¹çš„ç»Ÿè®¡ä¿¡æ¯å¤§è‡´ç›¸åŒã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">è¿™æ˜¯å¸¦æœ‰èŠ‚ç‚¹ä¹‹ä¸€çš„è¡¨çš„ç»Ÿè®¡ä¿¡æ¯</b> <div class="spoiler_text"> é”®ç©ºé—´ï¼šks <br> è¯»æ•°ï¼š9383707 <br> è¯»å–å»¶è¿Ÿï¼š0.04287025042448576 ms <br> å†™æ•°ï¼š15462012 <br> å†™å…¥å»¶è¿Ÿï¼š0.1350068438699957 ms <br> ç­‰å¾…å†²æ´—ï¼š0 <br> è¡¨ï¼št1 <br>  SSTableæ•°é‡ï¼š16 <br> ä½¿ç”¨çš„ç©ºé—´ï¼ˆå®æ—¶ï¼‰ï¼š148.59 MiB <br> å·²ä½¿ç”¨ç©ºé—´ï¼ˆæ€»è®¡ï¼‰ï¼š148.59 MiB <br> å¿«ç…§ä½¿ç”¨çš„ç©ºé—´ï¼ˆæ€»è®¡ï¼‰ï¼š0å­—èŠ‚ <br> ä½¿ç”¨çš„å †å¤–å†…å­˜ï¼ˆæ€»è®¡ï¼‰ï¼š5.17 MiB <br>  SSTableå‹ç¼©æ¯”ï¼š0.5720989576459437 <br> åˆ†åŒºæ•°ï¼ˆä¼°è®¡ï¼‰ï¼š3970323 <br> è®°å¿†ç»†èƒè®¡æ•°ï¼š0 <br>  Memtableèµ„æ–™å¤§å°ï¼š0ä¸ªä½å…ƒç»„ <br> å·²ä½¿ç”¨çš„è¡¨å¤–å †å†…å­˜ï¼š0ä¸ªå­—èŠ‚ <br> å†…å­˜å¼€å…³æ•°ï¼š5 <br> æœ¬åœ°è¯»å–è®¡æ•°ï¼š2346045 <br> æœ¬åœ°è¯»å–å»¶è¿Ÿï¼šNaN ms <br> æœ¬åœ°å†™è®¡æ•°ï¼š3865503 <br> æœ¬åœ°å†™å…¥å»¶è¿Ÿï¼šNaN ms <br> ç­‰å¾…å†²æ´—ï¼š0 <br> ä¿®å¤ç™¾åˆ†æ¯”ï¼š0.0 <br> å¸ƒéš†è¿‡æ»¤å™¨è¯¯æŠ¥ï¼š25 <br> å¸ƒéš†è¿‡æ»¤å™¨é”™è¯¯ç‡ï¼š0.00000 <br> ä½¿ç”¨çš„Bloomç­›é€‰å™¨ç©ºé—´ï¼š4.57 MiB <br> å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨çš„å †å†…å­˜ï¼š4.57 MiB <br> æ‰€ç”¨å †å†…å­˜çš„ç´¢å¼•æ‘˜è¦ï¼š590.02 KiB <br> ä½¿ç”¨çš„å †å†…å­˜å‹ç¼©å…ƒæ•°æ®ï¼š19.45 KiB <br> å‹ç¼©åˆ†åŒºçš„æœ€å°å­—èŠ‚æ•°ï¼š36 <br> å‹ç¼©åˆ†åŒºçš„æœ€å¤§å­—èŠ‚æ•°ï¼š42 <br> å‹ç¼©åˆ†åŒºçš„å¹³å‡å­—èŠ‚æ•°ï¼š42 <br> æ¯ç‰‡å¹³å‡æ´»ç»†èƒæ•°ï¼ˆæœ€è¿‘äº”åˆ†é’Ÿï¼‰ï¼šNaN <br> æ¯ç‰‡æœ€å¤§æ´»ç»†èƒæ•°ï¼ˆæœ€è¿‘äº”åˆ†é’Ÿï¼‰ï¼š0 <br> æ¯ç‰‡å¹³å‡å¢“ç¢‘ï¼ˆæœ€è¿‘äº”åˆ†é’Ÿï¼‰ï¼šNaN <br> æ¯ç‰‡æœ€å¤§å¢“ç¢‘æ•°ï¼ˆæœ€è¿‘äº”åˆ†é’Ÿï¼‰ï¼š0 <br> åˆ é™¤çš„å˜å¼‚ï¼š0ä¸ªå­—èŠ‚ <br></div></div><br> å°è¯•å‡å°æ‰¹æ¬¡çš„å¤§å°ï¼ˆç›´åˆ°ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‘é€ï¼‰æ²¡æœ‰æ•ˆæœï¼Œåªä¼šå˜å¾—æ›´ç³Ÿã€‚ å®é™…ä¸Šï¼Œè¿™å®é™…ä¸Šå¯èƒ½æ˜¯CSçš„æœ€é«˜æ€§èƒ½ï¼Œå› ä¸ºåœ¨CSä¸Šè·å¾—çš„ç»“æœä¸ä»DataStaxè·å¾—çš„ç»“æœç›¸ä¼¼-æ¯ç§’çº¦æ•°åä¸‡æ¬¡æ“ä½œã€‚ æ­¤å¤–ï¼Œå¦‚æœæŸ¥çœ‹èµ„æºåˆ©ç”¨ç‡ï¼Œæ‚¨ä¼šå‘ç°CSä½¿ç”¨æ›´å¤šçš„CPUå’Œç£ç›˜ï¼š <br><br><img src="https://habrastorage.org/webt/us/fo/i4/usfoi4-mgkktzlosilmz2ogm7uu.png"><br>  <i>è¯¥å›¾è¿ç»­æ˜¾ç¤ºä¸¤ä¸ªæ•°æ®åº“åœ¨è¿è¡Œæ‰€æœ‰æµ‹è¯•æœŸé—´çš„åˆ©ç”¨ç‡ã€‚</i> <br><br> å…³äºHBçš„å¼ºå¤§é˜…è¯»ä¼˜åŠ¿ã€‚ å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºè¿™ä¸¤ä¸ªæ•°æ®åº“ï¼Œè¯»å–æœŸé—´çš„ç£ç›˜åˆ©ç”¨ç‡éƒ½éå¸¸ä½ï¼ˆè¯»å–æµ‹è¯•æ˜¯æ¯ä¸ªæ•°æ®åº“æµ‹è¯•å‘¨æœŸçš„æœ€åä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼Œå¯¹äº15:20åˆ°15:40çš„CSï¼‰ã€‚ å¯¹äºHBï¼ŒåŸå› å¾ˆæ˜æ˜¾-å¤§å¤šæ•°æ•°æ®éƒ½æŒ‚åœ¨å†…å­˜ä¸­çš„memstoreä¸­ï¼Œè€ŒæŸäº›æ•°æ®åˆ™ç¼“å­˜åœ¨blockcacheä¸­ã€‚ è‡³äºCSï¼Œå°šä¸æ¸…æ¥šå…¶å·¥ä½œåŸç†ï¼Œä½†æ˜¯ï¼Œç£ç›˜åˆ©ç”¨ç‡ä¹Ÿä¸å¯è§ï¼Œä½†ä»¥é˜²ä¸‡ä¸€ï¼Œè¯•å›¾æ‰“å¼€row_cache_size_in_mb = 2048ç¼“å­˜å¹¶è®¾ç½®caching = {'keys'ï¼š'ALL'ï¼Œ'rows_per_partition'ï¼š' 2,000,000'}ï¼Œä½†æƒ…å†µæ›´ç³Ÿã€‚ <br><br> åŒæ ·å€¼å¾—ä¸€æçš„æ˜¯å…³äºHBåŒºåŸŸæ•°ç›®çš„é‡è¦è§‚ç‚¹ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œæ˜¾ç¤ºçš„å€¼ä¸º64ï¼Œå¦‚æœå°†å…¶å‡å°å¹¶ä½¿å…¶ç­‰äºä¾‹å¦‚4ï¼Œåˆ™è¯»å–é€Ÿåº¦ä¸‹é™2å€ã€‚ åŸå› æ˜¯memstoreå°†æ›´å¿«åœ°é˜»å¡å¹¶ä¸”æ–‡ä»¶å°†æ›´é¢‘ç¹åœ°åˆ·æ–°ï¼Œå¹¶ä¸”åœ¨è¯»å–æ—¶å°†éœ€è¦å¤„ç†æ›´å¤šæ–‡ä»¶ï¼Œè¿™å¯¹äºHBæ¥è¯´æ˜¯ç›¸å½“å¤æ‚çš„æ“ä½œã€‚ åœ¨å®é™…æ¡ä»¶ä¸‹ï¼Œå¯ä»¥é€šè¿‡è€ƒè™‘é¢„æ¤å…¥å’Œå‹ç¼©çš„ç­–ç•¥æ¥è§£å†³ï¼Œç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨è‡ªåˆ¶çš„å®ç”¨ç¨‹åºæ¥æ”¶é›†åƒåœ¾å¹¶åœ¨åå°ä¸æ–­å‹ç¼©HFilesã€‚ å¯¹äºDataStaxæµ‹è¯•ï¼Œé€šå¸¸å¯èƒ½ä¸ºæ¯ä¸ªè¡¨åˆ†é…1ä¸ªåŒºåŸŸï¼ˆè¿™æ˜¯ä¸æ­£ç¡®çš„ï¼‰ï¼Œè¿™å°†åœ¨æŸç§ç¨‹åº¦ä¸Šæ¾„æ¸…ä¸ºä»€ä¹ˆHBåœ¨å…¶è¯»å–æµ‹è¯•ä¸­æŸå¤±è¿™ä¹ˆå¤šã€‚ <br><br> ç”±æ­¤å¾—å‡ºçš„åˆæ­¥ç»“è®ºå¦‚ä¸‹ã€‚ å‡è®¾åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­æ²¡æœ‰å‘ç”Ÿé‡å¤§é”™è¯¯ï¼ŒCassandraå°±åƒä¸€å—å·¨å¤§çš„ç²˜åœŸè„šã€‚ æ›´å‡†ç¡®åœ°è¯´ï¼Œå½“å¥¹åœ¨ä¸€æ¡è…¿ä¸Šä¿æŒå¹³è¡¡æ—¶ï¼ˆå¦‚æœ¬æ–‡å¼€å¤´çš„å›¾ç‰‡ä¸­æ‰€ç¤ºï¼‰ï¼Œå¥¹æ˜¾ç¤ºå‡ºç›¸å¯¹è¾ƒå¥½çš„æˆç»©ï¼Œä½†æ˜¯å½“å¥¹åœ¨ç›¸åŒæ¡ä»¶ä¸‹è¿›è¡Œæˆ˜æ–—æ—¶ï¼Œå¥¹å°†å®Œå…¨è¾“æ‰æ¯”èµ›ã€‚ åŒæ—¶ï¼Œè€ƒè™‘åˆ°ç¡¬ä»¶çš„CPUä½¿ç”¨ç‡ä½ï¼Œæˆ‘ä»¬å­¦ä¼šäº†åœ¨æ¯ä¸ªä¸»æœºä¸Šå®‰è£…ä¸¤ä¸ªRegionServer HBï¼Œä»è€Œä½¿ç”Ÿäº§ç‡æé«˜äº†ä¸€å€ã€‚ å³ è€ƒè™‘åˆ°èµ„æºåˆ©ç”¨ç‡ï¼ŒCSçš„æƒ…å†µç”šè‡³æ›´ç³Ÿã€‚ <br><br> å½“ç„¶ï¼Œè¿™äº›æµ‹è¯•æ˜¯ç»¼åˆçš„ï¼Œæ­¤å¤„ä½¿ç”¨çš„æ•°æ®é‡ç›¸å¯¹è¾ƒå°‘ã€‚ åˆ‡æ¢åˆ°TBæ—¶ï¼Œæƒ…å†µå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯å¦‚æœå¯¹äºHBæˆ‘ä»¬å¯ä»¥åŠ è½½TBï¼Œé‚£ä¹ˆå¯¹äºCSæ¥è¯´ï¼Œè¿™æ˜¯æœ‰é—®é¢˜çš„ã€‚ å³ä½¿ä¸è¿™äº›å·ç›¸æ¯”ï¼Œå®ƒä¹Ÿç»å¸¸å¼•å‘OperationTimedOutExceptionï¼Œå°½ç®¡å“åº”æœŸæœ›å‚æ•°å·²ç»æ¯”é»˜è®¤å‚æ•°å¢åŠ äº†æ•°å€ã€‚ <br><br> æˆ‘å¸Œæœ›é€šè¿‡å…±åŒåŠªåŠ›ï¼Œæˆ‘ä»¬å°†å‘ç°CSç“¶é¢ˆï¼Œå¦‚æœæˆ‘ä»¬è®¾æ³•åŠ å¿«å®ƒçš„é€Ÿåº¦ï¼Œé‚£ä¹ˆæˆ‘ä¸€å®šä¼šåœ¨å¸–å­æœ«å°¾æ·»åŠ æœ‰å…³æœ€ç»ˆç»“æœçš„ä¿¡æ¯ã€‚ <br><br>  <b>UPDï¼š</b>ä»¥ä¸‹å‡†åˆ™é€‚ç”¨äºCSè®¾ç½®ï¼š <br><br>  <i>disk_optimization_strategyï¼šæ—‹è½¬</i> <i><br></i>  <i>MAX_HEAP_SIZE =â€œ 32Gâ€</i> <i><br></i>  <i>HEAP_NEWSIZE =â€œ 3200Mâ€</i> <i><br></i>  <i>-Xms32G</i> <i><br></i>  <i>-Xmx32G</i> <i><br></i>  <i>-XXï¼š+ UseG1GC</i> <i><br></i>  <i>-XXï¼šG1RSetUpdatingPauseTimePercent = 5</i> <i><br></i>  <i>-XXï¼šMaxGCPauseMillis = 500</i> <i><br></i>  <i>-XXï¼šInitiatingHeapOccupancyPercent = 70</i> <i><br></i>  <i>-XXï¼šParallelGCThreads = 32</i> <i><br></i>  <i>-XXï¼šConcGCThreads = 8</i> <br><br> è‡³äºæ“ä½œç³»ç»Ÿè®¾ç½®ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“é•¿ä¸”å¤æ‚çš„è¿‡ç¨‹ï¼ˆè·å–rootï¼Œé‡æ–°å¯åŠ¨æœåŠ¡å™¨ç­‰ï¼‰ï¼Œå› æ­¤æœªåº”ç”¨è¿™äº›å»ºè®®ã€‚ å¦ä¸€æ–¹é¢ï¼Œä¸¤ä¸ªæ•°æ®åº“å¤„äºç›¸åŒæ¡ä»¶ä¸‹ï¼Œå› æ­¤ä¸€åˆ‡éƒ½æ˜¯å…¬å¹³çš„ã€‚ <br><br> åœ¨ä»£ç éƒ¨åˆ†ï¼Œä¸ºå†™å…¥è¡¨çš„æ‰€æœ‰çº¿ç¨‹å»ºç«‹äº†ä¸€ä¸ªè¿æ¥å™¨ï¼š <br><pre> <code class="java hljs">connector = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CassandraConnector(); connector.connect(node, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, CL); session = connector.getSession(); session.getCluster().getConfiguration().getSocketOptions().setConnectTimeoutMillis(<span class="hljs-number"><span class="hljs-number">120000</span></span>); KeyspaceRepository sr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KeyspaceRepository(session); sr.useKeyspace(keyspace); prepared = session.prepare(<span class="hljs-string"><span class="hljs-string">"insert into "</span></span> + tableName + <span class="hljs-string"><span class="hljs-string">" (id, title) values (?, ?)"</span></span>);</code> </pre> <br><br> æ•°æ®æ˜¯é€šè¿‡ç»‘å®šå‘é€çš„ï¼š <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Long key = count * thNum; key &lt; count * (thNum + <span class="hljs-number"><span class="hljs-number">1</span></span>); key++) { String value = RandomStringUtils.random(dataSize, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); session.execute(prepared.bind(key, value)); }</code> </pre> <br><br> è¿™å¯¹å½•åˆ¶æ€§èƒ½æ²¡æœ‰é‡å¤§å½±å“ã€‚ ä¸ºäº†æé«˜å¯é æ€§ï¼Œæˆ‘ä½¿ç”¨YCSBå·¥å…·å¯åŠ¨äº†åŠ è½½ï¼Œç»“æœå®Œå…¨ç›¸åŒã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼ˆ4ä¸ªçº¿ç¨‹ä¸­ï¼‰çš„ç»Ÿè®¡ä¿¡æ¯ï¼š <br><br>  <i>2020-01-18 14:41:53ï¼š180315ç§’ï¼š10,000,000æ¬¡æ“ä½œ;</i>  <i>21589.1å½“å‰æ“ä½œ/ç§’ï¼›</i>  <i>[æ¸…ç†ï¼šè®¡æ•°= 100ï¼Œæœ€å¤§å€¼= 2236415ï¼Œæœ€å°å€¼= 1ï¼Œå¹³å‡= 22356.39ï¼Œ90 = 4ï¼Œ99 = 24ï¼Œ99.9 = 2236415ï¼Œ99.99 = 2236415] [æ’å…¥ï¼šè®¡æ•°= 119551ï¼Œæœ€å¤§å€¼= 174463ï¼Œæœ€å°å€¼= 273ï¼Œå¹³å‡= 2582.71ï¼Œ90 = 3491ï¼Œ99 = 16767ï¼Œ99.9 = 99711ï¼Œ99.99 = 171263]</i> <i><br></i>  <i>[OVERALL]ï¼Œè¿è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ315539</i> <i><br></i>  <i>[æ€»ä½“]ï¼Œååé‡ï¼ˆè¿è¥/ç§’ï¼‰ï¼Œ31691.803548848162</i> <i><br></i>  <i>[TOTAL_GCS_PS_Scavenge]ï¼Œè®¡æ•°ï¼Œ161</i> <i><br></i>  <i>[TOTAL_GC_TIME_PS_Scavenge]ï¼Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ2433</i> <i><br></i>  <i>[TOTAL_GC_TIME _ï¼…_ PS_Scavenge]ï¼Œæ—¶é—´ï¼ˆï¼…ï¼‰ï¼Œ0.7710615803434757</i> <i><br></i>  <i>[TOTAL_GCS_PS_MarkSweep]ï¼Œè®¡æ•°ï¼Œ0</i> <i><br></i>  <i>[TOTAL_GC_TIME_PS_MarkSweep]ï¼Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ0</i> <i><br></i>  <i>[TOTAL_GC_TIME _ï¼…_ PS_MarkSweep]ï¼Œæ—¶é—´ï¼ˆï¼…ï¼‰ï¼Œ0.0</i> <i><br></i>  <i>[TOTAL_GCs]ï¼Œè®¡æ•°ï¼Œ161</i> <i><br></i>  <i>[TOTAL_GC_TIME]ï¼Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ2433</i> <i><br></i>  <i>[TOTAL_GC_TIME_ï¼…]ï¼Œæ—¶é—´ï¼ˆï¼…ï¼‰ï¼Œ0.7710615803434757</i> <i><br></i>  <i>[INSERT]ï¼Œè¿è¥ï¼Œ10,000,000</i> <i><br></i>  <i>[INSERT]ï¼ŒAverageLatencyï¼ˆç¾å›½ï¼‰ï¼Œ3114.2427012</i> <i><br></i>  <i>[INSERT]ï¼ŒMinLatencyï¼ˆç¾å›½ï¼‰ï¼Œ269</i> <i><br></i>  <i>[INSERT]ï¼ŒMaxLatencyï¼ˆç¾å›½ï¼‰ï¼Œ609279</i> <i><br></i>  <i>[INSERT]ï¼Œ95thPercentileLatencyï¼ˆç¾å›½ï¼‰ï¼Œ5007</i> <i><br></i>  <i>[INSERT]ï¼Œ99thPercentileLatencyï¼ˆç¾å›½ï¼‰ï¼Œ33439</i> <i><br></i>  <i>[INSERT]ï¼Œè¿”å›= OKï¼Œ10000000</i> <i><br></i> <br><br> åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæµçš„é€Ÿåº¦çº¦ä¸ºæ¯ç§’32,000ä¸ªè®°å½•ï¼Œå·¥ä½œäº†4ä¸ªæµï¼Œç»“æœä¸º12.8ä¸‡ã€‚ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆå¯ä»¥æŒ¤å‡ºå½“å‰çš„ç£ç›˜å­ç³»ç»Ÿè®¾ç½®äº†ã€‚ <br><br> å…³äºé˜…è¯»æ›´æœ‰è¶£ã€‚ å¤šäºäº†åŒå¿—çš„å»ºè®®ï¼Œä»–æ‰å¾—ä»¥ä»æ ¹æœ¬ä¸ŠåŠ é€Ÿå‰è¿›ã€‚ è¯»å–ä¸æ˜¯åœ¨5ä¸ªæµä¸­è¿›è¡Œçš„ï¼Œè€Œæ˜¯åœ¨100ä¸ªæµä¸­è¿›è¡Œçš„ã€‚å¢åŠ åˆ°200ä¸ªä¸ä¼šäº§ç”Ÿæ•ˆæœã€‚ è¿˜æ·»åŠ åˆ°æ„å»ºå™¨ä¸­ï¼š <br>  .withLoadBalancingPolicyï¼ˆæ–°çš„TokenAwarePolicyï¼ˆDCAwareRoundRobinPolicy.builderï¼ˆï¼‰ã€‚buildï¼ˆï¼‰ï¼‰ï¼‰ <br><br> ç»“æœï¼Œå¦‚æœè¾ƒæ—©çš„æµ‹è¯•æ˜¾ç¤º159644ä¸ªæ“ä½œï¼ˆ5ä¸ªæµï¼Œ4ä¸ªè¡¨ï¼Œ100ä¸ªæ‰¹å¤„ç†ï¼‰ï¼Œåˆ™ç°åœ¨ï¼š <br>  100ä¸ªçº¿ç¨‹ï¼Œ4ä¸ªè¡¨ï¼Œæ‰¹å¤„ç†= 1ï¼ˆå•ç‹¬ï¼‰ï¼š301969ä¸ªæ“ä½œ <br>  100ä¸ªçº¿ç¨‹ï¼Œ4ä¸ªè¡¨ï¼Œæ‰¹å¤„ç†= 10ï¼š447608æ“ä½œ <br>  100ä¸ªçº¿ç¨‹ï¼Œ4ä¸ªè¡¨ï¼Œæ‰¹å¤„ç†= 100ï¼š625655ä¸ªæ“ä½œ <br><br> ç”±äºæ‰¹å¤„ç†çš„ç»“æœæ›´å¥½ï¼Œå› æ­¤æˆ‘å¯¹HBè¿›è¡Œäº†ç±»ä¼¼çš„*æµ‹è¯•ï¼š <br><img src="https://habrastorage.org/webt/ct/bk/-y/ctbk-yrecbwegasrbpauq6f1vv8.png"><br>  <i>*ç”±äºåœ¨400ä¸ªçº¿ç¨‹ä¸­å·¥ä½œæ—¶ï¼Œè¾ƒæ—©ä½¿ç”¨çš„RandomStringUtilså‡½æ•°å°†CPUåŠ è½½äº†100ï¼…ï¼Œå› æ­¤å®ƒè¢«æ›´å¿«çš„ç”Ÿæˆå™¨æ‰€å–ä»£ã€‚</i> <br><br> å› æ­¤ï¼ŒåŠ è½½æ•°æ®æ—¶çº¿ç¨‹æ•°çš„å¢åŠ ä¼šä½¿HBæ€§èƒ½æœ‰æ‰€æé«˜ã€‚ <br><br> è‡³äºé˜…è¯»ï¼Œè¿™æ˜¯å‡ ç§é€‰æ‹©çš„ç»“æœã€‚ åº”<a href="https://habr.com/ru/users/0x62ash/" class="user_link">0x62ash</a>çš„è¯·æ±‚ï¼Œåœ¨è¯»å–ä¹‹å‰å·²æ‰§è¡Œäº†flushå‘½ä»¤ï¼Œå¹¶ä¸”è¿˜æä¾›äº†å…¶ä»–å‡ ä¸ªé€‰é¡¹è¿›è¡Œæ¯”è¾ƒï¼š <br>  Memstore-ä»å†…å­˜è¯»å–ï¼Œå³ åœ¨åˆ·æ–°åˆ°ç£ç›˜ä¹‹å‰ã€‚ <br>  HFile + zip-ä»GZç®—æ³•å‹ç¼©çš„æ–‡ä»¶ä¸­è¯»å–ã€‚ <br>  HFile + upzip-æ— éœ€å‹ç¼©å³å¯è¯»å–æ–‡ä»¶ã€‚ <br><br> ä¸€ä¸ªæœ‰è¶£çš„åŠŸèƒ½æ˜¯å€¼å¾—æ³¨æ„çš„-å°æ–‡ä»¶ï¼ˆè¯·å‚è§â€œæ•°æ®â€å­—æ®µï¼Œå…¶ä¸­å†™å…¥äº†10ä¸ªå­—èŠ‚ï¼‰çš„å¤„ç†é€Ÿåº¦è¾ƒæ…¢ï¼Œå°¤å…¶æ˜¯åœ¨å‹ç¼©æ—¶ã€‚ æ˜¾ç„¶ï¼Œè¿™åªæœ‰åœ¨è¾¾åˆ°ä¸€å®šå¤§å°åæ‰å¯èƒ½å®ç°ï¼Œæ˜¾ç„¶ä¸€ä¸ª5 GBçš„æ–‡ä»¶å°†ä¸ä¼šä»¥è¶…è¿‡10 MBçš„é€Ÿåº¦å¤„ç†ï¼Œä½†æ˜¯å®ƒæ¸…æ¥šåœ°è¡¨æ˜ï¼Œåœ¨æ‰€æœ‰è¿™äº›æµ‹è¯•ä¸­ï¼Œä»ç„¶æ²¡æœ‰çŠvariousçš„é¢†åŸŸæ¥ç ”ç©¶å„ç§é…ç½®ã€‚ <br><br> å‡ºäºå…´è¶£ï¼Œæˆ‘æ›´æ­£äº†YCSBä»£ç ï¼Œä»¥å¤„ç†100ä»¶HBæ‰¹æ¬¡ä»¥æµ‹é‡å»¶è¿Ÿç­‰ã€‚ ä»¥ä¸‹æ˜¯å†™å…¥è¡¨çš„4ä¸ªå‰¯æœ¬çš„å·¥ä½œç»“æœï¼Œæ¯ä¸ªå‰¯æœ¬å…·æœ‰100ä¸ªçº¿ç¨‹ã€‚ ç»“æœæ˜¯ï¼š <br><div class="spoiler">  <b class="spoiler_title">ä¸€æ¬¡æ“ä½œ= 100æ¡è®°å½•</b> <div class="spoiler_text">  [OVERALL]ï¼Œè¿è¡Œæ—¶é—´ï¼ˆmsï¼‰ï¼Œ1165415 <br>  [æ€»ä½“]ï¼Œååé‡ï¼ˆæ“ä½œæ•°/ç§’ï¼‰ï¼Œ858.06343662987 <br>  [TOTAL_GCS_PS_Scavenge]ï¼Œè®¡æ•°ï¼Œ798 <br>  [TOTAL_GC_TIME_PS_Scavenge]ï¼Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ7346 <br>  [TOTAL_GC_TIME _ï¼…_ PS_Scavenge]ï¼Œæ—¶é—´ï¼ˆï¼…ï¼‰ï¼Œ0.6303334005483026 <br>  [TOTAL_GCS_PS_MarkSweep]ï¼Œè®¡æ•°ï¼Œ1 <br>  [TOTAL_GC_TIME_PS_MarkSweep]ï¼Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ74 <br>  [TOTAL_GC_TIME _ï¼…_ PS_MarkSweep]ï¼Œæ—¶é—´ï¼ˆï¼…ï¼‰ï¼Œ0.006349669431061038 <br>  [TOTAL_GCs]ï¼Œè®¡æ•°ï¼Œ799 <br>  [TOTAL_GC_TIME]ï¼Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ7420 <br>  [TOTAL_GC_TIME_ï¼…]ï¼Œæ—¶é—´ï¼ˆï¼…ï¼‰ï¼Œ0.6366830699793635 <br>  [INSERT]ï¼Œè¿è¥ï¼Œ1,000,000 <br>  [INSERT]ï¼ŒAverageLatencyï¼ˆç¾å›½ï¼‰ï¼Œ115893.891644 <br>  [æ’å…¥]ï¼ŒMinLatencyï¼ˆç¾å›½ï¼‰ï¼Œ14528 <br>  [INSERT]ï¼ŒMaxLatencyï¼ˆç¾å›½ï¼‰ï¼Œ1470463 <br>  [INSERT]ï¼Œ95thPercentileLatencyï¼ˆç¾å›½ï¼‰ï¼Œ248319 <br>  [æ’å…¥]ï¼Œ99thPercentileLatencyï¼ˆç¾å›½ï¼‰ï¼Œ445951 <br>  [æ’å…¥]ï¼Œè¿”å›= OKï¼Œ1,000,000 <br><br>  19/01/20 13:19:16 INFO client.ConnectionManager $ HConnectionImplementationï¼šå…³é—­zookeeperä¼šè¯ID = 0x36f98ad0a4ad8cc <br>  19/01/20 13:19:16ä¿¡æ¯zookeeper.ZooKeeperï¼šä¼šè¯ï¼š0x36f98ad0a4ad8ccå·²å…³é—­ <br>  19/01/20 13:19:16ä¿¡æ¯zookeeper.ClientCnxnï¼šEventThreadå…³é—­ <br>  [OVERALL]ï¼Œè¿è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ1165806 <br>  [æ€»ä½“]ï¼Œååé‡ï¼ˆæ“ä½œæ•°/ç§’ï¼‰ï¼Œ857.7756504941646 <br>  [TOTAL_GCS_PS_Scavenge]ï¼Œè®¡æ•°ï¼Œ776 <br>  [TOTAL_GC_TIME_PS_Scavenge]ï¼Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ7517 <br>  [TOTAL_GC_TIME _ï¼…_ PS_Scavenge]ï¼Œæ—¶é—´ï¼ˆï¼…ï¼‰ï¼Œ0.6447899564764635 <br>  [TOTAL_GCS_PS_MarkSweep]ï¼Œè®¡æ•°ï¼Œ1 <br>  [TOTAL_GC_TIME_PS_MarkSweep]ï¼Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ63 <br>  [TOTAL_GC_TIME _ï¼…_ PS_MarkSweep]ï¼Œæ—¶é—´ï¼ˆï¼…ï¼‰ï¼Œ0.005403986598113236 <br>  [TOTAL_GCs]ï¼Œè®¡æ•°ï¼Œ777 <br>  [TOTAL_GC_TIME]ï¼Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ7580 <br>  [TOTAL_GC_TIME_ï¼…]ï¼Œæ—¶é—´ï¼ˆï¼…ï¼‰ï¼Œ0.6501939430745767 <br>  [INSERT]ï¼Œè¿è¥ï¼Œ1,000,000 <br>  [INSERT]ï¼ŒAverageLatencyï¼ˆç¾å›½ï¼‰ï¼Œ116042.207936 <br>  [æ’å…¥]ï¼ŒMinLatencyï¼ˆç¾å›½ï¼‰ï¼Œ14056 <br>  [INSERT]ï¼ŒMaxLatencyï¼ˆç¾å›½ï¼‰ï¼Œ1462271 <br>  [INSERT]ï¼Œ95thPercentileLatencyï¼ˆç¾å›½ï¼‰ï¼Œ250239 <br>  [æ’å…¥]ï¼Œ99thPercentileLatencyï¼ˆç¾å›½ï¼‰ï¼Œ446719 <br>  [æ’å…¥]ï¼Œè¿”å›= OKï¼Œ1,000,000 <br><br>  19/01/20 13:19:16 INFO client.ConnectionManager $ HConnectionImplementationï¼šå…³é—­zookeeperä¼šè¯ID = 0x26f98ad07b6d67e <br>  19/01/20 13:19:16 INFO zookeeper.ZooKeeperï¼šä¼šè¯ï¼š0x26f98ad07b6d67eå…³é—­ <br>  19/01/20 13:19:16ä¿¡æ¯zookeeper.ClientCnxnï¼šEventThreadå…³é—­ <br>  [OVERALL]ï¼Œè¿è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ1165999 <br>  [æ€»ä½“]ï¼Œååé‡ï¼ˆè¿è¥/ç§’ï¼‰ï¼Œ857.63366863951 <br>  [TOTAL_GCS_PS_Scavenge]ï¼Œè®¡æ•°ï¼Œ818 <br> [TOTAL_GC_TIME_PS_Scavenge], Time(ms), 7557 <br> [TOTAL_GC_TIME_%_PS_Scavenge], Time(%), 0.6481137633908777 <br> [TOTAL_GCS_PS_MarkSweep], Count, 1 <br> [TOTAL_GC_TIME_PS_MarkSweep], Time(ms), 79 <br> [TOTAL_GC_TIME_%_PS_MarkSweep], Time(%), 0.006775305982252128 <br> [TOTAL_GCs], Count, 819 <br> [TOTAL_GC_TIME], Time(ms), 7636 <br> [TOTAL_GC_TIME_%], Time(%), 0.6548890693731299 <br> [INSERT], Operations, 1000000 <br> [INSERT], AverageLatency(us), 116172.212864 <br> [INSERT], MinLatency(us), 7952 <br> [INSERT], MaxLatency(us), 1458175 <br> [INSERT], 95thPercentileLatency(us), 250879 <br> [INSERT], 99thPercentileLatency(us), 446463 <br> [INSERT], Return=OK, 1000000 <br><br> 20/01/19 13:19:17 INFO client.ConnectionManager$HConnectionImplementation: Closing zookeeper sessionid=0x36f98ad0a4ad8cd <br> 20/01/19 13:19:17 INFO zookeeper.ZooKeeper: Session: 0x36f98ad0a4ad8cd closed <br> 20/01/19 13:19:17 INFO zookeeper.ClientCnxn: EventThread shut down <br> [OVERALL], RunTime(ms), 1166860 <br> [OVERALL], Throughput(ops/sec), 857.000839860823 <br> [TOTAL_GCS_PS_Scavenge], Count, 707 <br> [TOTAL_GC_TIME_PS_Scavenge], Time(ms), 7239 <br> [TOTAL_GC_TIME_%_PS_Scavenge], Time(%), 0.6203829079752499 <br> [TOTAL_GCS_PS_MarkSweep], Count, 1 <br> [TOTAL_GC_TIME_PS_MarkSweep], Time(ms), 67 <br> [TOTAL_GC_TIME_%_PS_MarkSweep], Time(%), 0.0057419056270675145 <br> [TOTAL_GCs], Count, 708 <br> [TOTAL_GC_TIME], Time(ms), 7306 <br> [TOTAL_GC_TIME_%], Time(%), 0.6261248136023173 <br> [INSERT], Operations, 1000000 <br> [INSERT], AverageLatency(us), 116230.849308 <br> [INSERT], MinLatency(us), 7352 <br> [INSERT], MaxLatency(us), 1443839 <br> [INSERT], 95thPercentileLatency(us), 250623 <br> [INSERT], 99thPercentileLatency(us), 447487 <br> [INSERT], Return=OK, 1000000 </div></div><br><br> ,    CS AverageLatency(us)   3114,   HB AverageLatency(us) = 1162 (,  1  = 100     ). <br><br>      â€”        HBase.   ,  SSD       .   ,       ,    ,     4 ,  400    ,      .   :  â€”  .  .   ScyllaDB     ,    â€¦ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN484096/">https://habr.com/ru/post/zh-CN484096/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN484084/index.html">1C-Bitrixå¹¶å°è¯•å¼•å…¥å®ƒ</a></li>
<li><a href="../zh-CN484088/index.html">å¯†ç å‘½ä¸­å¤§æ¸¸è¡Œï¼ˆä»æ³„æ¼ä¸­åˆ†æçº¦50äº¿ä¸ªå¯†ç ï¼‰</a></li>
<li><a href="../zh-CN484090/index.html">ä¿„ç½—æ–¯é‚®æ”¿æ•°æ®ä¸­å¿ƒçš„æ–°ITåŸºç¡€æ¶æ„</a></li>
<li><a href="../zh-CN484092/index.html">ç‹å­å’Œè´µæ—ç©¿å¾—æœ‰äº›ä½“é¢</a></li>
<li><a href="../zh-CN484094/index.html">ä½¿ç”¨DOTSåˆ›å»ºç¬¬ä¸‰äººç§°åƒµå°¸å°„å‡»æ¸¸æˆ</a></li>
<li><a href="../zh-CN484100/index.html">ä½¿ç”¨Androidç‰ˆGoogle Maps SDKä¸­çš„ç•Œé¢</a></li>
<li><a href="../zh-CN484102/index.html">PHP vs Python vs Ruby on Railsï¼šè¯¦ç»†æ¯”è¾ƒ</a></li>
<li><a href="../zh-CN484106/index.html">PostgreSQL-6ä¸­çš„MVCCã€‚ çœŸç©ºåº¦</a></li>
<li><a href="../zh-CN484108/index.html">Etherblade.netå°è£…å™¨å’Œç½‘ç»œç»„ä»¶çš„å¯¼å…¥æ›¿ä»£ï¼ˆç¬¬äºŒéƒ¨åˆ†ï¼‰</a></li>
<li><a href="../zh-CN484112/index.html">æœ‰å¯èƒ½ç é£æœºå—</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>