<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÖ üë©üèª‚Äç‚öïÔ∏è üè¨ Almacenamiento ZFS, entornos de espera y prueba ‚è∞ üêç üí™üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- ¬øTenemos alguna foto para enero, m√°s cerca de febrero? 
 - Ahora veamos ... ¬°S√≠, lo hay! Ahora abierto 

 Sucede que hay una vida √∫til promedio de l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Almacenamiento ZFS, entornos de espera y prueba</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/417373/">  <i>- ¬øTenemos alguna foto para enero, m√°s cerca de febrero?</i> <i><br></i>  <i>- Ahora veamos ... ¬°S√≠, lo hay!</i>  <i>Ahora abierto</i> <br><br>  Sucede que hay una vida √∫til promedio de la base de prueba, hay una vida √∫til para las instant√°neas acordadas por todos los interesados, pero algunos de los entornos "permanecen" demasiado tiempo en su imagen, lo que no se puede eliminar ... y luego resulta ser √∫til para los colegas.  Y menos a menos da un plus. <br><br>  Por lo general, para cualquier sistema en el que algo pueda suceder, debe crear copias de seguridad.  Y si todav√≠a se est√° desarrollando y finalizando, entonces en alg√∫n lugar tambi√©n es necesario implementar entornos de desarrollo y prueba.  Adem√°s, para las copias de seguridad y los entornos de prueba que funcionan, de hecho, con los mismos datos, necesita mucho espacio.  Y, sin embargo, estos entornos deben de alguna manera conducir al estado actual.  Y todo esto requiere hardware y recursos de tiempo. <br><br>  En nuestro caso, estas necesidades fueron cubiertas por el dispositivo de almacenamiento Oracle ZFS y los servidores Oracle / Sun, que realmente se fusionaron en el mismo ecosistema que Exadata, que apareci√≥ poco antes que ellos. <br><a name="habracut"></a><br>  Dado que hay un conmutador InfiniBand dentro de Exadata, a trav√©s del cual se comunican sus componentes, y ZFS Storage tambi√©n es un dispositivo Oracle, entonces: <br><br><ul><li>  en primer lugar, estaba conectado directamente a este conmutador por parte de sus puertos; </li><li>  en segundo lugar, puede almacenar archivos de espacio de tabla con segmentos comprimidos en la compresi√≥n de columnas h√≠brida Exadata (EHCC), lo que nos ahorra mucho espacio en el sistema principal.  Si intenta restaurar la base de datos en un servidor separado, luego de la recuperaci√≥n, refiri√©ndose a los datos comprimidos, obtendr√° el error: "ORA-64307: la compresi√≥n columnar h√≠brida no es compatible con espacios de tablas en este tipo de almacenamiento", porque los archivos de datos comprimido en el EHCC debe almacenarse en el dispositivo Oracle; </li><li> En tercer lugar, esto abre la posibilidad de utilizar las capacidades de ZFS para almacenar archivos de entorno de prueba. </li></ul><br>  Bueno, ¬øqu√© hay del lugar?  Se debe evitar la duplicaci√≥n. <br><br>  Los entornos de prueba necesitan los mismos datos que en las copias de seguridad.  ¬øPueden estos datos realizar ambas funciones?  ¬øPara ser una copia de seguridad y una base para cualquier entorno de prueba privilegiado que necesite un conjunto de datos completo?  Pueden! <br><br>  El dispositivo de almacenamiento Oracle ZFS es una matriz que proporciona, entre otras cosas, la capacidad de formar recursos compartidos de red que se ejecutan bajo el sistema de archivos ZFS.  Dentro del sistema de archivos ZFS, es posible crear instant√°neas, en funci√≥n de las cuales puede implementar clones, que son visibles como nuevos recursos compartidos de red.  Utilizamos esta oportunidad de la siguiente manera: <br><br><ol><li>  En ZFS Storage (como llamaremos a la matriz, para no confundirnos con el sistema de archivos), se crean dos recursos compartidos: Archivelog se agrega a uno y los archivos de base de datos al otro; </li><li>  El recurso compartido se monta en el servidor Oracle / Sun (que tambi√©n es el dispositivo), y en el servidor mismo se eleva una instancia de Oracle Database, que act√∫a como un modo de espera f√≠sico en cascada: recibe registros de un sitio de copia de seguridad condicional y aplica los cambios a los archivos en el recurso compartido; </li><li>  El uso de registros se organiza de acuerdo con el principio de la unidad de trabajo (¬°hola a todos los participantes en inform√°tica distribuida!).  A nivel de algoritmo, se introduce el concepto de unidad de trabajo, que corresponde a un cierto intervalo de tiempo.  Despu√©s de rodar los registros durante el intervalo requerido, la instancia se detiene y los archivos permanecen en el recurso compartido en un estado coherente entre s√≠ y con el archivo de control.  De hecho, esta es una copia de seguridad en fr√≠o, tambi√©n es una copia de imagen, sobre la cual se realiza una instant√°nea; </li><li>  Cuando llega el momento de recrear el entorno de prueba, se crea un clon a partir de la instant√°nea deseada.  Se monta en el servidor en el que se ejecuta el entorno, despu√©s de lo cual los archivos se abren como una base de datos con un nombre diferente y en modo de lectura / escritura; </li><li>  En el proceso de trabajar en la base de prueba, se realizan cambios que se posponen como parte del clon, y est√° creciendo lentamente.  Al final del ciclo de vida, el medio crece al m√°ximo. </li><li>  Para reducir el consumo de espacio en disco, utilizamos la compresi√≥n LZJB, que ZFS Storage realiza sobre la marcha. </li></ol><br>  En resumen: <br><br><ol><li>  En la configuraci√≥n actual, los entornos de prueba pueden realizar E / S hasta el nivel de 3.75 Gb / s; <br>  El m√°ximo para la lectura est√° limitado por la configuraci√≥n del puerto InfiniBand existente en el servidor, el m√°ximo para la escritura es la CPU en los controladores de almacenamiento ZFS y alcanza aproximadamente 2 Gb / s.  (¬°S√≠, s√≠! Dado que 10 GbE no eran suficientes, se compraron conmutadores separados para los servidores de prueba, que inclu√≠an ZFS Storage y los propios servidores); </li><li>  Se crean varias instant√°neas por d√≠a, que ahora se almacenan, seg√∫n la base, de 2 semanas a 2 meses.  Despu√©s de lo cual se eliminan todos, excepto las instant√°neas creadas a las 00:00, el 1 de cada mes, que se almacenan durante m√°s de una cuarta parte.  Hubo casos en que las instant√°neas almacenadas durante aproximadamente <i>seis meses</i> resultaron √∫tiles; </li><li>  Si es necesario, se puede restaurar toda la base de datos industrial a partir de la instant√°nea deseada.  Tambi√©n con una velocidad del orden de 1 ... 3 Gb / s, pero la opci√≥n de crear un clon a partir de la instant√°nea deseada es mucho m√°s popular, desde donde se descargan los datos de las tablas deseadas; </li><li>  El tiempo para recrear el entorno de prueba es de aproximadamente 1 hora (con la transferencia de varios circuitos adicionales, etc.); </li><li>  El tiempo para proporcionar a sus colegas un clon desde el que puede recopilar datos para la recuperaci√≥n o simplemente alg√∫n tipo de an√°lisis es de 15 minutos (con una combinaci√≥n ideal de condiciones) a 1-2 horas (con una gran carga paralela en ZFS Storage o us J); </li><li>  Si es necesario, puede restaurar desde la instant√°nea y el clon, y toda la base de datos; </li><li>  Una limitaci√≥n importante del rendimiento es la cantidad de IOPS generados por entornos de prueba o instancias de espera en cascada.  Y aqu√≠ el sistema se comporta de manera absolutamente adecuada y previsible: tan pronto como se selecciona su n√∫mero a 75 IOPS por HDD (contiene discos de 3.5 ‚Äùa 7200 rpm) bajo carga prolongada, el sistema comienza a ceder gradualmente.  Y poco tiempo: escribir y leer Flash son notablemente m√°s f√°ciles; </li><li>  La cantidad de IOPS, la cantidad total de datos entrantes, la carga en la CPU, la cantidad de lecturas de cach√©s en RAM y Flash, as√≠ como varias docenas (si no cientos) de m√©tricas se pueden ver en la interfaz de administraci√≥n web; </li><li>  Puede trabajar con objetos de almacenamiento ZFS utilizando las solicitudes REST descritas en la documentaci√≥n.  Con su ayuda, fue posible automatizar la eliminaci√≥n de instant√°neas obsoletas, ¬°pero se puede hacer mucho m√°s! </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es417373/">https://habr.com/ru/post/es417373/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es417355/index.html">Calvicie: teor√≠a y pr√°ctica del tratamiento, parte 2 "Incluso la pr√≥stata tiene am√≠gdalas, prostaglandinas"</a></li>
<li><a href="../es417357/index.html">Equipos de escritorio "Acerca de TI". Historia de los juegos de configuraci√≥n de computadora</a></li>
<li><a href="../es417359/index.html">Seguridad de la informaci√≥n? No no escuchado</a></li>
<li><a href="../es417367/index.html">¬øQu√© tan lejos llevan los sue√±os de la perfecta "b√∫squeda de archivos"</a></li>
<li><a href="../es417369/index.html">15 herramientas para el arsenal de trabajo del gerente de producto</a></li>
<li><a href="../es417375/index.html">15 m√©todos de elementos HTML que probablemente nunca has escuchado</a></li>
<li><a href="../es417377/index.html">Por qu√© no deber√≠as usar Google Cloud</a></li>
<li><a href="../es417379/index.html">Nuevo motor de cohete propulsor s√≥lido para Vega-C y Ariane 6</a></li>
<li><a href="../es417383/index.html">JavaScript ES6: Debilidades</a></li>
<li><a href="../es417385/index.html">C√≥mo me mud√© ... a casa, o mi respuesta al autor del art√≠culo sobre "harina despiadada"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>