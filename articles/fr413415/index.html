<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≥üèø üêµ üß¢ Limites de concurrence adaptative dans Netflix üë¥ üò° üë©üèª‚Äçü§ù‚Äçüë®üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Netflix est obs√©d√© par la disponibilit√© des services. Nous l'avons d√©j√† revu sur notre blog plus d'une fois et expliqu√© comment nous r√©ussissons √† att...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Limites de concurrence adaptative dans Netflix</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/413415/"><img src="https://habrastorage.org/webt/1f/9m/do/1f9mdoden4f5g0saek8572vqzk8.png"><br><br>  Netflix est obs√©d√© par la disponibilit√© des services.  Nous l'avons d√©j√† revu sur notre blog plus d'une fois et expliqu√© comment nous r√©ussissons √† atteindre nos objectifs.  Nous utilisons des disjoncteurs, des limites de simultan√©it√©, des tests de chaos, etc.  Aujourd'hui, nous vous pr√©sentons une autre approche innovante qui am√©liore consid√©rablement la stabilit√© de l'application sous des charges extr√™mes et √©vite les d√©faillances de service en cascade - limites adaptatives pour les connexions parall√®les.  Aucun effort suppl√©mentaire n'est n√©cessaire pour d√©terminer les limites des connexions parall√®les, permettant au syst√®me de maintenir un temps de r√©ponse court.  Dans le cadre de cette annonce, nous publions √©galement dans le domaine public une biblioth√®que Java simple avec des capacit√©s d'int√©gration pour les servlets, les programmes de contr√¥le et gRPC. <br><a name="habracut"></a><br><h4>  Commen√ßons par les bases </h4><br>  La limite des connexions parall√®les est le nombre maximal de demandes que le syst√®me est capable de traiter √† un certain moment.  En r√®gle g√©n√©rale, ce montant d√©pend d'une ressource limit√©e, telle que la puissance de traitement du processeur central.  Habituellement, la limite de connexions parall√®les d'un syst√®me est calcul√©e selon la loi de Little, qui se lit comme suit: pour un syst√®me stable, le nombre maximal de connexions parall√®les est √©gal au produit du temps moyen pass√© √† traiter la demande et de l'intensit√© moyenne des demandes entrantes (L = ŒªW).  Toutes les demandes d√©passant la limite de connexion parall√®le ne peuvent pas √™tre imm√©diatement trait√©es par le syst√®me, elles seront donc mises en file d'attente ou rejet√©es.  La mise en file d'attente est une fonction importante qui vous permet d'utiliser pleinement le syst√®me dans les cas o√π les demandes sont re√ßues de mani√®re in√©gale et n√©cessitent un temps de traitement diff√©rent. <br><br><img src="https://habrastorage.org/webt/rt/xg/jc/rtxgjcvizrzpe0rffihujn_tfxq.png"><br><br>  S'il n'y a pas de limite pour la file d'attente, un plantage du syst√®me peut se produire, par exemple, si pendant longtemps l'intensit√© des demandes est sup√©rieure √† la vitesse de leur traitement.  √Ä mesure que la file d'attente s'allonge, le d√©lai augmente, ce qui entra√Æne un d√©passement du temps d'attente pour les demandes.  Cela continue jusqu'√† √©puisement de la m√©moire libre, apr√®s quoi le syst√®me se bloque.  Si vous ne suivez pas le temps de retard croissant, il commencera √† affecter n√©gativement les services d'appel et entra√Ænera des d√©faillances du syst√®me en cascade. <br><br><img src="https://habrastorage.org/webt/so/wn/io/sowniojbjfektwb7esft-yaqham.png"><br><br>  L'utilisation de limites de connexion parall√®le est une pratique standard, mais la difficult√© r√©side dans leur d√©termination pour les grands syst√®mes distribu√©s dynamiques, o√π les param√®tres tels que le temps de retard et le nombre possible de connexions parall√®les changent constamment.  L'essence de notre solution est la capacit√© de d√©terminer dynamiquement la limite des connexions parall√®les.  Cette limite peut √™tre repr√©sent√©e comme le nombre de demandes entrantes (ex√©cut√©es en parall√®le et en file d'attente) que le syst√®me est en mesure de traiter jusqu'√† ce que ses performances commencent √† diminuer (et que le temps de retard augmente). <br><br><h4>  Solution </h4><br>  Auparavant, les employ√©s de Netflix d√©terminaient les limites de connexion simultan√©es manuelles gr√¢ce √† des tests de performances et √† un profilage fastidieux.  Le nombre r√©sultant √©tait correct pour une p√©riode de temps sp√©cifique, mais bient√¥t la topologie du syst√®me a commenc√© √† changer en raison de d√©faillances partielles, d'une mise √† l'√©chelle automatique ou de l'introduction d'un code suppl√©mentaire qui a affect√© le temps de retard.  Par cons√©quent, la limite est obsol√®te.  Nous savions que nous √©tions capables de plus, qu'il ne nous suffisait plus de d√©terminer statiquement les limites de connexion.  Nous avions besoin d'un moyen de d√©terminer automatiquement les limites inh√©rentes au syst√®me lui-m√™me.  En m√™me temps, nous voulions cette m√©thode: <br><br><ol><li>  ne n√©cessitait pas de travail manuel; <br></li><li>  ne n√©cessitait pas de coordination centrale; <br></li><li>  pourrait d√©terminer la limite sans aucune information sur la topologie du mat√©riel ou du syst√®me; <br></li><li>  Adapt√© aux changements de la topologie du syst√®me; <br></li><li>  √©tait simple en termes de mise en ≈ìuvre et de calculs n√©cessaires. <br></li></ol><br>  Pour r√©soudre ce probl√®me, nous nous sommes tourn√©s vers l'algorithme √©prouv√© de suivi de la congestion TCP.  Cet algorithme d√©termine le nombre de paquets de donn√©es qui peuvent √™tre transmis en parall√®le (c'est-√†-dire la taille de la fen√™tre de d√©bordement) sans augmenter le temps de retard ni d√©passer le temps d'attente.  Ces algorithmes utilisent divers indicateurs pour d√©terminer la limite de paquets transmis simultan√©ment et pour redimensionner la fen√™tre de d√©bordement en cons√©quence. <br><br><img src="https://habrastorage.org/webt/f-/ox/jo/f-oxjo0ds0ieqwv7flct4g5ntb8.png"><br><br>  La couleur bleue de l'image montre la limite inconnue pour les connexions parall√®les au syst√®me.  Tout d'abord, le client envoie un petit nombre de demandes simultan√©es, puis il commence √† v√©rifier p√©riodiquement le syst√®me pour voir s'il peut traiter plus de demandes en augmentant la fen√™tre de d√©bordement jusqu'√† ce que cela entra√Æne une augmentation du d√©lai.  Lorsque le d√©lai augmente encore, l'exp√©diteur d√©cide qu'il a atteint la limite et r√©duit √† nouveau la taille de la fen√™tre de d√©bordement.  Un tel test continu de la limite se refl√®te dans le graphique que vous voyez ci-dessus. <br><br>  Notre algorithme repose sur l'algorithme de suivi de congestion TCP, qui prend en compte la relation entre le temps de retard minimum (le meilleur sc√©nario possible dans lequel la file d'attente n'est pas utilis√©e) et le temps de retard, qui est mesur√© p√©riodiquement au fur et √† mesure de l'ex√©cution des requ√™tes.  Ce rapport permet de d√©terminer qu'une file d'attente s'est form√©e provoquant une augmentation du retard.  Ce rapport nous donne le gradient ou l'amplitude du changement de temps de retard: <i>gradient = (RTTnoload / RTTactual)</i> .  Si la valeur est √©gale √† un, alors nous comprenons qu'il n'y a pas de file d'attente et que la limite peut √™tre augment√©e.  Une valeur inf√©rieure √† un indique que la file d'attente est pleine et que la limite doit √™tre r√©duite.  √Ä chaque nouvelle mesure du temps de retard, la limite est ajust√©e en fonction du rapport ci-dessus, et avec elle la taille de file d'attente autoris√©e change conform√©ment √† cette formule simple: <br><br><pre><code class="hljs">_ = _ √ó  + _</code> </pre> <br>  Pour plusieurs it√©rations, l'algorithme calcule une limite qui permet non seulement de maintenir le temps de retard √† un niveau bas, mais aussi de former la file d'attente de requ√™tes n√©cessaire en cas de flamb√©es d'activit√©.  La taille de file d'attente valide peut √™tre configur√©e.  Il est utilis√© pour d√©terminer la vitesse √† laquelle la limite de simultan√©it√© peut augmenter.  Comme taille par d√©faut, nous avons choisi la racine carr√©e de la valeur limite actuelle.  Ce choix est d√ª √† la propri√©t√© utile de la racine carr√©e: aux petites valeurs, elle sera suffisamment grande par rapport √† la limite pour assurer une croissance rapide, mais aux grandes valeurs, au contraire, sa valeur relative sera moindre, ce qui augmentera la stabilit√© du syst√®me. <br><br><h4>  Limites adaptatives en action </h4><br>  Les limites adaptatives c√¥t√© serveur rejettent les demandes excessives et maintiennent une faible latence, ce qui permet √† l'instance syst√®me de se prot√©ger et de prot√©ger les services dont elle d√©pend.  Auparavant, lorsqu'il n'√©tait pas possible de rejeter des demandes excessives, toute augmentation r√©guli√®re du nombre de demandes par seconde ou de retard entra√Ænait une augmentation encore plus importante de ce d√©lai et, finalement, la chute de l'ensemble du syst√®me.  Aujourd'hui, les services peuvent se d√©barrasser des charges de travail inutiles et maintenir une faible latence tout en travaillant avec d'autres outils de stabilisation, tels que la mise √† l'√©chelle automatique. <br><br><img src="https://habrastorage.org/webt/zh/vp/zx/zhvpzxo9x0fp_pb_ckdcf9plhks.png"><br><br>  Il est important de se rappeler que des limites sont fix√©es au niveau du serveur (et sans aucune coordination), que le trafic vers chaque serveur peut chuter et augmenter fortement.  Par cons√©quent, il n'est pas surprenant que la limite d√©tect√©e et le nombre de connexions simultan√©es puissent √™tre diff√©rents selon le serveur.  Cela est particuli√®rement vrai dans un environnement cloud multi-clients.  Par cons√©quent, une situation peut se produire lorsqu'un serveur est surcharg√©, bien que le reste soit gratuit.  Dans le m√™me temps, lors de l'√©quilibrage de la charge c√¥t√© client, une seule demande r√©p√©t√©e parviendra au serveur avec des ressources gratuites dans pr√®s de 100% des cas.  Et ce n'est pas tout: il n'y a plus de raison de craindre que des requ√™tes r√©p√©t√©es provoquent une attaque DDOS, car les services sont capables de rejeter rapidement (en moins d'une milliseconde) le trafic avec un impact minimal sur les performances. <br><br><h4>  Conclusion </h4><br>  L'utilisation de limites adaptatives pour les connexions parall√®les √©limine la n√©cessit√© de d√©terminer manuellement comment et dans quels cas nos services doivent rejeter le trafic.  De plus, cela augmente √©galement la fiabilit√© et la disponibilit√© globales de l'ensemble de notre √©cosyst√®me de microservices. <br><br>  Nous sommes heureux de partager avec vous nos m√©thodes de mise en ≈ìuvre et l'int√©gration globale de cette solution, que vous pouvez trouver dans la biblioth√®que publique √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/Netflix/concurrency-limits</a> .  Nous esp√©rons que notre code aidera les utilisateurs √† prot√©ger leurs services contre les d√©faillances en cascade et les probl√®mes li√©s √† l'augmentation de la latence, ainsi qu'√† accro√Ætre leur disponibilit√©. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413415/">https://habr.com/ru/post/fr413415/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413405/index.html">Les meilleurs livres, articles et ressources pour les produits pour d√©butants: les auteurs des produits T√©l√©grammes conseillent</a></li>
<li><a href="../fr413407/index.html">M√©thodes d'attribution dans les trackers populaires: correspondance d'ID de p√©riph√©rique, r√©f√©rence d'installation et empreinte digitale</a></li>
<li><a href="../fr413409/index.html">Kubernetes d'Amazon (EKS) rendu public</a></li>
<li><a href="../fr413411/index.html">Nous surveillons les sessions actives de PostgreSQL 10, comme dans Oracle</a></li>
<li><a href="../fr413413/index.html">Pr√©sentation des composants Symfony: configuration</a></li>
<li><a href="../fr413417/index.html">Efficacit√© √©nerg√©tique: les approches que nous testons en Russie</a></li>
<li><a href="../fr413419/index.html">R√©sum√© des nouvelles de PostgreSQL. Num√©ro 7</a></li>
<li><a href="../fr413421/index.html">Incertitudes possibles dans la carri√®re d'un programmeur</a></li>
<li><a href="../fr413423/index.html">Solutions d'acc√®s √† distance dans Mars IS</a></li>
<li><a href="../fr413427/index.html">Programmation pour les ing√©nieurs r√©seau: utilisation de la configuration</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>