<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ö±Ô∏è ü§üüèΩ üëéüèæ Empire ERP. Contabilidade divertida: contabilidade, contas, saldo üòª üë©üèø‚Äçü§ù‚Äçüë®üèæ üë®üèæ‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, tentaremos penetrar no cora√ß√£o da "empresa sangrenta" - contabilidade. Primeiro, faremos um estudo do raz√£o geral, das contas e do balan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Empire ERP. Contabilidade divertida: contabilidade, contas, saldo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471304/"><p> Neste artigo, tentaremos penetrar no cora√ß√£o da "empresa sangrenta" - contabilidade.  Primeiro, faremos um estudo do raz√£o geral, das contas e do balan√ßo, identificaremos suas propriedades e algoritmos inerentes.  Usamos a tecnologia Python e Test Driven Development.  Aqui estaremos envolvidos na prototipagem; portanto, em vez do banco de dados, usaremos os cont√™ineres b√°sicos: listas, dicion√°rios e tuplas.  O projeto est√° sendo desenvolvido de acordo com os requisitos do <a href="">projeto Empire ERP</a> . </p><a name="habracut"></a><br><h2 id="uslovie-zadachi">  Condi√ß√£o da tarefa </h2><br><p>  Espa√ßo ... Planeta da Imp√©rio ... Um estado em todo o planeta.  A popula√ß√£o trabalha 2 horas em 2 semanas, ap√≥s 2 anos para se aposentar.  O plano de contas consiste em 12 posi√ß√µes.  As contas 1 a 4 est√£o ativas, 5 a 8 s√£o passivas ativas e 9 a 12 s√£o passivas.  Empresa Horns &amp; Hooves.  Todas as transa√ß√µes s√£o realizadas em um per√≠odo de relat√≥rio, no in√≠cio do per√≠odo n√£o h√° saldos. </p><br><h2 id="nastroyka-proekta">  Configura√ß√£o do projeto </h2><br><p>  Clonamos o projeto no github: </p><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/nomhoi/empire-erp.git</code> </pre> <br><p>  Estamos desenvolvendo no Python 3.7.4.  Configure o ambiente virtual, ative-o e instale o <strong>pytest</strong> . </p><br><pre> <code class="bash hljs">pip install pytest</code> </pre> <br><h2 id="1-glavnaya-kniga">  1. Contabilidade </h2><br><p>  V√° para a pasta <strong>reaserch / day1 / step1</strong> . </p><br><p>  <strong>accounting.py</strong> : </p><br><pre> <code class="python hljs">DEBIT = <span class="hljs-number"><span class="hljs-number">0</span></span> CREDIT = <span class="hljs-number"><span class="hljs-number">1</span></span> AMOUNT = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GeneralLedger</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__str__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> res = <span class="hljs-string"><span class="hljs-string">'\nGeneral ledger'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self: res += <span class="hljs-string"><span class="hljs-string">'\n {:2} {:2} {:8.2f}'</span></span>.format(e[DEBIT], e[CREDIT], e[AMOUNT]) res += <span class="hljs-string"><span class="hljs-string">"\n----------------------"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res</code> </pre> <br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> accounting <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> decimal <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ledger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GeneralLedger() @pytest.mark.parametrize(<span class="hljs-string"><span class="hljs-string">'entries'</span></span>, [ [(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>)] ]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_ledger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ledger, entries)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> entry <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> entries: ledger.append((entry[DEBIT], entry[CREDIT], Decimal(entry[AMOUNT]))) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(ledger) == <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">0</span></span>][DEBIT] == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">0</span></span>][CREDIT] == <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">0</span></span>][AMOUNT] == Decimal(<span class="hljs-number"><span class="hljs-number">100.00</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">1</span></span>][DEBIT] == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">1</span></span>][CREDIT] == <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">1</span></span>][AMOUNT] == Decimal(<span class="hljs-number"><span class="hljs-number">100.00</span></span>) print(ledger)</code> </pre> <br><p>  O livro principal, como vemos, √© apresentado na forma de uma lista de registros.  Cada entrada √© projetada como uma tupla.  At√© o momento, para o registro da transa√ß√£o, usamos apenas os n√∫meros de conta para d√©bito e cr√©dito e o valor da transa√ß√£o.  Datas, descri√ß√µes e outras informa√ß√µes ainda n√£o s√£o necess√°rias, iremos adicion√°-las mais tarde. </p><br><p>  A trava do <strong>raz√£o</strong> e o teste parametrizado <strong>test_ledger foram</strong> criados no arquivo de teste.  No par√¢metro de teste de <strong>entradas</strong> , transferimos imediatamente toda a lista de transa√ß√µes.  Para verificar, executamos o comando <strong>pytest -s -v</strong> no terminal.  O teste deve passar e veremos no terminal toda a lista de transa√ß√µes armazenadas no Raz√£o: </p><br><pre> <code class="bash hljs">General ledger 1 12 100.00 1 11 100.00</code> </pre> <br><h2 id="2-scheta">  2. Contas </h2><br><p>  Agora vamos adicionar suporte √† fatura no projeto.  V√° para a pasta <strong>day1 / step2</strong> . </p><br><p>  <strong>accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GeneralLedger</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, accounts=None)</span></span></span><span class="hljs-function">:</span></span> self.accounts = accounts <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.accounts.append_entry(entry) super().append(entry)</code> </pre> <br><p>  A classe <strong>GeneralLedger</strong> sobrecarregou o m√©todo <strong>append</strong> .  Quando voc√™ adiciona uma transa√ß√£o a um livro, n√≥s a adicionamos imediatamente √†s contas. </p><br><p>  <strong>accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Account</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, id, begin=Decimal</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0.00</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.id = id self.begin = begin self.end = begin self.entries = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, id, amount)</span></span></span><span class="hljs-function">:</span></span> self.entries.append((id, amount)) self.end += amount <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Accounts</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(dict)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.range = range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.range: self[i] = Account(i) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append_entry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> self[entry[DEBIT]].append(entry[CREDIT], Decimal(entry[AMOUNT])) self[entry[CREDIT]].append(entry[DEBIT], Decimal(-entry[AMOUNT]))</code> </pre> <br><p>  A classe <strong>Accounts</strong> foi criada como um dicion√°rio.  Nas chaves, o n√∫mero da conta, nos valores, o conte√∫do da conta, ou seja,  uma inst√¢ncia da classe <strong>Account</strong> , que por sua vez cont√©m os campos de saldo de abertura e fechamento e uma lista de transa√ß√µes relacionadas a esta conta.  Observe que nesta lista os valores das transa√ß√µes de d√©bito e cr√©dito s√£o armazenados em um campo, o valor do d√©bito √© positivo e o valor do empr√©stimo √© negativo. </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture def accounts(): return Accounts() @pytest.fixture def ledger(accounts): return GeneralLedger(accounts)</span></span></code> </pre> <br><p>  No arquivo de teste, adicionamos o bloqueio de <strong>contas</strong> e ajustamos o bloqueio do <strong>raz√£o</strong> . </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries', [ [(1, 12, 100.00), (1, 11, 100.00)] ]) def test_accounts(accounts, ledger, entries): for entry in entries: ledger.append((entry[DEBIT], entry[CREDIT], Decimal(entry[AMOUNT]))) assert len(ledger) == 2 assert ledger[0][DEBIT] == 1 assert ledger[0][CREDIT] == 12 assert ledger[0][AMOUNT] == Decimal(100.00) assert len(accounts) == 12 assert accounts[1].end == Decimal(200.00) assert accounts[11].end == Decimal(-100.00) assert accounts[12].end == Decimal(-100.00) print(ledger) print(accounts)</span></span></code> </pre> <br><p>  Adicionado um novo teste <strong>test_accounts</strong> . </p><br><p>  Execute o teste e observe a sa√≠da: </p><br><pre> <code class="bash hljs">General ledger 1 12 100.00 1 11 100.00 ---------------------- Account 1 beg: 0.00 0.00 12: 100.00 0.00 11: 100.00 0.00 end: 200.00 0.00 ---------------------- Account 11 beg: 0.00 0.00 1: 0.00 100.00 end: 0.00 100.00 ---------------------- Account 12 beg: 0.00 0.00 1: 0.00 100.00 end: 0.00 100.00 ----------------------</code> </pre><br><p>  Nas classes <strong>Conta</strong> e <strong>Contas</strong> , os <strong>m√©todos __str__</strong> tamb√©m <strong>est√£o</strong> sobrecarregados, como voc√™ pode ver nas fontes do projeto.  Os valores dos lan√ßamentos e saldos para melhor clareza s√£o apresentados em duas colunas: d√©bito e cr√©dito. </p><br><h2 id="3-scheta-proverka-provodok">  3. Contas: verifica√ß√£o de lan√ßamento </h2><br><p>  Recordamos a seguinte regra: </p><br><pre> <code class="bash hljs">        .         .   -         .</code> </pre> <br><p>  Ou seja, em uma inst√¢ncia da classe <strong>Account</strong> , o valor final (saldo final) nas contas ativas n√£o pode ser negativo e, nas contas passivas, n√£o pode ser positivo. </p><br><p>  V√° para a pasta <strong>day1 / step3</strong> . </p><br><p>  <strong>accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BalanceException</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Exception)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><p>  Adicionada uma <strong>BalanceException</strong> . </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Account</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_active</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.id &lt; <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_passive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.id &gt; <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> ...</code> </pre> <br><p>  Uma verifica√ß√£o foi adicionada √† classe <strong>Conta</strong> para determinar se a conta est√° ativa ou passiva. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Accounts</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(dict)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_balance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self[entry[CREDIT]].end - Decimal(entry[AMOUNT]) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> self[entry[CREDIT]].is_active(): <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> BalanceException(<span class="hljs-string"><span class="hljs-string">'BalanceException'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self[entry[DEBIT]].end + Decimal(entry[AMOUNT]) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> self[entry[DEBIT]].is_passive(): <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> BalanceException(<span class="hljs-string"><span class="hljs-string">'BalanceException'</span></span>) ...</code> </pre> <br><p>  Uma verifica√ß√£o foi adicionada √† classe <strong>Accounts.py</strong> , se, como resultado da adi√ß√£o de uma nova transa√ß√£o, um valor de d√©bito negativo for gerado na conta ativa, uma exce√ß√£o ser√° gerada e a mesma coisa se uma conta passiva obtiver um valor de cr√©dito negativo. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GeneralLedger</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.accounts.check_balance(entry) self.accounts.append_entry(entry) super().append(entry) ...</code> </pre> <br><p>  Na classe <strong>GeneralLedger,</strong> antes de adicionar o lan√ßamento √†s contas, realizamos uma verifica√ß√£o.  Se uma exce√ß√£o for gerada, o lan√ßamento n√£o se enquadra nas contas ou no Raz√£o. </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries, exception', [ ([(12, 1, 100.00)], BalanceException('BalanceException')), ([(12, 6, 100.00)], BalanceException('BalanceException')), ([(12, 11, 100.00)], BalanceException('BalanceException')), ([(6, 2, 100.00)], BalanceException('BalanceException')), #([(6, 7, 100.00)], BalanceException('BalanceException')), #([(6, 12, 100.00)], BalanceException('BalanceException')), ([(1, 2, 100.00)], BalanceException('BalanceException')), #([(1, 6, 100.00)], BalanceException('BalanceException')), #([(1, 12, 100.00)], BalanceException('BalanceException')), ]) def test_accounts_balance(accounts, ledger, entries, exception): for entry in entries: try: ledger.append((entry[DEBIT], entry[CREDIT], Decimal(entry[AMOUNT]))) except BalanceException as inst: assert isinstance(inst, type(exception)) assert inst.args == exception.args else: pytest.fail("Expected error but found none") assert len(ledger) == 0 assert len(accounts) == 12</span></span></code> </pre> <br><p>  O teste <strong>test_accounts_balance</strong> foi adicionado ao <strong>m√≥dulo de</strong> teste.  A lista de transa√ß√µes listou primeiro todas as combina√ß√µes poss√≠veis de transa√ß√µes e comentou todas as transa√ß√µes que n√£o geram uma exce√ß√£o.  Execute o teste e verifique se as 5 op√ß√µes de lan√ßamento restantes <strong>geram</strong> uma <strong>BalanceException</strong> . </p><br><h2 id="4-balans">  4. Equil√≠brio </h2><br><p>  V√° para a pasta <strong>day1 / step4</strong> . </p><br><p>  <strong>accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Balance</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, accounts)</span></span></span><span class="hljs-function">:</span></span> self.accounts = accounts self.suma = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) self.sump = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.suma = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) self.sump = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.accounts.range: active = self.accounts[i].end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts[i].end &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) passive = -self.accounts[i].end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts[i].end &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) self.append((active, passive)) self.suma += active self.sump += passive</code> </pre> <br><p>  Ao criar um saldo, simplesmente coletamos os saldos de todas as contas em uma tabela. </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture def balance(accounts): return Balance(accounts)</span></span></code> </pre> <br><p>  Crie uma trava de <strong>equil√≠brio</strong> . </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries', [ [ ( 1, 12, 200.00), # increase active and passive ],[ ( 1, 12, 200.00), # increase active and passive (12, 1, 100.00), # decrease passive and decrease active ],[ ( 1, 12, 300.00), # increase active and passive (12, 1, 100.00), # decrease passive and decrease active ( 2, 1, 100.00), # increase active and decrease active ],[ ( 1, 12, 300.00), # increase active and passive (12, 1, 100.00), # decrease passive and decrease active ( 2, 1, 100.00), # increase active and decrease active (12, 11, 100.00), # decrease passive and increase passive ] ]) def test_balance(accounts, ledger, balance, entries): for entry in entries: ledger.append(entry) balance.create() print(accounts) print(balance)</span></span></code> </pre> <br><p>  N√≥s criamos o teste <strong>test_balance</strong> .  A lista de par√¢metros listou todos os tipos poss√≠veis de transa√ß√µes: aumentando o ativo e o passivo, diminuindo o ativo e o passivo, aumentando o ativo e diminuindo o ativo, aumentando o passivo e diminuindo o passivo.  Foram emitidas 4 op√ß√µes para lan√ßamentos, para que voc√™ possa passo a passo ver a sa√≠da.  Para a √∫ltima op√ß√£o, a sa√≠da √© a seguinte: </p><br><pre> <code class="plaintext hljs">General ledger 1 12 300.00 12 1 100.00 2 1 100.00 12 11 100.00 ---------------------- Account 1 beg: 0.00 0.00 12: 300.00 0.00 12: 0.00 100.00 2: 0.00 100.00 end: 100.00 0.00 ---------------------- Account 2 beg: 0.00 0.00 1: 100.00 0.00 end: 100.00 0.00 ---------------------- Account 11 beg: 0.00 0.00 12: 0.00 100.00 end: 0.00 100.00 ---------------------- Account 12 beg: 0.00 0.00 1: 0.00 300.00 1: 100.00 0.00 11: 100.00 0.00 end: 0.00 100.00 ---------------------- Balance 1 : 100.00 0.00 2 : 100.00 0.00 3 : 0.00 0.00 4 : 0.00 0.00 5 : 0.00 0.00 6 : 0.00 0.00 7 : 0.00 0.00 8 : 0.00 0.00 9 : 0.00 0.00 10 : 0.00 0.00 11 : 0.00 100.00 12 : 0.00 100.00 ---------------------- sum: 200.00 200.00 ======================</code> </pre> <br><h2 id="5-storno">  5. Reverso </h2><br><p>  Agora vamos verificar como a revers√£o √© realizada. </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries', [ [ ( 1, 12, 100.00), ( 1, 12,-100.00), ] ]) def test_storno(accounts, ledger, balance, entries): for entry in entries: ledger.append(entry) balance.create() print(ledger) print(accounts) print(balance)</span></span></code> </pre> <br><p>  A conclus√£o foi a seguinte: </p><br><pre> <code class="bash hljs">General ledger 1 12 100.00 1 12 -100.00 ---------------------- Account 1 beg: 0.00 0.00 12: 100.00 0.00 12: 0.00 100.00 end: 0.00 0.00 ---------------------- Account 12 beg: 0.00 0.00 1: 0.00 100.00 1: 100.00 0.00 end: 0.00 0.00 ---------------------- Balance 1 : 0.00 0.00 2 : 0.00 0.00 3 : 0.00 0.00 4 : 0.00 0.00 5 : 0.00 0.00 6 : 0.00 0.00 7 : 0.00 0.00 8 : 0.00 0.00 9 : 0.00 0.00 10 : 0.00 0.00 11 : 0.00 0.00 12 : 0.00 0.00 ---------------------- sum: 0.00 0.00 ======================</code> </pre><br><p>  Tudo parece estar certo. </p><br><p>  E se usarmos esse conjunto de postagens, o teste ser√° aprovado: </p><br><pre> <code class="python hljs">( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), ( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">-100.00</span></span>),</code> </pre> <br><p>  E se esse conjunto, trocar as duas √∫ltimas linhas em alguns lugares, obteremos uma exce√ß√£o: </p><br><pre> <code class="python hljs">( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), ( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">-100.00</span></span>), (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>),</code> </pre> <br><p>  Portanto, para detectar esse erro, a revers√£o deve ser feita imediatamente ap√≥s a corre√ß√£o da transa√ß√£o. </p><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>  Nos artigos a seguir, continuaremos o estudo da contabilidade e consideraremos todos os aspectos do desenvolvimento do sistema de acordo com a lista de requisitos para o Empire ERP. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt471304/">https://habr.com/ru/post/pt471304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt471294/index.html">Poemas sobre Haskell, C ++ e programadores</a></li>
<li><a href="../pt471296/index.html">Lean Manufacturing - uma ferramenta para a efici√™ncia</a></li>
<li><a href="../pt471298/index.html">Bieber e Bilan acenam com uma caneta. AI agora est√° cantando m√∫sicas</a></li>
<li><a href="../pt471300/index.html">Reagir: elevar o estado est√° matando seu aplicativo</a></li>
<li><a href="../pt471302/index.html">Verifica√ß√£o do usu√°rio na China e cr√©dito social</a></li>
<li><a href="../pt471306/index.html">Desenvolvimento do plug-in VPN do Continent-AP para o sistema operacional Sailfish</a></li>
<li><a href="../pt471310/index.html">Minha opini√£o muito subjetiva sobre o profissional e n√£o apenas a educa√ß√£o em TI</a></li>
<li><a href="../pt471312/index.html">Preparando-se para a certifica√ß√£o profissional da Spring. Bota de mola</a></li>
<li><a href="../pt471318/index.html">Resumo de aprendizado de m√°quina e intelig√™ncia artificial de setembro</a></li>
<li><a href="../pt471320/index.html">Ferramentas para desenvolvedores de software: Framework aberto e bibliotecas de aprendizado de m√°quina</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>