<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∏ ü§õüèª ‚ÜóÔ∏è A longa hist√≥ria do guia - como eu escrevi um servi√ßo para trilhas inteligentes por 5 anos üöµüèº üßëüèø‚Äçü§ù‚Äçüßëüèø üìâ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muitos t√™m um ou mais de seus projetos dom√©sticos. S√£o pequenas utilidades, pe√ßas experimentais, amostras de novas tecnologias, ‚Äúassassinos‚Äù do Facebo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A longa hist√≥ria do guia - como eu escrevi um servi√ßo para trilhas inteligentes por 5 anos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471216/"><p>  Muitos t√™m um ou mais de seus projetos dom√©sticos.  S√£o pequenas utilidades, pe√ßas experimentais, amostras de novas tecnologias, ‚Äúassassinos‚Äù do Facebook e muito mais.  Notavelmente com menos frequ√™ncia esses projetos est√£o envolvidos por um longo tempo. </p><br><p>  No artigo, compartilharei minha experi√™ncia e contarei como, por cinco anos, trabalhei ocasionalmente no desenvolvimento de um guia inteligente para S√£o Petersburgo, como consegui n√£o abandonar esse neg√≥cio, como a atitude em rela√ß√£o ao projeto mudou e o que aconteceu no final. </p><br><p><img src="https://habrastorage.org/webt/ee/8f/lg/ee8flg22vilx7tptxu7jal6iity.jpeg"></p><a name="habracut"></a><br><blockquote>  Muitas solu√ß√µes t√©cnicas e bicicletas duvidosas s√£o descritas abaixo, mas n√£o se surpreenda - quase todas elas s√£o justificadas pelas metas e recursos dispon√≠veis naquele momento (= geralmente meu conhecimento e tempo) </blockquote><br><h2 id="ideya">  Id√©ia </h2><br><p>  Em qualquer grande cidade tur√≠stica, existem centenas de guias, bons e n√£o muito bons, onde as principais rotas s√£o pintadas, os principais pontos e v√°rias outras informa√ß√µes √∫teis. <br>  Mas as rotas s√£o constantes e limitadas, e os pontos tur√≠sticos geralmente s√£o apenas os mais importantes, como "o que ver em 3 dias". </p><br><p>  Portanto, surgiu a ideia de construir rotas inteligentes.  O usu√°rio seleciona os pontos A e B e recebe n√£o a rota mais curta cl√°ssica, mas algo pr√≥ximo a ela, mas passando pelas atra√ß√µes pr√≥ximas. </p><br><p>  A audi√™ncia desse guia n√£o √© apenas turistas, mas tamb√©m residentes locais que desejam diversificar suas rotas t√≠picas para casa / trabalho / loja (e, no final, houve essas avalia√ß√µes no aplicativo!) Ou simplesmente para conhecer melhor a cidade. </p><br><p>  <strong>TL; DR</strong> <br>  O resultado final √© o aplicativo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wander</a> Android, que agora funciona apenas para S√£o Petersburgo. </p><br><h2 id="akt-1-prototip">  Ato 1: Prot√≥tipo </h2><br><p> A ideia voltou √† universidade em 2014, nem tenho certeza de que ela era originalmente minha; em algum curso, foi necess√°rio dividir-se em grupos, criar projetos e conclu√≠-los como um trabalho de conclus√£o de curso.  Eles falharam e geraram a ideia do projeto e, em seguida, o nome <code>TravelPath</code> come√ßou. </p><br><p>  Era para ser um servi√ßo da web, eu sabia um pouco sobre PHP, ent√£o escolhi o PHP. <br>  Foi necess√°rio resolver v√°rios problemas: </p><br><p>  <strong>1. Base de Atra√ß√µes</strong> <br>  Aqui nos encontramos com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenStreetMap</a> , e esse √© o projeto mais legal que nos conv√©m perfeitamente.  O OSM √© um projeto de mapa da comunidade, sem fins lucrativos, baseado na comunidade.  Como a Wikipedia, apenas sobre mapas. <br>  Fa√ßa o download do mapa no formato xml de S√£o Petersburgo - <a href="">h√°</a> uma lista de recursos onde voc√™ pode fazer isso. <br>  Naquele momento, lembro-me de que os arquivos de mapas pesavam mais de 1 GB; portanto, um analisador de fluxo cont√≠nuo √© escrito para selecionar objetos de categorias pr√©-selecionadas - monumentos, parques, igrejas, museus. <br>  O OSM possui uma extensa documenta√ß√£o sobre tags, atributos e tudo o que voc√™ precisa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> , gra√ßas a isso n√£o ser√° dif√≠cil descobrir como obter os dados necess√°rios dos cart√µes. </p><br><p>  Os dados cartogr√°ficos s√£o criados por entusiastas, portanto, nem todos os lugares e nem sempre os objetos t√™m as tags necess√°rias, alguns lugares t√™m erros, problemas.  Mas para grandes cidades, os dados s√£o de alta qualidade. </p><br><p>  Se eu descobri corretamente meu c√≥digo antigo, usei as seguintes tags para buscar objetos: </p><br><ul><li>  <code>building</code> significado <code>cathedral</code> , <code>chapel</code> , <code>church</code> tornou-se uma categoria de <code>church</code> </li><li>  <code>amenity</code> com os valores das <code>fountain</code> cai no <code>monument</code> </li><li>  <code>tourism</code> com valores de <code>artwork</code> e <code>viewpoint</code> vai para <code>monument</code> , <code>zoo</code> e <code>museum</code> para <code>museum</code> e <code>theme_park</code> para <code>park</code> </li><li>  <code>historic</code> com <code>boundary_stone</code> , <code>castle</code> , <code>memorial</code> , valores do <code>monument</code> vai para a categoria <code>monument</code> </li><li>  <code>leisure</code> com um valor no <code>park</code> naturalmente, acaba no <code>park</code> </li></ul><br><p>  Colocamos todos os objetos recebidos em um banco de dados com coordenadas e nos alegramos!  Mais de 1.200 pontos foram lan√ßados em S√£o Petersburgo. </p><br><p>  <strong>2. Construindo uma rota</strong> <br>  N√£o era para implementar sistemas complexos como parte do curso, e como o conhecimento t√©cnico era escasso na √©poca, decidimos dividir a rota em duas partes: a escolha dos objetos na rota e a pr√≥pria rota.  Em parte, isso determinou o destino do futuro, porque mais tarde eu n√£o quis mudar esse esquema. </p><br><p>  A constru√ß√£o de uma rota entre os pontos selecionados foi dada pela API do Google Maps, que construiu rotas de carro muito bem, mas na √©poca n√£o sabia andar, pelo menos na R√∫ssia. </p><br><p>  A escolha dos objetos teve que ser implementada por voc√™ mesmo.  O resultado foi o seguinte esquema do aplicativo: </p><br><p><img src="https://habrastorage.org/webt/qf/ji/cu/qfjicujbis8zm-4ojiuumt9vkqk.jpeg"></p><br><p>  A principal desvantagem da abordagem √© a sele√ß√£o de pontos na rota sem levar em conta o mapa, apenas com base nas coordenadas GPS.  E, no geral, isso funciona razoavelmente bem, especialmente onde h√° uma grade de ruas frequente.  Problemas raros s√£o vis√≠veis ao longo de rios com pontes raras, por exemplo. </p><br><p>  Em seguida, criamos um algoritmo para selecionar pontos na rota.  Por um lado, √© necess√°rio que a rota n√£o desvie muito para o lado, mas, por outro lado, ainda seleciona alguns pontos nos bairros em quest√£o. </p><br><p>  N√£o √© uma afirma√ß√£o muito clara do problema, saiu o mesmo algoritmo, algo semelhante ao A * ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki</a> ): acredita-se que de cada ponto haja transi√ß√µes para cada um.  Al√©m disso, em A *, o pre√ßo de ir para o v√©rtice n ao procurar a rota AB √© geralmente expresso da seguinte forma: <code>f(n) = g(An) + h(nB)</code> , onde <code>g(x,y)</code> √© o comprimento do caminho de x para y, <code>h(x,y)</code> √© uma estimativa heur√≠stica da dist√¢ncia de x a y.  Meu pre√ßo √© o mesmo - <code>f(n) = h(x,n) + h(n,y) * q</code> , onde q √© uma constante menor que 1. Alterando o valor de q, voc√™ pode afetar o n√∫mero de pontos na rota. </p><br><p>  Implementamos o algoritmo e, parab√©ns, tudo funciona, fixamos a interface, compramos um dom√≠nio, carregamos para a hospedagem, escrevemos relat√≥rios e outras burocracias e nos alegramos!  Parecia algo assim (e n√£o mudou muito depois): </p><br><p><img src="https://habrastorage.org/webt/b3/fw/uz/b3fwuz0lqz_x3z2adx9qv-usau8.jpeg"></p><br><p>  <strong>Total:</strong> recebi um prot√≥tipo de uma id√©ia interessante, conheci o OSM, a API do Google, trabalhei em equipe, obtive cr√©dito na universidade e tamb√©m foi interessante. </p><br><h2 id="akt-2-pervaya-polnocennaya-web-versiya">  Ato 2: primeira vers√£o web completa </h2><br><p>  Gostei muito da ideia e decidi desenvolv√™-la ainda mais, mas j√° uma.  E ficou imediatamente claro o que era necess√°rio antes de tudo: naquela √©poca, o Google Maps ainda n√£o era capaz de construir rotas a p√©, apenas as de autom√≥veis.  E toda a id√©ia do aplicativo √© principalmente sobre caminhadas, o que significa que voc√™ precisa ser capaz de construir rotas ao longo dos becos sombrios de parques, passarelas para pedestres, pontes e muito mais. </p><br><p>  Foi em 2015, e continuei a trabalhar no TravelPath, assumi a corre√ß√£o dessa falha fatal - comecei a construir maneiras por conta pr√≥pria. </p><br><p>  Eu n√£o mudei a tecnologia, <code>PHP</code> + <code>MySQL</code> .  Obviamente, percebi imediatamente que essa n√£o era a melhor pilha t√©cnica para essa tarefa (construir rotas em PHP? S√©rio?). <br>  Mas eu tinha um tempo limitado e n√£o estava pronto para mudar para uma pilha mais razo√°vel e, em segundo lugar, at√© agora o projeto estava escrito "em cima da mesa" - eu gostaria de usar esse aplicativo em um dispositivo m√≥vel e, naqueles anos, significava apenas desenvolvimento nativo.  Ou seja, sua inaplicabilidade na forma de uma vers√£o da Web era √≥bvia, apesar de algumas tentativas de criar uma interface adapt√°vel. </p><br><p>  Surgiram as seguintes tarefas: </p><br><p>  <strong>1. Obtendo um gr√°fico da cidade</strong> <br>  Aqui o mesmo OSM nos salva.  Mais uma vez, baixe o gr√°fico no formato xml, analise-o, selecionando apenas os tipos de estradas necess√°rios e maravilhe-se com a quantidade de dados - naquele momento, mais de 3 milh√µes de v√©rtices e 500 mil arestas foram lan√ßados.  A primeira id√©ia √© que o gr√°fico pode n√£o estar relacionado. <br>  Quaisquer p√°tios, territ√≥rios fechados, coisas incompreens√≠veis n√£o s√£o muito interessantes para a constru√ß√£o de uma rota; portanto, selecionamos algum ponto, contornamos todo o gr√°fico, marcando os v√©rtices passados ‚Äã‚Äãe obtendo a parte conectada do gr√°fico. <br>  No total, surgiram mais de 600 mil picos e 150 mil arestas. <br>  Salva os recebidos no banco de dados e sai para tempos melhores. </p><br><p>  <strong>2. Construindo uma rota</strong> <br>  Existem dados, tudo √© deixado para os pequenos: crie rotas nele.  N√£o tivemos que inventar nada de novo - lembre-se do curso de algoritmos, leia atentamente os artigos sobre como trabalhar com gr√°ficos, pegue o algoritmo A *, implemente-o em PHP e <del>  regozijar-se </del>  frustrado com o qu√£o lentamente tudo funciona. </p><br><p>  Existem muitos dados, portanto, ao construir o gr√°fico, usamos n√£o o completo, mas apenas lemos parte dele - tudo o que cai no ret√¢ngulo obtido de todos os pontos selecionados na rota. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qc/p7/9k/qcp79klhlir-x7udd5im-0h-cw0.jpeg"></div><br><p>  (quadro vermelho = ~ esse gr√°fico foi lido para construir o caminho) </p><br><p>  O mesmo acontece com os pontos candidatos √† rota - levamos em conta n√£o tudo, mas apenas aqueles entre o in√≠cio e o fim + um pequeno valor. <br>  Depois de selecionar o tamanho desse ret√¢ngulo (a constante pela qual o aumentamos), tentamos garantir que lemos o tamanho m√≠nimo de dados necess√°rio. <br>  Havia tamb√©m a id√©ia de dividir a cidade em quadrados, construindo o percurso primeiro por quadrados e, depois, lendo o gr√°fico dentro desses quadrados e procurando um caminho apenas ao longo dele.  E voc√™ pode pr√©-calcular os caminhos entre todos os quadrados vizinhos.  Ou ainda mais - para calcular e salvar o caminho entre todos os pontos tur√≠sticos.  Ent√£o, na hora, resta construir apenas os caminhos do objeto inicial ao primeiro e do √∫ltimo objeto √† linha de chegada. <br>  Mas as m√£os n√£o alcan√ßaram a realiza√ß√£o de tais bicicletas. </p><br><p>  <strong>3. Roteamento em um per√≠odo de tempo razo√°vel</strong> <br>  Imediatamente ficou claro que o gargalo √© o armazenamento e o trabalho com dados - o pr√≥prio algoritmo de busca n√£o √© particularmente acelerado.  E benchmarks no joelho confirmam que a maior parte do tempo √© gasta lendo o banco de dados e manipula√ß√µes semelhantes. <br>  O que deve ser feito nesses casos?  N√£o guarde este gr√°fico.  Mas eu tenho uma maneira especial, <code>MySQL</code> e nada mais, mas o problema precisa ser resolvido. </p><br><ol><li>  O primeiro - os dados foram normalizados, o que era conveniente ao analisar, mas ler dezenas de milhares de registros e at√© duas tabelas √© doloroso.  A solu√ß√£o √≥bvia √© criar uma de duas tabelas (para v√©rtices e arestas), apenas para arestas, nas quais em cada registro as coordenadas dos v√©rtices e seu ID. </li><li>  Contamos com anteced√™ncia os v√©rtices mais pr√≥ximos do gr√°fico aos pontos tur√≠sticos, e n√£o fazemos isso sempre. </li><li>  Uma quantidade significativa de tempo √© gasta pesquisando o ponto do gr√°fico mais pr√≥ximo do usu√°rio especificado.  Para acelerar isso, dividi o gr√°fico inteiro em pequenos setores. Usando a f√≥rmula de coordenadas, voc√™ pode obter instantaneamente o ID do setor e selecionar o v√©rtice apenas dentro do setor, e n√£o no gr√°fico inteiro, que √© muito mais r√°pido. </li></ol><br><p>  Depois de todas as manipula√ß√µes, conseguimos construir qualquer rota a p√© razo√°vel em S√£o Petersburgo em 2 segundos, o que parece bom - esse √© um tempo de espera aceit√°vel para os usu√°rios. <br>  O esquema final saiu assim: </p><br><p><img src="https://habrastorage.org/webt/gk/f0/mh/gkf0mhnk5i9xnnnm6g1eym_a3ce.jpeg"></p><br><p>  <strong>Total:</strong> familiarizei-me ainda melhor com os dados do OSM; na pr√°tica, resolvi problemas de gr√°ficos (o caso em que os algoritmos de gr√°ficos finalmente foram √∫teis), escrevi meus primeiros benchmarks. </p><br><h2 id="akt-3-pervaya-normalnaya-web-versiya">  Ato 3: a primeira vers√£o normal da web </h2><br><p>  A√≠ v√™m os primeiros pensamentos sobre o projeto como um produto que pode ser √∫til para algu√©m, e n√£o sobre o artesanato em cima da mesa. <br>  Ent√£o, voc√™ precisa resolver os dois problemas mais importantes: </p><br><ol><li>  Ficou imediatamente √≥bvio que a constru√ß√£o de rotas como eu fiz no √∫ltimo par√°grafo est√° errada. </li><li>  Um guia no navegador pode n√£o ser conveniente para ningu√©m - voc√™ deseja passear pela cidade, procurando um aplicativo conveniente onde possa ler o que h√° de especial por a√≠ e assim por diante.  Em suma, pelo menos - voc√™ precisa de uma interface adapt√°vel legal e, de uma maneira boa, de um aplicativo m√≥vel. </li></ol><br><p>  Mas, nesta fase, decidi lidar apenas com o primeiro ponto.  Estudamos a Internet sobre esse assunto e aqui novamente o OSM ajuda, ou melhor, o projeto que nasceu gra√ßas a eles - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OSRM</a> . <br>  Com base nos dados do mapa do OSM, a Open Source Routing Machine pode construir uma variedade de rotas em um bom momento.  Sim, e um projeto de c√≥digo aberto com boa documenta√ß√£o que voc√™ pode instalar no servidor e usar. <br>  Como b√¥nus, ele tamb√©m possui uma API bastante conveniente. <br>  E o antaresmo j√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">escreveu</a> sobre OSRM em um habr que me ajudou na √©poca.  √â verdade que muita √°gua correu e o artigo est√° desatualizado.  Mas muito obrigado ao autor!  A documenta√ß√£o real e muito boa est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br>  Ap√≥s uma instala√ß√£o bem-sucedida, lan√ßamos, quase sem arrependimento, todo o nosso c√≥digo sobre as rotas e come√ßamos a seguir as rotas na API OSRM, e o diagrama final √© o seguinte: </p><br><p><img src="https://habrastorage.org/webt/by/2_/sg/by2_sgklt4qfns1b6l_i544t9z8.jpeg"></p><br><p>  Nem sequer tocamos na parte do cliente; por sua vez, a API do nosso servi√ßo n√£o muda de forma alguma. </p><br><p>  <strong>Total</strong> : pensei no uso real do aplicativo por outros, ele acabou sendo uma arquitetura normal e boas rotas.  A vers√£o web ainda est√° dispon√≠vel, embora n√£o tenha sido alterada desde ent√£o.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://travelpath.ru/</a> </p><br><h2 id="akt-4-android-prilozhenie">  Ato 4: aplicativo para Android </h2><br><p>  Apesar da solu√ß√£o para um problema passado, ainda est√° claro que o projeto ainda √© in√∫til para todos, exceto eu.  Porque voc√™ precisa de uma interface normal e, mais importante, de um aplicativo m√≥vel, n√£o de uma vers√£o do navegador.  Agora a tecnologia avan√ßou e, talvez, j√° seja poss√≠vel criar um aplicativo de navegador desse tipo para clientes m√≥veis, mas n√£o em 2015-2016.  O que significava uma possibilidade muito estreita de usar o projeto na forma de uma vers√£o da Web - para ficar em casa, selecione lugares interessantes para visitar com anteced√™ncia.  Portanto, se estamos falando de um produto normal, voc√™ precisa de um aplicativo m√≥vel com uma boa interface. </p><br><p>  Ent√£o, em 2016, comecei a escrever em Java (mas o back-end) e pensei que, no Android, eles tamb√©m escreviam em Java.  Por que n√£o tentar o desenvolvimento de aplicativos, deve ser uma experi√™ncia interessante. <br>  O segundo problema √© que eu n√£o sei projetar e n√£o fa√ßo uma boa interface.  Eu vim visitar meu primeiro local de trabalho (um pequeno est√∫dio Le-Dantu) e convidei meu colega <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Burovk para</a> participar do projeto.  Curiosamente, ele concordou, pelo qual muito obrigado :) </p><br><p>  <strong>Os primeiros layouts e prot√≥tipo</strong> <br>  Primeiro de tudo, estamos tentando criar um novo nome, porque o TravelPath n√£o √© uma abrevia√ß√£o muito e muito faladora.  E assim, atrav√©s dos esfor√ßos de Cyril, aparece "Wander" com um logotipo engra√ßado: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6t/8y/7f/6t8y7fht6pqmxvwnajhrtimxe5u.png"></div><br><p>  Eu o associei fortemente a um homem de bigode, mas em geral eu gosto. </p><br><p>  Aparecem os primeiros layouts do futuro aplicativo: </p><br><p><img src="https://habrastorage.org/webt/t4/u6/x8/t4u6x8pszrlpk7vop64rizgsywu.jpeg"></p><br><p>  Tamb√©m pensamos, discutimos, a segunda op√ß√£o aparece, que se torna a primeira vers√£o do aplicativo: </p><br><p><img src="https://habrastorage.org/webt/uk/nr/py/uknrpyeckiz1gdqogmtyngojun4.jpeg"></p><br><p>  Do lado do desenvolvimento, decidi conscientemente n√£o usar todos os tipos de estruturas da moda que fazem m√°gica diferente - porque h√° grandes riscos ao us√°-las sem entender o trabalho, e estudar tanto o b√°sico quanto eles consome muito tempo.  Google, lemos docas oficiais, artigos educacionais e superamos dificuldades. </p><br><p>  Dos problemas e tarefas lembrados: </p><br><ul><li>  Para o Android, existe o <code>ProGuard</code> - um utilit√°rio que comprime o c√≥digo fonte durante a montagem, elimina o n√£o utilizado, altera nomes e muito mais.  √â razo√°vel que exista, mas quando voc√™ entra no desenvolvimento e faz voc√™ mesmo - n√£o √© √≥bvio que h√° campos de renomea√ß√£o e isso pode afetar o comportamento.  E que tudo acontece apenas na montagem de prod.  Como resultado do lan√ßamento, tudo √© legal, mas por algum motivo n√£o h√° estat√≠sticas.  Voc√™ come√ßa a debitar no back-end - e o cliente envia algumas bobagens, em vez dos nomes normais dos campos - <code>a, b, c</code> , etc.  Muletas para que a API seja capaz de analisar isso com habilidade e, em seguida, voc√™ descobre que o ProGuard tentou e precisa especificar as classes necess√°rias como uma exce√ß√£o em sua configura√ß√£o.  Nada incomum em geral, mas o rel√≥gio de depura√ß√£o voou para longe. </li><li>  Uma tarefa interessante foi atualizar os dados do aplicativo.  O banco de dados principal vem com um arquivo <code>apk</code> e eu o atualizo antes de cada lan√ßamento.  Mas voc√™ tamb√©m precisa oferecer suporte √† atualiza√ß√£o pela rede, para que os clientes sempre tenham dados atualizados, se houver alguma altera√ß√£o. <br>  Na primeira vers√£o, decidi me concentrar apenas na hora da √∫ltima atualiza√ß√£o.  O aplicativo armazena o hor√°rio do objeto mais recente; a cada in√≠cio, ele pergunta ao back-end com esse hor√°rio se algo novo apareceu.  As atualiza√ß√µes s√£o enviadas a ele; o cliente se lembra novamente da hora do mais novo dos objetos recebidos (mas n√£o da hora da atualiza√ß√£o em si, isso √© importante). <br>  Aconteceu que eu pensei mal - porque um ano depois apareceu uma quinta categoria - edif√≠cios.  E ao atualizar da vers√£o antiga para a nova, surge um problema.  Eu tive que mudar um pouco e o cliente envia um tempo para cada categoria, n√£o a geral.  Mas o esquema ainda n√£o √© perfeito - ao adicionar novos campos aos objetos, surgem problemas que n√£o podem ser resolvidos dessa maneira.  Existem id√©ias sobre como fazer melhor, mas as m√£os n√£o chegaram e, em geral, a tarefa n√£o √© muito priorit√°ria.  Moralidade - vale a pena abordar cuidadosamente essas quest√µes e pensar um pouco com anteced√™ncia. </li></ul><br><p>  E tamb√©m quero dizer o que todo mundo j√° sabe - o Stack Overflow √© incrivelmente legal e isso √© especialmente percept√≠vel quando voc√™ desenvolve algo estranho do jeito que eu fiz - escreva imediatamente o aplicativo e n√£o com tranq√ºilidade nos cursos, guias e exemplos de demonstra√ß√£o .  E quando n√£o h√° ningu√©m para perguntar a um amigo.  Mas, al√©m dele, as conversas sobre o desenvolvimento do Android tamb√©m ajudaram - a√≠ voc√™ pode fazer perguntas mais abstratas e pedir dicas sobre a melhor forma de fazer algo. </p><br><p>  5 de dezembro de 2016 o aplicativo acessa o Google Play <br>  Ele tinha apenas fun√ß√µes b√°sicas - estabelecer uma rota, visualizar informa√ß√µes sobre pontos.  Mas mesmo isso pareceu um sucesso!  Sucesso, √© claro, apenas aos seus pr√≥prios olhos.  Havia um entendimento de que o aplicativo ainda √© bruto e precisa ser aprimorado. </p><br><p>  <strong>A primeira vers√£o completa e a m√≠dia</strong> <br>  Portanto, considero o pr√≥ximo lan√ßamento uma vers√£o completa e o primeiro lan√ßamento. <br>  Antes de tudo, revisamos o design e o logotipo - agora ficou assim: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4c/0q/ii/4c0qii9_t77tgksfkp31mldx94k.png" width="96"></div><br><p>  E eles adicionaram funcionalidades importantes para o guia - favoritos, pontos de visualiza√ß√£o no pr√≥prio mapa, uma lista de atra√ß√µes com uma pesquisa.  O aplicativo atualizado ficou assim: </p><br><p><img src="https://habrastorage.org/webt/eo/fh/2j/eofh2jhc1tjz8lyrc1t-ra9kpnk.jpeg"></p><br><p>  Outra id√©ia surgiu - entrar em contato com a Museum Night e criar um modo separado para o evento em S√£o Petersburgo. <br>  A Noite dos Museus √© um feriado internacional anual, onde os museus ficam abertos √† noite, com programas especiais.  Um √∫nico bilhete √© v√°lido e muitos tentam percorrer muitos museus ao mesmo tempo.  Ao mesmo tempo, n√£o h√° navegador / mapa para celular - apenas algumas funcionalidades no site oficial do evento. <br>  Parece que ele se encaixa perfeitamente com a id√©ia de Wander e tamb√©m est√° em demanda.  Entrei em contato com os organizadores do evento, mas, infelizmente, a id√©ia n√£o foi apreciada e permaneceu em minha mente at√© tempos melhores. </p><br><p>  No final, ficou legal e, finalmente, o aplicativo p√¥de ser totalmente utilizado.  Em 2 de junho de 2018, um lan√ßamento foi lan√ßado e decidimos tentar mostr√°-lo ao mundo - compramos publicidade no VKontakte e no Instagram.  Mas o mais importante, eles escreveram para alguns meios de comunica√ß√£o.  O jornal escreveu uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nota</a> sobre o lan√ßamento do aplicativo, depois que v√°rias publica√ß√µes de Petersburgo - The Village, Dog e outros - foram escritas ou reimpressas com um f√£.  E, finalmente, houve tr√°fego!  As instala√ß√µes surgiram com um pico, tamb√©m gr√°ficos de atividades dentro do aplicativo.  Obviamente, n√£o tivemos que nos alegrar por muito tempo - mas recebemos os primeiros usu√°rios, um feedback √∫til e, em geral, foi muito motivador.  No mesmo ver√£o, o tr√°fego da pesquisa do Google Play foi not√°vel, o que foi muito agrad√°vel, mas mais tarde o resultado n√£o p√¥de ser reproduzido. <br>  Ao todo, isso deu uma forte motiva√ß√£o e ajudou a continuar trabalhando no aplicativo. </p><br><p>  <strong>O que fazer depois?</strong>  <strong>Museum Night, Google mal, rotas circulares</strong> </p><br><p>  A temporada passou, a atividade no aplicativo caiu drasticamente e ficou claro que apenas serrar recursos n√£o √© muito √∫til - ningu√©m os ver√°, n√£o h√° or√ßamento para marketing.  Era necess√°rio inventar alguma coisa e, em seguida, voltamos √† id√©ia adiada com a Noite dos Museus. <br>  Mas, novamente, n√£o foi poss√≠vel chegar a um acordo, mas desta vez decidimos n√£o adiar a id√©ia, mas fazer tudo por conta pr√≥pria.  Ele resultou em v√°rios recursos √∫teis em um modo de guia separado: museus no mapa, rotas apenas para participantes, informa√ß√µes breves, favoritos. </p><br><p>  Al√©m desse modo, mesmo no backlog, conseguimos a preserva√ß√£o da rota e, mais importante, o recurso sobre rotas circulares. </p><br><p>  As rotas circulares eram sempre mais importantes que as rotas AB, mas eram teimosamente ignoradas.  Ainda assim, as pessoas costumam andar pelo metr√¥ / casa / trabalho / hotel do que propositalmente de A a B. Finalmente, elas alcan√ßaram suas m√£os e eu criei uma heur√≠stica simples: <br>  Obtemos todos os pontos dentro do raio especificado.  Raio √© o limitador do comprimento da rota.  Selecionamos primeiro algum ponto (aleatoriamente condicional).  Todos os outros s√£o ordenados em ordem crescente do √¢ngulo entre ele, o centro e o ponto especificado.          /  ,  . </p><br><p>       ,            . </p><br><p>     ,  ,   : </p><br><p><img src="https://habrastorage.org/webt/fe/nx/6s/fenx6slnfgifc85nw-prhsv51mq.jpeg"></p><br><p>    ,   ,       ,     ,  ,    .     ‚Äî  ,         , . </p><br><p>        Kotlin   , ,   Wander.   ,     .    ,   .         ,     java   ‚Äî       . </p><br><p>     ,  ,  ,   .          ‚Äî    The Village.        -        1000 ,    1400   . ,      Wander  , , ,       .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> . </p><br><p>    Google  .            ‚Äî  2018      ,         API.        ‚Äî         2018-        <code>Places API</code>   .         API,   -  ‚Äî        .        . </p><br><p>        ‚Äî  <code>Places API</code> ,          .        ,      .  ,         ‚Äî   Google Maps,    .           . </p><br><p> <strong></strong> :  android        Google Play,       .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">burovk</a> ,    Wander    ,       . </p><br><h2 id="ty-teper-ne-tolko-razrabotchik">      </h2><br><p>    ,   ,       ,     ‚Äî       .      ,  ,    ,      ‚Äî     .   ,   ‚Äî ,      .    ,         ,     . </p><br><ul><li>                 ‚Äî          <code>git tag v1.0.5</code> . </li><li>   ,   ,   ,    . </li><li>         -   ,       . </li><li>            ‚Äî      ,    //etc       . </li></ul><br><p>        Android  .      , ,      ,       . </p><br><p>       ‚Äî      ,    . </p><br><h2 id="plany">  </h2><br><p>  !  ,       .  , ,    ,           ,      ,   . <br>      : </p><br><ol><li>     ‚Äî ? -   ? </li><li>   .   ,    ‚Äî   . </li><li>   IOS </li><li>   </li></ol><br><p>     . ,   IOS      ,    . </p><br><p>      ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Google Play</a> . </p><br><h2 id="vyvody">  Conclus√µes </h2><br><ul><li>      ,   ‚Äî .      ,          .           . ,       . </li><li>   ‚Äî  ,      .   backend ,       ,    android   Kotlin,   ,  ,     .     ,     . </li><li>      ‚Äî .      - ,           .   -   .   ,    ‚Äî   . </li></ul><br><p>     .         IOS (   ) ‚Äî   ! </p><br><p>  PS <br>         ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://habr.com/post/414433/</a> .         . ,       (    -!),       . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt471216/">https://habr.com/ru/post/pt471216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt471198/index.html">Estudamos a afirma√ß√£o do teorema do limite central usando a distribui√ß√£o exponencial</a></li>
<li><a href="../pt471202/index.html">Como n√£o consegui ligar o meu MacBook devido √† desinstala√ß√£o do TeamViewer</a></li>
<li><a href="../pt471204/index.html">Reconhecer data e hora na fala natural</a></li>
<li><a href="../pt471210/index.html">Deus ... Balada sobre um programador</a></li>
<li><a href="../pt471212/index.html">10 dicas e truques para ajudar voc√™ a se tornar o melhor desenvolvedor do VueJS</a></li>
<li><a href="../pt471220/index.html">Cockpit - simplifique tarefas administrativas t√≠picas no Linux atrav√©s de uma interface web conveniente</a></li>
<li><a href="../pt471222/index.html">Compreender as pol√≠ticas de privacidade de aplicativos e servi√ßos ajudar√° redes neurais</a></li>
<li><a href="../pt471226/index.html">O Linux tem muitas faces: como trabalhar em qualquer distribui√ß√£o</a></li>
<li><a href="../pt471228/index.html">Grokay PyTorch</a></li>
<li><a href="../pt471232/index.html">Minha experi√™ncia conectando o LPS331AP ao Omega Onion2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>