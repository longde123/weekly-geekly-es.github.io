<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÜüèø üëßüèæ üóëÔ∏è L√≥gica de juego com√∫n en el cliente y el servidor. üîä üë®üèΩ‚Äçüîß ü¶É</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En Pixonic DevGAMM Talks, nuestro DTO Anton Grigoriev tambi√©n habl√≥. Nosotros en la compa√±√≠a ya dijimos que estamos trabajando en un nuevo tirador PvP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L√≥gica de juego com√∫n en el cliente y el servidor.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/429312/">  En Pixonic DevGAMM Talks, nuestro DTO Anton Grigoriev tambi√©n habl√≥.  Nosotros en la compa√±√≠a ya dijimos que estamos trabajando en un nuevo tirador PvP y Anton comparti√≥ algunos de los matices de la arquitectura de este proyecto.  Dijo c√≥mo construir el desarrollo para que los cambios en la l√≥gica del juego del cliente aparezcan autom√°ticamente en el servidor (y viceversa), y si es posible no escribir c√≥digo, sino minimizar el tr√°fico.  A continuaci√≥n hay un registro y una transcripci√≥n del informe. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/eFd4WZBHqDw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  No aprender√© c√≥mo hacer algo, hablar√© sobre c√≥mo lo hicimos.  Para que no pises el mismo rastrillo y puedas usar nuestra experiencia.  Hace un a√±o y medio, nosotros en la compa√±√≠a no sab√≠amos c√≥mo hacer tiradores en tel√©fonos m√≥viles.  Dices c√≥mo es, tienes War Robots, 100 millones de descargas, 1,5 millones de DAU.  Pero en este juego, los robots son muy lentos, y quer√≠amos hacer un tirador r√°pido, y la arquitectura de War Robots no lo permiti√≥. <br><br>  Sab√≠amos c√≥mo y qu√© hacer, pero no ten√≠amos experiencia.  Luego contratamos a una persona que ten√≠a esta experiencia y dijo: haz lo mismo que ya has hecho cientos de veces, solo que mejor.  Luego se sentaron y comenzaron a pensar en la arquitectura. <br><br><img src="https://habrastorage.org/webt/ta/cm/lz/tacmlz5phqxz6vg6kvpdjwjklaq.png"><br><br>  Lleg√≥ al Entity Component System (ECS).  Creo que mucha gente sabe lo que es.  Todos los objetos del mundo est√°n representados por entidades.  Por ejemplo, un jugador, su arma, alg√∫n objeto en el mapa.  Tienen propiedades que se describen por componentes.  Por ejemplo, el componente Transformar es la posici√≥n del jugador en el espacio, y el componente Salud es su salud.  Hay l√≥gica: est√° separada y representada por sistemas.  T√≠picamente, los sistemas son el m√©todo Execute (), que pasa a trav√©s de componentes de cierto tipo y hace algo con ellos, con el mundo del juego.  Por ejemplo, MoveSystem pasa por todos los componentes de Movimiento, observa la velocidad en este componente, el par√°metro y, sobre la base de esto, calcula la nueva posici√≥n del objeto, es decir  lo escribe para transformar. <br><br>  Tal arquitectura tiene sus propias caracter√≠sticas.  Cuando se desarrolla en ECS, debe pensar y hacer las cosas de manera diferente.  Una de las ventajas es la composici√≥n en lugar de la herencia m√∫ltiple.  ¬øRecuerdas esta r√≥mbica con herencia m√∫ltiple en C ++?  Todos sus problemas.  Este no es el caso en ECS. <br><br><img src="https://habrastorage.org/webt/eh/0e/2-/eh0e2-7mx_yl1ls4gp65yobizew.png"><br><br>  La segunda caracter√≠stica es la separaci√≥n de l√≥gica y datos, de la que ya habl√©.  ¬øQu√© nos da esto?  Podemos almacenar el estado del mundo y su historia en lotes, podemos serializarlo, podemos enviar estos datos a trav√©s de la red y cambiarlos en tiempo real.  Estos son solo datos en la memoria: podemos cambiar cualquier valor en cualquier momento.  Por lo tanto, es muy conveniente cambiar la l√≥gica del juego (o para depurar). <br><br>  Tambi√©n es muy importante realizar un seguimiento del orden de las llamadas al sistema.  Todos los sistemas van uno tras otro, son llamados por el m√©todo Execute () e, idealmente, deber√≠an ser independientes.  En la pr√°ctica, esto no sucede.  Un sistema cambia algo en el mundo, otro sistema lo usa.  Y si rompemos este orden, el juego ser√° diferente.  Probablemente no mucho, pero definitivamente no es lo mismo que antes. <br><br>  Finalmente, una de las caracter√≠sticas principales y m√°s importantes para nosotros es que podemos ejecutar el mismo c√≥digo tanto en el cliente como en el servidor. <br><br>  Dale una oportunidad al desarrollador, y encontrar√° 99 formas y razones para tomar su decisi√≥n, y no usar√° las existentes.  Creo que muchos lo hicieron.  Est√°bamos buscando el Marco ECS en ese momento.  Consideramos Entitas, Artemis C #, Ash.net y nuestra propia soluci√≥n, que podr√≠a escribirse a partir de la experiencia de un especialista que vino a nosotros. <br><br><img src="https://habrastorage.org/webt/v8/sb/dt/v8sbdteegwxn_milbcee_wc6qde.png"><br><br>  No intente leer lo que est√° escrito en la diapositiva, no es tan importante.  Lo importante es cu√°nto verde y rojo hay en las columnas.  Verde significa que la soluci√≥n es compatible con los requisitos, rojo - no es compatible, amarillo - es compatible, pero no del todo. <br><br>  En la columna, ECS es potencialmente nuestra soluci√≥n.  Como puede ver, est√° m√°s fresco: podr√≠amos admitir muchos m√°s requisitos.  Como resultado, no admitimos algunos de ellos (principalmente porque no eran necesarios), y algunos, sin los cuales no podr√≠amos trabajar m√°s, tuvieron que hacerse.  Elegimos la arquitectura, trabajamos durante mucho tiempo, hicimos una versi√≥n m√≠nimamente jugable y ... fakap. <br><br><img src="https://habrastorage.org/webt/5d/hg/7r/5dhg7r6qkdvxzcbj1svjtshafvk.png"><br><br>  Result√≥ la versi√≥n m√°s injugable.  El jugador constantemente retroced√≠a, frenaba, el servidor colgaba en el medio del partido.  Era imposible jugarlo.  ¬øCu√°les fueron las razones de los fracasos? <br><br>  Raz√≥n # 1 y lo m√°s importante es la inexperiencia.  Pero como es eso?  Contratamos a una persona con experiencia que se supon√≠a que deb√≠a hacer todo maravillosamente.  S√≠, pero en realidad le dimos solo una parte del trabajo.  Dijimos: "Aqu√≠ hay un servidor de juegos para usted, trabaje en √©l".  Y en nuestra arquitectura (m√°s sobre esto m√°s adelante), el cliente juega un papel muy importante.  Y fue esta parte la que le dimos a un hombre que no ten√≠a la experiencia necesaria.  No, es un buen programador, se√±or. Simplemente no hab√≠a experiencia.  Es decir  no ten√≠a idea de qu√© tipo de rastrillo podr√≠a haber. <br><br>  Raz√≥n # 2 - asignaciones poco realistas.  80 KB / trama.  ¬øEs mucho o no?  Si tenemos en cuenta que tenemos 30 cuadros por segundo, en un segundo obtenemos 2.5 MB, y para un partido de 5 minutos ya hay m√°s de 600 MB.  En resumen, mucho.  El recolector de basura comienza a tratar intensamente de liberar toda esta memoria (cuando le exigimos m√°s y m√°s), lo que conduce a picos.  Dado que quer√≠amos 30 cuadros por segundo, estos picos nos interfer√≠an mucho.  Adem√°s, tanto en el cliente como en el servidor. <br><br>  La raz√≥n principal de las asignaciones fue que constantemente asignamos matrices de datos.  Casi cada vez cada cuadro.  Utiliza LINQ, expresiones lambda y Photon.  Photon es una biblioteca de red con la que estamos familiarizados y utilizamos en War Robots.  Y todo parece estar bien, pero asigna memoria cada vez que env√≠a datos o los recibe. <br><br>  Si solucionamos los primeros problemas (reescribimos a nuestras colecciones personalizadas, hicimos el almacenamiento en cach√©), entonces pr√°cticamente no hab√≠a nada que hacer con Photon, porque es una biblioteca de terceros.  Solo era posible reducir el tama√±o del paquete, y ten√≠amos 5 Kbytes.  Mucho?  Si  Hay MTU: este es el tama√±o de paquete real m√≠nimo que se env√≠a a trav√©s de UDP, sin dividir el paquete en partes peque√±as.  Es aproximadamente 1.5 Kbytes, y tuvimos 5 (en promedio, hab√≠a m√°s). <br><br>  En consecuencia, Photon cort√≥ nuestro paquete en peque√±os y envi√≥ cada pieza como confiable, es decir  Con entrega garantizada.  Cada vez que la parte no llegaba, la enviaba una y otra vez.  Obtuvimos a√∫n m√°s latencia y la red funcion√≥ mal. <br><br>  Todas estas asignaciones condujeron al hecho de que recibimos un marco de aproximadamente 100 milisegundos cuando se necesitaba 33. Y all√≠, renderizaci√≥n, simulaci√≥n y otras acciones, todo esto requiere la CPU.  Todos estos problemas son complejos, es decir  era imposible decidir uno, y todo estar√≠a bien.  Era necesario resolverlos todos a la vez. <br><br>  Y otro peque√±o problema que se produjo durante el desarrollo: una gran cantidad de repositorios.  5 est√° escrito en la diapositiva, pero me parece que hab√≠a a√∫n m√°s.  Todos estos repositorios (para el cliente, el servidor del juego, el c√≥digo com√∫n, la configuraci√≥n y algo m√°s) estaban conectados por subm√≥dulos en los dos repositorios principales para el cliente y el servidor del juego.  Fue dif√≠cil trabajar con √©l.  Los programadores pueden trabajar con Git, SVN, pero tambi√©n hay artistas, dise√±adores, etc.  Creo que muchos trataron de ense√±arle a un artista o dise√±ador c√≥mo trabajar con un sistema de control de versiones.  Esto es realmente dif√≠cil, por lo que si su dise√±ador sabe c√≥mo hacerlo, cu√≠delo, es un empleado valioso.  En nuestro caso, incluso los programadores se asustaron y, como resultado, redujimos todo a un solo repositorio. <br><br>  Esta fue una gran soluci√≥n al problema.  Tenemos una carpeta con un servidor all√≠ y una carpeta con un cliente.  El servidor consta de un proyecto de servidor de juegos, un generador de c√≥digo y herramientas auxiliares. <br><br><img src="https://habrastorage.org/webt/ws/rg/6e/wsrg6ecn8sdodaa-uh1r_koqtoq.png"><br><br>  Un cliente es un cliente de Unity y un c√≥digo com√∫n.  Un c√≥digo com√∫n es una estructura de datos mundial, es decir  Entidades, componentes y simulaci√≥n de sistemas.  Este c√≥digo es generado principalmente por el generador del servidor.  Es usado por el servidor.  Es decir  Esta es una parte com√∫n para el cliente y el servidor. <br><br>  La vida  Tomamos TeamCity, lo configuramos en nuestro repositorio, recopilamos e implementamos el servidor.  Cada vez que un cliente cambia la l√≥gica general, se ensambla un servidor de juegos aqu√≠, ahora no se necesita un programador de servidor para esto.  Por lo general, hay un servidor, un cliente y algunas caracter√≠sticas.  El cliente lo corta en casa, el servidor en casa, y alg√∫n d√≠a funcionar√° para ellos.  En nuestro caso, no es as√≠: el cliente puede escribir esta funci√≥n y todo funciona en el servidor. <br><br>  La coincidencia consta de una parte com√∫n (designada como ECS) y una presentaci√≥n (estas son clases unitarias MonoBehavior, GameObjects, modelos, efectos, todo lo que el mundo representa).  No est√°n conectados <br><br><img src="https://habrastorage.org/webt/gh/dp/xf/ghdpxftm1m0fo6gqp51bmkifrw0.png"><br><br>  Entre ellos hay presentadores, que trabaja con ambas partes.  Como comprender√°, este es MVP (Model-View-Presenter) y cualquiera de estas partes se puede reemplazar si es necesario.  Hay otra parte que funciona con la red (en la diapositiva - Red).  Esto es serializaci√≥n de informaci√≥n sobre el mundo, serializaci√≥n de entrada, env√≠o al servidor, recepci√≥n por el servidor, conexi√≥n al servidor, etc. <br><br>  M√°s me gusta.  Tomamos y reemplazamos esta parte con un paquete que no es real, a trav√©s de la red, sino virtual.  Creamos un objeto dentro del cliente y le enviamos mensajes.  Implementa una simulaci√≥n de servidor: ahora este objeto hace todo lo que sucedi√≥ en el servidor del juego.  Los jugadores restantes son reemplazados por bots. <br><br><img src="https://habrastorage.org/webt/tn/gk/l3/tngkl3sijbk-emyfrzvwivkxyw0.png"><br><br>  Listo  Obtuvimos el juego y la capacidad de probarlo sin un servidor de juegos.  ¬øQu√© significa esto?  Esto significa que el artista, despu√©s de haber hecho un nuevo efecto, puede hacer clic en el bot√≥n Reproducir en el editor, ir inmediatamente al partido en el mapa y ver c√≥mo funciona.  O depurar para los programadores del cliente lo que escribieron. <br><br>  Pero fuimos m√°s all√° y nos unimos a esta emulaci√≥n de capa del jitter ping de los retrasos de la red (esto es cuando los paquetes en la red no llegan en el orden en que fueron enviados) y otras cosas de la red.  Como resultado, obtuvimos una coincidencia pr√°cticamente real sin un servidor de juegos.  Funciona, verificado. <br><br>  Volvamos a la generaci√≥n de c√≥digo. <br><br><img src="https://habrastorage.org/webt/vb/jd/kb/vbjdkbu6g6ot2a1jdyak4o84v8m.png"><br><br>  Ya he dicho que tenemos un generador de c√≥digo en un servidor de juegos.  Hay un lenguaje espec√≠fico de dominio, que en realidad es una clase simple de C #.  En este caso, la clase Salud.  Lo marcamos con nuestros atributos.  Por ejemplo, hay un atributo componente.  √âl dice que la salud es un componente en nuestro mundo.  Seg√∫n este atributo, el generador crear√° una nueva clase de C # en la que habr√° un mont√≥n de cosas.  Se pueden escribir a mano, pero generar√°.  Por ejemplo, el m√©todo de agregar un componente a la entidad, el m√©todo de b√∫squeda de componentes, serializaci√≥n de datos, etc.  Hay un atributo del tipo DontSend, que dice que no es necesario enviar un campo a trav√©s de la red: el servidor no lo necesita o el cliente no lo necesita.  O el atributo Mach, que informa que el jugador tiene un valor de salud m√°ximo de mil.  ¬øQu√© nos da esto?  En lugar de un campo que ocupa 32 bits (int), enviamos 10 bits, tres veces menos.  Tal generador de c√≥digo nos permiti√≥ reducir el tama√±o del paquete de 5 KB a 1. <br><br><img src="https://habrastorage.org/webt/1u/bx/bx/1ubxbxiuebsnmqh7v822vjo-xgs.png"><br><br>  1 KB &lt;1.5 - es decir  Conocimos a la MTU.  El fot√≥n dej√≥ de cortar y la red mejor√≥ mucho.  Casi todos sus problemas se han ido.  Pero fuimos m√°s all√° e hicimos una compresi√≥n delta. <br><br><img src="https://habrastorage.org/webt/bg/m1/gp/bgm1gpgzxdlktns_-3rentd-ceo.png"><br><br>  Esto es cuando env√≠a un estado completo, y luego solo sus cambios.  No sucede que todo el mundo haya cambiado por completo de inmediato.  Solo algunas partes cambian constantemente y estos cambios son mucho m√°s peque√±os en tama√±o que el estado mismo.  Recibimos un promedio de 300 bytes, es decir  17 veces menos de lo que era originalmente. <br><br>  ¬øPor qu√© es esto necesario si ya te metiste en MTU?  El juego est√° en constante crecimiento, aparecen nuevas caracter√≠sticas, y con ellas aparecen objetos, entidades, nuevos componentes.  El tama√±o de los datos est√° creciendo.  Si nos detuvi√©ramos en 1 KB, muy pronto volver√≠amos al mismo problema.  Ahora, habi√©ndolo reescrito para la compresi√≥n delta, no alcanzaremos esto muy pronto. <br><br>  Ahora la parte m√°s dulce.  Sincronizaci√≥n  Si juegas tiradores, sabes lo que es Input Lag: cuando haces clic en el bot√≥n y el personaje comienza a moverse despu√©s de un tiempo, por ejemplo, medio segundo.  Para algunos juegos en el g√©nero de la mafia, esto es normal.  Pero en el tirador, quieres que el h√©roe dispare y haga da√±o all√≠ mismo. <br><br><img src="https://habrastorage.org/webt/5q/ts/4t/5qts4t4xpvyygxwgkrjzffuzwam.png"><br><br>  ¬øPor qu√© ocurre el retraso de entrada?  El cliente recoge la entrada (entrada) del jugador y la env√≠a al servidor del juego (el env√≠o lleva tiempo).  Luego, el servidor del juego lo procesa (nuevamente, tiempo) y env√≠a el resultado nuevamente (nuevamente, tiempo).  Esto es un retraso.  ¬øC√≥mo quitarlo?  Hay una cosa llamada predicci√≥n: el cliente no espera una respuesta del servidor e inmediatamente comienza a intentar hacer lo mismo que el servidor del juego, es decir.  finge  Toma la entrada del jugador y comienza la simulaci√≥n.  Solo simulamos un cliente local, porque no conocemos la opini√≥n de otros jugadores, ellos no vienen a nosotros.  Por lo tanto, ejecutamos el sistema de simulaci√≥n solo en nuestro reproductor. <br><br>  En primer lugar, permite reducir el tiempo de simulaci√≥n.  El cliente inicia la simulaci√≥n tan pronto como recibe la entrada y est√° varios pasos por delante en relaci√≥n con el servidor del juego.  Digamos que en esta imagen est√° simulando la marca # 20.  En este punto, el servidor del juego simula la marca # 15 en el pasado.  El cliente ve el resto del mundo, nuevamente, en el pasado, √©l mismo, en el futuro.  Mientras env√≠a el 20 ¬∞ tick al servidor, mientras esta entrada llega, el servidor del juego ya comenzar√° a simular el 18 ¬∞ tick o ya el 20 ¬∞.  Si es el 18, lo coloca en el b√∫fer, llega al 20, procesa y devuelve el resultado. <br><br>  Digamos ahora que est√° simulando la marca No. 15.  Procesado, devuelve el resultado al cliente.  El cliente tiene alg√∫n tipo de 15¬∫ tic simulado, 15¬∫ estado del juego y el mundo del juego que predijo.  Comienza la comparaci√≥n con el servidor.  De hecho, √©l no compara al mundo entero, sino solo a su cliente, porque no somos responsables del resto del mundo.  Solo somos responsables de nosotros mismos.  Si el jugador coincidi√≥, todo est√° bien, lo que significa que simulamos correctamente, la f√≠sica funcion√≥ correctamente y no surgieron colisiones.  Luego continuamos simulando la marca 20, la 21 y as√≠ sucesivamente. <br><br>  Si el cliente / jugador no coincide, significa que nos equivocamos en alguna parte.  Ejemplo: como la f√≠sica no es determinista, no calcul√≥ correctamente nuestra posici√≥n o sucedi√≥ algo.  Tal vez solo un error.  Luego, el cliente toma el estado del servidor del juego, porque el servidor del juego ya lo ha confirmado (conf√≠a en el servidor; si no confiaba, los jugadores har√≠an trampa), y volver√° a simular el resto del 15 al 20.  Porque esta rama del tiempo ahora es err√≥nea. <br><br>  Crear una nueva rama de tiempo, es decir  mundos paralelos.  Resimulamos estas cinco marcas en una sola marca.  Una vez que nuestra simulaci√≥n tom√≥ 5 milisegundos, pero si necesitamos simular 10 ticks, ya son 50 milisegundos y no caemos en nuestros 30 milisegundos.  Se optimizaron y obtuvieron un milisegundo: ahora se procesan 10 ticks en 10 milisegundos.  Porque todav√≠a hay renderizado. <br><br>  Todas estas cosas funcionan en el cliente, y se lo dimos a la persona sin la experiencia necesaria.  Menos, tuvimos un fakap, y adem√°s, que el programador ahora sabe c√≥mo hacerlo bien. <br><br><img src="https://habrastorage.org/webt/zt/ph/j9/ztphj9138fs3coanbgqad_ef15w.png"><br><br>  Este esquema tiene sus propias caracter√≠sticas.  El cliente en la imagen de la izquierda est√° tratando de localizar al enemigo.  √âl est√° en la marca 20, el oponente est√° en la marca 15.  Porque ping y el cliente est√°n 5 tics por delante del servidor.  El cliente dispara y debe golpear con precisi√≥n y causar da√±os, tal vez incluso un tiro en la cabeza.  Pero la imagen es diferente en el servidor: cuando el servidor comienza a simular la vig√©sima marca, el enemigo ya puede moverse.  Por ejemplo, si el enemigo se estaba moviendo.  En teor√≠a, no deber√≠amos llegar.  Pero si eso funcionara as√≠, entonces nadie jugar√≠a tiradores en l√≠nea debido a fallas constantes.  Dependiendo del ping, la probabilidad de golpear tambi√©n cambi√≥: cuanto peor sea el ping, peor ser√°.  Por lo tanto, lo hacen de manera diferente. <br><br>  El servidor lleva y rueda todo el mundo a la teca en la que el jugador vio el mundo.  El servidor sabe cu√°ndo fue, lo regresa a la marca 15 y ve la imagen de la izquierda.  √âl ve que el jugador deber√≠a haber golpeado y le hace da√±o a su oponente ya en la vig√©sima marca.  Todo esta bien.  Casi.  Si el enemigo huy√≥ y corri√≥ detr√°s de un obst√°culo, entonces disparamos a la cabeza ya a trav√©s del muro.  Pero este es un problema conocido, los jugadores lo saben y no se preocupen.  Entonces funciona, no hay nada que hacer al respecto. <br><br><img src="https://habrastorage.org/webt/fy/f3/4g/fyf34g2zncwjpautyl5n-ea68qe.png"><br><br>  Entonces, hemos alcanzado 30 tics por segundo, 30 cuadros por segundo.  Ahora, aproximadamente 600 jugadores est√°n jugando en nuestro servidor al mismo tiempo.  Hay 6 jugadores en el partido, es decir  Cerca de 100 partidos.  No tenemos un programador de servidor, no lo necesitamos.  Los clientes escriben toda la l√≥gica en el editor de Unity, Rider, en C # y funciona en un servidor de juegos.  Casi siempre  Redujimos el tama√±o del paquete en 17 veces y redujimos las asignaciones de memoria en 80 veces, ahora incluso menos de un kilobyte en el cliente y el servidor.  El ping promedio fue de 200-250 ms, ahora es de 150. 200 es el est√°ndar para los juegos de redes m√≥viles, a diferencia de una PC, donde todo sucede mucho m√°s r√°pido, especialmente en una red local. <br><br><img src="https://habrastorage.org/webt/k8/sb/ko/k8sbkorut9xfqgnvrkiy5ngrljc.png"><br><br>  Planeamos aislar lo que est√° escrito en un marco separado para usarlo en otros proyectos.  Pero hasta ahora, no se habla de c√≥digo abierto.  Y agregue interpolaci√≥n all√≠.  Ahora tenemos 30 tics por segundo, podemos dibujar a medida que avanza.  Pero hay juegos en los que 20 tics por segundo o 10 son suficientes. En consecuencia, si dibujamos 10 veces por segundo, los personajes se mover√°n en tirones.  Por lo tanto, se necesita interpolaci√≥n.  Escribimos nuestra propia biblioteca de red en lugar de Photon; all√≠ no hay asignaciones de memoria. <br><br>  Todav√≠a hay partes que no puedes escribir con tus manos, pero generan c√≥digo.  Por ejemplo, cuando enviamos el estado del mundo a un cliente, eliminamos los datos que no necesita.  Mientras hacemos esto con nuestras manos y cuando aparece una nueva caracter√≠stica, y olvidamos recortar estos datos, algo sale mal.  De hecho, esto puede generarse marcando alg√∫n atributo. <br><br><h3>  Preguntas de la audiencia </h3><br>  <b>- ¬øQu√© est√°s usando para la generaci√≥n de c√≥digo?</b>  <b>¬øTu propia decisi√≥n?</b> <br><br>  - Todo es simple - manos.  Pensamos hacer algo listo, pero result√≥ ser m√°s r√°pido solo escribir con nuestras propias manos.  Siga este camino, funcion√≥ bien entonces y ahora. <br><br>  <b>- Rechaz√≥ al desarrollador del servidor, pero no solo redujo el tiempo de desarrollo debido al hecho de que se reutiliza el mismo c√≥digo.</b>  <b>Unity no es compatible con la √∫ltima versi√≥n de C #, tiene su propio motor debajo del cap√≥.</b>  <b>No puede usar .NET Core, no puede usar las √∫ltimas caracter√≠sticas, ciertas estructuras y m√°s.</b>  <b>¬øEl rendimiento no sufre aproximadamente un tercio de esto?</b> <br><br>  - Cuando comenzamos a hacer todo esto, pensamos que para usar no clases, sino estructuras, deber√≠a haber funcionado mucho m√°s r√°pido.  Escribimos un prototipo de c√≥mo se ver√° en el c√≥digo, c√≥mo los programadores usar√°n estas estructuras para escribir la l√≥gica.  Y fue terriblemente inc√≥modo.  Nos decidimos por las clases y el rendimiento que tenemos ahora es suficiente para nosotros. <br><br>  <b>- ¬øC√≥mo vives ahora sin interpolaci√≥n?</b>  <b>¬øY c√≥mo pretendes ser un jugador si la instant√°nea no viene en el marco correcto?</b> <br><br>  - Tenemos interpolaci√≥n, solo que no es visual, sino en aquellos paquetes que vienen a trav√©s de la red.  Digamos que tenemos los estados 18, 19 y 20.  18-,  20-,  19-  ,     ‚Äî    .      ,     . <br><br> <b>‚Äî    ,    ?</b> <br><br> ‚Äî    2D ‚Äî    ,          .      :     UDP,    ,    :     ,        .     . <br><br> <b>‚Äî         ?</b> <br><br>  "S√≠, por supuesto".  -    (  ,      ,    ),    2 :    ,    . <br><br> <b>‚Äî       .     ?   ?    1000   ,  ?  ,    ?</b> <br><br> ‚Äî   ,   .        ,       -,     ,   .  ,    30 . <br><br> <b>‚Äî      ,       ?</b> <br><br> ‚Äî . ,       (     ),     .    ‚Äî ,     , .  -   ,      ,        .  , ,  ,        ,   .    . <br><br> <b>‚Äî         ECS,   ,     ?      ?</b> <br><br> ‚Äî 30    ,      . 80     ,    .      . <br><br> <b>‚Äî     prediction.    20-  - ,      ,          -   ‚Äî    ,  ? ,         .   -  ?</b> <br><br> ‚Äî   :          .     (, 15-)  16-,17-,18-   . <br><br> <b>‚Äî      ?</b> <br><br> ‚Äî ,          .    , , .     Entity (   ),    .          ‚Äî       ,      . ID  ,        . <br><br> <b>‚Äî  -    ‚Äî     ,   ,     ,    ?   ,      ?</b> <br><br> ‚Äî , ,  .  3D    ,     ‚Äî    ,             ,  - .      ,   ,     .   top-down,   ‚Äî    .      .     ,   ,       ,    .     . <br><br> <b>‚Äî       ?</b> <br><br> ‚Äî   .  Esto tambi√©n pasa. <br><br> <b>‚Äî    ,        ,    - .  -         .   -  ,      ,   , 500 , ,     -     - .   ?</b> <br><br> ‚Äî  . <br><br><img src="https://habrastorage.org/webt/5q/ts/4t/5qts4t4xpvyygxwgkrjzffuzwam.png"><br><br>     , ..   20-    20- ,      .    ‚Äî    ,      .   :    20-  ,          ?       ,    . ,      ‚Äî -     .      ,   .      ,  ¬´    - ,  21-,  18-¬ª. : ¬´,    - ¬ª.   . <br><br> <b>‚Äî ..    ,           ?</b> <br><br> ‚Äî ,      . <br><br> <b>‚Äî    reliable UDP ‚Äî   -  ?</b> <br><br> ‚Äî  Photon,  Photon  reliable UDP, unreliable, c     . <br><br> <b>‚Äî    ?</b> <br><br> ‚Äî    ,   -.     ,      . ,   .    ,    .      ,         .     100%,     ,   80%,    . <br><br> <b>‚Äî  ?</b> <br><br> ‚Äî ,   , Photon   ,     MTU. <br><br> <b>‚Äî      ?   ?</b> <br><br> ‚Äî  ,   ,  ,      .     .  ,  .    ,   ,       ,    . <br><br> <b>‚Äî  ,    ,    ?</b> <br><br> ‚Äî   ,     .       ,     . , ,  . , -   .     ,   .   ,      . <br><br> <b>‚Äî       /   ‚Äî     -  .      ,     .</b> <br><br> ‚Äî   ,            . ,   (    ),       -,     ,     -.  ,   .    ‚Äî  ,   . <br><br> <b>‚Äî     ,  -  .      ?</b> <br><br> ‚Äî    ,    .             : ECS,    .       , ECS  .   ,   ECS .  ,       .  ,  ,   ,   (  ,   ,    ,  ,    ,   ).    2D ,   ,     3D ‚Äî    .  3D    , ,   .       .   - ,    .   ,       - -,      . <br><br> <b>‚Äî    ,  ECS      ,   .   ,  ,    C#?</b> <br><br> ‚Äî    ‚Äî . <br><br> <b>‚Äî ..     ES  ?   , ECS ‚Äî      ,         ,    ,       . .. ECS ‚Äî     ,     .</b> <br><br> ‚Äî   ,  ,     .     ,  .   ‚Äî   ,    ,    .   ,    O  -  ,    ,    . <br><br> <b>‚Äî ,   ECS-  ?</b> <br><br> ‚Äî  -, ECS    ,   ,   (   )    ‚Äî   ,     .    ,      ‚Äî   .  ‚Äî    ,     ,    .     ,   , ,   .. <br><br><h3>    Pixonic DevGAMM Talks </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> Consul   stateful-</a> ( , DevOps   BIT.GAMES); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CICD:        </a> ( ,   Pixonic); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">     -  Quake Champions</a> ( , backend- Saber Interactive); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> -  - Tacticool</a> ( , Lead Software Engineer  PanzerDog); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> ECS, C# Job System  SRP    </a> ( , Field Engineer  Unity); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> KISS  </a> ( , Lead Game Programmer  1C Game Studios); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cucumber  :  BDD-    </a> ( , Technical Product Manager, ALICE Platform). </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429312/">https://habr.com/ru/post/es429312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429298/index.html">Actualizaciones en VPS.today</a></li>
<li><a href="../es429302/index.html">Uso de UTF-8 en encabezados HTTP</a></li>
<li><a href="../es429306/index.html">Viernes Bullshit 4.3</a></li>
<li><a href="../es429308/index.html">C√≥mo dej√© una startup en una gran empresa</a></li>
<li><a href="../es429310/index.html">Contrataci√≥n, caza, formaci√≥n y desarrollo de rubistas. Rinc√≥n de recursos humanos en la conferencia RubyRussia-2018</a></li>
<li><a href="../es429314/index.html">Descripci√≥n general de las populares plataformas de lanzamiento criptogr√°fico</a></li>
<li><a href="../es429316/index.html">Operaciones de n√∫meros complejos</a></li>
<li><a href="../es429318/index.html">IPhone SMT Solver</a></li>
<li><a href="../es429320/index.html">Sberbank Data Science Day transmisi√≥n en vivo 10 de noviembre</a></li>
<li><a href="../es429322/index.html">nanoCAD Mechanics 9.0: los fundamentos del dise√±o moderno</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>