<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧖🏾 💝 🛃 Bagaimana kami memecahkan pondok tua itu dan membangun gedung pencakar langit di tempatnya 😵 🔬 🧗</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zurab Bely, ketua tim, praktik Jawa, menceritakan kisahnya bekerja di sebuah proyek untuk satu perusahaan besar dan berbagi pengalamannya. 

 Bagaiman...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana kami memecahkan pondok tua itu dan membangun gedung pencakar langit di tempatnya</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457624/">  Zurab Bely, ketua tim, praktik Jawa, menceritakan kisahnya bekerja di sebuah proyek untuk satu perusahaan besar dan berbagi pengalamannya. <br><br><h4>  Bagaimana saya menetap ... </h4><br>  Saya masuk ke proyek pada akhir musim panas 2017 sebagai pengembang biasa.  Saya tidak bisa mengatakan bahwa pada waktu itu saya sangat menyukainya: teknologi yang digunakan dalam proyek sudah tua, komunikasi dalam tim diminimalkan, komunikasi dengan pelanggan sulit dan tidak produktif.  Jadi proyek itu bertemu saya.  Pada saat itu, saya hanya memiliki satu keinginan: untuk keluar darinya dengan cepat. <br><br>  Saya akan memberi tahu Anda sedikit tentang proyek secara keseluruhan.  Ini adalah portal resmi satu perusahaan besar dengan informasi umum, berita, promosi, dan konten lainnya.  Semua nawala pemasaran berisi tautan ke halaman-halaman tertentu di situs, yaitu, bebannya stabil secara rata-rata, tetapi pada titik waktu tertentu dapat mencapai nilai tinggi.  Stabilitas dan aksesibilitas aplikasi web membutuhkan perhatian khusus - setiap menit downtime layanan menyebabkan kerugian besar bagi pelanggan. <br><a name="habracut"></a><br><h4>  Shanty yang menyipit tertiup angin </h4><br>  Pada awalnya, saya terutama mempelajari kondisi teknis proyek, memperbaiki bug kecil dan membuat perbaikan kecil.  Dari sudut pandang teknis, aplikasi tampak mengerikan: arsitektur monolitik yang dibangun di sekitar versi komersial dotCMS, kode yang ditulis dalam versi Java 6, ketika rendering sisi server kesembilan dari bagian klien pada kerangka kerja Velocity, yang belum beberapa tahun saat itu, telah dirilis didukung.  Setiap instance diluncurkan di JBoss AS dan dialihkan menggunakan Nginx.  Kebocoran memori menyebabkan restart terus-menerus dari node, dan kurangnya cache normal menyebabkan peningkatan beban server.  Tapi sempalan terbesar adalah perubahan yang dilakukan pada kode CMS.  Mereka mengesampingkan kemungkinan peningkatan tanpa rasa sakit ke versi yang lebih baru.  Ilustrasi yang baik tentang hal ini adalah transisi dari versi 3.2 ke 3.7, yang baru saja berakhir pada saat itu.  Transisi ke versi minor berikutnya membutuhkan waktu lebih dari satu tahun.  Tidak ada solusi populer, seperti Spring Framework, React.js, arsitektur microservice, Docker, dll.  Masuk lebih dalam ke proyek, konsekuensi dari kondisi teknis seperti itu menjadi jelas.  Yang paling akut adalah ketidakmampuan menjalankan aplikasi secara lokal untuk pengembangan dan debugging.  Seluruh tim yang terdiri dari 8 orang bekerja di satu stan pengembangan, di mana salinan versi produksi aplikasi dikerahkan.  Dengan demikian, hanya satu pengembang yang dapat men-debug kode mereka pada saat yang sama, dan menggulirkan kode yang diperbarui memblokir seluruh tim.  Apogee adalah penjualan yang gagal, di mana jutaan surat, SMS dan pemberitahuan push dikirim ke pengguna yang berbeda melalui puluhan saluran - puluhan ribu sesi dibuka pada waktu yang sama.  Server tidak tahan, dan sebagian besar portal tidak tersedia.  Aplikasi tidak skala dengan baik.  Hanya ada satu cara untuk melakukan ini: menyebarkan salinan lain secara berdampingan dan menyeimbangkan beban di antara mereka menggunakan Nginx.  Dan setiap pengiriman kode produksi melibatkan banyak pekerjaan manual dan memakan waktu beberapa jam. <br><br>  Enam bulan setelah keterlibatan saya dalam proyek, ketika situasinya sudah mulai keluar dari kendali, keputusan dibuat untuk secara radikal mengubah situasi.  Proses transisi telah dimulai.  Perubahan memengaruhi semua area: komposisi tim, proses kerja, arsitektur, dan komponen teknis aplikasi. <br><br><h4>  Kami membangun, membangun ... </h4><br>  Pertama-tama, perubahan personel telah terjadi.  Digantikan oleh beberapa pengembang, mereka menjadikan saya pemimpin tim.  Transisi ke solusi modern dimulai dengan keterlibatan orang-orang dalam tim yang memiliki pengalaman bekerja dengan mereka. <br><br>  Perubahan prosedural lebih bersifat global.  Pada saat itu, pengembangan sudah berjalan pada metodologi Agile- + Scrum, sprint dua minggu dengan pengiriman pada akhir setiap iterasi.  Tetapi pada kenyataannya, ini tidak hanya tidak meningkatkan kecepatan kerja, tetapi, sebaliknya, melambat.  Demonstrasi harian berlangsung selama satu setengah hingga dua jam dan tidak membuahkan hasil.  Perencanaan dan perawatan berubah menjadi perselisihan, sumpah serapah atau komunikasi sederhana.  Ada hubungannya dengan ini.  Awalnya sangat sulit untuk mengubah apa pun dalam nada ini - atas nama pelanggan, tim hampir kehilangan kepercayaan, terutama setelah penjualan yang gagal.  Setiap perubahan harus dibuktikan, didiskusikan dan dibuktikan untuk waktu yang lama.  Cukup aneh, tetapi inisiatif datang dari pelanggan.  Di pihak mereka, seorang scrum-master dilibatkan untuk mengendalikan aplikasi yang benar dari pendekatan dan metodologi, proses debug dan mengatur tim untuk bekerja.  Meskipun ia hanya tertarik pada beberapa sprint, itu membantu kami merakit fondasi dengan benar.  Pendekatan komunikasi dengan pelanggan telah banyak berubah.  Kami mulai membahas masalah dalam proses lebih sering, retrospektif mulai terjadi lebih produktif, pengembang lebih bersedia untuk memberikan umpan balik, dan pelanggan, untuk bagiannya, maju dan mendukung proses transisi dengan segala cara. <br><br>  Tapi, jujur, saya akan jujur ​​mengatakan: ada beberapa saat ketika beberapa perubahan dalam tim dilakukan "secara membabi buta", dan setelah penampilan hasil yang positif, ini dilaporkan kepada pelanggan.  Selama enam bulan, sikap telah berubah menjadi komunikasi kerja yang nyaman.  Ini diikuti oleh beberapa teambuildings, pertemuan satu hari dan dua hari dari seluruh tim pengembangan dengan tim pelanggan (pemasar, analis, perancang, pengamat produk, manajer konten, dll.), Kunjungan bersama ke bar.  Setelah satu tahun, dan hingga hari ini, komunikasi dapat disebut ramah.  Suasana telah menjadi ramah, santai dan nyaman.  Tentu saja, itu tidak dilakukan tanpa konflik, tetapi bahkan di keluarga yang paling bahagia pun terkadang ada pertengkaran. <br><br>  Perubahan yang tidak kalah menarik terjadi selama periode ini dalam kode aplikasi, dalam arsitekturnya dan solusi yang digunakan.  Jika Anda tidak mengerti secara teknis, Anda dapat dengan aman melewati seluruh teks sampai pada kesimpulan.  Dan jika Anda beruntung sama seperti saya - selamat datang!  Seluruh transisi dapat dibagi menjadi beberapa tahap.  Tentang masing-masing lebih detail. <br><br>  <b>Tahap 1. Identifikasi area masalah kritis.</b> <br><br>  Segalanya sesederhana dan sejelas mungkin.  Pertama-tama, perlu untuk menghilangkan ketergantungan dari produk komersial pihak ketiga, untuk memotong monolit dan untuk memungkinkan debug secara lokal.  Saya ingin memisahkan kode klien dan server, untuk mendistribusikannya secara arsitektur dan fisik.  Tempat masalah lain adalah kualifikasi.  Proyek ini sama sekali tidak memiliki pengujian otomatis.  Ini membuat transisi sedikit sulit, karena semuanya harus diperiksa secara manual.  Mengingat bahwa tidak pernah ada tugas teknis untuk fungsional (spesifik proyek dipengaruhi di sini), ada kemungkinan besar kehilangan sesuatu.  Setelah mengecat area yang bermasalah, kami sekali lagi melihat daftar itu.  Itu tampak seperti sebuah rencana.  Saatnya membangun gedung pencakar langit! <br><br>  <b>Tahap 2. Memperbarui basis kode.</b> <br><br>  Tahap yang paling lama berjalan.  Semuanya dimulai dengan transisi ke arsitektur layanan (jangan dikacaukan dengan layanan microser).  Idenya adalah sebagai berikut: untuk memecah aplikasi menjadi beberapa layanan terpisah, yang masing-masing akan berurusan dengan tugas spesifiknya.  Layanan seharusnya bukan "mikro," tetapi saya juga tidak ingin meletakkan semuanya dalam satu ketel.  Setiap layanan seharusnya menjadi aplikasi Spring Boot yang ditulis dalam Java SE 8 dan dijalankan pada Tomcat. <br><br>  Yang pertama adalah yang disebut.  "Layanan konten", yang telah menjadi lapisan antara aplikasi masa depan dan CMS.  Ini telah menjadi abstraksi dalam perjalanan ke konten.  Diasumsikan bahwa semua permintaan yang sebelumnya kami buat langsung di CMS akan dilakukan melalui layanan ini, tetapi sudah menggunakan protokol HTTP.  Solusi semacam itu memungkinkan kami untuk mengurangi konektivitas dan menciptakan kemungkinan untuk selanjutnya mengganti dotCMS dengan analog yang lebih modern atau bahkan menghilangkan penggunaan produk komersial dan menulis solusi kami sendiri yang dirancang untuk tugas-tugas kami (melihat ke depan, saya akan mengatakan bahwa ini adalah cara kami melangkah). <br><br>  Segera menciptakan landasan untuk pemisahan kode depan dan backend.  Mereka menciptakan layanan front-end, yang menjadi bertanggung jawab untuk mendistribusikan kode yang ditulis pada reaksi.  Kami mengacaukan npm, mengkonfigurasi node, dan membongkar perakitan - semuanya sebagaimana mestinya sesuai dengan tren modern bagian klien. <br><br>  Secara umum, fungsi dialokasikan ke layanan sesuai dengan algoritma berikut: <br><br><ul><li>  menciptakan aplikasi Boot Musim Semi baru dengan semua dependensi dan pengaturan yang diperlukan; </li><li>  porting semua logika dasar (sering menulisnya dari awal, merujuk ke kode lama, hanya untuk memastikan bahwa Anda tidak melupakan nuansa apa pun), misalnya, untuk layanan caching, ini adalah opsi untuk menambahkan ke cache, membaca dari itu dan menonaktifkannya; </li><li>  semua fungsi baru selalu ditulis menggunakan layanan baru; </li><li>  secara bertahap menulis ulang potongan aplikasi yang lama menjadi layanan baru sesuai dengan kepentingannya. </li></ul><br>  Pada awalnya, kami memiliki beberapa dari mereka: <br><br><ul><li>  Layanan konten.  Bertindak sebagai lapisan antara aplikasi dan CMS. </li><li>  Layanan cache.  Repositori sederhana di Spring Cache. </li><li>  Layanan AA.  Pada awalnya, ia hanya terlibat dalam distribusi informasi tentang pengguna yang berwenang.  Sisanya tetap di dalam dotCMS. </li><li>  Layanan depan.  Bertanggung jawab untuk mendistribusikan kode klien. </li></ul><br>  <b>Tahap 3. Autotests.</b> <br><br>  Dengan mempertimbangkan semua pengalaman proyek, kami memutuskan bahwa kehadiran tes fungsional sangat menyederhanakan kehidupan dan kemungkinan pembaruan aplikasi lebih lanjut.  Sudah waktunya untuk memperkenalkan mereka ke dalam proyek.  Unit test kode, sayangnya mengatakan ini, terhenti segera.  Mereka membutuhkan banyak waktu untuk menulis dan mendukung, dan kami memiliki sangat sedikit, karena, selain menulis ulang kode, tugas saat ini pada fungsi baru tergantung pada kami, dan bug sering muncul.  Diputuskan untuk fokus hanya pada pengujian antarmuka aplikasi menggunakan Selenium.  Ini, di satu sisi, membuatnya lebih mudah bagi kami untuk melakukan pengujian regresi sebelum mengirim ke produksi, di sisi lain, menjadi mungkin untuk melakukan refactoring di sisi server, memantau keadaan di sisi klien.  Tim tidak memiliki automator, dan menulis serta menjaga relevansi autotests memerlukan biaya tambahan.  Mereka tidak melatih kembali salah satu penguji, dan orang lain ditambahkan ke tim. <br><br>  <b>Tahap 4. Otomatisasi penyebaran.</b> <br><br>  Sekarang kami memiliki layanan terpisah, ketika frontend telah terpisah dari backend, ketika fungsi utama mulai dicakup oleh swa-uji, saatnya untuk membuka sekaleng bir dan mengotomatiskan semua pekerjaan manual penggelaran dan mendukung aplikasi secara lokal, pada server demo dan server prod.  Memotong monolit menjadi potongan-potongan dan penggunaan Spring Boot telah membuka cakrawala baru bagi kami. <br><br>  Pengembang dapat men-debug kode secara lokal, hanya menjalankan bagian dari fungsi yang diperlukan untuk ini.  Tiang uji akhirnya mulai digunakan untuk tujuan yang dimaksudkan - sudah ada lebih atau kurang kode yang didebug, siap untuk pengujian awal dan kualifikasi.  Tetapi masih ada banyak pekerjaan tangan yang menyia-nyiakan waktu dan energi kita yang berharga.  Setelah mempelajari masalah dan memilah-milah solusi, kami memutuskan sekelompok Gradle + TeamCity.  Karena proyek ini dibangun oleh Gradle, menambahkan sesuatu yang baru tidak masuk akal, dan skrip yang ditulis ternyata bersifat platform independen, mereka dapat dijalankan pada OS apa pun, jarak jauh atau lokal.  Dan ini memungkinkan tidak hanya menggunakan solusi apa pun untuk CI / CD, tetapi juga tanpa kesulitan mengubah platform ke yang lain.  TeamCity dipilih karena fungsi bawaannya yang kaya, keberadaan komunitas besar dan daftar panjang plug-in untuk semua kesempatan, serta integrasi dengan lingkungan pengembangan Intellij IDEA. <br><br>  Saat ini, ada lebih dari 100 skrip optimasi dan lebih dari 300 tugas dalam sistem CI untuk menjalankannya dengan parameter yang berbeda.  Ini tidak hanya penyebaran untuk menguji bangku dan pengiriman ke produksi, tetapi juga bekerja dengan log, manajemen server, perutean dan hanya solusi untuk tugas-tugas rutin dari jenis yang sama.  Beberapa tugas telah dihapus dari bahu kita.  Pengelola konten dapat membersihkan sendiri cache.  Orang-orang dari dukungan teknis mendapat kesempatan untuk menarik layanan individu sendiri, untuk melakukan tindakan resusitasi primer.  Tidur pengembang telah menjadi lebih dalam dan lebih tenang. <br><br>  <b>Tahap 5. CMS sendiri.</b> <br><br>  Setelah dimungkinkan untuk abstrak dari CMS komersial, menjadi mungkin untuk menerima data dari sumber lain, tanpa menulis ulang kode aplikasi.  Di mana mendapatkan data ini atau itu diputuskan oleh layanan konten.  Setelah mencari solusi yang sudah jadi dan menganalisisnya, kami memutuskan untuk menulis sistem manajemen konten kami sendiri, karena tidak ada satupun yang sepenuhnya memenuhi kebutuhan kami.  Menulis CMS Anda sendiri adalah proses tanpa akhir, kebutuhan dan keinginan baru terus muncul.  Kami memilih beberapa fitur dasar dan pergi ke dunia pengembangan yang indah.  Untuk meluncurkan versi pertama dalam prod, kami memiliki waktu satu setengah bulan.  Karena fungsionalitas siap di CMS baru, kami mentransfer konten dari yang lama ke sana.  Semua halaman baru tidak ada hubungannya dengan dotCMS lagi.  Seiring waktu, ini memungkinkan untuk meninggalkan versi berbayar dan beralih ke versi komunitas, dan di masa depan benar-benar meninggalkan sesuatu pihak ketiga. <br><br>  <b>Tahap 6. Proofreading.</b> <br><br>  Setelah menyingsingkan celana kami, kami memulai perjalanan kami ke dunia pemrograman hipster.  Tahap ini untuk proyek saya adalah yang terakhir dalam proses rekonstruksi.  Itu berlanjut hingga hari ini.  Area utama di mana tahap ini umumnya muncul adalah penskalaan.  Bundel + Kubernetes + bundel Konsul memungkinkan Anda untuk tidak hanya memfasilitasi penyebaran ke server yang berbeda dan mengelola setiap layanan secara terpisah, tetapi juga secara fleksibel mengukur seluruh aplikasi, melakukannya hanya di tempat-tempat yang diperlukan, dan hanya selama diperlukan.  Secara lebih rinci saya bisa melukis hanya ketika kita sepenuhnya beralih ke solusi ini dalam produksi. <br><br><h4>  ... dan akhirnya dibangun.  Hore! </h4><br><br>  Setahun telah berlalu sejak pembaruan aplikasi dimulai.  Sekarang ini adalah 26 layanan REST yang ditulis dalam Spring Boot.  Masing-masing memiliki dokumentasi API terperinci di UI Swagger.  Sisi klien ditulis dalam React.js dan dipisahkan dari sisi server.  Semua halaman utama portal ditutupi dengan tes.  Melakukan beberapa penjualan besar.  Transisi ke teknologi modern, menyingkirkan kode lama dan pengoperasian server yang stabil sangat memotivasi pengembang.  Dari "seperti yang kami katakan, kami melakukannya" proyek pindah ke arus utama, di mana semua orang tertarik untuk sukses, menawarkan opsi mereka sendiri untuk perbaikan dan optimasi.  Sikap pelanggan terhadap tim telah berubah, suasana yang bersahabat telah tercipta. <br><br>  Ini adalah hasil kerja seluruh tim, masing-masing pengembang dan penguji, manajer dan pelanggan.  Itu sangat sulit, gugup dan kadang-kadang di ambang pelanggaran.  Tetapi kohesi tim, perencanaan yang kompeten, dan kesadaran akan hasil memungkinkan untuk mengatasi semua kesulitan. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id457624/">https://habr.com/ru/post/id457624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id457612/index.html">Bagaimana cara mempercepat dekompresi LZ4 di ClickHouse?</a></li>
<li><a href="../id457614/index.html">Rahasia mencari pekerjaan di luar negeri dari seorang headhunter yang berpraktik</a></li>
<li><a href="../id457616/index.html">"Wow, aku tidak tahu itu!" saat-saat dengan bercanda</a></li>
<li><a href="../id457618/index.html">Menjadi pengembang penuh tumpukan modern</a></li>
<li><a href="../id457622/index.html">Mengukur Kinerja Qt</a></li>
<li><a href="../id457626/index.html">Revisi tingkat akses pengguna menggunakan Power BI menggunakan contoh Bitrix CMS (BUS)</a></li>
<li><a href="../id457628/index.html">Program P2M dan manajemen proyek yang efektif</a></li>
<li><a href="../id457630/index.html">Pengalaman mengembangkan persyaratan untuk ilmuwan data kualitas profesional</a></li>
<li><a href="../id457632/index.html">Berapa tes unit?</a></li>
<li><a href="../id457634/index.html">DDS Synthesizer di Verilog</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>