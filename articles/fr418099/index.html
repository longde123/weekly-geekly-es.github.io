<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ»â€ğŸ”¬ ğŸ§‘ğŸ¼â€ğŸ¤â€ğŸ§‘ğŸ¼ ğŸ‘©ğŸ» Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 3: Buffer Overflows: Exploits and Protection, Part 3 ğŸ¹ ğŸ‘ğŸ» ğŸ¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Institut de technologie du Massachusetts. Cours magistral # 6.858. "SÃ©curitÃ© des systÃ¨mes informatiques." Nikolai Zeldovich, James Mickens. 2014 annÃ©e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 3: Buffer Overflows: Exploits and Protection, Part 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/418099/"><h3>  Institut de technologie du Massachusetts.  Cours magistral # 6.858.  "SÃ©curitÃ© des systÃ¨mes informatiques."  Nikolai Zeldovich, James Mickens.  2014 annÃ©e </h3><br>  Computer Systems Security est un cours sur le dÃ©veloppement et la mise en Å“uvre de systÃ¨mes informatiques sÃ©curisÃ©s.  Les confÃ©rences couvrent les modÃ¨les de menace, les attaques qui compromettent la sÃ©curitÃ© et les techniques de sÃ©curitÃ© basÃ©es sur des travaux scientifiques rÃ©cents.  Les sujets incluent la sÃ©curitÃ© du systÃ¨me d'exploitation (OS), les fonctionnalitÃ©s, la gestion du flux d'informations, la sÃ©curitÃ© des langues, les protocoles rÃ©seau, la sÃ©curitÃ© matÃ©rielle et la sÃ©curitÃ© des applications Web. <br><br>  Cours 1: Â«Introduction: modÃ¨les de menaceÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 2: Â«ContrÃ´le des attaques de piratesÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <br>  ConfÃ©rence 3: Â«DÃ©bordements de tampon: exploits et protectionÂ» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3</a> <a name="habracut"></a><br><br>  Vous pouvez utiliser la technique de deviner le "canari" Ã  vos propres fins afin de dÃ©couvrir la prÃ©sence de "faibles", en termes de sÃ©lection, de bits.  Autrement dit, si vous avez bien devinÃ©, le serveur va redÃ©marrer, et cela vous signalera que la valeur dÃ©finie est assez facile Ã  deviner.  Ainsi, il est possible de vaincre les Â«canarisÂ» randomisÃ©s, en supposant qu'aprÃ¨s le redÃ©marrage du serveur, leur valeur ne changera pas.  Vous pouvez Ã©galement utiliser des gadgets pour implÃ©menter une sÃ©quence associÃ©e de plusieurs attaques. <br><br>  Ensuite, nous examinerons une maniÃ¨re plus productive d'utiliser toutes ces mÃ©thodes pour dÃ©jouer la prÃ©vention de l'exÃ©cution des donnÃ©es, les espaces d'adressage alÃ©atoires et les Â«canarisÂ». <br><br>  Tournons notre attention vers les architectures 64 bits au lieu des architectures 32 bits.  Les premiers sont mieux adaptÃ©s Ã  la randomisation, ils vous donnent donc beaucoup plus de Â«chanceÂ» de vous dÃ©fendre contre un pirate.  Et ces systÃ¨mes semblent beaucoup plus intÃ©ressants en termes de formation d'attaque. <br><br>  Ce type d'architecture 64 bits a Ã©galement Ã©tÃ© envisagÃ© du point de vue de <b>BROP</b> , une programmation orientÃ©e Â«aveugleÂ» inversÃ©e.  Pour simplifier, nous supposons que la seule diffÃ©rence entre les machines 64 bits et 32 â€‹â€‹bits est que sur une machine 64 bits, les arguments sont passÃ©s aux registres et, pour une machine 32 bits, Ã  la pile. <br><br><img src="https://habrastorage.org/webt/hg/z1/jc/hgz1jcij9zzqbaqc3fiztx1ctze.jpeg"><br><br>  Lorsqu'une fonction commence Ã  Ãªtre exÃ©cutÃ©e, il faut Â«regarderÂ» dans certains registres pour trouver oÃ¹ se trouvent les arguments. <br><br>  Passons maintenant Ã  l'essentiel de la confÃ©rence d'aujourd'hui - qu'est-ce que la programmation orientÃ©e retour aveugle, ou <b>BROP</b> .  La premiÃ¨re chose que nous allons faire est de trouver un gadget d'arrÃªt.  N'oubliez pas que lorsque nous disons Â«gadgetÂ», nous entendons essentiellement des adresses de retour.  Le gadget est identifiÃ© par l'adresse de retour, l'adresse de dÃ©part de la sÃ©quence d'instructions Ã  laquelle nous voulons aller.  Qu'est-ce qu'un gadget d'arrÃªt? <br><br>  Essentiellement, il s'agit de l'adresse de retour Ã  un endroit du code, cependant, si vous sautez lÃ -bas, mettez simplement le programme en pause, mais ne le faites pas planter.  C'est pourquoi cela s'appelle un gadget d'arrÃªt. <br><br>  Vous pouvez sauter Ã  un endroit du code, qui initie alors un appel systÃ¨me en veille, ou fait une pause, ou quelque chose comme Ã§a.  Il est possible que le programme "reste coincÃ©" dans une boucle sans fin si vous sautez Ã  cet endroit.  Peu importe pourquoi l'arrÃªt se produit, mais vous pouvez imaginer quelques scÃ©narios qui y mÃ¨neraient. <br><br>  Ã€ quoi sert un gadget d'arrÃªt? <br><br>  DÃ¨s que l'attaquant a rÃ©ussi Ã  vaincre le Â«canariÂ» en utilisant la technique interactive de deviner les bits, il peut commencer Ã  rÃ©Ã©crire cette adresse de retour, l'adresse de retour et commence Ã  Â«tÃ¢tonnerÂ» le gadget d'arrÃªt.  Notez que la plupart des adresses alÃ©atoires que vous pouvez placer sur la pile sont susceptibles de provoquer simplement une panne du serveur.  Encore une fois, ce message est pour vous, l'attaquant, c'est une indication que ce que vous avez trouvÃ© n'est pas un gadget d'arrÃªt.  Parce que lorsque le serveur tombe en panne, votre socket se ferme et vous, en tant quâ€™attaquant, comprenez que vous nâ€™avez pas utilisÃ© le gadget dâ€™arrÃªt.  Mais si vous avez devinÃ© quelque chose et que la prise reste ouverte pendant un certain temps, vous pensez: "Ouais, j'ai trouvÃ© ce gadget d'arrÃªt!"  L'idÃ©e de base de la premiÃ¨re Ã©tape est donc de trouver ce gadget d'arrÃªt. <br><br><img src="https://habrastorage.org/webt/xb/af/zx/xbafzxirvhgep_31ahp8fuzpey4.jpeg"><br><br>  La deuxiÃ¨me Ã©tape consiste Ã  rechercher des gadgets qui suppriment les entrÃ©es de pile Ã  l'aide de la commande <b>pop</b> .  Par consÃ©quent, vous devez utiliser cette sÃ©quence d'instructions soigneusement conÃ§ues pour savoir quand vous rÃ©cupÃ©rez l'un de ces gadgets de pile.  Cette sÃ©quence sera constituÃ©e de l' <b>adresse de sonde de l'adresse de sonde</b> , de l' <b>adresse d'arrÃªt de l'adresse d'arrÃªt</b> et de l' <b>adresse de</b> panne systÃ¨me de l' <b>adresse de crash</b> . <br><br>  Ainsi, l' <b>adresse de la sonde</b> est ce que nous allons mettre sur la pile.  Ce sera l'adresse du gadget potentiel pour effacer la pile, l' <b>adresse d'arrÃªt</b> - c'est ce que nous avons considÃ©rÃ© dans la premiÃ¨re Ã©tape, c'est l'adresse du gadget d'arrÃªt.  L' <b>adresse de plantage</b> sera alors simplement l'adresse du code non exÃ©cutable.  Ici, vous pouvez simplement mettre l'adresse zÃ©ro (0 x 0), et si vous appliquez la fonction <b>ret</b> Ã  cette adresse et essayez d'y exÃ©cuter le code, cela entraÃ®nera un plantage du programme. <br><br><img src="https://habrastorage.org/webt/38/fa/ba/38fabavrj2kahtqh0_ruuxiigaa.jpeg"><br><br>  Nous pouvons donc utiliser ces types d'adresses pour savoir oÃ¹ ces gadgets nettoient la <b>pile de popping</b> . <br><br>  Je vais donner un exemple simple.  Supposons que nous ayons deux exemples de <b>sondes</b> diffÃ©rents, le piÃ¨ge <b>piÃ¨ge</b> et le <b>piÃ¨ge d'</b> <b>arrÃªt</b> .  Supposons, avec l'aide de la <b>sonde, que</b> nous allons "sonder" une adresse, supposons qu'elle commence par 4 et se termine par huit: 0x4 ... 8, et derriÃ¨re elle se trouve la prochaine adresse de la forme 0x4 ... C.  HypothÃ©tiquement, nous pouvons supposer que l'une de ces deux adresses est l'adresse du gadget <b>popping de pile</b> . <br><br>  Le <b>piÃ¨ge piÃ¨ge</b> obtiendra zÃ©ro adresses 0x0 et 0x0, et laissera le gadget <b>stop s'arrÃªter</b> avoir des adresses arbitraires comme 0xS ... 0xS ..., cela n'a pas d'importance.  Ce gadget d'arrÃªt pointe vers le code sleep (10), provoquant une pause du programme. <br><br>  CommenÃ§ons par l'opÃ©ration de <b>sonde</b> , qui efface certains registres et retourne dans l'ordre suivant: <b>pop rax;</b>  <b>ret</b> .  Que va-t-il se passer?  Lorsque le systÃ¨me passe Ã  cette adresse, le pointeur de pile se dÃ©place au milieu de notre gadget.  Que va faire le gadget ici?  Ã€ droite, effectuez l'opÃ©ration <b>pop rax</b> . <br><br><img src="https://habrastorage.org/webt/i2/eu/zr/i2euzrwlujsohfb4dl-szdeasac.jpeg"><br><br>  Et puis suit <b>ret</b> , qui dÃ©placera la fonction vers la ligne supÃ©rieure du gadget, c'est-Ã -dire, pour <b>arrÃªter</b> , et la fonction s'arrÃªtera sans planter le programme entier.  Ainsi, Ã  l'aide de ce gadget, un attaquant peut dire que l'adresse de <b>sonde</b> appartient Ã  l'une de ces fonctions, ce qui efface la pile, car la connexion client serveur est ouverte. <br><br>  Supposons maintenant que la deuxiÃ¨me adresse de <b>sonde</b> pointe vers quelque chose comme <b>xor rax, rax, ret</b> pour un registre. <br><br><img src="https://habrastorage.org/webt/kw/5t/r3/kw5tr3vdtrqedphe0onl6ec-wa0.jpeg"><br><br>  Alors, que se passe-t-il si nous essayons de passer Ã  ce gadget?  Notez qu'il n'efface rien sur la pile, il modifie simplement le contenu des registres.  Nous allons donc faire un retour Ã  l'adresse 0x0 situÃ©e ci-dessus.  Et cela entraÃ®nera le crash du systÃ¨me.  La connexion client au serveur sera rompue et le pirate comprendra qu'il ne s'agit pas d'un gadget pour effacer la pile de <b>pile</b> . <br><br>  De cette faÃ§on, vous pouvez utiliser une sÃ©rie de piÃ¨ges et de gadgets plus Ã©tranges, par exemple, vous pouvez effacer deux Ã©lÃ©ments de la pile.  Pour ce faire, il vous suffit de placer une autre instruction de <b>dÃ©routement</b> ici, et si ce gadget n'efface pas deux Ã©lÃ©ments, vous vous retrouverez dans l'un de ces dÃ©routements, et le code cessera de s'exÃ©cuter.  Le matÃ©riel de la confÃ©rence dÃ©crit une chose appelÃ©e <b>gadget BROP,</b> qui est utile si vous n'aimez pas revenir Ã  la programmation.  Mais aujourd'hui, je vais Ã©galement vous expliquer comment utiliser ces simples gadgets <b>pop</b> pour lancer une attaque similaire.  Une fois que vous aurez compris cela, gÃ©rer un <b>gadget BROP</b> sera beaucoup plus facile. <br><br>  Mais comprenez-vous tous comment nous pouvons utiliser la fonction de <b>sonde</b> pour ces gadgets?  Supposons que vous trouviez l'emplacement des extraits de code qui vous permet d'effacer la pile avec la fonction <b>pop</b> , supprimez-en un Ã©lÃ©ment, mais vous ne savez pas vraiment dans quel registre cette fonction <b>pop</b> fonctionnera.  Vous savez juste qu'elle est dÃ©jÃ  prÃªte Ã  Ãªtre exÃ©cutÃ©e.  Mais vous devez savoir dans quel registre ces gadgets <b>pop</b> fonctionneront, car dans une architecture 64 bits, les registres contrÃ´lent l'emplacement des arguments de la fonction que vous souhaitez appeler. <br><br>  Ainsi, notre objectif est de pouvoir crÃ©er des gadgets qui nous permettront de supprimer les valeurs que nous mettons dans certains registres de pile, et finalement nous lancerons un appel <b>systÃ¨me appel systÃ¨me</b> , ce qui nous permettra de faire quelque chose de mal. <br>  Alors maintenant, nous devons dÃ©terminer quels registres sont utilisÃ©s par <b>les</b> gadgets <b>pop</b> . <br><br><img src="https://habrastorage.org/webt/xp/w-/hw/xpw-hw9rdgd2argq0yx6xgi3ece.jpeg"><br><br>  Pour ce faire, nous pouvons profiter de l'appel systÃ¨me de pause.  Si l'appel systÃ¨me est suspendu, l'exÃ©cution du programme est suspendue et il n'accepte aucun argument.  Et cela signifie que le systÃ¨me ignore tout dans les registres. <br><br>  En fait, pour trouver l'instruction de pause que nous exÃ©cutons, vous pouvez lier tous ces gadgets <b>pop</b> afin que nous puissions tous les mettre sur la pile, et entre chacun d'eux, nous <b>insÃ©rons un numÃ©ro d'appel systÃ¨me</b> pour faire une pause.  Ensuite, nous verrons si nous pouvons "suspendre" le programme de cette faÃ§on.  Permettez-moi de vous donner un exemple concret. <br><br>  Ici, nous mettons un gadget dans la barre d'adresse de retour qui efface les registres <b>RDI</b> et leur applique la fonction <b>ret</b> .  Au-dessus, nous mettrons un <b>numÃ©ro d'appel systÃ¨me</b> en pause. <br><br>  Supposons que nous ayons un autre gadget situÃ© au-dessus qui implÃ©mente la fonction <b>pop</b> dans un autre registre, par exemple <b>RSI</b> , puis <b>ret</b> .  Et puis nous mettons Ã  nouveau le <b>numÃ©ro d'appel systÃ¨me</b> en pause.  Et nous le faisons pour tous les gadgets que nous avons trouvÃ©s, puis nous nous retrouvons au sommet de la pile avec l'adresse putative pour <b>syscall</b> . <br><br><img src="https://habrastorage.org/webt/qd/yx/3v/qdyx3vymmlc13o-sceyeimho_ro.jpeg"><br><br>  Rappelez-vous Ã  nouveau comment vous utilisez ces appels systÃ¨me.  Vous devez mettre le <b>numÃ©ro syscall</b> dans le registre <b>RAX</b> , puis appeler la fonction <b>libc syscall</b> , qui est sur le point d'effectuer l'appel systÃ¨me demandÃ©. <br><br>  Alors, que se passe-t-il lorsque nous exÃ©cutons ce code?  Nous allons venir ici, Ã  la ligne d' <b>adresse ret</b> , nous allons sauter Ã  l'adresse de ce gadget, il faut noter que l'attaquant sait que ce gadget, situÃ© Ã  droite, supprime quelque chose de la pile, mais ne sait pas encore dans quel registre il se trouve. <br><br>  Donc, si nous sautons Ã  l' <b>adresse ret</b> , que se passe-t-il?  Il utilisera la fonction <b>pop</b> pour suspendre l' <b>appel systÃ¨me</b> , dans un registre <b>inconnu</b> de l'attaquant, puis nous continuerons Ã  grimper cette chaÃ®ne d'opÃ©rations dans la pile. <br><br>  Ce faisant, nous espÃ©rons que l'un de ces gadgets exÃ©cutera la fonction <b>pop</b> pour le <b>numÃ©ro d'appel systÃ¨me</b> dans le registre <b>RAX</b> correspondant.  Donc, au moment oÃ¹ nous arrivons ici, en haut de la pile, sur le chemin de "gÃ¢cher" tous les registres qui ont un <b>numÃ©ro d'appel systÃ¨me</b> Ã  mettre en pause, nous espÃ©rons qu'il nous reste un registre, ce qui devrait Ãªtre correct.  Parce que si l'un de nos gadgets le fait, et puis, lorsque nous faisons <b>ret</b> , aprÃ¨s un certain temps, nous reviendrons ici, en haut de la pile, nous obtiendrons une pause.  Encore une fois, la pause sert de signal Ã  l'attaquant.  Parce que si cette adresse supposÃ©e pour <b>syscall</b> Ã©tait incorrecte, le programme Ã©chouera. <br><br>  Alors qu'est-ce qui nous permet de faire cette phase d'attaque?  Nous ne savons toujours pas dans quels registres se trouvent les gadgets <b>pop</b> , mais nous savons que l'un d'eux libÃ©rera le <b>RAX</b> que nous voulons contrÃ´ler.  Et nous connaissons probablement l'adresse <b>syscall</b> , car nous avons rÃ©ussi Ã  interrompre le systÃ¨me. <br><br>  Une fois que nous avons fait cela, nous pouvons vÃ©rifier ces gadgets un par un et savoir lequel met le systÃ¨me en pause.  En d'autres termes, nous avons tout coupÃ© entre la ligne d' <b>adresse ret</b> et le haut de la pile pour passer directement Ã  l' <b>appel systÃ¨me</b> .  Nous vÃ©rifierons si une pause ou une dÃ©faillance du systÃ¨me s'est produite.  Si un Ã©chec se produit, nous identifions le gadget qui l'a provoquÃ©, par exemple, il est en bas Ã  droite, c'est <b>pop rdi</b> .  DÃ©barrassez-vous de lui et essayez le suivant.  Mettez ici dans la ligne ci-dessus l' <b>adresse ret l'adresse</b> rÃ©elle pour <b>syscall</b> .  Pouvons-nous suspendre le programme?  Oui, cela signifie que nous avons appris que ce gadget <b>pop</b> devrait libÃ©rer <b>RAX</b> .  Est-ce clair? <br><br>  <b>Public:</b> Donc, un moyen de deviner l'adresse d'un appel systÃ¨me est juste un transfert aveugle de gadgets? <br><br>  <b>Professeur:</b> oui, et il existe des moyens d'optimiser ce processus dans les supports de cours lorsque vous utilisez l'extension de fichier <b>PLT</b> et des choses similaires.  Avec la simple attaque que j'ai dÃ©crite, il vous suffit de coller l'adresse ici et de vous assurer qu'elle a provoquÃ© une pause ou non.  Ã€ la suite du test, nous dÃ©couvrons l'emplacement de <b>syscall</b> .  Nous dÃ©couvrirons oÃ¹ se trouve l'instruction qui exÃ©cute <b>pop RAX</b> .  Nous avons Ã©galement besoin de gadgets qui exÃ©cutent Ã©galement la fonction <b>pop</b> dans certains autres registres.  Vous pouvez effectuer des tests similaires pour eux.  Par consÃ©quent, au lieu de <b>suspendre le numÃ©ro d'</b> appel systÃ¨me, utilisez <b>push</b> pour une autre commande qui, par exemple, utilise les arguments <b>RAX</b> et <b>RDI</b> . <br><br>  Ainsi, vous pouvez utiliser le fait que pour tout ensemble particulier de registres que vous souhaitez contrÃ´ler, il existe une sorte d' <b>appel systÃ¨me</b> qui donnera Ã  un attaquant un signal pour savoir si vous l'avez rÃ©ussi ou non.  Ainsi, Ã  la fin de cette phase, vous aurez l'adresse <b>syscall</b> et l'adresse du tas de gadget, qui vous permettent de faire <b>apparaÃ®tre</b> des registres arbitraires. <br><br>  Et maintenant passons Ã  la 4Ã¨me Ã©tape, qui sera appelÃ©e <b>Ã©criture</b> - enregistrement.  La quatriÃ¨me Ã©tape consiste Ã  enregistrer un appel systÃ¨me.  Pour appeler en <b>Ã©criture</b> , nous devons disposer des gadgets suivants: <br><br>  <b>pop rdi, ret;</b> <b><br></b>  <b>pop rsi, ret;</b> <b><br></b>  <b>pop rdx, ret;</b> <b><br></b>  <b>pop rax, ret;</b> <b><br></b>  <b>syscall</b> <br><br><img src="https://habrastorage.org/webt/kj/1h/ds/kj1hdsjhh1509eliv3vjxte7nw4.jpeg"><br><br>  Comment ces registres sont-ils utilisÃ©s par un appel systÃ¨me?  Le premier est le socket, ou, plus gÃ©nÃ©ralement, le descripteur de fichier que vous allez transfÃ©rer pour l'Ã©criture.  Le second est le tampon, le troisiÃ¨me est la longueur de ce tampon, le quatriÃ¨me est le numÃ©ro d'appel systÃ¨me et le cinquiÃ¨me est l' <b>appel systÃ¨me</b> lui-mÃªme. <br><br>  Donc, si nous trouvons tous ces gadgets, nous pouvons contrÃ´ler les valeurs qui sont incorporÃ©es dans les arguments, qui, Ã  leur tour, sont placÃ©es dans ces registres, car nous les avons simplement Â«poussÃ©sÂ» sur la pile. <br><br>  Que devrait Ãªtre une prise?  Ici, nous devons deviner un peu.  Vous pouvez profiter du fait que Linux limite le nombre de connexions ouvertes simultanÃ©es pour un fichier qui atteint une valeur de 2024. Et aussi qu'il devrait Ãªtre le minimum de tous les disponibles. <br><br>  Je me demande ce que nous allons insÃ©rer dans le pointeur tampon?  C'est vrai, nous avons l'intention d'utiliser le fragment de texte du programme ici, nous allons le mettre dans un pointeur quelque part dans le code du programme.  Cela nous permet de lire le fichier binaire hors de la mÃ©moire en utilisant l'appel client correct Ã  partir du socket.  Ensuite, l'attaquant peut prendre ce fichier binaire, l'analyser hors ligne hors ligne, en utilisant <b>GDB</b> ou un autre outil pour savoir oÃ¹ tout cela se trouve.  L'attaquant sait que maintenant, chaque fois que le serveur Â«planteÂ», le mÃªme ensemble alÃ©atoire de choses y sera stockÃ©.  Alors maintenant qu'un attaquant peut trouver les adresses et les dÃ©calages du contenu de la pile, il peut attaquer ces gadgets directement.  Il peut attaquer directement d'autres vulnÃ©rabilitÃ©s, comprendre comment ouvrir le shell et autres.  En d'autres termes, Ã  l'endroit oÃ¹ vous avez fourni le binaire avec le pirate, vous avez Ã©tÃ© vaincu. <br><br>  Voici comment fonctionne l'attaque <b>BROP</b> .  Comme je l'ai dit, dans les documents de cours, il existe de nombreuses faÃ§ons d'optimiser ces processus, mais vous devez d'abord comprendre le matÃ©riau principal, sinon l'optimisation perd son sens.  Par consÃ©quent, vous pouvez me parler d'optimisation individuellement ou aprÃ¨s le cours. <br><br>  Pour l'instant, il suffit de dire que ce sont les bases de la faÃ§on dont vous pouvez lancer une attaque <b>BROP</b> .  Vous devez trouver le gadget d' <b>arrÃªt</b> , rechercher les gadgets qui remplissent la fonction d'entrÃ©es de pile <b>pop</b> , savoir dans quels registres ils se trouvent, oÃ¹ se trouve <b>syscall</b> , puis lancer l' <b>Ã©criture</b> , en fonction des informations obtenues. <br><br><img src="https://habrastorage.org/webt/xb/-q/iq/xb-qiqqwytbciwpbxiow5i_fovi.jpeg"><br><br>  Alors, passez rapidement en revue le sujet, comment vous dÃ©fendez-vous contre <b>BROP</b> ?  Donc, la chose la plus Ã©vidente que vous avez est la re-randomisation.  Puisque le fait que les serveurs Â«tombÃ©s en panneÂ» ne rÃ©apparaissent pas, ne crÃ©ent pas d'eux-mÃªmes des versions alÃ©atoires, agit comme un signal qui donne Ã  un attaquant la possibilitÃ© de tester diverses hypothÃ¨ses sur le fonctionnement des programmes. <br><br>  Un moyen facile de vous protÃ©ger est de vous assurer que vous <b>exÃ©cutez</b> plutÃ´t que <b>fork</b> lorsque vous relancez votre processus.  Parce que lorsque vous exÃ©cutez le processus, vous crÃ©ez un tout nouvel espace situÃ© au hasard, du moins c'est ce qui se passe sous Linux.  Sous Linux, lorsque vous compilez Ã  l'aide de <b>PIE</b> , <b>Position Independent Execution</b> , un exÃ©cutable indÃ©pendant de l'emplacement, lorsque vous utilisez <b>exec,</b> vous n'obtenez qu'un nouvel espace d'adressage alÃ©atoire. <br><br>  La deuxiÃ¨me faÃ§on consiste simplement Ã  utiliser Windows, car ce systÃ¨me d'exploitation n'a fondamentalement pas l'Ã©quivalent d'une fonction <b>fork</b> .  Cela signifie que lorsque vous relancez un serveur sous Windows, il aura toujours un nouvel espace d'adressage alÃ©atoire. <br><br>  Quelqu'un ici a demandÃ© ce qui se passerait si, aprÃ¨s un dysfonctionnement du serveur, il ne se dÃ©connectait pas?  Donc, si lors d'une panne de serveur, nous Â«capturonsÂ» cette erreur et gardons la connexion ouverte pendant un certain temps, nous pouvons confondre l'attaquant afin qu'il ne reÃ§oive pas de signal sur l'Ã©chec et pense qu'il a trouvÃ© la bonne adresse. <br><br>  Dans ce cas, votre attaque <b>BROP</b> se transformera en attaque <b>DOS</b> .  Parce que vous venez de recevoir tous les processus zombies potentiels qui existent.  Ils sont inutiles, mais vous ne pouvez pas les laisser aller plus loin, sinon vous devrez supprimer ces informations. <br><br>  Une autre chose Ã  laquelle vous pourriez penser est de faire le contrÃ´le des frontiÃ¨res dont nous avons parlÃ© auparavant.  Les matÃ©riaux de la confÃ©rence disent que cette mÃ©thode est improductive, car elle est 2 fois plus chÃ¨re, mais vous pouvez toujours l'utiliser. <br><br>  Voici comment <b>BROP</b> fonctionne.  Quant aux devoirs, une question plus dÃ©licate y est posÃ©e: que faire si vous utilisez un hash de l'heure actuelle?  Autrement dit, la durÃ©e pendant laquelle vous redÃ©marrez le programme.  Est-ce suffisant pour empÃªcher ce type d'attaque?  Notez que le hachage ne vous fournit pas comme par magie des bits d'entropie si les donnÃ©es que vous entrez dans le hachage sont facilement prÃ©visibles.  Si votre hachage contient des milliards de bits, cela n'a pas d'importance.  Mais si vous n'avez que quelques significations, l'attaquant les devinera.  Bien sÃ»r, il est prÃ©fÃ©rable d'utiliser un hachage temporel alÃ©atoire que de ne rien utiliser pour se protÃ©ger contre un pirate informatique, mais cela ne vous fournira pas la sÃ©curitÃ© sur laquelle vous devez compter. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xSQxaie_h1o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  La version complÃ¨te du cours est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Merci de rester avec nous.  Aimez-vous nos articles?  Vous voulez voir des matÃ©riaux plus intÃ©ressants?  Soutenez-nous en passant une commande ou en le recommandant Ã  vos amis, une <b>rÃ©duction de 30% pour les utilisateurs Habr sur un analogue unique de serveurs d'entrÃ©e de gamme que nous avons inventÃ©s pour vous:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Toute la vÃ©ritÃ© sur VPS (KVM) E5-2650 v4 (6 cÅ“urs) 10 Go DDR4 240 Go SSD 1 Gbps Ã  partir de 20 $ ou comment diviser le serveur?</a>  (les options sont disponibles avec RAID1 et RAID10, jusqu'Ã  24 cÅ“urs et jusqu'Ã  40 Go de DDR4). <br><br>  <b>Dell R730xd 2 fois moins cher?</b>  Nous avons seulement <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 Go DDR4 6x480 Go SSD 1 Gbps 100 TV Ã  partir de 249 $</a> aux Pays-Bas et aux Ã‰tats-Unis!</b>  Pour en savoir plus sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">crÃ©ation d'un bÃ¢timent d'infrastructure.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe utilisant des serveurs Dell R730xd E5-2650 v4 coÃ»tant 9 000 euros pour un sou?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418099/">https://habr.com/ru/post/fr418099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418087/index.html">80% des caisses libre-service sont Ã  risque</a></li>
<li><a href="../fr418089/index.html">PrÃ©sentation de la fraiseuse CNC SolidCraft</a></li>
<li><a href="../fr418091/index.html">Liste d'articles et de littÃ©rature sur NAS</a></li>
<li><a href="../fr418093/index.html">Cours MIT "SÃ©curitÃ© des systÃ¨mes informatiques". ConfÃ©rence 3: Buffer Overflows: Exploits and Protection, Part 2</a></li>
<li><a href="../fr418095/index.html">Ã€ propos de l'appareil de fonctionnalitÃ© de test intÃ©grÃ©e dans Rust (traduction)</a></li>
<li><a href="../fr418101/index.html">Ã‰tymologie des termes informatiques</a></li>
<li><a href="../fr418103/index.html">Le chef de Roscosmos s'est souvenu de sa premiÃ¨re fusÃ©e et a partagÃ© ses plans pour l'avenir</a></li>
<li><a href="../fr418105/index.html">Pourquoi l'ouverture de YouTube dans Firefox ou Edge peut prendre 5 fois plus de temps que dans Google Chrome</a></li>
<li><a href="../fr418107/index.html">DÃ©finition d'un prÃ©fixe pour le scanner MINDEO CS2190 pour travailler avec 1C en mode pause clavier</a></li>
<li><a href="../fr418111/index.html">L'apprentissage en ligne moderne: dÃ©fis et tendances</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>