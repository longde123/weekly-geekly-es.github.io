<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëó üôÅ ‚õé Application pratique de la transformation d'arbre AST en utilisant le putout comme exemple üíö ‚ú® üé∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 


 Chaque jour, lorsque vous travaillez sur le code, sur le chemin de la mise en ≈ìuvre d'une fonctionnalit√© utile √† l'utilisateur, des m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Application pratique de la transformation d'arbre AST en utilisant le putout comme exemple</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439564/"><h2 id="vvedenie">  Pr√©sentation </h2><br><p>  Chaque jour, lorsque vous travaillez sur le code, sur le chemin de la mise en ≈ìuvre d'une fonctionnalit√© utile √† l'utilisateur, des modifications forc√©es (in√©vitables ou simplement souhaitables) du code deviennent.  Cela peut √™tre la refactorisation, la mise √† jour d'une biblioth√®que ou d'un framework vers une nouvelle version majeure, la mise √† jour de la syntaxe JavaScript (ce qui n'est pas rare r√©cemment).  M√™me si la biblioth√®que fait partie d'un projet de travail, le changement est in√©vitable.  La plupart de ces changements sont routiniers.  Il n'y a rien d'int√©ressant pour le d√©veloppeur en eux, d'une part, d'autre part, cela n'apporte rien √† l'entreprise, et troisi√®mement, pendant le processus de mise √† jour, vous devez √™tre tr√®s prudent pour ne pas casser le bois de chauffage et ne pas casser la fonctionnalit√©.  Ainsi, nous arrivons √† la conclusion qu'il est pr√©f√©rable de d√©placer une telle routine sur les √©paules des programmes afin qu'ils fassent tout eux-m√™mes et que la personne, √† son tour, contr√¥le si tout a √©t√© fait correctement.  C'est ce qui sera discut√© dans l'article d'aujourd'hui. </p><a name="habracut"></a><br><h2 id="ast">  AST </h2><br><p>  Pour le traitement de code de programme, il est n√©cessaire de le traduire en une repr√©sentation sp√©ciale, avec laquelle il serait pratique pour les programmes de fonctionner.  Une telle repr√©sentation existe, elle s'appelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Arbre de Syntaxe Abstraite</a> (AST). <br>  Pour l'obtenir, utilisez des analyseurs.  L'AST r√©sultant peut √™tre transform√© comme vous le souhaitez, puis pour enregistrer le r√©sultat, vous avez besoin d'un g√©n√©rateur de code.  Examinons plus en d√©tail chacune des √©tapes.  Commen√ßons par l'analyseur. </p><br><h3 id="parser">  Analyseur </h3><br><p>  Et nous avons donc le code: </p><br><pre><code class="javascript hljs">a + b</code> </pre> <br><p>  Les analyseurs sont g√©n√©ralement divis√©s en deux parties: </p><br><ul><li>  Analyse lexicale </li></ul><br><p>  D√©compose le code en jetons, chacun d√©crivant une partie du code: </p><br><pre> <code class="json hljs">[{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Punctuator"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> }]</code> </pre> <br><ul><li>  Analyse </li></ul><br><p>  Construit un arbre de syntaxe √† partir de jetons: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"BinaryExpression"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"left"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"right"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> } }</code> </pre> <br><p>  Et maintenant, nous avons d√©j√† cette id√©e m√™me, avec laquelle vous pouvez travailler par programmation.  Il convient de pr√©ciser qu'il existe un grand nombre d'analyseurs <code>JavaScript</code> , en voici quelques-uns: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">babel-parser</a> - un analyseur qui utilise <code>babel</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">espree</a> - un analyseur qui utilise <code>eslint</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gland</a> - l'analyseur sur lequel les deux pr√©c√©dents sont bas√©s; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">esprima</a> - un analyseur populaire qui prend en charge JavaScript jusqu'√† EcmaScript 2017; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cherow</a> est un nouveau joueur parmi les analyseurs JavaScript qui pr√©tend √™tre le plus rapide; </li></ul><br><p>  Il existe un analyseur JavaScript standard, il est appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ESTree</a> et d√©finit les n≈ìuds √† analyser. <br>  Pour une analyse plus d√©taill√©e du processus d'impl√©mentation de l'analyseur (ainsi que du transformateur et du g√©n√©rateur), vous pouvez lire le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">super-minuscule-compilateur</a> . </p><br><h3 id="transformator">  Transformateur </h3><br><p>  Afin de transformer l'arborescence AST, vous pouvez utiliser le mod√®le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Visitor</a> , par exemple, en utilisant la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@ babel / traverse</a> .  Le code suivant affichera les noms de tous les identificateurs de code JavaScript √† partir de la variable de <code>code</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parser <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@babel/parser"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> traverse <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@babel/traverse"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> code = <span class="hljs-string"><span class="hljs-string">`function square(n) { return n * n; }`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ast = parser.parse(code); traverse(ast, { Identifier(path) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(path.node.name); } });</code> </pre> <br><h3 id="generator">  G√©n√©rateur </h3><br><p>  Vous pouvez g√©n√©rer du code, par exemple, en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@ babel / generator</a> , de cette fa√ßon: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {parse} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@babel/parser'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> generate <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@babel/generator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> code = <span class="hljs-string"><span class="hljs-string">'class Example {}'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ast = parse(code); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> output = generate(ast, code);</code> </pre> <br><p>  Et donc, √† ce stade, le lecteur aurait d√ª avoir une id√©e de base de ce qui est n√©cessaire pour transformer le code JavaScript, et avec quels outils il est impl√©ment√©. </p><br><p>  Il vaut √©galement la peine d'ajouter un outil en ligne comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">astexplorer</a> , il combine un grand nombre d'analyseurs, de transformateurs et de g√©n√©rateurs. </p><br><h2 id="putout">  Putout </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Putout</a> est un transformateur de code compatible avec les plugins.  En fait, c'est un croisement entre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">eslint</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">babel</a> , combinant les avantages des deux outils. </p><br><p>  Comment <code>eslint</code> <code>putout</code> affiche les zones √† probl√®me dans le code, mais contrairement √† <code>eslint</code> <code>putout</code> , le comportement du code est modifi√©, c'est-√†-dire qu'il est capable de corriger toutes les erreurs qu'il peut trouver. </p><br><p>  Comme <code>babel</code> <code>putout</code> convertit le code, mais essaie de le modifier de fa√ßon minimale, afin qu'il puisse √™tre utilis√© pour travailler avec du code stock√© dans le r√©f√©rentiel. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Prettier</a> m√©rite √©galement d'√™tre mentionn√©, il s'agit d'un outil de formatage et il diff√®re radicalement. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jscodeshift</a> est situ√© non loin de <code>putout</code> , mais il ne prend pas en charge les plugins, n'affiche pas de messages d'erreur et utilise √©galement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ast-types</a> au lieu de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@ babel / types</a> . </p><br><h3 id="istoriya-poyavleniya">  Histoire d'apparence </h3><br><p>  Dans le processus, <code>eslint</code> m'aide beaucoup avec mes conseils.  Mais parfois je veux plus de lui.  Par exemple, pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">supprimer le d√©bogueur</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">corrigez test.only</a> et supprimez √©galement les variables inutilis√©es.  Le dernier point a constitu√© la base de la mise au <code>putout</code> , au cours du processus de d√©veloppement, il est devenu clair que ce n'est pas facile et que de nombreuses autres transformations sont beaucoup plus faciles √† mettre en ≈ìuvre.  Ainsi, <code>putout</code> pass√© d'une fonction au syst√®me de plugins.  La suppression des variables inutilis√©es est d√©sormais le processus le plus difficile, mais cela ne nous emp√™che pas de d√©velopper et de prendre en charge de nombreuses autres transformations tout aussi utiles. </p><br><h3 id="kak-putout-ustroen-iznutri">  Comment fonctionne le putout √† l'int√©rieur </h3><br><p>  <code>putout</code> travail de mise au point peut √™tre divis√© en deux parties: le moteur et les plugins.  Cette architecture vous permet de ne pas √™tre distrait par les transformations lorsque vous travaillez avec le moteur, et lorsque vous travaillez sur des plug-ins, vous vous concentrerez autant que possible sur leur objectif. </p><br><h4 id="vstroennye-plaginy">  Plugins int√©gr√©s </h4><br><p>  <code>putout</code> est construit sur un syst√®me de plugins.  Chaque plugin repr√©sente une r√®gle.  En utilisant les r√®gles int√©gr√©es, vous pouvez effectuer les op√©rations suivantes: </p><br><ul><li><p>  Rechercher et supprimer: </p><br><ul><li>  variables inutilis√©es </li><li> <code>debugger</code> </li> <li>  appelez <code>test.only</code> </li><li>  appelez <code>test.skip</code> </li><li>  appeler <code>console.log</code> </li><li>  appelez <code>process.exit</code> </li><li>  blocs vides </li><li>  motifs vides </li></ul><br></li><li><p>  D√©claration de variable de recherche et de fractionnement: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  var one, two; //  var one; var two;</span></span></code> </pre> <br></li><li><p>  Convertir <code>esm</code> en <code>commonjs</code> : </p><br></li></ul><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//  import one from 'one'; //  const one = require('one');</span></span></code> </pre> <br><ul><li>  Appliquer la d√©structuration: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const name = user.name; //  const {name} = user;</span></span></code> </pre> <br><ol><li>  Combinez les propri√©t√©s de d√©structuration: </li></ol><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const {name} = user; const {password} = user; //  const { name, password } = user;</span></span></code> </pre> <br><p>  Chaque plugin est construit selon la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">philosophie Unix</a> , c'est-√†-dire qu'ils sont aussi simples que possible, chacun effectue une action, ce qui les rend faciles √† combiner, car ils sont, par essence, des filtres. </p><br><p>  Par exemple, avoir le code suivant: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = user.name; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = user.password;</code> </pre> <br><p>  Il est d'abord converti en utilisant la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©structuration d'application</a> pour: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {name} = user; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {password} = user;</code> </pre> <br><p>  Ensuite, en utilisant les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">propri√©t√©s de fusion-destruction, il est</a> converti en: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { name, password } = user;</code> </pre> <br><p>  Ainsi, les plugins peuvent fonctionner √† la fois s√©par√©ment et ensemble.  Lors de la cr√©ation de vos propres plug-ins, il est recommand√© de respecter cette r√®gle et d'impl√©menter un plug-in avec des fonctionnalit√©s minimales, en ne faisant que ce dont vous avez besoin, et les plug-ins int√©gr√©s et personnalis√©s se chargeront du reste. </p><br><h4 id="primer-ispolzovaniya">  Exemple d'utilisation </h4><br><p>  Apr√®s nous √™tre familiaris√©s avec les r√®gles int√©gr√©es, nous pouvons consid√©rer un exemple utilisant <code>putout</code> . <br>  Cr√©ez un fichier <code>example.js</code> avec le contenu suivant: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span>, y = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = user.name; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = user.password; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(name, password);</code> </pre> <br><p>  Ex√©cutez maintenant <code>putout</code> en passant <code>example.js</code> comme argument: </p><br><pre> <code class="plaintext hljs">coderaiser@cloudcmd:~/example$ putout example.js /home/coderaiser/example/example.js 1:6 error "x" is defined but never used remove-unused-variables 1:13 error "y" is defined but never used remove-unused-variables 6:0 error Unexpected "console" call remove-console 1:0 error variables should be declared separately split-variable-declarations 3:6 error Object destructuring should be used apply-destructuring 4:6 error Object destructuring should be used apply-destructuring 6 errors in 1 files fixable with the `--fix` option</code> </pre> <br><p>  Nous recevrons des informations contenant 6 erreurs, examin√©es plus en d√©tail ci-dessus, nous allons maintenant les corriger et voir ce qui s'est pass√©: </p><br><pre> <code class="plaintext hljs">coderaiser@cloudcmd:~/example$ putout example.js --fix coderaiser@cloudcmd:~/example$ cat example.js const { name, password } = user;</code> </pre> <br><p>  √Ä la suite de la correction, les variables inutilis√©es et les appels <code>console.log</code> ont √©t√© supprim√©s et la d√©structuration a √©galement √©t√© appliqu√©e. </p><br><h4 id="nastroyki">  Param√®tres </h4><br><p>  Les param√®tres par d√©faut peuvent ne pas toujours et pas pour tout le monde, donc <code>putout</code> prend en charge le fichier de configuration <code>.putout.json</code> , il se compose des sections suivantes: </p><br><ul><li>  Les r√®gles </li><li>  Ignorer </li><li>  Match </li><li>  Plugins </li></ul><br><h5 id="rules">  Les r√®gles </h5><br><p>  La section des <code>rules</code> contient un syst√®me de r√®gles.  Par d√©faut, les r√®gles sont d√©finies comme suit: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-unused-variables"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-debugger"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-only"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-skip"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-console"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"split-variable-declarations"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-empty"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-empty-pattern"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"convert-esm-to-commonjs"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"apply-destructuring"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"merge-destructuring-properties"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Pour activer <code>remove-process-exit</code> d√©finissez-le simplement sur <code>true</code> dans le fichier <code>.putout.json</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Ce sera suffisant pour signaler tous les appels <code>process.exit</code> trouv√©s dans le code et les supprimer si l'option <code>--fix</code> est <code>--fix</code> . </p><br><h5 id="ignore">  Ignorer </h5><br><p>  Si vous devez ajouter des dossiers √† la liste des exceptions, ajoutez simplement la section <code>ignore</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"ignore"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"test/fixture"</span></span> ] }</code> </pre> <br><h5 id="match">  Match </h5><br><p>  Si vous avez besoin d'un syst√®me de r√®gles ramifi√©, par exemple, activez <code>process.exit</code> pour le r√©pertoire <code>bin</code> , utilisez simplement la section de <code>match</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"match"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"bin"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } } }</code> </pre> <br><h5 id="plugins">  Plugins </h5><br><p>  Si vous utilisez des plugins qui ne sont pas int√©gr√©s et qui ont le pr√©fixe <code>putout-plugin-</code> , vous devez les inclure dans la section <code>plugins</code> avant de les activer dans la section <code>rules</code> .  Par exemple, pour connecter le <code>putout-plugin-add-hello-world</code> et activer la r√®gle <code>add-hello-world</code> , sp√©cifiez simplement: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"add-hello-world"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"add-hello-world"</span></span> ] }</code> </pre> <br><h4 id="dvizhok-putout">  Moteur de mise hors tension </h4><br><p>  Le moteur <code>putout</code> est un outil en ligne de commande qui lit les param√®tres, analyse les fichiers, charge et ex√©cute les plugins, puis √©crit le r√©sultat des plugins. </p><br><p>  Il utilise la biblioth√®que de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">refonte</a> , qui aide √† effectuer une t√¢che tr√®s importante: apr√®s l'analyse et la transformation, collecter le code dans un √©tat aussi similaire que possible au pr√©c√©dent. </p><br><p>  Pour l'analyse, un <code>ESTree</code> compatible <code>ESTree</code> est utilis√© ( <code>babel</code> est actuellement avec le plugin <code>estree</code> , mais des modifications sont possibles √† l'avenir), et les outils <code>babel</code> sont utilis√©s pour la transformation.  Pourquoi <code>babel</code> exactement?  Tout est simple.  Le fait est que c'est un produit tr√®s populaire, beaucoup plus populaire que d'autres outils similaires, et qu'il se d√©veloppe beaucoup plus rapidement.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chaque nouvelle proposition dans le standard EcmaScript n'est pas compl√®te sans un plugin babel</a> .  <a href="">Babel a √©galement</a> un livre, <a href="">Babel Handbook</a> , qui d√©crit tr√®s bien toutes les fonctionnalit√©s et les outils pour traverser et transformer un arbre AST. </p><br><h4 id="svoy-plagin-dlya-putout">  Plugin personnalis√© pour Putout </h4><br><p>  Le syst√®me de plugins <code>putout</code> est assez simple, et tr√®s similaire aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugins eslint</a> , ainsi qu'aux <a href="">plugins babel</a> .  Certes, au lieu d'une fonction, <code>putout</code> plugin devrait exporter 3. Cela est fait afin d'augmenter la r√©utilisation du code, car la duplication de la fonctionnalit√© dans 3 fonctions n'est pas tr√®s pratique, il est beaucoup plus facile de la mettre dans des fonctions s√©par√©es et de simplement l'appeler aux bons endroits. </p><br><h5 id="struktura-plagina">  Structure du plugin </h5><br><p>  <code>Putout</code> plugin <code>Putout</code> comprend donc 3 fonctions: </p><br><ul><li>  <code>report</code> - renvoie un message; </li><li>  <code>find</code> - recherche des lieux avec des erreurs et les renvoie; </li><li>  <code>fix</code> - corrige ces endroits; </li></ul><br><p>  Le principal point √† retenir lors de la cr√©ation d'un plugin pour <code>putout</code> est son nom, il doit commencer par <code>putout-plugin-</code> .  Ensuite peut √™tre le nom de l'op√©ration que le plugin effectue, par exemple, le plugin <code>remove-wrong</code> bad devrait √™tre appel√© comme ceci: <code>putout-plugin-remove-wrong</code> . </p><br><p>  Vous devez √©galement ajouter les mots: <code>putout</code> et <code>putout-plugin</code> √† la section <code>package.json</code> dans la section des <code>keywords</code> - <code>keywords</code> , et sp√©cifier <code>"putout": "&gt;=3.10"</code> dans <code>peerDependencies</code> <code>"putout": "&gt;=3.10"</code> , ou la version qui sera la derni√®re au moment de l'√©criture du plug-in. </p><br><h5 id="primer-plagina-dlya-putout">  Exemple de plugin pour Putout </h5><br><p>  √âcrivons un exemple de plugin qui supprimera le mot <code>debugger</code> du code.  Un tel plugin existe d√©j√†, c'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@ putout / plugin-remove-debugger</a> et il est assez simple pour le consid√©rer maintenant. </p><br><p>  Cela ressemble √† ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//        module.exports.report = () =&gt; 'Unexpected "debugger" statement'; //     ,  debugger    Visitor module.exports.find = (ast, {traverse}) =&gt; { const places = []; traverse(ast, { DebuggerStatement(path) { places.push(path); } }); return places; }; //  ,     module.exports.fix = (path) =&gt; { path.remove(); };</span></span></code> </pre> <br><p>  Si la r√®gle <code>remove-debugger</code> est incluse dans <code>.putout.json</code> , le <code>@putout/plugin-remove-debugger</code> sera charg√©.  Tout d'abord, la fonction <code>find</code> est appel√©e qui, √† l'aide de la fonction <code>traverse</code> , contournera les n≈ìuds de l'arbre AST et enregistrera tous les emplacements n√©cessaires. </p><br><p>  L'√©tape suivante se transforme en <code>report</code> pour obtenir le message souhait√©. </p><br><p>  Si l'indicateur <code>--fix</code> est utilis√©, la fonction <code>fix</code> du plugin sera appel√©e et la transformation sera effectu√©e, dans ce cas, le n≈ìud sera supprim√©. </p><br><h5 id="primer-testa-plagina">  Exemple de test de plugin </h5><br><p>  Afin de simplifier le test des plugins, l'outil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@ putout / test a</a> √©t√© √©crit.  √Ä la base, ce n'est rien de plus qu'un wrapper sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bande</a> , avec plusieurs m√©thodes pour la commodit√© et la simplification des tests. </p><br><p>  Le test du plugin <code>remove-debugger</code> pourrait ressembler √† ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> removeDebugger = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'..'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> test = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@putout/test'</span></span>)(__dirname, { <span class="hljs-string"><span class="hljs-string">'remove-debugger'</span></span>: removeDebugger, }); <span class="hljs-comment"><span class="hljs-comment">//        test('remove debugger: report', (t) =&gt; { t.reportCode('debugger', 'Unexpected "debugger" statement'); t.end(); }); //    test('remove debugger: transformCode', (t) =&gt; { t.transformCode('debugger', ''); t.end(); });</span></span></code> </pre> <br><h5 id="codemods">  Codemods </h5><br><p>  Toutes les transformations ne doivent pas √™tre utilis√©es tous les jours, pour les transformations ponctuelles, il suffit de faire la m√™me chose, mais au lieu de publier sur <code>npm</code> placez-la dans le <code>~/.putout</code> .  Au d√©marrage, <code>putout</code> va chercher dans ce dossier, ramasser et d√©marrer la transformation. </p><br><p>  Voici un exemple de transformation qui remplace la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">connexion de</a> <code>tape</code> et de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tentative de bande</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par un</a> appel de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">supertape</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">convert-tape-to-supertape</a> . </p><br><h3 id="eslint-plugin-putout">  eslint-plugin-putout </h3><br><p>  En fin de compte, cela vaut la peine d'ajouter un point: <code>putout</code> essaie de modifier le code de mani√®re minimale, mais s'il arrive √† un ami que certaines r√®gles de formatage ne respectent pas, eslint --fix est toujours pr√™t √† <code>eslint --fix</code> , et √† cet effet, il existe un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugin eslint-plugin-putout</a> sp√©cial.  Il peut √©gayer de nombreuses erreurs de formatage et, bien s√ªr, il peut √™tre personnalis√© en fonction des pr√©f√©rences des d√©veloppeurs sur un projet sp√©cifique.  La connexion est simple: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"plugin:putout/recommended"</span></span>, ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"putout"</span></span> ] }</code> </pre> <br><p>  Jusqu'√† pr√©sent, il n'y a qu'une seule r√®gle: la <code>one-line-destructuring</code> , elle fait ce qui suit: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const { one } = hello; //  const {one} = hello;</span></span></code> </pre> <br><p>  Il y a beaucoup plus de r√®gles <code>eslint</code> incluses que vous pouvez vous familiariser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus en d√©tail</a> . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Je remercie le lecteur de l'attention port√©e √† ce texte.  J'esp√®re sinc√®rement que le sujet des transformations AST deviendra plus populaire et que les articles sur ce processus fascinant appara√Ætront plus souvent.  Je serais tr√®s reconnaissant pour tout commentaire et suggestion concernant le d√©veloppement ult√©rieur de la <code>putout</code> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cr√©ez un probl√®me</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">envoyez un pool de demandes</a> , testez, √©crivez les r√®gles que vous souhaitez voir et comment programmer votre code par programme, nous travaillerons ensemble pour am√©liorer l'outil de transformation AST. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439564/">https://habr.com/ru/post/fr439564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439552/index.html">Extensions Chrome malveillantes</a></li>
<li><a href="../fr439556/index.html">TDMS Fairway. M√©thodologies PMBOK et organisations de conception russes</a></li>
<li><a href="../fr439558/index.html">Nouveau vieux t√©l√©phone. R√©inventez le t√©l√©phone PSTN</a></li>
<li><a href="../fr439560/index.html">Adaptateur Ethereum blockchain pour plate-forme de donn√©es InterSystems IRIS</a></li>
<li><a href="../fr439562/index.html">Configurez le cluster Kubernetes HA sur du m√©tal nu avec kubeadm. Partie 1/3</a></li>
<li><a href="../fr439566/index.html">Pourquoi la documentation SRE est importante. 3e partie</a></li>
<li><a href="../fr439568/index.html">SSD bas√©s sur QLC - un tueur de disque dur? Pas vraiment</a></li>
<li><a href="../fr439570/index.html">Magie IPython pour modifier les balises de cellules Jupyter</a></li>
<li><a href="../fr439572/index.html">Conception assist√©e par ordinateur d'√©quipements √©lectroniques</a></li>
<li><a href="../fr439574/index.html">Protocole SmartCard I2C. √âchangez les commandes APDU via l'interface I2C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>