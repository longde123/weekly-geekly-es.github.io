<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôçüèΩ üë®‚Äçüç≥ ‚è™ STM32 + NetBeans =? üë©üèº‚Äçüåæ üò± üé°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como voc√™ sabe, a compatibilidade com as ferramentas GNU e o suporte ao GDB tornam praticamente qualquer ambiente de desenvolvimento popular adequado ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>STM32 + NetBeans =?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413111/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ip/g9/vp/ipg9vp8f1dw4qq31hrwfvxyuvza.png" alt="Logotipo chato"></div><br>  Como voc√™ sabe, a compatibilidade com as ferramentas GNU e o suporte ao GDB tornam praticamente qualquer ambiente de desenvolvimento popular adequado para depurar uma ampla variedade de plataformas incorporadas, na maioria das vezes de forma gratuita e legal.  Em teoria. <br><br>  O que acontece na pr√°tica ao tentar fazer amizade com o STM32 e o NetBeans, e √© poss√≠vel, em princ√≠pio, obter um sistema vi√°vel com suporte para as √∫ltimas pedras - sob o corte. <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text">  Sim  Mas n√£o. </div></div><a name="habracut"></a><br><h2>  Algumas letras </h2><br>  Eu realmente n√£o queria deixar o microchip.  No entanto, ap√≥s a compra da Atmela, eles primeiro encobriram, talvez, uma das fam√≠lias mais promissoras do portf√≥lio da empresa - PIC32MM e, em seguida, toda a linha MIPS.  Tornou-se √≥bvio que, no futuro previs√≠vel, a transi√ß√£o para a ARM √© inevit√°vel, porque o microchip por dois anos n√£o integra o suporte dos controladores Atmelovsk em seu ecossistema, n√£o ofereceu nenhuma vantagem em ‚ÄúFique conosco‚Äù.  Pelo contr√°rio, a pol√≠tica de pre√ßos em alta e as dificuldades organizacionais tradicionais da fus√£o tornaram os AWPs da Atmelovskiye menos atraentes.  Ao mesmo tempo, apareceu um projeto que o PIC32MZ simplesmente encontrou.  Uma massa cr√≠tica foi conquistada. <br><br>  Por que STM: ampla cobertura de mercado, depura√ß√£o de or√ßamento, um ambiente de c√≥digo aberto gratuito e completo com base no SW4STM32 de c√≥digo aberto, bem, o aspecto pol√≠tico - a ST Microelectronics √© apoiada pelo governo franc√™s como um recurso estrat√©gico, portanto, a sa√≠da repentina do mercado ou aquisi√ß√£o, ao que parece, n√£o √© amea√ßada. <br><br><h2>  Depura√ß√£o - primeiras impress√µes </h2><br>  O SW4STM32 foi instalado da maneira tradicional - pressionando repetidamente o bot√£o Avan√ßar&gt; (* a seguir, todos os experimentos ocorrem no Win7 x64).  Um projeto de demonstra√ß√£o adequado para testar a fun√ß√£o desejada foi removido do pacote STM32Cube Firmware, tudo funcionou mais ou menos imediatamente.  O primeiro in√≠cio do emulador JTAG deixou uma impress√£o: todo o ciclo de entrada no modo de depura√ß√£o, come√ßando na conex√£o e terminando com a parada no in√≠cio de main (), com a atualiza√ß√£o do contexto, pode acontecer em 1-2 segundos.  Comparado aos depuradores de microchips (at√© o REAL ICE por meio meio), a diferen√ßa de velocidade √© m√∫ltipla! <br>  E, no entanto, algo desagradavelmente surpreendido. <br><br><h2>  O que h√° de errado com o Eclipse / SW4STM32 </h2><br>  Uma infinidade de configura√ß√µes e organiza√ß√£o il√≥gica, itens de menu ocultos, perspectivas, bugs de interface e artefatos visuais, faltando teclas de atalho e fun√ß√µes usadas na barra de ferramentas, pequenos pictogramas e marcadores desajeitados e ileg√≠veis, a aus√™ncia de "Encontrar usos" √© parcialmente subjetiva e voc√™ pode adaptar, se desejar .  Mas: esquece regularmente de salvar os arquivos modificados antes da montagem, embora todas as marcas de verifica√ß√£o sejam necess√°rias;  com economia manual for√ßada, ele n√£o v√™ mudan√ßas e a montagem incremental acaba sendo irrelevante;  n√£o h√° reconstru√ß√£o completa (Limpeza e Constru√ß√£o) como uma √∫nica equipe e, ap√≥s a limpeza for√ßada pelo Projeto Limpo, a montagem falha (acesso ao arquivo?) e √© conclu√≠da com √™xito somente ap√≥s a quarta tentativa - isso n√£o pode mais ser explicado de maneira razo√°vel.  Mesmo as primeiras vers√µes do MPLAB X Beta baseadas no antigo NetBeans 6.xx n√£o tiveram os mesmos problemas h√° 10 anos que o ambiente de desenvolvimento oficialmente suportado pelo STM32 atualmente. <br><br>  Al√©m disso, com o SW4STM32, 3 c√≥pias de IDEs t√≠picos j√° est√£o discadas no sistema, pois, al√©m disso, ainda h√° MPLAB X firmemente pregado no NetBeans 8.0.1 e um pouco restrito (ou seja, √© imposs√≠vel us√°-lo para outros idiomas / plataformas), e NetBeans 8.2 para Java e C / C ++. <br><br>  Acontece que a configura√ß√£o do NetBeans 8.2 para trabalhar com o STM32 eliminar√° os problemas pr√°ticos descritos no Eclipse, reduzir√° o n√∫mero de c√≥pias IDE e reduzir√° para uma plataforma, embora com vers√µes ligeiramente diferentes. <br><br><h2>  Ferramentas NetBeans 8.2 e GNU ARM </h2><br>  O NetBeans √© melhor usar 32 bits, porque al√©m de duplicar o consumo de mem√≥ria, n√£o foi poss√≠vel encontrar as diferen√ßas da vers√£o de 64 bits. <br><br>  O Google encontrou rapidamente um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">guia de configura√ß√£o</a> .  A principal diferen√ßa estava apenas no sistema operacional (eles t√™m Linux contra o Win7 x64 para mim); portanto, a instala√ß√£o do * nix-environment MSYS, inclu√≠do no pacote MinGW, tornou-se um jogo de premia√ß√£o.  As configura√ß√µes da cadeia de ferramentas devem ser algo como isto: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pa/at/55/paat55hytkpcafquqmaeouhiork.png" alt="nb-toolchain"></div><br>  Um ponto importante - ao adicionar a cadeia de ferramentas GNU ARM, selecione a fam√≠lia "GNU MinGW"; nesse caso, o NetBeans chamar√° corretamente o MSYS.  Se o Cygwin j√° estiver instalado na m√°quina, ser√° l√≥gico us√°-lo; portanto, a fam√≠lia GNU ARM deve selecionar ‚ÄúGNU Cygwin‚Äù. <br><br>  Conseguir uma compila√ß√£o bem-sucedida n√£o foi f√°cil, mas muito simples.  Como o SW4STM32 usa o mesmo compilador, observando a linha de comando da chamada do compilador no SW4STM32 e copiando as chaves ausentes em Propriedades do projeto ‚Üí Compilador C ‚Üí Op√ß√µes adicionais <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ch/l1/9d/chl19dfpmn67u7v2qcpyqrieoeu.png" alt="compilador nb"></div><br>  obtemos exatamente o mesmo resultado de sa√≠da, mas com uma importante diferen√ßa pr√°tica - tudo √© coletado na primeira vez, h√° o Clean and Build e funciona bem: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xy/p8/aa/xyp8aacaqx7cik38y4mqzhlbxlc.png" alt="nb-build1"></div><br>  Mas esse resultado tamb√©m pode ser aprimorado adicionando o processamento p√≥s-compila√ß√£o opcional.  Abra o Makefile e, na se√ß√£o .build-post: .build-impl add: <br><br><pre><code class="hljs powershell">.build<span class="hljs-literal"><span class="hljs-literal">-post</span></span>: .build<span class="hljs-literal"><span class="hljs-literal">-impl</span></span> cp <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_DISTDIR}/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}} <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}} arm<span class="hljs-literal"><span class="hljs-literal">-none</span></span><span class="hljs-literal"><span class="hljs-literal">-eabi</span></span><span class="hljs-literal"><span class="hljs-literal">-objcopy</span></span> <span class="hljs-literal"><span class="hljs-literal">-O</span></span> ihex <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}} <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}}.hex arm<span class="hljs-literal"><span class="hljs-literal">-none</span></span><span class="hljs-literal"><span class="hljs-literal">-eabi</span></span><span class="hljs-literal"><span class="hljs-literal">-size</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span>{CND_ARTIFACT_NAME_<span class="hljs-variable"><span class="hljs-variable">$</span></span>{CONF}}</code> </pre> <br>  (importante - o recuo deve ser um caractere de tabula√ß√£o √∫nico, n√£o espa√ßos) <br>  Linha por linha: 1 - copia o arquivo do objeto (.elf) da pasta de sa√≠da para a raiz do projeto, para facilitar o acesso;  2 - gera HEX do elf (pode ser comentado se HEX n√£o for necess√°rio);  3 - exibe a quantidade de mem√≥ria ocupada por segmentos. <br><br>  O resultado final: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6e/eb/u3/6eebu3andr0dd6zfgqh869chw7s.png" alt="nb-build2"></div><br>  At√© agora tudo bem. <br><br><h2>  OpenOCD - as primeiras dificuldades </h2><br>  Nos manuais online mencionados acima, a programa√ß√£o de um chip atrav√©s do OpenOCD √© simples e rotineira.  A vers√£o mais recente (0.10.0) √© instalada, o arquivo de configura√ß√£o √© obtido (do kit OpenOCD ou da pasta do projeto SW4STM32), e um comando do formul√°rio √© escrito em Propriedades do Projeto ‚Üí Executar: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x-/6a/5b/x-6a5bkmgaxhecmza5flej2x-iy.png" alt="nb-run"></div><br>  e tudo funciona imediatamente.  Na verdade, esse √© o caso de fam√≠lias mais jovens, como STM32F103 e F407, mas estou interessado em F7 e H7.  Com o primeiro, a vers√£o oficial do OpenOCD 0.10.0 falha com os erros "falha de auto_probe" e "motivo de depura√ß√£o indefinido 7";  estes √∫ltimos n√£o s√£o suportados.  Tentamos todas as assembl√©ias oficiais dispon√≠veis 0.10.0 de janeiro de 2017 e janeiro de 2018 - o resultado √© id√™ntico.  Uma pesquisa por palavra-chave confirma a exist√™ncia do problema, embora voc√™ n√£o possa nome√°-lo em massa;  n√£o h√° an√°lise e solu√ß√£o. <br><br>  Mas h√° uma vers√£o que √© garantida para o trabalho - a partir do kit SW4STM32.  Naturalmente, acaba sendo aprimorado e complementado, com novos scripts e suporte para a fam√≠lia H7.  Al√©m disso, a estrutura do arquivo foi alterada e, no plug-in, os recursos s√£o armazenados em um m√≥dulo separado; portanto, para que o utilit√°rio consolidado em uma √∫nica pasta veja seus scripts, a op√ß√£o -s era necess√°ria. <br><br>  Board.cfg para NUCLEO-F767ZI, l√≠quido de coment√°rios, e condensado: <br><br><pre> <code class="hljs powershell">set CHIPNAME STM32F767ZITx source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span><span class="hljs-type"><span class="hljs-type">erface</span></span>/<span class="hljs-type"><span class="hljs-type">stlink</span></span>-<span class="hljs-type"><span class="hljs-type">v2</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-type"><span class="hljs-type">.cfg</span></span>] transport select hla_swd source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-type"><span class="hljs-type">target</span></span>/<span class="hljs-type"><span class="hljs-type">stm32f7x.cfg</span></span>] set WORKAREASIZE <span class="hljs-number"><span class="hljs-number">0</span></span>x10000 set ENABLE_LOW_POWER <span class="hljs-number"><span class="hljs-number">1</span></span> set STOP_WATCHDOG <span class="hljs-number"><span class="hljs-number">1</span></span> reset_config srst_only srst_nogate connect_assert_srst set CONNECT_UNDER_RESET <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Finalmente, inicie o projeto Main Run: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oh/y-/j8/ohy-j8mnmadnqvq4zbcszplzchq.png" alt="nb-prog"></div><br>  O firmware foi bem sucedido, o c√≥digo est√° em execu√ß√£o. <br><br><h2>  Depura√ß√£o </h2><br>  O esquema √© considerado o mais tradicional: um servidor GDB local no OpenOCD, o NetBeans se conecta a ele atrav√©s do host local: 3333 via TCP.  Consequentemente, o NetBeans exigir√° o plug-in Gdbserver. <br><br>  √â poss√≠vel simplificar o lan√ßamento do OpenOCD por meio de um script bat e, uma vez que ap√≥s a conclus√£o da sess√£o, ela vai para o console, faz sentido repetir a reinicializa√ß√£o sem parar: <br><br><pre> <code class="hljs pgsql">:<span class="hljs-keyword"><span class="hljs-keyword">start</span></span> openocd -f <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>.cfg -sd:/Prog/openocd/scripts goto <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre> <br>  Lan√ßamento: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bz/k-/dl/bzk-dlt4v3upg6tijzo16oiaodc.png" alt="oocd-debug"></div><br>  A vers√£o do SW4STM32 n√£o est√° escrita explicitamente, mas o servidor est√° aguardando uma conex√£o TCP na porta 3333. No NetBeans, selecione Depurar ‚Üí Anexar Depurador ... e instale: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/-k/t8/qk-kt8brsnjmi4m8os7gumqbdu4.png" alt="nb-attach"></div><br>  A sess√£o est√° ativa.  Terminal OpenOCD: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3-/uh/b6/3-uhb6p4mqszlfw9jqk6klyljtc.png" alt="oocd-debug"></div><br>  Na apar√™ncia, tudo parece bom - a sess√£o de depura√ß√£o est√° ativa, o c√≥digo √© executado.  No entanto, o problema ainda existe. <br><br><h2>  O problema </h2><br>  No modo de execu√ß√£o livre, a execu√ß√£o n√£o pode ser parada. <br><br>  Se voc√™ definir um ponto de interrup√ß√£o antes de iniciar a sess√£o, ao inserir a depura√ß√£o, ele ser√° interrompido com a atualiza√ß√£o de contexto, a execu√ß√£o passo a passo e as vari√°veis ‚Äã‚Äãde visualiza√ß√£o / altera√ß√£o funcionar√£o, ou seja, em princ√≠pio, todas as fun√ß√µes b√°sicas necess√°rias para a depura√ß√£o completa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sq/s_/71/sqs_71pvec8ufdq6cln9cvbtfkm.png" alt="nb-debug"></div><br>  Mas apenas at√© o pr√≥ximo in√≠cio gratuito, ap√≥s o qual resta apenas fechar e reiniciar a sess√£o. <br><br>  Outro pouco desagrad√°vel est√° associado aos pontos de interrup√ß√£o do software: a fun√ß√£o SYSTEM_Halt () √© definida como __asm__ ("bkpt"), e sua opera√ß√£o leva √† exibi√ß√£o de um di√°logo desnecess√°rio: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9h/fu/gb/9hfugbj1z9u2pyj1peffrzpfozq.png" alt="nb-sigtrap"></div><br>  Quando voc√™ clica em Descartar e Pausar, ele funciona conforme necess√°rio (ou seja, interrompe a execu√ß√£o), no entanto, √© imposs√≠vel definir essa op√ß√£o por padr√£o e desativar a exibi√ß√£o da janela por meios padr√£o. <br><br>  Antes da pilha, eu gostaria de automatizar o lan√ßamento do OpenOCD e conectar o depurador diretamente atrav√©s do NetBeans. <br><br>  No entanto, objetivamente, a √∫nica fun√ß√£o que n√£o √© suficiente para depura√ß√£o mais ou menos completa √© interromper a execu√ß√£o (tamb√©m √© necess√°rio definir um ponto de interrup√ß√£o em tempo real). <br><br><h2>  Depura√ß√£o de depura√ß√£o </h2><br>  Uma pesquisa no google revelou que problemas semelhantes com o NetBeans parando o GDB pararam, mas foram corrigidos h√° v√°rios anos.  Por falta de uma id√©ia melhor, as fontes do NetBeans foram baixadas na esperan√ßa de percorrer o depurador ao vivo.  Surpreendentemente, conseguimos localizar rapidamente o problema antes de chamar o utilit√°rio externo GdbKillProc.exe, que √© essencialmente um inv√≥lucro para DebugBreakProcess (pid) do WinAPI.  O princ√≠pio do utilit√°rio √© reduzido a uma interrup√ß√£o n√£o invasiva do processo (an√°logo de "kill -SIGINT [pid]" sob * nix ou Ctrl + C no console). <br><br>  Mas ela n√£o trabalha. <br><br><h2>  O que √© testado </h2><br>  No modo de console, o cliente GDB (arm-none-eabi-gdb.exe) reage corretamente ao Ctrl + C, ou seja, interrompe a execu√ß√£o do c√≥digo sem fechar a sess√£o e aguarda mais instru√ß√µes. <br><br>  O ps -W e o Windows Process Explorer exibem o processo corretamente e o PID corresponde √† vari√°vel interna no NetBeans. <br><br>  A chamada manual "kill -SIGINT [pid]" do pacote MSYS gera um erro "No such process". <br><br>  A verifica√ß√£o de "taskkill / pid [pid]" produz "O processo ... n√£o p√¥de ser encerrado ... Este processo pode ser encerrado apenas com for√ßa ...", o que parece indicar um bloqueio do sistema.  Com a op√ß√£o / f, o processo fecha completamente, o que tamb√©m n√£o √© bom. <br><br>  No processo, verificou-se que, no Windows, a situa√ß√£o com a gera√ß√£o de sinais de interrup√ß√£o n√£o importa, ou melhor, de maneira alguma: apenas o anal√≥gico SIGTERM √© suportado por padr√£o, o que corresponde a uma redu√ß√£o aproximada do processo, e n√£o existe uma solu√ß√£o geralmente aceita. <br><br>  Na Internet, foi encontrado um utilit√°rio windows-kill, projetado para emular Ctrl + C e Ctrl + Brk.  O processo descobre que a interrup√ß√£o √© enviada sem erros, mas o cliente GDB ainda n√£o responde. <br><br>  Os experimentos foram realizados usando todas as vers√µes de 32 bits (NetBeans, ARM Tools, MSYS 1.0), exceto o windows-kill, que se recusou a iniciar 32 bits ("... n√£o foi poss√≠vel iniciar corretamente ...").  Talvez o problema seja justamente isso, porque, de acordo com dados fragmentados de f√≥runs e rastreadores de erros, a profundidade de bits do utilit√°rio e do processo deve coincidir.  A dificuldade aqui √© que o ARM n√£o oferece a vers√£o x64 da cadeia de ferramentas para Windows, incluindo a √∫nica maneira de eliminar a heterogeneidade √© fazer a vers√£o x32 do windows-kill funcionar, o que tamb√©m n√£o est√° claro se o Win x64 √© poss√≠vel em princ√≠pio. <br><br>  No meio do processo, o sistema operacional foi reinstalado do zero e nenhuma altera√ß√£o no comportamento dos sujeitos experimentais foi notada, incluindo com grande confian√ßa que os recursos de um sistema espec√≠fico podem ser eliminados. <br><br><h2>  Assist√™ncia no sal√£o necess√°ria </h2><br>  Na verdade, todos os itens acima podem ser considerados uma introdu√ß√£o a este par√°grafo. <br>  O √∫ltimo passo √© tornar a depura√ß√£o do STM32 no NetBeans real: <br><br>  <i>requer um mecanismo de software funcional para enviar o sinal de interrup√ß√£o SIGINT (Ctrl + C) para o processo do cliente Windows GDB</i> <br><br>  A seguir, √© apresentada uma recomenda√ß√£o para definir a configura√ß√£o m√≠nima suficiente para verificar / depurar o problema acima.  Se / quando ele puder ser resolvido, o artigo ser√° refeito em um guia passo a passo simples sobre como configurar o NetBeans + OpenOCD para v√°rias fam√≠lias diferentes e quadros de depura√ß√£o.  Outras funcionalidades podem ser conclu√≠das √† vontade, j√° tendo uma solu√ß√£o b√°sica vi√°vel. <br><br><h2>  Configura√ß√£o de teste </h2><br>  √â proposto o uso da placa Blue Pill baseada no STM32F103C8T6 e no clone ST-Link V2 como plataforma de hardware. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8g/m5/5r/8gm55r80dnmbhba7vr90piemhc0.png" alt="p√≠lula azul"></div><br>  √â necess√°rio: <br><br>  1. Instale a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cadeia de ferramentas incorporada GNU Arm</a> <br><br>  2. Instale o OpenOCD 0.10.0 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">compilado no Win</a> ) <br><br>  3. Registre as pastas bin de ambos os pacotes no PATH (Painel de controle ‚Üí Sistema ‚Üí Configura√ß√µes avan√ßadas do sistema ‚Üí Vari√°veis ‚Äã‚Äãde ambiente ... ‚Üí Caminho). <br><br>  4. Em um local conveniente para criar o arquivo board.cfg, copie o conte√∫do: <br><br><pre> <code class="hljs powershell">source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span><span class="hljs-type"><span class="hljs-type">erface</span></span>/<span class="hljs-type"><span class="hljs-type">stlink</span></span>-<span class="hljs-type"><span class="hljs-type">v2.cfg</span></span>] source [<span class="hljs-type"><span class="hljs-type">find</span></span> <span class="hljs-type"><span class="hljs-type">target</span></span>/<span class="hljs-type"><span class="hljs-type">stm32f1x.cfg</span></span>] transport select <span class="hljs-string"><span class="hljs-string">"hla_swd"</span></span> reset_config none separate set WORKAREASIZE <span class="hljs-number"><span class="hljs-number">0</span></span>x5000 set CHIPNAME STM32F103C8T6 set ENABLE_LOW_POWER <span class="hljs-number"><span class="hljs-number">1</span></span> set STOP_WATCHDOG <span class="hljs-number"><span class="hljs-number">1</span></span> set CLOCK_FREQ <span class="hljs-number"><span class="hljs-number">4000</span></span> set CONNECT_UNDER_RESET <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  5. Escolha o firmware de teste apropriado (test.elf), o principal crit√©rio √© que a execu√ß√£o e a parada sejam claramente distingu√≠veis.  Copie para um local conveniente. <br><br>  6. Em um local conveniente para exibir o quadro: <br><br> <code>openocd -f board.cfg -c "program test.elf verify reset exit"</code> <br> <br>  O firmware deve iniciar.  Exemplo de sa√≠da do OpenOCD para o console: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ye/4s/iv/ye4sivaywyegu12-xjodmnhntdw.png" alt="oocd-prog"></div><br>  7. Em um local conveniente para iniciar o servidor OpenOCD GDB: <br><br> <code>openocd -f board.cfg</code> <br> <br>  O c√≥digo ainda est√° em execu√ß√£o;  sa√≠da de amostra (o console permanece bloqueado pelo OpenOCD): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eo/ku/hd/eokuhd9oajy5kea8tz_dzcfwhq8.png" alt="oocd-debug"></div><br>  8. Em outro console ou execute diretamente arm-none-eabi-gdb.exe no pacote GNU ARM Embedded Toolchain e execute os comandos: <br><br>  <code>target extended-remote localhost:3333</code> (c√≥digo ainda em execu√ß√£o) <br>  <code>continue</code> (o c√≥digo est√° sendo executado, o console est√° bloqueado) <br>  <code>Ctrl+C</code> (c√≥digo parado, console ativo) <br>  <code>continue</code> (executando novamente, o console est√° bloqueado) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ye/4s/iv/ye4sivaywyegu12-xjodmnhntdw.png" alt="oocd-debug"></div><br>  A tarefa √© remover o cliente GDB do estado de execu√ß√£o (ou seja, emular essencialmente Ctrl + C) programaticamente. <br><br>  Para descobrir a identifica√ß√£o do processo, use "ps -W" no ambiente * nix ou Windows Process Explorer (instalado opcionalmente). <br><br>  Talvez algu√©m depure corretamente ap√≥s a configura√ß√£o inicial do NetBeans - essas informa√ß√µes tamb√©m ser√£o √∫teis, especialmente com uma descri√ß√£o detalhada do sistema e poss√≠veis recursos. <br><br>  Compartilhe id√©ias nos coment√°rios e espero que, trabalhando juntos, possamos transformar um experimento ousado em um guia √∫til para configurar uma ferramenta ainda mais √∫til. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413111/">https://habr.com/ru/post/pt413111/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413101/index.html">Placa de depura√ß√£o STM32F4 no fator de forma do Raspberry Pi</a></li>
<li><a href="../pt413103/index.html">Lan√ßamento do 3CX v15.5 Update 5 Beta e REST com AmoCRM</a></li>
<li><a href="../pt413105/index.html">Notas do provedor de IoT. Ativa√ß√£o e seguran√ßa no LoraWAN</a></li>
<li><a href="../pt413107/index.html">Tradu√ß√£o do wiki do projeto Svelto.ECS. Estrutura do ECS para Unity3D</a></li>
<li><a href="../pt413109/index.html">Como criar uma plataforma de integra√ß√£o de produtos SaaS: experi√™ncia de checkout na nuvem de p√¥steres</a></li>
<li><a href="../pt413113/index.html">Classe JavaScript Suporte √† serializa√ß√£o de JavaScript</a></li>
<li><a href="../pt413117/index.html">Como programar com seguran√ßa no bash</a></li>
<li><a href="../pt413119/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 317 (28 de maio a 3 de junho de 2018)</a></li>
<li><a href="../pt413121/index.html">Tour fotogr√°fico de Moscou coworking #tceh</a></li>
<li><a href="../pt413123/index.html">JOIN nos bancos de dados NoSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>