<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ£Ô∏è üëãüèº üë®üèø‚Äçüç≥ Intera√ß√£o de R com bancos de dados no exemplo do Microsoft SQL Server e outros DBMS üëêüèΩ ‚ñ∂Ô∏è üòé</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como a maior parte das informa√ß√µes comerciais √© armazenada em bancos de dados. Em qualquer linguagem de programa√ß√£o que voc√™ escreve, voc√™ deve execut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Intera√ß√£o de R com bancos de dados no exemplo do Microsoft SQL Server e outros DBMS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461063/"><p>  Como a maior parte das informa√ß√µes comerciais √© armazenada em bancos de dados.  Em qualquer linguagem de programa√ß√£o que voc√™ escreve, voc√™ deve executar v√°rias a√ß√µes com elas. </p><br><p>  Neste artigo, falarei sobre duas interfaces para trabalhar com bancos de dados em R. A maioria dos exemplos demonstra como trabalhar com o Microsoft SQL Server, no entanto, todos os exemplos de c√≥digo funcionar√£o com outros bancos de dados, como: MySQL, PostgreSQL, SQLite, ClickHouse , Google BigQuery etc. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/925/a23/786/925a23786a89917d9a314a793545cbb1.jpg" alt="imagem"></p><a name="habracut"></a><br><h1 id="soderzhanie">  Conte√∫do </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Software necess√°rio</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pacote DBI</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lista de fun√ß√µes b√°sicas do DBI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conectividade do banco de dados</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um exemplo de conex√£o com o Microsoft SQL Server usando o pacote odbc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um exemplo de conex√£o com o Microsoft SQL Server usando o pacote RMSSQL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como ocultar senhas de banco de dados em scripts R</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Criando tabelas e gravando no banco de dados</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lendo dados de um DBMS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Manipula√ß√£o de dados no DBMS (DML)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Transa√ß√µes no DBMS</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pacote RODBC</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Principais recursos do pacote RODBC</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um exemplo de trabalho com o RODBC</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Transacional</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conclus√£o</a> </li></ul><br><h1 id="trebuemoe-programmnoe-obespechenie">  Software necess√°rio </h1><br><p>  Para repetir todos os exemplos de trabalho com o DBMS descritos no artigo, voc√™ precisar√° do seguinte software livre listado abaixo: </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Linguagem R</a> ; </li><li>  Ambiente de desenvolvimento do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RStudio</a> ; </li><li>  Sistema de Gerenciamento de Banco de Dados, para escolher: <br>  3.1  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Microsoft SQL Server</a> <br>  3.2  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MySQL</a> <br>  3.3  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PostgreSQL</a> </li></ol><br><h1 id="paket-dbi">  Pacote DBI </h1><br><p> O pacote <code>DBI</code> √© a maneira mais popular e conveniente de interagir com os bancos de dados em R. </p><br><p>  <code>DBI</code> fornece um conjunto de fun√ß√µes com as quais voc√™ pode gerenciar bancos de dados.  Mas, para se conectar aos bancos de dados, voc√™ precisa instalar pacotes adicionais que s√£o drivers para v√°rios sistemas de gerenciamento de banco de dados (DBMS). </p><br><h3 id="spisok-osnovnyh-funkciy-dbi">  Lista de fun√ß√µes b√°sicas do DBI </h3><br><ul><li>  <code>dbConnect</code> - conex√£o com o banco de dados; </li><li>  <code>dbWriteTable</code> - escreve uma tabela no banco de dados; </li><li>  <code>dbReadTable</code> - carregando uma tabela de um banco de dados; </li><li>  <code>dbGetQuery</code> - carregando o resultado da execu√ß√£o da consulta; </li><li>  <code>dbSendQuery</code> - enviando uma consulta ao banco de dados; </li><li>  <code>dbFetch</code> - extrai elementos de um conjunto de resultados; </li><li>  <code>dbExecute</code> - execu√ß√£o de solicita√ß√µes para atualizar / excluir / inserir dados em tabelas; </li><li>  <code>dbGetInfo</code> - solicita informa√ß√µes sobre o resultado da solicita√ß√£o ou conex√£o; </li><li>  <code>dbListFields</code> - solicita√ß√£o de uma lista de campos da tabela; </li><li>  <code>dbListTables</code> - consulta uma lista de tabelas de banco de dados; </li><li>  <code>dbExistsTable</code> - verifica a presen√ßa de uma tabela no banco de dados; </li><li>  <code>dbRemoveTable</code> - exclui uma tabela do banco de dados; </li><li>  <code>dbDisconnect</code> - desconecta do banco de dados. </li></ul><br><h3 id="podklyuchenie-k-bazam-dannyh">  Conectividade do banco de dados </h3><br><p>  Para interagir com bancos de dados, voc√™ deve primeiro se conectar a eles.  Dependendo do DBMS com o qual planeja trabalhar, voc√™ precisar√° de um pacote adicional. Abaixo est√° uma lista dos pacotes mais usados. </p><br><ul><li>  <code>odbc</code> - Driver para conex√£o via interface ODBC; </li><li>  <code>RSQLite</code> - Driver para SQLite; </li><li>  <code>RMySQL</code> / <code>RMariaDB</code> - Driver para MySQL e MariaDB; </li><li>  <code>RPostgreSQL</code> - Driver para PosrtgreSQL; </li><li>  <code>bigrquery</code> - Driver para Google BigQuery; </li><li>  <code>RClickhouse</code> / <code>clickhouse</code> - Driver para ClickHouse; </li><li>  <code>RMSSQL</code> - O driver para Microsoft SQL Server (MS SQL), <em>no momento da escrita, est√° presente apenas no GitHub</em> . </li></ul><br><p>  O pacote <code>DBI</code> vem com o pacote R b√°sico, mas os pacotes que s√£o drivers de banco de dados devem ser instalados usando o comando <code>install.packages(" ")</code> . </p><br><p>  Para instalar pacotes do GitHub, voc√™ tamb√©m precisar√° de um pacote adicional - <code>devtools</code> .  Por exemplo, o pacote <code>RMSSQL</code> n√£o est√° publicado no reposit√≥rio principal do pacote R, use o seguinte c√≥digo para instal√°-lo: </p><br><pre> <code class="plaintext hljs">install.packages("devtools") devtools::install_github("bescoto/RMSSQL")</code> </pre> <br><h4 id="primer-podklyucheniya-k-microsoft-sql-server-s-pomoschyu-paketa-odbc">  Um exemplo de conex√£o com o Microsoft SQL Server usando o pacote odbc </h4><br><p>  Antes de usar qualquer pacote em uma sess√£o R, ele deve primeiro ser conectado usando a fun√ß√£o de <code>library(" ")</code> . </p><br><p>  N√£o foi √† toa que escolhi o Microsoft SQL Server como o DBMS principal, que fornecer√° a maioria dos exemplos deste artigo.  O fato √© que esse √© um banco de dados bastante popular, mas, ao mesmo tempo, ainda n√£o possui um driver para conex√£o do R publicado no CRAN. </p><br><p>  Felizmente, por√©m, o SQL Server, como quase qualquer outro banco de dados, possui uma interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ODBC</a> (English Open Database Connectivity) para conex√£o.  H√° v√°rios pacotes para conectar-se ao DBMS atrav√©s da interface ODBC em R.  Primeiro, veremos a conex√£o atrav√©s do pacote <code>odbc</code> . </p><br><div class="spoiler">  <b class="spoiler_title">F√°cil conex√£o com o banco de dados via interface odbc</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   odbc install.packages("odbc") #   library(odbc) #   MS SQL con &lt;- dbConnect(drv = odbc(), Driver = "SQL Server", Server = "localhost", Database = "mybase", UID = "my_username", PWD = "my_password", Port = 1433)</code> </pre> </div></div><br><p>  Na fun√ß√£o <code>dbConnect()</code> , voc√™ precisa passar a fun√ß√£o, que √© o driver para conectar-se ao DBMS ( <code>odbc()</code> ), como o primeiro argumento para <em>drv</em> .  Tais fun√ß√µes s√£o geralmente chamadas de DBMS e v√™m com pacotes que s√£o drivers para <code>DBI</code> . </p><br><p>  Em seguida, voc√™ precisa listar os par√¢metros de conex√£o.  Para conectar-se ao MS SQL via ODBC, voc√™ deve especificar os seguintes par√¢metros: </p><br><ul><li>  Driver - Nome do driver ODBC; </li><li>  Servidor - endere√ßo IP do servidor SQL; </li><li>  Banco de Dados - O nome do banco de dados ao qual se conectar; </li><li>  UID - nome de usu√°rio do banco de dados; </li><li>  PWD - Senha; </li><li>  Porta - a porta √† qual se conectar, com o SQL Server, a porta padr√£o √© 1433. </li></ul><br><p>  Um driver ODBC para conectar-se ao Microsoft SQL Server est√° inclu√≠do no Windows, mas pode ter um nome diferente.  Voc√™ pode exibir a lista de drivers instalados no ODBC Data Source Administrator.  Voc√™ pode iniciar o administrador da fonte de dados no Windows 10 da seguinte maneira: </p><br><ul><li>  Vers√£o de 32 bits: <code>%systemdrive%\Windows\SysWoW64\Odbcad32.exe</code> </li><li>  Vers√£o de 64 bits: <code>%systemdrive%\Windows\System32\Odbcad32.exe</code> </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c6c/816/934/c6c816934a70e2386a4547d7626d515f.png"></p><br><p>  Voc√™ tamb√©m pode obter uma lista de todos os drivers instalados no seu PC usando a fun√ß√£o <code>odbcListDrivers()</code> . </p><br><pre> <code class="plaintext hljs"> name attribute value &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 1 SQL Server APILevel 2 2 SQL Server ConnectFunctions YYY 3 SQL Server CPTimeout 60 4 SQL Server DriverODBCVer 03.50 5 SQL Server FileUsage 0 6 SQL Server SQLLevel 1 7 SQL Server UsageCount 1 8 MySQL ODBC 5.3 ANSI Driver UsageCount 1 9 MySQL ODBC 5.3 Unicode Driver UsageCount 1 10 Simba ODBC Driver for Google BigQuery Description Simba ODBC Driver for Google BigQuery2.0 # ... with 50 more rows</code> </pre> <br><p>  Voc√™ pode baixar drivers ODBC para outros DBMSs nos seguintes links: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MySQL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PostgreSQL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bigquery do Google</a> </li></ul><br><p>  Para v√°rios DBMSs, o nome dos par√¢metros para conex√£o pode ser diferente, por exemplo: </p><br><ul><li>  PostgreSQL / MySQL / MariaDB - usu√°rio, senha, host, porta, dbname; </li><li>  GoogleBigQuery - projeto, conjunto de dados; </li><li>  ClickHouse - usu√°rio, senha, banco de dados, porta, host; </li></ul><br><p>  Usando o administrador da fonte de dados ODBC, voc√™ pode executar o assistente para criar uma fonte de dados ODBC.  Para fazer isso, basta abrir o administrador, v√° para a guia "DSN personalizado" e clique no bot√£o "Adicionar ...". </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9ae/e92/ba3/9aee92ba30bdc8de811623aae1fb58fa.png"></p><br><p>  Ao criar uma fonte de dados usando um administrador, voc√™ indica um DSN (nome da fonte de dados). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b03/a0c/a7c/b03a0ca7c90fa0d5bddccb53575563a3.png"></p><br><p>  No exemplo acima, criamos uma fonte de dados com o DSN "my_test_source".  Agora podemos usar essa fonte para conectar-se ao Microsoft SQL Server e n√£o especificar outros par√¢metros de conex√£o no c√≥digo. </p><br><div class="spoiler">  <b class="spoiler_title">Conex√£o ao banco de dados via interface odbc usando DSN</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   DSN con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password")</code> </pre> </div></div><br><p>  Voc√™ pode ver os nomes de todas as fontes de dados ODBC criadas no seu PC usando a fun√ß√£o <code>odbcListDataSources()</code> . </p><br><pre> <code class="plaintext hljs"> name description &lt;chr&gt; &lt;chr&gt; 1 BQ Simba ODBC Driver for Google BigQuery 2 BQ_main Simba ODBC Driver for Google BigQuery 3 BQ ODBC Simba ODBC Driver for Google BigQuery 4 OLX Simba ODBC Driver for Google BigQuery 5 Multicharts Simba ODBC Driver for Google BigQuery 6 PostgreSQL35W PostgreSQL Unicode(x64) 7 hillel_bq Simba ODBC Driver for Google BigQuery 8 blog_bq Simba ODBC Driver for Google BigQuery 9 MyClientMSSQL SQL Server 10 local_mssql SQL Server 11 MSSQL_localhost SQL Server 12 my_test_source SQL Server 13 Google BigQuery Simba ODBC Driver for Google BigQuery</code> </pre> <br><h3 id="primer-podklyucheniya-k-microsoft-sql-server-s-pomoschyu-paketa-rmssql">  Um exemplo de conex√£o com o Microsoft SQL Server usando o pacote RMSSQL </h3><br><p>  <code>RMSSQL</code> n√£o <code>RMSSQL</code> publicado no CRAN, portanto voc√™ pode instal√°-lo no GitHub usando o pacote <code>devtools</code> . </p><br><pre> <code class="plaintext hljs">install.packages("devtools") devtools::install_github("bescoto/RMSSQL")</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Exemplo de conex√£o usando o driver DBI RMSSQL</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#    library(RJDBC) library(RMSSQL) library(DBI) #  RMSSQL con &lt;- dbConnect(MSSQLServer(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase")</code> </pre> </div></div><br><p>  Na maioria dos casos, usando o pacote <code>DBI</code> para trabalhar com bancos de dados, voc√™ se conectar√° dessa maneira.  I.e.  instale um dos pacotes de driver necess√°rios, transmitindo a fun√ß√£o <code>dbConnect</code> como o valor do argumento <em>drv</em> , a fun√ß√£o de driver para conectar-se ao DBMS necess√°rio. </p><br><div class="spoiler">  <b class="spoiler_title">Um exemplo de conex√£o com MySQL, PostgreSQL, SQLite e BigQuery</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   MySQL library(RMySQL) con &lt;- dbConnect(MySQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   PostrgeSQL library(RPostgreSQL) con &lt;- dbConnect(PostgreSQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   PostrgeSQL library(RPostgreSQL) con &lt;- dbConnect(PostgreSQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   SQLite library(RSQLite) # connection or create base con &lt;- dbConnect(drv = SQLite(), "localhost.db") #   Google BigQuery library(bigrquery) con &lt;- dbConnect(drv = bigquery(), project = "my_proj_id", dataset = "dataset_name")</code> </pre> </div></div><br><h3 id="kak-skryt-paroli-ot-bazy-dannyh-v-r-skriptah">  Como ocultar senhas de banco de dados em scripts R </h3><br><p>  Acima, dei alguns exemplos que podem ser usados ‚Äã‚Äãpara conectar-se a qualquer banco de dados, mas h√° uma desvantagem: neste formul√°rio, todos os acessos ao banco de dados, incluindo senhas, s√£o armazenados como texto nos pr√≥prios scripts. </p><br><p>  Se todos os seus scripts forem implantados e executados exclusivamente localmente no seu PC e estiverem protegidos por senha ao mesmo tempo, provavelmente n√£o haver√° problema.  Mas se voc√™ trabalha com algu√©m no mesmo servidor, o armazenamento de senhas dos bancos de dados no texto de seus scripts n√£o √© a melhor solu√ß√£o. </p><br><p>  Todo sistema operacional possui um utilit√°rio para gerenciar credenciais.  Por exemplo, no Windows, este √© o Credential Manager.  Voc√™ pode adicionar a senha usada para conectar-se ao banco de dados por meio do pacote de <code>keyring</code> neste reposit√≥rio.  O pacote √© multiplataforma e o exemplo acima funcionar√° em qualquer sistema operacional, pelo menos no Windows, MacOS e Linux. </p><br><pre> <code class="plaintext hljs"># install.packages("keyring") #   library(keyring) library(RMSSQL) #   key_set_with_value(service = "mssql", username = "my_username", password = "my_password") #   RMSSQL con &lt;- dbConnect(MSSQLServer(), host = 'localhost', user = 'my_username', password = key_get("mssql", "my_username"), dbname = "mybase")</code> </pre> <br><p>  I.e.  usando a fun√ß√£o <code>key_set_with_value()</code> , voc√™ adiciona uma senha ao armazenamento de credenciais e, usando <code>key_get()</code> solicita-a, e somente o usu√°rio que a adicionou √† loja pode solicitar uma senha.  Usando o <code>keyring</code> voc√™ pode armazenar senhas n√£o apenas dos bancos de dados, mas tamb√©m de quaisquer servi√ßos, al√©m de tokens de autoriza√ß√£o ao trabalhar com a API. </p><br><h3 id="sozdanie-tablic-i-zapis-v-bazu-dannyh">  Criando tabelas e gravando no banco de dados </h3><br><p>  A <code>dbWriteTable()</code> no banco de dados √© realizada pela fun√ß√£o <code>dbWriteTable()</code> . </p><br><p>  Argumentos para a fun√ß√£o <code>dbWriteTable()</code> : </p><br><p>  <em>Os argumentos necess√°rios est√£o em negrito, o it√°lico √© opcional</em> </p><br><ul><li>  <strong>conn</strong> - objeto de conex√£o DBMS criado usando a fun√ß√£o <code>dbConnect</code> ; </li><li>  <strong>nome</strong> - o nome da tabela no DBMS na qual os dados ser√£o gravados; </li><li>  <strong>valor</strong> - uma tabela (um objeto da classe data.frame / data.table / tibble_frame) em R, cujos dados ser√£o gravados no DBMS; </li><li>  <em>row.names</em> - Adiciona uma coluna row_names com n√∫meros de linhas √† tabela, o <em>padr√£o √© FALSE</em> . </li><li>  <em>substituir</em> - Substitua a tabela se a tabela com o nome especificado no argumento <em>name</em> j√° estiver presente no DBMS, <em>o valor padr√£o √© FALSE</em> ; </li><li>  <em>append</em> - Anexa dados se uma tabela com o nome especificado no argumento <em>name</em> j√° estiver presente no DBMS, <em>o valor padr√£o √© FALSE</em> ; </li><li>  <em>field.types</em> - Aceita um vetor nomeado e define o tipo de dados em cada campo ao gravar no DBMS, o <em>padr√£o √© NULL</em> ; </li><li>  <em>temporary</em> - Permite criar tabelas tempor√°rias no DBMS, que estar√£o dispon√≠veis at√© a conex√£o com o banco de dados ser desconectada; <em>o valor padr√£o √© FALSE</em> . </li></ul><br><div class="spoiler">  <b class="spoiler_title">Um exemplo de grava√ß√£o de dados em um DBMS atrav√©s do DBI</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #     DSN con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #     iris,         R  iris dbWriteTable(conn = con, name = "iris", value = iris) #     dbDisconnect(con)</code> </pre> </div></div><br><p>  Para visualizar tabelas no banco de dados, use a fun√ß√£o <code>dbListTables()</code> para excluir as tabelas <code>dbRemoveTable()</code> </p><br><div class="spoiler">  <b class="spoiler_title">Um exemplo de consulta a uma lista de tabelas e exclus√£o de uma tabela de um DBMS</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #    dbListTables(con) #   iris dbRemoveTable(con, "iris") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="chtenie-dannyh-iz-subd">  Lendo dados de um DBMS </h3><br><p>  Usando <code>DBI</code> voc√™ pode consultar tabelas inteiras ou o resultado da execu√ß√£o de sua consulta SQL.  As <code>dbReadTable()</code> e <code>dbGetQuery()</code> s√£o usadas para executar essas opera√ß√µes. </p><br><div class="spoiler">  <b class="spoiler_title">Um exemplo de consulta de uma tabela de √≠ris de um DBMS</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #   iris   iris dbiris &lt;- dbReadTable(con, "iris") #     dbDisconnect(con)</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Um exemplo de carregamento do resultado da execu√ß√£o SQL de um DBMS</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #     setosa &lt;- dbGetQuery(con, "SELECT * FROM iris WHERE Species = 'setosa'") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="manipulirovanie-dannymi-v-subd-dml">  Manipula√ß√£o de dados no DBMS (DML) </h3><br><p>  A fun√ß√£o <code>dbGetQuery()</code> acima √© usada exclusivamente para consultar amostras de dados (SELECT). </p><br><p>  Para opera√ß√µes de manipula√ß√£o de dados, como UPDATE, INSERT, DELETE, a fun√ß√£o <code>dbExecute()</code> existe no <code>DBI</code> . </p><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de amostra para manipula√ß√£o de dados em um DBMS</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #   (INSERT) dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   (UPDATE) dbExecute(con, "UPDATE iris SET [Species] = 'old_value' WHERE row_names = 51") #     (DELETE) dbExecute(con, "DELETE FROM iris WHERE row_names = 51") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="tranzakcii-v-subd">  Transa√ß√µes no DBMS </h3><br><blockquote>  Uma transa√ß√£o √© uma opera√ß√£o sequencial de leitura e grava√ß√£o.  O final de uma transa√ß√£o pode ser salvar altera√ß√µes (confirmar, confirmar) ou cancelar altera√ß√µes (revers√£o, revers√£o).  Em rela√ß√£o ao banco de dados, uma transa√ß√£o √© uma s√©rie de consultas, que s√£o tratadas como uma √∫nica consulta. </blockquote><p>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cite no artigo "Transa√ß√µes e os mecanismos de seu controle"</a></em> </p><br><p>  Uma transa√ß√£o encapsula v√°rias instru√ß√µes SQL em uma unidade elementar.  No <code>DBI</code> in√≠cio de uma transa√ß√£o √© iniciado com <code>dbBegin()</code> e, em seguida, confirmado com <code>dbCommit()</code> ou cancelado com <code>dbRollback()</code> .  Em qualquer caso, o DBMS garante que: todas ou nenhuma das instru√ß√µes ser√° aplicada aos dados. </p><br><p>  Por exemplo, durante a transa√ß√£o, vamos adicionar 51 linhas √† tabela iris, depois alterar o valor <em>Sepal.Width</em> para 5 linhas e excluir 43 linhas da tabela. </p><br><div class="spoiler">  <b class="spoiler_title">Exemplo de c√≥digo de transa√ß√£o</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor #    dbBegin(con) #   dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   dbExecute(con, "UPDATE iris SET [Sepal.Width] = 8 WHERE row_names = 5") #   43 dbExecute(con, "DELETE FROM iris WHERE row_names = 43") #   dbCommit(con) #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5 8.0 1.4 0.2 setosa # 2 51 7 3.2 4.7 1.4 versicolor # 3 51 5 3.3 1.7 0.3 new_values</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Exemplo de c√≥digo de cancelamento de transa√ß√£o</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor #    dbBegin(con) #   dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   dbExecute(con, "UPDATE iris SET [Sepal.Width] = 8 WHERE row_names = 5") #   43 dbExecute(con, "DELETE FROM iris WHERE row_names = 43") #   dbRollback(con) #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor</code> </pre> </div></div><br><h1 id="paket-rodbc">  Pacote RODBC </h1><br><p>  O pacote <code>RODBC</code> fornece uma interface independente para conectar e trabalhar com um DBMS por meio de uma interface ODBC. </p><br><p>  <code>RODBC</code> n√£o <code>RODBC</code> compat√≠vel com <code>DBI</code> , ou seja,  voc√™ n√£o pode usar o objeto de conex√£o criado usando o <code>RODBC</code> nas fun√ß√µes fornecidas pelo pacote <code>DBI</code> . </p><br><h3 id="osnovnye-funkcii-paketa-rodbc">  Principais recursos do pacote RODBC </h3><br><ul><li>  <code>odbcConnect</code> - Conex√£o ao DBMS via DSN; </li><li>  <code>odbcDriverConnect</code> - Conex√£o ao banco de dados atrav√©s da cadeia de conex√£o; </li><li>  <code>sqlQuery</code> - Enviando uma consulta ao DBMS e obtendo o resultado de sua execu√ß√£o.  Suporta consultas de qualquer tipo: SELECT, UPDATE, INSERT, DELETE. </li><li>  <code>sqlFetch</code> - Retorna a tabela inteira do DBMS; </li><li>  <code>sqlTables</code> - Obtenha uma lista de tabelas no banco de dados. </li><li>  <code>sqlSave</code> - Crie uma nova tabela no banco de dados ou adicione novos dados a uma tabela existente; </li><li>  <code>sqlUpdate</code> - Atualizando dados em uma tabela que j√° existe no DBMS; </li><li>  <code>sqlDrop</code> - Exclui uma tabela em um DBMS; </li><li>  <code>odbcClose</code> - <code>odbcClose</code> uma conex√£o com um DBMS. </li></ul><br><h3 id="primer-raboty-s-rodbc">  Um exemplo de trabalho com o RODBC </h3><br><p>  Do meu ponto de vista, o <code>RODBC</code> menos funcional que o <code>DBI</code> , mas possui todas as fun√ß√µes necess√°rias para trabalhar com um DBMS. </p><br><div class="spoiler">  <b class="spoiler_title">Um exemplo de intera√ß√£o com um DBMS atrav√©s do RODBC</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(RODBC) #   con_string &lt;- odbcDriverConnect(connection = "Driver=SQL Server;Server=localhost;Database=mybase;UID=my_username;PWD=my_password;Port=1433") #   DSN con_dsn &lt;- odbcConnect(dsn = "my_test_source", uid = "my_username", pwd = "my_password") #     sqlSave(con_dsn, dat = iris, tablename = "iris") #     iris sqlSave(con_dsn, dat = iris, tablename = "iris", append = TRUE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) #      R iris[1, 5] &lt;- "virginica" #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   4     sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) #   sqlDrop(con_dsn, sqtable = "iris") #     odbcCloseAll()</code> </pre> </div></div><br><h1 id="tranzakcionnost">  Transacional </h1><br><p>  Por padr√£o, a transacionalidade no <code>RODBC</code> desativada.  O gerenciamento de transa√ß√µes √© realizado por duas fun√ß√µes. </p><br><ul><li>  <code>odbcSetAutoCommit</code> - Alterna entre os modos de opera√ß√£o DBMS normal e transacional; </li><li>  <code>odbcEndTran</code> - Confirme ou cancele uma transa√ß√£o. </li></ul><br><p>  A <code>odbcSetAutoCommit</code> e desativa√ß√£o do modo de transa√ß√£o √© feita pela fun√ß√£o <code>odbcSetAutoCommit</code> usando o argumento <em>autoCommit</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Exemplo de trabalho no modo transacional no RODBC</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(RODBC) #   DSN con_dsn &lt;- odbcConnect(dsn = "my_test_source", uid = "my_username", pwd = "my_password") #     sqlSave(con_dsn, dat = iris, tablename = "iris") #    odbcSetAutoCommit(con_dsn, autoCommit = FALSE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 setosa # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #      R iris[1, 5] &lt;- "virginica" #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 virginica # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #   odbcEndTran(con_dsn, commit = FALSE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 setosa # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   odbcEndTran(con_dsn, commit = TRUE) #   4     sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 virginica # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #     odbcClose(con_dsn)</code> </pre> </div></div><br><h1 id="zaklyuchenie">  Conclus√£o </h1><br><p>  Os dois m√©todos de trabalhar com bancos de dados nas linguagens R, <code>DBI</code> e <code>RODBC</code> descritos no artigo s√£o bastante universais e funcionar√£o com quase todos os DBMS. </p><br><p>  A √∫nica diferen√ßa na opera√ß√£o entre diferentes DBMSs √© o processo de conex√£o.  Para os DBMSs mais populares, existem pacotes separados que s√£o drivers.  Para o restante do DBMS, √© necess√°rio configurar a conex√£o atrav√©s da interface ODBC usando <code>RODBC</code> <code>odbc</code> ou <code>RODBC</code> .  Todas as outras manipula√ß√µes, independentemente do DBMS que voc√™ escolheu, permanecer√£o inalteradas.  Uma exce√ß√£o √© o envio de consultas SQL, dependendo do dialeto SQL suportado pelo DBMS com o qual voc√™ est√° trabalhando. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461063/">https://habr.com/ru/post/pt461063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461053/index.html">Conectamos mapas on-line ao navegador no smartphone. Parte 2 - cart√µes de vetor</a></li>
<li><a href="../pt461055/index.html">Rekko Challenge 2019: como foi</a></li>
<li><a href="../pt461057/index.html">Canais de telegrama sobre desenvolvimento de jogos</a></li>
<li><a href="../pt461059/index.html">Escrevendo um aplicativo Android para f√£s de filmes - Parte 1 (prototipagem)</a></li>
<li><a href="../pt461061/index.html">Ligas de magn√©sio, limites duplos e segrega√ß√£o</a></li>
<li><a href="../pt461067/index.html">As 65 principais perguntas sobre SQL das entrevistas de emprego para as quais voc√™ deve estar preparado em 2019. Parte I</a></li>
<li><a href="../pt461069/index.html">C√¢meras IP externas Nobelic: testes, tecnologias e recursos dos sistemas de vigil√¢ncia por v√≠deo Ivideon</a></li>
<li><a href="../pt461071/index.html">Otimiza√ß√£o de consultas ao banco de dados no exemplo de servi√ßo B2B para construtores</a></li>
<li><a href="../pt461073/index.html">Conectamos mapas on-line ao navegador no smartphone. Parte 3 - OverpassTurbo</a></li>
<li><a href="../pt461075/index.html">Intelig√™ncia de neg√≥cios. Objetos de TI, componentes, ferramentas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>