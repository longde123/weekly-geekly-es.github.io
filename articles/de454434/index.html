<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå∏ üñ•Ô∏è üöé PDA (Pocket Travel Computer): Schaltkreis-GPS-Logger üèÖ üéÅ üîΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mein Hobbyprojekt ist ein GPS-Logger . In den Kommentaren wurde sogar vorgeschlagen, es als "Trip Computer" zu bezeichnen Die Protokollierung ist nur ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PDA (Pocket Travel Computer): Schaltkreis-GPS-Logger</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454434/">  Mein Hobbyprojekt ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GPS-Logger</a> .  In den Kommentaren wurde sogar vorgeschlagen, es als "Trip Computer" zu bezeichnen  Die Protokollierung ist nur ein kleiner Teil aller Funktionen des Ger√§ts.  Viel wurde bereits implementiert, aber die meisten m√ºssen noch getan werden. <br><br>  In fr√ºheren Artikeln habe ich den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√úbergang von Arduino zu STM32</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">STMCube / HAL, beschrieben</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein wenig √ºber das Build-System</a> , den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bootloader</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein Composite-USB-Ger√§t</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dessen Geschwindigkeit gesprochen</a> .  All dies wurde auf einem Steckbrett durchgef√ºhrt, das auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dem Blue Pill STM32F103CB-Brett</a> und einem Igel aus Dr√§hten basierte.  Es ist Zeit, dass das Ger√§t Gestalt annimmt, sowohl elektronisch (Schaltung) als auch physisch (K√∂rper). <br><br><img src="https://habrastorage.org/webt/0g/et/tj/0gettjt59u77r2mjpz73hyfn7sc.jpeg"><br><br>  Die Probleme, die ich zu diesem Zeitpunkt l√∂sen musste, sind sehr eng miteinander verbunden.  Bei der Auswahl von Komponenten f√ºr ein Projekt m√ºssen Sie sich ungef√§hr vorstellen, in welches Geh√§use sie geschoben werden k√∂nnen.  Und umgekehrt muss das Geh√§use f√ºr die verf√ºgbaren Komponenten und die Platinen erstellt werden, was wiederum mit Blick auf das Geh√§use erfolgen muss.  Im Allgemeinen ein Gewirr miteinander verbundener Themen.  Sie k√∂nnen nat√ºrlich eine gr√∂√üere Kiste nehmen und alles dorthin schieben, aber Sie wollten etwas Kompaktes und Leichtes. <br><br>  Bevor ich gleich anfange, m√∂chte ich darauf hinweisen, dass dies nicht die endg√ºltige Version des Ger√§ts ist.  H√∂chstwahrscheinlich wird es Fehler im Schema geben, etwas wird nicht wie beabsichtigt funktionieren, in den Kommentaren werden sie korrektere L√∂sungen anzeigen, einige Ans√§tze werden √ºberdacht.  Ich denke, dass die zweite oder sogar dritte Version des Ger√§ts nicht vermieden werden kann.  Daher freue ich mich √ºber Ihre konstruktiven Kommentare. <br><br>  Unter dem Schnitt ist er mehrperlig, aber es wird Technik sein. <br><a name="habracut"></a><br><h2>  Was und warum </h2><br>  Der GPS-Logger Holux M241 ist mein treuer Begleiter auf allen Reisen.  Er ist seit vielen tausend Kilometern bei mir.  Die vom Logger geschriebene Spur wird haupts√§chlich zum Geotaggen von Fotos verwendet, aber auch die Route selbst ist von Interesse.  Es macht Spa√ü herauszufinden, wie schnell Sie Ski gefahren sind, welche Route Ihr Flugzeug geflogen ist und was f√ºr ein Anblick gerade vor dem Fenster des Busses aufblitzte.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier habe</a> ich eine kleine √úberpr√ºfung dieses Ger√§ts durchgef√ºhrt. <br><br>  Leider haben die F√§higkeiten dieses Ger√§ts l√§ngst nicht mehr zu mir gepasst: Ich bin es leid, mit Batterien herumzuspielen, die sich immer im ung√ºnstigsten Moment hinsetzen.  Es gibt auch eine sehr niedrige USB-Geschwindigkeit, eine geringe Menge an internem Blitz, einen unbequemen Mechanismus zum Zusammenf√ºhren von Spuren, wenig Informationen auf dem Display, geringe Genauigkeit, einen sehr primitiven Kilometerz√§hler, keine Informationen √ºber Satelliten und vieles mehr. <br><br>  Ja, man k√∂nnte nach dem suchen, was moderne Tracker bieten - sicher gibt es bereits ein Ger√§t im Angebot, das meinen Anforderungen entspricht.  Aber das ist ein Hobby, ich m√∂chte versuchen, selbst etwas Komplexes, Interessantes, N√ºtzliches und Notwendiges zu tun.  Lass es sein, auch wenn ich es nur benutzen werde. <br><br>  Das Ziel des gesamten Projekts ist es, ein √§hnliches Ger√§t in etwas herzustellen, das nur mit meiner Wunschliste gef√ºllt ist.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Im ersten Artikel</a> der Serie habe ich meine Anforderungen an das Ger√§t detailliert beschrieben.  Kurz gesagt, ich m√∂chte Folgendes tun: <br><br><ul><li>  Recyceln Sie das Stromversorgungssystem und √ºbertragen Sie es auf eine Lithiumbatterie </li><li>  Stellen Sie eine informativere Anzeige </li><li>  genaueres GPS </li><li>  Erweitern Sie Flash mit SD-Karte </li><li>  Kompass und Beschleunigungsmesser hinzuf√ºgen </li><li>  Ich m√∂chte auch das Protokollierungssystem neu gestalten, um Spuren in dem von mir ben√∂tigten Format auszuspucken. </li></ul><br>  Neben den technischen Anforderungen und der Wunschliste gibt es auch nichttechnische (nicht funktionale).  Daher m√∂chte ich komplexe Ger√§te von Grund auf neu erstellen, um herauszufinden, wie verschiedene elektronische Komponenten funktionieren, wie sie programmiert werden, wie ein Board gez√ºchtet und ein Geh√§use entworfen wird. <br><br>  Warum ben√∂tigen Sie ein separates Ger√§t, wenn alle modernen Telefone √ºber GPS, einen gro√üen Bildschirm und viel Speicher verf√ºgen?  Zun√§chst einmal bin ich mir nicht sicher, ob ein Telefon mit eingeschaltetem GPS im Track-Aufnahmemodus den ganzen Tag standhalten kann.  Ich m√∂chte nicht wirklich ohne Telefon in einem unbekannten Land bleiben.  Auch ich pers√∂nlich benutze ein separates Ger√§t, das einfach komfortabler ist. <br><br>  M√∂glicherweise √§ndert sich im Laufe der Zeit das Konzept des Ger√§ts.  So wird es zum Beispiel jetzt immer logischer, den Bildschirm zu verlassen, eine Verbindung zum Telefon √ºber Bluetooth herzustellen und alle logischen Tricks auf dem Telefon auszuf√ºhren.  Diese Idee ist sehr robust und verlockend.  Aber zu diesem Zeitpunkt h√§tte ich immer noch gerne ein Display - ich habe immer Zeit, es aufzugeben. <br><br>  In den ersten anderthalb Jahren habe ich das Ger√§t auf verschiedenen Arten von Debug-Boards entwickelt (zuerst Arduino Nano, dann STM32F103 Blue Pill, dann STM32F407VE).  Ich musste Peripherieger√§te an Kabel anschlie√üen und Module kaufen.  Infolgedessen stellte sich auf dem Tisch ein Igel aus Dr√§hten heraus, der nicht zum Testen des GPS-Empfangs auf der Stra√üe geeignet war. Manchmal konnte man die Dr√§hte nicht einmal bewegen, ohne die Verbindung irgendwo zu unterbrechen.  Und dann viel Spa√ü beim Debuggen. <br><br>  Jedes Mal, wenn ich mich hinsetzte, um n√ºtzliche Funktionen zu schreiben, stie√ü ich auf die Tatsache, dass ein anderer Teil des Systems nicht mehr normal funktionierte und Stunden damit verbringen musste, etwas v√∂llig Unabh√§ngiges zu debuggen.  So stellte sich beispielsweise heraus, dass die wichtigste Komponente des Systems - der GPS-Empf√§nger - am Ende am wenigsten entwickelt war, weil  Ich musste mich mit dem Debuggen von USB, SD-Karten, dem Einrichten von Bibliotheken usw. befassen. <br><br>  Schlie√ülich wurde ich es leid und entschied mich, mein Debugging-Board zu erstellen - dies wird das Thema des heutigen Artikels sein.  Die Ziele, die ich mir in diesem Teil des Projekts gesetzt habe, waren folgende: <br><br><ul><li>  Erstellen Sie eine Debug-Karte, die keine Probleme mit ber√ºhrungslosen Komponenten hat </li><li>  Entscheiden Sie sich f√ºr die wichtigsten technischen und schematischen L√∂sungen </li><li>  Entscheide dich grob f√ºr die Komponenten, die ich als n√§chstes verwenden werde </li><li>  Entscheiden Sie sich grob f√ºr das Layout und den K√∂rper </li><li>  Die Schaltung sollte allgemein genug sein, um mit verschiedenen Komponenten und ihren Modi experimentieren zu k√∂nnen </li></ul><br>  Und obwohl das ultimative Ziel ein kompaktes Batterieger√§t ist, werde ich heute solche Dinge nicht tun wie <br><br><ul><li>  Feinabstimmung der Leistungsmodi </li><li>  Verbrauchseinstellung </li><li>  Schlafmodi </li></ul><br><br>  Ich werde mich mit der Verbrauchseinstellung befassen, wenn die Karte und der Hauptcode fertig sind.  √úbrigens wird es heute auch nicht um den Code gehen, aber ich werde definitiv auf diese Frage zur√ºckkommen, da es genug interessantes Material geben wird. <br><br><h2>  Komponenten </h2><br>  Beginnen wir mit den Komponenten und Peripherieger√§ten.  Unterwegs werden wir die Anzahl der Beine des Mikrocontrollers sch√§tzen, die zum Verbinden dieses Zoos erforderlich sind, sowie die Leistungsparameter.  Weil  Es ist ein Hobbyprojekt, bei dem ich Komponenten aus dem ausgew√§hlt habe, was ich tats√§chlich in Gesch√§ften / ebay / ali kaufen kann, und auch aus dem, was zu Hause gel√∂tet werden kann (nun, auch aus dem, was bereits in meinen pers√∂nlichen Vorr√§ten enthalten war).  Vielleicht k√∂nnten einige spezielle Mikroschaltungen das Problem besser l√∂sen, aber das Problem der Erschwinglichkeit und des Preises ist mir wichtig. <br><br><ul><li>  Die Hauptkomponente eines GPS-Loggers wird nat√ºrlich ein <b>GPS-Empf√§nger sein</b> .  In meinem Fall ist dies ein ziemlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ausgetrickster Beitian BN-880,</a> der auf dem UBlox M8N-Chip basiert.  Der Kompass auf dem HMC5883L-Chip ist ebenfalls in das Modul integriert. <br><br>  Anschluss: 2 Pins UART f√ºr GPS und 2 Pins I2C f√ºr Kompass <br>  Stromversorgung: Von 2,7V <br>  Verbrauch: 50mA <br><br><ul><li>  Bestellte auch ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beitial BN-220</a> Modul.  Es hat keinen Kompass, aber die Antenne ist kompakter (20x20mm gegen√ºber 30x30).  Die Wahrheit ist noch unklar, wie sich dies auf die Qualit√§t des Empfangs auswirkt.  M√ºssen testen.  Dem Datenblatt nach zu urteilen, kann dieses Modul jedoch mit 1,4 V betrieben werden, was sich positiv auf die Betriebszeit des Ger√§ts auswirken sollte. </li><li>  Hier ist tats√§chlich alles irgendwie schlammig.  Es scheint, dass der BN-880 auf der UBlox M8N basiert, w√§hrend der BN-220 auf dem U-blox M8030-KT basiert.  Aber in einigen Quellen scheint es, dass es dasselbe zu sein scheint.  Genauer gesagt ist der M8N ein Modul und der M8030-KT ist ein Chipsatz im Inneren.  Ich bin besorgt √ºber das Stromproblem in dieser Verwirrung - der M8N wird ab 2,7 V angek√ºndigt, w√§hrend der M8030-KT ab 1,4 V betrieben wird. </li><li>  Alternativ habe ich auch das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.aliexpress.com/item/1PC-SIM868-GSM-GPRS-Bluetooth-GNSS-SMS-GSM-Module-Instead-of-SIM808-SIM908/32821272639.html%3Fspm%3Da2g0s.9042311.0.0.27424c4dTkhPkq)%2520(%25D0%25BE%25D1%2582%25D0%25BB%25D0%25B0%25D0%25B4%25D0%25BE%25D1%2587%25D0%25BD%25D0%25B0%25D1%258F%2520%25D0%25BF%25D0%25BB%25D0%25B0%25D1%2582%25D0%25B0%2520">SIM868-</a> Modul herumliegen.  in dem es neben GPS auch ein GSM / GPRS-Modul und Bluetooth gibt.  W√§hrend es mit seiner Kniffligkeit und Komplexit√§t der Verbindung Angst macht.  Sie m√ºssen zuerst mit dem Debug-Board spielen. </li></ul></li><li>  Der Hauptunterschied zwischen dem Ger√§t und ‚Äûnur einer Black Box‚Äú ist das Vorhandensein eines <b>Displays</b> .  Bei den ersten Prototypen habe ich das Display √ºber I2C angeschlossen, aber die Buslast betrug ca. 25%.  Der Punkt liegt jedoch nicht einmal im prozentualen Verh√§ltnis, sondern in der Tatsache, dass die √úbertragung des Bildschirmpuffers etwa 25 ms dauert, w√§hrend derer es unm√∂glich ist, mit anderen Ger√§ten auf dem Bus zu kommunizieren.  Dies kann ein Problem sein. Sie m√ºssen das Display entweder auf einen separaten I2C-Bus stellen oder eine Verbindung √ºber SPI in Betracht ziehen <br><br>  Anschluss: 2 I2C-Dr√§hte oder 3 SPI-Dr√§hte (Nur-Schreib-Anzeige, daher wird die MISO-Leitung nicht verwendet, sondern ein separates Daten- / Befehlssignal) <br>  Stromversorgung: 3V <br>  Verbrauch: 25mA <br></li><li>  Um das Ger√§t zu steuern, verwende ich <b>2 Tasten</b> , die jeweils 2 Beine des Prozessors belegen <br></li><li>  Im Originalger√§t (Holux M241, von dem ich urspr√ºnglich die Funktionalit√§t kopiert habe) war es unm√∂glich, den Track zu einem beliebigen Zeitpunkt anzusehen.  Es war notwendig, das Ger√§t an den Computer anzuschlie√üen und die Daten mit einem speziellen Programm zusammenzuf√ºhren.  Es scheint mir, dass die M√∂glichkeit, einen Titel jederzeit auf einem Mobiltelefon oder Tablet anzusehen, sehr beliebt sein wird.  Daf√ºr habe ich ein <b>Bluetooth-</b> Modul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HM-13 gekauft</a> .  Dieses Modul wird ausgew√§hlt, weil es zus√§tzlich zu BLE √ºber SPP verf√ºgt. <br><br>  Anschluss: 2 UART-Kabel, 1 Statuskabel (verbunden / nicht angeschlossen) <br>  Stromversorgung: 2,5 V - 3,9 V. <br>  Verbrauch: 50 mA (obwohl die Zahl 13 mA direkt neben dem Datenblatt steht. Vielleicht ist dies der Spitzen- und Durchschnittswert) <br></li><li>  Wie mir gesagt wurde, macht es keinen Sinn, den H√∂rer eingeschaltet zu lassen, wenn Sie sich nur zur Ruhe setzen oder in einem Caf√© essen gehen.  Aus diesem Grund habe ich beschlossen, den <b>Beschleunigungsmesser</b> MMA8452 hinzuzuf√ºgen und damit festzustellen, ob das Ger√§t in Ruhe ist oder wir uns irgendwo bewegen. <br><br>  Anschluss: 2 Dr√§hte I2C, 1 Draht zur Unterbrechung <br>  Stromversorgung von 2V bis 3,6V mit etwas mikroskopischem Verbrauch <br></li><li>  Der GPS-Track wird auf der <b>SD-Karte</b> aufgezeichnet.  Ich habe bereits versucht, die Karte im SPI-Modus zu verwenden, und dies ist, gelinde gesagt, langsam.  Besonders auf der Platte.  Richtiger Modus f√ºr SD-Karte - SDIO <br><br>  Anschluss: 6 Dr√§hte <br>  Stromversorgung: Ab 1,8V <br>  Der Verbrauch ist unbekannt, aber ich denke nicht mehr als 20mA <br></li><li>  Um Energie zu sparen, ist es sinnvoll, die Stromversorgung der derzeit nicht verwendeten Ger√§te auszuschalten.  Also werde ich in der N√§he jedes Verbrauchers einen <b>Transistor</b> anlegen, der ein separates Signal des Mikrocontrollers steuert <br><br>  Verbindung: 5 Signale, ein Fu√ü pro Verbraucher (GPS, Bluetooth, Beschleunigungsmesser, SD-Karte, Display) <br><br>  UPD basierend auf Kommentaren.  Das Deaktivieren des Beschleunigungsmessers ist nicht sinnvoll - er hat bereits einen Centverbrauch.  Einige Ger√§te funktionieren h√∂chstwahrscheinlich immer (z. B. eine SD-Karte) - in Zukunft kann ich diese Transistoren entfernen.  Einige Ger√§te (z. B. GPS) k√∂nnen sich auf Befehl von der Schnittstelle trennen.  Wenn nach den Testergebnissen dieser Teil gut funktioniert, werde ich auch einen externen Transistor ablehnen.  In der Zwischenzeit mache ich die maximal m√∂gliche Gesamtgeb√ºhr, lassen Sie diese Transistoren alle sein.  Au√üerdem habe ich mich noch nicht f√ºr die Peripherie entschieden. </li><li>  <b>Eine zweifarbige LED</b> zur Statusanzeige (wie w√§re es ohne blinkende LED?).  Es w√§re m√∂glich, eine Dreifarbe zu setzen, aber bisher sehe ich keine Notwendigkeit. <br><br>  Anschluss: 2 Pins <br>  Verbrauch: 10mA <br></li><li>  Zus√§tzlich zu Bluetooth wird ein klassischerer Mechanismus zum Zusammenf√ºhren von Tracks implementiert - √ºber <b>USB</b> .  Hierf√ºr sind 4 Leitungen beteiligt - ein Differenzpaar f√ºr Daten, 1 Pin f√ºr die Erkennung, dass das Ger√§t an USB angeschlossen ist, und ein weiterer Pin f√ºr die logische Verbindung (warum ich diese 2 Pins ben√∂tige, werde ich unten beschreiben). <br></li><li>  Appetit kommt mit Essen.  Warum nicht einen <b>Hocht√∂ner</b> hinzuf√ºgen, seit ich angefangen habe, alles in mein Traumger√§t zu schieben?  Na ja, oder ein <b>Vibrationsmotor</b> .  Ich habe noch keinen User Case gefunden. <br><br>  Anschluss: 1 Draht <br></li><li>  Das Ger√§t muss noch eingeschaltet werden.  W√§hrend der PT1502-Chip mich als Lithium-Batterieladeger√§t und <b>Leistungsregler</b> ansieht.  Um mit der Mikroschaltung zu kommunizieren, m√ºssen Sie zwei Dr√§hte verwenden: einen f√ºr die Energieverwaltung und einen f√ºr ein Signal √ºber eine leere Batterie.  Aus Gr√ºnden des Interesses wird es m√∂glich sein, die Spannung der Batterie unter Verwendung einer anderen Leitung zu messen. <br></li><li>  Nat√ºrlich ist es falsch, die Ladung einer Lithiumbatterie anhand der Spannung zu messen.  Aus diesem <b>Grund habe</b> ich einen speziellen <b>INA219-Leistungsmesserchip</b> hinzugef√ºgt <br><br>  Versorgungsspannung: 3-5V, empfohlen 3,3V <br>  Anschluss: 2 Dr√§hte I2C <br><br>  Wie weiter unten zu sehen sein wird, verursacht eine Versorgungsspannung von 3 V einige Unannehmlichkeiten bei der Verbindung.  Ich w√ºrde es vorziehen, wenn der Z√§hlerchip mit 2,7 V oder weniger betrieben wird.  Aber nachdem ich verschiedene Optionen basierend auf Preis / Fall / Verf√ºgbarkeit durchgesehen hatte, fand ich bei 2,7 V immer noch nichts.  Ich werde f√ºr die Hilfe dankbar sein. <br></li><li>  Es bleibt nur eine Debugging-Schnittstelle <b>SWD</b> (3 Dr√§hte) und ein <b>Debugging-UART</b> (2 weitere Dr√§hte) bereitzustellen. <br></li></ul><br>  Ich war immer an der Frage interessiert, warum Controller mit einer gro√üen Anzahl von Ports ben√∂tigt werden, und ich z√§hlte leicht 39 Pfoten, die f√ºr meine Funktionalit√§t ben√∂tigt wurden.  Und das z√§hlt nicht Quarz, Zur√ºcksetzen und Leistung.  Und es gibt Ideen, wie man mit einem Dutzend mehr umgehen kann (zum Beispiel k√∂nnte das Display √ºber eine parallele Intel 8080- oder Motorola 6800-Schnittstelle angeschlossen werden). <br><br>  Sie k√∂nnen nat√ºrlich die externen I2C-Anschl√ºsse verschrauben, um die Anzahl der verwendeten Beine zu verringern.  Erstens sind dies zus√§tzliche Komponenten auf der Platine, zweitens wird der Softwareteil viel komplizierter, und drittens haben kleine Mikrocontroller immer noch wenig Speicher, und wo gen√ºgend Speicher vorhanden ist, gibt es auch gen√ºgend Ports.  Ich sehe also keinen Grund, alles zu komplizieren - lassen Sie es 39 Zeilen geben. <br><br><h2>  Ern√§hrung </h2><br>  Mit der Stromversorgung ist nicht alles so klar.  Sie k√∂nnen wahrscheinlich alle Ger√§te mit 3,3 V versorgen und sich beruhigen.  Trotzdem werden wir ein mobiles Ger√§t bauen, was bedeutet, dass wir dar√ºber nachdenken m√ºssen, Energie zu sparen.  Sie m√ºssen also versuchen, eine kleinere Versorgungsspannung zu w√§hlen.  Im Folgenden werde ich sch√§tzen, welche Einsparungen Sie erzielen k√∂nnen. <br><br>  Hier sind die Daten f√ºr alle Ger√§te in der Platte - in dieser Form ist es bequemer, die Leistungsdom√§ne auszuw√§hlen, an die dieses oder jenes Ger√§t angeschlossen werden soll. <br><br><div class="scrollable-table"><table><tbody><tr><td>  <b>Ger√§t</b> </td><td>  <b>Leistungsbereich</b> </td><td>  <b>Power Domain</b> </td><td>  <b>Kommunikation</b> </td></tr><tr><td>  CPU </td><td>  2 - 3,6 V. </td><td>  2V </td></tr><tr><td>  Beschleunigungsmesser </td><td>  2 - 3,6 V. </td><td>  2V </td><td>  I2C </td></tr><tr><td>  SD-Karte </td><td>  1,8 V oder 3,6 V. </td><td>  2V </td><td>  SDIO </td></tr><tr><td>  Anzeige </td><td>  1,65 - 3,3 V. <br>  oder 3 - 5V </td><td>  2V </td><td>  I2C oder SPI </td></tr><tr><td>  GPS </td><td>  2,7 - 5,5 V. <br>  oder von 1,4V </td><td>  2,7V </td><td>  UART </td></tr><tr><td>  Bluetooth </td><td>  2,5 - 3,9 V. </td><td>  2,7V </td><td>  UART </td></tr><tr><td>  Leistungsmesser (INA219) </td><td>  3 - 5,5 V. </td><td>  3v </td><td>  I2C </td></tr><tr><td>  Summer </td><td>  3V - 5V </td><td>  Vbat </td></tr></tbody></table></div><br>  An der Platte ist leicht zu erkennen, dass einige der Ger√§te mit ausreichend niedrigen Spannungen (ab 1,8 V) betrieben werden k√∂nnen.  Andere k√∂nnen bequem mit 2,7 V arbeiten.  Schlie√ülich k√∂nnen die verbleibenden Ger√§te unter 3 V nicht funktionieren.  Der Quietscher ben√∂tigt im Allgemeinen 5 V, aber f√ºr mich wird er mit der h√∂chsten Spannung betrieben - von der Batterie, egal wie viel sie ist. <br><br>  Mit der Leistung des Displays ist noch nicht vollst√§ndig verstanden.  In der Beschreibung von Anzeigemodulen mit Ali liegt der Bereich zwischen 3 und 5 V, w√§hrend im Datenblatt des Matrix-Controllers SSD1309 der Bereich zwischen 1,65 und 3,3 V liegt.  Ich gehe davon aus, dass 3 V ben√∂tigt werden, um den Aufw√§rtswandler auf der Anzeigemodulplatine zu schwenken, w√§hrend 1,65 V f√ºr die Logik ausreichen.  Wie aus den Diskussionen √ºber das Layout hervorgeht, ist es sinnvoll, das Anzeigemodul zu verlassen und das Display direkt anzuschlie√üen, wodurch das Display √ºber die 2B-Dom√§ne mit Strom versorgt wird. <br><br>  Ich habe ungef√§hr die gleichen √úberlegungen zu GPS - verschiedene Quellen zeigen unterschiedliche Versorgungsspannungen an.  Bisher habe ich kein Verst√§ndnis daf√ºr, welches Modul ich am Ende verwenden werde. Lassen Sie den Empf√§nger also in der 2,7-V-Dom√§ne h√§ngen. <br><br>  Bei einer SD-Karte ist das √ºberhaupt nicht klar.  Die Spezifikation besagt dunkel, dass die Karte im Allgemeinen mit 3,3 V betrieben werden sollte, aber moderne Karten sind intelligent genug und k√∂nnen verstehen, dass sie in einem Niederspannungsger√§t stecken und von 1,8 V auf Strom umgeschaltet werden k√∂nnen.  Der Mechanismus f√ºr die Auswahl der Lebensmittel ist jedoch nicht sehr klar.  Ich werde die Karte von 2B f√ºttern und sehen, was passiert.  Es wird nicht funktionieren - es wird von 3V funktionieren. <br><br>  Es drohen also 4 Leistungsbusse - 2 V, 2,7 V, 3 V und eine Batterie.  Ich m√∂chte alle Verbraucher, die essen und st√§ndig arbeiten (und dies ist der Controller und das GPS), auf den Bus mit der niedrigsten Spannung setzen, aber im Moment habe ich mich nicht f√ºr das GPS-Modul (und damit dessen Stromversorgung - 2 oder 2,7 V) entschieden, was bedeutet, dass es notwendig sein wird eine Art universelle L√∂sung.  Ich werde versuchen, die Karte zu trennen, damit die eine oder andere Spannung leicht angelegt werden kann. <br><br>  Woher bekommen Sie so viele verschiedene Belastungen?  Schon in der Anfangsphase des Projekts habe ich mir die Mikroschaltung PT1502 angesehen und es sogar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">geschafft, sie in einem anderen Projekt auszuprobieren</a> .  Zus√§tzlich zum Ladeger√§t f√ºr die Lithiumbatterie verf√ºgt diese Mikroschaltung √ºber bis zu 3 Stromquellen - einen Impuls und 2 lineare Abw√§rtsschalter.  Hier ist die Spannung an einem von ihnen jedoch nicht geregelt und betr√§gt 3V - ich werde versuchen, den INA219 damit zu versorgen.  Die restlichen 2 Stromquellen sind da kein Problem  Dort k√∂nnen Sie die Spannung w√§hlen. <br><br>  Die Sch√§tzung des Verbrauchs ist nicht sehr erfolgreich.  Der Spitzenverbrauch wird in den Datenbl√§ttern angegeben. Dies reicht aus, um die Leistung der Schl√ºsseltransistoren zu berechnen, reicht jedoch nicht aus, um die erforderliche Batteriekapazit√§t abzusch√§tzen.  Daher werde ich vorerst die Batterie basierend auf dem verf√ºgbaren Platz im Geh√§use ausw√§hlen und dort bereits den tats√§chlichen Verbrauch messen. <br><br>  Die Frage mag sich stellen, aber wie werden Ger√§te mit unterschiedlichen Betriebsspannungen angepasst?  Lass es uns richtig machen. <br><br><ul><li>  Alle Kommunikationszweige der Mikrocontroller sind als F√ºnf-Volt-tolerant gekennzeichnet (mit Ausnahme von UART2 an den Zweigen von PA2 / PA3). Wenn also 3,3 V vom Ger√§t mit der h√∂chsten Spannung anfallen, passiert nichts Schlimmes </li><li>  Obwohl der Beschleunigungsmesser mit 2 V betrieben wird, kann er m√∂glicherweise parallel zu Hochspannungsger√§ten am Bus geschaltet werden.  Dieses Problem l√§sst sich leicht l√∂sen. Mit der Mikroschaltung MMA8452Q k√∂nnen Sie die Kommunikationsleitungen separat von einem anderen Netzteil mit Strom versorgen (√ºber das Hochspannungsger√§t am Bus selbst). </li><li>  Ich werde versuchen, die SD-Karte mit der gleichen Spannung wie der Mikrocontroller zu betreiben, was bedeutet, dass ich nichts koordinieren muss. </li><li>  GPS und Bluetooth sollten die ‚Äûniedrige‚Äú Spannung vom Mikrocontroller problemlos aufnehmen.  Gleiches gilt f√ºr andere Hochspannungsger√§te </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zum Schluss noch ein paar Worte dar√ºber, warum ich so darum k√§mpfe, die Versorgungsspannung zu senken. </font><font style="vertical-align: inherit;">Ein Chip in einem gepulsten DC-DC-Wandler, der Volt gegen Ampere austauschen kann (wenn Sie die Verluste des Wandlers selbst nat√ºrlich nicht ber√ºcksichtigen). </font><font style="vertical-align: inherit;">Um genauer zu sein, tauschen Sie eine h√∂here Spannung mit einem niedrigeren Strom gegen eine niedrigere Spannung und einen h√∂heren Strom aus. </font><font style="vertical-align: inherit;">In diesem Fall interessiert uns eher die umgekehrte Argumentation: Wenn Sie eine Niederspannungslast √ºber DC-DC speisen, ist der Stromverbrauch dieser gesamten Struktur zusammen mit dem Wandler geringer als der Stromverbrauch der Last selbst. </font><font style="vertical-align: inherit;">Nun, da die Batteriekapazit√§t in mAh gemessen wird, erh√∂ht eine Reduzierung des Stromverbrauchs die Batterielebensdauer.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z√§hlen?</font></font></b> <div class="spoiler_text">   ,        90%,        DC-DC        .  .      ,      DC-DC   . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> .   900    4.1  3.5 (      ).  DC-DC    90% (   ).    100.            . <br><br> ,      900  100  9 .          ‚Äî 9.3     3.3, 11.4   2.7,   15    2. ,    ,    ,        . <br></div></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mikrocontroller </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich ging nachdenklich auf die Frage nach der Auswahl eines Mikrocontrollers ein - ich spielte lange mit dem Konfigurator und wog die Vor- und Nachteile der einzelnen Optionen ab. Die STM32-Mikrocontroller haben mir sehr gut gefallen, daher sehe ich keinen Sinn darin, ohne besondere Notwendigkeit in Richtung anderer Controller zu schauen. Dar√ºber hinaus gibt es in der STM32-Linie Controller f√ºr jeden Geschmack und f√ºr jede Peripherie. Die in den vorherigen Phasen meines Projekts gesammelten Erfahrungen erm√∂glichen es uns, die Auswahl des Controllers anhand der Liste der Peripherieger√§te, der bereits geschriebenen Softwarebindungen sowie der Funktionen, die ich in Zukunft implementieren m√∂chte, einzugrenzen.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist also ziemlich offensichtlich, dass 20 KB Speicher meines STM32F103CB definitiv klein sind - es gibt nicht gen√ºgend Puffer mit angemessener Gr√∂√üe f√ºr die Kommunikation mit einer SD-Karte und USB. </font><font style="vertical-align: inherit;">Ich habe noch nicht einmal begonnen, einen Gro√üteil der geplanten Funktionen zu implementieren, aber es hat bereits mehr als 19 KB gedauert. </font><font style="vertical-align: inherit;">Bei der Verarbeitungsleistung ist dies jedoch nicht besonders notwendig. </font><font style="vertical-align: inherit;">Wenn die gesamte Kommunikation mit Peripherieger√§ten in DMA √ºbertragen wird, verbleiben nur noch ein paar Prozent auf dem Anteil des Zentralprozessors. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem ich die Liste der ben√∂tigten Elemente vom Controller gesch√§tzt hatte, berechnete ich Folgendes:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; = 128kb Flash (derzeit werden ca. 50k verwendet) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; = 40 kb Speicher (jetzt sind 19k belegt) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; = 40 Fu√ü GPIO (siehe Argumentation oben) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; = 40 MHz (Sie brauchen nicht viel, die Hauptsache ist, weniger Verbrauch zu haben) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DMA (hat mir sehr gut gefallen) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; = 2x I2C,&gt; = 3x UART,&gt; = 1 SPI </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SDIO (Flash-Laufwerk √ºber SPI ist sehr langsam) </font></font></li><li>  USB Full Speed,  High Speed </li><li>  (      ) </li><li>       LCD  (         FSMC) </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STMicroelectornics-Mikrocontroller sind nur ein Dutzend - f√ºr jeden Geschmack, jede Farbe und jeden Geldbeutel. Zuerst habe ich versucht, einen Controller auszuw√§hlen, um von der Serie fortzufahren. Die Lineale L0 und F0 sind zu schwach und nicht gen√ºgend Speicher, S7 und H7 hingegen sind zu funktionsreich, es gibt kein SDIO in L4 (UPD: SDIO ist, sie haben es nur nicht auf der Titelseite der Serie erw√§hnt). Im Rest der Serie k√∂nnen Sie etwas ausw√§hlen, das meinen Bed√ºrfnissen entspricht, da ich keine besonderen Anforderungen habe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die STM32WB-Serie beeindruckt durch das Vorhandensein von Bluetooth, aber das VFQFPN68-Geh√§use k√ºhlt den Wunsch, es in Hobbyprojekten zu verwenden, etwas ab. Und solche Controller habe ich im Einzelhandel nicht gefunden.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich zielte auf das LQFP64-Geh√§use - ausreichend in der Anzahl der Beine, aber nicht sehr gro√ü zugleich und kann zu Hause gel√∂tet werden. Es ist gut, dass es einen CubeMX-Konfigurator gibt, in dem Sie mit Filtern ausw√§hlen k√∂nnen, was Sie ben√∂tigen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe mich aus drei Gr√ºnden f√ºr den STM32F103RB-Controller entschieden. Erstens habe ich die F103-Serie bereits gut mit dem Blue Pill Board studiert. Im Allgemeinen passte der STM32F103CB-Controller vollst√§ndig zu mir, nur der Speicher reichte nicht aus. Zweitens habe ich bereits einen Bootloader und einen Low-Level-Code f√ºr diesen Controller, w√§hrend andere √ºberarbeitet werden m√ºssen. Und drittens, vor ungef√§hr einem Jahr, hatte ich bereits Freude daran, 3 St√ºck STM32F103RB zu kaufen. Dann habe ich die verf√ºgbaren Controller nicht detailliert untersucht, sondern einfach einen dickeren Controller aus der F103-Reihe ausgew√§hlt. Wirf es jetzt nicht weg :)</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie bereits erw√§hnt, habe ich keine besonderen Anforderungen an Peripherieger√§te oder Leistung. </font><font style="vertical-align: inherit;">Aber wenn ich auf etwas sto√üe, habe ich bereits Controller aus der F4-Reihe (wenn etwas St√§rkeres ben√∂tigt wird) oder L152RD, wenn Sie etwas mit Verbrauch entscheiden m√ºssen (UPD: Ich habe mir auch L433RC angesehen). </font><font style="vertical-align: inherit;">Was gef√§llt, mit STM32 sind fast alle Pin-zu-Pin-Controller kompatibel, und F4 und L1 / L4 k√∂nnen fast ohne √Ñnderung der Platine gel√∂tet werden. </font><font style="vertical-align: inherit;">Sie k√∂nnen sogar den Verbrauch mit verschiedenen MKs erfassen und vergleichen.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein paar Worte zu K√∂rper und Layout </font></font></h2><br>  Wir haben uns f√ºr die Details entschieden.  Es ist Zeit, ein Diagramm zu zeichnen, dann die Tafel zu verfolgen und dann zu versuchen, sie in das Geh√§use einzupassen.  Oder nicht?  Zugegeben, zuerst bin ich einfach diesen Weg gegangen, aber dann bin ich zu dem Schluss gekommen, dass alles in umgekehrter Reihenfolge gemacht werden muss.  Na ja, oder zumindest zur gleichen Zeit. <br><br>  Ich m√∂chte ein kompaktes Ger√§t bekommen.  Dazu m√ºssen Sie die Gr√∂√üe des verf√ºgbaren Speicherplatzes genau kennen, um zu verstehen, wo die Platine platziert werden muss, wie gro√ü der Akku ist, wo die Tasten, der Bildschirm, der USB-Anschluss und andere externe Komponenten platziert werden m√ºssen und wie Sie die Komponenten montieren k√∂nnen ob es zweckm√§√üig ist, Dr√§hte zwischen ihnen zu verlegen.  Es ist einfach sinnlos, ein Board anzuheben, ohne all diese Dinge zu verstehen.  Es stellt sich also heraus, dass Sie sich zuerst mit dem K√∂rper und dem Layout befassen und dann mit der Schaltung fortfahren m√ºssen. <br><br>  Au√üerdem musste ich beim Zeichnen des Geh√§uses die Auswahl der Komponenten mehrmals √ºberarbeiten.  Daher dachte ich anfangs daran, ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">billiges</a> 128 x 64 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">0,96-</a> Zoll- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Display</a> (Arbeitsbereich 21,7 x 11,2 mm) zu verwenden, aber dieses Display sah vor dem Hintergrund eines viel gr√∂√üeren Geh√§uses v√∂llig mikroskopisch aus.  Dann wurde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein 1,3-Zoll-Display</a> bestellt (Arbeitsbereich 29,4 x 14,7 mm), aber es wurde nicht viel besser.  Dann habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein 1,54-Zoll-Display</a> (35 x 17,5 mm) bekommen - es sieht damit mehr oder weniger normal aus.  Dies ist derzeit die Hauptarbeitsoption. <br><br>  Sch√§tzungen zufolge h√§tte ein 1,8-Zoll-2-Zoll-Display besser ausgesehen, aber diese sind bereits in Farbe und h√∂herer Aufl√∂sung erh√§ltlich, und dementsprechend ist der Bildschirmpuffer gro√ü genug f√ºr meinen Controller (35 KB anstelle von 1 KB).  Das Einschieben gro√üer Displays in das Geh√§use kann auch ein Problem sein, weil  Landeklammern f√ºr solche Module sind deutlich gr√∂√üer als der aktive Bereich des Displays. <br><br>  W√§hrend ich diesen Artikel √ºber Ali schrieb, wurden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">monochrome 2,42-Zoll-Displays</a> mit derselben Aufl√∂sung (128 x 64) und genau derselben Bindung wie 1,54 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zoll angezeigt</a> .  Ich habe einen f√ºr meinen Test bestellt - es besteht die M√∂glichkeit, ihn in meinen Koffer zu stecken, ohne das Ger√§t signifikant zu vergr√∂√üern. <br><br>  Ein weiterer wichtiger Punkt in der Phase der Bearbeitung des Geh√§uses war das Verst√§ndnis, dass das gekaufte Anzeigemodul zu viel Platz beansprucht und den Platz f√ºr die Hauptplatine erheblich reduziert.  Aus diesem Grund habe ich beschlossen, das fertige Anzeigemodul aufzugeben und stattdessen das Display und seine Bindung auf meiner Platine zu platzieren.  Die Anzahl der Teile in der Schaltung nahm leicht zu, aber das Design insgesamt wurde erheblich vereinfacht und kompakter. <br><br>  Ich habe √§hnliche Gedanken zum Thema GPS-Modul.  Es ist nicht so gro√ü, aber egal wie es gestellt wird oder es st√∂rt oder die Antenne wird von einer Batterie geschlossen.  Es kann eine gute Idee sein, die F√ºllung des Moduls auf Ihrer Platine zu platzieren und die Antenne an einer anderen Stelle zu platzieren. <br><br>  Die Arbeit am Geh√§use erm√∂glichte es auch, die Gr√∂√üe und Kapazit√§t der Batterie zu bestimmen.  In dem verf√ºgbaren Volumen wurde gerade eine 900-mAh-Batterie gefunden - wir werden uns darauf konzentrieren.  Ich m√∂chte, dass mein Ger√§t mit einem 15-20-Stunden-Akku arbeitet, was bedeutet, dass der Verbrauch zwischen 45 und 60 mA liegen sollte. <br><br>  Im Moment kann ich die Arbeit am Rumpf nicht als beendet bezeichnen.  Erstens ist die Frage der Wahl f√ºr einige Komponenten (Display, GPS) noch offen.  Zweitens ist nicht klar, ob meine Schaltung grunds√§tzlich startet oder ob es notwendig sein wird, etwas radikal zu √§ndern.  Und drittens stellt sich heraus, dass die Platine zu kompakt ist - ich bin nicht sicher, ob ich sie aufl√∂sen, l√∂ten und debuggen kann.  Daher werde ich mich in diesem Artikel weiterhin auf Schaltungsprobleme konzentrieren, mich in einfacheren und verst√§ndlicheren Schritten bewegen und das n√§chste Mal √ºber den Fall sprechen.  Hier haben Sie ein paar Renderings und Fotos f√ºr Samen. <br><br><img src="https://habrastorage.org/webt/4j/ff/l-/4jffl-arvuselp1d93s5muqazqy.png"><br><br><img src="https://habrastorage.org/webt/o2/a9/ve/o2a9vejujirpcxe634dzikwqc0e.png"><br><br><img src="https://habrastorage.org/webt/a9/hu/ka/a9huka9xfxi-g0wegdzhb8ezonm.jpeg"><br><br><img src="https://habrastorage.org/webt/az/nl/b2/aznlb21azpqtsfgoaim0occrvgc.jpeg"><br><br><h2>  Schema </h2><br>  Jetzt k√∂nnen Sie Elektronik machen.  Ich werde die Schaltungsl√∂sungen ausreichend detailliert beschreiben.  Zuallererst f√ºr die gleichen Neulinge in der Elektronik wie ich, sowie eine Zusammenfassung f√ºr mich.  Erfahrene Elektronikingenieure k√∂nnen die Schaltkreise durchbl√§ttern und zum n√§chsten Abschnitt zur√ºckspulen. <br><br>  Beginnen wir mit der Ern√§hrung. <br><br>  Das Ger√§t wird von einer Lithiumbatterie gespeist, was bedeutet, dass Sie einen Laderegler ben√∂tigen.  Einige Komponenten haben auch eine obere Spannungsgrenze von etwa 3,6 V, w√§hrend eine Batterie leicht mit mehr als 4 V enden kann.  Sie ben√∂tigen also eine abgespeckte Stromquelle.  Wie wir bereits herausgefunden haben, werden wir verschiedene Belastungen ben√∂tigen. <br><br>  Ich habe bereits erw√§hnt, dass ich den PT1502-Chip verwenden werde.  Es passt gut, weil  implementiert einen Laderegler, 3 Stromquellen sowie eine Tastenschaltvorrichtung.  Die Mikroschaltung enth√§lt mehrere Funktionsbl√∂cke, die ich der √úbersichtlichkeit halber im Diagramm unterteilt habe.  Die Schaltung selbst ist eine leicht √ºberarbeitete Datenblattschaltung.  Hier ist der Lithium-Batterieladecontroller <br><br><img src="https://habrastorage.org/webt/7y/p7/sk/7yp7skuez7vcdpdzr33f6rhtfk4.png"><br><br>  Der Widerstand R3 stellt den Ladestrom ein.  Standardm√§√üig entspricht dies 470 mA.  Vielleicht werde ich den Testergebnissen zufolge den Wert dieses Widerstands auf 510 Ohm reduzieren, was einen Ladestrom von etwa 900 mA (1C) ergibt. <br><br>  Die Steuerung kann den aktuellen Lademodus mit dem Fu√ü CHG_STAT melden.  Au√üerdem wei√ü er, wie man Signale bis zu 3 gibt - es wird aufgeladen, es wird nicht aufgeladen und es wurde bereits aufgeladen, ist aber immer noch an die Steckdose angeschlossen.  In der ersten Version dr√ºckt der interne Transistor den Fu√ü auf den Boden und dies kann von der Steuerung leicht erkannt werden.  In der zweiten Ausf√ºhrungsform ist der Transistor vollst√§ndig geschlossen und der Zweig geht in einen hochohmigen Zustand √ºber.  Bei einem Einschalten ist ein solches Signal auch von der Steuerung leicht abzulesen. <br><br>  Aber mit dem dritten Zustand ist das nicht so einfach.  Dort ist der Transistor angelehnt und flie√üt von einem Strom von 20 ŒºA durch.  Um einen solchen Zustand in Betracht zu ziehen, wurde ich aufgefordert, einen Lift zu w√§hlen, so dass etwa die H√§lfte der Nahrung auf meinem Bein lag.  Dann ist es m√∂glich, einen solchen Zustand mit dem ADC leicht zu erkennen.  Nach dem Ohmschen Gesetz erhalten wir R5 = 1V / 20mkA = 50k. <br><br>  Wie gesagt, der PT1502-Chip ist nicht nur ein Ladeger√§t, sondern auch ein kniffliger Controller f√ºr alle Leistungen.  Die Mikroschaltung √ºberwacht die Spannungen in der Schaltung und kann mithilfe des RESET-Signals den Hauptprozessor steuern (sie sagen, dass Sie noch fr√ºh starten m√ºssen, die Leistung hat sich noch nicht stabilisiert). <br><br><img src="https://habrastorage.org/webt/21/z3/f1/21z3f1tkkpvqsph462qukz0_anu.png"><br><br>  Au√üerdem kann die Mikroschaltung das Ger√§t auf Knopfdruck (BTN1) starten und auf ein Signal vom Mikrocontroller (PWR_HOLD) den Vorgang abschlie√üen und die Stromversorgung ausschalten.  Nun, um dem Prozessor zu signalisieren, dass der Batterie das Signal BAT_LOW ausgeht. <br><br>  Und das ist die Hauptstromquelle. <br><br><img src="https://habrastorage.org/webt/nb/5x/tc/nb5xtc2txxl98wz1pfwgmzsr49u.png"><br><br>  Die Ausgangsspannung wird durch die Spannung an der Klemme BUCKFB eingestellt und mit Batteriestrom auf 2 V eingestellt.  Bei einer Zwei-Volt-Stromversorgung wurde jedoch ein Problem festgestellt: USB funktioniert nicht.  Das hei√üt,  Der Akku wird aufgeladen, kann jedoch keine Daten √ºbertragen. Der Mikrocontroller kann einfach keine Signale an einen USB-Bus mit ausreichender Amplitude senden.  Datashit empfiehlt eine Spannung von mindestens 2,7 V, besser als 3,3 V. <br><br>  Um keine andere Stromquelle zu blockieren und dar√ºber nachzudenken, wie man zwischen ihnen umschaltet, habe ich beschlossen, nur das Verh√§ltnis des Teilers R1 / R4 + R7 anzupassen.  Mit dieser Einbeziehung arbeitet der Impuls kontinuierlich.  Sobald das Ger√§t an USB angeschlossen ist, √∂ffnet der Transistor und Shunt R7.  Das Verh√§ltnis der Ansteuerwiderst√§nde √§ndert sich und wir erhalten 3,16 V am Ausgang (wir k√∂nnen immer noch mit den Nennwerten spielen und sie auf 3,3 V halten). <br><br>  Der PT1502 verf√ºgt au√üerdem √ºber 2 lineare Steuerungen. <br><br><img src="https://habrastorage.org/webt/1c/s0/tj/1cs0tjf8eerkuske4_dyqithygm.png"><br><br>  An diese Controller werden entweder Komponenten mit geringem Verbrauch (INA219) oder kurzlebige Komponenten (Bluetooth) angeschlossen, sodass die Effizienz dieser Quellen kein Problem darstellt.  Die LDO2-Versorgungsspannung kann √ºber die LDO2_SETx-Signale eingestellt werden. <br><br>  Da ich noch offene Fragen zur Versorgungsspannung habe, habe ich mich entschlossen, die Jumper zu trennen, um den LDO2_SETx-Modus auszuw√§hlen.  Um den tats√§chlichen Verbrauch auf dem entsprechenden Bus messen zu k√∂nnen, werde ich auch den Jumper JP1 / JP2 / JP3 mit dem Kamm verbinden. <br><br>  Zum Abschluss des Themas Netzteile m√ºssen wir die Leistung des Displays erw√§hnen.  Ich schrieb etwas h√∂her, dass ich im Namen der Kompaktheit das gekaufte Anzeigemodul aufgeben und das Display mit dem Umreifungsband an meinem Board abholen musste.  Diese Anzeige erfordert einen speziellen 7-16V-Aufw√§rtswandler.  Praktischerweise kann diese Quelle √ºber das EN-Signal ein- und ausgeschaltet werden.  Die Schaltung selbst wird aus dem Datenblatt des Boosters kopiert, genau das gleiche wird in Anzeigemodulen mit Ali verwendet. <br><br><img src="https://habrastorage.org/webt/oi/bd/zm/oibdzmvkie49fxcjamxcvszh9gw.png"><br><br><div class="spoiler">  <b class="spoiler_title">PT1505</b> <div class="spoiler_text">  Als ich im Internet nach Alternativen zum PT1502-Chip suchte, stie√ü ich auf ihre √§ltere Schwester - den PT1505-Chip.  Dies ist fast der gleiche Leistungsregler, jedoch mit einem zus√§tzlichen Upgrade.  Mit einer solchen Steuerung w√§re es m√∂glich, die Anzahl der Elemente auf der Platine zu reduzieren.  Leider habe ich keine PT1505-Chips zum Verkauf gefunden. <br><br>  Ich w√§re Ihnen √ºbrigens dankbar, wenn Sie √§hnliche Leistungsregler anderer Hersteller kennen. <br></div></div><br>  Nun ein wenig √ºber die Leistung des Mikrocontrollers.  Die Mikroschaltung ist gro√ü und verf√ºgt √ºber 6 Stromleitungen - 4 f√ºr den digitalen Teil, 1 analoge Stromversorgung und eine f√ºr die Uhr.  Gem√§√ü dem Datenblatt des STM32F103 sollte auf allen Stromleitungen (m√∂glicherweise mit Ausnahme der Uhr) ein 100-nF-Kondensator entlang des Kondensators und ein weiterer bei 4,7 uF vorhanden sein. <br><br>  Im Datenblatt des STM32F4 hei√üt es jedoch, dass die Mikrocontroller zwar in Bezug auf die Ausg√§nge praktisch kompatibel sind, jedoch immer noch etwas andere Leistungsschemata aufweisen.  An den beiden Klemmen sollten sich also zwischen Klemme und Masse Kondensatoren mit 2,2 mkF befinden (und nicht zwischen Masse und Stromversorgung, wie in F1).  Daher musste ich beide Optionen in Betracht ziehen und f√ºr einen bestimmten Mikrocontroller nur einen Teil der Kondensatoren l√∂ten. <br><br><img src="https://habrastorage.org/webt/vv/ai/a4/vvaia45dk-cjpdj9jrypfecczug.png"><br><br>  Wenn Sie das Thema Ern√§hrung fortsetzen, m√ºssen Sie herausfinden, wie Sie es messen k√∂nnen.  Sie k√∂nnen sich auf das Signal BAT_LOW verlassen und den Benutzer bitten, sich schnell zusammenzurollen, wenn die Batterie schwach ist.  Aber genau das hat mir im originalen Holux M-241 nicht gefallen, weil  Dieses Signal erschien zu sp√§t und war leicht zu √ºbersehen.  Ich brauche eine informativere Anzeige der Batterieleistung. <br><br><img src="https://habrastorage.org/webt/2r/6l/0g/2r6l0gd1bdyewq--m8zij_nugxs.png"><br><br>  F√ºr alle F√§lle habe ich den gew√∂hnlichsten Teiler zur Messung der Batteriespannung eingesetzt.  Bei Lithiumbatterien ist dies jedoch nur ein informativer Indikator und sollte nicht als verl√§sslich angesehen werden.  F√ºr ehrlichere Batteriemessungen im Internet empfehlen sie die Verwendung eines ‚ÄûAnh√§ngers‚Äú. <br><br><img src="https://habrastorage.org/webt/an/3u/nc/an3uncm2tjzd-pu3n6ns8vqnhz0.png"><br><br>  Dieser kleine Mikrochip z√§hlt die Energiemenge, die durch ihn zur oder von der Batterie geleitet wurde.  Messungen werden am Shunt R10 durchgef√ºhrt.  Die Messwerte der Mikroschaltung k√∂nnen √ºber I2C abgelesen werden.  Die Mikroschaltung ist in der Lage, die Spannung an der Batterie, den durch den Widerstand flie√üenden Strom zu messen und auch miteinander zu multiplizieren.  Leider wei√ü sie nicht, wie sie den Wert der von Watt * verstrichenen Stunden akkumulieren soll, daher muss sie eine st√§ndige Umfrage durchf√ºhren. <br><br>  Kommen wir zum digitalen Teil.  Das Herzst√ºck des gesamten Systems ist der Mikrocontroller STM32F103RB. <br><br><img src="https://habrastorage.org/webt/hm/ws/ma/hmwsma-hii28gwjrskmvmfsytl4.png"><br><br>  Die Umreifung in Form von zwei Quarzen wurde aus anderen im Internet gefundenen Schemata entnommen (im Datenblatt doppelt √ºberpr√ºft).  Ich muss nicht vom RAM booten, sondern weil das Signal BOOT1 auf den Boden gezogen wird.  BOOT0 kann mit einem Jumper ausgew√§hlt werden, um vom Haupt-Flash-Speicher oder dem eingebauten UART-Bootloader zu starten (z. B. f√ºr die prim√§re Firmware des Ger√§ts). <br><br>  Als n√§chstes ist die LED. <br><br><img src="https://habrastorage.org/webt/ja/bg/ah/jabgahdeoppmxzipfiqu5mpd9dq.png"><br><br>  Da die Hauptversorgungsspannung zwischen 2 und 3,3 V variiert, sollten keine LEDs daran angeschlossen werden - die Helligkeit und der Stromverbrauch variieren stark.  Daher werden die LEDs I an den 2,7-V-Bus angeschlossen, Strombegrenzungswiderst√§nde werden entsprechend berechnet.  Da der Mikrocontroller bei Batteriebetrieb nicht mehr als 2 V an seinem Fu√ü abgeben kann, kann der GPIO-Push-Pull-Modus nicht verwendet werden.  Nur offener Abfluss. <br><br>  √úber die Reset-Taste gibt es nichts Besonderes zu sagen. <br><br><img src="https://habrastorage.org/webt/6x/eq/is/6xeqise0ghoatscub44uzcykfoq.png"><br><br>  Da ein Drei-Volt-Ger√§t (INA219) auf dem I2C-Bus sitzt, m√ºssen Sie auch Klammern an drei Volt anlegen <br><br><img src="https://habrastorage.org/webt/xj/yi/n7/xjyin76yz6g_sg7vo9t2s4eqrms.png"><br><br>  Ein SWD-Anschluss ist ebenfalls Standard.  Eine Diode wird ben√∂tigt, um die Leistung zwischen der Batterie und der externen Leistung des Programmierger√§ts umzuschalten. <br><br><img src="https://habrastorage.org/webt/vl/s7/pw/vls7pw9grlfznf3gfo1_yglclqw.png"><br><br>  Vorwegnahme der Ausrufe, dass sie dies nicht tun und dass eine solche Verbindung die Batterie nicht wirklich trennt.  Ja, es schaltet sich nicht aus, aber die Diode ist nicht daf√ºr.  Dieses Ding wird ben√∂tigt, um das Ger√§t vom Programmierer aus mit Strom versorgen zu k√∂nnen, wenn der Akku nicht angeschlossen ist.  Und wenn verbunden, dann lassen Sie es daraus arbeiten.  Wenn die Batterie angeschlossen ist, m√ºssen Sie den Programmierer selbst vor 4,2 V an der Batterie sch√ºtzen. <br><br>  Die Schaltfl√§chen sollten jedoch detaillierter sein. <br><br><img src="https://habrastorage.org/webt/gg/du/gi/ggdugivqqx7iqjimaqwkbsiehru.png"><br><br>  Tatsache ist, dass die erste Taste nicht nur eine Taste ist, sondern auch als Ger√§teschalter fungiert - das BTN1-Signal wird an den PT1502-Leistungscontroller-Chip angeschlossen.  Wenn das Ger√§t ausgeschaltet ist, werden der Mikrocontroller und andere Verbraucher nicht mit Strom versorgt.  Aus diesem Grund ist der Knopf nicht an die Stromversorgung (VCC), sondern an die Batterie (BAT) angeschlossen.  Durch Dr√ºcken dieser Taste schaltet der PT1502 alle Stromquellen ein und startet den Mikrocontroller.  Danach kann die Schaltfl√§che wie eine normale Schaltfl√§che funktionieren.  Um den Mikrocontroller nicht mit einer hohen Batteriespannung zu verbrennen, habe ich einen kleinen Spannungsteiler eingebaut, der das BTN1-Signal in die erforderlichen Frames treibt (dies ist jedoch m√∂glich - der Mikrocontroller hat Eing√§nge, die 5 V tolerieren). <br><br>  Die zweite Taste ist unauff√§llig.  Im Inneren des Prozessors wird ein Zug auf den Boden eingeschlossen, und der Knopf f√ºhrt eine Einheit in die Leitung ein ... <br><br>  Gehen Sie nahtlos zur schweren Peripherie √ºber.  USB <br><br><img src="https://habrastorage.org/webt/hj/vn/tg/hjvntgq_-3sjzwjv03t0dqd--gg.png"><br><br>  Der USB-Anschluss ragt aus dem Ger√§t heraus und statische Elektrizit√§t kann dorthin gelangen.  Es stellt sich heraus, dass es spezielle Mikroschaltungen (wie STF202-22) gibt, die Mikrocontroller vor √§u√üeren Einfl√ºssen sch√ºtzen. <br><br>  Aber noch etwas ist hier interessant.  Im STF202-Chip, der zwischen dem VBUS-Zweig und der D + -Leitung angeschlossen ist, ist ein 1,5-k-Widerstand verborgen.  Dieser Widerstand wird gem√§√ü der USB-Spezifikation ben√∂tigt - er teilt dem Host mit, dass er in etwas steckt.  In vielen Schaltkreisen ist dieser Widerstand immer zwischen der Stromversorgung und der D + -Leitung angeschlossen.  Sobald der Host einen solchen Widerstand auf der D + -Leitung sieht, beginnt er sofort mit der Kommunikation mit dem Ger√§t.  Dies ist nicht immer angemessen, da  Einige Ger√§te sind m√∂glicherweise nicht sofort f√ºr die Kommunikation bereit. <br><br>  Dies ist nur mein Fall.  Daf√ºr gibt es einen einfachen Trick ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> ausspioniert).  Sie k√∂nnen diesen Widerstand mit einem Transistor ein- und ausschalten: Wir wollen Kommunikation - wir schalten den Widerstand ein, wir wollen nur √ºber USB mit Strom versorgt werden - schalten Sie ihn aus.  Wenn Sie Ihr Mobiltelefon an USB anschlie√üen, fragt er normalerweise: ‚ÄûWas machen wir?  Daten zusammenf√ºhren oder nur aufladen? ‚Äú  - In Bezug auf die Elektronik geht es nur darum, einen Pull-up-Widerstand anzuschlie√üen. <br><br>  Aber woher wissen Sie, ob ein Ger√§t an USB angeschlossen ist?  Zu diesem Zweck habe ich das Signal USB_PLUGGED bereitgestellt, das vom einfachsten Teiler entfernt wird. <br><br><img src="https://habrastorage.org/webt/hx/lr/u5/hxlru5qf7wv13uxeseybbyhhpdi.png"><br><br>  5 V von USB k√∂nnen auch direkt in den Fu√ü des Mikrocontrollers eingespeist werden - sie sind immer noch 5 V tolerant.  Aber lass es schon durch den Teiler sein. <br><br>  Beschleunigungsmesser jetzt <br><br><img src="https://habrastorage.org/webt/-g/t1/5j/-gt15jf_cub3nubnrpsbr5hiusa.png"><br><br>  Das Schema stammt aus einem Datenblatt.  Das Modul ist √ºber I2C verbunden, aber um dem Mikrocontroller zu signalisieren, dass es Neuigkeiten gibt, wird auch eine Interrupt-Leitung verwendet.  Da der Drei-Volt-INA219 immer noch am selben I2C-Bus h√§ngt, werden auch die Kommunikationszweige des Beschleunigungsmessers vom 3B-Bus mit Strom versorgt, um die Pegel zu koordinieren. <br><br>  Ich habe bereits erw√§hnt, dass ich Energie sparen und unbenutzte Ger√§te ausschalten m√∂chte.  Die Beschleunigungsmesserleistung wird also vom Transistor eingeschaltet. <br><br>  Das sogenannte hat mir √ºbrigens sehr gut gefallen  digitale Transistoren - ein Transistor mit zwei Widerst√§nden.  Dies spart etwas Platz auf der Platine.  Es ist nur schade, dass ich mit einer Zwei-Volt-Leistung keinen digitalen Transistor mit mindestens einem anst√§ndigen Strom aufnehmen konnte - maximal 20-30 mA.  Daher mussten uners√§ttlichere Verbraucher mit MOSFETs verbunden werden. <br><br>  Gehen Sie weiter GPS <br><br><img src="https://habrastorage.org/webt/vr/l-/hm/vrl-hm0a27os6lit3ont256xd1g.png"><br><br>  GPS befindet sich auf einer separaten Karte und ist √ºber einen Loopback verbunden.  Da ich mich noch nicht f√ºr das GPS-Modul entschieden habe, habe ich 2 verschiedene Netzteile bereitgestellt.  Neben dem Leistungstransistor auf der Prozessorkartenseite gibt es nichts Interessanteres. <br><br>  Ich sage nur ein paar Worte zu UARTs.  Urspr√ºnglich wollte ich alle 3 verwenden - eine zum Hochladen von Firmware und zum Debuggen, die zweite f√ºr GPS und die dritte f√ºr Bluetooth.  Es stellte sich jedoch heraus, dass sich UART3 auf denselben Pins befindet wie I2C Nr. 2, das ich urspr√ºnglich f√ºr das Display verwenden wollte.  Ich musste w√§hlen.  Als Ergebnis kam ich zu dem Schluss, dass ich Firmware hochladen und √ºber denselben UART debuggen kann, der f√ºr GPS reserviert ist (nat√ºrlich muss GPS deaktiviert werden).  Nun, wenn Sie das GPS selbst deb√ºtieren m√ºssen, dh USB CDC (in das Sie Protokolle hochladen k√∂nnen) und SWD.  Wenig sp√§ter gab ich die Idee der Verwendung von I2C Nr. 2 auf, sodass UART3 kostenlos wurde, aber im Namen des Batteriesparens entschied ich mich, mich auf zwei UARTs zu konzentrieren. <br><br>  Bluetooth <br><br><img src="https://habrastorage.org/webt/r2/m6/zt/r2m6ztztpabt1_2yprjrdava5nq.png"><br><br>  Bluetooth ist gem√§√ü dem Schema aus dem Datenblatt verbunden.  Pin PIO1 kann in zwei Modi betrieben werden.  Im ersten Fall wird eine LED daran angeschlossen und das Modul blinkt mit dieser LED.  Unterschiedliche Winks bedeuten unterschiedlichen Status.  In einem anderen Modus arbeitet dieser Pin als digitaler Pin - einer, wenn die Kommunikation hergestellt ist, und 0, wenn nicht.  Die Modi werden w√§hrend der Modulinitialisierung durch AT-Befehle umgeschaltet. <br><br>  SD-Karte <br><br>  Obwohl das SD-Kartenverbindungsschema Standard ist, war es aus irgendeinem Grund f√ºr mich sehr schwierig.  Es gibt zu viele verschiedene Verbindungsoptionen im Internet und es ist nicht so einfach zu verstehen, welche richtig ist. <br><br><img src="https://habrastorage.org/webt/9g/mi/xh/9gmixhnhcfhlo0s98wcmfz1dubk.png"><br><br>  Zum gr√∂√üten Teil hatte ich Fragen in Buchsen.  Gelegentlich gibt es Schemata, bei denen Widerst√§nde in 1k gesetzt werden.  Einige Schaltkreise setzen 22 Ohm Widerst√§nde ein, anscheinend als Schutz gegen statische Aufladung.  Trotzdem bieten die meisten Schaltkreise keine Durchgangswiderst√§nde an, und ich werde wahrscheinlich den gleichen Weg gehen.  Ich werde seitdem auch keine Statik mehr haben  Das Flash-Laufwerk befindet sich im Geh√§use. <br><br>  Der Leistungstransistor, so scheint es mir, wird auch nicht gefragt sein, ich denke, die Karte wird immer funktionieren - es ist ein Logger.  Aber da dies ein Testboard ist, lass es sein.  Das Gleiche gilt f√ºr die Spule - anscheinend wurde diese Aufnahme in das Original paranoid gemacht, oder die Karte wurde in einer Umgebung mit geringer Leistung oder Interferenz verwendet.  Ich denke dort einen Nullwiderstand anzul√∂ten und ohne Spule zu versuchen. <br><br>  Anzeige <br><br>  Ich hatte die M√∂glichkeit, eines der Anzeigemodule √ºber SPI mit ali zu verbinden und mit der Verbindung √ºber I2C zu vergleichen.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gab keine besonderen Schwierigkeiten und der Code musste nur geringf√ºgig verschwendet werden. Gleichzeitig ist die Geschwindigkeit von SPI um eine Gr√∂√üenordnung h√∂her als die von I2C. Nachdem ich die Daten aus dem Datenblatt zum Verbrauch (4 mA f√ºr SPI gegen√ºber 10 mA f√ºr I2C) und der Notwendigkeit von Pull-up-Widerst√§nden f√ºr I2C hinzugef√ºgt hatte, entschied ich mich, das Display √ºber SPI anzuschlie√üen. </font></font><br><br><img src="https://habrastorage.org/webt/zn/zx/yh/znzxyhs4tcmv4fyyhb-hfxzihns.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leider wird das BS0-Signal nicht an die Anzeigeschleife ausgegeben, und daher k√∂nnen Sie den 3-Draht-SPI-Modus nicht ausw√§hlen, sondern nur 4-Draht-SPI. Die Differenz in der zus√§tzlichen D / C-Leitung (Daten / Befehl), die im 3-Draht-Modus durch das neunte Bit der SPI-Daten √ºbertragen wird. Vielleicht ist der 4-Draht-Modus jedoch zum Besseren, weil SPI in STM32 kann nur 8 Bit √ºbertragen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Rest des Schemas entspricht dem Datenblatt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und schlie√ülich der Quietscher. Nichts Besonderes - einfach √ºber den Transistor einschalten.</font></font><br><br><img src="https://habrastorage.org/webt/b9/nk/9u/b9nk9uzbod6oeswokssk4nhfvsq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr den Fall, dass anstelle eines Hocht√∂ners ein Vibromotor vorhanden sein sollte, habe ich eine Schutzdiode bereitgestellt. </font><font style="vertical-align: inherit;">Ich habe jedoch die Meinung geh√∂rt, dass eine Schutzdiode auch den Hocht√∂ner nicht verletzt.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In Eisen </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oben habe ich meine Gedanken zum Thema Korps beschrieben. Tats√§chlich habe ich sogar versucht, ein Brett f√ºr diesen Fall zu z√ºchten. Leider war das Board zu eng. Ich musste zweiseitig installieren und von den Komponenten 1206 auf 0805 wechseln, aber trotzdem waren die Komponenten auf der Platine sehr dicht. Dar√ºber hinaus war jede √Ñnderung des Schemas ein Schmerz, weil Ich musste fast die H√§lfte des Brettes neu z√ºchten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also habe ich einige Wochen mit ihr herumgespielt, aber der Vorstand hat mich besiegt und ich habe das Projekt f√ºr fast ein Jahr aufgegeben. Kick wurde </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier in </font><font style="vertical-align: inherit;">diesem Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Aber wirklich, dies ist nur ein Prototyp und der erste von mehreren. Warum sollten Sie sich mit einer superkompakten Platine besch√§ftigen, bei der Sie nicht mit einem L√∂tkolben oder einem Oszilloskop kriechen k√∂nnen, wenn Sie alles auf einer gro√üen Platine debuggen k√∂nnen?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun, Sie m√ºssen kein so gro√ües Board wie ein iPhone herstellen, aber es ist durchaus m√∂glich, in die werblichen 100 x 100 mm 2 Schichten von JLCPCB einzusteigen. </font><font style="vertical-align: inherit;">Sie k√∂nnen sich praktisch einschr√§nken. </font><font style="vertical-align: inherit;">Auf der Platine befindet sich also ein riesiges 2,42-Zoll-Display, Steckbr√ºcken zur Messung des Verbrauchs √ºber alle Stromleitungen, Leistungskondensatoren, wo Sie sie ben√∂tigen und nicht ben√∂tigen, und im Allgemeinen eine Reihe von Teilen, die nicht installiert werden konnten. </font><font style="vertical-align: inherit;">Es ist noch ein Platz frei.</font></font><br><br><img src="https://habrastorage.org/webt/nm/ig/vr/nmigvrrichuyvfy4vddfogpnquu.png"><br><br><img src="https://habrastorage.org/webt/sr/cy/ed/srcyeditmbixylghywsn15j-qas.png"><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist in der Fotoansicht</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/d-/co/ru/d-coru_uwsrkpvz44tirfmisedg.png"><br><br><img src="https://habrastorage.org/webt/5w/pq/xk/5wpqxktdsgqt1auvgeh4wnhbaz4.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úber die Verkabelung gibt es nicht viel zu erz√§hlen. Ich teilte die meisten Signal- und Feldlinien entlang der oberen Schicht, w√§hrend die untere fast vollst√§ndig unter der Erde vergraben war. Leider stellte sich heraus, dass das Layout immer noch ziemlich dicht war und einige Signalleitungen entlang der unteren Schicht durch die H√§lfte der Platine gezogen werden mussten. Aus diesem Grund wird das Land stellenweise in mehrere lose miteinander verbundene Inseln "zerrissen". Ich hoffe das ist kein Problem. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe die Erde nicht unter der Bluetooth-Antenne gemacht, aber ich musste trotzdem eine der Signalleitungen durch diese Zone ziehen. Dies ist jedoch die BT_ON-Leitung, entlang der die Signale h√§ufig nicht laufen (sie wird dort entweder ein- oder ausgeschaltet), was bedeutet, dass sie das Signal nicht besonders beeinflussen sollte.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Sommer kam und ich hatte vor, die Miete in den Urlaub mitzunehmen. Damit Dienstm√§dchen in Hotels keine Angst vor einem blo√üen Debugging-Board mit einem Kabelventilator haben, w√§re es sch√∂n, es in dem Fall zu verstecken. Ich konnte mir das Vergn√ºgen nicht verweigern und entwickelte gleichzeitig den Fall und das Board. Es gab also Montageplatinen im Geh√§use, auf denen der Displayhalter montiert war. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das GPS-Modul besteht aus mehreren Platinen und einer 12 mm dicken Antenne. Ich beschloss, es nicht oben auf das Brett zu haken, sondern auf die gleiche Ebene zu legen. Dies reduzierte die Dicke des Geh√§uses, biss jedoch eine Ecke der Platte ab. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein paar Fotos von der Tafel und dem letzten Ger√§t (in dieser Phase des Projekts). </font></font><br><br><img src="https://habrastorage.org/webt/sr/yk/-g/sryk-gs6dpsw3cjk4mx7fhj4khw.jpeg"><br><br><img src="https://habrastorage.org/webt/i7/hm/im/i7hmimruqywcfpkw9q5qudxkyog.jpeg"><br><br><img src="https://habrastorage.org/webt/r_/wo/bj/r_wobjeewfmg8fohrp_nmehi1c4.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Akku passt gut unter das Display, aber ich musste eine kleine Box machen, um das Display n√§her an die obere Abdeckung zu heben.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein paar Worte auf dem Montagebrett. Ich habe alles an ungef√§hr drei Abenden gel√∂tet, und ungef√§hr eine Woche am Abend habe ich gem√§chlich gebraucht, um von der Softwareseite aus zu debuggen und zu √ºberpr√ºfen. Zu meiner √úberraschung gab es keine grunds√§tzlichen Schwierigkeiten beim Einrichten des Boards und fast alles begann so, wie es sollte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es stellte sich heraus, dass das L√∂ten von 0805 nicht viel schwieriger zu l√∂ten war als 1206, es ist zu Hause mit einer Lupe ziemlich essbar. Sie k√∂nnen sogar bei 0603 schwingen. Aber mit dem L√∂ten des Mikrocontrollers und des Displayanschlusses (sie haben einen Abstand von 0,5 mm) musste ich basteln. Auf YouTube sieht es f√ºr die Leute irgendwie so aus - ich habe es nur mit einem L√∂tkolben verbracht und das wars, aber alle meine Schlussfolgerungen blieben sofort h√§ngen.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicht ohne kleinere Probleme. An einigen Stellen gab es kein Trinken, irgendwo gab es einen ‚ÄûRotz‚Äú. Der Platzbedarf f√ºr den USB-Anschluss stellte sich als falsch heraus - er hatte einen Schritt der Schlussfolgerungen, der weniger als notwendig war (also vertrauen Sie nach diesen Fu√üabdr√ºcken aus dem Internet!). Ich musste die Schlussfolgerungen ein wenig biegen, damit sie auf die Strecke kamen. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> stellte sich heraus, dass der bei Ali gekaufte </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">FPC-</font></a><font style="vertical-align: inherit;"> Display- </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Anschluss</font></a><font style="vertical-align: inherit;"> mit den Kontakten unten √ºbereinstimmt, w√§hrend ich ihn mit den Kontakten oben ben√∂tigte (ich hatte zuvor keinen solchen Unterschied vermutet). Ich musste den Stecker von der Standardanzeigetafel ‚Äûabblasen‚Äú. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem ich die Platine in das Geh√§use gesteckt hatte, stellte sich heraus, dass es nicht m√∂glich war, die Batterie durch einfaches Herausziehen des Steckers zu trennen, aber ich wollte die debuggte Platine nicht unter Spannung lassen. Ich musste einen Schalter bet√§tigen.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beim Einrichten der Karte stellte sich heraus, dass es keinen Erdungskontakt gibt, an dem Sie die Sonde am Oszilloskop befestigen k√∂nnten. Ich musste mich mit einem Krokodil an den USB-Anschluss klammern. In der n√§chsten Version des Boards m√ºssen Teststandorte bereitgestellt werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schaltungen zeigten auch Probleme. Es war also eine v√∂llig unerwartete Tatsache, dass der PT1502-Chip am RESET-Pin eine Spannung von 3 V erzeugt (ich war mir v√∂llig sicher, dass es so etwas wie einen offenen Kollektor gab). Infolgedessen leckten diese 3 V an die Stromleitung, obwohl ich vorhatte, dort nur 2 V zu haben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier ist ein vereinfachtes Diagramm dessen, was passiert ist. </font></font><br><img src="https://habrastorage.org/webt/ag/rw/tg/agrwtgjika-hvgzl_die2gokf4c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dank des gro√üartigen Verstandes und der Leute von easyelectronics.ru wurde diese Verbindung durch Hinzuf√ºgen einer Diode entschieden. Nach einer kleinen Operation funktionierte dieser Teil wie es sollte.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au√üerdem habe ich das Bluetooth-Modul (mit 2,5 V versorgt) versehentlich an die Hauptstromversorgung (2 V) angeschlossen, anstatt an die festen 3 V. Jetzt kann das Bluetooth f√ºr mich nur funktionieren, wenn USB angeschlossen ist und die Spannung der Hauptstromversorgung auf 3,3 V ansteigt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Prinzip w√§re es m√∂glich, das Skalpell zu bewegen und das Bluetooth mit der richtigen Leistung zu verl√∂ten, aber der UART2, an den das Bluetooth angeschlossen ist, ist nicht tolerant gegen√ºber 5 V (er selbst hat es im Datenblatt in der Analysephase gelesen, er selbst hat dies im obigen Text notiert und schlie√ülich beim Verdrahten der Platine vergessen ) Daher ist das Anschlie√üen des Bluetooth an die Stromversorgung h√∂her als die Leistung des Mikrocontrollers ... In der n√§chsten Version der Karte verbinde ich das Bluetooth einfach mit einem anderen UART.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der DC-DC-Wandler mit variabler Spannung funktionierte ebenfalls wie geplant - wenn er von einer Batterie gespeist wird, gibt er 2 V ab, und wenn Sie den USB anschlie√üen, steigt er auf 3,16 V (Sie m√ºssen mit den Nennwerten spielen und 3,3 V erreichen). Aber hier ist noch ein Fehler der Schaltung herausgekommen: Sie m√ºssen auch in der Lage sein, die Spannung zu erh√∂hen, wenn sie vom Programmierer mit Strom versorgt werden. Ich denke, dies wird durch Hinzuf√ºgen einer weiteren Diode behandelt. Ich werde versuchen, etwas sp√§ter zu spielen.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schlie√ülich verstand ich w√§hrend der Arbeit an der Platine immer noch nicht, wie man die SD-Karte richtig gegen Unterspannung versorgt. Ein kurzes Googeln f√ºhrte zu nichts. Anscheinend m√ºssen Sie sich mit dem Lesen von Spezifikationen f√ºr enge Seiten befassen (die au√üerdem teilweise geschlossen sind). In der Zwischenzeit habe ich R7 kurzgeschlossen und die Karte wird jetzt von einer festen 3,16 V (3,3 V) gespeist. Ich werde es f√ºr die n√§chsten paar Monate so lassen, w√§hrend ich am Software-Teil arbeiten werde. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apropos Software. √úberraschenderweise (obwohl durchaus erwartet), aber im Allgemeinen lief alles ohne Probleme an. Da ich zwischen Mikrocontrollern der gleichen Serie (von F103CB zu F103RC) gewechselt habe, musste ich den Softwareteil nicht √§ndern. Korrigierte nur die Pin-Nummern, f√ºgte aber den Einschluss von Transistoren hinzu. Trotzdem gab es 2 nicht triviale Momente, an denen ich basteln musste.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der erste ist Batteriestrom. </font><font style="vertical-align: inherit;">Ich habe das Board mit USB-Strom getestet und alles hat im Allgemeinen gut funktioniert. </font><font style="vertical-align: inherit;">Aber das Board wollte den Akku nicht dauerhaft einschalten.</font></font> Das hei√üt,<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es kann funktionieren (wenn Sie es einschalten, w√§hrend der USB-Anschluss angeschlossen ist, und dann das Kabel herausziehen), aber es funktioniert nicht, wenn Sie mit einem kalten Kabel beginnen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entsprechend dem Design des PT1502-Chips sollte die Platine so beginnen. </font><font style="vertical-align: inherit;">Der Benutzer dr√ºckt die BTN1-Taste und nach einer Drittelsekunde schaltet der Chip alle Stromquellen ein. </font><font style="vertical-align: inherit;">Wenn alles in Ordnung ist, gibt der PT1502 das RESET-Signal ‚Äûfrei‚Äú und startet so den Mikrocontroller. </font><font style="vertical-align: inherit;">Der Prozessor setzt seinerseits das Signal PWR_HOLD auf eins und signalisiert, dass es gestartet wurde. </font><font style="vertical-align: inherit;">Danach versorgt der PT1502 den Stromkreis regelm√§√üig mit Strom, bis der Mikrocontroller das Signal PWR_HOLD auf Null senkt.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das ist aber theoretisch. Sobald der Prozessor das PWR_HOLD-Signal gesetzt hat, wurde die Karte sofort ausgeschaltet. Ich schaufelte den gesamten Stromkreis, schaute auf die Wellenformen der Hauptsignale, mischte den Code im Bootloader hin und her, aber ich konnte das Problem nicht verstehen. Ich habe auch wegen des Fehlens eines Pulldown-Widerstands in der PWR_HOLD-Leitung ges√ºndigt, den ich vergessen habe zu installieren, aber er wird von einem Datenblatt empfohlen (und h√∂chstwahrscheinlich wird er noch ben√∂tigt). Das Hinzuf√ºgen mit einem Baldachin l√∂ste das Problem jedoch nicht. Und erst als ich ein Vierkanal-Oszilloskop verlieh, wurde alles klar.</font></font><br><br><img src="https://habrastorage.org/webt/ix/ie/xf/ixiexf-lau1vggfbwu9ta4ys_hq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Benutzer die Taste dr√ºckt (orange Linie), schaltet der PT1502-Chip die Stromversorgung ein (lila Linie). All dies geschieht lange (300 ms) vor den Ereignissen auf dieser Wellenform. Und dann passiert etwas Interessantes. PT1502 gibt RESET (blaue Linie) frei, der Prozessor startet und senkt aus irgendeinem Grund die Tastenlinie auf Null. Obwohl der Mikrocontroller immer noch versucht, die POWER_HOLD-Leitung (gr√ºne Linie) anzuheben - es ist zu sp√§t, hat der PT1502 bereits alle Stromquellen ausgeschaltet. Dann gibt es noch ein paar Kr√§mpfe, aber die Schaltung stirbt immer noch leise. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Frage ist, woher kommt die Null auf dem Knopf? Der </font><font style="vertical-align: inherit;">springende </font><font style="vertical-align: inherit;">Punkt ist ein </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unauff√§lliger Fehler im Bootloader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aufgrund dessen das BTN1-Bein in den Ausgabemodus versetzt wurde (m√∂glicherweise traten in diesem Moment auch auf anderen Beinen Wunder auf) und dort ein niedriges Signal auftrat.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was sonst noch zu k√§mpfen hatte, ist die SD-Karte. Es gab einfach kein SDIO-Modul im alten Mikrocontroller, also musste ich dieses St√ºck von Grund auf neu studieren. Ich habe fast den ganzen Tag damit verbracht, eine Karte zu erstellen, Codeteile aus Beispielen im Internet zu kopieren und was CubeMX generiert hat. Obwohl die Karte auf einem Computer perfekt lesbar war, wollte sie dauerhaft nicht in meiner Schaltung starten. Ich habe wegen schlechtem L√∂ten, falsch ausgew√§hlten Pull-up-Widerst√§nden, ungeschickten Schaltkreisen und falsch interpretiertem Datenblatt ges√ºndigt. Zu meiner √úberraschung startete jedoch problemlos eine andere Karte mit demselben Code und demselben Board. Es wird notwendig sein, dieses Problem genauer zu untersuchen.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gab ein weiteres Problem mit der Karte. Ich stocherte mit einem Oszilloskop in verschiedenen Zeilen und sah Aktivit√§t nur auf der D0-Leitung, w√§hrend auf D1-D3 Stille herrschte - die Karte arbeitete im Einzelbitmodus. In HAL wurde sogar die Funktion HAL_SD_ConfigWideBusOperation () gefunden, die den 4-Bit-√úbertragungsmodus aktivieren kann. Als die Karte in den 4-Bit-Modus geschaltet wurde, gingen die SDIO-Peripherieger√§te leider in den Deep RX FIFO Overrun und funktionierten nicht mehr.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Problem stellte sich als sehr interessant heraus. </font><font style="vertical-align: inherit;">Es stellte sich heraus, dass es in der Funktion HAL_SD_ReadBlocks () eine bestimmte Schleife gibt, die die SDIO-Flags abfragt. </font><font style="vertical-align: inherit;">Wenn neue Daten von der Karte ankommen, √ºbertr√§gt dieser Code die Bytes vom internen FIFO-Puffer in den Benutzerspeicher. </font><font style="vertical-align: inherit;">Die Karte hat also Bytes so schnell √ºbertragen, dass der Code in HAL_SD_ReadBlocks () einfach keine Zeit hatte, die Daten zu √ºbertragen. </font><font style="vertical-align: inherit;">Ich musste die Taktfrequenz der Karte vor√ºbergehend senken. </font><font style="vertical-align: inherit;">Nun, in Zukunft werde ich DMA verwenden und ein solches Problem sollte im Prinzip nicht auftreten.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fazit und n√§chste Schritte </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diejenigen, die an diesem Ort erwartet haben, das fertige Ger√§t zu sehen, werden mich entt√§uschen m√ºssen - nur das Testboard ist fertig und sogar das, nur das St√ºck Eisen. Jetzt m√ºssen Sie ihm Leben einhauchen, die Programmierung durchf√ºhren, die Modi und den Verbrauch optimieren. Schreiben Sie tats√§chlich einen Protokollierungscode - deshalb wurde das gesamte Projekt gestartet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trotzdem ist diese Etappe f√ºr mich pers√∂nlich eine sehr gro√üe und wichtige Leistung. Elektronik ist nicht meine Spezialit√§t und ich bin sehr froh, dass das Ger√§t √ºberhaupt gestartet wurde. Ich habe es geschafft, genug zu pumpen, um Schaltkreise zu entwerfen, mehrere Ger√§te zusammenzubringen, die Platine zu verdrahten, Komponenten auszuw√§hlen und vieles mehr.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich werde ein anderes Mal √ºber den Softwareteil sprechen. </font><font style="vertical-align: inherit;">Sowie √ºber die Nuancen der Einstellungen. </font><font style="vertical-align: inherit;">Tatsache ist, dass diese gesamte F√ºllung zuerst wiederbelebt und getestet werden muss. </font><font style="vertical-align: inherit;">Im Moment haben wir es geschafft, alle Ger√§te auf dem Board zu starten (au√üer dem Hocht√∂ner), aber nur in der Menge von "es hat begonnen und reagiert irgendwie". </font><font style="vertical-align: inherit;">Es wurde noch keine Verarbeitungslogik geschrieben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pl√§ne f√ºr die nahe Zukunft:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fahren Sie die Elektronik in verschiedenen Modi und pr√ºfen Sie, ob die Schaltung noch funktioniert. </font><font style="vertical-align: inherit;">Behebung von Pfosten in der zweiten Version des Boards</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Messen Sie den Verbrauch der gesamten Peripherie und finden Sie M√∂glichkeiten zur Optimierung des Verbrauchs. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Stellen Sie mehrere Kartenoptionen auf verschiedenen Mikrocontrollern zusammen (z. B. L152 oder L433). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lesen Sie die SD-Spezifikation sorgf√§ltig durch und finden Sie heraus, wie Sie die Karte im Niederspannungssignalisierungsmodus (1,8 V) richtig anschlie√üen. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Probieren Sie verschiedene GPS-Module aus und entscheiden Sie schlie√ülich, welches ich als n√§chstes verwenden werde </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bestellen Sie einen separaten Kompass-Chip (z. B. HMC5883L oder HSCDTD008A) und versuchen Sie, ihn irgendwie zu verwenden </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> F√ºhren Sie ein internes Code-Refactoring durch und aktualisieren Sie alle wichtigen Bibliotheken, beginnend mit HAL </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnen Sie schlie√ülich mit dem Schreiben von Funktionen. </font><font style="vertical-align: inherit;">Implementieren Sie tats√§chlich, wof√ºr das Ger√§t bestimmt war</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erlauben Sie mir, mich zu verabschieden. </font><font style="vertical-align: inherit;">Ich w√§re dankbar f√ºr konstruktive Kommentare, Ideen und Ratschl√§ge zum Schaltungsdesign und zum Leiterplattenlayout. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quellen: - </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Urladercodes </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plata </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geh√§use</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de454434/">https://habr.com/ru/post/de454434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de454424/index.html">5 h√§ufige Fehler bei der Verwendung von Android-Architekturkomponenten</a></li>
<li><a href="../de454426/index.html">K√ºnstlich: zu Beginn der k√ºnstlichen Intelligenz</a></li>
<li><a href="../de454428/index.html">Was Apple auf der WWDC vorgestellt hat und was iOS-Entwickler dar√ºber denken</a></li>
<li><a href="../de454430/index.html">3D-Lebensdauer</a></li>
<li><a href="../de454432/index.html">Unterhaltsame Arch√§ologie: Der Style Guide R unter der Lupe</a></li>
<li><a href="../de454436/index.html">Petty Petty Joy # 1: Loguru</a></li>
<li><a href="../de454440/index.html">Petty Little Fun # 2: Starlette</a></li>
<li><a href="../de454442/index.html">So w√§hlen Sie ein Proxy-Netzwerk f√ºr Ihr Unternehmen aus: 3 praktische Tipps</a></li>
<li><a href="../de454444/index.html">Wir profilieren das Laden von Habr oder wie 189 Anfragen auf der Seite Einfluss nehmen</a></li>
<li><a href="../de454446/index.html">Was ist neu in C # 8?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>