<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ô üêä üë®üèæ‚Äç‚öñÔ∏è An√°lise est√°tica no Go: como economizamos tempo ao verificar o c√≥digo üßôüèΩ ü§ôüèΩ üå¨Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Habr. Meu nome √© Sergey Rudachenko, sou especialista t√©cnico na Roistat. Nos √∫ltimos dois anos, nossa equipe traduziu v√°rias partes do projeto em m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>An√°lise est√°tica no Go: como economizamos tempo ao verificar o c√≥digo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/roistat/blog/413175/"><p><img src="https://habrastorage.org/webt/ax/ky/rf/axkyrfxrmccrmh-vbn83run9wpe.jpeg"></p><br><p> Oi Habr.  Meu nome √© Sergey Rudachenko, sou especialista t√©cnico na Roistat.  Nos √∫ltimos dois anos, nossa equipe traduziu v√°rias partes do projeto em microsservi√ßos on Go.  Eles s√£o desenvolvidos por v√°rias equipes, portanto, precisamos definir uma barra de qualidade de c√≥digo r√≠gido.  Para fazer isso, usamos v√°rias ferramentas; neste artigo, focaremos em uma delas - na an√°lise est√°tica. </p><br><p>  A an√°lise est√°tica √© o processo de verificar automaticamente o c√≥digo-fonte usando utilit√°rios especiais.  Este artigo abordar√° seus benef√≠cios, descrever√° brevemente as ferramentas populares e fornecer√° instru√ß√µes para implementa√ß√£o.  Vale a pena ler se voc√™ n√£o encontrou ferramentas semelhantes ou as usou sistematicamente. </p><br><p>  Em artigos sobre esse t√≥pico, o termo "linter" √© frequentemente encontrado.  Para n√≥s, esse √© um nome conveniente para ferramentas simples para an√°lise est√°tica.  A tarefa do linter √© procurar erros simples e design incorreto. </p><a name="habracut"></a><br><h2 id="zachem-nuzhny-lintery">  Por que os linters s√£o necess√°rios? </h2><br><p> Ao trabalhar em equipe, voc√™ provavelmente est√° realizando an√°lises de c√≥digo.  Erros ignorados na revis√£o s√£o poss√≠veis erros.  Perdeu um <code>error</code> n√£o tratado - n√£o receba uma mensagem informativa e voc√™ procurar√° o problema cegamente.  Erro no lan√ßamento do tipo ou virou para o mapa nulo - pior ainda, o bin√°rio cair√° de p√¢nico. </p><br><p>  Os erros descritos acima podem ser adicionados √†s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conven√ß√µes de c√≥digo</a> , mas encontr√°-los ao ler a solicita√ß√£o pull n√£o √© t√£o simples, porque o revisor precisar√° ler o c√≥digo.  Se n√£o houver um compilador em sua cabe√ßa, alguns dos problemas ir√£o para a batalha de qualquer maneira.  Al√©m disso, a busca por pequenos erros distrai a verifica√ß√£o da l√≥gica e da arquitetura.  √Ä dist√¢ncia, o suporte a esse c√≥digo se tornar√° mais caro.  Escrevemos em uma linguagem estaticamente tipada, √© estranho n√£o us√°-la. </p><br><h2 id="populyarnye-instrumenty">  Ferramentas populares </h2><br><p>  A maioria das ferramentas para an√°lise est√°tica usa os pacotes <code>go/ast</code> e <code>go/parser</code> .  Eles fornecem fun√ß√µes para analisar a sintaxe dos arquivos .go.  O encadeamento de execu√ß√£o padr√£o (por exemplo, para o utilit√°rio golint) √© este: </p><br><ul><li>  a lista de arquivos dos pacotes necess√°rios √© carregada </li><li>  <code>parser.ParseFile(...) (*ast.File, error)</code> √© executado para cada arquivo </li><li>  verifica as regras suportadas para cada arquivo ou pacote </li><li>  a verifica√ß√£o passa por cada instru√ß√£o, por exemplo, assim: </li></ul><br><pre> <code class="go hljs">f, err := parser.ParseFile(<span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span>) ast.Walk(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n *ast.Node)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> v := node.(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> *ast.FuncDecl: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> strings.Contains(v.Name, <span class="hljs-string"><span class="hljs-string">"_"</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(<span class="hljs-string"><span class="hljs-string">"wrong function naming"</span></span>) } } }, f)</code> </pre> <br><p>  Al√©m do AST, h√° uma atribui√ß√£o est√°tica √∫nica (SSA).  Essa √© uma maneira mais complexa de analisar c√≥digo que funciona com um encadeamento de execu√ß√£o, em vez de constru√ß√µes de sintaxe.  Neste artigo, n√£o o consideraremos em detalhes, voc√™ pode ler a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> e dar uma olhada no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">exemplo do</a> utilit√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">stackcheck</a> . </p><br><p>  Em seguida, apenas os utilit√°rios populares que executam verifica√ß√µes √∫teis para n√≥s ser√£o considerados. </p><br><h3 id="gofmt">  gofmt </h3><br><p>  Este √© o utilit√°rio padr√£o do pacote go, que verifica a correspond√™ncia de estilos e pode corrigi-lo automaticamente.  A conformidade com o estilo √© um requisito obrigat√≥rio para n√≥s, portanto, a verifica√ß√£o do gofmt est√° inclu√≠da em todos os nossos projetos. </p><br><h3 id="typecheck">  typecheck </h3><br><p>  O Typecheck verifica a correspond√™ncia de tipos no c√≥digo e suporta o fornecedor (diferente do gotype).  Seu lan√ßamento √© necess√°rio para verificar a compila√ß√£o, mas n√£o oferece garantias completas. </p><br><h3 id="go-vet">  v√° ao veterin√°rio </h3><br><p>  O utilit√°rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">go vet</a> faz parte do pacote padr√£o e √© recomendado para uso pela equipe Go.  Verifica v√°rios erros comuns, por exemplo: </p><br><ul><li>  uso indevido de printf e fun√ß√µes similares </li><li>  tags de compila√ß√£o incorretas </li><li>  fun√ß√£o de compara√ß√£o e nada </li></ul><br><h3 id="golint">  golint </h3><br><p>  O Golint √© desenvolvido pela equipe Go e valida o c√≥digo com base nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentos</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Effective Go</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CodeReviewComments</a> .  Infelizmente, n√£o h√° documenta√ß√£o detalhada, mas <a href="">o c√≥digo mostra</a> que o seguinte est√° verificado: </p><br><pre> <code class="go hljs">f.lintPackageComment() f.lintImports() f.lintBlankImports() f.lintExported() f.lintNames() f.lintVarDecls() f.lintElses() f.lintRanges() f.lintErrorf() f.lintErrors() f.lintErrorStrings() f.lintReceiverNames() f.lintIncDec() f.lintErrorReturn() f.lintUnexportedReturn() f.lintTimeNames() f.lintContextKeyTypes() f.lintContextArgs()</code> </pre> <br><h3 id="staticcheck">  staticcheck </h3><br><p>  Os pr√≥prios desenvolvedores apresentam o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">staticcheck</a> como um veterin√°rio aprimorado.  Existem muitas verifica√ß√µes, elas s√£o divididas em grupos: </p><br><ul><li>  uso indevido de bibliotecas padr√£o </li><li>  problemas de multithreading </li><li>  problemas com testes </li><li>  c√≥digo in√∫til </li><li>  problemas de desempenho </li><li>  projetos duvidosos </li></ul><br><h3 id="gosimple">  gosimple </h3><br><p>  √â especialista em encontrar estruturas que valem a pena simplificar, por exemplo: </p><br><p>  <strong>Antes</strong> ( <a href="">c√≥digo fonte golint</a> ) </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f *file)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isMain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ffName.Name == <span class="hljs-string"><span class="hljs-string">"main"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><p>  <strong>Depois</strong> </p><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f *file)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isMain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ffName.Name == <span class="hljs-string"><span class="hljs-string">"main"</span></span> }</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A documenta√ß√£o √©</a> semelhante √† staticcheck e inclui exemplos detalhados. </p><br><h3 id="errcheck">  cheque </h3><br><p>  Erros retornados por fun√ß√µes n√£o podem ser ignorados.  Os motivos est√£o descritos em detalhes no documento vinculativo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Effective Go</a> .  Errcheck n√£o ignora o seguinte c√≥digo: </p><br><pre> <code class="go hljs">json.Unmarshal(text, &amp;val) f, _ := os.OpenFile(<span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span>)</code> </pre> <br><h3 id="gas">  g√°s </h3><br><p>  Localiza vulnerabilidades no c√≥digo: acessos codificados, inje√ß√µes de sql e uso de fun√ß√µes de hash inseguras. </p><br><p>  Exemplos de erros: </p><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//    IP  l, err := net.Listen("tcp", ":2000") //  sql  q := fmt.Sprintf("SELECT * FROM foo where name = '%s'", name) q := "SELECT * FROM foo where name = " + name //     import "crypto/md5"</span></span></code> </pre> <br><h2 id="maligned">  difamado </h2><br><p>  No Go, a ordem dos campos nas estruturas afeta o consumo de mem√≥ria.  Maligno encontra classifica√ß√£o n√£o ideal.  Com esta ordem de campos: </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { a <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> }</code> </pre> <br><p>  A estrutura ocupar√° 32 bits na mem√≥ria devido √† adi√ß√£o de bits vazios ap√≥s os campos a e c. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9b9/3e3/b67/9b93e3b6777d84459548ac9247b4e76f.jpg" alt="imagem"></p><br><p>  Se alterarmos a classifica√ß√£o e colocarmos dois campos bool juntos, a estrutura ter√° apenas 24 bits: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ec5/557/62b/ec555762b87fc61b410675ad4fbd8ac2.jpg" alt="imagem"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Imagem original no stackoverflow</a> </p><br><h3 id="goconst">  goconst </h3><br><p>  Vari√°veis ‚Äã‚Äãm√°gicas no c√≥digo n√£o refletem o significado e complicam a leitura.  O Goconst encontra literais e n√∫meros que aparecem no c√≥digo 2 vezes ou mais.  Observe que muitas vezes at√© um √∫nico uso pode ser um erro. </p><br><h3 id="gocyclo">  gocyclo </h3><br><p>  Consideramos a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">complexidade ciclom√°tica do</a> c√≥digo uma m√©trica importante.  Gocycle mostra complexidade para cada fun√ß√£o.  Somente fun√ß√µes que excedem o valor especificado podem ser exibidas. </p><br><pre> <code class="hljs pgsql">gocyclo -<span class="hljs-keyword"><span class="hljs-keyword">over</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> package/<span class="hljs-type"><span class="hljs-type">name</span></span></code> </pre> <br><p>  Escolhemos um valor limite de 7 para n√≥s mesmos, porque n√£o encontramos um c√≥digo com uma complexidade mais alta que n√£o exigisse refatora√ß√£o. </p><br><h3 id="mertvyy-kod">  C√≥digo morto </h3><br><p>  Existem v√°rios utilit√°rios para encontrar c√≥digo n√£o utilizado; sua funcionalidade pode se sobrepor parcialmente. </p><br><ul><li>  ineffassign: verifica atribui√ß√µes in√∫teis </li></ul><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{} log.Println(res) res, err := loadData() <span class="hljs-comment"><span class="hljs-comment">//  res    return err }</span></span></code> </pre> <br><ul><li>  deadcode: encontra fun√ß√µes n√£o utilizadas </li><li>  unused: localiza fun√ß√µes n√£o utilizadas, mas √© melhor que deadcode </li></ul><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unusedFunc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { formallyUsedFunc() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formallyUsedFunc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { }</code> </pre> <br><p>  Como resultado, o n√£o utilizado apontar√° para as duas fun√ß√µes ao mesmo tempo e o c√≥digo morto apenas para o n√£o utilizadoFunc.  Gra√ßas a isso, o c√≥digo extra √© exclu√≠do em uma passagem.  Tamb√©m n√£o utilizado encontra vari√°veis ‚Äã‚Äãn√£o utilizadas e campos de estrutura. </p><br><ul><li>  varcheck: encontra vari√°veis ‚Äã‚Äãn√£o utilizadas </li><li>  unconvert: encontra convers√µes de tipo in√∫teis </li></ul><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(res) <span class="hljs-comment"><span class="hljs-comment">// unconvert error</span></span></code> </pre> <br><p>  Se n√£o houver tarefa para economizar no tempo necess√°rio para iniciar as verifica√ß√µes, √© melhor execut√°-las todas juntas.  Se for necess√°ria otimiza√ß√£o, recomendo o uso n√£o utilizado e a convers√£o. </p><br><h2 id="kak-eto-vse-udobno-nastroit">  Qu√£o conveniente √© configurar </h2><br><p>  A execu√ß√£o das ferramentas acima em sequ√™ncia √© inconveniente: os erros s√£o emitidos em um formato diferente, a execu√ß√£o leva muito tempo.  A verifica√ß√£o de um de nossos servi√ßos com um tamanho de ~ 8000 linhas de c√≥digo levou mais de dois minutos.  Voc√™ tamb√©m precisar√° instalar os utilit√°rios separadamente. </p><br><p>  Existem utilit√°rios de agrega√ß√£o para resolver esse problema, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">goreporter</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gometalinter</a> .  O Goreporter renderiza o relat√≥rio em html e o gometalinter grava no console. </p><br><p>  O Gometalinter ainda √© usado em alguns projetos grandes (por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">janela de encaixe</a> ).  Ele sabe como instalar todos os utilit√°rios com um √∫nico comando, execut√°-los em paralelo e formatar erros de acordo com o modelo.  O tempo de execu√ß√£o no servi√ßo acima foi reduzido para um minuto e meio. </p><br><p>  A agrega√ß√£o funciona apenas pela coincid√™ncia exata do texto do erro; portanto, erros repetidos s√£o inevit√°veis ‚Äã‚Äãna sa√≠da. </p><br><p>  Em maio de 2018, o projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">golangci-lint</a> apareceu no github, o que supera muito o gometalinter por conveni√™ncia: </p><br><ul><li>  o tempo de execu√ß√£o no mesmo projeto foi reduzido para 16 segundos (8 vezes) </li><li>  quase nenhum erro duplicado </li><li>  limpar configura√ß√£o yaml </li><li>  boa sa√≠da de erro com uma linha de c√≥digo e um ponteiro para um problema <br><img src="https://habrastorage.org/webt/nu/ro/vi/nuroviwafnlgpzkyijvsucjwzme.png"></li><li>  n√£o √© necess√°rio instalar utilit√°rios adicionais </li></ul><br><p>  Agora, o aumento na velocidade √© fornecido com a reutiliza√ß√£o do SSA e do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">loader.Program</a> , no futuro, tamb√©m est√° planejado reutilizar a √°rvore AST, sobre a qual escrevi no in√≠cio da se√ß√£o Ferramentas. </p><br><p>  No momento em que escrevemos este artigo em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hub.docker.com,</a> n√£o havia imagem com documenta√ß√£o; portanto, criamos nossos pr√≥prios, personalizados de acordo com nossas id√©ias sobre conveni√™ncia.  No futuro, a configura√ß√£o ser√° alterada, portanto, para a produ√ß√£o, recomendamos substitu√≠-la pela sua.  Para fazer isso, basta adicionar o arquivo .golangci.yaml ao diret√≥rio raiz do projeto ( <a href="">um exemplo</a> est√° no reposit√≥rio golangci-lint). </p><br><pre> <code class="bash hljs">PACKAGE=package/name docker run --rm -t \ -v $(GOPATH)/src/$(PACKAGE):/go/src/$(PACKAGE) \ -w /go/src/$(PACKAGE) \ roistat/golangci-lint</code> </pre> <br><p>  Este comando pode testar o projeto inteiro.  Por exemplo, se estiver em <code>~/go/src/project</code> , altere o valor da vari√°vel para <code>PACKAGE=project</code> .  A valida√ß√£o funciona recursivamente em todos os pacotes internos. </p><br><p>  Observe que este comando s√≥ funciona corretamente ao usar o fornecedor. </p><br><h1 id="vnedrenie">  Implementa√ß√£o </h1><br><p>  Todos os nossos servi√ßos de desenvolvimento usam docker.  Qualquer projeto √© executado sem o ambiente go instalado.  Para executar os comandos, use o Makefile e adicione o comando lint a ele: </p><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">lint:</span></span> @docker run --rm -t -v $(GOPATH)/src/$(PACKAGE)<span class="hljs-symbol"><span class="hljs-symbol">:/go/src/</span></span>$(PACKAGE) -w /go/src/$(PACKAGE) roistat/golangci-lint</code> </pre> <br><p>  Agora a verifica√ß√£o √© iniciada com este comando: </p><br><pre> <code class="bash hljs">make lint</code> </pre> <br><p>  Existe uma maneira f√°cil de bloquear o c√≥digo com erros ao entrar no mestre - crie um gancho de pr√©-recebimento.  √â adequado se: </p><br><ol><li>  Voc√™ tem um projeto pequeno e poucas depend√™ncias (ou elas est√£o no reposit√≥rio) </li><li>  N√£o √© um problema para voc√™ esperar o comando <code>git push</code> ser conclu√≠do por alguns minutos </li></ol><br><p>  Instru√ß√µes de configura√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gancho</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gitlab</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bitbucket Server</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Github Enterprise</a> . </p><br><p>  Em outros casos, √© melhor usar o IC e proibir o c√≥digo de mesclagem no qual h√° pelo menos um erro.  Fazemos exatamente isso, adicionando o lan√ßamento do linter antes dos testes. </p><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>  A introdu√ß√£o de revis√µes sistem√°ticas reduziu significativamente o per√≠odo de revis√£o.  No entanto, outra coisa √© mais importante: agora podemos discutir o cen√°rio geral e a arquitetura na maioria das vezes.  Isso permite que voc√™ pense sobre o desenvolvimento do projeto em vez de fazer buracos. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413175/">https://habr.com/ru/post/pt413175/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413165/index.html">Explica√ß√£o SRTP</a></li>
<li><a href="../pt413167/index.html">Como integrar o Zimbra com um sistema DLP?</a></li>
<li><a href="../pt413169/index.html">M√©todos √∫teis de matriz e objeto em JavaScript</a></li>
<li><a href="../pt413171/index.html">Tokamak JET lan√ßa nova campanha de deut√©rio e tr√≠tio</a></li>
<li><a href="../pt413173/index.html">Monitorando erros de JavaScript com window.onerror</a></li>
<li><a href="../pt413177/index.html">Eventos digitais em Moscou, de 4 a 10 de junho</a></li>
<li><a href="../pt413181/index.html">Quando chamadas de fun√ß√£o externas s√£o mais r√°pidas que chamadas C nativas</a></li>
<li><a href="../pt413183/index.html">Mem√≥ria persistente Optane DC - Optane no formato DIMM</a></li>
<li><a href="../pt413185/index.html">Jogo sujo, ou como os organizadores do sorteio nos enganam</a></li>
<li><a href="../pt413187/index.html">Entrevista com Ryan Dahl, criador do Node.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>