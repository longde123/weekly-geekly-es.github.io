<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏼‍🤝‍🧑🏼 🤘🏼 🅰️ Avez-vous vraiment besoin d'une autorisation de confier ou de laravel pour mettre en œuvre votre autorisation? 💴 🥧 🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="«Alors… j'ai besoin d'une simple autorisation. Une sorte de rôle d'administrateur, et peut-être le rôle d'éditeur / modérateur. Maintenant, google. Oh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Avez-vous vraiment besoin d'une autorisation de confier ou de laravel pour mettre en œuvre votre autorisation?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426799/"> «Alors… j'ai besoin d'une simple autorisation.  Une sorte de rôle d'administrateur, et peut-être le rôle d'éditeur / modérateur.  Maintenant, google.  Oh!  Il existe déjà des packages prêts à l'emploi pour laravel!  <b>zizaco / confiez</b> , <b>spatie / laravel-permission</b> et autres!  Choisissons-en! » <br><br>  C’est comme ça que tout se passe.  Ensuite, la migration du package ajoute 5 étiquettes à la base de données pour stocker les rôles, les autorisations et leurs relations.  Toutes les règles d'autorisation, telles que les rôles <b>'admin'</b> et <b>'éditeur'</b> peuvent faire <b>'éditer les publications'</b> , sont stockées dans ces tableaux.  En règle générale, un projet possède de nombreuses copies de la base de données.  Copies des développeurs, base (s) de test et production.  Par conséquent, toutes ces règles d'autorisation sont forcées de se synchroniser entre les bases de données. <br><br><a name="habracut"></a>  J'ai rencontré quelques projets où il y avait une copie principale des règles dans la base de données de production et le reste a tout copié à partir de là. <br><br>  L'idée d'utiliser la classe Seeder ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemple</a> ) est bien meilleure.  Vous avez juste besoin de courir <br><br> <code>php artisan db:seed AuthSeeder</code> <br> <br>  et vous avez la dernière version des règles dans la base de données.  Ainsi, cette classe de semoir devient une sorte de source unique de vérité.  Bien, mais cette approche présente encore de nombreux inconvénients: <br><br><ul><li>  Seeder doit être suffisamment intelligent pour non seulement créer des rôles et des autorisations et les connexions entre eux, mais également synchroniser les anciennes versions.  C'est-à-dire  supprimez ou créez des liens entre les rôles et les autorisations si nécessaire. </li><li>  Les règles sont stockées dans la base de données et une synchronisation constante entre elles est requise.  Chaque changement de l'exigence du formulaire «les éditeurs ne devraient plus éditer les articles, seulement les publier» entraîne un changement dans le semoir, la synchronisation de la base de code via un git ou quelque chose, et «N'OUBLIEZ PAS DE DÉMARRER AuthSeeder!» </li><li>  Les règles d'autorisation peuvent être complexes.  Par exemple, une publication peut être éditée non seulement par des éditeurs ou des administrateurs, mais aussi par l'auteur de cette publication.  Par conséquent, au lieu d'un simple middleware: </li></ul><br><pre> <code class="php hljs">[<span class="hljs-string"><span class="hljs-string">'middleware'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'permission:edit posts'</span></span>]]</code> </pre> <br>  les développeurs doivent utiliser l'autorisation laravel standard: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostPolicy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">edit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User $user, Post $post)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $user-&gt;id == $post-&gt;owner_id || $user-&gt;hasPermissionTo(<span class="hljs-string"><span class="hljs-string">'edit posts'</span></span>); } }</code> </pre><br><h4>  Alors peut-être que le moyen le plus simple n'est pas le meilleur? </h4><br>  Cela semble simple: mettez le package, exécutez la migration terminée et c'est parti.  Du point de vue d'un soutien de projet à long terme, ce n'est pas le meilleur choix. <br><br>  Essayons d'analyser de quels projets ont généralement besoin?  Système de jeu de rôle simple.  Presque toujours un rôle par utilisateur.  Administrateur  Eh bien, peut-être un autre éditeur ou modérateur.  Et ces rôles ont des autorisations.  Allons le chemin le plus direct!  Ajoutez un nouveau champ à la table des utilisateurs!  <b>is_admin</b> ou <b>role</b> .  Ensuite, quelques assistants pour la classe <b>User</b> : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAdmin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{...} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isEditor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{...} }</code> </pre> <br>  Maintenant, permishen.  Laravel fournit deux méthodes de base pour les décrire: les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">portes</a> et les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">politiques</a> .  Je vais utiliser des portes (il y a encore un petit truc avec une fonction dans une variable, mais pour les amateurs de programmation fonctionnelle ce n'est pas du tout un truc): <br><br><pre> <code class="php hljs"> $isAdmin = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User $user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $user-&gt;isAdmin(); } $isEditorOrAdmin = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User $user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $user-&gt;isAdmin() || $user-&gt;isEditor(); } Gate::define(<span class="hljs-string"><span class="hljs-string">'foo-permission'</span></span>, $isAdmin); Gate::define(<span class="hljs-string"><span class="hljs-string">'bar-permission'</span></span>, $isAdmin); Gate::define(<span class="hljs-string"><span class="hljs-string">'editor-permission'</span></span>, $isEditorOrAdmin); <span class="hljs-comment"><span class="hljs-comment">// Complex permission Gate::define('edit-post', function(User $user, Post $post) { return $user-&gt;id == $post-&gt;owner_id || $user-&gt;isAdmin(); });</span></span></code> </pre> <br>  Si le projet a besoin de plusieurs rôles par utilisateur, ajoutez simplement la table <b>user_roles</b> et modifiez les assistants de la classe <b>User</b> .  Le contenu de la classe seeder pour les packages * trust et cette autorisation basée sur le code sont presque identiques!  Mais les règles sont désormais simplement stockées dans le code et il n'est pas nécessaire de les synchroniser en permanence dans les bases de données. <br><br>  Je ne veux pas dire que ces packages sont inutiles.  Cette approche est très utile dans les projets avec un système d'autorisation complexe, où le client lui-même souhaite configurer les rôles ultérieurement.  Il existe également des projets avec des autorisations dynamiques.  Exemple: forum avec sous-forums.  Chaque sous-forum peut avoir ses propres modérateurs, chaque modérateur a des droits définis par l'administrateur dans ce sous-forum.  Un autre exemple est le télégramme et ses groupes.  C'est la même chose.  De tels projets ont vraiment besoin d'un système d'autorisation complexe, stocké dans la base de données, avec tous ses problèmes.  Mais la plupart des autres ne le font pas. <br><br>  La situation avec les packages pour laravel devient similaire à la situation avec les composants pour Delphi (les personnes âgées s'en souviennent).  Ils ont mis les paquets sans hésitation - vraiment nécessaires ou non. <br><br><blockquote>  Donc, je devrais calculer $ a + $ b dans mon projet ici.  Existe-t-il un package Laravel-Sum? </blockquote><br>  PS Je m'excuse pour les autorisations, mais je n'ai pas trouvé une bonne traduction précise. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426799/">https://habr.com/ru/post/fr426799/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426785/index.html">Comment LIGO peut-il voir les ondes gravitationnelles si dans la lumière GRT s'étend le long de l'espace?</a></li>
<li><a href="../fr426787/index.html">3 compétences clés d'un gestionnaire de réussite client efficace</a></li>
<li><a href="../fr426791/index.html">Comment créer une architecture informatique dans une entreprise à l'aide de SAP Enterprise Architecture Designer</a></li>
<li><a href="../fr426793/index.html">DotNext - il y a d'autres héros</a></li>
<li><a href="../fr426797/index.html">Réseau de neurones utilisant TensorFlow: classification d'images</a></li>
<li><a href="../fr426803/index.html">Un aperçu des techniques d'adaptation de domaine approfondi de base (partie 1)</a></li>
<li><a href="../fr426805/index.html">Amortisseurs, roulements de roue, freins, moteurs électriques - futures sources de chaleur pour les voitures électriques?</a></li>
<li><a href="../fr426807/index.html">Écriture du système d'exploitation: multitâche</a></li>
<li><a href="../fr426809/index.html">Zeev Surasky: L'avenir du moteur et du framework Zend</a></li>
<li><a href="../fr426811/index.html">Parkour, danse et travaux de construction de Boston Dynamics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>