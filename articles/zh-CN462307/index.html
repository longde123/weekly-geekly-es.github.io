<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤´ ğŸ¡ ğŸ£ ä½¿ç”¨ReactiveUIå’ŒAvaloniaåœ¨è·¨å¹³å°.NET Core GUIåº”ç”¨ç¨‹åºä¸­å°†è·¯ç”±çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ âš¾ï¸ ğŸ‘©ğŸ»â€ğŸ³ ğŸ¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç°ä»£ä¼ä¸šåº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢éå¸¸å¤æ‚ã€‚ ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ‚¨é€šå¸¸éœ€è¦å®ç°åº”ç”¨å†…å¯¼èˆªï¼ŒéªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œæ ¹æ®ç”¨æˆ·åå¥½æ˜¾ç¤ºæˆ–éšè—å±å¹•ã€‚ ä¸ºäº†è·å¾—æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºåº”èƒ½å¤Ÿåœ¨åº”ç”¨ç¨‹åºæŒ‚èµ·æ—¶å°†çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ï¼Œå¹¶åœ¨åº”ç”¨ç¨‹åºæ¢å¤æ—¶æ¢å¤çŠ¶æ€ã€‚ 


 ReactiveUIæä¾›çš„åŠŸèƒ½å…è®¸æ‚¨åœ¨åº”ç”¨å…³é—­æˆ–æŒ‚èµ·æ—¶é€šè¿‡åºåˆ—åŒ–...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨ReactiveUIå’ŒAvaloniaåœ¨è·¨å¹³å°.NET Core GUIåº”ç”¨ç¨‹åºä¸­å°†è·¯ç”±çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462307/"><p><img src="https://habrastorage.org/webt/tu/lv/gl/tulvgli1xkcq1jqef9m91o_caxe.png" alt="å›¾ç‰‡"></p><br><p> ç°ä»£ä¼ä¸šåº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢éå¸¸å¤æ‚ã€‚ ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ‚¨é€šå¸¸éœ€è¦å®ç°åº”ç”¨å†…å¯¼èˆªï¼ŒéªŒè¯ç”¨æˆ·è¾“å…¥ï¼Œæ ¹æ®ç”¨æˆ·åå¥½æ˜¾ç¤ºæˆ–éšè—å±å¹•ã€‚ ä¸ºäº†è·å¾—æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºåº”èƒ½å¤Ÿåœ¨åº”ç”¨ç¨‹åºæŒ‚èµ·æ—¶å°†çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ï¼Œå¹¶åœ¨åº”ç”¨ç¨‹åºæ¢å¤æ—¶æ¢å¤çŠ¶æ€ã€‚ </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUI</a>æä¾›çš„åŠŸèƒ½å…è®¸æ‚¨åœ¨åº”ç”¨å…³é—­æˆ–æŒ‚èµ·æ—¶é€šè¿‡åºåˆ—åŒ–è§†å›¾æ¨¡å‹æ ‘æ¥ä¿æŒåº”ç”¨çŠ¶æ€ã€‚ æš‚åœäº‹ä»¶å› å¹³å°è€Œå¼‚ã€‚  ReactiveUIå¯¹WPFä½¿ç”¨<code>Exit</code>äº‹ä»¶ï¼Œå¯¹Xamarin.Androidä½¿ç”¨<code>ActivityPaused</code>å¯¹äº<code>DidEnterBackground</code>ä½¿ç”¨DidEnterBackgroundï¼Œå¯¹äºUWPä½¿ç”¨<code>OnLaunched</code> ã€‚ </p><br><p> åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºæ¼”ç¤º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUI Suspension</a>åŠŸèƒ½ä¸<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avalonia</a> ï¼ˆåŸºäºè·¨å¹³å°.NET Core XAMLçš„GUIæ¡†æ¶ï¼‰çš„ç»“åˆä½¿ç”¨ã€‚ åœ¨é˜…è¯»æœ¬è¯´æ˜ä¹‹å‰ï¼Œæ‚¨åº”è¯¥å…ˆç†Ÿæ‚‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">MVVMæ¨¡å¼</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">å“åº”å¼æ‰©å±•</a> ã€‚ å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Windows 10æˆ–Ubuntu 18å¹¶ä¸”å®‰è£…äº†.NET Core SDKï¼Œåˆ™æœ¬æ•™ç¨‹ä¸­æè¿°çš„æ­¥éª¤åº”è¯¥å¯ä»¥ä½¿ç”¨ã€‚ è®©æˆ‘ä»¬å¼€å§‹å§ï¼ </p><a name="habracut"></a><br><h2 id="bootstrapping-the-project"> å¼•å¯¼é¡¹ç›® </h2><br><p> è‹¥è¦æŸ¥çœ‹å®é™…çš„ReactiveUIè·¯ç”±ï¼Œæˆ‘ä»¬åŸºäºAvaloniaåº”ç”¨ç¨‹åºæ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„.NET Coreé¡¹ç›®ã€‚ ç„¶åï¼Œæˆ‘ä»¬å®‰è£…<code>Avalonia.ReactiveUI</code>è½¯ä»¶åŒ…ã€‚ è¯¥è½¯ä»¶åŒ…æä¾›äº†ç‰¹å®šäºå¹³å°çš„Avaloniaç”Ÿå‘½å‘¨æœŸæŒ‚é’©ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">è·¯ç”±</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ¿€æ´»</a>åŸºç¡€ç»“æ„ã€‚ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¹‹å‰ï¼Œè¯·è®°ä½å®‰è£…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">.NET Core</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">git</a> ã€‚ </p><br><pre> <code class="plaintext hljs">git clone https://github.com/AvaloniaUI/avalonia-dotnet-templates git --git-dir ./avalonia-dotnet-templates/.git checkout 9263c6b dotnet new --install ./avalonia-dotnet-templates dotnet new avalonia.app -o ReactiveUI.Samples.Suspension cd ./ReactiveUI.Samples.Suspension dotnet add package Avalonia.ReactiveUI dotnet add package Avalonia.Desktop dotnet add package Avalonia</code> </pre> <br><p> è®©æˆ‘ä»¬è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼Œå¹¶ç¡®ä¿å®ƒæ˜¾ç¤ºä¸€ä¸ªæ˜¾ç¤ºâ€œæ¬¢è¿ä½¿ç”¨Avaloniaï¼â€çš„çª—å£ã€‚ </p><br><pre> <code class="plaintext hljs"># Use .NET Core version which you have installed. # It can be netcoreapp2.0, netcoreapp2.1 and so on. dotnet run --framework netcoreapp3.0</code> </pre> <br><p><img src="https://habrastorage.org/webt/bn/84/7b/bn847bgygv5j5awbdb_0pvipoyq.png" alt="å›¾ç‰‡"></p><br><h2 id="installing-avalonia-preview-builds-from-myget"> ä»MyGetå®‰è£…Avaloniaé¢„è§ˆç‰ˆ </h2><br><p> æ¯æ¬¡å°†æ–°æäº¤æäº¤åˆ°GitHubä¸Š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avaloniaå­˜å‚¨åº“</a>çš„<code>master</code>åˆ†æ”¯æ—¶ï¼Œæœ€æ–°çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avalonia</a>è½¯ä»¶åŒ…å°±ä¼šå‘å¸ƒåˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">MyGet</a> ã€‚ è¦åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨MyGetçš„æœ€æ–°è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>nuget.config</code></a>æ–‡ä»¶ã€‚ ä½†æ˜¯åœ¨æ‰§è¡Œæ­¤æ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">.NET Core CLI</a>ä¸ºå…ˆå‰åˆ›å»ºçš„é¡¹ç›®ç”Ÿæˆä¸€ä¸ª<code>sln</code>æ–‡ä»¶ï¼š </p><br><pre> <code class="plaintext hljs">dotnet new sln # Ctrl+C dotnet sln ReactiveUI.Samples.Suspension.sln add ReactiveUI.Samples.Suspension.csproj</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»ºå…·æœ‰ä»¥ä¸‹å†…å®¹çš„<code>nuget.config</code>æ–‡ä»¶ï¼š </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packageSources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AvaloniaCI"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.myget.org/F/avalonia-ci/api/v2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packageSources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> é€šå¸¸ï¼Œéœ€è¦é‡æ–°å¯åŠ¨ä»¥å¼ºåˆ¶æˆ‘ä»¬çš„IDEä»æ–°æ·»åŠ çš„MyGet feedä¸­æ£€æµ‹åŒ…ï¼Œä½†æ˜¯é‡æ–°åŠ è½½è§£å†³æ–¹æ¡ˆä¹Ÿåº”è¯¥æœ‰æ‰€å¸®åŠ©ã€‚ ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨NuGetåŒ…ç®¡ç†å™¨GUIæˆ–.NET Core CLIå°†AvaloniaåŒ…å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆæˆ–è‡³å°‘å‡çº§åˆ°<code>0.9.1</code> ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">dotnet add package Avalonia.ReactiveUI --version 0.9.1 dotnet add package Avalonia.Desktop --version 0.9.1 dotnet add package Avalonia --version 0.9.1 cat ReactiveUI.Samples.Suspension.csproj</code> </pre> <br><p>  <code>ReactiveUI.Samples.Suspension.csproj</code>æ–‡ä»¶ç°åœ¨åº”å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Sdk</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.NET.Sdk"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputType</span></span></span><span class="hljs-tag">&gt;</span></span>WinExe<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span>netcoreapp3.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Compile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Update</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"**\*.xaml.cs"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DependentUpon</span></span></span><span class="hljs-tag">&gt;</span></span>%(Filename)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DependentUpon</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Compile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AvaloniaResource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"**\*.xaml"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SubType</span></span></span><span class="hljs-tag">&gt;</span></span>Designer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SubType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AvaloniaResource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Avalonia"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.9.1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Avalonia.Desktop"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.9.1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Avalonia.ReactiveUI"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.9.1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­åˆ›å»ºäº†ä¸¤ä¸ªæ–°æ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«åä¸º<code>Views/</code>å’Œ<code>ViewModels/</code> ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†<code>MainWindow</code>ç±»é‡å‘½åä¸º<code>MainView</code>å¹¶å°†å…¶ç§»åŠ¨åˆ°<code>Views/</code>æ–‡ä»¶å¤¹ã€‚ è¯·è®°ä½åœ¨ç›¸åº”çš„XAMLæ–‡ä»¶ä¸­é‡å‘½åå¯¹å·²ç¼–è¾‘ç±»çš„å¼•ç”¨ï¼Œå¦åˆ™ï¼Œè¯¥é¡¹ç›®å°†æ— æ³•ç¼–è¯‘ã€‚ å¦å¤–ï¼Œè¯·è®°ä½å°†<code>MainView</code>çš„å‘½åç©ºé—´æ›´æ”¹ä¸º<code>ReactiveUI.Samples.Suspension.Views</code>ä»¥ä¿æŒä¸€è‡´æ€§ã€‚ ç„¶åï¼Œæˆ‘ä»¬ç¼–è¾‘å¦å¤–ä¸¤ä¸ªæ–‡ä»¶<code>Program.cs</code>å’Œ<code>App.xaml.cs</code> æˆ‘ä»¬å‘<code>UseReactiveUI</code>åº”ç”¨æ„å»ºå™¨æ·»åŠ äº†å¯¹<code>UseReactiveUI</code>çš„è°ƒç”¨ï¼Œå°†åº”ç”¨åˆå§‹åŒ–ä»£ç ç§»è‡³<code>OnFrameworkInitializationCompleted</code>æ–¹æ³•ä»¥ç¬¦åˆ<code>OnFrameworkInitializationCompleted</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</a>å‡†åˆ™ï¼š </p><br><p>  <strong>Program.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-comment"><span class="hljs-comment">// The entry point. Things aren't ready yet, so at this point // you shouldn't use any Avalonia types or anything that // expects a SynchronizationContext to be ready. public static void Main(string[] args) =&gt; BuildAvaloniaApp() .StartWithClassicDesktopLifetime(args); // This method is required for IDE previewer infrastructure. // Don't remove, otherwise, the visual designer will break. public static AppBuilder BuildAvaloniaApp() =&gt; AppBuilder.Configure&lt;App&gt;() .UseReactiveUI() // required! .UsePlatformDetect() .LogToDebug(); }</span></span></code> </pre> <br><p>  <strong>App.xaml.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span> : <span class="hljs-title"><span class="hljs-title">Application</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; AvaloniaXamlLoader.Load(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-comment"><span class="hljs-comment">// The entrypoint for your application. Here you initialize your // MVVM framework, DI container and other components. You can use // the ApplicationLifetime property here to detect if the app // is running on a desktop platform or on a mobile platform (WIP). public override void OnFrameworkInitializationCompleted() { new Views.MainView().Show(); base.OnFrameworkInitializationCompleted(); } }</span></span></code> </pre> <br><p> åœ¨å°è¯•æ„å»ºé¡¹ç›®ä¹‹å‰ï¼Œæˆ‘ä»¬ç¡®ä¿<code>using Avalonia.ReactiveUI</code>æŒ‡ä»¤å·²æ·»åŠ åˆ°<code>Program.cs</code>æ–‡ä»¶çš„é¡¶éƒ¨ã€‚ æˆ‘ä»¬çš„IDEå¾ˆå¯èƒ½å·²ç»å¯¼å…¥äº†è¯¥åç§°ç©ºé—´ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰å¯¼å…¥ï¼Œæˆ‘ä»¬å°†æ”¶åˆ°ç¼–è¯‘æ—¶é”™è¯¯ã€‚ æœ€åï¼Œæ˜¯æ—¶å€™ç¡®ä¿åº”ç”¨ç¨‹åºå¯ä»¥ç¼–è¯‘ï¼Œè¿è¡Œå¹¶æ˜¾ç¤ºæ–°çª—å£ï¼š </p><br><pre> <code class="plaintext hljs">dotnet run --framework netcoreapp2.1</code> </pre> <br><p><img src="https://habrastorage.org/webt/bn/84/7b/bn847bgygv5j5awbdb_0pvipoyq.png" alt="å›¾ç‰‡"></p><br><h2 id="cross-platform-reactiveui-routing"> è·¨å¹³å°çš„ReactiveUIè·¯ç”± </h2><br><p> åœ¨è·¨å¹³å°çš„.NETåº”ç”¨ç¨‹åºä¸­ç»„ç»‡åº”ç”¨å†…å¯¼èˆªçš„ä¸€èˆ¬æ–¹æ³•æœ‰ä¸¤ç§ï¼šè§†å›¾ä¼˜å…ˆå’Œè§†å›¾æ¨¡å‹ä¼˜å…ˆã€‚ å‰ä¸€ç§æ–¹æ³•å‡å®šViewå±‚ç®¡ç†å¯¼èˆªå †æ ˆ-ä¾‹å¦‚ï¼Œä½¿ç”¨å¹³å°ç‰¹å®šçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Frame</a>å’Œ<a href="" rel="nofollow">Page</a>ç±»ã€‚ ä½¿ç”¨åä¸€ç§æ–¹æ³•ï¼Œè§†å›¾æ¨¡å‹å±‚å°†é€šè¿‡ä¸å¹³å°æ— å…³çš„æŠ½è±¡æ¥å¤„ç†å¯¼èˆªã€‚ å»ºç«‹ReactiveUIå·¥å…·æ—¶è¦ç‰¢è®°è§†å›¾æ¨¡å‹ä¼˜å…ˆçš„æ–¹æ³•ã€‚  ReactiveUIè·¯ç”±åŒ…å«ä¸€ä¸ª<code>IScreen</code>å®ç°ï¼Œè¯¥å®ç°åŒ…å«å½“å‰è·¯ç”±çŠ¶æ€ï¼Œå‡ ä¸ª<code>IRoutableViewModel</code>å®ç°ä»¥åŠä¸€ä¸ªç§°ä¸º<code>RoutedViewHost</code>çš„ç‰¹å®šäºå¹³å°çš„XAMLæ§ä»¶ã€‚ </p><br><p><img width="600" src="https://habrastorage.org/webt/4s/7a/6_/4s7a6_gsiixrbgx3h5kf7leezcw.png"><br></p><br><p>  <code>RoutingState</code>å¯¹è±¡å°è£…äº†å¯¼èˆªå †æ ˆç®¡ç†ã€‚  <code>IScreen</code>æ˜¯å¯¼èˆªçš„æ ¹ç›®å½•ï¼Œä½†æ˜¯å°½ç®¡æœ‰åç§°ï¼Œå®ƒä¹Ÿä¸å¿…å æ®æ•´ä¸ªå±å¹•ã€‚  <code>RoutedViewHost</code>å¯¹ç»‘å®šçš„<code>RoutingState</code>ä¸­çš„æ›´æ”¹åšå‡ºååº”ï¼Œå¹¶ä¸ºå½“å‰é€‰æ‹©çš„<code>IRoutableViewModel</code>åµŒå…¥é€‚å½“çš„è§†å›¾ã€‚ ç¨åå°†é€šè¿‡æ›´å…¨é¢çš„ç¤ºä¾‹æ¥è¯´æ˜æ‰€æè¿°çš„åŠŸèƒ½ã€‚ </p><br><h2 id="persisting-view-model-state"> æŒä¹…åŒ–è§†å›¾æ¨¡å‹çŠ¶æ€ </h2><br><p> ä»¥æœç´¢å±å¹•è§†å›¾æ¨¡å‹ä¸ºä¾‹ã€‚ </p><br><p><img width="400" src="https://habrastorage.org/webt/ki/tk/o4/kitko4krrwapat8y9_bm0kcobky.png"><br></p><br><p> æˆ‘ä»¬å°†å†³å®šåœ¨åº”ç”¨ç¨‹åºå…³é—­æ—¶ä¿å­˜å“ªäº›è§†å›¾æ¨¡å‹å±æ€§ï¼Œä»¥åŠé‡æ–°åˆ›å»ºå“ªäº›å±æ€§ã€‚ æ— éœ€ä¿å­˜å®ç°<code>ICommand</code>æ¥å£çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ååº”å¼å‘½ä»¤</a>çš„çŠ¶æ€ã€‚  <code>ReactiveCommand&lt;TIn, TOut&gt;</code>ç±»é€šå¸¸åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ï¼Œå…¶<code>CanExecute</code>æŒ‡ç¤ºç¬¦é€šå¸¸å®Œå…¨å–å†³äºè§†å›¾æ¨¡å‹å±æ€§ï¼Œå¹¶ä¸”æ¯å½“è¿™äº›å±æ€§ä¸­çš„ä»»ä½•ä¸€ä¸ªæ›´æ”¹æ—¶éƒ½ä¼šé‡æ–°è®¡ç®—ã€‚ æ˜¯å¦ä¿ç•™æœç´¢ç»“æœæ˜¯æœ‰äº‰è®®çš„ï¼Œä½†æ˜¯ä¿å­˜æœç´¢æŸ¥è¯¢æ˜¯ä¸ªå¥½ä¸»æ„ã€‚ </p><br><p>  <strong>ViewModels / SearchViewModel.cs</strong> </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DataContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SearchViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveObject</span></span>, <span class="hljs-title"><span class="hljs-title">IRoutableViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ReactiveCommand&lt;Unit, Unit&gt; _search; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _searchQuery; <span class="hljs-comment"><span class="hljs-comment">// We inject the IScreen implementation via the constructor. // If we receive null, we use Splat.Locator to resolve the // default implementation. The parameterless constructor is // required for the deserialization feature to work. public SearchViewModel(IScreen screen = null) { HostScreen = screen ?? Locator.Current.GetService&lt;IScreen&gt;(); // Each time the search query changes, we check if the search // query is empty. If it is, we disable the command. var canSearch = this .WhenAnyValue(x =&gt; x.SearchQuery) .Select(query =&gt; !string.IsNullOrWhiteSpace(query)); // Buttons bound to the command will stay disabled // as long as the command stays disabled. _search = ReactiveCommand.CreateFromTask( () =&gt; Task.Delay(1000), // emulate a long-running operation canSearch); } public IScreen HostScreen { get; } public string UrlPathSegment =&gt; "/search"; public ICommand Search =&gt; _search; [DataMember] public string SearchQuery { get =&gt; _searchQuery; set =&gt; this.RaiseAndSetIfChanged(ref _searchQuery, value); } }</span></span></code> </pre> <br><p> æˆ‘ä»¬ä½¿ç”¨<code>[DataContract]</code>å±æ€§æ ‡è®°æ•´ä¸ªè§†å›¾æ¨¡å‹ç±»ï¼Œå¹¶ä½¿ç”¨<code>[DataMember]</code>å±æ€§æ³¨é‡Šè¦åºåˆ—åŒ–çš„å±æ€§ã€‚ å¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨é€‰æ‹©å¯ç”¨åºåˆ—åŒ–æ¨¡å¼ï¼Œè¿™å°±è¶³å¤Ÿäº†ã€‚ è€ƒè™‘åˆ°åºåˆ—åŒ–æ¨¡å¼ï¼Œé€‰æ‹©é€€å‡ºæ„å‘³ç€å°†å¯¹æ‰€æœ‰å…¬å…±å­—æ®µå’Œå±æ€§è¿›è¡Œåºåˆ—åŒ–ï¼Œé™¤éæ‚¨é€šè¿‡ä½¿ç”¨<code>[IgnoreDataMember]</code>å±æ€§è¿›è¡Œæ³¨é‡Šæ¥æ˜¾å¼å¿½ç•¥å®ƒä»¬ï¼Œå¦åˆ™é€‰æ‹©é€€å‡ºåˆ™ç›¸åã€‚ å¦å¤–ï¼Œæˆ‘ä»¬åœ¨è§†å›¾æ¨¡å‹ç±»ä¸­å®ç°<code>IRoutableViewModel</code>æ¥å£ã€‚ åœ¨å°†è§†å›¾æ¨¡å‹ç”¨ä½œå¯¼èˆªå †æ ˆçš„ä¸€éƒ¨åˆ†æ—¶ï¼Œè¿™æ˜¯å¿…éœ€çš„ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ç™»å½•è§†å›¾æ¨¡å‹çš„å®ç°ç»†èŠ‚</b> <div class="spoiler_text"><p>  <strong>ViewModels / LoginViewModel.cs</strong> </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DataContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LoginViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveObject</span></span>, <span class="hljs-title"><span class="hljs-title">IRoutableViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ReactiveCommand&lt;Unit, Unit&gt; _login; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _password; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _username; <span class="hljs-comment"><span class="hljs-comment">// We inject the IScreen implementation via the constructor. // If we receive null, we use Splat.Locator to resolve the // default implementation. The parameterless constructor is // required for the deserialization feature to work. public LoginViewModel(IScreen screen = null) { HostScreen = screen ?? Locator.Current.GetService&lt;IScreen&gt;(); // When any of the specified properties change, // we check if user input is valid. var canLogin = this .WhenAnyValue( x =&gt; x.Username, x =&gt; x.Password, (user, pass) =&gt; !string.IsNullOrWhiteSpace(user) &amp;&amp; !string.IsNullOrWhiteSpace(pass)); // Buttons bound to the command will stay disabled // as long as the command stays disabled. _login = ReactiveCommand.CreateFromTask( () =&gt; Task.Delay(1000), // emulate a long-running operation canLogin); } public IScreen HostScreen { get; } public string UrlPathSegment =&gt; "/login"; public ICommand Login =&gt; _login; [DataMember] public string Username { get =&gt; _username; set =&gt; this.RaiseAndSetIfChanged(ref _username, value); } // Note: Saving passwords to disk isn't a good idea. public string Password { get =&gt; _password; set =&gt; this.RaiseAndSetIfChanged(ref _password, value); } }</span></span></code> </pre> </div></div><br><p> è¿™ä¸¤ä¸ªè§†å›¾æ¨¡å‹å®ç°äº†<code>IRoutableViewModel</code>æ¥å£ï¼Œå¹¶å‡†å¤‡åµŒå…¥åˆ°å¯¼èˆªå±å¹•ä¸­ã€‚ ç°åœ¨æ˜¯æ—¶å€™å®ç°<code>IScreen</code>æ¥å£äº†ã€‚ åŒæ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>[DataContract]</code>å±æ€§æ¥æŒ‡ç¤ºè¦åºåˆ—åŒ–çš„éƒ¨åˆ†å’Œè¦å¿½ç•¥çš„éƒ¨åˆ†ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ <code>RoutingState</code>å±æ€§è®¾ç½®å™¨è¢«æ•…æ„å£°æ˜ä¸º<code>RoutingState</code>è¿™å…è®¸æˆ‘ä»¬çš„åºåˆ—åŒ–ç¨‹åºåœ¨ååºåˆ—åŒ–æ—¶ä¿®æ”¹å±æ€§ã€‚ </p><br><p>  <strong>ViewModels / MainViewModel.cs</strong> </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DataContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveObject</span></span>, <span class="hljs-title"><span class="hljs-title">IScreen</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ReactiveCommand&lt;Unit, Unit&gt; _search; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ReactiveCommand&lt;Unit, Unit&gt; _login; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RoutingState _router = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RoutingState(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainViewModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// If the authorization page is currently shown, then // we disable the "Open authorization view" button. var canLogin = this .WhenAnyObservable(x =&gt; x.Router.CurrentViewModel) .Select(current =&gt; !(current is LoginViewModel)); _login = ReactiveCommand.Create( () =&gt; { Router.Navigate.Execute(new LoginViewModel()); }, canLogin); // If the search screen is currently shown, then we // disable the "Open search view" button. var canSearch = this .WhenAnyObservable(x =&gt; x.Router.CurrentViewModel) .Select(current =&gt; !(current is SearchViewModel)); _search = ReactiveCommand.Create( () =&gt; { Router.Navigate.Execute(new SearchViewModel()); }, canSearch); } [DataMember] public RoutingState Router { get =&gt; _router; set =&gt; this.RaiseAndSetIfChanged(ref _router, value); } public ICommand Search =&gt; _search; public ICommand Login =&gt; _login; }</span></span></code> </pre> <br><p> åœ¨æˆ‘ä»¬çš„ä¸»è§†å›¾æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬ä»…å°†ä¸€ä¸ªå­—æ®µä¿å­˜åˆ°ç£ç›˜ä¸Šï¼Œå³ä¸€ä¸ªç±»å‹ä¸º<code>RoutingState</code>å­—æ®µã€‚ æˆ‘ä»¬ä¸å¿…ä¿å­˜ååº”å¼å‘½ä»¤çš„çŠ¶æ€ï¼Œå› ä¸ºå®ƒä»¬çš„å¯ç”¨æ€§å®Œå…¨å–å†³äºè·¯ç”±å™¨çš„å½“å‰çŠ¶æ€å¹¶è¿›è¡Œååº”å¼æ›´æ”¹ã€‚ ä¸ºäº†èƒ½å¤Ÿå°†è·¯ç”±å™¨è¿˜åŸåˆ°å®ƒæ‰€å¤„çš„ç¡®åˆ‡çŠ¶æ€ï¼Œåœ¨å¯¹è·¯ç”±å™¨è¿›è¡Œåºåˆ—åŒ–æ—¶ï¼Œæˆ‘ä»¬åŒ…æ‹¬<code>IRoutableViewModel</code>å®ç°çš„æ‰©å±•ç±»å‹ä¿¡æ¯ã€‚ ç¨åæˆ‘ä»¬å°†ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Newtonsoft.Jsonçš„</a> <code>TypenameHandling.All</code>è®¾ç½®æ¥å®ç°ã€‚ æˆ‘ä»¬å°†<code>MainViewModel</code>æ”¾å…¥<code>ViewModels/</code>æ–‡ä»¶å¤¹ä¸­ï¼Œå°†å‘½åç©ºé—´è°ƒæ•´ä¸º<code>ReactiveUI.Samples.Suspension.ViewModels</code> ã€‚ </p><br><p><img width="250" src="https://habrastorage.org/webt/d7/l0/zm/d7l0zmx2opzysobg-rkqvhexpxk.png"><br></p><br><h2 id="routing-in-an-avalonia-app"> åœ¨Avaloniaåº”ç”¨ä¸­è·¯ç”± </h2><br><p> ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†åº”ç”¨ç¨‹åºçš„è¡¨ç¤ºæ¨¡å‹ã€‚ åæ¥ï¼Œè§†å›¾æ¨¡å‹ç±»å¯ä»¥æå–åˆ°é’ˆå¯¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">.NET Standard</a>çš„å•ç‹¬ç¨‹åºé›†ä¸­ï¼Œå› æ­¤æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒéƒ¨åˆ†å¯ä»¥åœ¨å¤šä¸ª.NET GUIæ¡†æ¶ä¸­é‡ç”¨ã€‚ ç°åœ¨æ˜¯æ—¶å€™å®ç°æˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­ç‰¹å®šäºAvaloniaçš„GUIäº†ã€‚ æˆ‘ä»¬åœ¨<code>Views/</code>æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«åä¸º<code>SearchView.xaml</code>å’Œ<code>SearchView.xaml.cs</code> ã€‚ è¿™æ˜¯å•ä¸ªæœç´¢è§†å›¾çš„ä¸¤ä¸ªéƒ¨åˆ†-å‰ä¸€ä¸ªæ˜¯XAMLä¸­å£°æ˜å¼æè¿°çš„UIï¼Œåä¸€ä¸ªåŒ…å«Cï¼ƒä»£ç éšè—ã€‚ æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯å…ˆå‰åˆ›å»ºçš„æœç´¢è§†å›¾æ¨¡å‹çš„è§†å›¾ã€‚ </p><br><p> æ¥è‡ªWPFï¼ŒUWPæˆ–XFçš„å¼€å‘äººå‘˜åº”è¯¥ç«‹å³ç†Ÿæ‚‰Avaloniaä¸­ä½¿ç”¨çš„XAMLæ–¹è¨€ã€‚ åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„å¸ƒå±€ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ–‡æœ¬æ¡†å’Œä¸€ä¸ªè§¦å‘æœç´¢çš„æŒ‰é’®ã€‚ æˆ‘ä»¬å°†æ¥è‡ª<code>SearchViewModel</code>å±æ€§å’Œå‘½ä»¤ç»‘å®šåˆ°<code>SearchViewModel</code>ä¸­å£°æ˜çš„æ§ä»¶ã€‚ </p><br><p>  <strong>è§†å›¾/ SearchView.xaml</strong> </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/avaloniaui"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{d:DesignInstance viewModels:SearchViewModel}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:viewModels</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:ReactiveUI.Samples.Suspension.ViewModels"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ReactiveUI.Samples.Suspension.Views.SearchView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:reactiveUi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://reactiveui.net"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Search view"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding SearchQuery, Mode=TwoWay}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Search"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Search}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <strong>è§†å›¾/ SearchView.xaml.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SearchView</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveUserControl</span></span>&lt;<span class="hljs-title"><span class="hljs-title">SearchViewModel</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// The call to WhenActivated is used to execute a block of code // when the corresponding view model is activated and deactivated. this.WhenActivated((CompositeDisposable disposable) =&gt; { }); AvaloniaXamlLoader.Load(this); } }</span></span></code> </pre> <br><p>  WPFå’ŒUWPå¼€å‘äººå‘˜å¯èƒ½è¿˜ä¼šå‘ç°<code>SearchView.xaml</code>æ–‡ä»¶çš„ä»£ç éšè—ã€‚ æ·»åŠ äº†å¯¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>WhenActivated</code></a>çš„è°ƒç”¨ä»¥æ‰§è¡Œè§†å›¾æ¿€æ´»é€»è¾‘ã€‚ å½“å–æ¶ˆæ¿€æ´»è§†å›¾æ—¶ï¼Œå°†ä¸¢å¼ƒç”¨ä½œ<code>WhenActivated</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ä¸€æ¬¡æ€§å˜é‡ã€‚ å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ˜¯<em>çƒ­çš„å¯è§‚å¯Ÿå¯¹è±¡</em> ï¼ˆä¾‹å¦‚å®šä½æœåŠ¡ï¼Œè®¡æ—¶å™¨ï¼Œäº‹ä»¶èšåˆå™¨ï¼‰ï¼Œåˆ™æ˜æ™ºçš„å†³å®šæ˜¯é€šè¿‡æ·»åŠ <code>DisposeWith</code>è°ƒç”¨å°†è®¢é˜…é™„åŠ åˆ°<code>WhenActivated</code>å¤åˆä¸€æ¬¡æ€§<code>DisposeWith</code> ï¼Œè¿™æ ·è§†å›¾å°†é€€è®¢é‚£äº›çƒ­çš„å¯è§‚å¯Ÿå¯¹è±¡å¹¶å†…å­˜æ³„æ¼ä¸ä¼šå‘ç”Ÿã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ç™»å½•è§†å›¾çš„å®ç°ç»†èŠ‚</b> <div class="spoiler_text"><p>  <strong>è§†å›¾/ LoginView.xaml</strong> </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/avaloniaui"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:DataContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{d:DesignInstance viewModels:LoginViewModel, IsDesignTimeCreatable=True}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:viewModels</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:ReactiveUI.Samples.Suspension.ViewModels"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ReactiveUI.Samples.Suspension.Views.LoginView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:reactiveUi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://reactiveui.net"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Login view"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Username, Mode=TwoWay}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">PasswordChar</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Password, Mode=TwoWay}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Login"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Login}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UserControl</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <strong>è§†å›¾/ LoginView.xaml.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LoginView</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveUserControl</span></span>&lt;<span class="hljs-title"><span class="hljs-title">LoginViewModel</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoginView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhenActivated(disposables =&gt; { }); AvaloniaXamlLoader.Load(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> </div></div><br><p> æˆ‘ä»¬ç¼–è¾‘<code>Views/MainView.xaml</code>å’Œ<code>Views/MainView.xaml.cs</code>æ–‡ä»¶ã€‚ æˆ‘ä»¬å°†<code>RoutedViewHost</code>å‘½åç©ºé—´ä¸­çš„<code>RoutedViewHost</code>æ§ä»¶æ·»åŠ åˆ°ä¸»çª—å£XAMLå¸ƒå±€ä¸­ï¼Œå¹¶å°†<code>MainViewModel</code>çš„<code>Router</code>å±æ€§ç»‘å®šåˆ°<code>RoutedViewHost.Router</code>å±æ€§ã€‚ æˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªæ‰“å¼€æœç´¢é¡µé¢ï¼Œå¦ä¸€ä¸ªæ‰“å¼€æˆæƒé¡µé¢ã€‚ </p><br><p>  <strong>è§†å›¾/ MainView.xaml</strong> </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://github.com/avaloniaui"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:DesignWidth</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"800"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d:DesignHeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"450"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ReactiveUI.Samples.Suspension.Views.MainView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:reactiveUi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://reactiveui.net"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ReactiveUI.Samples.Suspension"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- The RoutedViewHost XAML control observes the bound RoutingState. It subscribes to changes in the navigation stack and embedds the appropriate view for the currently selected view model. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reactiveUi:RoutedViewHost</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Router</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Router}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reactiveUi:RoutedViewHost.DefaultContent</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Default Content"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reactiveUi:RoutedViewHost.DefaultContent</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reactiveUi:RoutedViewHost</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ColumnDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.ColumnDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Search}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Search"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Login}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Login"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Command</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Router.NavigateBack}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Back"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <strong>è§†å›¾/ MainView.xaml.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainView</span></span> : <span class="hljs-title"><span class="hljs-title">ReactiveWindow</span></span>&lt;<span class="hljs-title"><span class="hljs-title">MainViewModel</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhenActivated(disposables =&gt; { }); AvaloniaXamlLoader.Load(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><p> ä¸€ä¸ªç®€å•çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avalonia</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUI</a>è·¯ç”±æ¼”ç¤ºåº”ç”¨ç¨‹åºç°å·²å‡†å¤‡å°±ç»ªã€‚ å½“ç”¨æˆ·æŒ‰ä¸‹æœç´¢æˆ–ç™»å½•æŒ‰é’®æ—¶ï¼Œå°†è§¦å‘è§¦å‘å¯¼èˆªçš„å‘½ä»¤ï¼Œå¹¶æ›´æ–°<code>RoutingState</code> ã€‚  <code>RoutedViewHost</code> XAMLæ§ä»¶è§‚å¯Ÿè·¯ç”±çŠ¶æ€ï¼Œå°è¯•ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>Locator.Current</code></a>è§£æé€‚å½“çš„<code>IViewFor&lt;TViewModel&gt;</code>å®ç°ã€‚ å¦‚æœæ³¨å†Œäº†<code>IViewFor&lt;TViewModel&gt;</code>å®ç°ï¼Œåˆ™å°†åˆ›å»ºæ§ä»¶çš„æ–°å®ä¾‹å¹¶å°†å…¶åµŒå…¥åˆ°Avaloniaçª—å£ä¸­ã€‚ </p><br><p><img width="550" src="https://habrastorage.org/webt/ys/o4/dg/yso4dgybdbqulwbb7dumlbktp5w.png"><br></p><br><p> æˆ‘ä»¬ä½¿ç”¨<code>Locator.CurrentMutable</code>åœ¨<code>App.OnFrameworkInitializationCompleted</code>æ–¹æ³•ä¸­æ³¨å†Œ<code>IViewFor</code>å’Œ<code>IScreen</code>å®ç°ã€‚ è¦è¿è¡Œ<code>RoutedViewHost</code>æ§ä»¶ï¼Œéœ€è¦æ³¨å†Œ<code>IViewFor</code>å®ç°ã€‚ æ³¨å†Œ<code>IScreen</code>å¯ä»¥ä½¿æˆ‘ä»¬çš„<code>SearchViewModel</code>å’Œ<code>LoginViewModel</code>åœ¨ååºåˆ—åŒ–æœŸé—´ä½¿ç”¨æ— å‚æ•°æ„é€ å‡½æ•°è¿›è¡Œå±æ€§åˆå§‹åŒ–ã€‚ </p><br><p>  <strong>App.xaml.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnFrameworkInitializationCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Here we register our view models. Locator.CurrentMutable.RegisterConstant&lt;IScreen&gt;(new MainViewModel()); Locator.CurrentMutable.Register&lt;IViewFor&lt;SearchViewModel&gt;&gt;(() =&gt; new SearchView()); Locator.CurrentMutable.Register&lt;IViewFor&lt;LoginViewModel&gt;&gt;(() =&gt; new LoginView()); // Here we resolve the root view model and initialize main view data context. new MainView { DataContext = Locator.Current.GetService&lt;IScreen&gt;() }.Show(); base.OnFrameworkInitializationCompleted(); }</span></span></code> </pre> <br><p> è®©æˆ‘ä»¬å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ç¡®ä¿è·¯ç”±èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚ å¦‚æœXAML UIæ ‡è®°å‡ºäº†é—®é¢˜ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avalonia XamlIIç¼–è¯‘å™¨</a>å°†åœ¨ç¼–è¯‘æ—¶é€šçŸ¥æˆ‘ä»¬ä»»ä½•é”™è¯¯ã€‚ æ­¤å¤–ï¼ŒXamlIlæ”¯æŒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">è°ƒè¯•XAML</a> ï¼ </p><br><pre> <code class="plaintext hljs">dotnet run --framework netcoreapp3.0</code> </pre> <br><p><img src="https://habrastorage.org/webt/c2/pp/88/c2pp88h397pwscpwn-i8vnke6sw.gif" width="400"><br></p><br><h2 id="saving-and-restoring-application-state"> ä¿å­˜å’Œè¿˜åŸåº”ç”¨ç¨‹åºçŠ¶æ€ </h2><br><p> ç°åœ¨æ˜¯æ—¶å€™å®æ–½æŒ‚èµ·é©±åŠ¨ç¨‹åºï¼Œè´Ÿè´£åœ¨åº”ç”¨ç¨‹åºæŒ‚èµ·å’Œæ¢å¤æ—¶è´Ÿè´£ä¿å­˜å’Œè¿˜åŸåº”ç”¨ç¨‹åºçŠ¶æ€ã€‚ ç‰¹å®šäºå¹³å°çš„<code>AutoSuspendHelper</code>ç±»è´Ÿè´£åˆå§‹åŒ–äº‹ç‰©ï¼Œä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ‚¨åªéœ€åœ¨åº”ç”¨ç¨‹åºç»„åˆæ ¹ç›®å½•ä¸­åˆ›å»ºå…¶å®ä¾‹ã€‚ å¦å¤–ï¼Œæ‚¨éœ€è¦åˆå§‹åŒ–<code>RxApp.SuspensionHost.CreateNewAppState</code>å·¥å‚ã€‚ å¦‚æœåº”ç”¨ç¨‹åºæ²¡æœ‰ä¿å­˜çš„æ•°æ®ï¼Œæˆ–è€…ä¿å­˜çš„æ•°æ®å·²æŸåï¼Œåˆ™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUIä¼š</a>è°ƒç”¨è¯¥å·¥å‚æ–¹æ³•æ¥åˆ›å»ºåº”ç”¨ç¨‹åºçŠ¶æ€å¯¹è±¡çš„é»˜è®¤å®ä¾‹ã€‚ </p><br><p> ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨<code>RxApp.SuspensionHost.SetupDefaultSuspendResume</code>æ–¹æ³•ï¼Œå¹¶å°†æ–°çš„<code>ISuspensionDriver</code>å®ä¾‹<code>ISuspensionDriver</code>ç»™å®ƒã€‚ è®©æˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Newtonsoft.Json</a>å’Œ<code>System.IO</code>å‘½åç©ºé—´ä¸­çš„ç±»æ¥å®ç°<code>ISuspensionDriver</code>æ¥å£ã€‚ </p><br><pre> <code class="plaintext hljs">dotnet add package Newtonsoft.Json</code> </pre> <br><p>  <strong>é©±åŠ¨ç¨‹åº/ NewtonsoftJsonSuspensionDriver.cs</strong> </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NewtonsoftJsonSuspensionDriver</span></span> : <span class="hljs-title"><span class="hljs-title">ISuspensionDriver</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _file; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> JsonSerializerSettings _settings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JsonSerializerSettings { TypeNameHandling = TypeNameHandling.All }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NewtonsoftJsonSuspensionDriver</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> file</span></span></span><span class="hljs-function">)</span></span> =&gt; _file = file; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IObservable&lt;Unit&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InvalidateState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (File.Exists(_file)) File.Delete(_file); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Observable.Return(Unit.Default); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IObservable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lines = File.ReadAllText(_file); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state = JsonConvert.DeserializeObject&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(lines, _settings); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Observable.Return(state); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IObservable&lt;Unit&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lines = JsonConvert.SerializeObject(state, _settings); File.WriteAllText(_file, lines); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Observable.Return(Unit.Default); } }</code> </pre> <br><p> æ‰€æè¿°çš„æ–¹æ³•æœ‰ä¸€ä¸ªç¼ºç‚¹-æŸäº›<code>System.IO</code>ç±»ä¸é€‚ç”¨äºUWPæ¡†æ¶ï¼ŒUWPåº”ç”¨ç¨‹åºåœ¨æ²™ç›’ä¸­è¿è¡Œï¼Œå¹¶ä¸”åŠŸèƒ½ä¸åŒã€‚ è¿™å¾ˆå®¹æ˜“è§£å†³-æ‚¨è¦åšçš„å°±æ˜¯åœ¨é’ˆå¯¹UWPæ—¶ä½¿ç”¨<code>StorageFile</code>å’Œ<code>StorageFolder</code>ç±»è€Œä¸æ˜¯<code>File</code>å’Œ<code>Directory</code> ã€‚ è¦ä»ç£ç›˜è¯»å–å¯¼èˆªå †æ ˆï¼Œæ‚¬æŒ‚é©±åŠ¨ç¨‹åºåº”æ”¯æŒå°†JSONå¯¹è±¡ååºåˆ—åŒ–ä¸ºå…·ä½“çš„<code>IRoutableViewModel</code>å®ç°ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨<code>TypeNameHandling.All</code> Newtonsoft.Jsonåºåˆ—åŒ–ç¨‹åºè®¾ç½®ã€‚ æˆ‘ä»¬é€šè¿‡<code>App.OnFrameworkInitializationCompleted</code>æ–¹æ³•åœ¨åº”ç”¨ç¨‹åºç»„åˆæ ¹ç›®å½•ä¸­æ³¨å†Œæ‚¬æµ®é©±åŠ¨ç¨‹åºï¼š </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnFrameworkInitializationCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Initialize suspension hooks. var suspension = new AutoSuspendHelper(ApplicationLifetime); RxApp.SuspensionHost.CreateNewAppState = () =&gt; new MainViewModel(); RxApp.SuspensionHost.SetupDefaultSuspendResume(new NewtonsoftJsonSuspensionDriver("appstate.json")); suspension.OnFrameworkInitializationCompleted(); // Read main view model state from disk. var state = RxApp.SuspensionHost.GetAppState&lt;MainViewModel&gt;(); Locator.CurrentMutable.RegisterConstant&lt;IScreen&gt;(state); // Register views. Locator.CurrentMutable.Register&lt;IViewFor&lt;SearchViewModel&gt;&gt;(() =&gt; new SearchView()); Locator.CurrentMutable.Register&lt;IViewFor&lt;LoginViewModel&gt;&gt;(() =&gt; new LoginView()); // Show the main window. new MainView { DataContext = Locator.Current.GetService&lt;IScreen&gt;() }.Show(); base.OnFrameworkInitializationCompleted(); }</span></span></code> </pre> <br><p>  <code>Avalonia.ReactiveUI</code>ç¨‹åºåŒ…ä¸­çš„<code>AutoSuspendHelper</code>ç±»ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºè®¾ç½®äº†ç”Ÿå‘½å‘¨æœŸæŒ‚é’©ï¼Œå› æ­¤ReactiveUIæ¡†æ¶å°†çŸ¥é“ä½•æ—¶ä½¿ç”¨æä¾›çš„<code>ISuspensionDriver</code>å®ç°å°†åº”ç”¨ç¨‹åºçŠ¶æ€å†™å…¥ç£ç›˜ã€‚ å¯åŠ¨åº”ç”¨ç¨‹åºåï¼Œæ‚¬æŒ‚é©±åŠ¨ç¨‹åºå°†åˆ›å»ºä¸€ä¸ªåä¸º<code>appstate.json</code>çš„æ–°JSONæ–‡ä»¶ã€‚ åœ¨ç”¨æˆ·ç•Œé¢ä¸­è¿›è¡Œæ›´æ”¹ï¼ˆä¾‹å¦‚ï¼Œåœ¨æ–‡æœ¬å­—æ®µä¸­é”®å…¥ä¸€äº›å†…å®¹æˆ–å•å‡»ä»»ä½•æŒ‰é’®ï¼‰ç„¶åå…³é—­åº”ç”¨ç¨‹åºåï¼Œ <code>appstate.json</code>æ–‡ä»¶å°†ç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">appstate.json</b> <div class="spoiler_text"><p> è¯·æ³¨æ„ï¼Œæ–‡ä»¶ä¸­çš„æ¯ä¸ªJSONå¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ª<code>$type</code>é”®ï¼Œè¯¥é”®å…·æœ‰å®Œå…¨é™å®šçš„ç±»å‹åï¼ŒåŒ…æ‹¬åç§°ç©ºé—´ã€‚ </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"$type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReactiveUI.Samples.Suspension.ViewModels.MainViewModel, ReactiveUI.Samples.Suspension"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Router"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReactiveUI.RoutingState, ReactiveUI"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_navigationStack"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$type"</span></span>: <span class="hljs-string"><span class="hljs-string">"System.Collections.ObjectModel.ObservableCollection`1[[ReactiveUI.IRoutableViewModel, ReactiveUI]], System.ObjectModel"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$values"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"$type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReactiveUI.Samples.Suspension.ViewModels.SearchViewModel, ReactiveUI.Samples.Suspension"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"SearchQuery"</span></span>: <span class="hljs-string"><span class="hljs-string">"funny cats"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"$type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ReactiveUI.Samples.Suspension.ViewModels.LoginViewModel, ReactiveUI.Samples.Suspension"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Username"</span></span>: <span class="hljs-string"><span class="hljs-string">"worldbeater"</span></span> } ] } } }</code> </pre> </div></div><br><p> å¦‚æœæ‚¨å…³é—­è¯¥åº”ç”¨ç¨‹åºç„¶åå†æ¬¡å¯åŠ¨å®ƒï¼Œæ‚¨å°†åœ¨å±å¹•ä¸Šçœ‹åˆ°ä¸ä»¥å‰ç›¸åŒçš„å†…å®¹ï¼ æ‰€æè¿°çš„åŠŸèƒ½å¯åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUI</a>æ”¯æŒçš„æ¯ä¸ªå¹³å°ä¸Šä½¿ç”¨ï¼ŒåŒ…æ‹¬UWPï¼ŒWPFï¼ŒXamarin Formsæˆ–Xamarin Nativeã€‚ </p><br><p><img src="https://habrastorage.org/webt/jm/xw/h8/jmxwh8il2bc9athdixw2skg7-3e.png" alt="å›¾ç‰‡"></p><br><p>  <strong>å¥–åŠ±ï¼š</strong>å¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Akavache</a> ï¼ˆå¼‚æ­¥ï¼ŒæŒä¹…æ€§é”®å€¼å­˜å‚¨ï¼‰æ¥å®ç°<code>ISuspensionDriver</code>æ¥å£ã€‚ å¦‚æœæ‚¨å°†æ•°æ®å­˜å‚¨åœ¨<code>UserAccount</code>éƒ¨åˆ†æˆ–<code>Secure</code>éƒ¨åˆ†ä¸­ï¼Œåˆ™åœ¨iOSå’ŒUWPä¸Šï¼Œæ‚¨çš„æ•°æ®å°†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">è‡ªåŠ¨å¤‡ä»½åˆ°äº‘ä¸­ï¼Œ</a>å¹¶ä¸”å¯ä»¥åœ¨å®‰è£…äº†è¯¥åº”ç”¨ç¨‹åºçš„æ‰€æœ‰è®¾å¤‡ä¸Šä½¿ç”¨ã€‚ å¦å¤–ï¼Œ <code>ReactiveUI.AndroidSupport</code>åŒ…ä¸­è¿˜å­˜åœ¨<code>BundleSuspensionDriver</code> ã€‚  Xamarin.Essentials <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">SecureStorage API</a>ä¹Ÿå¯ä»¥ç”¨äºå­˜å‚¨æ•°æ®ã€‚ æ‚¨è¿˜å¯ä»¥å°†åº”ç”¨ç¨‹åºçŠ¶æ€å­˜å‚¨åœ¨è¿œç¨‹æœåŠ¡å™¨æˆ–ç‹¬ç«‹äºå¹³å°çš„äº‘æœåŠ¡ä¸­ã€‚ </p><br><h2 id="useful-links"> æœ‰ç”¨çš„é“¾æ¥ </h2><br><ul><li> æ‰€æè¿°åº”ç”¨ç¨‹åºçš„æºä»£ç å¯åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">GitHub</a>ä¸Š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ‰¾åˆ°</a> ã€‚ </li><li> è¯·å‚é˜…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Avaloniaæ–‡æ¡£</a>ä»¥å¼€å§‹å­¦ä¹ æ¡†æ¶ã€‚ </li><li> é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ReactiveUIæ‰‹å†Œ</a>ä»¥å‘ç°æ›´å¤šå¾ˆæ£’çš„åŠŸèƒ½ã€‚ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN462307/">https://habr.com/ru/post/zh-CN462307/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN462295/index.html">ç›®å½•å¤§å°ä¸å€¼å¾—æˆ‘ä»¬åŠªåŠ›</a></li>
<li><a href="../zh-CN462297/index.html">ã€Šå“ˆä¼¯å‘¨åˆŠã€‹ç¬¬12æœŸ/ OneWebï¼Œç¦æ­¢èšé›†è€…çš„ç«™ç‚¹ï¼ŒITéƒ¨é—¨çš„å·¥èµ„ï¼Œâ€œäº²çˆ±çš„ï¼Œæˆ‘ä»¬æ€æ­»äº†äº’è”ç½‘â€åœ¨ä¿„ç½—æ–¯è”é‚¦æ˜¯ä¸å…è®¸çš„</a></li>
<li><a href="../zh-CN462299/index.html">åœ¨.NETä¸­å››èˆäº”å…¥</a></li>
<li><a href="../zh-CN462301/index.html">ç§˜è¯€ï¼ŒæŠ€å·§å’Œçªé—¨ï¼šå¦‚ä½•ä¸ºGoogle Assistantåˆ›å»ºé…·ç‚«çš„åŠ¨ä½œ</a></li>
<li><a href="../zh-CN462303/index.html">è¿‘ä¼¼çš„ç¾¤é›†å†…å­˜</a></li>
<li><a href="../zh-CN462311/index.html">@Pythonetcç¼–è¯‘ï¼Œ2019å¹´7æœˆ</a></li>
<li><a href="../zh-CN462313/index.html">æˆ‘çš„ç”µæŠ¥é¢‘é“@pythonetcçš„æç¤ºå’ŒæŠ€å·§ï¼Œ2019å¹´7æœˆ</a></li>
<li><a href="../zh-CN462315/index.html">åŠå…¬èŠ‚èƒ½ï¼šå¦‚ä½•å‡å°‘å®é™…èƒ½è€—ï¼Ÿ</a></li>
<li><a href="../zh-CN462317/index.html">ä½¿ç”¨AWSä¼˜åŒ–Laravelæ¶æ„çš„æç¤º</a></li>
<li><a href="../zh-CN462321/index.html">å›½é™…SEO | å›½é™…SEOæ’åå› ç´ </a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>