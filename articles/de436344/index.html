<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∫üèº üé® üë®üèª‚Äçüè≠ Fibaro Home Center 2 und Thermostat f√ºr Fu√übodenheizung HeatIt. Wie man die Temperatur erh√∂ht üîº üëêüèæ üö§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich stand vor der Aufgabe, einen warmen Boden √ºber die Fibaro Home Center 2-Oberfl√§che zu steuern. Es scheint eine einfache Aufgabe zu sein, aber nein...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fibaro Home Center 2 und Thermostat f√ºr Fu√übodenheizung HeatIt. Wie man die Temperatur erh√∂ht</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436344/">  Ich stand vor der Aufgabe, einen warmen Boden √ºber die Fibaro Home Center 2-Oberfl√§che zu steuern. Es scheint eine einfache Aufgabe zu sein, aber nein.  Auf Wunsch des Kunden sollten Thermostate auf der Bodentemperatur basieren.  Es wurde beschlossen, HeatIt-Thermostate zu verwenden. <br><br><img src="https://habrastorage.org/webt/fz/mf/8_/fzmf8_iydmmy3icnfdwrwuufdlg.jpeg" alt="Bild"><br><a name="habracut"></a><br>  Sie waren am besten f√ºr Kundenanforderungen geeignet: <br><br><ul><li>  minimalistisches Design </li><li>  die F√§higkeit, so viel wie m√∂glich zu l√∂schen, was auf dem Panel leuchtet </li><li>  die F√§higkeit, basierend auf der Bodentemperatur zu arbeiten </li><li>  die M√∂glichkeit der direkten Verbindung mit externen Relais (da die Fu√übodenheizung Wasser ist, m√ºssen Sie die Relais im Kesselraum steuern, die die Ventile der entsprechenden Stromkreise √∂ffnen und schlie√üen) </li></ul><br>  Nachdem ich die Materialien im Netzwerk ein wenig untersucht hatte, stellte ich fest, dass das ‚Äûcoole‚Äú Fibaro Home Center 2 nicht wei√ü, wie Thermostate in der Weboberfl√§che auf Temperaturen&gt; 30 Grad und in der mobilen Anwendung auf&gt; 28 Grad eingestellt werden.  Was f√ºr die maximale Bodentemperatur nat√ºrlich nicht ausreicht. <br><br><img src="https://habrastorage.org/webt/hn/or/x6/hnorx6-xkntp2ge3fzocx-c6bdw.png" alt="Bild"><br><br>  Gleichzeitig erm√∂glichen HeatIt-Thermostate die Einstellung von bis zu 40 Grad.  Die Frage ist, warum Fibaro dem Installateur nicht erlaubt, den Bereich m√∂glicher Temperaturen einzustellen.  Okay, dachte ich, wir werden uns etwas einfallen lassen.  Es gab sogar die Idee, die Messwerte des NTC-Sensors durch einen zus√§tzlichen Widerstand zu verschieben, aber dann m√ºsste sich der Kunde an die Temperaturmesswerte in den bedingten "Papageien" gew√∂hnen, was nicht gut ist. <br><br>  Es gab eine Idee, aber was ist, wenn wir einen gr√∂√üeren Wert annehmen und auf irgendeine Weise senden? <br><br>  Der Austausch zwischen dem Webclient und Home Center 2 wird in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fibaro REST-API beschrieben</a> <br>  Aber ich fand es einfacher, alle Befehle in Wireshark abzufangen. <br><br>  Speziell f√ºr HeatIt: <br><blockquote>  POST / api / device / 9 / action / setMode {"args": [1]} <br>  POST / api / device / 9 / action / setSetpointMode {"args": [1]} <br>  POST / api / device / 9 / action / setThermostatSetpoint {"args": [1,27]} </blockquote><div class="spoiler">  <b class="spoiler_title">Beschreibung</b> <div class="spoiler_text">  setMode - Modusauswahl (Argumente: 1 - beim Heizen, 11 - wirtschaftliches Heizen, 0 - aus) <br>  setSetpointMode - W√§hlen Sie aus, in welchem ‚Äã‚ÄãModus die Installationstemperatur angezeigt wird (die Argumente sind dieselben). <br>  setThermostatSetpoint - Legt die Zieltemperatur f√ºr den Modus fest (dementsprechend ist das erste Argument der Modus, das zweite die Temperatur). <br></div></div><br>  Sie k√∂nnen auch Anfragen senden wie: <br><blockquote>  GET / api / callAction? DeviceID = ID &amp; name = setThermostatSetpoint &amp; arg1 = MODE &amp; arg2 = TEMP VALUE </blockquote>  usw. <br><br>  Sie k√∂nnen auch alle Befehle und Werte f√ºr alle installierten Ger√§te durch eine REST-Anforderung lernen: <br><blockquote>  GET / api / Ger√§te </blockquote>  Also schicken wir dem Thermostat eine Temperatur von 35 Grad, und siehe da, der Thermostat hat sie akzeptiert. <br><br>  Jetzt besteht die Aufgabe darin, einen Ersatz f√ºr die regelm√§√üige Steuerung des Thermostats zu finden. <br><br>  Die erste Option ist eine virtuelle Fibaro-Appliance. <br><br>  Ich habe das Formular skizziert: <br><br><img src="https://habrastorage.org/webt/fq/iq/3v/fqiq3v0n0omwd1f_lny4_jjowti.jpeg"><br><br>  Erste Schritte beim Schreiben von Skripten: <br><br>  Zuerst ermitteln wir die ID aller Ger√§te, an denen wir interessiert sind. Gehen Sie dazu zu den Einstellungen f√ºr jedes ‚ÄûGer√§t‚Äú in Bezug auf unseren Thermostat und sehen Sie sich die ID auf der Seite oder in der Adressleiste des Browsers an. <br><br>  In meinem Fall das Ger√§t zum Einstellen der Zieltemperatur (setPoint) - ID: <b>7</b> <br><br>  Bodentemperatursensor - ID: <b>8</b> <br><br>  Auswahl des Thermostat-Betriebsmodus - ID: <b>9</b> <br><br><img src="https://habrastorage.org/webt/8f/wu/2t/8fwu2txxghejau1f6xwlb8jy9to.jpeg"><br><br><img src="https://habrastorage.org/webt/y6/m_/xm/y6m_xmgpan5f54wysh3eukx078c.jpeg"><br><br>  Au√üerdem hat unser virtuelles Ger√§t auch eine eigene ID, die nur in der Adressleiste des Browsers angezeigt wird. Ich habe diese ID <b>12</b> .  Au√üerdem hat jedes Element des virtuellen Ger√§ts in meinem Fall auch eine eigene ID: <br><br>  "Aktuelles Tempo."  Ich habe die ID " <b>Label1</b> ", " <b>Zieltemperatur</b> " - ID " <b>Label2</b> " <br>  Tasten "+" und "-" - ID " <b>Button1</b> " bzw. ID " <b>Button2</b> ".  "Mode" - ID " <b>Label1</b> ". <br>  Nun, die Tasten "OFF", "ECO" und "ON" - ID " <b>Button3</b> ", ID " <b>Button4</b> " und ID " <b>Button5</b> ". <br><br>  Die Hauptschleife: <br><br><pre><code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--       ,       : floor_temp = fibaro:getValue(8, 'value') currentSetPoint = tonumber(fibaro:getValue(7, 'value')) mode = fibaro:getValue(9, 'mode') --     fibaro:call(12, "setProperty", "ui.Label1.value", floor_temp) --               if (mode == '1') then fibaro:call(12, "setProperty", "ui.Label3.value", "ON") fibaro:call(12, "setProperty", "ui.Label2.value", currentSetPoint) elseif (mode == '11') then fibaro:call(12, "setProperty", "ui.Label3.value", "ECO") fibaro:call(12, "setProperty", "ui.Label2.value", currentSetPoint) elseif (mode == '0') then fibaro:call(12, "setProperty", "ui.Label3.value", "OFF") fibaro:call(12, "setProperty", "ui.Label2.value", "OFF") end</span></span></code> </pre> <br>  Als n√§chstes schreiben wir Skripte f√ºr die Schaltfl√§chen: <br>  Mit den Moduswahltasten ist alles einfach: <br>  "AUS": <br><br><pre> <code class="lua hljs">fibaro:call(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">'setMode'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  "ECO": <br><br><pre> <code class="lua hljs">fibaro:call(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">'setMode'</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>) fibaro:call(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'setSetpointMode'</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>)</code> </pre> <br>  "EIN": <br><br><pre> <code class="lua hljs">fibaro:call(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">'setMode'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) fibaro:call(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'setSetpointMode'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  F√ºr die Schaltfl√§che "+": <br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--     currentSetPoint = tonumber(fibaro:getValue(7, 'value')) --  ,        40  if (currentSetPoint &lt; 40) then setPoint = currentSetPoint + 1 else setPoint = 40 end --      fibaro:call(7, 'setThermostatSetpoint',11, setPoint)</span></span></code> </pre> <br>  F√ºr die Schaltfl√§che "-": <br><br><pre> <code class="lua hljs">currentSetPoint = <span class="hljs-built_in"><span class="hljs-built_in">tonumber</span></span>(fibaro:getValue(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentSetPoint &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> setPoint = currentSetPoint - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> setPoint = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> fibaro:call(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'setThermostatSetpoint'</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>, setPoint)</code> </pre> <br>  Im Allgemeinen alles. <br><br>  Es funktioniert gut, das einzige Problem ist die Verz√∂gerung nach dem Dr√ºcken der Taste.  Wenn Sie von einem lokalen Netzwerk aus verwalten, betr√§gt dies 1-2 Sekunden. Wenn Sie jedoch remote verwalten, kann die Verz√∂gerung bis zu 10 Sekunden betragen.  Das hei√üt,  Falls erforderlich, kann das Hinzuf√ºgen oder Verringern der Temperatur um ein Dutzend Grad aus der Ferne einige Minuten dauern. <br><br>  Im Allgemeinen ist dies nat√ºrlich eine Kr√ºcke, aber es gibt keinen anderen Ausweg.  Mit Blick auf die Zukunft werde ich sagen, dass das gesamte System irgendwann unter die Kontrolle von Iridium Mobile geraten wird. Dies ist also eine vor√ºbergehende L√∂sung. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436344/">https://habr.com/ru/post/de436344/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436332/index.html">PVS-Studio 7.00</a></li>
<li><a href="../de436334/index.html">Lernkonzepte durch sensomotorische Interaktion</a></li>
<li><a href="../de436338/index.html">Wie funktioniert der Flughafen Vnukovo?</a></li>
<li><a href="../de436340/index.html">Separate Protokollierungsstufe f√ºr jede Anforderung</a></li>
<li><a href="../de436342/index.html">Eine Einf√ºhrung in die robuste Optimierung [... und eine kleine Einkaufsliste, die ich vergessen habe ...]</a></li>
<li><a href="../de436346/index.html">Ben√∂tigen Sie immer Docker, Microservices und reaktive Programmierung?</a></li>
<li><a href="../de436348/index.html">Aufbau eines Teams zur Abfrage von Daten aus der Datenbank - Teil 2</a></li>
<li><a href="../de436350/index.html">Lernen Sie kontroverse Taktiken, Techniken und allgemeines Wissen (ATT @ CK). Unternehmenstaktik. Teil 7</a></li>
<li><a href="../de436352/index.html">PostgreSQL News Digest. Ausgabe Nr. 14</a></li>
<li><a href="../de436354/index.html">Das US-Milit√§r vernachl√§ssigt Fragen der Cybersicherheit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>