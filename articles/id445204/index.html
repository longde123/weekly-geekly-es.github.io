<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🎓 ✌🏽 😢 Konversi aliran dari basis data Firebird 2.5 ke format ODS12 (Firebird 3.0) 👨🏼‍🎤 👻 🧑🏿‍🤝‍🧑🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setiap versi Firebird memiliki versi sendiri dari format struktur basis data disk - O (n) D (isk) S (tructure). Sebelum versi 2.5 inklusif, mesin Fire...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Konversi aliran dari basis data Firebird 2.5 ke format ODS12 (Firebird 3.0)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445204/">  Setiap versi Firebird memiliki versi sendiri dari format struktur basis data disk - O (n) D (isk) S (tructure).  Sebelum versi 2.5 inklusif, mesin Firebird dapat bekerja dengan ODS dari versi sebelumnya, yaitu, database dari versi yang lebih lama dibuka oleh versi baru dan bekerja dalam mode kompatibilitas, tetapi mesin Firebird 3.0 hanya bekerja dengan database di ODS versi 12.0 sendiri. <br><br>  Untuk beralih ke 3.0, database dari 2.5 harus dikonversi ke format baru melalui backup / restore.  Tentu saja, kami mengasumsikan bahwa basis data sebelumnya disiapkan untuk konversi - yaitu  metadata dan permintaan telah diuji kompatibilitasnya dengan Firebird 3.0. <br><br>  Jika Anda mengikuti pendekatan standar, ini berarti Anda harus membuat cadangan ke versi 2.5, lalu instal 3.0 dan melakukan pengembalian.  Prosedur ini dapat diterima jika ada cukup waktu, tetapi ketika memigrasi basis data besar, atau saat memigrasi beberapa lusin basis data, ketika waktu hampir habis, Anda dapat menggunakan konversi aliran, yang 30-40% lebih cepat.  Bagaimana tepatnya melakukan ini (di Windows dan di Linux), baca di bawah cat. <br><a name="habracut"></a><br>  Gagasan umum adalah bahwa untuk akselerasi kita akan menggunakan pipa: <br><br><pre><code class="plaintext hljs">gbak -b … 25 stdout | gbak -c … stdin 30</code> </pre> <br>  Gbak dari 2.5 menghasilkan cadangan dalam format linier dan mengirimkannya ke stdout, yang segera mengambil gbak dari 3.0 melalui stdin dan membuat database baru. <br><br>  Diperlukan untuk mengatur pipa seperti itu menggunakan metode akses (file) lokal, karena akses jaringan (bahkan melalui localhost) secara signifikan akan memperlambat proses. <br><br>  Di bawah ini kita melihat detail untuk Windows dan Linux. <br><br>  <b>Windows</b> <br><br>  Dalam kasus Windows, cara termudah untuk membuat Firebird sepenuhnya otonom.  Untuk melakukan ini, ambil <a href="">Firebird 2.5 embed-archive</a> , ganti nama fbemded.dll menjadi fbclient.dll, tambahkan utilitas gbak.exe dari arsip 2.5 "biasa" dan (opsional) isql.exe. <br><br>  Firebird 3.0 menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">perakitan tunggal</a> dan tidak memerlukan modifikasi apa pun. <br><br>  Opsi terkecil (yang tidak memerlukan instalasi perpustakaan runtime VS2008 / VS2010 pada sistem target) berisi file-file berikut: <br><br><pre> <code class="plaintext hljs">25/gbak.exe 25/fbclient.dll 25/firebird.conf 25/firebird.log 25/firebird.msg 25/ib_util.dll 25/icudt30.dll 25/icuin30.dll 25/icuuc30.dll 25/Microsoft.VC80.CRT.manifest 25/msvcp80.dll 25/msvcr80.dll 30/fbclient.dll 30/firebird.conf 30/firebird.msg 30/gbak.exe 30/ib_util.dll 30/icudt52.dll 30/icudt52l.dat 30/icuin52.dll 30/icuuc52.dll 30/msvcp100.dll 30/msvcr100.dll 30/intl/fbintl.conf 30/intl/fbintl.dll 30/plugins/engine12.dll</code> </pre> <br>  Administrator yang berpengalaman mungkin memperhatikan bahwa intl / fbintl.dll dan intl / fbintl.conf tidak termasuk dalam 2.5.  Ini benar karena gbak tidak menggunakan koneksi char atau mengkonversi data antar karakter, tetapi di sisi "penerima" Firebird 3.0 file-file ini diperlukan saat membuat indeks. <br><br>  Di firebird.conf, Firebird 3.0 merekomendasikan untuk menambahkan: <br><br><pre> <code class="plaintext hljs">MaxUnflushedWrites = -1 MaxUnflushedWriteTime = -1</code> </pre> <br>  Juga, disarankan untuk mengatur nilai IpcName yang berbeda untuk 2.5 dan 3.0. <br><br>  Ketika memilih nilai-nilai parameter lain, firebird.conf melanjutkan dari pertimbangan sederhana: pada tahap transfer data, dalam satu proses, gbak menjalankan 2,5, dan pada proses lainnya 3,0, lalu 2,5 selesai, dan 3,0 mulai membuat indeks. <br><br>  Untuk mempercepat tahap membangun indeks di 3.0, disarankan untuk meningkatkan ukuran parameter TempCacheLimit menjadi ~ 40% RAM (jika itu adalah server khusus, tentu saja). <br><br>  Misalnya, jika server memiliki 16 GB RAM, maka Anda dapat menempatkan <br><br><pre> <code class="plaintext hljs">TempCacheLimit=6G</code> </pre> <br>  <i>Tentu saja, nilai ini hanya dapat ditetapkan untuk Firebird 3-bit 64, karena proses 32-bit tidak akan dapat mengalokasikan lebih dari 2 gigabytes memori.</i> <br><br>  Pada 2.5, parameter ini tidak perlu diubah - itu sudah tidak boleh lebih dari 2 gigabytes, dan itu tidak mempengaruhi kecepatan selama cadangan. <br><br>  Sebelum melakukan operasi, Anda perlu memeriksa bahwa halaman cache di header database diatur ke 0 ( <code>gstat -h databasename</code> perintah, lihat baris Halaman buffer). <br><br>  Jika cache ditentukan secara eksplisit di header database, maka cache menimpa nilai-nilai dari firebird.conf (dan databases.conf dalam 3.0), dan jika nilai-nilai yang tidak cukup besar itu dapat menyebabkan konsumsi memori yang berlebihan dan beralih ke swap. <br><br>  Selanjutnya, salin file ke sistem target. <br><br>  Konversi dilakukan setelah menghentikan layanan "sistem" Firebird 2.5, pada baris perintah dengan peningkatan hak istimewa kepada administrator lokal (contoh): <br><br><pre> <code class="plaintext hljs">set ISC_USER= "25/gbak" -z -b -g -v -st t -y 25.log 25 stdout|^ "30/gbak" -z -c -v -st t -y 30.log stdin 30</code> </pre> <br>  Contoh ini menggunakan "oblique lurus" dalam tanda kutip ("gaya unix" yang valid), dan topi (karakter "^") keluar dari karakter umpan baris, yang sesuai saat mengetik perintah panjang.  Opsi -st (atus) muncul di Firebird 2.5.8 dan memungkinkan Anda untuk menulis data tentang waktu operasi proses gbak ke protokol (lihat dokumentasi untuk detailnya). <br><br>  <b>Linux</b> <br><br>  Di Linux, Firebird 3 tergantung pada pustaka tommath.  Dalam CentOS (RHEL), perpustakaan ini berada di repositori epel, di Ubuntu (Debian) itu berada di sistem satu. <br><br>  Untuk CentOS, Anda harus terlebih dahulu menghubungkan repositori epel dan hanya kemudian lakukan <br><br><pre> <code class="plaintext hljs">yum install libtommath</code> </pre> <br>  Ubuntu tidak perlu menghubungkan repositori tambahan, tetapi versi berbeda dari paket diinstal pada Ubuntu 16 dan Ubuntu 18 - libtommath0 dan libtommath1, masing-masing. <br><br>  Firebird 3.0 sedang mencari tommath.so.0 dan untuk Ubuntu 18 juga diperlukan untuk membuat tautan (symlink) dari tommath.so.0 ke tommath.so.1.  Untuk melakukan ini, pertama-tama Anda perlu menemukan tommath.so.1. <br><br>  Jalur pencarian di Ubuntu adalah <code>/usr/lib/x86_64-linux-gnu/</code> , tetapi di distribusi berbasis Debian lain mungkin berbeda. <br><br>  Masalah kedua adalah bahwa sebelum Firebird 3.0.1, inklusif, tidak ada cara mudah untuk menginstal dua versi server yang berbeda.  Kami tidak mempertimbangkan opsi "kompilasi dari sumber dengan awalan yang diinginkan" karena kompleksitas relatifnya. <br><br>  Untuk Firebird 3.0.2 dan lebih tinggi, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">build dengan –enable-binreloc</a> dan opsi installer yang terpisah (-path path) diimplementasikan. <br><br>  Dengan asumsi bahwa pustaka tommath dan, jika perlu, symlink untuk tommath.so.0 telah ditambahkan ke sistem, Anda dapat menambahkan distribusi aktual (pada saat penulisan ini) Firebird 3.0.4 ke, misalnya, / opt / fb3: <br><br><pre> <code class="plaintext hljs">./install.sh -path /opt/fb3</code> </pre> <br>  Setelah itu, Anda dapat menghentikan layanan sistem Firebird dan memulai konversi streaming. <br><br>  <i>Ketika menghentikan Firebird, harus diingat bahwa Firebid 2.5 memproses dalam mode Klasik biasanya memulai xinetd - oleh karena itu diperlukan untuk menonaktifkan layanan firebird untuk xinetd atau menghentikan xinetd sepenuhnya.</i> <br><br>  Di firebird.conf untuk 3.0 di Linux, Anda tidak perlu mengatur parameter MaxUnflushed (hanya berfungsi di Windows) dan mengubah pengaturan Firebird 2.5. <br><br>  Di Linux, akses (file) lokal Firebird 2.5 tidak setara dengan versi embeded untuk Windows - server 2.5 akan bekerja dalam proses gbak (tanpa bagian jaringan), tetapi hak akses akan diperiksa terhadap basis pengguna, yang berarti bahwa tidak hanya login, tetapi juga kata sandi akan diperlukan : <br><br><pre> <code class="plaintext hljs">export ISC_USER=username ISC_PASSWORD=password /opt/firebird/bin/gbak -b … 25 stdout\ |/opt/fb3/bin/gbak -c … stdin 30</code> </pre> <br>  Setelah konversi berhasil, Anda harus terlebih dahulu menghapus "tambahan" Firebird 3.0, lalu "utama" Firebird 2.5, dan hanya setelah itu melakukan instalasi Firebird 3.0 yang bersih - terbaik dari semuanya dari pemasang tar.gz biasa, dan bukan melalui repositori, karena  versi dalam repositori mungkin ketinggalan. <br><br>  Selain itu, setelah memulihkan database Linux dan menginstalnya kembali, Anda perlu memeriksa apakah database baru tersebut memiliki pemilik pengguna firebird. <br><br>  Jika tidak, maka perlu diperbaiki <br><br><pre> <code class="plaintext hljs">chown firebird.firebird database</code> </pre> <br>  <b>Ringkasan</b> <br><br>  Selain menghemat waktu dan ruang disk, konversi streaming memiliki keunggulan penting lainnya - konversi basis data dilakukan tanpa menghapus Firebird 2.5 yang ada, yang sangat menyederhanakan pengembalian jika konversi tidak berhasil (paling sering karena kurangnya ruang atau reboot yang tidak terduga selama proses migrasi). <br><br>  Menghemat waktu disebabkan oleh fakta bahwa konversi "klasik" adalah "waktu cadangan" plus "waktu pemulihan".  Pemulihan terdiri dari dua bagian: membaca data dari file cadangan dan membuat indeks. <br><br>  Dalam konversi streaming, total waktu diperoleh sebagai "waktu cadangan plus lima hingga sepuluh persen" dan "waktu pembuatan indeks". <br><br>  Hasil spesifik tergantung pada struktur database, tetapi rata-rata, waktu pemulihan kira-kira sama dengan waktu cadangan ganda.  Karena itu, jika kita mengambil waktu cadangan per unit, maka "konversi klasik" - tiga unit waktu, mengalir - dua unit waktu.  Peningkatan TempCacheLimit juga membantu mengurangi waktu. <br><br>  Secara umum, konversi aliran dalam praktiknya memungkinkan Anda menghemat 30-40% dari waktu cadangan dan restoran pengganti. <br><br>  <b>Pertanyaan?</b> <br><br>  Silakan tulis semua pertanyaan di komentar, atau kirim ke penulis metodologi dan penulis bersama artikel ini - Vasily Sidorov, insinyur sistem terkemuka di iBase, di bs di ibase ru. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id445204/">https://habr.com/ru/post/id445204/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id445194/index.html">10 konsep untuk seorang desainer di 2019</a></li>
<li><a href="../id445196/index.html">Kubernetes 1.14: Tinjauan Umum Inovasi-inovasi Utama</a></li>
<li><a href="../id445198/index.html">Cmus console player untuk Linux</a></li>
<li><a href="../id445200/index.html">Penyedia internet meminta Kementerian Komunikasi untuk membiarkan mereka masuk ke rumah mereka tanpa kontrak</a></li>
<li><a href="../id445202/index.html">Happy Potter dan Urutan CSS</a></li>
<li><a href="../id445206/index.html">Kurangi waktu henti saat meningkatkan Zimbra</a></li>
<li><a href="../id445208/index.html">Tingkat Kematangan TI Perusahaan</a></li>
<li><a href="../id445210/index.html">Koloni Cryptocurrency</a></li>
<li><a href="../id445212/index.html">NetBIOS ada di tangan seorang hacker</a></li>
<li><a href="../id445214/index.html">Kami memompa React hooks menggunakan FRP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>