<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>  锔 Las funciones de Yandex env铆an correo さ 锔 </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoy crearemos el llamado La funci贸n Yandex (el nombre oficial de Yandex Cloud Functions ), que conspira con el servicio de correo SendGrid, enviar谩 "j...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Las funciones de Yandex env铆an correo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440374/"><img src="https://habrastorage.org/webt/-m/wh/t7/-mwht7iegxhuf9jusdci3-n7bpw.jpeg" alt="Caracter铆sticas de Yandex"><br><br>  Hoy crearemos el llamado  <i><b>La funci贸n Yandex</b></i> (el nombre oficial de <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Yandex Cloud Functions</a></i> ), que conspira con el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><i>servicio de</i></a> correo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><i>SendGrid,</i></a> enviar谩 "jab贸n" a los usuarios que duerman pac铆ficamente ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><i>es broma</i></a> , s茅 que todos estamos en contra del correo no deseado). <br><br>  Tambi茅n soy un oponente (pero sin fanatismo) de los servidores tradicionales y un defensor de los llamados  soluciones sin <i>servidor</i> (sin servidor), porque no me gusta (y realmente no s茅 c贸mo) administrar el servidor, y a煤n m谩s, pagar el tiempo en que no est谩n cargados.  Las funciones son otra cosa.  Alguien los atiende sin m铆, y yo pago solo por las llamadas.  A principios de octubre de 2019, Yandex present贸 sus <i>Yandex Cloud Functions</i> , parece ser el primer <i>servidor sin servidor</i> en la Federaci贸n de Rusia.  Y lo que es especialmente bueno: para las habilidades de Alice, generalmente son libres, por lo que desde entonces han estado en el campo de mi visi贸n perif茅rica.  Pero empecemos. <br><a name="habracut"></a><br>  Imagina tal escenario.  Su aplicaci贸n (por ejemplo, la habilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><i><b>Recordar y olvidar de</b></i></a> Alicia que, por cierto, tambi茅n funciona en las <i>funciones de Yandex</i> ) ofrece al usuario comprar productos digitales, por ejemplo, opciones adicionales, y el usuario realiza un pago.  Un cierto sistema de pago (similar al grado de confusi贸n con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><i>Yandex.Money</i></a> ) procesa el pago y lo env铆a a la direcci贸n que proporcion贸 (y tendremos un enlace para llamar a la <i>funci贸n Yandex</i> ) Solicitud <i>HTTP que</i> contiene detalles de pago, como cantidad, nombre, tel茅fono y correo electr贸nico del pagador.  Pero queremos procesar estos datos de alguna manera, por ejemplo: verifique la cantidad, ingrese las entradas apropiadas en la base de datos, env铆e <i>SMS</i> y <i>correos</i> <i>electr贸nicos</i> a los usuarios con la confirmaci贸n del recibo del pago e instrucciones adicionales.  Tal <i><b>microservicio</b></i> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b><i>Alice recuerda todo</i></b></a> sobre c贸mo grabar desde las <i>funciones de Yandex</i> en la base de datos de <i>Cloud Firestore</i> en el tutorial (y en el futuro, creo, consideraremos un ejemplo para otra base de datos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><i>Yandex Database</i></a> ).  Analizaremos c贸mo enviar <i>SMS a los</i> usuarios e integrar nuestra aplicaci贸n con <i>Yandex.Money</i> en un futuro pr贸ximo.  Ahora solo nos ocuparemos del env铆o de cartas. <br><br><h2>  1. Crear una cuenta en SendGrid </h2><br><div class="spoiler">  <b class="spoiler_title">Nota</b> <div class="spoiler_text">  SendGrid es solo mi elecci贸n, que hice por alguna raz贸n, y la principal es su disponibilidad de un SDK listo para Node.js.  Puede elegir cualquier otro servicio de lista de correo. <br></div></div><br>  Vamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><i>a la p谩gina de registro de la cuenta</i></a> y completamos el formulario de registro all铆.  Luego vaya al <i>Panel de</i> control, en el panel de navegaci贸n, seleccione <i>API de correo electr贸nico -&gt; Gu铆a de integraci贸n</i> , y en el panel principal - <i>API web</i> y haga clic en el bot贸n <i>Elegir</i> .  Todo est谩 como en la imagen: <br><br><img src="https://habrastorage.org/webt/pg/fb/h7/pgfbh7l3afq7zc2euvbnklqdoim.png" alt="Consola en SendGrid"><br><br>  En el siguiente paso, seleccione <i>Node.js</i> : <br><br><img src="https://habrastorage.org/webt/ae/ip/0y/aeip0y-m-yl_vvewbhcmasuhcga.png" alt="Elegir Node.js en SendGrid"><br><br>  A continuaci贸n, se nos ocurre un nombre para nuestra clave <i>API</i> (se mostrar谩 solo en la consola en la lista de claves, y no tiene nada que ver con nuestro c贸digo futuro; solo se me ocurri贸 una <i>clave-API</i> imperecedera) y haga clic en el bot贸n <i>Crear clave</i> : <br><br><img src="https://habrastorage.org/webt/y6/ah/c0/y6ahc0j8lewypmyknq6qjuq0nik.png" alt="Crear una API clave en SendGrid"><br><br>  Se genera la clave, la copiamos y la guardamos en el m谩s profundo secreto.  Y tendremos una pantalla con el bot贸n <i>Verificar integraci贸n</i> , como en la imagen a continuaci贸n, pero por ahora no lo presionaremos, sino que procederemos a escribir el c贸digo: <br><br><img src="https://habrastorage.org/webt/iq/1n/0s/iq1n0sazcac2tron51v9qxpb_ue.png" alt="Solicitud de confirmaci贸n de integraci贸n con SendGrid"><br><br><h2>  2. Redacci贸n de c贸digos </h2><br>  Y como ve, el c贸digo en s铆 es rid铆culamente peque帽o: 隆22 l铆neas! <br><br><img src="https://habrastorage.org/webt/as/am/ce/asamcev3zizxt3dzp_xqrcxjp4c.png" alt="C贸digo"><br><br>  En la l铆nea <i># 8,</i> mi correo est谩 registrado con un c贸digo r铆gido (y por lo tanto est谩 t铆midamente cubierto): usted indica el suyo.  En la vida real, recibiremos todos los datos del objeto del <i>evento</i> .  Por ejemplo, si el m茅todo <i>POST</i> ( <code>"Content-Type": "application/json"</code> ) pasa el campo de <i>correo electr贸nico</i> (propiedad): <br><pre> <code class="plaintext hljs">{ ... "email": "user@example.com", ... }</code> </pre><br>  El valor de este campo se puede obtener de la siguiente manera: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> body = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(event.body); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> email = body.email;</code> </pre><br>  Y si el campo de <i>correo electr贸nico</i> es propiedad de otro campo, el objeto de <i>usuario</i> (colecci贸n): <br><pre> <code class="plaintext hljs">{ ... "user": { ... "email": "user@example.com", ... }, ... }</code> </pre><br>  El valor de este campo se puede obtener a煤n m谩s f谩cilmente: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { user } = event; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> email = user.email;</code> </pre><br>  Si la direcci贸n de correo se pasa a la funci贸n en la URL (la llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><i>cadena de consulta de URL</i></a> ), por ejemplo: <code>https://functions.yandexcloud.net/123abc? <b>email=user@example.com</b></code> <code>https://functions.yandexcloud.net/123abc? <b>email=user@example.com</b></code> <br>  El valor del par谩metro de <i>correo electr贸nico</i> ser谩: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> email = event.queryStringParameters.email;</code> </pre> <br>  Para ver qu茅 contiene exactamente el objeto de <i>evento</i> , puede crear una <i>funci贸n Yandex</i> simple y girarla con solicitudes: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.handler = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">'statusCode'</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">'headers'</span></span>: { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json; charset=utf-8'</span></span> }, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(event), <span class="hljs-string"><span class="hljs-string">'isBase64Encoded'</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }; };</code> </pre> <br>  M谩s (pero menos inteligible) esto se afirma en la documentaci贸n oficial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><i>aqu铆</i></a> . <br><br>  Entonces, cree el directorio del proyecto (por ejemplo, <i>mailer</i> ), vaya a 茅l, inicialice el proyecto, instale las dependencias: <br><br><pre> <code class="plaintext hljs">mkdir mailer cd mailer npm init -y npm i @sendgrid/mail email-validator dotenv</code> </pre><br>  Aqu铆, solo se <i>requiere el</i> paquete <i>@ sendgrid / mail</i> .  El <i>paquete de validaci贸n de correo electr贸nico</i> verifica la validez de la direcci贸n de correo electr贸nico (驴como no lo adivin茅 de inmediato?), Pero si estamos seguros de ello (se ha verificado durante mucho tiempo sin nosotros), no podemos instalarlo (y, por supuesto, no verifique el c贸digo).  El paquete <i>dotenv est谩</i> dise帽ado para leer entradas del archivo <i>.env</i> como variables de <i>tiempo de ejecuci贸n</i> .  Pero las <i>funciones de Yandex</i> tienen la capacidad de poner estas variables directamente en el entorno de ejecuci贸n.  Como?  - Lo mostrar茅 a continuaci贸n.  Por lo tanto, el paquete <i>dotenv</i> tampoco se puede instalar, y el archivo <i>.env</i> no se debe crear, y el c贸digo en el archivo <i>index.js</i> no se debe cambiar.  Pero aqu铆 instalamos este paquete, por lo que creamos los <i>archivos</i> <i>index.js</i> y <i>.env</i> : <br><br><pre> <code class="plaintext hljs">touch index.js touch .env</code> </pre><br>  En el archivo <i>index.js</i> , escribimos 22 l铆neas de c贸digo que se muestran en la captura de pantalla anterior (cambie el correo solo en la l铆nea <i># 8</i> ), y en el archivo <i>.env</i> (sin comillas ni signos de puntuaci贸n) especifique un par: el nombre / valor de la clave <i>API</i> , que Recientemente llegamos a la consola <i>SendGrid</i> : <br>  <i>SENDGRID_API_KEY = your-very-secret-sendgrid-api-key</i> <br><br>  Y si quieres menos trabajo, clona el repositorio, instala los paquetes: <br><br><pre> <code class="plaintext hljs">git clone https://github.com/stmike/ycf-sendgrid-mailer-tutorial.git cd ycf-sendgrid-mailer-tutorial npm i</code> </pre><br>  En el archivo <i>index.js</i> , en la l铆nea <i># 8,</i> cambie el correo;  cree el archivo <i>.env</i> en el directorio ra铆z y especifique el nombre / valor de la clave <i>API</i> en 茅l, como se muestra un poco m谩s arriba. <br><br><h2>  3. Implementar </h2><br>  M谩s o menos claramente y en detalle sobre <i>Yandex.Cloud</i> y c贸mo colocar <i>las funciones de Yandex all铆 se</i> describen en mi art铆culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><i><b>Alice en el pa铆s de Bitrix</b></i></a> : se lo env铆o a los ignorantes en este pa铆s y a todos los dem谩s (y a los que regresaron), en adelante un peque帽o c贸mic (es decir, e. una serie de im谩genes y texto). <br><br>  Creamos un archivo <i>zip</i> (llam茅moslo, por ejemplo, <i>mailer.zip</i> ), en el que incluimos el directorio <i>node_modules</i> y los <i>archivos .env, index.js</i> , todo desde el directorio de nuestro proyecto: <br><br><img src="https://habrastorage.org/webt/mm/t4/wo/mmt4wo_3lrmvfsmu_jb1zvqosdi.png" alt="Archivo de proyectos"><br><br>  Creamos una funci贸n con el nombre ... correctamente - <i>anuncio publicitario</i> , seleccione el <i>Editor</i> en el men煤 de navegaci贸n izquierdo, complete los campos necesarios, cambie a la pesta帽a <i>Archivo ZIP y</i> cargue nuestro archivo <i>mailer.zip</i> : <br><br><img src="https://habrastorage.org/webt/3_/lm/kp/3_lmkpmibz5zreymkt0ablnofnc.png" alt="Descargar archivo"><br><br>  Y aqu铆 est谩 la oportunidad mencionada anteriormente para descargar la <i>clave API</i> directamente aqu铆, y no crear el archivo <i>.env</i> en el proyecto, y no instalar el paquete <i>dotenv</i> .  Pero ya hemos hecho todo esto, as铆 que lo estoy mostrando solo para informaci贸n.  Es decir, 隆no hay necesidad de duplicar! <br><br><img src="https://habrastorage.org/webt/_k/qt/rz/_kqtrzgehcja5njtxhxgq1b2sqi.png" alt="Variables de entorno"><br><br>  Ahora en la esquina superior derecha, haga clic en el bot贸n <i>Crear versi贸n</i> y espere un par de segundos.  Cuando todo est茅 listo, iremos autom谩ticamente a la secci贸n <i>Descripci贸n general</i> .  All铆 habilitaremos la opci贸n <i>Funci贸n p煤blica</i> para que pueda interactuar con ella desde el mundo exterior. <br><br><img src="https://habrastorage.org/webt/bx/7a/cf/bx7acfdqk78xywz_nlpq3osecxo.png" alt="Resumen de caracter铆sticas"><br><br>  驴Ves el enlace azul al lado del enlace <i>de llamada</i> ?  Haz clic en ella  Se abrir谩 una ventana de navegador vac铆a ... Pero espera, recib铆 una carta: <br><br><img src="https://habrastorage.org/webt/ty/im/pe/tyimpe1b_kbkkd5_ztjmmssvcqk.png" alt="Correo electr贸nico"><br><br>  Ahora puede volver a la consola <i>SendGrid</i> y hacer clic en el bot贸n <i>Verificar integraci贸n</i> .  El sistema verificar谩 todo en sus canales y, como resultado, deber铆a devolver dicha pantalla: <br><br><img src="https://habrastorage.org/webt/f-/pz/gn/f-pzgnxkutupsgqlyutkhh5pwci.png" alt="Confirmaci贸n de integraci贸n"><br><br>  Entonces, chicos (y chicas, por supuesto), 隆todo es realmente muy simple y elegante!  Habr谩 m谩s art铆culos.  Para quien es interesante leer, suscr铆base para no perderse.  Puedes suscribirte aqu铆 o en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><i>Telegram</i></a> . <br><br><h2>  4. Donuts </h2><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"><img src="https://habrastorage.org/webt/rk/dv/cw/rkdvcwukhwm_dzin-9t_kgszgj0.jpeg" alt="Donat"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440374/">https://habr.com/ru/post/440374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440362/index.html">El scooter el茅ctrico Xiaomi m365 es susceptible de pirater铆a con la capacidad de controlar de forma remota</a></li>
<li><a href="../440364/index.html">Sabes kilo, mega y concierto. 驴Qu茅 hay de Ronne y Cuecca?</a></li>
<li><a href="../440366/index.html">Ciclo de vida de un art铆culo sobre Habr茅: escribimos un habraparser</a></li>
<li><a href="../440370/index.html">T茅rminos de servicio: el 99% de los usuarios simplemente no los entienden</a></li>
<li><a href="../440372/index.html">Mi compilador Pascal y arte contempor谩neo polaco</a></li>
<li><a href="../440376/index.html">20 juegos para ense帽arle a tu hijo a programar</a></li>
<li><a href="../440378/index.html">Volver a los microservicios con Istio. Parte 2</a></li>
<li><a href="../440382/index.html">驴200 es bueno o malo?</a></li>
<li><a href="../440386/index.html">Liberando el manejo de errores eliminando errores</a></li>
<li><a href="../440388/index.html">Intervalos: la pr贸xima evoluci贸n de C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>