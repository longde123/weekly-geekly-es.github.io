<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘§ ğŸ‘± ğŸ¥‰ Listes de capture Swift: quelle est la diffÃ©rence entre les liens faibles, forts et non possÃ©dÃ©s? ğŸ¤™ğŸ½ âš«ï¸ ğŸ‘¨â€ğŸ«</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Joseph Wright, le prisonnier - Illustration d'une capture forte 

 La liste des valeurs Â«capturÃ©esÂ» se trouve devant la liste des paramÃ¨tres de fermet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Listes de capture Swift: quelle est la diffÃ©rence entre les liens faibles, forts et non possÃ©dÃ©s?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444336/"><img src="https://habrastorage.org/webt/ol/xa/zo/olxazojaea9ikajugulkcm6c-24.jpeg"><br>  <i>Joseph Wright, le prisonnier</i> - Illustration d'une capture forte <br><br>  La liste des valeurs Â«capturÃ©esÂ» se trouve devant la liste des paramÃ¨tres de fermeture et peut Â«capturerÂ» les valeurs du pÃ©rimÃ¨tre de trois maniÃ¨res diffÃ©rentes: en utilisant les liens Â«fortÂ», Â«faibleÂ» ou Â«sans propriÃ©taireÂ».  Nous l'utilisons souvent, principalement pour Ã©viter les cycles de rÃ©fÃ©rence forts (Â«cycles de rÃ©fÃ©rence fortsÂ» ou Â«conserver les cyclesÂ»). <br>  Il peut Ãªtre difficile pour un dÃ©veloppeur novice de dÃ©cider quelle mÃ©thode utiliser, vous pouvez donc passer beaucoup de temps Ã  choisir entre Â«fortÂ» et Â«faibleÂ» ou entre Â«faibleÂ» et Â«sans propriÃ©taireÂ», mais avec le temps, vous vous rendrez compte que le bon choix - un seul. <br><a name="habracut"></a><br>  CrÃ©ez d'abord une classe simple: <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playSong</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Shake it off!"</span></span>) } }</code> </pre> <br>  Ensuite, nous Ã©crivons une fonction qui crÃ©e une instance de la classe <b>Singer</b> et renvoie une fermeture qui appelle la mÃ©thode <b>playSong ()</b> de la classe <b>Singer</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; () -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> taylor = <span class="hljs-type"><span class="hljs-type">Singer</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> singing = { taylor.playSong() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> singing }</code> </pre> <br>  Enfin, nous pouvons appeler <b>sing ()</b> n'importe oÃ¹ pour obtenir le rÃ©sultat de la <b>lecture de playSong ()</b> <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> singFunction = sing() singFunction()</code> </pre> <br><br>  En consÃ©quence, la ligne Â«Secouez-le!Â» Sera affichÃ©e. <br><br><h2>  Capture forte </h2><br>  Sauf si vous spÃ©cifiez explicitement une mÃ©thode de capture, Swift utilise une capture Â«forteÂ».  Cela signifie que la fermeture capture les valeurs externes utilisÃ©es et ne les laissera jamais libres. <br><br>  Jetons Ã  nouveau un Å“il Ã  la fonction <b>sing ()</b> <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; () -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> taylor = <span class="hljs-type"><span class="hljs-type">Singer</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> singing = { taylor.playSong() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> singing }</code> </pre> <br>  La <b>constante de Taylor est</b> dÃ©finie Ã  l'intÃ©rieur d'une fonction, donc dans des circonstances normales, sa place serait libÃ©rÃ©e une fois que la fonction a terminÃ© son travail.  Cependant, cette constante est utilisÃ©e Ã  l'intÃ©rieur de la fermeture, ce qui signifie que Swift assurera automatiquement sa prÃ©sence tant que la fermeture elle-mÃªme existera, mÃªme aprÃ¨s la fin de la fonction. <br>  Il s'agit d'une capture "forte" en action.  Si Swift autorisait la libÃ©ration de <b>taylor</b> , appeler la fermeture serait dangereux - sa mÃ©thode <b>taylor.playSong ()</b> n'est plus valide. <br><br><h2>  Capture "faible" (capture faible) </h2><br>  Swift nous permet de crÃ©er une Â« <u>liste de capture</u> Â» pour dÃ©terminer comment les valeurs utilisÃ©es sont capturÃ©es.  Une alternative Ã  la capture Â«forteÂ» est Â«faibleÂ» et son application entraÃ®ne les consÃ©quences suivantes: <br><br>  1. Les valeurs capturÃ©es Â«faiblementÂ» ne sont pas conservÃ©es par la fermeture et peuvent donc Ãªtre libÃ©rÃ©es et rÃ©glÃ©es sur <b>zÃ©ro</b> . <br><br>  2. En consÃ©quence du premier paragraphe, les valeurs capturÃ©es Â«faiblementÂ» dans Swift sont toujours <b>facultatives</b> . <br>  Nous modifions notre exemple en utilisant une capture Â«faibleÂ» et voyons immÃ©diatement la diffÃ©rence. <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; () -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> taylor = <span class="hljs-type"><span class="hljs-type">Singer</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> singing = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> taylor] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> taylor?.playSong() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> singing }</code> </pre> <br>  <b>[taylor faible]</b> - c'est notre " <u>liste de capture</u> ", une partie spÃ©ciale de la syntaxe de fermeture dans laquelle nous donnons des instructions sur la faÃ§on dont les valeurs doivent Ãªtre capturÃ©es.  Ici, nous disons que <b>taylor</b> doit Ãªtre capturÃ© "faiblement", nous devons donc utiliser <b>taylor? .PlaySong ()</b> - maintenant, il est <b>facultatif</b> , car il peut Ãªtre dÃ©fini sur <b>nil</b> Ã  tout moment. <br><br>  Si vous exÃ©cutez maintenant ce code, vous verrez que l'appel Ã  <b>singFunction ()</b> n'entraÃ®ne plus de message.  La raison en est que <b>taylor</b> n'existe qu'Ã  l'intÃ©rieur de <b>sing ()</b> , et la fermeture retournÃ©e par cette fonction ne maintient pas <b>taylor</b> Â«fortementÂ» Ã  l'intÃ©rieur de lui-mÃªme. <br><br>  Essayez maintenant de changer <b>taylor? .PlaySong ()</b> en <b>taylor! .PlaySong ()</b> .  Cela entraÃ®nera un dÃ©ballage forcÃ© du <b>taylor</b> Ã  l'intÃ©rieur de la fermeture et, par consÃ©quent, une erreur fatale (dÃ©ballage du contenu contenant <b>zÃ©ro</b> ) <br><br><h2>  Capture "sans propriÃ©taire" (capture sans propriÃ©taire) </h2><br>  Une alternative Ã  la capture Â«faibleÂ» est Â«sans propriÃ©taireÂ». <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; () -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> taylor = <span class="hljs-type"><span class="hljs-type">Singer</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> singing = { [<span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> taylor] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> taylor.playSong() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> singing }</code> </pre> <br>  Ce code se terminera anormalement de la mÃªme maniÃ¨re avec l'option facultative dÃ©ployÃ©e illustrÃ©e ci-dessus - un <b>taylor sans</b> propriÃ©taire dit: "Je sais avec certitude que <b>taylor</b> existera pendant la durÃ©e de la fermeture, donc je n'ai pas besoin de le garder en mÃ©moire."  En fait, <b>taylor</b> sera publiÃ© presque immÃ©diatement et ce code plantera. <br><br>  Alors, utilisez <b>-le</b> trÃ¨s soigneusement sans <b>propriÃ©taire</b> . <br><br><h2>  ProblÃ¨mes courants </h2><br>  Les dÃ©veloppeurs sont confrontÃ©s Ã  quatre problÃ¨mes lorsqu'ils utilisent la capture de valeur dans les fermetures: <br><br><h3>  1. DifficultÃ©s avec l'emplacement de la liste de capture dans le cas oÃ¹ la fermeture prend des paramÃ¨tres </h3><br>  Il s'agit d'un problÃ¨me courant que vous pouvez rencontrer au dÃ©but de l'Ã©tude des fermetures, mais, heureusement, Swift nous aidera dans ce cas. <br><br>  Lorsque vous utilisez la liste de capture et les paramÃ¨tres de fermeture ensemble, la liste de capture est d'abord entre crochets, puis les paramÃ¨tres de fermeture, puis le mot clÃ© in, marquant le dÃ©but du Â«corpsÂ» de fermeture. <br><br><pre> <code class="swift hljs">writeToLog { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] user, message <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.addToLog(<span class="hljs-string"><span class="hljs-string">"\(user) triggered event: \(message)"</span></span>) }</code> </pre> <br>  Tenter de mettre une liste de capture aprÃ¨s les paramÃ¨tres de fermeture entraÃ®nera une erreur de compilation. <br><br><h3>  2. L'Ã©mergence d'un cycle de liens forts, conduisant Ã  une fuite de mÃ©moire </h3><br>  Lorsqu'une entitÃ© A a une entitÃ© B, et vice versa, vous avez une situation appelÃ©e Â«cycle de rÃ©tentionÂ». <br><br>  Ã€ titre d'exemple, considÃ©rons le code: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">House</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ownerDetails: (() -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)? <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printDetails</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"This is a great house."</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"I'm being demolished!"</span></span>) } }</code> </pre> <br>  Nous avons dÃ©fini la classe <b>House</b> , qui contient une propriÃ©tÃ© (fermeture), une mÃ©thode et un dÃ©sinitialiseur qui affichera un message lorsqu'une instance de la classe est dÃ©truite. <br><br>  CrÃ©ez maintenant une classe <b>Owner</b> similaire Ã  la prÃ©cÃ©dente, sauf que sa propriÃ©tÃ© de fermeture contient des informations sur la maison. <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Owner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> houseDetails: (() -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>)? <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printDetails</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"I own a house."</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"I'm dying!"</span></span>) } }</code> </pre> <br>  CrÃ©ez maintenant des instances de ces classes dans le bloc <b>do</b> .  Nous n'avons pas besoin d'un bloc catch, mais l'utilisation d'un bloc <b>do</b> dÃ©truira les instances juste aprÃ¨s} <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Creating a house and an owner"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> house = <span class="hljs-type"><span class="hljs-type">House</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> owner = <span class="hljs-type"><span class="hljs-type">Owner</span></span>() } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Done"</span></span>)</code> </pre> <br>  En consÃ©quence, des messages seront affichÃ©s: Â«CrÃ©ation d'une maison et d'un propriÃ©taireÂ», Â«Je meurs!Â», Â«Je suis en train d'Ãªtre dÃ©moli!Â», Puis Â«TerminÃ©Â» - tout fonctionne comme il se doit. <br><br>  CrÃ©ez maintenant une boucle de liens solides. <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Creating a house and an owner"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> house = <span class="hljs-type"><span class="hljs-type">House</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> owner = <span class="hljs-type"><span class="hljs-type">Owner</span></span>() house.ownerDetails = owner.printDetails owner.houseDetails = house.printDetails } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Done"</span></span>)</code> </pre> <br>  Maintenant, le message Â«CrÃ©ation d'une maison et d'un propriÃ©taireÂ» apparaÃ®t, puis Â«TerminÃ©Â».  Les dÃ©sinitialiseurs ne seront pas appelÃ©s. <br><br>  Cela est dÃ» au fait que la maison a une propriÃ©tÃ© qui pointe vers le propriÃ©taire et que le propriÃ©taire a une propriÃ©tÃ© qui pointe vers la maison.  Par consÃ©quent, aucun d'entre eux ne peut Ãªtre libÃ©rÃ© en toute sÃ©curitÃ©.  Dans une situation rÃ©elle, cela conduit Ã  des fuites de mÃ©moire, ce qui entraÃ®ne des performances mÃ©diocres et mÃªme un crash de l'application. <br><br>  Pour corriger la situation, nous devons crÃ©er une nouvelle fermeture et utiliser une capture Â«faibleÂ» dans un ou deux cas, comme ceci: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Creating a house and an owner"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> house = <span class="hljs-type"><span class="hljs-type">House</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> owner = <span class="hljs-type"><span class="hljs-type">Owner</span></span>() house.ownerDetails = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> owner] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> owner?.printDetails() } owner.houseDetails = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> house] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> house?.printDetails() } } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Done"</span></span>)</code> </pre> <br>  Il n'est pas nÃ©cessaire de dÃ©clarer les deux valeurs capturÃ©es, il suffit de le faire en un seul endroit - cela permettra Ã  Swift de dÃ©truire les deux classes si nÃ©cessaire. <br><br>  Dans les projets rÃ©els, la situation d'un cycle aussi Ã©vident de liens forts se pose rarement, mais cela souligne d'autant plus l'importance d'utiliser la capture Â«faibleÂ» avec un dÃ©veloppement compÃ©tent. <br><br><h3>  3. L'utilisation par inadvertance de liens solides, gÃ©nÃ©ralement lors de la capture de plusieurs valeurs </h3><br>  Swift utilise une forte adhÃ©rence par dÃ©faut, ce qui peut entraÃ®ner un comportement inattendu. <br>  ConsidÃ©rez le code suivant: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; () -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> taylor = <span class="hljs-type"><span class="hljs-type">Singer</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> adele = <span class="hljs-type"><span class="hljs-type">Singer</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> singing = { [<span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> taylor, adele] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> taylor.playSong() adele.playSong() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> singing }</code> </pre> <br>  Maintenant, nous avons deux valeurs capturÃ©es par la fermeture, et nous utilisons les deux de la mÃªme maniÃ¨re.  Cependant, seul <b>Taylor est</b> capturÃ© comme non possÃ©dÃ© - Adele <b>est</b> capturÃ© fortement car le mot-clÃ© <b>Unowned</b> doit Ãªtre utilisÃ© pour chaque valeur capturÃ©e. <br><br>  Si vous l'avez fait exprÃ¨s, alors tout va bien, mais si vous voulez que les deux valeurs soient capturÃ©es "sans <b>propriÃ©taire</b> ", vous avez besoin des Ã©lÃ©ments suivants: <br><br><pre> <code class="swift hljs">[<span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> taylor, <span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> adele]</code> </pre> <br><h3>  4. Copiez les fermetures et partagez les valeurs capturÃ©es </h3><br>  Le dernier cas sur lequel les dÃ©veloppeurs tombent est la faÃ§on dont les erreurs sont copiÃ©es car les donnÃ©es qu'elles capturent deviennent disponibles pour toutes les copies de l'erreur. <br>  Prenons un exemple de fermeture simple qui capture la variable entiÃ¨re <b>numberOfLinesLogged</b> dÃ©clarÃ©e en dehors de la fermeture, afin que nous puissions augmenter sa valeur et l'imprimer chaque fois que la fermeture est appelÃ©e: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> numberOfLinesLogged = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logger1 = { numberOfLinesLogged += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Lines logged: \(numberOfLinesLogged)"</span></span>) } logger1()</code> </pre> <br>  Cela affichera le message Â«Lignes enregistrÃ©es: 1Â». <br>  Nous allons maintenant crÃ©er une copie de la fermeture qui partagera les valeurs capturÃ©es avec la premiÃ¨re fermeture.  Ainsi, si nous appelons la fermeture originale ou sa copie, nous verrons la valeur croissante de la variable. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logger2 = logger1 logger2() logger1() logger2()</code> </pre><br>  Cela affichera les messages "Lignes enregistrÃ©es: 1" ... "Lignes enregistrÃ©es: 4" car <b>logger1</b> et <b>logger2</b> pointent vers la mÃªme variable <b>numberOfLinesLogged</b> capturÃ©e. <br><br><h2>  Quand utiliser une capture "forte", "faible" et "sans propriÃ©taire" </h2><br>  Maintenant que nous comprenons comment tout fonctionne, essayons de rÃ©sumer: <br><br>  1. Si vous Ãªtes sÃ»r que la valeur capturÃ©e ne deviendra jamais <b>nulle</b> lors de la fermeture, vous pouvez utiliser la <b>Â«capture sans propriÃ©taireÂ»</b> .  Il s'agit d'une situation peu frÃ©quente oÃ¹ l'utilisation de la capture Â«faibleÂ» peut entraÃ®ner des difficultÃ©s supplÃ©mentaires, mÃªme lors de l'utilisation d'une garde laissÃ©e Ã  une valeur faiblement capturÃ©e Ã  l'intÃ©rieur de la fermeture. <br><br>  2. Si vous avez un cas de cycle de liens forts (l'entitÃ© A possÃ¨de l'entitÃ© B et l'entitÃ© B possÃ¨de l'entitÃ© A), alors dans l'un des cas, vous devez utiliser la <b>Â«capture faibleÂ»</b> .  Il est nÃ©cessaire de prendre en compte laquelle des deux entitÃ©s sera libÃ©rÃ©e en premier, donc si le contrÃ´leur de vue A reprÃ©sente le contrÃ´leur de vue B, alors le contrÃ´leur de vue B peut contenir un lien Â«faibleÂ» vers Â«AÂ». <br><br>  3. Si la possibilitÃ© d'un cycle de liens forts est exclue, vous pouvez utiliser la capture "forte" ( <b>"capture forte"</b> ).  Par exemple, l'exÃ©cution d'une animation ne se bloque pas Ã  l'intÃ©rieur de la fermeture contenant l'animation, vous pouvez donc utiliser une liaison forte. <br><br>  4. Si vous n'Ãªtes pas sÃ»r, commencez par une reliure Â«faibleÂ» et ne la changez que si nÃ©cessaire. <br><br>  Facultatif - Guide Swift officiel: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Court-circuits</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comptage automatique des liens</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444336/">https://habr.com/ru/post/fr444336/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444324/index.html">Suivre les traces des calculatrices: SpeedCrunch</a></li>
<li><a href="../fr444326/index.html">Surveillance par SMS du poids de trois ruches pour 30 $</a></li>
<li><a href="../fr444328/index.html">La refonte de l'interface utilisateur est souvent une perte de temps</a></li>
<li><a href="../fr444330/index.html">Le CMS sans serveur est enfin un concurrent digne de Wordpress</a></li>
<li><a href="../fr444332/index.html">SÃ©curitÃ© de l'information et restauration: comment les managers pensent les produits informatiques</a></li>
<li><a href="../fr444338/index.html">Encapsulation dans Python 3</a></li>
<li><a href="../fr444340/index.html">CaractÃ©ristiques de l'utilisation du type de donnÃ©es Symbol en JavaScript</a></li>
<li><a href="../fr444342/index.html">DÃ©veloppement d'applications JavaScript simples et modernes Ã  l'aide de Webpack et de technologies Web avancÃ©es</a></li>
<li><a href="../fr444344/index.html">10 Ã©tapes pour rÃ©ussir un projet Python</a></li>
<li><a href="../fr444346/index.html">GraphQL et Golang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>