<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõµ ü•É üçÅ "Nouvelles √©pop√©es". Nous mangeons l'√©l√©phant en plusieurs parties ‚öΩÔ∏è üß¢ ü§öüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je mettrai en place un environnement de travail pour le d√©veloppement du jeu "Epics", ainsi que je diviserai le jeu lui-m√™me en part...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Nouvelles √©pop√©es". Nous mangeons l'√©l√©phant en plusieurs parties</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/482752/"><p><img src="https://habrastorage.org/webt/gd/be/ip/gdbeip7f5h-k71jqzl7gmb1axva.jpeg"></p><br><p>  Dans cet article, je mettrai en place un environnement de travail pour le d√©veloppement du jeu "Epics", ainsi que je diviserai le jeu lui-m√™me en parties adapt√©es √† une utilisation dans OpenFaaS.  Je ferai toutes les manipulations sous Linux, Kubernetes sera d√©ploy√© en minikube en utilisant VirtualBox.  Dans ma machine de travail, il y a 2 c≈ìurs de processeur et 12 Go de RAM, j'utilise le SSD comme disque syst√®me.  J'utiliserai debian 8 comme syst√®me principal de d√©veloppement, avec les paquets emacs, sudo, git et virtualbox install√©s, j'installerai le reste en t√©l√©chargeant depuis GitHub et d'autres sources.  Nous installerons ces applications dans / usr / local / bin, sauf indication contraire.  Commen√ßons! </p><a name="habracut"></a><br><h2 id="podgotovka-rabochego-okruzheniya">  Pr√©paration de l'environnement de travail </h2><br><h3 id="ustanovka-go">  Aller √† l'installation </h3><br><p>  Suivez les instructions du site officiel: </p><br><pre><code class="plaintext hljs">$ curl -L0 https://dl.google.com/go/go1.13.5.linux-amd64.tar.gz -o go.tar.gz $ sudo tar -C /usr/local -xzf go.tar.gz $ echo 'export PATH=$PATH:/usr/local/go/bin' &gt;&gt; ~/.profile</code> </pre> <br><p>  V√©rifier les performances: </p><br><pre> <code class="plaintext hljs">$ mkdir -p ~/go/src/hello &amp;&amp; cd ~/go/src/hello $ echo 'package main import "fmt" func main() { fmt.Printf("hello, world\n") }' &gt; hello.go $ go build $ ./hello hello, world</code> </pre> <br><h3 id="ustanovka-faas-cli">  Installer faas-cli </h3><br><p>  Suivez les instructions du site officiel: </p><br><pre> <code class="plaintext hljs">$ curl -sSL https://cli.openfaas.com | sudo -E sh x86_64 Downloading package https://github.com/openfaas/faas-cli/releases/download/0.11.3/faas-cli as /tmp/faas-cli Download complete. Running with sufficient permissions to attempt to move faas-cli to /usr/local/bin New version of faas-cli installed to /usr/local/bin Creating alias 'faas' for 'faas-cli'. ___ _____ ____ / _ \ _ __ ___ _ __ | ___|_ _ __ _/ ___| | | | | '_ \ / _ \ '_ \| |_ / _` |/ _` \___ \ | |_| | |_) | __/ | | | _| (_| | (_| |___) | \___/| .__/ \___|_| |_|_| \__,_|\__,_|____/ |_| CLI: commit: 73004c23e5a4d3fdb7352f953247473477477a64 version: 0.11.3</code> </pre> <br><p>  De plus, vous pouvez activer l'ach√®vement de bash: </p><br><pre> <code class="plaintext hljs">faas-cli completion --shell bash | sudo tee /etc/bash_completion.d/faas-cli</code> </pre> <br><h3 id="ustanovka-i-nastroyka-kubernetes">  Installer et configurer Kubernetes </h3><br><p>  Minikube est suffisant pour le d√©veloppement, nous allons donc l'installer et kubelet dans / usr / local / bin, nous installerons √©galement helm pour installer les applications: </p><br><pre> <code class="plaintext hljs">$ curl https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 -o minikube &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/ $ curl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl -o kubectl &amp;&amp; chmod +x kubectl &amp;&amp; sudo mv kubectl /usr/local/bin/ $ curl https://get.helm.sh/helm-v3.0.2-linux-amd64.tar.gz | tar -xzvf - linux-amd64/helm --strip-components=1; sudo mv helm /usr/local/bin</code> </pre> <br><p>  Lancer le minikube: </p><br><pre> <code class="plaintext hljs">$ minikube start minikube v1.6.2 on Debian 8.11 Automatically selected the 'virtualbox' driver (alternates: []) Downloading VM boot image ... &gt; minikube-v1.6.0.iso.sha256: 65 B / 65 B [--------------] 100.00% ? p/s 0s &gt; minikube-v1.6.0.iso: 150.93 MiB / 150.93 MiB [-] 100.00% 5.67 MiB p/s 27s Creating virtualbox VM (CPUs=2, Memory=8192MB, Disk=20000MB) ... Preparing Kubernetes v1.17.0 on Docker '19.03.5' ... Downloading kubeadm v1.17.0 Downloading kubelet v1.17.0 Pulling images ... Launching Kubernetes ... Waiting for cluster to come online ... Done! kubectl is now configured to use "minikube"</code> </pre> <br><p>  Nous v√©rifions: </p><br><pre> <code class="plaintext hljs">$ kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-6955765f44-knlcb 1/1 Running 0 29m kube-system coredns-6955765f44-t9cpn 1/1 Running 0 29m kube-system etcd-minikube 1/1 Running 0 28m kube-system kube-addon-manager-minikube 1/1 Running 0 28m kube-system kube-apiserver-minikube 1/1 Running 0 28m kube-system kube-controller-manager-minikube 1/1 Running 0 28m kube-system kube-proxy-hv2wc 1/1 Running 0 29m kube-system kube-scheduler-minikube 1/1 Running 0 28m kube-system storage-provisioner 1/1 Running 1 29m</code> </pre> <br><h3 id="ustanovka-openfaas">  Installer OpenFaaS </h3><br><p>  Les d√©veloppeurs recommandent de cr√©er 2 espaces de noms pour le travail: </p><br><pre> <code class="plaintext hljs">$ kubectl apply -f https://raw.githubusercontent.com/openfaas/faas-netes/master/namespaces.yml namespace/openfaas created namespace/openfaas-fn created</code> </pre> <br><p>  Ajoutez un r√©f√©rentiel pour Helm: </p><br><pre> <code class="plaintext hljs">$ helm repo add openfaas https://openfaas.github.io/faas-netes/ "openfaas" has been added to your repositories</code> </pre> <br><p>  Le graphique a la possibilit√© de d√©finir un mot de passe avant l'installation, de l'utiliser et d'enregistrer les donn√©es d'acc√®s sous la forme d'un secret k8s: </p><br><pre> <code class="plaintext hljs">$ PASSWORD=verysecurerandompasswordstring $ kubectl -n openfaas create secret generic basic-auth --from-literal=basic-auth-user=admin --from-literal=basic-auth-password="$PASSWORD" secret/basic-auth created</code> </pre> <br><p>  D√©ployer: </p><br><pre> <code class="plaintext hljs">$ helm repo update Hang tight while we grab the latest from your chart repositories... ...Successfully got an update from the "openfaas" chart repository Update Complete. Happy Helming! $ helm upgrade openfaas --install openfaas/openfaas --namespace openfaas --set functionNamespace=openfaas-fn --set generateBasicAuth=false Release "openfaas" does not exist. Installing it now. NAME: openfaas LAST DEPLOYED: Fri Dec 25 10:28:22 2019 NAMESPACE: openfaas STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: To verify that openfaas has started, run: kubectl -n openfaas get deployments -l "release=openfaas, app=openfaas"</code> </pre> <br><p>  Apr√®s un certain temps, ex√©cutez la commande propos√©e: </p><br><pre> <code class="plaintext hljs">$ kubectl -n openfaas get deployments -l "release=openfaas, app=openfaas" NAME READY UP-TO-DATE AVAILABLE AGE alertmanager 1/1 1 1 114s basic-auth-plugin 1/1 1 1 114s faas-idler 1/1 1 1 114s gateway 1/1 1 1 114s nats 1/1 1 1 114s prometheus 1/1 1 1 114s queue-worker 1/1 1 1 114s</code> </pre> <br><p>  V√©rifier les performances: </p><br><pre> <code class="plaintext hljs">$ kubectl rollout status -n openfaas deploy/gateway deployment "gateway" successfully rolled out $ kubectl port-forward -n openfaas svc/gateway 8080:8080 &amp; [1] 6985 Forwarding from 127.0.0.1:8080 -&gt; 8080 $ echo -n $PASSWORD | faas-cli login --username admin --password-stdin Calling the OpenFaaS server to validate the credentials... Handling connection for 8080 WARNING! Communication is not secure, please consider using HTTPS. Letsencrypt.org offers free SSL/TLS certificates. credentials saved for admin http://127.0.0.1:8080 $ faas-cli list Function Invocations Replicas</code> </pre> <br><h3 id="ustanovka-mongodb">  Installer Mongodb </h3><br><p>  Nous mettons tout en utilisant la barre: </p><br><pre> <code class="plaintext hljs">$ helm repo add stable https://kubernetes-charts.storage.googleapis.com/ "stable" has been added to your repositories $ helm install stable/mongodb --generate-name NAME: mongodb-1577466908 LAST DEPLOYED: Fri Dec 25 11:15:11 2019 NAMESPACE: default STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: ** Please be patient while the chart is being deployed ** MongoDB can be accessed via port 27017 on the following DNS name from within your cluster: mongodb-1577466908.default.svc.cluster.local To get the root password run: export MONGODB_ROOT_PASSWORD=$(kubectl get secret --namespace default mongodb-1577466908 -o jsonpath="{.data.mongodb-root-password}" | base64 --decode) To connect to your database run the following command: kubectl run --namespace default mongodb-1577466908-client --rm --tty -i --restart='Never' --image bitnami/mongodb --command -- mongo admin --host mongodb-1577466908 --authenticationDatabase admin -u root -p $MONGODB_ROOT_PASSWORD To connect to your database from outside the cluster execute the following commands: kubectl port-forward --namespace default svc/mongodb-1577466908 27017:27017 &amp; mongo --host 127.0.0.1 --authenticationDatabase admin -p $MONGODB_ROOT_PASSWORD</code> </pre> <br><p>  Nous v√©rifions: </p><br><pre> <code class="plaintext hljs">kubectl run --namespace default mongodb-1577466908-client --rm --tty -i --restart='Never' --image bitnami/mongodb --command -- mongo admin --host mongodb-1577466908 --authenticationDatabase admin -u root -p $(kubectl get secret --namespace default mongodb-1577466908 -o jsonpath="{.data.mongodb-root-password}" | base64 --decode) If you don't see a command prompt, try pressing enter. &gt; db.version(); 4.0.14</code> </pre> <br><p>  Appuyez sur ctrl + D pour quitter le conteneur. </p><br><h3 id="nastroyka-emacs">  Configuration d'Emacs </h3><br><p>  En principe, tout √©tait d√©j√† configur√© pour <a href="http://reangdblog.blogspot.com/2016/06/emacs-ide-go.html">cet article</a> , donc je ne peindrai pas en d√©tail. </p><br><h2 id="razbienie-igry-na-funkcii">  Diviser le jeu en fonctions </h2><br><p>  L'interaction avec les fonctions est r√©alis√©e via le protocole http, l'authentification de bout en bout entre les diff√©rentes fonctions est assur√©e par JWT.  Mongodb est utilis√© pour stocker des jetons, ainsi que l'√©tat du jeu, les donn√©es des joueurs, les s√©quences de mouvements de tous les jeux et d'autres informations.  Examinons de plus pr√®s les fonctionnalit√©s les plus int√©ressantes. </p><br><h3 id="registraciya">  Inscription </h3><br><p>  A l'entr√©e de cette fonction se trouve JSON avec un alias de jeu et un mot de passe.  Lorsque cette fonction est appel√©e, l'absence de cet alias est v√©rifi√©e dans la base de donn√©es; si elle est v√©rifi√©e avec succ√®s, l'alias et le hachage de mot de passe sont ins√©r√©s dans la base de donn√©es.  L'inscription est requise pour une participation active au jeu. </p><br><h3 id="vhod">  Se connecter </h3><br><p>  √Ä l'entr√©e de la fonction se trouve JSON avec un alias de jeu et un mot de passe, s'il y a un alias dans la base de donn√©es et que le mot de passe est v√©rifi√© avec succ√®s avec le mot de passe pr√©c√©demment stock√© dans la base de donn√©es, le JWT est retourn√©, qui doit √™tre transmis √† d'autres fonctions lors de leur appel.  Divers enregistrements de service sont √©galement ins√©r√©s dans la base de donn√©es, par exemple l'heure de la derni√®re connexion, etc. </p><br><h3 id="prosmotr-spiska-igr">  Afficher la liste des jeux </h3><br><p>  Tout utilisateur non autoris√© peut demander une liste de tous les jeux sauf ceux actifs.  Un utilisateur autoris√© voit √©galement une liste de jeux actifs.  Le r√©sultat de la fonction est JSON contenant des listes de jeux (identifiant de jeu, nom lisible par l'homme, etc.). </p><br><h3 id="sozdanie-igry">  Cr√©ation de jeux </h3><br><p>  La fonction ne fonctionne qu'avec les utilisateurs autoris√©s, le nombre maximum de joueurs, ainsi que les param√®tres du jeu (par exemple, quels personnages activer dans ce jeu, nombre maximum de joueurs, etc.) sont accept√©s en entr√©e.  Un param√®tre distinct du jeu est la pr√©sence d'un mot de passe pour rejoindre, qui vous permet de cr√©er des jeux non publics.  Par d√©faut, un jeu public est cr√©√©.  Le r√©sultat de l'ex√©cution de la fonction est JSON, dans lequel il y a un champ de r√©ussite de cr√©ation, un identifiant unique pour le jeu, ainsi que d'autres param√®tres. </p><br><h3 id="prisoedinenie-k-igre">  Rejoindre le jeu </h3><br><p>  La fonction ne fonctionne qu'avec les utilisateurs autoris√©s, √† l'entr√©e - l'identifiant du jeu et son mot de passe, s'il s'agit d'un jeu non public, √† la sortie - JSON avec les param√®tres du jeu.  L'utilisateur autoris√© qui a rejoint le jeu, ainsi que le cr√©ateur du jeu, sont alors appel√©s les participants au jeu. </p><br><h3 id="prosmotr-sobytiy-igry">  Afficher les √©v√©nements du jeu </h3><br><p>  Tout utilisateur non autoris√© peut demander une liste d'√©v√©nements de jeux inactifs, et un utilisateur autoris√© peut obtenir une liste d'√©v√©nements et de tout jeu actif.  Un param√®tre suppl√©mentaire √† la fonction peut √™tre le num√©ro d'√©v√©nement que l'utilisateur poss√®de d√©j√†.  Dans ce cas, seuls les √©v√©nements survenus ult√©rieurement seront renvoy√©s dans la liste.  En lan√ßant r√©guli√®rement cette fonction, un utilisateur autoris√© regarde ce qui se passe dans le jeu.  Cette fonction renvoie √©galement une demande d'action √† laquelle l'utilisateur peut r√©pondre √† l'aide de la fonction d'envoi d'un √©v√©nement de jeu. </p><br><h3 id="otpravka-sobytiya-igry">  Envoi de l'√©v√©nement de jeu </h3><br><p>  La fonction ne fonctionne que pour les participants au jeu: la possibilit√© de lancer un jeu, de bouger, de voter, d'√©crire un SMS qui appara√Æt dans la liste des √©v√©nements du jeu, etc. est mise en ≈ìuvre. <br>  L'utilisateur autoris√© qui a cr√©√© le jeu commence la distribution des r√¥les √† tous les participants au jeu, y compris eux-m√™mes, ils doivent confirmer leur r√¥le en utilisant la m√™me fonction.  Une fois tous les r√¥les confirm√©s, le jeu passe automatiquement en mode nuit. </p><br><h3 id="statistika-igry">  Statistiques du jeu </h3><br><p>  La fonction ne fonctionne que pour les participants au jeu, affiche l'√©tat du jeu, la liste et le nombre de joueurs (alias), les r√¥les et leur statut (d√©placement effectu√© ou non), ainsi que d'autres informations.  Comme pour la fonction pr√©c√©dente, tout ne fonctionne que pour les participants au jeu. </p><br><h3 id="periodicheski-zapuskaemye-funkcii">  Ex√©cuter p√©riodiquement des fonctions </h3><br><p>  Si le jeu n'a pas √©t√© lanc√© pendant un certain temps sp√©cifi√© lors de la cr√©ation du jeu, il sera automatiquement supprim√© de la liste des jeux actifs √† l'aide de la fonction de balayage. </p><br><p>  Une autre t√¢che p√©riodique est la commutation forc√©e du mode de jeu de nuit en jour et retour pour les jeux dans lesquels cela ne s'est pas produit pendant le tour (par exemple, un joueur qui doit r√©pondre √† un √©v√©nement de jeu n'a pas envoy√© sa d√©cision pour une raison quelconque). </p><br><h2 id="anons">  Annonce </h2><br><ul><li>  <a href="https://habr.com/ru/company/southbridge/blog/482010/">Pr√©sentation</a> </li><li>  D√©finition de l'environnement de d√©veloppement, division de la t√¢che en fonctions </li><li>  Travailler sur le backend </li><li>  Travail frontal </li><li>  Configuration CI \ CD, organisation de test </li><li>  D√©marrage d'une session d'essai de jeu </li><li>  R√©sum√© </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482752/">https://habr.com/ru/post/fr482752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482736/index.html">Utilisation de TSDuck pour surveiller les flux IP (TS)</a></li>
<li><a href="../fr482740/index.html">Interview pour la position d'un po√®te</a></li>
<li><a href="../fr482742/index.html">Entrer sur le march√© occidental: comment interagir avec les clients</a></li>
<li><a href="../fr482744/index.html">Trouver une balle d'argent: des munitions inhabituelles</a></li>
<li><a href="../fr482748/index.html">Cr√©er une entreprise de r√©servation de taxi √† Duba√Ø: comment lancer une application de taxi centr√©e sur le client comme Careem & Hala?</a></li>
<li><a href="../fr482756/index.html">Est-ce un avenir vert brumeux?</a></li>
<li><a href="../fr482758/index.html">En route vers le clavier parfait</a></li>
<li><a href="../fr482762/index.html">42 000 000 000 de visites. PornHub r√©sume 2019</a></li>
<li><a href="../fr482764/index.html">Rhasspy est une bo√Æte √† outils vocale open source et enti√®rement hors ligne. Reconnaissance de la langue russe. Aucune fuite vers le cloud</a></li>
<li><a href="../fr482766/index.html">√Ä propos de certains probl√®mes de microoptimisation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>