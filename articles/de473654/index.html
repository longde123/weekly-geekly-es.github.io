<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÅ üñêüèæ üéá PHP Composer: Korrigieren Sie Abh√§ngigkeiten ohne Schmerzen üìë üéº üé¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Viele von Ihnen sind wahrscheinlich auf eine Situation gesto√üen, in der ein Fehler vorliegt oder nicht die erforderliche Funktionalit√§t in der Bibliot...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP Composer: Korrigieren Sie Abh√§ngigkeiten ohne Schmerzen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/473654/"><p>  Viele von Ihnen sind wahrscheinlich auf eine Situation gesto√üen, in der ein Fehler vorliegt oder nicht die erforderliche Funktionalit√§t in der Bibliothek oder dem Framework, das Sie verwenden.  Angenommen, Sie waren nicht zu faul und haben eine Pull-Anfrage erstellt.  Sie werden es jedoch nicht sofort akzeptieren, und die n√§chste Ver√∂ffentlichung des Produkts kann in einem Jahr erfolgen. </p><br><p><img src="https://habrastorage.org/webt/jv/ys/9h/jvys9h_dh2zmefozo_xhrosiipo.jpeg" alt="PHP-Komponist: Korrigieren Sie Schadenigkeiten ohne Schmerzen"></p><br><p>  Was tun, wenn Sie die Korrektur dringend auf das Produkt √ºbertragen m√ºssen?  Die naheliegende L√∂sung besteht darin, einen Zweig einer Bibliothek oder eines Frameworks zu verwenden.  Mit Gabeln ist jedoch nicht alles einfach.  Die Verwendung der Vererbung zum √úberschreiben der zu √§ndernden Funktionen ist nicht immer m√∂glich und erfordert h√§ufig gr√∂√üere √Ñnderungen.  Plugins f√ºr Composer, die Abh√§ngigkeiten patchen k√∂nnen, helfen. </p><br><p>  In diesem Artikel werde ich mehr dar√ºber sprechen, warum Gabeln unpraktisch sind, und zwei Plugins f√ºr Composer f√ºr das Patchen von Abh√§ngigkeiten in Betracht ziehen: wie sie sich unterscheiden, wie sie verwendet werden und welche Vorteile sie haben.  Wenn Sie auf √§hnliche Probleme gesto√üen sind oder sich nur fragen, sind Sie bei cat willkommen. <a name="habracut"></a></p><br><p> Das Problem wird am bequemsten anhand eines Beispiels betrachtet.  Angenommen, wir m√∂chten etwas in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PHP-</a> Codeabdeckungsbibliothek √§ndern, die im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PHPUnit-Testframework</a> verwendet wird, um den Grad der Codeabdeckung durch Tests zu messen.  Angenommen, wir m√∂chten so etwas in Version 7.0.8 ( <code>myFix.patch</code> Datei) <code>myFix.patch</code> : </p><br><pre> <code class="diff hljs">diff --git a/src/CodeCoverage.php b/src/CodeCoverage.php index 2c92ae2..514171e 100644 --- a/src/CodeCoverage.php +++ b/src/CodeCoverage.php @@ -190,6 +190,7 @@ public function filter(): Filter */ public function getData(bool $raw = false): array { + // for example some changes here if (!$raw &amp;&amp; $this-&gt;addUncoveredFilesFromWhitelist) { $this-&gt;addUncoveredFilesFromWhitelist(); }</code> </pre> <br><p>  Lassen Sie uns unsere Beispielbibliothek erstellen.  Sei es ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PHP-Composer-Patches-Beispiel</a> .  Die Details hier sind nicht sehr wichtig, aber falls Sie sich entscheiden, die Bibliothek zu sehen, bringe ich die Konsolenausgabe unter den Spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Versteckter Text</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ git clone git@github.com:mougrim/php-composer-patches-example.git   ¬´php-composer-patches-example¬ª‚Ä¶ remote: Enumerating objects: 3, done. remote: Counting objects: 100% (3/3), done. remote: Compressing objects: 100% (2/2), done. remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0  : 100% (3/3), . $ cd php-composer-patches-example/ $ $ composer.phar init --name=mougrim/php-composer-patches-example --description="It's an example for article with using forks and patches for changing dependencies" --author='Mougrim &lt;rinat@mougrim.ru&gt;' --type=library --require='phpunit/phpunit:^8.4.2' --license=MIT --homepage='https://github.com/mougrim/php-composer-patches-example' Welcome to the Composer config generator This command will guide you through creating your composer.json config. Package name (&lt;vendor&gt;/&lt;name&gt;) [mougrim/php-composer-patches-example]: Description [It's an example for article with using forks and patches for changing dependencies]: Author [Mougrim &lt;rinat@mougrim.ru&gt;, n to skip]: Minimum Stability []: Package Type (eg library, project, metapackage, composer-plugin) [library]: License [MIT]: Define your dependencies. Would you like to define your dev dependencies (require-dev) interactively [yes]? no { "name": "mougrim/php-composer-patches-example", "description": "It's an example for article with using forks and patches for changing dependencies", "type": "library", "homepage": "https://github.com/mougrim/php-composer-patches-example", "require": { "phpunit/phpunit": "^8.4.2" }, "license": "MIT", "authors": [ { "name": "Mougrim", "email": "rinat@mougrim.ru" } ] } Do you confirm generation [yes]? yes Would you like to install dependencies now [yes]? yes Loading composer repositories with package information Updating dependencies (including require-dev) Package operations: 29 installs, 0 updates, 0 removals - Installing sebastian/version (2.0.1): Loading from cache - Installing sebastian/type (1.1.3): Loading from cache - Installing sebastian/resource-operations (2.0.1): Loading from cache - Installing sebastian/recursion-context (3.0.0): Loading from cache - Installing sebastian/object-reflector (1.1.1): Loading from cache - Installing sebastian/object-enumerator (3.0.3): Loading from cache - Installing sebastian/global-state (3.0.0): Loading from cache - Installing sebastian/exporter (3.1.2): Loading from cache - Installing sebastian/environment (4.2.2): Loading from cache - Installing sebastian/diff (3.0.2): Loading from cache - Installing sebastian/comparator (3.0.2): Loading from cache - Installing phpunit/php-timer (2.1.2): Loading from cache - Installing phpunit/php-text-template (1.2.1): Loading from cache - Installing phpunit/php-file-iterator (2.0.2): Loading from cache - Installing theseer/tokenizer (1.1.3): Loading from cache - Installing sebastian/code-unit-reverse-lookup (1.0.1): Loading from cache - Installing phpunit/php-token-stream (3.1.1): Loading from cache - Installing phpunit/php-code-coverage (7.0.8): Loading from cache - Installing doctrine/instantiator (1.2.0): Loading from cache - Installing symfony/polyfill-ctype (v1.12.0): Loading from cache - Installing webmozart/assert (1.5.0): Loading from cache - Installing phpdocumentor/reflection-common (2.0.0): Loading from cache - Installing phpdocumentor/type-resolver (1.0.1): Loading from cache - Installing phpdocumentor/reflection-docblock (4.3.2): Loading from cache - Installing phpspec/prophecy (1.9.0): Loading from cache - Installing phar-io/version (2.0.1): Loading from cache - Installing phar-io/manifest (1.0.3): Loading from cache - Installing myclabs/deep-copy (1.9.3): Loading from cache - Installing phpunit/phpunit (8.4.2): Loading from cache sebastian/global-state suggests installing ext-uopz (*) phpunit/phpunit suggests installing phpunit/php-invoker (^2.0.0) phpunit/phpunit suggests installing ext-soap (*) Writing lock file Generating autoload files $ $ echo 'vendor/' &gt; .gitignore $ echo 'composer.lock' &gt;&gt; .gitignore $ git add .gitignore composer.json $ $ git commit --gpg-sign --message='Init composer' [master ce800ae] Init composer 2 files changed, 18 insertions(+) create mode 100644 .gitignore create mode 100644 composer.json $ git push origin master  : 4, . Delta compression using up to 4 threads.  : 100% (3/3), .  : 100% (4/4), 1.21 KiB | 1.21 MiB/s, . Total 4 (delta 0), reused 0 (delta 0) To github.com:mougrim/php-composer-patches-example.git f31c342..ce800ae master -&gt; master</code> </pre> </div></div><br><h2 id="chto-ne-tak-s-forkom-zavisimosti">  Was ist los mit einer Suchtgabel? </h2><br><p>  Mal sehen, wie Gabelabh√§ngigkeit auftritt.  Versuchen wir, die PHP-Code-Abdeckung zu teilen. </p><br><ol><li>  Wir gehen zur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Seite PHP Code Coverage auf GitHub</a> . </li><li>  Dr√ºcken Sie die Gabel-Taste <img src="https://habrastorage.org/webt/qj/ff/ta/qjfftaa4kurvcfu91mlrvr2twie.png" alt="Gabelknopf">  (Hinweis: Sie haben Ihre Gabel, ersetzen Sie Mougrim durch Ihren Benutzernamen). </li><li>  Klonen Sie die Gabel: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:mougrim/php-code-coverage.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-code-coverage</code> </pre> </li><li>  Gehen Sie zu der Version, die wir patchen m√∂chten: <br><pre> <code class="bash hljs">git checkout 7.0.8</code> </pre> </li><li>  Erstellen Sie einen Zweig f√ºr die Korrektur: <br><pre> <code class="bash hljs">git checkout -b 7.0.8-myFix</code> </pre> </li><li>  Wir nehmen die notwendigen √Ñnderungen vor, verpflichten uns, dr√§ngen: <br><pre> <code class="bash hljs">git apply ../myFix.patch git add src/CodeCoverage.php git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'My fix'</span></span> git push -u origin 7.0.8-myFix</code> </pre> </li><li>  F√ºgen Sie fork als Repository in composer.json f√ºr unsere Bibliothek hinzu (dies ist erforderlich, damit beim Verbinden des <code>phpunit/php-code-coverage</code> Pakets nicht das Originalpaket, sondern der Fork verbunden wird): <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout -b useFork composer.phar config repositories.phpunit/php-code-coverage vcs https://github.com/mougrim/php-code-coverage.git</code> </pre> </li><li>  √Ñndern Sie die Version f√ºr die Abh√§ngigkeit in Brunch: <br><pre> <code class="bash hljs">composer.phar require phpunit/php-code-coverage <span class="hljs-string"><span class="hljs-string">'dev-7.0.8-myFix'</span></span></code> </pre> </li></ol><br><p>  Aber eigentlich ist es noch komplizierter: Composer sagt, dass die Installation unm√∂glich ist, da f√ºr <code>phpunit/phpunit</code> die Version <code>^7.0.7</code> f√ºr <code>phpunit/php-code-coverage</code> <code>^7.0.7</code> ist und f√ºr unser Projekt <code>dev-7.0.8-myFix</code> : </p><br><pre> <code class="plaintext hljs">$ composer.phar require phpunit/php-code-coverage 'dev-7.0.8-myFix' ./composer.json has been updated Loading composer repositories with package information Updating dependencies (including require-dev) Your requirements could not be resolved to an installable set of packages. Problem 1 - phpunit/phpunit 8.4.2 requires phpunit/php-code-coverage ^7.0.7 -&gt; satisfiable by phpunit/php-code-coverage[7.0.x-dev]. - phpunit/phpunit 8.4.2 requires phpunit/php-code-coverage ^7.0.7 -&gt; satisfiable by phpunit/php-code-coverage[7.0.x-dev]. - phpunit/phpunit 8.4.2 requires phpunit/php-code-coverage ^7.0.7 -&gt; satisfiable by phpunit/php-code-coverage[7.0.x-dev]. - Can only install one of: phpunit/php-code-coverage[7.0.x-dev, dev-7.0.8-myFix]. - Installation request for phpunit/php-code-coverage dev-7.0.8-myFix -&gt; satisfiable by phpunit/php-code-coverage[dev-7.0.8-myFix]. - Installation request for phpunit/phpunit ^8.4.2 -&gt; satisfiable by phpunit/phpunit[8.4.2]. Installation failed, reverting ./composer.json to its original content.</code> </pre> <br><p>  Was tun?  Es gibt vier M√∂glichkeiten: </p><br><ol><li>  <code>phpunit/php-code-coverage</code> zus√§tzlich zur Gabel <code>phpunit/php-code-coverage</code> PHPUnit und schreiben Sie die Version <code>dev-7.0.8-myFix</code> f√ºr die Abh√§ngigkeit <code>phpunit/php-code-coverage</code> .  Dieser Pfad ist in Bezug auf die Unterst√ºtzung ziemlich kompliziert und je komplizierter, desto mehr Bibliotheken h√§ngen von der <code>phpunit/php-code-coverage</code> von <code>phpunit/php-code-coverage</code> . </li><li>  Verwenden Sie einen <a href="">Alias,</a> wenn Sie <code>phpunit/php-code-coverage</code> .  Aliase werden jedoch nicht aus den Abh√§ngigkeiten gezogen, was bedeutet, dass sie immer manuell geschrieben werden m√ºssen. </li><li>  <code>phpunit/php-code-coverage</code> in Ihrer Gabel eine <code>phpunit/php-code-coverage</code> sodass das <code>7.0.8</code> Tag <code>7.0.8</code> anderes Commit <code>7.0.8</code> .  Dies ist zumindest nicht offensichtlich, aber maximal - in Git ist es unpraktisch, mit Tags zu arbeiten, die auf verschiedene Commits mit demselben Namen in verschiedenen Remote-Repositorys verweisen. </li><li>  <code>phpunit/php-code-coverage</code> in Ihrer Fork- <code>phpunit/php-code-coverage</code> das Alpha-Release-Tag, z. B. <code>7.0.8-a+myFix</code> (es kann zu Kollisionen mit Alpha-Releases der <code>7.0.8-a+myFix</code> kommen). </li></ol><br><p>  Alle Optionen haben ihre Nachteile.  Ich habe auch versucht, ein Tag wie <code>7.0.8.1</code> , aber Composer akzeptiert solche Tags nicht. </p><br><p>  Die zweite und vierte Option scheinen das geringere √úbel zu sein.  Aufgrund der Anzahl der Aktionen, die ungef√§hr gleich sind, werden wir in diesem Artikel nur eine - die vierte - betrachten.  Erstellen Sie ein Alpha-Release-Tag: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-code-coverage git tag 7.0.8<span class="hljs-_"><span class="hljs-_">-a</span></span>+myFix git push origin 7.0.8<span class="hljs-_"><span class="hljs-_">-a</span></span>+myFix <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example composer.phar require phpunit/php-code-coverage <span class="hljs-string"><span class="hljs-string">'7.0.8-a+myFix'</span></span> git add composer.json git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'Use fork'</span></span> git push -u origin useFork</code> </pre> <br><p>  <code>mougrim/php-composer-patches-example</code> , wir m√∂chten unser Beispiel f√ºr die Bibliothek <code>mougrim/php-composer-patches-example</code> in einem Projekt verwenden, das von <code>phpunit/phpunit</code> .  Hier kann man nicht ohne Schamanismus <code>phpunit/php-code-coverage</code> , man muss erneut das Repository <code>https://github.com/mougrim/php-code-coverage.git</code> f√ºr <code>phpunit/php-code-coverage</code> angeben sowie explizit die Abh√§ngigkeit von <code>phpunit/php-code-coverage</code> Version <code>7.0.8-a+myFix</code> (andernfalls wird die Installation nicht erfolgreich sein): </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ mkdir php-project <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-project/ composer.phar require phpunit/phpunit <span class="hljs-string"><span class="hljs-string">'^8.4.2'</span></span> composer.phar config repositories.mougrim/php-composer-patches-example vcs https://github.com/mougrim/php-composer-patches-example.git composer.phar config repositories.phpunit/php-code-coverage vcs https://github.com/mougrim/php-code-coverage.git composer.phar require phpunit/php-code-coverage 7.0.8<span class="hljs-_"><span class="hljs-_">-a</span></span>+myFix composer.phar require mougrim/php-composer-patches-example dev-useFork</code> </pre> <br><p>  Bitte beachten Sie, dass PHP-Composer-Patches-Beispiel als Repository verbunden ist, da dieses Repository nur ein Beispiel ist und daher nicht zu Packagist hinzugef√ºgt wurde.  In Ihrem Fall wird dieser Schritt h√∂chstwahrscheinlich √ºbersprungen. </p><br><p>  Um die Verwendung von Gabeln zusammenzufassen. </p><br><p>  Die Vorteile dieses Ansatzes: </p><br><ul><li>  Es m√ºssen keine Plugins f√ºr Composer installiert werden. </li></ul><br><p>  Nachteile dieses Ansatzes: </p><br><ul><li>  Wenn Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>roave/security-advisories</code></a> , werden keine Informationen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>roave/security-advisories</code></a> , dass die Version der Abh√§ngigkeit, die Sie gegabelt und ge√§ndert haben, eine Sicherheitsanf√§lligkeit enth√§lt. </li><li>  Wenn eine neue Version der Abh√§ngigkeit herauskommt, muss die Fork-Story erneut wiederholt werden. </li><li>  Wenn Sie eine Abh√§ngigkeitsabh√§ngigkeit wie im betrachteten Beispiel beheben m√∂chten, <code>dev-*</code> nicht und Sie m√ºssen mit Versionen oder Fork f√ºr widerspr√ºchliche Abh√§ngigkeiten schamanisieren. </li><li>  Wenn es Projekte gibt, die von Ihrer Bibliothek abh√§ngen, m√ºssen Sie die Bibliothek nicht auf die offensichtlichste und bequemste Weise im Projekt installieren. </li><li>  Wenn es Projekte gibt, die von Ihrer Bibliothek abh√§ngen, wird f√ºr sie die <code>phpunit/php-code-coverage</code> streng festgelegt, was nicht immer akzeptabel ist. </li><li>  Wenn die Projekte aus den oben genannten Punkten die Abdeckung von PHP-Code bereits aus einem anderen Grund verzweigten, wird alles noch komplizierter. </li></ul><br><p>  Ich denke, Sie haben bereits erkannt, dass es keine so gute Idee ist, Sucht zu forken. </p><br><h2 id="ispolzovanie-cweaganscomposer-patches">  Verwenden von Cweagans / Composer-Patches </h2><br><p>  Ich hatte wieder einmal Schmerzen und litt unter der Verwendung von Gabeln. In <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PHP Digest Nr. 101</a> stie√ü ich auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>cweagans/composer-patches</code></a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Pronskiy hat √ºbrigens einen</a> n√ºtzlichen Blog, ich empfehle, ihn zu abonnieren).  Dies ist ein Plugin f√ºr omposer, mit dem Sie Patches auf Abh√§ngigkeiten anwenden k√∂nnen.  Nachdem ich die Beschreibung gelesen hatte, dachte ich, dass dies genau das ist, was Sie brauchen. </p><br><p>  Verwendung von Cweagans / Composer-Patches: </p><br><ol><li>  Klonen Sie die PHP-Code-Abdeckung: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ rm -rf php-code-coverage git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:sebastianbergmann/php-code-coverage.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-code-coverage</code> </pre> </li><li>  Gehen Sie zu der Version, die wir patchen m√∂chten: <br><pre> <code class="bash hljs">git checkout 7.0.8</code> </pre> </li><li>  Wir nehmen die notwendigen √Ñnderungen vor. </li><li>  Erstellen Sie einen Patch: <br><pre> <code class="bash hljs">mkdir -p ../php-composer-patches-example/patches/phpunit/php-code-coverage git diff HEAD &gt; ../php-composer-patches-example/patches/phpunit/php-code-coverage/myFix.patch</code> </pre> </li><li>  In unserem Projekt verbinden wir <code>cweagans/composer-patches</code> : <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout master composer.phar update git checkout -b cweagansComposerPatches composer.phar require cweagans/composer-patches <span class="hljs-string"><span class="hljs-string">'^1.6.7'</span></span></code> </pre> </li><li>  <code>cweagans/composer-patches</code> zur Konfiguration von <code>cweagans/composer-patches</code> Folgendes zu <code>composer.json</code> (Sie k√∂nnen mehrere Patches f√ºr ein Paket angeben): <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"config"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"preferred-install"</span></span>: <span class="hljs-string"><span class="hljs-string">"source"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"patches"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"phpunit/php-code-coverage"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"My fix description"</span></span>: <span class="hljs-string"><span class="hljs-string">"patches/phpunit/php-code-coverage/myFix.patch"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"enable-patching"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> </li><li>  Abh√§ngigkeiten aktualisieren: <br><pre> <code class="bash hljs">composer.phar update</code> </pre> </li><li>  Wenn etwas schief gelaufen ist, wird dies in der Ausgabe des vorherigen Befehls angezeigt. F√ºr alle F√§lle k√∂nnen Sie jedoch √ºberpr√ºfen, ob unsere √Ñnderungen √ºbernommen wurden: <br><pre> <code class="plaintext hljs">$ grep example vendor/phpunit/php-code-coverage/src/CodeCoverage.php // for example some changes here</code> </pre> </li><li>  √úbernehmen und pushen Sie das Ergebnis: <br><pre> <code class="bash hljs">git add composer.json patches/phpunit/php-code-coverage/myFix.patch git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'Use cweagans/composer-patches'</span></span> git push -u origin cweagansComposerPatches</code> </pre> </li></ol><br><p>  Wir stellen sicher, dass bei der Installation unserer Bibliothek im Projekt auch der Patch angewendet wird. </p><br><p>  Erstellen Sie ein Projekt: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ rm -rf php-project mkdir php-project <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-project composer.phar require phpunit/phpunit <span class="hljs-string"><span class="hljs-string">'^8.4.2'</span></span></code> </pre> <br><p>  F√ºgen Sie <code>composer.json</code> die folgenden Zeilen hinzu: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"enable-patching"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Installiere <code>mougrim/php-composer-patches-example</code> : </p><br><pre> <code class="bash hljs">composer.phar config repositories.mougrim/php-composer-patches-example vcs https://github.com/mougrim/php-composer-patches-example.git composer.phar require mougrim/php-composer-patches-example dev-cweagansComposerPatches</code> </pre> <br><p>  Es scheint, dass beim Anschlie√üen des Pakets versucht werden sollte, den Patch anzuwenden, aber nein. <br>  Wir aktualisieren die Pakete so, dass der Patch angewendet wird, aber dies passiert nicht: </p><br><pre> <code class="plaintext hljs">$ composer.phar update Removing package phpunit/php-code-coverage so that it can be re-installed and re-patched. - Removing phpunit/php-code-coverage (7.0.8) Loading composer repositories with package information Updating dependencies (including require-dev) Package operations: 1 install, 0 updates, 0 removals No patches supplied. Gathering patches for dependencies. This might take a minute. - Installing phpunit/php-code-coverage (7.0.8): Loading from cache - Applying patches for phpunit/php-code-coverage patches/phpunit/php-code-coverage/myFix.patch (My fix description) Could not apply patch! Skipping. The error was: The "patches/phpunit/php-code-coverage/myFix.patch" file could not be downloaded: failed to open stream: No such file or directory Writing lock file Generating autoload files</code> </pre> <br><p>  Nachdem ich in einem Bug-Tracker gest√∂bert hatte, stellte ich fest, dass ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dateibasierter Patch nicht im Abh√§ngigkeitsfehler behoben wurde</a> .  Es stellt sich heraus, dass Sie entweder die URL vor dem Patch angeben m√ºssen (dh von irgendwoher herunterladen) oder den Pfad zum Patch in jedem Projekt manuell angeben m√ºssen, in dem Sie eine Abh√§ngigkeit installieren, f√ºr die Patches erforderlich sind. </p><br><p>  Um die Verwendung von <code>cweagans/composer-patches</code> . </p><br><p>  Die Vorteile dieses Ansatzes: </p><br><ul><li>  Das Plugin hat eine Community. </li><li>  <code>roave/security-advisories</code> werden nicht aufh√∂ren zu arbeiten; </li><li>  Wenn eine neue Version der Abh√§ngigkeit ver√∂ffentlicht wird und der Patch erfolgreich angewendet wird, reicht es aus, um sicherzustellen, dass alles mit der neuen Version funktioniert (bei kleineren Versionen funktioniert es mit hoher Wahrscheinlichkeit ganz von selbst, bei gr√∂√üeren Versionen ist es auch wahrscheinlich, dass nichts unternommen wird). </li><li>  Wenn es Projekte gibt, die von Ihrer Bibliothek abh√§ngen, wird f√ºr sie die Version von <code>phpunit/php-code-coverage</code> nicht streng festgelegt. </li><li>  Dar√ºber hinaus kann ein solches Projekt im Fall des obigen Absatzes seine Patches in PHP Code Coverage anwenden. </li></ul><br><p>  Nachteile: </p><br><ul><li>  Dies ist ein Plugin f√ºr Composer. Dies bedeutet, dass es beim Aktualisieren von Composer m√∂glicherweise kaputt geht. </li><li>  <code>enable-patching=true</code> muss angegeben werden, damit Patches aus Abh√§ngigkeiten angewendet werden. </li><li>  Der Hauptprojektbetreuer hat nicht viel Zeit, um sich damit zu befassen. Daher akzeptiert er in der Regel Pull-Anfragen, entwickelt das Projekt jedoch nicht besonders weiter (zum Beispiel hatte er Ideen f√ºr die zweite Version der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgabe</a> , aber nach drei Jahren hat sich wenig ge√§ndert). </li><li>  Es gibt einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dateibasierten Patch, der nicht im Abh√§ngigkeitsfehler behoben wurde.</a> Dies ist unpraktisch und h√§ngt seit drei Jahren im Backlog. </li><li>  Sie k√∂nnen keine unterschiedlichen Patches f√ºr unterschiedliche Versionen von Abh√§ngigkeiten verwenden. </li></ul><br><p>  Der letzte Punkt ist f√ºr mich zu einer Barriere geworden.  Zuerst habe ich eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Feature-Anfrage gestellt</a> .  Der Betreuer schrieb, dass er diese Funktion nicht zum Hauptcode hinzuf√ºgen wollte, aber in der zweiten Version w√§re es m√∂glich, ein Plug-In zu schreiben (ja, ein Plug-In f√ºr das Plug-In f√ºr Composer).  Die Aussichten f√ºr die zweite Version waren vage, daher entschied ich mich, nach Alternativen zu suchen.  In der kleinen Liste habe ich kein Plugin gefunden, das unterst√ºtzt werden w√ºrde. </p><br><p>  Ich wollte nicht in den Plugin-Code einsteigen, also habe ich mich f√ºr Gabeln entschieden - sicher war jemand bereits auf das Problem gesto√üen und hat es gel√∂st. </p><br><h2 id="ispolzovanie-vaimo-composer-patches">  Verwenden von Vaimo Composer-Patches </h2><br><p>  Bei den meisten Gabeln gab es √ºberhaupt keine Unterschiede zum Original (warum gabeln sie sich √ºberhaupt?).  Ein Teil der Gabeln wurde f√ºr Pull-Anfragen erstellt, die bereits mit der Hauptbibliothek zusammengef√ºhrt wurden.  Es gab jedoch einen interessanten Kandidaten, der mein Problem l√∂ste - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vaimo Composer Patches</a> .  Zu dieser Zeit war es noch als Gabel gerahmt, aber sein Betreuer schien keine Pull-Anfragen zu stellen.  So hat er beispielsweise bereits den Paketnamen in <code>vaimo/composer-patches</code> ge√§ndert.  Aber es gab ein Problem: Probleme wurden deaktiviert, das hei√üt, es gab √ºberhaupt kein Feedback vom Autor.  Au√üerdem wurde das Plugin nicht auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Packagist</a> gehostet. </p><br><p>  Eine so gute Gabel sollte nicht in einem Stapel anderer nutzloser Gabeln verloren gehen.  Daher habe ich den Autor mit der Bitte kontaktiert, Probleme zu aktivieren und Packagist ein Paket hinzuzuf√ºgen.  Nach fast einem Monat antwortete der Autor und tat dies alles.  :) </p><br><p>  Die Verwendung von <code>vaimo/composer-patches</code> nicht von der Verwendung des vorherigen Plugins, Sie k√∂nnen jedoch verschiedene Patches f√ºr verschiedene Versionen angeben. </p><br><ol><li>  Wir f√ºhren ein <code>cweagans/composer-patches</code> unserer Bibliothek durch (das L√∂schen des <code>vendor</code> Ordners ist erforderlich, da die Plugins <code>cweagans/composer-patches</code> und <code>vaimo/composer-patches</code> nicht sehr kompatibel sind): <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout master rm -rf vendor/ composer.phar update</code> </pre> </li><li>  Wir f√ºhren die Punkte 1-4 aus dem vorherigen Abschnitt aus. </li><li>  In unserem Projekt verbinden wir <code>vaimo/composer-patches</code> : <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../php-composer-patches-example git checkout -b vaimoComposerPatches composer.phar require vaimo/composer-patches <span class="hljs-string"><span class="hljs-string">'^4.20.2'</span></span></code> </pre> </li><li>  <code>vaimo/composer-patches</code> zur Konfiguration von <code>vaimo/composer-patches</code> Folgendes zu <code>composer.json</code> (die Dokumentation finden Sie <a href="">hier</a> ): <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"patches"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"phpunit/php-code-coverage"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"My fix description"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"&lt; 7.0.0"</span></span>: <span class="hljs-string"><span class="hljs-string">"patches/phpunit/php-code-coverage/myFix-leagcy.patch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"&gt;= 7.0.0"</span></span>: <span class="hljs-string"><span class="hljs-string">"patches/phpunit/php-code-coverage/myFix.patch"</span></span> } } } } }</code> </pre> </li><li>  Abh√§ngigkeiten aktualisieren: <br><pre> <code class="bash hljs">composer.phar update</code> </pre> </li><li>  Wenn etwas schief gelaufen ist, wird dies in der Ausgabe des vorherigen Befehls angezeigt. F√ºr alle F√§lle k√∂nnen Sie jedoch sicherstellen, dass unsere √Ñnderungen √ºbernommen werden: <br><pre> <code class="plaintext hljs">$ grep example vendor/phpunit/php-code-coverage/src/CodeCoverage.php // for example some changes here</code> </pre> </li><li>  √úbernehmen und pushen Sie das Ergebnis: <br><pre> <code class="bash hljs">git add composer.json patches/phpunit/php-code-coverage/myFix.patch git commit --gpg-sign --message=<span class="hljs-string"><span class="hljs-string">'Use vaimo/composer-patches'</span></span> git push -u origin vaimoComposerPatches</code> </pre> </li></ol><br><p>  Wir stellen sicher, dass bei der Installation unserer Bibliothek im Projekt auch der Patch angewendet wird. </p><br><p>  Erstellen Sie ein Projekt und installieren Sie <code>mougrim/php-composer-patches-example</code> : </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ rm -rf php-project mkdir php-project <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-project composer.phar require phpunit/phpunit <span class="hljs-string"><span class="hljs-string">'^8.4.2'</span></span> composer.phar config repositories.mougrim/php-composer-patches-example vcs https://github.com/mougrim/php-composer-patches-example.git composer.phar require mougrim/php-composer-patches-example dev-vaimoComposerPatches</code> </pre> <br><p>  F√ºr alle F√§lle k√∂nnen Sie sicherstellen, dass unsere √Ñnderungen √ºbernommen wurden: </p><br><pre> <code class="plaintext hljs">$ grep example vendor/phpunit/php-code-coverage/src/CodeCoverage.php // for example some changes here</code> </pre> <br><p>  Um die Verwendung von <code>vaimo/composer-patches</code> . </p><br><p>  Die Vorteile dieses Plugins sind fast dieselben wie bei den vorherigen, umfassen jedoch auch Folgendes: </p><br><ul><li>  Der Betreuer entwickelt das Plugin aktiv und hat bereits die vierte Hauptversion ver√∂ffentlicht. </li><li>  Es ist nicht erforderlich, zus√§tzlich Patches aus Abh√§ngigkeiten vorzuschreiben. </li><li>  Sie k√∂nnen verschiedene Patches f√ºr verschiedene Versionen von Abh√§ngigkeiten verwenden. </li><li>  Das Plugin verf√ºgt √ºber viele Einstellungen. Wenn Ihnen die im Artikel beschriebene Funktionalit√§t nicht ausreicht, lesen Sie die Dokumentation - m√∂glicherweise ist die von Ihnen ben√∂tigte Funktion bereits implementiert. </li></ul><br><p>  Nachteile: </p><br><ul><li>  Wie das vorherige ist dies ein Plugin f√ºr Composer, was bedeutet, dass es beim Aktualisieren von Composer m√∂glicherweise kaputt geht. </li><li>  Im Gegensatz zum vorherigen Plugin hat diese Community weniger. </li></ul><br><h2 id="vyvody">  Schlussfolgerungen </h2><br><p>  Um die allgemeinen Ergebnisse zusammenzufassen: </p><br><ul><li>  Die Verwendung von Paketgabeln f√ºr kleinere Korrekturen ist unpraktisch. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>cweagans/composer-patches</code></a> ist ein gutes Plugin, entwickelt sich aber schlecht, daher empfehle ich es nicht </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vaimo Composer Patches</a> ist ein hervorragendes Plugin, das das Problem der Behebung von Abh√§ngigkeiten gut l√∂st und au√üerdem eine Reihe von Einstellungen enth√§lt. </li><li>  Vaimo Composer Patches hat eine kleine Community, aber ich hoffe, dieser Artikel wird sie erweitern. </li><li>  Wenn in der Abh√§ngigkeit viele √Ñnderungen erforderlich sind, ist es m√∂glicherweise einfacher, auf eine harte Gabel zur√ºckzugreifen (halten Sie die Gabel unabh√§ngig von der urspr√ºnglichen Abh√§ngigkeit). </li></ul><br><p>  Ich habe auch eine indirekte Schlussfolgerung gezogen: Wenn eine Art von Abh√§ngigkeit nicht die erforderliche Funktionalit√§t bietet, gibt es m√∂glicherweise Gabeln, die diese Funktionalit√§t implementiert haben, und noch mehr. </p><br><p>  Bei Badoo verwenden wir Vaimo Composer Patches in zwei F√§llen: </p><br><ul><li>  in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SoftMocks</a> zum Patchen von PHPUnit und PHP Code Coverage; </li><li>  im internen Repository f√ºr den Webmozart <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Assert-Fix</a> zur Kompatibilit√§t mit SoftMocks als tempor√§ren Fix (w√§hrend SoftMocks keine <code>array_map(array('static', 'valueToString')</code> Konstruktionen unterst√ºtzen <code>array_map(array('static', 'valueToString')</code> ). </li></ul><br><p>  Rinat Akhmadeev, Sr.  PHP-Entwickler </p><br><p>  <strong>UPD1</strong> : Danke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">BoShurik</a> f√ºr den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> zu <a href="">Aliasen</a> .  Dem Artikel wurde ein Punkt √ºber Aliase hinzugef√ºgt. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473654/">https://habr.com/ru/post/de473654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473640/index.html">Big Data Sonnenuntergang</a></li>
<li><a href="../de473642/index.html">Cribble Crabble Gradle: Magie automatisch aufbauen</a></li>
<li><a href="../de473646/index.html">Hackathon in einer kleinen Firma: Wie man arrangiert, ohne einen Zug von Ressourcen zu entsorgen</a></li>
<li><a href="../de473648/index.html">Das Pferd ist totschrei: √úbergang von Tslint zu Eslint</a></li>
<li><a href="../de473652/index.html">Erstellen einer REST-API mit Node.js und einer Oracle-Datenbank. Teil 5</a></li>
<li><a href="../de473656/index.html">Hugo Static Site Generator Erfahrung</a></li>
<li><a href="../de473658/index.html">Umgang mit Fehlern in Go 1.13</a></li>
<li><a href="../de473660/index.html">Arcade Reverse Engineering: Nehmen Sie Michael Jordan bei NBA Jam auf</a></li>
<li><a href="../de473664/index.html">Lernerfahrung aus erster Hand. Yandex.Practicum - Datenanalyst</a></li>
<li><a href="../de473666/index.html">Als Science-Fiction-Autor h√§tte Arthur Clark die Zeitschrift Tech - Youth fast geschlossen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>