<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥“ ğŸ‘¨ğŸ½â€ğŸ­ ğŸ¤°ğŸ¾ KeeBee Membuat keyboard USB Anda sendiri dari awal ğŸ›ƒ ğŸ–•ğŸ¼ ğŸ‘©ğŸ¼â€ğŸ’¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa bulan yang lalu, proyek saya untuk membuat keyboard USB selesai. Antara lain, saya menyelesaikan desain sirkuit elektronik, merancang papan s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>KeeBee Membuat keyboard USB Anda sendiri dari awal</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441032/">  Beberapa bulan yang lalu, proyek saya untuk membuat keyboard USB selesai.  Antara lain, saya menyelesaikan desain sirkuit elektronik, merancang papan sirkuit cetak, memprogram firmware, membuat tata letak dalam CAD dan memasang perangkat.  Hasilnya adalah keyboard yang nyaman yang saya gunakan setiap hari dan memanggil KeeBee dengan penuh kasih: <br><br> <a href=""><img src="https://habrastorage.org/webt/ad/2w/y9/ad2wy9hofgppmzgmk_a7fqobizo.jpeg"></a> <br>  <i><font color="gray">Final Keyboard KeeBee</font></i> <br><br>  Beberapa tujuan proyek: <br><br><ol><li>  Penciptaan skema ini sendiri. <br></li><li>  Menulis firmware keyboard. <br></li><li>  Pelajari cara kerja protokol USB. </li></ol><a name="habracut"></a><br>  Di tempat kerja, saya terutama mengembangkan perangkat lunak untuk layanan cloud, di mana banyak lapisan peralatan nyata hilang.  Oleh karena itu, sangat bagus untuk menghilangkan beberapa abstraksi dan turun ke tingkat perangkat keras: berikut adalah perangkat elektronik nyata yang dapat Anda sentuh dan gunakan. <br><br><h1>  Belajar dan tata letak CAD </h1><br>  Saya sangat suka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OLKB</a> Planck minimalis dan keyboard gaya Preonic, yang, karena pengaturan orto-linear dari tombol, sangat kompak.  Saya juga langsung tahu bahwa saya ingin menggunakan sakelar Cherry MX Brown.  Dengan mempertimbangkan dua komponen desain ini, saya mulai bermain dengan layout kunci di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OpenSCAD</a> .  Ini adalah alat open source yang hebat yang bekerja lebih seperti bahasa pemrograman daripada antarmuka mouse WYSIWYG. <br><br>  Mengambil ukuran elemen dari dokumentasi Cherry MX, saya <a href="">membuat tata letak pelat atas</a> , lalu menambahkan sakelar dan tombol untuk mendapatkan gambaran seperti apa hasil akhirnya.  Pelat atas terletak di atas papan ketik PCB dan berfungsi sebagai penstabil yang baik untuk sakelar. <br><br>  Desain pelat atas: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dd7/e5c/0d0/dd7e5c0d0f409136cd386b09e6f1cb9b.png"><br><br>  Setelah menambahkan kunci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/247/053/a3e/247053a3edee7464dcaf24b343dc2be4.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6bc/8fb/e4b/6bc8fbe4b1620d728838609fecc836f1.png"><br><br><h1>  Pembuatan prototipe papan dan firmware </h1><br>  Sebagai mikrokontroler utama, saya memilih <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">STM32F042K6T6</a> .  Ini sekitar tiga dolar per keping, jika Anda ambil dari satu potong.  Dia memiliki cukup kontak untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">matriks pemindaian</a> 69 kunci (total 32 kontak).  Ini berjalan pada prosesor ARM Cortex M0 dan berisi periferal USB khusus untuk mengirim sinyal USB tanpa memuat prosesor utama dengan tugas ini.  Saya membeli <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">papan dev prototipe Nucleo</a> dengan chip ini sebelum mengintegrasikannya ke dalam desain PCB saya.  Nucleo dengan sangat nyaman berbaring di atas papan tempat memotong roti dan ditenagai melalui USB. <br><br>  Saya menempatkan sirkuit empat kunci kecil di papan tempat memotong roti untuk menguji <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sirkuit dioda yang</a> saya pelajari.  Mengabaikan sisi USB dari persamaan, langkah pertama adalah membuat sakelar Cherry andal menghidupkan dan mematikan empat LED yang sesuai ketika tombol-tombol ditekan. <br><br><img src="https://habrastorage.org/webt/6z/ks/xw/6zksxwfpdqzy4winp9vk3if_kd0.jpeg"><br><br>  Matriks pemindaian adalah suatu teknik yang perlu Anda gunakan ketika Anda memiliki lebih banyak sakelar daripada kontak pada mikrokontroler. <br><br>  Ketika matriks <a href="">bekerja dengan memuaskan</a> , tiba saatnya untuk bekerja pada USB. <br><br>  Siklus firmware bawaan pada dasarnya adalah ini: <br><br><ol><li>  Pindai semua kunci dalam matriks. <br></li><li>  Cocokkan tata letak tombol dengan karakter yang sesuai dalam tata letak yang dipilih (QWERTY, Dvorak, dll.). <br></li><li>  Ambil hasil perbandingan, hasilkan paket Laporan HID USB dan kirimkan ke perangkat periferal USB. <br></li><li>  Nyalakan LED pada keyboard, jika tombol ditekan, matikan - jika tidak. </li></ol><br>  Dari <a href="">main.cc</a> : <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scan_and_update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ scan_matrix.Scan(key_scans, row_count, column_count); keyboard.SendReport( key_pipeline.MapKeyScans(key_scans, key_count)); update_key_press_status(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Init(); status_led.SetOk(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { scan_and_update(); } }</code> </pre> <br>  Komponen <code>keyboard.SendReport</code> sebenarnya mentransfer paket ke host USB.  Saya berusaha keras agar USB berfungsi dengan baik.  Ada banyak lapisan non-sepele dalam protokol ini yang membutuhkan waktu yang akurat dan <a href="">identifikasi perangkat yang tepat</a> .  Pada akhirnya, saya harus menjalankan Wireshark untuk mendengarkan semua paket USB yang masuk ke laptop Linux saya dan mencari tahu di mana itu hilang.  Pencarian di Internet tidak menghasilkan apa-apa, sebagian besar pertanyaan dijawab seperti ini: "Kemungkinan perangkat USB Anda rusak, Anda perlu membeli yang baru."  Jika Anda benar-benar mencoba <i>merancang</i> perangkat USB, jawaban ini tidak terlalu membantu.  Saya hanya bisa terjun ke spesifikasi USB yang banyak dengan banyak terminologi yang tidak dikenal. <br><br>  Setelah bermain-main sebentar, saya masih membuat keyboard dengan empat tombol dengan benar mengidentifikasi dirinya sebagai USB HID (Perangkat Antarmuka Manusia) dan semua mesin press dipindahkan dengan benar ke laptop: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/901/712/4b7/9017124b76d06f097826194838cc06e2.png"><br><br>  Mendaftar sebagai vendor USB dan mendapatkan id perangkat resmi itu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mahal</a> .  Jika Anda hanya memiliki proyek amatir, maka Anda harus <a href="">mengambil pengidentifikasi dari beberapa perangkat serupa</a> .  Saya pikir "Kepala Gigi" terdengar keren, terutama karena mereka melepaskan keyboard, jadi saya memilih mereka. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/457/e29/628/457e296280138ee96564ca190685c836.png"><br><br><h1>  Sirkuit dan PCB </h1><br>  Setelah menerima kurang lebih firmware yang berfungsi dan prototipe yang berfungsi, saatnya untuk menggambar sirkuit dan desain papan sirkuit di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">KiCAD</a> dan membuat papan sirkuit nyata.  Ketika saya memastikan bahwa rangkaian untuk 4 tombol berfungsi, tugas yang relatif sederhana adalah menghubungkan semuanya bersama-sama: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82c/4e9/047/82c4e9047e47a8b5c7f9d71979fb1643.png"><br><br>  Setelah mengembangkan sirkuit dan memasang bantalan untuk komponen, Anda perlu membuat model papan sirkuit cetak sungguhan: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/433/7db/515/4337db515b6a1672924dc9c0e527b20e.png"><br><br>  KiCAD dapat dengan indah membuat papan masa depan dalam 3D: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b8/73a/15f/6b873a15ffb39ac5033f68bfac74722c.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb3/caa/3bd/bb3caa3bd098b51889b4db0aeebfd4c0.png"><br><br>  Ada banyak tutorial KiCAD yang hebat.  Saya mulai dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">seri</a> video <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Getting to Blinkey 4.0 yang</a> sangat baik dari Chris Gammel, di mana dia menjelaskan secara terperinci semua langkah yang terlibat dalam membuat sirkuit linker LED di KiCAD dari awal hingga selesai. <br><br><h1>  Memesan PCB dan komponen </h1><br>  Setelah membawa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">desain dan desain papan sirkuit</a> ke tingkat yang memuaskan, saya mulai menempatkan banyak pesanan: <br><br><ol><li>  Semua komponen dari <a href="">daftar bahan</a> : sakelar, LED, dioda, mikrokontroler, dll. Saya biasanya memesannya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">DigiKey</a> . <br></li><li>  Papan sirkuit itu sendiri.  Cukup banyak layanan yang siap murah membuat Anda prototipe.  Saya memiliki pengalaman luar biasa dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OshPark</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">JLCPCB</a> .  Untuk proyek ini, saya memilih JLCPCB karena harga untuk ukuran seperti itu, dan juga karena mereka memungkinkan saya untuk memilih lapisan biru. <br></li><li>  Semua detail lainnya: sampul dan barang-barang.  Untuk proyek ini, ipar saya membantu memotong laser pelat keyboard atas dan bawah dari 1/4 "lembaran akrilik.  Untuk komponen lainnya, Anda dapat menggunakan layanan pemotongan laser dan 3D online jika Anda tidak memiliki akses ke peralatan. </li></ol><br>  Hari paket tiba adalah yang terbaik: <br><br><img src="https://habrastorage.org/webt/58/zh/tq/58zhtqbwaxb5-dfy2vxzrkg14uu.jpeg"><br><br><img src="https://habrastorage.org/webt/0e/il/ln/0eillnhgbfcciaovcjl3hwushyq.jpeg"><br><br>  JLCPCB adalah layanan yang sangat terjangkau.  Desain dengan pengiriman DHL dari China ini harganya kurang dari $ 30, dan seluruh proses mulai dari mengunduh file hingga kedatangan paket membutuhkan waktu lebih dari seminggu. <br><br>  Shurin mengambil <a href="">file DXF</a> dari OpenSCAD dan melemparkannya ke dalam pemotong laser: <br><br><img src="https://habrastorage.org/webt/xr/ww/4i/xrww4ips2bdp6lonon3vxcl8dji.jpeg"><br><br><h1>  Perakitan akhir </h1><br>  Setelah menerima semua detail, saya mulai berkumpul.  Langkah pertama adalah merakit komponen PCB: besi solder untuk komponen elektronik besar dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">stasiun solder</a> untuk pemasangan permukaan komponen kecil seperti mikrokontroler STM32. <br><br>  Total waktu perakitan papan adalah sekitar tiga jam - sebagian besar adalah menyolder 70 dioda dan sakelar. <br><br>  Saya menambahkan header untuk debug JTAG, di mana saya menghubungkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">JLINK Edu mini</a> untuk firmware mikrokontroler menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OpenOCD</a> . <br><br>  Maka saatnya untuk pengujian akhir dan perakitan akhir: <br><br><img src="https://habrastorage.org/webt/hy/yx/w3/hyyxw3ukirnhihemampdyqi9fh0.jpeg"><br><br><img src="https://habrastorage.org/webt/jn/te/zv/jntezvouheop_oqkcylzgvriaj4.jpeg"><br><br><img src="https://habrastorage.org/webt/bt/zn/nu/btznnuwjhqasmyfimlchnur8vki.jpeg"><br><br>  Putranya memutuskan bahwa ini adalah kereta yang hebat untuk hewan-hewannya: <br><br><img src="https://habrastorage.org/webt/uy/nl/d1/uynld1ae660x2w5um-nta3rvwvy.jpeg"><br><br><img src="https://habrastorage.org/webt/zs/ih/4w/zsih4wdyjnnzezye3e06row6zyi.jpeg"><br><br><h1>  Ringkasan </h1><br>  Dari ide awal hingga perakitan akhir, proyek ini memakan waktu sekitar tiga bulan.  Itu sangat berguna sebagai hobi untuk melakukan apa yang masih saya gunakan setiap hari di tempat kerja. <br><br>  Semua file proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diterbitkan di GitHub</a> , termasuk sumber firmware, papan sirkuit, daftar bahan dan model CAD. <br><br>  Terima kasih telah membaca dan menikmati retasan! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id441032/">https://habr.com/ru/post/id441032/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id441022/index.html">Kesalahan umum penumpang kereta api dan maskapai penerbangan</a></li>
<li><a href="../id441024/index.html">Kami menulis perayap untuk satu atau dua 1.0</a></li>
<li><a href="../id441026/index.html">VMware NSX untuk yang terkecil. Bagian 2. Mengkonfigurasi Firewall dan NAT</a></li>
<li><a href="../id441028/index.html">Bagaimana para peneliti menemukan database MongoDB dan Elasticsearch yang terbuka</a></li>
<li><a href="../id441030/index.html">Mendeteksi Serangan Web dengan Autoencoder Seq2Seq</a></li>
<li><a href="../id441034/index.html">6 poin pertumbuhan konversi atau cara meningkatkan kepercayaan menggunakan telepon di situs</a></li>
<li><a href="../id441036/index.html">Cara memberi dan menerima umpan balik jika Anda sparrow-sociophobus</a></li>
<li><a href="../id441040/index.html">Menghasilkan ikon multi-platform multi-merek dengan Sketch dan skrip Node.js - Bagian # 1</a></li>
<li><a href="../id441042/index.html">Menghasilkan ikon multi-platform multi-merek dengan Sketch dan skrip Node.js - Bagian # 2</a></li>
<li><a href="../id441044/index.html">Kisah bagaimana kami mengubah ikon PVS-Studio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>