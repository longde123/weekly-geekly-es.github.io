<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‰ ğŸ¤¯ ğŸ–¨ï¸ MVVMå’Œé€‚é…å™¨ä¸­çš„å…ƒç´ é€‰æ‹© ğŸ—ï¸ âŒ¨ï¸ ğŸ‘©ğŸ½â€âœˆï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å…³äºç¬¬ä¸‰ä¸ªè‡ªå†™é€‚é…å™¨ï¼Œåœ¨å…¶ä¸­å¿…é¡»å®ç°è®°ä½æ‰€é€‰å…ƒç´ çš„é€»è¾‘ä¹‹åï¼Œæˆ‘æ›¾æƒ³è¿‡åº”è¯¥æœ‰ä¸€äº›å·²ç»åŒ…å«æ‰€æœ‰å¿…è¦å†…å®¹çš„è§£å†³æ–¹æ¡ˆã€‚ ç‰¹åˆ«æ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‚¨ä¸å¾—ä¸æ›´æ”¹ä»…é€‰æ‹©ä¸€é¡¹ä»¥è¿›è¡Œå¤šé¡¹é€‰æ‹©çš„åŠŸèƒ½ã€‚ 


åœ¨ç ”ç©¶äº†MVVMæ–¹æ³•å¹¶å°†å…¶å®Œå…¨æµ¸å…¥å…¶ä¸­ä¹‹åï¼Œä¸Šè¿°é—®é¢˜å°±æ›´åŠ æ˜æ˜¾åœ°å‡ºç°äº†ã€‚ æ­¤å¤–ï¼Œé€‚é…å™¨æœ¬èº«å¤„äºViewçº§åˆ«ï¼Œè€Œå¯¹...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MVVMå’Œé€‚é…å™¨ä¸­çš„å…ƒç´ é€‰æ‹©</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483552/"><p>å…³äºç¬¬ä¸‰ä¸ªè‡ªå†™é€‚é…å™¨ï¼Œåœ¨å…¶ä¸­å¿…é¡»å®ç°è®°ä½æ‰€é€‰å…ƒç´ çš„é€»è¾‘ä¹‹åï¼Œæˆ‘æ›¾æƒ³è¿‡åº”è¯¥æœ‰ä¸€äº›å·²ç»åŒ…å«æ‰€æœ‰å¿…è¦å†…å®¹çš„è§£å†³æ–¹æ¡ˆã€‚ ç‰¹åˆ«æ˜¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ‚¨ä¸å¾—ä¸æ›´æ”¹ä»…é€‰æ‹©ä¸€é¡¹ä»¥è¿›è¡Œå¤šé¡¹é€‰æ‹©çš„åŠŸèƒ½ã€‚ </p><br><p>åœ¨ç ”ç©¶äº†MVVMæ–¹æ³•å¹¶å°†å…¶å®Œå…¨æµ¸å…¥å…¶ä¸­ä¹‹åï¼Œä¸Šè¿°é—®é¢˜å°±æ›´åŠ æ˜æ˜¾åœ°å‡ºç°äº†ã€‚ æ­¤å¤–ï¼Œé€‚é…å™¨æœ¬èº«å¤„äº<code>View</code>çº§åˆ«ï¼Œè€Œå¯¹äº<code>ViewModel</code> ï¼Œæœ‰å…³æ‰€é€‰å…ƒç´ çš„ä¿¡æ¯é€šå¸¸æ˜¯æå…¶å¿…è¦çš„ã€‚ </p><br><p> ä¹Ÿè®¸æˆ‘æ²¡æœ‰èŠ±è¶³å¤Ÿçš„æ—¶é—´åœ¨Internetä¸Šå¯»æ‰¾ç­”æ¡ˆï¼Œä½†æ˜¯æ— è®ºå¦‚ä½•ï¼Œæˆ‘éƒ½æ²¡æœ‰æ‰¾åˆ°ç°æˆçš„è§£å†³æ–¹æ¡ˆã€‚ ä½†æ˜¯ï¼Œåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘æå‡ºäº†ä¸€ä¸ªå¯èƒ½æ˜¯é€šç”¨çš„å®ç°æƒ³æ³•ï¼Œæ‰€ä»¥æˆ‘æƒ³åˆ†äº«ä¸€ä¸‹ã€‚ <a name="habracut"></a></p><br><p>  <strong><em>å¤‡æ³¨</em></strong> ã€‚ å°½ç®¡Androidä¸Šçš„MVVMåœ¨<code>LiveData</code>çš„æƒ…å†µä¸‹è¿›è¡Œå®ç°æ˜¯åˆä¹é€»è¾‘çš„ï¼Œä½†åœ¨ç°é˜¶æ®µï¼Œæˆ‘è¿˜ä¸å‡†å¤‡ä½¿ç”¨å®ƒç¼–å†™ä»£ç ã€‚ æ‰€ä»¥è¿™åªæ˜¯ä¸ºäº†æœªæ¥ã€‚ ä½†æ˜¯æœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆè¯æ˜æ²¡æœ‰<code>Android</code>ä¾èµ–é¡¹ï¼Œè¿™æœ‰å¯èƒ½ä½¿å®ƒå¯ä»¥åœ¨kotlinå¯ä»¥è¿è¡Œçš„ä»»ä½•å¹³å°ä¸Šä½¿ç”¨ã€‚ </p><br><h2 id="selectionmanager"> é€‰æ‹©ç®¡ç†å™¨ </h2><br><p> ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œç¼–è¯‘äº†å¸¸è§„çš„<code>SelectionManager</code>æ¥å£ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectionManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearSelection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">selectPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerSelectionChangeListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(listener: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">position</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, isSelected: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): Disposable <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSelectedPositions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: ArrayList&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAnySelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSelectionInterceptor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(interceptor: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">position</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, isSelected: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">, callback: ()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>): Disposable }</code> </pre> <br><p> é»˜è®¤æƒ…å†µä¸‹ï¼Œå·²ç»æœ‰3ç§ä¸åŒçš„å®ç°ï¼š </p><br><ul><li>  <code>MultipleSelection</code>è¯¥å¯¹è±¡ä½¿æ‚¨å¯ä»¥ä»åˆ—è¡¨ä¸­é€‰æ‹©ä»»æ„æ•°é‡çš„å…ƒç´ ï¼› </li><li>  <code>SingleSelection</code>ä¸€ä¸ªå¯¹è±¡ä»…å…è®¸æ‚¨é€‰æ‹©ä¸€ä¸ªå…ƒç´ ï¼› </li><li>  <code>NoneSelection</code>å¯¹è±¡å®Œå…¨ä¸å…è®¸é€‰æ‹©å…ƒç´ ã€‚ </li></ul><br><p> å¯èƒ½æ˜¯åè€…ï¼Œæ‰€æœ‰é—®é¢˜ä¸­å¤§å¤šæ•°éƒ½ä¼šå‡ºç°ï¼Œå› æ­¤æˆ‘å°†å°è¯•åœ¨ä¸€ä¸ªç¤ºä¾‹ä¸Šè¿›è¡Œå±•ç¤ºã€‚ </p><br><h2 id="adapter"> è½¬æ¥å¤´ </h2><br><p> åº”è¯¥é€šè¿‡æ„é€ å‡½æ•°å°†<code>SelectionManager</code>å¯¹è±¡ä½œä¸ºä¾èµ–é¡¹æ·»åŠ åˆ°é€‚é…å™¨ã€‚ </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestAdapter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> selectionManager: SelectionManager) : RecyclerView.Adapter&lt;TestHolder&gt;() { <span class="hljs-comment"><span class="hljs-comment">//class body }</span></span></code> </pre> <br><p> åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä¸ä¼šç†ä¼šå¤„ç†å…ƒç´ å•å‡»çš„é€»è¾‘ï¼Œå› æ­¤æˆ‘ä»¬åªåŒæ„æŒæœ‰äººï¼ˆæ— è¯¦ç»†ä¿¡æ¯ï¼‰å®Œå…¨è´Ÿè´£å•å‡»ä¾¦å¬å™¨çš„ä»»å‘½ã€‚ </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestHolder</span></span></span></span>(itemView: View) : RecyclerView.ViewHolder(itemView) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">, onItemClick: ()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//all bind logic } }</span></span></code> </pre> <br><p> æ­¤å¤–ï¼Œä¸ºäº†ä½¿æ­¤é­”æœ¯èµ·ä½œç”¨ï¼Œé€‚é…å™¨å¿…é¡»æ‰§è¡Œä»¥ä¸‹3ä¸ªæ­¥éª¤ï¼š </p><br><h4 id="1-onbindviewholder"> <code>1. onBindViewHolder</code> </h4> <br><p> å°†å›è°ƒä¼ é€’ç»™æŒæœ‰è€…çš„<code>bind</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¸ºæ˜¾ç¤ºçš„å…ƒç´ è°ƒç”¨<code>selectionManager.selectPosition(position)</code> ã€‚ åŒæ ·åœ¨è¿™é‡Œï¼Œæ‚¨å¾ˆå¯èƒ½éœ€è¦æ ¹æ®å½“å‰æ˜¯å¦é€‰ä¸­è¯¥é¡¹ç›®æ¥æ›´æ”¹æ˜¾ç¤ºï¼ˆé€šå¸¸ä»…æ˜¯èƒŒæ™¯ï¼‰-æ‚¨å¯ä»¥ä¸ºæ­¤è°ƒç”¨<code>selectionManager.isPositionSelected(position)</code> ã€‚ </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(holder: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TestHolder</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> isItemSelected = selectionManager.isPositionSelected(position) <span class="hljs-comment"><span class="hljs-comment">//do whatever you need depending on `isItemSelected` value val item = ... //get current item by `position` value holder.bind(item) { selectionManager.selectPosition(position) } }</span></span></code> </pre> <br><h4 id="2-registerselectionchangelistener"> <code>2. registerSelectionChangeListener</code> </h4> <br><p> ä¸ºäº†ä½¿é€‚é…å™¨åŠæ—¶æ›´æ–°æŒ‰ä¸‹çš„å…ƒç´ ï¼Œæ‚¨å¿…é¡»è®¢é˜…é€‚å½“çš„æ“ä½œã€‚ å¹¶ä¸”ä¸è¦å¿˜è®°å¿…é¡»ä¿å­˜è®¢é˜…æ–¹æ³•è¿”å›çš„ç»“æœã€‚ </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> selectionDisposable = selectionManager.registerSelectionChangeListener { position, isSelected -&gt; notifyItemChanged(position) }</code> </pre> <br><p> æˆ‘æ³¨æ„åˆ°åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>isSelected</code>å‚æ•°çš„<code>isSelected</code>å¹¶ä¸é‡è¦ï¼Œå› ä¸ºä»»ä½•æ›´æ”¹éƒ½ä¼šæ”¹å˜å…ƒç´ çš„å¤–è§‚ã€‚ ä½†æ˜¯ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢æ‚¨æ·»åŠ å…¶ä»–å¤„ç†ï¼Œå¯¹æ­¤å€¼å¾ˆé‡è¦ã€‚ </p><br><h4 id="3-selectiondisposable"> <code>3. selectionDisposable</code> </h4> <br><p> åœ¨ä¸Šä¸€æ­¥ä¸­ï¼Œæˆ‘ä¸ä»…ä»…æ˜¯è¯´å¿…é¡»ä¿å­˜è¯¥æ–¹æ³•çš„ç»“æœ-è¿”å›ä¸€ä¸ªæ¸…é™¤é¢„è®¢çš„å¯¹è±¡ï¼Œä»¥é¿å…æ³„æ¼ã€‚ å®Œæˆå·¥ä½œåï¼Œå¿…é¡»å’¨è¯¢è¯¥å¯¹è±¡ã€‚ </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { selectionDisposable.dispose() }</code> </pre> <br><h2 id="viewmodel"> è§†å›¾æ¨¡å‹ </h2><br><p> å¯¹äºé­”æœ¯é€‚é…å™¨å°±è¶³å¤Ÿäº†ï¼Œæˆ‘ä»¬å°†ä¼ é€’ç»™<code>ViewModel</code> ã€‚ åˆå§‹åŒ–<code>SelectionManager</code>éå¸¸ç®€å•ï¼š </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestViewModel</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewModel</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> selectionManager: SelectionManager = SingleSelection() }</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œä¸é€‚é…å™¨ç±»ä¼¼ï¼Œæ‚¨å¯ä»¥è®¢é˜…æ›´æ”¹ï¼ˆä¾‹å¦‚ï¼Œå½“æœªé€‰æ‹©ä»»ä½•é¡¹ç›®æ—¶ï¼Œä½¿â€œåˆ é™¤â€æŒ‰é’®ä¸å¯ç”¨ï¼‰ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥å•å‡»æ‘˜è¦æŒ‰é’®ï¼ˆä¾‹å¦‚ï¼Œâ€œä¸‹è½½æ‰€é€‰å†…å®¹â€ï¼‰ä»¥è·å–æ‰€æœ‰å·²é€‰æ‹©å†…å®¹çš„åˆ—è¡¨ã€‚ ã€‚ </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDownloadClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> selectedPositions: ArrayList&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt; = selectionManager.getSelectedPositions() ... }</code> </pre> <br><p> è¿™æ˜¯æˆ‘è§£å†³æ–¹æ¡ˆçš„ç¼ºç‚¹ä¹‹ä¸€ï¼šåœ¨å½“å‰é˜¶æ®µï¼Œå¯¹è±¡åªèƒ½å­˜å‚¨å…ƒç´ çš„ä½ç½®ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ºäº†å‡†ç¡®åœ°è·å–é€‰å®šçš„å¯¹è±¡è€Œä¸æ˜¯å®ƒä»¬çš„ä½ç½®ï¼Œå°†éœ€è¦ä½¿ç”¨è¿æ¥åˆ°é€‚é…å™¨çš„æ•°æ®æºæ¥é™„åŠ é€»è¾‘ï¼ˆé˜¿æ‹‰æ–¯è¯­ï¼Œä»…åˆ°ç›®å‰ä¸ºæ­¢ï¼‰ã€‚ ä½†å¸Œæœ›æ‚¨èƒ½è§£å†³ã€‚ </p><br><p> æ­¤å¤–ï¼Œä»…ä¿ç•™å°†é€‚é…å™¨ä¸è§†å›¾æ¨¡å‹è¿æ¥ã€‚ è¿™å·²ç»å¤„äºæ´»åŠ¨çº§åˆ«ã€‚ </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestActivity</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppCompatActivity</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> adapter: TestAdapter <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> viewModel: TestViewModel <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) <span class="hljs-comment"><span class="hljs-comment">//`TestViewModel` initialization adapter = TestAdapter(viewModel.selectionManager) } }</span></span></code> </pre> <br><h2 id="gibkost"> æŸ”éŸ§æ€§ </h2><br><p> å¯¹äºæŸäº›äººæ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯å¯ä»¥ç†è§£çš„ï¼Œä½†æ˜¯æˆ‘æƒ³ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼Œé€šè¿‡è¿™ç§å®ç°æ–¹å¼ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æ§åˆ¶é€‚é…å™¨ä¸­çš„é€‰æ‹©æ–¹æ³•ã€‚ ç°åœ¨ï¼Œé€‚é…å™¨åªèƒ½é€‰æ‹©ä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯å¦‚æœ<code>TestViewModel</code>åœ¨<code>TestViewModel</code>æ›´æ”¹<code>selectionManager</code>å±æ€§çš„åˆå§‹åŒ–ï¼Œåˆ™å…¶ä½™ä»£ç å°†â€œä»¥æ–°æ–¹å¼â€å·¥ä½œï¼Œè€Œæ— éœ€è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¾ç½®<code>val selectionManager: SelectionManager = MultipleSelection()</code> ï¼Œç°åœ¨é€‚é…å™¨å…è®¸æ‚¨é€‰æ‹©ä»»æ„å¤šä¸ªå…ƒç´ ã€‚ </p><br><p> è€Œä¸”ï¼Œå¦‚æœæ‚¨æœ‰æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æŸç§åŸºæœ¬é€‚é…å™¨ç±»ï¼Œåˆ™å¯ä»¥ä¸å¿…æ‹…å¿ƒä»¥ç›¸åŒçš„æ–¹å¼åŒ…å«<code>SelectionManager</code> ã€‚ ç¡®å®ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæ ¹æœ¬ä¸æš—ç¤ºé€‰æ‹©å…ƒç´ çš„é€‚é…å™¨ï¼Œæœ‰ä¸€ä¸ª<code>NoneSelection</code>çš„å®ç°-ä¸ç®¡æ‚¨åšä»€ä¹ˆï¼Œå®ƒéƒ½ä¸ä¼šæ‹¥æœ‰é€‰å®šçš„å…ƒç´ ï¼Œä¹Ÿæ°¸è¿œä¸ä¼šè°ƒç”¨ä»»ä½•ä¾¦å¬å™¨ã€‚ ä¸ï¼Œä»–ä¸ä¼šæŠ›å‡ºå¼‚å¸¸-ä»–åªæ˜¯å¿½ç•¥æ‰€æœ‰è°ƒç”¨ï¼Œä½†æ˜¯é€‚é…å™¨å®Œå…¨ä¸éœ€è¦çŸ¥é“è¿™ä¸€ç‚¹ã€‚ </p><br><h2 id="interceptor"> æ‹¦æˆªå™¨ </h2><br><p> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå…ƒç´ çš„é€‰æ‹©æ›´æ”¹ä¼šä¼´éšå…¶ä»–æ“ä½œï¼ˆä¾‹å¦‚ï¼ŒåŠ è½½è¯¦ç»†ä¿¡æ¯ï¼‰ï¼Œè€Œæ— æ³•æˆåŠŸå®Œæˆæ›´æ”¹æ“ä½œä¼šå¯¼è‡´é”™è¯¯çŠ¶æ€ã€‚ ç‰¹åˆ«æ˜¯å¯¹äºè¿™äº›æƒ…å†µï¼Œæˆ‘æ·»åŠ äº†ä¸€ç§æ‹¦æˆªæœºåˆ¶ã€‚ </p><br><p> è¦æ·»åŠ æ‹¦æˆªå™¨ï¼Œæ‚¨éœ€è¦è°ƒç”¨<code>addSelectionInterceptor</code>æ–¹æ³•ï¼ˆåŒæ ·ï¼Œæ‚¨éœ€è¦ä¿å­˜ç»“æœå¹¶åœ¨å®Œæˆåè®¿é—®å®ƒï¼‰ã€‚  <code>callback: () -&gt; Unit</code>ç¤ºä¾‹ä¸­æ‹¦æˆªå™¨çš„å‚æ•°ä¹‹ä¸€<code>callback: () -&gt; Unit</code>ç›´åˆ°è¢«è°ƒç”¨ï¼Œæ›´æ”¹æ‰ä¼šåº”ç”¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ²¡æœ‰ç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œæ— æ³•æˆåŠŸå®Œæˆä»æœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯çš„åŠ è½½ï¼›å› æ­¤ï¼Œæ‰€ä½¿ç”¨çš„<code>selectionManager</code>çš„çŠ¶æ€å°†ä¸ä¼šæ›´æ”¹ã€‚ å¦‚æœè¿™æ­£æ˜¯æ‚¨è¦äº‰å–çš„è¡Œä¸ºï¼Œåˆ™éœ€è¦æ­¤æ–¹æ³•ã€‚ </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interceptionDisposable = selectionManager.addSelectionInterceptor { position: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, isSelected: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, callback: () -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(isSelected) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> selectedItem = ... <span class="hljs-comment"><span class="hljs-comment">//get current item by `position` value val isDataLoadingSuccessful: Boolean = ... //download data for `selectedItem` if(isDataLoadingSuccessful) { callback() } } }</span></span></code> </pre> <br><p> å¦‚æœ‰å¿…è¦ï¼Œæ‚¨å¯ä»¥è¿æ¥ä»»æ„æ•°é‡çš„æ‹¦æˆªå™¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨çš„<code>callback()</code>è°ƒç”¨å¼€å§‹å¤„ç†ç¬¬äºŒä¸ªæ‹¦æˆªå™¨ã€‚ å¹¶ä¸”åªæœ‰æœ€åä¸€ä¸ªä¸­çš„<code>callback()</code>ä¼šæœ€ç»ˆå¯¼è‡´<code>selectionManager</code>çŠ¶æ€å‘ç”Ÿå˜åŒ–ã€‚ </p><br><h2 id="perspektivy"> å‰æ™¯å±•æœ› </h2><br><ol><li> ä½¿ç”¨<code>Disposable</code>æ¸…é™¤è®¢é˜…å¾ˆæœ‰æ•ˆï¼Œä½†ä¸å¦‚<code>LiveData</code>æ–¹ä¾¿ã€‚ åœ¨çº¿ä¸Šçš„ç¬¬ä¸€ä¸ªæ”¹è¿›æ˜¯ä½¿ç”¨<code>android.arch.lifecycle</code>çš„åŠŸèƒ½æ¥è¿›è¡Œæ›´æ–¹ä¾¿çš„å·¥ä½œã€‚ å¾ˆæœ‰å¯èƒ½ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®ï¼Œä»¥å…åœ¨å½“å‰é¡¹ç›®ä¸­å¢åŠ å¹³å°ä¾èµ–æ€§ã€‚ </li><li> å°±åƒæˆ‘è¯´çš„é‚£æ ·ï¼Œè·å–é€‰å®šå¯¹è±¡çš„åˆ—è¡¨å¾ˆä¸æ–¹ä¾¿ã€‚ æˆ‘è¿˜æƒ³å°è¯•å®ç°å¯ä»¥â€‹â€‹ä»¥ç›¸åŒæ–¹å¼ä¸æ•°æ®å®¹å™¨ä¸€èµ·ä½¿ç”¨çš„å¯¹è±¡ã€‚ åŒæ—¶ï¼Œå®ƒå¯èƒ½æ˜¯é€‚é…å™¨çš„æ•°æ®æºã€‚ </li></ol><br><h2 id="ssylki"> å‚è€ƒæ–‡çŒ® </h2><br><p> æ‚¨å¯ä»¥åœ¨é“¾æ¥<a href="https://github.com/Ircover/SelectionManager">ä¸Š</a>æ‰¾åˆ°æºä»£ç <a href="https://github.com/Ircover/SelectionManager">-GitHub</a> <br> è¯¥é¡¹ç›®ä¹Ÿå¯ä»¥é€šè¿‡gradleå®æ–½<code>ru.ircover.selectionmanager:core:1.0.0</code> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483552/">https://habr.com/ru/post/zh-CN483552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483538/index.html">é€šè¿‡FMCå°†10â€œ ER-TFT101-1æ˜¾ç¤ºå™¨è¿æ¥åˆ°STM32F429</a></li>
<li><a href="../zh-CN483540/index.html">ChaiScript-C ++è„šæœ¬è¯­è¨€</a></li>
<li><a href="../zh-CN483542/index.html">ç”µä¿¡æ‘˜è¦-æœ‰å…³æä¾›å•†å·¥ä½œçš„ææ–™</a></li>
<li><a href="../zh-CN483544/index.html">æ–°æ•°æ®é©³æ–¥äº†æš—èƒ½é‡çš„å…³é”®å‡è®¾</a></li>
<li><a href="../zh-CN483550/index.html">æœåŠ¡å’ŒIaaSå¼€å‘ï¼šäº‘ï¼Œæ•°æ®å­˜å‚¨å’Œ1cloud Evolutionçš„æ±‡ç¼–</a></li>
<li><a href="../zh-CN483554/index.html">20å¹´ä»£çš„æ–°æŠ€æœ¯å¹³å°ã€‚ ä¸ºä»€ä¹ˆæˆ‘ä¸åŒæ„æ‰å…‹ä¼¯æ ¼</a></li>
<li><a href="../zh-CN483556/index.html">ç¾å›½é“¶è¡ŒæŠ¥å‘Šï¼šæœªæ¥åå¹´å°†æ”¹å˜å…¨çƒç»æµçš„5ç§è¶‹åŠ¿</a></li>
<li><a href="../zh-CN483558/index.html">åˆå­¦è€…çœ¼ä¸­çš„Webix JavaScriptåº“</a></li>
<li><a href="../zh-CN483564/index.html">ITä¸­çš„æ–‡æ¡ˆæ’°å†™ï¼šå¦‚ä½•å¼€å§‹æ’°å†™æœ‰å…³æŠ€æœ¯çš„æ–‡ç« </a></li>
<li><a href="../zh-CN483568/index.html">ä»å¤´å¼€å§‹åˆ›å»ºåŸå§‹è®¡ç®—æœº</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>