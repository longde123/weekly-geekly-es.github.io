<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👍🏻 👨🏾‍🌾 🌭 Apple Metal في MAPS.ME 👇🏻 🚣🏽 🏴󠁧󠁢󠁷󠁬󠁳󠁿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="مرحبا بالجميع! 

 يوجد في العالم عدد كبير من التطبيقات على OpenGL ، ويبدو أن Apple لا توافق تمامًا على ذلك. بدءًا من iOS 12 و MacOS Mojave ، تم إيقاف ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apple Metal في MAPS.ME</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/430850/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jf/bk/ix/jfbkixzquc9k0dnnqnaorskj4bk.png" alt="الصورة" align="left">  مرحبا بالجميع! <br><br>  يوجد في العالم عدد كبير من التطبيقات على OpenGL ، ويبدو أن Apple لا توافق تمامًا على ذلك.  بدءًا من iOS 12 و MacOS Mojave ، تم إيقاف OpenGL.  لقد دمجنا Apple Metal في MAPS.ME ونحن مستعدون لمشاركة خبرتنا ونتائجنا.  سنخبرك بكيفية إعادة تصميم محرك الرسومات ، والصعوبات التي كان علينا مواجهتها ، والأهم من ذلك ، كم عدد إطارات FPS لدينا الآن. <br><br>  كل من يهتم أو يفكر في إضافة دعم Apple Metal لمحرك الرسومات مرحبًا به في القطط. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  العدد </h2><br>  تم تصميم محرك الرسومات الخاص بنا على أنه متعدد المنصات ، وبما أن OpenGL هو في الواقع واجهة برمجة التطبيقات الرسومية عبر الأنظمة الأساسية الوحيدة لمجموعة المنصات التي تهمنا (iOS و Android و MacOS و Linux) ، فقد اخترناها كأساس.  لم نقدم مستوى إضافيًا من التجريد من شأنه إخفاء الميزات الخاصة بـ OpenGL ، ولكن لحسن الحظ ، تركنا إمكانية تنفيذه. <br><br>  مع ظهور الجيل الجديد من واجهات برمجة التطبيقات الرسومية Apple Metal و Vulkan ، نظرنا بالطبع في إمكانية ظهورها في تطبيقنا ، ومع ذلك ، توقفنا عن طريق ما يلي: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يمكن أن يعمل Vulkan فقط على Android و Linux ، ويمكن أن يعمل Apple Metal فقط على iOS و MacOS.  لم نرغب في فقدان النظام الأساسي المشترك على مستوى واجهة برمجة التطبيقات الرسومية ، وهذا من شأنه أن يعقد عمليات التطوير والتصحيح ، ويزيد من حجم العمل. </li><li style=";text-align:right;direction:rtl">  لا يمكن إنشاء تطبيق على Apple Metal وتشغيله على محاكي iOS (بالمناسبة ، حتى الآن) ، الأمر الذي سيعقد أيضًا تطورنا ولن يسمح لنا بالتخلص تمامًا من OpenGL. </li><li style=";text-align:right;direction:rtl">  إطار Qt Framework ، الذي نستخدمه لإنشاء أدوات داخلية ، يدعم OpenGL فقط ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">يتم دعم Vulkan الآن</a> ). </li><li style=";text-align:right;direction:rtl">  لم يكن لدى Apple Metal وليس لديه واجهة برمجة تطبيقات C ++ ، الأمر الذي سيجبرنا على التوصل إلى ملخصات ليس فقط لوقت التشغيل ، ولكن أيضًا لمرحلة بناء التطبيق ، عندما يتم تجميع جزء من المحرك في Objective-C ++ ، وآخر أكبر بكثير في C ++. </li><li style=";text-align:right;direction:rtl">  لم نكن مستعدين لإنشاء محرك منفصل أو فرع رمز منفصل خاص بـ iOS. </li><li style=";text-align:right;direction:rtl">  تم تقييم التنفيذ لمدة ستة أشهر على الأقل في عمل مطور رسومي واحد. </li></ol><br>  عندما أعلنت Apple في ربيع عام 2018 عن نقل OpenGL إلى حالة موقوفة ، أصبح من الواضح أنه لم يعد من الممكن التأجيل ، ويجب حل المشكلات المذكورة أعلاه بطريقة أو بأخرى.  بالإضافة إلى ذلك ، نحن نعمل منذ فترة طويلة على تحسين سرعة التطبيق واستهلاك الطاقة ، وبدا أن Apple Metal قادرة على المساعدة. <br><br><h2 style=";text-align:right;direction:rtl">  اختيار القرار </h2><br>  على الفور لاحظنا <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">MoltenVK</a> .  يحاكي هذا الإطار Vulkan API باستخدام Apple Metal ، وتم فتح كود المصدر الخاص به مؤخرًا.  يبدو أن استخدام MoltenVK سيسمح باستبدال OpenGL بـ Vulkan ، ولن يضطر إلى التعامل مع التكامل المنفصل لـ Apple Metal على الإطلاق.  بالإضافة إلى ذلك ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">رفض</a> مطورو Qt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">دعمًا منفصلاً للعرض على Apple Metal</a> لصالح MoltenVK.  ومع ذلك ، تم إيقافنا: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الحاجة إلى دعم أجهزة Android التي لا يتوفر عليها Vulkan ؛ </li><li style=";text-align:right;direction:rtl">  عدم القدرة على البدء في محاكاة iOS دون وجود احتياطي على OpenGL ؛ </li><li style=";text-align:right;direction:rtl">  عدم القدرة على استخدام أدوات Apple لتصحيح الأخطاء والتظليل والتشكيل المسبق للتجميع ، حيث تقوم MoltenVK بإنشاء تظليل في الوقت الفعلي لـ Apple Metal من أكواد مصدر SPIR-V أو GLSL ؛ </li><li style=";text-align:right;direction:rtl">  الحاجة إلى انتظار التحديثات وإصلاح الأخطاء في MoltenVK عند إصدار إصدارات جديدة من Metal ؛ </li><li style=";text-align:right;direction:rtl">  استحالة التحسين الدقيق الخاص بالمعدن ، ولكن ليس محددًا أو غير موجود لـ Vulkan. </li></ul><br>  اتضح أننا بحاجة إلى حفظ OpenGL ، مما يعني أنه لا يمكننا الاستغناء عن تجريد المحرك من واجهة برمجة التطبيقات الرسومية.  سيتم استخدام Apple Metal و OpenGL ES ، وفي المستقبل Vulkan ، لإنشاء مكونات داخلية مستقلة لمحرك الرسومات ، والتي يمكن استبدالها بالكامل.  سيلعب OpenGL دور خيار الرجوع عند عدم توفر Metal أو Vulkan لسبب أو لآخر. <br><br>  كانت خطة التنفيذ على النحو التالي: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إعادة بيع محرك الرسومات لاستخلاص واجهة برمجة التطبيقات للرسومات المستخدمة. </li><li style=";text-align:right;direction:rtl">  تقدم إلى Apple Metal لإصدار iOS من التطبيق. </li><li style=";text-align:right;direction:rtl">  ضع معايير مناسبة لتقديم السرعة واستهلاك الطاقة لمعرفة ما إذا كانت واجهات برمجة التطبيقات الرسومية الحديثة ذات المستوى المنخفض يمكن أن تفيد المنتج. </li></ol><br><h2 style=";text-align:right;direction:rtl">  الاختلافات الرئيسية بين OpenGL والمعادن </h2><br>  لفهم كيفية تجريد واجهة برمجة التطبيقات الرسومية ، دعنا أولاً نحدد الاختلافات المفاهيمية الرئيسية بين OpenGL و Metal. <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يعتقد ، وليس بدون سبب ، أن Metal هي واجهة برمجة تطبيقات ذات مستوى أدنى.  ومع ذلك ، هذا لا يعني أنه يجب عليك الكتابة في المجمع أو تنفيذ التنقيط بنفسك.  يمكن تسمية Metal بواجهة برمجة تطبيقات منخفضة المستوى بمعنى أنها تؤدي عددًا صغيرًا جدًا من الإجراءات الضمنية ، أي أنه يجب كتابة جميع الإجراءات تقريبًا إلى المبرمج نفسه.  يقوم OpenGL بالكثير من الأشياء بشكل ضمني ، بدءًا من دعم مرجع ضمني لسياق OpenGL وربط هذا السياق بالدفق الذي تم إنشاؤه فيه. </li><li style=";text-align:right;direction:rtl">  في Metal ، التحقق من "لا" في الوقت الحقيقي للفرق.  في وضع التصحيح ، يوجد التحقق بالطبع ، وهو أفضل بكثير من العديد من واجهات برمجة التطبيقات الأخرى ، ويرجع ذلك إلى حد كبير إلى تكامله المحكم مع Xcode.  ولكن عندما يتم إرسال البرنامج إلى المستخدم ، لم يعد هناك أي التحقق من الصحة ، ببساطة يتعطل البرنامج على الخطأ الأول.  وغني عن القول ، تعطل برنامج OpenGL فقط في الحالات القصوى.  الممارسة الأكثر شيوعًا: تجاهل الخطأ والاستمرار في العمل. </li><li style=";text-align:right;direction:rtl">  يمكن للمعادن ترجمة تظليل وبناء مكتبات منها.  في OpenGL ، يتم تجميع التظليل من المصدر في عملية البرنامج ، لأن هذا هو المسؤول عن التنفيذ المحدد منخفض المستوى لـ OpenGL على جهاز معين.  تؤدي الاختلافات و / أو الأخطاء في تنفيذ جامعي التظليل في بعض الأحيان إلى أخطاء رائعة ، خاصة على أجهزة Android من العلامات التجارية الصينية. </li><li style=";text-align:right;direction:rtl">  يستخدم OpenGL بنشاط آلة الحالة ، والتي تضيف آثارًا جانبية على كل وظيفة تقريبًا.  وبالتالي ، فإن دالات OpenGL ليست دالات خالصة ، وغالبًا ما يكون ترتيب الطلبات والمكالمات مهمًا.  لا يستخدم المعدن الحالات بشكل ضمني ولا يحافظ عليها لفترة أطول مما هو ضروري للعرض.  الدول موجودة ككائنات مسبقة الفشل. </li></ol><br><h2 style=";text-align:right;direction:rtl">  إعادة بناء محرك الرسوم البيانية وتضمين المعادن </h2><br>  تتكون عملية إعادة هيكلة محرك الرسومات بشكل أساسي من إيجاد أفضل حل للتخلص من ميزات OpenGL التي يستخدمها محركنا بنشاط.  تم تضمين التضمين المعدني ، بدءًا من إحدى المراحل ، بالتوازي. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  كما ذكرنا من قبل ، فإن OpenGL API لديها كيان ضمني يسمى السياق.  يرتبط السياق بسلسلة رسائل محددة ، وتجد الدالة OpenGL التي يتم استدعاؤها في سلسلة الرسائل هذه نفسها وتستخدم هذا السياق.  لا يعمل Metal و Vulkan (نعم ، وواجهات برمجة التطبيقات الأخرى ، على سبيل المثال ، Direct3D) بهذه الطريقة ، فلديهم كائنات صريحة مماثلة تسمى الجهاز أو المثيل.  يقوم المستخدم نفسه بإنشاء هذه الكائنات وهو مسؤول عن نقلها إلى أنظمة فرعية مختلفة.  من خلال هذه الكائنات يتم إجراء جميع المكالمات لأوامر الرسوم. <br><br>  أطلقنا على كائننا المجرد سياقًا رسوميًا ، وفي حالة OpenGL ، فإنه ببساطة يزين مكالمات أوامر OpenGL ، وفي حالة Metal فإنه يحتوي على واجهة MTLDevice الجذر التي يتم من خلالها استدعاء الأوامر المعدنية. <br><br>  بالطبع ، اضطررت إلى توزيع هذا الكائن (وبما أننا نقدم عرضًا متعدد الخيوط ، ثم العديد من هذه الكائنات) عبر جميع الأنظمة الفرعية. <br><br>  قمنا بإخفاء إنشاء قوائم انتظار للأوامر ، وبرامج التشفير ، وإدارتها داخل السياق الرسومي ، حتى لا ننشر الكيانات التي لا توجد ببساطة في OpenGL. </li><li style=";text-align:right;direction:rtl">  لم يكن احتمال اختفاء التحقق من صحة الأوامر الرسومية على أجهزة المستخدم مرضيًا بشكل علني.  لا يمكن لقسم ضمان الجودة تغطية مجموعة كبيرة من الأجهزة وإصدارات نظام التشغيل بالكامل.  لذلك ، كان علينا إضافة سجلات تفصيلية حيث تلقينا سابقًا خطأ ذا معنى من واجهة برمجة التطبيقات الرسومية.  بالطبع ، تمت إضافة هذا التحقق فقط إلى المواقع التي يحتمل أن تكون خطرة وحرجة لمحرك الرسومات ، حيث إن تغطية المحرك بالكامل برمز تشخيص أمر مستحيل عمليا ويضر بالأداء بشكل عام.  الواقع الجديد هو أن اختبار المستخدم وتصحيح الأخطاء باستخدام السجلات أصبح الآن في الماضي ، على الأقل من حيث العرض. </li><li style=";text-align:right;direction:rtl">  كان نظام التظليل السابق الخاص بنا غير مناسب لإعادة البناء ؛ كان علي إعادة كتابته بالكامل.  النقطة هنا ليست فقط التجهيز المسبق للتظليل والتحقق من صحتها في مرحلة تجميع المشروع.  يستخدم OpenGL ما يسمى المتغيرات الموحدة لتمرير المعلمات إلى التظليل.  لا يتوفر النقل المنظم للبيانات إلا مع OpenGL ES 3.0 ، وبما أننا ما زلنا ندعم OpenGL ES 2.0 ، فإننا ببساطة لم نستخدم هذه الطريقة.  جعلنا المعدن نستخدم هياكل البيانات لتمرير المعلمات ، وبالنسبة لـ OpenGL ، كان علينا أن نبتكر حقول بنية رسم الخرائط لمتغيرات موحدة.  بالإضافة إلى ذلك ، كان علي إعادة كتابة كل تظليل في لغة التظليل المعدنية. </li><li style=";text-align:right;direction:rtl">  عند استخدام أشياء الدولة ، كان علينا أن نذهب لخدعة.  في OpenGL ، يتم تعيين جميع الحالات ، كقاعدة ، مباشرة قبل التقديم ، وفي Metal يجب أن يكون هذا كائنًا تم إنشاؤه والتحقق منه مسبقًا.  من الواضح أن محركنا استخدم نهج OpenGL ، وكان إعادة البناء مع الإنشاء الأولي لكائنات الحالة يمكن مقارنته بإعادة كتابة كاملة للمحرك.  لقص هذه العقدة ، أنشأنا ذاكرة تخزين مؤقت للحالة داخل السياق الرسومي.  في المرة الأولى التي يتم فيها إنشاء مجموعة فريدة من معلمات الحالة ، يتم إنشاء كائن حالة في Metal ووضعه في ذاكرة التخزين المؤقت.  للمرة الثانية واللاحقة ، يتم استرداد الكائن ببساطة من ذاكرة التخزين المؤقت.  يعمل هذا في خرائطنا ، نظرًا لأن عدد المجموعات المختلفة من معلمات الحالة ليست كبيرة جدًا (حوالي 20-30).  بالنسبة لمحرك رسومات اللعبة المعقد ، فإن هذه الطريقة بالكاد مناسبة. </li></ul><br>  ونتيجة لذلك ، بعد حوالي 5 أشهر من العمل ، تمكنا من إطلاق MAPS.ME لأول مرة مع العرض الكامل على Apple Metal.  لقد حان الوقت لمعرفة ما حدث. <br><br><h2 style=";text-align:right;direction:rtl">  تقديم اختبار السرعة </h2><br><h4 style=";text-align:right;direction:rtl">  تقنية تجريبية </h4><br>  استخدمنا أجيالًا مختلفة من أجهزة Apple في التجربة.  تم تحديثهم جميعًا إلى iOS 12. تم تنفيذ نفس البرنامج النصي للمستخدم على التنقل على الخريطة (النقل والتحجيم).  تم كتابة البرنامج النصي لضمان هوية كاملة تقريبًا للعمليات داخل التطبيق في كل مرة يتم تشغيلها على كل جهاز.  كموقع اختبار ، اخترنا منطقة لوس أنجلوس - واحدة من أكثر المناطق تحميلًا في MAPS.ME. <br><br>  أولاً ، تم تشغيل البرنامج النصي مع العرض على OpenGL ES 3.0 ، ثم على نفس الجهاز مع العرض على Apple Metal.  بين البدء ، تم إلغاء تحميل التطبيق بالكامل من الذاكرة. <br>  تم قياس المؤشرات التالية: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  FPS (إطارات في الثانية) للإطار بأكمله ؛ </li><li style=";text-align:right;direction:rtl">  FPS للجزء من الإطار الذي يعمل فقط في التقديم ، باستثناء إعداد البيانات والعمليات الأخرى لإطار بإطار ؛ </li><li style=";text-align:right;direction:rtl">  النسبة المئوية للإطارات البطيئة (أكبر من 30 مللي ثانية تقريبًا) ، أي  تلك التي يمكن أن تنظر إليها العين البشرية على أنها هزات. </li></ul><br>  عند قياس FPS ، تم استبعاد الرسم مباشرة على شاشة الجهاز ، لأن المزامنة الرأسية مع معدل تحديث الشاشة لا تسمح بالحصول على نتائج موثوقة.  لذلك ، تم رسم الإطار في النسيج في الذاكرة.  لمزامنة وحدة المعالجة المركزية ووحدة معالجة الرسومات ، استخدم OpenGL مكالمة إضافية لـ <code>glFinish</code> ، بينما استخدمت Apple Metal <code>waitUntilCompleted</code> لـ <code>MTLFrameCommandBuffer</code> . <br><br><table style=";text-align:right;direction:rtl"><tbody><tr><th width="100"></th><th width="100">  آيفون 6s </th><th width="100"></th><th width="100">  iPhone 7+ </th><th width="100"></th><th width="100">  آيفون 8 </th><th width="100"></th></tr><tr><th></th><th>  Opengl </th><th>  معدن </th><th>  Opengl </th><th>  معدن </th><th>  Opengl </th><th>  معدن </th></tr><tr><td>  Fps </td><td>  106 </td><td>  160 </td><td>  159 </td><td>  221 </td><td>  196 </td><td>  298 </td></tr><tr><td>  FPS (التقديم فقط) </td><td>  157 </td><td>  596 </td><td>  247 </td><td>  597 </td><td>  271 </td><td>  833 </td></tr><tr><td>  جزء الإطارات البطيئة (&lt;30 إطارًا في الثانية) </td><td>  4.13٪ </td><td>  1.25٪ </td><td>  5.45٪ </td><td>  0.76٪ </td><td>  1.5٪ </td><td>  0.29٪ </td></tr></tbody></table><br><table style=";text-align:right;direction:rtl"><tbody><tr><th width="100"></th><th width="100">  iPhone X </th><th width="100"></th><th width="100">  iPad Pro 12.9 " </th><th width="100"></th></tr><tr><th></th><th>  Opengl </th><th>  معدن </th><th>  Opengl </th><th>  معدن </th></tr><tr><td>  Fps </td><td>  145 </td><td>  210 </td><td>  104 </td><td>  137 </td></tr><tr><td>  FPS (التقديم فقط) </td><td>  248 </td><td>  705 </td><td>  147 </td><td>  463 </td></tr><tr><td>  جزء الإطارات البطيئة (&lt;30 إطارًا في الثانية) </td><td>  0.15٪ </td><td>  0.15٪ </td><td>  17.52٪ </td><td>  4.46٪ </td></tr></tbody></table><br><table style=";text-align:right;direction:rtl"><tbody><tr><th width="100"></th><th width="100">  آيفون 6s </th><th width="100">  iPhone 7+ </th><th width="100">  آيفون 8 </th><th width="100">  iPhone X </th><th width="100">  iPad Pro 12.9 " </th></tr><tr><td>  تسريع الإطار المعدني (N مرات) </td><td>  1،5 </td><td>  1.39 </td><td>  1،52 </td><td>  1.45 </td><td>  1.32 </td></tr><tr><td>  تسريع التقديم على المعدن (N times) </td><td>  3.78 </td><td>  2.41 </td><td>  3.07 </td><td>  2.84 </td><td>  3.15 </td></tr><tr><td>  تحسن في الإطارات البطيئة (مرات N) </td><td>  3.3 </td><td>  7.17 </td><td>  5.17 </td><td>  1 </td><td>  3.93 </td></tr></tbody></table><br><h4 style=";text-align:right;direction:rtl">  تحليل النتائج </h4><br>  في المتوسط ​​، كان مكاسب أداء الإطار باستخدام Apple Metal 43٪.  تم إصلاح الحد الأدنى للقيمة على iPad Pro 12.9 '- 32٪ ، والحد الأقصى - 52٪ على iPhone 8. هناك تبعية: فكلما انخفضت دقة الشاشة ، تجاوزت Apple Metal OpenGL ES 3.0. <br><br>  إذا قمنا بتقييم جزء الإطار المسؤول مباشرة عن العرض ، فقد زاد متوسط ​​سرعة العرض على Apple Metal 3 مرات.  يشير هذا إلى تنظيم أفضل بكثير ، ونتيجة لذلك ، كفاءة واجهة برمجة تطبيقات Apple Metal مقارنة بـ OpenGL ES 3.0. <br><br>  تم تقليل عدد الإطارات البطيئة (أكثر من 30 مللي ثانية) على Apple Metal بنحو 4 مرات.  هذا يعني أن إدراك الرسوم المتحركة والتحرك حول الخريطة أصبح أكثر سلاسة.  تم تسجيل أسوأ نتيجة على iPad Pro 12.9 'بدقة 2732 × 2048 بكسل: يوفر OpenGL ES 3.0 حوالي 17.5٪ من الإطارات البطيئة ، في حين أن Apple Metal - 4.5٪ فقط. <br><br><h2 style=";text-align:right;direction:rtl">  اختبار القوة </h2><br><h4 style=";text-align:right;direction:rtl">  تقنية تجريبية </h4><br>  تم اختبار استهلاك الطاقة على iPhone 8 على نظام التشغيل iOS 12. تم تنفيذ سيناريو المستخدم نفسه - التنقل في الخريطة (الانتقال والقياس) لمدة ساعة واحدة.  تم كتابة البرنامج النصي لضمان هوية شبه كاملة للعمليات داخل التطبيق في كل بداية.  كما تم اختيار منطقة لوس أنجلوس كموقع للاختبار. <br><br>  استخدمنا النهج التالي لقياس استهلاك الطاقة.  الجهاز غير متصل بالشحن.  في إعدادات المطور ، يتم تمكين تسجيل الطاقة.  قبل بدء التجربة ، تم شحن الجهاز بالكامل.  تنتهي التجربة في نهاية النص.  في نهاية التجربة ، تم تسجيل حالة شحن البطارية ، وتم استيراد سجلات استهلاك الطاقة إلى الأداة المساعدة لتحديد خصائص البطارية في Xcode.  سجلنا مقدار المبلغ الذي تم إنفاقه على وحدة معالجة الرسومات.  بالإضافة إلى ذلك ، قمنا هنا أيضًا بترجيح العرض من خلال تضمين عرض مخطط المترو ومضاد التحيز ملء الشاشة. <br><br>  لم يتغير سطوع الشاشة في جميع الحالات.  تم تنفيذ أية عمليات أخرى باستثناء النظام و MAPS.ME.  تم تشغيل وضع الطائرة ، وتم إيقاف Wi-Fi و GPS.  بالإضافة إلى ذلك ، تم إجراء العديد من قياسات التحكم. <br><br>  ونتيجة لذلك ، لكل مؤشر من المؤشرات ، تم تشكيل مقارنة بين المعدن وبين OpenGL ، ثم تم حساب متوسط ​​النسب للحصول على تقدير مجمع واحد. <br><br><table style=";text-align:right;direction:rtl"><tbody><tr><th width="100"></th><th width="100">  Opengl </th><th width="100">  معدن </th><th width="100">  ربح </th></tr><tr><td>  استنزاف البطارية </td><td>  32٪ </td><td>  28٪ </td><td>  12.5٪ </td></tr><tr><td>  التنميط استخدام البطارية في Xcode </td><td>  1.95٪ </td><td>  1.83٪ </td><td>  6.16٪ </td></tr></tbody></table><br><h4 style=";text-align:right;direction:rtl">  تحليل النتائج </h4><br>  في المتوسط ​​، تحسن استهلاك الطاقة في إصدار العرض على Apple Metal قليلاً.  لا يتأثر استهلاك الطاقة لتطبيق GPU الخاص بنا كثيرًا ، حوالي 2٪ ، لأنه لا يمكن استدعاء MAPS.ME بشكل كبير من حيث استخدام GPU.  ربما يتم تحقيق مكاسب صغيرة من خلال تقليل التكاليف الحسابية عند إعداد التعليمات لوحدة معالجة الرسومات على وحدة المعالجة المركزية ، والتي ، للأسف ، لا يمكن تمييزها بمساعدة أدوات التنميط. <br><br><h2 style=";text-align:right;direction:rtl">  ملخص </h2><br>  تكلفنا عملية دمج المعادن 5 أشهر من التطوير.  مع ذلك ، قام مطوران بذلك دائمًا تقريبًا.  من الواضح أننا فزنا بشكل كبير في أداء الأداء ، وكسبنا القليل في استهلاك الطاقة.  بالإضافة إلى ذلك ، أتيحت لنا الفرصة لدمج واجهات برمجة تطبيقات رسومات جديدة ، على وجه الخصوص ، Vulkan ، بجهد أقل بكثير.  تقريبا "فرز" محرك الرسومات ، ونتيجة لذلك ، وجدنا وإصلاح العديد من الأخطاء القديمة ومشاكل الأداء. <br><br>  بالنسبة للسؤال عما إذا كان مشروعنا يحتاج حقًا إلى العرض على Apple Metal ، فنحن مستعدون للإجابة بالإيجاب.  لا نحب الابتكار كثيرًا ، أو أنه يمكن لشركة Apple التخلي عن OpenGL أخيرًا.  إنه فقط عام 2018 ، وظهر برنامج OpenGL في عام 1997 البعيد ، فقد حان الوقت لاتخاذ الخطوة التالية. <br><br>  <b>PS</b> حتى أطلقنا الميزة على جميع أجهزة iOS.  لتمكينه يدويًا ، اكتب <code>?metal</code> في شريط البحث وأعد تشغيل التطبيق.  لإرجاع العرض إلى OpenGL ، أدخل الأمر <code>?gl</code> وأعد تشغيل التطبيق. <br><br>  <b>PPS</b> MAPS.ME هو مشروع مفتوح المصدر.  يمكنك قراءة شفرة المصدر على <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">جيثب</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar430850/">https://habr.com/ru/post/ar430850/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar430838/index.html">عجائب التسويق الجماعي ، أو كيفية الترويج لنشاط تجاري بمراجعات</a></li>
<li><a href="../ar430840/index.html">ما الدليل الذي يمكن أن يقنع علماء الرياضيات إذا لم يكن هناك دليل صارم؟</a></li>
<li><a href="../ar430842/index.html">نستخدم blockchain لمحاربة الفساد والتسلط عبر الإنترنت</a></li>
<li><a href="../ar430844/index.html">كيفية اختيار بطارية UPS</a></li>
<li><a href="../ar430846/index.html">ما الجديد: أصبحت التفاصيل حول تنفيذ بنية Zen 2 الجديدة معروفة</a></li>
<li><a href="../ar430852/index.html">الاتساق وضمانات ACID في أنظمة التخزين الموزعة</a></li>
<li><a href="../ar430854/index.html">"JS أصبحت أكثر نضجًا": مقابلة مع لجنة برنامج HolyJS 2018 في موسكو</a></li>
<li><a href="../ar430856/index.html">الحقيقة الكاملة عن RTOS. المادة رقم 21. صناديق البريد: المقدمة والخدمات الأساسية</a></li>
<li><a href="../ar430860/index.html">قم بتنزيل وحفظ وعرض ملف PDF في Swift</a></li>
<li><a href="../ar430862/index.html">وحوش في الألعاب - كيف تجعل اللاعب يكرهك؟</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>