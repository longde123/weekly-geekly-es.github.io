<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤜🏿 😑 🎻 7 Nützliche Tipps zur Raumnutzung 🎻 🍔 🖐🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Room ist eine Abstraktionsschicht über SQLite, die die Speicherung vereinfacht. Wenn Sie Room noch nicht kennen, lesen Sie diesen Einführungsartikel: ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>7 Nützliche Tipps zur Raumnutzung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442786/"><p><img src="https://habrastorage.org/getpro/habr/post_images/67f/9e9/00f/67f9e900f75e27bf3453979d40ea4ef1.jpg" alt="7 Nützliche Tipps zur Raumnutzung"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Room</a> ist eine Abstraktionsschicht über SQLite, die die Speicherung vereinfacht.  Wenn Sie Room noch nicht kennen, lesen Sie diesen Einführungsartikel: </p><br><blockquote>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">7 Schritte zur Verwendung von Room.</a></em>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Exemplarische Vorgehensweise zum Migrieren Ihrer Anwendung nach Room</a></em> </blockquote><p>  In diesem Artikel möchte ich einige Tipps geben, wie Sie Room so effizient wie möglich nutzen können. </p><a name="habracut"></a><br><h2 id="1-predvaritelnoe-zapolnenie-bazy-dannyh">  1. Füllen Sie die Datenbank vorab aus </h2><br><p> Müssen Sie Ihrer Datenbank unmittelbar nach ihrer Erstellung oder zum Zeitpunkt des ersten Zugriffs darauf Standarddaten hinzufügen?  Verwenden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RoomDatabase # Callback</a> .  Rufen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie</a> beim Erstellen Ihrer Datenbank die Methode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">addCallback auf</a> und überschreiben Sie entweder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">onCreate</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">onOpen</a> . </p><br><p> <code>onCreate</code> wird beim ersten <code>onCreate</code> der Datenbank unmittelbar nach dem <code>onCreate</code> der Tabellen aufgerufen.  <code>onOpen</code> wird aufgerufen, wenn die Datenbank geöffnet wird.  Da der Zugriff auf das DAO erst nach Abschluss dieser Methoden möglich ist, erstellen wir einen neuen Stream, in dem wir einen Link zur Datenbank erhalten. Anschließend erhalten wir das DAO und fügen die erforderlichen Daten ein. </p><br><pre> <code class="kotlin hljs">Room.databaseBuilder(context.applicationContext, DataDatabase::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">"Sample.db") // prepopulate the database after onCreate was called .addCallback</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : Callback() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(db: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SupportSQLiteDatabase</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(db) <span class="hljs-comment"><span class="hljs-comment">// moving to a new thread ioThread { getInstance(context).dataDao() .insert(PREPOPULATE_DATA) } } }) .build()</span></span></code> </pre> <br><p>  Das vollständige Beispiel finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><p>  <strong>Hinweis:</strong> Wenn Sie den <code>ioThread</code> Ansatz verwenden und die Anwendung beim ersten Start zwischen dem Erstellen der Datenbank und dem Einfügen abstürzt, werden die Daten niemals eingefügt. </p><br><h2 id="2-ispolzovanie-vozmozhnostey-nasledovaniya-dao">  2. Verwenden von DAO-Vererbungsfunktionen </h2><br><p>  Haben Sie mehrere Tabellen in Ihrer Datenbank und kopieren Sie dieselben Methoden zum <strong>Einfügen</strong> , <strong>Aktualisieren</strong> und <strong>Löschen</strong> ?  DAOs unterstützen die Vererbung. Erstellen Sie daher eine <code>BaseDao&lt;T&gt;</code> -Klasse und definieren Sie dort Ihre allgemeinen Methoden <code>@Insert</code> , <code>@Update</code> und <code>@Delete</code> .  Lassen Sie jedes DAO <code>BaseDao</code> und Methoden hinzufügen, die für jedes von ihnen spezifisch sind. </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseDao</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Insert</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">vararg</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> } <span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataDao</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BaseDao</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Data</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-meta"><span class="hljs-meta">@Query(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SELECT * FROM Data"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Data&gt; }</code> </pre> <br><p>  Details finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><p>  DAOs müssen Schnittstellen oder abstrakte Klassen sein, da Room ihre Implementierung zur Kompilierungszeit generiert, einschließlich Methoden von <code>BaseDao</code> . </p><br><h2 id="3-vypolnenie-zaprosov-v-tranzakciyah-bez-shablonnogo-koda">  3. Ausführen von Abfragen in Transaktionen ohne Boilerplate-Code </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Durch</a> das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Annotieren einer</a> Methode mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@Transaction wird</a> sichergestellt, dass alle Datenbankoperationen, die Sie in dieser Methode ausführen, innerhalb derselben Transaktion ausgeführt werden.  Eine Transaktion wird nicht ausgeführt, wenn im Methodenkörper eine Ausnahme auftritt. </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Transaction</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(users: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">User</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { deleteAllUsers() insertAll(users) } <span class="hljs-meta"><span class="hljs-meta">@Insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insertAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(users: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">User</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> <span class="hljs-meta"><span class="hljs-meta">@Query(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"DELETE FROM Users"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteAllUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> }</code> </pre> <br><p>  Möglicherweise möchten Sie die Annotation <code>@Transaction</code> für <code>@Transaction</code> Methoden verwenden, die die <code>select</code> Anweisung in folgenden Fällen verwenden: </p><br><ul><li>  Wenn das Abfrageergebnis ziemlich groß ist.  Indem Sie eine Anfrage in einer Transaktion stellen, stellen Sie sicher, dass das Ergebnis der Anfrage, wenn es nicht in einen „Teil“ des Cursors passt, nicht durch Änderungen in der Datenbank zwischen den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cursorpermutationen</a> beschädigt wird. </li><li>  Wenn das Abfrageergebnis ein POJO mit <code>@Relation</code> Feldern ist.  Jedes Feld ist eine Anforderung für sich. Wenn Sie sie also in einer Transaktion ausführen, werden konsistente Ergebnisse zwischen den Anforderungen sichergestellt. </li></ul><br><p>  Die <code>@Insert</code> <code>@Delete</code> , <code>@Update</code> und <code>@Insert</code> , die mehrere Parameter haben, werden automatisch innerhalb der Transaktion gestartet. </p><br><h2 id="4-chtenie-tolko-togo-chto-vam-nuzhno">  4. Lesen Sie nur das, was Sie brauchen </h2><br><p>  Verwenden Sie beim Anfordern der Datenbank alle Felder, die Sie in der Antwort erhalten?  Achten Sie auf die von Ihrer Anwendung verwendete Speichermenge und laden Sie nur die Felder herunter, die Sie letztendlich verwenden werden.  Dies erhöht auch die Geschwindigkeit Ihrer Anfragen, indem die Kosten für E / A gesenkt werden.  Room übernimmt für Sie die Zuordnung zwischen den Spalten und dem Objekt. </p><br><p>  Betrachten Sie dieses komplexe <code>User</code> : </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity(tableName = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"users"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span></span>(<span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> id: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> firstName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lastName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> email: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dateOfBirth: Date, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> registrationDate: Date)</code> </pre> <br><p>  Auf einigen Bildschirmen müssen nicht alle diese Informationen angezeigt werden.  Daher können wir stattdessen ein <code>UserMinimal</code> Objekt erstellen, das nur die erforderlichen Daten enthält. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserMinimal</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userId: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> firstName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lastName: String)</code> </pre> <br><p>  In der DAO-Klasse definieren wir die Abfrage und wählen die richtigen Spalten aus der <code>users</code> . </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Query(“SELECT userId, firstName, lastName FROM Users)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUsersMinimal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;UserMinimal&gt; }</code> </pre> <br><h2 id="5-kontrol-zavisimostey-mezhdu-suschnostyami-s-vneshnimi-klyuchami">  5. Kontrolle der Abhängigkeiten zwischen Entitäten mit Fremdschlüsseln </h2><br><p>  Obwohl Room Beziehungen zwischen Entitäten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nicht direkt unterstützt</a> , können Sie Abhängigkeiten zwischen Objekten mithilfe von Fremdschlüsseln definieren. </p><br><p>  Der Raum verfügt über die Annotation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@ForeignKey</a> , die Teil der Annotation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@Entity ist</a> .  In der Funktionalität ähnelt es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fremdschlüsseln in SQLite</a> .  Es garantiert die Beibehaltung der Beziehungen zwischen Entitäten, wenn Änderungen an der Datenbank vorgenommen werden.  Definieren Sie zum Hinzufügen das Objekt, auf das verwiesen werden soll, sowie die Spalten im aktuellen Objekt und das Volume, auf das Sie sich beziehen. </p><br><p>  Betrachten Sie die Klasse <code>User</code> und <code>Pet</code> .  <code>Pet</code> hat einen Besitzer - die Benutzer-ID, auf die der Fremdschlüssel verweist. </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity(tableName = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"pets"</span></span></span><span class="hljs-meta">, foreignKeys = arrayOf( ForeignKey(entity = User::class, parentColumns = arrayOf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"userId"</span></span></span><span class="hljs-meta">)</span></span>, childColumns = arrayOf(<span class="hljs-string"><span class="hljs-string">"owner"</span></span>)))) <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pet</span></span></span></span>(<span class="hljs-meta"><span class="hljs-meta">@PrimaryKey</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> petId: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> owner: String)</code> </pre> <br><p>  Wenn Sie möchten, können Sie festlegen, welche Aktion ausgeführt werden soll, wenn das übergeordnete Element in der Datenbank gelöscht oder aktualisiert wird.  Sie können eine der folgenden Optionen <code>NO_ACTION</code> : <code>NO_ACTION</code> , <code>RESTRICT</code> , <code>SET_NULL</code> , <code>SET_DEFAULT</code> oder <code>CASCADE</code> , die sich wie in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SQLite</a> verhalten. </p><br><p>  <strong>Hinweis:</strong> In Room funktioniert <code>SET_NULL</code> wie <code>SET_NULL</code> , weil  In Room können Sie noch keine Standardwerte für Spalten festlegen. </p><br><h2 id="6-uproschenie-zaprosov-odin-ko-mnogim-s-pomoschyu-relation">  6. Vereinfachen Sie Eins-zu-Viele-Abfragen mit @Relation </h2><br><p>  Im vorherigen Beispiel <code>User</code> - <code>Pet</code> können wir sagen, dass es eine <strong>Eins-zu-Viele-</strong> Beziehung gibt: Der Benutzer kann mehrere Haustiere haben.  Angenommen, wir möchten eine Liste der Benutzer mit ihren Haustieren erhalten: <code>List&lt;UserAndAllPets&gt;</code> . </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserAndAllPets</span></span></span><span class="hljs-class"> </span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user: User, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pets: List&lt;Pet&gt; = ArrayList())</code> </pre> <br><p>  Um dies manuell zu tun, benötigen wir zwei Abfragen: eine, um eine Liste aller Benutzer zu erhalten, und die andere, um eine Liste der Haustiere basierend auf der Benutzer-ID zu erhalten. </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Query(“SELECT * FROM Users”)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;User&gt; getUsers(); <span class="hljs-meta"><span class="hljs-meta">@Query(“SELECT * FROM Pets where owner = :userId”)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;Pet&gt; getPetsForUser(String userId);</code> </pre> <br><p>  Dann werden wir die Liste der Benutzer durchlaufen und jedes Mal auf die Tabelle " <code>Pets</code> zugreifen. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@Relation</a> Annotation erleichtert unser Leben: Es werden automatisch verwandte Objekte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">angefordert</a> .  <code>@Relation</code> kann nur auf <code>List</code> oder <code>Set</code> angewendet werden.  Aktualisieren Sie die UserAndAllPets-Klasse: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserAndAllPets</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Embedded</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> user: User? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@Relation(parentColumn = “userId”, entityColumn = “owner”)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pets: List&lt;Pet&gt; = ArrayList() }</code> </pre> <br><p>  Im DAO definieren wir eine Abfrage, und Room fragt die <code>Users</code> und <code>Pets</code> und ordnet die Objekte selbst zu. </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Transaction</span></span> <span class="hljs-meta"><span class="hljs-meta">@Query(“SELECT * FROM Users”)</span></span> List&lt;UserAndAllPets&gt; getUsers();</code> </pre> <br><h2 id="7-izbezhanie-lozhnyh-uvedomleniy-observable-zaprosov">  7. Vermeiden Sie falsche Benachrichtigungen für beobachtbare Anfragen </h2><br><p>  Angenommen, Sie möchten einen Benutzer anhand einer beobachtbaren Anforderung anhand seiner Kennung ermitteln: </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Query(“SELECT * FROM Users WHERE userId = :id)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: LiveData&lt;User&gt; <span class="hljs-comment"><span class="hljs-comment">// or @Query(“SELECT * FROM Users WHERE userId = :id) fun getUserById(id: String): Flowable&lt;User&gt;</span></span></code> </pre> <br><p>  Sie erhalten jedes Mal ein neues <code>User</code> wenn es aktualisiert wird.  Sie erhalten dieses Objekt jedoch auch, wenn andere Änderungen in der <code>Users</code> (Löschungen, Aktualisierungen oder Einfügungen) auftreten, die nichts mit dem Benutzer zu tun haben, an dem Sie interessiert sind, was zu falschen Benachrichtigungen führt.  Wenn Ihre Abfrage mehrere Tabellen enthält, erhalten Sie außerdem neue Nachrichten, wenn sich an einer dieser Tabellen etwas ändert. </p><br><p>  Folgendes passiert hinter den Kulissen: </p><br><ol><li>  SQLite hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Trigger</a> , die <code>DELETE</code> , wenn <code>DELETE</code> , <code>UPDATE</code> oder <code>INSERT</code> in einer Tabelle auftreten. </li><li>  Room erstellt einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">InvalidationTracker</a> , der <code>Observers</code> , die alle Änderungen in den beobachteten Tabellen verfolgen. </li><li>  Sowohl <code>LiveData</code> als auch <code>Flowable</code> Anforderungen <code>Flowable</code> auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Benachrichtigung InvalidationTracker.Observer # onInvalidated</a> .  Wenn es empfangen wird, tritt eine wiederholte Anforderung auf. </li></ol><br><p>  Der Raum weiß nur, dass der Tisch geändert wurde, weiß aber nicht, warum und was sich geändert hat.  Daher wird nach einer zweiten Anforderung das Ergebnis der Anforderung mit <code>LiveData</code> oder <code>Flowable</code> .  Weil  Der Raum speichert keine Daten im Speicher und kann nicht feststellen, ob es sich um dieselben Daten handelt oder nicht. </p><br><p>  Sie müssen sicherstellen, dass Ihr DAO <strong>Anforderungen filtert</strong> und nur auf die erforderlichen Objekte reagiert. </p><br><p>  Wenn die beobachtbare Abfrage mit <code>Flowables</code> implementiert <code>Flowables</code> , verwenden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Flowable # diverUntilChanged</a> . </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDao</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BaseDao</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-comment"><span class="hljs-comment">/** * Get a user by id. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> the user from the table with a specific id. */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Query(“SELECT * FROM Users WHERE userid = :id”)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Flowable&lt;User&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDistinctUserById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Flowable&lt;User&gt; = getUserById(id) .distinctUntilChanged() }</code> </pre> <br><p>  Wenn Ihre Abfrage <code>LiveData</code> , können Sie <code>MediatorLiveData</code> , das nur die gewünschten Objekte von der Quelle empfängt. </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> LiveData</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDistinct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: LiveData&lt;T&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> distinctLiveData = MediatorLiveData&lt;T&gt;() distinctLiveData.addSource(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : Observer&lt;T&gt; { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initialized = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastObj: T? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">T</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!initialized) { initialized = <span class="hljs-literal"><span class="hljs-literal">true</span></span> lastObj = obj distinctLiveData.postValue(lastObj) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; lastObj != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || obj != lastObj) { lastObj = obj distinctLiveData.postValue(lastObj) } } }) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> distinctLiveData }</code> </pre> <br><p>  In Ihren DAOs ist die Methode, die <code>LiveData</code> zurückgibt, <code>public</code> und die Methode, die die Datenbank abfragt, ist <code>protected</code> . </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Dao</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserDao</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BaseDao</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-meta"><span class="hljs-meta">@Query(“SELECT * FROM Users WHERE userid = :id”)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: LiveData&lt;User&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDistinctUserById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: LiveData&lt;User&gt; = getUserById(id).getDistinct() }</code> </pre> <br><p>  Das vollständige Codebeispiel finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><p>  <strong>Hinweis:</strong> Wenn Sie eine Liste zur Anzeige anfordern, beachten Sie die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Paging-Bibliothek</a> , die einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LivePagedListBuilder zurückgibt</a> .  Die Bibliothek hilft Ihnen dabei, die Differenz zwischen Listenelementen automatisch zu berechnen und Ihre Benutzeroberfläche zu aktualisieren. </p><br><blockquote>  <em>Siehe auch: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">7 Schritte zur Verwendung von Room.</a></em>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Exemplarische Vorgehensweise zum Migrieren Ihrer Anwendung nach Room</a></em> </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442786/">https://habr.com/ru/post/de442786/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442776/index.html">Indizes in PostgreSQL - 3 (Hash)</a></li>
<li><a href="../de442778/index.html">Learning Go: Eine Auswahl von Videoberichten</a></li>
<li><a href="../de442780/index.html">Die häufigsten Missverständnisse in der Populärphysik</a></li>
<li><a href="../de442782/index.html">VShard - horizontale Skalierung in Tarantool</a></li>
<li><a href="../de442784/index.html">BGP-Hijacking durch Hinzufügen des AS des Opfers zum AS-SET des Angreifers</a></li>
<li><a href="../de442788/index.html">Warum brauchen wir ein Überwachungssystem auf einem Chip?</a></li>
<li><a href="../de442790/index.html">Die Registrierung für das Allure Server Meetup in St. Petersburg ist offen</a></li>
<li><a href="../de442794/index.html">Wir laden Sie zur Konferenz „(IT) Architekt in IT-Projekten und -Organisationen“ ein.</a></li>
<li><a href="../de442796/index.html">Umfrage: Cloud-Technologien in GIS- und Geodatendiensten</a></li>
<li><a href="../de442798/index.html">Das Überwachen von Pings zwischen Kubernetes-Hosts ist unser Rezept</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>