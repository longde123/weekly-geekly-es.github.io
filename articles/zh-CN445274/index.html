<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🏭 👶🏿 📒 当“Zoë”！==“Zoë”时，或者为什么需要标准化Unicode字符串 👩🏾‍🌾 👈🏾 🎰</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="听说过Unicode规范化吗？ 你并不孤单。 但是每个人都需要知道这一点。 标准化可以为您节省很多问题。 任何开发人员迟早都会发生与下图中所示类似的事情。 
 Zoë不是Zoë 

 顺便说一下，这并不是另一个奇怪的 JavaScript的例子。 该材料的作者（我们今天出版的翻译版）说，他可以证明使...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>当“Zoë”！==“Zoë”时，或者为什么需要标准化Unicode字符串</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/445274/"> 听说过Unicode规范化吗？ 你并不孤单。 但是每个人都需要知道这一点。 标准化可以为您节省很多问题。 任何开发人员迟早都会发生与下图中所示类似的事情。 <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aed/667/54c/aed66754c254c8eb6c077d2a418f1db6.png"></div>  <i><font color="#999999">Zoë不是Zoë</font></i> <br><a name="habracut"></a><br> 顺便说一下，这并不是另一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">奇怪的</a> JavaScript的例子。 该材料的作者（我们今天出版的翻译版）说，他可以证明使用几乎所有现有的编程语言时，同样的问题如何表现出来。 特别是，我们谈论的是Python，Go甚至shell脚本。 怎么处理呢？ <br><br><h2>  <font color="#3AC1EF">背景知识</font> </h2><br> 多年前，当我编写一个应用程序（在Objective-C中）从用户的通讯录及其社交网络中导入联系人列表时，我首先遇到了Unicode问题，之后我消除了重复项。 在某些情况下，事实证明有些人两次出现在名单上。 发生这种情况的原因是，根据程序，它们的名称不是相同的字符串。 <br><br> 尽管在上面的示例中这两行看起来完全相同，但是它们在系统中的显示方式不同，但它们在磁盘上存储的字节不同。 在名字<code>"Zoë"</code> ë”（带有变音符）字符表示单个Unicode代码点。 在第二种情况下，我们正在处理分解，即使用多个字符表示字符的方法。 如果在您的应用程序中使用Unicode字符串，则需要考虑以下事实：相同的字符可以用不同的方式表示。 <br><br><h2>  <font color="#3AC1EF">表情符号的使用方法：简而言之，字符编码</font> </h2><br> 计算机使用字节来工作，字节只是数字。 为了能够在计算机上处​​理文本，人们一致同意字符和数字的对应关系，并就字符的外观表示方式达成一致。 <br><br> 第一个这样的协议由ASCII（美国信息交换标准代码）编码表示。 该编码使用7位，可以表示128个字符，其中包括拉丁字母（大写和小写字母），数字和基本标点符号。  ASCII还包括许多“不可打印”字符，例如换行符，制表符，回车符等。 例如，在ASCII中，拉丁字母M（大写m）被编码为77（十六进制表示为4D）。 <br><br>  ASCII的问题在于，尽管128个字符足以代表使用英语文本的人们通常使用的所有字符，但是此数量的字符不足以表示其他语言的文本和各种特殊字符（如表情符号）。 <br><br> 解决此问题的方法是采用Unicode标准，该标准旨在表示所有现代和古代文本中使用的每个字符，包括表情符号之类的字符。 例如，在最新的Unicode 12.0标准中，有超过137,000个字符。 <br><br> 可以使用多种字符编码方法来实现Unicode标准。 最常见的是UTF-8和UTF-16。 应当指出，在网络空间中，最常见的是用于对文本进行UTF-8编码的标准。 <br><br>  UTF-8标准使用1到4个字节来表示字符。  UTF-8是ASCII的超集，因此其前128个字符与ASCII码表中表示的字符匹配。 另一方面，UTF-16标准使用2到4个字节来表示1个字符。 <br><br> 为什么都有这两个标准？ 事实是西方语言的文本通常使用UTF-8标准进行最有效的编码（因为此类文本中的大多数字符都可以表示为1字节大小的代码）。 如果我们谈论东方语言，那么可以说使用UTF-16来存储以这些语言编写的文本的文件通常较少。 <br><br><h2>  <font color="#3AC1EF">Unicode代码点和字符编码</font> </h2><br>  Unicode标准中的每个字符都分配有一个称为代码点的标识号。 例如，一个代码点表情符号 <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"> 是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">U + 1F436</a> 。 <br><br> 对该图标进行编码时，它可以表示为各种字节序列： <br><br><ul><li>  UTF-8：4个字节， <code>0xF0 0x9F 0x90 0xB6</code> </li><li>  UTF-16：4个字节， <code>0xD83D 0xDC36</code> </li></ul><br> 在下面的JavaScript代码中，所有这三个命令将相同的字符输出到浏览器控制台。 <br><br> <code>//         <br> console.log(' <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"> ') // =&gt; <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"> <br> //     Unicode (ES2015+) <br> console.log('\u{1F436}') // =&gt; <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"> <br> //        UTF-16 <br> //      ( 2  ) <br> console.log('\uD83D\uDC36') // =&gt; <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"></code> <br><br> 大多数JavaScript解释器（包括Node.js和现代浏览器）的内部机制都使用UTF-16。 这意味着我们正在考虑的狗图标使用两个UTF-16代码单元（每个16位）存储。 因此，以下代码输出对您来说似乎不应该理解： <br><br> <code>console.log(' <img src="https://habrastorage.org/webt/j9/wk/dp/j9wkdpjar2e6a4ixmkb6oo4upii.png"> '.length) // =&gt; 2</code> <br> <br><h2>  <font color="#3AC1EF">字符组合</font> </h2><br> 现在回到开始的地方，即让我们讨论为什么对于一个人来说看起来相同的符号具有不同的内部表示形式。 <br><br> 某些Unicode字符旨在修改其他字符。 它们被称为组合字符。 它们适用于基本字符，例如： <br><br><ul><li> <code>n + ˜ = ñ</code> </li> <li> <code>u + ¨ = ü</code> </li> <li> <code>e + ´ = é</code> </li> </ul><br> 从前面的示例中可以看到，可组合字符使您可以在基本字符中添加变音符号。 但是Unicode的字符转换功能不限于此。 例如，某些字符序列可以表示为连字（因此ae可以变成æ）。 <br><br> 问题在于特殊字符可以以各种方式表示。 <br><br> 例如，字母é可以用两种方式表示： <br><br><ul><li> 使用单个代码点<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">U + 00E9</a> 。 </li><li> 使用字母e和急性符号的组合，即使用两个代码点<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-U + 0065</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">U + 0301</a> 。 </li></ul><br> 使用上述任何一种表示字母é的方式产生的字符看起来都是相同的，但是相比之下，结果却发现它们是不同的。 包含它们的行将具有不同的长度。 您可以通过在浏览器控制台中运行以下代码来验证这一点。 <br><br><pre> <code class="plaintext hljs">console.log('\u00e9') // =&gt; é console.log('\u0065\u0301') // =&gt; é console.log('\u00e9' == '\u0065\u0301') // =&gt; false console.log('\u00e9'.length) // =&gt; 1 console.log('\u0065\u0301'.length) // =&gt; 2</code> </pre> <br> 这可能会导致意外错误。 例如，它们可以表示为以下事实：由于未知原因，该程序无法在数据库中找到某些条目，因为输入正确密码的用户无法登录系统。 <br><br><h2>  <font color="#3AC1EF">线归一化</font> </h2><br> 上面的问题有一个简单的解决方案，其中包括规范化字符串，将其带入“规范表示”。 <br><br> 归一化有四种标准形式（算法）： <br><br><ul><li>  NFC：规范化表格规范组成。 </li><li>  NFD：规范化形式规范分解。 </li><li>  NFKC：标准化表格兼容性组成。 </li><li>  NFKD：标准化表格兼容性分解。 </li></ul><br> 最常用的规范化形式是NFC。 使用此算法时，首先分解所有字符，然后按照标准定义的顺序重新组合所有组合序列。 对于实际使用，您可以选择任何形式。 最主要的是始终如一地应用它。 结果，在程序输入处接收相同的数据将始终导致相同的结果。 <br><br> 在JavaScript中，从ES2015（ES6）标准开始，存在一种用于标准化字符串的内置方法<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-String.prototype.normalize（[form]）</a> 。 您可以在Node.js环境和几乎所有现代浏览器中使用它。 此方法的<code>form</code>参数是规范化表单的字符串标识符。 默认值为NFC表单。 <br><br> 我们回到前面考虑的示例，这次应用规范化： <br><br><pre> <code class="plaintext hljs">const str = '\u0065\u0301' console.log(str == '\u00e9') // =&gt; false const normalized = str.normalize('NFC') console.log(normalized == '\u00e9') // =&gt; true console.log(normalized.length) // =&gt; 1</code> </pre> <br><h2>  <font color="#3AC1EF">总结</font> </h2><br> 如果要开发Web应用程序并使用用户在其中输入的内容，请始终规范化接收到的文本数据。 在JavaScript中，您可以使用标准的字符串方法<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">normalize（）</a>进行规范化。 <br><br>  <b>亲爱的读者们！</b> 您是否遇到过可以通过规范化解决的字符串问题？ <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN445274/">https://habr.com/ru/post/zh-CN445274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN445264/index.html">预加载，预取和其他标签</a></li>
<li><a href="../zh-CN445266/index.html">GeekBrains与Rostelecom一起进行物联网Hackathon</a></li>
<li><a href="../zh-CN445268/index.html">GraphQL详细信息：什么，如何以及为什么</a></li>
<li><a href="../zh-CN445270/index.html">[书签]初学者重击：21条有用的命令</a></li>
<li><a href="../zh-CN445272/index.html">JavaScript是适合初学者的最佳编程语言。 是不是？</a></li>
<li><a href="../zh-CN445276/index.html">完整的使用效果指南</a></li>
<li><a href="../zh-CN445278/index.html">如果您从来都不是艺术家，那么如何创建游戏</a></li>
<li><a href="../zh-CN445280/index.html">网站和服务的盈利能力</a></li>
<li><a href="../zh-CN445284/index.html">ClickHouse产品分析VKontakte</a></li>
<li><a href="../zh-CN445286/index.html">大脑的脚凳：Hedera Hashgraph分布式注册表平台</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>