<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤟🏼 🤦🏼 🙇🏼 Codegenerierung von OpenAPI v3 (auch bekannt als Swagger 3) bis TypeScript und nicht nur 👕 🛀 🚖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor zwei Jahren habe ich mit der Entwicklung begonnen  noch eins  ein kostenloser Codegenerator von OpenAPI Specification v3 bis TypeScript ( verfügba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Codegenerierung von OpenAPI v3 (auch bekannt als Swagger 3) bis TypeScript und nicht nur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483628/"><p>  Vor zwei Jahren habe ich mit der Entwicklung begonnen <del>  noch eins </del>  ein kostenloser Codegenerator von <a href="https://swagger.io/docs/specification/about/">OpenAPI Specification</a> v3 bis TypeScript ( <a href="https://github.com/koshevy/codegena">verfügbar auf Github</a> ).  Zunächst wollte ich <a href="https://json-schema.org/understanding-json-schema/reference/combining.html">einfache</a> und komplexe Datentypen in TypeScript effizient generieren und dabei verschiedene <a href="https://json-schema.org/">JSON-</a> <a href="https://json-schema.org/understanding-json-schema/reference/combining.html">Schemafunktionen</a> berücksichtigen, z. B. <a href="https://json-schema.org/understanding-json-schema/reference/combining.html">oneOf / anyOf / allOf</a> usw.  (Swaggers <a href="https://github.com/swagger-api/swagger-codegen">native Lösung</a> hatte einige Probleme damit).  Eine weitere Idee bestand darin, Schemata aus Spezifikationen für die Validierung auf der Vorder- und Rückseite sowie auf anderen Teilen des Systems zu verwenden. </p><br><p><img src="https://habrastorage.org/webt/hz/cd/u4/hzcdu47rcjbutgqbe6pdb2k46x8.png"></p><a name="habracut"></a><br><p>  Jetzt ist der Codegenerator relativ fertig - er befindet sich im <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B8%25D0%25BD%25D0%25B8%25D0%25BC%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE_%25D0%25B6%25D0%25B8%25D0%25B7%25D0%25BD%25D0%25B5%25D1%2581%25D0%25BF%25D0%25BE%25D1%2581%25D0%25BE%25D0%25B1%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BA%25D1%2582">MVP-</a> Stadium.  Es verfügt über viele Funktionen zum Generieren von Datentypen sowie über eine experimentelle Bibliothek zum Generieren von Front-End-Diensten (bisher für Angular).  In diesem Artikel möchte ich die Entwicklungen zeigen und erläutern, wie sie helfen können, wenn Sie TypeScript und OpenAPI v3 verwenden.  Unterwegs möchte ich einige Ideen und Überlegungen mitteilen, die sich in meinem Arbeitsprozess ergeben haben.  Wenn Sie interessiert sind, können Sie die Hintergrundgeschichte lesen, die ich im Spoiler versteckt habe, um das Lesen des technischen Teils nicht zu erschweren. </p><br><h2 id="soderzhanie">  Inhalt </h2><br><ol><li>  <a href="https://habr.com/ru/post/483628/">Hintergrund</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Beschreibung</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Installation und Verwendung</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Üben Sie die Verwendung eines Codegenerators</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Generierte Datentypen in Anwendungen verwenden</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Zerlegung von Stromkreisen innerhalb der OAS-Spezifikation</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Verschachtelte Zerlegung</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Automatisch generierte Services für die Arbeit mit der REST-API</a> <br><ol><li>  <a href="https://habr.com/ru/post/483628/">Warum ist das nötig?</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Service-Generierung</a> </li><li>  <a href="https://habr.com/ru/post/483628/">Generierte Services verwenden</a> </li></ol></li><li>  <a href="https://habr.com/ru/post/483628/">Anstelle eines Nachwortes</a> </li></ol><br><a name="Foreword"></a><br><h2 id="predystoriya">  Hintergrund </h2><br><div class="spoiler">  <b class="spoiler_title">Zum Lesen erweitern (überspringen)</b> <div class="spoiler_text"><p>  Alles begann vor zwei Jahren - dann arbeitete ich für ein Unternehmen, das eine Data Mining-Plattform entwickelte, und war für das Frontend (hauptsächlich TypeScript + Angular) verantwortlich.  Die Projektmerkmale waren komplexe Datenstrukturen mit einer großen Anzahl von Parametern (30 oder mehr) und nicht immer offensichtlichen Geschäftsbeziehungen zwischen ihnen.  Das Unternehmen wuchs und die Softwareumgebung wurde häufig geändert.  Das Frontend musste sich in den Nuancen auskennen, da einige Berechnungen im Frontend und im Backend dupliziert wurden.  Das heißt, dies war der Fall, wenn die Verwendung von OpenAPI mehr als angemessen ist.  Ich fand eine Zeit in der Firma, in der das Entwicklungsteam innerhalb weniger Monate eine einzige Spezifikation erwarb, die zu einer gemeinsamen Wissensbasis für die hintere, vordere und sogar die Kernabteilung wurde, die sich hinter der breiten Rückseite des Web-Backends verbarg.  Die OpenAPI-Version wurde „zum Wachsen“ gewählt - damals noch recht jung v3.0 </p><br><p>  Dies war keine Spezifikation mehr in einer oder mehreren statischen YML / JSON-Dateien und nicht das Ergebnis von <a href="https://github.com/zircote/swagger-php">Annotatoren</a> , sondern eine ganze Bibliothek von Komponenten, Methoden, Vorlagen und Eigenschaften, die gemäß dem DDD-Konzept der Plattform organisiert wurden.  Die Bibliothek war in Verzeichnisse und Dateien unterteilt, und ein speziell zusammengestellter Sammler erstellte OAS-Dokumente für jeden Themenbereich.  Ein experimenteller Weg war der Aufbau eines Workflows, der als Design-First bezeichnet werden konnte. </p><br><blockquote>  Es gibt einen <a href="https://habr.com/ru/company/yamoney/blog/347390/">guten Artikel</a> im Blog des Unternehmens Yandex.Money, in dem es um Design First ging </blockquote><p>  Design First und die allgemeine Spezifikation halfen bei der Deaktivierung des Wissens, aber ein neues Problem wurde offensichtlich - die Beibehaltung der Relevanz des Codes.  In der Spezifikation wurden mehrere Dutzend Methoden und Dutzende (und später Hunderte) von Entitäten beschrieben.  Der Code musste jedoch manuell geschrieben werden: Datentypen, Dienste für die Arbeit mit REST usw.  Ein oder zwei Sprints mit parallelen Geschichten haben das Bild stark verändert;  Fügen Sie der Verschmelzung mehrerer Geschichten und des menschlichen Faktors Komplexität hinzu.  Die Routine drohte bedeutend zu sein, und die Lösung schien offensichtlich: Sie müssen Code generieren.  Schließlich enthielten die OAS-Spezifikationen bereits alles Notwendige, um sie nicht manuell erneut einzugeben.  Aber es war nicht so einfach. </p><br><p>  Das Frontend befindet sich ganz am Ende des Produktionszyklus, so dass ich schmerzhaftere Veränderungen verspürte als Kollegen aus anderen Abteilungen.  Bei der Entwicklung der REST-API entschied die Backend-Umgebung, und selbst nach der Genehmigung von „Design First“ blieb die Trägheit bestehen.  Für das Frontend schien alles weniger offensichtlich zu sein.  Tatsächlich verstand ich das von Anfang an und begann, den Boden im Voraus zu untersuchen - als die Rede von einer „universellen“ Spezifikation gerade erst begann.  Es war nicht die Rede davon, einen eigenen Codegenerator zu schreiben.  Ich wollte nur etwas fertig finden. </p><br><p>  Ich war enttäuscht  Es gab zwei Probleme: Die OAS-Version 3.0, mit deren Unterstützung anscheinend niemand in Eile war, und die Qualität der Lösungen selbst - zu dieser Zeit (ich erinnere mich an sie vor zwei Jahren) gelang es mir, zwei relativ fertige Lösungen zu finden: <a href="https://github.com/swagger-api/swagger-codegen">von Swagger</a> und von Microsoft (es scheint <a href="https://github.com/Azure/autorest">so</a> ).  In der ersten Phase befand sich die Unterstützung für OAS 3.0 in einer tiefen Beta.  Der zweite funktionierte nur mit Version 2.x, es gab jedoch keine eindeutigen Vorhersagen.  Übrigens konnte ich den Microsoft-Codegenerator auch bei einem Testdokument im Swagger 2.0-Format nicht starten.  Die Lösung von Swagger funktionierte, aber ein mehr oder weniger kompliziertes Schema mit $ ref-Links verwandelte sich in einen unverständlichen "FEHLER!", Und rekursive Abhängigkeiten schickten es in eine Endlosschleife.  Es gab Probleme mit <a href="">primitiven Typen</a> .  Außerdem verstand ich nicht ganz, wie man mit automatisch generierten Diensten arbeitet - sie schienen nur für Shows gedacht zu sein, und ihre tatsächliche Verwendung verursachte mehr Probleme als sie lösten (meiner Meinung nach).  Und schließlich war die Integration der JAR-Datei in eine NPM-orientierte CI / CD unpraktisch: Ich musste den <a href="https://oss.sonatype.org/content/repositories/snapshots/io/swagger/codegen/v3/swagger-codegen-cli/3.0.15-SNAPSHOT/">erforderlichen Schnappschuss</a> , der 13 Megabyte zu wiegen schien, manuell herunterladen und etwas damit anfangen.  Im Allgemeinen machte ich eine Pause und beschloss zu beobachten, was als nächstes passiert. </p><br><p>  Nach ungefähr fünf Monaten tauchte das Problem der Codegenerierung erneut auf.  Ich musste einen Teil der Webanwendung neu schreiben und erweitern, und gleichzeitig wollte ich alte Services für die Arbeit mit der REST-API und den Datentypen überarbeiten.  Die Bewertung der Komplexität war jedoch nicht optimistisch: von einer Mannwoche bis zwei - und dies gilt nur für REST-Services und Typbeschreibungen.  Ich werde nicht sagen, dass es mich sehr deprimiert hat, aber trotzdem.  Andererseits habe ich nie eine Lösung für die Codegenerierung gefunden und nicht gewartet, und die Implementierung würde kaum weniger Zeit in Anspruch nehmen.  Das heißt, es gab keine Frage: Der Nutzen ist zweifelhaft, die Risiken sind groß.  Niemand würde diese Idee unterstützen, und ich schlug nicht vor.  In der Zwischenzeit näherten sich die Maiferien, und die Firma schuldete mir mehrere Tage für die Freistellung am Wochenende.  Zwei Wochen lang bin ich von all den Arbeitserfahrungen nach Georgia geflüchtet, wo ich einmal fast ein Jahr lang gelebt habe. </p><br><p>  Zwischen Partys und Festen musste ich etwas unternehmen und entschied mich, meine Entscheidung aufzuschreiben.  Die Arbeit in Sommercafés in der Nähe von Vake Park war überraschend produktiv, und ich kehrte mit einem vorgefertigten Codegenerator für Datentypen zu Peter zurück.  Dann „beendete“ ich für einen weiteren Monat die Gottesdienste an den Wochenenden, bevor er zur Arbeit bereit war. </p><br><p>  Von Anfang an habe ich den Codegenerator geöffnet und in meiner Freizeit daran gearbeitet.  Obwohl in der Tat schrieb er für einen Arbeitsentwurf.  Ich werde nicht sagen, dass die Überarbeitung / Einarbeitung ohne Probleme verlief;  und ich werde nicht sagen, dass sie bedeutend waren.  Aber irgendwann bemerkte ich, dass ich die Redoc / Swagger-Dokumentation nicht mehr verwendete: Das Navigieren im Code war bequemer, vorausgesetzt, der Code ist immer aktuell und kommentiert.  Bald „bewertete“ ich meine Leistungen, ohne sie in irgendeiner Weise weiterzuentwickeln, bis ein Kollege (vor einem halben Jahr bin ich zu einem anderen Unternehmen gegangen) mir riet, sie ernster zu nehmen (er hatte auch den Namen). </p><br><blockquote>  Ich hatte nicht genug Freizeit und brauchte mehrere Monate, um im Hintergrund fertig zu werden: <a href="https://stackblitz.com/edit/codegena-playground">Spielplatz</a> , Testanwendung, Reorganisation des Projekts.  Jetzt bin ich bereit, Feedback zu erhalten. </blockquote></div></div><br><a name="Description"></a><br><h2 id="opisanie">  Beschreibung </h2><br><p> Gegenwärtig umfasst die Lösung zur Codegenerierung drei NPM-Bibliotheken, die in den @ codegena- <code>@codegena</code> und sich in einem gemeinsamen <a href="https://github.com/koshevy/codegena">Mono-Repository befinden</a> : </p><br><div class="scrollable-table"><table><thead><tr><th>  Die Bibliothek </th><th>  Beschreibung </th></tr></thead><tbody><tr><td>  @ codegena / oapi3ts </td><td>  Die Basisbibliothek ist ein Konverter von OAS3 in Datentypbeschreibungen (unterstützt jetzt nur TypeScript) </td></tr><tr><td>  @ codegena / ng-api-service </td><td>  Erweiterung für Angular Services </td></tr><tr><td>  @ codegena / oapi3ts-cli </td><td>  Shell zur bequemen Verwendung in CLI-Skripten </td></tr></tbody></table></div><br><a name="SetupAndUsing"></a><br><h3 id="ustanovka-i-ispolzovanie">  Installation und Verwendung </h3><br><p>  Die praktischste Option ist die Verwendung in NodeJS-Skripten, die über die CLI ausgeführt werden.  Zuerst müssen Sie die Abhängigkeiten installieren: </p><br><pre> <code class="plaintext hljs">npm i @codegena/oapi3ts, @codegena/ng-api-service, @codegena/oapi3ts-cli</code> </pre> <br><p>  Erstellen Sie dann eine js-Datei (z. B. <code>update-typings.js</code> ) mit dem folgenden Code: </p><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliLib = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@codegena/oapi3ts-cli'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliApp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cliLib.CliApplication; cliApp.createTypings(); <span class="hljs-comment"><span class="hljs-comment">// cliApp.createServices('angular'); // optional</span></span></code> </pre> <br><p>  Und starten Sie es, indem Sie drei Parameter übergeben: </p><br><pre> <code class="plaintext hljs">node ./update-typings.js --srcPath ./specs/todo-app-spec.json --destPath ./src/lib --separatedFiles true</code> </pre> <br><p>  In <code>destPath</code> werden Dateien generiert, und der Inhalt <a href="https://github.com/koshevy/codegena/tree/master/libs/todo-app-scheme/src/lib">dieses Verzeichnisses</a> im Projekt-Repository wird auf dieselbe Weise erstellt.  <a href="">Hier ist das Generierungsskript</a> , und <a href="">so wird</a> es in NPM-Skripten ausgeführt.  Wenn Sie möchten, können Sie es jedoch auch im Browser verwenden, wie im <a href="https://codegena-playground.stackblitz.io/">Spielplatz</a> . </p><br><a name="CodegenerationUsingPractice"></a><br><h2 id="praktika-ispolzovanie-kodogeneratora">  Üben Sie die Verwendung eines Codegenerators </h2><br><p>  Als nächstes möchte ich darüber sprechen, was wir als Ergebnis erhalten werden: Was ist die Idee, wie dies uns helfen wird.  Eine visuelle Hilfe wird der Code der Demo-Anwendung sein.  Es besteht aus zwei Teilen: einem Backend (auf dem <a href="https://nestjs.com/">NestJS-</a> Framework) und einem Frontend (auf <a href="https://angular.io/">Angular</a> ).  Wenn Sie möchten, können Sie <a href="https://github.com/koshevy/codegena/tree/5367749623826d270fb652e32fa394c023751877">es auch lokal ausführen</a> . </p><br><blockquote>  Auch wenn Sie mit Angular und / oder NestJS nicht vertraut sind, sollte dies keine Probleme verursachen: Die bereitgestellten Codebeispiele sollten von den meisten TypeScript-Entwicklern verstanden werden. </blockquote><p>  Obwohl die Anwendung maximal vereinfacht ist (z. B. speichert das Backend Daten in einer Sitzung und nicht in der Datenbank), habe ich versucht, den darin enthaltenen Datenfluss und die Merkmale der Hierarchie der Datentypen, die der tatsächlichen Anwendung inhärent sind, wiederherzustellen.  Es ist zu etwa 80-85% fertig, aber das "Ende" kann sich verzögern, aber im Moment ist es wichtiger, darüber zu sprechen, was bereits da ist. </p><br><a name="UsingGeneratedDataTypes"></a><br><h2 id="ispolzovanie-generiruemyh-tipov-dannyh-v-prilozheniyah">  Generierte Datentypen in Anwendungen verwenden </h2><br><p>  Angenommen, wir haben eine OpenAPI-Spezifikation (zum Beispiel <a href="">diese</a> ), mit der wir arbeiten müssen.  Es spielt keine Rolle, ob wir etwas von Grund auf neu erstellen oder unterstützen, es gibt eine wichtige Sache, mit der wir am ehesten beginnen - das Tippen.  Wir werden entweder mit der Beschreibung der grundlegenden Datentypen beginnen oder Änderungen daran vornehmen.  Die meisten Programmierer tun dies, um ihre zukünftige Entwicklung zu erleichtern.  Sie müssen also nicht noch einmal in die Dokumentation schauen, sondern müssen die Parameterlisten beachten.  und Sie können sicher sein, dass die IDE und / oder der Compiler einen Tippfehler bemerken. </p><br><p>  Unsere Spezifikation kann den Abschnitt <a href="">components.schemas</a> enthalten oder nicht.  In jedem Fall werden aber Parametersätze, Anfragen und Antworten beschrieben - und wir können sie verwenden.  Betrachten Sie ein Beispiel: </p><br><pre> <code class="javascript hljs">@Controller(<span class="hljs-string"><span class="hljs-string">'group'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @Put(':groupId') rewriteGroup( @Param(ParseQueryPipe) { groupId }: RewriteGroupParameters, @Body() body: RewriteGroupRequest, @Session() session ): RewriteGroupResponse&lt;HttpStatus.OK&gt; { return this.appService .setSession(session) .rewriteGroup(groupId, body); } // ... }</span></span></code> </pre> <br><p>  Dies ist ein <a href="">Controller-</a> Fragment für das NestJS-Framework, dessen Parameter ( <code>RewriteGroupParameters</code> ), Anforderungshauptteil ( <code>RewriteGroupRequest</code> ) und <code>RewriteGroupResponse&lt;T&gt;</code> ( <code>RewriteGroupResponse&lt;T&gt;</code> ) <code>RewriteGroupResponse&lt;T&gt;</code> .  Bereits in diesem Codefragment sehen wir die Vorteile des Tippens: </p><br><ul><li>  Wenn wir den Namen des zerstörten Parameters <code>groupId</code> stattdessen <code>groupId</code> , erhalten wir sofort einen Fehler im Editor. <br><img src="https://habrastorage.org/webt/1z/2q/0c/1z2q0cstw2lv3vncwmgi8gkxfa0.png"></li><li>  Wenn die Methode <a href="">this.appService.rewriteGroup (groupId, body)</a> typisierte Parameter enthält, können wir die Richtigkeit des übergebenen <code>body</code> Parameters <a href="">überprüfen</a> .  Und wenn sich das Eingabedatenformat der Controller-Methode oder der Service-Methode ändert, werden wir sofort darüber informiert.  Mit Blick auf die <code>RewriteGroupRequest</code> ich fest, dass die Eingabemethode der <code>RewriteGroupRequest</code> einen anderen Datentyp als <code>RewriteGroupRequest</code> hat, in unserem Fall jedoch identisch ist.  Wenn jedoch plötzlich die <code>ToDoGroup</code> geändert wird und <code>ToDoGroup</code> anstelle von <code>ToDoGroupBlank</code> akzeptiert wird, zeigen die IDE und der Compiler sofort die Stellen an, an denen Unstimmigkeiten <code>ToDoGroupBlank</code> sind: <br><img src="https://habrastorage.org/webt/wo/cq/rr/wocqrrks2gtcthaq_wghrhlbbta.png"></li><li>  Auf die gleiche Weise können wir die Einhaltung des zurückgegebenen Ergebnisses kontrollieren.  Wenn sich der Status einer erfolgreichen Antwort plötzlich in der Spezifikation ändert und zu <code>202</code> statt zu <code>200</code> , werden wir dies ebenfalls herausfinden, da <code>RewriteGroupResponse</code> <a href="">eine generische</a> <code>RewriteGroupResponse</code> <a href="">mit einem Aufzählungstyp ist</a> : <br><img src="https://habrastorage.org/webt/pt/io/ss/ptiossjjfhihchrlwdlydrrkft4.png"></li></ul><br><p>  Schauen wir uns nun <a href="">ein Beispiel aus der Front-End-Anwendung an</a> , die mit einer <a href="">anderen API-Methode arbeitet</a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initSelectedGroupData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(truth: ComponentTruth)</span></span></span><span class="hljs-function">: Observable&lt;ComponentTruth&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getGroupsService.request(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, { isComplete: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, withItems: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }).pipe( pickResponseBody&lt;GetGroupsResponse&lt;<span class="hljs-number"><span class="hljs-number">200</span></span>&gt;&gt;(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>), switchMap&lt;ToDoGroup[], Observable&lt;ComponentTruth&gt;&gt;( groups =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loadItemsOfSelectedGroups({ ...truth, groups }) ) ); }</code> </pre> <br><p>  Gehen wir nicht weiter und analysieren den benutzerdefinierten RxJS-Operator <code>pickResponseBody</code> , sondern konzentrieren uns auf die Verfeinerung des <code>GetGroupsResponse</code> Typs.  Wir verwenden es in einer Kette von RxJS-Operatoren, und der Operator, der darauf folgt, hat eine Eingabeoptimierung von <code>ToDoGroup[]</code> .  Wenn dieser Code funktioniert, entsprechen die angegebenen Datentypen einander.  Hier können wir auch die Typzuordnung steuern. Wenn sich das Antwortformat in unserer API plötzlich ändert, entgeht dies unserer Aufmerksamkeit nicht: </p><br><p><img src="https://habrastorage.org/webt/ci/hr/7c/cihr7csbo5kqn9fqkreoij7kuxk.png"></p><br><p>  <code>this.getGroupsService.request</code> auch die Aufrufparameter von <code>this.getGroupsService.request</code> eingegeben.  Dies ist jedoch das Thema der generierten Dienste. </p><br><blockquote>  In den obigen Beispielen sehen wir, dass die Eingabe von Anforderungen, Antworten und Parametern in verschiedenen Teilen des Systems verwendet werden kann - Frontend, Backend usw.  Wenn sich das Backend und das Frontend im selben Mono-Repository befinden und eine kompatible Eco-Umgebung haben, können sie dieselbe <a href="https://github.com/koshevy/codegena/tree/5367749623826d270fb652e32fa394c023751877/libs/todo-app-scheme">gemeinsam genutzte Bibliothek</a> mit dem generierten Code verwenden.  Aber selbst wenn das Backend und das Frontend von verschiedenen Teams unterstützt werden und nichts gemeinsam haben, außer der öffentlichen OAS-Spezifikation, ist es für sie immer noch einfacher, ihren Code zu synchronisieren. </blockquote><br><a name="DecompositionInOAS"></a><br><h2 id="dekompoziciya-shem-vnutri-oas-specifikacii">  Zerlegung von Stromkreisen innerhalb der OAS-Spezifikation </h2><br><p>  Wahrscheinlich haben Sie in den vorherigen Beispielen auf die <code>ToDoGroupBlank</code> , <code>ToDoGroup</code> , mit denen <code>RewriteGroupResponse</code> und <code>GetGroupsResponse</code> .  Tatsächlich ist <code>RewriteGroupResponse</code> nur ein generischer Alias ​​für <code>ToDoGroup</code> , <code>HttpErrorBadRequest</code> usw.  Es ist leicht zu erraten, dass sowohl <a href="">ToDoGroup</a> als auch <a href="">HttpErrorBadRequest</a> die Schemata aus dem <a href="">Komponentenschemaspezifikationsabschnitt</a> sind, auf die vom <a href="">rewriteGroup-Endpunkt verwiesen wird</a> (direkt oder über <a href="">Vermittler</a> ): </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"responses"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"200"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Todo group saved"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"content"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"application/json"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"schema"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ToDoGroup"</span></span> } } } }, <span class="hljs-attr"><span class="hljs-attr">"400"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorBadRequest"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"404"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorGroupNotFound"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"409"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorConflict"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"500"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/responses/errorServer"</span></span> } }</code> </pre><br><p>  Dies ist die übliche Zerlegung von Datenstrukturen und ihr Prinzip ist dasselbe wie in anderen Programmiersprachen.  Komponenten können wiederum auch zerlegt werden: Verweisen Sie auf andere Komponenten (auch rekursiv), verwenden Sie Kombinationen und andere JSON-Schema-Funktionen.  Unabhängig von der Komplexität sollten sie jedoch korrekt in Beschreibungen von Datentypen konvertiert werden.  Ich möchte zeigen, wie Sie die Zerlegung in OpenAPI verwenden können und wie der generierte Code aussehen wird. </p><br><blockquote>  Die Komponenten in einer gut entworfenen OAS-Spezifikation überschneiden sich mit dem DDD-Modell der Anwendungen, die es verwenden.  Aber auch wenn die Spezifikation nicht perfekt ist, können Sie sich darauf verlassen und Ihr eigenes Datenmodell erstellen.  Dies gibt Ihnen mehr Kontrolle über die Korrespondenz Ihrer Datentypen mit den Datentypen der integrierten Subsysteme. </blockquote><p>  Da unsere Anwendung eine Liste von Aufgaben ist, ist das Wesentliche die Aufgabe.  Es ist logisch, es an erster Stelle in die Komponenten zu setzen, weil  andere Entitäten und Endpunkte werden irgendwie damit verbunden sein.  Aber vorher müssen Sie zwei Dinge verstehen: </p><br><ul><li>  Wir beschreiben nicht nur die Abstraktion, sondern auch die Validierungsregeln. Je genauer und eindeutiger sie sind, desto besser. </li><li>  Wie jede Entität, die in einer Datenbank gespeichert ist, verfügt eine Aufgabe über zwei Arten von Eigenschaften: Dienst und vom Benutzer eingegeben. </li></ul><br><p>  Es stellt sich heraus, dass je nach Verwendungsszenario zwei Datenstrukturen vorliegen: die Aufgabe, die der Benutzer gerade erstellt hat, und die Aufgabe, die bereits in der Datenbank gespeichert ist.  Im zweiten Fall hat es eine eindeutige UID, ein Erstellungsdatum, ein Änderungsdatum usw., und diese Daten müssen im Backend zugewiesen werden.  Ich habe zwei Entitäten ( <code>ToDoTaskBlank</code> und <code>ToDoTask</code> ) so beschrieben, dass die erste eine Teilmenge der zweiten ist: </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"components"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ToDoTaskBlank"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Base part of data of item in todo's group"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Data about group item needed for creation of it"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"groupUid"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"An unique id of group that item belongs to"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/Uid"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Short brief of task to be done"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"minLength"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxLength"</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Detailed description and context of the task. Allowed using of Common Markdown."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: [<span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-string"><span class="hljs-string">"null"</span></span>], <span class="hljs-attr"><span class="hljs-attr">"minLength"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">"maxLength"</span></span>: <span class="hljs-number"><span class="hljs-number">1024</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"isDone"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Status of task: is done or not"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"boolean"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Position of a task in group. Allows to track changing of state of a concrete item, including changing od position."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"number"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"min"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"max"</span></span>: <span class="hljs-number"><span class="hljs-number">4096</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"attachments"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"array"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Any material attached to the task: may be screenshots, photos, pdf- or doc- documents on something else"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMeta"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"maxItems"</span></span>: <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: [] } }, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"isDone"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"isDone"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Book soccer field"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"The complainant agreed and recruited more members to play soccer."</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"ToDoTask"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Item in todo's group"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Describe data structure of an item in group of tasks"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"allOf"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ToDoTaskBlank"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"object"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"properties"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"uid"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"An unique id of task"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/Uid"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dateCreated"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Date/time (ISO) when task was created"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format"</span></span>: <span class="hljs-string"><span class="hljs-string">"date-time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-11-17T11:20:51.555Z"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dateChanged"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Date/time (ISO) when task was changed last time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format"</span></span>: <span class="hljs-string"><span class="hljs-string">"date-time"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"readOnly"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"example"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-11-17T11:20:51.555Z"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"dateChanged"</span></span>, <span class="hljs-string"><span class="hljs-string">"dateCreated"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span>, <span class="hljs-string"><span class="hljs-string">"uid"</span></span> ] } ] } }</code> </pre> <br><p>  Am Ausgang erhalten wir zwei TypeScript-Schnittstellen, die <a href="">erste</a> wird von der <a href="">zweiten übernommen</a> : </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * ## Base part of data of item in todo's group * Data about group item needed for creation of it */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskBlank</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... imagine there are ToDoTaskBlank properties } /** * ## Item in todo's group * Describe data structure of an item in group of tasks */ export interface ToDoTask extends ToDoTaskBlank { /** * ## UID of element * An unique id of task */ readonly uid: string; /** * Date/time (ISO) when task was created */ readonly dateCreated: string; /** * Date/time (ISO) when task was changed last time */ readonly dateChanged: string; // ... imagine there are ToDoTaskBlank properties }</span></span></code> </pre> <br><p>  Jetzt haben wir die grundlegenden Beschreibungen der Task-Entität und verweisen auf sie <strong>im Code unserer Anwendung,</strong> wie dies in der <a href="">Demo-Anwendung</a> geschehen ist: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTask, ToDoTaskBlank, } from <span class="hljs-string"><span class="hljs-string">'@our-npm-scope/our-generated-lib'</span></span>; export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskTeaser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-class"> </span></span>{ isInvalid?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Means this task just created, has temporary uid * and not saved yet. */</span></span> isJustCreated?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Means this task is saving now. */</span></span> isPending?: <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Previous uid of task temporary assigned until * it gets saved and gets new UID from backend. */</span></span> prevTempUid?: string; }</code> </pre> <br><p>  In diesem Beispiel haben wir eine neue Entität beschrieben, die <code>ToDoTask</code> die Eigenschaften hinzufügt, die uns auf der Front-End-Anwendungsseite fehlen.  Das heißt, wir haben das resultierende Datenmodell unter Berücksichtigung lokaler Besonderheiten erweitert.  Um dieses Modell herum wachsen nach und nach eine Reihe <a href="">lokaler Tools</a> und so etwas wie ein primitiver DTO: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downgradeTeaserToTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> taskTeaser: ToDoTaskTeaser </span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> task = { ...taskTeaser }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!task.description || !task.description.trim()) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.description; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { task.description = task.description.trim(); } <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.isJustCreated; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.isPending; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.prevTempUid; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downgradeTeaserToTaskBlank</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> taskTeaser: ToDoTaskTeaser </span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToDoTaskBlank</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> task = downgradeTeaserToTask(taskTeaser) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> any; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.dateChanged; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.dateCreated; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> task.uid; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Jemand zieht es vor, das Datenmodell integraler zu gestalten und Klassen zu verwenden.</b> <div class="spoiler_text"><pre> <code class="java hljs">export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTaskTeaser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoTask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// … imagine, definitions from ToDoTask are here constructor( task: ToDoTask, public isInvalid?: boolean, public isJustCreated?: boolean, public isPending?: boolean, public prevTempUid?: string ) { Object.assign(this, task); } downgradeTeaserToTask(): ToDoTask { const task = {...this}; if (!task.description || !task.description.trim()) { delete task.description; } else { task.description = task.description.trim(); } delete task.isJustCreated; delete task.isPending; delete task.prevTempUid; return task; } downgradeTeaserToTaskBlank(): ToDoTaskBlank { // … some code } }</span></span></code> </pre> </div></div><br><p>  Dies ist jedoch eine Frage des Stils, der Angemessenheit und der Entwicklung der Anwendungsarchitektur.  Unabhängig von der Vorgehensweise können wir uns im Allgemeinen auf ein grundlegendes Datenmodell verlassen und mehr Kontrolle über die Konformität der Eingabe haben.  Wenn aus irgendeinem Grund die <code>uid</code> von <code>ToDoTask</code> eine Zahl wird, kennen wir alle Teile des Codes, die aktualisiert werden müssen: </p><br><p><img src="https://habrastorage.org/webt/cc/7g/yz/cc7gyzy0tc4oh5zpomvjy09endw.png"></p><br><a name="NestedDecomposition"></a><br><h2 id="vlozhennaya-dekompoziciya">  Verschachtelte Zerlegung </h2><br><p>  Jetzt haben wir die <code>ToDoTask</code> Oberfläche und können darauf verweisen.  In ähnlicher Weise werden <a href="">ToDoTaskGroup</a> und <a href="">ToDoTaskGroupBlank beschrieben</a> und sie enthalten Eigenschaften der Typen <code>ToDoTask</code> bzw. <code>ToDoTaskBlank</code> .  Aber jetzt werden wir die "Aufgabengruppe" in zwei und nicht in drei Komponenten <a href="">aufteilen</a> : Der Übersichtlichkeit <a href="">halber werden</a> wir das Delta in <a href="">ToDoGroupExtendedData beschreiben</a> .  Daher möchte ich einen Ansatz demonstrieren, bei dem eine Komponente aus den beiden anderen erstellt wird: </p><br><pre> <code class="plaintext hljs">"ToDoGroup": { "allOf": [ { "$ref": "#/components/schemas/ToDoGroupBlank" }, { "$ref": "#/components/schemas/ToDoGroupExtendedData" } ] }</code> </pre> <br><p>  Nach dem Start der Codegenerierung erhalten wir ein etwas anderes TypeScript-Konstrukt: </p><br><pre> <code class="java hljs">export type ToDoGroup = ToDoGroupBlank &amp; <span class="hljs-comment"><span class="hljs-comment">// Data needed for group creation ToDoGroupExtendedData; // Extended data has to be obtained after first save</span></span></code> </pre> <br><p>  Da <code>ToDoGroup</code> keinen eigenen „Körper“ hat, hat der Codegenerator es vorgezogen, ihn in eine Vereinigung von Schnittstellen <code>ToDoGroup</code> .  Wenn Sie jedoch den dritten Teil mit Ihrem eigenen (anonymen) Schema hinzufügen, wird das Ergebnis eine Schnittstelle mit zwei Vorfahren sein (es ist jedoch besser, dies nicht zu tun).  <code>ToDoGroupBlank</code> Sie, dass die <code>items</code> <code>ToDoGroupBlank</code> der <code>ToDoGroupBlank</code> Schnittstelle als Array von <code>ToDoTaskBlank</code> und in <code>ToDoGroupBlank</code> für <code>ToDoTask</code> neu <code>ToDoTask</code> .  Auf diese Weise kann der Codegenerator die recht komplexen Zerlegungsnuancen vom JSON-Schema auf TypeScipt übertragen. </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTaskBlank } from <span class="hljs-string"><span class="hljs-string">'./to-do-task-blank'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * ## Base part of data of group * Data needed for group creation */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoGroupBlank</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... items?: Array&lt;ToDoTaskBlank&gt;; // ... }</span></span></code> </pre> <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ToDoTask } from <span class="hljs-string"><span class="hljs-string">'./to-do-task'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * ## Extended data of group * Extended data has to be obtained after first save */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToDoGroupExtendedData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... items: Array&lt;ToDoTask&gt;; }</span></span></code> </pre><br><p>  Gut und natürlich <code>ToDoTaskBlank</code> wir in <code>ToDoTask</code> / <code>ToDoTaskBlank</code> auch die Zerlegung verwenden.  Möglicherweise haben Sie bemerkt, dass die Eigenschaft <code>attachments</code> als Array von Elementen des Typs <a href="">AttachmentMeta beschrieben wird</a> .  Und diese Komponente wird wie folgt beschrieben: </p><br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">"AttachmentMeta"</span></span>: { <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Common meta data model of any type of attachment"</span></span>, <span class="hljs-string"><span class="hljs-string">"oneOf"</span></span>: [ {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMetaImage"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/AttachmentMetaDocument"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"$ref"</span></span>: <span class="hljs-string"><span class="hljs-string">"#/components/schemas/ExternalResource"</span></span>} ] }</code> </pre> <br><p>  Das heißt, diese Komponente bezieht sich auf andere Komponenten.  Da es kein eigenes Schema hat, wird es vom Codegenerator nicht in einen separaten Datentyp umgewandelt, um Entitäten nicht zu multiplizieren, sondern es wird eine anonyme Beschreibung des Aufzählungstyps erstellt: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Any material attached to the task: may be screenshots, photos, pdf- or doc- * documents on something else */</span></span> attachments?: Array&lt; | AttachmentMetaImage <span class="hljs-comment"><span class="hljs-comment">// Meta data of image attached to task | AttachmentMetaDocument // Meta data of document attached to task | string // Link to any external resource &gt;;</span></span></code> </pre> <br><p>  Gleichzeitig werden für die Komponenten <code>AttachmentMetaImage</code> und <code>AttachmentMetaDocument</code> nicht anonyme Schnittstellen beschrieben, die mit diesen in die Dateien importiert werden: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AttachmentMetaDocument } from <span class="hljs-string"><span class="hljs-string">'./attachment-meta-document'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AttachmentMetaImage } from <span class="hljs-string"><span class="hljs-string">'./attachment-meta-image'</span></span>;</code> </pre> <br><p>  Aber auch in <a href="">AttachmentMetaImage finden</a> wir einen Link zu einer anderen gerenderten <a href="">ImageOptions-</a> Schnittstelle, die zweimal verwendet wird, einschließlich einer anonymen Schnittstelle (das Ergebnis der Konvertierung von <a href="">additionalProperties</a> ): </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* tslint:disable */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ImageOptions } from <span class="hljs-string"><span class="hljs-string">'./image-options'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Meta data of image attached to task */</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AttachmentMetaImage</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... /** * Possible thumbnails of uploaded image */ thumbs?: { [key: string]: { /** * Link to any external resource */ url?: string; imageOptions?: ImageOptions; }; }; // ... imageOptions: ImageOptions; }</span></span></code> </pre> <br><p>  Basierend auf den <code>ToDoTask</code> oder <code>ToDoGroup</code> integrieren wir mehrere Entitäten und eine Kette ihrer Geschäftsverbindungen in unseren Code, wodurch wir mehr Kontrolle über Änderungen im Over-System erhalten, die über unseren Code hinausgehen.  Dies ist natürlich nicht in allen Fällen sinnvoll.  Wenn Sie OpenAPI verwenden, erhalten Sie möglicherweise zusätzlich zur eigentlichen Dokumentation einen weiteren kleinen Bonus. </p><br><a name="ServiceGeneration"></a><br><h2 id="avtogeneraciya-servisov-dlya-raboty-s-rest-api">  Automatisch generierte Services für die Arbeit mit der REST-API </h2><br><a name="WhyItNeccessary"></a><br><h3 id="zachem-eto-nuzhno">  Warum ist das nötig? </h3><br><p>  Wenn wir eine durchschnittliche statistische Front-End-Anwendung verwenden, die mit einer mehr oder weniger komplexen REST-API arbeitet, besteht ein erheblicher Teil ihres Codes aus Diensten (oder nur Funktionen) für den Zugriff auf die API.  Sie umfassen: </p><br><ul><li>  URL- und Parameterzuordnungen </li><li>  Validierung von Parametern, Anforderung und Antwort </li><li>  Datenextraktion und Notfallbehandlung </li></ul><br><p>  Es ist unangenehm, dass dies in vielerlei Hinsicht typisch ist und keine eindeutige Logik enthält.  Nehmen wir ein Beispiel an - als allgemeine Übersicht kann die Arbeit mit der API erstellt werden: </p><br><div class="spoiler">  <b class="spoiler_title">Ein vereinfachtes schematisches Beispiel für die Arbeit mit der REST-API</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Observable, fromFetch, throwError } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { switchMap } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Definitions const URLS = { 'getTasksOfGroup': `${env.REST_API_BASE_URL}/tasks/\${groupId}`, // ... other urls ... }; const URL_TEMPLATES = _.mapValues(urls, url =&gt; _.template(url)); interface GetTaskConditions { isDone?: true | false; offset?: number; limit?: number; } interface ErrorReponse { error: boolean; message?: string; } // Helpers // I taken this snippet from StackOverflow only for example function encodeData(data) { return Object.keys(data).map(function(key) { return [key, data[key]].map(encodeURIComponent).join("="); }).join("&amp;"); } // REST API functions // our REST API working function example function getTasksFromServer(groupUid: string, conditions: GetTaskConditions = {}): Observable&lt;Response&gt; { if (!groupUid) { return throwError(new Error('You should specify "groupUid"!')); } if (!_.isString(groupUid)) { return throwError(new Error('`groupUid` should be string!')); } if (_.isBoolean(conditions.isDone)) { // ... applying of conditions.isDone } else if (conditions.isDone !== undefined) { return throwError(new Error('`isDone` should be "true", "false" or should\'t be set!'!)); } if (offset) { // ... check of `offset` and applying or error throwing } if (limit) { // ... check of `limit` and applying or error throwing } const url = [ URL_TEMPLATES['getTasksOfGroup']({groupUid}), ...(conditions ? [encodeData(conditions)] : []) ]; return fromFetch(url); } // Using of REST API working functions function getRemainedTasks(groupUid: number): Observable&lt;ToDoTask[] | ErrorReponse&gt; { return getTasksFromServer(groupUid, {isDone: false}).pipe( switchMap(response =&gt; { if (response.ok) { // OK return data return response.json(); } else { // Server is returning a status requiring the client to try something else. return of({ error: true, message: `Error ${response.status}` }); } }), catchError(err =&gt; { // Network or other error, handle appropriately console.error(err); return of({ error: true, message: err.message }) }) ); }</span></span></code> </pre> </div></div><br><p>  Sie können eine Abstraktion auf hoher Ebene verwenden, um mit REST zu arbeiten. Je nach verwendetem Stapel kann dies <a href="https://github.com/axios/axios">Folgendes</a> sein: <a href="https://github.com/axios/axios">Axios</a> , <a href="http">Angular HttpClient</a> oder eine andere ähnliche Lösung.  Aber wahrscheinlich stimmt Ihr Code im Grunde mit diesem Beispiel überein.  Es wird mit ziemlicher Sicherheit Folgendes umfassen: </p><br><ul><li>  Dienste oder Funktionen für den Zugriff auf bestimmte Endpunkte (in unserem Beispiel die Funktion <code>getTasksFromServer</code> ) </li><li>  Codeteile, die das Ergebnis verarbeiten (Funktion <code>getRemainedTasks</code> ) </li></ul><br><p>  In einer Anwendung aus der realen Welt wird dieser Code komplizierter: Die Spezifikation der Demo-Anwendung <a href="">beschreibt 5-6 Antwortoptionen</a> .  Häufig ist die REST-API so konzipiert, dass jeder Antwortstatus vom Server entsprechend behandelt werden muss.  Aber selbst das Überprüfen der Eingabedaten wird während der Entwicklung der Anwendung schwieriger: Je länger die Unterstützung und Verarbeitung von Fehlerüberprüfungen dauert, desto mehr möchten Sie über die Engpässe im Datenverkehr in der Anwendung informiert werden. </p><br><blockquote>  An jedem Docking-Knoten von Softwareteilen können Fehler auftreten, deren frühzeitige Erkennung (sowie die Suche nach schwer zu diagnostizierenden Problemen) für Unternehmen sehr kostspielig sein kann.  Daher wird es zusätzliche Klärungsprüfungen geben.  Je größer die Codebasis und die Anzahl der behandelten Fälle ist, desto komplexer ist es, Änderungen vorzunehmen.  Aber das Geschäft ist ein ständiger Wandel und es gibt kein Umgehen.  Daher sollten wir uns im Voraus Gedanken machen, wie wir Änderungen vornehmen werden. </blockquote><p>  Zurück zum OpenAPI-Thema stellen wir fest, dass in den OAS-Spezifikationen möglicherweise genügend Informationen vorhanden sind, um: </p><br><ul><li>  Beschreiben Sie alle erforderlichen Endpunkte in Form von Funktionen oder Diensten </li><li>       </li><li>   URL      </li><li>         </li></ul><br><p>         — <strong></strong> .    ,     ,     /  — 5, 10  200,            .  ,      ,   : , , , RxJS- <a href="">pickResponseBody</a> ,            ,     - ;  <a href="">tapResponse</a> ,    side-effect (tap)   HTTP-.     ,     -   .    ,       ,    . </p><br><blockquote> ,     —   -,      .      ,       ,  ,   ""  /     API     "-"  "" .    -   ,        "" (    ),     . </blockquote><p>   ,          REST API   Angular.         ,      ,        /.      . ,      ,    .  ,      , ..      . </p><br><a name="HowToGenerateServices"></a><br><h3 id="generaciya-servisov">   </h3><br><p>   " <a href="https://habr.com/ru/post/483628/">  </a> "      .   Angular-,       <code>update-typings.js</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">"use strict"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliLib = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@codegena/oapi3ts-cli'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cliApp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> cliLib.CliApplication; cliApp.createTypings(); cliApp.createServices(<span class="hljs-string"><span class="hljs-string">'angular'</span></span>);</code> </pre> <br><p>             ,   Angular-    API   .    , -   - ,     <a href="https://github.com/koshevy/codegena/tree/master/libs/todo-app-scheme/src/lib/services"> </a> .     ,    <a href="">RewriteGroupService</a> .    <a href="">ApiService</a> ,        ,   ,   -: </p><br><div class="spoiler"> <b class="spoiler_title">-  </b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Typings for this API method import { RewriteGroupParameters, RewriteGroupResponse, RewriteGroupRequest } from '../typings'; // Schemas import { schema as domainSchema } from './schema.b4c655ec1635af1be28bd6'; /** * Service for angular based on ApiAgent solution. * Provides assured request to API method with implicit * validation and common errors handling scheme. */ @Injectable() export class RewriteGroupService extends ApiService&lt; RewriteGroupResponse, RewriteGroupRequest, RewriteGroupParameters &gt; { protected get method(): 'PUT' { return 'PUT'; } /** * Path template, example: `/some/path/{id}`. */ protected get pathTemplate(): string { return '/group/{groupId}'; } /** * Parameters in a query. */ protected get queryParams(): string[] { return ['forceSave']; } // ... }</span></span></code> </pre> </div></div><br><p> , <a href="">   JSON Schema</a>  ,   .    <a href=""> </a> ,        ,       : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { schema as domainSchema } from <span class="hljs-string"><span class="hljs-string">'./schema.b4c655ec1635af1be28bd6'</span></span>;</code> </pre> <br><blockquote> ,     <code>schema.b4c655ec1635af1be28bd6.ts</code>       ,  <a href="">  </a>  ,  . </blockquote><br><a name="UsingOfGeneratedServices"></a><br><h3 id="ispolzovanie-generiruemyh-servisov">    </h3><br><p>       ,   Angular-. </p><br><div class="spoiler"> <b class="spoiler_title">    Angular-</b> <div class="spoiler_text"><p>      <code>ApiModule</code>       : </p><br><pre> <code class="plaintext hljs">import { ApiModule, API_ERROR_HANDLER } from '@codegena/ng-api-service'; import { CreateGroupItemService, GetGroupsService, GetGroupItemsService, UpdateFewItemsService } from '@codegena/todo-app-scheme'; @NgModule({ imports: [ ApiModule, // ... ], providers: [ RewriteGroupService, { provide: API_ERROR_HANDLER, useClass: ApiErrorHandlerService }, // ... ], // ... }) export class TodoAppModule { }</code> </pre> </div></div><br><p>    ,     [])( <a href="https://angular.io/guide/dependency-injection">https://angular.io/guide/dependency-injection</a> ): </p><br><pre> <code class="plaintext hljs">@Injectable() export class TodoTasksStore { constructor( protected createGroupItemService: CreateGroupItemService, protected getGroupsService: GetGroupsService, protected getGroupItemsService: GetGroupItemsService, protected updateFewItemsService: UpdateFewItemsService ) {} }</code> </pre> <br><p>         —  ,       <a href="">request</a> ,        : </p><br><pre> <code class="plaintext hljs">return this.getGroupsService.request(null, { isComplete: null, withItems: false }).pipe( pickResponseBody&lt;GetGroupsResponse&lt;200&gt;&gt;(200, null, true), switchMap&lt;ToDoGroup[], Observable&lt;ComponentTruth&gt;&gt;( groups =&gt; this.loadItemsOfSelectedGroups({ ...truth, groups }) ) );</code> </pre> <br><p>  <code>request</code>   <code>Observable&lt;HttpResponse&lt;R&gt; | HttpEvent&lt;R&gt;&gt;</code> ,   ,        . ,     ,      . ,  ,      ,     .     RxJS- <code>pickResponseBody</code> . </p><br><p>  ,    ,    ,   .         API,    .        .   ,     : </p><br><p><img src="https://habrastorage.org/webt/3y/xe/dy/3yxedy51z7su99butzrk2dvunnq.png"></p><br><p>      .   JSON Schema     .       ,   ""      - .   ,      <a href="https://sentry.io/welcome/">Sentry</a>  <a href="https://www.elastic.co/products/kibana">Kibana</a> ,   .       .  ,      ,      . </p><br><blockquote>  ,             .  ,      :) </blockquote><br><a name="AfterWord"></a><br><h2 id="vmesto-poslesloviya">  Anstelle eines Nachwortes </h2><br><p>   ,       .       -,   "    "    —   .  ,  ,   ,   . </p><br><p>     —    ,  - /    (   ).      ,  —   . </p><br><p>   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de483628/">https://habr.com/ru/post/de483628/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de483612/index.html">Tesla-Fahrer wegen Zähneputzens im Autopiloten bestraft</a></li>
<li><a href="../de483614/index.html">Methoden zur Bekämpfung von Diebstahl in einem Robotikclub</a></li>
<li><a href="../de483616/index.html">Lacmus-Projekt: Wie Computer Vision hilft, verlorene Menschen zu retten</a></li>
<li><a href="../de483624/index.html">Wettbewerb von Yandex.Taxi: Analyse des Backend-Tracks der Programmiermeisterschaft</a></li>
<li><a href="../de483626/index.html">Wie man einen 100-Gitlab-Job in 100 Zeilen auf Jsonnet beschreibt</a></li>
<li><a href="../de483630/index.html">The Ember Times - Ausgabe 130</a></li>
<li><a href="../de483634/index.html">Min und Max Breite / Höhe Eigenschaften in CSS</a></li>
<li><a href="../de483646/index.html">Hack The Box - Bitlab-Komplettlösung. Schwache JS-Verschleierung, GIT und umgekehrte Windows-Anwendungen</a></li>
<li><a href="../de483648/index.html">Offshore für IT-Business in Georgia: Life Hacks und Fallstricke</a></li>
<li><a href="../de483650/index.html">Kosmodrome näher am Äquator - Wenchang Tropical Cosmodrome</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>