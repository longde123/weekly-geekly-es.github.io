<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ≤Ô∏è üîí üë®üèª‚Äç‚öïÔ∏è Teil 2: RocketChip: RAM verbinden üí™üèø üåâ ‚èπÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im vorherigen Teil haben wir einen Mikrocontroller ohne RAM auf Basis des Altera / Intel FPGA zusammengestellt. Die Karte verf√ºgt jedoch √ºber einen An...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Teil 2: RocketChip: RAM verbinden</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456172/"><p><img src="https://habrastorage.org/webt/zk/ts/cb/zktscbjwvl5eq08j9sjb3vefdaq.png" align="left">  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Teil haben</a> wir einen Mikrocontroller ohne RAM auf Basis des Altera / Intel FPGA zusammengestellt.  Die Karte verf√ºgt jedoch √ºber einen Anschluss mit installiertem SO-DIMM DDR2 1 GB, den ich nat√ºrlich verwenden m√∂chte.  Dazu m√ºssen wir den DDR2-Controller mit der <code>ALTMEMPHY</code> Schnittstelle in ein Modul <code>ALTMEMPHY</code> , das f√ºr das in RocketChip verwendete TileLink-Speicherprotokoll verst√§ndlich ist.  Unter dem Cut-Tactile-Debugging, Brute-Force-Programmierung und RAKE. </p><br><p>  <em>Wie Sie wissen, hat die Informatik zwei Hauptprobleme: die Ung√ºltigmachung des Caches und die Benennung von Variablen.</em>  <em>Bei KDPV sehen Sie einen seltenen Moment - die beiden Hauptprobleme, denen CS begegnet ist</em> <del>  <em>und planen etwas</em> </del>  <em>.</em> </p><a name="habracut"></a><br><p>  <strong>HAFTUNGSAUSSCHLUSS:</strong> Zus√§tzlich zur Warnung aus dem vorherigen Artikel empfehle ich dringend, den Artikel bis zum Ende zu lesen, bevor Sie die Experimente wiederholen, um Sch√§den am FPGA, dem Speichermodul oder den Stromkreisen zu vermeiden. </p><br><p>  Dieses Mal wollte ich, wenn nicht Linux booten, zumindest den RAM anschlie√üen, der auf meinem Board bereits ein ganzes Gigabyte hat (oder Sie k√∂nnen bis zu vier setzen).  Ein Erfolgskriterium wird vorgeschlagen, um die F√§higkeit zum Lesen und Schreiben durch eine Reihe von GDB + OpenOCD zu ber√ºcksichtigen, einschlie√ülich Adressen, die nicht durch 16 Bytes ausgerichtet sind (die Breite einer Anforderung an den Speicher).  Auf den ersten Blick m√ºssen Sie nur die Konfiguration ein wenig korrigieren, der SoC-Generator kann RAM nicht sofort unterst√ºtzen.  Es unterst√ºtzt es, aber √ºber die MIG-Schnittstelle (naja, und m√∂glicherweise eine andere Schnittstelle von Microsemi).  √úber die Standardschnittstelle unterst√ºtzt AXI4 es ebenfalls, aber meines Wissens ist es nicht so einfach, es zu bekommen (zumindest nicht Platform Designer zu beherrschen). </p><br><p>  <em>Lyrischer Exkurs:</em> Soweit ich wei√ü, gibt es eine recht beliebte Reihe von AXI-Schnittstellen, die von ARM entwickelt wurden.  Hier w√ºrde man denken, dass alles patentiert und geschlossen ist.  Aber nachdem ich mich registriert hatte (ohne ‚ÄûUniversit√§tsprogramme‚Äú und alles andere - nur per E-Mail und Ausf√ºllen des Fragebogens) und Zugang zur Spezifikation erhalten hatte, war ich angenehm √ºberrascht.  Nat√ºrlich bin ich kein Anwalt, aber es scheint, dass der Standard ziemlich offen ist: Sie m√ºssen entweder lizenzierte Kernel von ARM verwenden oder √ºberhaupt keine Kompatibilit√§t mit ARM beanspruchen, <em>und dann scheint alles in Ordnung zu sein</em> .  Aber im Allgemeinen lesen Sie nat√ºrlich die Lizenz, lesen Sie mit Anw√§lten usw. </p><br><h1 id="martyshka-i-tilelink-basnya">  Affe und TileLink (Fabel) </h1><br><p>  Die Aufgabe schien recht einfach zu sein, und ich √∂ffnete die Beschreibung der <code>ddr2_64bit</code> bereits im Projekt vom Lieferanten erh√§ltlich war: </p><br><div class="spoiler">  <b class="spoiler_title">Intel Eigentum und allgemein</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">module ddr2_64bit ( local_address, local_write_req, local_read_req, local_burstbegin, local_wdata, local_be, local_size, global_reset_n, pll_ref_clk, soft_reset_n, local_ready, local_rdata, local_rdata_valid, local_refresh_ack, local_init_done, reset_phy_clk_n, mem_odt, mem_cs_n, mem_cke, mem_addr, mem_ba, mem_ras_n, mem_cas_n, mem_we_n, mem_dm, phy_clk, aux_full_rate_clk, aux_half_rate_clk, reset_request_n, mem_clk, mem_clk_n, mem_dq, mem_dqs); input [25:0] local_address; input local_write_req; input local_read_req; input local_burstbegin; input [127:0] local_wdata; input [15:0] local_be; input [2:0] local_size; input global_reset_n; input pll_ref_clk; input soft_reset_n; output local_ready; output [127:0] local_rdata; output local_rdata_valid; output local_refresh_ack; output local_init_done; output reset_phy_clk_n; output [1:0] mem_odt; output [1:0] mem_cs_n; output [1:0] mem_cke; output [13:0] mem_addr; output [1:0] mem_ba; output mem_ras_n; output mem_cas_n; output mem_we_n; output [7:0] mem_dm; output phy_clk; output aux_full_rate_clk; output aux_half_rate_clk; output reset_request_n; inout [1:0] mem_clk; inout [1:0] mem_clk_n; inout [63:0] mem_dq; inout [7:0] mem_dqs; ...</code> </pre> </div></div><br><p>  Die allgemeine Weisheit sagt: "Jede Dokumentation auf Russisch muss mit den Worten beginnen:" Also, es funktioniert nicht. "  Die <em>Benutzeroberfl√§che</em> hier ist jedoch nicht ganz <em>intuitiv</em> , daher <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">lesen wir sie immer noch</a> .  In der Beschreibung wird uns sofort gesagt, dass die Arbeit mit DDR2 keine leichte Aufgabe ist.  Sie m√ºssen PLL konfigurieren, eine Kalibrierung durchf√ºhren, <em>Crack-Fex-Pex</em> , das Signal <code>local_init_done</code> ist <code>local_init_done</code> , Sie k√∂nnen arbeiten.  Im Allgemeinen lautet die <code>local_</code> hier ungef√§hr wie folgt: Namen mit <code>local_</code> Pr√§fixen sind die "Benutzer" -Schnittstelle, <code>mem_</code> Ports <code>mem_</code> direkt an die mit dem Speichermodul verbundenen Beine ausgegeben werden, <code>pll_ref_clk</code> muss ein Taktsignal mit der beim Einrichten des Moduls angegebenen Frequenz gesendet werden - der Rest wird von ihm empfangen Frequenzen, na ja, alle Arten von Ein- und Ausg√§ngen werden zur√ºckgesetzt und Frequenzausg√§nge, mit denen die Benutzeroberfl√§che synchron arbeiten sollte. </p><br><p>  Erstellen wir eine Beschreibung der externen Signale f√ºr den Speicher und die Schnittstelle des Moduls <code>ddr2_64bit</code> : </p><br><div class="spoiler">  <b class="spoiler_title">Merkmal memif</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MemIf</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_init_done = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> global_reset_n = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pll_ref_clk = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> soft_reset_n = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reset_phy_clk_n = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_odt = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_cs_n = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_cke = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_addr = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">14.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_ba = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_ras_n = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_cas_n = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_we_n = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_dm = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> phy_clk = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> aux_full_rate_clk = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> aux_half_rate_clk = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reset_request_n = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_clk = <span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_clk_n = <span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_dq = <span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">64.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_dqs = <span class="hljs-type"><span class="hljs-type">Analog</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connectFrom</span></span></span></span>(mem_if: <span class="hljs-type"><span class="hljs-type">MemIf</span></span>): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { local_init_done := mem_if.local_init_done mem_if.global_reset_n := global_reset_n mem_if.pll_ref_clk := pll_ref_clk mem_if.soft_reset_n := soft_reset_n reset_phy_clk_n := mem_if.reset_phy_clk_n mem_odt &lt;&gt; mem_if.mem_odt mem_cs_n &lt;&gt; mem_if.mem_cs_n mem_cke &lt;&gt; mem_if.mem_cke mem_addr &lt;&gt; mem_if.mem_addr mem_ba &lt;&gt; mem_if.mem_ba mem_ras_n &lt;&gt; mem_if.mem_ras_n mem_cas_n &lt;&gt; mem_if.mem_cas_n mem_we_n &lt;&gt; mem_if.mem_we_n mem_dm &lt;&gt; mem_if.mem_dm mem_clk &lt;&gt; mem_if.mem_clk mem_clk_n &lt;&gt; mem_if.mem_clk_n mem_dq &lt;&gt; mem_if.mem_dq mem_dqs &lt;&gt; mem_if.mem_dqs phy_clk := mem_if.phy_clk aux_full_rate_clk := mem_if.aux_full_rate_clk aux_half_rate_clk := mem_if.aux_half_rate_clk reset_request_n := mem_if.reset_request_n } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MemIfBundle</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MemIf</span></span></span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Klasse dd2_64bit</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ddr2_64bit</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlackBox</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MemIfBundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_address = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">26.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_write_req = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_read_req = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_burstbegin = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_wdata = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">128.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_be = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_size = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">3.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_ready = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_rdata = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">128.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_rdata_valid = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> local_refresh_ack = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) }</code> </pre> </div></div><br><p>  Hier wartete der erste Haufen Rechen auf mich: <code>ROMGenerator</code> ich mir die <code>ROMGenerator</code> Klasse angesehen hatte, dachte ich zun√§chst, dass der Speichercontroller durch eine globale Variable aus den Tiefen des Designs herausgezogen werden k√∂nnte, und Chisel w√ºrde die Dr√§hte selbst irgendwie weiterleiten.  Hat nicht funktioniert.  Daher musste ich einen <code>MemIfBundle</code> Kabelbaum herstellen, <code>MemIfBundle</code> in der gesamten Hierarchie <code>MemIfBundle</code> .  Warum ragt er nicht aus der <code>BlackBox</code> und stellt keine <code>BlackBox</code> Verbindung her?  Tatsache ist, dass mit <code>BlackBox</code> alle externen Ports in <code>val io = IO(new Bundle { ... })</code> gestopft sind.  Wenn das gesamte <code>MemIfBundle</code> zu einer Variablen im Bundle gemacht wird, wird der Name dieser Variablen als Pr√§fix f√ºr die Namen aller Ports festgelegt, und die Namen stimmen nicht mit der Schnittstelle des Blocks √ºberein.  Wahrscheinlich kann es <em>irgendwie angemessener gemacht werden</em> , aber lassen wir es jetzt so. </p><br><p>  In Analogie zu anderen TileLink-Ger√§ten (haupts√§chlich in <code>rocket-chip/src/main/scala/tilelink</code> ) und insbesondere zu <code>BootROM</code> werden wir au√üerdem unsere Schnittstelle zum Speichercontroller beschreiben: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AltmemphyDDR2RAM</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LazyModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">MemoryPortParams</span></span>(<span class="hljs-type"><span class="hljs-type">MasterPortParams</span></span>(base, size, beatBytes, _, _, executable), <span class="hljs-number"><span class="hljs-number">1</span></span>) = p(<span class="hljs-type"><span class="hljs-type">ExtMem</span></span>).get <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> node = <span class="hljs-type"><span class="hljs-type">TLManagerNode</span></span>(<span class="hljs-type"><span class="hljs-type">Seq</span></span>(<span class="hljs-type"><span class="hljs-type">TLManagerPortParameters</span></span>( <span class="hljs-type"><span class="hljs-type">Seq</span></span>(<span class="hljs-type"><span class="hljs-type">TLManagerParameters</span></span>( address = <span class="hljs-type"><span class="hljs-type">AddressSet</span></span>.misaligned(base, size), resources = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SimpleDevice</span></span>(<span class="hljs-string"><span class="hljs-string">"ram"</span></span>, <span class="hljs-type"><span class="hljs-type">Seq</span></span>(<span class="hljs-string"><span class="hljs-string">"sifive,altmemphy0"</span></span>)).reg(<span class="hljs-string"><span class="hljs-string">"mem"</span></span>), regionType = <span class="hljs-type"><span class="hljs-type">RegionType</span></span>.<span class="hljs-type"><span class="hljs-type">UNCACHED</span></span>, executable = executable, supportsGet = <span class="hljs-type"><span class="hljs-type">TransferSizes</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>), supportsPutFull = <span class="hljs-type"><span class="hljs-type">TransferSizes</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>), fifoId = <span class="hljs-type"><span class="hljs-type">Some</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) )), beatBytes = <span class="hljs-number"><span class="hljs-number">16</span></span> ))) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> module = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">AltmemphyDDR2RAMImp</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AltmemphyDDR2RAMImp</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_outer: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">AltmemphyDDR2RAM</span></span></span></span></span><span class="hljs-class">)(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LazyModuleImp</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_outer</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> (in, edge) = _outer.node.in(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ddr2 = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ddr2_64bit) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_if = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MemIfBundle</span></span>) <span class="hljs-comment"><span class="hljs-comment">// TODO    } trait HasAltmemphyDDR2 { this: BaseSubsystem =&gt; val dtb: DTB val mem_ctrl = LazyModule(new AltmemphyDDR2RAM) mem_ctrl.node := mbus.toDRAMController(Some("altmemphy-ddr2"))() } trait HasAltmemphyDDR2Imp extends LazyModuleImp { val outer: HasAltmemphyDDR2 val mem_if = IO(new MemIfBundle) mem_if &lt;&gt; outer.mem_ctrl.module.mem_if }</span></span></code> </pre> <br><p>  <code>ExtMem</code> Standard- <code>ExtMem</code> Schl√ºssel extrahieren wir die externen Speicherparameter aus der SoC- <code>ExtMem</code> ( <em>diese seltsame Syntax</em> erm√∂glicht es mir zu sagen: ‚ÄûIch wei√ü, dass sie eine Instanz der <code>MemoryPortParameters</code> (dies wird durch den Schl√ºsseltyp in der Phase des Kompilierens des Scala-Codes durch die Bedingung garantiert dass wir nicht in die Laufzeit fallen, indem wir Inhalte aus <code>Option[MemoryPortParams]</code> gleich <code>None</code> , aber dann gab es nichts, um einen Speichercontroller in <code>System.scala</code> zu erstellen ...), daher brauche ich die case-Klasse nicht und einige ihrer Felder werden ben√∂tigt ").  Als N√§chstes erstellen wir den Manager-Port des TileLink-Ger√§ts (das TileLink-Protokoll stellt die Interaktion von fast allem sicher, was mit dem Speicher zu tun hat: dem DDR-Controller und anderen speicherabgebildeten Ger√§ten, Prozessor-Caches, m√∂glicherweise etwas anderem. Jedes Ger√§t kann mehrere Ports haben Das Ger√§t kann sowohl Manager als auch Client sein.  <code>beatBytes</code> ich es verstehe, legt <code>beatBytes</code> die Gr√∂√üe einer Transaktion fest, und wir haben 16 Bytes, die mit dem Controller ausgetauscht werden.  <code>HasAltmemphyDDR2</code> und <code>HasAltmemphyDDR2Imp</code> wir an den richtigen Stellen in <code>System.scala</code> , schreiben die Konfiguration </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BigZeowaaConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> (</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> new </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">WithNBreakpoints</span></span></span></span><span class="hljs-class"><span class="hljs-params">(2</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">++</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithNExtTopInterrupts</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">0</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">++</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithExtMemSize</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">1l &lt;&lt; 30</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">++</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithNMemoryChannels</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">1</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">++</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithCacheBlockBytes</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">16</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">++</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithNBigCores</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">1</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">++</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithJtagDTM</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">++</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseConfig</span></span></span><span class="hljs-class"> )</span></span></code> </pre> <br><p>  Nachdem ich in <code>AltmemphyDDR2RAMImp</code> eine ‚ÄûSkizze einer Eule‚Äú <code>AltmemphyDDR2RAMImp</code> , synthetisierte ich das Design (etwas nur bei ~ 30 MHz, es ist gut, dass ich von 25 MHz takte) und lud es mit den Fingern auf die Speichermodule und den FPGA-Chip auf die Platine.  Dann habe ich gesehen, was eine <em>wirklich</em> intuitive Benutzeroberfl√§che ist: Dies ist, wenn Sie in gdb einen Befehl zum Schreiben in den Speicher und von einem eingefrorenen Prozessor und geben <del>  verbrannt </del>  Wenn die Finger eine starke Hitze sp√ºren, m√ºssen Sie dringend die Reset-Taste auf der Platine dr√ºcken und den Controller reparieren. </p><br><h1 id="chitaem-dokumentaciyu-na-kontroller-ddr2">  Lesen Sie die Dokumentation zum DDR2-Controller </h1><br><p>  Anscheinend ist es Zeit, die Dokumentation auf dem Controller √ºber die Liste der Ports hinaus zu lesen.  Also, was haben wir hier? .. Ups, es stellt sich heraus, dass die E / A mit dem Pr√§fix <code>local_</code> nicht synchron gesetzt werden sollten, nicht mit <code>pll_ref_clk</code> , das 25 MHz ist, sondern entweder mit <code>phy_clk</code> , <code>phy_clk</code> H√§lfte der Speicherfrequenz f√ºr den Controller mit halber Rate <code>phy_clk</code> , oder in unserem Fall <code>aux_half_rate_clk</code> (vielleicht doch <code>aux_full_rate_clk</code> ?), das die volle Speicherfrequenz ausgibt und f√ºr eine Minute 166 MHz betr√§gt. </p><br><p>  Daher ist es notwendig, die Grenzen von Frequenzbereichen zu √ºberschreiten.  Nach <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">alter Erinnerung habe</a> ich mich entschieden, Riegel oder vielmehr eine Kette davon zu verwenden: </p><br><pre> <code class="plaintext hljs"> +-+ +-+ +-+ +-+ --| |--| |--| |--| |---&gt; +-+ +-+ +-+ +-+ | | | | ---+ | | | inclk | | | | | | --------+----+ | outclk | | ------------------+ output enable</code> </pre> <br><p>  Nachdem ich an der Stunde herumgebastelt hatte, kam ich zu dem Schluss, dass ich nicht zwei Warteschlangen auf den "skalaren" Latches (im Hochfrequenzbereich und umgekehrt) verarbeiten konnte, von denen jedes antidirektionale Signale ( <code>ready</code> und <code>valid</code> ) hat, und trotzdem, um sicherzugehen, dass Einige Beatik werden nicht hinter ein oder zwei Schl√§gen auf der Stra√üe zur√ºckbleiben.  Nach einiger Zeit wurde mir klar, dass das Beschreiben der Synchronisation im <code>ready</code> - <code>valid</code> ohne ein gemeinsames Taktsignal - auch eine Aufgabe ist, die dem Erstellen nicht blockierender Datenstrukturen in dem Sinne √§hnelt, dass Sie viel nachdenken <strong>und formal beweisen</strong> m√ºssen. Es ist leicht, einen Fehler zu machen, es ist schwer zu bemerken und vor allem ist alles bereits vor uns implementiert: Intel hat ein <code>dcfifo</code> , eine Warteschlange mit konfigurierbarer L√§nge und Breite, die aus verschiedenen Frequenzbereichen gelesen und geschrieben wird.  Infolgedessen nutzte ich die experimentelle Gelegenheit von frischem Mei√üel, n√§mlich die parametrisierten Black Boxes: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FIFO</span></span></span><span class="hljs-class"> (</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">val width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, lglength: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlackBox</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Map</span></span></span></span><span class="hljs-class"><span class="hljs-params">( "intended_device_family" -&gt; </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">StringParam</span></span></span></span><span class="hljs-class"><span class="hljs-params">("</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Cyclone</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">IV</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">E</span></span></span></span><span class="hljs-class"><span class="hljs-params">"</span></span></span><span class="hljs-class">), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lpm_showahead</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">-&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringParam</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">"</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">OFF</span></span></span></span><span class="hljs-class"><span class="hljs-params">"</span></span></span><span class="hljs-class">), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lpm_type</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">-&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringParam</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">"dcfifo"</span></span></span><span class="hljs-class">), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lpm_widthu</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">-&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntParam</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">lglength</span></span></span><span class="hljs-class">), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">overflow_checking</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">-&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringParam</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">"</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ON</span></span></span></span><span class="hljs-class"><span class="hljs-params">"</span></span></span><span class="hljs-class">), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rdsync_delaypipe</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">-&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntParam</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">5</span></span></span><span class="hljs-class">), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">underflow_checking</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">-&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringParam</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">"</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ON</span></span></span></span><span class="hljs-class"><span class="hljs-params">"</span></span></span><span class="hljs-class">), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">use_eab</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">-&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringParam</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">"</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ON</span></span></span></span><span class="hljs-class"><span class="hljs-params">"</span></span></span><span class="hljs-class">), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrsync_delaypipe</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">-&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntParam</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">5</span></span></span><span class="hljs-class">), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lpm_width</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">-&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntParam</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width</span></span></span><span class="hljs-class">), "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lpm_numwords</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">-&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntParam</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">1 &lt;&lt; lglength</span></span></span><span class="hljs-class">) )) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> data = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rdclk = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rdreq = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wrclk = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Clock</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wrreq = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> q = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rdempty = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wrfull = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">desiredName</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"dcfifo"</span></span> }</code> </pre> <br><p>  Und er schrieb ein einfaches kleines Fernglas mit beliebigen Datentypen: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FIFO</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">T</span></span> &lt;: <span class="hljs-type"><span class="hljs-type">Data</span></span>]( lglength: <span class="hljs-type"><span class="hljs-type">Int</span></span>, output: <span class="hljs-type"><span class="hljs-type">T</span></span>, outclk: <span class="hljs-type"><span class="hljs-type">Clock</span></span>, input: <span class="hljs-type"><span class="hljs-type">T</span></span>, inclk: <span class="hljs-type"><span class="hljs-type">Clock</span></span> ): <span class="hljs-type"><span class="hljs-type">FIFO</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> res = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">FIFO</span></span>(width = output.widthOption.get, lglength = lglength)) require(input.getWidth == res.width) output := res.io.q.asTypeOf(output) res.io.rdclk := outclk res.io.data := input.asUInt() res.io.wrclk := inclk res } }</code> </pre> <br><h1 id="otladka">  Debuggen </h1><br><p>  Danach verwandelte sich der Code in die √úbertragung von Nachrichten zwischen Dom√§nen √ºber zwei bereits unidirektionale Warteschlangen: <code>tl_req</code> / <code>ddr_req</code> und <code>ddr_resp</code> / <code>tl_resp</code> (die mit dem Pr√§fix <code>tl_</code> wird zusammen mit TileLink getaktet, die Tatsache, dass <code>ddr_</code> mit dem Speichercontroller verbunden ist).  Das Problem ist, dass sowieso alles festgefahren war und es manchmal ziemlich warm war.  Und wenn die Ursache f√ºr √úberhitzung die gleichzeitige Einstellung von <code>local_read_req</code> und <code>local_write_req</code> , war es nicht so einfach, mit Deadlocks umzugehen.  Der Code zur gleichen Zeit war so etwas wie </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AltmemphyDDR2RAMImp</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_outer: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">AltmemphyDDR2RAM</span></span></span></span></span><span class="hljs-class">)(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LazyModuleImp</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_outer</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> addrSize = log2Ceil(_outer.size / <span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> (in, edge) = _outer.node.in(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ddr2 = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ddr2_64bit) require(ddr2.io.local_address.getWidth == addrSize) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tl_clock = clock <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ddr_clock = ddr2.io.aux_full_rate_clk <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem_if = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MemIfBundle</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DdrRequest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size = <span class="hljs-type"><span class="hljs-type">UInt</span></span>(in.a.bits.size.widthOption.get.<span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> source = <span class="hljs-type"><span class="hljs-type">UInt</span></span>(in.a.bits.source.widthOption.get.<span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> address = <span class="hljs-type"><span class="hljs-type">UInt</span></span>(addrSize.<span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> be = <span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> wdata = <span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">128.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> is_reading = <span class="hljs-type"><span class="hljs-type">Bool</span></span>() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tl_req = <span class="hljs-type"><span class="hljs-type">Wire</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">DdrRequest</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ddr_req = <span class="hljs-type"><span class="hljs-type">Wire</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">DdrRequest</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fifo_req = <span class="hljs-type"><span class="hljs-type">FIFO</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, ddr_req, ddr_clock, tl_req, clock) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DdrResponce</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> is_reading = <span class="hljs-type"><span class="hljs-type">Bool</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size = <span class="hljs-type"><span class="hljs-type">UInt</span></span>(in.d.bits.size.widthOption.get.<span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> source = <span class="hljs-type"><span class="hljs-type">UInt</span></span>(in.d.bits.source.widthOption.get.<span class="hljs-type"><span class="hljs-type">W</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rdata = <span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">128.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tl_resp = <span class="hljs-type"><span class="hljs-type">Wire</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">DdrResponce</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ddr_resp = <span class="hljs-type"><span class="hljs-type">Wire</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">DdrResponce</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fifo_resp = <span class="hljs-type"><span class="hljs-type">FIFO</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, tl_resp, clock, ddr_resp, ddr_clock) <span class="hljs-comment"><span class="hljs-comment">//    TileLink withClock(ddr_clock) { //     }</span></span></code> </pre> <br><p>  Um das Problem zu lokalisieren, habe ich beschlossen, den gesamten Code in <code>withClock(ddr_clock)</code> (nicht <code>withClock(ddr_clock)</code> , visuell sieht es so aus, als w√ºrde ein Stream erstellt) und ihn durch einen Stub zu ersetzen, der mit Sicherheit funktioniert: </p><br><pre> <code class="scala hljs"> withClock (ddr_clock) { ddr_resp.rdata := <span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span> ddr_resp.is_reading := ddr_req.is_reading ddr_resp.size := ddr_req.size ddr_resp.source := ddr_req.source <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> will_read = <span class="hljs-type"><span class="hljs-type">Wire</span></span>(!fifo_req.io.rdempty &amp;&amp; !fifo_resp.io.wrfull) fifo_req.io.rdreq := will_read fifo_resp.io.wrreq := <span class="hljs-type"><span class="hljs-type">RegNext</span></span>(will_read) }</code> </pre> <br><p>  Wie ich sp√§ter bemerkte, funktionierte dieser Stub auch nicht, weil das <code>Wire(...)</code> -Konstrukt, das ich "aus Gr√ºnden der Zuverl√§ssigkeit" hinzugef√ºgt habe, um zu zeigen, dass es sich um einen benannten Draht handelt, das Argument tats√§chlich nur als Prototyp zum Erstellen verwendete Art der Bedeutung, <strong>aber nicht an das Ausdrucksargument gebunden</strong> .  Als ich versuchte zu lesen, was noch generiert wurde, stellte ich fest, dass es im Simulationsmodus eine gro√üe Auswahl an Aussagen bez√ºglich der Nichteinhaltung des TileLink-Protokolls gibt.  Sie werden mir wahrscheinlich sp√§ter n√ºtzlich sein, aber bisher wurde nicht versucht, die Simulation auszuf√ºhren - warum sollte ich sie starten?  Verilator wei√ü wahrscheinlich nichts √ºber die IP-Cores von Alter. ModelSim Starter Edition wird sich h√∂chstwahrscheinlich weigern, ein so gro√ües Projekt zu simulieren, aber ich habe auch geschworen, dass es kein Controller-Modell f√ºr die Simulation gibt.  Und um es zu generieren, m√ºssen Sie wahrscheinlich zuerst zur neuen Version des Controllers wechseln (da die alte im alten Quartus konfiguriert wurde). </p><br><p>  <em>Tats√§chlich wurden die Codebl√∂cke einer fast funktionierenden Version entnommen und nicht derjenigen, die einige Stunden zuvor aktiv getestet wurde.</em>  <em>Aber Sie besser;)</em> √úbrigens k√∂nnen Sie das Design st√§ndig schneller wieder zusammenbauen, wenn die Einstellung <code>WithNBigCores(1)</code> durch <code>WithNSmallCores(1)</code> - aus Sicht der Grundfunktionalit√§t des Speichercontrollers scheint es keinen Unterschied zu geben.  Und ein kleiner Trick: Um nicht jedes Mal dieselben Befehle in gdb zu √ºbertragen (zumindest habe ich <strong>zwischen den</strong> Sitzungen dort keinen Befehlsverlauf), k√∂nnen Sie einfach so etwas in die Befehlszeile eingeben </p><br><pre> <code class="plaintext hljs">../../rocket-tools/bin/riscv32-unknown-elf-gdb -q -ex "target remote :3333" -ex "x/x 0x80000000" ../../rocket-tools/bin/riscv32-unknown-elf-gdb -q -ex "target remote :3333" -ex "set variable *0x80000000=0x1234"</code> </pre> <br><p>  und nach Bedarf mit normalen Mitteln der Shell ausf√ºhren. </p><br><h1 id="itog">  Zusammenfassung </h1><br><p>  Als Ergebnis wurde der folgende Code f√ºr die Arbeit mit der Steuerung erhalten: </p><br><pre> <code class="scala hljs"> withClock(ddr_clock) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rreq = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   (  ) val wreq = RegInit(false.B) //   (  ) val rreq_pending = RegInit(false.B) //   ( ) ddr2.io.local_read_req := rreq ddr2.io.local_write_req := wreq // -   :) ddr2.io.local_size := 1.U ddr2.io.local_burstbegin := true.B //    (    q FIFO) ddr2.io.local_address := ddr_req.address ddr2.io.local_be := ddr_req.be ddr2.io.local_wdata := ddr_req.wdata //  ,    ddr_resp.is_reading := ddr_req.is_reading ddr_resp.size := ddr_req.size ddr_resp.source := ddr_req.source //   ,   ** ** val will_read_request = !fifo_req.io.rdempty &amp;&amp; !rreq &amp;&amp; !wreq &amp;&amp; !rreq_pending &amp;&amp; ddr2.io.local_ready // ,     val will_respond = !fifo_resp.io.wrfull &amp;&amp; ( (rreq_pending &amp;&amp; ddr2.io.local_rdata_valid) || (wreq &amp;&amp; ddr2.io.local_ready)) val request_is_read = RegNext(will_read_request) fifo_req.io.rdreq := will_read_request fifo_resp.io.wrreq := will_respond //  ,     when (request_is_read) { rreq := ddr_req.is_reading rreq_pending := ddr_req.is_reading wreq := !ddr_req.is_reading } when (will_respond) { rreq := false.B wreq := false.B ddr_resp.rdata := ddr2.io.local_rdata } //    ,    when (rreq &amp;&amp; ddr2.io.local_ready) { rreq := false.B } }</span></span></code> </pre> <br><p>  Hier werden wir das Abschlusskriterium noch leicht √§ndern: Ich habe bereits gesehen, dass die aufgezeichneten Daten ohne Arbeit mit dem Speicher <em>wie</em> gelesen sind, weil es sich um einen Cache handelt.  Deshalb kompilieren wir einen einfachen Code: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdint.h&gt; static volatile uint8_t *x = (uint8_t *)0x80000000u; void entry() { for (int i = 0; i &lt; 1&lt;&lt;24; ++i) { x[i] = i; } }</span></span></span></span></code> </pre> <br><pre> <code class="plaintext hljs">../../rocket-tools/bin/riscv64-unknown-elf-gcc test.c -S -O1</code> </pre> <br><p>  Als Ergebnis erhalten wir das folgende Fragment der Assembler-Liste, das die ersten 16 MB Speicher initialisiert: </p><br><pre> <code class="plaintext hljs"> li a5,1 slli a5,a5,31 li a3,129 slli a3,a3,24 .L2: andi a4,a5,0xff sb a4,0(a5) addi a5,a5,1 bne a5,a3,.L2</code> </pre> <br><p>  <code>bootrom/xip/leds.S</code> am Anfang von <code>bootrom/xip/leds.S</code>  Jetzt ist es unwahrscheinlich, dass alles nur in einem Cache gespeichert werden kann.  Es bleibt, das Makefile auszuf√ºhren, das Projekt in Quartus neu zu erstellen, es in das Board zu f√ºllen, OpenOCD + GDB zu verbinden und ... Vermutlich Prost, Sieg: </p><br><pre> <code class="plaintext hljs">$ ../../rocket-tools/bin/riscv32-unknown-elf-gdb -q -ex "target remote :3333" Remote debugging using :3333 warning: No executable has been specified and target does not support determining executable automatically. Try using the "file" command. 0x0000000000010014 in ?? () (gdb) x/x 0x80000000 0x80000000: 0x03020100 (gdb) x/x 0x80000100 0x80000100: 0x03020100 (gdb) x/x 0x80000111 0x80000111: 0x14131211 (gdb) x/x 0x80010110 0x80010110: 0x13121110 (gdb) x/x 0x80010120 0x80010120: 0x23222120</code> </pre> <br><p>  Ist es so, werden wir in der n√§chsten Serie herausfinden (ich kann auch nicht √ºber Leistung, Stabilit√§t usw. sagen). </p><br><p>  Code: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AltmemphyDDR2RAM.scala</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de456172/">https://habr.com/ru/post/de456172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de456160/index.html">Verst√§rkungslernen oder Evolutionsstrategien? - Beide</a></li>
<li><a href="../de456162/index.html">Aurora, ein Unternehmen, das von Einwanderern aus Google, Tesla und Uber gegr√ºndet wurde, begann mit der Arbeit mit Autokonzernen</a></li>
<li><a href="../de456164/index.html">Loon-Ballons bieten nach einem Erdbeben der St√§rke 8,0 eine Notfallverbindung zum Netzwerk und zum Internet in Peru</a></li>
<li><a href="../de456168/index.html">Wo war dein Haus vor Millionen von Jahren?</a></li>
<li><a href="../de456170/index.html">So erstellen Sie eine Finanzanwendung: 5 APIs, die dem Entwickler helfen</a></li>
<li><a href="../de456174/index.html">Wie man als Student einen Hackathon organisiert 101. Teil Zwei</a></li>
<li><a href="../de456178/index.html">Android-Themen und -Stile ohne Magie. Und wie man sie mit SwitchCompat kocht</a></li>
<li><a href="../de456180/index.html">Wie habe ich meine erste Sicherheitsl√ºcke gefunden?</a></li>
<li><a href="../de456182/index.html">Audio √ºber Bluetooth: Detaillierteste Informationen zu Profilen, Codecs und Ger√§ten</a></li>
<li><a href="../de456184/index.html">Software Defined Radio - wie funktioniert es? Teil 8</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>