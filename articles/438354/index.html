<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüîß üîÅ ü§õüèª Vue, Storybook, TypeScript: comenzar un nuevo proyecto con las mejores pr√°cticas en mente üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® ü§û üìì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(publicado originalmente en Medium ) 


 Me gusta escribir c√≥digo React. Esta podr√≠a ser una extra√±a introducci√≥n a una historia sobre Vue, pero debes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vue, Storybook, TypeScript: comenzar un nuevo proyecto con las mejores pr√°cticas en mente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438354/"><p><img src="https://habrastorage.org/webt/3l/z_/hj/3lz_hjzvuh91eqfwdlcux6yluyy.png"></p><br><p>  <em>(publicado originalmente en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Medium</a> )</em> </p><br><p>  Me gusta escribir c√≥digo React.  Esta podr√≠a ser una extra√±a introducci√≥n a una historia sobre Vue, pero debes entender mis antecedentes para entender por qu√© estoy aqu√≠ discutiendo sobre Vue. </p><br><p>  Me gusta escribir c√≥digo React y odio leerlo.  JSX es una buena idea para ensamblar las piezas r√°pidamente, Material-UI es una soluci√≥n incre√≠ble para arrancar la interfaz de usuario de su pr√≥xima startup, computar CSS desde constantes JS le permite ser muy flexible.  Sin embargo, leer sus viejos JSX se siente horrible, incluso con escrupulosas pr√°cticas de revisi√≥n de c√≥digo, puede rascarse la cabeza no una sola vez mientras intenta imaginar la intrincada anidaci√≥n de los componentes. </p><br><p>  He escuchado muchas cosas sobre Vue, el ni√±o no tan nuevo en la cuadra, y finalmente decid√≠ mojarme los pies;  trayendo todo mi equipaje mental de React and Polymer (y Angular, pero no hablemos de eso). </p><a name="habracut"></a><br><p> Vue se parece mucho a Polymer, m√°s a√∫n, los autores lo nombran como una de las fuentes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">inspiraci√≥n</a> .  La estructura de los archivos <code>*.vue</code> parec√≠a la mejor parte de Polymer y me sumerg√≠ directamente.  Unos d√≠as m√°s tarde sal√≠ del pantano del mecanografiado, el desarrollo impulsado por la interfaz de usuario y numerosas pr√°cticas recomendadas y estoy listo para compartir lo que encontr√©. </p><br><h2 id="lets-go">  Vamos! </h2><br><p>  Usaremos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">npx</a> para ejecutar los comandos.  Si a√∫n no tiene npx, aqu√≠ le mostramos c√≥mo obtenerlo: <code>npm install -g npx</code> .  Npx es un salvavidas cuando manejas paquetes npm cli y no quieres <code>npm install -g</code> docenas de aplicaciones.  Tambi√©n necesitar√° Yarn si no lo tiene: <code>npm install -g yarn</code> deber√≠a ponerlo al d√≠a. </p><br><pre> <code class="plaintext hljs">$ npx vue create not-a-todo-app Vue CLI v3.3.0 ? Please pick a preset: Manually select features ? Check the features needed for your project: Babel, TS, PWA, Router, Vuex, CSS Pre-processors, Linter, Unit, E2E ? Use class-style component syntax? Yes ? Use Babel alongside TypeScript for auto-detected polyfills? Yes ? Use history mode for router? (Requires proper server setup for index fallback in production) Yes ? Pick a CSS pre-processor (PostCSS, Autoprefixer and CSS Modules are supported by default): Sass/SCSS ? Pick a linter / formatter config: TSLint ? Pick additional lint features: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)Lint on save ? Pick a unit testing solution: Jest ? Pick a E2E testing solution: Cypress ? Where do you prefer placing config for Babel, PostCSS, ESLint, etc.? In dedicated config files ? Save this as a preset for future projects? No</code> </pre> <br><p>  Vue Cli tiene un buen mago para guiarte;  para este tutorial usaremos el modo manual y habilitaremos <strong>todas las funciones</strong> .  ¬øExceso?  Tal vez, pero queremos ver c√≥mo funciona Vue con todo lo que puede proporcionar de inmediato.  A√∫n as√≠, veamos las opciones y la raz√≥n sobre c√≥mo y por qu√©. </p><br><p>  Necesitamos tanto <strong>Babel</strong> como <strong>TypeScript</strong> habilitado.  TS ser√° el idioma principal de elecci√≥n y Babel admitir√° el manejo de c√≥digo externo que requiere transpilaci√≥n.  Podr√≠a argumentar que TypeScript tambi√©n puede transpilar el c√≥digo JS y, de hecho, ese es el caso, pero en mis experimentos (especialmente relacionados con las pruebas unitarias y Vuetify) pens√© que era mucho mejor mantener TS para <code>*.ts</code> y usar Babel para todo lo dem√°s. </p><br><p>  <strong>Los</strong> preprocesadores de <strong>CSS</strong> ser√°n √∫tiles para Vuetify;  Si bien viene con CSS preminificado, es posible que desee incluir los archivos de estilo originales para trabajar con estilos.  <strong>Linter / Formatter</strong> es un requisito obvio para cualquier proyecto nuevo (debe cumplir con un estilo de c√≥digo √∫nico y puede agradecerme en un a√±o cuando leer√° su c√≥digo anterior).  Permitimos las pruebas <strong>unitarias</strong> y las <strong>pruebas</strong> <strong>E2E,</strong> aunque es posible que no desee realizar los casos de prueba e2e completos, es √∫til saber c√≥mo solucionarlos despu√©s de que hayamos terminado con Vuetify. </p><br><p>  <strong>El soporte de la aplicaci√≥n web progresiva (PWA)</strong> , el <strong>enrutador</strong> y <strong>Vuex</strong> no son estrictamente necesarios para este tutorial y no los utilizaremos, pero habilitarlos simplificar√° su vida en un proyecto real. </p><br><p>  <strong>Usar sintaxis de componentes de estilo de clase?</strong>  Si  Las clases hacen que el c√≥digo sea un poco m√°s voluminoso pero m√°s legible y m√°s f√°cil de razonar;  Tambi√©n hacen su vida de TypeScript m√°s f√°cil. </p><br><p>  <strong>¬øUsar Babel junto con TypeScript para polyfills autodetectados?</strong>  Si  Queremos tanto a Babel como a TS para el caso que analizaremos m√°s adelante. </p><br><p>  <strong>¬øUsar el modo de historial para el enrutador?</strong>  S√≠ (pero YMMV).  No escribiremos ning√∫n back-end para servir esto en producci√≥n, pero generalmente es una buena idea usar API de historial. </p><br><p>  <strong>Elija un preprocesador CSS (los m√≥dulos PostCSS, Autoprefixer y CSS son compatibles de forma predeterminada):</strong> solo utilizaremos m√≥dulos CSS en este tutorial, por lo que puede elegir sass / less / stylus seg√∫n sus preferencias. </p><br><p>  <strong>Elija una configuraci√≥n de linter / formateador:</strong> TSlint es una opci√≥n obvia ya que queremos usar TypeScript tanto como sea posible. </p><br><p>  <strong>Elija caracter√≠sticas adicionales de pelusa:</strong> habilite ambas ( <code>a</code> ).  Linting es bueno. </p><br><p>  <strong>Elija una soluci√≥n de prueba de unidad:</strong> este tutorial se centra en Jest, por lo que debe seleccionarlo. </p><br><p>  <strong>Elija una soluci√≥n de prueba E2E:</strong> este tutorial se centra en Cypress. </p><br><p>  <strong>¬øD√≥nde prefiere colocar la configuraci√≥n para Babel, PostCSS, ESLint, etc.?</strong>  ¬øNo crees que es un poco extra√±o que todos intenten meter a√∫n m√°s cosas en <code>package.json</code> ?  El archivo apenas se puede leer como est√° ahora.  Use archivos de configuraci√≥n dedicados: es mucho m√°s f√°cil trabajar con ellos y su historial de git ser√° m√°s bonito. </p><br><p>  Es hora de verificar la configuraci√≥n, ejecutar <code>yarn serve</code> : <br><img src="https://habrastorage.org/webt/5p/ak/ty/5paktyugcycg2dzdtjt1ss1vfoi.png"></p><br><p>  No debe haber errores en la consola y navegar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http: // localhost: 8080 / lo</a> recibir√° con: <br><img src="https://habrastorage.org/webt/z4/hj/hv/z4hjhvcto1oaxdxokxi5rmuzque.png"></p><br><p>  Las pruebas unitarias de verificaci√≥n funcionan, ejecutan la <code>yarn test:unit</code> : <br><img src="https://habrastorage.org/webt/gd/v1/i1/gdv1i1hpoxsejeovp1bvbc4jnbg.png"></p><br><p>  Y trabajo de prueba e2e ( <code>yarn test:e2e --headless</code> ): <br><img src="https://habrastorage.org/webt/_p/td/ho/_ptdhoshlgew083bq7hfaapmvnu.png"></p><br><p>  Genial  Pasando a la interfaz de usuario. </p><br><h2 id="the-material-dilemma">  El dilema material. </h2><br><p>  Hay algunas bibliotecas de UI de material para Vue en un nivel diferente de flexibilidad y pulido.  Seguramente hay docenas de otras bibliotecas de componentes, por lo que puede usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bootstrap Vue</a> si lo desea.  Este tutorial se enfoca en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vuetify</a> por varias razones: </p><br><ul><li>  es la biblioteca de material m√°s destacada en GitHub; </li><li>  fue un verdadero dolor hacer que funcione, por lo que es una gran demostraci√≥n de todos los casos extremos en los que puede tropezar. </li></ul><br><p>  Convencido?  Contin√∫e con la instalaci√≥n y luego: <code>vue add vuetify</code> .  Seleccione la opci√≥n <strong>Configurar (avanzado)</strong> . </p><br><p>  <strong>¬øUsar una plantilla prefabricada?</strong>  Vuetify anular√° App.vue y HelloWorld.vue predeterminados.  Responda s√≠ a esto, ya que es un proyecto nuevo. </p><br><p>  <strong>¬øUsar tema personalizado?</strong>  Si  Necesitar√° uno tarde o temprano de todos modos, as√≠ que configur√©moslo.  Por las mismas razones, ¬øresponde s√≠ a <strong>Usar propiedades personalizadas (variables CSS)?</strong>  . </p><br><p>  <strong>Seleccione la fuente del icono:</strong> Iconos de material (pero m√°s adelante tambi√©n le mostrar√© c√≥mo solucionarlo para Font Awesome).  <strong>¬øUsar fuentes como dependencia?</strong>  No  Obtendremos las fuentes de CDN. </p><br><p>  <strong>¬øUtiliza componentes a la carta?</strong>  Si  Esta parece ser la forma m√°s f√°cil de usar Vuetify. <br><img src="https://habrastorage.org/webt/w1/aa/v9/w1aav901fzrpaeqnnvluidjoufu.png"></p><br><p>  Hay muchos cambios, pero lo m√°s importante es que cuando ejecutas el <code>yarn serve</code> ahora ver√°s una imagen diferente: <br><img src="https://habrastorage.org/webt/3l/z_/hj/3lz_hjzvuh91eqfwdlcux6yluyy.png"></p><br><p>  (tambi√©n recibir√° un par de docenas de advertencias de su linter). </p><br><p>  Vamos a ver las pruebas unitarias ... <br><img src="https://habrastorage.org/webt/ov/ks/29/ovks2927ibmuxyxblnxamj_jyb8.png"></p><br><h2 id="making-vuetify-work-with-unit-and-e2e-tests">  Hacer que Vuetify funcione con pruebas unitarias y e2e </h2><br><p>  Verifiquemos <code>./tests/unit/example.spec.ts</code> .  La prueba verifica que <code>msg</code> muestra " <em>mensaje nuevo</em> ", pero la plantilla que viene con Vuetify ya no es compatible con este accesorio.  En una situaci√≥n del mundo real, eliminar√≠a tanto el componente HelloWorld como su prueba, pero aqu√≠ actualizamos el mensaje para buscar algo que est√© en el componente: </p><br><pre> <code class="plaintext hljs">const msg = 'Welcome to Vuetify';</code> </pre> <br><p>  Ahora la prueba pasa (verifique con <code>yarn test:unit</code> ) pero todav√≠a hay una buena docena de advertencias similares a </p><br><pre> <code class="plaintext hljs">[Vue warn]: Unknown custom element: &lt;v-layout&gt; - did you register the component correctly? For recursive components, make sure to provide the "name" option.</code> </pre> <br><p>  La forma en que funciona Vuetify agrega <code>./src/plugins/vuetify.ts</code> que configura Vuetify como parte de la aplicaci√≥n.  Este archivo proviene de <code>./src/main.ts</code> .  Lamentablemente, se omite <code>main.ts</code> cuando ejecuta pruebas unitarias. </p><br><p>  Lo primero es lo primero, <code>vuetify.ts</code> los errores y advertencias dentro del <code>vuetify.ts</code> generado. </p><br><p>  Abra su <code>./tsconfig.json</code> y agregue <code>vuetify</code> a la secci√≥n <code>compilerOptions.types</code> : </p><br><pre> <code class="plaintext hljs"> "types": [ "webpack-env", "vuetify", "jest" ],</code> </pre> <br><p>  Esto le dice al compilador TypeScript de d√≥nde obtener los tipos de Vuetify y el error en <code>./src/plugins/vuetify.ts</code> desaparece.  Arreglemos algunas advertencias de estilo para limpiarlo: </p><br><pre> <code class="plaintext hljs">import Vue from 'vue'; import Vuetify from 'vuetify/lib'; import 'vuetify/src/stylus/app.styl'; Vue.use(Vuetify, { theme: { primary: '#ee44aa', secondary: '#424242', accent: '#82B1FF', error: '#FF5252', info: '#2196F3', success: '#4CAF50', warning: '#FFC107', }, customProperties: true, iconfont: 'md', });</code> </pre> <br><p>  Ahora necesitamos cargar Vuetify en el contexto de nuestras pruebas unitarias.  Cree un nuevo archivo en <code>./tests/jest-setup.js</code> con el siguiente contenido: </p><br><pre> <code class="plaintext hljs">import '@/plugins/vuetify';</code> </pre> <br><p>  y actualice <code>./jest.config.js</code> para cargarlo: </p><br><pre> <code class="plaintext hljs">module.exports = { ... setupFiles: ['./tests/jest-setup.js'], }</code> </pre> <br><p><img src="https://habrastorage.org/webt/xi/xk/-h/xixk-hz2bwqbiqo5_nlxo1ahgq8.png"></p><br><p>  Las pruebas a√∫n fallan pero de una manera bastante cr√≠ptica.  Que paso </p><br><p>  <code>vuetify/lib</code> es una fuente sin procesar de Vuetify que incluye elementos como m√≥dulos ES.  Jest ejecuta transformaciones solo para su c√≥digo fuente de forma predeterminada, lo que significa que ignora todo en <code>node_modules</code> .  M√°s a√∫n, dado que le dijimos a Vue que use TypeScript, la broma no est√° configurada para transpilar JS. </p><br><p>  Para solucionar esto, necesitamos hacer dos cambios en <code>./jest.config.js</code> : </p><br><pre> <code class="plaintext hljs">module.exports = { ... transform: { '^.+\\.vue$': 'vue-jest', '.+\\.(css|styl|less|sass|scss|svg|png|jpg|ttf|woff|woff2)$': 'jest-transform-stub', '^.+\\.tsx?$': 'ts-jest', '^.+\\.jsx?$': 'babel-jest', // &lt;-- (1) }, transformIgnorePatterns: [ 'node_modules/(?!(vuetify)/)', // &lt;-- (2) ], }</code> </pre> <br><p>  En <strong>(1)</strong> le decimos a Jest que transforme cualquier archivo <code>*.js</code> o <code>*.jsx</code> con Babel (y Babel est√° preconfigurado para nosotros por Vue Cli), pero ¬øqu√© es <strong>(2)</strong> ?  <code>transformIgnorePatterns</code> especifica las rutas que Jest ignorar√° al transpilar c√≥digo y, como se√±al√© anteriormente, el valor predeterminado incluye <code>node_modules</code> .  Aqu√≠ reemplazamos el valor predeterminado con una expresi√≥n cr√≠ptica <code>node_modules/(?!(vuetify)/)</code> que significa "ignorar cualquier ruta que comience con <code>node_modules/</code> menos que sea seguido por <code>vuetify</code> ": <br><img src="https://habrastorage.org/webt/7e/z_/yi/7ez_yimfw1mdrnxxm0didej0piq.png"></p><br><p>  Observe c√≥mo los dos primeros caminos tienen una coincidencia, pero el tercero no.  Este truco ser√° √∫til cuando agreguemos Storybook, pero por ahora. </p><br><p>  Ejecutando las pruebas nuevamente ... <br><img src="https://habrastorage.org/webt/p9/yy/sa/p9yysa_dproyxl5wtyovsh0p6f8.png"></p><br><p>  Elementos personalizados desconocidos est√°n de vuelta;  pero al menos se compila y se ejecuta con √©xito.  Vuetify se transplic√≥ pero a√∫n necesitamos registrar los componentes manualmente.  Hay algunas opciones sobre c√≥mo hacerlo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">consulte sus documentos para ver otras opciones</a> );  lo que haremos aqu√≠ es importar los componentes necesarios al alcance global de Vue.  Abra <code>./src/plugins/vuetify.ts</code> nuevamente y actual√≠celo a: </p><br><pre> <code class="plaintext hljs">import Vue from 'vue'; import Vuetify, { VFlex, VLayout, VContainer, VImg } from 'vuetify/lib'; import 'vuetify/src/stylus/app.styl'; Vue.use(Vuetify, { components: { VFlex, VLayout, VContainer, VImg }, theme: { primary: '#ee44aa', secondary: '#424242', accent: '#82B1FF', error: '#FF5252', info: '#2196F3', success: '#4CAF50', warning: '#FFC107', }, customProperties: true, iconfont: 'md', });</code> </pre> <br><p>  Finalmente, las pruebas pasan: <br><img src="https://habrastorage.org/webt/5f/7s/n1/5f7sn17rr8sk9ei5pgib4x3kc_0.png"></p><br><p>  Las pruebas E2E tambi√©n fallar√°n ( <code>yarn test:e2e --headless</code> ), pero se debe a que <code>./tests/e2e/specs/test.js</code> buscando una cadena que ya no existe.  Las pruebas de E2E aceleran su aplicaci√≥n real en un navegador real para que no haya c√≥digo que corregir: Vuetify est√° configurado en su aplicaci√≥n.  <code>test.js</code> para buscar el nuevo encabezado: </p><br><pre> <code class="plaintext hljs">cy.contains('h1', 'Welcome to Vuetify')</code> </pre> <br><p>  y se volver√° verde nuevamente. </p><br><p>  Recapitulemos.  Agregamos Vuetify, arreglamos las pruebas de unidad y e2e para tratar con una nueva plantilla y actualizamos Jest para transpilar el c√≥digo fuente de Vuetify y cargarlo.  Nuestra aplicaci√≥n es funcional y podemos usar varios componentes materiales.  Pasando a las historias! </p><br><h2 id="storybooks">  Libros de cuentos </h2><br><p>  Los libros de cuentos son una idea brillante: escribe sus casos de prueba desde la perspectiva del dise√±ador: peque√±os componentes en la aplicaci√≥n completa.  Puede razonar con el flujo de datos, asegurarse de que todo se vea exactamente como lo dise√±√≥ su dise√±ador de interfaz de usuario en Photoshop, probar sus componentes de forma aislada.  ¬°Agreguemos soporte para libros de cuentos! </p><br><p>  Hay un complemento Vue storybook pero encontr√© que <code>sb init</code> ofrece una plantilla predeterminada m√°s agradable, por lo que la utilizaremos en su lugar.  Ejecute <code>npx -p @storybook/cli sb init</code> y despu√©s de unos minutos deber√≠a recibir un mensaje para ejecutar <code>yarn storybook</code> .  Hag√°moslo: <br><img src="https://habrastorage.org/webt/zl/nk/zp/zlnkzp3a8aoo-hvz9m_n8yu3moa.png"></p><br><p>  ¬°Agreguemos una nueva historia!  Cree <code>./src/components/LoveButton.stories.ts</code> con los siguientes contenidos: </p><br><pre> <code class="plaintext hljs">import { storiesOf } from '@storybook/vue'; import LoveButton from './LoveButton.vue'; storiesOf('LoveButton', module) .add('default', () =&gt; ({ components: { LoveButton }, template: `&lt;love-button love="vue"/&gt;`, }));</code> </pre> <br><p>  (tenga en cuenta que puede usar <code>LoveButton.stories.js</code> aqu√≠ si quiere ser relajado al escribir sus historias). </p><br><p>  TypeScript le advertir√° sobre los tipos faltantes que puede solucionar con <code>yarn add -D @types/storybook__vue</code> . </p><br><p>  Ahora cree <code>./src/components/LoveButton.vue</code> con los siguientes contenidos: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span>favorite<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span> {{love}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ts"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> Vue </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'vue'</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">export</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">default</span></span></span><span class="javascript"> Vue.extend({ </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">props</span></span></span><span class="javascript">: [</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'love'</span></span></span><span class="javascript">], }); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Storybook buscar√° en <code>./stories</code> sus historias de manera predeterminada, pero a menudo es m√°s √∫til mantener las historias m√°s cerca de sus componentes (tal como lo hicimos nosotros).  Para decirle a Storybook d√≥nde buscarlos, actualice su <code>./.storybook/config.js</code> : </p><br><pre> <code class="plaintext hljs">import { configure } from '@storybook/vue'; const req = require.context('../src', true, /.stories.(j|t)s$/); function loadStories() { req.keys().forEach(filename =&gt; req(filename)); } configure(loadStories, module);</code> </pre> <br><p>  Ahora, ejecute <code>yarn storybook</code> nuevamente: <br><img src="https://habrastorage.org/webt/zp/et/ow/zpetowrxhyjw0fk58backjxdtj8.png"></p><br><p>  No muy emocionante.  La consola est√° llena de advertencias: <br><img src="https://habrastorage.org/webt/8r/cr/kj/8rcrkj3uud0cc8kaaya3rr1lkho.png"></p><br><p>  Sin embargo, sabemos de qu√© se trata ahora.  Storybook es otro contexto "ra√≠z" con su propio punto de entrada;  no usa <code>main.ts</code> y, como tal, no carga Vuetify, por lo que debemos decirle que lo haga.  Actualizaci√≥n <code>./.storybook/config.js</code> : </p><br><pre> <code class="plaintext hljs">import { configure } from '@storybook/vue'; import '../src/plugins/vuetify'; // &lt;-- add this const req = require.context('../src', true, /.stories.(j|t)s$/); function loadStories() { req.keys().forEach(filename =&gt; req(filename)); } configure(loadStories, module);</code> </pre> <br><p>  Estamos cargando nuestra configuraci√≥n existente nuevamente, lo que nos asegura que Storybook use el mismo tema que la aplicaci√≥n real.  Lamentablemente, el <code>yarn storybook</code> fallar√° ahora: <br><img src="https://habrastorage.org/webt/lb/g0/nq/lbg0nq7fapzeztm7zfrzrhx8lz8.png"></p><br><p>  Storybook no sabe que usamos TypeScript, por lo que no puede cargar el archivo <code>vuetify.ts</code> .  Para solucionar esto, necesitamos actualizar la propia configuraci√≥n del paquete web de Storybook.  Cree <code>./.storybook/webpack.config.js</code> con los siguientes contenidos: </p><br><pre> <code class="plaintext hljs">const ForkTsCheckerWebpackPlugin = require('fork-ts-checker-webpack-plugin'); module.exports = (baseConfig, env, defaultConfig) =&gt; { defaultConfig.resolve.extensions.push('.ts', '.tsx', '.vue', '.css', '.less', '.scss', '.sass', '.html') defaultConfig.module.rules.push({ test: /\.ts$/, exclude: /node_modules/, use: [ { loader: 'ts-loader', options: { appendTsSuffixTo: [/\.vue$/], transpileOnly: true }, } ], }); defaultConfig.module.rules.push({ test: /\.less$/, loaders: [ 'style-loader', 'css-loader', 'less-loader' ] }); defaultConfig.module.rules.push({ test: /\.styl$/, loader: 'style-loader!css-loader!stylus-loader' }); defaultConfig.plugins.push(new ForkTsCheckerWebpackPlugin()) return defaultConfig; };</code> </pre> <br><p>  Esto carga la configuraci√≥n predeterminada, agrega <code>ts-loader</code> para archivos TypeScript y tambi√©n agrega soporte para less y styl (que usa Vuetify). </p><br><p>  Las advertencias siguen ah√≠, porque necesitamos registrar los componentes que utilizamos.  Usemos componentes locales esta vez para que pueda ver la diferencia (en una aplicaci√≥n de producci√≥n real es mucho m√°s simple registrarlos todos en <code>vuetify.ts</code> ).  Actualizaci√≥n <code>./src/components/LoveButton.vue</code> : </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span>favorite<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-icon</span></span></span><span class="hljs-tag">&gt;</span></span> {{love}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">v-btn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ts"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> Vue </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'vue'</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> { VBtn, VIcon } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'vuetify/lib'</span></span></span><span class="javascript">; </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">// &lt;-- add this export default Vue.extend({ components: { VBtn, VIcon }, // &lt;-- and this props: ['love'], }); </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  El libro de cuentos se actualiza al guardar: <br><img src="https://habrastorage.org/webt/jb/eb/yn/jbebynfkavexxg2og5kbdcvtaou.png"></p><br><p>  Marginalmente mejor.  Lo que falta  El instalador de Vuetify agreg√≥ las fuentes css directamente a <code>./public/index.html</code> pero Storybook no usa ese archivo, por lo que debemos agregar la fuente de Material Icons que falta.  Cree <code>./.storybook/preview-head.hmtl</code> con lo siguiente (copiando de <code>./public/index.html</code> ): </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://fonts.googleapis.com/css?family=Material+Icons"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  (hay otras formas de hacer lo mismo, por ejemplo, usando CSS <code>@import</code> ). </p><br><p>  Debe reiniciar su <code>yarn storybook</code> de <code>yarn storybook</code> para que se vuelva a representar correctamente: <br><img src="https://habrastorage.org/webt/ar/pn/i2/arpni2dvklu5w-cdct4fvgtl00q.png"></p><br><p>  Mucho mejor pero todav√≠a inferior: la fuente de texto es incorrecta porque Vuetify espera que todos sus componentes est√©n anidados dentro de <code>v-app</code> que aplica los estilos de p√°gina.  Seguramente no podemos agregar <code>v-app</code> a nuestro bot√≥n, as√≠ que decoremos la historia en su lugar.  Actualice su <code>./src/components/LoveButton.stories.ts</code> : </p><br><pre> <code class="plaintext hljs">import { storiesOf } from '@storybook/vue'; import { VApp, VContent } from 'vuetify/lib'; // &lt;-- add the import import LoveButton from './LoveButton.vue'; // add the decorator const appDecorator = () =&gt; { return { components: { VApp, VContent }, template: ` &lt;v-app&gt; &lt;div style="background-color: rgb(134, 212, 226); padding: 20px; width: 100%; height: 100%;"&gt; &lt;v-content&gt; &lt;story/&gt; &lt;/v-content&gt; &lt;/div&gt; &lt;/v-app&gt; `, }; }; storiesOf('LoveButton', module) .addDecorator(appDecorator) // &lt;-- decorate the stories .add('default', () =&gt; ({ components: { LoveButton }, template: `&lt;love-button love="vue"/&gt;`, }));</code> </pre> <br><p>  Debe registrar <code>VApp</code> y <code>VContent</code> en el √°mbito global, actualice su <code>./src/plugins/vuetify.ts</code> : </p><br><pre> <code class="plaintext hljs">import Vue from 'vue'; import Vuetify, { VFlex, VLayout, VContainer, VImg, VApp, VContent } from 'vuetify/lib'; import 'vuetify/src/stylus/app.styl'; Vue.use(Vuetify, { components: { VFlex, VLayout, VContainer, VImg, VApp, VContent }, theme: { primary: '#ee44aa', secondary: '#424242', accent: '#82B1FF', error: '#FF5252', info: '#2196F3', success: '#4CAF50', warning: '#FFC107', }, customProperties: true, iconfont: 'md', });</code> </pre> <br><p>  Finalmente, el resultado es espectacular: <br><img src="https://habrastorage.org/webt/gv/4a/nn/gv4ann-op0rqahdnqjpuzjqlgya.png"></p><br><h2 id="adding-storybook-testing">  Agregar pruebas de cuentos </h2><br><p>  Finalmente, asegur√©monos de que nuestras historias est√©n cubiertas por pruebas unitarias.  Agregue las dependencias requeridas: <code>yarn add -D @storybook/addon-storyshots jest-vue-preprocessor babel-plugin-require-context-hook</code> y cree <code>./test/unit/storybook.spec.js</code> : </p><br><pre> <code class="plaintext hljs">import registerRequireContextHook from 'babel-plugin-require-context-hook/register'; import initStoryshots from '@storybook/addon-storyshots'; registerRequireContextHook(); initStoryshots();</code> </pre> <br><p>  La configuraci√≥n de Storybook usa <code>require.context</code> para recopilar todas las fuentes;  webpack proporciona esa funci√≥n y necesitamos usar <code>babel-plugin-require-context-hook</code> para sustituirla en Jest.  Modifique su <code>./babel.config.js</code> : </p><br><pre> <code class="plaintext hljs">module.exports = api =&gt; ({ presets: ['@vue/app'], ...(api.env('test') &amp;&amp; { plugins: ['require-context-hook'] }), });</code> </pre> <br><p>  Aqu√≠ agregamos el complemento <code>require-context-hook</code> si babel se ejecuta para pruebas unitarias. </p><br><p>  Finalmente, debemos permitir que Jest transpile los archivos <code>*.vue</code> del libro de cuentos.  ¬øRecuerdas esa expresi√≥n regular <code>./jest.config.js</code> en <code>./jest.config.js</code> ?  Volvamos a visitarlo ahora: </p><br><pre> <code class="plaintext hljs">module.exports = { ... transformIgnorePatterns: [ 'node_modules/(?!(vuetify/|@storybook/.*\\.vue$))', ], }</code> </pre> <br><p>  Tenga en cuenta que no podemos simplemente agregar una segunda l√≠nea all√≠.  Recuerde que es un patr√≥n de ignorar, por lo que si el primer patr√≥n ignora todo menos Vuetify, los archivos del libro de cuentos ya se ignorar√°n cuando Jest llegue a la segunda expresi√≥n regular. </p><br><p>  Las nuevas pruebas funcionan como se esperaba: <br><img src="https://habrastorage.org/webt/dn/t6/22/dnt622f3au95rkrhcfgusnkdj_e.png"></p><br><p>  Esta prueba ejecutar√° todas sus historias y las verificar√° contra las instant√°neas locales en <code>./tests/unit/__snapshots__/</code> .  Para verlo en acci√≥n, puede eliminar <code>&lt;v-icon&gt;favorite&lt;/v-icon&gt;</code> del componente de su bot√≥n y volver a ejecutar la prueba para ver que falla: <br><img src="https://habrastorage.org/webt/rf/oh/09/rfoh09qhni7mvf_jzsj_dmzuf_e.png"></p><br><p>  <code>yarn test:unit -u</code> actualizar√° su instant√°nea para el nuevo dise√±o del bot√≥n. </p><br><h2 id="recap">  Recapitulaci√≥n </h2><br><p>  En este tutorial aprendimos c√≥mo crear una nueva aplicaci√≥n Vue con TypeScript habilitado;  c√≥mo agregar la biblioteca Vuetify con componentes de la interfaz de usuario de material.  Nos aseguramos de que nuestras pruebas unitarias y las pruebas e2e funcionen como se esperaba.  Finalmente, agregamos soporte para libros de cuentos, creamos una historia de muestra y nos aseguramos de que los cambios de UI est√©n cubiertos por nuestras pruebas unitarias. </p><br><h2 id="closing-thoughts">  Pensamientos finales </h2><br><p>  JS es un mundo en movimiento, las cosas cambian constantemente, surgen nuevos patrones, los viejos se olvidan.  Este tutorial puede quedar obsoleto en solo un par de meses, as√≠ que aqu√≠ hay algunos consejos √∫tiles. </p><br><p>  Conoce tus herramientas.  Est√° bien copiar y pegar l√≠neas desde el desbordamiento de la pila hasta que su c√≥digo funcione, pero <strong>debe</strong> investigar por qu√© el cambio lo hizo funcionar m√°s tarde.  Lea los documentos y aseg√∫rese de comprender qu√© hace exactamente el cambio. </p><br><p>  Si tienes algo para trabajar, incluso parcialmente, haz un compromiso.  Incluso si es un trabajo en progreso, tendr√° algo a lo que recurrir en caso de que sus cambios adicionales rompan algo. </p><br><p>  Experimento!  Si algo no funciona como piensas y los documentos dicen lo contrario, ¬°experimenta!  El mundo frontend es en su mayor√≠a de c√≥digo abierto, as√≠ que profundice en las fuentes de terceros y vea si puede jugar con sus instrumentos desde el interior para agregar el registro de depuraci√≥n. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/438354/">https://habr.com/ru/post/438354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../438342/index.html">¬øPor qu√© enga√±a a la IA amigable en Ghost Recon Wildlands?</a></li>
<li><a href="../438346/index.html">Como lo hacen Descripci√≥n general de las tecnolog√≠as de anonimato de criptomonedas</a></li>
<li><a href="../438348/index.html">C√≥mo aprender a programar a los 9 a√±os de forma independiente</a></li>
<li><a href="../438350/index.html">Gu√≠a completa para la b√∫squeda profesional de c√°maras ocultas y dispositivos esp√≠a</a></li>
<li><a href="../438352/index.html">Video del descenso del rover "Yutu-2", sus primeros metros en la superficie de la luna. Dos semanas de sue√±o en la luna ha terminado</a></li>
<li><a href="../438356/index.html">Arquitectura certificada de SQL Server Data Warehouse Fast Track (DWFT): qu√© significa y c√≥mo funciona</a></li>
<li><a href="../438358/index.html">Ex operativos de la NSA espiando iPhones de las v√≠ctimas por encargo de los EAU</a></li>
<li><a href="../438362/index.html">C√≥mo tradujimos la configuraci√≥n de nuestros servicios de XML a YAML</a></li>
<li><a href="../438364/index.html">Replicaci√≥n del primer codificador digital de voz del mundo</a></li>
<li><a href="../438366/index.html">Otra revisi√≥n m√°s de la caracter√≠stica de tokens de hardware OATH en Azure Cloud MFA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>