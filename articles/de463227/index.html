<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📆 👨🏽‍💼 🔶 Problemlösung mit pwnable.kr 19 - Verknüpfung aufheben. Heap-Pufferüberlauf 👩‍👩‍👧 👨🏿‍✈️ 🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werden wir uns mit der Sicherheitsanfälligkeit bezüglich Pufferüberlauf im Heap befassen und auch die 19. Aufgabe von der Site pwnab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Problemlösung mit pwnable.kr 19 - Verknüpfung aufheben. Heap-Pufferüberlauf</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463227/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/al/py/ef/alpyefagnx81cc2xc1ncjqs8lus.png" alt="Bild"></div><br>  In diesem Artikel werden wir uns mit der Sicherheitsanfälligkeit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bezüglich</a> Pufferüberlauf im Heap befassen und auch die 19. Aufgabe von der Site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pwnable.kr lösen</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Organisationsinformationen</b> <div class="spoiler_text">  Speziell für diejenigen, die etwas Neues lernen und sich in einem der Bereiche Informations- und Computersicherheit entwickeln möchten, werde ich über die folgenden Kategorien schreiben und sprechen: <br><br><ul><li>  PWN; </li><li>  Kryptographie (Krypto); </li><li>  Netzwerktechnologien (Netzwerk); </li><li>  Reverse (Reverse Engineering); </li><li>  Steganographie (Stegano); </li><li>  Suche und Ausnutzung von WEB-Schwachstellen. </li></ul><br>  Darüber hinaus werde ich meine Erfahrungen in den Bereichen Computerforensik, Analyse von Malware und Firmware, Angriffe auf drahtlose Netzwerke und lokale Netzwerke, Durchführung von Pentests und Schreiben von Exploits teilen. <br><a name="habracut"></a><br>  Damit Sie sich über neue Artikel, Software und andere Informationen informieren können, habe ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in Telegram</a> einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kanal</a> und eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gruppe eingerichtet, um alle Probleme</a> im Bereich ICD <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu diskutieren</a> .  Außerdem werde ich Ihre persönlichen Anfragen, Fragen, Vorschläge und Empfehlungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">persönlich</a> prüfen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">und alle beantworten</a> . <br><cut></cut><br>  Alle Informationen werden nur zu Bildungszwecken bereitgestellt.  Der Autor dieses Dokuments übernimmt keine Verantwortung für Schäden, die jemandem durch die Verwendung von Kenntnissen und Methoden entstehen, die durch das Studium dieses Dokuments erworben wurden. <br></div></div><br><h2>  Wie ein Haufen organisiert ist </h2><br>  Der Speicher kann belegt (zugewiesen) und frei sein.  Die Abbildung zeigt den dynamischen Speicher. <br><ul><li>  SSize - Die Größe des vorherigen Speicherblocks, sofern dieser frei ist. </li><li>  Größe - Die Größe des angegebenen Speicherblocks, zu dem 2 Statusbits hinzugefügt werden. </li><li>  Daten - Benutzerdaten. </li><li>  Fd ist ein Zeiger auf den nächsten freien Block. </li><li>  Bk - Zeiger auf den vorherigen freien Block. </li><li>  Freier Speicher. </li></ul><br><img src="https://habrastorage.org/webt/od/l8/wl/odl8wldwtep38idb6xl7mo0xomo.png" alt="Bild"><br><cut></cut><br>  Somit können keine zwei freien Blöcke Nachbarn sein.  Außerdem befindet sich an der Grenze zwischen belegtem und freiem Systemspeicher ein speziell verarbeiteter freier W-Block. <br><br><img src="https://habrastorage.org/webt/g7/me/mj/g7memj23astzelqipouglqcyryo.png" alt="Bild"><br><br>  Die Darstellung von Blöcken in Listen (Körben) ist wie folgt. <br><br><img src="https://habrastorage.org/webt/si/nb/zi/sinbzijmqm41pmtlvznicjwqsig.png" alt="Bild"><br><br>  Die Methode zum Aufheben der Verknüpfung wird verwendet, um einen freien Block aus der Liste zu entfernen. <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unlink</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S, BK, FD)</span></span></span></span>{ BK = S-&gt;bk; FD = S-&gt;fd; FD-&gt;bk=BK; FD-&gt;fd=FD; }</code> </pre> <br><h2>  Zuweisung und Freigabe von Speicher </h2><br>  Mal sehen, wie mmap funktioniert.  Im ersten Schritt werden die Arrays mit den erforderlichen Größen überprüft (z. B. 24 Byte).  Wenn es einen erforderlichen Block gibt, wird dieser durch Aufheben der Verknüpfung getrennt. <br><br><img src="https://habrastorage.org/webt/1l/ia/1g/1lia1gy8vhckf3btuyuuipxwrvs.png" alt="Bild"><br><br>  Wenn dieser Block im zweiten Schritt groß genug ist, wird er in zwei Teile geteilt.  Der erste Teil wird zugewiesen und der zweite Teil wird auf ein anderes Array verteilt. <br><br><img src="https://habrastorage.org/webt/tn/0g/dz/tn0gdz_2jn5pxabh-bmqe85sllw.png" alt="Bild"><br><br>  Wenn im dritten Schritt der Block der erforderlichen Größe nicht zugewiesen wurde, wird der W-Block überprüft.  Wenn er zufrieden ist, werden die Schritte zwei mit ihm gehalten.  Wenn der W-Block klein war, werden sbrk () und mmap () verwendet, um den verfügbaren Speicher zu erweitern.  Die Free-Methode ist der mmap völlig entgegengesetzt. <br><br><h2>  Heap-Pufferüberlauf </h2><br>  Ein Heap-Überlauf ist eine Art Pufferüberlauf, der im Heap-Datenbereich auftritt.  Der Speicher auf dem Heap wird von der Anwendung zur Laufzeit dynamisch zugewiesen und enthält normalerweise Programmdaten.  Die Ausnutzung erfolgt durch Beschädigung dieser Daten auf besondere Weise, sodass die Anwendung interne Strukturen überschreibt, z. B. Zeiger auf eine verknüpfte Liste.  Die kanonische Heap-Überlaufmethode überschreibt die dynamische Speicherzuordnungsbeziehung (z. B. Malloc-Metadaten) und verwendet den Zeigertausch, um einen Zeiger auf eine Programmfunktion neu zu schreiben. <br><br>  In der Funktion "Verknüpfung aufheben" können Sie beispielsweise mit FD-&gt; bk den Wert eines beliebigen Wortes im Speicher ändern.  Geben Sie beispielsweise den Shellcode ein, um die GOT-Adresse zu ändern.  Ein Beispiel für einen Überlauf ist ein Beispiel. <br><br><h2>  Joblösung aufheben </h2><br>  Wir klicken auf das erste Symbol mit der Verknüpfung der Signatur und erfahren, dass wir über SSH eine Verbindung mit dem Kennwort "Gast" herstellen müssen. <br><br><img src="https://habrastorage.org/webt/jz/as/1x/jzas1xaqekf5eq9erbqm5njrwsc.png" alt="Bild"><br><br>  Wenn verbunden, sehen wir das entsprechende Banner. <br><br><img src="https://habrastorage.org/webt/ys/ez/1q/ysez1qokcr1rmiop8umaw7xsydy.png" alt="Bild"><br><br>  Lassen Sie uns herausfinden, welche Dateien sich auf dem Server befinden und welche Rechte wir haben. <br><br><img src="https://habrastorage.org/webt/tr/_f/ax/tr_faxkgym1_ffnyi2dhf4pyeui.png" alt="Bild"><br><br>  Sehen wir uns den Quellcode an. <br><br><img src="https://habrastorage.org/webt/xl/w_/ov/xlw_ovk-ykliwdgmzemsutj740m.png" alt="Bild"><br><br>  Wir haben also Objekt B mit den Objekten A und C verknüpft. Dann wird das Objekt A eingegeben und gefüllt. Wenn die Objekte A - B - C verbunden sind und die Füllung von A steuern, können wir den Heap überlaufen und die Objekte B und C neu schreiben. Wir müssen einen Weg finden, um die Sicherheitsanfälligkeit auszunutzen.  Schauen wir uns gdb an. <br><br><img src="https://habrastorage.org/webt/c3/pz/mn/c3pzmn74gtqxoadbjt3uoo-vyru.png" alt="Bild"><br><br>  So können Sie den Shellcode schreiben und die Absenderadresse von main in unseren Shellcode umschreiben.  Die Absenderadresse fällt insb aus dem ecx-Register, wo sie von ebp-4 gespeist wird.  Beim Zerlegen der Unlink-Funktion stellen wir fest, dass ebp-4 durch Benutzereingaben gesteuert werden kann. <br><br><img src="https://habrastorage.org/webt/yk/wr/vs/ykwrvs0tnxcx-baddh99o7iv4eq.png" alt="Bild"><br><br>  Mal sehen, wie sich unsere Objekte im Speicher befinden und wie die Funktion zum Aufheben der Verknüpfung funktioniert.  Jedes Objekt belegt 16 Byte im Speicher (4 für Zeiger und 8 für Puffer). <br><br><img src="https://habrastorage.org/webt/o-/bd/gj/o-bdgjsoyb4cgj_wqd_h7ce6vkc.png" alt="Bild"><br><br>  Die Speicherzuweisung für Objekte erfolgt in den Zeilen main + 38, main + 54 und main + 70.  Vor jedem Aufruf erhöht sich der Stapelzeiger (esp) um 16 und verringert sich um 12, wonach 16 Bytes reserviert werden. <br><br><img src="https://habrastorage.org/webt/64/s2/g3/64s2g3u8ol_xinrsp-eua8gibfo.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/ba/y5/b7/bay5b7cq9wmxel5juyrrfzkiaqu.png" alt="Bild"><br><br>  Das heißt, zwischen den Strukturen befinden sich 4 Bytes. <br><br><img src="https://habrastorage.org/webt/me/4e/qx/me4eqxnvxygpcp_n5ohygmkwomi.png" alt="Bild"><br><br>  Als nächstes folgt das Verknüpfen und Verknüpfen von Objekten. <br><br><img src="https://habrastorage.org/webt/y3/nd/vu/y3ndvuyo9euui4ip_ktetucknsa.png" alt="Bild"><br><br><img src="https://habrastorage.org/webt/rj/aw/0l/rjaw0lfmf7sycqabk3zlcziok4i.png" alt="Bild"><br><br>  Daher müssen wir bei der Rückkehr von der Funktion die Adresse an den Speicherort Heap + 12 senden, der die Kontrolle an die Adresse überträgt, an der sich der Shellcode befindet. <br><br><img src="https://habrastorage.org/webt/sn/ex/nd/snexnd9lwel8-cv1gxcnee1-wvg.png" alt="Bild"><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pwn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * s = ssh(<span class="hljs-string"><span class="hljs-string">"unlink"</span></span>, <span class="hljs-string"><span class="hljs-string">"pwnable.kr"</span></span>, password=<span class="hljs-string"><span class="hljs-string">"guest"</span></span>, port=<span class="hljs-number"><span class="hljs-number">2222</span></span>) ex = s.process(<span class="hljs-string"><span class="hljs-string">"./unlink"</span></span>) shell_address = p32(<span class="hljs-number"><span class="hljs-number">0x80484eb</span></span>) ans = ex.recv().split(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>) stack_addr = p32(int(ans[<span class="hljs-number"><span class="hljs-number">0</span></span>].split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">5</span></span>],<span class="hljs-number"><span class="hljs-number">16</span></span>) + <span class="hljs-number"><span class="hljs-number">16</span></span>) heap_addr = p32(int(ans[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">" "</span></span>)[<span class="hljs-number"><span class="hljs-number">5</span></span>],<span class="hljs-number"><span class="hljs-number">16</span></span>) + <span class="hljs-number"><span class="hljs-number">12</span></span>) payload = shell_address + <span class="hljs-string"><span class="hljs-string">"A"</span></span>*<span class="hljs-number"><span class="hljs-number">12</span></span> + heap_addr + stack_addr ex.sendline(payload) ex.interactive()</code> </pre> <br><img src="https://habrastorage.org/webt/bf/ve/wv/bfvewvnmhb4ncoo4uwc5rvrrqss.png" alt="Bild"><br><br>  Wir bekommen die Muschel, lesen die Flagge, bekommen 10 Punkte. <br><br><img src="https://habrastorage.org/webt/cn/jm/cg/cnjmcgkhpj7_lzlu2eht9odbjga.png"><br><br>  Sie können sich uns <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">per Telegramm anschließen</a> .  Das nächste Mal werden wir uns mit dem Heap-Überlauf befassen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de463227/">https://habr.com/ru/post/de463227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de463207/index.html">Chatbot-Entwicklung (Telegramm + Youtube)</a></li>
<li><a href="../de463215/index.html">Ingenieure und Architekten entwerfen bereits Mond-Siedlungen</a></li>
<li><a href="../de463221/index.html">Beobachten der Sonne: 5 Arten von Geräten, von 5 bis 5.000 US-Dollar</a></li>
<li><a href="../de463223/index.html">Die Zusammenfassung interessanter Materialien für den mobilen Entwickler # 310 (vom 5. bis 11. August)</a></li>
<li><a href="../de463225/index.html">WiFi Enterprise. FreeRadius + FreeIPA + Ubiquiti</a></li>
<li><a href="../de463229/index.html">Jetpacks in Kultur: Kino</a></li>
<li><a href="../de463231/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 14. VTP, Bereinigen und natives VLAN</a></li>
<li><a href="../de463233/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 15. Langsame Kommunikation und Port-Sicherheit</a></li>
<li><a href="../de463237/index.html">Wie wir Musik mit neuronalen Netzen v 2.0 gespielt haben</a></li>
<li><a href="../de463239/index.html">22. August - Alfa JS MeetUP SPb</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>