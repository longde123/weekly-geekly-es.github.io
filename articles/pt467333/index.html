<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¥üèº ‚è∏Ô∏è ‚õ∑Ô∏è [Resumo do administrador] Como fazer amizade com o DHCP e n√£o ter medo do APIPA üßî üõãÔ∏è üò°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O servi√ßo que emite endere√ßos IP para dispositivos na rede local parece ser um dos mais simples e mais familiares. No entanto, meus colegas mais joven...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>[Resumo do administrador] Como fazer amizade com o DHCP e n√£o ter medo do APIPA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pc-administrator/blog/467333/"><p><img src="https://habrastorage.org/getpro/habr/post_images/9c9/795/e15/9c9795e155e62808327ad29e2e964e7a.jpg"></p><br><p>  O servi√ßo que emite endere√ßos IP para dispositivos na rede local parece ser um dos mais simples e mais familiares.  No entanto, meus colegas mais jovens ainda ocasionalmente t√™m perguntas como "o computador est√° recebendo algum endere√ßo estranho", e a apar√™ncia de um segundo servidor DHCP em um segmento de rede causa alguns problemas de emo√ß√£o ou rede. </p><br><p>  Para que aqueles que leem este material n√£o tenham essas perguntas, eu gostaria de reunir v√°rias informa√ß√µes b√°sicas sobre a opera√ß√£o dos mecanismos de emiss√£o de endere√ßos IP, recursos e exemplos de configura√ß√£o de configura√ß√µes protegidas e tolerantes a falhas.  Sim, e talvez especialistas inexperientes estejam interessados ‚Äã‚Äãem atualizar as conex√µes neurais. </p><br><p>  Um pouco de teoria e solu√ß√µes para problemas interessantes e n√£o muito pr√°ticos - sob o corte. </p><a name="habracut"></a><br><p>  Em uma rede local moderna, a emiss√£o de endere√ßos geralmente √© feita por servi√ßos especializados com suporte a protocolo.  O mais popular deles √© o DHCP (Dynamic Host Configuration Protocol). </p><br><h1 id="zeroconf-ili-zachem-nam-voobsche-kakoy-to-dhcp">  Zeroconf ou por que precisamos de algum tipo de DHCP </h1><br><p> Em princ√≠pio, uma pilha de tecnologia chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zeroconf</a> foi criada especificamente para pequenas redes.  Ele permite que voc√™ fique sem servi√ßos e servidores centralizados, incluindo, entre outros, a emiss√£o de endere√ßos IP.  Eles fecham (bem, ou quase fecham) as seguintes perguntas: </p><br><p>  <strong>Obten√ß√£o de um endere√ßo IP</strong> (endere√ßamento IP privado autom√°tico ou APIPA).  O pr√≥prio sistema atribui um IP da rede 169.254.0.0/16 (exceto as grades / 24 no in√≠cio e no final do intervalo), com base no endere√ßo MAC e no gerador de n√∫meros pseudo-aleat√≥rios.  Este sistema permite evitar conflitos, e o endere√ßo desta rede √© chamado link-local - inclusive porque esses endere√ßos n√£o s√£o roteados. </p><br><p>  <strong>Pesquise pelo nome</strong> .  O sistema anuncia seu nome de rede e cada computador trabalha com ele como no DNS, armazenando entradas em seu cache.  A Apple usa a tecnologia mDNS (DNS de difus√£o seletiva) e a Microsoft usa LLMNR (resolu√ß√£o de nome de difus√£o seletiva local), mencionada no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dom√≠nios, endere√ßos e Windows: misture, mas n√£o agite</a> ". </p><br><p>  <strong>Procure por servi√ßos de rede</strong> .  Por exemplo, impressoras.  Talvez o protocolo mais famoso seja o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">UPnP</a> , que, entre outras coisas, pode abrir portas nos pr√≥prios roteadores.  O protocolo √© bastante complicado, ele usa todo um conjunto de complementos, como o http, ao contr√°rio do segundo protocolo conhecido - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DNS-SD</a> (DNS Service Discovery), que simplesmente usa registros SRV, inclusive ao trabalhar com mDNS. </p><br><p>  Com todas as vantagens do Zeroconf - sem nenhum conhecimento sagrado, voc√™ pode construir uma rede de trabalho simplesmente conectando computadores no n√≠vel f√≠sico - pode at√© interferir com os especialistas em TI. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d5b/71d/a7e/d5b71da7ea5fe5493e9881ee71272394.jpg"></p><br><p>  <em>Um pouco chato, n√£o √©?</em> </p><br><p>  Nos sistemas Windows, para desativar o ajuste autom√°tico em todos os adaptadores de rede, voc√™ deve criar um par√¢metro DWORD com o nome <em>IPAutoconfigurationEnabled</em> na se√ß√£o <em>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ Tcpip \ Parameters</em> e configur√°-lo como 0. </p><br><p>  √â claro que o Zeroconf √© adequado apenas para pequenas redes isoladas (por exemplo, voc√™ conheceu um amigo com laptops, os conectou via Wi-Fi e vamos jogar o Diablo II, sem perder tempo em nenhum servidor), e eu tamb√©m quero obter uma rede local na Internet .  Para n√£o sofrer com as configura√ß√µes est√°ticas de cada computador, foram criados protocolos especiais, incluindo o her√≥i do dia - DHCP. </p><br><h1 id="dhcp-i-ego-praroditeli">  DHCP e seus progenitores </h1><br><p>  Uma das primeiras implementa√ß√µes do protocolo para emiss√£o de endere√ßos IP apareceu mais de 30 anos atr√°s e foi chamada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RARP</a> (Reverse Address Resolution Protocol).  Se simplificamos um pouco o princ√≠pio de sua opera√ß√£o, ficou assim: o cliente fez uma solicita√ß√£o para o endere√ßo de broadcast da rede, o servidor a aceitou, encontrou a liga√ß√£o do endere√ßo MAC e do IP do cliente em seu banco de dados e enviou uma resposta de IP. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e6a/53f/109/e6a53f1099a79a913500b6dea05b1dfd.jpg"></p><br><p>  <em>Esquema do protocolo RARP.</em> </p><br><p>  E tudo parecia funcionar.  Mas o protocolo tinha suas desvantagens: era necess√°rio configurar o servidor em cada segmento da rede local, registrar os endere√ßos MAC nesse servidor e n√£o era poss√≠vel transmitir informa√ß√µes adicionais ao cliente.  Portanto, para substitu√≠-lo, o protocolo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BOOTP</a> (Protocolo Bootstrap) foi criado. </p><br><p>  Inicialmente, era usado para esta√ß√µes de trabalho sem disco, que precisavam n√£o apenas fornecer um endere√ßo IP, mas tamb√©m transmitir informa√ß√µes adicionais ao cliente, como o endere√ßo do servidor TFTP e o nome do arquivo de download.  Ao contr√°rio do RARP, o protocolo j√° suportava retransmiss√£o - pequenos servi√ßos que encaminhavam solicita√ß√µes ao servidor "principal".  Isso tornou poss√≠vel usar um servidor em v√°rias redes simultaneamente.  Apenas permaneceu a necessidade de configurar manualmente as tabelas e o limite de tamanho para obter informa√ß√µes adicionais.  Como resultado, o protocolo DHCP moderno entrou em cena, que √© uma extens√£o compat√≠vel do BOOTP (o servidor DHCP suporta clientes herdados, mas n√£o vice-versa). </p><br><p>  Uma diferen√ßa importante dos protocolos obsoletos √© a capacidade de emitir temporariamente um endere√ßo (concess√£o) e transferir uma grande quantidade de informa√ß√µes diferentes para o cliente.  Isso √© alcan√ßado devido ao procedimento menos trivial para obter o endere√ßo.  Se nos antigos protocolos o esquema era simples, do tipo de solicita√ß√£o-resposta, agora o esquema √© o seguinte: </p><br><ul><li>  O cliente procura o servidor com uma solicita√ß√£o de transmiss√£o, solicitando configura√ß√µes adicionais tamb√©m. </li><li>  O servidor responde ao cliente oferecendo um endere√ßo IP e outras configura√ß√µes. </li><li>  O cliente confirma as informa√ß√µes recebidas por solicita√ß√£o de transmiss√£o, indicando na confirma√ß√£o o endere√ßo IP do servidor selecionado. </li><li>  O servidor concorda com o cliente enviando um pedido, ap√≥s o recebimento do qual o cliente j√° configura a interface de rede ou a rejeita. </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b55/510/aa5/b55510aa54fa43c6b42e109826ec02a5.jpg"></p><br><p>  <em>O esquema de comunica√ß√£o do cliente com o servidor de encaminhamento e o servidor.</em> </p><br><p>  Voc√™ pode ler mais sobre o esquema de intera√ß√£o servidor-cliente e a estrutura de solicita√ß√µes e respostas, por exemplo, no material " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Estrutura, formato e finalidade dos pacotes DHCP</a> ". </p><br><blockquote>  Em v√°rias entrevistas, eles me perguntaram: "Que transporte e porta o DHCP usa?"  Por precau√ß√£o, respondemos: ‚ÄúServidor UDP: 67, cliente UDP: 68‚Äù. </blockquote><p>  Muitas implementa√ß√µes de um servidor DHCP foram encontradas por muitos, mesmo ao configurar uma rede dom√©stica.  De fato, agora o servidor √©: </p><br><ul><li>  Em quase qualquer roteador, especialmente SOHO. </li><li>  Nos sistemas Windows Server.  Voc√™ pode ler sobre o servidor e sua configura√ß√£o na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> oficial. </li><li>  Em sistemas * nix.  Talvez o software mais popular seja o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ISC DHCP Server</a> (dhcpd) e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dnsmasq</a> "harvester". </li></ul><br><p>  Existem muitas implementa√ß√µes espec√≠ficas, mas, por exemplo, as configura√ß√µes do servidor s√£o limitadas nos roteadores SOHO.  Isso se refere principalmente a configura√ß√µes adicionais, al√©m do cl√°ssico "endere√ßo IP, m√°scara, gateway, servidor DNS".  E s√£o precisamente essas op√ß√µes adicionais que causam maior interesse na opera√ß√£o do protocolo.  A lista completa pode ser encontrada na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC</a> correspondente, mas analisarei alguns exemplos interessantes. </p><br><h1 id="udivitelnye-opcii-dhcp">  Incr√≠veis op√ß√µes de DHCP </h1><br><p>  Nesta se√ß√£o, discutirei o uso pr√°tico das op√ß√µes de DHCP no equipamento MikroTik.  Imediatamente chamarei a aten√ß√£o para o fato de que nem todas as op√ß√µes est√£o definidas, obviamente, o formato dos par√¢metros √© descrito no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki</a> .  Tamb√©m deve ser observado que o cliente aplica as op√ß√µes somente quando ele solicita.  Em alguns servidores, voc√™ pode for√ßar o envio de configura√ß√µes: por exemplo, no ISC DHCP Server, a diretiva <strong><em>dhcp-parameter-request-list</em></strong> √© respons√°vel por isso e em Dnsmasq - * * - <strong><em>dhcp-option-force</em></strong> .  MikroTik e Windows n√£o sabem como. </p><br><p>  <strong>Op√ß√£o 6</strong> e <strong>Op√ß√£o 15.</strong> Vamos come√ßar com um simples.  O n√∫mero da configura√ß√£o 6 s√£o os servidores DNS atribu√≠dos aos clientes, 15 √© o sufixo DNS.  A atribui√ß√£o de um sufixo DNS pode ser √∫til ao trabalhar com recursos de dom√≠nio em uma rede que n√£o seja de dom√≠nio, como descrevi no artigo ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como reduzimos a equipe por Wi-Fi</a> ‚Äù.  Configure o MikroTik sob o spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Configurando o MikroTik, op√ß√£o 15</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  15.  ‚Äî   HEX . /ip dhcp-server option add code=15 name=dns-suffix value=0x57687920616c6c207468697320736869743f #   /ip dhcp-server option sets add name=dns option=dns-suffix #   DHCP-  . /ip dhcp-server network set [find comment="wi-fi client dhcp"] dhcp-option-set=dns</span></span></code> </pre> </div></div><br><p>  Saber que um servidor DNS tamb√©m √© uma op√ß√£o recentemente foi √∫til quando clientes diferentes tiveram que emitir servidores DNS diferentes.  A decis√£o do formul√°rio ‚Äúemitir um servidor e criar regras dst-nat diferentes para a porta 53‚Äù n√£o se encaixou por v√°rios motivos.  Parte da configura√ß√£o est√° novamente sob o spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Configurando o MikroTik, op√ß√£o 6</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ,  ,  ip    /ip dhcp-server option add code=6 name=google value="'8.8.8.8'" add code=6 name=cloudflare value="'1.1.1.1'" #  /ip dhcp-server lease add address=10.0.0.2 dhcp-option=google mac-address=11:11:11:11:11:11 server=dhcp add address=10.0.0.3 dhcp-option=cloudflare mac-address=22:22:22:22:22:22 server=dhcp</span></span></code> </pre></div></div><br><p>  <strong>Op√ß√£o 66</strong> e <strong>Op√ß√£o 67</strong> .  Essas configura√ß√µes voltaram do BOOTP e permitem especificar o servidor TFTP e a imagem para a inicializa√ß√£o da rede.  Para uma ramifica√ß√£o pequena, √© bastante conveniente instalar o Mikrotik e as esta√ß√µes de disco sem disco e lan√ßar uma imagem preparada de alguns <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ThinStation no roteador</a> .  Exemplo de configura√ß√£o do DHCP: </p><br><pre> <code class="bash hljs">/ip dhcp-server option add name=<span class="hljs-string"><span class="hljs-string">"option66"</span></span> code=66 value=<span class="hljs-string"><span class="hljs-string">"s'192.168.88.1'"</span></span> add name=<span class="hljs-string"><span class="hljs-string">"option67"</span></span> code=67 value=<span class="hljs-string"><span class="hljs-string">"'pxelinux.0'"</span></span> /ip dhcp-server option sets add name=<span class="hljs-string"><span class="hljs-string">"set-pxe"</span></span> options=option66,option67</code> </pre><br><p>  <strong>Op√ß√£o 121</strong> e <strong>Op√ß√£o 249</strong> .  Eles s√£o usados ‚Äã‚Äãpara transferir rotas adicionais para o cliente, o que, em alguns casos, pode ser mais conveniente do que registrar rotas no gateway padr√£o.  As configura√ß√µes s√£o quase id√™nticas, exceto que os clientes Windows preferem o √∫ltimo.  Para configurar o par√¢metro, as rotas devem ser convertidas em hexadecimal, coletando a m√°scara de rede de destino, o endere√ßo de rede e o gateway em uma linha.  Al√©m disso, pelo RFC, voc√™ deve adicionar uma rota padr√£o.  A op√ß√£o de ajuste est√° sob o spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Configura√ß√£o de rota</b> <div class="spoiler_text"><p>  Suponha que precisamos adicionar uma rota como dst-address = 10.0.0.0 / 24 gateway = 192.168.88.2 aos clientes, e o gateway principal ser√° 192.168.88.1.  Vamos trazer tudo isso em HEX: </p><br><div class="scrollable-table"><table><tbody><tr><td>  Dados de configura√ß√µes </td><td>  Dez </td><td>  Hex </td></tr><tr><td>  Mask </td><td>  24 </td><td>  0x18 </td></tr><tr><td>  Rede de destino </td><td>  10.0.0.0 </td><td>  0x0A 00 00 </td></tr><tr><td>  Gateway </td><td>  192.168.88.2 </td><td>  0xc0 a8 58 02 </td></tr><tr><td>  Rede padr√£o </td><td>  0.0.0.0/0 </td><td>  0x00 </td></tr><tr><td>  Gateway padr√£o </td><td>  192.168.88.1 </td><td>  0xc0 a8 58 01 </td></tr></tbody></table></div><br><p>  Vamos coletar toda essa felicidade em uma linha e obter a configura√ß√£o: </p><br><pre> <code class="bash hljs">/ip dhcp-server option add code=121 name=classless value=0x0A0000c0a8580200c0a85801</code> </pre></div></div><br><p>  Leia mais no artigo ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Mikrotik, rota sem classe DHCP</a> ‚Äù. </p><br><p>  <strong>Op√ß√£o 252.</strong> Configura√ß√£o autom√°tica do servidor proxy.  Se, por algum motivo, a organiza√ß√£o usar um proxy opaco, ser√° conveniente configur√°-lo com os clientes por meio de um arquivo wpad (pac) especial.  Um exemplo de configura√ß√£o desse arquivo √© descrito no material <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PAC (Proxy Auto Configuration)</a> .  Infelizmente, o MiroTik n√£o possui um servidor web embutido para hospedar esse arquivo.  Voc√™ pode usar o pacote de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hotspot</a> ou os recursos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">metarouter</a> para isso, mas √© melhor colocar o arquivo em outro lugar. </p><br><p>  <strong>Op√ß√£o 82</strong> .  Uma das op√ß√µes mais √∫teis n√£o √© apenas para o cliente, mas tamb√©m para a retransmiss√£o DHCP.  Permite transferir informa√ß√µes sobre a porta do switch √† qual o cliente est√° conectado e o ID do pr√≥prio switch.  Com base nessas informa√ß√µes, o servidor, por sua vez, j√° pode emitir um determinado conjunto de configura√ß√µes para o cliente ou simplesmente registr√°-lo - para encontrar a porta de conex√£o do cliente, n√£o era necess√°rio acessar todos os comutadores seguidos (especialmente se eles n√£o estiverem na pilha). </p><br><p>  Ap√≥s configurar o DHCP-Relay no roteador, os campos <strong>ID do circuito</strong> do <strong>agente</strong> e <strong>ID</strong> <strong>remoto do agente</strong> aparecer√£o nas informa√ß√µes do cliente, onde o primeiro √© o identificador da porta do switch e o segundo √© o identificador do switch. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9c3/350/fb7/9c3350fb7d11ac6f57f28c21eb58489f.jpg"></p><br><p>  <em>Emiss√£o de endere√ßos com a op√ß√£o 82.</em> </p><br><p>  As informa√ß√µes s√£o fornecidas em formato hexadecimal.  Por conveni√™ncia, voc√™ pode usar scripts para analisar o log do DHCP.  Por exemplo, uma solu√ß√£o para uma solu√ß√£o da Microsoft √© publicada na galeria de scripts do Technet, denominada ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Decorando as op√ß√µes de DHCP 82</a> ‚Äù. </p><br><p>  <strong>A op√ß√£o 82 tamb√©m √©</strong> usada ativamente no sistema de cobran√ßa de provedores e na prote√ß√£o da rede contra interfer√™ncias externas.  Isso √© um pouco mais detalhado. </p><br><h1 id="dobavim-seti-nadezhnosti-i-bezopasnosti">  Adicione redes de confiabilidade e seguran√ßa </h1><br><p>  Devido √† simplicidade do protocolo e √† presen√ßa de solicita√ß√µes de transmiss√£o, h√° ataques efetivos √† infraestrutura - principalmente do tipo MITM (‚Äúman in the middle‚Äù).  Os ataques s√£o realizados aumentando o servidor DHCP ou a retransmiss√£o: afinal, se voc√™ controla a emiss√£o das configura√ß√µes de rede, pode redirecionar facilmente o tr√°fego para um gateway comprometido.  Para facilitar o ataque, a priva√ß√£o de DHCP √© usada (fingindo ser um cliente ou uma retransmiss√£o, o atacante for√ßa o servidor DHCP "nativo" a esgotar seus endere√ßos IP).  Voc√™ pode ler mais sobre a implementa√ß√£o do ataque no artigo ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Atacando o DHCP</a> ‚Äù, enquanto o <strong>DHCP Snooping</strong> √© o m√©todo de prote√ß√£o. </p><br><p>  Essa √© uma fun√ß√£o de comutador que permite "ligar" um servidor DHCP a uma porta espec√≠fica.  As respostas DHCP em outras portas ser√£o bloqueadas.  Em alguns comutadores, voc√™ pode configurar o trabalho com a Op√ß√£o 82 quando for detectado no pacote (que indica a presen√ßa de um rel√©): descartar, substituir, deixar inalterado. </p><br><p>  Nos comutadores MikroTik, o DHCP Snooping √© ativado nas configura√ß√µes da ponte: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># dhcp-snooping  option 82 /interface bridge add name=bridge set [find where name="bridge"] dhcp-snooping=yes add-dhcp-option82=yes #    /interface bridge port add bridge=bridge interface=ether1 add bridge=bridge interface=ether2 trusted=yes</span></span></code> </pre><br><p>  A configura√ß√£o em outros comutadores √© semelhante. </p><br><blockquote>  Vale a pena notar que nem todos os modelos MikroTik t√™m suporte completo de hardware para DHCP Snooping - apenas o CRS3xx o possui. </blockquote><p>  Al√©m da prote√ß√£o contra hackers mal-intencionados, essa fun√ß√£o aliviar√° as dores de cabe√ßa quando outro servidor DHCP aparecer na rede - por exemplo, quando um roteador SOHO usado como um switch com um ponto de acesso redefine suas configura√ß√µes.  Infelizmente, nas redes em que o equipamento SOHO √© encontrado, nem sempre existe uma estrutura de rede a cabo competente com roteadores gerenciados.  Mas essa √© outra quest√£o. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/058/801/3c3/0588013c3a7595d350ee0f207dcd7b83.jpg"></p><br><p>  <em>Mudan√ßa bonita √© a chave para a sa√∫de.</em> </p><br><p>  Outros m√©todos de prote√ß√£o incluem <strong>Port Security</strong> ("vincular" um endere√ßo MAC espec√≠fico √† porta do roteador; se o tr√°fego de outros endere√ßos for detectado, a porta ser√° bloqueada), a <strong>an√°lise de</strong> tr√°fego para o n√∫mero de solicita√ß√µes e respostas DHCP ou limitar seu n√∫mero e, √© claro, v√°rios sistemas <strong>IPS \ IDS</strong> . </p><br><p>  Se falarmos n√£o apenas sobre prote√ß√£o de rede, mas tamb√©m sobre confiabilidade, n√£o ser√° inadequado mencionar os recursos do DHCP √† prova de falhas.  De fato, com sua simplicidade, o DHCP geralmente √© um dos principais servi√ßos e, se falhar, o trabalho da organiza√ß√£o pode ser paralisado.  Mas se voc√™ apenas instalar dois servidores com configura√ß√µes id√™nticas, nada al√©m de um conflito de endere√ßos IP levar√° a isso. </p><br><p>  Parece que voc√™ pode dividir a √°rea de distribui√ß√£o entre dois servidores e deixar um dar metade dos endere√ßos e o outro dar outro.  Aqui est√£o apenas uma metade paralisada da infraestrutura √© um pouco melhor que o todo. </p><br><p>  Analisaremos op√ß√µes mais pr√°ticas. </p><br><p>  Nos sistemas <strong>Windows Server a</strong> partir de 2012, o sistema de redund√¢ncia DHCP funciona imediatamente, no modo de balanceamento de carga (ativo-ativo) ou no modo de toler√¢ncia a falhas (ativo-passivo).  Uma descri√ß√£o detalhada da tecnologia e configura√ß√µes pode ser encontrada na <a href="">documenta√ß√£o</a> oficial.  Observo que a toler√¢ncia a falhas √© configurada no n√≠vel da zona, para que diferentes zonas possam funcionar em modos diferentes. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ced/b26/26d/cedb2626dd463700eed59152438a6a60.jpg"></p><br><p>  <em>Configurando o Failover do Servidor DHCP no Windows.</em> </p><br><p>  <strong>O ISC DHCP Server</strong> usa a diretiva de <strong><em>ponto de falha</em></strong> para configurar a toler√¢ncia a falhas; prop√µe-se sincronizar os dados independentemente - por exemplo, usando o rsync.  Leia mais no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dois servidores DHCP no Centos7 ...</a> " </p><br><p>  Se voc√™ criar uma solu√ß√£o tolerante a falhas com base no MikroTik, n√£o poder√° fazer isso sem truques.  Uma das op√ß√µes para solucionar o problema foi anunciada na MUM RU 18 e depois publicada no blog <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do autor</a> .  Resumindo: dois servidores est√£o configurados, mas com um par√¢metro de Delay Threshold diferente (atraso de resposta).  Em seguida, o servidor emitir√° o endere√ßo com menos atraso e com um atraso maior - somente quando o primeiro falhar.  A sincroniza√ß√£o de informa√ß√µes novamente deve ser feita com scripts. </p><br><p>  Pessoalmente, ao mesmo tempo, dei um tapinha nos meus nervos quando um roteador apareceu na rede "acidentalmente" e conectado √† rede local, tanto nas interfaces WAN quanto na LAN. </p><br><p>  <strong>Diga-me, voc√™ teve que lidar com a hansen√≠ase DHCP?</strong> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt467333/">https://habr.com/ru/post/pt467333/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt467317/index.html">Como o SoftBank engoliu o mundo</a></li>
<li><a href="../pt467323/index.html">Vis√£o geral dos recursos de programa√ß√£o do microcontrolador Qt Creator 4.10 e QBS 1.14</a></li>
<li><a href="../pt467327/index.html">Como me tornei programador aos 35 anos</a></li>
<li><a href="../pt467329/index.html">Os melhores produtos partem de problemas reais: interfone sobre trabalhos a serem realizados. Parte 1</a></li>
<li><a href="../pt467331/index.html">Venda + uma bela loja online no WordPress por US $ 269 "do zero" - nossa experi√™ncia</a></li>
<li><a href="../pt467335/index.html">Veja como atualizar o Node.js via Visual Studio, NPM, Windows / Mac</a></li>
<li><a href="../pt467337/index.html">O jogo para celular mais popular: como o "Snake" foi criado para celulares Nokia</a></li>
<li><a href="../pt467339/index.html">E, novamente, o 256¬∫ dia do ano</a></li>
<li><a href="../pt467343/index.html">Por que deixei o freelance: impress√µes do desenvolvedor de back-end ap√≥s 2 anos de "liberdade"</a></li>
<li><a href="../pt467345/index.html">Conhe√ßa os blogs de TI e 4 camadas de treinamento: uma entrevista com Sergei Abdulmanov, da Mosigra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>