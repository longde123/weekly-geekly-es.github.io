<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ñ üë®üèº‚Äçü§ù‚Äçüë®üèª üë®‚Äçüë©‚Äçüë¶ So integrieren Sie ReactJS in 1C-Bitrix mit der automatischen Generierung von Vorlagen im Back-End am Beispiel des Globus-Netzwerks üßïüèΩ üíÜüèº üåô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Jahr wurde ReactJS erstmals f√ºr den Online-Shop der Globus-Hypermarktkette eingef√ºhrt. Das Projekt ist insofern interessant, als es die Funk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So integrieren Sie ReactJS in 1C-Bitrix mit der automatischen Generierung von Vorlagen im Back-End am Beispiel des Globus-Netzwerks</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421531/"> In diesem Jahr wurde ReactJS erstmals f√ºr den Online-Shop der Globus-Hypermarktkette eingef√ºhrt.  Das Projekt ist insofern interessant, als es die Funktionen der Bitrix-Plattform erweitert und gleichzeitig die M√∂glichkeit beh√§lt, Seiten f√ºr Suchmaschinen zu generieren, und nicht mit doppelten Codes und Layouts √ºberf√ºllt ist.  In diesem Artikel wird erl√§utert, wie Sie Bitrix-Komponenten mit ReactJS-Komponenten mithilfe des v8js-Moduls f√ºr PHP verbinden und den vorderen Hauptteil der Site speichern. <br><a name="habracut"></a><br><h3>  Warum wurde das gebraucht? </h3><br>  Zun√§chst wurde die Logik der Website des Online-Shops auf der Bibliothek Marionette.js aufgebaut.  Vor einigen Jahren hat sich diese Logik ausgezahlt, aber im Laufe der Zeit sind die Gesch√§ftsanforderungen f√ºr die Front-End-Funktionalit√§t so stark gestiegen, dass jede Verfeinerung mit ernsthaften Schwierigkeiten einherging.  Aufgrund der hohen Belastung nahm die Geschwindigkeit des Vorderteils ab und lie√ü zu w√ºnschen √ºbrig.  Um dieses Problem zu l√∂sen, haben wir ReactJS gew√§hlt. Es gab jedoch ein Problem beim Rendern von Seiten im Back-End und beim Verkn√ºpfen von Teilen der Seiten, um auf Komponenten zu reagieren.  Gleichzeitig war unser Ziel ein schrittweiser √úbergang zu ReactJS, as  Dramatische √Ñnderungen k√∂nnten zu einer vollst√§ndigen Neugestaltung der Front f√ºhren. Infolgedessen fiel die Auswahl auf folgende Komponenten: <br><br><ul><li>  Produktkarten; </li><li>  Minikorb; </li><li>  Men√º </li></ul><br>  Die Hauptschwierigkeit beim √úbertragen von Minik√∂rben und Produktkarten an ReactJS war die sofortige Synchronisation der Warenmenge in beiden Komponenten, d. H.  Befinden sich 3 kg Karotten im Warenkorb, sollten im Block zum Hinzuf√ºgen von Waren zum Warenkorb (Kommissionierer) 3 kg angezeigt werden. Wenn sich die Warenmenge im Minikorb √§ndert, sollte die √Ñnderung im Kommissionierer erfolgen und umgekehrt.  Au√üerdem musste die Verz√∂gerung der Back-End-Anforderungen ausgeglichen werden, damit die Schnittstelle so schnell wie m√∂glich funktionierte. <br><br><img src="https://habrastorage.org/webt/zs/0-/4t/zs0-4tm2cptsxb_ertod4wohimm.png">  "" <br><br>  Eine zus√§tzliche Komplexit√§t war die Spezifit√§t des Gesch√§fts (Lebensmitteleinzelhandel), in dem das Konzept der st√ºckgewichteten Waren besteht.  Dies ist ein Produkt, das in kg angegeben wird, aber der Benutzer kauft es in St√ºcken, zum Beispiel eine Wassermelone, die der Kunde nicht teilweise, sondern nur vollst√§ndig kaufen kann.  Ein solches Produkt f√ºr den Benutzer sollte in der St√ºckzahl angezeigt werden, im Back-End wird es jedoch in Kilogramm angegeben. <br><br><h3>  Wie haben Sie das Problem gel√∂st? </h3><br>  Um das Layout der Komponenten in den Vorlagen des 1C-Bitrix- und React-Systems nicht zu duplizieren, wurde beschlossen, es auf den React-Komponenten zu platzieren.  Der Komponentenname in React sollte mit der 1C-Bitrix-Systemkomponentenvorlage √ºbereinstimmen.  Um solche Ideen umzusetzen, verwendeten wir: <br><br><ul><li>  V8js Modul f√ºr PHP; </li><li>  reactjs / react-php-v8js; </li><li>  Webpack. </li></ul><br>  Das erste Element ist das v8js-Modul, das unsere Reaktionskomponenten in ein statisches Layout in einer PHP-Umgebung konvertieren soll. <br><br>  Das Folgende ist eine kleine Bibliothek von React Community, einem Wrapper zur einfacheren React-Initialisierung in der js-Umgebung des v8js-Moduls. <br><br>  Und nat√ºrlich Webpack, wo ohne.  In Verbindung mit babel k√∂nnen Sie jsx-Vorlagen und den es6-Standard zum Schreiben von Code verwenden.  Alle Beispiele werden in es6-Syntax dargestellt.  Es ist ganz einfach, aber wenn es nicht sofort verstanden wird, sollten Sie Ihr Ged√§chtnis daf√ºr auffrischen. <br><br>  <i>V8js Modul f√ºr PHP.</i> <br><br>  Dieses Modul ist eine Erweiterung f√ºr PHP, mit der Sie die V8 Javascript Engine verwenden k√∂nnen, um JS-Code in PHP auszuf√ºhren.  Installiert ganz einfach, wie eine normale PECL-Erweiterung.  Die Hauptsache ist, dass Sie in Ihren Systembibliotheken und V8-Header-Dateien haben. <br><br>  <i>Webpack</i> <br><br>  Um die Bibliothek mit React- und React-Komponenten zu erstellen, verwenden wir das Webpack.  Die Montagedateien f√ºr Vorder- und R√ºckseite unterscheiden sich geringf√ºgig.  Wir gehen zu 3 Dateien: <br><br><ul><li>  initialize.js -&gt; app.js - Anwendung f√ºr die Front; </li><li>  reactServer.js -&gt; reactBuild.js - React-Bibliothek f√ºr die Serverseite; </li><li>  components.js -&gt; reactComponents.js - eine Sammlung von Reaktionskomponenten. </li></ul><br>  Der Hauptunterschied zwischen der Assembly f√ºr das Server-Rendering besteht darin, dass alle Bibliotheken und Komponenten in das globale Objekt eingef√ºgt werden m√ºssen und Bibliotheken √ºber die Funktion require verbunden sind.  Die Importrichtlinie funktioniert aus irgendeinem Grund nicht. <br><br>  Alle Quelldateien befinden sich im lokalen Verzeichnis / templates / &lt;Vorlagenname&gt; / src / <br><br><img src="https://habrastorage.org/webt/gg/vz/ck/ggvzckbgtq4g4jl9ftrgkr5ipnu.png"><br><br>  Im Stammverzeichnis des Projekts befinden sich die Einstellungen webpack.config.js - settings. <br><br><img src="https://habrastorage.org/webt/fd/2j/yk/fd2jykgbdtcbpwfjn11goi5s8xq.png"><br><br>  Der Inhalt der Baugruppendateien befindet sich am Ende des Artikels. <br><br>  Npm und die folgenden Pakete m√ºssen installiert sein: <br><br><ul><li>  babel; </li><li>  babel-cli; </li><li>  Webpack </li><li>  reagieren </li><li>  React-Dom; </li><li>  Unterstrich // optional. </li></ul><br>  Die Montage erfolgt durch Ausf√ºhren des Befehls: <br>  $ webpack. <br><br>  <i>Anpassung der Bitrix Template Engine</i> <br><br>  Um eine angepasste Engine im 1C-Bitrix-System zu registrieren, m√ºssen Sie ihre Einstellungen zur globalen Variablen $ arCustomTemplateEngines hinzuf√ºgen.  Im Schl√ºssel m√ºssen Sie den Code Ihres Motors angeben.  Wir haben "JSX" verwendet.  In den Werten m√ºssen Sie die Dateierweiterung der Vorlage angeben, die Funktion zum Rendern der Vorlage.  Es ist ratsam, eine Sortierung unter einem Wert von 100 anzugeben, damit die Priorit√§t unseres Motors √ºber dem Standard liegt. <br><br>  Erstellen Sie eine JSXEngine-Klasse mit den folgenden Methoden: <br><br><ul><li>  setEngine - registriere eine Vorlage; </li><li>  init - Initialisierung von v8js √ºber den Bibliotheks-Wrapper reactjs / react-php-v8js; </li><li>  execute - Template-Rendering-Funktionalit√§t </li></ul><br>  und eine Wrapper-Funktion zum Rendern der _JSXEngineExecute-Vorlage, weil  Das 1C-Bitrix-System erfordert die Registrierung einer bestimmten Funktion. <br><br>  Um nicht jedes Mal eine React-Instanz zu initialisieren, platzieren Sie sie in einer statischen Variablen und f√ºgen Sie eine Initialisierungsmethode hinzu. <br><br>  In der ReactJS-Klasse der Bibliothek reactjs / react-php-v8js ist eine spezielle Schnittstelle implementiert, um die React-Komponente zu rendern.  Der Klassenkonstruktor verwendet zwei Parameter als Eingabe, die den js-Code des Reaktionsmoduls und alle Reaktionskomponenten enthalten sollten, die in dem √ºber das Webpack gesammelten Projekt verwendet werden.  Nach der Initialisierung k√∂nnen wir sie rendern.  Rufen Sie dazu die setComponent-Methode zum Installieren der Komponente mit den Parametern des Komponentennamens und des Requisitenarrays auf.  Danach zeigt die Methode getMarkup den Inhalt der Komponente an, und getJS zeigt den js-Code zum Binden der Komponente an der Vorderseite an.  Die Methode getJS erfordert die Kennung des HTML-Blocks, in dem sich die Komponente in den Parametern befindet.  Zu diesem Zweck haben wir eine einfache Vorlage zum Umschlie√üen einer gerenderten Komponente in einen HTML-Block implementiert.  Die Einstellungen des Blocks selbst werden in eine JSON-Datei √ºbertragen, die in der 1C-Bitrix-Systemkomponentenvorlage abgelegt wird.  Die Einstellungen werden im JSON-Format gespeichert. <br><br><img src="https://habrastorage.org/webt/t7/fd/r3/t7fdr30zlxslwvouggmryh6bvgu.png"><br><br><img src="https://habrastorage.org/webt/6g/ng/op/6gngopga5l-r10z4zfqzkjjgmbw.jpeg"><br><br>  <i>√úbertragen Sie eine Komponente in eine neue Vorlage</i> <br><br>  Wir zeigen die √úbersetzung der Komponente in React am Beispiel einer Standardmen√ºkomponente.  Das Layout der Komponente wurde bereits in die Standardvorlagen-Engine integriert.  React empfiehlt eine Richtlinie zum Aufteilen der Funktionalit√§t in Komponenten.  Dar√ºber hinaus k√∂nnen die Komponenten sehr klein sein.  Bis zum Hyperlink-Tag.  Wir werden unser Men√º nicht auf solche Kleinigkeiten herunterbrechen, aber wir werden trotzdem eine kleine Zerlegung vornehmen. <br><br>  Unser Men√º verwendet Verschachtelung bis zu 3 Ebenen.  Daher ist es logisch, die Men√ºfunktionalit√§t in 3 Reaktionskomponenten pro Ebene zu unterteilen.  Wenn Sie genau hinschauen, werden Sie feststellen, dass die Men√ºpunkte der zweiten Ebene in zwei Spalten angeordnet sind.  Diese Funktionalit√§t sollte in eine zus√§tzliche Komponente eingef√ºgt werden. <br><br><img src="https://habrastorage.org/webt/y1/uy/fo/y1uyfohp9vilnly4xun9zkfe5pm.png"><br><br>  Somit haben wir 4 Komponenten.  Wir werden sie in den Dateien TopMenu.js, SubMenuLevel2.js, SubMenuLevel3.js, TwoColumnItem.js im Verzeichnis src / components ablegen (siehe den Code f√ºr andere Komponenten am Ende): <br><br><img src="https://habrastorage.org/webt/nt/80/bj/nt80bjgwhznbqv9ckuiursphqyw.png"><br><br>  Damit unsere Vorlage funktioniert, m√ºssen Sie eine Vorlage f√ºr die Men√ºkomponente des 1C-Bitrix-Systems erstellen.  Der Name der Vorlage muss mit dem Namen der Reaktionskomponente √ºbereinstimmen.  Innerhalb der Vorlage m√ºssen Sie die Datei mit der Erweiterung platzieren, die den Einstellungen unserer Engine entspricht.  In der Datei m√ºssen Sie den HTML-Knoten angeben, in dem unsere Reaktionskomponente gerendert wird. <br><br><h3>  Ergebnis </h3><br>  Mit dieser L√∂sung k√∂nnen Sie Reaktionskomponenten auf der Back-End-Seite und auf der Front-End-Seite verwenden.  Somit wird die Logik der Anzeige der Funktionalit√§t an einem Ort gespeichert, was die Unterst√ºtzung des Projekts erheblich erleichtert. <br><br>  Die Geschwindigkeit beim ersten Rendern von Seiten wurde um fast 1 Sekunde erh√∂ht.  Weil  Jetzt m√ºssen Sie das Hauselement, in dem sich die Komponente befindet, nicht neu zeichnen.  ReactJs nimmt es sofort auf.  Auch das Blinken von Elementen auf schwachen Ger√§ten verschwand. <br><br>  In Zukunft ist geplant, √ºber einen auf node.js basierenden Service auf das Rendern von Komponenten auf der Back-End-Seite umzusteigen und eine Einzelseitenanwendung zu implementieren, w√§hrend weiterhin Seiten f√ºr SEO generiert werden k√∂nnen. <br><br><h3>  App </h3><br>  initialize.js <br><br><img src="https://habrastorage.org/webt/s_/n2/mz/s_n2mz7lilpjjdadeg0ppctjlmk.png"><br><br>  components.js <br><br><img src="https://habrastorage.org/webt/gs/eo/m7/gseom7029c7ams6zdvaojkl894c.png"><br><br>  reactServer.js <br><br><img src="https://habrastorage.org/webt/bh/ne/ln/bhnelnigqxydigkiafpmoccwvwm.png"><br><br>  SubMenuLevel2.js <br><br><img src="https://habrastorage.org/webt/ep/7t/xa/ep7txacqkwh--ep9lealiucgves.png"><br><br>  SubMenuLevel3.js <br><br><img src="https://habrastorage.org/webt/8l/bo/oq/8lbooq9g6y2ivrt_sr7pti6eyzc.png"><br><br>  TwoColumnItems.js <br><br><img src="https://habrastorage.org/webt/lv/5s/bk/lv5sbkebar6j_yvdjwjv3s01nca.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de421531/">https://habr.com/ru/post/de421531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de421521/index.html">Monster nach den Ferien: AMD Threadripper 2990WX 32-Core und 2950X 16-Core (Teil 3 - Tests)</a></li>
<li><a href="../de421523/index.html">Einheit: Skriptf√§hige Objekte kennenlernen</a></li>
<li><a href="../de421525/index.html">Ein wenig √ºber die Unterschiede zwischen russischen und ausl√§ndischen Gastgebern</a></li>
<li><a href="../de421527/index.html">Broadcast-Start des Projekts "Server in the Clouds"</a></li>
<li><a href="../de421529/index.html">Netflix, Uber, Google und Sie bei MBLT DEV 2018</a></li>
<li><a href="../de421533/index.html">Auswahl einer Programmiersprache: 3 Tipps von einem Programmierer von Apple</a></li>
<li><a href="../de421535/index.html">Abenteuer - Elektronik. Auf einer gefl√ºgelten Schaukel in der IT-Welt</a></li>
<li><a href="../de421537/index.html">Funktionen h√∂herer Ordnung in JS: Young Fighter Course</a></li>
<li><a href="../de421543/index.html">Klonen Sie eine kontaktlose Karte mit einer mobilen Anwendung</a></li>
<li><a href="../de421545/index.html">Testbericht zum PocketBook 616 - dem preisg√ºnstigsten Taschenbuch f√ºr 2018 mit Hintergrundbeleuchtung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>