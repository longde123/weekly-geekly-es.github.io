<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüé§ üíÄ üöá Verwenden von Unity3D in einer nativen iOS / Android-Anwendung zum Modellieren der Beleuchtung von Freifl√§chen ü§≤üèΩ üëΩ ‚åöÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unity3D ist eine bekannte 3D- und 2D-Spieleentwicklungsplattform, die weltweit an Popularit√§t gewonnen hat. Gleichzeitig beschr√§nken sich seine Funkti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verwenden von Unity3D in einer nativen iOS / Android-Anwendung zum Modellieren der Beleuchtung von Freifl√§chen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/simbirsoft/blog/417779/"><img src="https://habrastorage.org/webt/ac/6n/is/ac6nistgzfsvyyhyj3wqngoiak4.png" alt="Bild"><br><br>  Unity3D ist eine bekannte 3D- und 2D-Spieleentwicklungsplattform, die weltweit an Popularit√§t gewonnen hat.  Gleichzeitig beschr√§nken sich seine Funktionen nicht nur auf die Entwicklung von Spieleanwendungen, sondern eignen sich auch f√ºr den Einsatz in anderen Bereichen, in denen plattform√ºbergreifende Anwendungen f√ºr die Arbeit mit Grafiken erstellt werden m√ºssen.  In diesem Artikel werden wir √ºber die Erfahrungen mit Unity3D sprechen, um ein System zur Berechnung der Beleuchtung offener R√§ume zu entwickeln. <br><a name="habracut"></a><br>  Das Unternehmen, mit dem wir zusammengearbeitet haben, ist das internationale Beleuchtungsunternehmen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BOOS LIGHTING GROUP</a> .  Um die Attraktivit√§t seiner Produkte zu erh√∂hen und die Interaktion mit Kunden zu vereinfachen, musste eine Anwendung entwickelt werden, mit der Sie den Standort von Beleuchtungsger√§ten visuell simulieren, Beleuchtungsberechnungen durchf√ºhren und die erforderlichen technischen Informationen im Bericht anzeigen k√∂nnen.  Es wurde angenommen, dass die Anwendung von einem potenziellen Kunden oder Vertriebsmitarbeiter auf einem iPad oder Android-Tablet gestartet wurde und dem Kunden erm√∂glicht, sich sofort ein Bild √ºber die M√∂glichkeit von Beleuchtungsinstallationen zu machen. <br><br>  Die Arbeiten wurden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">schrittweise</a> auf der Grundlage der von der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BOOS LIGHTING GROUP</a> Corporation entwickelten Spezifikation von Anforderungen und Konsultationen zum Thema des Projekts durchgef√ºhrt. <br><br>  Im Allgemeinen ist die Anwendung ein Editor, mit dem Sie Beleuchtungselemente, Stra√üen und dekorative Elemente hinzuf√ºgen und bearbeiten, eine lichttechnische Berechnung der Szene durchf√ºhren und einen Bericht im PDF-Format anzeigen k√∂nnen.  Jedes Element verf√ºgt √ºber eigene Parameter f√ºr die Bearbeitung und Untertypen, die sich auf die Anzeige und Berechnung auswirken. <br><br><ul><li>  Es gibt verschiedene Arten von Beleuchtungsmasten mit verschiedenen Arten von Leuchten, Neigungswinkeln von Lampen und Verl√§ngerungsl√§ngen.  Bei bestimmten Leuchtentypen ist eine individuelle Einstellung mit Angabe der Beleuchtungsrichtung m√∂glich. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2o/ci/da/2ocida45cxhpgpekhtfat_mc_6y.png" width="70%" alt="Bild"></div></li><li>  Stra√üen k√∂nnen lineare Abschnitte, Bogenelemente, Fl√§chen oder Ringe sein.  F√ºr jedes Element k√∂nnen Abmessungen, Position, Layouttyp und Ebene angepasst werden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s1/3s/lx/s13slxoinkzba4yyljw518pqw78.png" alt="Bild" width="70%"></div></li><li>  Dekorative Elemente - Autos, B√§ume, B√ºsche, Verkehrszeichen </li></ul><br>  Alle Elemente der Szene k√∂nnen gedreht und verschoben werden.  Standardaktionen zum Zur√ºcksetzen oder erneuten Versuchen werden ebenfalls unterst√ºtzt.  Mit den allgemeinen Einstellungen des Projekts k√∂nnen Sie die Textur des Dorg, die Erdoberfl√§che und die Anzeige zus√§tzlicher Parameter festlegen.  Die Szene wird im 2D / 3D-Modus angezeigt.  Bei der Berechnung der Beleuchtung auf der Oberfl√§che wird eine Karte der Beleuchtung der Oberfl√§che in fiktiven Farben angezeigt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ac/6n/is/ac6nistgzfsvyyhyj3wqngoiak4.png" width="100%" alt="Bild"></div><br><br>  Wenn m√∂glich, sollte die gesamte Benutzeroberfl√§che mit nativen iOS / Android-Tools erstellt werden. <br>  Die wichtigste technische Anforderung f√ºr die Anwendung besteht darin, die B√ºhnenbeleuchtung gem√§√ü den technischen Spezifikationen der Leuchten berechnen zu k√∂nnen.  Erforderlich war auch die F√§higkeit jedes Ger√§ts, sein Strahlungsmuster (Lichtintensit√§tskurven) im 3D / 2D-Modus anzuzeigen und anzuzeigen. <br><br><h4>  Plattformauswahl </h4><br>  Um das Projekt zu implementieren, haben wir Unity als bequemer f√ºr die Implementierung der erforderlichen Funktionalit√§t ausgew√§hlt.  Im Allgemeinen hatte unser Unternehmen Erfahrung mit anderen 3D-Engines und -Plattformen (OpenSceneGraph, Ogre3D, LibGdx) und technisch k√∂nnen sie alle die erforderliche Aufgabe bew√§ltigen. Diesmal fiel die Wahl jedoch auf Unity, was die Verwaltung der Szene w√§hrend der Entwicklung und des Debugs erleichtert im Prozess der Arbeit. <br><br><h4>  Die Hauptschwierigkeiten </h4><br>  Wir werden nicht auf die Feinheiten der Entwicklung der gesamten Anwendung eingehen, da die Funktionalit√§t zum Anzeigen und Bearbeiten der Szene technisch gesehen Standard ist.  Nat√ºrlich gab es Schwierigkeiten mit den Mechanismen der spezifischen Bearbeitung von Objekten, dem Hinzuf√ºgen und L√∂schen von Objekten sowie dem Speichern einer Befehlskette f√ºr die M√∂glichkeit, Aktionen zu wiederholen und abzubrechen. <br>  Wir m√∂chten uns nur mit den Funktionen des Systems befassen, die mit der Arbeit mit der nativen Benutzeroberfl√§che, der Erstellung von PDF-Berichten und der Arbeit mit Photometrie- und Beleuchtungsberechnungen zusammenh√§ngen. <br><br><h4>  Arbeiten Sie mit der nativen Benutzeroberfl√§che </h4><br>  In den meisten F√§llen interagiert Unity mithilfe des Plug-In-Systems mit den nativen Funktionen des Systems, sodass Sie die gew√ºnschten Funktionen in die Anwendung einbetten k√∂nnen.  In unserem Fall ist die Situation jedoch etwas anders.  Wir mussten eine vollst√§ndige Benutzeroberfl√§che √ºber dem Unity-Fenster anzeigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4z/0s/41/4z0s41r48kbp8cuzxnc7naj6l3i.png" width="70%" alt="Bild"></div><br><br>  Gl√ºcklicherweise kann Unity ein Projekt exportieren, das als Grundlage f√ºr eine native Anwendung verwendet werden kann.  Die Hauptschwierigkeit in diesem Fall besteht darin, eine zus√§tzliche Benutzeroberfl√§che in das resultierende Projekt zu integrieren.  Ebenso wichtig ist es, dass beim Zusammenstellen eines Unity-Projekts dessen Format und Speicherort von Unity gebildet und teilweise neu geschrieben werden, was die M√∂glichkeit zum √Ñndern des Projekts einschr√§nkt. <br><br>  Bei der Entwicklung einer iOS-Anwendung haben wir den im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> vorgeschlagenen Mechanismus verwendet.  W√§hrend der Entwicklung wurde Unity 5.5 verwendet, und im Moment kann das, was darin angegeben ist, an Relevanz verlieren.  Beim Zusammenstellen des Android-Projekts traten keine zus√§tzlichen Probleme auf, mit der Ausnahme, dass Unity die Manifestdatei und die Ressourcendateien jedes Mal √ºberschreibt. <br>  Ein weiteres Problem ist, dass Unity nur in einem Fenster arbeiten kann.  Gleichzeitig mussten wir sicherstellen, dass Unity die gesamte Szene anzeigt, und beim √ñffnen des Einstellungsfensters sollte ein 3D-Modell des photometrischen K√∂rpers der Lampe angezeigt werden.  Um dies zu erreichen, musste ich einen ‚ÄûHack‚Äú verwenden und dasselbe UIView-Objekt in verschiedenen Fenstern verwenden. <br><br>  Zum Senden von Nachrichten haben wir die von Unity angebotene Standardfunktionalit√§t verwendet.  Das hei√üt, alle Nachrichten waren im JSON-Format und wurden in einfachen Zeilen √ºbertragen.  Dies f√ºhrte zu keinen Leistungseinschr√§nkungen, da die Gr√∂√üe der Nachrichten maximal 100 Zeichen erreichte und ihre H√§ufigkeit durch die Geschwindigkeit des Programms bestimmt wurde.  Gleichzeitig ist es in anspruchsvolleren Anwendungen sinnvoll, einen eigenen Nachrichtenhandler zu erstellen, wie er <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> auf dem Haber dargestellt wird. <br><br><h4>  Beleuchtungsberechnung </h4><br>  Alle in der Anwendung verwendeten Lichtquellen werden im Standard- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">IES-</a> Format geliefert, das die Verteilung des Lichts in verschiedene Richtungen beschreibt ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spezifikation</a> ).  Dieses Format wird h√§ufig in professionellen CAD-Systemen und 3D-Editoren verwendet.  Es ist eine Textdatei, die die Lichtintensit√§t in verschiedene Richtungen und zus√§tzliche Metainformationen angibt, die den Typ, die Gesamtintensit√§t der Quelle, die Achsen und Symmetrieebenen angeben.  Aufgrund der Symmetrie der Ger√§te kann die ies-Datei sehr klein sein.  Beispielsweise reicht es bei axialer Symmetrie aus, die Lichtspur nur in einer Ebene anzuzeigen. <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel einer einfachen IES-Datei</b> <div class="spoiler_text"><pre><code class="plaintext hljs">IESNA91[TEST] Simple demo intensity distribution [MANUFAC] Lightscape Technologies, Inc. TILT=NONE 1 -1 1 8 1 1 2 0.0 0.0 0.0 1.0 1.0 0.0 0.0 5.0 10.0 20.0 30.0 45.0 65.0 90.0 0.0 1000.0 1100.0 1300.0 1150.0 930.0 650.0 350.0 0.0</code> </pre> <br></div></div><br>  Zur Anzeige des Strahlungsmusters wurden zwei Arten der Anzeige verwendet: <br><br><ul><li>  Lichtintensit√§tskurven (KSS) ist ein zweidimensionales Diagramm, das die Lichtintensit√§t in einer der Hauptebenen in Abh√§ngigkeit von der Richtung zeigt.  Der Einfachheit halber kann dieser Graph sowohl im polaren als auch im kartesischen Koordinatensystem dargestellt werden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/df/89/xc/df89xcesta0qlw4jcyuxpbihmyi.png" width="100%" alt="Bild"></div></li><li>  Photometrischer K√∂rper - ein dreidimensionales Bild der Lichtintensit√§t in verschiedene Richtungen <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/su/1s/if/su1sifzigs4cwuy-jg6bhpni79o.png" width="100%" alt="Bild"></div></li></ul><br><h4>  Berechnungsmodul </h4><br>  Um die Beleuchtung zu berechnen, hatte der Kunde sein eigenes C ++ - Modul, das in anderen Produkten des Unternehmens verwendet wurde, und musste es daher in das Unity-Projekt integrieren.  Die Reihenfolge der Modulverbindungen unterschied sich von der verwendeten Plattform. <br><br><ul><li>  Auf der iOS-Plattform kann Unitu C-Funktionen direkt aufrufen. Kopieren Sie einfach den Quellcode des Moduls direkt in das Projekt und f√ºgen Sie Klassen f√ºr die Interaktion mit Unity hinzu.  Klassen k√∂nnen sowohl direkt im iOS-Projekt als auch im Plugins-Ordner gespeichert werden, die beim Exportieren des Projekts nach Xcode automatisch kopiert werden.  Ein Beispiel f√ºr den Aufruf von C ++ - Funktionen lautet wie folgt: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DllImport(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"__Internal"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateLight</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[MarshalAs(UnmanagedType.LPArray, SizeParamIndex = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">)] Light[] lights, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> size, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">ref</span></span></span><span class="hljs-function"> CalculationResult result)</span></span>;</code> </pre> </li><li>  Auf der Android-Plattform muss das C ++ - Modul in eine separate Bibliothek vorkompiliert werden.  Dies kann direkt erfolgen, indem dem Projekt C ++ - Quellen hinzugef√ºgt und gradle eingerichtet werden, um sie in solchen Bibliotheken zu erstellen. </li><li>  Zum Debuggen und Testen des Unity-Teils wurde die Entwicklung auf einem Windows-Computer durchgef√ºhrt, sodass der Quellcode des Moduls auch in Windows verbunden werden musste.  Dies geschieht √§hnlich wie beim Android-Projekt, nur dass in diesem Fall die heruntergeladenen Dateien in der DLL-Bibliothek gesammelt und mit dem Projekt verbunden werden. </li></ul><br><h4>  Leichte Kartenanzeige </h4><br>  Auf Wunsch des Kunden sollten die Ergebnisse der Beleuchtungsberechnung auf der Oberfl√§che der Szene angezeigt werden.  Auf der Oberfl√§che von Stra√üen ist es notwendig, fiktive Farben mit der Anzeige einer Skala zur Anpassung von Farbe und Lichtintensit√§t zu verwenden, und auf dem Rest der Oberfl√§che ist es ausreichend, nur die Helligkeit anzuzeigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/18/5q/k9/185qk9lbx4fsoq3ax0miaedzjkm.png" width="70%" alt="Bild"></div><br><br>  Wie bereits erw√§hnt, wurde die gesamte Berechnung von einem C ++ - Plug-In durchgef√ºhrt, an das Daten zu Farbquellen √ºbertragen wurden.  Das Ergebnis der Berechnung war eine zweidimensionale Anordnung der Lichtintensit√§t √ºber die gesamte Oberfl√§che der Szene mit einem bestimmten Detail. <br><br>  Die resultierende Bestrahlungsst√§rkekarte wurde auf den minimalen, maximalen Wert analysiert, mit dem eine eindimensionale Gradiententextur (GradientRamp) erstellt wurde.  Unter Verwendung dieser Textur wurde die Lichtintensit√§t direkt im Fragment-Shader in fiktive Farben umgewandelt.  Zur gleichen Zeit wurde der gleiche Shader f√ºr verschiedene Stra√üenoberfl√§chen und die Erdoberfl√§che verwendet, und das Umschalten des Beleuchtungsmodus wurde unter Verwendung des " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Multi-Compile</a> " -Shaders bereitgestellt. <br><br><h4>  Generierung von PDF-Dateien </h4><br>  In √úbereinstimmung mit den technischen Anforderungen sollte f√ºr den Benutzer ein Bericht erstellt werden, der Informationen √ºber die allgemeine Szene (Abmessungen, Bilder, Beleuchtungsparameter) und Informationen zu jedem verwendeten Leuchtentyp enth√§lt und deren Position, Richtung der Eigenschaften sowie KCC-Diagramme und die Anzeige des photometrischen K√∂rpers angibt. <br>  Da der Bericht sowohl auf iOS als auch auf Android angezeigt werden sollte, musste der Bericht direkt im Unity-Modul generiert und anschlie√üend mit nativen Standardtools angezeigt werden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/aw/fo/je/awfojewyanvogdxu6sihv6zr-i8.png" alt="Bild"></div><br>  Um PDF zu erstellen, wurde die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">iTextSharp-</a> Bibliothek ausgew√§hlt, die unseren Anforderungen entspricht.  Das Erstellen eines Berichts darin ist nicht besonders schwierig und besteht darin, Textbl√∂cke, Tabellen und Bilder direkt aus dem Code zu erstellen.  W√§hrend der Entwicklung waren wir jedoch mit vielen Nuancen konfrontiert, deren L√∂sung manchmal erhebliche Anstrengungen erforderte.  Das Hauptproblem war der Start der Berichterstellung im Hintergrundthread. <br><br>  Wenn beim Testen auf einem Desktop-Computer die PDF-Generierung in der Gr√∂√üenordnung von mehreren Sekunden lag, erreichte diese Zeit beim Testen auf dem iPad mini 3 leicht 1-3 Minuten.  Nat√ºrlich musste die Erstellung des Berichts in einen separaten Thread √ºbertragen werden, um Probleme mit der Unterbrechung der Schnittstelle zu vermeiden.  Im allgemeinen Fall ist dies kein Problem, dies ist jedoch nicht der Fall, wenn Unity verwendet wird, bei dem die Verwendung der Unity-API von au√üerhalb des Hauptthreads ausdr√ºcklich untersagt ist.  Gleichzeitig mussten wir f√ºr den Bericht mindestens das CSS und das Szenenbild rendern, was nur aus dem Hauptstrom erfolgen sollte. <br><br>  Um den Bericht zu erstellen, m√ºssen wir die Aufgaben in einer bestimmten Reihenfolge ausf√ºhren. Gleichzeitig k√∂nnen einige von ihnen im Hintergrundthread arbeiten, und ein Teil muss im Hauptthread gestartet werden. <br><br>  Um dieses Problem zu l√∂sen, k√∂nnen Sie auf den ersten Blick versuchen, den Standardmechanismus zu verwenden und jede Operation in einer separaten Coroutine auszuf√ºhren.  Dies erspart uns jedoch nicht das Problem des Bremsens der Schnittstelle.  Wie Sie wissen, arbeiten Coroutinen im Hauptthread und sind nicht f√ºr langsame Operationen geeignet.  Gleichzeitig erfordern viele Vorg√§nge beim Erstellen eines Berichts viel Zeit, und daher k√∂nnen Coroutinen nicht zur L√∂sung unseres Problems beitragen. <br><br><h4>  UniRx </h4><br>  Eine andere L√∂sung besteht darin, den Code in einen Teil aufzuteilen, der im Hauptthread arbeiten muss, und einen Teil, der in einem separaten Thread ausgef√ºhrt werden kann.  In diesem Fall k√∂nnen beispielsweise Bilder mithilfe des Coroutine-Mechanismus erstellt und anschlie√üend in einem separaten Stream in den Bericht eingebettet werden.  In diesem Fall m√ºssen jedoch irgendwo Zwischenergebnisse gespeichert werden, wodurch die Menge des verwendeten Speichers oder der freie Speicherplatz auf dem Ger√§t zus√§tzlich eingeschr√§nkt wird. <br><br>  In unserer Anwendung haben wir es vorgezogen, den direkten Weg zu gehen und Aufgaben nacheinander im Haupt- oder im Hintergrund-Thread auszuf√ºhren.  Das einzige Problem bestand darin, einen solchen Start von Aufgaben zu organisieren, um nicht in diesem Durcheinander h√§ngen zu bleiben und Vorg√§nge korrekt zu synchronisieren. <br>  Eine wichtige Hilfe bei der L√∂sung dieses Problems war die Verwendung von Rx, seiner Verk√∂rperung als kostenloses UniRx- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Asset</a> , das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> auf dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hub</a> bereits ausf√ºhrlich beschrieben wurde. <br><br>  Die Verwendung hat die Interaktion zwischen Threads erheblich vereinfacht. Das folgende Beispiel zeigt, dass Sie mehrere Methoden in strikter Reihenfolge, jedoch in unterschiedlichen Threads ausf√ºhren k√∂nnen <br><br><div class="spoiler">  <b class="spoiler_title">Codebeispiel</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initializer = Observable.FromCoroutine(initMethod); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> heavyMethod1 = Observable.Start(() =&gt; doHardWork()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mainThread1 = Observable.FromCoroutine(renderImage); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> heavyMethod2 = Observable.Start(() =&gt; doHardWork2()); initializer.SelectMany(heavyMethod1) .SelectMany(mainThread1) .SelectMany(heavyMethod2) .ObserveOnMainThread() .Subscribe((x) =&gt; done()) .AddTo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  In diesem Beispiel wird die Methode doHardWork () nacheinander im Hintergrundthread ausgef√ºhrt.  Nach Abschluss wird renderImage () im Hauptthread gestartet und danach wird doHardWork2 () im Hintergrundthread erneut ausgef√ºhrt. <br></div></div><br>  Es ist auch erw√§hnenswert, dass bei der Analyse der Berichtserstellung auf Leistung festgestellt wurde, dass der langsamste Teil die Implementierung von Bildern im Bericht ist.  Eine Suche im Internet hat gezeigt, dass wir nicht die einzigen sind, die mit diesem Problem konfrontiert sind, aber es gab keine geeignete L√∂sung f√ºr uns.  Wir mussten die Bildqualit√§t leicht auf ein akzeptables Ma√ü reduzieren, was zu einer Geschwindigkeitssteigerung von 20-40% f√ºhrte. <br><br>  So war es in der von uns erstellten Anwendung m√∂glich, die Unity-Grafik-Engine erfolgreich in die native iOS / Android-Anwendung einzuf√ºhren.  Dies unterscheidet sich vom herk√∂mmlichen Ansatz, wenn Unity der Hauptteil der Anwendung ist und die spezifischen Eigenschaften des Systems √ºber das Plug-In-System ber√ºcksichtigt werden.  Gleichzeitig kann unser Ansatz n√ºtzlich sein, wenn Sie eine komplexe native Oberfl√§che entwickeln m√ºssen, in die Sie nicht triviale 3D-Grafiken einbetten m√∂chten. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de417779/">https://habr.com/ru/post/de417779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de417769/index.html">User Memory Design: Wie man f√ºr Alter entwirft</a></li>
<li><a href="../de417771/index.html">ICANN-Plan: Corporation bietet neues DNS-Root-Server-Verwaltungsmodell an</a></li>
<li><a href="../de417773/index.html">Selbstgemachtes OpenPnP-Komponenteninstallationsprogramm</a></li>
<li><a href="../de417775/index.html">Bitcoin-Provisionsmechanismus und warum mit Bergleuten befreundet sein</a></li>
<li><a href="../de417777/index.html">Wochenendlesung: 25 Materialien f√ºr Vinyl-Anf√§nger</a></li>
<li><a href="../de417781/index.html">Die NASA-Sonde ‚Äûber√ºhrt‚Äú die Sonne - und schmilzt nicht</a></li>
<li><a href="../de417783/index.html">In Python verwendete Optimierungen: Liste und Tupel</a></li>
<li><a href="../de417785/index.html">Welcher Systemadministrator tr√§umt nicht von seinem Outsourcing-Unternehmen?</a></li>
<li><a href="../de417787/index.html">Meine Berufserfahrung zur Rolle des agilen Coach in Europa, Teil 1</a></li>
<li><a href="../de417789/index.html">Diskussionen √ºber Telekommunikationsaussichten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>