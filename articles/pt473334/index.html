<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ûüèª üîí ü•¶ Cat Ghonim: Como fazer com que os gatos n√£o se aliviem no gramado em casa? ‚õπÔ∏è ‚ôüÔ∏è üåú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Havia Robert Bond, um programador de 65 anos da Calif√≥rnia. E ele tinha uma esposa de jardinagem que amava muito o gramado limpo. Mas aqui √© a Calif√≥r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cat Ghonim: Como fazer com que os gatos n√£o se aliviem no gramado em casa?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/473334/"> Havia Robert Bond, um programador de 65 anos da Calif√≥rnia.  E ele tinha uma esposa de jardinagem que amava muito o gramado limpo.  Mas aqui √© a Calif√≥rnia, n√£o h√° cercas de dois metros com um sistema de prote√ß√£o para gatos.  Gatos vizinhos andam no gramado e porcaria! <br><br><img src="https://habrastorage.org/webt/ee/li/u5/eeliu5qcoz1urdayl5mvncwbjzo.jpeg"><br><br>  O problema tinha que ser resolvido.  Como Robert decidiu isso?  Ele comprou ferro no computador, conectou uma c√¢mera de vigil√¢ncia externa olhando para o gramado e, em seguida, fez algo incomum: baixou o software Open Source gratuito dispon√≠vel - uma rede neural e come√ßou a trein√°-la para reconhecer gatos na imagem da c√¢mera.  E a tarefa no come√ßo parece trivial, porque se voc√™ aprende algo e √© f√°cil, √© para gatos, porque os gatos est√£o cheios de lixo na Internet, existem dezenas de milh√µes deles.  Se tudo fosse t√£o simples, mas as coisas est√£o piores, na vida real, os gatos costumam cagar principalmente √† noite.  Praticamente n√£o h√° fotos de gatos noturnos fazendo xixi no gramado na Internet.  E alguns gatos at√© conseguem beber do sistema de irriga√ß√£o durante o trabalho, mas ainda o despejam. <br><br><img src="https://habrastorage.org/webt/0i/uw/_p/0iuw_pgxfmlmkw_w-ztq2t_hbls.jpeg"><a name="habracut"></a><br><br>  Abaixo, fornecemos uma descri√ß√£o do projeto do autor, a vers√£o em ingl√™s pode ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">encontrada aqui</a> . <br><br>  Esse projeto foi motivado por duas coisas: o desejo de aprender mais sobre o software de rede neural e o desejo de incentivar os gatos vizinhos a sair em outro lugar al√©m do meu gramado. <br><br>  O projeto inclui apenas tr√™s componentes de hardware: a placa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nvidia Jetson TX1</a> , a c√¢mera IP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Foscam FI9800P</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Particle Photon</a> conectado ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rel√©</a> .  A c√¢mera est√° montada na lateral da casa, na lateral do gramado.  Ela entra em contato com o ponto de acesso WI-FI, seguido por Jetson.  O f√≥ton de part√≠culas e os rel√©s s√£o instalados na unidade de controle do meu sistema de irriga√ß√£o e conectados a um ponto de acesso WI-FI na cozinha. <br><br>  No processo, a c√¢mera est√° configurada para monitorar as altera√ß√µes no quintal.  Quando algo muda, a c√¢mera transmite um conjunto de 7 imagens para a Jetson, uma por segundo.  O servi√ßo da Jetson rastreia as imagens recebidas, transferindo-as para a rede neural de treinamento profundo da Caffe.  Se a rede detectar um gato, Jetson sinaliza para o servidor Particle Photon na nuvem, que envia uma mensagem para o Photon.  O Photon responde ligando os aspersores por dois minutos. <br><br>  Aqui o gato entrou no quadro, ligando a c√¢mera: <br><br><img src="https://habrastorage.org/webt/db/yb/o6/dbybo6fzxy4rfhhqpcuqkr0q02q.jpeg"><br><br>  Depois de alguns segundos, o gato entrou no meio do quintal, ligando a c√¢mera novamente e ativou os aspersores do sistema de irriga√ß√£o: <br><br><img src="https://habrastorage.org/webt/oy/44/b2/oy44b223ivw14to9lca8bxwfbhc.jpeg"><br><br><h3>  Instala√ß√£o da c√¢mera </h3><br>  N√£o havia nada incomum em instalar uma c√¢mera.  A √∫nica conex√£o permanente √© uma conex√£o com fio de 12 volts que passa por um pequeno orif√≠cio sob a borda.  Montei a c√¢mera em uma caixa de madeira para capturar o jardim da frente com um gramado.  Um monte de fios est√£o conectados √† c√¢mera, que eu escondi em uma caixa. <br><br>  Siga as instru√ß√µes da Foscam para associ√°-lo ao AP da Jetson (veja abaixo).  Na minha configura√ß√£o, o Jetson est√° em 10.42.0.1.  Atribuai um endere√ßo IP fixo de 10.42.0.11 √† c√¢mera para que fosse f√°cil encontr√°-la.  Feito isso, conecte o laptop Windows √† c√¢mera e configure o par√¢metro "Warning" para ativar a altera√ß√£o.  Configure o upload de 7 imagens via FTP por aviso (alerta).  Em seguida, forne√ßa o ID do usu√°rio e a senha no Jetson.  Minha c√¢mera envia imagens de 640x360 via FTP para o diret√≥rio inicial. <br><br>  Abaixo voc√™ pode ver os par√¢metros que foram selecionados para a configura√ß√£o da c√¢mera. <br><br><img src="https://habrastorage.org/webt/zu/mn/uq/zumnuqz05cz7nq1mvf_jsid-xi0.jpeg"><br><br><h3>  Configurando o Particle Photon </h3><br>  Photon foi f√°cil de configurar.  Coloquei na unidade de controle de irriga√ß√£o. <br><br><img src="https://habrastorage.org/webt/vr/v4/hg/vrv4hg7qfnd1cctippafwmihbp4.jpeg"><br><br>  A caixa preta √† esquerda com o LED azul √© um conversor de 24 V CA (5 V) convertido em 5 V CC (CC), adquirido no eBay.  Voc√™ pode ver o rel√© branco na placa de rel√©s e o conector azul na frente.  O pr√≥prio f√≥ton est√° √† direita.  Ambos s√£o colados a um peda√ßo de papel√£o para mant√™-los unidos. <br><br>  A sa√≠da de 5 V do conversor est√° conectada ao conector Particle Photon VIN.  A placa do rel√© √© basicamente anal√≥gica: possui um transistor NPN de coletor aberto com uma entrada nominal de 3,3 V para a base do transistor e um rel√© de 3 V.  O controlador de f√≥tons n√£o podia fornecer corrente suficiente para controlar o rel√©, ent√£o conectei o coletor da entrada do transistor a 5 V atrav√©s de um resistor com uma resist√™ncia de 15 Ohms e uma pot√™ncia de 1/2 W, limitando a corrente.  Os contatos do rel√© s√£o conectados ao ventilador de √°gua em paralelo com o circuito de controle normal. <br><br>  Aqui est√° o diagrama de conex√£o: <br><br>  Conversor 24VAC 24VAC &lt;---&gt; Caixa de controle 24VAC OUT <br>  Conversor 24VAC + 5V &lt;---&gt; Photon VIN, resistor para placa de rel√© + 3.3V <br>  Conversor 24VAC GND &lt;---&gt; Photon GND, rel√© GND <br>  F√≥ton D0 &lt;---&gt; Entrada do sinal da placa de rel√© <br>  Rel√© COM &lt;---&gt; Caixa de controle 24VAC OUT <br>  Rel√© N√ÉO &lt;---&gt; V√°lvula de √°gua do quintal <br><br><h3>  Instale o Jetson </h3><br>  Os √∫nicos componentes de hardware adicionados ao Jetson s√£o um SSD SATA e um pequeno hub USB da Belkin.  O hub possui duas teclas sem fio que conectam um teclado e um mouse. <br><br>  O SSD surgiu sem problemas.  Reformatei-o para EXT4 e instalei-o como / caffe.  Eu recomendo excluir todos os c√≥digos do seu projeto, reposit√≥rios git e dados do aplicativo do cart√£o SD interno da Jetson, porque geralmente √© mais f√°cil limpar o sistema durante uma atualiza√ß√£o do Jetpack. <br><br><img src="https://habrastorage.org/webt/8d/u9/j6/8du9j6xa2inpeyxcvjkneoeuxre.jpeg"><br><br>  A configura√ß√£o de um ponto de acesso sem fio foi bastante simples (verdadeiro!) Se voc√™ seguiu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este guia</a> .  Basta usar o menu Ubuntu como indicado e n√£o se esque√ßa de adicionar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este par√¢metro de configura√ß√£o</a> . <br><br>  Eu instalei o vsftpd como um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">servidor FTP</a> .  A configura√ß√£o √© basicamente de estoque.  N√£o ativei o FTP an√¥nimo.  Dei √† c√¢mera um nome de usu√°rio e senha que n√£o s√£o mais usados ‚Äã‚Äãpara nada. <br><br>  Eu instalei o Caffe usando a receita <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JetsonHacks</a> .  Acredito que n√£o h√° mais um problema LMDB_MAP_SIZE nas vers√µes atuais, portanto, tente constru√≠-lo antes de fazer altera√ß√µes.  Voc√™ deve poder executar os testes e a demonstra√ß√£o de tempo mencionados no script de shell do JetsonHacks.  Atualmente, estou usando o Cuda 7.0, mas n√£o tenho certeza se isso √© significativo neste est√°gio.  Use CDNN, ele economiza uma quantidade significativa de mem√≥ria nesses pequenos sistemas.  Depois de criado, inclua o diret√≥rio build na vari√°vel PATH para que os scripts possam encontrar o Caffe.  Adicione tamb√©m o diret√≥rio lib do Caffe Python ao seu PYTHONPATH. <br><br><pre><code class="plaintext hljs">~ $ echo $PATH /home/rgb/bin:/caffe/drive_rc/src:/caffe/drive_rc/std_caffe/caffe/build/tools:/usr/local/cuda-7.0/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin ~ $ echo $PYTHONPATH /caffe/drive_rc/std_caffe/caffe/python: ~ $ echo $LD_LIBRARY_PATH /usr/local/cuda-7.0/lib:/usr/local/lib</code> </pre> <br>  Estou usando a op√ß√£o Rede totalmente convolucional para segmenta√ß√£o sem√¢ntica (FCN).  Veja <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Berkeley Model Zoo</a> , <a href="">github</a> . <br><br>  Tentei v√°rias outras redes e finalmente decidi pela FCN.  Leia mais sobre o processo de sele√ß√£o no pr√≥ximo artigo.  O Fcn32s funciona bem no TX1 - ocupa pouco mais de 1 GB de mem√≥ria, √© executado em cerca de 10 segundos e segmenta uma imagem de 640x360 em cerca de um ter√ßo de segundo.  H√° um bom conjunto de scripts no reposit√≥rio atual do github, e a configura√ß√£o √© independente do tamanho da imagem - ela redimensiona a rede para se ajustar ao que voc√™ coloca nela. <br><br>  Para experiment√°-lo, voc√™ precisar√° implantar os modelos Caffe j√° treinados.  Demora alguns minutos: o tamanho do arquivo fcn32s-heavy-pascal.caffemodel excede 500 MB. <br><br><pre> <code class="plaintext hljs">$ cd voc-fcn32s $ wget `cat caffemodel-url`</code> </pre><br>  Edite infer.py alterando o caminho no comando Image.open () para o correspondente .jpg.  Altere a linha "net" para que aponte para o modelo rec√©m-carregado: <br><br><pre> <code class="plaintext hljs"> -net = caffe.Net('fcn8s/deploy.prototxt', 'fcn8s/fcn8s-heavy-40k.caffemodel', caffe.TEST) +net = caffe.Net('voc-fcn32s/deploy.prototxt', 'voc-fcn32s/fcn32s-heavy-pascal.caffemodel', caffe.TEST)</code> </pre><br>  Voc√™ precisar√° do arquivo voc-fcn32s / deploy.prototxt.  √â facilmente gerado a partir do voc-fcn32s / train.prototxt.  Veja as altera√ß√µes entre o voc-fcn8s / train.prototxt e o voc-fcn8s / deploy.prototxt para ver como fazer isso, ou voc√™ pode obt√™-lo no meu reposit√≥rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chasing-cats</a> no github.  Agora voc√™ deve poder executar. <br><br><pre> <code class="plaintext hljs"> $ python infer.py</code> </pre><br>  Meu reposit√≥rio inclui v√°rias vers√µes do infer.py, v√°rios utilit√°rios Python que sabem sobre arquivos segmentados, c√≥digos de photon e scripts de gerenciamento e scripts operacionais que eu uso para iniciar e monitorar o sistema.  Leia mais sobre o software abaixo. <br><br><h3>  Sele√ß√£o de rede </h3><br>  As redes neurais para reconhecimento de imagens geralmente s√£o treinadas para reconhecer um conjunto de objetos.  Suponha que atribuamos a cada objeto um √≠ndice de um a n.  A rede de classifica√ß√£o responde √† pergunta "Quais objetos nesta imagem?"  retornando uma matriz de zero a n-1, em que cada entrada da matriz possui um valor de zero a um.  Zero significa que o objeto n√£o est√° na imagem.  Um valor diferente de zero significa que ele pode estar l√° com probabilidade crescente quando o valor se aproxima da unidade.  Aqui est√° um gato e um homem em uma matriz de 5 elementos: <br><br><img src="https://habrastorage.org/webt/oa/ww/ff/oawwffcoudbw13p25vfa44guxna.png"><br><br>  Uma rede segmentada segmenta pixels de imagens de √°reas ocupadas por objetos da nossa lista.  Ela responde √† pergunta retornando uma matriz com um registro correspondente a cada pixel na imagem.  Cada registro tem um valor zero se for um pixel de plano de fundo ou um valor de um a n para n objetos diferentes que ele pode reconhecer.  Este exemplo fict√≠cio pode ser o p√© de uma pessoa: <br><br><img src="https://habrastorage.org/webt/ud/l6/tw/udl6twr0wz9obfkxqbx3njhrsms.png"><br><br>  Este projeto faz parte de um projeto maior, destinado a controlar um carro controlado por r√°dio usando um computador.  A id√©ia √© usar uma rede neural para determinar a posi√ß√£o (posi√ß√£o e orienta√ß√£o tridimensional global) de um carro para transmitir comandos de navega√ß√£o a ele.  A c√¢mera √© fixa e o gramado √© praticamente plano.  Posso usar um pouco o gatilho para alterar a posi√ß√£o 3D, para que a rede neural encontre os pixels e a orienta√ß√£o da tela.  O papel do gato em tudo isso √© o "objetivo pretendido". <br><br>  Comecei pensando principalmente no carro, porque n√£o sabia como seria, assumindo que reconhecer um gato com uma rede pr√©-treinada seria trivial.  Depois de muito trabalho, que n√£o descreverei em detalhes neste artigo, decidi que voc√™ pode determinar a orienta√ß√£o do carro com um alto grau de confiabilidade.  Aqui est√° uma foto de treinamento em um √¢ngulo de 292,5 graus: <br><br><img src="https://habrastorage.org/webt/7m/kz/hv/7mkzhvtay1em-qvcuomfxjuvdy4.jpeg"><br><br>  A maior parte deste trabalho foi realizada com a rede de classifica√ß√£o, o modelo Caffe bvlc_reference_caffenet.  Portanto, decidi deixar que a tarefa de rede de segmenta√ß√£o determine a posi√ß√£o da m√°quina na tela. <br><br>  A primeira rede que usei √© o Faster R-CNN [1].  Retorna caixas delimitadoras para objetos na imagem, n√£o pixels.  Mas a rede em Jetson estava muito lenta para este aplicativo.  A id√©ia de uma caixa delimitadora era muito atraente, ent√£o eu tamb√©m olhei para a rede orientada √† dire√ß√£o [2].  Ela tamb√©m era muito lenta.  FCN [3] foi a rede de segmenta√ß√£o mais r√°pida que tentei.  ‚ÄúFCN‚Äù significa ‚Äúrede totalmente convolucional‚Äù, rede totalmente convolucional, j√° que n√£o exige mais a entrada de nenhum tamanho de imagem espec√≠fico e consiste apenas em convolu√ß√µes / agrupamentos.  Mudar apenas para camadas convolucionais leva a uma acelera√ß√£o significativa, classificando minhas imagens em cerca de 1/3 de segundo no Jetson.  A FCN inclui um bom conjunto de scripts Python para treinamento e f√°cil implanta√ß√£o.  Os scripts Python redimensionam a rede para caber em qualquer tamanho da imagem recebida, facilitando o processamento da imagem principal.  Eu tive um vencedor! <br><br>  A vers√£o FCN GitHub tem v√°rias op√ß√µes.  Primeiro eu tentei o voc-fcn32s.  Funcionou perfeitamente.  O Voc-fcn32s foi pr√©-treinado em 20 aulas padr√£o.  Como isso √© muito simples, tentei o pascalcontext-fcn32s.  Ele foi treinado em 59 aulas, incluindo grama e √°rvores, ent√£o achei que deveria ser melhor.  Mas aconteceu que nem sempre - as imagens produzidas tinham muito mais conjuntos de pixels, e a segmenta√ß√£o de gatos e pessoas sobrepostas em grama e arbustos n√£o era t√£o precisa.  A segmenta√ß√£o do siftflow era ainda mais complexa, ent√£o voltei rapidamente √†s op√ß√µes de voc. <br><br>  A escolha de redes vocais ainda significa tr√™s coisas a serem consideradas: voc-fcn32s, voc-fcn16s e voc-fcn8s.  Eles diferem na "etapa" da segmenta√ß√£o de sa√≠da.  A etapa 32 √© a etapa principal da rede: a imagem de 640x360 √© reduzida para uma rede de 20x11 quando as camadas convolucionais s√£o conclu√≠das.  Essa segmenta√ß√£o bruta "deconvolve" de volta para 640x360, conforme descrito em [3].  As etapas 16 e 8 s√£o alcan√ßadas adicionando mais l√≥gica √† rede para melhor segmenta√ß√£o.  Eu nem tentei - a segmenta√ß√£o de 32 segmentos √© a primeira que tentei e surgiu, e continuei porque a segmenta√ß√£o parece boa o suficiente para este projeto e o treinamento, conforme descrito, parece mais complicado para as outras duas redes. <br><br><h3>  Treinamento </h3><br>  A primeira coisa que notei quando liguei e iniciei o sistema foi que apenas cerca de 30% dos gatos foram reconhecidos pela rede.  Eu encontrei duas raz√µes para isso.  Em primeiro lugar, os gatos costumam vir √† noite, ent√£o a c√¢mera os v√™ sob luz infravermelha.  Isso pode ser facilmente corrigido - basta adicionar algumas imagens infravermelhas segmentadas de gatos para treinamento.  O segundo problema que descobri depois de revisar v√°rias centenas de fotografias de gatos no kit de treinamento √© que muitas das fotografias pertencem √† variedade "olhe minha gatinha fofa".  Estas s√£o imagens frontais de um gato ao n√≠vel dos olhos de um gato.  Ou o gato est√° deitado de costas ou no colo do dono.  Eles n√£o parecem gatos andando pelo meu quintal.  Novamente, ele pode ser facilmente corrigido com algumas imagens diurnas segmentadas. <br><br><img src="https://habrastorage.org/webt/oz/yh/us/ozyhuswgxhoqy0tndmzvqer_lko.jpeg"><br><br>  Como segmentar um objeto em uma imagem de treinamento?  Minha abordagem √© subtrair a imagem de plano de fundo e depois processar os pixels do primeiro plano para indicar o rastreamento do objeto.  Na pr√°tica, isso funciona muito bem, porque no meu arquivo da c√¢mera geralmente h√° uma imagem que foi tirada alguns segundos antes da imagem segmentada.  Mas h√° artefatos que precisam ser limpos e a segmenta√ß√£o geralmente precisa ser esclarecida. Por isso, escrevi um utilit√°rio de prepara√ß√£o para editar segmentos de imagem, src / extract_fg.cpp.  Veja a nota na parte superior do arquivo de origem para uso.  √â um pouco desajeitado e possui pequenos erros de verifica√ß√£o e precisa de algum aprimoramento, mas funciona bem o suficiente para a tarefa. <br><br>  Agora que temos algumas imagens para treinamento, vamos ver como faz√™-lo.  Clonei o voc-fcn32s no diret√≥rio rgb_voc_fcn32s.  Todos os nomes de arquivos se referir√£o a esse diret√≥rio at√© o final desta li√ß√£o. <br><br><pre> <code class="plaintext hljs"> $ cp -r voc-fcn32s rgb_voc_fcn32s</code> </pre><br>  C√≥digo no meu github, incluindo amostra de arquivo de treinamento em data / rgb_voc.  As principais altera√ß√µes est√£o indicadas abaixo. <br><br><h3>  Formato do arquivo de treinamento </h3><br>  A camada de dados distribu√≠dos espera imagens codificadas e diret√≥rios de segmenta√ß√£o.  O arquivo de treinamento possui uma linha por arquivo;  a camada de dados obt√©m os nomes dos arquivos e segmentos de imagem, adicionando nomes de diret√≥rio codificados.  Isso n√£o funcionou para mim, porque tenho v√°rias classes de dados de treinamento.  Meus dados de treinamento t√™m um conjunto de linhas, cada uma contendo uma imagem e segmenta√ß√£o para essa imagem. <br><br><pre> <code class="plaintext hljs"> $ head data/rgb_voc/train.txt /caffe/drive_rc/images/negs/MDAlarm_20160620-083644.jpg /caffe/drive_rc/images/empty_seg.png /caffe/drive_rc/images/yardp.fg/0128.jpg /caffe/drive_rc/images/yardp.seg/0128.png /caffe/drive_rc/images/negs/MDAlarm_20160619-174354.jpg /caffe/drive_rc/images/empty_seg.png /caffe/drive_rc/images/yardp.fg/0025.jpg /caffe/drive_rc/images/yardp.seg/0025.png /caffe/drive_rc/images/yardp.fg/0074.jpg /caffe/drive_rc/images/yardp.seg/0074.png /caffe/drive_rc/images/yard.fg/0048.jpg /caffe/drive_rc/images/yard.seg/0048.png /caffe/drive_rc/images/yard.fg/0226.jpg /caffe/drive_rc/images/yard.seg/0226.png</code> </pre><br>  Substitu√≠ voc_layers.py por rgb_voc_layers.py, que entende o novo esquema: <br><br><pre> <code class="plaintext hljs"> --- voc_layers.py 2016-05-20 10:04:35.426326765 -0700 +++ rgb_voc_layers.py 2016-05-31 08:59:29.680669202 -0700 ... - # load indices for images and labels - split_f = '{}/ImageSets/Segmentation/{}.txt'.format(self.voc_dir, - self.split) - self.indices = open(split_f, 'r').read().splitlines() + # load lines for images and labels + self.lines = open(self.input_file, 'r').read().splitlines()</code> </pre><br>  E modifiquei o train.prototxt para usar meu c√≥digo rgb_voc_layers.  Observe que os argumentos tamb√©m s√£o diferentes. <br><br><pre> <code class="plaintext hljs"> --- voc-fcn32s/train.prototxt 2016-05-03 09:32:05.276438269 -0700 +++ rgb_voc_fcn32s/train.prototxt 2016-05-27 15:47:36.496258195 -0700 @@ -4,9 +4,9 @@ top: "data" top: "label" python_param { - module: "layers" - layer: "SBDDSegDataLayer" - param_str: "{\'sbdd_dir\': \'../../data/sbdd/dataset\', \'seed\': 1337, \'split\': \'train\', \'mean\': (104.00699, 116.66877, 122.67892)}" + module: "rgb_voc_layers" + layer: "rgbDataLayer" + param_str: "{\'input_file\': \'data/rgb_voc/train.txt\', \'seed\': 1337, \'split\': \'train\', \'mean\': (104.00699, 1</code> </pre><br>  Quase a mesma altera√ß√£o no val.prototxt: <br><br><pre> <code class="plaintext hljs"> --- voc-fcn32s/val.prototxt 2016-05-03 09:32:05.276438269 -0700 +++ rgb_voc_fcn32s/val.prototxt 2016-05-27 15:47:44.092258203 -0700 @@ -4,9 +4,9 @@ top: "data" top: "label" python_param { - module: "layers" - layer: "VOCSegDataLayer" - param_str: "{\'voc_dir\': \'../../data/pascal/VOC2011\', \'seed\': 1337, \'split\': \'seg11valid\', \'mean\': (104.00699, 116.66877, 122.67892)}" + module: "rgb_voc_layers" + layer: "rgbDataLayer" + param_str: "{\'input_file\': \'data/rgb_voc/test.txt\', \'seed\': 1337, \'split\': \'seg11valid\', \'mean\': (104.00699, 116.66877, 122.67892)}"</code> </pre><br><h3>  Solver.py </h3><br>  Execute o resolve.py para iniciar seu treino: <br><br><pre> <code class="plaintext hljs"> $ python rgb_voc_fcn32s / solve.py</code> </pre><br>  Modifica alguns dos mecanismos normais do Caffe.  Em particular, o n√∫mero de itera√ß√µes √© definido na parte inferior do arquivo.  Nessa configura√ß√£o espec√≠fica, a itera√ß√£o √© uma imagem, pois o tamanho da rede muda para cada imagem e as imagens s√£o puladas uma de cada vez. <br><br>  Uma das grandes vantagens de trabalhar com a Nvidia √© que equipamentos realmente √≥timos est√£o dispon√≠veis.  Eu tenho um Titan incorporado em uma esta√ß√£o de trabalho e minha ger√™ncia n√£o se importava em me deixar us√°-lo para algo t√£o d√∫bio quanto este projeto.  Minha √∫ltima corrida de treinamento foi de 4.000 itera√ß√µes, o que levou um pouco mais de duas horas no Titan. <br><br><h3>  Eu aprendi algumas coisas </h3><br><ul><li>  Um punhado de imagens (menos de 50) foi suficiente para treinar a rede para reconhecer invasores noturnos. </li><li>  As tomadas noturnas ensinaram a rede a pensar que as sombras na trilha s√£o gatos. </li><li>  Fotos negativas, ou seja, imagens sem pixels segmentados, ajudam a lidar com o problema das sombras. </li><li>  √â f√°cil treinar novamente a rede usando uma c√¢mera estacion√°ria, para que tudo o que difere seja classificado como algo aleat√≥rio. </li><li>  Gatos e humanos, sobrepostos em contextos aleat√≥rios, ajudam nos problemas decorrentes do excesso de treinamento. </li></ul><br>  Como voc√™ pode ver, o processo √© iterativo. <br><br><h3>  Recomenda√ß√µes </h3><br>  [1] R-CNN mais r√°pido: rumo √† detec√ß√£o de objetos em tempo real com redes de propostas de regi√µes Shaoqing Ren, Kaiming He, Ross Girshick, Jian Sun <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">abs / 1506.01497v3</a> . <br>  [2] Uma avalia√ß√£o emp√≠rica da aprendizagem profunda na condu√ß√£o de rodovias Brody Huval, Tao Wang, Sameep Tandon, Jeff Kiske, Will Song, Joel Pazhayampallil, Mykhaylo Andriluka, Pranav Rajpurkar, Toki Migimatsu, Royce Cheng-Yue, Fernando Cojuju, Fernando Mujica, Andrew Y. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NX arXiv: 1504.01716v3</a> , <a href="">github.com/brodyh/caffe.git</a> . <br>  [3] Redes totalmente convolucionais para segmenta√ß√£o sem√¢ntica Jonathan Long, Evan Shelhamer, Trevor Darrell <a href="">arXiv: 1411.4038v2</a> , <a href="">github.com/shelhamer/fcn.berkeleyvision.org.git</a> . <br><br><h3>  Conclus√µes </h3><br>  Para ensinar a rede neural a reconhecer gatos noturnos, foi necess√°rio adicionar os dados necess√°rios, acumulando-os.  Depois disso, o √∫ltimo passo foi dado - o sistema √© conectado √† v√°lvula, que inicia o pulverizador.  A id√©ia √© que, assim que o gato entra no gramado e quer se adaptar, ele come√ßa a ser regado.  O gato despeja.  Assim, a tarefa √© resolvida, a esposa √© feliz e todo esse estranho milagre √© uma rede neural que ensina a reconhecer gatos, descobre que a Internet n√£o possui imagens fonte suficientes para treinamento e que aprendeu isso, tornou-se a √∫nica rede neural no mundo que pode reconhecer gatos noturnos. <br><br>  Vale notar que tudo isso foi feito por uma pessoa que n√£o √© um hiperprogramador que trabalhou no Yandex ou no Google a vida toda e com a ajuda de hardware, bastante barato, compacto e simples. <br><br><h3>  Um pouco de publicidade :) </h3><br>  Obrigado por ficar conosco.  Voc√™ gosta dos nossos artigos?  Deseja ver materiais mais interessantes?  Ajude-nos fazendo um pedido ou recomendando a seus amigos, um <b>desconto de 30% para os usu√°rios da Habr em um servidor anal√≥gico exclusivo que inventamos para voc√™:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Toda a verdade sobre o VPS (KVM) E5-2650 v4 (6 n√∫cleos) 10GB DDR4 240GB SSD 1Gbps de US $ 20 ou como dividir o servidor?</a>  (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). <br><br>  <b>Dell R730xd 2 vezes mais barato?</b>  Somente temos <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</a> na Holanda!</b>  <b><b>Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de US $ 99!</b></b>  Leia sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como criar um pr√©dio de infraestrutura.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">classe usando servidores Dell R730xd E5-2650 v4 custando 9.000 euros por um centavo?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt473334/">https://habr.com/ru/post/pt473334/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt473320/index.html">SpecFlowMaster: Como melhorar a qualidade do teste</a></li>
<li><a href="../pt473324/index.html">Tirando Jira do dep√≥sito de lixo, por onde come√ßar</a></li>
<li><a href="../pt473328/index.html">Como Methodius se tornou Anna: a experi√™ncia de desenvolver e lan√ßar classificadores de mensagens de voz. Parte 2</a></li>
<li><a href="../pt473330/index.html">Testadores homeop√°ticos ou problemas cr√¥nicos de recrutamento</a></li>
<li><a href="../pt473332/index.html">Mitya Alexandrov e Dmitry Konstantinov na reuni√£o jug.msk.ru</a></li>
<li><a href="../pt473338/index.html">TDD: como escrever especifica√ß√µes corretamente (descreve)</a></li>
<li><a href="../pt473340/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 386 (21 a 27 de outubro de 2019)</a></li>
<li><a href="../pt473342/index.html">‚ÄúO longo caminho est√° esperando por voc√™ ...‚Äù ou resolvendo o problema de previs√£o em C # usando o Ml.NET (DataScience)</a></li>
<li><a href="../pt473344/index.html">Concertos e eventos KudaGo no seu espelho</a></li>
<li><a href="../pt473346/index.html">Criando uma API REST com Node.js e um Banco de Dados Oracle. Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>