<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóÑÔ∏è üö∂üèæ üìß De scripts simples a aplicativos cliente-servidor fa√ßa voc√™ mesmo no WCF: por que eu gosto de trabalhar no CM ü§Ωüèº üöç üé≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O trabalho na equipe de Gerenciamento de configura√ß√£o est√° associado a garantir a funcionalidade dos processos de constru√ß√£o - montagem de produtos da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>De scripts simples a aplicativos cliente-servidor fa√ßa voc√™ mesmo no WCF: por que eu gosto de trabalhar no CM</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/veeam/blog/417701/">  O trabalho na equipe de Gerenciamento de configura√ß√£o est√° associado a garantir a funcionalidade dos processos de constru√ß√£o - montagem de produtos da empresa, verifica√ß√£o preliminar de c√≥digo, an√°lise estat√≠stica, documenta√ß√£o e muito mais.  Al√©m disso, estamos constantemente trabalhando na otimiza√ß√£o de v√°rios processos e, o que √© maravilhoso, somos praticamente livres para escolher ferramentas para este trabalho interessante.  A seguir, falarei em detalhes sobre como, tendo apenas um n√≠vel diferente de conhecimento em C # e C ++, criei um servi√ßo WCF funcional para trabalhar com filas de corre√ß√£o.  E por que eu decidi que √© muito importante. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b47/a3e/2d9/b47a3e2d9febdfd19dcde2b59d58df1b.png"><br><a name="habracut"></a><br><h2>  Automa√ß√£o uma vez ou 117 p√°ginas instru√ß√£o repetidamente </h2><br>  Uma pequena digress√£o para que voc√™ entenda por que estou t√£o preocupado com a automa√ß√£o e otimiza√ß√£o de processos. <br><br>  Antes da Veeam, trabalhei para uma grande empresa internacional - eu era o l√≠der da equipe de Gerenciamento de configura√ß√£o, estava envolvido na cria√ß√£o do aplicativo e na implanta√ß√£o em ambientes de teste.  O programa foi desenvolvido com sucesso, novas fun√ß√µes foram adicionadas, documenta√ß√£o foi escrita, cujo suporte eu tamb√©m lidei.  Mas sempre me surpreendi por que um programa t√£o s√©rio n√£o possui um sistema de configura√ß√£o de par√¢metros normal, do qual havia muitas dezenas, sen√£o centenas. <br><br>  Conversei com os desenvolvedores sobre esse t√≥pico e recebi uma resposta - o cliente n√£o pagou por esse recurso, n√£o concordou com seu custo e, portanto, o recurso n√£o foi implementado.  Mas, na verdade, o controle de qualidade sofreu e n√≥s, a equipe SM, fomos diretamente afetados.  A configura√ß√£o do programa e sua configura√ß√£o preliminar foram realizadas atrav√©s de muitos arquivos de configura√ß√£o, cada um com dezenas de par√¢metros. <br><br>  Cada nova constru√ß√£o, cada nova vers√£o fazia suas altera√ß√µes na configura√ß√£o.  Arquivos de configura√ß√£o antigos n√£o puderam ser usados, pois costumavam ser incompat√≠veis com a nova vers√£o.  Como resultado, todas as vezes antes de implantar a compila√ß√£o para o teste ou nas m√°quinas de trabalho dos testadores, era necess√°rio gastar muito tempo configurando o programa, corrigindo erros de configura√ß√£o, consultas constantes com os desenvolvedores sobre o t√≥pico "por que n√£o funciona assim agora?"  Em geral, o processo foi extremamente otimizado. <br><br>  Para ajudar na configura√ß√£o, tivemos uma instru√ß√£o de 117 p√°ginas no tamanho de fonte Arial 9. Tivemos que ler com muito, muito cuidado.  √Äs vezes, parecia que era mais f√°cil construir um kernel Linux com os olhos fechados em um computador desligado. <br><br>  Ficou claro que a otimiza√ß√£o n√£o poderia ser evitada aqui.  Comecei a escrever meu configurador para um programa com suporte a perfis e a capacidade de alterar par√¢metros em alguns segundos, mas o projeto chegou √† sua fase final e passei a trabalhar em outro projeto.  Nele, analisamos muitos logs de um sistema de cobran√ßa para poss√≠veis erros no lado do servidor.  A automa√ß√£o de muitas a√ß√µes usando a linguagem Python me salvou da quantidade monstruosa de trabalho manual.  Gostei muito dessa linguagem de script e, com sua ajuda, criamos um conjunto de scripts de an√°lise para todas as ocasi√µes.  As tarefas que exigiram v√°rios dias de an√°lise criteriosa de acordo com o ‚Äúcat logfile123 |  grep something_special ‚Äù, demorou alguns minutos.  Tudo foi √≥timo ... e chato. <br><br><h2>  Gerenciamento de Configura√ß√£o - Novas Aventuras </h2><br>  Eu vim para a Veeam como l√≠der de uma pequena equipe de CM.  Muitos processos exigiram automa√ß√£o, otimiza√ß√£o e repensar.  Mas havia total liberdade na escolha de ferramentas!  O desenvolvedor deve usar uma linguagem de programa√ß√£o espec√≠fica, estilo de c√≥digo, um conjunto espec√≠fico de bibliotecas.  SM, por outro lado, pode n√£o usar nada para resolver a tarefa, se ele tiver tempo suficiente, coragem e paci√™ncia para isso. <br><br>  A Veeam, como muitas outras empresas, tem a tarefa de montar atualiza√ß√µes de produtos.  A atualiza√ß√£o incluiu centenas de arquivos e foi necess√°rio alterar apenas aqueles que foram alterados, levando em considera√ß√£o v√°rias condi√ß√µes importantes.  Para fazer isso, criamos um script volumoso de PowerShell que poderia acessar o TFS, selecionar arquivos e classific√°-los nas pastas necess√°rias.  A funcionalidade do script foi complementada, gradualmente se tornou enorme, demorou muito tempo para depurar e constantemente algumas muletas para inicializar.  Era urgente fazer alguma coisa. <br><br><h2>  O que os desenvolvedores queriam </h2><br>  Aqui est√£o as principais reclama√ß√µes: <br><br><ul><li>  N√£o foi poss√≠vel colocar as corre√ß√µes na fila.  Voc√™ deve verificar constantemente a p√°gina da Web para ver quando a montagem da corre√ß√£o particular termina e pode come√ßar a criar a sua pr√≥pria. <br></li><li>  N√£o h√° notifica√ß√µes sobre erros - para ver erros na GUI do aplicativo de montagem, voc√™ precisa ir ao servidor e observar muitos logs volumosos. <br></li><li>  N√£o h√° hist√≥rico de compila√ß√£o para corre√ß√µes particulares. <br></li></ul><br>  Era necess√°rio lidar com essas tarefas e adicionar pequenas coisas agrad√°veis ‚Äã‚Äãque os desenvolvedores n√£o recusariam. <br><br><h2>  O que s√£o corre√ß√µes particulares </h2><br>  Uma corre√ß√£o particular no contexto do nosso desenvolvimento √© um determinado conjunto de corre√ß√µes no c√≥digo, armazenado no shelveset do Team Foundation Server para a ramifica√ß√£o de lan√ßamento.  Um pequeno esclarecimento para aqueles que n√£o est√£o familiarizados com a terminologia do TFS: <br><br><ul><li>  check-in - um conjunto de altera√ß√µes locais no c√≥digo-fonte, que √© feito no c√≥digo armazenado no TFS.  Essa verifica√ß√£o pode ser verificada usando processos de Integra√ß√£o Cont√≠nua / Check-in Fechado que permitem ignorar apenas o c√≥digo correto e rejeitar todas as verifica√ß√µes que violam a cole√ß√£o do projeto final. <br></li><li>  shelveset - um conjunto de altera√ß√µes locais no c√≥digo-fonte que n√£o √© feito diretamente no c√≥digo-fonte localizado no TFS, mas √© acess√≠vel por seu nome.  O shellset pode ser implantado na m√°quina local do desenvolvedor ou no sistema de compila√ß√£o para trabalhar com c√≥digo modificado que n√£o est√° inclu√≠do no TFS.  Al√©m disso, o shellset pode ser adicionado ao TFS como uma verifica√ß√£o ap√≥s a implanta√ß√£o, quando todo o trabalho com ele estiver conclu√≠do.  Por exemplo, o verificador de portas funciona dessa maneira.  Primeiro, o shellset no construtor √© verificado.  Se a verifica√ß√£o for bem-sucedida, o shellset se transformar√° em uma verifica√ß√£o! <br></li></ul><br>  Aqui est√° o que o construtor de corre√ß√µes particulares faz: <br><br><ol><li>  Obt√©m o nome (n√∫mero) do shellset e o implementa no construtor de corre√ß√µes particular.  Como resultado, obtemos o c√≥digo-fonte do produto de lan√ßamento, al√©m de altera√ß√µes / corre√ß√µes no shellset.  O ramo de lan√ßamento permanece inalterado. <br></li><li>  Em um construtor de corre√ß√µes particular, um projeto ou uma s√©rie de projetos est√° sendo executado para o qual uma corre√ß√£o particular foi executada. <br></li><li>  O conjunto de arquivos bin√°rios compilados √© copiado para o diret√≥rio de rede da corre√ß√£o privada.  O cat√°logo cont√©m o nome do conjunto de shell, que √© uma sequ√™ncia de n√∫meros. <br></li><li>  O c√≥digo-fonte no construtor de corre√ß√µes privado √© restaurado para sua forma original. <br></li></ol><br>  Para conveni√™ncia dos desenvolvedores, uma interface da web √© usada na qual voc√™ pode especificar o produto para o qual deseja coletar uma corre√ß√£o privada, especificar o n√∫mero do conjunto de shell, selecionar os projetos para os quais deseja coletar uma corre√ß√£o privada e adicionar o conjunto da corre√ß√£o √† fila.  A captura de tela abaixo mostra a vers√£o final de trabalho do aplicativo Web, que exibe o status atual da constru√ß√£o, a fila de corre√ß√µes particulares e o hist√≥rico de sua montagem.  No nosso exemplo, apenas a fila para montar corre√ß√µes particulares √© considerada. <br><br><h2>  O que era meu </h2><br><ul><li>  Um construtor de corre√ß√µes particular que coletava corre√ß√µes particulares do shellset do TFS iniciando um aplicativo de console com os par√¢metros de linha de comando fornecidos. <br></li><li>  Veeam.Builder.Agent - um servi√ßo WCF criado pela Veeam que inicia o aplicativo com par√¢metros no modo de console no usu√°rio atual e retorna o status atual do aplicativo. <br></li><li>  O servi√ßo web do IIS √© um aplicativo no Windows Forms que permite inserir o nome do conjunto de shell, os par√¢metros especificados e iniciar o processo de cria√ß√£o de uma corre√ß√£o particular. <br></li><li>  Um conhecimento muito superficial de programa√ß√£o √© C ++, um pouco de C # na universidade, e cria pequenos aplicativos para automa√ß√£o, adicionando novas fun√ß√µes aos processos de compila√ß√£o atuais e como hobby. <br></li><li>  Colegas experientes, Google e artigos indianos do MSDN s√£o fontes de respostas para todas as perguntas. <br></li></ul><br><h2>  O que faremos </h2><br>  Neste artigo, mostrarei como implementei o enfileiramento do conjunto de corre√ß√µes e seu lan√ßamento sequencial no construtor.  Aqui est√£o as partes da solu√ß√£o: <br><br><ul><li>  QBuilder.AppQueue √© o meu servi√ßo WCF que fornece trabalho com a fila de constru√ß√£o e chama o servi√ßo Veeam.Builder.Agent para executar o programa de constru√ß√£o. <br></li><li>  O dummybuild.exe √© um programa de stub usado para depura√ß√£o e como aux√≠lio visual.  Necess√°rio para visualizar os par√¢metros transferidos. <br></li><li>  QBuilder.AppLauncher - servi√ßo WCF que executa aplicativos no console do usu√°rio atual e funciona no modo interativo.  Este √© um an√°logo significativamente simplificado do programa Veeam.Builder.Agent escrito especificamente para este artigo.  O servi√ßo original pode funcionar como um servi√ßo do Windows e executar aplicativos no console, o que requer trabalho adicional com a API do Windows.  Para descrever todos os truques, seria necess√°rio um artigo separado.  Meu exemplo funciona como um servi√ßo de console interativo simples e usa duas fun√ß√µes - iniciar um processo com par√¢metros e verificar seu status. <br></li></ul><br>  Al√©m disso, criamos um novo aplicativo da Web conveniente que pode funcionar com v√°rios construtores e manter registros de eventos.  Para n√£o sobrecarregar o artigo, tamb√©m n√£o falaremos sobre isso em detalhes.  Al√©m disso, este artigo n√£o descreve o trabalho com o TFS, com o hist√≥rico de armazenamento de corre√ß√µes particulares coletadas e v√°rias classes e fun√ß√µes auxiliares. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3c/c13/6b9/d3cc136b9f661a26314f2a44eff3a4b3.jpg"><br><br><h2>  Criando servi√ßos WCF </h2><br>  Existem muitos artigos detalhados que descrevem a cria√ß√£o de servi√ßos WCF.  Gostei mais do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">material do site da Microsoft</a> .  Tomei isso como base para o desenvolvimento.  Para facilitar o meu conhecimento do projeto, eu tamb√©m expus os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bin√°rios</a> .  Vamos come√ßar! <br><br><h3>  Crie o servi√ßo QBuilder.AppLauncher </h3><br>  Aqui teremos apenas o disco principal do servi√ßo.  Nesta fase, precisamos garantir que o servi√ßo inicie e funcione.  Al√©m disso, o c√≥digo √© id√™ntico para QBuilder.AppLauncher e QBuilder.AppQueue, portanto, esse processo precisar√° ser repetido duas vezes. <br><br><ol><li>  Crie um novo aplicativo de console chamado QBuilder.AppLauncher <br></li><li>  Renomeie Program.cs para Service.cs <br></li><li>  Renomeie o espa√ßo para nome para QBuilder.AppLauncher <br></li><li>  Adicione as seguintes refer√™ncias ao projeto: <br>  a.  System.ServiceModel.dll <br>  b.  System.ServiceProcess.dll <br>  c.  System.Configuration.Install.dll <br></li><li>  Adicione as seguintes defini√ß√µes ao Service.cs <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ComponentModel; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ServiceModel; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ServiceProcess; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Configuration; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Configuration.Install;</code> </pre> <br>  No processo de montagem adicional, tamb√©m ser√£o necess√°rias as seguintes defini√ß√µes: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Reflection; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Xml.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Xml.XPath;</code> </pre> </li><li>  Definimos a interface IAppLauncher e adicionamos fun√ß√µes para trabalhar com a fila: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    [ServiceContract(Namespace = "http://QBuilder.AppLauncher")]   public interface IAppLauncher   {    //             [OperationContract]       bool TestConnection();   }</span></span></code> </pre></li><li>  Na classe AppLauncherService, implementamos a interface e a fun√ß√£o de teste TestConnection: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AppLauncherService</span></span> : <span class="hljs-title"><span class="hljs-title">IAppLauncher</span></span>   {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestConnection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>       {           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>;       }   }</code> </pre></li><li>  Crie uma nova classe AppLauncherWindowsService que herda a classe ServiceBase.  Adicione a vari√°vel local serviceHost - um link para ServiceHost.  Definimos o m√©todo Main, que chama ServiceBase.Run (new AppLauncherWindowsService ()): <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AppLauncherWindowsService</span></span> : <span class="hljs-title"><span class="hljs-title">ServiceBase</span></span>   {       <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ServiceHost serviceHost = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AppLauncherWindowsService</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>       {           <span class="hljs-comment"><span class="hljs-comment">// Name the Windows Service           ServiceName = "QBuilder App Launcher";       }       public static void Main()       {           ServiceBase.Run(new AppLauncherWindowsService());       }</span></span></code> </pre></li><li>  Substitua a fun√ß√£o OnStart () que cria a nova inst√¢ncia ServiceHost: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span>       {           <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (serviceHost != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)           {               serviceHost.Close();           }           <span class="hljs-comment"><span class="hljs-comment">// Create a ServiceHost for the CalculatorService type and           // provide the base address.           serviceHost = new ServiceHost(typeof(AppLauncherService));           // Open the ServiceHostBase to create listeners and start           // listening for messages.           serviceHost.Open();       }</span></span></code> </pre></li><li>  Substitua a fun√ß√£o onStop que fecha a inst√¢ncia ServiceHost: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>       {           <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (serviceHost != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)           {               serviceHost.Close();               serviceHost = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;           }       }   }</code> </pre></li><li>  Crie uma nova classe ProjectInstaller, herdada do Installer e marcada com RunInstallerAttribute, definida como True.  Isso permite que voc√™ instale o servi√ßo do Windows usando o programa installutil.exe: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">RunInstaller(true)</span></span>]   <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ProjectInstaller</span></span> : <span class="hljs-title"><span class="hljs-title">Installer</span></span>   {       <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ServiceProcessInstaller process;       <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ServiceInstaller service;       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProjectInstaller</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>       {           process = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceProcessInstaller();           process.Account = ServiceAccount.LocalSystem;           service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceInstaller();           service.ServiceName = <span class="hljs-string"><span class="hljs-string">"QBuilder App Launcher"</span></span>;           Installers.Add(process);           Installers.Add(service);       }   }</code> </pre></li><li>  Altere o conte√∫do do arquivo app.config: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.serviceModel</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">services</span></span></span><span class="hljs-tag">&gt;</span></span>     <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"QBuilder.AppLauncher.AppLauncherService"</span></span></span><span class="hljs-tag">              </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">behaviorConfiguration</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppLauncherServiceBehavior"</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">baseAddresses</span></span></span><span class="hljs-tag">&gt;</span></span>           <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">baseAddress</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://localhost:8000/QBuilderAppLauncher/service"</span></span></span><span class="hljs-tag">/&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">baseAddresses</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">endpoint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">                 </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">binding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wsHttpBinding"</span></span></span><span class="hljs-tag">                 </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contract</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"QBuilder.AppLauncher.IAppLauncher"</span></span></span><span class="hljs-tag"> /&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">endpoint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mex"</span></span></span><span class="hljs-tag">                 </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">binding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mexHttpBinding"</span></span></span><span class="hljs-tag">                 </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">contract</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"IMetadataExchange"</span></span></span><span class="hljs-tag"> /&gt;</span></span>     <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">services</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">behaviors</span></span></span><span class="hljs-tag">&gt;</span></span>     <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serviceBehaviors</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">behavior</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppLauncherServiceBehavior"</span></span></span><span class="hljs-tag">&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serviceMetadata</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">httpGetEnabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serviceDebug</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">includeExceptionDetailInFaults</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"False"</span></span></span><span class="hljs-tag">/&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">behavior</span></span></span><span class="hljs-tag">&gt;</span></span>     <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serviceBehaviors</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">behaviors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system.serviceModel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li></ol><br><h3>  Verificando a capacidade de manuten√ß√£o do servi√ßo </h3><br><ol><li>  N√≥s compilamos o servi√ßo. <br></li><li>  Instale-o com o comando installutil.exe <br>  1) V√° para a pasta onde est√° o arquivo de servi√ßo compilado <br>  2) Execute o comando de instala√ß√£o: <br>  C: \ Windows \ Microsoft.NET \ Framework64 \ v4.0.30319 \ InstallUtil.exe </li><li>  Entramos no snap-in services.msc, verificamos a disponibilidade do servi√ßo QBuilder App Launcher e o executamos. <br></li><li>  Verificamos a capacidade de manuten√ß√£o do servi√ßo usando o programa WcfTestClient.exe, inclu√≠do no VisualStudio: <br><br>  1) Execute WcfTestClient <br>  2) Adicione o endere√ßo do servi√ßo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 8000 / QBuilderAppLauncher / service</a> <br>  3) A interface de servi√ßo √© aberta: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f32/d38/35e/f32d3835e5b7ddcb399f7e48b3028df9.png"><br><br>  4) Chamamos a fun√ß√£o de teste TestConnection, verifique se tudo funciona e a fun√ß√£o retorna um valor: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00e/96a/460/00e96a46098ebee72c99b32357930759.png"></li></ol><br>  Agora que temos um disco de trabalho do servi√ßo, adicionamos as fun√ß√µes que precisamos. <br><br><h3>  Por que preciso de uma fun√ß√£o de teste que n√£o faz nada </h3><br>  Quando comecei a aprender a escrever um servi√ßo WCF do zero, li v√°rios artigos sobre esse t√≥pico.  Na mesa, havia uma d√∫zia ou duas folhas impressas nas quais eu conseguia descobrir o que e como.  Admito que n√£o consegui iniciar imediatamente o servi√ßo.  Passei muito tempo e cheguei √† conclus√£o de que √© realmente importante fazer um disco de servi√ßo.  Com isso, voc√™ ter√° certeza de que tudo funciona e poder√° come√ßar a implementar as fun√ß√µes necess√°rias.  A abordagem pode parecer um desperd√≠cio, mas facilitar√° a vida se um monte de c√≥digo escrito n√£o funcionar como deveria. <br><br><h3>  Adicione a capacidade de executar no console </h3><br>  Voltar para o aplicativo.  No est√°gio de depura√ß√£o e em v√°rios outros casos, √© necess√°rio iniciar o servi√ßo na forma de um aplicativo de console sem registrar-se como um servi√ßo.  Esse √© um recurso muito √∫til que permite que voc√™ fique sem o tedioso uso de depuradores.  √â nesse modo que o servi√ßo QBuilder.AppLauncher funciona.  Veja como implement√°-lo: <br><br><ol><li>  Adicione o procedimento RunInteractive √† classe AppLauncherWindowsService, que fornece o servi√ßo no modo do console: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunInteractive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ServiceBase[] services</span></span></span><span class="hljs-function">)</span></span> {   Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Service is running in interactive mode."</span></span>);   Console.WriteLine();   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> start = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ServiceBase).GetMethod(<span class="hljs-string"><span class="hljs-string">"OnStart"</span></span>, BindingFlags.Instance | BindingFlags.NonPublic);   <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> services)   {       Console.Write(<span class="hljs-string"><span class="hljs-string">"Starting {0}..."</span></span>, service.ServiceName);       start.Invoke(service, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { } });       Console.Write(<span class="hljs-string"><span class="hljs-string">"Started {0}"</span></span>, service.ServiceName);   }   Console.WriteLine();   Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Press any key to stop the services and end the process..."</span></span>);   Console.ReadKey();   Console.WriteLine();   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stop = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ServiceBase).GetMethod(<span class="hljs-string"><span class="hljs-string">"OnStop"</span></span>, BindingFlags.Instance | BindingFlags.NonPublic);   <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> services)   {       Console.Write(<span class="hljs-string"><span class="hljs-string">"Stopping {0}..."</span></span>, service.ServiceName);       stop.Invoke(service, <span class="hljs-literal"><span class="hljs-literal">null</span></span>);       Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Stopped {0}"</span></span>, service.ServiceName);   }   Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"All services stopped."</span></span>); }</code> </pre></li><li>  N√≥s fazemos altera√ß√µes no procedimento Principal - adicionamos o processamento dos par√¢metros da linha de comando.  Com a op√ß√£o / console e uma sess√£o de usu√°rio ativo aberta, lan√ßamos o programa no modo interativo.  Caso contr√°rio, o lan√ßaremos como um servi√ßo. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> services = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceBase[]   {       <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AppLauncherWindowsService()   };   <span class="hljs-comment"><span class="hljs-comment">//           ,      /console   if (args.Length == 1 &amp;&amp; args[0] == "/console" &amp;&amp; Environment.UserInteractive)   {       //            RunInteractive(services);   }   else   {       //          ServiceBase.Run(services);   } }</span></span></code> </pre></li></ol><br><h3>  Adicione fun√ß√µes para iniciar o aplicativo e verifique seu status </h3><br>  O servi√ßo √© extremamente simples, n√£o h√° verifica√ß√µes adicionais.  Ele pode executar aplicativos apenas na vers√£o do console e em nome do administrador.  Ele tamb√©m pode inici√°-los como um servi√ßo - mas voc√™ n√£o os ver√°, eles girar√£o em segundo plano e voc√™ poder√° v√™-los apenas atrav√©s do Gerenciador de Tarefas.  Tudo isso pode ser implementado, mas este √© um t√≥pico para um artigo separado.  A principal coisa para n√≥s aqui √© um exemplo claro de trabalho. <br><br><ol><li>  Primeiro, adicione a vari√°vel global appProcess, que armazena o processo em execu√ß√£o no momento. <br><br>  Adicione-o <code>public class AppLauncherService : IAppLauncher</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AppLauncherService</span></span> : <span class="hljs-title"><span class="hljs-title">IAppLauncher</span></span>   {       Process appProcess;</code> </pre></li><li>  Adicione uma fun√ß√£o √† mesma classe que verifica o status do processo em execu√ß√£o: <br><br><pre> <code class="cs hljs">   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>       {           <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (appProcess!=<span class="hljs-literal"><span class="hljs-literal">null</span></span>)           {               <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (appProcess.HasExited)               {                   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;               }               <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>               {                   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>;               }           }           <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>           {               <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;           }       }</code> </pre><br>  A fun√ß√£o retornar√° false se o processo n√£o existir ou ainda n√£o estiver em execu√ß√£o e true se o processo estiver ativo. <br></li><li>  Adicione a fun√ß√£o para iniciar o aplicativo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> arguments, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> workingDirectory, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> domain, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> userName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timeoutInMinutes</span></span></span><span class="hljs-function">)</span></span>       {           ProcessStartInfo processStartInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProcessStartInfo();           processStartInfo.FileName = fileName;           processStartInfo.Arguments = arguments;           processStartInfo.Domain = domain;           processStartInfo.UserName = userName;           processStartInfo.CreateNoWindow = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;           processStartInfo.UseShellExecute = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;           <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>           {               <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (appProcess!=<span class="hljs-literal"><span class="hljs-literal">null</span></span>)               {                   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!appProcess.HasExited)                   {                       Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Process is still running. Waiting..."</span></span>);                       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;                   }               }           }           <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex)           {               Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Error while checking process: {0}"</span></span>, ex);           }           <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>           {               appProcess = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Process();               appProcess.StartInfo = processStartInfo;               appProcess.Start();           }           <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex)           {               Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Error while starting process: {0}"</span></span>,ex);           }           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>;                          }</code> </pre></li></ol><br>  A fun√ß√£o inicia qualquer aplicativo com par√¢metros.  Os par√¢metros Domain e Username n√£o s√£o usados ‚Äã‚Äãnesse contexto e podem estar vazios, pois o servi√ßo inicia o aplicativo a partir da sess√£o do console com direitos de administrador. <br><br><h3>  Iniciando o servi√ßo QBuilder.AppLauncher </h3><br>  Conforme descrito anteriormente, este servi√ßo funciona interativamente e permite executar aplicativos na sess√£o atual do usu√°rio, verifica se o processo est√° em execu√ß√£o ou j√° foi conclu√≠do. <br><br><ol><li>  Para funcionar, voc√™ precisa dos arquivos QBuilder.AppLauncher.exe e QBuilder.AppLauncher.exe.config, que est√£o no arquivo no link acima.  O c√≥digo fonte deste aplicativo para montagem autom√°tica tamb√©m est√° localizado l√°. <br></li><li>  Iniciamos o servi√ßo com direitos de administrador. <br></li><li>  A janela do console do servi√ßo ser√° aberta: <br></li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/981/e79/eb4/981e79eb4757690818462d72cbba5cc4.png"><br><br>  Qualquer pressionamento de tecla no console de servi√ßo fecha, tenha cuidado. <br><br><ol><li>  Para testes, execute o wcftestclient.exe, inclu√≠do no Visual Studio.  Verificamos a disponibilidade do servi√ßo em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 8000 / QBuilderAppLauncher / service</a> ou abrimos o link no Internet Explorer. <br></li></ol><br>  Se tudo funcionar, v√° para o pr√≥ximo passo. <br><br><h3>  Criando o servi√ßo QBuilder.AppQueue </h3><br>  E agora vamos ao servi√ßo mais importante, para o qual o artigo inteiro foi escrito!  Repetimos a sequ√™ncia de a√ß√µes no cap√≠tulo "Criando o servi√ßo QBuilder.AppLauncher" e no cap√≠tulo "Adicionando a inicializa√ß√£o a partir do console", substituindo o AppLauncher pelo AppQueue no c√≥digo. <br><br><h3>  Adicione um link ao servi√ßo QBuilder.AppLauncher para uso no servi√ßo de fila </h3><br><ol><li>  No Solution Explorer do nosso projeto, selecione Add Service Reference e especifique o endere√ßo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">localhost</a> : 8000 / QBuilderAppLauncher / service <br></li><li>  Selecione o espa√ßo para nome do nome: AppLauncherService. <br></li></ol><br>  Agora podemos acessar a interface de servi√ßo do nosso programa. <br><br><h3>  Crie uma estrutura para armazenar elementos da fila </h3><br>  No espa√ßo para nome de QBuilder.AppQueue, adicione a classe QBuildRecord: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// ,     public class QBuildRecord { // ID  public string BuildId { get; set; } // ID  public string IssueId { get; set; } //   public string IssueName { get; set; } //    public DateTime StartDate { get; set; } //    public DateTime FinishDate { get; set; } //    C# public bool Build_CSharp { get; set; } //    C++ public bool Build_Cpp { get; set; } }</span></span></code> </pre> <br><h3>  Implementando a classe de fila CXmlQueue </h3><br>  Adicionamos a classe CXmlQueue.cs ao nosso projeto, que conter√° v√°rios procedimentos para trabalhar com o arquivo XML: <br><br><ul><li>  Construtor CXmlQueue - define o nome inicial do arquivo em que a fila est√° armazenada. <br></li><li>  SetCurrentBuild - grava informa√ß√µes sobre a compila√ß√£o atual no arquivo XML da fila.  Este √© um elemento que n√£o est√° na fila e armazena informa√ß√µes sobre o processo em execu√ß√£o no momento.  Pode estar vazio. <br></li><li>  GetCurrentBuild - Obt√©m os par√¢metros do processo em execu√ß√£o no arquivo XML da fila.  Pode estar vazio. <br></li><li>  ClearCurrentBuild - limpa o elemento currentbuild no arquivo XML da fila se o processo terminar. <br></li><li>  OpenXmlQueue - fun√ß√£o para abrir o arquivo XML em que a fila est√° armazenada.  Se o arquivo estiver ausente, um novo ser√° criado. <br></li><li>  GetLastQueueBuildNumber - cada build na fila possui seu pr√≥prio n√∫mero de s√©rie exclusivo.  Esta fun√ß√£o retorna seu valor, que √© armazenado no atributo raiz. <br></li><li>  IncrementLastQueueBuildNumber - aumenta o valor do n√∫mero da compila√ß√£o ao enfileirar uma nova compila√ß√£o. <br></li><li>  GetCurrentQueue - Retorna uma lista de elementos QBuildRecord do arquivo XML da fila. <br></li></ul><br>  No c√≥digo original, todos esses procedimentos foram colocados na classe principal, mas para maior clareza, criei uma classe separada CXmlQueue.  A classe √© criada no namespace QBuilder.AppQueue, verifique se todas as defini√ß√µes necess√°rias est√£o especificadas: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Xml.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Xml.XPath; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.IO; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">QBuilder.AppQueue</span></span> { . . . }</code> </pre> <br>  Ent√£o, estamos implementando.  A pr√≥pria classe CXmlQueue: <br><br><div class="spoiler">  <b class="spoiler_title">Clique para expandir o spoiler com c√≥digo</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//      XML  public class CXmlQueue { //  ,    string xmlBuildQueueFile; public CXmlQueue(string _xmlQueueFile) { xmlBuildQueueFile = _xmlQueueFile; } public string GetQueueFileName() { return xmlBuildQueueFile; } // ,       xml (   xml) public QBuildRecord GetCurrentBuild() { QBuildRecord qBr; XElement xRoot = OpenXmlQueue(); XElement xCurrentBuild = xRoot.XPathSelectElement("currentbuild"); if (xCurrentBuild != null) { qBr = new QBuildRecord(); qBr.BuildId = xCurrentBuild.Attribute("BuildId").Value; qBr.IssueId = xCurrentBuild.Attribute("IssueId").Value; qBr.StartDate = Convert.ToDateTime(xCurrentBuild.Attribute("StartDate").Value); return qBr; } return null; } // ,       xml (   xml) public void SetCurrentBuild(QBuildRecord qbr) { XElement xRoot = OpenXmlQueue(); XElement newXe = (new XElement( "currentbuild", new XAttribute("BuildId", qbr.BuildId), new XAttribute("IssueId", qbr.IssueId), new XAttribute("StartDate", DateTime.Now.ToString()) )); XElement xCurrentBuild = xRoot.XPathSelectElement("currentbuild"); if (xCurrentBuild != null) { xCurrentBuild.Remove(); // remove old value } xRoot.Add(newXe); xRoot.Save(xmlBuildQueueFile); } // ,       xml,  ,    public void ClearCurrentBuild() { XElement xRoot = OpenXmlQueue(); try { XElement xCurrentBuild = xRoot.XPathSelectElement("currentbuild"); if (xCurrentBuild != null) { Console.WriteLine("Clearing current build information."); xCurrentBuild.Remove(); } } catch (Exception ex) { Console.WriteLine("XML queue doesn't have running build yet. Nothing to clear!"); } xRoot.Save(xmlBuildQueueFile); } //   XML           public XElement OpenXmlQueue() { XElement xRoot; if (File.Exists(xmlBuildQueueFile)) { xRoot = XElement.Load(xmlBuildQueueFile, LoadOptions.None); } else { Console.WriteLine("Queue file {0} not found. Creating...", xmlBuildQueueFile); XElement xE = new XElement("BuildsQueue", new XAttribute("BuildNumber", 0)); xE.Save(xmlBuildQueueFile); xRoot = XElement.Load(xmlBuildQueueFile, LoadOptions.None); } return xRoot; } //       public int GetLastQueueBuildNumber() { XElement xRoot = OpenXmlQueue(); if (xRoot.HasAttributes) return int.Parse(xRoot.Attribute("BuildNumber").Value); return 0; } //              public int IncrementLastQueueBuildNumber() { int buildIndex = GetLastQueueBuildNumber(); buildIndex++; XElement xRoot = OpenXmlQueue(); xRoot.Attribute("BuildNumber").Value = buildIndex.ToString(); xRoot.Save(xmlBuildQueueFile); return buildIndex; } //    xml     QBuildRecord public List&lt;QBuildRecord&gt; GetCurrentQueue() { List&lt;QBuildRecord&gt; qList = new List&lt;QBuildRecord&gt;(); XElement xRoot = OpenXmlQueue(); if (xRoot.XPathSelectElements("build").Any()) { List&lt;XElement&gt; xBuilds = xRoot.XPathSelectElements("build").ToList(); foreach (XElement xe in xBuilds) { qList.Add(new QBuildRecord { BuildId = xe.Attribute("BuildId").Value, IssueId = xe.Attribute("IssueId").Value, IssueName = xe.Attribute("IssueName").Value, StartDate = Convert.ToDateTime(xe.Attribute("StartDate").Value), Build_CSharp = bool.Parse(xe.Attribute("Build_CSharp").Value), Build_Cpp = bool.Parse(xe.Attribute("Build_Cpp").Value) }); } } return qList; } }</span></span></code> </pre> <br></div></div><br>  A fila no arquivo XML √© a seguinte: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BuildsQueue</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildNumber</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"23"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"14"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"26086"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:50.515238+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"15"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"59559"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:50.6880927+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"45275"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:50.859937+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"17"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30990"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.0321322+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"18"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16706"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.2009904+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"19"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"66540"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.3581274+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"68618"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.5087854+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"21"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"18453"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.6713477+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"22"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"68288"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.8277942+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"23"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"89884"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:52.0151294+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">currentbuild</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"13"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4491"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"13.06.2018 16:53:16"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BuildsQueue</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Crie um arquivo BuildQueue.xml com este conte√∫do e coloque-o no diret√≥rio com o arquivo execut√°vel.  Este arquivo ser√° usado na depura√ß√£o de teste para corresponder aos resultados do teste. <br><br><h3>  Adicionar classe AuxFunctions </h3><br>  Nesta classe, coloco fun√ß√µes auxiliares.  No momento, existe apenas uma fun√ß√£o, FormatParameters, que executa a formata√ß√£o dos par√¢metros para transmiti-los ao aplicativo do console para inicializa√ß√£o.  Listagem do arquivo AuxFunctions.cs: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">QBuilder.AppQueue</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AuxFunctions</span></span> { <span class="hljs-comment"><span class="hljs-comment">//       public static string FormatParameters(string fileName, IDictionary&lt;string, string&gt; parameters) { if (String.IsNullOrWhiteSpace(fileName)) { throw new ArgumentNullException("fileName"); } if (parameters == null) { throw new ArgumentNullException("parameters"); } var macros = String.Join(" ", parameters.Select(parameter =&gt; String.Format("\"{0}={1}\"", parameter.Key, parameter.Value.Replace(@"""", @"\""")))); return String.Format("{0} /b \"{1}\"", macros, fileName); } } }</span></span></code> </pre> <br><h3>  Adicione novos recursos √† interface de servi√ßo </h3><br>  A fun√ß√£o de teste TestConnection pode ser exclu√≠da neste est√°gio.  Para implementar o trabalho da fila, eu precisava do seguinte conjunto de fun√ß√µes: <br><br><ul><li>  PushBuild (QBuildRecord): nulo.  Esta √© uma fun√ß√£o que adiciona um novo valor ao arquivo XML da fila com os par√¢metros QBuildRecord <br></li><li>  TestPushBuild (): nulo.  Esta √© uma fun√ß√£o de teste que adiciona dados de teste a uma fila em um arquivo XML. <br></li><li>  PullBuild: QBuildRecord.  Esta √© uma fun√ß√£o que recupera o valor QBuildRecord do arquivo XML da fila.  Pode estar vazio. <br></li></ul><br>  A interface ser√° assim: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IAppQueue</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     [OperationContract] void PushBuild(QBuildRecord qBRecord); //     [OperationContract] void TestPushBuild(); //      [OperationContract] QBuildRecord PullBuild(); }</span></span></code> </pre><br><h3>  Implementamos fun√ß√µes na classe AppQueueService: IAppQueue: </h3><br><br><div class="spoiler">  <b class="spoiler_title">Clique para expandir o spoiler com c√≥digo</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AppQueueService</span></span> : <span class="hljs-title"><span class="hljs-title">IAppQueue</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  ,    public AppLauncherClient buildAgent; // ,      private string _xmlQueueFile; public AppQueueService() { //       .     ,  . _xmlQueueFile = ConfigurationManager.AppSettings["QueueFileName"]; } public QBuildRecord PullBuild() { QBuildRecord qBr; CXmlQueue xmlQueue = new CXmlQueue(_xmlQueueFile); XElement xRoot = xmlQueue.OpenXmlQueue(); if (xRoot.XPathSelectElements("build").Any()) { qBr = new QBuildRecord(); XElement xe = xRoot.XPathSelectElements("build").FirstOrDefault(); qBr.BuildId = xe.Attribute("BuildId").Value; qBr.IssueId = xe.Attribute("IssueId").Value; qBr.IssueName = xe.Attribute("IssueName").Value; qBr.StartDate = Convert.ToDateTime(xe.Attribute("StartDate").Value); qBr.Build_CSharp = bool.Parse(xe.Attribute("Build_CSharp").Value); qBr.Build_Cpp = bool.Parse(xe.Attribute("Build_Cpp").Value); xe.Remove(); // Remove first element xRoot.Save(xmlQueue.GetQueueFileName()); return qBr; } return null; } public void PushBuild(QBuildRecord qBRecord) { CXmlQueue xmlQueue = new CXmlQueue(_xmlQueueFile); XElement xRoot = xmlQueue.OpenXmlQueue(); xRoot.Add(new XElement( "build", new XAttribute("BuildId", qBRecord.BuildId), new XAttribute("IssueId", qBRecord.IssueId), new XAttribute("IssueName", qBRecord.IssueName), new XAttribute("StartDate", qBRecord.StartDate), new XAttribute("Build_CSharp", qBRecord.Build_CSharp), new XAttribute("Build_Cpp", qBRecord.Build_Cpp) )); xRoot.Save(xmlQueue.GetQueueFileName()); } public void TestPushBuild() { CXmlQueue xmlQueue = new CXmlQueue(_xmlQueueFile); Console.WriteLine("Using queue file: {0}",xmlQueue.GetQueueFileName()); int buildIndex = xmlQueue.IncrementLastQueueBuildNumber(); Random rnd = new Random(); PushBuild (new QBuildRecord { Build_CSharp = true, Build_Cpp = true, BuildId = buildIndex.ToString(), StartDate = DateTime.Now, IssueId = rnd.Next(100000).ToString(), IssueName = "TestIssueName" } ); } }</span></span></code> </pre> <br></div></div><br><h3>  Fazendo altera√ß√µes na classe AppQueueWindowsService: ServiceBase </h3><br>  Adicione novas vari√°veis ‚Äã‚Äãao corpo da classe: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// ,         private System.Timers.Timer timer; // ,       public QBuildRecord currentBuild; //public QBuildRecord processingBuild; // ,       public bool clientStarted; //    public string xmlBuildQueueFileName; //   public CXmlQueue xmlQueue; //         public string btWorkingDir; public string btLocalDomain; public string btUserName; public string buildToolPath; public string btScriptPath; public int agentTimeoutInMinutes; //  public AppQueueService buildQueueService;</span></span></code> </pre><br>  No construtor AppQueueWindowsService (), inclua fun√ß√µes para ler o arquivo de configura√ß√£o, inicialize servi√ßos e classes de fila: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//          try { xmlBuildQueueFileName = ConfigurationManager.AppSettings["QueueFileName"]; buildToolPath = ConfigurationManager.AppSettings["BuildToolPath"]; btWorkingDir = ConfigurationManager.AppSettings["BuildToolWorkDir"]; btLocalDomain = ConfigurationManager.AppSettings["LocalDomain"]; btUserName = ConfigurationManager.AppSettings["UserName"]; btScriptPath = ConfigurationManager.AppSettings["ScriptPath"]; agentTimeout= 30000; //    buildQueueService = new AppQueueService(); //    xmlQueue = new CXmlQueue(xmlBuildQueueFileName); } catch (Exception ex) { Console.WriteLine("Error while loading configuration: {0}", ex); }</span></span></code> </pre> <br>  AgentTimeout - frequ√™ncia de resposta do timer.  Indicado em milissegundos.  Aqui, definimos que o timer deve disparar a cada 30 segundos.  No original, esse par√¢metro est√° no arquivo de configura√ß√£o.  Para o artigo, decidi defini-lo no c√≥digo. <br><br>  Adicione a fun√ß√£o para verificar o processo de constru√ß√£o em execu√ß√£o na classe: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//        public bool BuildIsStarted() { IAppLauncher builderAgent; try { builderAgent = new AppLauncherClient(); return builderAgent.IsStarted(); } catch (Exception ex) { return false; } }</span></span></code> </pre><br>  Adicione o procedimento para trabalhar com o timer: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerTick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, System.Timers.ElapsedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     if (!BuildIsStarted()) { //     clientStarted,     if (clientStarted) { //     ,  clientStarted  false      currentBuild.FinishDate = DateTime.Now; clientStarted = false; } else { //       clientStarted=false ( ) -      xmlQueue.ClearCurrentBuild(); } //        currentBuild = buildQueueService.PullBuild(); //    ,     if (currentBuild != null) { //     true -    clientStarted = true; //   currentbuild -     xml            xmlQueue.SetCurrentBuild(currentBuild); //      var parameters = new Dictionary&lt;string, string&gt;(StringComparer.OrdinalIgnoreCase) { {"BUILD_ID", currentBuild.BuildId}, {"ISSUE_ID", currentBuild.IssueId}, {"ISSUE_NAME", currentBuild.IssueName}, {"BUILD_CSHARP", currentBuild.Build_CSharp ? "1" : "0"}, {"BUILD_CPP", currentBuild.Build_Cpp ? "1" : "0"} }; //       var arguments = AuxFunctions.FormatParameters(btScriptPath, parameters); try { //          AppLauncher IAppLauncher builderAgent = new AppLauncherClient(); builderAgent.Start(buildToolPath, arguments, btWorkingDir, btLocalDomain, btUserName, agentTimeout); } catch (Exception ex) { Console.WriteLine(ex); } } } } catch (Exception ex) { Console.WriteLine(ex); } }</span></span></code> </pre> <br>     OnStart,     : <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//     OnStart protected override void OnStart(string[] args) { if (serviceHost != null) { serviceHost.Close(); } //      this.timer = new System.Timers.Timer(agentTimeout); //    this.timer.AutoReset = true; this.timer.Elapsed += new System.Timers.ElapsedEventHandler(this.TimerTick); this.timer.Start(); //  ServiceHost   AppQueueService serviceHost = new ServiceHost(typeof(AppQueueService)); //  ServiceHostBase      serviceHost.Open(); }</span></span></code> </pre> <br><h3>     </h3><br>      : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ComponentModel; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ServiceModel; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ServiceProcess; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Configuration; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Configuration.Install; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Reflection; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Xml.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Xml.XPath; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> QBuilder.AppQueue.AppLauncherService;</code> </pre><br><h3>     App.config </h3><br>      : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"QueueFileName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BuildQueue.xml"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BuildToolPath"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"c:\temp\dummybuild.exe"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BuildToolWorkDir"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"c:\temp\"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LocalDomain"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"."</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UserName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ScriptPath"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"C:\Temp\BuildSample.bld"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">appSettings</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><h2>    </h2><br><ol><li>   QBuilder.AppLauncher.zip.        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> . <br></li><li>   dummybuild.exe     binaries  , ,  c:\temp.           ,     .     ,     BuildToolPath  BuildToolWorkDir   . <br></li><li>    \QBuilder.AppLauncher\binaries\QBuilder.AppLauncher\    QBuilder.AppLauncher.exe   .        . <br></li><li>       QBuilder.AppQueue.exe /console   . <br></li><li> ,     : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/18b/e4a/b17/18be4ab1798effcc29cfa113f6b75452.png"><br></li><li>   .    ,   30    : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/251/681/2a0/2516812a03c79a5c9b2d9811fbbdb0a0.png"><br></li><li>   BuildQueue.xml  ,       currentbuild: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BuildsQueue</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildNumber</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"23"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"19"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"66540"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.3581274+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"68618"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.5087854+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"21"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"18453"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.6713477+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"22"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"68288"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.8277942+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"23"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"89884"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:52.0151294+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">currentbuild</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"18"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16706"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"13.06.2018 23:20:06"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BuildsQueue</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li>     dummy   ,       : <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BuildsQueue</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildNumber</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"23"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"21"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"18453"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.6713477+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"22"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"68288"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:51.8277942+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"23"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"89884"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TestIssueName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2018-06-13T16:49:52.0151294+02:00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_CSharp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Build_Cpp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">currentbuild</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BuildId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">IssueId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"68618"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StartDate</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"13.06.2018 23:24:25"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BuildsQueue</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li></ol><br>  ! <br><br><h2>  </h2><br>   powershell-    .      C#.      rulesets ‚Äî ,                setup-.                ‚Äî  ,          .          ‚Äî     MD5-   -,            . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dea/641/fbe/dea641fbea68d0be6417a2e757928d6b.png"><br> <i>  ,      </i> <br><br>      ,        ‚Äî             .    ,         ,    .      -    . <br><br>     ,    XML,   ,   .       ,       .        ,     ,    . <br><br> ,        WCF-,          XML-.         : <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/U4rXSbt_OMo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br> <b>PS</b>     ,          .  ,        ,       . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt417701/">https://habr.com/ru/post/pt417701/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt417687/index.html">Assimetria da vida</a></li>
<li><a href="../pt417689/index.html">Mobio fala com o CEO da Appnext sobre o mercado de CPI e tend√™ncias de aplicativos m√≥veis</a></li>
<li><a href="../pt417691/index.html">Nossa estante de livros √© um programador de C #. E voc√™?</a></li>
<li><a href="../pt417697/index.html">Editor de imagens simples no VueJS</a></li>
<li><a href="../pt417699/index.html">Western Digital fecha outra f√°brica de HDD devido √† menor demanda</a></li>
<li><a href="../pt417703/index.html">C√≥digo de rede Age of Empires: 1.500 arqueiros por modem de 28,8 kbps</a></li>
<li><a href="../pt417705/index.html">Como um fabricante de placa de v√≠deo afeta a lucratividade da minera√ß√£o de GPU</a></li>
<li><a href="../pt417707/index.html">CSS-in-JS - mitos e realidade (componentes estilizados como exemplo)</a></li>
<li><a href="../pt417709/index.html">Onde e como os desenvolvedores classificam seus empregadores? Servi√ßos de avalia√ß√£o de empresas no setor de TI</a></li>
<li><a href="../pt417711/index.html">O que ler sobre o Swift em russo?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>