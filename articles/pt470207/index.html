<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçå üèöÔ∏è üö∂üèæ 1C Developer Tales: Epicafe üë®üèª‚Äçüíº üêÉ üëèüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Todos n√≥s gostamos de falar sobre nossos sucessos e realmente n√£o gostamos de falar sobre falhas. Mas a experi√™ncia de erros √© geralmente mais valiosa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>1C Developer Tales: Epicafe</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470207/">  Todos n√≥s gostamos de falar sobre nossos sucessos e realmente n√£o gostamos de falar sobre falhas.  Mas a experi√™ncia de erros √© geralmente mais valiosa do que o lucro de um neg√≥cio conclu√≠do com sucesso.  Portanto, gostaria apenas de falar sobre esses casos hoje.  Ent√£o vamos l√° ... <br><a name="habracut"></a><br><h2>  Panela, n√£o cozinhe! </h2><br>  Essa hist√≥ria aconteceu h√° alguns anos, no come√ßo da minha carreira como desenvolvedor da 1C. <br><br>  Um projeto apareceu em nossa empresa para otimizar a opera√ß√£o de uma base muito carregada de um cliente muito grande e respeitado.  O cliente estava com um servi√ßo de seguran√ßa t√£o paran√≥ico que n√£o havia e n√£o podia haver nenhum acesso remoto aos servidores a partir do exterior.  Para conectar-se diretamente √†s bases de nosso escrit√≥rio, foi instalada uma rede local separada com VPN de hardware e instaladas esta√ß√µes de trabalho com software estritamente negociado.  Claro, sem os direitos de um administrador local. <br><br>  Como qualquer outro projeto desse tipo, come√ßou com a coleta de dados.  Supunha-se que primeiro coletar√≠amos v√°rios indicadores dentro de um m√™s e, em seguida, estar√≠amos envolvidos na otimiza√ß√£o da pr√≥pria base de informa√ß√µes.  Quanto e quanto tempo nesse ambiente burocr√°tico levou para montar a MCC, isso √© material para uma hist√≥ria separada.  Mas agora, em algum momento, o MCC foi configurado e iniciado.  Depois disso, o especialista que conduziu esse projeto (Dima, oi!), Entrou no seu carro de luxo e foi viajar pelo nosso vasto pa√≠s e depois mais pelos pa√≠ses vizinhos.  Mas, na verdade, eu ainda sabia pouco e sabia como, mas j√° era considerado um desenvolvedor respons√°vel.  Portanto, antes de partir, Dmitry me encarregou de uma tarefa muito importante e s√©ria: 2 vezes por dia, no hor√°rio de pico de carga, tive que ir at√© o computador secreto e iniciar as medi√ß√µes no CCM e deslig√°-las depois de uma hora.  As instru√ß√µes eram extremamente simples e claras: <br><br>  - Olha, voc√™ pressiona este pequeno bot√£o verde "play", diferentes gr√°ficos correm, voc√™ espera uma hora e depois clica neste bot√£o - "stop".  S√≥ isso. <br><br>  O que poderia ser mais f√°cil, certo?  Em v√£o, estudei por 5 anos na faculdade de matem√°tica? <br><br>  Durante toda a semana, observei estritamente esse ritual de manh√£ e √† noite.  E estava tudo bem at√© o √∫ltimo dia.  Depois do almo√ßo, na sexta-feira, como sempre, comecei a coletar dados e depois ... Bem, voc√™ sabe como isso acontece ... sexta-feira √† noite, precisamos terminar algumas coisas urgentes, terminar algumas tarefas, depois do trabalho levar minha esposa para minha sogra, pelo caminho cair em uma loja, uma segunda, etc.  Em geral, sa√≠ do trabalho, esquecendo completamente esse mal-intencionado MCC. <br><br>  S√°bado de manh√£ come√ßou com uma liga√ß√£o.  Temos TODA a base 1C no cliente.  Achtung e desastre!  Nosso especialista est√° em algum lugar entre Dzheyrakh e Pasanauri, fora da √°rea de acesso √† rede.  O administrador principal do cliente tamb√©m est√° em alguma casa de campo e inacess√≠vel.  Tentando descobrir por telefone, qual o motivo?  De alguma forma, o espa√ßo em disco acabou, ent√£o o servi√ßo do agente 1C aumentou.  Aqui j√° comecei a suspeitar de algo ... <br><br>  Como voc√™ se lembra, n√£o h√° udalenka.  O computador n√£o est√° apenas isolado da Internet, mas tamb√©m fora da nossa rede local.  Nada a fazer - indo trabalhar.  Enquanto se preparavam e dirigiam, os administradores perceberam que todo o lugar era ocupado pelos registros da MCC e fizeram o que julgavam mais razo√°vel - eles o interromperam pelo gerenciador de tarefas.  V√° em frente.  Voc√™ n√£o pode simplesmente excluir logs do disco - perderemos os dados de medi√ß√£o.  De alguma forma, eles encontraram espa√ßo suficiente no compartilhamento de rede e copiaram os arquivos l√°.  O trabalho parece ter sido retomado. <br><br>  A manh√£ de domingo come√ßou com uma liga√ß√£o.  Temos TODA a base 1C no cliente.  Achtung e desastre levam dois!  Todo o p√¢nico acabou - o lugar acabou.  Mas como assim?  MCC desativado?  Com pressa, vou trabalhar novamente, jogando os logs para liberar espa√ßo.  E todos crescem e crescem, amaldi√ßoem-nos!  Sob o medo das execu√ß√µes mais perversas, os administradores me proibiram de iniciar qualquer coisa ou configurar qualquer coisa.  Durante o resto do domingo, eu estava sentado em frente ao computador e copiando as toras para a bola, para que as bases n√£o se levantassem novamente. <br><br>  Apenas tarde da noite, Dima entrou em contato e disse que voc√™ s√≥ precisa excluir um arquivo pequeno no servidor 1C.  Mais tarde, algumas semanas depois, li sobre ele em um conhecido livro de "escrivaninha", mas naquele dia, exaustos, os torturados voltaram para casa para dormir. <br><br>  Na segunda-feira de manh√£, nossa conta foi bloqueada at√© Dmitry voltar das f√©rias, e foi dito claramente na minha conta: "Para que n√£o o vejamos novamente!" <br><br>  Foi assim que meu primeiro projeto de otimiza√ß√£o terminou para mim. <br><br><h2>  Duas vezes em um funil </h2><br>  Grande explora√ß√£o.  18 bases de informa√ß√µes com configura√ß√£o id√™ntica, localizadas em todo o pa√≠s.  A atualiza√ß√£o ocorre uma vez por semana e √© o mesmo ritual: o arquivo de entrega deve ser preparado com anteced√™ncia, carregado na nuvem, verifique se ele foi baixado em todas as filiais (mesmo em 2018 em algumas regi√µes a Internet √© mais lenta que o t√≠pico 1C: ERP), verifique se os backups foram criados em todos os lugares (n√£o parecemos ser respons√°veis ‚Äã‚Äãpor isso, mas a experi√™ncia amarga nos ensinou a ser seguros) e, em cada filial, execute o script de atualiza√ß√£o manualmente e verifique se ele funcionou sem erros.  Freq√ºentemente, no √∫ltimo momento, descobre-se que mais uma tarefa deve ser inclu√≠da na entrega e essa √© uma corre√ß√£o menor, porque a pr√≥xima atualiza√ß√£o ocorre apenas em uma semana. <br><br>  Ent√£o era a hora.  Um desenvolvedor experiente, com muitos anos de experi√™ncia com pressa, cometeu um erro em uma linha ao transferir uma tarefa para um circuito de combate.  O erro acabou sendo cr√≠tico, foi descoberto ap√≥s a atualiza√ß√£o de todos os bancos de dados. <br><br>  Bem, o que fazer?  O desenvolvedor corrige rapidamente o c√≥digo.  N√£o deixa ningu√©m testar: <br><br>  - Sim, tem lixo ... N√£o posso errar duas vezes em uma linha? <br><br>  Uma hora depois, 18 filiais foram atualizadas pela terceira vez. <br><br><h2>  Desenvolvedor que poderia </h2><br>  A hist√≥ria contada por um colega no Skype. <br>  [Colega]: Era uma vez um desenvolvedor que podia!  Ele tinha uma roupa de desenvolvimento.  Ele queria abrir um teste, mas errou e abriu um processo produtivo ... <br>  [Colega]: Mas isso poderia parar o ‚Äúdesenvolvedor que poderia‚Äù?  N√£o! <br>  [I]: E ao atualizar, ele n√£o entendeu que havia pessoas sentadas l√°, por assim dizer?  ))) <br>  [Colega]: Al√©m disso, ele v√™ que o konf est√° apoiando ... Mas voc√™ acha que isso poderia parar o ‚Äúdesenvolvedor que poderia‚Äù?  N√£o! <br>  [Colega]: Ele remove a configura√ß√£o do suporte (!) E viu seu mod ignorando todos os reposit√≥rios ... <br>  [I]: N√£o √© isso!  Termine a hist√≥ria, atualiza√ß√£o din√¢mica))) <br>  [Colega]: Atualiza√ß√µes ... O sistema diz: ‚ÄúExistem 18 sess√µes ativas no banco de dados!‚Äù.  Mas como isso poderia impedir o "desenvolvedor que poderia"?  N√£o e n√£o de novo! <br>  [Colega]: Ele atualiza o banco de dados e passa a tarefa para o teste ... <br>  [Colega]: O consultor n√£o consegue encontrar a roupa ... e s√≥ ent√£o, depois de um longo tempo, ele percebe que perdeu. <br>  [Colega]: Eu tive que repreend√™-lo ... <br>  [Colega]: Eu estou ligando para ele ... e estou rindo no telefone ... <br>  [Colega]: Eu simplesmente n√£o entendo ... COMO ??? <br><br><h2>  Colapso do transporte </h2><br>  A hist√≥ria contada por um colega e registrada a partir de suas palavras. <br><br>  Isso aconteceu em uma grande empresa de log√≠stica.  A maioria dos processos de neg√≥cios est√° concentrada em uma base de informa√ß√µes.  Usu√°rios competitivos para 2012 - cerca de 3.000 pessoas de todas as regi√µes do pa√≠s. <br><br>  Defina uma tarefa simples.  Segundo ele, ele fez seu pr√≥prio registro de informa√ß√µes, no qual os dados s√£o gravados quando determinados documentos s√£o lan√ßados.  Embora n√£o haja muitos tipos de documentos, o n√∫mero desses documentos por dia √© enorme.  Em teoria, a opera√ß√£o de grava√ß√£o que adicionei ao registro n√£o deve carregar muito o sistema.  Mas havia uma nuance na implementa√ß√£o da tarefa - ao gravar um conjunto, a propriedade Substituir foi definida como Falso.  Ou seja, cada documento contendo entradas adicionadas ao registro.  Isso foi necess√°rio de acordo com as condi√ß√µes do problema, mas praticamente n√£o afetou o desempenho, porque  de acordo com as condi√ß√µes de sele√ß√£o, sempre havia 1 a 10 entradas. <br><br>  O teste funcional foi bem sucedido.  Realizamos v√°rias dezenas de documentos, certificamos que as entradas no registro estavam corretas, n√£o notamos nada de suspeito e as enviamos para o produtivo. <br><br>  Naquela infeliz manh√£ de sexta-feira, atualizamos a base de combate e os usu√°rios come√ßaram a trabalhar.  3000 pessoas preencheram alegremente documentos e o registro come√ßou a ser preenchido com dados.  Depois de verificar se tudo estava indo bem, algumas horas depois voltamos para casa com uma alma calma (trabalhamos em diferentes fusos hor√°rios com os principais usu√°rios da base de informa√ß√µes). <br><br>  Deve-se notar que os servidores nos quais o IS estava em execu√ß√£o s√£o quase um dos mais poderosos da R√∫ssia usados ‚Äã‚Äãem 1C.  Mas depois de algumas horas "algo deu errado" (c). <br><br>  Os usu√°rios come√ßaram a notar uma diminui√ß√£o no desempenho do sistema.  Todas as opera√ß√µes come√ßaram a desacelerar.  As respostas a quaisquer a√ß√µes cresceram mais.  A carga no equipamento aumentou constantemente.  Enquanto o departamento de TI entendia o que estava acontecendo, o trabalho no sistema quase parou.  O equipamento n√£o aguentava, as filas nos discos eram mais longas do que nas ag√™ncias dos correios da R√∫ssia.  Se o equipamento fosse mais fraco, o problema seria detectado quase imediatamente.  Mas os servidores mais poderosos resistiram heroicamente √†s minhas m√£os tortas por meio dia. <br><br>  ‚ÄúDas palavras‚Äù do MSSQL, a solicita√ß√£o mais grave de repente se tornou uma solicita√ß√£o de leitura no meu registro.  Embora eu n√£o tenha feito nenhuma leitura.  Um problema foi rapidamente descoberto no c√≥digo 1C.  Esqueci de definir sele√ß√µes em um conjunto de registros.  Se a propriedade "Substituir" fosse definida como "Verdadeiro", eu imediatamente encontraria um erro, porque  cada entrada limparia o registro inteiro.  Mas, no nosso caso, isso n√£o aconteceu.  No exemplo de uma d√∫zia de documentos, √© claro, n√£o percebemos nenhuma perda de desempenho.  Mas quando o registro come√ßou a se encher de dezenas e centenas de milhares de linhas - o sistema cada vez tinha que verificar o registro inteiro em busca de registros correspondentes. <br><br>  Naquela √©poca, segundo alguns usu√°rios, j√° havia ocorrido um colapso no transporte, porque  os carros n√£o receberam documentos da 1C e n√£o puderam sair dos pontos de descarga. <br><br>  Ent√£o, ‚Äúesquecendo‚Äù de colocar uma sele√ß√£o no conjunto de registros, coloquei um dos maiores bancos de dados 1C da R√∫ssia. <br><br><h2>  PS Veja tamb√©m: </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Contos de desenvolvedores 1C: admin</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt470207/">https://habr.com/ru/post/pt470207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt470195/index.html">F # 4: deixe / use / fa√ßa</a></li>
<li><a href="../pt470197/index.html">Posso haz? Considere o padr√£o Tem</a></li>
<li><a href="../pt470199/index.html">Memorando para um desenvolvedor iniciante de jogos de computador</a></li>
<li><a href="../pt470203/index.html">A agulha de aprova√ß√£o do carma, como um espelho da evolu√ß√£o do Homo</a></li>
<li><a href="../pt470205/index.html">Localiza√ß√£o de jogos no Unreal Engine 4</a></li>
<li><a href="../pt470209/index.html">Transforma√ß√£o de c√≥digo no Android 2. An√°lise AST</a></li>
<li><a href="../pt470215/index.html">CAGR como uma maldi√ß√£o para especialistas, ou erros na previs√£o de processos exponenciais</a></li>
<li><a href="../pt470217/index.html">DS18B20 falso √† prova d'√°gua: o que fazer?</a></li>
<li><a href="../pt470219/index.html">F # 5: Operadores</a></li>
<li><a href="../pt470221/index.html">Holivar. Hist√≥ria do Runet. Parte 3. Motores de busca: Yandex vs Rambler. Como n√£o fazer um investimento</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>