<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñ§ üë®‚Äçüë®‚Äçüë¶ üêò Layout go pet project di VPS üßúüèæ üë¶ üïí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Nama saya Artyom Zheltak , saya seorang pemimpin tim, dan juga seorang guru di kursus "Pengembang Golang" di OTUS. Untuk mengantisipasi di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Layout go pet project di VPS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/485240/">  <i>Halo, Habr!</i>  <i>Nama saya <a href="https://otus.pw/QkRm/">Artyom Zheltak</a> , saya seorang pemimpin tim, dan juga seorang guru di kursus <a href="https://otus.pw/UygG/">"Pengembang Golang"</a> di OTUS.</i>  <i>Untuk mengantisipasi dimulainya <a href="https://otus.pw/UygG/">aliran baru kursus</a> , saya ingin berbagi artikel saya dengan Anda.</i> <br><hr><br>  Saya percaya bahwa Golang itu hebat, tetapi masih ada banyak php dan proyek lain yang mengerjakan VPS, VDS di dunia.  Anda dapat meletakkan buruh pelabuhan di sana, tetapi ini (menurut penulis) adalah komplikasi ulang dari tugas tersebut.  Anda dapat mengkompilasi file dan mengunggah melalui FTP - itu tidak aman dan tidak feng shui, SFTP lebih aman, tetapi jangan feng shui lagi.  Kemudian mari kita mengotomatisasi proses ini melalui <a href="https://circleci.com/">CircleCI</a> .  Kami akan menulis file konfigurasi untuk CI langkah demi langkah, pada akhirnya kami akan mengumpulkan hasilnya dan menjalankan penyebaran. <br><br><img src="https://habrastorage.org/webt/cv/2s/yw/cv2sywq6jxqrpflgccoicqbrahc.jpeg"><br><br><a name="habracut"></a><br><h3>  Persyaratan implementasi </h3><br><ol><li>  Inovasi server minimal </li><li>  Penyebaran harus otomatis </li><li>  Titik masuk untuk penempatan adalah penandaan untuk perakitan dev dan konfirmasi manual tambahan untuk prod </li><li>  Majelis harus lulus pengujian otomatis </li><li>  Versi mekanisme rollback manual </li></ol><br><h3>  Mengapa CircleCI? </h3><br>  Sejak awal, proyek ini menggunakan repositori bitbucket pribadi.  (Sekarang repositori pribadi sudah ada di github.) Tanpa meninggalkan ekosistem, Atlasian memutuskan untuk menggunakan CircleCI (selanjutnya disebut CI).  Saya suka itu: <br><br><ul><li>  pengaturan minimum </li><li>  fitur ssh debug </li><li>  versi gratis tetapi dengan keterbatasan <br><ul><li>  2500 kredit / per minggu (penyelesaian sekitar 250 menit) #go dikumpulkan dan digunakan dengan cepat, kami sudah cukup </li><li>  eksekusi berurutan tunggal # kami tidak memiliki banyak proyek kesayangan </li><li>  hanya linux dan windows # kita perlu linux </li></ul></li></ul><br><h3>  Bagian Satu, alur kerja </h3><br>  Buat folder .circle dan buat file config.yml di dalamnya dan jelaskan alur kerja yang diharapkan di sana (urutan pelaksanaan tugas) <br><br><pre><code class="plaintext hljs">workflows: version: 2 tagged-build: jobs: - test - dev_deploy: requires: - test - approve_master_deploy: type: approval requires: - test - dev_deploy - prod_deploy: requires: - dev_deploy - approve_master_deploy</code> </pre> <br>  Inilah hasilnya: <br><br><img src="https://habrastorage.org/webt/sj/c0/9r/sjc09rejzva6l9t5pyho4nxyw3c.jpeg" alt="gambar"><br><br>  Kami menggambarkan pola yang menurutnya setiap komit akan diperiksa pertama kali dengan tes, kemudian diluncurkan ke dev, kemudian, dengan konfirmasi manual, dikirim ke server pertempuran.  Untuk memandu gloss, tambahkan filter sehingga tugas hanya bekerja dengan tag. <br><br><pre> <code class="plaintext hljs">- dev_deploy: requires: - test filters: branches: ignore: /.*/ tags: only: /.*/</code> </pre> <br><h3>  Langkah kedua, yang paling mudah </h3><br>  Mari kita mulai dengan menjalankan tes, akan ada kode minimum. <br><br><pre> <code class="plaintext hljs">jobs: test: docker: - image: circleci/golang:1.12 working_directory: ~/go-example/ steps: - checkout #   linter'   - run: go test -cover -v ./...</code> </pre> <br>  Setelah kode kami diuji dan lulus pemeriksaan gaya kode, Anda dapat melakukan penerapan pada dev.  Saya sarankan menggunakan supervisor (ver 3.1.4 pada saat penulisan) untuk memulai layanan go, kami akan mengumpulkan log untuk mereka. <br><br>  Tambahkan file supervisor_ph.conf ke folder .circleci, dalam CI PH_NAME akan berubah menjadi nama proyek.  Dan pada file yang sama kita akan menulis output dari log. <br><br><pre> <code class="plaintext hljs">[program:PH_NAME] stopasgroup=true user=deploy-user autostart=true autorestart=true stdout_logfile=/var/log/supervisor/PH_NAME.log stderr_logfile=/var/log/supervisor/PH_NAME.log redirect_stderr=true</code> </pre> <br>  Semua yang membedakan proyek kami dari yang lain: <br><br><img src="https://habrastorage.org/webt/l7/2f/mj/l72fmjecgyvovcovx6xamliiy3o.jpeg"><br><br><h3>  Sebarkan Waktu </h3><br>  Untuk dev dan prod, hanya server yang diubah dan sufiks ditambahkan ke nama aplikasi.  Konfigurasi disimpan dalam variabel lingkungan.  ( <a href="https://12factor.net/ru/config">Aplikasi 12 faktor</a> ) Kami akan mengambil bagian ini ke lingkungan, kami akan menggandakan sisanya. <br><br><pre> <code class="plaintext hljs">prod_deploy: environment: TARGET_IP: 0.0.0.0 TARGET_DIR: /var/www/deploy-user/go-example REMOTE_USER: deploy-user SERVICE_NAME: go_example_prod docker: - image: circleci/golang:1.12 working_directory: ~/go-example/ steps: - checkout - add_ssh_keys #   ci ,    - run: go build -ldflags "-X main.version=$CIRCLE_TAG" -o ./main ./src/main - run: ssh -o "StrictHostKeyChecking=no" $REMOTE_USER@$TARGET_IP "mkdir $TARGET_DIR/v$CIRCLE_TAG" #    ,        - run: scp main $REMOTE_USER@$TARGET_IP:$TARGET_DIR/v$CIRCLE_TAG/ #       - run: sed "s/PH_NAME/$SERVICE_NAME/g" .circleci/supervisor_ph.conf &gt; .circleci/$SERVICE_NAME.conf - run: echo command=$TARGET_DIR/v$CIRCLE_TAG/main &gt;&gt; .circleci/$SERVICE_NAME.conf - run: scp .circleci/$SERVICE_NAME.conf $REMOTE_USER@$TARGET_IP:$TARGET_DIR/v$CIRCLE_TAG/ - run: ssh $REMOTE_USER@$TARGET_IP "ln -sf $TARGET_DIR/v$CIRCLE_TAG/$SERVICE_NAME.conf /etc/supervisord.d" - run: ssh $REMOTE_USER@$TARGET_IP "supervisorctl -c /etc/supervisord.conf reread &amp;&amp; supervisorctl -c /etc/supervisord.conf update" - run: curl "$TELEGRAM_SERVICE?msg=$SERVICE_NAME%20v$CIRCLE_TAG%20deployed&amp;channel=go_deploy"</code> </pre> <br>  Untuk pemberitahuan, kami menggunakan bot kami sendiri, yang disebut melalui curl.  Perintah `when: on_fail` berfungsi jika terjadi kesalahan, itu juga dapat digunakan untuk mengembalikan perubahan.  Meskipun kami memiliki bot telegram, tetapi secara umum Anda dapat melakukannya tanpa itu dan menggunakan pemberitahuan standar: Slack, IRC.  Plus notifikasi kesalahan masuk ke email. <br><br>  Variabel `$ TELEGRAM_SERVICE` ditambahkan melalui bagian BUILD SETTING ‚Üí Variabel Lingkungan. <br><br><pre> <code class="plaintext hljs">- run: command: curl "$TELEGRAM_SERVICE?msg=$SERVICE_NAME%20v$CIRCLE_TAG%20failed&amp;channel=go_deploy" when: on_fail</code> </pre> <br><h3>  Garis finish </h3><br>  Kami mendorong di github atau di bitbucket.  Setelah kita pergi ke CircleCI di proyek Add item <br><br><img src="https://habrastorage.org/webt/1n/z5/jh/1nz5jhheeilqigbrbgpc0pasfw0.jpeg"><br><br>  Kemudian pilih Mulai membangun.  Langkah terakhir adalah menambahkan kunci ssh untuk otorisasi di server di bawah pengguna yang dipilih. <br><br><img src="https://habrastorage.org/webt/af/pv/ds/afpvdsmm0zsbu1gg6vba8ytxury.png"><br><br>  Semuanya bisa dilakukan menyebarkan, memberi tag dan mulai menikmati hidup.  Versi terakhir ./.circleci/config.yml - <a href="https://gist.github.com/JackShadow/352202bfb08e7dd9317434dde5c5d552">di sini</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id485240/">https://habr.com/ru/post/id485240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id485228/index.html">Apa itu pembelajaran aktif?</a></li>
<li><a href="../id485230/index.html">5 Buku Teratas untuk Dibaca untuk Perancang Gerakan</a></li>
<li><a href="../id485232/index.html">Pembelajaran mesin otomatis: ketika para ilmuwan data tidak akan diperlukan</a></li>
<li><a href="../id485236/index.html">File konfigurasi python</a></li>
<li><a href="../id485238/index.html">Kami menggunakan penyeleksi redux terlalu banyak</a></li>
<li><a href="../id485256/index.html">Ivan Lilekvist dan Kim Dotkom, sebuah wawancara besar: kisah Megaupload, ekstradisi ke Amerika Serikat, kebebasan, bitcoin. Bagian 1</a></li>
<li><a href="../id485260/index.html">13 Kesalahan Umum untuk Analis Bisnis Awal</a></li>
<li><a href="../id485264/index.html">Seperti apa bentuk arsip zip dan apa yang bisa kita lakukan dengannya. Bagian 4 - Membaca arsip</a></li>
<li><a href="../id485266/index.html">Habr Contest: pemenang dari kontes ide</a></li>
<li><a href="../id485268/index.html">Jika .NET berfungsi di mana-mana, maka pada Windows 3.11 dan DOS juga</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>