<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßïüèæ üë©üèº‚Äçüè´ üßõüèª JETZT in NoSQL-Datenbanken üë®‚Äç‚öïÔ∏è üí± üí∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Beitrag wird erl√§utert, wie Sammlungen in NoSQL-Datenbanken mongodb, arangodb, orientdb und rethinkdb verbunden werden (sie sind nicht nur N...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JETZT in NoSQL-Datenbanken</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413123/"> In diesem Beitrag wird erl√§utert, wie Sammlungen in NoSQL-Datenbanken mongodb, arangodb, orientdb und rethinkdb verbunden werden (sie sind nicht nur NoSQL-Datenbanken, sondern werden auch durch eine kostenlose Version mit einer ziemlich loyalen Lizenz vereint).  In relationalen Datenbanken wird eine √§hnliche Funktionalit√§t mit SQL JOIN implementiert.  Trotz der Tatsache, dass CRUD-Operationen in NoSQL-Datenbanken sehr √§hnlich sind und sich nur in Details unterscheiden, z. B. in einer Datenbank, wird die Funktion create ({...}) verwendet, um ein Objekt zu erstellen, in die andere einzuf√ºgen ({...}) und in Das dritte - Speichern ({...}) - Die Implementierung einer Auswahl von zwei oder mehr Sammlungen in jeder der Datenbanken wird auf v√∂llig unterschiedliche Weise implementiert.  Daher ist es interessant, f√ºr alle Datenbanken dieselbe Auswahl durchzuf√ºhren.  F√ºr alle Datenbanken wird die Stichprobe (eine Viele-zu-Viele-Beziehung) f√ºr zwei Tabellen ber√ºcksichtigt. <br><a name="habracut"></a><br>  Beispielsweise werden Tabellen verwendet. <br><br>  Der Autor <br><br><ul><li>  Vorname </li></ul><br>  Das Buch <br><br><ul><li>  Titel </li></ul><br>  BooksAuthor <br><br><ul><li>  Der Autor </li><li>  Das Buch </li></ul><br>  F√ºr Mongodb wird die Auswahl aus den Tabellen folgenderma√üen implementiert: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mongo = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongodb-bluebird'</span></span>); mongo.connect(<span class="hljs-string"><span class="hljs-string">"mongodb://localhost:27017/test"</span></span>).then(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">db</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> author = db.collection(<span class="hljs-string"><span class="hljs-string">'author'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> book = db.collection(<span class="hljs-string"><span class="hljs-string">'book'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bookauthor = db.collection(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>); [<span class="hljs-string"><span class="hljs-string">'Joe'</span></span>, <span class="hljs-string"><span class="hljs-string">'John'</span></span>, <span class="hljs-string"><span class="hljs-string">'Jack'</span></span>, <span class="hljs-string"><span class="hljs-string">'Jeremy'</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (name) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> author.insert({name}) ); [<span class="hljs-string"><span class="hljs-string">'Art'</span></span>, <span class="hljs-string"><span class="hljs-string">'Paint'</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (title) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> book.insert({title}) ); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Author = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> author.findOne({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Joe'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Book = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> book.findOne({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Paint'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> bookauthor.insert({<span class="hljs-attr"><span class="hljs-attr">author</span></span>: Author._id, <span class="hljs-attr"><span class="hljs-attr">book</span></span>: Book._id}) Author = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> author.findOne({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'John'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> bookauthor.insert({<span class="hljs-attr"><span class="hljs-attr">author</span></span>: Author._id, <span class="hljs-attr"><span class="hljs-attr">book</span></span>: Book._id}) Book = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> book.findOne({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Art'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> bookauthor.insert({<span class="hljs-attr"><span class="hljs-attr">author</span></span>: Author._id, <span class="hljs-attr"><span class="hljs-attr">book</span></span>: Book._id}) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> author.aggregate([{ <span class="hljs-attr"><span class="hljs-attr">$lookup</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">from</span></span>: <span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>, <span class="hljs-attr"><span class="hljs-attr">localField</span></span>: <span class="hljs-string"><span class="hljs-string">'_id'</span></span>, <span class="hljs-attr"><span class="hljs-attr">foreignField</span></span>: <span class="hljs-string"><span class="hljs-string">'author'</span></span>, <span class="hljs-attr"><span class="hljs-attr">as</span></span>: <span class="hljs-string"><span class="hljs-string">'ba'</span></span> }}, { <span class="hljs-attr"><span class="hljs-attr">$lookup</span></span>: { <span class="hljs-attr"><span class="hljs-attr">from</span></span>: <span class="hljs-string"><span class="hljs-string">'book'</span></span>, <span class="hljs-attr"><span class="hljs-attr">localField</span></span>: <span class="hljs-string"><span class="hljs-string">'ba.book'</span></span>, <span class="hljs-attr"><span class="hljs-attr">foreignField</span></span>: <span class="hljs-string"><span class="hljs-string">'_id'</span></span>, <span class="hljs-attr"><span class="hljs-attr">as</span></span>: <span class="hljs-string"><span class="hljs-string">'books'</span></span> }}],{ }) });</code> </pre> <br>  Im Gegensatz zur SQL JOIN-Auswahl ist die resultierende Auswahl keine flache Tabelle, in der der Autor so viele B√ºcher wiederholt, wie er geschrieben hat, sondern ein hierarchisches Objekt, in dem jeder Autor durch ein Objekt dargestellt wird, dessen Eigenschaft books ein Array von Buchobjekten enth√§lt .  Aus meiner Sicht ist dies ein sehr gro√ües Plus in NoSQL-Datenbanken.  M√∂glicherweise ben√∂tigen Sie jedoch auch eine "flache" Version, √§hnlich wie SQL JOIN.  Um es in der Anfrage zu erhalten, m√ºssen Sie die "Erweiterung" von Arrays hinzuf√ºgen: <code>{ $unwind: '$books' }</code> . <br><br>  Das im Beispiel dargestellte Beispiel ist ein Analogon von SQL LEFT JOIN, dh alle Autoren werden in das Beispiel aufgenommen, auch wenn sie keine B√ºcher haben.  Um ein Analogon zu SQL [INNER] JOIN zu erstellen, m√ºssen Sie die Bedingung <code>{ $match: { books: { $ne: [ ] } } }</code> hinzuf√ºgen, oder wenn $ unwind verwendet wird: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">$unwind</span></span>: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">"$role"</span></span>, <span class="hljs-attr"><span class="hljs-attr">preserveNullAndEmptyArrays</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } }</code> </pre> <br>  Fahren wir also mit Arangodb fort, einer hybriden Datenbank.  Neben der Arbeit mit Dokumenten wird auch die Arbeit mit Diagrammen implementiert.  Lassen Sie uns zun√§chst sehen, wie Sie in Arangodb eine Auswahl nur mit Dokumenten (nicht mit Grafiken) treffen k√∂nnen: <br><br><pre> <code class="javascript hljs"> FOR a IN author FOR ba IN bookauthor FILTER a._id == ba.author FOR b IN book FILTER b._id == ba.book SORT a.name, b.title RETURN { <span class="hljs-attr"><span class="hljs-attr">author</span></span>: a, <span class="hljs-attr"><span class="hljs-attr">book</span></span>: b }</code> </pre><br>  Arangodb verwendet das Schl√ºsselwort FOR, um Sammlungen zu verbinden, und FILTER, um die Verkn√ºpfungsbedingung anzugeben.  Das in diesem Fall erhaltene Beispiel √§hnelt SQL [INNER] JOIN (dh es ist ein "flaches" Objekt und enth√§lt keine leeren Werte). <br><br>  In Arangodb ist es jedoch viel bequemer, Diagrammfunktionen f√ºr die Auswahl aus mehreren Objekten zu verwenden: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { Database, aql } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'arangojs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Database({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">"http://localhost:8529"</span></span> }); db.useDatabase(<span class="hljs-string"><span class="hljs-string">"test"</span></span>); db.useBasicAuth(<span class="hljs-string"><span class="hljs-string">"test"</span></span>, <span class="hljs-string"><span class="hljs-string">"test"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> author = db.collection(<span class="hljs-string"><span class="hljs-string">'author'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> book = db.collection(<span class="hljs-string"><span class="hljs-string">'book'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bookauthor = db.edgeCollection(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ [<span class="hljs-string"><span class="hljs-string">'Joe'</span></span>, <span class="hljs-string"><span class="hljs-string">'John'</span></span>, <span class="hljs-string"><span class="hljs-string">'Jack'</span></span>, <span class="hljs-string"><span class="hljs-string">'Jeremy'</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (name) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> author.save({name}) ); [<span class="hljs-string"><span class="hljs-string">'Art'</span></span>, <span class="hljs-string"><span class="hljs-string">'Paint'</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (title) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> book.save({title}) ); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Author = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> author.firstExample({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Joe'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Book = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> book.firstExample({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Paint'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> bookauthor.save({<span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-string"><span class="hljs-string">'Some data'</span></span>}, Author._id, Book._id) Author = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> author.firstExample({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'John'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> bookauthor.save({<span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-string"><span class="hljs-string">'Some data'</span></span>}, Author._id, Book._id) Book = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> book.firstExample({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Art'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> bookauthor.save({<span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-string"><span class="hljs-string">'Some data'</span></span>}, Author._id, Book._id) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cursor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.query(aql<span class="hljs-string"><span class="hljs-string">` FOR a IN author FOR book_vertex, book_edge IN OUTBOUND a bookauthor COLLECT a1 = a INTO b1 RETURN {author: a1, books: b1[*].book_vertex} `</span></span>); }();</code> </pre><br>  Wir verwenden jetzt f√ºr die Kommunikation kein Dokument, sondern eine Sammlung von Kanten des Diagramms (Rand) des Buchautors.  Die <code>IN OUTBOUND a bookauthor</code> w√§hlt f√ºr einen bestimmten Autor <code>a</code> Sammlung verwandter Dokumente aus, die in der Antwort unter dem Namen <code>book_vertex</code> .  Die <code>COLLECT a1 = a INTO b1</code> Anweisung <code>COLLECT a1 = a INTO b1</code> ist ein Analogon von SQL GROUP - sie akkumuliert einen Wert in einem Array, der in der Antwort unter dem Namen <code>b1</code> f√ºr jeden Wert von Autor <code></code> verf√ºgbar ist, der in der Antwort unter dem Namen <code>a1</code> verf√ºgbar ist.  Mit der Konstruktion <code>b1[*].book_vertex</code> k√∂nnen <code>b1[*].book_vertex</code> unn√∂tige Verschachtelungsebenen aus dem Objekt entfernen, damit das Ergebnis f√ºr weitere Arbeiten geeignet ist. <br><br>  Das Implementieren von SQL-Abfragen vom Typ LEFT JOIN in Arangodb ist schwieriger, weil  Die FOR - FILTER - Anweisung legt Einschr√§nkungen fest, die denen von SQL [INNER] JOIN √§hneln.  Um die "linken Verbindungen" zu implementieren, werden der LET-Oprerator und die Unterabfrage verwendet: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cursor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.query(aql<span class="hljs-string"><span class="hljs-string">` FOR a IN author LET books = ( FOR book_vertex, book_edge IN OUTBOUND a bookauthor RETURN book_vertex ) RETURN {author: a, books} `</span></span>);</code> </pre><br>  In diesem Fall ist seitdem keine Datengruppierung erforderlich  F√ºr jeden Autor wird eine Unterabfrage durchgef√ºhrt, und die Antwort enth√§lt bereits ein gotisches Array von Buchobjekten. <br><br>  Gehen Sie zur orientdb-Datenbank.  Es ist auch eine hybride Datenbank, mit der Sie sowohl mit Dokumenten als auch mit Grafiken arbeiten k√∂nnen.  Die Ideologie der Arbeit mit Graphen √§hnelt dem vorherigen Beispiel in Arangodb.  Das hei√üt, um Sammlungen zu verkn√ºpfen, wird eine Sammlung von Kanten des Buchautorendiagramms verwendet. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OrientDB = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'orientjs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = OrientDB({ <span class="hljs-attr"><span class="hljs-attr">host</span></span>: <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">2424</span></span>, }); <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> db = server.use({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>:<span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.open(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.class.drop(<span class="hljs-string"><span class="hljs-string">'Author UNSAFE'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(ex) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(ex) } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.class.drop(<span class="hljs-string"><span class="hljs-string">'Book UNSAFE'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(ex) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(ex) } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.class.drop(<span class="hljs-string"><span class="hljs-string">'BookAuthor UNSAFE'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(ex) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(ex) } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> author = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.class.create(<span class="hljs-string"><span class="hljs-string">'Author'</span></span>, <span class="hljs-string"><span class="hljs-string">'V'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> book = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.class.create(<span class="hljs-string"><span class="hljs-string">'Book'</span></span>, <span class="hljs-string"><span class="hljs-string">'V'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bookauthor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.class.create(<span class="hljs-string"><span class="hljs-string">'BookAuthor'</span></span>, <span class="hljs-string"><span class="hljs-string">'E'</span></span>); [<span class="hljs-string"><span class="hljs-string">'Joe'</span></span>, <span class="hljs-string"><span class="hljs-string">'John'</span></span>, <span class="hljs-string"><span class="hljs-string">'Jack'</span></span>, <span class="hljs-string"><span class="hljs-string">'Jeremy'</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (name) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> author.create({name}) ); [<span class="hljs-string"><span class="hljs-string">'Art'</span></span>, <span class="hljs-string"><span class="hljs-string">'Paint'</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (title) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> book.create({title}) ); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> author.list(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> book.list(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Author = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.select().from(<span class="hljs-string"><span class="hljs-string">'Author'</span></span>).where({<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Joe'</span></span>}).one(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Book = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.select().from(<span class="hljs-string"><span class="hljs-string">'book'</span></span>).where({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Paint'</span></span> }).one(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.create(<span class="hljs-string"><span class="hljs-string">'EDGE'</span></span>, <span class="hljs-string"><span class="hljs-string">'BookAuthor'</span></span>).from(Author[<span class="hljs-string"><span class="hljs-string">'@rid'</span></span>]).to(Book[<span class="hljs-string"><span class="hljs-string">'@rid'</span></span>]).set({<span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-string"><span class="hljs-string">'Some data'</span></span>}).one(); Author = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.select().from(<span class="hljs-string"><span class="hljs-string">'Author'</span></span>).where({<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'John'</span></span>}).one(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.create(<span class="hljs-string"><span class="hljs-string">'EDGE'</span></span>, <span class="hljs-string"><span class="hljs-string">'BookAuthor'</span></span>).from(Author[<span class="hljs-string"><span class="hljs-string">'@rid'</span></span>]).to(Book[<span class="hljs-string"><span class="hljs-string">'@rid'</span></span>]).set({<span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-string"><span class="hljs-string">'Some data'</span></span>}).one(); Book = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.select().from(<span class="hljs-string"><span class="hljs-string">'book'</span></span>).where({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Art'</span></span> }).one(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.create(<span class="hljs-string"><span class="hljs-string">'EDGE'</span></span>, <span class="hljs-string"><span class="hljs-string">'BookAuthor'</span></span>).from(Author[<span class="hljs-string"><span class="hljs-string">'@rid'</span></span>]).to(Book[<span class="hljs-string"><span class="hljs-string">'@rid'</span></span>]).set({<span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-string"><span class="hljs-string">'Some data'</span></span>}).one(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cursor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> db.query(<span class="hljs-string"><span class="hljs-string">`select name, out('BookAuthor').title as books from Author`</span></span>).all() } ()</code> </pre><br>  Vielleicht hat orientdb die erfolgreichste Implementierung, als  Es kommt der SQL-Syntax am n√§chsten und ist in Bezug auf die Arbeit mit Diagrammen pr√§zise.  Der Ausdruck <code>out('BookAuthor').title as books from Author</code> bedeutet, dass f√ºr die Autorensammlung alle ausgehenden Kanten aus der BookAuthor-Sammlung ausgew√§hlt werden, die die Autorensammlung mit der Buchsammlung verkn√ºpfen.  In diesem Fall ist das resultierende Objekt hierarchisch (ein Objekt f√ºr jeden Autor mit einem Array von Buchobjekten).  Wenn Sie das Array zu einem flachen Objekt "erweitern" m√ºssen, wird der Operator UNWIND verwendet. <br><br>  Und zum Schluss noch einmal √ºberlegen.  Vor nicht allzu langer Zeit hat das Team, das diese Datenbank entwickelt, aufgeh√∂rt zu existieren und die Entwicklung an die offene Community √ºbertragen.  Ich sage das sofort, weil  Jemand k√∂nnte diese Nachricht √ºbersprungen haben.  Vor einer detaillierteren Bekanntschaft schien mir die Implementierung von JOIN in rethinkdb am bequemsten zu sein.  Vielleicht, weil eine solche Gelegenheit sofort in die Datenbank-API aufgenommen und sogar join () genannt wurde.  Aber dann stellte sich heraus, dass nicht alles so rosig ist und nicht alle Funktionen, die JOIN implementieren, gleich effizient arbeiten und ausreichend flexibel sind, um die richtigen Abfragen zu erstellen.  Das gleiche End-to-End-Beispiel ist jetzt auf rethinkdb implementiert: <br><br><pre> <code class="javascript hljs">r = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'rethinkdb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> conn = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.connect({ <span class="hljs-attr"><span class="hljs-attr">host</span></span>: <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-attr"><span class="hljs-attr">port</span></span>: <span class="hljs-number"><span class="hljs-number">28015</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).tableDrop(<span class="hljs-string"><span class="hljs-string">'author'</span></span>).run(conn); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).tableDrop(<span class="hljs-string"><span class="hljs-string">'book'</span></span>).run(conn); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).tableDrop(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>).run(conn); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ex) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(ex) } <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).tableCreate(<span class="hljs-string"><span class="hljs-string">'author'</span></span>).run(conn); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).tableCreate(<span class="hljs-string"><span class="hljs-string">'book'</span></span>).run(conn); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).tableCreate(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>).run(conn); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>).indexCreate(<span class="hljs-string"><span class="hljs-string">'author'</span></span>).run(conn); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>).indexCreate(<span class="hljs-string"><span class="hljs-string">'book'</span></span>).run(conn); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>).indexWait(<span class="hljs-string"><span class="hljs-string">'author'</span></span>, <span class="hljs-string"><span class="hljs-string">'book'</span></span>).run(conn); [<span class="hljs-string"><span class="hljs-string">'Joe'</span></span>, <span class="hljs-string"><span class="hljs-string">'John'</span></span>, <span class="hljs-string"><span class="hljs-string">'Jack'</span></span>, <span class="hljs-string"><span class="hljs-string">'Jeremy'</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (name) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'author'</span></span>).insert({ name }).run(conn) ); [<span class="hljs-string"><span class="hljs-string">'Art'</span></span>, <span class="hljs-string"><span class="hljs-string">'Paint'</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (title) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'book'</span></span>).insert({ title }).run(conn) ); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Author = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'author'</span></span>).filter({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Joe'</span></span> }).run(conn).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">authors</span></span></span><span class="hljs-function"> =&gt;</span></span> authors.next()); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Book = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'book'</span></span>).filter({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Paint'</span></span> }).run(conn).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">books</span></span></span><span class="hljs-function"> =&gt;</span></span> books.next()); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>).insert({<span class="hljs-attr"><span class="hljs-attr">author</span></span>: Author.id, <span class="hljs-attr"><span class="hljs-attr">book</span></span>: Book.id}).run(conn); Author = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'author'</span></span>).filter({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'John'</span></span> }).run(conn).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">authors</span></span></span><span class="hljs-function"> =&gt;</span></span> authors.next()); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>).insert({<span class="hljs-attr"><span class="hljs-attr">author</span></span>: Author.id, <span class="hljs-attr"><span class="hljs-attr">book</span></span>: Book.id}).run(conn); Book = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'book'</span></span>).filter({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Art'</span></span> }).run(conn).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">books</span></span></span><span class="hljs-function"> =&gt;</span></span> books.next()); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>).insert({<span class="hljs-attr"><span class="hljs-attr">author</span></span>: Author.id, <span class="hljs-attr"><span class="hljs-attr">book</span></span>: Book.id}).run(conn); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cursor = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'author'</span></span>) .eqJoin(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'bookauthor'</span></span>), {<span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-string"><span class="hljs-string">'author'</span></span>}).zip() .eqJoin(<span class="hljs-string"><span class="hljs-string">'book'</span></span>, r.db(<span class="hljs-string"><span class="hljs-string">'test'</span></span>).table(<span class="hljs-string"><span class="hljs-string">'book'</span></span>)).zip().run(conn); }();</code> </pre><br>  Sie sollten auf solche Punkte achten.  In diesem Beispiel wurde die Sekund√§rindexkommunikation mithilfe der Funktion eqJoin () implementiert, die beim Verbinden von Objekten Paare verwenden kann: einen Prim√§rschl√ºssel mit einem Prim√§rschl√ºssel oder einen Prim√§rschl√ºssel mit einem Sekund√§rschl√ºssel (jedoch keinen Sekund√§rschl√ºssel mit einem Sekund√§rschl√ºssel).  F√ºr komplexere Bedingungen wird die Funktion map () verwendet, die um eine Gr√∂√üenordnung schwieriger zu verstehen ist.  Andere Funktionen, die JOIN implementieren, sind nicht optimiert (vermutlich wird eine vollst√§ndige Aufz√§hlung der Werte implementiert). <br><br>  Der Text der Beispiele befindet sich im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> . <br><br>  apapacy@gmail.com <br>  4. Juni 2018 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413123/">https://habr.com/ru/post/de413123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413111/index.html">STM32 + NetBeans =?</a></li>
<li><a href="../de413113/index.html">Klasse JavaScript Unterst√ºtzung der JavaScript-Serialisierung</a></li>
<li><a href="../de413117/index.html">So programmieren Sie sicher in Bash</a></li>
<li><a href="../de413119/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 317 (28. Mai - 3. Juni 2018)</a></li>
<li><a href="../de413121/index.html">Fototour von Moskau Coworking #tceh</a></li>
<li><a href="../de413125/index.html">Die Gentherapie gibt kleinen Patienten mit Muskelatrophie eine √úberlebenschance</a></li>
<li><a href="../de413127/index.html">Ein paar Worte zur tats√§chlichen Leistung des Hypervisors</a></li>
<li><a href="../de413129/index.html">25 Fehler ein Anf√§nger Programmierer</a></li>
<li><a href="../de413133/index.html">Beliebte Antimuster: Paginierung</a></li>
<li><a href="../de413135/index.html">Code-Review-Testzuweisung von Junior-React-Entwicklern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>