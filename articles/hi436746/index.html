<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЫНя╕П ЁЯЩПЁЯП╝ ЁЯХ┤я╕П рдЗрд╕рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдХреИрд╕реЗ рдиреАрдЪрд╛ рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рдП ЁЯСйЁЯП╝тАНтЬИя╕П ЁЯзЪЁЯП╗ ЁЯСйтАНтЪЦя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╣рдо рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдЪрд╛рд╣рддреЗ рдереЗ, рд▓реЗрдХрд┐рди рдпрд╣ рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣ рдирд┐рдХрд▓рд╛ред 
 рд╡рд┐рдХреНрдЯрд░ рдЪреЗрд░реНрдиреЛрдорд┐рд░рд┐рди, 
 рд░реВрд╕реА рд░рд╛рдЬрдиреЗрддрд╛ 


 рдЬрд╝рд┐рдиреНрджрдЧреА рдореЗрдВ рдХрдИ рдмрд╛рд░ рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдЖрдк рд╕рдм рдХреБрдЫ рд╕рд╣реА рдХрд░рддреЗ рдирдЬ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЗрд╕рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░рдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдХреИрд╕реЗ рдиреАрдЪрд╛ рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рдП</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436746/"><p> <em>рд╣рдо рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рдЪрд╛рд╣рддреЗ рдереЗ, рд▓реЗрдХрд┐рди рдпрд╣ рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣ рдирд┐рдХрд▓рд╛ред</em> <br>  рд╡рд┐рдХреНрдЯрд░ рдЪреЗрд░реНрдиреЛрдорд┐рд░рд┐рди, <br>  рд░реВрд╕реА рд░рд╛рдЬрдиреЗрддрд╛ </p><br><p>  рдЬрд╝рд┐рдиреНрджрдЧреА рдореЗрдВ рдХрдИ рдмрд╛рд░ рдРрд╕рд╛ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдЖрдк рд╕рдм рдХреБрдЫ рд╕рд╣реА рдХрд░рддреЗ рдирдЬрд╝рд░ рдЖрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреБрдЫ рдЧрд▓рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред <br>  рдпрд╣ рдХрд╣рд╛рдиреА рдРрд╕реЗ рд╣реА рдПрдХ рдорд╛рдорд▓реЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИред </p><a name="habracut"></a><br><p>  рдПрдХ рдмрд╛рд░ рдореИрдВрдиреЗ рдЗрд╕ рдХреЛрдб рдХреЛ рджреЗрдЦрд╛ рдФрд░ рдЗрд╕реЗ рдЧрддрд┐ рджреЗрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪрд╛: </p><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendBounds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex = data.beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex = data.endIndex; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder() .append(<span class="hljs-string"><span class="hljs-string">'L'</span></span>) .append(data.str, beginIndex, endIndex) .append(<span class="hljs-string"><span class="hljs-string">';'</span></span>) .toString(); }</code> </pre> <br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдореИрдВ рдЪрд░ рдХреА рдХреБрд▓ рд▓рдВрдмрд╛рдИ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рд░рд╣рд╛ рд╣реВрдВ рдЪрд░ <code>beginIndex</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ <code>beginIndex</code> рдФрд░ <code>endIndex</code> (рд╕рд╛рде рд╣реА рдЗрд╕ рддрдереНрдп рдХреЗ рд╕рд╛рде рдХрд┐ рдЫрдВрдЯрдиреА рдХреА рдЧрдИ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕реНрдЯреНрд░реАрдВрдЧрдмреБрдЗрдЯ рдореЗрдВ 2 рдФрд░ рдкрд╛рддреНрд░реЛрдВ рдХреЛ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛), рдФрд░ рдЖрд╡рд╢реНрдпрдХ рдорд╛рди рдХреЗ рдЖрдХрд╛рд░ рдХрд╛ рдЪрдпрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдореВрд▓реНрдп рдХреЛ рддреБрд░рдВрдд рд╕реНрдЯреНрд░рд┐рдВрдЧ рдирд┐рд░реНрдорд╛рддрд╛ рдХреЗ рдкрд╛рд╕ рджреЗрдВред ред  рдпрд╣ рд╡рд┐рдЪрд╛рд░ рдореБрдЭреЗ рдмрд╣реБрдд рд╕реНрдкрд╖реНрдЯ рд▓рдЧрд╛, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдХреБрдЫ рдФрд░ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреАред  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдЗрд╕ рдХреЛрдб рдХреЛ "рдЖрдЗрдбрд┐рдпрд╛" рджреНрд╡рд╛рд░рд╛ рд╣рд╛рдЗрд▓рд╛рдЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬрд┐рд╕рдиреЗ рдореБрдЭреЗ рд╕рд╣реА рд╡рд┐рдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд┐рдпрд╛, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдЪрддреБрд░ рд▓рдбрд╝рдХреА рдЖрдорддреМрд░ рдкрд░ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд╕реНрдерд╛рди рдкрд░ рд╢реЙрд░реНрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдмрджрд▓рдиреЗ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрддреА рд╣реИ <code>StringBuilder::append</code> рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХреЗ рд╕рд╛рде <code>StringBuilder::append</code> рдХрд░реЗрдВ, рдЬреЛ рдЫреЛрдЯрд╛ рдФрд░ рдкрдврд╝рдиреЗ рдореЗрдВ рдЖрд╕рд╛рди рд╣реИред </p><br><p>  рдЗрд╕ рд╕рд░рд▓реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рдзрд╛ <code>StringBuilder.append(CharSequence, int, int)</code> рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реИред  рдпрд╣ рджреЗрдЦрддреЗ рд╣реБрдП рдХрд┐ <code>data.str</code> рдлрд╝реАрд▓реНрдб рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реИ, <code>String.substring(beginIndex, endIndex)</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ <code>String.substring(beginIndex, endIndex)</code> рдЖрдк рдЗрд╕рдореЗрдВ рд╕реЗ рдПрдХ рд╡рд┐рдХрд▓реНрдк рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ <code>StringBuilder.append(String)</code> рдХреЛ рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рд░реВрдкрд╛рдВрддрд░рдг рдХреЗ рдмрд╛рдж рдХреЛрдб: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendBounds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex = data.beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex = data.endIndex; String subString = data.str.substring(beginIndex, endIndex); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder() .append(<span class="hljs-string"><span class="hljs-string">'L'</span></span>) .append(subString) .append(<span class="hljs-string"><span class="hljs-string">';'</span></span>) .toString(); }</code> </pre> <br><p>  рдФрд░ рдЕрдм рдЖрдЗрдбрд┐рдпрд╛ рдПрдХ рд╕рд░рд▓реАрдХрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendBounds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex = data.beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex = data.endIndex; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'L'</span></span> + data.str.substring(beginIndex, endIndex) + <span class="hljs-string"><span class="hljs-string">';'</span></span>; }</code> </pre> <br><p>  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдорд╛рд░рд╛ рд▓рдХреНрд╖реНрдп рдЙрддреНрдкрд╛рджрдХрддрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрддрдиреА рдкрдардиреАрдпрддрд╛ рдирд╣реАрдВ рд╣реИред  рджреЛрдиреЛрдВ рддрд░реАрдХреЛрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░реЗрдВ: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@BenchmarkMode</span></span>(Mode.AverageTime) <span class="hljs-meta"><span class="hljs-meta">@OutputTimeUnit</span></span>(TimeUnit.NANOSECONDS) <span class="hljs-meta"><span class="hljs-meta">@Fork</span></span>(jvmArgsAppend = {<span class="hljs-string"><span class="hljs-string">"-Xms2g"</span></span>, <span class="hljs-string"><span class="hljs-string">"-Xmx2g"</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilderAppendBenchmark</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendSubString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ String latinStr = data.latinStr; String nonLatinStr = data.nonLatinStr; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex = data.beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex = data.endIndex; String substring = data.nonLatin ? nonLatinStr.substring(beginIndex, endIndex) : latinStr.substring(beginIndex, endIndex); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder() .append(<span class="hljs-string"><span class="hljs-string">'L'</span></span>) .append(substring) .append(<span class="hljs-string"><span class="hljs-string">';'</span></span>) .toString(); } <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendBounds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ String latinStr = data.latinStr; String nonLatinStr = data.nonLatinStr; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex = data.beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex = data.endIndex; String appended = data.nonLatin ? nonLatinStr : latinStr; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder() .append(<span class="hljs-string"><span class="hljs-string">'L'</span></span>) .append(appended, beginIndex, endIndex) .append(<span class="hljs-string"><span class="hljs-string">';'</span></span>) .toString(); } <span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Thread) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Data</span></span></span><span class="hljs-class"> </span></span>{ String latinStr; String nonLatinStr; <span class="hljs-meta"><span class="hljs-meta">@Param</span></span>({<span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-string"><span class="hljs-string">"false"</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> nonLatin; <span class="hljs-meta"><span class="hljs-meta">@Param</span></span>({<span class="hljs-string"><span class="hljs-string">"5"</span></span>, <span class="hljs-string"><span class="hljs-string">"10"</span></span>, <span class="hljs-string"><span class="hljs-string">"50"</span></span>, <span class="hljs-string"><span class="hljs-string">"100"</span></span>, <span class="hljs-string"><span class="hljs-string">"500"</span></span>, <span class="hljs-string"><span class="hljs-string">"1000"</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ThreadLocalRandom random = ThreadLocalRandom.current(); <span class="hljs-meta"><span class="hljs-meta">@Setup</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ latinStr = randomString(<span class="hljs-string"><span class="hljs-string">"abcdefghijklmnopqrstuvwxyz"</span></span>); nonLatinStr = randomString(<span class="hljs-string"><span class="hljs-string">""</span></span>); beginIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; endIndex = length + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randomString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String alphabet)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = alphabet.toCharArray(); StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(length + <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; length + <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c = chars[random.nextInt(chars.length)]; sb.append(c); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.toString(); } } }</code> </pre> <br><p>  рдмреЗрдВрдЪрдорд╛рд░реНрдХ рджреЛ рдкреЗрдиреА рдХреЗ рд╕рдорд╛рди рд╕рд░рд▓ рд╣реИ: рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рд╕реНрдЯреНрд░рд┐рдВрдЧрдмрд░реНрдмреНрдпреВрд▓ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЖрдХрд╛рд░ <code>length</code> рдХреНрд╖реЗрддреНрд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЬрдм рд╕реЗ рдпрд╛рд░реНрдб 2019 рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЗрд╕реЗ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдВрдЪрдирд╛ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рдореБрдЦреНрдп рд▓реИрдЯрд┐рди рд╡рд░реНрдгрдорд╛рд▓рд╛ (рддрдерд╛рдХрдерд┐рдд рд╕рдВрдкреАрдбрд╝рд┐рдд рд▓рд╛рдЗрди), рдЬрд┐рд╕рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рд┐рддреНрд░ рдХреЗ рдЕрдХреНрд╖рд░ рд╣реЛрддреЗ рд╣реИрдВред 1 рдмрд╛рдЗрдЯ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреА рд╣реИ), рдФрд░ рдЧреИрд░-рд▓реИрдЯрд┐рди рд╡рд░реНрдгреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ (рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рд┐рддреНрд░ 2 рдмрд╛рдЗрдЯреНрд╕ рджреНрд╡рд╛рд░рд╛ рджрд░реНрд╢рд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ)ред </p><br><p>  рдПрдХ рд╕рд░рд╕рд░реА рдкрд░реАрдХреНрд╖рд╛ рдкрд░, <code>appendSubString</code> рд╡рд┐рдзрд┐ рд╣рдореЗрдВ рдзреАрдореА <code>appendSubString</code> рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ <code>appendBounds</code> рд╡рд┐рдзрд┐ рдХреЗ рд╕рд╛рде рдЪрд┐рдкрдХреЗ рд╣реБрдП рдбреЗрдЯрд╛ рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐, <code>appendSubString</code> рд╡рд┐рдзрд┐ рдореЗрдВ рдПрдХ <code>appendSubString</code> рдПрдХ рд╕реНрдкрд╖реНрдЯ рдирд┐рд░реНрдорд╛рдг рднреА рд╣реИ, рдЕрд░реНрдерд╛рддреН, рдПрдХ рдирдИ рд╡рд╕реНрддреБ рдХреЗ рд▓рд┐рдП рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрд┐рдд рдХрд░рдирд╛ рдФрд░ <code>data.latinStr</code> рд╕реЗ рд╕рд╛рдордЧреНрд░реА рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдирд╛ред / <code>data.nonLatinStr</code> ред </p><br><p>  рд╕рднреА рдЕрдзрд┐рдХ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ (рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдкрд╣рд▓реА рдирдЬрд╝рд░ рдореЗрдВ) рдПрдХ рдШрд░реЗрд▓реВ рдорд╢реАрди (рдЗрдВрдЯреЗрд▓ рдХреЛрд░ i5-4690, 3.50 GHz) рдкрд░ JDK11 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореЗрд░реЗ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рдорд╛рдк рдХреЗ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рддреАрдд рд╣реЛрддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">Benchmark nonLatin length Score Error Units appendBounds true 5 44,6 ┬▒ 0,4 ns/op appendBounds true 10 45,7 ┬▒ 0,7 ns/op appendBounds true 50 129,0 ┬▒ 0,5 ns/op appendBounds true 100 218,7 ┬▒ 0,8 ns/op appendBounds true 500 907,1 ┬▒ 5,5 ns/op appendBounds true 1000 1626,4 ┬▒ 13,0 ns/op appendSubString true 5 28,6 ┬▒ 0,2 ns/op appendSubString true 10 30,8 ┬▒ 0,2 ns/op appendSubString true 50 65,6 ┬▒ 0,4 ns/op appendSubString true 100 106,6 ┬▒ 0,6 ns/op appendSubString true 500 430,1 ┬▒ 2,4 ns/op appendSubString true 1000 839,1 ┬▒ 8,6 ns/op appendBounds:┬╖gc.alloc.rate.norm true 5 184,0 ┬▒ 0,0 B/op appendBounds:┬╖gc.alloc.rate.norm true 10 200,0 ┬▒ 0,0 B/op appendBounds:┬╖gc.alloc.rate.norm true 50 688,0 ┬▒ 0,0 B/op appendBounds:┬╖gc.alloc.rate.norm true 100 1192,0 ┬▒ 0,0 B/op appendBounds:┬╖gc.alloc.rate.norm true 500 5192,0 ┬▒ 0,0 B/op appendBounds:┬╖gc.alloc.rate.norm true 1000 10200,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm true 5 136,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm true 10 160,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm true 50 360,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm true 100 608,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm true 500 2608,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm true 1000 5104,0 ┬▒ 0,0 B/op appendBounds false 5 20,8 ┬▒ 0,1 ns/op appendBounds false 10 24,0 ┬▒ 0,2 ns/op appendBounds false 50 66,4 ┬▒ 0,4 ns/op appendBounds false 100 111,0 ┬▒ 0,8 ns/op appendBounds false 500 419,2 ┬▒ 2,7 ns/op appendBounds false 1000 840,4 ┬▒ 7,8 ns/op appendSubString false 5 25,3 ┬▒ 0,3 ns/op appendSubString false 10 25,7 ┬▒ 0,2 ns/op appendSubString false 50 36,0 ┬▒ 0,1 ns/op appendSubString false 100 52,8 ┬▒ 0,4 ns/op appendSubString false 500 206,1 ┬▒ 6,1 ns/op appendSubString false 1000 388,1 ┬▒ 1,6 ns/op appendBounds:┬╖gc.alloc.rate.norm false 5 80,0 ┬▒ 0,0 B/op appendBounds:┬╖gc.alloc.rate.norm false 10 88,0 ┬▒ 0,0 B/op appendBounds:┬╖gc.alloc.rate.norm false 50 320,0 ┬▒ 0,0 B/op appendBounds:┬╖gc.alloc.rate.norm false 100 544,0 ┬▒ 0,0 B/op appendBounds:┬╖gc.alloc.rate.norm false 500 2144,0 ┬▒ 0,0 B/op appendBounds:┬╖gc.alloc.rate.norm false 1000 4152,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm false 5 96,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm false 10 112,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm false 50 192,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm false 100 288,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm false 500 1088,0 ┬▒ 0,0 B/op appendSubString:┬╖gc.alloc.rate.norm false 1000 2088,0 ┬▒ 0,0 B/op</code> </pre> <br><p>  рд╣рдорд╛рд░реА рдзрд╛рд░рдгрд╛ рдХрд╛ рдЦрдВрдбрди рдХрд░рддреЗ рд╣реБрдП, рдЕрдзрд┐рдХрд╛рдВрд╢ рдорд╛рдорд▓реЛрдВ рдореЗрдВ (рдиреЙрди-рд▓реИрдЯрд┐рди рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЗ рд▓рд┐рдП рд╣рдореЗрд╢рд╛ рд╕рд╣рд┐рдд) <code>appendSubString</code> рд╡рд┐рдзрд┐ рддреЗрдЬреА рд╕реЗ рдФрд░ рдХрдо рдЧреНрд▓реВрдЯреЛрдирд╕ (рднрд▓реЗ рд╣реА <code>String::substring</code> рдПрдХ рдирдИ рд╡рд╕реНрддреБ рджреЗрддрд╛ рд╣реИ) рдирд┐рдХрд▓рд╛ред  рдпрд╣ рдХреИрд╕реЗ рд╣реБрдЖ? </p><br><h2 id="smotryu-v-knigu-vizhu-figu">  рдореИрдВ рдХрд┐рддрд╛рдм рдореЗрдВ рджреЗрдЦрддрд╛ рд╣реВрдВ, рдореБрдЭреЗ рдПрдХ рдЕрдВрдЬреАрд░ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИ </h2><br><p>  <code>StringBuilder</code> рд╕реНрд░реЛрдд рдХреЛрдб рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рдиреЗ рд╕реЗ рдЧреЛрдкрдиреАрдпрддрд╛ <code>StringBuilder</code> рдкрд░реНрджрд╛ <code>StringBuilder</code> рдорджрдж рдорд┐рд▓реЗрдЧреАред  рджреЛрдиреЛрдВ рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ рд╡рд┐рдзрд┐рдпрд╛рдБ <code>AbstractStringBuilder</code> рдХреЗ рд╕рдорд╛рди рддрд░реАрдХреЛрдВ рд╕реЗ рдХреЙрд▓ рдкрд╛рд╕ рдХрд░рддреА рд╣реИрдВ: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractStringBuilder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">io</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Comparable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CharSequence</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.append(str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CharSequence s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.append(s, start, end); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre> <br><p>  <code>AbstractStringBuilder.append(String)</code> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AbstractStringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> appendNull(); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = str.length(); ensureCapacityInternal(count + len); putStringAt(count, str); count += len; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putStringAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getCoder() != str.coder()) { inflate(); } str.getBytes(value, index, coder); }</code> </pre> <br><p>  рдпрд╣рд╛рдБ рдХреНрдпрд╛ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ?  <code>AbstractStringBuilder::inflate</code> рдирд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ <code>AbstractStringBuilder::inflate</code> , рдЕрд╕рдорд╛рди рддрд╛рд░ рдХрд╛ рд╕рдВрдпреЛрдЬрди рдХрд░рддреЗ рд╕рдордп <code>AbstractStringBuilder.value</code> рд╕рд░рдгреА рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдбреЗрдЯрд╛ рдХреЛ <code>String::getBytes</code> рдореЗрдВ <code>String::getBytes</code> рдЧрдпрд╛ рд╣реИ: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBytes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] dst, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dstBegin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> coder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (coder() == coder) { System.arraycopy(value, <span class="hljs-number"><span class="hljs-number">0</span></span>, dst, dstBegin &lt;&lt; coder, value.length); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// this.coder == LATIN &amp;&amp; coder == UTF16 StringLatin1.inflate(value, 0, dst, dstBegin, value.length); } }</span></span></code> </pre> <br><p>  рдХреНрдпрд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ?  рдпрджрд┐ рддрд╛рд░ рд╕рдорд░реВрдк рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдЖрдВрддрд░рд┐рдХ <code>System::arraycopy</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЕрдиреНрдпрдерд╛ <code>StringLatin1::inflate</code> рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рдордВрдбрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣рдореЗрдВ <code>StringUTF16::inflate</code> рдУрд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// inflatedCopy byte[] -&gt; byte[] @HotSpotIntrinsicCandidate public static void inflate(byte[] src, int srcOff, byte[] dst, int dstOff, int len) { // We need a range check here because 'putChar' has no checks checkBoundsOffCount(dstOff, len, dst); for (int i = 0; i &lt; len; i++) { putChar(dst, dstOff++, src[srcOff++] &amp; 0xff); } } @HotSpotIntrinsicCandidate static void putChar(byte[] val, int index, int c) { assert index &gt;= 0 &amp;&amp; index &lt; length(val) : "Trusted caller missed bounds check"; index &lt;&lt;= 1; val[index++] = (byte)(c &gt;&gt; HI_BYTE_SHIFT); val[index] = (byte)(c &gt;&gt; LO_BYTE_SHIFT); }</span></span></code> </pre> <br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдпрджрд┐ рдкрдВрдХреНрддрд┐рдпрд╛рдБ рд╕рдЬрд╛рддреАрдп рд╣реИрдВ, рддреЛ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо-рдЖрд╢реНрд░рд┐рдд рд╡рд┐рдзрд┐ <code>System::arraycopy</code> рдХреЛ рдбреЗрдЯрд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЕрдиреНрдпрдерд╛ рдПрдХ рд▓реВрдк (рдЖрдВрддрд░рд┐рдХ рднреА) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдЬрдм рджреЛ рд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдЧреНрд▓реВрдЗрдВрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд╣рд╛рдВ рд╕рднреА рд╡рд░реНрдг рдореБрдЦреНрдп рд▓реИрдЯрд┐рди рд╡рд░реНрдгрдорд╛рд▓рд╛ рдХреЗ рд╕реЗрдЯ рдореЗрдВ рд╣реЛрддреЗ рд╣реИрдВ (рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, 1 рдмрд╛рдЗрдЯ рдореЗрдВ рдлрд┐рдЯ рд╣реЛрддреЗ рд╣реИрдВ), рддреЛ рдкреНрд░рджрд░реНрд╢рди рд╡рд┐рд╖рдо рд▓рд╛рдЗрдиреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдмрд╣реБрдд рдмреЗрд╣рддрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдЗрд╕рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИ ( <code>nonLatin = false</code> рд▓рд┐рдП рдЖрдЙрдЯрдкреБрдЯ рджреЗрдЦреЗрдВ)ред </p><br><p>  рдЕрдм <code>AbstractStringBuilder.append(CharSequence, int, int)</code> рд╡рд┐рдзрд┐ <code>AbstractStringBuilder.append(CharSequence, int, int)</code> : </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AbstractStringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CharSequence s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { s = <span class="hljs-string"><span class="hljs-string">"null"</span></span>; } checkRange(start, end, s.length()); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = end - start; ensureCapacityInternal(count + len); appendChars(s, start, end); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendChars</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CharSequence s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> off, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isLatin1()) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] val = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = off, j = count; i &lt; end; i++) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c = s.charAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StringLatin1.canEncode(c)) { val[j++] = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)c; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { count = j; inflate(); StringUTF16.putCharsSB(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value, j, s, i, end); count += end - i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { StringUTF16.putCharsSB(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value, count, s, off, end); } count += end - off; }</code> </pre> <br><p>  рдпрд╣рд╛рдВ, рджреГрд╖реНрдЯрд┐рдХреЛрдг рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдПрдХ рдХреЗ рд╕рдорд╛рди рд╣реИ: рд╕рдЬрд╛рддреАрдп рддрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП, рдПрдХ рд╕рд░рд▓ рддрдВрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдпрд╣рд╛рдВ, рдПрдХ рдкрд╛рд╢ рдореЗрдВ рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рд╕рд╛рдЗрди рдЗрди рдХрд░реЗрдВ), рд╡рд┐рд╖рдо рддрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рд╣рдо <code>StringUTF16</code> рдЙрдкрдпреЛрдЧ <code>StringUTF16</code> , рд╣рд╛рд▓рд╛рдВрдХрд┐, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ <code>StringUTF16::putCharsSB</code> рдЖрдВрддрд░рд┐рдХ рдирд╣реАрдВ рдХрд╣рд╛ рдЧрдпрд╛ <code>StringUTF16::putCharsSB</code> ред </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putCharsSB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] val, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, CharSequence s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> off, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ checkBoundsBeginEnd(index, index + end - off, val); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = off; i &lt; end; i++) { putChar(val, index++, s.charAt(i)); } }</code> </pre> <br><p>  рддреЛ, рджреЛрдиреЛрдВ рддрд░реАрдХреЛрдВ рдХреА рдЖрдВрддрд░рд┐рдХ рд╕рдВрд░рдЪрдирд╛ рдФрд░ рдЙрдирдХреЗ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкреНрд░рджрд░реНрд╢рди рдХрд╛ рдХрд╛рд░рдг рдХрдореЛрдмреЗрд╢ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд╕реНрдкрд╖реНрдЯ рд╣реИред  рд╕рд╡рд╛рд▓ рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ рдЙрдарддрд╛ рд╣реИ - рдЖрдЧреЗ рдкреНрд░рд╛рдкреНрдд рдЬреНрдЮрд╛рди рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ?  рдПрдХ рд╕рд╛рде рдХрдИ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ: </p><br><p>  1) рдЗрд╕реЗ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦреЗрдВ рдФрд░ рдЬрдм рдпрд╣ рдПрдХ рд╕рдВрджрд┐рдЧреНрдз рдХреЛрдб рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рд╣рд╛рде рд╕реЗ рдмрджрд▓ рджреЗрдВ <br>  2) рдЯреИрдЧрд┐рд░ рдХреЗ рдкрд╛рд╕ рдЬрд╛рдУ рдФрд░ рдЙрд╕реЗ рдПрдХ рдЪреЗрдХ рджрд╛рдпрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣реЗрдВ рдЬреЛ рд╣рдорд╛рд░реЗ рдмрдЬрд╛рдп рдХрд╛рдо рдХрд░реЗрдЧрд╛ <br>  3) рдЬреЗрдбреАрдХреЗ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдХреЛрдб рдмрд┐рд▓реНрдХреБрд▓ рднреА рди рдмрджрд▓реЗред </p><br><p>  рдмреЗрд╢рдХ, рд╣рдо рддреАрд╕рд░реЗ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдореМрдХрд╛ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВ? </p><br><h2 id="pogruzhenie-v-puchinu">  Deeps рдореЗрдВ рдиреАрдЪреЗ </h2><br><p>  рд╣рдо рдкреНрд░рд╢рд┐рдХреНрд╖рдг рджреЗрдВрдЧреЗ <del>  рдмрд┐рд▓реНрд▓рд┐рдпреЛрдВ рдкрд░ </del>  рдЧреНрдпрд╛рд░рд╣рд╡реЗрдВ рдЬрд╛рд╡рд╛ рдХреЗ рд╕реНрд░реЛрдд рдХреЛрдб рдкрд░, рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрдВ</a> ред </p><br><p>  рд╕реБрдзрд╛рд░ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рд╕рд░рд▓ рдФрд░ рд╕реНрдкрд╖реНрдЯ рддрд░реАрдХрд╛ рд╣реИ рдХрд┐ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА <code>AbstractStringBuilder.append(CharSequence, int, int)</code> рд╡рд┐рдзрд┐ рдХреЗ рдЕрдВрджрд░ рдПрдХ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  public AbstractStringBuilder append(CharSequence s, int start, int end) { if (s == null) { s = "null"; } checkRange(start, end, s.length()); int len = end - start; ensureCapacityInternal(count + len); appendChars(s, start, end); return this; } //  public AbstractStringBuilder append(CharSequence s, int start, int end) { if (s == null) { s = "null"; } checkRange(start, end, s.length()); return append(s.subSequence(start, end).toString()); }</span></span></code> </pre> <br><p>  рдЕрдм рдЖрдкрдХреЛ JDK рдмрдирд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ, рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдПрдВ рдФрд░ рдЙрд╕ рдкрд░ <code>StringBuilderAppendBenchmark::appendBounds</code> рдмреЗрдВрдЪрдорд╛рд░реНрдХ <code>StringBuilderAppendBenchmark::appendBounds</code> , рдЬрд┐рд╕рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреА рддреБрд▓рдирд╛ рдореВрд▓ JDK рдкрд░ рдПрдХ рд╣реА рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЗ рд╕рд╛рде рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="plaintext hljs">#   before      JDK, # after -   Benchmark nonLatin length before after Units avgt true 5 44,6 64,4 ns/op avgt true 10 45,7 66,3 ns/op avgt true 50 129,0 168,9 ns/op avgt true 100 218,7 281,9 ns/op avgt true 500 907,1 1116,2 ns/op avgt true 1000 1626,4 2002,5 ns/op gc.alloc.rate.norm true 5 184,0 264,0 B/op gc.alloc.rate.norm true 10 200,0 296,0 B/op gc.alloc.rate.norm true 50 688,0 904,0 B/op gc.alloc.rate.norm true 100 1192,0 1552,0 B/op gc.alloc.rate.norm true 500 5192,0 6752,0 B/op gc.alloc.rate.norm true 1000 10200,0 13256,0 B/op avgt false 5 20,8 38,0 ns/op avgt false 10 24,0 37,8 ns/op avgt false 50 66,4 82,9 ns/op avgt false 100 111,0 138,8 ns/op avgt false 500 419,2 531,9 ns/op avgt false 1000 840,4 1002,7 ns/op gc.alloc.rate.norm false 5 80,0 152,0 B/op gc.alloc.rate.norm false 10 88,0 168,0 B/op gc.alloc.rate.norm false 50 320,0 440,0 B/op gc.alloc.rate.norm false 100 544,0 688,0 B/op gc.alloc.rate.norm false 500 2144,0 2688,0 B/op gc.alloc.rate.norm false 1000 4152,0 5192,0 B/op</code> </pre> <br><p>  рдХреНрдпрд╛ рдХрд╣рддреЗ рд╣реИрдВ, рдЕрдЪрд╛рдирдХ!  рд╕реБрдзрд╛рд░ рди рдХреЗрд╡рд▓ рд╣реБрдЖ, рдмрд▓реНрдХрд┐ рдЧрд┐рд░рд╛рд╡рдЯ рднреА рд╣реБрдИред  рд▓рд╛рдирдд рд╣реИ, рд▓реЗрдХрд┐рди рдХреИрд╕реЗ? </p><br><p>  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдмрд╣реБрдд рд╢реБрд░реБрдЖрдд рдореЗрдВ, <code>StringBuilder::append</code> рд╡рд┐рдзрд┐ рдХреЗ рд╡рд┐рд╡рд░рдг рдореЗрдВ <code>StringBuilder::append</code> рдореИрдВрдиреЗ рдПрдХ рдЫреЛрдЯреА, рд▓реЗрдХрд┐рди рдЧрдВрднреАрд░ рд░реВрдк рд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЪреВрдХ рдХреАред  рд╡рд┐рдзрд┐ рдЗрд╕ рддрд░рд╣ рд╡рд░реНрдгрд┐рдд рдереА: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.append(str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre> <br><p>  рдФрд░ рдпрд╣рд╛рдБ рдЗрд╕рдХрд╛ рдкреВрд░рд╛ рджреГрд╢реНрдп рд╣реИ: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-meta"><span class="hljs-meta">@HotSpotIntrinsicCandidate</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.append(str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre> <br><p>  рдЬрд╛рд╡рд╛ рдХреЛрдб рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдКрдкрд░ рдЬрд╛рдВрдЪрд╛, рд╕реА 2 рд╕реНрддрд░ рдкрд░ рдЧрд░реНрдо рдФрд░ рд╕рдВрдХрд▓рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛, рдЗрд╕рд╕реЗ рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдВрддрд░рд┐рдХред  рдпрд╣ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">async-profiler</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЛ рд╣рдЯрд╛рдХрд░ рд╕рд╛рдмрд┐рдд рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред  рдЗрд╕рдХреЗ рдмрд╛рдж, рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЛ <code>length = 1000</code> рдФрд░ <code>nonLatin = true</code> - <code>nonLatin = true</code> рд▓рд┐рдП рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ <code>nonLatin = true</code> : </p><br><pre> <code class="plaintext hljs">#   `appendSubString`, JDK    ns percent samples top ---------- ------- ------- --- 19096340914 43.57% 1897673 jbyte_disjoint_arraycopy &lt;--------- 13500185356 30.80% 1343343 jshort_disjoint_arraycopy &lt;--------- 4124818581 9.41% 409533 java.lang.String.&lt;init&gt; #   2177311938 4.97% 216375 java.lang.StringUTF16.compress #   1557269661 3.55% 154253 java.util.Arrays.copyOfRange #   349344451 0.80% 34823 appendSubString_avgt_jmhStub 279803769 0.64% 27862 java.lang.StringUTF16.newString 274388920 0.63% 27312 org.openjdk.jmh.infra.Blackhole.consume 160962540 0.37% 15946 SpinPause 122418222 0.28% 11795 __memset_avx2</code> </pre> <br><p>  <code>StringBuilder</code> (рдФрд░ <code>AbstractStringBuilder</code> ) рдХрд╛ рдХреЛрдб рдпрд╣рд╛рдВ рднреА рдЧрдВрдз рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рдЧрднрдЧ 3/4 рдкрд░ рдПрдХ рдЖрдВрддрд░рд┐рдХ рджреНрд╡рд╛рд░рд╛ рдХрдмреНрдЬрд╛ рдХрд░ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдореИрдВ рд╣рдорд╛рд░реЗ "рдмреЗрд╣рддрд░" <code>StringBuilder.append(CharSequence, int, int)</code> рдХреЗ рдкреНрд░реЛрдлрд╛рдЗрд▓ рдореЗрдВ рдПрдХ рд╣реА рддрд╕реНрд╡реАрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ред </p><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдпрд╣ рд╣реИ: </p><br><pre> <code class="plaintext hljs"> ns percent samples top ---------- ------- ------- --- 19071221451 43.78% 1897827 jbyte_disjoint_arraycopy 6409223440 14.71% 638348 jlong_disjoint_arraycopy 3933622128 9.03% 387403 java.lang.StringUTF16.newBytesFor 2067248311 4.75% 204193 java.lang.AbstractStringBuilder.ensureCapacityInternal 1929218737 4.43% 194751 java.lang.StringUTF16.compress 1678321343 3.85% 166458 java.util.Arrays.copyOfRange 1621470408 3.72% 160849 java.lang.String.checkIndex 969180099 2.22% 96018 java.util.Arrays.copyOf 581600786 1.34% 57818 java.lang.AbstractStringBuilder.&lt;init&gt; 417818533 0.96% 41611 appendBounds_jmhTest 406565329 0.93% 40479 java.lang.String.&lt;init&gt; 340972882 0.78% 33727 java.lang.AbstractStringBuilder.append 299895915 0.69% 29982 java.lang.StringBuilder.toString 183885595 0.42% 18136 SpinPause 168666033 0.39% 16755 org.openjdk.jmh.infra.Blackhole.consume</code> </pre> <br><p>  рдЖрдк рдХрд╣реЗрдВрдЧреЗ: "рд╡реЗ рдпрд╣рд╛рдБ рд╣реИрдВ, рдЖрдВрддрд░рд┐рдХ, рдмрд╣реБрдд рдКрдкрд░!"  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдХреЗрд╡рд▓ рдпреЗ рдПрдХ рд╣реА рдЖрдВрддрд░рд┐рдХ рдирд╣реАрдВ рд╣реИрдВ (рдКрдкрд░ рд╕реЗ рджреВрд╕рд░реЗ рдХреЗ рдирд╛рдо рдХреА рддреБрд▓рдирд╛ рдХрд░реЗрдВ)ред  рдпрд╛рдж: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-meta"><span class="hljs-meta">@HotSpotIntrinsicCandidate</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.append(str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre> <br><p>  рдпрд╣рд╛рдБ рдЖрдВрддрд░рд┐рдХ рдХреЙрд▓ <code>StringBuilder.append(String)</code> рдХреЛ рдмрджрд▓ рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдорд╛рд░реЗ рдкреИрдЪ рдореЗрдВ рдпрд╣ рдХреЙрд▓ рдирд╣реАрдВ рд╣реИ!  рдЬрд┐рд╕реЗ <code>AbstractStringBuilder.append(String)</code> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  <code>jbyte_disjoint_arraycopy</code> рдХреЙрд▓ рдЬрд┐рд╕реЗ рд╣рдо <code>jbyte_disjoint_arraycopy</code> , рд╡рд╣ <code>StringLatin1::inflate</code> рд▓рд┐рдП рдЖрдВрддрд░рд┐рдХ рд╣реИ, рдЬрд┐рд╕реЗ <code>AbstractStringBuider::putStringAt</code> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ <code>AbstractStringBuider::putStringAt</code> рдорд╛рдзреНрдпрдо рд╕реЗ <code>String::getBytes</code> ред  рдпрд╣реА рд╣реИ, <code>StringBuilder::append</code> рд╡рд┐рдкрд░реАрдд <code>StringBuilder::append</code> рди рдХреЗрд╡рд▓ рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо-рд╡рд┐рд╢рд┐рд╖реНрдЯ, рдмрд▓реНрдХрд┐ рдЬрд╛рд╡рд╛ рдХреЛрдб рднреА рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, </p><br><p>  рдЕрд╕рдлрд▓рддрд╛ рдХреЗ рдХрд╛рд░рдг рдХреЛ рд╕рдордЭреЗрдВ, рдЕрдиреНрдпрдерд╛ рд╕рдлрд▓ рд╣реЛрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред  рдпрд╣ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдирд╛ рдЖрд╕рд╛рди рд╣реИ рдХрд┐ рд╣рдореЗрдВ рдХрд┐рд╕реА рддрд░рд╣ <code>StringBuilder::append</code> рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдЖрдк рдкрд┐рдЫрд▓реЗ рдкреИрдЪ рдХреЛ рдлрд╛рдбрд╝рдХрд░ рдФрд░ <code>StringBuilder</code> рдЦреБрдж рдмрджрд▓рд╛рд╡ рдХрд░рдХреЗ рдРрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  @Override public StringBuilder append(CharSequence s, int start, int end) { super.append(s, start, end); return this; } //  @Override public StringBuilder append(CharSequence s, int start, int end) { if (s == null) { s = "null"; } checkRange(start, end, s.length()); return this.append(s.subSequence(start, end).toString()); } }</span></span></code> </pre> <br><p>  рдЕрдм рд╕рдм рдХреБрдЫ рд╕рдордЭрджрд╛рд░реА рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рдЖрдВрддрд░рд┐рдХ StringBuilder :: рдкрд░рд┐рд╢рд┐рд╖реНрдЯ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред <br>  рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдПрдБ, рдЪрд▓рд╛рдПрдВ, рддреБрд▓рдирд╛ рдХрд░реЗрдВ: </p><br><pre> <code class="plaintext hljs">#   before      JDK, # after -   Benchmark nonLatin length before after Units avgt true 5 44,6 60,2 ns/op avgt true 10 45,7 59,1 ns/op avgt true 50 129,0 164,6 ns/op avgt true 100 218,7 276,2 ns/op avgt true 500 907,1 1088,8 ns/op avgt true 1000 1626,4 1959,4 ns/op gc.alloc.rate.norm true 5 184,0 264,0 B/op gc.alloc.rate.norm true 10 200,0 296,0 B/op gc.alloc.rate.norm true 50 688,0 904,0 B/op gc.alloc.rate.norm true 100 1192,0 1552,0 B/op gc.alloc.rate.norm true 500 5192,0 6752,0 B/op gc.alloc.rate.norm true 1000 10200,0 13256,0 B/op avgt false 5 20,8 37,9 ns/op avgt false 10 24,0 37,9 ns/op avgt false 50 66,4 80,9 ns/op avgt false 100 111,0 125,6 ns/op avgt false 500 419,2 483,6 ns/op avgt false 1000 840,4 893,8 ns/op gc.alloc.rate.norm false 5 80,0 152,0 B/op gc.alloc.rate.norm false 10 88,0 168,0 B/op gc.alloc.rate.norm false 50 320,0 440,0 B/op gc.alloc.rate.norm false 100 544,0 688,0 B/op gc.alloc.rate.norm false 500 2144,0 2688,0 B/op gc.alloc.rate.norm false 1000 4152,0 5187,2 B/op</code> </pre><br><p>  рдореИрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдмрд╣реБрдд рджреБрдЦреА рд╣реВрдВ, рд▓реЗрдХрд┐рди рдпрд╣ рдмреЗрд╣рддрд░ рдирд╣реАрдВ рд╣реБрдЖред  рдЕрдм рдПрдХ рдирдпрд╛ рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓: </p><br><pre> <code class="plaintext hljs"> ns percent samples top ---------- ------- ------- --- 19614374885 44.12% 1953620 jbyte_disjoint_arraycopy 6645299702 14.95% 662146 jlong_disjoint_arraycopy 4065789919 9.15% 400167 java.lang.StringUTF16.newBytesFor 2374627822 5.34% 234746 java.lang.AbstractStringBuilder.ensureCapacityInternal 1837858014 4.13% 183822 java.lang.StringUTF16.compress 1472039604 3.31% 145956 java.util.Arrays.copyOfRange 1316397864 2.96% 130747 appendBounds_jmhTest 956823151 2.15% 94959 java.util.Arrays.copyOf 573091712 1.29% 56933 java.lang.AbstractStringBuilder.&lt;init&gt; 434454076 0.98% 43202 java.lang.String.&lt;init&gt; 368480388 0.83% 36439 java.lang.AbstractStringBuilder.append 304409057 0.68% 30442 java.lang.StringBuilder.toString 272437989 0.61% 26833 SpinPause 201051696 0.45% 19985 java.lang.StringBuilder.&lt;init&gt; 198934052 0.45% 19810 appendBounds_avgt_jmhStub</code> </pre> <br><p>  рдереЛрдбрд╝рд╛ рдмрджрд▓ рдЧрдпрд╛ рд╣реИред  рдореЗрд░реЗ рд▓рд┐рдП, рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ <code>StringBuilder.append(String)</code> рднреАрддрд░ рд╕реЗ <code>StringBuilder.append(String)</code> рддрдХ <code>StringBuilder.append(String)</code> рд╕рдордп рдЖрдВрддрд░рд┐рдХ рдХрд╛рдо рдХреНрдпреЛрдВ рдирд╣реАрдВ рдХрд┐рдпрд╛ред  рдПрдХ рд╕рдВрджреЗрд╣ рд╣реИ рдХрд┐ <code>StringBuilder.append(String)</code> рдкрджреНрдзрддрд┐ рдХреЗ рд╢рд░реАрд░ рдХреЛ <code>StringBuilder.append(CharSequence, int, int)</code> рдХреЗ рд╢рд░реАрд░ рдореЗрдВ рдЪрд┐рдкрдХрд╛рдиреЗ рд╕реЗ рд╡реАрдПрдо рд╡рд┐рдзрд┐ рдХреЙрд▓ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдХреБрдЫ рдкрд░рд┐рд╡рд░реНрддрди рд╣реЛрддрд╛ рд╣реИред </p><br><p>  рд╡реИрд╕реЗ рднреА, рдпрд╣ рдлрд┐рдпрд╛рд╕реНрдХреЛ, рднрд╛рдИ рд╣реИред  рдЬреЗрдбреАрдХреЗ рдХреЛ рдкреИрдЪ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдирд╣реАрдВ рдерд╛, рд▓реЗрдХрд┐рди рд╣рдо рдЕрднреА рднреА рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдВ рдпрд╣ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рд╡рд┐рдлрд▓рддрд╛ рд╕рд╛рд╣рд┐рддреНрдпрд┐рдХ рд╡рд╛рдкрд╕реА</b> <div class="spoiler_text"><blockquote>  рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рджреЛ рджрд┐рдиреЛрдВ рдореЗрдВ рдЖрдпрд╛ред  рдирд╛рд╡рд┐рдХ рдУрдЯреЛ рд╡реЗрд▓рд╛рд░рд╛ рдХреЗ рд╕рд╛рде рднрд╛рдЧ рдирд╣реАрдВ рд▓реЗрдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ, рдПрдХ рдХрдВрдкрдиреА рдХреЗ рд╕рд╛рде рдЬреЛ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд░реВрдк рд╕реЗ рддреЗрдЬ рдФрд░ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдпреБрджреНрдзрдкреЛрддреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреА рд╣реИред  рдирд╛рд╡рд┐рдХ рдореЗрд░реЗ рд▓рд┐рдП рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдкрдврд╝рдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддрд╛ рд╣реИред  рд╡рд╣ рдХреЗрд╡рд▓ рдХрдорд╛рдВрдб рдкреЛрд╕реНрдЯ рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЛрд╣рд░рд╛рддрд╛ рд╣реИ: "рдирд╣реАрдВред"  рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ "рдХреНрдпреЛрдВ рдирд╣реАрдВред"  "рдирд╣реАрдВ" рдХрд┐рд╕реА рднреА рдорд╛рдорд▓реЗ рдореЗрдВ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╡рд╣ рдПрдХ рдмрдбрд╝реЗ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рдЙрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреБрдЫ рднреА рдирд╣реАрдВ рдкрддрд╛ рдерд╛, рддреЛ рдЗрд╕рдХрд╛ рдЬрд╡рд╛рдм рд╣рд╛рдВ рдореЗрдВ рд╣реЛрдЧрд╛: рдЗрд╕реЗ рдЖрдЬрд╝рдорд╛рдПрдВред  рдмрд╣реБрдд рдмреБрд░рд╛ред  рдРрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рд╡реНрдпрдХреНрддрд┐ рдХреЛ рдЦреЛрдирд╛ рдПрдХ рджрдпрд╛ рд╣реИред  рдФрд░ рд╕реЗрдирд╛рдкрддрд┐ рдореБрдЭреЗ рдХреНрд╖рдорд╛ рдХрд░реЗрдВред  рд╢рд╛рдпрдж рдкрд╣рд▓реА рдмрд╛рд░ рдЕрдлрд╝рд╕реЛрд╕ рд╣реБрдЖред  рд╡рд╣ рдореБрдЭреЗ рд╡рд╛рдЗрдХрд┐рдВрдЧреНрд╕ рдореЗрдВ рдШреБрд╕рддреЗ рд╣реБрдП рджреЗрдЦрддрд╛ рд╣реИред  рдФрд░ рд╡рд╣ рдореБрдЭреЗ рдлрд┐рд░ рд╕реЗ рдЧреНрд░реЗрд╣рд╛рдЙрдВрдб рдореЗрдВ рдзрдХреЗрд▓рдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддрд╛ рд╣реИред <br>  рд╡рд╣ рдЪреБрдк рд╣реИред  рд▓реЗрдХрд┐рди рдореБрдЭреЗ рдкрддрд╛ рд╣реИ рдХрд┐ рд╢реНрд░рдорд┐рдХреЛрдВ рдХреА рдПрдХ рдЬрдВрдЧрд▓реА рдХрдореА рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдореЗрдВ: <br>  - рдореИрдВ, рдХреЙрдорд░реЗрдб рдЬрдирд░рд▓, рдХрд▓ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реВрдВред  рдореБрдЭреЗ рдЬрд╛рдиреЗ рджреЛ? <br>  - рдЪрд▓реЗрдВред  - рдФрд░ рдЕрдЪрд╛рдирдХ рд╡рд╣ рдореБрд╕реНрдХреБрд░рд╛рддреА рд╣реИред  "рддреБрдореНрд╣реЗрдВ рдкрддрд╛ рд╣реИ, рд╣рд░ рдмрд╛рджрд▓ рдореЗрдВ рдПрдХ рдЪрд╛рдВрджреА рдХреА рдкрд░рдд рд╣реЛрддреА рд╣реИред" <br>  ", рдХреЙрдорд░реЗрдб рдЬрдирд░рд▓, рд╣рдореЗрд╢рд╛ рдЕрдЪреНрдЫреЗ рдХреЗ рдмрд┐рдирд╛ рдмреАрдорд╛рд░ рд╣реИрдВред" <br>  "рдФрд░ рдпрд╣рд╛рдБ рдпрд╣ рд╣реИред"  рдЖрдкрдХреЛ рдЙрд╕рд╕реЗ рдорд┐рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдордирд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдпрд╣ рдмреБрд░рд╛ рд╣реИред  <strong>рд▓реЗрдХрд┐рди рдЕрдкрдиреЗ рдЕрдиреБрднрд╡ рдХреЗ рдЦрдЬрд╛рдиреЗ рдореЗрдВ, рд╣рдордиреЗ рдПрдХ рдФрд░ рдЕрдирд╛рдЬ рдЬреЛрдбрд╝рд╛ред</strong> </blockquote></div></div><br><p>  рдирд┐рд╖реНрдХрд░реНрд╖: </p><br><ul><li>  рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЬреЗрдбреАрдХреЗ рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдХреЛрдб рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╡рд┐рдзрд┐ рдХреЗ рд╢рд░реАрд░ рдХреЗ рдмрдЬрд╛рдп рдПрдХ рдЖрдВрддрд░рд┐рдХ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рд╡реАрдПрдо рдХреЗ рдЖрдВрддреЛрдВ рдореЗрдВ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реИред </li><li>  рдЗрд╕реА рддрд░рд╣ рдХреЗ рддрд░реАрдХреЛрдВ рдХреЛ рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, <code>@HotSpotIntrinsicCandidate</code> рд▓реЗрдмрд▓ рдЙрдиреНрд╣реЗрдВ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдХреБрдЫ рддрд░реАрдХреЛрдВ рдХреЛ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕рдВрдХреЗрдд рдХреЗ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ <code>@HotSpotIntrinsicCandidate</code> рдЬрд╛рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП <code>String::equals</code> (рдФрд░ <a href="">рдХрдИ, рдХрдИ рдЕрдиреНрдп</a> )ред </li><li>  рдкрд╣рд▓реЗ рджреЛ рд╕реЗ рдЬреЛ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд▓рддрд╛ рд╣реИ рд╡рд╣ рдпрд╣ рд╣реИ рдХрд┐ рдЬреЗрдбреАрдХреЗ рдХреЛрдб рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣рдорд╛рд░реА рдЪрд░реНрдЪрд╛ рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдХреЗ рд╡рд┐рдкрд░реАрдд рд╣реЛ рд╕рдХрддреА рд╣реИред  C'est la vie </li></ul><br><p>  рдкреБрдирд╢реНрдЪ <br>  рдПрдХ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди: </p><br><pre> <code class="java hljs">StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.append(str, <span class="hljs-number"><span class="hljs-number">0</span></span>, endIndex); <span class="hljs-comment"><span class="hljs-comment">// --&gt; StringBuilder sb = new StringBuilder(str.substring(o, endIndex));</span></span></code> </pre> <br><p>  рдкреА рдкреА рдПрд╕ <br>  рдУрд░реЗрдХрд▓ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдареАрдХ рд╣реА рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВ </p><br><blockquote>  рдпрд╣ рдПрдХ рдХреЛрдб рдкрде рдореЗрдВ рдкреЗрд╢ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдореБрдЭреЗ рдЕрдЬреАрдм рдФрд░ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд▓рдЧрддрд╛ рд╣реИ <br>  sb.append (рд╕реАрдПрд╕, рдЗрдВрдЯ, рдЗрдВрдЯ) рдЬреЛ рд╕реНрдореГрддрд┐ рдХреЛ рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ <br>  рдХреЗрд╡рд▓ рдХрднреА-рдХрднреА рдЪреАрдЬреЗрдВ рддреЗрдЬреА рд╕реЗ рдЪрд▓рддреА рд╣реИрдВред  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдкрдиреЗ рджреЗрдЦрд╛, рдкреНрд░рджрд░реНрд╢рди <br>  рдЯреНрд░реЗрдбрдСрдлрд╝ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИрдВред <br><br>  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдпрджрд┐ рд╣рдо sb.append (cs, int, int) рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рд╢рд╛рдпрдж рд╣рдореЗрдВ рдмрд╕ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП <br>  рдЖрдЧреЗ рдФрд░ рдХрд░реЗрдВ, рд╕рдВрднрд╡рддрдГ рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ рдЬреЛрдбрд╝рдХрд░ рдпрд╛ рдкреБрдирд░реНрд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдХреЗред </blockquote><p>  рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рд╕рдорд╛рдзрд╛рди <code>StringBuilder.append(CharSequence, int, int)</code> ред </p><br><p>  тЖТ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд╛рд░реНрдп</a> <br>  тЖТ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЪрд░реНрдЪрд╛</a> </p><br><p>  <strong>рдкреА рдкреА рдПрд╕</strong> <br>  рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ, рдЗрд╕ рд╕рдордп, рдЬрдм рдХреБрдЫ рд▓рд┐рдЦрдирд╛ рдкрд╕рдВрдж рд╣реИ </p><br><pre> <code class="java hljs">StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.append(str.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, endIndex));</code> </pre> <br><p>  "рдЖрдЗрдбрд┐рдпрд╛" рд╕реЗ рдХреЛрдб рдХреЛ рд╕рд░рд▓ рдмрдирд╛рдиреЗ рдХрд╛ рд╕реБрдЭрд╛рд╡ рдорд┐рд▓рддрд╛ рд╣реИ </p><br><pre> <code class="java hljs">StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.append(s, <span class="hljs-number"><span class="hljs-number">0</span></span>, endIndex);</code> </pre> <br><p>  рдпрджрд┐ рдЗрд╕ рд╕реНрдерд╛рди рдореЗрдВ рдкреНрд░рджрд░реНрд╢рди рдЖрдкрдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИ, рддреЛ рд╕рдВрднрд╡рддрдГ рджреВрд╕рд░реЗ, рд╕рд░рд▓реАрдХреГрдд рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЕрдзрд┐рдХ рд╕рд╣реА рд╣реИред  рдлрд┐рд░ рднреА, рд╣рдо рдЬреЛ рднреА рдХреЛрдб рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рдЙрд╕рдХрд╛ рдЕрдзрд┐рдХрд╛рдВрд╢ рднрд╛рдЧ рд╣рдорд╛рд░реЗ рдХрд╛рдорд░реЗрдб рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ, рдорд╢реАрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi436746/">https://habr.com/ru/post/hi436746/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi436722/index.html">рдкреНрд░реЛрд▓реЙрдЧ рдкрд░ рдиреИрджрд╛рдирд┐рдХ тАЛтАЛрдЪрд┐рдХрд┐рддреНрд╕рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдкреНрд░рдгрд╛рд▓реА</a></li>
<li><a href="../hi436736/index.html">рд╕рдордп рдХреА рд▓рд╛рдЧрдд рдХреА рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд░рд▓ рдЕрднреНрдпрд╛рд╕</a></li>
<li><a href="../hi436740/index.html">рдЦреБрдж рдХрд╛ рд╢реЛрдз, рдХреНрдпрд╛ рдЦреБрд▓рд╛ рд╕реНрд░реЛрдд рд╣рдореЗрдВ рдмрддрд╛ рд╕рдХрддреЗ рд╣реИрдВ?</a></li>
<li><a href="../hi436742/index.html">2019 рддрдХ рдПрдВрдбреНрд░реЙрдЗрдб рд░реЛрдмреЛрдЯрд┐рдХреНрд╕: рдЕрд╕рд▓реА рдХрд╣рд╛рдиреА; 5 рднрд╛рдЧреЛрдВ рдореЗрдВ; рднрд╛рдЧ рез</a></li>
<li><a href="../hi436744/index.html">рд░рд╛рд╕реНрдкрдмреЗрд░реА рдкрд╛рдИ рдкрд░ рдЕрдкрдиреЗ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдбрд┐рдЯреЗрдХреНрдЯрд░ рдХреЛ рдиреНрдпреВрд░рд▓ рдХрдореНрдкреНрдпреВрдЯ рд╕реНрдЯрд┐рдХ рдФрд░ рдУрдкрдирд╡рд┐рдиреЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реЙрдиреНрдЪ рдХрд░реЗрдВ</a></li>
<li><a href="../hi436748/index.html">рдЦрд░реЛрдВрдЪ рд╕реЗ рд╣реЗрдХреНрд╕рд╛рдкреЛрдб рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдирд╛ (рднрд╛рдЧ 3) - рдХреАрдиреЗрдореЗрдЯреАрдХреНрд╕</a></li>
<li><a href="../hi436750/index.html">2018 рдХреЗ рд▓рд┐рдП рд░реВрд╕реА YouTube рдХрд╛ рд░реБрдЭрд╛рди рд╡рд┐рд╢реНрд▓реЗрд╖рдг</a></li>
<li><a href="../hi436752/index.html">рдХреЗрдХ рдЭреВрда рд╣реИ</a></li>
<li><a href="../hi436754/index.html">Q2VKPT: рдпрдерд╛рд░реНрдерд╡рд╛рджреА рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛ рдХреЗ рд╕рд╛рде рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд▓рд┐рдЦрд┐рдд рджреНрд╡рд┐рддреАрдп</a></li>
<li><a href="../hi436756/index.html">рдЕрд▓рдЧрд╛рд╡рд╡рд╛рдж рдмрдЪрд╛рд╡ рдХреА рдореБрджреНрд░рд╛ рдореЗрдВ рд╣реИ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>