<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚕️ 🌌 ⭐️ Alasan bodoh mengapa aplikasi penglihatan mesin Anda yang licik tidak berfungsi: orientasi di EXIF 🍌 🛑 🍝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya menulis banyak tentang visi komputer dan proyek pembelajaran mesin, seperti sistem pengenalan objek dan proyek pengenalan wajah . Saya juga memil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Alasan bodoh mengapa aplikasi penglihatan mesin Anda yang licik tidak berfungsi: orientasi di EXIF</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471112/"> Saya menulis banyak tentang visi komputer dan proyek pembelajaran mesin, seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sistem pengenalan objek</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proyek pengenalan wajah</a> .  Saya juga memiliki open source <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">library pengenalan wajah</a> Python yang entah bagaimana membuatnya menjadi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">top 10 perpustakaan pembelajaran mesin paling populer di Github</a> .  Semua ini telah mengarahkan pendatang baru ke Python dan visi mesin untuk mengajukan <i>banyak</i> pertanyaan kepada saya. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c4b/b2f/40c/c4bb2f40c4522fd2caee36c65a8f4b09.png"><br><br>  Dari pengalaman, ada satu masalah teknis khusus yang paling sering membingungkan orang.  Tidak, ini bukan pertanyaan teoretis yang sulit atau masalah dengan GPU yang mahal.  Faktanya adalah bahwa hampir semua orang memuat gambar ke dalam memori yang diputar, tanpa menyadarinya.  Dan komputer <i>tidak</i> mendeteksi objek dengan <i>sangat baik</i> atau mengenali wajah dalam gambar yang diputar. <br><a name="habracut"></a><br><h1>  Bagaimana kamera digital secara otomatis memutar gambar </h1><br>  Ketika Anda mengambil gambar, kamera mendaftarkan posisi telepon, sehingga di program lain gambar akan ditampilkan dalam orientasi yang benar: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd0/0e3/ebd/cd00e3ebd77f1d9e920128d76b4f776a.png"><br><br>  Tetapi kamera sebenarnya tidak memutar data piksel di dalam file.  Karena sensor gambar dalam kamera digital dibaca baris demi baris sebagai aliran informasi piksel yang berkelanjutan, kamera lebih mudah untuk selalu menyimpan data piksel dalam urutan yang sama, terlepas dari posisi aktual ponsel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f4/5ba/d70/3f45bad70377a193db2bf631ef1a91ab.png"><br><br>  Ini adalah masalah program untuk menonton - memutar gambar dengan benar sebelum menampilkannya di layar.  Seiring dengan data gambar itu sendiri, kamera juga menyimpan metadata - pengaturan lensa, data lokasi dan, tentu saja, sudut rotasi kamera.  Penampil harus menggunakan informasi ini untuk ditampilkan dengan benar. <br><br>  Format metadata gambar yang paling umum disebut <b>EXIF</b> (kependekan dari Exchangeable Image File Format).  Metadata EXIF ​​tertanam di setiap file jpeg.  Anda tidak dapat melihatnya di layar, tetapi dibaca oleh program apa pun yang tahu ke mana harus mencari. <br><br>  Berikut adalah metadata EXIF ​​di dalam gambar JPEG angsa kami dari alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">exiftool</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/601/cad/fda/601cadfda25a8aab0af8ccb2b8c699b1.png"><br><br>  Lihat elemen 'Orientasi'?  Dia memberi tahu pemirsa bahwa sebelum ditampilkan di layar, gambar harus diputar 90 derajat searah jarum jam.  Jika program lupa melakukan ini, gambar akan berada di sisinya! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3d7/c9d/230/3d7c9d230dab3133a1628aec93169824.png"><br><br><h1>  Mengapa ini merusak begitu banyak aplikasi penglihatan mesin dengan Python? </h1><br>  Metadata EXIF ​​pada awalnya bukan bagian dari format JPEG.  Mereka diperkenalkan jauh kemudian, meminjam ide dari format TIFF.  Untuk kompatibilitas mundur, metadata ini bersifat opsional, dan beberapa program tidak perlu repot untuk menguraikannya. <br><br>  Kebanyakan pustaka gambar Python, seperti numpy, scipy, TensorFlow, Keras, dll., Menganggap diri mereka <i>alat ilmiah bagi orang</i> - <i>orang serius</i> yang bekerja dengan kumpulan data bersama.  Mereka tidak peduli dengan masalah <i>tingkat konsumen</i> , seperti rotasi gambar otomatis, meskipun ini diperlukan untuk hampir semua foto di dunia yang diambil dengan kamera modern. <br><br>  Ini berarti bahwa ketika memproses gambar dengan hampir semua perpustakaan Python, Anda mendapatkan data gambar asli tanpa rotasi.  Dan coba tebak apa yang terjadi ketika Anda mencoba mengunggah foto di sisi Anda atau terbalik dalam model deteksi wajah atau objek?  Detektor tidak menyala karena Anda memberikan data yang buruk. <br><br>  Anda mungkin berpikir bahwa masalah hanya muncul di program pemula dan siswa, tetapi tidak demikian!  Bahkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">versi demo API Visi andalan Google</a> tidak menangani orientasi EXIF ​​dengan benar: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e81/3e6/0dc/e813e60dcc810a22eb21a15b3adb52f2.jpg"><br>  <i><font color="gray">Demo Google Vision API tidak tahu cara memutar gambar berorientasi potret yang diambil dari ponsel standar</font></i> <br><br>  Meskipun Google Vision mengenali beberapa hewan di sisinya, ia menandai mereka dengan label umum “hewan”, karena model visi mesin jauh lebih sulit untuk mengenali angsa di sisinya daripada angsa vertikal.  Inilah hasilnya, jika Anda memutar gambar dengan benar sebelum mengirimkannya ke model: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/68f/7c9/a07/68f7c9a073642c35d200cacbe9d89838.jpg"><br><br>  Dengan orientasi yang benar, Google mendeteksi burung dengan tanda angsa yang lebih spesifik dan indikator kepercayaan yang lebih tinggi.  Jauh lebih baik! <br><br>  Ini adalah masalah yang sangat jelas ketika Anda <i>melihat dengan jelas bahwa gambar berada di sisinya</i> , seperti dalam demo ini.  Tapi di sinilah semuanya menjadi berbahaya - biasanya Anda tidak melihatnya!  Semua program normal di komputer Anda akan menampilkan gambar dalam orientasi yang benar, dan bukan bagaimana sebenarnya disimpan di disk.  Karena itu, ketika Anda mencoba melihat gambar untuk melihat mengapa model Anda tidak berfungsi, itu akan ditampilkan dengan benar, dan Anda tidak akan mengerti mengapa model itu tidak berfungsi! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b6/cb5/a01/2b6cb5a010eca220dd2f9887c4c24e27.png"><br>  <i><font color="gray">Finder di Mac selalu menampilkan foto yang diputar dengan benar dari EXIF.</font></i>  <i><font color="gray">Tidak ada cara untuk melihat bahwa gambar sebenarnya disimpan di sisinya</font></i> <br><br>  Ini pasti mengarah ke banyak tiket terbuka di Github: orang mengeluh bahwa proyek open source rusak dan modelnya tidak terlalu akurat.  Tapi masalahnya jauh lebih sederhana - mereka hanya memasukkan foto yang diputar atau terbalik ke pintu masuk! <br><br><h1>  Koreksi </h1><br>  Solusinya adalah bahwa setiap kali Anda memuat gambar ke program Python, Anda harus memeriksa metadata orientasi EXIF ​​dan memutar gambar jika perlu.  Ini cukup mudah dilakukan, tetapi di internet sangat sulit menemukan contoh kode yang melakukannya dengan benar untuk semua orientasi. <br><br>  Berikut adalah kode untuk memuat gambar apa saja ke dalam array numpy dengan orientasi yang benar: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PIL.Image <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PIL.ImageOps <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exif_transpose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(img)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> img: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> img exif_orientation_tag = <span class="hljs-number"><span class="hljs-number">274</span></span> <span class="hljs-comment"><span class="hljs-comment"># Check for EXIF data (only present on some files) if hasattr(img, "_getexif") and isinstance(img._getexif(), dict) and exif_orientation_tag in img._getexif(): exif_data = img._getexif() orientation = exif_data[exif_orientation_tag] # Handle EXIF Orientation if orientation == 1: # Normal image - nothing to do! pass elif orientation == 2: # Mirrored left to right img = img.transpose(PIL.Image.FLIP_LEFT_RIGHT) elif orientation == 3: # Rotated 180 degrees img = img.rotate(180) elif orientation == 4: # Mirrored top to bottom img = img.rotate(180).transpose(PIL.Image.FLIP_LEFT_RIGHT) elif orientation == 5: # Mirrored along top-left diagonal img = img.rotate(-90, expand=True).transpose(PIL.Image.FLIP_LEFT_RIGHT) elif orientation == 6: # Rotated 90 degrees img = img.rotate(-90, expand=True) elif orientation == 7: # Mirrored along top-right diagonal img = img.rotate(90, expand=True).transpose(PIL.Image.FLIP_LEFT_RIGHT) elif orientation == 8: # Rotated 270 degrees img = img.rotate(90, expand=True) return img def load_image_file(file, mode='RGB'): # Load the image with PIL img = PIL.Image.open(file) if hasattr(PIL.ImageOps, 'exif_transpose'): # Very recent versions of PIL can do exit transpose internally img = PIL.ImageOps.exif_transpose(img) else: # Otherwise, do the exif transpose ourselves img = exif_transpose(img) img = img.convert(mode) return np.array(img)</span></span></code> </pre> <br>  Dari sini, Anda dapat mentransfer array data gambar ke pustaka visi mesin Python standar apa pun yang mengharapkan array input: misalnya, Keras atau TensorFlow. <br><br>  Karena masalahnya ada di mana-mana, saya menerbitkan fungsi ini sebagai pustaka pip bernama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">image_to_numpy</a> .  Anda dapat menginstalnya sebagai berikut: <br><br><pre>  pip3 instal image_to_numpy </pre><br>  Ia bekerja dengan program Python apa pun, memperbaiki pemuatan gambar, misalnya: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> image_to_numpy <span class="hljs-comment"><span class="hljs-comment"># Load your image file img = image_to_numpy.load_image_file("my_file.jpg") # Show it on the screen (or whatever you want to do) plt.imshow(img) plt.show()</span></span></code> </pre> <br>  Lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">file readme</a> untuk lebih jelasnya. <br><br>  Selamat menikmati! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id471112/">https://habr.com/ru/post/id471112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id471096/index.html">Tes publik: solusi untuk privasi dan skalabilitas dalam Ethereum</a></li>
<li><a href="../id471098/index.html">Terobosan Digital - Bagaimana Itu</a></li>
<li><a href="../id471100/index.html">Interaksi antara komponen sudut menggunakan RxJS</a></li>
<li><a href="../id471102/index.html">DNS Dinamis Kustom dengan CloudFlare</a></li>
<li><a href="../id471104/index.html">Oktober Intisari Acara TI (Bagian Dua)</a></li>
<li><a href="../id471116/index.html">5 perangkat teknologi makanan dan sebuah robot dengan tomat</a></li>
<li><a href="../id471118/index.html">Cara Memperkenalkan Organisasi Anda ke OpenStack</a></li>
<li><a href="../id471120/index.html">Bagaimana mengatasi masalah IT saat ini dalam manajemen perbaikan peralatan</a></li>
<li><a href="../id471122/index.html">Berita dari dunia OpenStreetMap No. 480 (09.24.2019 - 09.09.2019)</a></li>
<li><a href="../id471126/index.html">Berurusan dengan cadangan untuk Dell EMC UnityVSA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>