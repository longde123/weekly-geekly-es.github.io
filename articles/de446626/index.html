<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè∞ üë©üèª‚Äç‚öïÔ∏è ‚§¥Ô∏è Kaspersky Mobile Talks # 1. Multimodularit√§t ‚õÖÔ∏è üë©üèæ‚Äçüéì üí•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ende Februar haben wir ein neues Format f√ºr Meetings von Android-Entwicklern von Kaspersky Mobile Talks eingef√ºhrt . Der Hauptunterschied zu normalen ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kaspersky Mobile Talks # 1. Multimodularit√§t</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/kaspersky/blog/446626/"><p>  Ende Februar haben wir ein neues Format f√ºr Meetings von Android-Entwicklern von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kaspersky Mobile Talks eingef√ºhrt</a> .  Der Hauptunterschied zu normalen Besprechungen besteht darin, dass sich ‚Äûerfahrene‚Äú Entwickler anstelle von Hunderten von Zuh√∂rern und sch√∂nen Pr√§sentationen zu verschiedenen Themen versammelten, um nur ein Thema zu diskutieren: Wie sie Multimodularit√§t in ihren Anwendungen implementieren, mit welchen Problemen sie konfrontiert sind und wie sie gel√∂st werden. </p><br><p><img src="https://habrastorage.org/webt/i5/da/5v/i5da5vzrshhino9ayx-a5e6ikkc.jpeg"></p><a name="habracut"></a><br><h2 id="soderzhanie">  Inhalt </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hintergrund</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mediatoren in HeadHunter.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Alexander Blinov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tinkoff-Domain-Module</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vladimir Kokhanov, Alexander Zhukov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wirkungsanalyse in Avito.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Evgeny Krivobokov, Mikhail Yudin</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wie in Tinkoff reduzierten sie die Montagezeit f√ºr PR von vierzig Minuten auf vier.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vladimir Kokhanov</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">N√ºtzliche Links</a> </li></ol><br><a name="history"></a><br><p>  Bevor wir mit dem unmittelbaren Inhalt des Meetings im B√ºro von Kaspersky Lab fortfahren, erinnern wir uns, woher der Mod stammt, um die Anwendung in Module zu unterteilen (im Folgenden wird das Modul als Gradle-Modul und nicht als Dolch verstanden, sofern nicht anders angegeben). </p><br><p>  Das Thema Multimodularit√§t besch√§ftigt die Android-Community seit Jahren.  Eine der Grundlagen kann als Bericht von Denis Neklyudov √ºber den letztj√§hrigen St. Petersburg "Mobius" angesehen werden.  Er schlug vor, die monolithische Anwendung, die lange Zeit kein Thin Client mehr war, in Module zu unterteilen, um die Erstellungsgeschwindigkeit zu erh√∂hen. <br>  Link zum Bericht: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pr√§sentation</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video</a> </p><br><p>  Dann gab es einen Bericht von Vladimir Tagakov von Yandex.Maps √ºber das Verkn√ºpfen von Modulen mit Dagger.  Somit l√∂sen sie das Problem, eine einzelne Komponente von Karten f√ºr die Wiederverwendung in vielen anderen Yandex-Anwendungen zuzuweisen. <br>  Link zum Bericht: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pr√§sentation</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video</a> </p><br><p>  Auch Kaspersky Lab hat sich dem Trend nicht entzogen: Im September schrieb Evgeni Matsyuk einen Artikel dar√ºber, wie man Module mit Dagger verbindet und gleichzeitig eine Architektur mit mehreren Modulen horizontal erstellt, ohne zu vergessen, die Prinzipien der sauberen Architektur vertikal zu befolgen. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link zum Artikel</a> </p><br><p>  Und im Winter Mobius gab es zwei Berichte gleichzeitig.  Zuerst sprach Alexander Blinov √ºber die Multimodularit√§t in der HeadHunter-Anwendung mit Toothpick als DI, und direkt nach ihm sprach Artem Zinnatulin √ºber die Schmerzen von mehr als 800 Modulen in Lyft.  Sasha begann √ºber Multimodularit√§t zu sprechen, um die Architektur der Anwendung zu verbessern und nicht nur die Montage zu beschleunigen. <br>  Blinov-Bericht: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pr√§sentation</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video</a> <br>  Zinnatulin-Bericht: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video</a> </p><br><p> Warum habe ich den Artikel mit einer Retrospektive begonnen?  Erstens hilft es Ihnen, das Thema besser zu studieren, wenn Sie zum ersten Mal √ºber Multimodularit√§t lesen.  Und zweitens begann die erste Rede bei unserem Treffen mit einer Mini-Pr√§sentation von Alexey Kalaida von der Firma Stream, die zeigte, wie sie ihre Anwendung auf der Grundlage von Zhenyas Artikel in Module aufteilten (und einige Punkte schienen mir Vladimirs Ansatz √§hnlich zu sein). </p><br><p>  Das Hauptmerkmal dieses Ansatzes war die Bindung an die Benutzeroberfl√§che: Jedes Modul ist als separater Bildschirm verbunden - ein Fragment, auf das Abh√§ngigkeiten vom Haupt-App-Modul einschlie√ülich des FragmentManager √ºbertragen werden.  Zun√§chst versuchten Kollegen, Multimodularit√§t durch Proxy-Injektoren zu implementieren, was Zhenya in dem Artikel vorschlug.  Dieser Ansatz schien jedoch √ºberw√§ltigend: Es gab Probleme, wenn ein Feature von einem anderen abhing, was wiederum vom dritten abhing - wir mussten f√ºr jedes Feature-Modul einen Proxy-Injektor schreiben.  Der auf UI-Komponenten basierende Ansatz erm√∂glicht es Ihnen, keine Injektoren zu schreiben, wodurch Abh√§ngigkeiten auf der Abh√§ngigkeitsebene von Zielfragmenten zugelassen werden. </p><br><p>  Die Hauptbeschr√§nkungen dieser Implementierung: Ein Feature muss ein Fragment (oder eine andere Ansicht) sein.  das Vorhandensein verschachtelter Fragmente, was zu einer gro√üen Kesselplatte f√ºhrt.  Wenn ein Feature andere Features implementiert, sollte es der Abh√§ngigkeitskarte hinzugef√ºgt werden, die Dagger beim Kompilieren √ºberpr√ºft.  Wenn es viele solcher Merkmale gibt, treten zum Zeitpunkt der Verkn√ºpfung des Abh√§ngigkeitsgraphen Schwierigkeiten auf. </p><br><a name="hh"></a><br><p>  Nach Alexeys Bericht ergriff Alexander Blinov das Wort.  Seiner Meinung nach w√§re eine an die Benutzeroberfl√§che gebundene Implementierung f√ºr DI-Container in Flutter geeignet.  Dann wechselte die Diskussion zu einer Diskussion mit mehreren Modulen in HeadHunter.  Der Zweck ihrer Unterteilung in Module war die M√∂glichkeit der architektonischen Isolierung von Merkmalen und der Erh√∂hung der Montagegeschwindigkeit. </p><br><p>  Vor der Aufteilung in Module ist eine Vorbereitung wichtig.  Zun√§chst k√∂nnen Sie ein Abh√§ngigkeitsdiagramm erstellen - beispielsweise mit einem solchen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tool</a> .  Dies wird dazu beitragen, Komponenten mit einer minimalen Anzahl von Abh√§ngigkeiten zu isolieren und unn√∂tige zu entfernen (Chop).  Erst danach k√∂nnen die am wenigsten verbundenen Komponenten zu Modulen ausgew√§hlt werden. </p><br><p>  Alexander erinnerte sich an die wichtigsten Punkte, √ºber die er bei Mobius ausf√ºhrlicher sprach.  Eine der komplexen Aufgaben, die die Architektur ber√ºcksichtigen muss, ist die Wiederverwendung eines Moduls an verschiedenen Stellen in der Anwendung.  In dem Beispiel mit der hh-Bewerbung handelt es sich um ein Lebenslaufmodul, auf das sowohl f√ºr das Stellenlistenmodul (VacanciesList), wenn der Benutzer zu dem f√ºr diese Stelle eingereichten Lebenslauf wechselt, als auch f√ºr das Negativantwortmodul (Negotiation) zugegriffen werden sollte.  Aus Gr√ºnden der Klarheit habe ich das Bild, das Sasha auf einem Flipchart dargestellt hat, neu gezeichnet. </p><br><p><img src="https://habrastorage.org/webt/e8/yv/jj/e8yvjjob9amuir_xu9693i2qisk.png"></p><br><p>  Jedes Modul enth√§lt zwei Hauptentit√§ten: Abh√§ngigkeiten - die Abh√§ngigkeiten, die dieses Modul ben√∂tigt, und API - die Methoden, die das Modul anderen Modulen zur Verf√ºgung stellt.  Die Kommunikation zwischen den Modulen erfolgt √ºber Mediatoren, die im Haupt-App-Modul eine flache Struktur aufweisen.  Jedes Feature hat eine Auswahl.  Die Mediatoren selbst sind in einem bestimmten MediatorManager im Projekt-App-Modul enthalten.  Im Code sieht es ungef√§hr so ‚Äã‚Äãaus: </p><br><pre><code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> MediatorManager { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> chatMediator: ChatMediator <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { ChatMediator() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> someMediator: ... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TechSupportMediator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: SuppportComponent { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deps = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : SuppportComponentDependencies { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> getInternalChat{ MediatorManager.rootMediator.api.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openInternalChat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuppportComponent</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dependencies) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> api: SupportComponentApi = ... <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { SupportDI.keeper.installComponent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SuppportComponentDependencies</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSmth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { scopeHolder.destroyCoordinator &lt; -ref count } }</code> </pre> <br><p>  Alexander versprach, in K√ºrze ein Plug-In zum Erstellen von Modulen in Android Studio zu ver√∂ffentlichen, mit dem das Kopieren und Einf√ºgen in seinem Unternehmen beseitigt wird, sowie ein Beispiel f√ºr ein Konsolenprojekt mit mehreren Modulen. </p><br><p>  Weitere Fakten zu den aktuellen Ergebnissen der Trennung von hh-Anwendungsmodulen: </p><br><ul><li>  ~ 83 Funktionsmodule. </li><li>  Um einen A / B-Test durchzuf√ºhren, k√∂nnen Features auf Mediatorebene vollst√§ndig durch das Feature-Modul ersetzt werden. </li><li>  Die Grafik von Gradle Scan zeigt, dass nach der parallelen Kompilierung der Module ein ziemlich langwieriger Prozess zum Dexen der Anwendung stattfindet (in diesem Fall zwei: f√ºr Arbeitssuchende und Arbeitgeber): <br><img src="https://habrastorage.org/webt/4a/wj/xz/4awjxzwf4ohdfdayj7xt591ekf0.png"></li></ul><br><a name="tinkoff"></a><br><p>  Folgendes haben Alexander und Vladimir von Tinkoff das Wort ergriffen: <br>  Das Schema ihrer Multi-Modul-Architektur sieht folgenderma√üen aus: <br><img src="https://habrastorage.org/webt/4x/p-/t0/4xp-t0r5xgdc2rhssvrzv0zqaco.png"></p><br><p>  Module sind in zwei Kategorien unterteilt: Funktionsmodule und Dom√§nenmodule. <br>  Funktionsmodule enthalten Gesch√§ftslogik- und UI-Funktionen.  Sie h√§ngen von Dom√§nenmodulen ab, k√∂nnen jedoch nicht voneinander abh√§ngen. </p><br><p>  Dom√§nenmodule enthalten Code f√ºr die Arbeit mit Datenquellen, dh einige Modelle, DAO (f√ºr die Arbeit mit der Datenbank), API (f√ºr die Arbeit mit dem Netzwerk) und Repositorys (kombinieren Sie die Arbeit von API und DAO).  Dom√§nenmodule k√∂nnen im Gegensatz zu Feature-Modulen voneinander abh√§ngen. </p><br><p>  Die Verbindung zwischen Dom√§nen- und Feature-Modulen erfolgt vollst√§ndig innerhalb von Feature-Modulen (dh in der Terminologie von hh werden Abh√§ngigkeiten und API-Abh√§ngigkeiten von Domain-Modulen in den Feature-Modulen, die sie verwenden, vollst√§ndig aufgel√∂st, ohne dass zus√§tzliche Entit√§ten wie Mediatoren verwendet werden m√ºssen). </p><br><p>  Es folgte eine Reihe von Fragen, die ich hier im Format ‚ÄûFrage-Antwort‚Äú fast unver√§ndert stellen werde: </p><br><blockquote>  - Wie erfolgt die Autorisierung?  Wie zieht man es in Feature-Module? <br>  - Funktionen bei uns h√§ngen nicht von der Autorisierung ab, da fast alle Aktionen der Anwendung in der autorisierten Zone ausgef√ºhrt werden. <br><br>  - Wie k√∂nnen nicht verwendete Komponenten verfolgt und gereinigt werden? <br>  - Wir haben eine Entit√§t wie InjectorRefCount (implementiert √ºber WeakHashMap), die beim L√∂schen der letzten Aktivit√§t (oder des letzten Fragments) mit dieser Komponente diese l√∂scht. <br><br>  - Wie misst man eine "saubere" Scan- und Erstellungszeit?  Wenn die Caches eingeschaltet sind, wird ein ziemlich schmutziger Scan erhalten. <br>  - Sie k√∂nnen den Gradle-Cache deaktivieren (org.gradle.caching in gradle.properties). <br><br>  - Wie werden Unit-Tests von allen Modulen im Debug-Modus ausgef√ºhrt?  Wenn Sie nur einen Gradle-Test ausf√ºhren, werden Tests aller Geschmacksrichtungen und BuildType abgerufen. <br>  (Diese Frage l√∂ste die Diskussion vieler Teilnehmer des Treffens aus.) <br>  - Sie k√∂nnen versuchen, testDebug auszuf√ºhren. <br>  - Dann werden Module, f√ºr die es keine Debug-Konfiguration gibt, nicht festgezogen.  Es beginnt entweder zu viel oder zu wenig. <br>  - Sie k√∂nnen eine Gradle-Aufgabe schreiben, die testDebug f√ºr solche Module √ºberschreibt, oder eine gef√§lschte Debug-Konfiguration im Modul build.gradle vornehmen. <br>  - Sie k√∂nnen diesen Ansatz folgenderma√üen implementieren: </blockquote><br><pre> <code class="plaintext hljs">withAndroidPlugin(project) { _, applicationExtension -&gt; applicationExtension.testVariants.all { testVariant -&gt; val testVariantSuffix = testVariant.testedVariant.name.capitalize() } } val task = project.tasks.register &lt; SomeTask &gt; ( "doSomeTask", SomeTask::class.java ) { task.dependsOn("${project.path}:taskName$testVariantSuffix") }</code> </pre> <br><p><img src="https://habrastorage.org/webt/oy/gc/68/oygc68_brbzgxgzfh_wztse_na8.jpeg"></p><br><a name="avito"></a><br><p>  Die n√§chste improvisierte Pr√§sentation wurde von Evgeny Krivobokov und Mikhail Yudin aus Avito gemacht. <br>  Sie verwendeten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mindmap</a> , um ihre Geschichte zu visualisieren. </p><br><p>  Jetzt umfasst das Projekt des Unternehmens&gt; 300 Module, wobei 97% der Codebasis in Kotlin geschrieben sind.  Der Hauptzweck der Aufteilung in Module bestand darin, die Montage des Projekts zu beschleunigen.  Die Aufteilung in Module erfolgte schrittweise, wobei die am wenigsten abh√§ngigen Teile des Codes den Modulen zugewiesen wurden.  Zu diesem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zweck</a> wurde ein Tool zum Markieren der Abh√§ngigkeiten von Quellcodes in der Grafik f√ºr die Auswirkungsanalyse entwickelt ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht √ºber die Auswirkungsanalyse in Avito</a> ). </p><br><p>  Mit diesem Tool k√∂nnen Sie ein Feature-Modul als endg√ºltig markieren, sodass andere Module nicht davon abh√§ngen k√∂nnen.  Diese Eigenschaft wird w√§hrend der Auswirkungsanalyse √ºberpr√ºft und enth√§lt eine Bezeichnung f√ºr explizite Abh√§ngigkeiten und Vereinbarungen mit den Teams, die f√ºr das Modul verantwortlich sind.  Basierend auf dem erstellten Diagramm wird auch die Verteilung der √Ñnderungen √ºberpr√ºft, um Komponententests f√ºr den betroffenen Code auszuf√ºhren. </p><br><p>  Das Unternehmen verwendet ein Mono-Repository, jedoch nur f√ºr Android-Quellen.  Der Code anderer Plattformen lebt separat. </p><br><p>  Gradle wird zum Erstellen des Projekts verwendet (obwohl Kollegen bereits an einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Builder</a> wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Buck</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bazel</a> denken, der f√ºr Projekte mit mehreren Modulen besser geeignet ist).  Sie haben bereits Kotlin DSL ausprobiert und sind dann in Gradle-Skripten zu Groovy zur√ºckgekehrt, da es unpraktisch ist, verschiedene Versionen von Kotlin in Gradle und im Projekt zu unterst√ºtzen - die allgemeine Logik wird in Plugins integriert. </p><br><p>  Gradle kann Aufgaben parallelisieren, zwischenspeichern und bin√§re Abh√§ngigkeiten nicht neu kompilieren, wenn sich ihr ABI nicht ge√§ndert hat, was eine schnellere Zusammenstellung eines Projekts mit mehreren Modulen gew√§hrleistet.  F√ºr ein effizienteres Caching werden Mainfraimer und mehrere selbstgeschriebene L√∂sungen verwendet: </p><br><ul><li>  Beim Wechsel von Zweig zu Zweig hinterl√§sst Git m√∂glicherweise leere Ordner, die das Caching <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unterbrechen</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gradle-Problem Nr. 2463</a> ).  Daher werden sie manuell mit dem Git-Hook gel√∂scht. </li><li>  Wenn Sie die Umgebung auf den Computern der Entwickler nicht steuern, k√∂nnen verschiedene Versionen des Android SDK und andere Parameter das Caching beeintr√§chtigen.  W√§hrend der Erstellung des Projekts vergleicht das Skript die Umgebungsparameter mit den erwarteten: Wenn die falschen Versionen oder Parameter installiert sind, wird die Erstellung gel√∂scht. </li><li>  Analytics aktiviert / deaktiviert Parameter und die Umgebung.  Dies dient zur √úberwachung und Unterst√ºtzung von Entwicklern. </li><li>  Build-Fehler werden auch an Analytics gesendet.  Bekannte und beliebte Probleme werden auf einer speziellen Seite mit einer L√∂sung eingetragen. </li></ul><br><p>  All dies tr√§gt dazu bei, 15% Cache-Fehler bei CI und 60-80% lokal zu erzielen. </p><br><p>  Die folgenden Gradle-Tipps k√∂nnen auch n√ºtzlich sein, wenn in Ihrem Projekt eine gro√üe Anzahl von Modulen angezeigt wird: </p><br><ul><li>  Das Deaktivieren von Modulen √ºber IDE-Flags ist unpraktisch. Diese Flags k√∂nnen zur√ºckgesetzt werden.  Daher werden Module √ºber settings.gradle deaktiviert. </li><li>  In Studio 3.3.1 gibt es ein Kontrollk√§stchen "Quellengenerierung bei Gradle-Synchronisierung √ºberspringen, wenn ein Projekt mehr als 1 Module enth√§lt".  Standardm√§√üig ist es ausgeschaltet, es ist besser, es einzuschalten. </li><li>  Abh√§ngigkeiten werden in buildSrc registriert, um in allen Modulen wiederverwendet zu werden.  Eine andere Option ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Plugins DSL</a> , aber dann k√∂nnen Sie die Anwendung des Plugins nicht in einer separaten Datei ablegen. </li></ul><br><a name="pr4"></a><br><p>  Unser Treffen endete mit Vladimir von Tinkoff mit dem Clickbait-Titel des Berichts <strong>‚ÄûWie man die PR-</strong> Versammlung <strong>von 40 Minuten auf vier Minuten reduziert‚Äú.</strong>  Tats√§chlich sprachen wir √ºber die Verteilung der Starts von Gradle-Plugs: Apk-Builds, Tests und statische Analysatoren. </p><br><p>  Zun√§chst f√ºhrten die Mitarbeiter bei jeder Pull-Anfrage eine statische Analyse durch, direkt die Montage und die Tests.  Dieser Vorgang dauerte 40 Minuten, von denen nur Lint und SonarQube 25 Minuten dauerten und nur 7% der Starts fielen. </p><br><p>  Daher wurde beschlossen, den Start in einen separaten Job zu verschieben, der alle zwei Stunden nach einem Zeitplan ausgef√ºhrt wird und im Fehlerfall eine Nachricht an Slack sendet. </p><br><p>  Die umgekehrte Situation war die Verwendung von Detect.  Es st√ºrzte fast st√§ndig ab, weshalb es einem vorl√§ufigen Pre-Push-Check unterzogen wurde. </p><br><p>  Daher blieben nur die apk-Montage- und Komponententests bei der √úberpr√ºfung der Pull-Anforderung √ºbrig.  Tests kompilieren die Quellen vor dem Ausf√ºhren, sammeln jedoch keine Ressourcen.  Da die Zusammenf√ºhrung von Ressourcen fast immer erfolgreich war, wurde auch die apk-Versammlung selbst aufgegeben. </p><br><p>  Infolgedessen blieb nur der Start von Unit-Tests auf der Pull-Anfrage, wodurch wir die angegebenen 4 Minuten erreichen konnten.  Build apk wird mit Merger Pull Request in dev ausgef√ºhrt. </p><br><a name="end"></a><br><p>  Trotz der Tatsache, dass das Meeting fast 4 Stunden dauerte, konnten wir das brennende Problem der Organisation der Navigation in einem Projekt mit mehreren Modulen nicht diskutieren.  Vielleicht ist dies das Thema f√ºr die n√§chsten Kaspersky Mobile Talks.  Au√üerdem hat den Teilnehmern das Format sehr gut gefallen.  Sagen Sie uns, wor√ºber Sie in der Umfrage oder in den Kommentaren sprechen m√∂chten. </p><br><p>  Und schlie√ülich n√ºtzliche Links aus demselben Chat: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Monolith-Konnektivit√§tsdiagrammdefinition</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Regeln zum Schreiben von Code in hh und Dienstprogramme zur Unterst√ºtzung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mirakle - Plugin zum √úbertragen von Builds auf den Mainframe</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Umfrageergebnisse zur Modularisierung von Android-Anwendungen</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de446626/">https://habr.com/ru/post/de446626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de446614/index.html">Virtuelle Linux-Dateisysteme: Warum werden sie ben√∂tigt und wie funktionieren sie? Teil 1</a></li>
<li><a href="../de446616/index.html">Wie wir Cloud FaaS in Kubernetes gemacht und beim Tinkoff Hackathon gewonnen haben</a></li>
<li><a href="../de446620/index.html">DataGrip 2019.1: Unterst√ºtzung f√ºr neue Datenbanken, Initialisierungsskripte, neue Inspektionen und mehr</a></li>
<li><a href="../de446622/index.html">Nachrichten um 11</a></li>
<li><a href="../de446624/index.html">Indizes in PostgreSQL - 6 (SP-GiST)</a></li>
<li><a href="../de446628/index.html">Geben Sie mehr HighLoad ++: ab Montag in St. Petersburg</a></li>
<li><a href="../de446630/index.html">Wie man einen 3D-Drucker ausw√§hlt oder warum man einen Heiztisch und eine geschlossene Kamera ben√∂tigt</a></li>
<li><a href="../de446632/index.html">Vom Gesetz zur Big Data-Entwicklung</a></li>
<li><a href="../de446634/index.html">SDN Digest - Sechs Open Source Emulatoren</a></li>
<li><a href="../de446638/index.html">Cisco HyperFlex vs. Wettbewerber: Testleistung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>