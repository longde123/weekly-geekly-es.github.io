<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçª ü¶ï ‚õ≤Ô∏è Belanja Android - Mainkan Perpustakaan Penagihan ‚úùÔ∏è üë∏üèª üèâ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dan bagaimana masih belum ada artikel tentang Habr√© tentang ini? Tidak masalah, perlu untuk memperbaikinya. 

 Ada 2 cara untuk menambahkan pembelian ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Belanja Android - Mainkan Perpustakaan Penagihan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444072/"><img src="https://cdn-images-1.medium.com/max/2600/1*MEl6386c9aV-g7EG3-HrKw.png" alt="gambar"><br><br>  Dan bagaimana masih belum ada artikel tentang Habr√© tentang ini?  Tidak masalah, perlu untuk memperbaikinya. <br><br>  Ada 2 cara untuk menambahkan pembelian dalam aplikasi ke aplikasi Android Anda - lama dan baru.  Hingga 2017, semua orang menggunakan perpustakaan dari anjlab, tetapi sejak Juni 2017 situasinya telah berubah, Google merilis perpustakaannya sendiri untuk pembelian dan langganan internal - Play Billing Library.  Sekarang yang terakhir dianggap standar. <br><a name="habracut"></a><br>  Play Billing Library sangat sederhana. <br><br>  Hubungkan ketergantungan. <br><br><pre><code class="java hljs">implementation <span class="hljs-string"><span class="hljs-string">'com.android.billingclient:billing:1.2'</span></span></code> </pre> <br>  Tambahkan izin dalam manifes. <br><br><pre> <code class="java hljs">&lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"com.android.vending.BILLING"</span></span>/&gt;</code> </pre> <br>  Buat instance BillingClient dan mulai koneksi. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BillingClient mBillingClient; ... mBillingClient = BillingClient.newBuilder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).setListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PurchasesUpdatedListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPurchasesUpdated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> responseCode, @Nullable List&lt;Purchase&gt; purchases)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (responseCode == BillingClient.BillingResponse.OK &amp;&amp; purchases != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//       } } }).build(); mBillingClient.startConnection(new BillingClientStateListener() { @Override public void onBillingSetupFinished(@BillingClient.BillingResponse int billingResponseCode) { if (billingResponseCode == BillingClient.BillingResponse.OK) { //         } } @Override public void onBillingServiceDisconnected() { //    -    } });</span></span></code> </pre> <br>  Kami masuk ke metode <i>onPurchasesUpdated ()</i> ketika pembelian dilakukan, dalam metode <i>onBillingSetupFinished ()</i> Anda dapat meminta informasi tentang barang dan pembelian. <br><br>  Minta informasi produk.  Masukkan <i>querySkuDetails ()</i> di <i>onBillingSetupFinished ()</i> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Map&lt;String, SkuDetails&gt; mSkuDetailsMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String mSkuId = <span class="hljs-string"><span class="hljs-string">"sku_id_1"</span></span>; ... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBillingSetupFinished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@BillingClient.BillingResponse </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> billingResponseCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (billingResponseCode == BillingClient.BillingResponse.OK) { <span class="hljs-comment"><span class="hljs-comment">//         querySkuDetails(); //   } } ... private void querySkuDetails() { SkuDetailsParams.Builder skuDetailsParamsBuilder = SkuDetailsParams.newBuilder(); List&lt;String&gt; skuList = new ArrayList&lt;&gt;(); skuList.add(mSkuId); skuDetailsParamsBuilder.setSkusList(skuList).setType(BillingClient.SkuType.INAPP); mBillingClient.querySkuDetailsAsync(skuDetailsParamsBuilder.build(), new SkuDetailsResponseListener() { @Override public void onSkuDetailsResponse(int responseCode, List&lt;SkuDetails&gt; skuDetailsList) { if (responseCode == 0) { for (SkuDetails skuDetails : skuDetailsList) { mSkuDetailsMap.put(skuDetails.getSku(), skuDetails); } } } }); }</span></span></code> </pre> <br>  Dalam kode, Anda mungkin memperhatikan konsep SKU, apa itu?  SKU - dari Unit Penyimpanan Saham Inggris (pengidentifikasi barang komoditas). <br><br>  Sekarang di <i>mSkuDetailsMap</i> kami memiliki semua informasi tentang produk (nama, deskripsi, harga) yang terdaftar di Play Console dari aplikasi ini (lebih lanjut tentang itu nanti).  Perhatikan <i>skuList.add</i> baris ini <i>(mSkuId);</i>  , di sini kami menambahkan id produk dari Play Console, daftar di sini semua produk yang ingin Anda berinteraksi.  Kami memiliki satu produk ‚Äîsku_id_1. <br><br>  Semuanya siap memenuhi permintaan pembelian.  Kami melewati id produk.  Jalankan metode ini, misalnya, dengan mengklik tombol. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">launchBilling</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String skuId)</span></span></span><span class="hljs-function"> </span></span>{ BillingFlowParams billingFlowParams = BillingFlowParams.newBuilder() .setSkuDetails(mSkuDetailsMap.get(skuId)) .build(); mBillingClient.launchBillingFlow(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, billingFlowParams); }</code> </pre> <br>  Sekarang, dengan menjalankan metode ini, Anda akan melihat kotak dialog ini (sekitar Gambar dari Internet). <br><br><img src="https://cdn-images-1.medium.com/max/1200/1*GMy6xh4083vU7c6SHng57g.png" alt="gambar"><br><br>  Sekarang, jika pengguna membeli barang - mereka harus menyediakannya.  Tambahkan metode <i>payComplete ()</i> dan lakukan tindakan di dalamnya yang memberikan akses ke produk yang dibeli.  Misalnya, jika pengguna membeli pemutusan iklan, buat metode ini agar iklan tidak lagi muncul. <br><br><pre> <code class="java hljs">... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPurchasesUpdated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> responseCode, @Nullable List&lt;Purchase&gt; purchases)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (responseCode == BillingClient.BillingResponse.OK &amp;&amp; purchases != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//       payComplete(); } } ...</span></span></code> </pre> <br>  Semuanya baik-baik saja, tetapi jika pengguna me-restart aplikasi, program kami tidak tahu apa-apa tentang pembelian.  Penting untuk meminta informasi tentang mereka.  Lakukan di <i>onBillingSetupFinished ()</i> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBillingSetupFinished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@BillingClient.BillingResponse </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> billingResponseCode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (billingResponseCode == BillingClient.BillingResponse.OK) { <span class="hljs-comment"><span class="hljs-comment">//         querySkuDetails(); //   List&lt;Purchase&gt; purchasesList = queryPurchases(); //   //   ,    for (int i = 0; i &lt; purchasesList.size(); i++) { String purchaseId = purchasesList.get(i).getSku(); if(TextUtils.equals(mSkuId, purchaseId)) { payComplete(); } } } } ... private List&lt;Purchase&gt; queryPurchases() { Purchase.PurchasesResult purchasesResult = mBillingClient.queryPurchases(BillingClient.SkuType.INAPP); return purchasesResult.getPurchasesList(); }</span></span></code> </pre><br>  Dalam <i>pembelian, Daftar</i> mendapat daftar semua pembelian yang dilakukan oleh pengguna. <br><br>  Kami melakukan pemeriksaan: jika barang dibeli, jalankan <i>payComplete ()</i> . <br><br>  Selesai  Tetap mempublikasikan aplikasi ini di Play Console dan menambahkan produk.  Cara menambahkan produk: <i>Deskripsi halaman aplikasi</i> &gt; <i>Konten untuk dijual</i> &gt; <i>Buat konten terbatas</i> . <br><br>  <b>Catatan 1</b> : Anda tidak akan dapat menambahkan barang sampai Anda mengunggah aplikasi build ke Play Console. <br><br>  <b>Catatan 2</b> : Untuk melihat dialog pembelian, Anda perlu mengunggah build ke Play Console, tambahkan produk dan tunggu sebentar (~ 30 menit - 1 jam - 3 jam) hingga produk diperbarui, hanya setelah kotak dialog muncul dan Anda dapat akan melakukan pembelian. <br><br>  <b>Catatan 3</b> : <i>Harap perbaiki</i> kesalahan <i>input params.</i>  <i>SKU tidak boleh null</i> - produk di Play Console belum diperbarui, harap tunggu. <br><br>  <b>Catatan 4</b> : Anda dapat menemukan <i>Kesalahan Galat "Transaksi Anda tidak dapat diselesaikan"</i> , dalam log sebagai <i>kode respons 6,</i> saat Anda akan menguji.  Untuk alasan apa hal ini terjadi pada saya tidak diketahui secara pasti, tetapi menurut pengamatan saya, ini terjadi setelah sering dimanipulasi dengan pembelian dan pengembalian barang.  Untuk mengatasinya, buka menu kartu bank dan transfer kartu Anda.  Bagaimana cara menghindarinya?  Tambahkan akun Anda ke Play Console sebagai tester dan beli hanya dari kartu tes. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Demo di github</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Beli saya kopi</a> <br><br>  <sup><i>(Omong-omong, sistem donet berfungsi di Habr dengan tombol di bawah artikel - kira-kira Moderator).</i></sup> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id444072/">https://habr.com/ru/post/id444072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id444060/index.html">Bermigrasi dari Nagios ke Icinga2 di Australia</a></li>
<li><a href="../id444062/index.html">Menyala! Transformasi malam dari Lakhta Center</a></li>
<li><a href="../id444064/index.html">Gagasan baru untuk masa depan yang baru</a></li>
<li><a href="../id444068/index.html">Siapa yang menonton?</a></li>
<li><a href="../id444070/index.html">Mengembangkan hexapod dari awal (bagian 4) - lintasan dan urutan matematika</a></li>
<li><a href="../id444074/index.html">Internet of Things: Empat Kisah Teknologi</a></li>
<li><a href="../id444076/index.html">Bagaimana saya mencoba mengalahkan TP4056</a></li>
<li><a href="../id444078/index.html">Linux 5.1 kernel - apa yang diketahui tentang perubahan</a></li>
<li><a href="../id444082/index.html">Intisari materi menarik untuk pengembang seluler # 290 (11 Maret - 17 Maret)</a></li>
<li><a href="../id444088/index.html">Bahan baru untuk sel bahan bakar memungkinkan Anda membuat "sel energi" jangka panjang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>