<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤦 🌫️ 👩🏼‍🎨 Testen der Leistung verschiedener Laufwerkstypen in einer virtuellen Umgebung 🕺🏽 🎟️ 👍🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Virtualisierungstechnologien sind heute nicht nur im Segment „Big Business“, sondern auch in KMU und bei Heimanwendern gefragt. Insbesondere für klein...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Testen der Leistung verschiedener Laufwerkstypen in einer virtuellen Umgebung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419825/">  Virtualisierungstechnologien sind heute nicht nur im Segment „Big Business“, sondern auch in KMU und bei Heimanwendern gefragt.  Insbesondere für kleine Unternehmen können Virtualisierungsserver verwendet werden, um eine Reihe von nicht sehr ressourcenintensiven Service-Services zu implementieren.  Dies bezieht sich normalerweise auf eigenständige Server, die auf Plattformen mit einem oder zwei Prozessoren basieren, mit einer relativ geringen RAM-Größe von 32 bis 64 GB und ohne spezielle Hochleistungsspeichersysteme.  Über die ganze Reihe von Vorteilen hinaus müssen Sie sich jedoch darüber im Klaren sein, dass sich virtuelle Systeme in Bezug auf die Leistung von realen unterscheiden.  In diesem Artikel werden die Geschwindigkeiten verschiedener lokaler Laufwerkstypen (HDD, SSD und NVMe) für verschiedene Konfigurationen virtueller Maschinen verglichen, um die Verluste aus ihrer Virtualisierung abzuschätzen.  Niemand bestreitet, dass es in den „richtigen“ Implementierungen von Virtualisierungssystemen besser ist, externen Speicher zu verwenden, aber in der Budgetversion können Sie mit lokalen Festplatten auskommen. <br><a name="habracut"></a><br>  Die Tests wurden auf dem Server mit der folgenden Konfiguration durchgeführt: Asus Z10PE-D16-Motherboard, zwei Intel Xeon E5-2609 v3-Prozessoren, 64 GB RAM.  Als Virtualisierungsumgebung wurde Proxmox VE Version 5.2 ausgewählt, ein Open-Source-System, das auf Debian basiert.  Für die Installation wurde eine separate SATA-SSD verwendet, und die getesteten Laufwerke wurden separat mit anderen Schnittstellen und Ports verbunden. <br><br>  Testen Sie zunächst das Laufwerk von der Host-Plattform.  Die zweite Möglichkeit besteht darin, die virtuelle Maschine (KVM und Debian 9 werden dafür verwendet, 2 Kerne und 8 GB RAM werden zugewiesen) als physische Festplatte weiterzuleiten.  Die dritte Konfiguration ist eine virtuelle Festplatte in LVM.  Die vierte ist eine RAW-Datei auf einem Volume mit einem ext4-Dateisystem.  In den letzten beiden Optionen wurde eine Festplattengröße von 64 GB gewählt.  Ein zusätzliches Ergebnis des Artikels kann daher ein Vergleich von LVM und RAW zum Speichern von Images virtueller Festplatten sein. <br><br>  Das Dienstprogramm fio mit sequentiellen Lese- und Schreibmustern mit einem 256-KB-Block und zufälligen Operationen mit einem 4-KB-Block wird zum Messen der Geschwindigkeit verwendet.  Tests wurden mit dem Parameter iodepth von 1 bis 256 durchgeführt, um unterschiedliche Lasten zu emulieren.  Für sequentielle Operationen schätzen wir die Geschwindigkeit in MB / s, für zufällige Operationen - IOPS.  Zusätzlich betrachten wir die durchschnittlichen Verzögerungen (aus dem Testbericht). <br><br>  Beginnen wir mit einer herkömmlichen Festplatte in der Rolle des älteren HGST HUH728080ALE640 - einer Festplatte mit einer SATA-Schnittstelle und einer Kapazität von 2 TB.  Die Verwendung einzelner Festplatten, insbesondere wenn keine Volumenanforderungen bestehen, im beschriebenen Szenario der kostengünstigen Virtualisierung für eine kleine Last kann als typische Option angesehen werden, wenn Sie diese Option vollständig speichern oder "formen" und diese Option nicht berücksichtigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wc/p7/t9/wcp7t9eobeyhe_rvuer6t6jiixq.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zp/y4/og/zpy4og16idayiiof3txhbcr-6iy.jpeg" alt="Bild"></div><br>  Beim Lesen zeigen alle Optionen mit Ausnahme der letzten ungefähr die gleichen Ergebnisse bei 190 MB / s (nur bei hoher Last mit iodepth = 256 für Passthrough und LVM werden die Ergebnisse auf 150 MB / s reduziert).  Während Raw dank Caching auf dem Host „in den Weltraum fliegt“ und die anderen vor dem Hintergrund nicht mehr sichtbar sind.  Einerseits können wir sagen, dass der verwendete Test und die Systemeinstellungen es uns nicht ermöglichen, die Geschwindigkeit dieser Konfiguration korrekt zu bewerten und die Leistung nicht von RAM, sondern von RAM anzuzeigen.  Andererseits ist Caching eine der effektivsten und gebräuchlichsten Technologien zur Steigerung der Produktivität, und wenn es funktioniert, wäre es seltsam, es abzulehnen.  Vergessen Sie jedoch nicht die zuverlässige Stromversorgung in solchen Konfigurationen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7d/_p/gj/7d_pgjvsszjnvacwb6bfvys_ffy.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/de/dh/fd/dedhfdxgsey_eq9ahayxxapthok.jpeg" alt="Bild"></div><br>  Es gibt keinen solchen Effekt mehr auf die Aufnahme, so dass bei sequentiellen Operationen alle Konfigurationen ungefähr gleich sind - die maximale Geschwindigkeit beträgt ungefähr 190 MB / s.  Obwohl sich raw immer noch anders verhält als andere - mit einer kleinen Last ist es langsamer, aber maximal verlangsamt es sich nicht wie die anderen.  Es gibt keine Unterschiede bei den Verzögerungen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3_/jz/qg/3_jzqghdrkck7dbuematfrm-adk.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rr/lb/vb/rrlbvbj4a9kxjneixugzay40rmu.jpeg" alt="Bild"></div><br>  Die Verwendung des Host-Cache macht sich auch bei zufälligen Lesevorgängen bemerkbar - hier ist Raw durchweg am schnellsten und zeigt bis zu 950 IOPS.  Etwa doppelt so langsam wie lvm - bis zu 450 IOPS.  Nun, die Festplatte selbst, einschließlich der "Weiterleitung" an das Gastsystem, zeigt ungefähr 200 IOPS.  Die Verteilung der Teilnehmer auf dem Verspätungsplan entspricht den Geschwindigkeiten. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mw/f8/gz/mwf8gzltrtsihnsukyilqtyi2gs.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ff/fn/yh/fffnyhvvdvquo7sp9rjbtr_o52a.jpeg" alt="Bild"></div><br>  Bei zufälligen Schreibvorgängen erwies sich die lvm-Konfiguration, die bis zu 400 IOPS bereitstellte, als die beste.  Es folgt raw (~ 330 IOPS), und die letzten beiden Teilnehmer mit 290 IOPS schließen die Liste.  Es gibt keine merklichen Unterschiede bei den Verzögerungen. <br><br>  Wenn Sie die von lvm bereitgestellten Funktionen nicht benötigen und das Hauptkriterium nicht die zufällige Schreibgeschwindigkeit ist, ist es im Allgemeinen besser, Raw in Bezug auf die Geschwindigkeit zu verwenden, wenn Sie virtuelle Festplatten im lokalen Speicher ablegen.  Die Anwendung von Technologie zum Weiterleiten einer physischen Festplatte an eine virtuelle Maschine bietet in diesem Fall keine Leistungsvorteile.  Es kann jedoch interessant sein, wenn Sie ein Laufwerk mit vorhandenen Daten mit der virtuellen Maschine verbinden möchten. <br><br>  Der zweite Testteilnehmer ist die Samsung 850 EVO SSD.  Aufgrund seines Alters und seiner Arbeit in einem System ohne TRIM verliert er bei einigen Tests (insbesondere bei der sequentiellen Aufzeichnung) bereits auf der Festplatte.  Aufgrund eines erheblichen Leistungsgewinns bei zufälligen Vorgängen vor einer herkömmlichen Festplatte ist dies jedoch auch für virtuelle Maschinen sehr interessant. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k_/1y/on/k_1yon-hc7y0ybcvvldspq_dfas.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6q/vw/bn/6qvwbntvdeiacogszcaz0cbibc8.jpeg" alt="Bild"></div><br>  Das Ergebnis des sequentiellen Lesens im Raw-Modus kann ähnlich wie bei der Variante mit einer Festplatte kommentiert werden.  Interessanter ist hier jedoch, dass die ersten beiden Konfigurationen unter hoher Last stabile 370 MB / s aufweisen, während lvm nur 190 MB / s unterstützt.  Die Verzögerungen für diesen Modus sind ebenfalls höher. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oc/2r/js/oc2rjsdvfxgznupq-8xonsahxtq.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wl/zq/l5/wlzql5ra2fqyjk81-7-uzbrkqji.jpeg" alt="Bild"></div><br>  Wie bereits erwähnt, sieht diese SSD bei Schreibvorgängen im aktuellen Zustand nicht sehr interessant aus und zeigt eine Geschwindigkeit von 100 MB / s.  Was den Vergleich der Konfigurationen betrifft, so verliert Raw in diesem Test bei geringer Last sowohl an Geschwindigkeit als auch an Verzögerung. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2p/my/yr/2pmyyretrpqncfaly3nfkwz6jry.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l2/mh/ho/l2mhhowl7-v5u1b0dqveolb5ccu.jpeg" alt="Bild"></div><br>  Zufällige Operationen sind die Haupt-SSD "Trumpfkarte".  Hier sehen wir, dass alle „virtuellen“ Optionen merklich an ein „sauberes“ Laufwerk verlieren - sie bieten nur 30.000 IOPS, während die SSD selbst dreimal schneller arbeiten kann.  Anscheinend liegt hier die Einschränkung in der Hardware- und Softwareplattform.  Die Verzögerungen in diesem Test überschreiten jedoch nicht 7 ms, so dass es unwahrscheinlich ist, dass dieser Unterschied in IOPS von allgemeinen Anwendungen bemerkt werden kann. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wc/el/hk/wcelhk7kfzgtfs4k5xds4effhsg.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vx/gi/vz/vxgivzvxkosn3otkxcip65rfmbk.jpeg" alt="Bild"></div><br>  Und auf einer zufälligen Aufzeichnung ist ein anderes Kräfteverhältnis.  Die "echte" Scheibe verliert bereits, wenn auch leicht.  Es kann bis zu 4.200 IOPS anzeigen.  lvm und passhrough sind ein oder zweihundert mehr und raw erreicht bereits 5.500 IOPS.  In der Grafik der Verzögerungen aus einem offensichtlich interessanten Video ist ein Bruch von iodepth = 32. <br><br>  Tests haben gezeigt, dass sich die SSD in diesem Szenario anders verhält als die Festplatte.  Erstens bleibt das sequentielle Lesen mit lvm deutlich hinter anderen Optionen zurück.  Zweitens verlieren virtuelle Festplatten auf SSDs bei zufällig gelesenen IOPS merklich. <br><br>  Der dritte Teilnehmer ist etwas "preiswert", aber dieses Produkt an sich ist sehr interessant für den universellen "Beschleuniger" des Festplattenbetriebs und kann nicht nur mit einzelnen Laufwerken, sondern auch mit RAID-Arrays in der Geschwindigkeit konkurrieren.  Es geht um Intel Optane.  In diesem Fall haben wir das 900P-Modell für den PCIe 3.0 x4-Bus mit einer Kapazität von 280 GB verwendet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lh/aq/vf/lhaqvf9fxg0imqhxzvcrpx3o0i8.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eg/5h/32/eg5h32ohktgtm1iwuqci7fropdg.jpeg" alt="Bild"></div><br>  Intel Optane kann in diesem Test bereits mit dem RAM konkurrieren.  Der Unterschied ist nicht mehr wie bei den anderen Teilnehmern eine Größenordnung, sondern nur noch zwei- bis dreimal.  Darüber hinaus werden mit zunehmender Belastung die Werte praktisch verglichen.  Die Verzögerungen wie in den obigen Tests sind für die Rohkonfiguration geringer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u3/h6/1w/u3h61w2cb4xmads1t3hb4z24hwq.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7n/ol/se/7nolse87xec2wvrs5exfbfl4voa.jpeg" alt="Bild"></div><br>  Bei sequentiellen Schreibvorgängen verliert ein „sauberes“ Laufwerk sogar an andere Teilnehmer - mit zunehmender Last erreichen sie einen stabilen Wert von 2.150 MB / s und reduzieren die Geschwindigkeit auf etwa 1.700 MB / s.  Verzögerungen können in diesem Fall nicht verglichen werden. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yp/mn/ge/ypmngejmm9-_-jk0m2lvxgachji.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vb/dd/pb/vbddpbv9b1bhhyus7ovocl5zctw.jpeg" alt="Bild"></div><br>  Die zufälligen Lesevorgänge dieses SSD-Modells beim Zugriff vom Host aus können fast 200.000 IOPS bereitstellen (die Geschwindigkeit liegt bei 760 MB / s).  Alle anderen Verbindungsschemata, wie wir oben für SSDs mit einer SATA-Schnittstelle gesehen haben, sind jedoch auf 35.000 IOPS beschränkt, was nur stören kann.  Dementsprechend haben sie eine höhere Verzögerung, etwa fünfmal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/my/jh/ja/myjhjar5pwk71zrtvpqd5j2ntrg.jpeg" alt="Bild"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nn/lj/wp/nnljwpk97cdlb6jcumd9dcrkztc.jpeg" alt="Bild"></div><br>  Bei der zufälligen Aufzeichnung zeigt dieses zweifellos einzigartige Laufwerksmodell fast die gleichen Ergebnisse wie beim zufälligen Lesen - etwa 190.000 IOPS für die direkte Verbindung und 35.000 IOPS für andere Optionen.  Die Verzögerungen stimmen auch mit dem Diagramm der Leseoperationen überein.  Auf der anderen Seite mehr als 700 MB / s in zufälliger Aufzeichnung in kleinen Blöcken - solche Ergebnisse müssen noch gesucht werden. <br><br>  Die Verwendung des Intel Optane-Laufwerks für das untersuchte Problem zeigt, dass die Geschwindigkeit bei sequentiellen Vorgängen in Gastbetriebssystemen nicht wesentlich abnimmt.  Wenn Sie jedoch hohe IOPS zum zufälligen Lesen oder Schreiben benötigen, begrenzt diese Plattform die Leistung auf 35.000 IOPS, obwohl das Laufwerk selbst fünfmal schneller ist. <br><br>  Tests haben gezeigt, dass Sie beim Erstellen von Speichersystemen für virtuelle Server bestimmte Verluste durch die Virtualisierung berücksichtigen sollten, wenn die Geschwindigkeit für Ihre virtuellen Maschinen wichtig ist.  In den meisten getesteten Konfigurationen zeigen virtuelle Festplatten signifikant andere Leistungsindikatoren als physische Geräte.  Bei herkömmlichen Festplatten ist der Unterschied jedoch normalerweise relativ gering, da sie selbst nicht so schnell sind.  Bei SATA-SSDs können erhebliche Verluste in IOPS für den wahlfreien Zugriff festgestellt werden, sie bleiben jedoch bei diesen Aufgaben erheblich schneller als Winchester.  Das Intel Optane-Laufwerk hat in der virtuellen Umgebung bei zufälligen Vorgängen sicherlich viel verloren, aber selbst in diesem Fall bleibt es bei der Aufnahme weiterhin phänomenal schnell.  Und in späteren Operationen gibt es keine Kommentare zu ihm.  Ein weiterer wesentlicher Vorteil dieses Geräts ist seine stabile Leistung - es sind keine speziellen Reinigungsvorgänge erforderlich, sodass die Geschwindigkeit unabhängig vom Status und der Vergangenheit sowie dem Betriebssystem und seinen Einstellungen jederzeit konstant bleibt.  Aber wie immer passiert nichts umsonst.  Der Intel Optane 900P ist nicht nur einzigartig schnell, sondern auch einzigartig teuer. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de419825/">https://habr.com/ru/post/de419825/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de419813/index.html">Skillbox-Webinare: Auswahl am Freitag</a></li>
<li><a href="../de419815/index.html">Geheimnisse der Fehlertoleranz unseres Front Office</a></li>
<li><a href="../de419817/index.html">Starten des RabbitMQ-Clusters in Kubernetes</a></li>
<li><a href="../de419819/index.html">Biomarker des Alterns. Panel Gebrechlichkeit. Teil 2</a></li>
<li><a href="../de419823/index.html">Ungewöhnliche Duett - Passphrasen und Gedächtnisbilder</a></li>
<li><a href="../de419829/index.html">Die Standardschlüsselverschlüsselung von OpenSSH ist schlechter als keine</a></li>
<li><a href="../de419831/index.html">So funktioniert JS: Benutzerdefinierte Elemente</a></li>
<li><a href="../de419833/index.html">Fernarbeit, wie es funktioniert</a></li>
<li><a href="../de419835/index.html">Wie man Autoren motiviert, mit Experten verhandelt und im Allgemeinen gute Artikel schreibt</a></li>
<li><a href="../de419837/index.html">Ich, RoboLoyer, oder wie man in Dokumenten nach Anomalien sucht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>