<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤲🏻 🖥️ 🍿 网络安全测试入门套件 👨🏿‍🌾 🤹🏽 🆚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="大家好！ 

 我叫安德烈。 十年来，我一直在寻找各种Web服务中的漏洞。 并准备与您分享我的知识。 去年五月，我在Heisenbug会议上做了有关此事的报告，现在我也准备在Habr的露天场所分享我的知识。 因此，让我们开始吧。 

 一次，我在臭名昭著的Facebook公司的服务器上发现了一个漏洞...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>网络安全测试入门套件</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/441966/">大家好！ <br><br> 我叫安德烈。 十年来，我一直在寻找各种Web服务中的漏洞。 并准备与您分享我的知识。 去年五月，我在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Heisenbug</a>会议上做了有关此事的报告，现在我也准备在Habr的露天场所分享我的知识。 因此，让我们开始吧。 <br><br> 一次，我在臭名昭著的Facebook公司的服务器上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">发现了一个漏洞</a> 。 伙计们忘了更新ImageMagick（用于图像处理的库）并为此付费：)在此示例中，我想表明我们都是人，而且无论在哪个公司和处于哪个职位，我们都可能犯错误。 唯一的问题是这些错误可能导致各种风险。 <br> 您的应用程序/网站/工具越复杂，出现问题的可能性就越大。 <br> 您需要检查漏洞。 根本不这样做是很愚蠢的。 <br><a name="habracut"></a><br> 以下各项可能是检查Web应用程序的阶段： <br><ul><li> 准备： <ul><li> 定义入口点-实际上是数据可以从应用程序中获取的位置； </li><li> 确定技术库存； </li><li> 确定应检查哪些漏洞； </li></ul></li><li> 验证码 您需要检查适用于Web应用程序技术范围的所有漏洞。 </li><li> 代码分析。 不要偷懒，不要跳过此项目。 在某些情况下，如果无法访问代码，很难找到任何漏洞，这也使您可以绕过可能嵌入在应用程序中的筛选。 </li></ul><br> 我将详细讨论所有这些。 <br><br> 所以，准备。 我不会重点关注所有类型的漏洞，否则文章中的文字数量将超过所有可能的和难以想象的大小。 我建议您从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OWASP十大项目</a>列表中开始学习。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OWASP联盟</a>每隔几年就会列出最相关的漏洞列表。 我们将详细考虑其中的一些。 <br><br><h2>  s </h2><br>  <i>XSS（跨站点脚本）</i>是对用户的攻击，它使攻击者可以在受害者的浏览器的上下文中执行任意脚本。 大多数情况下，它意味着<i>HTML</i>标签和<i>JS</i>脚本的实现。 <br> 示例：曾经有过<i>Yahoo!</i>这样的服务。  <i>Ad Exchange</i> 密码恢复表单具有“ <i>Return URL</i> ”参数。 它可以指示在密码重置过程之后返回哪个页面。 如果在其中插入一个或另一个向量来导致<i>JS</i>代码的执行，则可以获得所有用户的<i>cookie</i> 。 我们将分析这种情况如何发生以及原因。 <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br> 这是向量本身。 一次全部： <br><img src="https://habrastorage.org/webt/ua/ko/8l/uako8l_hpqr4bov7qmzhm97xwj4.png"><br> 要进行注入，您需要摆脱默认情况下我们所处的变量的上下文（默认情况下-这是程序员在编写代码时所假定的）。 <br> 以下是原始值。 这是有效的行为。 <br><img src="https://habrastorage.org/webt/v4/rm/l7/v4rml7dzf1rqpkyvgq8yxdnl3oi.png"><br> 我们看到returnURL = / login.jsp <br> 这属于<i>&lt;input&gt;标记</i>的值。 <br> 如果我们在<i>jsp</i>之后添加引号，我们将看到<i>HTML</i>语法已经注入。 幸运的是， <i>HTML</i>语言并不严格，解析器将跳过，不会有任何问题： <br><img src="https://habrastorage.org/webt/3o/s6/z1/3os6z130clrrtkshbktmqgkguto.png"><br> 添加另一个字符。 在这里，我们完全脱离了<i>&lt;input&gt;标记</i>的上下文： <br><img src="https://habrastorage.org/webt/lg/x9/av/lgx9avfst6nskdlowyzx0uasgyy.png"><br> 现在，我们添加<i>&lt;svg&gt;标签</i>的开头，就语法而言，我们得到了两个有效的标签： <br><img src="https://habrastorage.org/webt/u8/pe/tg/u8petg6ghf1gajt49dvsvtfnzn0.png"><br> 接下来，添加整个攻击向量： <br><img src="https://habrastorage.org/webt/o2/t5/n8/o2t5n8-li9jpdao1cbzghum-mhe.png"><br> 在这种情况下，将绘制<i>svg</i>图片。 使用“ <i>onload</i> ” <i>JavaScript</i>处理程序，我们使用文档的<i>cookie</i>执行警报。 仅此而已！ 攻击者收到了您的<i>cookie</i> 。 <br> 如果在证据中我们仅显示警报本身，那么对于攻击者而言，将cookie发送到由他控制的服务器并不困难，在最坏的情况下，也可以抓住您的帐户。 让我们再看一下它的外观： <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br> 客户端上还有更多的攻击媒介。 我将给出一些带有简短描述的示例。 但是首先，您需要了解如何脱离上下文： <br><ul><li> 脱离上下文。 这6个字符不仅有助于从HTML参数值的上下文中脱颖而出，而且还可以帮助您脱颖而出： <br>  -&gt;'“&gt; <br></li></ul><br> 好吧，实际上，这是两个最简单的攻击媒介： <br><ul><li> 特别插入链接。 但在一般情况下-更改页面的外观。 例如，他们可能在您的页面中嵌入html代码，并显示一些伪造的窗口，要求输入数据： <br><img src="https://habrastorage.org/webt/dt/-p/yz/dt-pyzv0wcrhgxqihw3iuoccbnc.png"><br> 字符串“ <i>aaaa</i> ”指向<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">google.com</a> 。 您可以看到该链接已呈现在页面上，但是您可能看不到该链接，但这不会取消其在代码中的存在。 在这两种情况下，都可以认为案件已经完成； </li><li> 脚本执行，例如，拦截用户<i>cookie</i> ： <br><img src="https://habrastorage.org/webt/w8/yd/yb/w8ydybkf9oucxuawq_vumapupda.png"><br></li></ul><br><br><h3> 在哪里以及如何搜索XSS？ </h3><br> 首先，在页面上找到信息/数据输出功能。 分析什么数据到达那里？ 这里是<i>不可信来源</i>的概念。 首先是<i>您的用户</i> 。 攻击媒介可以包含在任何其他来源中：RSS源，其他服务（内部和外部）。 <br> 这是一个真实的例子：我为SEMrush IT工作。 我们正在开发一个在线平台，这是在线营销人员的通用工具。 因此，一个服务为我们保存了数据，另一个推论了，每个团队彼此依赖，事实证明，由于缺少对输出数据的正确处理，第二个服务<i>XSS</i>出现了，并且第一个命令根本没有必要过滤输入的数据以任何方式保留其“ <i>原样</i> ”。 结论：如果您不知道该或该数据的存储方式，则应将其视为不可信的。 或者事先就谁存储以及如何存储，过滤和显示数据达成协议。 <br><br> 如果您已经有来自不受信任来源的数据，那么我建议： <br><ul><li> 研究传入数据的过滤； </li><li> 检查输出的上下文。 即使没有过滤，也并非在所有情况下都可以执行<i>XSS</i> 。 例如，如果响应的<i>Content-type</i>是： <i>text / plain;</i> </li><li> 不要依靠过滤嵌入式安全系统框架。 </li></ul><br><br><h2>  SQL注入 </h2><br><img src="https://habrastorage.org/webt/do/b8/ry/dob8ryjj2vifp3w1th18oroewis.png"><br><br>  <i>SQL代码的实现（英语SQL注入）</i> -在数据库查询中引入了此处未隐含的指令。 <br><br> 例子（不是从生活，而是好的）： <br> 我们看到一个显示用户表的脚本。 在这种情况下，他可以按用户名搜索。 <br> 右侧显示对数据库查询的外观，左侧显示浏览器中脚本的结果。 <br><img src="https://habrastorage.org/webt/ng/u2/ou/ngu2ouq8da3jtb18gkjj2amzxss.png"><br> 此外，为了测试并至少获得一些主要结果，我们在name参数的值中插入了两个引号。 单人和双人： <br><img src="https://habrastorage.org/webt/0a/fd/ck/0afdckohg1xuacw-7olxyrzifha.png"><br> 我们从输出的角度来看，一切都崩溃了，表格完全消失了。 该请求还将获得额外的2个引号。 违反了<i>SQL</i>查询的整个语法。 <br> 如果我们采用这样的构造并将其添加到参数值（ <i>ed .：在黄色框中查看</i> ），我们将得到一个绝对有效的请求。 页面输出与第一个请求完全相同，该请求不包含注入： <br><img src="https://habrastorage.org/webt/nh/9q/gu/nh9qguk8d0unxfz1bsxlfb0n8vo.png"><br> 为了完全验证是否存在漏洞，我们添加了一个平局而不是统一： <br><img src="https://habrastorage.org/webt/lx/je/a6/lxjea6hv3hebohiv96gpauuo4o0.png"><br> 事实证明，从布尔逻辑的角度来看，该请求变为假，因此不包含数据。 但是，与发生错误的时刻不同，我们拥有表本身的输出。 <br><br> 为了不列出可能在不同数据库引擎和不同类型查询中的所有内容，我将所有内容简化为一行： <br><img src="https://habrastorage.org/webt/xz/ok/mn/xzokmnhyzqdepnyax-n1bzd8siq.png"><br> 您可以尝试输入参数，然后根据答案中的差异尝试了解正在发生的事情，是否存在漏洞。 大约有80％的情况您可以使用此操作进行处理。 <br> 在困难的情况下，仍有20％的情况不会为您提供任何信息，例如：嵌套查询/过滤等。 在我的实践中，我只遇到过一次类似的经历。 然后，我不得不绕过服务端的过滤。 <br><br>  SQL有什么危险？ <br><ul><li> 从明显的<i>信息泄漏</i> 。 如果攻击者能够对您的数据库生成查询，则他可以以一种或另一种方式获取不应被输出的值（密码散列，客户端地址等）； </li><li>  <i>数据变更</i> 。 现在，许多开发人员通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ORM</a>系统使用数据库。 这些系统本身默认情况下允许您一次进行多个查询，SQL语法也允许您这样做。 如果存在漏洞，则不仅可以选择数据，还可以更改数据（包括删除表，更改数据库结构等）。 <br> 在相同情况下，可能会增加用户特权。 更改某些表中的字段（例如，在<i>用户</i>数据库中放置<i>is_admins = true</i> ），从而提高您对管理员的权限； </li><li>  <i>拒绝服务</i> 在某些情况下，注射可能会导致拒绝服务。 生成了多个对数据库的繁重查询，并在多个线程中启动了这些查询，并且您的服务可能会停止一段时间。 </li><li>  <i>读取系统文件</i>是SQL注入可能带来的另一场灾难。 这种风险的发生取决于您使用的数据库系统以及使用该数据库系统的用户（是否特权）； </li><li>  <i>RCE（远程代码执行）</i>是代码执行。 它直接取决于所使用的数据库类型（以前在默认情况下，使用MSSQL中的默认数据库设置，这是可能的）。 </li></ul><br> 下表显示了<i>SQL</i>查询中的漏洞。 当然，您不需要记住它。 另外，这些并不是所有可能的选择，而仅仅是示例。 请注意以下事实：如果原始数据到达<i>SQL</i>查询的地方可能会以红色突出显示。 有经验的攻击者可能会找到一种方法来利用此漏洞。 小心细心。 <br><img src="https://habrastorage.org/webt/gz/bt/xh/gzbtxhbbrkng9axlc2av07rax9o.png"><br><br><h2>  SSRF（服务器端请求伪造） </h2><br> 文字翻译-服务器端的虚假请求。 也就是说，一种攻击使您可以操纵发送到应用程序的数据，从而迫使您不向业务逻辑最初计划的位置发出请求。 <br> 下图显示了<i>SSRF</i>的操作： <br><img src="https://habrastorage.org/webt/cn/3m/xc/cn3mxclin9jb7tr5fdg6zcowez8.png"><br> 有一个攻击者，有您的服务器，该服务器已被<i>防火墙</i>关闭，但同时有一项功能可让您进一步代表服务器发出请求。 <br> 如果此功能没有得到适当的保护和/或不正确的保护（如通常发生的情况：），处理传入的数据，则攻击者可以使用<i>Memcached</i> ， <i>Redis</i>或访问受害者的任何内部资源。 <br><br> 对于一个更具说明性的示例，请考虑SEMrush用于内部员工培训的展台。 <br> 重要的是要注意“ <i>头像URL</i> ”的含义： <br><img src="https://habrastorage.org/webt/yi/yp/fr/yiypfrzdsu-pqg0adlbup1ziqgk.png"><br> 这里我们注意两点： <br><ul><li> 头像网址本身 </li><li> 以及使用文件下载它的能力。 </li></ul><br> 请注意，“ <i>Avatar URL</i> ”字段是用于输入的文本字段，这意味着我们可以操纵该值。 让我们尝试使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">404错误</a>页面上的化身，也许是互联网上最著名的图片-Googlebot。 <br> 做一次： <br><img src="https://habrastorage.org/webt/hg/8d/oa/hg8doavbzbji9apfewlydlpxhyq.png"><br> 双击“ <i>保存”</i> 。 我们得到了一个机器人而不是我的照片： <br><img src="https://habrastorage.org/webt/kf/4x/lr/kf4xlr2atwvebex_dmsiqlxvmbi.png"><br> 在这里，值得注意的是，“ <i>头像URL</i> ”的值已更改为某些本地路径-显然，应用程序请求了图片，将其保存到服务器并替换了新值。 <br><br> 我们继续前进。 在“ <i>URL头像</i> ”字段中，输入值<i>文件：/// etc / passwd</i> 。 此设计使您可以访问文件结构。 在某些用于<i>HTTP的</i>库中，默认情况下，使用文件结构的功能处于打开状态，并从启动它们的服务器接收数据： <br><img src="https://habrastorage.org/webt/_j/2i/jb/_j2ijbofjimkfmd2tjxmoegkh4k.png"><br> 单击“ <i>保存</i> ”按钮后会发生什么？ <br> 首先，图片变成“ <i>蝙蝠</i> ”，其次，文件的路径改变了。 <br><img src="https://habrastorage.org/webt/bn/ro/d5/bnrod5bxckue0avxxbvvktglimg.png"><br> 如果我们尝试在浏览器中请求此图像，则它们将不会向我们显示任何内容（文件已“ <i>损坏</i> ”）。 但是我们不是信息安全的第一天，我们知道该怎么做:)通过简单的操作，我们可以在计算机上获取文件的内容： <br><img src="https://habrastorage.org/webt/vd/sw/97/vdsw97u1ce8abtqa2aqcp_zb2ac.png"><br> 因此，借助此漏洞，我（作为攻击者）可以获取服务的所有源代码以及其他数据，以供正在运行Web服务的用户阅读。 <br> 让我们看一下SSRF的危险： <br><ul><li> 端口扫描。 对于外部网络，您的服务是一个入口点和2个端口（http和https）。 通过从基础架构内部扫描端口，攻击者可以检测到打开的端口。 </li><li> 绕过基于主机的身份验证。 有什么意义？ 您的结构中可能有仅对某些资源可用的服务（请参阅：IP白名单）。 因此，如果您的易受攻击的服务器在白名单中，则可以访问他可用的那些服务，从而可以对其进行操作； </li><li> 继续开发上述攻击，您可以继续利用Intranet或本地服务器上运行的漏洞程序。 在很多情况下，内部基础结构（外部无法访问）的监控不佳（版本/安全补丁等并不总是更新）。 这也可能导致攻击和数据盗窃； </li><li> 读取本地数据。 我在上面展示了一个例子。 可以读取和访问您的配置，令牌和密码。 </li></ul><br><br><h3> 在哪里寻找SSRF？ </h3><br> 这不是标准漏洞。 它可以在不同的地方找到，通常是在最意外的地方。 在这种情况下，“在这里看，但您甚至可能不在这里看”技术无效。 <br> 可能出现<i>SSRF的</i>迹象： <br><ul><li>  <i>Webhook</i> 。 如果它们的配置不正确，如果在Webhooks发出请求的那些服务器上防火墙配置不正确，则可以获得漏洞。 </li><li>  <i>HTML转换</i> 。 尝试嵌入指向内部服务的<i>&lt;iframe&gt;</i> ， <i>&lt;img&gt;</i> ， <i>&lt;base&gt;</i> ， <i>&lt;script&gt;</i>或<i>CSS</i> <i>url</i>结构； </li><li>  <i>下载已删除的文件</i> 。 还记得化身的例子吗？ 当用户有机会通过URL将数据上传到服务器时，这就带来了很大的问题。 尝试发送带有端口的URL，并查看上传了哪些内容。 </li></ul><br><br><h3> 如何搜索SSRF？ </h3><br><ul><li> 提升服务器并运行<i>侦听器</i> ： <br><pre><code class="bash hljs">user$ nc -1 -n -vv -p 8080 -k</code> </pre> <br> 这样，您将看到端口<i>8080</i>上到达服务器的所有请求。 一方面，它是您的Web服务器上未占用的端口，另一方面，它通常是未被<i>Firewall</i>过滤的端口。 据认为，它用于<i>http</i>协议，并禁止它是可选的； </li><li> 在正在研究的应用程序中，找到参数，您可以将路径传递给该参数，以从我们的主机（向我们的<i>侦听器</i> ）请求数据； </li><li> 检查<i>列表器的</i>输出或返回的响应。 </li></ul><br><br><h2>  XXE（XML外部实体） </h2><br> 我将像往常一样以一个例子开始这个故事，以便使它更加清楚： <br> 在前面提到的SEMrush服务中，有一个用于处理内容分析的工具。 用户输入其站点或竞争对手站点的URL，然后在对其进行分析之前，该服务将下载此内容。 观看视频中的情况： <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WS3pJoyWwto" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br> 要下载，该服务将访问指定的站点，并且<i>搜寻</i>器将下载<i>sitemap.xml</i>文件。 这就是我们在本模块中讨论的<i>XML</i> 。 <br> 在视频中，我们可以观察到攻击站点如何将外部实体<i>XXE</i>的定义添加到<i>sitemap.xml</i> ，该定义指向“ <i>file：/// etc / hosts</i> ”。 在Linux系统上，这是一个文件，如果没有<i>DNS</i>记录，则描述与主机对应的IP。 <br> 接下来，攻击者在<i>&lt;loc&gt;标记中</i>指示此变量<i>的</i>扩展。 之后， <i>XML</i>解析器在处理了隔离专区中的所有<i>XML</i>之后，将位置为“ <i>file：/// etc / hosts</i> ”的值插入到<i>位置</i>变量中（在视频中以红色突出显示）。 <br> 攻击者启动了我们的解析器的启动，进入了日志，然后出现一行，在视频中以白色突出显示。 这是在<i>GET</i>请求中获得的文件“ <i>file：/// etc / hosts</i> ”的内容，该文件由它控制的服务器的日志中。 <br> 接下来是什么？ 攻击者将验证他是对的。 它将文件名更改为“ <i>file：/// etc / fstab</i> ”，再次运行解析器并获取有关正在运行的进程的统计信息。 <br><br> 最后是“ <i>file：/// etc / hostname</i> ”，启动解析器，转到日志并获取我们所在机器的<i>主机名</i> 。 <br> 这是与我们公司无关的真人发现的真实错误。 我不得不在头上撒灰，然后付钱:) <br><br>  <i>XXE的</i>另一个示例： <br><img src="https://habrastorage.org/webt/3t/va/i9/3tvai98kmgwwmpjwh0wjjuzodk0.png"><br> 假设我们有一个特定的<i>端点</i> ，称为<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-example.com/xxe</a></i> 。 <br> 我们向其发送<i>XML</i>结构→在<i>XML中，我们</i>声明实体<i></i> →实体<i></i>引用系统文件<i>/ etc / passwd</i>并在响应主体中进一步打开→我们在响应中获取此文件的内容。 <br> 值得一提的是，这种情况并不像我们希望的那样频繁发生。 <br><br><h3> 为什么行得通？ </h3><br>  <i>XML</i>文档是一种结构化的数据格式，除其他外，它使您可以使用特殊的<i>DOCTYPE</i>标记描述它可能包含的数据类型。 <br>  <i>数据类型定义（DTD）</i> -此<i>XML</i>文档中数据类型的定义。 有三种方法可以完成此操作： <br><ul><li> 如果文档支持<i>DTD</i> 。 下面的示例显示了一些<i>XML</i> ，其中包含一个订单结构，一个<i>product</i>元素和一个<i>count</i>元素（大概是：产品的库存数量和订单中的项目数量）。  <i>Order</i>是这两个元素的父元素： <br><img src="https://habrastorage.org/webt/ft/to/kb/fttokbp3vkqsknatvo8yql9p5h4.png"></li><li> 本地服务器上的外部DTD。 <br> 我们执行与第一实施例相同的操作，但是我们将所有定义都放在一个单独的文件中，该文件位于本地服务器上： <br><img src="https://habrastorage.org/webt/qy/re/3m/qyre3m2bfjatzni4bdq6t-3opko.png"><br></li><li> 第三方服务器上的外部DTD： <br><img src="https://habrastorage.org/webt/wf/dj/tp/wfdjtpme3bh_lnhgiyr56m-p5si.png"></li></ul><br> 如果您是一位专心的读者，则可能与以下事实相关：在您的服务上发出此类请求和请求外部<i>DTD</i>方案的能力本身就是一个漏洞，我们在上文中谈到过，即<i>SSRF</i>漏洞。 <br> 常见的情况是：开发人员修复了<i>XXE</i>漏洞，但是忘记禁止处理外部<i>DTD</i>并获得<i>SSRF</i> 。 由此不会导致致命的后果，但您不要忘记它。 <br><br><h3>  XML中的实体是什么？ </h3><br>  <i>XML中的</i> <i>实体</i> 。 这是什么 这是定义某些值并将其驱动为变量的机会。 实体具有三种不同的类型： <br><img src="https://habrastorage.org/webt/er/lb/h7/erlbh7l8z_adl4nla3ll_tir1rm.png"><br>  <i>预定义</i> -预定义。 与<i>HTML</i>代码类似，可以将语言语法中的那些字符用作文本结构。 这里以它们为例，以便您了解它是什么。 是的，在大多数攻击中都没有使用它们，但是在某些特殊情况下可能需要使用它们。 <br>  <i>通用</i>和<i>参数</i> 。 这是相同的，只是它们声明的语法发生变化，以及声明后如何调用它们 <br><br><h3> 在哪里寻找<i>XXE</i> ？ </h3><br> 几种选择： <br><ul><li> 任何形式的<i>XML</i>处理： <br><ul><li>  <i>SVG;</i> </li><li>  <i>网站地图;</i> </li></ul></li><li> 将<i>HTML</i>转换为其他格式； </li><li> 处理<i>docx</i> ， <i>xlsx</i>和类似格式。 </li></ul><br><br><h3> 如何寻找他们？ </h3><br><img src="https://habrastorage.org/webt/eo/ce/tl/eocetlpzyfdgocqc2qwv1hbxnhe.png"><br> 图片仅显示一个示例。 它不是通用密钥。 需要针对您正在研究的服务中使用的格式进行优化。 <br><br> 我们要做的第一件事：声明一个实体<i>Z</i> ，该实体<i>Z</i>访问受攻击主机控制的主机，并将其扩展到<i>XML</i>文档的主体内。 <br> 在这里，第二种选择是可能的-只是<i>Parameter</i>的本质。 与第一个广告不同（ <i>％</i>符号）。 并且为了转向这个本质，不再需要文档的主体。 我们可以直接在<i>DOCTYPE</i>结构中访问它并公开此实体： <br><img src="https://habrastorage.org/webt/3-/hc/xo/3-hcxohtjre3dee0mbed39vlfzq.png"><br> 第三种情况是查看是否已打开或关闭从外部服务请求<i>DOCTYPE</i>的功能： <br><img src="https://habrastorage.org/webt/xn/yo/nj/xnyonjotk9gmb4l1ba-d818g3k4.png"><br> 接下来，我们看看由我们控制的服务器的输出。 如果我们看到来自各个<i>IP</i>地址的对<i>URL</i>的调用<i>/检查</i> ，则意味着漏洞通过的可能性很高，然后我们只需要弄清楚如何为我们获取更多有趣的数据即可。 <br><img src="https://habrastorage.org/webt/xl/7d/oz/xl7dozt94jtm9zf3c_zfr39kacq.png"><br>  <i>XXE</i>的危险是什么？ 我将简短地逐点编写： <br><ul><li> 读取本地文件； </li><li> 获得当地资源； </li><li> 端口/主机扫描 </li><li>  <i>纯文本包装器</i> 。 这是访问基于纯文本协议运行的服务的机会。 </li><li>  <i>远程执行代码</i> （不经常<i>执行</i> ）。 默认情况下它是关闭的； </li><li>  <i>拒绝服务</i> 由于实体可以串联在一起，因此可以轻松地获得这些参数占用的内存量的指数增长。 结果是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">十亿个笑声发作</a> 。 换句话说，您只是在使受攻击服务器的内存超载。 </li></ul><br> 总之，我要说的是，如果没有实际应用，所有这些（文章以及您所获得的任何知识）是没有意义的。 因此，我会问您一个真正的琐事：考虑一下您昨天编写/测试的应用程序，并尝试检查其是否存在漏洞。 是否有任何输入表单或<i>XML</i>处理？ 此应用程序受保护吗？ 是否添加了过滤功能并禁用了<i>DTD</i> ？ <br> 打开<i>SQLmap</i>手册，了解如何使用它来检查您的应用程序。 如果他没有找到任何东西，请使用其他工具并进行检查，然后测试您的应用程序是否存在其他漏洞。 就像我在开始时所说的那样，本文仅研究了几个漏洞，但其中有<i>数千个</i> 。 <br> 我不认为您可以编写绝对安全的代码。 总是存在漏洞，您只是<i><u>还没有发现</u></i>它们。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN441966/">https://habr.com/ru/post/zh-CN441966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN441952/index.html">选择文件存储系统进行团队合作</a></li>
<li><a href="../zh-CN441954/index.html">用户奖赏给Habr的作者</a></li>
<li><a href="../zh-CN441956/index.html">统一的错误处理（微控制器的C ++选项）</a></li>
<li><a href="../zh-CN441962/index.html">PostgreSQL中的索引-1</a></li>
<li><a href="../zh-CN441964/index.html">Kubernetes技巧与窍门：将集群资源移至Helm 2</a></li>
<li><a href="../zh-CN441968/index.html">开发新产品分支：如何摆脱不切实际并保持有用</a></li>
<li><a href="../zh-CN441970/index.html">FinFisher Butkit分析</a></li>
<li><a href="../zh-CN441972/index.html">令人难以置信-其他YouTube前端</a></li>
<li><a href="../zh-CN441974/index.html">历史学家从HR到Java程序员的道路：有点运气和毅力</a></li>
<li><a href="../zh-CN441976/index.html">与您一起FizTech.Science：我们正在寻找隐藏的参数，并跳入奇妙的量子世界</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>