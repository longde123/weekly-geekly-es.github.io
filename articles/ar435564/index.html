<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤´ğŸ¿ ğŸ§’ğŸ¾ ğŸ‡ğŸ½ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GtkApplication. Librsvg ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…ÙŠØ²Ø§Øª ğŸ“” ğŸ‘‚ğŸ¿ ğŸ—½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‚Ø§Ù„. 



- Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GtkApplication. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ù„ÙƒÙŠ. Makefile. 
- Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙƒØªØ¨Ø© librsvg. 
- ØªØµØ¯ÙŠØ± ØµÙˆØ±Ø© Ø¥Ù„Ù‰ GtkImage ÙˆØ­Ø¬Ù…Ù‡Ø§. 
- ØªØ­Ø¬ÙŠÙ… SVG Ù…...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GtkApplication. Librsvg ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ù…ÙŠØ²Ø§Øª</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435564/" style=";text-align:right;direction:rtl">  Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‚Ø§Ù„. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GtkApplication.  ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³Ù„ÙƒÙŠ.  Makefile. </li><li style=";text-align:right;direction:rtl">  Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙƒØªØ¨Ø© librsvg. </li><li style=";text-align:right;direction:rtl">  ØªØµØ¯ÙŠØ± ØµÙˆØ±Ø© Ø¥Ù„Ù‰ GtkImage ÙˆØ­Ø¬Ù…Ù‡Ø§. </li><li style=";text-align:right;direction:rtl">  ØªØ­Ø¬ÙŠÙ… SVG Ù…Ø¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©. </li><li style=";text-align:right;direction:rtl">  Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª. </li><li style=";text-align:right;direction:rtl">  Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ GtkDrawingArea Ù…Ù‚Ø§Ø¨Ù„ GtkImage. </li></ul><a name="habracut"></a><br>  ÙÙŠ ÙˆÙ‚Øª Ø³Ø§Ø¨Ù‚ ØŒ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù…Ù‚Ø§Ù„Ø§Øª (ÙˆÙ„ÙŠØ³Øª Ù…Ù‚Ø§Ù„Ø§Øª) ÙÙŠ Ù„ÙˆØ­Ø© ÙˆØµÙ„ GTK + ØªØ³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© gtk_main (void) Ø§Ù„ÙØ§Ø±ØºØ© ÙÙŠ Ø§Ù„Ø£Ù…Ø«Ù„Ø© Ø›  ØªØªÙŠØ­ Ù„Ùƒ ÙØ¦Ø© GtkApplication ØªÙ…ÙŠÙŠØ² ÙˆØ¸Ø§Ø¦Ù Ø±Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ application_activate Ùˆ application_shutdown Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­.  Ù…Ø¹ gtk_main ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø±Ø¨Ø· gtk_main_quit Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­ Ø¨Ø­ÙŠØ« Ø£Ù†Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ÙÙˆÙ‚ Ø§Ù„ØªÙ‚Ø§Ø·Ø¹ ØŒ ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.  ÙŠÙ†Ù‡ÙŠ GtkApplication Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ„ÙŠØ¨ ØŒ ÙˆÙ‡Ùˆ Ø£ÙƒØ«Ø± Ù…Ù†Ø·Ù‚ÙŠØ©.  ÙŠØªÙƒÙˆÙ† Ø¥Ø·Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù†ÙØ³Ù‡ Ù…Ù† main.h Ùˆ Makefile Ùˆ string.gresource.xmlØŒ main.c. <br><br>  <b>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</b> <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;gtk/gtk.h&gt; typedef struct{ GtkApplication *restrict app; GtkWidget *restrict win; GtkBuilder *restrict builder; }appdata; appdata data; appdata *data_ptr; #endif</span></span></span></span></code> </pre> <br>  <b>Makefile</b> <br><br>  Ø¹Ø§Ù„Ù…ÙŠ Ù‡Ù†Ø§ ØŒ ÙŠØ³Ù…Ø­ Ù„Ùƒ Ø¨ØªØ±Ø¬Ù…Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØµØ¯Ø± Ø¯ÙˆÙ† ØªØ­Ø¯ÙŠØ¯ Ø£Ø³Ù…Ø§Ø¡ Ù…Ù„ÙØ§Øª Ù…Ø­Ø¯Ø¯Ø© ØŒ ÙˆÙ„ÙƒÙ† Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ù„ÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø¯ ØŒ ÙØ³ÙŠÙ‚Ø³Ù… Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠ. <br>  ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ù‹Ø§ Ø§Ø³ØªØ®Ø¯Ø§Ù… CC = g ++ -std = c ++ 11 ØŒ Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ ÙˆØ¶Ø¹ ÙˆØ¸Ø§Ø¦Ù Ø±Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ <br>  Ø®Ø§Ø±Ø¬ÙŠ "C". <br><br><pre style=";text-align:right;direction:rtl"> <code class="cmake hljs">CC = gcc -std=c99 PKGCONFIG = $(shell which pkg-config) CFLAGS = $(shell $(PKGCONFIG) --cflags gio-<span class="hljs-number"><span class="hljs-number">2.0</span></span> gtk+-<span class="hljs-number"><span class="hljs-number">3.0</span></span> librsvg-<span class="hljs-number"><span class="hljs-number">2.0</span></span>) -rdynamic -O3 LIBS = $(shell $(PKGCONFIG) --libs gio-<span class="hljs-number"><span class="hljs-number">2.0</span></span> gtk+-<span class="hljs-number"><span class="hljs-number">3.0</span></span> gmodule-<span class="hljs-number"><span class="hljs-number">2.0</span></span> librsvg-<span class="hljs-number"><span class="hljs-number">2.0</span></span> epoxy) -lm GLIB_COMPILE_RESOURCES = $(shell $(PKGCONFIG) --variable=glib_compile_resources gio-<span class="hljs-number"><span class="hljs-number">2.0</span></span>) SRC = $(wildcard *.c) GEN = gresources.c BIN = main ALL = $(GEN) $(SRC) OBJS = $(ALL:.c=.o) all: $(BIN) gresources.c: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.gresource.xml $(shell $(GLIB_COMPILE_RESOURCES) --sourcedir=. --generate-dependencies <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.gresource.xml) $(GLIB_COMPILE_RESOURCES) <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.gresource.xml --<span class="hljs-keyword"><span class="hljs-keyword">target</span></span>=$@ --sourcedir=. --generate-source %.o: %.c $(CC) $(CFLAGS) -c -o $(@F) $&lt; $(BIN): $(OBJS) $(CC) -o $(@F) $(OBJS) $(LIBS) clean: @rm -f $(GEN) $(OBJS) $(BIN)</code> </pre><br>  <b>string.gresource.xml</b> <br><br>  ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ†ÙÙŠØ° ØŒ ÙˆÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø§Ù„Ø© ÙŠÙƒÙˆÙ† Ù…Ù„Ù ÙˆØµÙ ÙˆØ§Ø¬Ù‡Ø© window.glade <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gresources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gresource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">prefix</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/com/example/YourApp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">preprocess</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xml-stripblanks"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">compressed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span>window.glade<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gresource</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gresources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <b>main.c</b> <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"main.h"</span></span></span><span class="hljs-meta"> GtkBuilder* builder_init(void) { GError *</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta"> = NULL; data.builder = gtk_builder_new(); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!gtk_builder_add_from_resource (data.builder, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/com/example/YourApp/window.glade"</span></span></span><span class="hljs-meta">, &amp;</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta">)) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//     g_critical ("   : %s", error-&gt;message); g_error_free (error); } gtk_builder_connect_signals (data.builder,NULL); return data.builder; } void application_activate(GtkApplication *application, gpointer user_data) { GtkBuilder *builder=builder_init(); data_ptr=&amp;data; data.win=GTK_WIDGET(gtk_builder_get_object(builder, "window1")); gtk_widget_set_size_request(data.win,360,240); gtk_application_add_window(data.app,GTK_WINDOW(data.win)); gtk_widget_show_all(data.win); } void application_shutdown(GtkApplication *application, gpointer user_data) { g_object_unref(data.builder); } int main (int argc, char *argv[]) { gtk_init (&amp;argc, &amp;argv); gint res; data.app = gtk_application_new("gtk.org", G_APPLICATION_FLAGS_NONE); g_signal_connect(data.app, "activate", G_CALLBACK(application_activate), NULL); g_signal_connect(data.app, "shutdown", G_CALLBACK(application_shutdown), NULL); res = g_application_run(G_APPLICATION(data.app), 0, NULL); return 0; }</span></span></span></span></code> </pre><br>  ÙÙŠ Ø§Ù„ÙˆØ³ÙŠØ·Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„Ø¯Ø§Ù„Ø© gtk_application_new ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ÙˆØ¶Ø¹ Ø£ÙŠ Ù†Øµ ØŒ Ù„ÙƒÙ†Ù‡ Ù„Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ù†Ù‚Ø·Ø©.  ÙŠØ­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø«Ø§Ù„ Ø£ÙŠØ¶Ù‹Ø§ Ù…Ù„Ù window.glade ØŒ ÙˆØ§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ† Ø¥Ù†Ø´Ø§Ø¤Ù‡ ÙÙŠ Ù…Ø­Ø±Ø± Glade UI. <br><br>  Ù†Ù‚Ø³Ù… Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ø­Ø§ÙˆÙŠØ© GtkBox Ø¥Ù„Ù‰ Ù‚Ø³Ù…ÙŠÙ† ØŒ ÙÙŠ Ø£Ø­Ø¯Ù‡Ù…Ø§ Ù†Ø¶Ø¹ GtkDrawingArea ØŒ Ù…Ù† Ø¬Ù‡Ø© Ø£Ø®Ø±Ù‰: <br><br><img src="https://habrastorage.org/webt/d4/_f/qy/d4_fqyifbcg7k12sfrrrw6d-xw0.png"><br><br>  Ù†ØªÙŠØ¬Ø© Ù„Ø°Ù„Ùƒ ØŒ Ø³ÙŠØªØºÙŠØ± appdata <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class">{</span></span> GtkApplication *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> app; GtkWidget *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> win; GtkBuilder *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> builder; GtkDrawingArea *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> draw; GtkImage *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> image; GtkEventBox *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> eventbox1; RsvgHandle *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> svg_handle_image; RsvgHandle *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> svg_handle_svg; GdkPixbuf *pixbuf; <span class="hljs-keyword"><span class="hljs-keyword">cairo_t</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> cr; <span class="hljs-keyword"><span class="hljs-keyword">cairo_surface_t</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> surf; }appdata;</code> </pre><br>  ÙˆØ¨Ø§Ù„ØªØ§Ù„ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application_activate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GtkApplication *application, gpointer user_data)</span></span></span><span class="hljs-function"> </span></span>{ GtkBuilder *builder=builder_init(); data_ptr=&amp;data; data.win=GTK_WIDGET(gtk_builder_get_object(builder, <span class="hljs-string"><span class="hljs-string">"window1"</span></span>)); data.draw=GTK_DRAWING_AREA(gtk_builder_get_object(builder, <span class="hljs-string"><span class="hljs-string">"drawingarea1"</span></span>)); data.image=GTK_IMAGE(gtk_builder_get_object(builder, <span class="hljs-string"><span class="hljs-string">"image1"</span></span>)); gtk_widget_set_size_request(data.win,<span class="hljs-number"><span class="hljs-number">640</span></span>,<span class="hljs-number"><span class="hljs-number">480</span></span>); gtk_application_add_window(data.app,GTK_WINDOW(data.win)); gtk_widget_show_all(data.win); }</code> </pre><br>  Ø£Ø¶Ù Ø§Ù„Ù…Ø³Ø§Ø± # ØªØ¶Ù…ÙŠÙ† &lt;librsvg-2.0 / librsvg / rsvg.h&gt;.  (ÙŠØ¬Ø¨ ØªØ«Ø¨ÙŠØª Ø­Ø²Ù… librsvg Ùˆ librsvg-dev). <br><br>  ÙŠØªÙ… Ø£Ø®Ø° Ø£Ø³Ù…Ø§Ø¡ ÙˆØ¸Ø§Ø¦Ù Ø±Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ù† Ù…Ù„Ù .glade ØŒ ØªÙƒÙˆÙ† Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø°Ù„Ùƒ <br>  gtk_builder_connect_signals (data.builderØŒ NULL)Ø› <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">gboolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawingarea1_draw_cb</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GtkWidget *widget, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">cairo_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *cr, gpointer user_data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!data.svg_handle_svg) {data.svg_handle_svg=rsvg_handle_new_from_file(<span class="hljs-string"><span class="hljs-string">"compassmarkings.svg"</span></span>,<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>);} gboolean result=rsvg_handle_render_cairo(data.svg_handle_svg,cr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result&amp;&amp;cr) {cairo_stroke(cr);} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">" \n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; }</code> </pre><br>  ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ø§Ù„Ø§Øª (Ù…Ø«Ù„ HMI) ØŒ Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… SVG.  ÙŠÙ…ÙƒÙ† <br>  Ù‚Ù… Ø¨ØªØºÙŠÙŠØ± Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø§Ø±ØªÙØ§Ø¹ ÙÙŠ Ù…Ù„Ù SVG.  Ø£Ùˆ Ù†Ù‚Ù„ Ø¥Ù„Ù‰ GtkPixbuf ÙˆÙ‡Ù†Ø§Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„ Ù„Ø¬Ø¹Ù„ Ø§Ù„ØªØ­Ø¬ÙŠÙ….  Ù†Ø¸Ø±Ù‹Ø§ Ù„Ø£Ù† GtkImage Ù„ÙŠØ³ Ù…ÙˆØ±ÙˆØ«Ù‹Ø§ Ù…Ù† GtkBin ØŒ ÙÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ù‡ Ø£Ø­Ø¯Ø§Ø« Ù…Ù† Ù†ÙˆØ¹ ButtonClick (Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ù…Ø¤Ø´Ø±).  Ù‡Ù†Ø§Ùƒ Ø­Ø§ÙˆÙŠØ© ÙØ§Ø±ØºØ© Ù„Ù‡Ø°Ø§ - GtkEventBox.  ÙˆÙŠÙ…ÙƒÙ† ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø±Ø³Ù… Ù†ÙØ³Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ GtkImage. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">gboolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image1_draw_cb</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GtkWidget *widget, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">cairo_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *cr, gpointer user_data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!data.svg_handle_image) { data.svg_handle_image=rsvg_handle_new_from_file(<span class="hljs-string"><span class="hljs-string">"compassmarkings.svg"</span></span>,<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); data.surf=cairo_image_surface_create_from_png(<span class="hljs-string"><span class="hljs-string">"2.png"</span></span>); data.pixbuf=rsvg_handle_get_pixbuf(data.svg_handle_image); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(data.pixbuf) { cairo_set_source_surface(cr,data.surf,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); GdkPixbuf *dest=gdk_pixbuf_scale_simple (data.pixbuf,<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>,GDK_INTERP_BILINEAR); gtk_image_set_from_pixbuf (data.image,dest); g_object_unref(dest); cairo_paint(cr); } }</code> </pre><br>  ØªÙ‚ÙˆÙ… Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø¨ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© (2.png) ØŒ ÙˆØ§Ù„ØªÙŠ ØªÙ…Ø«Ù„ ÙÙŠ Ø£ØºÙ„Ø¨ Ø§Ù„Ø£Ø­ÙŠØ§Ù† <br>  Ø±Ø³Ù… 1 Ã— 1 Ø¨ÙƒØ³Ù„ Ø´ÙØ§Ù.  Ø«Ù… ÙŠØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø±Ø³Ù… (pixbuf) Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø­ Ø«Ù… ÙŠØªÙ… Ø§Ù„ØªÙƒØ¨ÙŠØ± ÙˆØ§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© (ØµÙˆØ±Ø©). <br><br>  ÙˆÙŠØ¬Ø¨ Ø£Ù„Ø§ Ù†Ù†Ø³Ù‰ Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">application_shutdown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GtkApplication *application, gpointer user_data)</span></span></span><span class="hljs-function"> </span></span>{ cairo_surface_destroy(data.surf); g_object_unref(data.svg_handle_image); g_object_unref(data.svg_handle_svg); g_object_unref(data.pixbuf); g_object_unref(data.builder); }</code> </pre><br>  ÙˆØ§Ù„Ù†ØªÙŠØ¬Ø© Ù‡ÙŠ: <br><br><img src="https://habrastorage.org/webt/hw/bn/yi/hwbnyikg3opargq5pg5pbzqnweg.png"><br>  Ø¥Ø°Ø§ ØªÙ… ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ… Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø§Ø±ØªÙØ§Ø¹ ÙÙŠ Ù…Ø¹Ù„Ù…Ø§Øª SVG ØŒ ÙÙ‚Ø¯ ØªØªØ­ÙˆÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Ø¶Ø¨Ø§Ø¨ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ png. <br><br>  ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ù‹Ø§ ØªØºÙŠÙŠØ± Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø¨Ø±Ù…Ø¬ÙŠÙ‹Ø§.  Ù„Ù‡Ø°Ø§ ØŒ Ù‚Ù…Øª Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª Ù…Ù†ÙØµÙ„Ø© <br>  svg_to_pixbuf_class.c Ùˆ svg_to_pixbuf_class.h.  Ø¨Ù…Ø¹Ù†Ù‰ ØŒ ÙŠØªÙ… ÙØªØ­ Ø§Ù„Ù…Ù„Ù ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙˆØ§Ù„Ø·ÙˆÙ„. <br><br>  ÙŠØªÙ… Ø­ÙØ¸Ù‡ ÙÙŠ / dev / shm /.  Ø¨Ø¹Ø¯ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ù„Ù‰ svg_handle ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù Ù†ÙØ³Ù‡ ÙˆÙ…Ø³Ø§Ø± Ø§Ù„Ø³Ø·Ø± Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù„Ù.  ÙƒÙ…Ø§ ÙŠØªÙ… Ø¯Ø¹Ù… Ù‚ÙŠÙ… Ø§Ù„Ø¹Ø±Ø¶ / Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ÙƒØ³Ø±ÙŠ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">svg_to_pixbuf_class.c</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;string.h&gt; #include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;gtk/gtk.h&gt; #include &lt;sys/types.h&gt; #include &lt;sys/stat.h&gt; #include &lt;fcntl.h&gt; #include &lt;math.h&gt; #include &lt;stdbool.h&gt; int char_to_digit(char num) { switch(num) { case '0': return 0; case '1': return 1; case '2': return 2; case '3': return 3; case '4': return 4; case '5': return 5; case '6': return 6; case '7': return 7; case '8': return 8; case '9': return 9; case '.': return -1; default: return -2; } } //     text double read_num_in_text(char* text) { double result=0; int i=0; bool fractional_flag=FALSE; char whole_part[16]={0}; char whole_digits=0; char fractional_part[16]={0}; char fractional_digits=0; while(char_to_digit(text[i])!=-2) { if(char_to_digit(text[i])!=-1&amp;&amp;!fractional_flag) { whole_part[whole_digits]=char_to_digit(text[i]); printf("text_num=%d|%c\n",char_to_digit(text[i]),text[i]); ++whole_digits; ++i; } else { if(char_to_digit(text[i])==-1) { printf("fractional flag is true\n"); fractional_flag=TRUE; ++i; } else { fractional_part[fractional_digits]=char_to_digit(text[i]); ++fractional_digits; printf("frac_digit=%d|%c\n",char_to_digit(text[i]),text[i]); ++i; } } } ///    i=whole_digits; result=whole_part[whole_digits]; while(i&gt;0) { --i; printf("whole=%d\n",whole_part[i]); result=result+pow(10,whole_digits-i-1)*whole_part[i]; } i=0; while(i&lt;=fractional_digits) { result=result+pow(0.1,i+1)*fractional_part[i]; ++i; } printf("result_read_num=%lf\n",result); return result; } //  ,    // int count_of_digits_for_delete(char* text) { int i=0; bool fractional_flag=FALSE; char whole_part[16]={0}; int whole_digits=0; char fractional_part[16]={0}; int fractional_digits=0; while(char_to_digit(text[i])!=-2) { if(char_to_digit(text[i])!=-1&amp;&amp;!fractional_flag) { whole_part[whole_digits]=char_to_digit(text[i]); printf("text_num=%d|%c\n",char_to_digit(text[i]),text[i]); ++whole_digits; ++i; } else { if(char_to_digit(text[i])==-1) { printf("fractional flag is true\n"); fractional_flag=TRUE; ++i; } else { fractional_part[fractional_digits]=char_to_digit(text[i]); ++fractional_digits; printf("frac_digit=%d|%c\n",char_to_digit(text[i]),text[i]); ++i; } } } if(fractional_flag) return whole_digits+1+fractional_digits; else return whole_digits; } //      /dev/shm //      char* create_dump_file(char *file_with_path) { char *file=NULL; int i=0; while(file_with_path[i]!='\0') {++i;} while(file_with_path[i]!='/'&amp;&amp;i&gt;0) {--i;} file=file_with_path+i; GString *string=g_string_new("test -f /dev/shm"); g_string_append(string,file); g_string_append(string,"|| touch /dev/shm/"); g_string_append(string,file); system(string-&gt;str); ///  -  GString *full_path=g_string_new("/dev/shm"); g_string_append(full_path,file); char *result=g_string_free(full_path,FALSE); return result; } //result must be freed with g_string_free GString* read_file_in_buffer(char *file_with_path) { FILE *input = NULL; struct stat buf; int fh, result; char *body=NULL; // GString *resultat=g_string_new(""); fh=open(file_with_path, O_RDONLY); result=fstat(fh, &amp;buf); if (result !=0) printf("  \n"); else { printf("%s",file_with_path); printf(" : %ld\n", buf.st_size); printf(" : %lu\n", buf.st_dev); printf(" : %s", ctime(&amp;buf.st_atime)); input = fopen(file_with_path, "r"); if (input == NULL) { printf("Error opening file"); } body=(char*)calloc(buf.st_size+64,sizeof(char)); //    //    if(body==NULL) { printf("      body\n"); } int size_count=fread(body,sizeof(char),buf.st_size, input); if(size_count!=buf.st_size) printf("   "); resultat=g_string_append(resultat,body); free(body); } fclose(input); return resultat; } void* write_string_to_file(char* writed_file, char* str_for_write, int lenght) { FILE * ptrFile = fopen (writed_file ,"wb"); size_t writed_byte_count=fwrite(str_for_write,1,lenght,ptrFile); //if(writed_byte_count&gt;4) return TRUE; //else return FALSE; fclose(ptrFile); } //      g_free char* get_resized_svg(char *file_with_path, int width, int height) { char *writed_file=create_dump_file(file_with_path); //       GString *body=read_file_in_buffer(file_with_path); char *start_search=NULL; char *end_search=NULL; char *width_start=NULL; char *width_end=NULL; char *height_start=NULL; char *height_end=NULL; start_search=strstr(body-&gt;str,"&lt;svg"); int j=0; //   if(start_search) { end_search=strstr(start_search,"&gt;"); if(end_search) { ///  width width_start=strstr(start_search,"width"); width_end=width_start+strlen("width"); ///   width    while(width_end[j]==0x0A||width_end[j]==0x20) ++j; if(width_end[j]=='=') ++j; while(width_end[j]==0x0A||width_end[j]==0x20) ++j; if(width_end[j]!='"') printf("   svg.     width=%c\n",width_end[j]); else ++j; ///  ///  ,   gssize size=count_of_digits_for_delete(width_end+j); ///   (1  - 1 ) gssize pos=width_end+j-body-&gt;str; ///       g_string_erase(body,pos,size); char width_new[8]; g_snprintf(width_new,8,"%d",width); g_string_insert(body, pos, width_new); ///  height height_start=strstr(start_search,"height"); height_end=height_start+strlen("height"); ///   height    j=0; while(height_end[j]==0x0A||height_end[j]==0x20) ++j; if(height_end[j]=='=') ++j; while(height_end[j]==0x0A||height_end[j]==0x20) ++j; if(height_end[j]!='"') printf("   svg. \    height=%c%c%c\n",height_end[j-1],height_end[j],height_end[j+1]); else ++j; ///  ///  ,   size=count_of_digits_for_delete(height_end+j); ///   (1  - 1 ) pos=height_end+j-body-&gt;str; ///       g_string_erase(body,pos,size); char height_new[8]; g_snprintf(height_new,8,"%d",height); g_string_insert(body, pos, height_new); ///      dev/shm/ ///   write_string_to_file(writed_file,body-&gt;str,strlen(body-&gt;str)); return writed_file; //g_free(writed_file); g_string_free(body,TRUE); } else printf(" :      svg"); } } void resized_svg_free(char *path) { if (remove (path)==-1 ) { printf("    %s\n",path); } }</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">svg_to_pixbuf_class.h</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> SVG_TO_PIXBUF_CLASS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SVG_TO_PIXBUF_CLASS_H void resized_svg_free(char *path); char* get_resized_svg(char *file_with_path, int width, int height); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//result must be freed with g_free() #endif</span></span></span></span></code> </pre><br></div></div><br>  Ø§Ù„Ø¢Ù† ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠØ³Ø± (ÙˆÙ‡Ùˆ GtkDrawingArea) <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">gboolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawingarea1_draw_cb</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GtkWidget *widget, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">cairo_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *cr, gpointer user_data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!data.svg_handle_svg) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* path=get_resized_svg(<span class="hljs-string"><span class="hljs-string">"/home/alex/svg_habr/compassmarkings.svg"</span></span>, <span class="hljs-number"><span class="hljs-number">220</span></span>, <span class="hljs-number"><span class="hljs-number">220</span></span>); data.svg_handle_svg=rsvg_handle_new_from_file(path,<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); resized_svg_free(path); g_free(path); } gboolean result=rsvg_handle_render_cairo(data.svg_handle_svg,cr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result&amp;&amp;cr) {cairo_stroke(cr);} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">" \n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; }</code> </pre><br>  ÙƒÙ…Ø§ ØªØ±ÙˆÙ† ØŒ Ù‡Ù†Ø§Ùƒ Ù…ÙŠØ²Ø© ØºÙŠØ± Ø³Ø§Ø±Ø© - Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„.  Ø¨Ù…Ø¹Ù†Ù‰ ØŒ Ø§Ù„Ø£Ù…Ø± ÙŠØ³ØªØ­Ù‚ Ù†Ù‚Ù„ Ø§Ù„Ù…Ø¬Ù„Ø¯ ØŒ Ø­ÙŠØ« ÙŠØªÙˆÙ‚Ù Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙŠØ³Ø± (Ø§Ù„Ø°ÙŠ GtkDrawingArea) Ø¹Ù† Ø¹Ø±Ø¶Ù‡.  ÙŠÙ†Ø·Ø¨Ù‚ Ø§Ù„Ø´ÙŠØ¡ Ù†ÙØ³Ù‡ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„ØªÙŠ Ù„Ù… ÙŠØªÙ… ØªØ¶Ù…ÙŠÙ†Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ†ÙÙŠØ°.  Ù„Ù„Ù‚ÙŠØ§Ù… Ø¨Ø°Ù„Ùƒ ØŒ ÙƒØªØ¨Øª ÙˆØ¸ÙŠÙØ© ØªØ­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ù„Ù Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ†ÙÙŠØ° ØŒ Ø¨ØºØ¶ Ø§Ù„Ù†Ø¸Ø± Ø¹Ù† ÙƒÙŠÙÙŠØ© ØªØ´ØºÙŠÙ„Ù‡. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   data.path void get_real_path(char *argv0) { char* result=(char*)calloc(1024,sizeof(char)); char* cwd=(char*)calloc(1024,sizeof(char)); getcwd(cwd, 1024); int i=0; while(argv0[i]!='\0'&amp;&amp;i&lt;1024) ++i; while(argv0[i]!='/'&amp;&amp;i&gt;0) --i; result[i]='\0'; while(i&gt;0) { --i; result[i]=argv0[i]; } /*alex@alex-System-Product-Name:~/project_manager$ ./manager.elf argv[0]=./manager.elf path=/home/alex/project_manager*/ if(strlen(result)&lt;=strlen(cwd)) //   { free(result); strcpy(data.path,cwd); strcat(data.path,"/"); //printf("path_cwd=%s\n",cwd); free(cwd);} else { /*alex@alex-System-Product-Name:/home$ '/home/alex/project_manager/manager.elf' argv[0]=/home/alex/project_manager/manager.elf path=/home*/ free(cwd); strcpy(data.path,result); strcat(data.path,"/"); //printf("path_result=%s\n",result); free(result); } }</span></span></code> </pre><br>  ÙŠÙˆØ¬Ø¯ Ù…Ø«Ø§Ù„Ø§Ù† ÙÙŠ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙƒÙŠÙÙŠØ© ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù„Ù manager.elf.  ØªØ­ØªØ§Ø¬ Ø£ÙŠØ¶Ù‹Ø§ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ main () ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙˆØ¸ÙŠÙØ© <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> cwd[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; getcwd(cwd, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(cwd)); get_real_path(argv[<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre><br>  Ø³ÙˆÙ ØªØ£Ø®Ø° ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ§Ù„ÙŠ <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">gboolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawingarea1_draw_cb</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GtkWidget *widget, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">cairo_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *cr, gpointer user_data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!data.svg_handle_svg) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> image_path[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">strcat</span></span>(image_path,data.path); <span class="hljs-built_in"><span class="hljs-built_in">strcat</span></span>(image_path,<span class="hljs-string"><span class="hljs-string">"compassmarkings.svg"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"image_path=%s\n"</span></span>,image_path); <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* path=get_resized_svg(image_path, <span class="hljs-number"><span class="hljs-number">220</span></span>, <span class="hljs-number"><span class="hljs-number">220</span></span>); data.svg_handle_svg=rsvg_handle_new_from_file(path,<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); resized_svg_free(path); g_free(path); } gboolean result=rsvg_handle_render_cairo(data.svg_handle_svg,cr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result&amp;&amp;cr) {cairo_stroke(cr);} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">" \n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; }</code> </pre><br>  <b>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹.</b> <br><br>  Ù„Ø¯ÙŠÙ†Ø§ 2 ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ¹Ø§Ø¯Ù„ (GtkDrawingArea Ùˆ GtkImage). <br><br>  Ø³Ù†Ø¶Ø¹ ÙƒÙ„ Ù…Ù†Ù‡Ù… ÙÙŠ ØªØµÙ…ÙŠÙ… Ù…Ù† Ù†ÙˆØ¹ (Ø¯ÙˆÙ† Ø£Ù† Ù†Ù†Ø³Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ &lt;time.h&gt;) <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">clock_t</span></span> tic = clock(); <span class="hljs-keyword"><span class="hljs-keyword">clock_t</span></span> toc = clock(); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"image1_draw_cb elapsed : %f seconds\n"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)(toc - tic) / CLOCKS_PER_SEC);</code> </pre><br>  ÙˆÙÙŠ ØªØ·Ø¨ÙŠÙ‚ htop ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªØ±Ù‰ ÙƒÙŠÙ ÙŠØ³ØªÙˆØ¹Ø¨ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ 20-30 Ùª Ù…Ù† ÙƒÙ„ Ù†ÙˆØ§Ø© Athlon 2 X3 2.5 GHz. <br><br>  ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø·Ø£ Ø¨Ø³Ø±Ø¹Ø©. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">gboolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image1_draw_cb</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GtkWidget *widget, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">cairo_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *cr, gpointer user_data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">clock_t</span></span> tic = clock(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!data.svg_handle_image) { data.svg_handle_image=rsvg_handle_new_from_file(<span class="hljs-string"><span class="hljs-string">"compassmarkings.svg"</span></span>,<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); data.surf=cairo_image_surface_create_from_png(<span class="hljs-string"><span class="hljs-string">"2.png"</span></span>); data.pixbuf=rsvg_handle_get_pixbuf(data.svg_handle_image); <span class="hljs-comment"><span class="hljs-comment">//} //if(data.pixbuf) // { cairo_set_source_surface(cr,data.surf,0,0); GdkPixbuf *dest=gdk_pixbuf_scale_simple (data.pixbuf,250,250,GDK_INTERP_BILINEAR); gtk_image_set_from_pixbuf (data.image,dest); g_object_unref(dest); //cairo_paint(cr); } clock_t toc = clock(); printf("image1_draw_cb elapsed : %f seconds\n", (double)(toc - tic) / CLOCKS_PER_SEC); return FALSE; }</span></span></code> </pre><br>  ÙƒÙ…Ø§ Ø§ØªØ¶Ø­ ÙÙŠÙ…Ø§ Ø¨Ø¹Ø¯ ØŒ ÙØ¥Ù† GtkImage Ù„Ø¯ÙŠÙ‡ Ù†Ø¸Ø§Ù… Ø¹Ø±Ø¶ Ø®Ø§Øµ Ø¨Ù‡ ØŒ ÙˆÙŠÙ…ÙƒÙ† ØªÙ‡ÙŠØ¦Ø© Ù…Ø­ØªÙˆÙŠØ§Øª image1_draw_cb Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·.  ÙˆÙƒØ§Ù†Øª Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© Ø²Ø§Ø¦Ø¯Ø© Ø¹Ù† Ø§Ù„Ø­Ø§Ø¬Ø©. <br><br><img src="https://habrastorage.org/webt/2s/2p/4i/2s2p4ibxxewesxsfsupstrcwzju.png"><br><br>  ÙƒÙ…Ø§ ØªØ±ÙˆÙ† ØŒ ØªØ³ØªØºØ±Ù‚ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© ÙˆÙ‚ØªÙ‹Ø§ Ø£Ø·ÙˆÙ„ Ù…Ø¹ GtkImage Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ù€ GtkDrawingArea ØŒ ÙˆÙ„ÙƒÙ† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ù†Ø¸Ø±ÙŠÙ‹Ø§ Ø£Ø³Ø±Ø¹.  Ù‡Ù†Ø§Ùƒ 4 Ù…Ù„Ø§ÙŠÙŠÙ† Ø¯ÙˆØ±Ø© Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ù„ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ù„ØµÙˆØ±Ø© ØªØ¨Ù„Øº 220 Ø¨ÙƒØ³Ù„ * 220 Ø¨ÙƒØ³Ù„ Ø£ÙƒØ¨Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ ØŒ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª Ø¥Ù„Ø§ Ù…Ù† Ø®Ù„Ø§Ù„ pixbuf (Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ØŒ Ù„Ø§ Ø£Ø¹Ø±Ù Ø·Ø±Ù‚Ù‹Ø§ Ø£Ø®Ø±Ù‰). <br><br>  Ø´ÙƒØ±Ø§ Ù„Ø§Ù‡ØªÙ…Ø§Ù…ÙƒÙ… </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar435564/">https://habr.com/ru/post/ar435564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar435552/index.html">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ø¯ÙŠÙ„ - ÙƒÙ„Ù…Ø© Ù…Ù† Ø§Ù„ØªØ±Ù‚ÙŠÙ…</a></li>
<li><a href="../ar435556/index.html">Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ù…Ø±ÙƒØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ÙƒÙŠÙ ÙƒØ§Ù†</a></li>
<li><a href="../ar435558/index.html">Ø§Ø®ØªØ¨Ø§Ø± PostgreSQL Ù…Ø¹ HugePages Ø¹Ù„Ù‰ Ù„ÙŠÙ†ÙƒØ³</a></li>
<li><a href="../ar435560/index.html">Ø£ÙˆÙ„ ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø§Ù„ÙƒÙ… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ - Ø¢ÙŠ Ø¨ÙŠ Ø¥Ù…</a></li>
<li><a href="../ar435562/index.html">Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ø¯Ø®Ù†: ÙƒÙŠÙ ØªØ¯Ø®Ù„ Ù…Ù‡Ù†Ø© Ù…Ø¨Ø±Ù…Ø¬ ØŒ Ø¥Ø°Ø§ ÙƒÙ†Øª Ø¥Ù†Ø³Ø§Ù†ÙŠÙ‹Ø§</a></li>
<li><a href="../ar435568/index.html">VyOS Ø±Ø§ÙˆØªØ± Ù…ÙØªÙˆØ­ Ø§Ù„Ù…ØµØ¯Ø±</a></li>
<li><a href="../ar435572/index.html">Anycubic i3 Mega: Ø·Ø¨Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø¬ÙˆØ¯Ø© Prusa i3</a></li>
<li><a href="../ar435574/index.html">ÙƒÙŠÙ ÙŠØ¹Ù…Ù„ Ù…Ù†Ø¹Ø±Ø¬ØŸ</a></li>
<li><a href="../ar435576/index.html">1C ØŒ Ù„Ø§ Ø£Ù„Ù…</a></li>
<li><a href="../ar435578/index.html">Ø§Ù„Ø³ÙŠØ± ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡ Ù„Ø¹ÙŠØ¯ Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>