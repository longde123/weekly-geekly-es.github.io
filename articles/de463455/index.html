<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ≥Ô∏è üî∞ üö£üèΩ Tausende Dinge, die in Java ab Version 1 behoben werden m√ºssen: ein gro√üartiges Interview mit Sergey Kuksenko von Oracle üë®üèº‚Äçüéì ü§∂üèø üí∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sergey Kuksenko ist ein Performance-Ingenieur, der Java bereits in Version 1.0 gesehen hat. W√§hrend dieser Zeit gelang es ihm, an der Entwicklung von ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tausende Dinge, die in Java ab Version 1 behoben werden m√ºssen: ein gro√üartiges Interview mit Sergey Kuksenko von Oracle</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/463455/"><p><img src="https://habrastorage.org/webt/df/kc/6_/dfkc6_bq7r5jfxx7vr1awxr-mf8.jpeg"></p><br><p>  Sergey Kuksenko ist ein Performance-Ingenieur, der Java bereits in Version 1.0 gesehen hat.  W√§hrend dieser Zeit gelang es ihm, an der Entwicklung von Mobil-, Client-, Serveranwendungen und virtuellen Maschinen teilzunehmen.  Seit 2005 besch√§ftigt sich Java mit Leistung und arbeitet derzeit bei Oracle an der Verbesserung der JDK-Leistung.  Einer der beliebtesten Redner bei Joker und JPoint. </p><br><p>  Dieser Habrapost ist ein gro√üartiges Interview mit Sergey, das folgenden Themen gewidmet ist: </p><br><ul><li>  Leistungskult; </li><li>  Wann und was muss optimiert werden, das anf√§ngliche Design der Sprache und Bibliothek; </li><li>  Vielversprechende Bereiche f√ºr die weitere Optimierung; </li><li>  Wie man an der Entwicklung teilnimmt und was durch Optimierungen gebrochen werden kann; </li><li>  Compiler-Tricks, Registerplatzierung; </li><li>  Ist es m√∂glich, eine Katze aus Hackfleisch zusammenzusetzen? </li><li>  Wenn Tests an f√ºnf aufeinander folgenden Tagen und anderen Haushaltsroutinen durchgef√ºhrt werden; </li><li>  Wie man ein Performance Engineer wird; </li><li>  Vorbereiten eines Berichts f√ºr den n√§chsten Joker. <a name="habracut"></a></li></ul><br><h2 id="o-kulte-proizvoditelnosti">  √úber den Produktivit√§tskult </h2><br><p>  <strong>Oleg:</strong> Sie sind unser alter Sprecher, und dies ist nicht unser erstes Interview.  Sag mir ein wenig, wer bist du jetzt, was machst du? </p><br><p>  <strong>Sergey:</strong> Ich bin genauso wie vor vielen Jahren und mache das Gleiche.  Ich arbeite im Java Performance-Team und bin verantwortlich f√ºr die Leistung von Oracle Java-Maschinen, OpenJDK. </p><br><p>  <strong>Oleg:</strong> Dann habe ich eine etwas trollige Frage: Hier sind Sie ein Performance-Ingenieur, und Ihre Berichte beziehen sich auf alle Arten von Performance.  Denken Sie nicht, dass das Leistungsproblem etwas √ºberbewertet ist?  Jeder eilt mit ihr, aber ist das √ºberhaupt notwendig? </p><br><p>  <strong>Sergey:</strong> Das ist eine gute Frage.  Es h√§ngt alles vom anderen ab.  Diese Art der Aufmerksamkeit des Publikums kann als √ºberm√§√üig angesehen werden.  Unternehmensproduktivit√§t ist dagegen Geld. </p><br><p>  Dies ist das echte Geld, das die Leute f√ºr Hardware ausgeben, f√ºr eine Art Cloud in Amazon.  Wenn Sie Ihre Anfragen nicht schnell genug bearbeiten, verlieren Sie Kunden, verlieren Geld, verlieren alles andere.  Daher ist die Leistungsanforderung nat√ºrlich immer da.  Die Frage ist, wie wichtig es jeweils ist.  Ich schweige √ºber den Hochfrequenzhandel. </p><br><p>  <strong>Oleg:</strong> Denkst du √ºbrigens, Java ist daf√ºr geeignet? </p><br><p>  <strong>Sergey:</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hattest</a> du die Gelegenheit, eine Person wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Peter Lawrey</a> zu treffen? </p><br><p>  <strong>Oleg:</strong> Wer ist der CEO von Chronicle Software, den Entwicklern von OpenHFT? </p><br><p>  <strong>Sergey:</strong> Dies ist ein sehr ber√ºhmter Freund aus London, der viel auf Konferenzen unterwegs ist.  Sie arbeiten in Java im Hochfrequenzhandel, sie leben gro√üartig. </p><br><p>  <strong>Oleg:</strong> Tun sie das auf Java oder hei√üt es nativer Code von Java?  Trotzdem gibt es einen Unterschied. </p><br><p>  <strong>Sergey:</strong> Ich wei√ü es auf dieser Ebene nicht, er hat es nicht gesagt.  Grunds√§tzlich kann auf Wunsch alles, was ben√∂tigt wird, in Java selbst erreicht werden. </p><br><p>  <strong>Oleg:</strong> Interessant.  Wenn Sie zum Beispiel eine Gemeinschaft von Pythonisten nehmen, dann haben sie einen viel weniger Produktivit√§tskult.  Wie kommt es, dass genau das in unserer Gemeinde passiert?  Vielleicht haben <em>Sie</em> mit Ihren Berichten den Leistungskult provoziert?  Sie, Shipilev, Pangin, Ivanov und so weiter. </p><br><p> <strong>Sergey:</strong> Ich wei√ü nicht, wie es passiert ist.  Der Produktivit√§tskult auf der russischen Konferenz ist viel h√∂her als auf der amerikanischen.  Vielleicht spiegelt dies das Publikum selbst wider.  Bei uns wollen sich die Menschen mehr f√ºr die Produktivit√§t engagieren, das ist f√ºr sie interessant.  Und in Amerika wollen sie mehr f√ºr das tun, was sie mehr bezahlen.  Aber das ist eine Hypothese, eine Vermutung.  Es ist so passiert. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/MvJJgR6nxXQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kogda-i-chto-nuzhno-optimizirovat">  Wann und was muss optimiert werden </h2><br><p>  <strong>Oleg:</strong> Sie sagten, dass es immer noch eine Leistungsanfrage gibt.  Ab wann m√ºssen Sie √ºber Leistung nachdenken?  Wann schl√§gt der Donner ein? </p><br><p>  <strong>Sergey:</strong> Dies ist eine allgemeine abstrakte Frage.  Es ist besser, sich noch einmal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Alexey Shipilevs Keynote</a> von einer der vorherigen Konferenzen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zuzuwenden</a> , auf der er all dies gut genug gemalt hat. </p><br><p>  <strong>Oleg:</strong> Ja, ich erinnere mich an die "Kurve des Namens Sh". </p><br><p>  <strong>Sergey:</strong> Sie m√ºssen sofort Leistung erbringen, aber je nach Level.  Es ist nicht notwendig, sofort Benchmarks zu schreiben.  Es ist zum Beispiel bekannt, dass die banale Einschr√§nkung der API-Architekturstufe zwischen Set as a set und SortedSet uns bereits grundlegende algorithmische Einschr√§nkungen auferlegt. </p><br><p>  Wenn wir ein SortedSet in die API geschoben haben (obwohl niemand dieses sortierte ben√∂tigt) und es dann √ºber unser gesamtes System verteilt ist, muss dieses Ding schmerzhaft und hart herausgezogen werden. </p><br><p>  Die Frage beginnt auf der Ebene des Designs - dies ist eine Frage minimaler Einschr√§nkungen.  Es m√ºssen die kleinstm√∂glichen Einschr√§nkungen verwendet werden, damit Sie sp√§ter damit spielen k√∂nnen.  Als ich zum Beispiel verschiedene Teile von Java verdrehte, kamen mir extrem schlechte Worte in den Sinn.  Ich m√∂chte etwas mit einer der Basisklassen tun, kann aber nichts tun, da die API repariert ist, Sie sie nicht mehr √§ndern k√∂nnen und sie bereits ausgebrochen ist.  Aber um einen Trick und ein √úbertakten zu machen, m√ºssen Sie einige Details verbergen. </p><br><p>  Fallstudie: Ich habe mich in der Klasse java.math.BigDecimal herumgetrieben.  Es gab eine gro√üe Bitte von verschiedenen Seiten, es irgendwie zu zerstreuen.  Es gibt einen guten Sonderfall, wenn unser BigDecimal nicht ‚Äûgro√ü‚Äú ist, sondern nur dezimal, und Sie m√ºssen sie lesen. </p><br><p>  Jetzt wurde nat√ºrlich ein passender Wrapper daf√ºr hergestellt.  Wenn jedoch kein √∂ffentlicher Konstruktor aus BigDecimal herausragt, sondern einige statische Methoden und Fabriken, k√∂nnte man BigDecimal abstrakt machen und zwei verschiedene Implementierungen ausspucken, die nach Bedarf funktionieren.  Dies ist jedoch unm√∂glich, da der Konstruktor hervorsteht.  Aus diesem Grund m√ºssen Sie bereits eine unn√∂tige Laufzeitpr√ºfung durchf√ºhren, die es Ihnen in einigen F√§llen erm√∂glicht, einem schnellen Pfad zu folgen. </p><br><p>  <strong>Oleg:</strong> Folgt daraus, dass es sich bei der Entwicklung einer Standardbibliothek lohnt, die Designer aufzugeben und √ºberall Bauherren zu arbeiten? </p><br><p>  <strong>Sergey:</strong> Es wird sp√§t. </p><br><p>  <strong>Oleg:</strong> Wenn es nicht zu sp√§t w√§re, w√§re es eine gute Idee? </p><br><p>  <strong>Sergey:</strong> Sie w√ºrde mehr Spielraum geben.  Schauen Sie: Wir schreiben neu, und dieses neue steht au√üerhalb des Konstruktors.  Es werden zwei Operationen erhalten: Zuerst erstellen wir ein Objekt, dann rufen wir den Konstruktor auf, der es f√ºllt.  Und manchmal w√§re es sehr n√ºtzlich, die Erstellung des Objekts zu verbergen und das falsche Objekt zu erstellen, das wir drau√üen haben.  Dies ist eine Sprachbeschr√§nkung, das Original aus den fr√ºhen Tagen von Java. </p><br><p>  <strong>Oleg:</strong> Nun, jetzt verwendet jeder DI-Frameworks, mit denen Sie Proxys nach Belieben drehen und hinzuf√ºgen k√∂nnen, wobei diese Einschr√§nkung umgangen wird.  K√∂nnten Sie im urspr√ºnglichen Design der Sprache so etwas wie den eingebauten Abh√§ngigkeitsinjektionscontainer hinzuf√ºgen? </p><br><p>  <strong>Sergey:</strong> Ich habe eine sehr spezifische Meinung √ºber das urspr√ºngliche Design der Sprache.  Wenn Sie sich an die Geschichte von Java 1.0 erinnern, kam es zu einem ziemlich starken Zeitdruck, alles musste schnell erledigt werden. </p><br><p>  Es gibt Tausende von Dingen, die ich pers√∂nlich gerne von der ersten Version an behoben sehen w√ºrde.  Aber ich bef√ºrchte, selbst wenn einer von tausend ausgew√§hlt w√ºrde, eins, zwei, drei, und sie h√§tten zum Zeitpunkt des ersten Java begonnen, w√§re Java nicht herausgekommen.  Dies ist ein Standardbeispiel daf√ºr, dass das Beste der Feind des Guten ist. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/9E6DKrxOLHo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="chto-eschyo-mozhno-optimizirovat-v-java">  Was kann man sonst noch in Java optimieren? </h2><br><p>  <strong>Oleg:</strong> Normale Leute k√∂nnen nur in ihrem Projekt etwas reparieren, und Sie als Performance-Ingenieure bei JDK sind sofort von Hunderttausenden von Projekten betroffen.  Es stellt sich die Frage: Gab es in mehr als 20 Jahren Java-Entwicklung Bereiche im JDK, in denen Eingriffe von Kerningenieuren zu sp√ºrbaren Auswirkungen f√ºhren k√∂nnen?  Und wie auff√§llig ist dieser ‚Äûsp√ºrbare Effekt‚Äú? </p><br><p>  <strong>Sergey:</strong> Erstens funktioniert Java jetzt √ºberhaupt nicht mehr auf der Hardware, die beispielsweise vor 10 Jahren verwendet wurde.  Eisen jetzt und Eisen vor 10 Jahren sind zwei gro√üe Unterschiede, und es ist ratsam, verschiedene Optimierungen vorzunehmen. </p><br><p>  Zweitens ist es nat√ºrlich wunderbar, wenn ein Performance-Ingenieur etwas sitzt und beschleunigt, gro√üe Zahlen erh√§lt, seinen Vorgesetzten Bericht erstattet und nach diesen √úbertaktungen Geld f√ºr einen Bonus ausschl√§gt.  An neuen Projekten wird jedoch sehr viel gearbeitet.  Eine Funktion wurde hinzugef√ºgt, und die Aufgabe des Performance Engineers besteht nicht darin, die Funktion zu √ºbertakten, sondern sicherzustellen, dass in dieser Funktion alles in Ordnung ist.  Oder wenn nicht in Ordnung, dann √ºberlegen Sie sich eine Korrektur. </p><br><p>  <strong>Oleg:</strong> Wie kannst du sicher sein?  Sie √ºberpr√ºfen den Code nicht formal.  Was ist ein "sicherstellen"? </p><br><p>  <strong>Sergey: Um</strong> sicherzustellen, dass unter dem Gesichtspunkt der Leistung alles in Ordnung ist, ist die subjektive Expertenmeinung eines Leistungsingenieurs, der einen Bericht schreibt und sagt, dass ‚Äûin dieser Funktion alles normal ist‚Äú.  Abh√§ngig von der Gr√∂√üe des Features bedeutet dies manchmal ziemlich viel Action, manchmal viele verschiedene Anstrengungen.  Ausgehend von der Tatsache, dass Sie nur dumm sitzen, beobachten m√ºssen, was dort getan wird, diesen Bereich bewerten, Benchmarks fahren, sehen, was am Ausgang passiert, und eine vern√ºnftige fundierte Entscheidung treffen m√ºssen. </p><br><p>  <strong>Oleg:</strong> Und unter dem Gesichtspunkt der Leistung und der neuen Funktionen - bewegt sich Java im Allgemeinen vorw√§rts?  Gibt es da etwas?  Weil sich an unserer Hardware nicht viel ge√§ndert hat, zum Beispiel wenn wir √ºber Intel sprechen. </p><br><p>  <strong>Sergey:</strong> F√ºr welchen Zeitraum hat sich das nicht ge√§ndert? </p><br><p>  <strong>Oleg:</strong> Zum Beispiel die letzten 10 Jahre. </p><br><p>  <strong>Sergey:</strong> Ja, gibt es vor einem Jahrzehnt einen AVX-512 auf Hardware? </p><br><p>  <strong>Oleg:</strong> Nein.  Er ist wahrscheinlich nicht immer in der Moderne pr√§sent? </p><br><p>  <strong>Sergey:</strong> Das tue ich definitiv nicht.  Wir haben es in unserem Labor, aber es ist alles von Compilern besetzt.  Sie schrauben so weit, also habe ich nicht geschaut. </p><br><p>  <strong>Oleg:</strong> Kann die Unterst√ºtzung von AVX-512 als Beispiel f√ºr eine typische Funktion angesehen werden? </p><br><p>  <strong>Sergey:</strong> Wahrscheinlich m√∂glich.  Was genau mache ich? Wir haben viel dar√ºber gearbeitet, dass es moderne Anforderungen f√ºr das Hinzuf√ºgen neuer kryptografischer Algorithmen gibt.  Dies ist eine Sache, auf die sich zehn Jahre alte Kryptografiealgorithmen einfach nicht verlassen k√∂nnen.  Wir brauchen neue Algorithmen, gr√∂√üere Schl√ºssel.  Und die Hinzuf√ºgung neuer kryptografischer Algorithmen erfolgt, w√ºrde ich sagen, st√§ndig. </p><br><p>  <strong>Oleg:</strong> Beschleunigen sie irgendwie die Hardware? </p><br><p>  <strong>Sergey:</strong> Es h√§ngt alles von bestimmten Algorithmen ab.  Es gibt sehr gut beschleunigte Algorithmen.  √úbrigens h√§tte dies vor 10 Jahren auf Intel-Hardware nicht funktioniert, aber ungef√§hr 5-6, wie gute Anweisungen erschienen, bis hin zu AES-Einheiten mit Beschleunigungen.  All dies wurde mit einem minimalen Zeitintervall implementiert. </p><br><p>  <strong>Oleg:</strong> Was ist mit der GPU? K√∂nnen sie auch Matrizen multiplizieren? </p><br><p>  <strong>Sergey:</strong> √úber die GPU - ein separates Gespr√§ch.  Wir haben daf√ºr ein Panama-Projekt, in dem all diese Arbeiten ausgef√ºhrt werden, und eines Tages wird es mit allen Extras die Java-Hauptlinie erreichen. </p><br><p>  <strong>Oleg:</strong> Ich habe ein paar Bekannte, die sich bedingt mit Finanzmathematik besch√§ftigen.  Ab einem bestimmten Zeitpunkt wechseln sie immer zu C ++, um zu rechnen, und behaupten, dass es sehr unpraktisch ist, all diese Optimierungen und Hardware von der verwalteten Plattform aus zu verwenden.  Kann das verbessert werden? </p><br><p>  <strong>Sergey:</strong> Wir haben auch eine gro√üe Anfrage daf√ºr und es gibt eine Reihe interner Anforderungen.  Zum Beispiel, damit etwas im Bereich des maschinellen Lernens besser funktioniert.  Dies ist in der Regel eine banale Matrixmultiplikation, die auf der GPU abgeworfen werden kann.  Die Arbeit daran ist noch nicht abgeschlossen. </p><br><p>  Wir haben zwei gro√üe Dachprojekte: Valhalla und Panama, die Funktionen wie die GPU sammeln sollen.  An der Kreuzung von Valhalla und Panama befindet sich eine Vektor-API, die mit unseren SIMD / SSE / AVX-Anweisungen direkt aus Java-Code zusammenarbeitet, und Valhalla selbst mit Inline-Typen ist ein gro√üer Schritt in diese Richtung. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/M4URPKrbr0A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="chto-mozhno-slomat-optimizaciey-kak-pouchastvovat-v-razrabotke">  Was kann durch Optimierung gebrochen werden, wie kann man an der Entwicklung teilnehmen? </h2><br><p>  <strong>Oleg:</strong> Die Regenschirme, die Sie erw√§hnt haben, sind einander √§hnlich.  Ist es m√∂glich, dass ein Projekt ein anderes beeinflusst, auch in Bezug auf Code und Leistungsprofil?  Haben Sie zum Beispiel etwas umgestaltet, und der ungl√ºckliche Ron Presler, der Tr√§nen einschenkt, repariert abends seine Tests in einer Ecke? </p><br><p>  <strong>Sergey:</strong> Das passiert die ganze Zeit.  Ein konkretes Beispiel ist die Vektor-API.  Damit die Vektor-API gut funktioniert, m√ºssen unsere nativen Vektoren schlie√ülich zu Werttypen oder, wie es jetzt in Java genannt wird, zu Inline-Typen werden.  Sie k√∂nnen eine Problemumgehung im Hotspot vornehmen und sie irgendwie implementieren, aber ich m√∂chte eine allgemeine L√∂sung.  Andererseits besteht das Hauptmerkmal von Inline-Typen darin, sich keine Gedanken √ºber das Layout dieser Daten zu machen, und das Layout dieser Daten ist f√ºr die Vektor-API √§u√üerst wichtig. </p><br><p>  Weil es tats√§chlich direkt dem AVX-512 und all dem entspricht.  Es ist klar, dass Sie einige Kniebeugen und Optimierungen vornehmen m√ºssen, die einerseits den Inline-Typ zu einem normalen Typ machen, aber ein hardwarebasiertes Layout haben.  Nat√ºrlich treten Kreuzungen auf.  Wenn Sie sich die Gruppen von Menschen ansehen, die Panama und Walhalla bewegen, schneiden sie mehr als die H√§lfte. </p><br><p>  <strong>Oleg:</strong> Rein organisatorisch, hier haben Sie ein Projekt, eine Art Leistungsproblem, aber es ist der Knotenpunkt mehrerer Projekte.  Was ist als n√§chstes zu tun?  Wie kann man das l√∂sen?  Es stellt sich heraus, dass dies bereits ein Kompromiss zwischen Projekten und Menschen ist und nicht zwischen einigen abstrakten Aufgaben. </p><br><p>  <strong>Sergey: Hier ist</strong> alles sehr einfach: Wenn dies ein Leistungsproblem mit einer Funktion ist, die gerade entworfen wird, m√ºssen Sie zu den Leuten gehen, die entwerfen, und sagen: ‚ÄûAlso und so, was werden wir tun?  Lass es uns anders machen. ‚Äú  Die Diskussion beginnt und das Problem ist gel√∂st. </p><br><p>  Wenn der Code bereits vorhanden ist, funktioniert er bereits.  Im Idealfall beheben Sie dieses Problem, oder wenn Sie es nicht vollst√§ndig beheben k√∂nnen, platzen Sie den Prototyp heraus. Dann kommen Sie erneut zum Eigent√ºmer des Codes und sagen: "Hier ist der Prototyp, was werden wir tun?"  Au√üerdem l√∂sen wir dieses Problem speziell f√ºr jeden Fall. </p><br><p>  <strong>Oleg:</strong> Wir haben hier interessierte Leute, die nicht an diesem Prozess teilnehmen k√∂nnen, das sind Endbenutzer. </p><br><p>  <strong>Sergey:</strong> Sie k√∂nnen nicht genau genug teilnehmen, um nicht f√ºr ihre Geh√§lter in Oracle bezahlt zu werden.  Wenn Sie kein Gehalt ben√∂tigen, kommen Sie zu OpenJDK und nehmen Sie teil. </p><br><p>  <strong>Oleg:</strong> Wie real ist es?  OpenJDK hat einige verdammte Genies wie Sie, und wo gew√∂hnliche Leute sind und wo Sie sind.  Nehmen wir an, etwas verlangsamt sich f√ºr mich, was soll ich tun und wie? </p><br><p>  <strong>Sergey:</strong> Wenn Sie das Problem nicht kennen, ist dies eine separate Frage, ob jemand nach einer L√∂sung f√ºr Sie sucht. Dies ist eine Frage als Bereich, als Beispiel und so weiter.  Auch wenn Sie das Problem nicht kennen, ist es vielleicht sinnvoll, in OpenJDK zu schreiben und zu fragen.  Wenn dies etwas ist, das jemand sofort in den Kopf klickt, werden die Leute es ergreifen.  Wenn es f√ºr niemanden von Interesse ist, bleibt es unbeantwortet. </p><br><p>  <strong>Oleg:</strong> Angenommen, ich kenne das Problem und wei√ü sogar, was behoben werden muss. </p><br><p>  <strong>Sergey:</strong> Wenn Sie das Problem kennen, kommen Sie zu OpenJDK, unterschreiben alle erforderlichen Zettel, bieten einen Patch an, der √ºberarbeitet und gegossen wird. </p><br><p>  <strong>Oleg:</strong> Ist das so einfach? </p><br><p>  <strong>Sergey:</strong> Nun ja, ein bisschen B√ºrokratie, warte ein bisschen.  Gestern hat Tagir ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Lany</a> ) eine kleine L√∂sung gefunden, die ich aufgegeben habe.  Er will nur zum Ende gebracht werden.  Er fing an, sich selbst daran zu erinnern.  Er sagt: "Verdammt, was ist los, ich habe alles getan, angelegt, niemand √ºberpr√ºft es."  Nun ja, niemand √ºberpr√ºft.  Es ist Juli, die H√§lfte des Java-B√ºros ist im Urlaub.  Sie werden aus dem Urlaub kommen und es tun. </p><br><p>  <strong>Oleg:</strong> Urlaub in den USA sind ungef√§hr die gleichen Daten wie normalerweise in Russland? </p><br><p>  <strong>Sergey:</strong> Nein, das Urlaubssystem in den USA ist v√∂llig anders als in Russland.  Erstens sind sie deutlich kleiner.  Und auch in den USA ist das Feriensystem an Schulen gebunden.  Wenn Sie Kinder im Urlaub haben - dann Ferien.  Sobald die Feiertage beginnen, beginnt sich ganz Amerika zu bewegen.  Und da der Unterricht hier Mitte Juni endet und Mitte August beginnt, ist dieses Urlaubsdelta nicht so gro√ü - nur zwei Monate. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/ulWWSKr0Ce0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kompilyatornye-tryuki-razmeschenie-registrov">  Compiler-Tricks, Platzierung registrieren </h2><br><p>  <strong>Oleg:</strong> Ist es jemals vorgekommen, dass Sie zu Hause etwas optimiert haben und danach Benutzer Code anders schreiben mussten?  Relativ gesehen √§ndert dieses Refactoring die Art und Weise, wie Sie Code schreiben, wenn Sie einen Teilstring ausw√§hlen, der zum Einnehmen eines Bereichs verwendet wird, und jetzt eine vollst√§ndige Kopie erstellen. </p><br><p>  <strong>Sergey:</strong> Sicher war es das, aber ich werde jetzt keine konkreten Beispiele nennen.  Die Frage ist, was die Leute beim Schreiben von Code festlegen.  Wenn sie die maximale Leistung herausholen m√ºssen und daf√ºr alle Arten von compilerspezifischen Tricks ausf√ºhren, sollten sie darauf vorbereitet sein, dass sich der Compiler im Laufe der Zeit weiterentwickelt, und sie m√ºssen ihren Code st√§ndig entsprechend dem aktuellen Status des Compilers √§ndern.  Und das ist gro√üartig. </p><br><p>  Angenommen, nach 20 Jahren wird Graal pl√∂tzlich der Haupt-Compiler f√ºr HotSpot sein - dann m√ºssen diese armen Kerle √ºberhaupt alles neu schreiben.  Dies geschieht nur, wenn Sie eine solche technische Aufgabe √ºbernommen haben - √Ñnderungen im Compiler zu verfolgen.  Es ist viel einfacher, den richtigen Code ohne direkte Bindungen mit mehr oder weniger normalen allgemeinen Implementierungen zu schreiben. </p><br><p>  √úbrigens √ºber Compiler - nicht nur √ºber Java-Compiler, sondern allgemein.  Es gibt Moores Gesetz, das kein Gesetz ist, sondern nur eine empirische Beobachtung, dass sich die Anzahl der Transistoren alle anderthalb Jahre verdoppelt. </p><br><p>  Und es gibt genau das gleiche Gesetz ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Proebsting-Gesetz</a> ), nach dem die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Codeleistung</a> ohne √Ñnderung alle anderthalb bis zwei Jahre um 4 Prozent steigt.  Diese 4 Prozent erhalten Endbenutzer kostenlos, allein durch die Entwicklung der Compiler.  Keine Hardware, n√§mlich Compiler. </p><br><p>  <strong>Oleg:</strong> Ich frage mich, woher diese Prozents√§tze kommen.  Ist das eine Art anf√§ngliche Ineffizienz?  Aber dann wird dieser Bestand an Ineffizienzen eines Tages enden. </p><br><p>  <strong>Sergey:</strong> Nein, es ist nur eine Frage der Technologieentwicklung.  Ich habe Compiler beendet, als ich anfing, an der Leistung zu arbeiten.  Aber als ich verlobt war, wurde die gr√∂√üte Entdeckung f√ºr mich 2005 oder 2006 gemacht.  Ich habe 2008 √ºberhaupt davon erfahren, weil ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Artikel</a> nicht rechtzeitig <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gelesen</a> habe. </p><br><p>  Eine sehr wichtige Aufgabe jeder Codegenerierung ist die Registerzuordnung.  Es ist bekannt, dass dieses Problem im Allgemeinen NP-vollst√§ndig ist.  Es ist sehr schwierig, es zu l√∂sen, und daher versuchen alle Compiler, einen ungef√§hren Algorithmus mit unterschiedlichen Qualit√§tsgraden zu betreiben. </p><br><p>  Und hier kommt ein Artikel, in dem die Jungs beweisen, dass in einigen F√§llen, die eine gro√üe Anzahl von Compilern und eine gro√üe Anzahl von internen Darstellungen mit bestimmten Einschr√§nkungen abdecken, ein exakter Polynomalgorithmus f√ºr die Aufgabe der Zuweisung der Registerzuordnung existiert.  Hurra, lass uns gehen! </p><br><p>  Dies geschah im Jahr 2005, fr√ºher erstellte Compiler wussten dies nicht. </p><br><p>  <strong>Oleg:</strong> Jetzt k√∂nnen Sie einen neuen Allokator f√ºr Java erstellen? </p><br><p>  <strong>Sergey:</strong> Jetzt, wo es eine theoretische L√∂sung gibt, kann sie umgeschrieben werden.  Ich habe nicht auf Details eingegangen, aber ich wei√ü, dass die Jungs von Excelsior den Algorithmus implementiert haben. </p><br><p>  <strong>Oleg:</strong> Wir haben k√ºrzlich ein Interview mit Cliff Click gef√ºhrt und er hat √ºber den wahnsinnig komplexen und wahnsinnigen Genie-Allokator gesprochen, den er f√ºr Java geschrieben hat.  Willst du nicht noch einen schreiben? </p><br><p>  <strong>Sergey:</strong> Nein. </p><br><p>  <strong>Oleg:</strong> Gibt es etwas Normales? </p><br><p>  <strong>Sergey:</strong> Nein, er ist nicht normal.  Aus meiner utilitaristischen Sicht werde ich sagen, dass ich in Assembler schaue und manchmal sehe ich: "Nun ja, hier sind die Register schlecht geworden."  Wenn ich unsere Compiler kicke und wir den Allokator neu schreiben, was bekommen wir dann?  Wir werden einen gewissen Gewinn erzielen, aber es ist unwahrscheinlich, dass ich ihn sehe, au√üer bei den Beispielen, bei denen ich die ineffiziente Zuweisung von Registern gesehen habe.  Solange es in diesem Bereich keine gro√üen Fehler gibt, gibt es immer etwas zu tun und mehr Gewinne zu erzielen. </p><br><p>  <strong>Oleg:</strong> Gibt es im JDK Arbeitsbereiche, in denen der gesamte Motorraum-Compiler oder die Leistungsmagie an die Oberfl√§che bricht?  Sie sagen, dass Sie normalen Code schreiben m√ºssen und alles in Ordnung ist, aber es klingt verd√§chtig. </p><br><p>  <strong>Sergey:</strong> Alles wird gut, bis du einen Super Duper brauchst.  Wenn Sie es wirklich schnell brauchen, schreiben Sie es immer neu.  Im Moment spielt eine abstrakte gro√üe Anwendung im Gro√üen und Ganzen, wie sie geschrieben steht, im Allgemeinen keine Rolle f√ºr die Leistung. </p><br><p>  Einerseits verbraucht der Garbage Collector, sobald er ausgel√∂st wird, seine 10-20%, andererseits beginnt die Anwendungsarchitektur zu erscheinen.  Das gro√üe Problem, das ich im Haufen von Anwendungen gesehen habe, ist, dass sie Daten verschieben.  Wir haben die Daten von hier genommen, dorthin √ºbertragen und dort einige Transformationen vorgenommen.  Im Allgemeinen macht jedes Programm genau das.  Es √ºbertr√§gt Daten auf irgendeine Weise von einem Ort zum anderen.  Wenn Sie jedoch zu viele Schichten im Programm haben, hilft der Compiler nicht weiter. </p><br><p>  <strong>Oleg:</strong> Sie k√∂nnen versuchen, einige einfache Dinge zu verfolgen, wie zum Beispiel: Dieses Erinnerungsst√ºck wechselt den Besitzer und bewegt sich zwischen Objekten in diese Richtung. </p><br><p>  <strong>Sergey:</strong> Nein, das ist ein Designproblem.  Aber ich verschiebe nicht nur, sondern verschiebe mit Modifikationen, ich mache etwas mit ihnen.  Der gr√∂√üte Vorteil bei realen, massiven Anwendungen kann erzielt werden, wenn Sie dar√ºber nachdenken: Ist so viel Verschiebung erforderlich?  Statt zehn ist es schon gut, sieben zu machen. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/kxgo7Y4cdA8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/JRBWBJ6S4aU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <em>(Es k√∂nnte den Anschein haben, dass dasselbe Video hier versehentlich dupliziert wurde. Tats√§chlich ist alles einfacher, Habr hat das falsche Bild von YouTube zwischengespeichert.)</em> </p><br><h2 id="sobiraem-koshku-iz-farsha">  Wir sammeln eine Katze aus Hackfleisch </h2><br><p>  <strong>Oleg:</strong> Wir hatten gerade eine Hydra-Konferenz √ºber verteiltes Rechnen.  Und so viele Menschen besch√§ftigen sich sehr mit Dingen wie einem Kostenmodell, das die Kosten jeder Operation bestimmt <strong>-</strong> sehr detailliert, sehr genau.  Die Leute wollen wirklich alle Anweisungen aufschreiben, die Kosten f√ºr jede von ihnen addieren und sehen, wie viele Balken Ihr Code ben√∂tigt.  Ich frage mich, wie dieser Ansatz in der modernen Realit√§t funktioniert.    ,   ? </p><br><p> <strong>:</strong> ,      .  ,    .         ,   .  ,     .   ,    ,      ,        .           ? </p><br><p> <strong>:</strong> : ¬´    ¬ª. </p><br><p> <strong>:</strong>  , .   ,     .    ,   ?   .   ‚Äî   ,      .   ,   , -   ,    . </p><br><p> <strong>:</strong>       ,      ? </p><br><p> <strong>:</strong>     ,     ?   ,     .         ? </p><br><p> <strong>:</strong> , -  ? </p><br><p> <strong>:</strong>   ,          ‚Äî ,   .   -  .   ?    ,      ,   ,        ,   . ,           . </p><br><p> <strong>:</strong>    . </p><br><p> <strong>:</strong>      ,       1 .   ,      ,   .     , -  ,  -  . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/O8oN4KSZEXE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/i0Jr2l3jrDA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="pyat-dney-na-testy-i-drugie-zadachi-performance-inzhenera">        performance- </h2><br><p> <strong>:</strong>     OpenJDK    .        ? C++    .       ‚Äî   -? </p><br><p> <strong>:</strong> ,  ,  .     .     OpenJDK  15 .      15    . </p><br><p> <strong>:</strong>   ,      ,       .          . </p><br><p> <strong>:</strong>   !       ,    ,   .     ,    ,  , , ,         .  ,       .     :   ,  ,   (  ,     ),      ‚Äî   .      ,   ,      . </p><br><p> <strong>:</strong> ,      ? </p><br><p> <strong>:</strong> , ,       Java. </p><br><p> <strong>:</strong>   ? </p><br><p> <strong>:</strong> , ,    Valhalla. </p><br><p> <strong>:</strong>    -  ,  ,  ‚Äî   ,      ?     ?               . </p><br><p> <strong>:</strong>    ,  .   ‚Äî       .    ,   ,    ,    .  ,  , .      .    2-3 ,      ,      ,       ,  ‚Äî ,   . </p><br><p> , ,   inline-,        Java        Joker.    .  ,    Java-   ,    runtime-.     red flag: runtime-    0.         ?  ,      out of order- ‚Äî . </p><br><p>     ,   . ,   .     ?             .       .  baseline,   ,       5-6 ,          ‚Äî     .  ,    ,  -  2    ‚Äî     -    .   3%   - ,     .  3%  ? </p><br><p> <strong>:</strong>    ,      ? </p><br><p> <strong>:</strong>     ,     .     performance-,     . ,             ,   ‚Äî . </p><br><p>        ,    ,  .   performance- ‚Äî     ,    - performance-  -       ,   .  ,   ,     . </p><br><p> ,    ,   ,   ,   performance- ‚Äî  class libraries    hotspot,     . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/cz93lTJW-do" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="kak-voyti-v-performance">  ¬´¬ª  performance </h2><br><p> <strong>:</strong> , -     performance-,     . ,      ,       ? </p><br><p> <strong>:</strong>    .     ?    ,    performance-         performance-. </p><br><p>  ,      :  ,       ,   Oracle, Twitter, Netflix  ,    -   .          ,              ‚Äî    .  ,     performance-    ,   . </p><br><p>     -  ,   ,    performance-  ,      ?     ,   ,    . </p><br><p>     ,   performance- ‚Äî    .    :          - performance review,        , , ,  ,  .     ‚Äî  performance   . </p><br><p>    : ¬´ ,  ...¬ª,        ,     ‚Äî  . ,  -     ‚Äî ,   ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   </a> ,    . </p><br><h2 id="podgotovka-k-joker">   Joker </h2><br><p> <strong>:</strong>    Joker  .   ? </p><br><p> <strong>:</strong>  inline-,     . </p><br><p> <strong>:</strong>  ,    value-? </p><br><p> <strong>:</strong> ,       ,    .          .   ,    .   value   Java-   .    value,  value,   by value, -  by value,       value type.     ,         . </p><br><p>      .  ,   ,   ,  R√©mi Forax -        ,    inline-. ,   ,      Kotlin inline-   ,     value- Java,    . </p><br><p>      .         value-,     ,  , mvt (minimum value types),     LW 1.     LW 2 ‚Äî  ,         .  , ,        ,    .   ,      ,  , ,  performance-  ,   ,       ,   ,   . </p><br><p> <strong>:</strong>    ,               - -? </p><br><p> <strong>:</strong>  , -     .   , ,   ,   ,   invokedynamic  . </p><br><p> <strong>:</strong>  ,    , ,   ,  . </p><br><p> <strong>:</strong>    ,    ,    ,            .  ‚Äî ,   ,    .   ,     ? </p><br><p> <strong>:</strong>   , ,  ,    . </p><br><p> <strong>:</strong>  .    , ,   inline-       generic-     ,       inline-.        ,        . </p><br><p> <strong>:</strong>     ,  -    ? </p><br><p> <strong>:</strong>    :     inline- LW2   .    value-,     generic,       . </p><br><blockquote>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">¬´   Java -?        Valhalla¬ª</a>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> Joker</a> ,    - 25-26  2019 .  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de463455/">https://habr.com/ru/post/de463455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de463439/index.html">Apollo-Bordsteuerungscomputer: Messstab und technische Analyse des Speichers auf mehreren zusammengef√ºgten Kernen</a></li>
<li><a href="../de463441/index.html">Sampler. Konsolen-Dienstprogramm zur Visualisierung des Ergebnisses von Shell-Befehlen</a></li>
<li><a href="../de463443/index.html">JMeter - Schweizer Pr√ºfmesser (Teil 2)</a></li>
<li><a href="../de463445/index.html">9 Arten von Collaboration-Softwarel√∂sungen zur Verwaltung agiler Teams</a></li>
<li><a href="../de463447/index.html">Astra Linux 1.6 (Smolensk). Ist das System bereit, mit normalen Benutzern zu arbeiten? Kr√ºckenbeispiele</a></li>
<li><a href="../de463459/index.html">Versteckte Fehler bei Shared Element Transitions</a></li>
<li><a href="../de463461/index.html">Was ist und was nicht in Go. Teil 1</a></li>
<li><a href="../de463463/index.html">Methode zum Erstellen eines DRAG- und DROP-Effekts</a></li>
<li><a href="../de463465/index.html">Das Buch ‚ÄûExpressive JavaScript. Moderne Webprogrammierung. 3. Auflage</a></li>
<li><a href="../de463469/index.html">Schr√∂dinger Katze ohne Box: das Problem des Konsenses in verteilten Systemen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>