<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕢 👪 👽 Tipps und Tricks von meinem Telegramm-Kanal @pythonetc, Mai 2019 💜 🙍🏾 🧒🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es ist eine neue Auswahl von Tipps und Tricks zu Python und Programmierung von meinem Telegramm-Kanal @pythonetc. 

 ← Frühere Veröffentlichungen 


 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tipps und Tricks von meinem Telegramm-Kanal @pythonetc, Mai 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/454648/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d63/195/6d5/d631956d535edaa7d72b6a30165e8e58.png"></div><br><br>  Es ist eine neue Auswahl von Tipps und Tricks zu Python und Programmierung von meinem Telegramm-Kanal @pythonetc. <br><br>  ← <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Frühere Veröffentlichungen</a> <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  <code>break</code> Anweisung unterdrückt die Ausnahme, wenn sie in der <code>finally</code> Klausel verwendet wird, auch wenn der <code>except</code> nicht dargestellt wird: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">10</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> / i <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: print(<span class="hljs-string"><span class="hljs-string">'finally'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> print(<span class="hljs-string"><span class="hljs-string">'after try'</span></span>) print(<span class="hljs-string"><span class="hljs-string">'after while'</span></span>)</code> </pre> <br>  Ausgabe: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> after <span class="hljs-keyword"><span class="hljs-keyword">while</span></span></code> </pre> <br>  Das Gleiche gilt für <code>continue</code> , kann jedoch erst in Python 3.8 <code>finally</code> : <br><br><pre> <code class="python hljs">SyntaxError: <span class="hljs-string"><span class="hljs-string">'continue'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> supported inside <span class="hljs-string"><span class="hljs-string">'finally'</span></span> clause</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Sie können Unicode-Zeichen in einem Zeichenfolgenliteral nicht nur anhand ihrer Nummer, sondern auch anhand ihres Namens hinzufügen. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-string"><span class="hljs-string">'\N{EM DASH}'</span></span> <span class="hljs-string"><span class="hljs-string">'—'</span></span> &gt;&gt;&gt; <span class="hljs-string"><span class="hljs-string">'\u2014'</span></span> <span class="hljs-string"><span class="hljs-string">'—'</span></span></code> </pre> <br>  Es ist auch kompatibel mit F-Strings: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>width = <span class="hljs-number"><span class="hljs-number">800</span></span> &gt;&gt;&gt; <span class="hljs-string"><span class="hljs-string">f'Width \N</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{EM DASH}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{width}</span></span></span><span class="hljs-string">'</span></span> <span class="hljs-string"><span class="hljs-string">'Width — 800'</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Es gibt sechs magische Methoden für Python-Objekte, die Vergleichsregeln definieren: <br><br><ul><li>  <code>__lt__</code> für <code>&lt;</code> <br></li><li>  <code>__gt__</code> für <code>&gt;</code> <br></li><li>  <code>__le__</code> für <code>&lt;=</code> <br></li><li>  <code>__ge__</code> für <code>&gt;=</code> <br></li><li>  <code>__eq__</code> für <code>==</code> <br></li><li>  <code>__ne__</code> für <code>!=</code> <br></li></ul><br>  Wenn einige dieser Methoden nicht definiert sind oder <code>NotImplemented</code> , gelten die folgenden Regeln: <br><br><ul><li>  <code>a.__lt__(b)</code> ist dasselbe wie <code>b.__gt__(a)</code> </li><li>  <code>a.__le__(b)</code> ist dasselbe wie <code>b.__ge__(a)</code> </li><li>  <code>a.__eq__(b)</code> ist dasselbe wie <code>not a.__ne__(b)</code> (beachten Sie, dass <code>a</code> und <code>b</code> in diesem Fall nicht getauscht werden) </li></ul><br>  <code>a &gt;= b</code> und <code>a != b</code> implizieren jedoch nicht automatisch <code>a &gt; b</code> .  Der Dekorator <code>functools.total_ordering</code> erstellt alle sechs Methoden basierend auf <code>__eq__</code> und einer der folgenden Methoden: <code>__lt__</code> , <code>__gt__</code> , <code>__le__</code> oder <code>__ge__</code> . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> functools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> total_ordering @total_ordering <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pk, name)</span></span></span><span class="hljs-function">:</span></span> self.pk = pk self.name = name <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__le__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, other)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.pk &lt;= other.pk <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__eq__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, other)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.pk == other.pk <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> User(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'Vadim'</span></span>) &lt; User(<span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-string"><span class="hljs-string">'Catherine'</span></span>)</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ix/fw/hm/ixfwhm2i27b6uy36zmz5qlvjqdc.png"></div><br>  Manchmal möchten Sie sowohl dekorierte als auch nicht dekorierte Versionen einer Funktion verwenden.  Der einfachste Weg, dies zu erreichen, besteht darin, auf die spezielle Decorator-Syntax (die mit <code>@</code> ) zu verzichten und die dekorierte Funktion manuell zu erstellen: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> result = f(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(result, list): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [result] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) load_data = ensure_list(load_data_orig) print(load_data(<span class="hljs-string"><span class="hljs-string">'3'</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># [3] print(load_data_orig('4')) 4</span></span></code> </pre> <br>  Alternativ können Sie einen anderen Dekorateur schreiben, der eine Funktion dekoriert, während die ursprüngliche Version im <code>orig</code> Attribut der neuen beibehalten wird: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saving_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(another_decorator)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> decorated = another_decorator(f) decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> ... @saving_orig(ensure_list) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) print(load_data(<span class="hljs-string"><span class="hljs-string">'3'</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># [3] print(load_data.orig('4')) # 4</span></span></code> </pre> <br>  Wenn alle Dekorateure, mit denen Sie arbeiten, über <code>functools.wraps</code> , können Sie mit dem Attribut <code>__wrapped__</code> auf die nicht dekorierte Funktion zugreifen: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> functools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wraps <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> @wraps(f) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> result = f(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(result, list): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [result] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated @ensure_list <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) print(load_data(<span class="hljs-string"><span class="hljs-string">'3'</span></span>)) <span class="hljs-comment"><span class="hljs-comment"># [3] print(load_data.__wrapped__('4')) # 4</span></span></code> </pre> <br>  Beachten Sie jedoch, dass dies nicht für Funktionen funktioniert, die von mehr als einem Dekorateur dekoriert wurden: Sie müssen für jeden angewendeten Dekorateur auf <code>__wrapped__</code> zugreifen: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_ints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> @wraps(f) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> result = f(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [int(x) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated @ensure_ints @ensure_list <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( load_data, load_data.__wrapped__, load_data.__wrapped__.__wrapped__, ): print(repr(f(<span class="hljs-string"><span class="hljs-string">'"4"'</span></span>)))</code> </pre> <br>  Ausgabe: <br><br><pre> <code class="python hljs">[<span class="hljs-number"><span class="hljs-number">4</span></span>] [<span class="hljs-string"><span class="hljs-string">'4'</span></span>] <span class="hljs-string"><span class="hljs-string">'4'</span></span></code> </pre> <br>  Das <code>@saving_orig</code> erwähnte <code>@saving_orig</code> akzeptiert einen anderen Dekorateur als Argument.  Was ist, wenn dieser Dekorateur parametrisiert werden kann?  Nun, da der parametrisierte Dekorator eine Funktion ist, die einen tatsächlichen Dekorator zurückgibt, wird dieser Fall automatisch behandelt: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> functools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wraps <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saving_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(another_decorator)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> decorated = another_decorator(f) decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_ints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*, default=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> @wraps(f) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> result = f(*args, **kwargs) ints = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: x_int = int(x) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> default <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: x_int = default ints.append(x_int) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ints <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator @saving_orig(ensure_ints(default=<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) print(repr(load_data(<span class="hljs-string"><span class="hljs-string">'["2", "3", "A"]'</span></span>))) print(repr(load_data.orig(<span class="hljs-string"><span class="hljs-string">'["2", "3", "A"]'</span></span>)))</code> </pre> <br>  Der <code>@saving_orig</code> Dekorator macht nicht wirklich das, was wir wollen, wenn mehr als ein Dekorator auf eine Funktion angewendet wird.  Wir müssen <code>orig</code> für jeden solchen Dekorateur anrufen: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> functools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wraps <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saving_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(another_decorator)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> decorated = another_decorator(f) decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_list</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ensure_ints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*, default=None)</span></span></span><span class="hljs-function">:</span></span> ... @saving_orig(ensure_ints(default=<span class="hljs-number"><span class="hljs-number">42</span></span>)) @saving_orig(ensure_list) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( load_data, load_data.orig, load_data.orig.orig, ): print(repr(f(<span class="hljs-string"><span class="hljs-string">'"X"'</span></span>)))</code> </pre> <br>  Ausgabe: <br><br><pre> <code class="python hljs">[<span class="hljs-number"><span class="hljs-number">42</span></span>] [<span class="hljs-string"><span class="hljs-string">'X'</span></span>] <span class="hljs-string"><span class="hljs-string">'X'</span></span></code> </pre> <br>  Wir können das <code>saving_orig</code> beheben, indem wir eine beliebige Anzahl von Dekoratoren als <code>saving_orig</code> Argumente unterstützen: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saving_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*decorators)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> decorated = f <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> d <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> reversed(decorators): decorated = d(decorated) decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator ... @saving_orig( ensure_ints(default=<span class="hljs-number"><span class="hljs-number">42</span></span>), ensure_list, ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ( load_data, load_data.orig, ): print(repr(f(<span class="hljs-string"><span class="hljs-string">'"X"'</span></span>)))</code> </pre> <br>  Ausgabe: <br><br><pre> <code class="python hljs">[<span class="hljs-number"><span class="hljs-number">42</span></span>] <span class="hljs-string"><span class="hljs-string">'X'</span></span></code> </pre> <br>  Eine andere Lösung besteht darin, <code>saving_orig</code> intelligent zu machen, dass <code>orig</code> von einer dekorierten Funktion an eine andere übergeben wird: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saving_orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(another_decorator)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> decorated = another_decorator(f) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hasattr(f, <span class="hljs-string"><span class="hljs-string">'orig'</span></span>): decorated.orig = f.orig <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorator @saving_orig(ensure_ints(default=<span class="hljs-number"><span class="hljs-number">42</span></span>)) @saving_orig(ensure_list) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json.loads(string)</code> </pre> <br>  Wenn ein Dekorator, den Sie schreiben, zu kompliziert wird, kann es sinnvoll sein, ihn mit der Methode <code>__call__</code> von einer Funktion in eine Klasse <code>__call__</code> <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SavingOrig</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, another_decorator)</span></span></span><span class="hljs-function">:</span></span> self._another = another_decorator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, f)</span></span></span><span class="hljs-function">:</span></span> decorated = self._another(f) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> hasattr(f, <span class="hljs-string"><span class="hljs-string">'orig'</span></span>): decorated.orig = f.orig <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: decorated.orig = f <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> decorated saving_orig = SavingOrig</code> </pre> <br>  In der letzten Zeile können Sie sowohl die Klasse mit dem Kamelkoffer benennen als auch den Namen des Dekorateurs im Schlangenkoffer aufbewahren. <br><br>  Anstatt die dekorierte Funktion zu ändern, können Sie eine andere aufrufbare Klasse erstellen, um ihre Instanzen anstelle einer Funktion zurückzugeben: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CallableWithOrig</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, to_call, orig)</span></span></span><span class="hljs-function">:</span></span> self._to_call = to_call self._orig = orig <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._to_call(*args, **kwargs) @property <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">orig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(self._orig, type(self)): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._orig.orig <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._orig <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SavingOrig</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, another_decorator)</span></span></span><span class="hljs-function">:</span></span> self._another = another_decorator <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, f)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CallableWithOrig(self._another(f), f) saving_orig = SavingOrig</code> </pre> <br>  Den gesamten Code finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de454648/">https://habr.com/ru/post/de454648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de454634/index.html">Sicherheitswoche 23: Notepad-Sicherheitslücke, eine Million Systeme mit nicht gepatchten RDP</a></li>
<li><a href="../de454640/index.html">Remote-Microservice-Debugging über SSH unter VPN in 4 Runden</a></li>
<li><a href="../de454642/index.html">"Machen Sie eine Anwendung für Menschen" - dies ist nicht auf das Knie zu kritzeln ": über die mobile Entwicklung in der CFT</a></li>
<li><a href="../de454644/index.html">Schulung Cisco 200-125 CCNA v3.0. Tag 8. Setup wechseln</a></li>
<li><a href="../de454646/index.html">@ Pythonetc-Zusammenstellung, Mai 2019</a></li>
<li><a href="../de454652/index.html">Düsentriebwerk auf einem 3D-Heimdrucker</a></li>
<li><a href="../de454658/index.html">Beauty Gadgets - Ernstes Geschäft</a></li>
<li><a href="../de454662/index.html">Sorgfältiger Umzug in die Niederlande mit seiner Frau und Hypothek. Teil 1: Jobsuche</a></li>
<li><a href="../de454664/index.html">Spielen Sie Tetris in AR</a></li>
<li><a href="../de454666/index.html">Software Defined Radio - wie funktioniert es? Teil 7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>