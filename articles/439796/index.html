<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ü üßëüèº‚Äçü§ù‚Äçüßëüèº üïâÔ∏è Spring Boot 2: lo que no escriben en las notas de la versi√≥n üåå üéÖüèæ üï¥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cuando un proyecto a gran escala se somete a una actualizaci√≥n masiva, todo nunca es simple: inevitablemente hay matices obvios (en otras palabras, un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spring Boot 2: lo que no escriben en las notas de la versi√≥n</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/439796/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/a4/e3/fc/a4e3fcwl22r0y3nlx8z-6pkhtny.jpeg"></div><br><br>  Cuando un proyecto a gran escala se somete a una actualizaci√≥n masiva, todo nunca es simple: inevitablemente hay matices obvios (en otras palabras, un rastrillo).  Y luego, no importa cu√°n buena sea la documentaci√≥n, solo la experiencia, la suya o la de otra persona, ayudar√° con algo. <br><br>  En la conferencia Joker 2018, habl√© sobre los problemas que encontr√© cuando cambi√© a Spring Boot 2 y c√≥mo se resuelven.  Y ahora especialmente para Habr: la versi√≥n de texto de este informe.  Para mayor comodidad, la publicaci√≥n tiene tanto una grabaci√≥n de video como una tabla de contenido: no puede leer todo el contenido, pero vaya directamente al problema que le preocupa. <br><a name="habracut"></a><br><h2>  Tabla de contenidos </h2><br><ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Grabaci√≥n de video</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Entrada</a></b> </li><li>  <b>Rastrillar tiempo de compilaci√≥n</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ejemplos de problemas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Como ser</a> </li><li>  <b>Tipo de contenido.</b>  <b>Determinar el tipo de respuesta HTTP</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Como ser</a> </li><li>  <b>Programaci√≥n</b>  <b>Lanzamiento programado</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Como ser</a> </li><li>  <b>Spring Cloud &amp; Co.</b>  <b>Compatibilidad de la biblioteca</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bonus: caso de adiciones</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Como ser</a> </li><li>  <b>Relajante Encuadernaci√≥n.</b>  <b>Enlace de par√°metro difuso</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Como ser</a> </li><li>  <b>Pruebas unitarias.</b>  <b>Ejecuci√≥n de pruebas en Mockito 2</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Como ser</a> </li><li>  <b>Gradle Plugin.</b>  <b>Construye proyectos Spring Boot</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El problema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Como ser</a> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Otros</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Conclusi√≥n</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Resumen y conclusiones</a></b> </li></ul><br><br><a name="video"></a><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="intro"></a>  Buen dia  Quiero contarles algunas caracter√≠sticas (llam√©moslas rastrillos) que pueden surgir al actualizar Spring Boot Framework a la segunda versi√≥n y su posterior operaci√≥n. <br><br>  Mi nombre es Vladimir Plizg√° ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> ), trabajo para CFT, uno de los desarrolladores de software m√°s grandes y antiguos de Rusia.  Durante los √∫ltimos a√±os, he estado desarrollando backend all√≠, responsable del desarrollo t√©cnico del banco en l√≠nea de tarjetas prepagas.  Fue en este proyecto que me convert√≠ en el iniciador y ejecutor de la transici√≥n de una arquitectura monol√≠tica a una arquitectura de microservicios (que todav√≠a est√° en curso).  Bueno, dado que la mayor parte del conocimiento que decid√≠ compartir con usted se ha acumulado en el ejemplo de este proyecto en particular, le contar√© un poco m√°s al respecto. <br><br><h2>  Brevemente sobre el producto experimental. </h2><br>  Este es un banco de Internet que sirve a m√°s de dos docenas de empresas asociadas en Rusia: brinda a los clientes finales la capacidad de administrar su dinero a trav√©s de servicios bancarios remotos (aplicaciones m√≥viles, sitios).  Uno de los socios es Beeline y su tarjeta de pago.  Result√≥ ser una buena banca por Internet, a juzgar por la calificaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Markswebb Mobile Banking Rank</a> , donde nuestro producto tom√≥ una buena posici√≥n para los principiantes. <br><br>  Las "tripas" todav√≠a est√°n en transici√≥n, por lo que tenemos un monolito, el llamado n√∫cleo, alrededor del cual se construyen 23 microservicios.  En el interior, los microservicios de Spring Cloud Netflix, Spring Integration y m√°s.  Y en Spring Boot 2, todo esto ha estado volando desde aproximadamente el mes de julio.  Y justo en este lugar nos detenemos con m√°s detalle.  Al traducir este proyecto a la segunda versi√≥n, me encontr√© con algunas caracter√≠sticas que quiero contarles. <br><br><h2>  Resumen del informe </h2><br><img src="https://habrastorage.org/webt/rl/jd/zq/rljdzqye-_lbzjguklndonlyc-4.jpeg"><br><br>  Hay muchas √°reas donde aparecieron las caracter√≠sticas de Spring Boot 2, trataremos de repasar todas.  Para hacer esto r√°pidamente, necesitamos un detective o investigador experimentado, alguien que descubra todo esto como si fuera por nosotros.  Como Holmes y Watson ya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hicieron una presentaci√≥n</a> en Joker, seremos asistidos por otro especialista, el teniente Colombo.  ¬°Adelante! <br><br><h2>  Spring boot / 2 </h2><br>  Primero, algunas palabras sobre Spring Boot en general y la segunda versi√≥n en particular.  En primer lugar, se lanz√≥ esta versi√≥n, por decirlo suavemente, no ayer: el 1 de marzo de 2018, ya estaba en Disponibilidad general.  Uno de los principales objetivos que persiguieron los desarrolladores fue admitir completamente Java 8 en el nivel de origen.  Es decir, no se puede compilar en una versi√≥n m√°s peque√±a, aunque el tiempo de ejecuci√≥n es compatible.  Se tom√≥ como base el Spring Framework de la quinta versi√≥n, que se lanz√≥ un poco antes que Spring Boot 2. Y esta no es la √∫nica dependencia.  Tambi√©n tiene un concepto como <a href="">BOM</a> (Bill Of Materials): este es un enorme XML, que enumera todas las dependencias (transitivas para nosotros) de todo tipo de bibliotecas de terceros, marcos adicionales, herramientas y m√°s. <br><br>  En consecuencia, no todos los efectos especiales que trae el segundo Spring Boot provienen de s√≠ mismos o del ecosistema de Spring.  Se han escrito dos documentos excelentes para toda esta granja: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Notas de la versi√≥n</a> y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gu√≠a de migraci√≥n</a> .  Los documentos son geniales, la primavera en este sentido generalmente est√° bien hecha.  Pero, por razones obvias, est√° lejos de ser posible cubrir todo lo que hay all√≠: hay algunos detalles, desviaciones, etc. que no pueden o no deben incluirse all√≠.  Hablaremos de tales caracter√≠sticas. <br><br><a name="compile"></a><h2>  Tiempo de compilaci√≥n  Ejemplos de cambio de API </h2><br>  Comencemos con el rastrillo m√°s o menos simple y obvio: estos son los que surgen en tiempo de compilaci√≥n.  Es decir, algo que ni siquiera le permitir√° compilar el proyecto si simplemente cambia el n√∫mero 1 en el script de arranque a 2. <br><br>  La principal fuente de cambios, que se convirti√≥ en la base para tales ediciones en Spring Boot, es, por supuesto, la transici√≥n de Spring a Java 8. Adem√°s, la pila web de Spring 5 y Spring Boot 2 se divide, en t√©rminos relativos, en dos.  Ahora es servlet, tradicional para nosotros y reactivo.  Adem√°s, era necesario tener en cuenta una serie de deficiencias de versiones anteriores.  Se iniciaron bibliotecas de terceros (desde fuera de Spring).  Si miras las Notas de la versi√≥n, no ver√°s ning√∫n obst√°culo sobre la marcha y, francamente, cuando le√≠ las Notas de la versi√≥n por primera vez, me pareci√≥ que todo estaba bien all√≠.  Y para m√≠ se parec√≠a a esto: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/uJ2P16LXA94" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Pero, como probablemente adivine, no todo es tan bueno. <br><br>  <b>En qu√© se romper√° la compilaci√≥n (ejemplo 1):</b> <br><br><ul><li> <b>Por qu√©</b> : la clase <code>WebMvcConfigurerAdapter</code> ya no existe; </li><li>  <b>Por qu√©</b> : para admitir chips Java 8 (m√©todos predeterminados en las interfaces); </li><li>  <b>Qu√© hacer</b> : use la interfaz <code>WebMvcConfigurer</code> . </li></ul><br>  Un proyecto puede no compilarse al menos debido al hecho de que algunas clases simplemente ya no existen.  Por qu√©  S√≠, porque en Java 8 no son necesarios.  Si se tratara de adaptadores con una implementaci√≥n primitiva de m√©todos, entonces no hay nada especial que explicar, los m√©todos predeterminados resuelven todo esto perfectamente.  Aqu√≠ hay un ejemplo de esta clase, est√° claro que es suficiente usar la interfaz en s√≠, y no se necesitan adaptadores. <br><br>  <b>En qu√© compilaci√≥n se romper√° (ejemplo 2):</b> <br><br><ul><li>  <b>Por qu√©</b> : el m√©todo de <code>PropertySourceLoader#load</code> comenz√≥ a devolver una lista de fuentes en lugar de una; </li><li>  <b>Por qu√©</b> : para admitir recursos de documentos m√∫ltiples, por ejemplo, YAML; </li><li>  <b>Qu√© hacer</b> : ajustar la respuesta en <code>singletonList()</code> (cuando se reemplaza). </li></ul><br>  Un ejemplo de un √°rea completamente diferente.  Algunos m√©todos incluso han cambiado las firmas.  Si alguna vez us√≥ el m√©todo load PropertySourceLoader, ahora devuelve una colecci√≥n.  En consecuencia, esto permiti√≥ el soporte de recursos de documentos m√∫ltiples.  Por ejemplo, en YAML, a trav√©s de tres guiones, puede especificar un grupo de documentos en un archivo.  Si ahora necesita trabajar con √©l desde Java, tenga en cuenta que esto debe hacerse a trav√©s de la colecci√≥n. <br><br>  <b>En qu√© compilaci√≥n se romper√° (ejemplo 3):</b> <br><br><ul><li>  <b>Por qu√©</b> : algunas clases del paquete <code>org.springframework.boot.autoconfigure.web</code> han <code>org.springframework.boot.autoconfigure.web</code> de los paquetes <code>.servlet</code> : <code>.servlet</code> y <code>.reactive</code> ; </li><li>  <b>Por qu√©</b> : para apoyar el jet stack a la par de lo tradicional; </li><li>  <b>Qu√© hacer</b> : actualizar las importaciones. </li></ul><br>  Incluso se han introducido m√°s cambios, por lo que se apilan.  Por ejemplo, lo que sol√≠a estar en el mismo paquete web ahora se ha dividido en dos paquetes con un mont√≥n de clases.  Estos son <code>.servlet</code> y <code>.reactive</code> .  ¬øPor qu√© se hace?  Porque no se supon√≠a que el jet stack fuera una enorme muleta encima del servlet.  Era necesario hacer esto para que pudieran mantener su propio ciclo de vida, desarrollarse en sus propias direcciones y no interferir entre s√≠.  ¬øQu√© hacer al respecto?  Suficiente para cambiar las importaciones: la mayor√≠a de estas clases segu√≠an siendo compatibles a nivel API.  La mayor√≠a, pero no todos. <br><br>  <b>En qu√© compilaci√≥n se romper√° (ejemplo 4):</b> <br><br><ul><li>  <b>Por qu√©</b> : la firma de los m√©todos de la clase <code>ErrorAttributes</code> ha <code>ErrorAttributes</code> : en lugar de <code>RequestAttributes</code> , <code>WebRequest(servlet)</code> y <code>ServerRequest(reactive)</code> comenzaron a usarse; </li><li>  <b>Por qu√©</b> : para apoyar el jet stack a la par de lo tradicional; </li><li>  <b>Qu√© hacer</b> : reemplazar los nombres de clase en las firmas. </li></ul><br>  Por ejemplo, en la clase ErrorAttributes, ahora, en lugar de RequestAttributes, otras dos clases comenzaron a usarse en m√©todos: estos son WebRequest y ServerRequest.  El motivo es el mismo.  ¬øY qu√© hacer al respecto?  Si cambia del primer Spring Boot al segundo, debe cambiar RequestAttributes a WebRequest.  Bueno, si ya est√°s en el segundo, usa ServerRequest.  Obviamente, ¬øno es as√≠? <br><br><a name="compile_solution"></a><h3>  Como ser </h3><br>  Hay bastantes ejemplos de este tipo; no los resolveremos todos.  ¬øQu√© hacer al respecto?  En primer lugar, vale la pena echar un vistazo a la Gu√≠a de migraci√≥n de Spring Boot 2.0 para notar el cambio que le concierne a tiempo.  Por ejemplo, menciona renombrar clases completamente no obvias.  A√∫n as√≠, si algo se ha separado y roto, vale la pena considerar que el concepto de "web" se divide en 2: "servlet" y "reactivo".  Con orientaci√≥n en todas las clases y paquetes, esto puede ayudar.  Adem√°s, debe tenerse en cuenta que no solo se cambi√≥ el nombre de las clases y paquetes, sino tambi√©n dependencias y artefactos completos.  Como esto, por ejemplo, sucedi√≥ con Spring Cloud. <br><br><hr><br><a name="contenttype"></a><h2>  Tipo de contenido.  Determinar el tipo de respuesta HTTP </h2><br>  Suficiente sobre estas cosas simples desde el momento de la compilaci√≥n, todo es claro y simple all√≠.  Hablemos de lo que puede suceder en tiempo de ejecuci√≥n y, en consecuencia, puede disparar, incluso si Spring Boot 2 ha estado trabajando para usted durante mucho tiempo.  Hablemos de la definici√≥n de tipo de contenido. <br><br><img src="https://habrastorage.org/webt/03/a2/db/03a2dbs5_suz7osfukciaumo0-y.jpeg"><br><br>  No es ning√∫n secreto que Spring puede escribir aplicaciones web, tanto API de p√°gina como REST, y puede representar contenido con una amplia variedad de tipos, ya sea XML, JSON u otra cosa.  Y uno de los encantos que tanto le gusta a Spring es que no tiene que preocuparse por la definici√≥n del tipo que se proporciona en su c√≥digo.  Puedes esperar magia.  Esta magia funciona, en t√©rminos relativos, de tres maneras diferentes: se basa en el encabezado Aceptar que vino del cliente, o en la extensi√≥n del archivo solicitado, o en un par√°metro especial en la URL, que, por supuesto, tambi√©n se puede dirigir. <br><br>  Considere un ejemplo simple ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digo fuente completo</a> ).  En adelante utilizar√© la notaci√≥n de Gradle, pero incluso si eres un fan√°tico de Maven, no ser√° dif√≠cil para ti entender lo que est√° escrito aqu√≠: creamos una peque√±a aplicaci√≥n en el primer Spring Boot y usamos solo una web de inicio. <br><br>  Ejemplo (v1.x): <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.14.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) }</code> </pre><br>  Como c√≥digo ejecutable, tenemos una sola clase en la que el m√©todo del controlador se declara inmediatamente. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/download/{fileName: .+}"</span></span>, produces = {TEXT_HTML_VALUE, APPLICATION_JSON_VALUE, TEXT_PLAIN_VALUE}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ResponseEntity&lt;Resource&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">download</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable String fileName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,  Content-Type }</span></span></code> </pre><br>  Toma un cierto nombre de archivo como entrada, que supuestamente formar√° y dar√°.  Realmente forma su contenido en uno de los tres tipos indicados (determinando esto por el nombre del archivo), pero no especifica el tipo de contenido de ninguna manera: tenemos Spring, √©l har√° todo por s√≠ mismo. <br><br><img src="https://habrastorage.org/webt/wa/nd/77/wand77z2iocxhhqbcr-bn6lvzxm.jpeg"><br><br>  En general, incluso puedes intentar hacerlo.  De hecho, si solicitamos el mismo documento con diferentes extensiones, ser√° devuelto con el tipo de contenido correcto dependiendo de lo que devolvamos: si quieres - json, si quieres - txt, si quieres - html.  Funciona como un cuento de hadas. <br><br><h3>  Actualizando a v2.x </h3><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) }</code> </pre><br>  Es hora de actualizar al segundo Spring Boot.  Simplemente cambiamos el n√∫mero 1 a 2. <br><br><img src="https://habrastorage.org/webt/rk/ki/dg/rkkidgg5r97wfxcfq_3djkria_u.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Spring MVC Path Matching Cambio de comportamiento predeterminado</a> <br><br>  Pero somos ingenieros, echaremos un vistazo a la Gu√≠a de Migraci√≥n, y de repente se dice algo al respecto.  Pero menciona alg√∫n tipo de "coincidencia de ruta de sufijo".  Se trata de c√≥mo mapear correctamente los m√©todos en Java con una URL.  Pero este no es nuestro caso, aunque un poco como. <br><br><img src="https://habrastorage.org/webt/cy/re/_f/cyre_fno26kbqiepmtpr0tewmrw.jpeg"><br><br>  ¬°Por lo tanto, marcamos, verificamos y golpeamos!  - De repente no funciona.  Por alguna raz√≥n, solo texto / html comienza a darse en todas partes, y si lo cava, no es solo texto / html, sino solo el primero de los tipos que especific√≥ en el atributo produce en la anotaci√≥n @GetMapping.  Por qu√©  Parece, por decirlo suavemente, incomprensible. <br><br><img src="https://habrastorage.org/webt/xt/mj/50/xtmj50wpv1ossdx_6nqeakchwxc.jpeg"><br><br>  Y aqu√≠, las Notas de la versi√≥n no ayudar√°n, debe leer la fuente. <br><br><h3>  ContentNegotiationManagerFactoryBean </h3><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ContentNegotiationManagerFactoryBean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;ContentNegotiationStrategy&gt; strategies = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.strategies != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { strategies.addAll(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.strategies); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.favorPathExtension) { PathExtensionContentNegotiationStrategy strategy; <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶</span></span></code> </pre><br>  All√≠ puede encontrar un cl√°sico con un nombre corto lac√≥nico muy comprensible, que menciona un determinado indicador llamado "considerar extensi√≥n en el camino" (favorPathExtension).  El valor de este indicador "verdadero" corresponde a la aplicaci√≥n de una determinada estrategia con otro nombre conciso corto y comprensible, a partir del cual est√° claro que solo es responsable de determinar el tipo de contenido por extensi√≥n de archivo.  Como puede ver, si la bandera es falsa, entonces la estrategia no se aplicar√°. <br><br><img src="https://habrastorage.org/webt/qy/g3/ms/qyg3mscyw2mnlyqewltjefecwri.jpeg"><br><br>  S√≠, probablemente, muchos notaron que en primavera, aparentemente, hay alg√∫n tipo de pauta, por lo que el nombre debe estar bien, al menos veinte caracteres de largo. <br><br><img src="https://habrastorage.org/webt/ef/j8/il/efj8ilxfvvc1_dtss-7-becc_m0.jpeg"><br><br>  Si profundizas un poco m√°s, puedes cavar un fragmento as√≠.  En el propio marco de Spring, y no en la quinta versi√≥n, como cabr√≠a esperar, pero desde tiempos inmemoriales, este indicador por defecto se ha establecido en "verdadero".  Mientras estaba en Spring Boot y en la segunda versi√≥n, fue bloqueado por otro, que ahora est√° disponible para el control desde la configuraci√≥n.  Es decir, ahora podemos desviarlos de la gesti√≥n ambiental, y esto es solo en la segunda versi√≥n.  ¬øTe sientes?  All√≠ ya asumi√≥ el significado de "falso".  Es decir, quer√≠an, m√°s o menos, hacer lo mejor posible, poner esta bandera en la configuraci√≥n (y esto es genial), pero el valor predeterminado se cambi√≥ a otro (esto no es muy). <br><br>  Los desarrolladores del marco tambi√©n son personas, tambi√©n tienden a cometer errores.  ¬øQu√© hacer al respecto?  Est√° claro que necesita cambiar el par√°metro en su proyecto, y todo estar√° bien. <br><br>  Lo √∫nico que vale la pena hacer por si acaso, para despejar la conciencia, es buscar en la documentaci√≥n de Spring Boot cualquier menci√≥n de esta bandera.  Y all√≠ se lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">menciona</a> realmente, pero solo en un contexto extra√±o: <br><blockquote>  Si <b>comprende las advertencias</b> y a√∫n desea que su aplicaci√≥n use la coincidencia de patr√≥n de sufijo, se requiere la siguiente configuraci√≥n: <br>  spring.mvc.contentnegotiation.favor-path-extension = true <br>  ... <br></blockquote>  Est√° escrito, dicen, si comprende todos los trucos y a√∫n desea utilizar la coincidencia de ruta de sufijo, marque esta casilla.  Siente la discrepancia?  Parece que estamos hablando de la definici√≥n de tipo de contenido en el contexto de este indicador, pero aqu√≠ estamos hablando de la coincidencia de m√©todos y URL de Java.  Parece de alguna manera incomprensible. <br><br>  Tenemos que cavar m√°s lejos.  Existe una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solicitud de extracci√≥n</a> en GitHub: <br><br><img src="https://habrastorage.org/webt/qa/ra/e8/qarae8b3dxgmf-mwhx1-bf9tev0.jpeg"><br><br>  Dentro del marco de esta solicitud de extracci√≥n, se realizaron estos cambios, cambiando el valor predeterminado, y all√≠ uno de los autores del marco dice que este problema tiene dos aspectos: uno es solo la coincidencia de ruta y el segundo es la definici√≥n del tipo de contenido .  Es decir, en otras palabras, la bandera se aplica a ambos, y est√°n inextricablemente vinculados. <br><br>  Podr√≠a, por supuesto, encontrarlo de inmediato en GitHub si supiera d√≥nde buscar. <br><br><img src="https://habrastorage.org/webt/nb/pr/sq/nbprsqxl5nlwzs5qtnv3vohv26y.jpeg"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Partido de sufijo</a> <br><br>  Adem√°s, la documentaci√≥n del Spring Framework en s√≠ mismo tambi√©n afirma que el uso de extensiones de archivo era necesario anteriormente, pero ahora ya no se considera una necesidad.  Adem√°s, result√≥ ser problem√°tico en varios casos. <br><br><h3>  Resumir </h3><br>  Cambiar el valor predeterminado de la bandera no es un error, sino una caracter√≠stica.  Est√° inextricablemente vinculado con la definici√≥n de coincidencia de ruta y est√° dise√±ado para hacer <b>tres cosas</b> : <br><br><ul><li>  reducir los riesgos de seguridad (cu√°les aclarar√©); </li><li>  Alinear el comportamiento de WebFlux y WebMvc, difer√≠an en este aspecto; </li><li>  alinee la declaraci√≥n en la documentaci√≥n con el c√≥digo marco. </li></ul><br><a name="contenttype_solution"></a><h3>  Como ser </h3><br>  Primero, siempre que sea posible, no debe confiar en la definici√≥n de tipo de contenido por extensi√≥n.  El ejemplo que mostr√© es un contraejemplo, ¬°no es necesario hacer esto!  Adem√°s, no es necesario confiar en el hecho de que las solicitudes del formulario "OBTENER algo.json", por ejemplo, simplemente "OBTENER algo".  Este fue el caso en Spring Framework 4 y en Spring Boot 1. Esto ya no funciona.  Si necesita asignar a un archivo con la extensi√≥n, debe hacerlo expl√≠citamente.  En cambio, es mejor confiar en el encabezado Aceptar o en el par√°metro URL, cuyo nombre puede dirigir.  Bueno, si no puede hacerlo de ninguna manera, supongamos que tiene algunos clientes m√≥viles antiguos que dejaron de actualizarse en el siglo pasado, tendr√° que devolver este indicador, configurarlo como "verdadero", y todo funcionar√° como antes. <br><br>  Adem√°s, para una comprensi√≥n general, puede leer el cap√≠tulo "Coincidencia de sufijos" en la documentaci√≥n del Spring Framework, es considerado por los desarrolladores como una especie de colecci√≥n de mejores pr√°cticas en esta √°rea, y familiarizarse con lo que es el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ataque Reflected File Download</a> , solo implementado usando manipulaciones con extensi√≥n de archivo <br><br><a name="scheduling"></a><h2>  Programaci√≥n  Tareas programadas o peri√≥dicas </h2><br>  Cambiemos un poco el alcance y hablemos de completar tareas en un horario o peri√≥dicamente. <br><br><h3>  Un ejemplo de una tarea.  Mensaje de registro cada 3 segundos </h3><br>  Lo que se dice, creo, es comprensible.  Tenemos algunas necesidades comerciales, hacer algo con alg√∫n tipo de repetici√≥n, por lo que procederemos inmediatamente al ejemplo.  Supongamos que tenemos una tarea megacompleja: generar algo de suciedad en el registro cada 3 segundos. <br><br><img src="https://habrastorage.org/webt/rf/ay/mh/rfaymhimyivf7htbkhf7fw3nia0.jpeg"><br><br>  Esto se puede hacer, obviamente, en una variedad de formas, para ellos de cualquier manera ya hay algo en primavera.  Y encu√©ntralo, de muchas maneras. <br><br><h3>  Opci√≥n 1: busque un ejemplo en su proyecto </h3><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *A very helpful service */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReallyBusinessService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ a bunch of methods ‚Ä¶ @Scheduled(fixedDelay = 3000L) public void runRepeatedlyWithFixedDelay() { assert Runtime.getRuntime().availableProcessors() &gt;= 4; } // ‚Ä¶ another bunch of methods ‚Ä¶ }</span></span></code> </pre><br>  Podemos buscar en nuestro propio proyecto y probablemente encontraremos algo como esto.  Una anotaci√≥n depender√° del m√©todo p√∫blico, y quedar√° claro que tan pronto como la cuelgues, todo funciona como en un cuento de hadas. <br><br><h3>  Opci√≥n 2: busque la anotaci√≥n deseada </h3><br><img src="https://habrastorage.org/webt/nr/ax/sv/nraxsvpmgs9u7z2yjavxhceqrli.jpeg"><br><br>  Puede buscar la anotaci√≥n directamente por nombre, y tambi√©n quedar√° claro en la documentaci√≥n que la cuelga, y todo funciona. <br><br><h3>  Opci√≥n 3: buscar en Google </h3><br>  Si no tienes fe en ti mismo, puedes buscarlo en Google y, por lo que has <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">encontrado,</a> tambi√©n estar√° claro que todo comenzar√° con una anotaci√≥n. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventCreator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOG = LoggerFactory.getLogger(EventCreator.class); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EventRepository eventRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventCreator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> EventRepository eventRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventRepository = eventRepository; } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LocalDateTime start = LocalDateTime.now(); eventRepository.save( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventKey(<span class="hljs-string"><span class="hljs-string">"An event type"</span></span>, start, UUID.randomUUID()), Math.random() * <span class="hljs-number"><span class="hljs-number">1000</span></span>)); LOG.debug(<span class="hljs-string"><span class="hljs-string">"Event created!"</span></span>); } }</code> </pre><br>  ¬øQui√©n ve la trampa en esto?  Somos ingenieros despu√©s de todo, veamos c√≥mo funciona esto en realidad. <br><br><h3>  ¬°Mu√©strame el c√≥digo! </h3><br>  Considere una tarea espec√≠fica (la tarea misma y el c√≥digo est√°n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en mi repositorio</a> ). <br><br>  Quien no quiera leer, puede ver este fragmento del video con una demostraci√≥n (hasta el minuto 22): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Como dependencia, usaremos el primer Spring Boot con dos iniciadores.  Uno es para la web, es como si estuvi√©ramos desarrollando un servidor web, y el segundo es un actuador de arranque por resorte para que tengamos caracter√≠sticas listas para la producci√≥n para que al menos nos parezcamos a algo real. <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.14.RELEASE'</span></span> <span class="hljs-comment"><span class="hljs-comment">// springBootVersion = '2.0.4.RELEASE' } compile("org.springframework.boot:spring-boot-starter-web:$springBootVersion") compile("org.springframework.boot:spring-boot-starter-actuator:$springBootVersion") // +100500      }</span></span></code> </pre> <br>  Y nuestro c√≥digo ejecutable ser√° a√∫n m√°s simple. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tech.toparvion.sample.joker18.schedule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.LoggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.autoconfigure.SpringBootApplication; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.Scheduled; <span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnableSchedulingDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(EnableSchedulingDemoApplication.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(EnableSchedulingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">3000L</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doOnSchedule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ log.info(‚Äú <span class="hljs-number"><span class="hljs-number">3</span></span>     ‚Ä¶‚Äù); } }</code> </pre><br>  En general, casi nada notable, excepto por el √∫nico m√©todo en el que colgamos la anotaci√≥n.  Lo copiamos en alguna parte y esperamos que funcione. <br><br>  Vamos a ver, somos ingenieros.  Empezamos  Suponemos que cada tres segundos se registrar√° dicho mensaje.  Todo deber√≠a salir de la caja, nos aseguramos de que todo se inicie en el primer Spring Boot, y esperamos la salida de la l√≠nea deseada.  Pasan tres segundos: se emite una l√≠nea, seis pasadas: se muestra una l√≠nea.  Los optimistas ganaron, todo funciona. <br><br><img src="https://habrastorage.org/webt/ed/em/ir/edemirx8zopb5wbf193tlbbh6fi.png"><br><br>  Solo llega el momento de actualizar al segundo Spring Boot.  No nos molestaremos, solo cambiaremos de uno a otro: <br><br><pre> <code class="java hljs">dependencies { ext { <span class="hljs-comment"><span class="hljs-comment">// springBootVersion = '1.5.14.RELEASE' springBootVersion = '2.0.4.RELEASE' }</span></span></code> </pre><br>  En teor√≠a, la Gu√≠a de Migraci√≥n no nos advirti√≥ sobre nada, y esperamos que todo funcione sin desviaciones.  Desde el punto de vista del c√≥digo ejecutable, no tenemos ninguno de los otros rastrillos que mencion√© anteriormente (incompatibilidad a nivel API u otra cosa), ya que la aplicaci√≥n es lo m√°s simple posible. <br><br>  Empezamos  En primer lugar, estamos convencidos de que estamos trabajando en el segundo Spring Boot, de lo contrario, al parecer, no hay desviaciones. <br><br><img src="https://habrastorage.org/webt/e4/rq/cy/e4rqcy4gms2t-cog16ru4cr8qcu.png"><br><br>  Sin embargo, pasan 3 segundos, 6, 9, pero todav√≠a no hay Herman, no hay conclusi√≥n, nada funciona. <br>  Como sucede a menudo, las expectativas est√°n en desacuerdo con la realidad.  A menudo nos escriben en la documentaci√≥n que, de hecho, todo funciona de forma inmediata en Spring Boot, que en general simplemente podemos comenzar como est√° con problemas m√≠nimos, y no se requiere configuraci√≥n.  Pero tan pronto como se hace realidad, a menudo resulta que todav√≠a se debe leer la documentaci√≥n.  En particular, si profundiza, puede encontrar aqu√≠ estas l√≠neas: <br><blockquote>  7.3.1.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Habilitar anotaciones de programaci√≥n</a> <br>  Para habilitar la compatibilidad con las anotaciones @Scheduled y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Async</a> , puede agregar @EnableScheduling y @EnableAsync a una de sus clases de @Configuration. </blockquote>  Para que la anotaci√≥n programada funcione, debe colgar otra anotaci√≥n en la clase con otra anotaci√≥n.  Bueno, como siempre en primavera.  ¬øPero por qu√© funcion√≥ antes?  No hicimos nada de eso.  Obviamente, esta anotaci√≥n en alg√∫n lugar colg√≥ antes en el primer Spring Boot, pero ahora por alguna raz√≥n no est√° en el segundo. <br><br><img src="https://habrastorage.org/webt/zz/7_/ar/zz7_ardj3w6--f-wefbyenp7_p0.jpeg"><br><br>  Comenzamos a hurgar en los c√≥digos fuente del primer Spring Boot.  Encontramos que hay una clase en la que supuestamente depende.  Miramos m√°s de cerca, se llama "MetricExportAutoConfiguration" y, aparentemente, es responsable de entregar estas m√©tricas de rendimiento al exterior, a algunos agregadores centralizados, y realmente tiene esta anotaci√≥n. <br><br><img src="https://habrastorage.org/webt/mf/ya/pb/mfyapbujxbyzbumuxy2cghrs2qk.jpeg"><br><br>  Adem√°s, funciona de tal manera que incluye su comportamiento en toda la aplicaci√≥n a la vez, no necesita colgarse en clases separadas.  Fue esta clase la que proporcion√≥ este comportamiento y, por alguna raz√≥n, no lo hizo.  Por qu√© <br><br><img src="https://habrastorage.org/webt/vd/p_/fj/vdp_fjs2gqgaicooirzzwu-tjg8.jpeg"><br><br>  De todos modos, GitHub nos empuja a una excavaci√≥n arqueol√≥gica: como parte de la transici√≥n a la segunda versi√≥n de Spring Boot, esta clase se cort√≥ junto con la anotaci√≥n.  Por qu√©  S√≠, porque el motor de entrega de m√©tricas tambi√©n ha cambiado: ya no usan su propio script, sino que cambiaron a Micrometer, una soluci√≥n realmente significativa.  Eso es algo superfluo que le queda.  Quiz√°s esto sea incluso correcto. <br><br>  Quien no quiera leer, vea una breve demostraci√≥n durante 30 segundos: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Se deduce que si ahora tomamos y colgamos manualmente la anotaci√≥n faltante en nuestra clase original, entonces, en teor√≠a, el comportamiento deber√≠a ser correcto. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tech.toparvion.sample.joker18.schedule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.LoggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.autoconfigure.SpringBootApplication; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.EnableScheduling; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.Scheduled; <span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableScheduling</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnableSchedulingDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(EnableSchedulingDemoApplication.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(EnableSchedulingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">3000L</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doOnSchedule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ log.info(‚Äú <span class="hljs-number"><span class="hljs-number">3</span></span>     ‚Ä¶‚Äù); } }</code> </pre><br>  ¬øCrees que funcionar√°?  Vamos a ver  Empezamos <br><br><img src="https://habrastorage.org/webt/6f/pg/ld/6fpgldlhinmkrdq6git1-dovdrg.png"><br><br>  Se puede ver que despu√©s de 3 segundos, despu√©s de 6 y despu√©s de 9, el mensaje esperado por nosotros todav√≠a se muestra en el registro. <br><br><a name="scheduling_solution"></a><h3>  Como ser </h3><br>  ¬øQu√© hacer con esto en este caso particular y m√°s general?  No importa cu√°n moralista pueda sonar, en primer lugar, vale la pena leer no solo fragmentos de documentaci√≥n copiados, sino tambi√©n un poco m√°s amplios, solo para cubrir tales aspectos. <br><br>  En segundo lugar, recuerde que en Spring Boot, aunque muchas funciones est√°n listas para usar (programaci√≥n, as√≠ncrona, almacenamiento en cach√©, ...), no siempre se incluyen, deben habilitarse expl√≠citamente. <br><br>  En tercer lugar, no se molesta en estar seguro: agregue anotaciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Enable</a> * (y toda su familia) a su c√≥digo, sin esperar un marco.  Pero entonces surge la pregunta: ¬øqu√© pasar√° si por casualidad yo y mis colegas agregamos algunas anotaciones, c√≥mo se comportar√°n?   ,        .    :  .   ,       . <br><br> , @EnableAsync  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Enable</a> Caching  , ,  ,  ,        ,    . ,             .     ?      javadoc    ,      .  ,        .    ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Enable</a> *,       ,    .     ?            . <br><br><a name="proxy"></a><h2> Spring Cloud &amp; Co.   </h2><br><img src="https://habrastorage.org/webt/0a/sa/qj/0asaqj87-tg2xetyig_ytjreb34.jpeg"><br><br>       Spring Boot 2   ,    Spring Cloud ‚Äî      Service Discovery (   ).      JavaMelody.     -  .  , ,    JDBC,    H2. <br><br><img src="https://habrastorage.org/webt/as/fd/lb/asfdlb0f-iqfgaquxgr7bjitwpq.jpeg"><br><br>    ,      ,  JavaMelody ‚Äî   ,           ,   .   dev-,  test,          -  ,  Prometheus. <br><br>      Gradle   : <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> springCloudVersion = <span class="hljs-string"><span class="hljs-string">'2.0.1.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) runtime(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-jdbc:$springBootVersion"</span></span>) runtime group: <span class="hljs-string"><span class="hljs-string">"org.springframework.cloud"</span></span>, name: <span class="hljs-string"><span class="hljs-string">"spring-clooud-starter-netflix-eureka-client"</span></span>, version: <span class="hljs-function"><span class="hljs-function">springCloudVersion </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runtime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"net.bull.javamelody:javamelody-spring-boot-starter:1.72.0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//‚Ä¶ }</span></span></span></span></code> </pre><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">(  )</a> <br><br>      Spring Boot ‚Äî  web  jdbc,  Spring Cloud     eureka (,    ,    Service Discovery),   JavaMelody.        . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HikariJavamelodyDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(HikariJavamelodyDemoApplication.class, args); } }</code> </pre><br>  Empezamos <br><br><img src="https://habrastorage.org/webt/uj/os/hr/ujoshrw-kj_cn72s23h5e7fjgka.jpeg"><br><br>      .      ,        ,      -  com.sun.proxy  Hikari, HikariDataSource.    ,  Hikari ‚Äî      ,    Tomcat, C3P0  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hv/la/u9/hvlau913-05gppcoqmjfsbuzip0.jpeg" width="50%"></div><br>   ?       . <br><br><h2>   </h2><br><h3> Spring Cloud  dataSource   </h3><br>  ,  Spring Cloud   ,    dataSource (   ),  .     ,    AutoRefresh  RefreshScope ‚Äî                .          .      CGLIB. <br><br>  , ,   Spring Boot     Spring    :     JDK  (    ,   )     CGLIB (   ).     BeanPostProcessor'    BeanDefinition      ,        . <br><br><h3> JavaMelody  dataSource   </h3><br>   ‚Äî  JavaMelody.    DataSource  ,      ,         . JavaMelody   JDK-,      ,   .       ‚Äî   BeanPostProcessor. <br><br>        ,   ,     DataSource     JDK-,    CGLIB-.    : <br><br><img src="https://habrastorage.org/webt/j8/la/aj/j8laaj9tuxuewycjnpqzuxcaxpw.png"><br><br>     .      ,         . <br><br><h3> Spring Boot  dataSource.unwrap() </h3><br>     Spring Boot,     DataSource#unwrap(),        JMX.    JDK-       (     ),  CGLIB-,   Spring Cloud,     Spring Context. ,   ,      JDK-,    CGLIB API    . <br><br>       ,     : <br><br><img src="https://habrastorage.org/webt/a4/tb/aw/a4tbawwbqhd72cn7zw-ain4zm4c.jpeg"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://jira.spring.io/browse/SPR-17381</a> <br><br>       ,   ,     ,         .     ,     , , , -   . <br><br><img src="https://habrastorage.org/webt/ke/bn/ns/kebnnswvcy8kwtnqezvikitcdvw.jpeg"><br><br>     .       Hikari? <br><br>  ,     Hikari  -    ,   Spring Cloud    .   : Hikari       Spring Boot 2. ? -    - .   ,  Spring Cloud?   ,    -  ,       ?   .  ,       . <br><br><h3>    ‚Ä¶ </h3><br><pre> <code class="java hljs">org.springframework.cloud.autoconfigure.RefreshAutoConfiguration .RefreshScopeBeanDefinitionEnhancer: <span class="hljs-comment"><span class="hljs-comment">/** * Class names for beans to post process into refresh scope. Useful when you * don't control the bean definition (eg it came from auto-configuration). */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;String&gt; refreshables = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;&gt;( Arrays.asList(<span class="hljs-string"><span class="hljs-string">"com.zaxxer.hikari.HikariDataSource"</span></span>));</code> </pre><br>      Spring Cloud    autoconfiguration,       Enhancer BeanDefinition',       ,      Hikari.    Spring Cloud        .       . <br><br>      ?    Spring Cloud   ,        CGLIB-.   , ,  ,  ,    -      .        (jira.spring.io/browse/SPR-17381).       BeanPostProcessor,     .      BeanDefinition       ,    BeanPostProcessor'.   Stack Overflow    ,      -  ,    , proxyTargetClass   true  false  ,   .    ,        .      . <br><br>            ,      -   ,     . <br><br>    : <br><br><ul><li>      (, Tomcat JDBC Pool) <br> spring.datasource.type=org.apache.tomcat.jdbc.pool.DataSource <br>     <br> runtime 'org.apache.tomcat:tomcat-jdbc:8.5.29' <br> Hikari ,  , ,   ,      ,      Tomcat,     Spring Boot. </li><li>   JavaMelody,   JDBC-,    . <br> javamelody.excluded-datasources=scopedTarget.dataSource </li><li>      Spring Cloud. <br> spring.cloud.refresh.enabled=false <br> ,  ,     ,    Service Discovery,       . </li></ul><br><br>      .              ,          . <br><br><a name="bonus"></a><h3>  ( *) </h3><br> *  Spring Cloud (   JavaMelody) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@ManagedResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableAsync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyJmxResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ManagedOperation</span></span> <span class="hljs-meta"><span class="hljs-meta">@Async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">launchLongLastingJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// -   } }</span></span></code> </pre><br>   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/toparvion/joker-2018-samples/tree/master/jmx-resource</a> . <br><br>   .    ,      Spring Cloud.   JavaMelody ,    Spring-,   .       ,  ,     ,    JMX   .      -  ,      Async,    JMX-  .      JMX,      @ManagedOperation,     ,     (    Spring ‚Äî    ,     OK). <br><br>      ,     ,      , , ,  myJMXResource     JMX,     .     ,          ‚Äî     , CGLIB  JDK. <br><br><img src="https://habrastorage.org/webt/de/c2/bo/dec2bo6sbaa1zipyhg55jigk960.jpeg"><br><br>  JDK  CGLIB-.    ,  -   BeanPostProcessor. <br><br>  ,    BeanPostProcessor': <br> AsyncAnnotationBeanPostProcessor <br><br><ul><li> :      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Async</a> </li><li> : org.springframework.scheduling </li><li>  :  @EnableAsync ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Import</a> ) </li></ul><br> 2. DefaultAdvisorAutoProxyCreator <br><ul><li> :     AOP-,        </li><li> : org.springframework.aop.framework.autoproxy </li><li>  : @Configuration- PointcutAdvisorConfig (  ) </li></ul><br> DefaultAdvisorAutoProxyCreator   @Configuration-.   ,      ,   JavaMelody,             configuration-.  ,    PointcutAdvisorConfig,        . <br><br><img src="https://habrastorage.org/webt/ta/bq/lh/tabqlh0jqjk71cnajqj5trjwp10.jpeg"><br><br>   ,    .   PointcutAdvisorConfig,   AdvisorConfig,     ,  configuration-,   ,  ,  ,    ,          . <br><br>  ,     ,   ,   ,    -. <br><br><img src="https://habrastorage.org/webt/nx/hw/vk/nxhwvkroqzaw8eziviybh7ct2sk.jpeg"><br><br>       BeanPostProcessor'.        ,       ,   ,    BeanPostProcessor         .    ,         Advised (  BeanPostProcessor'),   , ,   ,     , ,   JDK-,         .      . <br><br>        .     ,     : <br><br><img src="https://habrastorage.org/webt/kz/_r/te/kz_rtesazmfb1jdrd-2cbt7_kfo.png"><br><br>       JMX     .        BeanPostProcessor.       BeanPostProcessor',        , ,   ,   ,            JAR,    ,   . <br><br><a name="proxy_solution"></a><h3>  Como ser </h3><br> -,       ,   Spring AOP,  , .  ¬´ ¬ª?        ,  -       Advice  Advisor,      ,       . <br><br> -,    best practices. ,          JMX-  ,       .  - ,       , ,     .      ,   autowire' ()     .     .  ,    ,    - .           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Order</a> ,     .  ,   ,     , ..     proxyTargetClass,   . <br><br> :     ,   . -, ¬´Keep calm and YAGNI¬ª.   ,                .  ¬´ ¬ª,      - , -   ,    ,       ,   .     ,  ,       :    -,   ,       ‚Äî  ,    .          . , Spring    ,      ,    .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">tolkkv</a> ,   ,      436- ,   .      ,      . <br><br><a name="relax"></a><h2> Relax Binding.    ()  </h2><br>   ,    . <br><br><img src="https://habrastorage.org/webt/ry/xw/mv/ryxwmvrfnmzbmona2o3vys4yqim.jpeg"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-external-config-relaxed-binding</a> <br><br>    ,  Relax Binding  Spring Boot.       -         . ,      -   firstName   ,       acme.my-project.person,  Spring Boot      .        :  camel case,  ,     ,  -  ‚Äî       firstName.      Relax Binding. <br><br>      Spring Boot'    ,   ,          ‚Äî        . ,  ,   ,     : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#relaxed-binding</a> ( 1 ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-external-config-relaxed-binding</a> ( 3 ) </li><li> <a href="">github.com/spring-projects/spring-boot/wiki/Relaxed-Binding-2.0</a> ( 4 ) </li></ul><br>   ,  ,  .  - . ,      . <br><br>  Por ejemplo: <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter:$springBootVersion"</span></span>) }</code> </pre><br> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> ) <br><br>       - ,   web,   Spring Boot,         -  . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RelaxBindingApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(RelaxBindingDemoApplication.class); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SecurityProperties securityProperties; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(RelaxBindingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> main </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ApplicationArguments args)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"KEYSTORE TYPE IS: {}"</span></span>, securityProperties.getKeyStoreType()); } }</code> </pre><br>  ,    POJO- ( )        ,    KEYSTORE TYPE.  POJO          ,      applications.properties  application.yaml,  . <br><br>      keystoreType,     private String keystoreType,      applications.properties: security.keystoreType=jks. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConfigurationProperties</span></span>(prefix = <span class="hljs-string"><span class="hljs-string">"security"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecurityProperties</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String keystorePath; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String keystoreType; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKeystorePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keystorePath; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKeystorePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String keystorePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.keystorePath = keystorePath; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKeyStoreType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keystoreType; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKeystoreType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String keystoreType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.keystoreType = keystoreType; } }</code> </pre><br>     Spring Boot     . <br><br><img src="https://habrastorage.org/webt/ya/fn/kg/yafnkgxoaoudil70xnvdw1q_hhc.jpeg"><br><br>  ,  ,  ,  .      ,      . <br><br><img src="https://habrastorage.org/webt/qz/1b/s6/qz1bs6ydorm1cfaej8lcfzvxc84.jpeg"><br><br>      ,   .   ,   ,  ,    -   ,       , - key-store-type.        ,    ,        ,     . <br><br>       .    ,      . <br><br><img src="https://habrastorage.org/webt/kf/8j/8e/kf8j8eytzsayh7xarx_dx_kaedy.jpeg"><br><br>     .      2  ,   ,   .           Java   properties ‚Äî  ,    .    , , ,     ,    ,      .   ‚Äî      Java bean       .   ,    ,  .       ,   ¬´keystore¬ª  ,    : ¬´Key¬ª  ¬´Store¬ª. ‚Ä¶ <br><br><img src="https://habrastorage.org/webt/9-/ak/rw/9-akrwm5gftlarfdvte2s1hqkas.jpeg"><br><br>  ,    ,    ?  Nosotros entendemos <br><br> ,    ,    Relax Binding    (   getStoreType()).   ,     . ,         .    ,  keyStoreType,   . ,       Relax Binding,    ,        ,    . <br><br>  ,   -  ,  -   ,     .      ,     .         : <br><br><img src="https://habrastorage.org/webt/ll/s_/c2/lls_c2hpqhq6ea7eooc_bf65c_u.jpeg"><br><br>        ,  -    ,    ,   , ,     -,         .        . <br><br><a name="relax_solution"></a><h3>  Como ser </h3><br>        :       - . -,   ,     dev-   , ,  YAML  properties,    ‚Äî      ,    ,    . -,     <a href="">c   </a> ,       Relax Binding,    .  , , ,     Spring Boot   . <br><br><a name="unit"></a><h2> Unit Testing.    Mockito 2 </h2><br>    ,    -     ,        Mockito. <br><br> Mockito    ,        Spring Boot Starter,      Spring,        Mockito. <br><br><pre> <code class="plaintext hljs">$gradle -q dependencyInsight --configuration testCompile --dependency mockito org.mockito:mockito-core:2.15.0 variant "runtime" /--- org.springframework.boot:spring-boot-starter-test:2.0.2.RELEASE /---testCompile</code> </pre><br>     ?      .    Spring Boot  Mockito   ,    1.5.2 Spring Boot     Mockito 2,      .     -  .         Mockito 2. <br><br>  Mockito   ,    2016-   Mockito 2.0  Mockito.2.1‚Äî      :  Java 8    ,     Hamcrest     - .   ,     ,     . <br><br>     ,           ,     (  ) . <br><br><img src="https://habrastorage.org/webt/5a/yt/fo/5aytfoqxgbx4crbjwmngut1dh1i.jpeg"><br><br> ,       ,     JButton  Swing,    null,   ,     -  .   , string'   null,   , null   instanceof  string.  ,  Mockito 1     ,  Mockito 2          ,  anyString  null   ,        ,       .      :      null,     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> ,  ,         ,     Mockito 1. <br><br>  ,   , . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object target)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//‚Ä¶ } } &lt;hr/&gt; @Test public void testAnyStringMatcher() { MyService myServiceMock = mock(MyService.class); myServiceMock.setTarget(new JButton()); verify(myServiceMock).setTarget(anyString()); }</span></span></code> </pre><br> ,        ,   .                 JButton.       anyString.  ,   :   ,     ‚Äî    .   ,       .    -       10-    ,        .  Mockito 1   ,     : <br><br><img src="https://habrastorage.org/webt/ts/_s/cd/ts_scdhl4ikfptceteyv-plex0o.png"><br><br> Mockito 2    , ,   , anyString     : <br><br><img src="https://habrastorage.org/webt/db/tw/ec/dbtwecp6onmr9f_r4k-ufverzb8.jpeg"><br><br>     .   ,    . ,        ,      ,         ,         SocketTimeoutException,       -   .          ,  SocketTimeoutException ,  .         Mockito 1. <br><br><img src="https://habrastorage.org/webt/2b/nc/9d/2bnc9dqcfgkh7htm6-tiih1mf38.png"><br><br>   Mockito 2        ,        : <br><br><img src="https://habrastorage.org/webt/41/ya/uh/41yauhpileynqw_fqvdisk26h_k.jpeg"><br><br>   ,  Mockito 1    ,     ,        .      new SocketTimeoutException   new,  constructor,  Mockito 1   . <br><br>  ¬øQu√© hacer al respecto?    , ,  RuntimeException,       ,    Mockito     . <br><br>    .    ,       .       compile-time. -     ,     Hamcrest.  Spring Boot,  Mockito 1     @MockBean  @SpyBean.        ,    Spring Integration,         review. <br> (: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://docs.spring.io/spring-integration/docs/5.0.0.RELEASE/reference/htmlsingle/#testing</a> ) <br><br><h3>  Como ser </h3><br>     ,   ,      Mockito 1,      Mockito 2 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dzone.com/refcardz/mockito</a> ). <br><br> -,      ,     ,    Spring Boot 1.5.2  Mockito 2. <br><br> -, ,    ,    Mockito 2,          : <a href=""></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . <br><br><a name="gradle"></a><h2> Gradle Plugin.  Spring Boot  </h2><br> ,     , ‚Äî  Spring Boot-  Gradle. <br><br>   Migration Guide ,  Spring Boot   Gradle   .  ,  .  :    Gradle 4  (,    settings.gradle   ).       dependency management plugin,    .    bootRepackage,  ,   :  bootWar  bootJar.     bootJar     . <br><br>  bootJar: <br><br><ul><li>  ,    org.springframework.boot  java; </li><li>   jar; </li><li>   mainClassName (    )   (  ,  -  ). </li></ul><br>  ,    ,      ‚Äî   ,   ,   Gradle,     Spring Boot. <br><br>     ?   -    Spring Boot 2, , ,  Gradle 4      Spring Boot-.     ,     ,  :      ,  ,     (    ,     ). <br><br><img src="https://habrastorage.org/webt/kb/uh/y4/kbuhy4rtm7yyl_zjp2ij62wavoq.jpeg"><br><br>   ,   .    app1 ,    app2, app3  . .  app1    lib. <br><br><h3> ¬´Show me the code!¬ª </h3><br>   <br><br><pre> <code class="java hljs">subprojects { repositories { mavenCentral() } apply plugin: <span class="hljs-string"><span class="hljs-string">'java'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'org.springframework.boot'</span></span> }</code> </pre><br>         ‚Äî   : java   Spring Boot   . <br><br> ,   ,       ,   .      ,        ,     ,     .       . <br><br> app1:   <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter:$springBootVersion"</span></span>) <span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">':lib'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> }</span></span></code> </pre><br>          lib  ,   Spring Boot-. <br><br> app1:   <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GradlePluginDemoApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//‚Ä¶ @Override public void run(ApplicationArguments args) { String appVersion = Util.getAppVersion(getClass()); log.info("Current application version: {}", appVersion); } }</span></span></code> </pre><br>         Util,     . <br><br> lib:   <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Util</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAppVersion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;?&gt; appClass)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> appClass.getPackage().getImplementationVersion(); } }</code> </pre><br>   Util   getAppVersion    ,    ,  ImplementationVersion   .        . <br><br><img src="https://habrastorage.org/webt/jc/ax/ur/jcaxur0f1_-yhxot9uvkfsf3fos.jpeg"><br><br>      IDE,   ,    ,     .    gradle build  IDE ,   .         Util.  ,  ,    ,      ,       . <br><br><a name="gradle_solution"></a><h3>   </h3><br> : <br><br><ul><li> bootJar   jar; </li><li> Gradle        jar. </li></ul><br> : <ul><li>       ; </li><li>   ,    jar (  ImplementationVersion), . </li></ul><br>    ?   :        . <br><br><img src="https://habrastorage.org/webt/dz/lr/p8/dzlrp85l4z8wsgc12ttn7cwsqec.jpeg"><br><br>       Spring Boot-   , ,   lib    .     . <br><br>  2:  SB Gradle Plugin   Spring Boot- <br><br><pre> <code class="java hljs">bootJar { enabled = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }</code> </pre><br>    ,      -   ,    , ,    , ,      bootJar   . ,    jar  ,       . <br><br><a name="other"></a><h2>  Otros </h2><br>  , ,      ,      Spring Boot.       . <br><br><img src="https://habrastorage.org/webt/xm/8w/kx/xm8wkxoaoc2ujoy0kicwn5v2n9w.jpeg"><br><br>  Spring Boot        :       web-,       ,    .    - ,       ,  Spring Boot properties migrator,      ,  ,        .      ,     ,     -,        . <br><br>      Actuator.  ,       ()  ,      Spring Security.       . <br><br><img src="https://habrastorage.org/webt/hv/sl/d4/hvsld4a0hcak8jvs3rbwsbugi00.jpeg"><br><br>  Spring Cloud   .   ,        .   ,  Netflix  Feign. <br><br><img src="https://habrastorage.org/webt/lu/a5/6l/lua56loq0hsapwtgkstpf0_7ik0.jpeg"><br><br>  Spring Integration,     ,   Spring Framework,   .     ‚Äî  ,    Java DSL      , ,        .   ,       ,   ,      ,        handle    handleWithAdapter. <br><br><a name="summary"></a><h2> .    </h2><br> ,    ,     : <br><br><img src="https://habrastorage.org/webt/ww/ob/aq/wwobaqaf8ncw8fsfowcbdvipbvu.jpeg"><br><br>   ,   , , Web,       . <br><br>  (Properties Binding),   ,       ,    Relax Binding. <br><br>  ‚Äî ,     :   , AOP  ,        ,   Spring Boot 2     . <br><br> , , ,  ‚Äî   ,     Mockito 1  Mockito 2.    -  ,     ? <br><br><ul><li>  ¬´ ¬ª (YAGNI) </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">;</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Migration Guide</a> ; </li><li>   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> </li></ul><br> -,   ,         ,     ,    YAGNI.   ,    -  ,     .  ,  ,     . <br><br> -,   - - ,     ,   ,     .     ,      ,  , ,       .           Migration Guide.  ,         ,   ,       ,  ,          . <br><br>     ,             Spring Boot. ,                 Spring Boot,     ,       ‚Ä¶    . <br><blockquote>    ,  : <b>5-6   </b>  <b>JPoint</b> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>  Spring Boot:      Spring Boot-  Java 8  Java 11.    ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439796/">https://habr.com/ru/post/439796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439786/index.html">Revisi√≥n del tel√©fono IP Snom D712 (y un poco D710)</a></li>
<li><a href="../439788/index.html">Otras rarezas en los algoritmos GOST Grasshopper y Stribog</a></li>
<li><a href="../439790/index.html">Prueba de JaCarta WebClient o almacenar tokens en una caja fuerte</a></li>
<li><a href="../439792/index.html">La NASA est√° buscando socios en la industria estadounidense para crear un aterrizaje tripulado parcialmente reutilizable</a></li>
<li><a href="../439794/index.html">Dolor de espalda: comprensi√≥n desde la perspectiva de la medicina moderna</a></li>
<li><a href="../439804/index.html">Zen de pruebas unitarias</a></li>
<li><a href="../439806/index.html">Nombres de dominio SSL v√°lidos para contenedores Docker locales</a></li>
<li><a href="../439808/index.html">Los telescopios m√°s grandes. Desde notebook y ojos hasta c√°maras de 340 megap√≠xeles y centros de datos. Parte 1</a></li>
<li><a href="../439810/index.html">Conozca el marco de microservicios de Moleculer</a></li>
<li><a href="../439812/index.html">Enfoques de Kaggle para CV en prod: no puede implementar para cortar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>