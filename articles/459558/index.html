<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôéüèΩ üèçÔ∏è üç∂ C√≥mo comenzar a usar el modo de usuario en Linux üçé üè∞ üìí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introducci√≥n del traductor: en el contexto de la entrada masiva en nuestras vidas de varios tipos de contenedores, puede ser bastante interesante y √∫t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo comenzar a usar el modo de usuario en Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/459558/">  <i>Introducci√≥n del traductor: en el contexto de la entrada masiva en nuestras vidas de varios tipos de contenedores, puede ser bastante interesante y √∫til descubrir con qu√© tecnolog√≠as comenz√≥ todo una vez.</i>  <i>Algunos de ellos pueden usarse hasta el d√≠a de hoy, pero no todos recuerdan tales m√©todos (o saben si no fueron encontrados durante su r√°pido desarrollo).</i>  <i>Una de esas tecnolog√≠as es User Mode Linux.</i>  <i>El autor del original revolvi√≥ bastante, averiguando qu√© de los desarrollos antiguos todav√≠a funcionaba, y qu√© no era mucho, y recopil√≥ algo como una instrucci√≥n paso a paso sobre c√≥mo iniciar UML local en 2k19 para m√≠.</i>  <i>Y s√≠, invitamos al autor de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">publicaci√≥n</a> original de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Cadey</a> a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Habr</a> , as√≠ que si tiene preguntas, pregunte en ingl√©s en los comentarios.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/480/b5e/ecc/480b5eeccd71ac8e098a9e7b3b8bedb6.jpg" alt="imagen"><br><br>  El modo de usuario de Linux es, de hecho, el puerto del kernel de Linux.  Este modo le permite ejecutar un kernel de Linux completo como un proceso de usuario y generalmente lo usan los desarrolladores para probar los controladores.  Pero este modo tambi√©n es √∫til como herramienta para el aislamiento general, cuyo principio es similar al funcionamiento de las m√°quinas virtuales.  Este modo proporciona m√°s aislamiento que Docker, pero menos que una m√°quina virtual completa como KVM o Virtual Box. <br><a name="habracut"></a><br>  En general, el modo de usuario puede parecer extra√±o y dif√≠cil de usar, pero a√∫n tiene sus propias √°reas de aplicaci√≥n.  Despu√©s de todo, este es un n√∫cleo Linux completo, que trabaja desde un usuario sin privilegios.  Esta caracter√≠stica le permite ejecutar c√≥digo potencialmente no confiable sin ninguna amenaza para la m√°quina host.  Y dado que es un kernel completo, sus procesos est√°n aislados de la m√°quina host, es decir, los <b>procesos que se ejecutan dentro del Modo de usuario no ser√°n visibles para el host</b> .  Esto no es como el contenedor Docker habitual, en cuyo caso la m√°quina host siempre ve los procesos dentro del repositorio.  Echa un vistazo a esta pieza de pstree desde uno de mis servidores: <br><br><pre><code class="xml hljs">containerd‚îÄ‚î¨‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄdnsd‚îÄ‚îÄ‚îÄ19*[{dnsd}] ‚îÇ ‚îÇ ‚îî‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îî‚îÄ10*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄaerial‚îÄ‚îÄ‚îÄ21*[{aerial}] ‚îÇ ‚îÇ ‚îî‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îî‚îÄ10*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îÇ ‚îî‚îÄsurl ‚îÇ ‚îî‚îÄ9*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄh‚îÄ‚îÄ‚îÄ13*[{h}] ‚îÇ ‚îÇ ‚îî‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îî‚îÄ10*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄgoproxy‚îÄ‚îÄ‚îÄ14*[{goproxy}] ‚îÇ ‚îî‚îÄ9*[{containerd-shim}] ‚îî‚îÄ32*[{containerd}]</code> </pre> <br>  Y compare esto con el kernel pstree Linux en modo de usuario: <br><br><pre> <code class="xml hljs">linux‚îÄ‚î¨‚îÄ5*[linux] ‚îî‚îÄslirp</code> </pre> <br>  Cuando trabajo con contenedores Docker, puedo ver los nombres de los procesos que se ejecutan en el sistema invitado desde el host.  Con el modo de usuario de Linux, esto no es posible.  ¬øQu√© significa esto?  Esto significa que las herramientas de monitoreo que funcionan a trav√©s del subsistema de auditor√≠a de Linux <b>no ven los</b> procesos que se ejecutan en el sistema invitado.  Pero en algunas situaciones, esta caracter√≠stica puede convertirse en una espada de doble filo. <br><br>  En general, toda la publicaci√≥n a continuaci√≥n es un conjunto de estudios e intentos groseros para lograr el resultado deseado.  Para hacer esto, tuve que usar varias herramientas antiguas, leer las fuentes del n√∫cleo, depurar intensamente el c√≥digo escrito mientras a√∫n estaba en la escuela primaria, y tambi√©n elegir los ensamblados de Heroku usando un binario especial en busca de las herramientas que necesitaba.  Todo este trabajo ha llevado a los chicos de mi IRC a llamarme m√°gico.  Espero que esta publicaci√≥n sirva como una documentaci√≥n confiable para que todo funcione de la misma manera, pero con kernels y versiones de sistema operativo m√°s recientes. <br><br><h3>  Personalizaci√≥n </h3><br>  La configuraci√≥n del modo de usuario de Linux tiene varios pasos: <br><br><ul><li>  instalar dependencias en el host; </li><li>  Descargar el kernel de Linux </li><li>  configuraci√≥n del ensamblaje del n√∫cleo; </li><li>  ensamblaje del grano; </li><li>  instalaci√≥n binaria; </li><li>  configurar el sistema de archivos de invitado; </li><li>  selecci√≥n de par√°metros de lanzamiento del kernel; </li><li>  configuraci√≥n de la red de invitados; </li><li>  comenzando el kernel invitado. </li></ul><br>  Supongo que si decides subirlo todo por ti mismo, lo m√°s probable es que hagas todo lo descrito en alg√∫n sistema similar a Ubuntu o Debian.  Trat√© de implementar todo lo anterior en mi distribuci√≥n favorita: Alpine, pero no sali√≥ nada de eso, aparentemente porque el kernel de Linux ten√≠a un estricto enlace en glibc-isms para los controladores en modo de usuario.  Tengo la intenci√≥n de informar de esto a la corriente arriba despu√©s de que finalmente descubra el problema. <br><br><h3>  Instalar dependencias en el host </h3><br>  Ubuntu requiere al menos los siguientes paquetes para construir el kernel de Linux (siempre que haya una instalaci√≥n limpia): <br><br> <code>- 'build-essential' <br> - 'flex' <br> - 'bison' <br> - 'xz-utils' <br> - 'wget' <br> - 'ca-certificates' <br> - 'bc' <br> - 'linux-headers'</code> <br> <br>  Puede instalarlos usando el siguiente comando (con privilegios de root o usando sudo): <br><br><pre> <code class="xml hljs">apt-get -y install build-essential flex bison xz-utils wget ca-certificates bc \ linux-headers-$(uname -r)</code> </pre> <br>  Tenga en cuenta que ejecutar el programa de configuraci√≥n del men√∫ para el kernel de Linux requerir√° la instalaci√≥n de <code>libncurses-dev</code> .  Aseg√∫rese de que est√© instalado con el siguiente comando (con privilegios de root o con sudo): <br><br><pre> <code class="xml hljs">apt-get -y install libncurses-dev</code> </pre> <br><h3>  Descarga del kernel </h3><br>  Determine la ubicaci√≥n para la carga y el posterior ensamblaje del n√∫cleo.  Para esta operaci√≥n, deber√° asignar aproximadamente 1.3 GB de espacio en el disco duro, as√≠ que aseg√∫rese de tener uno. <br><br>  Luego vaya a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">kernel.org</a> y obtenga la URL para descargar la √∫ltima versi√≥n estable del kernel.  Al momento de escribir esta publicaci√≥n: <a href="">https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.1.16.tar.xz</a> <br><br>  Descargue este archivo usando <code>'wget'</code> : <br><br><pre> <code class="xml hljs">wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.1.16.tar.xz</code> </pre> <br>  Y extraerlo con <code>'tar'</code> : <br><br><pre> <code class="xml hljs">tar xJf linux-5.1.16.tar.xz</code> </pre> <br>  Ahora ingresamos al directorio creado al desempacar el tarball: <br><br><pre> <code class="xml hljs">cd linux-5.1.16</code> </pre> <br><h3>  Configuraci√≥n de compilaci√≥n del n√∫cleo </h3><br>  El sistema de compilaci√≥n del n√∫cleo es una colecci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Makefiles</a> con <b>muchas</b> herramientas y scripts personalizados para automatizar el proceso.  Para comenzar, abra el programa de configuraci√≥n en l√≠nea: <br><br><pre> <code class="xml hljs">make ARCH=um menuconfig</code> </pre> <br>  Completar√° parcialmente el ensamblaje y mostrar√° un cuadro de di√°logo para usted.  Cuando se muestra ' <code>[Select]</code> ' en la parte inferior de la ventana, puede hacer la configuraci√≥n con las teclas Espacio o Entrar.  Navegaci√≥n en la ventana, como de costumbre, con las flechas hacia arriba y hacia abajo del teclado, y la selecci√≥n de elementos es izquierda o derecha. <br><br>  Un puntero de vista ---&gt; significa que est√° en un submen√∫ al que se accede mediante la tecla Intro.  La salida es obviamente a trav√©s de ' <code>[Exit]</code> '. <br><br>  Incluya los siguientes par√°metros en ' <code>[Select]</code> ' y aseg√∫rese de que haya un s√≠mbolo '[*]' junto a ellos: <br><br><pre> <code class="xml hljs">UML-specific Options: - Host filesystem Networking support (enable this to get the submenu to show up): - Networking options: - TCP/IP Networking UML Network devices: - Virtual network device - SLiRP transport</code> </pre> <br>  Todo desde esta ventana se puede salir seleccionando secuencialmente ' <code>[Exit]</code> '.  Solo aseg√∫rese de que al final se le solicite que guarde la configuraci√≥n y seleccione ' <code>[Yes]</code> '. <br><br>  Te recomiendo que juegues con las opciones de compilaci√≥n del n√∫cleo despu√©s de leer esta publicaci√≥n.  Gracias a estos experimentos, puede aprender mucho en t√©rminos de comprender el trabajo de la mec√°nica de kernel de bajo nivel y la influencia de varios indicadores en su ensamblaje. <br><br><h3>  Ensamblaje de granos </h3><br>  El kernel de Linux es un gran programa que hace muchas cosas.  Incluso con una configuraci√≥n tan m√≠nima en equipos antiguos, puede llevar bastante tiempo ensamblarlo.  Por lo tanto, construya el n√∫cleo con el siguiente comando: <br><br><pre> <code class="xml hljs">make ARCH=um -j$(nproc)</code> </pre> <br>  Por qu√©  Este comando le indicar√° a nuestro ensamblador que use todos los n√∫cleos y subprocesos de procesador disponibles durante el proceso de compilaci√≥n.  El <code>$(nproc)</code> al final de Build sustituye la salida del <code>nproc</code> , que es parte de <code>coreutils</code> en la compilaci√≥n est√°ndar de Ubuntu. <br><br>  Despu√©s de un tiempo, nuestro n√∫cleo se compilar√° en un archivo ejecutable <code>./linux</code> . <br><br><h3>  Instalaci√≥n binaria </h3><br>  Como User Mode en Linux crea un binario regular, puede instalarlo como cualquier otra utilidad.  As√≠ es como lo hice: <br><br><pre> <code class="xml hljs">mkdir -p ~/bin cp linux ~/bin/linux</code> </pre> <br>  Tambi√©n vale la pena verificar que <code>~/bin</code> est√° en su <code>$PATH</code> : <br><br><pre> <code class="xml hljs">export PATH=$PATH:$HOME/bin</code> </pre> <br><h3>  Configurar el sistema de archivos invitado </h3><br>  Cree un directorio para el sistema de archivos invitado: <br><br><pre> <code class="xml hljs">mkdir -p $HOME/prefix/uml-demo cd $HOME/prefix</code> </pre><br>  Abra alpinelinux.org y en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la secci√≥n de descargas</a> encuentre el enlace actual para descargar <code>MINI ROOT FILESYSTEM</code> .  En el momento de escribir esto, era: <br><br><pre> <code class="xml hljs">http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-minirootfs-3.10.0-x86_64.tar.gz</code> </pre> <br>  Descargue este tarball usando wget: <br><br><pre> <code class="xml hljs">wget -O alpine-rootfs.tgz http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-minirootfs-3.10.0-x86_64.tar.gz</code> </pre> <br>  Ahora ingrese el directorio del sistema de archivos invitado y descomprima el archivo: <br><br><pre> <code class="xml hljs">cd uml-demo tar xf ../alpine-rootfs.tgz</code> </pre> <br>  Los pasos descritos crear√°n una peque√±a plantilla de sistema de archivos.  Debido a la naturaleza del sistema, la instalaci√≥n de paquetes a trav√©s del administrador Alpine apk ser√° extremadamente dif√≠cil.  Pero este FS ser√° suficiente para evaluar la idea general. <br><br>  Tambi√©n necesitamos la herramienta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tini</a> para suprimir el consumo de memoria por los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">procesos zombies de</a> nuestro n√∫cleo invitado. <br><br><pre> <code class="xml hljs">wget -O tini https://github.com/krallin/tini/releases/download/v0.18.0/tini-static chmod +x tini</code> </pre> <br><h3>  Crear una l√≠nea de comando del n√∫cleo </h3><br>  El n√∫cleo de Linux, como la mayor√≠a de los otros programas, tiene argumentos de l√≠nea de comandos a los que se puede acceder especificando el <code>--help</code> . <br><br><div class="spoiler">  <b class="spoiler_title">Sam - ayuda</b> <div class="spoiler_text"><pre> <code class="xml hljs">linux --help User Mode Linux v5.1.16 available at http://user-mode-linux.sourceforge.net/ --showconfig Prints the config file that this UML binary was generated from. iomem=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> Configure <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> as an IO memory region named <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>. mem=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">desired</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ram</span></span></span><span class="hljs-tag">&gt;</span></span> This controls how much "physical" memory the kernel allocates for the system. The size is specified as a number followed by one of 'k', 'K', 'm', 'M', which have the obvious meanings. This is not related to the amount of memory in the host. It can be more, and the excess, if it's ever used, will just be swapped out. Example: mem=64M --help Prints this message. debug this flag is not needed to run gdb on UML in skas mode root=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">containing</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">the</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">root</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fs</span></span></span><span class="hljs-tag">&gt;</span></span> This is actually used by the generic kernel in exactly the same way as in any other kernel. If you configure a number of block devices and want to boot off something other than ubd0, you would use something like: root=/dev/ubd5 --version Prints the version number of the kernel. umid=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> This is used to assign a unique identity to this UML machine and is used for naming the pid file and management console socket. con[0-9]*=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">&gt;</span></span> Attach a console or serial line to a host channel. See http://user-mode-linux.sourceforge.net/old/input.html for a complete description of this switch. eth[0-9]+=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transport</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">options</span></span></span><span class="hljs-tag">&gt;</span></span> Configure a network device. aio=2.4 This is used to force UML to use 2.4-style AIO even when 2.6 AIO is available. 2.4 AIO is a single thread that handles one request at a time, synchronously. 2.6 AIO is a thread which uses the 2.6 AIO interface to handle an arbitrary number of pending requests. 2.6 AIO is not available in tt mode, on 2.4 hosts, or when UML is built with /usr/include/linux/aio_abi.h not available. Many distributions don't include aio_abi.h, so you will need to copy it from a kernel tree to your /usr/include/linux in order to build an AIO-capable UML nosysemu Turns off syscall emulation patch for ptrace (SYSEMU). SYSEMU is a performance-patch introduced by Laurent Vivier. It changes behaviour of ptrace() and helps reduce host context switch rates. To make it work, you need a kernel patch for your host, too. See http://perso.wanadoo.fr/laurent.vivier/UML/ for further information. uml_dir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> The location to place the pid and umid files. quiet Turns off information messages during boot. hostfs=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span>,... This is used to set hostfs parameters. The root directory argument is used to confine all hostfs mounts to within the specified directory tree on the host. If this isn't specified, then a user inside UML can mount anything on the host that's accessible to the user that's running it. The only flag currently supported is 'append', which specifies that all files opened by hostfs will be opened in append mode.</code> </pre> <br></div></div><br>  Este banner ilumina las principales opciones de lanzamiento.  Ejecutemos el kernel con el conjunto m√≠nimo de opciones requeridas: <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ init=/bin/sh</code> </pre> <br>  Las l√≠neas anteriores le dicen a nuestro n√∫cleo lo siguiente: <br><br><ul><li>  Supongamos que el sistema de archivos ra√≠z es el pseudo dispositivo <code>/dev/root</code> . </li><li>  Elija <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hostfs</a> como el controlador del sistema de archivos ra√≠z. </li><li>  Monte el sistema de archivos invitado que creamos en el dispositivo ra√≠z. </li><li>  Y s√≠, en modo lectura-escritura. </li><li>  Use solo 64 megabytes de RAM (puede usar mucho menos, dependiendo de lo que planee hacer, pero 64 MB parece ser el tama√±o √≥ptimo). </li><li>  El kernel se inicia autom√°ticamente <code>/bin/sh</code> como un proceso de <code>init</code> . </li></ul><br>  Ejecute este comando y deber√≠a obtener algo como lo siguiente: <br><br><div class="spoiler">  <b class="spoiler_title">Otra hoja</b> <div class="spoiler_text"><pre> <code class="xml hljs">Core dump limits : soft - 0 hard - NONE Checking that ptrace can change system call numbers...OK Checking syscall emulation patch for ptrace...OK Checking advanced syscall emulation patch for ptrace...OK Checking environment variables for a tempdir...none found Checking if /dev/shm is on tmpfs...OK Checking PROT_EXEC mmap in /dev/shm...OK Adding 32137216 bytes to physical memory to account for exec-shield gap Linux version 5.1.16 (cadey@kahless) (gcc version 7.4.0 (Ubuntu 7.4.0-1ubuntu1~18.04.1)) #30 Sun Jul 7 18:57:19 UTC 2019 Built 1 zonelists, mobility grouping on. Total pages: 23898 Kernel command line: root=/dev/root rootflags=/home/cadey/dl/uml/alpine rootfstype=hostfs rw mem=64M init=/bin/sh Dentry cache hash table entries: 16384 (order: 5, 131072 bytes) Inode-cache hash table entries: 8192 (order: 4, 65536 bytes) Memory: 59584K/96920K available (2692K kernel code, 708K rwdata, 588K rodata, 104K init, 244K bss, 37336K reserved, 0K cma-reserved) SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=1, Nodes=1 NR_IRQS: 15 clocksource: timer: mask: 0xffffffffffffffff max_cycles: 0x1cd42e205, max_idle_ns: 881590404426 ns Calibrating delay loop... 7479.29 BogoMIPS (lpj=37396480) pid_max: default: 32768 minimum: 301 Mount-cache hash table entries: 512 (order: 0, 4096 bytes) Mountpoint-cache hash table entries: 512 (order: 0, 4096 bytes) Checking that host ptys support output SIGIO...Yes Checking that host ptys support SIGIO on close...No, enabling workaround devtmpfs: initialized random: get_random_bytes called from setup_net+0x48/0x1e0 with crng_init=0 Using 2.6 host AIO clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns futex hash table entries: 256 (order: 0, 6144 bytes) NET: Registered protocol family 16 clocksource: Switched to clocksource timer NET: Registered protocol family 2 tcp_listen_portaddr_hash hash table entries: 256 (order: 0, 4096 bytes) TCP established hash table entries: 1024 (order: 1, 8192 bytes) TCP bind hash table entries: 1024 (order: 1, 8192 bytes) TCP: Hash tables configured (established 1024 bind 1024) UDP hash table entries: 256 (order: 1, 8192 bytes) UDP-Lite hash table entries: 256 (order: 1, 8192 bytes) NET: Registered protocol family 1 console [stderr0] disabled mconsole (version 2) initialized on /home/cadey/.uml/tEwIjm/mconsole Checking host MADV_REMOVE support...OK workingset: timestamp_bits=62 max_order=14 bucket_order=0 Block layer SCSI generic (bsg) driver version 0.4 loaded (major 254) io scheduler noop registered (default) io scheduler bfq registered loop: module loaded NET: Registered protocol family 17 Initialized stdio console driver Using a channel type which is configured out of UML setup_one_line failed for device 1 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 2 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 3 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 4 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 5 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 6 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 7 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 8 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 9 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 10 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 11 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 12 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 13 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 14 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 15 : Configuration failed Console initialized on /dev/tty0 console [tty0] enabled console [mc-1] enabled Failed to initialize ubd device 0 :Couldn't determine size of device's file VFS: Mounted root (hostfs filesystem) on device 0:11. devtmpfs: mounted This architecture does not have kernel memory protection. Run /bin/sh as init process /bin/sh: can't access tty; job control turned off random: fast init done / #</code> </pre> <br></div></div><br>  Manipular lo anterior nos dar√° un <b>sistema de invitado como m√≠nimo</b> , sin elementos como <code>/proc</code> o un nombre de host asignado.  Por ejemplo, pruebe los siguientes comandos: <br><br> <code>- uname -av <br> - cat /proc/self/pid <br> - hostname</code> <br> <br>  Para salir del sistema invitado, escriba <code>exit</code> o presione control-d.  Esto disparar√° el shell seguido de kernel panic: <br><br><pre> <code class="xml hljs">/ # exit Kernel panic - not syncing: Attempted to kill init! exitcode=0x00000000 fish: ‚Äú./linux root=/dev/root rootflag‚Ä¶‚Äù terminated by signal SIGABRT (Abort)</code> </pre> <br>  Tenemos este kernel panic porque el kernel de Linux cree que el proceso de inicializaci√≥n siempre se est√° ejecutando.  Sin √©l, el sistema ya no puede funcionar y se apaga.  Pero dado que este es un proceso en modo de usuario, el resultado se env√≠a a <code>SIGABRT</code> , que conduce a la salida. <br><br><h3>  Configuraci√≥n de red de invitado </h3><br>  Y aqu√≠, en nosotros, todo comienza a ir no seg√∫n el plan.  La red en modo de usuario Linux es donde todo el concepto de un "modo de usuario" limitado comienza a desmoronarse.  Despu√©s de todo, generalmente a nivel del sistema, la red se limita a modos de ejecuci√≥n <b>privilegiados</b> por razones claras. <br><br>  <i>Nota</i>  <i>trans .: puede leer m√°s sobre las diferentes opciones para trabajar con la red en UML <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .</i> <br><br><h3>  Viaja a slirp </h3><br>  Sin embargo, existe una herramienta antigua y casi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">incompatible</a> llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Slirp</a> , con la cual el Modo de usuario Linux puede interactuar con la red.  Funciona m√°s o menos como una pila TCP / IP a nivel de usuario y no requiere ning√∫n permiso del sistema para ejecutarse.  Esta herramienta fue <b>lanzada en 1995</b> , y la √∫ltima actualizaci√≥n data de <b>2006</b> .  Slirp es muy viejo.  Durante un tiempo sin soporte ni actualizaciones, los compiladores han llegado tan lejos que ahora esta herramienta solo puede describirse como una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"descomposici√≥n de c√≥digo"</a> . <br><br>  Entonces, pasemos Slirp desde los repositorios de Ubuntu e intentemos ejecutarlo: <br><br><pre> <code class="xml hljs">sudo apt-get install slirp /usr/bin/slirp Slirp v1.0.17 (BETA) Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500, 115200 baud] SLiRP Ready ... fish: ‚Äú/usr/bin/slirp‚Äù terminated by signal SIGSEGV (Address boundary error)</code> </pre> <br>  Oh dioses  Instalemos un depurador para Slirp y veamos si podemos descubrir qu√© est√° pasando aqu√≠: <br><br><pre> <code class="xml hljs">sudo apt-get install gdb slirp-dbgsym gdb /usr/bin/slirp GNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git Copyright (C) 2018 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">licenses</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gpl.html</span></span></span><span class="hljs-tag">&gt;</span></span> This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type "show copying" and "show warranty" for details. This GDB was configured as "x86_64-linux-gnu". Type "show configuration" for configuration details. For bug reporting instructions, please see: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">software</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gdb</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bugs</span></span></span><span class="hljs-tag">/&gt;</span></span>. Find the GDB manual and other documentation resources online at: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">software</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gdb</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">documentation</span></span></span><span class="hljs-tag">/&gt;</span></span>. For help, type "help". Type "apropos word" to search for commands related to "word"... Reading symbols from /usr/bin/slirp...Reading symbols from /usr/lib/debug/.build-id/c6/2e75b69581a1ad85f72ac32c0d7af913d4861f.debug...done. done. (gdb) run Starting program: /usr/bin/slirp Slirp v1.0.17 (BETA) Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500, 115200 baud] SLiRP Ready ... Program received signal SIGSEGV, Segmentation fault. ip_slowtimo () at ip_input.c:457 457 ip_input.c: No such file or directory.</code> </pre> <br>  El error late en <a href="">esta l√≠nea</a> .  Echemos un vistazo a stacktrace, tal vez algo nos ayudar√° all√≠: <br><br><pre> <code class="xml hljs">(gdb) bt full #0 ip_slowtimo () at ip_input.c:457 fp = 0x55784a40 #1 0x000055555556a57c in main_loop () at ./main.c:980 so = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> so_next = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> timeout = {tv_sec = 0, tv_usec = 0} ret = 0 nfds = 0 ttyp = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> ttyp2 = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> best_time = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> tmp_time = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> #2 0x000055555555b116 in main (argc=1, argv=0x7fffffffdc58) at ./main.c:95 No locals.</code> </pre> <br>  Aqu√≠ vemos que ocurre una falla durante el inicio del bucle principal, cuando slirp intenta verificar los tiempos de espera.  En este punto, tuve que renunciar a tratar de depurar.  Pero veamos si Slirp compilado de alg√∫n tipo funciona.  Recargu√© el archivo directamente desde el sitio web de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sourceforge</a> , porque arrastrar algo desde all√≠ a trav√©s de la l√≠nea de comando es un dolor: <br><br><pre> <code class="xml hljs">cd ~/dl wget https://xena.greedo.xeserv.us/files/slirp-1.0.16.tar.gz tar xf slirp-1.0.16.tar.gz cd slirp-1.0.16/src ./configure --prefix=$HOME/prefix/slirp make</code> </pre> <br>  Aqu√≠ vemos alertas sobre funciones incorporadas indefinidas, es decir, sobre la imposibilidad de vincular el archivo binario resultante.  Parece que entre 2006 y este momento, gcc dej√≥ de crear caracteres utilizados en las funciones integradas de archivos compilados intermedios.  Intentemos reemplazar la <code>inline</code> con un comentario vac√≠o y veamos el resultado: <br><br><pre> <code class="xml hljs">vi slirp.h :6 a <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">enter</span></span></span><span class="hljs-tag">&gt;</span></span> #define inline /**/ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">escape</span></span></span><span class="hljs-tag">&gt;</span></span> :wq make</code> </pre> <br>  No  Esto tampoco funciona.  A√∫n no puede encontrar los caracteres para estas funciones. <br><br>  En este punto, me di por vencido y comenc√© a buscar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">paquetes de compilaci√≥n de Heroku</a> en Github.  Mi teor√≠a se bas√≥ en el hecho de que algunos paquetes de compilaci√≥n de Heroku contendr√°n los archivos binarios que necesito.  Como resultado, la b√∫squeda me llev√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Descargu√© y desempaqu√© <code>uml.tar.gz</code> y encontr√© lo siguiente: <br><br><pre> <code class="xml hljs">total 6136 -rwxr-xr-x 1 cadey cadey 79744 Dec 10 2017 ifconfig* -rwxr-xr-x 1 cadey cadey 373 Dec 13 2017 init* -rwxr-xr-x 1 cadey cadey 149688 Dec 10 2017 insmod* -rwxr-xr-x 1 cadey cadey 66600 Dec 10 2017 route* -rwxr-xr-x 1 cadey cadey 181056 Jun 26 2015 slirp* -rwxr-xr-x 1 cadey cadey 5786592 Dec 15 2017 uml* -rwxr-xr-x 1 cadey cadey 211 Dec 13 2017 uml_run*</code> </pre> <br>  Este es un archivo slirp binario!  ¬øEl trabaja? <br><br><pre> <code class="xml hljs">./slirp Slirp v1.0.17 (BETA) FULL_BOLT Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500] SLiRP Ready ...</code> </pre><br>  No se bloquea, ¬°as√≠ que deber√≠a funcionar!  Enganchemos este binario a <code>~/bin/slirp</code> : <br><br><pre> <code class="xml hljs">cp slirp ~/bin/slirp</code> </pre> <br>  En caso de que el creador del paquete lo elimine, hice <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un espejo</a> . <br><br><h3>  Configuraci√≥n de red </h3><br>  Ahora configuremos la red en nuestro n√∫cleo de invitados.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Actualizar opciones de inicio</a> : <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ eth0=slirp,,$HOME/bin/slirp \ init=/bin/sh</code> </pre> <br>  Ahora encienda la red: <br><br><pre> <code class="xml hljs">mount -t proc proc proc/ mount -t sysfs sys sys/ ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 route add default gw 10.0.2.2</code> </pre> <br>  Los dos primeros comandos de configuraci√≥n <code>/proc</code> y <code>/sys</code> necesarios para que <code>ifconfig</code> funcione, lo que configura una interfaz de red para comunicarse con Slirp.  El comando de <code>route</code> configura una tabla de enrutamiento del n√∫cleo para forzar todo el tr√°fico a trav√©s del t√∫nel Slirp.  Verifiquemos esto con una consulta DNS: <br><br><pre> <code class="xml hljs">nslookup google.com 8.8.8.8 Server: 8.8.8.8 Address 1: 8.8.8.8 dns.google Name: google.com Address 1: 172.217.12.206 lga25s63-in-f14.1e100.net Address 2: 2607:f8b0:4006:81b::200e lga25s63-in-x0e.1e100.net</code> </pre> <br>  Funciona! <br><br>  <i>Nota: Aparentemente, la publicaci√≥n original se escribi√≥ en el escritorio con una tarjeta de red con cable o alguna otra configuraci√≥n que no requiera controladores adicionales.</i>  <i>En una computadora port√°til con WiFi 8265 de Intel, cuando eleva la red, se produce un error</i> <br><br><pre> <code class="bash hljs">/ <span class="hljs-comment"><span class="hljs-comment"># ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 slirp_tramp failed - errno = 2 ifconfig: ioctl 0x8914 failed: No such file or directory / #</span></span></code> </pre> <br>  <i>Aparentemente, el n√∫cleo no puede comunicarse con el controlador de red.</i>  <i>Lamentablemente, un intento de compilar firmware en el kernel no solucion√≥ la situaci√≥n.</i>  <i>En el momento de la publicaci√≥n, no era posible encontrar una soluci√≥n en esta configuraci√≥n particular.</i>  <i>En configuraciones m√°s simples (por ejemplo, en Virtualbox) la interfaz se eleva correctamente.</i> <br><br>  Automaticemos la redirecci√≥n utilizando el siguiente script de shell: <br><br><pre> <code class="xml hljs">#!/bin/sh # init.sh mount -t proc proc proc/ mount -t sysfs sys sys/ ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 route add default gw 10.0.2.2 echo "networking set up" exec /tini /bin/sh</code> </pre> <br>  Y m√°rquelo como ejecutable: <br><br><pre> <code class="xml hljs">chmod +x init.sh</code> </pre> <br>  Y luego realice cambios en la l√≠nea de comando del kernel: <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ eth0=slirp,,$HOME/bin/slirp \ init=/init.sh</code> </pre><br>  Y repito: <br><br><pre> <code class="xml hljs">SLiRP Ready ... networking set up /bin/sh: can't access tty; job control turned off nslookup google.com 8.8.8.8 Server: 8.8.8.8 Address 1: 8.8.8.8 dns.google Name: google.com Address 1: 172.217.12.206 lga25s63-in-f14.1e100.net Address 2: 2607:f8b0:4004:800::200e iad30s09-in-x0e.1e100.net</code> </pre> <br>  ¬°La red es estable! <br><br><h3> - </h3><br>       ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dockerfile</a> ,           .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> ,    ,    .   ,       . <br><br><hr><br>  ,      ,    .  - ,          ,    User Mode  Linux       .                .     Docker ‚Äî    tar-,         <code>docker export</code> ,            . ,    shell-. <br><br>   Rkeene  #lobsters  Freenode.      Slirp      .    ,    Slackware    slirp,    Ubuntu  Alpine   slirp    Rkeene .     ,      -. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459558/">https://habr.com/ru/post/459558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459542/index.html">Mec√°nica de gamificaci√≥n: √°rbol de habilidades</a></li>
<li><a href="../459544/index.html">¬øPor qu√© la serie de Chernobyl describi√≥ tan mal la energ√≠a nuclear?</a></li>
<li><a href="../459550/index.html">Backup, Parte 5: Prueba de Bacula y Veeam Backup para Linux</a></li>
<li><a href="../459552/index.html">C√≥mo perder el acceso al sistema en vivo simplemente buscando el c√≥digo fuente</a></li>
<li><a href="../459554/index.html">Realice un seguimiento de los cambios de archivos con Alerting OpenDistro for Elasticsearch</a></li>
<li><a href="../459560/index.html">Capacidades de los centros de datos de contenedores: centro de conmutaci√≥n listo para usar en Myanmar en 50 d√≠as</a></li>
<li><a href="../459562/index.html">Programaci√≥n diferenciable</a></li>
<li><a href="../459564/index.html">Lo que los desarrolladores necesitan saber sobre negocios</a></li>
<li><a href="../459568/index.html">Letra vertical en TI moderna</a></li>
<li><a href="../459570/index.html">Beeline muestra anuncios al robot de Google. Bot infeliz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>