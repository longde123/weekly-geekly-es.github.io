<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçæ üêÅ üíª Actualizaci√≥n de la base de datos y despliegue de tiempo de inactividad cero üëàüèº ü§∑üèª üë©üèæ‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se han escrito muchos art√≠culos sobre la actualizaci√≥n de sistemas sobre la marcha sin detenerlos (implementaci√≥n de tiempo de inactividad cero) y muc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Actualizaci√≥n de la base de datos y despliegue de tiempo de inactividad cero</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423429/">  Se han escrito muchos art√≠culos sobre la actualizaci√≥n de sistemas sobre la marcha sin detenerlos (implementaci√≥n de tiempo de inactividad cero) y muchos aspectos de este enfoque son bastante obvios.  En mi opini√≥n, la parte m√°s dif√≠cil de la implementaci√≥n en este caso es actualizar los almacenes de datos si su contrato (esquema) ha cambiado.  Es este aspecto el que me gustar√≠a considerar en este art√≠culo. <br><a name="habracut"></a><br>  Cualquiera que sea la base de datos, con un esquema de datos expl√≠cito como relacional o con uno arbitrario como NoSQL, el esquema de datos todav√≠a est√° presente, incluso a nivel de aplicaci√≥n.  Los datos le√≠dos de la base de datos deben ser entendibles para el cliente, incluso si el repositorio en s√≠ no impone ninguna restricci√≥n en su estructura. <br><br>  Supongamos que un sistema con una estructura de datos espec√≠fica y terabytes de datos en la base de datos ya se est√° ejecutando en producci√≥n.  En la nueva versi√≥n del sistema, necesitamos cambiar ligeramente la estructura para implementar nuevas funciones o mejorar el rendimiento.  Considere qu√© cambios en el circuito pueden ocurrir: <br><br><ul><li>  Agregar un nuevo campo </li><li>  Borrado de campo </li><li>  Renombrar campo </li><li>  Cambios de tipo de campo </li><li>  Transferencia de un campo a otra estructura de datos (por ejemplo, en el caso de desnormalizaci√≥n) </li></ul><br>  Agregar un nuevo campo as√≠ como agregar cualquier otro objeto de base de datos es un cambio compatible con versiones anteriores y no requiere ning√∫n paso adicional en t√©rminos de implementaci√≥n de implementaci√≥n de tiempo de inactividad cero (con una advertencia: si este nuevo campo u objeto no depende funcionalmente de otros ya almacenados en la base de datos) datos).  Simplemente aplique los cambios a la base de datos sobre la marcha y luego implemente una nueva versi√≥n del c√≥digo que use los nuevos objetos de la base de datos. <br><br>  Eliminar un campo o cualquier otro objeto de la base de datos no es un cambio compatible con versiones anteriores, pero el enfoque para su implementaci√≥n es muy simple: los objetos innecesarios de la base de datos deben eliminarse solo despu√©s de que la nueva versi√≥n del sistema est√© completamente bloqueada. <br><br>  Los otros tres tipos de cambios son m√°s complejos en t√©rminos de proporcionar una implementaci√≥n de tiempo de inactividad cero.  En general, todos se pueden realizar copiando datos a otros campos / entidades y eliminando los "antiguos" despu√©s de una migraci√≥n de datos exitosa: para cambiar el nombre, puede copiar datos del campo antiguo a un campo con un nombre nuevo, luego eliminar el campo antiguo, cambiar el tipo de datos se puede hacer junto con renombrar, etc.  De una forma u otra, durante un per√≠odo de tiempo, la base de datos debe admitir contratos antiguos y nuevos.  Hay al menos dos formas de hacer tales cambios sobre la marcha: <br><br><h3>  Si la base de datos admite desencadenantes </h3><br><ol><li>  Cree disparadores que copien datos del lugar anterior al nuevo en cualquier cambio / adici√≥n y config√∫relos en producci√≥n. </li><li>  Aplique una utilidad de conversi√≥n de datos que haga lo mismo, pero para todos los registros de la base de datos.  Como los disparadores ya est√°n instalados, la utilidad no puede hacer nada m√°s complicado que una simple actualizaci√≥n "ficticia" de cada registro (tabla ACTUALIZAR SET campo = campo ...).  Un punto muy importante aqu√≠ es que la acci√≥n de leer datos del lugar antiguo y escribir en el nuevo debe ser at√≥mica y protegida de los cambios perdidos.  Dependiendo de la estructura de la base de datos, puede usar el bloqueo pesimista mediante SELECT FOR UPDATE o sus an√°logos, u optimista si la tabla tiene un campo con una versi√≥n de registro. </li><li>  Una vez que la utilidad finaliza su trabajo (dependiendo de la cantidad de datos y la complejidad de la actualizaci√≥n, el tiempo de ejecuci√≥n puede tardar d√≠as), ya es posible instalar una nueva versi√≥n del sistema que admita el nuevo esquema de datos.  En este punto, todos los registros en la base de datos que exist√≠an en el momento en que se lanz√≥ la utilidad se convertir√°n con √©xito, y todos los nuevos que aparecieron durante su operaci√≥n tambi√©n se convertir√°n por disparadores. </li><li>  Elimine los desencadenantes y todos los campos (u otros objetos de la base de datos) que ya no sean necesarios. </li></ol><br><h3>  Si no es posible usar disparadores (como es el caso con muchas soluciones NoSQL) </h3><br><img src="https://habrastorage.org/webt/y2/09/6c/y2096cri-hcwq7p5caokazzy6dq.png"><br><br><ol><li>  Cree e implemente una nueva versi√≥n de la aplicaci√≥n (versi√≥n temporal 1 en la figura), que siempre lee del campo anterior, pero al escribir en este campo, actualiza tanto el lugar antiguo como el nuevo correspondiente (en la figura "C" - la antigua, "H" - nuevo)  Zadeplit esta versi√≥n a todos los nodos en los que se ejecutan las instancias de la aplicaci√≥n. </li><li>  Aplique una utilidad que copie datos de la ubicaci√≥n anterior a la nueva.  Al igual que con los desencadenantes, debe tomar medidas para evitar cambios perdidos. </li><li>  Cree y, una vez completada la utilidad, instale otra versi√≥n de la aplicaci√≥n (versi√≥n temporal 2), que lee los datos de un nuevo campo, pero a√∫n escribe en dos lugares.  Este paso es necesario, ya que durante la actualizaci√≥n secuencial de cada uno de los nodos todav√≠a habr√° una brecha cuando las instancias de la versi√≥n anterior de la aplicaci√≥n que lee el campo antiguo funcionen simult√°neamente con el nuevo. </li><li>  Cree y, al final del barrido completo de la versi√≥n anterior, implemente la versi√≥n final, que ya no interact√∫a con el campo anterior. </li><li>  Eliminar viejos campos. </li></ol><br>  El segundo enfoque requiere la creaci√≥n e instalaci√≥n de tres versiones diferentes de la aplicaci√≥n, lo que puede ser muy inc√≥modo y engorroso.  En su lugar, puede usar la funci√≥n de alternancia: para poner la l√≥gica de las tres versiones en una sola, pero cambie el modo seg√∫n el par√°metro de configuraci√≥n, que idealmente podr√≠a cambiarse sobre la marcha.  Por lo tanto, en lugar de instalar cada versi√≥n posterior, ser√° suficiente cambiar el valor del par√°metro (y reiniciar el servicio si no se proporciona la actualizaci√≥n sobre la marcha).  Despu√©s de completar con √©xito la instalaci√≥n de la versi√≥n final, todo el c√≥digo relacionado con garantizar la migraci√≥n de datos debe eliminarse por completo de la rama de trabajo, incluso si se "activa" en la producci√≥n hasta la pr√≥xima actualizaci√≥n del sistema. <br><br>  Es f√°cil notar que garantizar un tiempo de inactividad cero al actualizar el sistema es un procedimiento engorroso y fr√°gil, por lo que tiene sentido molestarse con √©l solo si existe un requisito correspondiente de la empresa.  Pero incluso si los requisitos para la disponibilidad del sistema son bastante bajos (por ejemplo, 99% por a√±o y la ventana para la actualizaci√≥n planificada del sistema es de 24 horas), la conversi√≥n de datos requerida para instalar la nueva versi√≥n a√∫n puede demorar m√°s.  Por lo tanto, debe estar preparado de antemano para el uso de tales soluciones si planea almacenar grandes cantidades de datos. <br><br>  Un enfoque alternativo puede ser el rechazo intencional de cambios retrocompatibles en el esquema de la base de datos, pero, desafortunadamente, en la pr√°ctica no siempre es posible, ya que a menudo la forma m√°s efectiva de mejorar el rendimiento del acceso a los datos es reestructurar el esquema. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423429/">https://habr.com/ru/post/es423429/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423419/index.html">Cliente HTML5 para VMware vSphere que saldr√° este oto√±o: lo que necesita saber</a></li>
<li><a href="../es423421/index.html">¬øPor qu√© la hierba era m√°s verde para indie?</a></li>
<li><a href="../es423423/index.html">Curso MIT "Seguridad de sistemas inform√°ticos". Lecci√≥n 8: Modelo de seguridad de red, parte 3</a></li>
<li><a href="../es423425/index.html">Old school: cu√°les fueron los juegos que salieron: hablamos de medios inusuales</a></li>
<li><a href="../es423427/index.html">IndieVisible es una comunidad indie en l√≠nea de c√≥digo abierto</a></li>
<li><a href="../es423431/index.html">Profundidades SIEM: correlaciones listas para usar. Parte 1: ¬ømarketing puro o un problema sin soluci√≥n?</a></li>
<li><a href="../es423437/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 270 (del 10 al 16 de septiembre)</a></li>
<li><a href="../es423439/index.html">Informe del Club de Roma 2018, Cap√≠tulo 2.6: "Errores filos√≥ficos de la doctrina del mercado"</a></li>
<li><a href="../es423441/index.html">Primer enlace para Exonum: por qu√© elegimos Java</a></li>
<li><a href="../es423445/index.html">Crear una estructura de tienda en l√≠nea: esquema de categor√≠a</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>