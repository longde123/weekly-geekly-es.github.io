<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂üèΩ üé¶ üíª Automatizaci√≥n para los m√°s peque√±os. Segunda parte Dise√±o de red üõåüèæ üëç ‚õìÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En los primeros dos art√≠culos, plante√© el tema de la automatizaci√≥n y esboc√© su marco, en el segundo hice una digresi√≥n sobre la virtualizaci√≥n de la ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatizaci√≥n para los m√°s peque√±os. Segunda parte Dise√±o de red</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475614/">  En los primeros dos art√≠culos, plante√© el tema de la automatizaci√≥n y esboc√© su marco, en el segundo hice una digresi√≥n sobre la virtualizaci√≥n de la red, como el primer enfoque para automatizar la configuraci√≥n de los servicios. <br>  Y ahora es el momento de dibujar un diagrama de red f√≠sica. <br><br>  Si no est√° muy cerca del dispositivo de las redes de centros de datos, le recomiendo comenzar con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo sobre ellas</a> . <br><br>  Todos los problemas: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">0. ADSM.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte Cero.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Planificacion</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1. ADSM.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Primera parte (que es despu√©s de cero).</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Virtualizaci√≥n de red</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2. ADSM.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Segunda parte</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dise√±o de red</a> </li></ul><br>  Las pr√°cticas descritas en esta serie deber√≠an ser aplicables a una red de cualquier tipo, cualquier escala, con cualquier variedad de proveedores (no).  Sin embargo, no se puede describir un ejemplo universal de la aplicaci√≥n de estos enfoques.  Por lo tanto, me enfocar√© en la arquitectura moderna de la red DC: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Klose Factory</a> . <br>  DCI lo har√° en MPLS L3VPN. <br><br>  Una red Overlay del host se ejecuta sobre la red f√≠sica (puede ser OpenStack VXLAN o Tungsten Fabric o cualquier otra cosa que requiera solo conectividad IP b√°sica de la red). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e13/b5a/aa8/e13b5aaa8e2c2161e75084de878ed741.jpg" width="600"></a> <br><br>  En este caso, obtenemos un escenario relativamente simple para la automatizaci√≥n, porque tenemos muchos equipos configurados de la misma manera. <br><br>  Elegiremos un DC esf√©rico en el vac√≠o: <br><br><ul><li>  Una versi√≥n del dise√±o est√° en todas partes. </li><li>  Dos vendedores que forman dos planos de la red. </li><li>  Un DC es como otro como dos gotas de agua. </li></ul><br><hr><br><a name="habracut"></a><br><h1>  Contenido </h1><br><ul><li>  <b>Topolog√≠a f√≠sica</b> </li><li>  <b>Enrutamiento</b> </li><li>  <b>Plan de propiedad intelectual</b> </li><li>  <b>Laba</b> </li><li>  <b>Conclusi√≥n</b> </li><li>  <b>Enlaces utiles</b> </li></ul><br>  Deje que nuestro proveedor de servicios LAN_DC, por ejemplo, organice videos de capacitaci√≥n sobre la supervivencia en ascensores atascados. <br><br>  En las megaciudades, esto es muy popular, por lo que hay muchas m√°quinas f√≠sicas. <br><br>  Primero, describir√© la red aproximadamente como me gustar√≠a verla.  Y luego lo simplificar√© para el laboratorio. <br><br><hr><br><br><h1>  Topolog√≠a f√≠sica </h1><br><h2>  Localizaciones </h2><br>  LAN_DC tendr√° 6 DC: <br><ul><li>  Rusia ( <b>RU</b> ): <br><ul><li>  Mosc√∫ ( <b>msk</b> ) </li><li>  Kaz√°n ( <b>kzn</b> ) </li></ul><br></li><li>  Espa√±a ( <b>SP</b> ): <br><ul><li>  Barcelona ( <b>bcn</b> ) </li><li>  M√°laga ( <b>mlg</b> ) </li></ul><br></li><li>  China ( <b>CN</b> ): <br><ul><li>  Shangai ( <b>sha</b> ) </li><li>  Xi'an ( <b>sia</b> ) </li></ul><br></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/c79/5f3/6f3/c795f36f3eb1553eaf32f909d570ed16.png" width="800"><br><hr><br><br><h2>  DC interior (Intra-DC) </h2><br>  En todos los DC, redes de conectividad interna id√©nticas basadas en la topolog√≠a de Clos. <br>  ¬øQu√© tipo de redes son Klose y por qu√© est√°n en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> separado? <br><br>  En cada DC hay 10 bastidores con autom√≥viles, se numerar√°n como <b>A</b> , <b>B</b> , <b>C</b> , etc. <br><br>  Cada estante tiene 30 autos.  No nos interesar√°n. <br><br>  Adem√°s, en cada bastidor hay un interruptor al que est√°n conectadas todas las m√°quinas; este es <b>el interruptor de la parte superior del bastidor: ToR</b> o, en t√©rminos de la f√°brica de Klose, lo llamaremos <b>Leaf</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3a/5da/d17/e3a5dad17c7aadf1cf95865deaa8e359.png" width="800"><br>  <i>El esquema general de la f√°brica.</i> <br><br>  Los denominaremos <i><b>XXX</b> -leaf <b>Y</b></i> , donde <b>XXX</b> es la abreviatura de tres letras DC, e <b>Y</b> es el n√∫mero de serie.  Por ejemplo, <i>kzn-leaf11</i> . <br><blockquote>  En los art√≠culos me permito usar los t√©rminos Leaf y ToR de manera bastante fr√≠vola, como sin√≥nimos.  Sin embargo, uno debe recordar que esto no es as√≠. <br>  ToR es un interruptor montado en bastidor al que se conectan las m√°quinas. <br>  Leaf es el papel de un dispositivo en una red f√≠sica o un conmutador de primer nivel en t√©rminos de topolog√≠a de Clos. <br>  Es decir, Leaf! = ToR. <br>  Entonces Leaf puede ser un interruptor EndofRaw, por ejemplo. <br>  Sin embargo, dentro del marco de este art√≠culo, nos referiremos a ellos como sin√≥nimos. <br></blockquote>  Cada interruptor ToR est√° conectado a su vez a cuatro interruptores de agregaci√≥n aguas arriba: <b>columna vertebral</b> .  Bajo Spine'y asign√≥ un bastidor en el DC.  Lo <i>nombraremos de</i> la misma manera: <i><b>XXX</b> -spine <b>Y.</b></i> <br><br>  En el mismo bastidor habr√° equipos de red para la conectividad entre DC - 2 enrutadores con MPLS a bordo.  Pero en general, estos son los mismos ToR.  Es decir, desde el punto de vista de los interruptores de columna, no importa si hay un ToR habitual con m√°quinas conectadas o un enrutador para DCI: una cosa maldita. <br><br>  Tales ToR especiales se denominan <b>Edge-leaf</b> .  Los llamaremos <i><b>XXX-</b> edge <b>Y.</b></i> <br><br>  Se ver√° as√≠. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62c/83f/d27/62c83fd278227f1740e5cf4e64eaed4e.png" width="800"><br><br>  En el diagrama sobre el borde y la hoja que realmente puse en el mismo nivel.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Las redes cl√°sicas de tres niveles</a> nos han ense√±ado a considerar el enlace ascendente (el t√©rmino es en realidad de aqu√≠), como enlaces ascendentes.  Y aqu√≠ resulta que el "enlace ascendente" de DCI vuelve a bajar, lo que rompe un poco la l√≥gica habitual.  En el caso de redes grandes, cuando los centros de datos se dividen en unidades m√°s peque√±as: <b>POD</b> (Punto de entrega), se asignan <b>Edge-POD</b> separados para DCI y acceso a redes externas. <br><br>  Por conveniencia, en el futuro a√∫n dibujar√© Edge on Spine, mientras tenemos en cuenta que no hay inteligencia sobre Spine y diferencias al trabajar con Leaf y Edge-leaf ordinarios (aunque puede haber matices, pero en general es as√≠) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca5/67d/9db/ca567d9db0c49c3baf63304443477102.png" width="600"><br>  <i>Dise√±o de f√°brica con hojas de borde.</i> <br><br>  Trinity Leaf, Spine y Edge forman una red o f√°brica de Underlay. <br><br>  La tarea de la f√°brica de red (leer Underlay), como ya hemos determinado en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">n√∫mero anterior</a> , es muy, muy simple: proporcionar conectividad IP entre m√°quinas tanto dentro de la misma DC como entre ellas. <br>  Es por eso que la red se llama f√°brica, al igual que, por ejemplo, una f√°brica de conmutaci√≥n dentro de cajas de red modular, que se puede encontrar con m√°s detalle en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SDSM14</a> . <br><blockquote>  En general, dicha topolog√≠a se denomina f√°brica, porque la tela en traducci√≥n es una tela.  Y es dif√≠cil no estar de acuerdo: <br><img src="https://habrastorage.org/getpro/habr/post_images/7e9/db7/2c3/7e9db72c353e6b5b050eb63de72bb111.png" width="300"><br></blockquote><br>  F√°brica completamente L3.  Sin VLAN, sin transmisi√≥n: estos son excelentes programadores en LAN_DC, pueden escribir aplicaciones que viven en el paradigma L3, y las m√°quinas virtuales no requieren Live Migration para guardar la direcci√≥n IP. <br><br>  Y de nuevo: la respuesta a la pregunta por qu√© la f√°brica y por qu√© L3 - en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> separado. <br><hr><br><br><h2>  DCI - Interconexi√≥n del centro de datos (Inter-DC) </h2><br>  DCI se organizar√° utilizando Edge-Leaf, es decir, son nuestro punto de salida a la autopista. <br>  Para simplificar, asumimos que los DC est√°n conectados por enlaces directos. <br>  Excluimos la conectividad externa de la consideraci√≥n. <br><blockquote>  Soy consciente de que cada vez que elimino un componente, simplifico enormemente la red.  Y con la automatizaci√≥n de nuestra red abstracta, todo estar√° bien, pero aparecer√°n muletas en la red real. <br>  Eso es asi.  Sin embargo, el objetivo de esta serie es pensar y trabajar en enfoques, y no resolver heroicamente problemas imaginarios. <br></blockquote><br>  En Edge-Leafs, la capa subyacente se coloca en la VPN y se transmite a trav√©s de la red troncal MPLS (el mismo enlace directo). <br><br>  Aqu√≠ hay un esquema de alto nivel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4e/ad7/b78/e4ead7b7898490c29fa93f7375376aa8.png" width="800"><br><br><hr><br><br><h1>  Enrutamiento </h1><br><br>  Para el enrutamiento dentro de DC usaremos BGP. <br>  En OSPF + LDP MPLS Trunk <br>  Para DCI, es decir, la organizaci√≥n de la conectividad en la parte inferior es BGP L3VPN sobre MPLS. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a55/3b1/30b/a553b130b286a50fd1c97fe8bb2b5b5b.png" width="800"><br>  <i>Esquema general de enrutamiento</i> <br><br>  No hay OSPF e ISIS en la f√°brica (el protocolo de enrutamiento est√° prohibido en la Federaci√≥n de Rusia). <br><br>  Y esto significa que no habr√° Autodescubrimiento y c√°lculos de ruta m√°s corta, solo configuraciones de protocolo, vecindad y pol√≠ticas manuales (de hecho autom√°ticas, estamos aqu√≠ sobre la automatizaci√≥n). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82b/426/251/82b4262513aeae7c12d6e1618182f272.png" width="600"><br>  <i>Esquema de enrutamiento BGP dentro del DC</i> <br><br>  <b>¬øPor qu√© BGP?</b> <br><br>  Hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un RFC completo</a> llamado Facebook y Arista sobre este tema, que explica c√≥mo construir redes <b>muy grandes</b> de centros de datos utilizando BGP.  Se lee casi como un arte, muy recomendable para una noche l√°nguida. <br><br>  Y toda una secci√≥n de mi art√≠culo est√° dedicada a esto.  ¬øA d√≥nde te estoy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enviando?</a> <br><br>  Pero a√∫n as√≠, en resumen, ning√∫n IGP es adecuado para redes de grandes centros de datos, donde cuentan miles de dispositivos de red. <br><br>  Adem√°s, el uso de BGP en todas partes le permite no rociar el soporte de varios protocolos diferentes y la sincronizaci√≥n entre ellos. <br><blockquote>  Mano a mano, en nuestra f√°brica, que con un alto grado de probabilidad no crecer√° r√°pidamente, OSPF ser√≠a suficiente para los ojos.  Estos son en realidad los problemas de los megaescalers y los titanes en la nube.  Pero imaginemos algunos problemas que necesitamos, y usaremos BGP, como leg√≥ Peter Lapukhov. <br></blockquote><br><hr><br><br><h2>  Pol√≠ticas de enrutamiento </h2><br>  En los conmutadores Leaf, importamos en prefijos BGP desde interfaces Underlay con redes. <br>  Tendremos una sesi√≥n de BGP entre <b>cada</b> par Leaf-Spine en el que estos prefijos de Underlay se anunciar√°n en una red de charcos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85a/4b0/38d/85a4b038dc57c9fc54f1fb1ad10a5172.png" width="800"><br><br>  Dentro de un centro de datos, distribuiremos los detalles que se importaron a ToRe.  En Edge-Leafs los agregaremos y anunciaremos en DC remotos y los reduciremos a ToR.  Es decir, cada ToR sabr√° exactamente c√≥mo llegar a otro ToR en el mismo DC y d√≥nde est√° el punto de entrada para llegar al ToR en otro DC. <br><br>  En DCI, las rutas se transmitir√°n como VPNv4.  Para hacer esto, en Edge-Leaf, la interfaz de la f√°brica se colocar√° en VRF, llam√©mosla UNDERLAY, y el vecindario con Spine on the Edge-Leaf se elevar√° dentro del VRF, y entre Edge-Leafs en la familia VPNv4. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/231/d58/9d6/231d589d6ae0bcd63e4f60028771cd95.png" width="800"><br><br>  Y tambi√©n prohibiremos volver a anunciar rutas recibidas de las espinas, de regreso a ellas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f0/f41/dfa/3f0f41dfa8510d48849ef8743f5b757a.png" width="500"><br><br>  En Leaf and Spine, no importaremos Loopbacks.  Solo los necesitamos para determinar la ID del enrutador. <br><br>  Pero en Edge-Leafs lo importamos a Global BGP.  Entre las direcciones de bucle invertido, Edge Leafs establecer√° una sesi√≥n BGP en la familia VPN IPv4 entre s√≠. <br><br>  Entre los dispositivos EDGE, tendremos una red troncal OSPF + LDP.  Todo en una zona.  Configuraci√≥n extremadamente simple. <br><br>  Aqu√≠ hay una imagen de enrutamiento. <br><hr><br><br><h2>  BGP ASN </h2><br><h3>  Edge-Leaf ASN </h3><br>  En Edge-Leafs habr√° un ASN en todos los DC.  Es importante que haya iBGP entre Edge-Leafs y que no nos encontremos con los matices de eBGP.  Sea 65535. En realidad, podr√≠a ser un n√∫mero AS p√∫blico. <br><br><h3>  Columna vertebral ASN </h3><br>  En Spine, tendremos un ASN por DC.  Comencemos aqu√≠ desde el primer n√∫mero del rango AS privado: 64512, 64513, etc. <br><br>  ¬øPor qu√© est√° ASN en DC? <br><br>  Descomponemos esta pregunta en dos: <br><br><ul><li>  ¬øPor qu√© hay los mismos ASN en todas las espinas del mismo DC? </li><li>  ¬øPor qu√© son diferentes en diferentes DC? </li></ul><br>  <b>¬øPor qu√© son los mismos ASN en todas las espinas de un DC</b> <br><br>  As√≠ se ver√° la ruta AS-Path Anderlay en Edge-Leaf: <br> <code>[leafX_ASN, <b>spine_ASN</b> , edge_ASN]</code> <br>  Si intenta anunciarlo nuevamente a Spine, lo descartar√° porque su AS (Spine_AS) ya est√° en la lista. <br><br>  Sin embargo, dentro de DC estamos completamente satisfechos de que las rutas de Underlay que subieron a Edge no podr√°n descender.  Toda comunicaci√≥n entre hosts dentro del DC debe ocurrir dentro del nivel de la columna vertebral. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b3/cec/64c/0b3cec64c8666b0154f041bd64c9059b.png" width="800"><br><br>  Al mismo tiempo, las rutas agregadas de otros DC en cualquier caso alcanzar√°n libremente los ToR: en su AS-Path solo habr√° ASN 65535, el n√∫mero de AS Edge-Leafs, porque fue sobre ellos que fueron creados. <br><br>  <b>¬øPor qu√© son diferentes en diferentes DC?</b> <br><br>  Te√≥ricamente, podr√≠amos necesitar arrastrar Loopbacks y algunas m√°quinas virtuales de servicio entre los DC. <br><br>  Por ejemplo, en un host, ejecutaremos un Reflector de ruta o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el mismo VNGW</a> (Virtual Network Gateway), que estar√° bloqueado con ToR a trav√©s de BGP y anunciar√° su loopback, que deber√≠a estar disponible en todos los DC. <br><br>  As√≠ que aqu√≠ est√° c√≥mo se ver√° su AS-Path: <br> <code>[VNF_ASN, leafX_DC1_ASN, <b>spine_DC1_ASN</b> , edge_ASN, <b>spine_DC2_ASN</b> , leafY_DC2_ASN]</code> <br> <br>  Y aqu√≠ no deber√≠a haber ASN duplicados en ning√∫n lado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fee/b97/61f/feeb9761f4964eda7f7519464927f61e.png" width="800"><br><br>  Es decir, Spine_DC1 y Spine_DC2 deber√≠an ser diferentes, al igual que leafX_DC1 y leafY_DC2, que es exactamente a lo que nos estamos acercando. <br><blockquote>  Como probablemente sepa, hay hacks que le permiten aceptar rutas con ASN repetidos a pesar del mecanismo de prevenci√≥n de bucle invertido de Cisco.  E incluso tiene usos bastante leg√≠timos.  Pero esta es una brecha potencial en la resistencia de la red.  Y personalmente ca√≠ en ello un par de veces. <br><br>  Y si tenemos la oportunidad de no usar cosas peligrosas, lo usaremos. <br></blockquote><br><h3>  Hoja asn </h3><br>  Tendremos un ASN individual en cada conmutador Leaf en toda la red. <br>  Hacemos esto por las razones indicadas anteriormente: AS-Path sin bucles, configuraci√≥n BGP sin marcadores. <br><br>  Para que las rutas entre Leafs pasen sin obst√°culos, AS-Path deber√≠a verse as√≠: <br> <code>[leafX_ASN, spine_ASN, leafY_ASN]</code> <br>  donde leafX_ASN y leafY_ASN ser√≠a bueno ser diferente. <br><br>  Esto tambi√©n es necesario para la situaci√≥n con el anuncio del loopback VNF entre DC: <br> <code>[VNF_ASN, <b>leafX_DC1_ASN</b> , spine_DC1_ASN, edge_ASN, spine_DC2_ASN, <b>leafY_DC2_ASN</b> ]</code> <br> <br>  Utilizaremos un ASN de 4 bytes y lo generaremos en funci√≥n del ASN de Spine y el n√∫mero de cambio de hoja, es decir, as√≠: <i>Spine_ASN.0000X</i> . <br><hr><br><br>  Aqu√≠ hay una foto con ASN. <br><img src="https://habrastorage.org/getpro/habr/post_images/c4a/f3b/66c/c4af3b66cff4bb0589ee0c6ef98134cf.png" width="800"><br><hr><br><br><h1>  Plan de propiedad intelectual </h1><br><br>  B√°sicamente, necesitamos asignar direcciones para las siguientes conexiones: <br><br><ol><li>  Calibre las direcciones de red entre ToR y la m√°quina.  Deben ser √∫nicos en toda la red para que cualquier m√°quina pueda comunicarse con cualquier otra.  Genial para <b>10/8</b> .  Para cada estante / 26 con un margen.  Asignaremos / 19 para DC y / 17 para la regi√≥n. <br></li><li>  Direcciones de enlace entre Leaf / Tor y Spine. <br><br>  Me gustar√≠a asignarlos algor√≠tmicamente, es decir, calcular a partir de los nombres de los dispositivos que deben conectarse. <br><br>  Deja que sea ... 169.254.0.0/16. <br>  A saber, <b>169.254.00X.Y / 31</b> , donde <b>X</b> es el n√∫mero de la columna vertebral, <b>Y</b> es la red P2P / 31. <br>  Esto le permitir√° ejecutar hasta 128 bastidores y hasta 10 Spine en DC.  Las direcciones de enlace pueden (y ser√°n) repetidas de DC a DC. </li><li>  Organizamos la uni√≥n Spine - Edge-Leaf en las subredes <b>169.254.10X.Y / 31</b> , donde de la misma manera <b>X</b> es el n√∫mero de Spine, <b>Y</b> es la red P2P / 31. </li><li>  Vincular direcciones de Edge-Leaf a la red troncal MPLS.  Aqu√≠ la situaci√≥n es algo diferente: el lugar de conectar todas las piezas en un solo pastel, por lo que reutilizar las mismas direcciones no funcionar√°, debe seleccionar la siguiente subred libre.  Por lo tanto, tomaremos <b>192.168.0.0/16</b> como base y eliminaremos a los libres. </li><li>  Direcciones de bucle invertido.  Dales todo el rango <b>172.16.0.0/12</b> . <br><ul><li>  Hoja - a / 25 por DC - los mismos 128 bastidores.  Asignar por / 23 a la regi√≥n. </li><li>  Spine - by / 28 en DC - hasta 16 Spine.  Asignar por / 26 a la regi√≥n. </li><li>  Edge-Leaf - por / 29 en DC - hasta 8 cajas.  Asignar por / 27 a la regi√≥n. </li></ul></li></ol><br>  Si en DC no tenemos suficientes rangos seleccionados (pero no estar√°n all√≠, pretendemos ser hyper-skeylerostvo), simplemente seleccione el siguiente bloque. <br><br>  Aqu√≠ hay una imagen con direccionamiento IP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/def/f08/e49/deff08e49e0fee39e0799dfac4fad2a4.png" width="800"><br><br>  Loopbacks: <br><table border="2"><tbody><tr><td>  <b>Prefijo</b> </td><td>  <b>Rol del dispositivo</b> </td><td>  <b>Regi√≥n</b> </td><td>  <b>DC</b> </td></tr><tr><td>  172.16.0.0/23 </td><td rowspan="10">  borde </td><td></td><td></td></tr><tr><td>  172.16.0.0/27 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  172.16.0.0/29 </td><td>  msk </td></tr><tr><td>  172.16.0.8/29 </td><td>  kzn </td></tr><tr><td>  172.16.0.32/27 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  172.16.0.32/29 </td><td>  bcn </td></tr><tr><td>  172.16.0.40/29 </td><td>  mlg </td></tr><tr><td>  172.16.0.64/27 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.0.64/29 </td><td>  sha </td></tr><tr><td>  172.16.0.72/29 </td><td>  sia </td></tr><tr><td>  172.16.2.0/23 </td><td rowspan="10">  columna vertebral </td><td></td><td></td></tr><tr><td>  172.16.2.0/26 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  172.16.2.0/28 </td><td>  msk </td></tr><tr><td>  172.16.2.16/28 </td><td>  kzn </td></tr><tr><td>  172.16.2.64/26 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  172.16.2.64/28 </td><td>  bcn </td></tr><tr><td>  172.16.2.80/28 </td><td>  mlg </td></tr><tr><td>  172.16.2.128/26 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.2.128/28 </td><td>  sha </td></tr><tr><td>  172.16.2.144/28 </td><td>  sia </td></tr><tr><td>  172.16.8.0/21 </td><td rowspan="10">  hoja </td><td></td><td></td></tr><tr><td>  172.16.8.0/23 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  172.16.8.0/25 </td><td>  msk </td></tr><tr><td>  172.16.8.128/25 </td><td>  kzn </td></tr><tr><td>  172.16.10.0/23 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  172.16.10.0/25 </td><td>  bcn </td></tr><tr><td>  172.16.10.128/25 </td><td>  mlg </td></tr><tr><td>  172.16.12.0/23 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.12.0/25 </td><td>  sha </td></tr><tr><td>  172.16.12.128/25 </td><td>  sia </td></tr></tbody></table><br><br>  Underlay: <br><table border="2"><tbody><tr><td>  <b>Prefijo</b> </td><td>  <b>Regi√≥n</b> </td><td>  <b>DC</b> </td></tr><tr><td>  10.0.0.0/17 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  10.0.0.0/19 </td><td>  msk </td></tr><tr><td>  10.0.32.0/19 </td><td>  kzn </td></tr><tr><td>  10.0.128.0/17 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  10.0.128.0/19 </td><td>  bcn </td></tr><tr><td>  10.0.160.0/19 </td><td>  mlg </td></tr><tr><td>  10.1.0.0/17 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  10.1.0.0/19 </td><td>  sha </td></tr><tr><td>  10.1.32.0/19 </td><td>  sia </td></tr></tbody></table><br><hr><br><br><h1>  Laba </h1><br>  Dos vendedores  Una red  ADSM <br><br>  Enebro + Arista.  Ubuntu  Buena vieja Eva. <br><br>  La cantidad de recursos en nuestro virtual en Miran todav√≠a es limitada, por lo que para la pr√°ctica usaremos una red tan simplificada hasta el l√≠mite. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/477/a27/096/477a2709633866d53fec5972e9417421.png" width="800"><br><br>  Dos centros de datos: Kaz√°n y Barcelona. <br><br><ul><li>  Dos espinas en cada una: Juniper y Arista. </li><li>  Un toro (Hoja) en cada uno: Juniper y Arista, con un host conectado (tomemos el ligero Cisco IOL para esto). </li><li>  Un nodo Edge-Leaf (solo Juniper hasta ahora). </li><li>  Un interruptor de Cisco para gobernarlos a todos. </li><li>  Adem√°s de las cajas de red, se lanz√≥ una m√°quina virtual de administraci√≥n.  Ejecutando Ubuntu. <br>  Ella tiene acceso a todos los dispositivos, sistemas IPAM / DCIM, un mont√≥n de scripts de Python, ansible y todo lo que necesitemos estar√° girando sobre √©l. </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La configuraci√≥n completa de</a> todos los dispositivos de red que intentaremos reproducir utilizando la automatizaci√≥n. <br><hr><br><br><h1>  Conclusi√≥n </h1><br>  ¬øTambi√©n aceptado?  Debajo de cada art√≠culo para hacer una breve conclusi√≥n? <br><br>  Por lo tanto, elegimos la red Klose de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tres niveles</a> dentro del DC, porque esperamos mucho tr√°fico Este-Oeste y queremos ECMP. <br><br>  Dividimos la red en f√≠sica (subyacente) y virtual (superpuesta).  En este caso, la superposici√≥n comienza desde el host, lo que simplifica los requisitos para la superposici√≥n. <br><br>  Elegimos BGP como protocolo de enrutamiento para las redes no retransmitidas por su escalabilidad y flexibilidad de pol√≠ticas. <br><br>  Tendremos nodos separados para la organizaci√≥n DCI - Edge-leaf. <br>  Habr√° OSPF + LDP en el tronco. <br>  DCI se implementar√° en base a MPLS L3VPN. <br>  Para enlaces P2P, calcularemos las direcciones IP algor√≠tmicamente en funci√≥n de los nombres de los dispositivos. <br>  Los Lupbacks ser√°n asignados por el rol de los dispositivos y su ubicaci√≥n en secuencia. <br>  Prefijos subyacentes: solo en los conmutadores Leaf secuencialmente seg√∫n su ubicaci√≥n. <br><br>  Supongamos que no tenemos el equipo instalado en este momento. <br>  Por lo tanto, nuestros pr√≥ximos pasos ser√°n llevarlos a los sistemas (IPAM, inventario), organizar el acceso, generar una configuraci√≥n e implementarla. <br><br>  En el pr√≥ximo art√≠culo, trataremos con Netbox, el sistema de gesti√≥n de inventario y espacio IP en DC. <br><hr><br><br><h1>  Gracias </h1><br><ul><li>  Andrey Glazkov, alias @glazgoo, para revisi√≥n y edici√≥n </li><li>  Alexander Klimenko, alias @ v00lk, para revisi√≥n y edici√≥n </li><li>  Artyom Chernobay para KDPV </li></ul><br><hr></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/475614/">https://habr.com/ru/post/475614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../475600/index.html">C√≥mo conectamos Prometeo</a></li>
<li><a href="../475604/index.html">Configuraci√≥n de la plantilla oficial de PostgreSQL en Zabbix 4.4</a></li>
<li><a href="../475608/index.html">Administrador de etiquetas de Google: configuraciones de disparador poco obvias y √∫tiles</a></li>
<li><a href="../475610/index.html">L√°mparas de mesa LED seguras que retienen la visi√≥n</a></li>
<li><a href="../475612/index.html">Dado, cuando, afirmaciones y confianza en la implementaci√≥n</a></li>
<li><a href="../475622/index.html">Extender UObject en Unreal Engine 4</a></li>
<li><a href="../475624/index.html">PHP-Watcher: una herramienta que simplifica el desarrollo de aplicaciones de larga duraci√≥n</a></li>
<li><a href="../475630/index.html">Knative: una plataforma basada en k8s como servicio con soporte sin servidor</a></li>
<li><a href="../475640/index.html">Si est√° creando algo, evite la programaci√≥n del gerente.</a></li>
<li><a href="../475642/index.html">Mecanismo de tuplas de solo almacenamiento din√°mico en PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>