<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóùÔ∏è üç¨ ‚ôâÔ∏è Et encore dans l'espace: comment le licorne Stellarium a visit√© üêé üíì üßìüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pendant toute la dur√©e de leur existence, les gens ont d√©ploy√© des efforts consid√©rables pour √©tudier presque toute la zone du ciel √©toil√©. √Ä ce jour,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Et encore dans l'espace: comment le licorne Stellarium a visit√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/432954/">  Pendant toute la dur√©e de leur existence, les gens ont d√©ploy√© des efforts consid√©rables pour √©tudier presque toute la zone du ciel √©toil√©.  √Ä ce jour, nous avons examin√© des centaines de milliers d'ast√©ro√Ødes, de com√®tes, de n√©buleuses et d'√©toiles, de galaxies et de plan√®tes.  Pour voir toute cette beaut√© vous-m√™me, il n'est pas n√©cessaire de quitter la maison et de vous acheter un t√©lescope.  Vous pouvez installer Stellarium - un plan√©tarium virtuel sur votre ordinateur, et regarder le ciel nocturne, confortablement allong√© sur le canap√© ... Mais est-ce confortable?  Pour trouver la r√©ponse √† cette question, nous allons v√©rifier Stellarium pour les erreurs de code informatique. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b8/c8b/129/4b8c8b12983537442bfea4700cadca97.png"></div><br><a name="habracut"></a><br><h2>  Un peu sur le projet ... </h2><br>  Selon la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">description</a> du site Wikipedia, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Stellarium</a> est un plan√©tarium virtuel open source disponible pour Linux, Mac OS X, Microsoft Windows, Symbian, Android et iOS, ainsi que MeeGo.  Le programme utilise les technologies OpenGL et Qt pour cr√©er un ciel r√©aliste en temps r√©el.  Avec Stellarium, vous pouvez voir ce que vous pouvez voir avec un t√©lescope moyen et m√™me grand.  Le programme fournit √©galement des observations des √©clipses solaires et du mouvement des com√®tes. <br><br>  Stellarium a √©t√© cr√©√© par le programmeur fran√ßais Fabian Chereau, qui a lanc√© le projet √† l'√©t√© 2001.  Parmi les autres d√©veloppeurs √©minents figurent Robert Spearman, Johannes Gadzhozik, Matthew Gates, Timothy Reeves, Bogdan Marinov et Johan Meeris, qui est responsable de l'≈ìuvre. <br><br><h2>  ... et sur l'analyseur </h2><br>  L'analyse du projet a √©t√© r√©alis√©e √† l'aide de l'analyseur de code statique PVS-Studio.  Il s'agit d'un outil de d√©tection d'erreurs et de vuln√©rabilit√©s potentielles dans le code source des programmes √©crits en C, C ++ et C # (bient√¥t en Java!).  Il fonctionne sur Windows, Linux et macOS.  Il est con√ßu pour ceux qui ont besoin d'am√©liorer la qualit√© de leur code. <br><br>  L'analyse √©tait assez simple.  Tout d'abord, j'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©charg√©</a> le projet Stellarium depuis GitHub, puis j'ai install√© tous les packages n√©cessaires √† l'assemblage.  √âtant donn√© que le projet est construit √† l'aide de Qt Creator, j'ai utilis√© le syst√®me de suivi du lancement du compilateur, qui est int√©gr√© √† la version <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">autonome</a> de l'analyseur.  Vous pouvez y voir le rapport d'analyse termin√©. <br><br>  Les nouveaux lecteurs et utilisateurs de <b><i>Stellarium</i></b> se sont peut-√™tre demand√©: pourquoi la licorne appara√Æt-elle dans le titre de l'article et comment est-elle li√©e √† l'analyse de code?  Je r√©ponds: je suis l'un des d√©veloppeurs de PVS-Studio, et la licorne est notre mascotte espi√®gle pr√©f√©r√©e.  Alors, allez! <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bfc/8f2/aab/bfc8f2aaba0bf61f3b40d4d0765dd027.png"></div><br>  J'esp√®re que gr√¢ce √† cet article, les lecteurs apprendront quelque chose de nouveau par eux-m√™mes, et les d√©veloppeurs de Stellarium pourront √©liminer certaines erreurs et am√©liorer la qualit√© du code. <br><br>  Apportez-vous du caf√© avec un croissant d'air et installez-vous confortablement, car nous allons √† la partie la plus int√©ressante - un aper√ßu des r√©sultats de l'analyse et de l'analyse des erreurs! <br><br><h2>  Conditions suspectes </h2><br>  Pour un plus grand plaisir de lecture, je sugg√®re de ne pas regarder directement l'avertissement de l'analyseur, mais d'essayer ici et plus loin de trouver les erreurs vous-m√™me. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QZipReaderPrivate::scanFiles() { .... <span class="hljs-comment"><span class="hljs-comment">// find EndOfDirectory header int i = 0; int start_of_directory = -1; EndOfDirectory eod; while (start_of_directory == -1) { const int pos = device-&gt;size() - int(sizeof(EndOfDirectory)) - i; if (pos &lt; 0 || i &gt; 65535) { qWarning() &lt;&lt; "QZip: EndOfDirectory not found"; return; } device-&gt;seek(pos); device-&gt;read((char *)&amp;eod, sizeof(EndOfDirectory)); if (readUInt(eod.signature) == 0x06054b50) break; ++i; } .... }</span></span></code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Avertissement</a> <b>PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V654</a> La condition 'start_of_directory == - 1' de la boucle est toujours vraie.  qzip.cpp 617 <br><br>  Pourriez-vous trouver une erreur?  Si oui, louez-le. <br><br>  L'erreur r√©side dans l'√©tat de la <i>boucle while</i> .  C'est toujours vrai, car la variable <i>start_of_directory</i> ne change pas dans le corps de la boucle.  Tr√®s probablement, le cycle ne sera pas √©ternel, car il contient <i>retour</i> et <i>pause</i> , mais un tel code semble √©trange. <br><br>  Il me semble que dans le code ils ont oubli√© de faire l'affectation <i>start_of_directory = pos</i> √† l'endroit o√π la signature est v√©rifi√©e.  Ensuite, la d√©claration de <i>rupture</i> est peut-√™tre superflue.  Dans ce cas, le code peut √™tre r√©√©crit comme ceci: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> start_of_directory = <span class="hljs-number"><span class="hljs-number">-1</span></span>; EndOfDirectory eod; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (start_of_directory == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos = device-&gt;size() - <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndOfDirectory)) - i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || i &gt; <span class="hljs-number"><span class="hljs-number">65535</span></span>) { qWarning() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"QZip: EndOfDirectory not found"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } device-&gt;seek(pos); device-&gt;read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)&amp;eod, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndOfDirectory)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readUInt(eod.signature) == <span class="hljs-number"><span class="hljs-number">0x06054b50</span></span>) start_of_directory = pos; ++i; }</code> </pre> <br>  Cependant, je ne suis pas s√ªr de ce que le code devrait √™tre comme √ßa.  Il est pr√©f√©rable que les d√©veloppeurs du projet analysent eux-m√™mes cette partie du programme et apportent les modifications n√©cessaires. <br><br>  Une autre condition √©trange: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StelProjectorCylinder</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StelProjector { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">intersectViewportDiscontinuityInternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3d&amp; capN, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> capD)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capN, capD)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cap.intersects(cap1) &amp;&amp; cap.intersects(cap2) &amp;&amp; cap.intersects(cap2); } };</code> </pre> <br>  <b>Avertissement PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V501</a> Il existe des sous-expressions identiques ¬´cap.intersects (cap2)¬ª √† gauche et √† droite de l'op√©rateur ¬´&amp;&amp;¬ª.  StelProjectorClasses.hpp 175 <br><br>  Comme vous l'avez probablement d√©j√† devin√©, l'erreur r√©side dans la derni√®re ligne de la fonction: le programmeur a fait une faute de frappe, et √† la fin il s'est av√©r√© que la fonction renvoie le r√©sultat quelle que soit la valeur de <i>cap3</i> . <br><br>  Ce type d'erreur est extr√™mement courant: dans presque tous les projets v√©rifi√©s, nous avons rencontr√© des fautes de frappe associ√©es aux noms des formulaires <i>nom1</i> et <i>nom2</i> , etc.  En r√®gle g√©n√©rale, ces erreurs sont li√©es au copier-coller. <br><br>  Cette instance de code est un excellent exemple d'un autre mod√®le d'erreur commun, pour lequel nous avons m√™me men√© une mini-√©tude distincte.  Mon coll√®gue Andrei Karpov l'a appel√© ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'effet de derni√®re ligne¬ª</a> .  Si vous n'√™tes pas familier avec ce mat√©riel, je vous sugg√®re d'ouvrir un onglet dans le navigateur pour le lire plus tard, mais pour l'instant, continuons. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> BottomStelBar::updateText(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> updatePos) { .... updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location-&gt;text() != newLocation || updatePos) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fov-&gt;text() != str) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fps-&gt;text() != str) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (updatePos) { .... } }</code> </pre> <br>  <b>Avertissements de PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V560</a> Une partie de l'expression conditionnelle est toujours vraie: updatePos.  StelGuiItems.cpp 732 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V547 L'</a> expression 'updatePos' est toujours vraie.  StelGuiItems.cpp 831 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V763 Le</a> param√®tre 'updatePos' est toujours r√©√©crit dans le corps de la fonction avant d'√™tre utilis√©.  StelGuiItems.cpp 690 </li></ul><br>  La valeur du param√®tre <i>updatePos est</i> toujours √©cras√©e avant d'√™tre utilis√©e, c'est-√†-dire  la fonction fonctionnera de la m√™me mani√®re, quelle que soit la valeur qui lui est transmise. <br><br>  √áa a l'air bizarre, non?  Dans tous les endroits o√π le param√®tre <i>updatePos</i> est <i>impliqu√©</i> , c'est <i>vrai</i> .  Cela signifie que les conditions <i>if (location-&gt; text ()! = NewLocation || updatePos)</i> et <i>if (updatePos)</i> seront toujours vraies. <br><br>  Un autre extrait: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> LandscapeMgr::onTargetLocationChanged(StelLocation loc) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pl &amp;&amp; flagEnvironmentAutoEnabling) { QSettings* conf = StelApp::getInstance().getSettings(); setFlagAtmosphere(pl-&gt;hasAtmosphere() &amp; conf-&gt;value(<span class="hljs-string"><span class="hljs-string">"landscape/flag_atmosphere"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).toBool()); setFlagFog(pl-&gt;hasAtmosphere() &amp; conf-&gt;value(<span class="hljs-string"><span class="hljs-string">"landscape/flag_fog"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).toBool()); setFlagLandscape(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } .... }</code> </pre> <br>  <b>Avertissements de PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V792</a> La fonction 'toBool' situ√©e √† droite de l'op√©rateur '&amp;' sera appel√©e quelle que soit la valeur de l'op√©rande gauche.  Peut-√™tre vaut-il mieux utiliser '&amp;&amp;'.  LandscapeMgr.cpp 782 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V792</a> La fonction 'toBool' situ√©e √† droite de l'op√©rateur '&amp;' sera appel√©e quelle que soit la valeur de l'op√©rande gauche.  Peut-√™tre vaut-il mieux utiliser '&amp;&amp;'.  LandscapeMgr.cpp 783 </li></ul><br>  L'analyseur a d√©tect√© une expression suspecte dans les arguments des fonctions <i>setFlagAtmosphere</i> et <i>setFlagFog</i> .  En effet: des deux c√¥t√©s de l'op√©rateur de bit <i>&amp; il</i> y a des valeurs de type <i>bool</i> .  Au lieu de l'op√©rateur <i>&amp;</i> , vous devez utiliser l'op√©rateur <i>&amp;&amp;</i> , et maintenant je vais vous expliquer pourquoi. <br><br>  Oui, le r√©sultat de cette expression sera toujours correct.  Avant d'utiliser les bits ¬´et¬ª, les deux op√©randes seront promus <i>int</i> .  En C ++, une telle conversion est <a href="">sans ambigu√Øt√©</a> : false est converti en 0 et true est converti en 1. Par cons√©quent, le r√©sultat de cette expression sera le m√™me que si l'op√©rateur <i>&amp;&amp;</i> √©tait utilis√©. <br><br>  Mais il y a une nuance.  Lors du calcul du r√©sultat de l'op√©ration <i>&amp;&amp;</i> , le soi-disant "calcul paresseux" est utilis√©.  Si la valeur de l'op√©rande gauche est <i>fausse</i> , alors la valeur droite n'est m√™me pas calcul√©e, car le "et" logique retournera en tout cas <i>faux</i> .  Ceci est fait pour √©conomiser les ressources informatiques et vous permet d'√©crire des conceptions plus complexes.  Par exemple, vous pouvez v√©rifier que le pointeur n'est pas nul et, dans l'affirmative, le d√©r√©f√©rencer pour effectuer une v√©rification suppl√©mentaire.  Exemple: <i>if (ptr &amp;&amp; ptr-&gt; foo ())</i> . <br><br>  Ce "calcul paresseux" n'est pas effectu√© √† l'aide de l'op√©rateur au niveau du bit <i>&amp;</i> : les expressions <i>conf-&gt; value ("...", true) .toBool ()</i> seront √©valu√©es √† chaque fois, quelle que soit la valeur <i>pl-&gt; hasAtmosphere ()</i> . <br><br>  Dans de rares cas, cela est fait expr√®s.  Par exemple, si le calcul de l'op√©rande droit a des ¬´effets secondaires¬ª, le r√©sultat est utilis√© plus tard.  Ce n'est pas tr√®s bon de le faire non plus, car cela complique la compr√©hension du code et complique sa maintenance.  De plus, l'ordre de calcul des op√©randes <i>&amp; n'est</i> pas d√©fini, donc dans certains cas d'utilisation de telles "astuces", vous pouvez obtenir un comportement ind√©fini. <br><br>  Si vous devez enregistrer des effets secondaires - faites-le sur une ligne distincte et enregistrez le r√©sultat dans une variable distincte.  Les personnes qui travailleront avec ce code √† l'avenir vous seront reconnaissantes :) <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/301/5a6/971/3015a69710bc07f948b5233dac04fc87.png"></div><br>  Nous passons au sujet suivant. <br><br><h2>  Gestion incorrecte de la m√©moire </h2><br>  Commen√ßons le sujet de la m√©moire dynamique avec ce fragment: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/************ Basic Edge Operations ****************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/* __gl_meshMakeEdge creates one edge, * two vertices, and a loop (face). * The loop consists of the two new half-edges. */</span></span> GLUEShalfEdge* __gl_meshMakeEdge(GLUESmesh* mesh) { GLUESvertex* newVertex1 = allocVertex(); GLUESvertex* newVertex2 = allocVertex(); GLUESface* newFace = allocFace(); GLUEShalfEdge* e; <span class="hljs-comment"><span class="hljs-comment">/* if any one is null then all get freed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( newVertex1 == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || newVertex2 == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || newFace == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertex1 != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newVertex1); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertex2 != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newVertex2); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newFace != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newFace); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } e = MakeEdge(&amp;mesh-&gt;eHead); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } MakeVertex(newVertex1, e, &amp;mesh-&gt;vHead); MakeVertex(newVertex2, e-&gt;Sym, &amp;mesh-&gt;vHead); MakeFace(newFace, e, &amp;mesh-&gt;fHead); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e; }</code> </pre> <br>  <b>Avertissements de PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V773</a> La fonction a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ferm√©e</a> sans lib√©rer le pointeur 'newVertex1'.  Une fuite de m√©moire est possible.  mesh.c 312 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V773</a> La fonction a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ferm√©e</a> sans lib√©rer le pointeur 'newVertex2'.  Une fuite de m√©moire est possible.  mesh.c 312 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V773</a> La fonction a √©t√© quitt√©e sans lib√©rer le pointeur 'newFace'.  Une fuite de m√©moire est possible.  mesh.c 312 </li></ul><br>  La fonction alloue de la m√©moire √† plusieurs structures et la transmet aux pointeurs <i>newVertex1</i> , <i>newVertex2</i> (noms int√©ressants, non?) Et <i>newFace</i> .  Si l'un d'eux s'av√®re √™tre nul, alors toute la m√©moire r√©serv√©e √† l'int√©rieur de la fonction est lib√©r√©e, apr√®s quoi le flux de contr√¥le quitte la fonction. <br><br>  Que se passe-t-il si la m√©moire des trois structures est allou√©e correctement et que la fonction <i>MakeEdge (&amp; mesh-&gt; eHead)</i> renvoie <i>NULL</i> ?  Le flux de contr√¥le atteindra le deuxi√®me <i>retour</i> . <br><br>  √âtant donn√© que les pointeurs <i>newVertex1</i> , <i>newVertex2</i> et <i>newFace</i> sont des variables locales, ils cesseront d'exister apr√®s avoir quitt√© la fonction.  Mais la lib√©ration de la m√©moire qui leur appartenait n'aura pas lieu.  Il restera r√©serv√©, mais nous n'y aurons plus acc√®s. <br><br>  De telles situations sont appel√©es fuites de m√©moire.  Un sc√©nario typique avec une telle erreur: avec une utilisation prolong√©e du programme, il commence √† consommer de plus en plus de RAM, jusqu'√† son √©puisement. <br><br>  Il est √† noter que dans cet exemple, le troisi√®me <i>retour n'est</i> pas erron√©.  Les fonctions <i>MakeVertex</i> et <i>MakeFace</i> transf√®rent les adresses de la m√©moire allou√©e √† d'autres structures de donn√©es, d√©l√©guant ainsi la responsabilit√© de sa lib√©ration. <br><br>  Le prochain d√©faut est dans la m√©thode, qui prend 90 lignes.  Pour plus de commodit√©, je l'ai r√©duit, ne laissant que des zones √† probl√®mes. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AstroCalcDialog::drawAngularDistanceGraph() { .... QVector&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; xs, ys; .... }</code> </pre> <br>  Il ne reste qu'une ligne.  Permettez-moi de vous donner un indice: c'est la seule mention des objets <i>xs</i> et <i>ys</i> . <br><br>  <b>Avertissements de PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'objet</a> 'xs' V808 de type 'QVector' a √©t√© cr√©√© mais n'a pas √©t√© utilis√©.  AstroCalcDialog.cpp 5329 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'objet V808</a> 'ys' de type 'QVector' a √©t√© cr√©√© mais n'a pas √©t√© utilis√©.  AstroCalcDialog.cpp 5329 </li></ul><br>  Les vecteurs <i>xs</i> et <i>ys</i> sont cr√©√©s, mais ne sont utilis√©s nulle part.  Il s'av√®re que chaque fois que vous utilisez la m√©thode <i>drawAngularDistanceGraph</i> , une cr√©ation et une suppression suppl√©mentaires d'un conteneur vide se produisent.  Je pense que cette annonce est rest√©e dans le code apr√®s refactoring.  Bien s√ªr, ce n'est pas une erreur, mais vous devez supprimer le code suppl√©mentaire. <br><br><h2>  Moulages de type √©trange </h2><br>  Un autre exemple apr√®s un peu de mise en forme ressemble √† ceci: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SatellitesDialog::updateSatelliteData() { .... <span class="hljs-comment"><span class="hljs-comment">// set default buttonColor = QColor(0.4, 0.4, 0.4); .... }</span></span></code> </pre> <br>  Afin de comprendre quelle est l'erreur, vous devrez regarder les prototypes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des constructeurs de classe Qcolor</a> : <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7d/84e/798/f7d84e79849bca96f7a27016aec0e9d3.png"></div><br>  <b>Avertissements de PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V674</a> Le litt√©ral '0.4' de type 'double' est implicitement converti en type 'int' lors de l'appel de la fonction 'QColor'.  Inspectez le premier argument.  SatellitesDialog.cpp 413 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V674</a> Le litt√©ral '0.4' de type 'double' est implicitement converti en type 'int' lors de l'appel de la fonction 'QColor'.  Inspectez le deuxi√®me argument.  SatellitesDialog.cpp 413 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V674</a> Le litt√©ral '0.4' de type 'double' est implicitement converti en type 'int' lors de l'appel de la fonction 'QColor'.  Inspectez le troisi√®me argument.  SatellitesDialog.cpp 413 </li></ul><br>  La classe <i>Qcolor n'a</i> pas de constructeurs qui acceptent le type <i>double</i> , donc les arguments de l'exemple seront implicitement convertis en <i>int</i> .  Cela fait que les champs <i>r</i> , <i>g</i> , <i>b</i> de l'objet <i>buttonColor</i> ont une valeur de <i>0</i> . <br><br>  Si le programmeur avait l'intention de cr√©er un objet √† partir de valeurs de type <i>double</i> , il devrait utiliser un constructeur diff√©rent. <br><br>  Par exemple, vous pouvez utiliser un constructeur qui accepte <i>Qrgb</i> en √©crivant: <br><br><pre> <code class="cpp hljs">buttonColor = QColor(QColor::fromRgbF(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>));</code> </pre> <br>  Cela aurait pu √™tre fait diff√©remment.  Qt utilise des valeurs r√©elles dans la plage [0,0, 1,0] ou des valeurs enti√®res dans la plage [0, 255] pour indiquer les couleurs RVB. <br><br>  Par cons√©quent, le programmeur pourrait traduire les valeurs de r√©el en entier en √©crivant comme ceci: <br><br><pre> <code class="cpp hljs">buttonColor = QColor((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>));</code> </pre> <br>  ou juste <br><br><pre> <code class="cpp hljs">buttonColor = QColor(<span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">102</span></span>);</code> </pre> <br>  √ätes-vous ennuy√©?  Ne vous inqui√©tez pas: des erreurs plus int√©ressantes nous attendent. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f18/aa0/297/f18aa02975f89e9e6cc7c661706fc608.png"></div><br>  <font color="#999999"><i>"Licorne dans l'espace."</i></font>  <font color="#999999"><i>Vue depuis le Stellarium.</i></font> <br><br><h2>  Autres erreurs </h2><br>  En fin de compte, je vous ai laiss√© un peu plus d√©licieux :) Passons √† l'un d'eux. <br><br><pre> <code class="cpp hljs">HipsTile* HipsSurvey::getTile(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> order, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pix) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (order == orderMin &amp;&amp; !allsky.isNull()) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbw = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span> * <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; (<span class="hljs-number"><span class="hljs-number">2</span></span> * order)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (pix % nbw) * allsky.width() / nbw; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = (pix / nbw) * allsky.width() / nbw; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> s = allsky.width() / nbw; QImage image = allsky.copy(x, y, s, s); .... } .... }</code> </pre> <br>  <b>PVS-Studio Warning:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V634</a> La priorit√© de l'op√©ration '*' est sup√©rieure √† celle de l'op√©ration '&lt;&lt;'.  Il est possible que des parenth√®ses soient utilis√©es dans l'expression.  StelHips.cpp 271 <br><br>  Eh bien, avez-vous pu d√©tecter l'erreur?  Consid√©rez plus en d√©tail l'expression <i>(12 * 1 &lt;&lt; (ordre 2 *))</i> .  L'analyseur rappelle que l'op√©ration ' <i>*</i> ' a une priorit√© plus √©lev√©e que l'op√©ration de d√©calage de bit ' <i>&lt;&lt;</i> '.  Il est facile de voir que multiplier <i>12</i> par <i>1 est</i> inutile, et les crochets autour de l' <i>ordre 2 *</i> ne <i>sont</i> pas n√©cessaires. <br><br><pre> <code class="cpp hljs"> ,    : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbw = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span> * order));     &lt;i&gt;<span class="hljs-number"><span class="hljs-number">12</span></span> &lt;/i&gt;     .</code> </pre> <br>  Remarque  De plus, je tiens √† noter que si la valeur de l'op√©rande de droite ' <i>&lt;&lt;</i> ' est sup√©rieure ou √©gale au nombre de bits de l'op√©rande de gauche, le r√©sultat n'est pas d√©fini.  √âtant donn√© que les litt√©raux num√©riques sont <i>int</i> par d√©faut, ce qui prend <i>32</i> bits, la valeur du param√®tre <i>order</i> ne doit pas d√©passer <i>15</i> .  Sinon, l'√©valuation de l'expression peut entra√Æner un comportement ind√©fini. <br><br>  Nous continuons.  La m√©thode ci-dessous est tr√®s d√©routante, mais je suis s√ªr qu'un lecteur sophistiqu√© g√©rera la d√©tection d'erreur :) <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* inherits documentation from base class */</span></span> QCPRange QCPStatisticalBox:: getKeyRange(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&amp; foundRange, SignDomain inSignDomain) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdBoth) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdNegative) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdPositive) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); } } foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); }</code> </pre> <br>  <b>Avertissement PVS-Studio:</b> V779 Code inaccessible d√©tect√©.  Il est possible qu'une erreur soit pr√©sente.  qcustomplot.cpp 19512. <br><br>  Le fait est que toutes les succursales <i>if ... else</i> ont un <i>retour</i> .  Par cons√©quent, le flux de contr√¥le n'atteint jamais les deux derni√®res lignes. <br><br>  Dans l'ensemble, cet exemple fonctionnera normalement et fonctionnera correctement.  Mais la seule pr√©sence d'un code inaccessible est un signal.  Dans ce cas, il indique la structure incorrecte de la m√©thode, ce qui complique grandement la lisibilit√© et l'intelligibilit√© du code. <br><br>  Ce fragment de code devrait √™tre refactoris√©, obtenant une fonction plus soign√©e √† la sortie.  Par exemple, comme ceci: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* inherits documentation from base class */</span></span> QCPRange QCPStatisticalBox:: getKeyRange(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&amp; foundRange, SignDomain inSignDomain) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (inSignDomain) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdBoth: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdNegative: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdPositive: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); }</code> </pre> <br>  La derni√®re de notre critique sera l'erreur que j'ai le plus appr√©ci√©e.  Le code spot d'incident est court et simple: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Avez-vous remarqu√© quelque chose de suspect?  Tout le monde ne peut pas :) <br><br>  <b>PVS-Studio Warning:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V603</a> L'objet a √©t√© cr√©√© mais il n'est pas utilis√©.  Si vous souhaitez appeler le constructeur, 'this-&gt; Plane :: Plane (....)' doit √™tre utilis√©.  Plane.cpp 29 <br><br>  Le programmeur s'attendait √† ce que certains champs de l'objet soient initialis√©s √† l'int√©rieur du constructeur imbriqu√©, mais cela s'est av√©r√© ainsi: lorsque le constructeur <i>Plane (Vec3f &amp; v1, Vec3f &amp; v2, Vec3f &amp; v3)</i> est appel√©, un objet temporaire sans nom est cr√©√© √† l'int√©rieur, qui est imm√©diatement supprim√©.  Par cons√©quent, une partie de l'objet reste non initialis√©e. <br><br>  Pour que le code fonctionne correctement, vous devez utiliser la fonctionnalit√© pratique et s√ªre de C ++ 11 - le constructeur d√©l√©gu√©: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f&amp; v1, Vec3f&amp; v2, Vec3f&amp; v3) : Plane(v1, v2, v3, SPolygon::CCW) { distance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; sDistance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; }</code> </pre> <br>  Mais si vous utilisez le compilateur pour les anciennes versions de la langue, vous pouvez √©crire comme ceci: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Plane::Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Ou alors: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Je note que les deux derni√®res m√©thodes sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tr√®s dangereuses</a> .  Par cons√©quent, vous devez √™tre tr√®s prudent et bien comprendre comment ces m√©thodes fonctionnent. <br><br><h2>  Conclusion </h2><br>  Quelles conclusions peut-on tirer de la qualit√© du code Stellarium?  Honn√™tement, il n'y a pas eu beaucoup d'erreurs.  De plus, dans l'ensemble du projet, je n'ai trouv√© aucune erreur dans laquelle le code est li√© √† un comportement non d√©fini.  Pour le projet opensource, la qualit√© du code s'est av√©r√©e √™tre √† un niveau √©lev√©, pour lequel je porte mon chapeau aux d√©veloppeurs.  Vous √™tes super!  J'ai √©t√© ravi et int√©ress√© de revoir votre projet. <br><br>  Qu'en est-il du plan√©tarium lui-m√™me - je l'utilise assez souvent.  Malheureusement, vivant dans une ville, je peux rarement profiter d'un ciel nocturne clair et Stellarium me permet d'√™tre n'importe o√π dans le monde sans me lever du canap√©.  C'est vraiment confortable! <br><br>  J'aime particuli√®rement le mode ¬´Constellation art¬ª.  La vue des √©normes personnages couvrant tout le ciel dans une √©trange danse est √† couper le souffle. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/613/3d5/107/6133d51079ac983aa11a017acd1945ee.png"></div><br>  <font color="#999999"><i>"Une danse √©trange."</i></font>  <font color="#999999"><i>Vue depuis le Stellarium.</i></font> <br><br>  Les terriens ont tendance √† faire des erreurs, et il n'y a rien de honteux dans le fait que ces erreurs fuient dans le code.  Pour cela, des outils d'analyse de code, tels que PVS-Studio, sont d√©velopp√©s.  Si vous √™tes l'un des terriens - <strike>comme √ßa, je vous</strike> sugg√®re de le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©charger et de l'essayer vous-m√™me</a> . <br><br>  J'esp√®re que vous avez √©t√© int√©ress√© par la lecture de mon article et que vous avez appris quelque chose de nouveau et d'utile pour vous-m√™me.  Et je souhaite aux d√©veloppeurs une correction pr√©coce des erreurs trouv√©es. <br><br>  Abonnez-vous √† nos cha√Ænes et restez √† l'√©coute pour les nouvelles du monde de la programmation! <br><br><ul><li>  Vk: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@pvsstudio_rus</a> </li><li>  T√©l√©gramme: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@pvsstudio_rus</a> </li><li>  Instagram: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@pvsstudio_rus</a> </li><li>  Twitter: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@pvsstudio_rus</a> </li><li>  YouTube: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@PVSStudioTool</a> </li></ul><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br>  Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: George Gribkov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Into Space Again: comment la licorne a visit√© le stellarium</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432954/">https://habr.com/ru/post/fr432954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432940/index.html">50 nuances de jeton</a></li>
<li><a href="../fr432942/index.html">Mod√®les de corutine et antipatterns dans Kotlin</a></li>
<li><a href="../fr432944/index.html">Optimisation forc√©e des requ√™tes PostgreSQL</a></li>
<li><a href="../fr432946/index.html">Unity - Pi√®ges du d√©veloppement de jeux 2D</a></li>
<li><a href="../fr432948/index.html">Clouds intelligents, entreprises intelligentes: comment l'IA transforme l'industrie du cloud computing</a></li>
<li><a href="../fr432956/index.html">Monstres d'Id: comment Doom a √©t√© cr√©√©</a></li>
<li><a href="../fr432958/index.html">Le nouveau paradoxe quantique clarifie dans quel cas nos id√©es sur la r√©alit√© s'av√®rent fausses</a></li>
<li><a href="../fr432960/index.html">Pourquoi les consommateurs n'ont pas peur du vol d'identit√©</a></li>
<li><a href="../fr432964/index.html">Un pouvoir bon ou rien: une nouvelle initiative l√©gislative en F√©d√©ration de Russie</a></li>
<li><a href="../fr432966/index.html">Chargeur de d√©marrage chiffr√© pour STM32</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>