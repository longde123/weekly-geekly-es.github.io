<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯП│я╕П ЁЯСиЁЯП╗тАНЁЯЪА ЁЯд┤ЁЯП╗ рдлреВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдЕрд╡рд░реЛрдзрди рдХрд╛рд░реНрдп ЁЯФд тП╣я╕П ЁЯдЯЁЯП┐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд▓рд┐рдирдХреНрд╕ рд╕рд┐рд╕реНрдЯрдо рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ, рд╣рдореЗрдВ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреЗ рдФрд░ рд╕рдВрджрд┐рдЧреНрдз рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд╖рдорддрд╛ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдлреВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдЕрд╡рд░реЛрдзрди рдХрд╛рд░реНрдп</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413241/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><img src="https://habrastorage.org/webt/xy/k-/zy/xyk-zye1hkr1vaw41hvsxup3brc.png" alt="рдкреЗрдВрдЧреБрдЗрди, рдПрди 3 рдПрд▓" align="right" width="40%"></a>  рд▓рд┐рдирдХреНрд╕ рд╕рд┐рд╕реНрдЯрдо рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ, рд╣рдореЗрдВ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рдиреЗ рдФрд░ рд╕рдВрджрд┐рдЧреНрдз рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реНрдиреЗрд▓ рдХреЗ рдЕрдВрджрд░ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдХрд╛рд░реНрдпреЛрдВ (рдЬреИрд╕реЗ рдХрд┐ рдлрд╛рдЗрд▓реЗрдВ рдЦреЛрд▓рдиреЗ рдФрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдПрдВ рдЪрд▓рд╛рдиреЗ) рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереАред <br><br>  рд╡рд┐рдХрд╛рд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди, рд╣рдо рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдХрд░рдиреЗ рдореЗрдВ рдХрд╛рдордпрд╛рдм рд░рд╣реЗ, рдЬреЛ рд╣рдореЗрдВ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдХрд┐рд╕реА рднреА рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдирд╛рдо рд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рд░реЛрдХрдирд╛ рдФрд░ рдЗрд╕рдХреЗ рдХреЙрд▓ рдХреЗ рдЖрд╕рдкрд╛рд╕ рд╣рдорд╛рд░реЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯрд░ рдХреЛ рдХрд░реНрдиреЗрд▓ рдХреЗ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдХреЗ рдмрд┐рдирд╛, рдПрдХ рд▓реЛрдб рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдЬреАрдкреАрдПрд▓ рдореЙрдбреНрдпреВрд▓ рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рджреГрд╖реНрдЯрд┐рдХреЛрдг x86_64 рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕реНрдХрд░рдг 3.19+ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред <br><a name="habracut"></a><br>  <font color="gray">(рдКрдкрд░ рд╕рд┐рд░реНрдл рдкреЗрдВрдЧреБрдЗрди рдЫрд╡рд┐: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">┬й De3antArt рдХреЗ рд╕рд╛рде En3l</a> ред)</font> <br><br><h2>  рдЬреНрдЮрд╛рдд рдЕрдиреБрдореЛрджрди </h2><br><h3>  рд▓рд┐рдирдХреНрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдПрдкреАрдЖрдИ </h3><br>  <em>рд▓рд┐рдирдХреНрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдПрдкреАрдЖрдИ</em> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рд╕рд╣реА рд╣реЛрдЧрд╛ - рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЗрди рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ред  рдХрд░реНрдиреЗрд▓ рдХреЛрдб рдХреЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реНрдерд╛рдиреЛрдВ рдореЗрдВ, рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рд╕реНрдерд┐рдд рд╣реИрдВ, рдЬреЛ рдмрджрд▓реЗ рдореЗрдВ, рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреЙрд▓рдмреИрдХ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВред  рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓ рдПрдХ рдСрдкрд░реЗрд╢рди рдХреЗ рд╕рдВрджрд░реНрдн рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рдкрд░ рдирд┐рд░реНрдгрдп рд▓реЗ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдЗрд╕рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ рдпрд╛ рдЗрдирдХрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br>  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рд▓рд┐рдирдХреНрд╕ рд╕реБрд░рдХреНрд╖рд╛ рдПрдкреАрдЖрдИ рдореЗрдВ рдХреБрдЫ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реАрдорд╛рдПрдБ рд╣реИрдВ: <br><br><ul><li>  рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓ рдХреЛ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рд▓реЛрдб рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдХрд░реНрдиреЗрд▓ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВ рдФрд░ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ </li><li>  рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдХреБрдЫ рдЕрдкрд╡рд╛рджреЛрдВ рдХреЗ рд╕рд╛рде) </li></ul><br>  рдпрджрд┐ рдХрд░реНрдиреЗрд▓ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреА рд╕реНрдерд┐рддрд┐ рдореЙрдбреНрдпреВрд▓ рдХреА рдмрд╣реБрд▓рддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрд╕реНрдкрд╖реНрдЯ рд╣реИ, рддреЛ рдЧрддрд┐рд╢реАрд▓ рд▓реЛрдбрд┐рдВрдЧ рдкрд░ рдкреНрд░рддрд┐рдмрдВрдз рдореМрд▓рд┐рдХ рд╣реИ: рд╕реБрд░рдХреНрд╖рд╛ рдореЙрдбреНрдпреВрд▓ рдХреЛ рд▓реЛрдбрд┐рдВрдЧ рдХреЗ рдХреНрд╖рдг рд╕реЗ, рд▓рдЧрд╛рддрд╛рд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реНрдиреЗрд▓ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╕реБрд░рдХреНрд╖рд╛ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЕрдкрдиреА рдХрд░реНрдиреЗрд▓ рдЕрд╕реЗрдВрдмрд▓реА рдХреА рдЖрдкреВрд░реНрддрд┐ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП, рд╕рд╛рде рд╣реА SELinux рдпрд╛ AppArmor рдХреЗ рд╕рд╛рде рдРрдб-рдСрди рдореЙрдбреНрдпреВрд▓ рдХреЛ рдПрдХреАрдХреГрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЬреЛ рдХрд┐ рд▓реЛрдХрдкреНрд░рд┐рдп рд╡рд┐рддрд░рдг рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЧреНрд░рд╛рд╣рдХ рдРрд╕реЗ рджрд╛рдпрд┐рддреНрд╡реЛрдВ рдХреА рд╕рджрд╕реНрдпрддрд╛ рдирд╣реАрдВ рд▓реЗрдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдорд╛рд░реНрдЧ рдмрдВрдж рдерд╛ред <br><br>  рдЗрди рдХрд╛рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП, рд╕реБрд░рдХреНрд╖рд╛ рдПрдкреАрдЖрдИ рд╣рдореЗрдВ рд╕реВрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдЕрдиреНрдпрдерд╛ рдпрд╣ рдПрдХ рдЖрджрд░реНрд╢ рд╡рд┐рдХрд▓реНрдк рд╣реЛрдЧрд╛ред <br><br><h3>  рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдЯреЗрдмрд▓ рдХрд╛ рд╕рдВрд╢реЛрдзрди </h3><br>  рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдирд┐рдЧрд░рд╛рдиреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА, рддрд╛рдХрд┐ рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ рдЗрд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЗ рд╕реНрддрд░ рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ, рд▓рд┐рдирдХреНрд╕ рд╕рднреА рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╣реИрдВрдбрд▓рд░ рдХреЛ <code>sys_call_table</code> рдЯреЗрдмрд▓ рдореЗрдВ рд╕реНрдЯреЛрд░ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдореВрд▓реНрдпреЛрдВ рдХрд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди рдкреВрд░реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣реИрдВрдбрд▓рд░ рдХреЗ рдкреБрд░рд╛рдиреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП рдФрд░ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╣реИрдВрдбрд▓рд░ рдХреЛ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдХрд┐рд╕реА рднреА рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рдХреБрдЫ рдлрд╛рдпрджреЗ рд╣реИрдВ: <br><br><ul><li>  <strong>рдХрд┐рд╕реА рднреА рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдкрд░ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг</strong> - рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рдПрдХрдорд╛рддреНрд░ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ред  рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдо рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдП рдЧрдП рдХрд┐рд╕реА рднреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЛ рдпрд╛рдж рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред <br></li><li>  <strong>рдиреНрдпреВрдирддрдо рдУрд╡рд░рд╣реЗрдбред</strong>  рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдЯреЗрдмрд▓ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╕рдордп рдПрдХ рдмрд╛рд░ рдХрд╛ рдкреВрдВрдЬреА рдирд┐рд╡реЗрд╢ рд╣реЛрддрд╛ рд╣реИред  рдЕрдкрд░рд┐рд╣рд╛рд░реНрдп рдирд┐рдЧрд░рд╛рдиреА рдкреЗрд▓реЛрдб рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХрдорд╛рддреНрд░ рдЦрд░реНрдЪ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ (рдореВрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╣реИрдВрдбрд▓рд░ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП) рд╣реИред <br></li><li>  <strong>рдиреНрдпреВрдирддрдо рдХрд░реНрдиреЗрд▓ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБред</strong>  рдпрджрд┐ рд╡рд╛рдВрдЫрд┐рдд рд╣реИ, рддреЛ рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдХрд┐рд╕реА рднреА рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╡рд┐рдХрд▓реНрдк рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ рдпрд╣ рд╕рд┐рд╕реНрдЯрдо рдХреА рд╡реНрдпрд╛рдкрдХ рд╕рдВрднрд╡ рд╕реАрдорд╛ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред <br></li></ul><br>  рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╡рд╣ рдХреБрдЫ рдЦрд╛рдорд┐рдпреЛрдВ рд╕реЗ рднреА рдЧреНрд░рд╕реНрдд рд╣реИ: <br><br><ul><li>  <strong>рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреА рддрдХрдиреАрдХреА рдЬрдЯрд┐рд▓рддрд╛ред</strong>  рдЕрдкрдиреЗ рдЖрдк рд╕реЗ, рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕рдВрдХреЗрдд рдХреА рдЬрдЧрд╣ рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реИред  рд▓реЗрдХрд┐рди рд╕рдВрдмрдВрдзрд┐рдд рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЧреИрд░-рд╕реНрдкрд╖реНрдЯ рд╕рдорд╛рдзрд╛рди рдФрд░ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдпреЛрдЧреНрдпрддрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: <br><ul><li>  рдЦреЛрдЬ рдкреНрд░рдгрд╛рд▓реА рдХреЙрд▓ рддрд╛рд▓рд┐рдХрд╛ </li><li>  рддрд╛рд▓рд┐рдХрд╛ рд╕рдВрд╢реЛрдзрди рд╕рдВрд░рдХреНрд╖рдг рдмрд╛рдИрдкрд╛рд╕ </li><li>  рдкрд░рдорд╛рдгреБ рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди </li></ul><br>  рдпреЗ рд╕рднреА рджрд┐рд▓рдЪрд╕реНрдк рдЪреАрдЬреЗрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдиреНрд╣реЗрдВ рдореВрд▓реНрдпрд╡рд╛рди рд╡рд┐рдХрд╛рд╕ рд╕рдордп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдкрд╣рд▓реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд▓рд┐рдП, рдФрд░ рдлрд┐рд░ рд╕рдорд░реНрдерди рдФрд░ рд╕рдордЭ рдХреЗ рд▓рд┐рдПред <br></li><li>  <strong>рдХреБрдЫ рд╣реИрдВрдбрд▓рд░ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрдерддрд╛ред</strong>  рд╕рдВрд╕реНрдХрд░рдг 4.16 рд╕реЗ рдкрд╣рд▓реЗ рдЧреБрдард▓реА рдореЗрдВ, x86_64 рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╣реИрдВрдбрд▓рд┐рдВрдЧ рдореЗрдВ рдХрдИ рдЕрдиреБрдХреВрд▓рди рдереЗред  рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдиреЗ рдорд╛рдВрдЧ рдХреА рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╣реИрдВрдбрд▓рд░ рдХреЛрдбрд╛рдВрддрд░рдХ рдореЗрдВ рд▓рд╛рдЧреВ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдПрдбрд╛рдкреНрдЯрд░ рд╣реЛред  рддрджрдиреБрд╕рд╛рд░, рдРрд╕реЗ рд╣реИрдВрдбрд▓рд░ рдХрднреА-рдХрднреА рдореБрд╢реНрдХрд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ, рдФрд░ рдХрднреА-рдХрднреА рд╕реА рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╕рд╛рде рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЕрд╕рдВрднрд╡ рд╣реЛрддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХрд░реНрдиреЗрд▓ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдЕрдиреБрдХреВрд▓рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЧреБрд▓реНрд▓рдХ рдореЗрдВ рддрдХрдиреАрдХреА рдХрдард┐рдирд╛рдЗрдпреЛрдВ рдХреЛ рдЬреЛрдбрд╝рддрд╛ рд╣реИред <br></li><li>  <strong>рдХреЗрд╡рд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рд╣реИрдВред</strong>  рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЖрдкрдХреЛ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╣реИрдВрдбрд▓рд░реНрд╕ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдХреЗрд╡рд▓ рдЙрдирдХреЗ рдкрд╛рд╕ рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред  рд╕рднреА рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдВрдЪ рдпрд╛ рддреЛ рд╢реБрд░реБрдЖрдд рдореЗрдВ рдпрд╛ рдЕрдВрдд рдореЗрдВ рдХреА рдЬрд╛рддреА рд╣реИрдВ, рдФрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдФрд░ рдЙрд╕рдХреЗ рд░рд┐рдЯрд░реНрди рдорд╛рди рдХреЗ рддрд░реНрдХ рд╣реИрдВред  рдХрднреА-рдХрднреА рдпрд╣ рддрд░реНрдХреЛрдВ рдФрд░ рдкрд╣реБрдВрдЪ рдЬрд╛рдВрдЪ рдХреА рдкрд░реНрдпрд╛рдкреНрддрддрд╛ рдкрд░ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдЪреЗрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИред  рдХрднреА-рдХрднреА рдпрд╣ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдУрд╡рд░рд╣реЗрдб рдХрд╛ рдХрд╛рд░рдг рдмрдирддрд╛ рд╣реИ рдЬрдм рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рдореЗрдореЛрд░реА рдХреЛ рджреЛ рдмрд╛рд░ рдХреЙрдкреА рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ: рдпрджрд┐ рддрд░реНрдХ рдПрдХ рд╕реВрдЪрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╛рд░рд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдкрд╣рд▓реЗ рдЗрд╕реЗ рдЦреБрдж рдХреЛ рдХреЙрдкреА рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдлрд┐рд░ рдореВрд▓ рд╣реИрдВрдбрд▓рд░ рдЕрдкрдиреЗ рд▓рд┐рдП рдлрд┐рд░ рд╕реЗ рддрд░реНрдХ рдХреЛ рдХреЙрдкреА рдХрд░реЗрдЧрд╛ред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдмрд╣реБрдд рдХрдо рдШрдЯрдирд╛рдУрдВ рдХреА рдПрдХ рдЧреНрд░реИрдиреНрдпреБрд▓реИрд░рд┐рдЯреА рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╢реЛрд░ рд╕реЗ рдЕрддрд┐рд░рд┐рдХреНрдд рд░реВрдк рд╕реЗ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдирд╛ рдкрдбрд╝рддрд╛ рд╣реИред <br></li></ul><br>  рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рд╣рдордиреЗ рд╕рд┐рд╕реНрдЯрдо рдХреА рд╕рдмрд╕реЗ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд╛рднреЛрдВ рдХрд╛ рдкреАрдЫрд╛ рдХрд░рддреЗ рд╣реБрдП, рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдЪреБрдирд╛ рдФрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЙрд╕ рд╕рдордп рд╣рдореЗрдВ рдЕрднреА рднреА x86_64 рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдФрд░ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рдХреЙрд▓ рдкрд░ рдкреНрд░рддрд┐рдмрдВрдз рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рдкрддрд╛ рдерд╛ред  рдмрд╛рдж рдореЗрдВ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛ рдЧрдпрд╛ - рдХреНрд▓реЛрди () рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд () - рдЬреЛ рдЕрднреА рд╡рд┐рд╢реЗрд╖ рд╣реИред  рдЗрд╕реА рдиреЗ рд╣рдореЗрдВ рдирдП рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд┐рдпрд╛ред <br><br><h3>  Kprobes рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </h3><br>  рдЬрд┐рди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, <em>рдЙрдирдореЗрдВ рд╕реЗ</em> рдПрдХ <em>kprobes</em> рдХрд╛ рдЙрдкрдпреЛрдЧ рдерд╛: рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдбреАрдмрдЧрд┐рдВрдЧ рдФрд░ рдХрд░реНрдиреЗрд▓ рдХреЛ рдЯреНрд░реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ APIред  рдпрд╣ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдЖрдкрдХреЛ рдХрд░реНрдиреЗрд▓ рдореЗрдВ <em>рдХрд┐рд╕реА рднреА рдирд┐рд░реНрджреЗрд╢ рдХреЗ</em> рд▓рд┐рдП рдкреНрд░реА-рдФрд░ рдкреЛрд╕реНрдЯ-рд╣реИрдВрдбрд▓рд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╕рд╛рде рд╣реА рдПрдХ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдФрд░ рд▓реМрдЯрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрдВрдбрд▓рд░ рднреАред  рд╣реИрдВрдбрд▓рд░реНрд╕ рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рдХрд╛рдо рдХреЗ рдЖрдЧреЗ рдХреЗ рдкрд╛рдареНрдпрдХреНрд░рдо рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рджреЛрдиреЛрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рдереЗред <br><br>  рдЕрд╡рд░реЛрдзрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд╛рдн: <br><br><ul><li>  <strong>рдкрд░рд┐рдкрдХреНрд╡ рдПрдкреАрдЖрдИред</strong>  Kprobes рдЕрд╕реНрддрд┐рддреНрд╡ рдореЗрдВ рд╣реИ рдФрд░ рд╕рдордп рд╕реЗ рд╕реБрдзрд╛рд░ рд╣реБрдЖ рд╣реИ (2002)ред  рдЙрдирдХреЗ рдкрд╛рд╕ рдПрдХ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдкреНрд░рд▓реЗрдЦрд┐рдд рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╣реИ, рдЕрдзрд┐рдХрд╛рдВрд╢ рдиреБрдХрд╕рд╛рди рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкрд╛рдП рдЧрдП рд╣реИрдВ, рдЙрдирдХреЗ рдХрд╛рдо рдХреЛ рдпрдерд╛рд╕рдВрднрд╡ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдЗрд╕реА рддрд░рд╣ред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдкреНрд░рд╛рдпреЛрдЧрд┐рдХ рд╕реНрд╡-рдирд┐рд░реНрдорд┐рдд рдмрд╛рдЗрдХ рдкрд░ рдлрд╛рдпрджреЗ рдХрд╛ рдПрдХ рдкреВрд░рд╛ рдкрд╣рд╛рдбрд╝ред <br></li><li>  <strong>рдХреЛрд░ рдореЗрдВ рдХрд┐рд╕реА рднреА рдЬрдЧрд╣ рдХрд╛ рдЕрд╡рд░реЛрдзрдиред</strong>  Kprobes рдХреЛ рдХрд░реНрдиреЗрд▓ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдХреЛрдб рдореЗрдВ рдПрдореНрдмреЗрдбреЗрдб рдмреНрд░реЗрдХрдкреНрд╡рд╛рдЗрдВрдЯ (int3 рдирд┐рд░реНрджреЗрд╢) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рдЖрдкрдХреЛ рдХрд┐рд╕реА рднреА рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдХрд╣реАрдВ рднреА, рдпрджрд┐ рдЬреНрдЮрд╛рдд рд╣реЛ рддреЛ рдХрд╛рдкреНрд░реЛрдмреНрд╕ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдЗрд╕реА рддрд░рд╣, рдХреНрд░реЗрдЯрдкреНрд░реЙрдмреНрд╕ рдХреЛ рд╕реНрдЯреИрдХ рдкрд░ рд░рд┐рдЯрд░реНрди рдПрдбреНрд░реЗрд╕ рдХреЛ рдЦрд░рд╛рдм рдХрд░рдиреЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЖрдкрдХреЛ рдХрд┐рд╕реА рднреА рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рд░рд┐рдЯрд░реНрди рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ (рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рдЕрдкрд╡рд╛рдж рдХреЗ рд╕рд╛рде рдЬреЛ рд╕рд┐рджреНрдзрд╛рдВрдд рдореЗрдВ рдирд┐рдпрдВрддреНрд░рдг рд╡рд╛рдкрд╕ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ)ред <br></li></ul><br>  Kprobes рдХреЗ рдиреБрдХрд╕рд╛рди: <br><br><ul><li>  <strong>рддрдХрдиреАрдХреА рдХрдард┐рдирд╛рдИред</strong>  Kprobes рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдХрд╣реАрдВ рднреА рдПрдХ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рд╕реЗрдЯ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИред  рдХрд┐рд╕реА рдлрд╝рдВрдХреНрд╢рди рдпрд╛ рд╕реНрдерд╛рдиреАрдп рдЪрд░реЛрдВ рдХреЗ рдорд╛рдиреЛрдВ рдХреЗ рддрд░реНрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдХреМрди рд╕реЗ рд░рдЬрд┐рд╕реНрдЯрд░ рдпрд╛ рдЬрд╣рд╛рдВ рд╡реЗ рд╕реНрдерд┐рдд рд╣реИрдВ, рдФрд░ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдЙрдиреНрд╣реЗрдВ рд╡рд╣рд╛рдВ рд╕реЗ рд╣рдЯрд╛ рджреЗрдВред  рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХреЛ рдмреНрд▓реЙрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЛ рд▓рдЧреЗ рдХрд┐ рдпрд╣ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдкрд╣рд▓реЗ рд╣реА рдирд┐рдпрдВрддреНрд░рдг рд╡рд╛рдкрд╕ рдХрд░ рдЪреБрдХрд╛ рд╣реИред <br></li><li>  <strong>Jprobes рдХреЛ рдкрджрд╛рд╡рдирдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</strong>  Jprobes kprobes рдХреЗ рд▓рд┐рдП рдПрдХ рдРрдб-рдСрди рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдпрд╣ рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдпрд╛ рд╕реНрдЯреИрдХ рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рддрд░реНрдХреЛрдВ рдХреЛ рд╣рдЯрд╛ рджреЗрдЧрд╛ рдФрд░ рдЖрдкрдХреЗ рд╣реИрдВрдбрд▓рд░ рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛, рдЬрд┐рд╕рдореЗрдВ рд╣реБрдХ рдХрд┐рдП рдЧрдП рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рдорд╛рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдкрдХрдбрд╝ рдпрд╣ рд╣реИ рдХрд┐ рдЬрд┐рдкрд░ рдХреЛ рдЖрдзреБрдирд┐рдХ рдЧреБрдард▓реА рд╕реЗ рдирд┐рдХрд╛рд▓рд╛ рдФрд░ рдХрд╛рдЯрд╛ рдЬрд╛рддрд╛ рд╣реИред <br></li><li>  <strong>рдЧреИрд░-рддреБрдЪреНрдЫ рдУрд╡рд░рд╣реЗрдбред</strong>  рдмреНрд░реЗрдХрдкреНрд╡рд╛рдЗрдВрдЯ рдорд╣рдВрдЧреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдПрдХ рдмрд╛рд░ред  рдмреНрд░реЗрдХрдкреНрд╡рд╛рдЗрдВрдЯ рдЕрдиреНрдп рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдирдХрд╛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдорд╣рдВрдЧрд╛ рд╣реИред  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, x86_64 рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП рдЬрдВрдк-рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝реЗрд╢рди рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдХрд┐рдкреНрд░реЛрдмреНрд╕ рдХреА рд▓рд╛рдЧрдд рдХреЛ рдХрд╛рдлреА рдХрдо рдХрд░ рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрднреА рднреА рдЕрдзрд┐рдХ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬрдм рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдЯреЗрдмрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддрд╛ рд╣реИред <br></li><li>  <strong>рдХреНрд░реЗрдЯрдкреНрд░реЛрдмреНрд╕ рдХреА рд╕реАрдорд╛рдПрдВред</strong>  рд╕реНрдЯреИрдХ рдкрд░ рд░рд┐рдЯрд░реНрди рдПрдбреНрд░реЗрд╕ рдХреЛ рд╕реНрдкреВрдл рдХрд░рдХреЗ рдХреНрд░реЗрдЯрдкреНрд░реЛрдмреНрд╕ рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рддрджрдиреБрд╕рд╛рд░, рдЙрдиреНрд╣реЗрдВ рдХреНрд░реЗрдЯрдкреНрд░реЛрдм рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рдмрд╛рдж рд╡рд╣рд╛рдВ рд▓реМрдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдореВрд▓ рдкрддреЗ рдХреЛ рдХрд╣реАрдВ рд╕реНрдЯреЛрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдкрддреЗ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЖрдХрд╛рд░ рдХреЗ рдмрдлрд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдЕрддрд┐рдкреНрд░рд╡рд╛рд╣ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЬрдм рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдПрдХ рд╕рд╛рде рдХрдИ рдХреЙрд▓ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдХреНрд░реЗрдЯрдкреНрд░реЙрдмреНрд╕ рдСрдкрд░реЗрд╢рди рдХреЛ рдЫреЛрдбрд╝ рджреЗрдЧрд╛ред <br></li><li>  <strong>рд╡рд┐рдХрд▓рд╛рдВрдЧ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓рдирд╛ред</strong>  рдЪреВрдБрдХрд┐ kprobes interrupts рдФрд░ juggles рдкреНрд░реЛрд╕реЗрд╕рд░ рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рд┐рдВрдХреНрд░реЛрдирд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рд▓рд┐рдП рд╕рднреА рд╣реИрдВрдбрд▓рд░ рдХреЛ рдкреНрд░реАрдЗрдореНрдкреЗрдХреНрд╢рди рдбрд┐рд╕реЗрдмрд▓ рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рд╣реИрдВрдбрд▓рд░ рдкрд░ рдХреБрдЫ рдкреНрд░рддрд┐рдмрдВрдз рд▓рдЧрд╛рддрд╛ рд╣реИ: рдЖрдк рдЙрдирдореЗрдВ рдЗрдВрддрдЬрд╛рд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рдмрд╣реБрдд рд╕рд╛рд░реА рдореЗрдореЛрд░реА рдЖрд╡рдВрдЯрд┐рдд рдХрд░реЗрдВ, рдХреНрдпрд╛ рдореИрдВ / рдУ, рдЯрд╛рдЗрдорд░ рдФрд░ рд╕реЗрдорд╛рдлреЛрд░рд╕ рдореЗрдВ рдиреАрдВрдж, рдФрд░ рдЕрдиреНрдп рдЬреНрдЮрд╛рдд рдЪреАрдЬреЗрдВред <br></li></ul><br>  рд╡рд┐рд╖рдп рдкрд░ рд╢реЛрдз рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ, рд╣рдорд╛рд░реА рдирдЬрд╝рд░ рдлрд╝реБрдЯреНрд░реЗрд╕ рдлреНрд░реЗрдорд╡рд░реНрдХ рдкрд░ рдкрдбрд╝реА, рдЬреЛ рдЬрд┐рдкрд░ рдХреЛ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдирд┐рдХрд▓рд╛, рдпрд╣ рд╣рдорд╛рд░реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдЕрд╡рд░реЛрдзрди рдХреА рдЬрд░реВрд░рддреЛрдВ рдХреЗ рд▓рд┐рдП рдмреЗрд╣рддрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдЖрдкрдХреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рднреАрддрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ kprobes рдХреЛ рдЫреВрдЯ рдирд╣реАрдВ рджреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред <br><br><h3>  рд╕реНрдкреНрд▓рд┐рд╕рд┐рдВрдЧ </h3><br>  рдкреВрд░реНрдгрддрд╛ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯрд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди рдХреА рд╢рд╛рд╕реНрддреНрд░реАрдп рд╡рд┐рдзрд┐ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рд▓рд╛рдпрдХ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рдмрд┐рдирд╛ рд╣рдорд╛рд░реЗ рд╣реИрдВрдбрд▓рд░ рдХреЗ рд▓рд┐рдП рдмрд┐рдирд╛ рд╢рд░реНрдд рд╕рдВрдХреНрд░рдордг рд╣реЛрддрд╛ рд╣реИред  рдореВрд▓ рдирд┐рд░реНрджреЗрд╢ рджреВрд╕рд░реА рдЬрдЧрд╣ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рдлрд╝рдВрдХреНрд╢рди рдкрд░ рд╡рд╛рдкрд╕ рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред  рджреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдмрджрд▓рд╛рд╡реЛрдВ рдХреА рдорджрдж рд╕реЗ рд╣рдо рдЕрдкрдиреЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЛрдб рдХреЛ рдлрдВрдХреНрд╢рди рдореЗрдВ рдПрдореНрдмреЗрдб (рд╡рд┐рднрд╛рдЬрд┐рдд) рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ <em>рд╕реНрдкрд╛рдЗрд╕рд▓рд┐рдВрдЧ</em> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдпрд╣ рд╣реИ рдХрд┐ рдХреИрд╕реЗ kprobes рдХреЗ рд▓рд┐рдП рдХреВрдж рдЕрдиреБрдХреВрд▓рди рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕реНрдкреНрд▓рд┐рд╕рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк рдПрдХ рд╣реА рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди kprobes рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рд▓рд╛рдЧрдд рдХреЗ рдмрд┐рдирд╛ рдФрд░ рд╕реНрдерд┐рддрд┐ рдХреЗ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рд╕рд╛рдеред <br><br>  рд╕реНрдкреНрд▓рд┐рд╕рд┐рдВрдЧ рдХреЗ рд▓рд╛рдн рд╕реНрдкрд╖реНрдЯ рд╣реИрдВ: <br><br><ul><li>  <strong>рдиреНрдпреВрдирддрдо рдХрд░реНрдиреЗрд▓ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБред</strong>  рдмрдВрдЯрд╡рд╛рд░реЗ рдХреЛ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рд╡рд┐рдХрд▓реНрдк рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ рдФрд░ рдХрд┐рд╕реА рднреА рдлрд╝рдВрдХреНрд╢рди рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рдЖрдкрдХреЛ рдмрд╕ рдЙрд╕рдХрд╛ рдкрддрд╛ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ред <br></li><li>  <strong>рдиреНрдпреВрдирддрдо рдУрд╡рд░рд╣реЗрдбред</strong>  рджреЛ рдмрд┐рдирд╛ рд╢рд░реНрдд рд╕рдВрдХреНрд░рдордг - рдХрд┐ рд╣реИрдВрдбрд▓рд░ рдФрд░ рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд рдирд┐рдпрдВрддреНрд░рдг рд╣рд╕реНрддрд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд╡рд░реЛрдзрди рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕рдВрдХреНрд░рдордг рдкреНрд░реЛрд╕реЗрд╕рд░ рджреНрд╡рд╛рд░рд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдиреБрдорд╛рдирд┐рдд рд╣реИрдВ рдФрд░ рдмрд╣реБрдд рд╕рд╕реНрддреЗ рд╣реИрдВред <br></li></ul><br>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдореБрдЦреНрдп рджреЛрд╖ рдЧрдВрднреАрд░рддрд╛ рд╕реЗ рдЪрд┐рддреНрд░ рдкрд░ рдмрд╛рджрд▓ рд╣реИ: <br><br><ul><li>  <strong>рддрдХрдиреАрдХреА рдХрдард┐рдирд╛рдИред</strong>  рд╡рд╣ рд▓реБрдврд╝рдХ рдЬрд╛рддреА рд╣реИред  рдЖрдк рдорд╢реАрди рдХреЛрдб рдХреЛ рдХреЗрд╡рд▓ рд▓реЗ рдФрд░ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦ рдирд╣реАрдВ рд╕рдХрддреЗред  рдпрд╣рд╛рдВ рд╣рд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдХрд╛рд░реНрдпреЛрдВ рдХреА рдПрдХ рдЫреЛрдЯреА рдФрд░ рдЕрдзреВрд░реА рд╕реВрдЪреА рджреА рдЧрдИ рд╣реИ: <br><ul><li>  рдЕрд╡рд░реЛрдзрди рдХреА рд╕реНрдерд╛рдкрдирд╛ рдФрд░ рд╣рдЯрд╛рдиреЗ рдХрд╛ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝реЗрд╢рди (рдпрджрд┐ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕реАрдзреЗ рдЕрдкрдиреЗ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдХреНрдпрд╛ рд╣реЛрдЧрд╛)? </li><li>  рдПрдХ рдХреЛрдб рдХреЗ рд╕рд╛рде рд╕реНрдореГрддрд┐ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рд╕рдВрд╢реЛрдзрди рдкрд░ рд╕рдВрд░рдХреНрд╖рдг рдХрд╛ рдмрд╛рдИрдкрд╛рд╕ </li><li>  рдирд┐рд░реНрджреЗрд╢ рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рдж рд╕реАрдкреАрдпреВ рдХреИрд╢ рдЕрдорд╛рдиреНрдп </li><li>  рдмрджрд▓реА рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдирд┐рд░реНрджреЗрд╢ рдЙрдиреНрд╣реЗрдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХреЙрдкреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП </li><li>  рдмрджрд▓реЗ рд╣реБрдП рдЯреБрдХрдбрд╝реЗ рдХреЗ рдЕрдВрджрд░ рд╕рдВрдХреНрд░рдордг рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдЬрд╛рдБрдЪ рдХрд░рдирд╛ </li><li>  рдмрджрд▓реЗ рд╣реБрдП рдЯреБрдХрдбрд╝реЗ рдХреЛ рджреВрд╕рд░реЗ рд╕реНрдерд╛рди рдкрд░ рд▓реЗ рдЬрд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ </li></ul><br>  рд╣рд╛рдВ, рдЖрдк kprobes рдХреА рдЬрд╛рд╕реВрд╕реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд▓рд╛рдЗрд╡рдкреИрдЪ рдЗрдВрдЯреНрд░рд╛рдиреНрдпреВрдХреНрд▓рд┐рдпрд░ рдлреНрд░реЗрдорд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЕрдВрддрд┐рдо рд╕рдорд╛рдзрд╛рди рдЕрднреА рднреА рдХрд╛рдлреА рдЬрдЯрд┐рд▓ рд╣реИред  рдпрд╣ рдХрд▓реНрдкрдирд╛ рдХрд░рдирд╛ рдбрд░рд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдирдП рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдиреАрдВрдж рдХреА рдХрд┐рддрдиреА рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реЛрдВрдЧреАред <br></li></ul><br>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдпрджрд┐ рдЖрдк рдЗрд╕ рджрд╛рдирд╡ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВ, рддреЛ рдпрд╣ рдХреЗрд╡рд▓ рджреАрдХреНрд╖рд╛ рдХреЗ рдЕрдзреАрди рд╣реИ, рдФрд░ рдЗрд╕реЗ рдЖрдкрдХреЗ рдХреЛрдб рдореЗрдВ рд╕рд╣рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИ, рддреЛ рд╕реНрдкрд╛рдЗрд╕реАрд▓рд┐рдВрдЧ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рд╣реИред  рдореЗрд░реЗ рдкрд╛рд╕ рд╕рд╛рдЗрдХрд┐рд▓ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдХрд╛рд░рд╛рддреНрдордХ рд░рд╡реИрдпрд╛ рдерд╛, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╡рд┐рдХрд▓реНрдк рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдПрдХ рдмреИрдХрдЕрдк рдмрдирд╛ рд░рд╣рд╛ рдЬрдм рдХрд┐ рддреИрдпрд╛рд░ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдХреЛрдИ рднреА рдкреНрд░рдЧрддрд┐ рдЖрд╕рд╛рди рдирд╣реАрдВ рд╣реЛрдЧреАред <br><br><h2>  рдирдП рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде </h2><br>  <strong>рдлреНрд░реЗрд╕</strong> рдПрдХ рдлрдВрдХреНрд╢рди-рд▓реЗрд╡рд▓ рдХрд░реНрдиреЗрд▓ рдЯреНрд░реЗрд╕рд┐рдВрдЧ рдлреНрд░реЗрдорд╡рд░реНрдХ рд╣реИред  рдпрд╣ 2008 рд╕реЗ рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╢рд╛рдирджрд╛рд░ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╣реИред  рдлреНрд░реЗрд╕реНрд░реЗрд╕ рдЖрдкрдХреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХреА рдЖрд╡реГрддреНрддрд┐ рдФрд░ рдЕрд╡рдзрд┐ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ, рдХреЙрд▓ рдЧреНрд░рд╛рдлрд╝ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ, рдЯреЗрдореНрдкрд▓реЗрдЯ рджреНрд╡рд╛рд░рд╛ рд░реБрдЪрд┐ рдХреЗ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕реА рддрд░рд╣ред  рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ рд╕реЗ</a> ftrace рдлреАрдЪрд░реНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрдврд╝рдирд╛ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрдВ</a> , рдФрд░ рдлрд┐рд░ рд▓рд┐рдВрдХ рдФрд░ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдкреНрд░рд▓реЗрдЦрди рдХрд╛ рдкрд╛рд▓рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдпрд╣ рд╕рдВрдХрд▓рдХ рдХреБрдВрдЬреА <code>-pg</code> рдФрд░ <code>-mfentry</code> рдЖрдзрд╛рд░ рдкрд░ <code>-pg</code> рдХреЛ <code>-mfentry</code> , рдЬреЛ рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рдВрдХреНрд╢рди рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╡рд┐рд╢реЗрд╖ рдЯреНрд░реЗрд╕ рдлрд╝рдВрдХреНрд╢рди mcount () рдпрд╛ __fentry __ () рдореЗрдВ рдХреЙрд▓ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рддрд╛ рд╣реИред  рдЖрдорддреМрд░ рдкрд░, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдореЗрдВ, рдЗрд╕ рд╕рдВрдХрд▓рдХ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд░реЛрдлрд╛рдЗрд▓рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХреЙрд▓ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдХрд░реНрдиреЗрд▓ рдЗрди рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдлрд╝реБрдЯреНрд░реЗрд╕ рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддрд╛ рд╣реИред <br><br>  рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ <em>рдкреНрд░рддреНрдпреЗрдХ</em> рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдХреЙрд▓рд┐рдВрдЧ рдлрд╝реЗрдпрд░, рд╕рд╕реНрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд▓реЛрдХрдкреНрд░рд┐рдп рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдХреВрд▓рди рдЙрдкрд▓рдмреНрдз рд╣реИ: <em>рдбрд╛рдпрдиреЗрдорд┐рдХ рдлрд╝реНрд░реЗрд╕</em> ред  рд▓рдмреНрдмреЛрд▓реБрдЖрдм рдпрд╣ рд╣реИ рдХрд┐ рдХрд░реНрдиреЗрд▓ рд╕рднреА рдХреЙрд▓ рдХреЗ рд╕реНрдерд╛рди рдХреЛ mcount () рдпрд╛ __fentry __ () рдХреЗ рд░реВрдк рдореЗрдВ рдЬрд╛рдирддрд╛ рд╣реИ рдФрд░ рд▓реЛрдбрд┐рдВрдЧ рдХреЗ рд╢реБрд░реБрдЖрддреА рдЪрд░рдгреЛрдВ рдореЗрдВ рдЙрдирдХреЗ рдорд╢реАрди рдХреЛрдб рдХреЛ <strong>nop рд╕реЗ</strong> рдмрджрд▓ рджреЗрддрд╛ рд╣реИ - рдПрдХ рд╡рд┐рд╢реЗрд╖ рдирд┐рд░реНрджреЗрд╢ рдЬреЛ рдХреБрдЫ рднреА рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рдЬрдм рдЯреНрд░реЗрд╕рд┐рдВрдЧ рдХреЛ рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ ftrace рдХреЙрд▓реНрд╕ рдХреЛ рд╡рд╛рдкрд╕ рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЕрдЧрд░ ftrace рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдЗрд╕рдХрд╛ рдкреНрд░рднрд╛рд╡ рдХрдо рд╕реЗ рдХрдо рд╣реИред <br><br><h3>  рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рд╡рд┐рд╡рд░рдг </h3><br>  рдкреНрд░рддреНрдпреЗрдХ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдВрд░рдЪрдирд╛ рджреНрд╡рд╛рд░рд╛ рд╡рд░реНрдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/** * struct ftrace_hook -    * * @name:    * * @function:  -,     *   * * @original:   ,     *  ,    * * @address:   ,    * * @ops:   ftrace,  , *      */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_hook</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *function; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *original; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> address; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_ops</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class">;</span></span> };</code> </pre><br>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдХреЗрд╡рд▓ рдкрд╣рд▓реЗ рддреАрди рдлрд╝реАрд▓реНрдб рднрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: рдирд╛рдо, рдлрд╝рдВрдХреНрд╢рди, рдореВрд▓ред  рд╢реЗрд╖ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдПрдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╡рд┐рд╡рд░рдг рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рднреА рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╡рд┐рд╡рд░рдг рдХреЛ рдПрдХ рд╕рд░рдгреА рдореЗрдВ рдЗрдХрдЯреНрдард╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдореИрдХреНрд░реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЛрдб рдХреА рдХреЙрдореНрдкреИрдХреНрдЯрдиреЗрд╕ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> HOOK(_name, _function, _original) \ { \ .name = (_name), \ .function = (_function), \ .original = (_original), \ } static struct ftrace_hook hooked_functions[] = { HOOK(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sys_clone"</span></span></span><span class="hljs-meta">, fh_sys_clone, &amp;real_sys_clone), HOOK(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sys_execve"</span></span></span><span class="hljs-meta">, fh_sys_execve, &amp;real_sys_execve), };</span></span></code> </pre><br>  рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд┐рдП рдЧрдП рдХрд╛рд░реНрдпреЛрдВ рдкрд░ рд░реИрдкрд░реНрд╕ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╣реИрдВ: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* *        execve(). *     .      *  :       , *    ABI (  "asmlinkage"). */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> asmlinkage </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">long</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*real_sys_execve)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *envp)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *      .   тАФ  *   .      *  .      ,  *    . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> asmlinkage </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_sys_execve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *envp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ret; pr_debug(<span class="hljs-string"><span class="hljs-string">"execve() called: filename=%p argv=%p envp=%p\n"</span></span>, filename, argv, envp); ret = real_sys_execve(filename, argv, envp); pr_debug(<span class="hljs-string"><span class="hljs-string">"execve() returns: %ld\n"</span></span>, ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдиреНрдпреВрдирддрдо рдЕрддрд┐рд░рд┐рдХреНрдд рдХреЛрдб рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рдлрд╝рдВрдХреНрд╢рдиред  рдХреЗрд╡рд▓ рдПрдХ рд╣реА рдЪреАрдЬ рдкрд░ рдзреНрдпрд╛рди рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдлрд╝рдВрдХреНрд╢рди рд╣рд╕реНрддрд╛рдХреНрд╖рд░ред  рдЙрдиреНрд╣реЗрдВ рдПрдХ рд╕реЗ рдореЗрд▓ рдЦрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЗрд╕рдХреЗ рдмрд┐рдирд╛, рдЬрд╛рд╣рд┐рд░ рд╣реИ, рддрд░реНрдХреЛрдВ рдХреЛ рдЧрд▓рдд рддрд░реАрдХреЗ рд╕реЗ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рд╕рдм рдХреБрдЫ рдбрд╛рдЙрдирд╣рд┐рд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред  рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдХрдо рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЙрдирдХреЗ рд╣реИрдВрдбрд▓рд░ рдмрд╣реБрдд рд╕реНрдерд┐рд░ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рджрдХреНрд╖рддрд╛ рдХреЗ рд▓рд┐рдП рдЙрд╕реА рдХреНрд░рдо рдореЗрдВ рддрд░реНрдХ рд▓реЗрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рд╕рд┐рд╕реНрдЯрдо рдЦреБрдж рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рдЖрдк рдЕрдиреНрдп рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд░реЛрдХрдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдпрд╛рдж рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд░реНрдиреЗрд▓ рдХреЗ рдЕрдВрджрд░ рдХреЛрдИ рд╕реНрдерд┐рд░ рдЗрдВрдЯрд░рдлреЗрд╕ рдирд╣реАрдВ рд╣реИрдВ</a> ред <br><br><h3>  рдлреБрдЯреНрд░реЗрд╕ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди </h3><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рдЙрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдвреВрдВрдврдирд╛ рдФрд░ рд╕рд╣реЗрдЬрдирд╛ рд╣реЛрдЧрд╛ рдЬрд┐рд╕реЗ рд╣рдо рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░реЗрдВрдЧреЗред  Ftrace рдЖрдкрдХреЛ рдирд╛рдо рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдЕрднреА рднреА рдЗрд╕реЗ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореВрд▓ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рдЖрдк <em>kallsyms</em> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рдХрд░реНрдиреЗрд▓ рдореЗрдВ рд╕рднреА рдкрд╛рддреНрд░реЛрдВ рдХреА рдПрдХ рд╕реВрдЪреАред  рдЗрд╕ рд╕реВрдЪреА рдореЗрдВ <em>рд╕рднреА</em> рд╡рд░реНрдг рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рди рдХреЗрд╡рд▓ рдореЙрдбреНрдпреВрд▓ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдпрд╛рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╣реБрдХ рдХрд┐рдП рдЧрдП рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╣реИ: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve_hook_address</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct ftrace_hook *hook)</span></span></span><span class="hljs-function"> </span></span>{ hook-&gt;address = kallsyms_lookup_name(hook-&gt;name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!hook-&gt;address) { pr_debug(<span class="hljs-string"><span class="hljs-string">"unresolved symbol: %s\n"</span></span>, hook-&gt;name); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -ENOENT; } *((<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>*) hook-&gt;original) = hook-&gt;address; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  рдЕрдЧрд▓рд╛, рдЖрдкрдХреЛ <code>ftrace_ops</code> рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреА <code>ftrace_ops</code> рд╣реИред  рдпрд╣ рдмрд╛рдзреНрдпрдХрд╛рд░реА рд╣реИ <br>  рдлрд╝реАрд▓реНрдб рдПрдХ рдХреЙрд▓рдмреИрдХ рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ <br>  рдХреБрдЫ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЭрдВрдбреЗ рд╕реЗрдЯ рдХрд░реЗрдВ: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_install_hook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct ftrace_hook *hook)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> err; err = resolve_hook_address(hook); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err; hook-&gt;ops.func = fh_ftrace_thunk; hook-&gt;ops.flags = FTRACE_OPS_FL_SAVE_REGS | FTRACE_OPS_FL_IPMODIFY; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre><br>  <em>fh_ftrace_thunk</em> () рд╣рдорд╛рд░реА рдХреЙрд▓рдмреИрдХ рд╣реИ рдЬрд┐рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЯреНрд░реЗрд╕ рдХрд░рддреЗ рд╕рдордп ftrace рдХреЙрд▓ рдХрд░реЗрдЧрд╛ред  рдЙрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдж рдореЗрдВред  рдЕрд╡рд░реЛрдзрди рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЭрдВрдбреЗ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдВрдЧреЗред  рд╡реЗ рдкреНрд░реЛрд╕реЗрд╕рд░ рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреЛ рд╕рд╣реЗрдЬрдиреЗ рдФрд░ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ftrace рдХрд╛ рдирд┐рд░реНрджреЗрд╢ рджреЗрддреЗ рд╣реИрдВ, рдЬрд┐рдирдХреА рд╕рд╛рдордЧреНрд░реА рд╣рдо рдХреЙрд▓рдмреИрдХ рдореЗрдВ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЕрдм рд╣рдо рдЕрд╡рд░реЛрдзрди рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ ftrace_set_filter_ip () рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд░реБрдЪрд┐ рдХреЗ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП ftrace рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдФрд░ рдлрд┐рд░ ftrace рдХреЛ register_ftrace_function () рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рдорд╛рд░реЗ рдХреЙрд▓рдмреИрдХ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВ: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_install_hook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct ftrace_hook *hook)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> err = ftrace_set_filter_ip(&amp;hook-&gt;ops, hook-&gt;address, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { pr_debug(<span class="hljs-string"><span class="hljs-string">"ftrace_set_filter_ip() failed: %d\n"</span></span>, err); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err; } err = register_ftrace_function(&amp;hook-&gt;ops); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { pr_debug(<span class="hljs-string"><span class="hljs-string">"register_ftrace_function() failed: %d\n"</span></span>, err); <span class="hljs-comment"><span class="hljs-comment">/*    ftrace   . */</span></span> ftrace_set_filter_ip(&amp;hook-&gt;ops, hook-&gt;address, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  рдЕрд╡рд░реЛрдзрди рдХреЛ рдЙрд╕реА рддрд░рд╣ рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХреЗрд╡рд▓ рд░рд┐рд╡рд░реНрд╕ рдСрд░реНрдбрд░ рдореЗрдВ: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_remove_hook</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct ftrace_hook *hook)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> err; err = unregister_ftrace_function(&amp;hook-&gt;ops); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { pr_debug(<span class="hljs-string"><span class="hljs-string">"unregister_ftrace_function() failed: %d\n"</span></span>, err); } err = ftrace_set_filter_ip(&amp;hook-&gt;ops, hook-&gt;address, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { pr_debug(<span class="hljs-string"><span class="hljs-string">"ftrace_set_filter_ip() failed: %d\n"</span></span>, err); } }</code> </pre><br>  Unregister_ftrace_function () рдХреЗ рдХреЙрд▓ рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХреЙрд▓рдмреИрдХ рдХреА рд╕рдХреНрд░рд┐рдпрддрд╛ рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ (рдФрд░ рдЗрд╕рдХреЗ рд╕рд╛рде рд╣рдорд╛рд░реЗ рдЖрд╡рд░рдг) рдХреА рдЧрд╛рд░рдВрдЯреА рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╢рд╛рдВрддрд┐ рд╕реЗ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯрд░ рдореЙрдбреНрдпреВрд▓ рдХреЛ рдЕрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕ рдбрд░ рдХреЗ рдмрд┐рдирд╛ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдХрд╣реАрдВ рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдп рдЕрднреА рднреА рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ (рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рд╡реЗ рдЧрд╛рдпрдм рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ, рддреЛ рдкреНрд░реЛрд╕реЗрд╕рд░ рдкрд░реЗрд╢рд╛рди рд╣реЛрдЧрд╛)ред <br><br><h3>  рдПрдХ рдлрдВрдХреНрд╢рди рд╣реБрдХ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░рдирд╛ </h3><br>  рдЕрдВрддрд░рд╡рд┐рд░реЛрдз рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреИрд╕рд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд┐рдпрд╛ рд╣реИ?  рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИред  рдлреВрдЯреНрд░реЗрд╕ рдЖрдкрдХреЛ рдХреЙрд▓рдмреИрдХ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХреЗ рдмрд╛рдж рд░рдЬрд┐рд╕реНрдЯрд░реЛрдВ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  % рд░рд┐рдк рд░рд┐рдк рдХреЛ рдмрджрд▓рдХрд░ - рдЕрдЧрд▓реЗ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдирд┐рд░реНрджреЗрд╢ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдХреЗрддрдХ - рд╣рдо рдЙрди рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЛ рдмрджрд▓рддреЗ рд╣реИрдВ рдЬреЛ рдкреНрд░реЛрд╕реЗрд╕рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ - рдЕрд░реНрдерд╛рдд, рд╣рдо рдЗрд╕реЗ рд╡рд░реНрддрдорд╛рди рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдмрд┐рдирд╛ рд╢рд░реНрдд рд╕рдВрдХреНрд░рдордг рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдзреНрдп рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣рдо рдирд┐рдпрдВрддреНрд░рдг рд▓реЗрддреЗ рд╣реИрдВред <br><br>  Ftrace рдХреЗ рд▓рд┐рдП рдХреЙрд▓рдмреИрдХ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> notrace </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_ftrace_thunk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ip, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parent_ip, struct ftrace_ops *ops, struct pt_regs *regs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_hook</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hook</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">container_of</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_hook</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class">);</span></span> regs-&gt;ip = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>) hook-&gt;function; }</code> </pre><br>  <code>struct ftrace_hook</code> () рдореИрдХреНрд░реЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдЕрдкрдиреЗ <code>struct ftrace_hook</code> рдХрд╛ рдкрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдЗрд╕рдореЗрдВ рдПрдореНрдмреЗрдбреЗрдб <code>struct ftrace_hook</code> рдХреЗ рдкрддреЗ рдкрд░ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рд╣рдо рдЕрдкрдиреЗ рд╣реИрдВрдбрд▓рд░ рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде рд╕реНрдЯреНрд░рдХреНрдЪрд░ <code>struct pt_regs</code> рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ% rip рд░рдЬрд┐рд╕реНрдЯрд░ рдорд╛рди рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рд╡рд╣ рд╕рдм рд╣реИред  X86_64 рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдЕрдиреНрдп рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП, рдЗрд╕ рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЛ рдЕрд▓рдЧ рддрд░рд╣ рд╕реЗ рдХрд╣рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдЬреИрд╕реЗ рдЖрдИрдкреА рдпрд╛ рдкреАрд╕реА), рд▓реЗрдХрд┐рди рд╡рд┐рдЪрд╛рд░ рдЙрдирдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рд╕рд┐рджреНрдзрд╛рдВрдд рдореЗрдВ рд╣реИред <br><br>  <strong>рдиреЛрдЯрдмреИрдХ рдХреНрд╡рд╛рд▓рд┐рдлрд╝рд╛рдпрд░</strong> рдХреЛ рдХреЙрд▓рдмреИрдХ рдХреЗ рд▓рд┐рдП рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдиреЛрдЯ рдХрд░реЗрдВред  рд╡реЗ рдЙрди рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЛ рдлрд╝реНрд▓реИрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдлрд╝реБрдЯреНрд░реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╣реИ рдХрд┐ рдлреНрд░реЗрд╕ рдХреЗ рдХрд╛рд░реНрдп рдЬреЛ рдЯреНрд░реЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЪрд┐рд╣реНрдирд┐рдд рд╣реИрдВред  рдпрд╣ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЯреНрд░реЗрд╕ рдХрд░рддреЗ рд╕рдордп рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдПрдХ рдЕрдВрддрд╣реАрди рд▓реВрдк рдореЗрдВ рдЬрдордиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ (ftrace рдпрд╣ рдХрд░ рд╕рдХрддрд╛ рд╣реИ)ред <br><br>  рдлрд╝реБрдЯрдмреИрдХ рдХреЙрд▓рдмреИрдХ рдЖрдорддреМрд░ рдкрд░ рдПрдХреНрд╕рдЯреНрд░реВрдЬрд╝рди рдбрд┐рд╕реЗрдмрд▓реНрдб (рдЬреИрд╕реЗ рдХрд┐рдкреНрд░реЛрдмреНрд╕) рдХреЗ рд╕рд╛рде рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред  рдЕрдкрд╡рд╛рдж рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдкрдХреЛ рдЙрди рдкрд░ рднрд░реЛрд╕рд╛ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдкреНрд░рддрд┐рдмрдВрдз рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рд╕рд┐рд░реНрдл рдЖрда рдмрд╛рдЗрдЯреНрд╕ рдХреА рдЬрдЧрд╣ рд▓реЗрддреЗ рд╣реИрдВред <br><br>  рдЖрд╡рд░рдг рдлрд╝рдВрдХреНрд╢рди, рдЬрд┐рд╕реЗ рдмрд╛рдж рдореЗрдВ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдореВрд▓ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рдорд╛рди рд╕рдВрджрд░реНрдн рдореЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛ред  рдЗрд╕рд▓рд┐рдП, рдЖрдк рд╡рд╣рд╛рдВ рд╡рд╣реА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдПрдХ рдмрд╛рдзрд╛ рд╣реИрдВрдбрд▓рд░ рдХреЛ рд░реЛрдХрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЕрднреА рднреА рдПрдХ рдЖрд╡рд░рдг рдореЗрдВ рдирд╣реАрдВ рд╕реЛ рд╕рдХрддреЗ рд╣реИрдВред <br><br><h3>  рдкреБрдирд░рд╛рд╡рд░реНрддреА рдХреЙрд▓ рд╕рдВрд░рдХреНрд╖рдг </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдКрдкрд░ рджрд┐рдП рдЧрдП рдХреЛрдб рдореЗрдВ рдПрдХ рдкрдХрдбрд╝ рд╣реИ: рдЬрдм рд╣рдорд╛рд░рд╛ рд░реИрдкрд░ рдореВрд▓ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдлрд┐рд░ рд╕реЗ рдлрд╝реНрд░реЗрд╕ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдлрд┐рд░ рд╕реЗ рд╣рдорд╛рд░реЗ рдХреЙрд▓рдмреИрдХ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдлрд┐рд░ рд╕реЗ рд░реИрдкрд░ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рдЕрдирдВрдд рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХреЛ рдХрд┐рд╕реА рддрд░рд╣ рдХрдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╣реЛрдиреЗ рд╡рд╛рд▓рд╛ рд╕рдмрд╕реЗ рд╕реБрд░реБрдЪрд┐рдкреВрд░реНрдг рддрд░реАрдХрд╛ рд╣реИ </font></font><code>parent_ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдлрд╝реБрдЯреЗрдЬ рдХреЙрд▓рдмреИрдХ рдХреЗ рдПрдХ рддрд░реНрдХ рдХрд╛ </font><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </font><font style="vertical-align: inherit;">, рдЬрд┐рд╕рдореЗрдВ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рдкрддрд╛ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЯреНрд░реЗрд╕ рдХрд┐рдП рдЧрдП рдлрд╝рдВрдХреНрд╢рди рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЖрдорддреМрд░ рдкрд░ рдЗрд╕ рддрд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХреЗ рдЧреНрд░рд╛рдл рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкрд╣рд▓реЗ рдХреЙрд▓ рдХреЛ рдмрд╛рд░-рдмрд╛рд░ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЬрдм рдлрд┐рд░ рд╕реЗ рдмреБрд▓рд╛ рд░рд╣рд╛ рд╣реИ</font></font><code>parent_ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рдЖрд╡рд░рдг рдХреЗ рдЕрдВрджрд░ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрдмрдХрд┐ рдкрд╣рд▓реЗ - рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдХрд┐рд╕реА рдЕрдиреНрдп рд╕реНрдерд╛рди рдкрд░ред </font><font style="vertical-align: inherit;">рдирд┐рдпрдВрддреНрд░рдг рдХреЗрд╡рд▓ рддрдм рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рдлрд╝рдВрдХреНрд╢рди рдкрд╣рд▓реЗ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЕрдиреНрдп рд╕рднреА рдХреЛ рдореВрд▓ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рдореЙрдбреНрдпреВрд▓ рдХреА рд╕реАрдорд╛рдУрдВ рдХреЗ рд╕рд╛рде рдкрддреЗ рдХреА рддреБрд▓рдирд╛ рдХрд░рдХреЗ рдкреНрд░рд╡реЗрд╢ рдЬрд╛рдВрдЪ рдмрд╣реБрдд рдХреБрд╢рд▓рддрд╛ рд╕реЗ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ (рдЬрд┐рд╕рдореЗрдВ рд╣рдорд╛рд░реЗ рд╕рднреА рдХрд╛рд░реНрдп рд╢рд╛рдорд┐рд▓ рд╣реИрдВ)ред </font><font style="vertical-align: inherit;">рдпрд╣ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЕрдЧрд░ рдореЙрдбреНрдпреВрд▓ рдореЗрдВ рдХреЗрд╡рд▓ рд░реИрдкрд░ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЕрдиреНрдпрдерд╛, рдЖрдкрдХреЛ рдЕрдзрд┐рдХ рдЪрдпрдирд╛рддреНрдордХ рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреБрд▓ рдореЗрдВ, рд╕рд╣реА ftrace рдХреЙрд▓рдмреИрдХ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> notrace </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_ftrace_thunk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ip, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parent_ip, struct ftrace_ops *ops, struct pt_regs *regs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_hook</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hook</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">container_of</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ftrace_hook</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!within_module(parent_ip, THIS_MODULE)) regs-&gt;ip = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>) hook-&gt;function; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреА рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ / рд▓рд╛рдн: </font></font><br><br><ul><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрдо рдУрд╡рд░рд╣реЗрдбред </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╕ рдХреБрдЫ рдШрдЯрд╛рд╡ рдФрд░ рддреБрд▓рдирд╛ред </font><font style="vertical-align: inherit;">рдХреЛрдИ рд╕реНрдкрд┐рдирд▓реЙрдХ, рд╕реВрдЪреА рдкрд╛рд╕ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдЗрд╕реА рддрд░рд╣ред</font></font><br></li><li> <strong>   .</strong>         .       ,         . <br></li><li> <strong>   .</strong>     <em>kretprobes</em>         ,     (      ).           ,       . <br></li></ul><br><h3>    </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдЗрдП рдПрдХ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ: рдЖрдкрдиреЗ </font><font style="vertical-align: inherit;">рдореМрдЬреВрджрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рд╕реВрдЪреА рджреЗрдЦрдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рдЯрд░реНрдорд┐рдирд▓ рдореЗрдВ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls рдХрдорд╛рдВрдб</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЯрд╛рдЗрдк рдХрд┐рдпрд╛ </font><font style="vertical-align: inherit;">ред рд╢реЗрд▓ (рдХрд╣реЛ рдмрд╛рд╢) рдПрдХ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ </font><font style="vertical-align: inherit;">рд▓рд┐рдП рд╕реА рдорд╛рдирдХ рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╕реЗ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╛рдВрдЯрд╛</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () + </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд╖реНрдкрд╛рджрд┐рдд</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () </font><font style="vertical-align: inherit;">рдХрд╛рд░реНрдпреЛрдВ рдХреА рдПрдХ рдкрд╛рд░рдВрдкрд░рд┐рдХ рдЬреЛрдбрд╝реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред рдЖрдВрддрд░рд┐рдХ рд░реВрдк рд╕реЗ, рдЗрди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ </font><font style="vertical-align: inherit;">рдХреНрд░рдорд╢рдГ </font><font style="vertical-align: inherit;">рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреНрд▓реЛрди ()</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд╖реНрдкрд╛рджрд┐рдд () рдХреЗ</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдорд╛рдзреНрдпрдо рд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ </font><font style="vertical-align: inherit;">рд╣реИред рдорд╛рди рд▓реЗрдВ рдХрд┐ рд╣рдо рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреА рд╢реБрд░реБрдЖрдд рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд () рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЛ рд░реЛрдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреНрд░рд╛рдлрд┐рдХ рд░реВрдк рдореЗрдВ, рд╣реИрдВрдбрд▓рд░ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЕрд╡рд░реЛрдзрди рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: </font></font><br><br><img alt="рдЕрд╡рд░реЛрдзрди рдЕрдиреБрдХреНрд░рдо рдЖрд░реЗрдЦ" src="https://habrastorage.org/webt/ok/mm/4x/okmm4xnova8g2nfmx7y60oocuju.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ ( </font></font><font color="#66B2FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреАрд▓рд╛</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) рдХрд░реНрдиреЗрд▓ рдХреЛ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреИрд╕реЗ рдХрд░рддреА рд╣реИ ( </font></font><font color="#EA6B66"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд▓рд╛рд▓)</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), рдЬрд╣рд╛рдВ рдлреВрдЯреНрд░реЗрд╕ рдлреНрд░реЗрдорд╡рд░реНрдХ ( </font></font><font color="#A680B8"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреИрдВрдЧрдиреА</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) рд╣рдорд╛рд░реЗ рдореЙрдбреНрдпреВрд▓ ( </font></font><font color="#97D077"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреНрд░реАрди</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font><font style="vertical-align: inherit;">рд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font><br><br><ol><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ SYSCALL рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреА рд╣реИред </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдХрд░реНрдиреЗрд▓ рдореЛрдб рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг рдХреЛ рдирд┐рдореНрди-рд╕реНрддрд░реАрдп рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╣реИрдВрдбрд▓рд░ - </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐_SYSCALL_64</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> () </font><font style="vertical-align: inherit;">рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╡рд╣ 64-рдмрд┐рдЯ рдХрд░реНрдиреЗрд▓ рдкрд░ 64-рдмрд┐рдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЗ рд╕рднреА рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред</font></font><br></li><li> <strong>    .</strong>     , <a href="">  </a> ,      <em>do_syscall_64</em> (), <a href="">  </a> .            <code>sys_call_table</code>          тАФ       <em>sys_execve</em> (). <br></li><li> <strong> ftrace.</strong>         <em>__fentry__</em> (),    ftrace.  ,    ,       <em>nop</em> ,      sys_execve()   . <br></li><li> <strong>Ftrace   .</strong>    ftrace     ,   .         ,    %rip,       . <br></li><li> <strong>  .</strong>     <code>parent_ip</code> ,   do_syscall_64() тАФ        sys_execve() тАФ     ,   <em> %rip</em>   <code>pt_regs</code> . <br></li><li> <strong>Ftrace  .</strong>   FTRACE_SAVE_REGS, ftrace      <code>pt_regs</code>   .    ftrace     .     %rip тАФ      тАФ          . <br></li><li> <strong>  -.</strong> -     sys_execve()   .       <em>fh_sys_execve</em> ().           ,                do_syscall_64(). <br></li><li> <strong>   .</strong>          .  fh_sys_execve()        (  )       .        .        тАФ sys_execve()  ,   <em>real_sys_execve</em> ,      . <br></li><li> <strong>  .</strong>      sys_execve(),     ftrace     . ,       -тАж <br></li><li> <strong>   .</strong>       sys_execve()    fh_sys_execve(),     do_syscall_64().         sys_execve()   .     : ftrace    sys_execve() . <br></li><li> <strong>  .</strong>       sys_execve()      fh_sys_execve().        .   ,    execve()  ,   ,     ,  . . <br></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рдмрдВрдзрди рдХреЛрд░ рдореЗрдВ рд▓реМрдЯрддрд╛ рд╣реИред </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, fh_sys_execve () рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдирд┐рдпрдВрддреНрд░рдг do_syscall_64 () рдХреЛ рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдорд╛рдирддрд╛ рд╣реИ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣ рдкреВрд░рд╛ рд╣реЛ рдЧрдпрд╛ рдерд╛ред </font><font style="vertical-align: inherit;">рдХреЛрд░ рдЕрдкрдиреЗ рдкрд░рдорд╛рдгреБ рдХрд╛рд░реЛрдмрд╛рд░ рдХреЛ рдЬрд╛рд░реА рд░рдЦрддрд╛ рд╣реИред</font></font><br></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рдмрдВрдзрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рд▓реМрдЯрддрд╛ рд╣реИред </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдХрд░реНрдиреЗрд▓ IRET рдирд┐рд░реНрджреЗрд╢ (рдпрд╛ SYSRET, рд▓реЗрдХрд┐рди рдирд┐рд╖реНрдкрд╛рджрд┐рдд () рдпрд╣ рд╣рдореЗрд╢рд╛ IRET рд╣реЛрддрд╛ рд╣реИ) рдХреЛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдирдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рд░рдЬрд┐рд╕реНрдЯрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдХреЗрдВрджреНрд░реАрдп рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдореЛрдб рдореЗрдВ рдбрд╛рд▓рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рд┐рд╕реНрдЯрдо рдХреЙрд▓ (рдФрд░ рдПрдХ рдирдИ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ) рдкреВрд░рд╛ рд╣реЛ рдЧрдпрд╛ рд╣реИред</font></font><br></li></ol><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдлрд╛рдпрджреЗ рдФрд░ рдиреБрдХрд╕рд╛рди </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирддреАрдЬрддрди, рд╣рдореЗрдВ рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдХрд┐рд╕реА рднреА рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рд╣реА рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рддрд░реАрдХрд╛ рдорд┐рд▓рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдлрд╛рдпрджреЗ рд╣реИрдВ: </font></font><br><br><ul><li> <strong> API   .</strong>        .       ,     ,      .   тАФ   -,    . <br></li><li> <strong>    .</strong>            .   -     ,     ,  ,  - .      (    ),    . <br></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреБрд░реЗрдЦрдг рдЕрдиреБрд░реЗрдЦрдг рдХреЗ рд╕рд╛рде рд╕рдВрдЧрдд рд╣реИред </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╛рд╣рд┐рд░ рд╣реИ, рдпрд╣ рд╡рд┐рдзрд┐ рдлреВрдЯ рдХреЗ рд╕рд╛рде рд╕рдВрдШрд░реНрд╖ рдирд╣реАрдВ рдХрд░рддреА рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдк рдЕрднреА рднреА рдХрд░реНрдиреЗрд▓ рд╕реЗ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рдкреНрд░рджрд░реНрд╢рди рд╕рдВрдХреЗрддрдХ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">Kprobes рдпрд╛ splicing рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ ftrace рддрдВрддреНрд░ рдореЗрдВ рдмрд╛рдзрд╛ рдЖ рд╕рдХрддреА рд╣реИред</font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЗрд╕ рд╕рдорд╛рдзрд╛рди рдХреЗ рдиреБрдХрд╕рд╛рди рдХреНрдпрд╛ рд╣реИрдВ? </font></font><br><br><ul><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд░реНрдиреЗрд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВред </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлреНрд░реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрдВрдХреНрд╢рди рд╣реБрдХ рдХреЛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХрд░реНрдиреЗрд▓ рдХреЛ рдХрдИ рд╕реБрд╡рд┐рдзрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдирд╛рдо рд╕реЗ рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓реНрд╕ рдЬрд┐рдо рдХреЗ рдкрд╛рддреНрд░реЛрдВ рдХреА рд╕реВрдЪреА </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдиреБрд░реЗрдЦрдг рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдлреБрдЯреНрд░реЗрд╕ рдлреНрд░реЗрдорд╡рд░реНрдХ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЖрд▓реЛрдЪрдирд╛ рдЕрд╡рд░реЛрдзрди рд╡рд┐рдХрд▓реНрдк </font></font></li></ul><br>                . ,  ,   ,        ,           . ,     -  ,       . <br></li><li> <strong>   ftrace</strong> ,   kprobes (  ftrace    ),   ,   ,  . , <em> ftrace</em> тАФ      ,    ┬л┬╗  ftrace   . <br></li><li> <strong>  .</strong>    ,      . ,         ,  ftrace    . ,         ,       . <br></li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрдмрд▓ рдХреЙрд▓ рдлреБрдЯреНрд░реЗрд╕ред </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реВрдЪрдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рджреГрд╖реНрдЯрд┐рдХреЛрдг </font></font><code>parent_ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ рдкрд░рд┐рдгрд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ </font><font style="vertical-align: inherit;">рдКрдкрд░ рд╡рд░реНрдгрд┐рдд рд╣реИ </font><font style="vertical-align: inherit;">рдлрд┐рд░ рд╕реЗ рд╣реБрдХ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ред </font><font style="vertical-align: inherit;">рдпрд╣ рдУрд╡рд░рд╣реЗрдб рдХрд╛ рдПрдХ рд╕рд╛ рдЬреЛрдбрд╝рддрд╛ рд╣реИ рдФрд░ рдЕрдиреНрдп рдирд┐рд╢рд╛рди рдиреАрдЪреЗ рджрд╕реНрддрдХ рджреЗ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрдИ рдХреЙрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рджреЛ рдмрд╛рд░ рджреЗрдЦреЗрдВрдЧреЗред </font><font style="vertical-align: inherit;">рдереЛрдбрд╝рд╛ рдХрд╛рд▓рд╛ рдЬрд╛рджреВ рд▓рдЧрд╛рдиреЗ рд╕реЗ рдЗрд╕ рдЦрд╛рдореА рдХреЛ рдЯрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ: рдлрдВрдХреНрд╢рди рдХреЗ рд╢реБрд░реБрдЖрдд рдореЗрдВ рдлреВрдЯреНрд░реЗрд╕ рдХреЙрд▓ рд╕реНрдерд┐рдд рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдореВрд▓ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдкрддрд╛ 5 рдмрд╛рдЗрдЯреНрд╕ (рдХреЙрд▓ рдЗрдВрд╕реНрдЯреНрд░рдХреНрд╢рди рдХреА рд▓рдВрдмрд╛рдИ) рджреНрд╡рд╛рд░рд╛ рдЖрдЧреЗ рдмрдврд╝рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдлрд╝реБрдЯреНрд░реЗрд╕ рд╕реЗ рдХреВрдж рд╕рдХрддреЗ рд╣реИрдВред</font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреБрдЫ рдиреБрдХрд╕рд╛рдиреЛрдВ рдкрд░ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХрд░реНрдиреЗрд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╢реБрд░реБрдЖрдд рдХреЗ рд▓рд┐рдП, рдХрд░реНрдиреЗрд▓ рдХреЛ ftrace рдФрд░ kalls Gym рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рд╕рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CONFIG_FTRACE </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CONFIG_KALLSYMS </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд░, рдлреНрд░реЗрд╕ рдХреЛ рдЧрддрд┐рд╢реАрд▓ рд░рдЬрд┐рд╕реНрдЯрд░ рд╕рдВрд╢реЛрдзрди рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдк рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CONFIG_DYNAMIC_FTRACE_WITH_REGS </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдХрд░реНрдиреЗрд▓ </font><font style="vertical-align: inherit;">FTRACE_OPS_FL_IPMODIFY рдзреНрд╡рдЬ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рдВрд╕реНрдХрд░рдг 3.19 рдпрд╛ рдЙрдЪреНрдЪрддрд░</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдХрд░реНрдиреЗрд▓ рдХреЗ рдкрд╣рд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рднреА% рд░рд┐рдк рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЛ рдмрджрд▓рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВ, рд▓реЗрдХрд┐рди 3.19 рд╕реЗ рд╢реБрд░реВ рд╣реЛрдХрд░ рдпрд╣ рдзреНрд╡рдЬ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╣реА рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдкреБрд░рд╛рдиреА рдЧреБрдард▓реА рдХреЗ рд▓рд┐рдП рдПрдХ рдзреНрд╡рдЬ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдПрдХ рд╕рдВрдХрд▓рди рддреНрд░реБрдЯрд┐ рдХрд╛ рдХрд╛рд░рдг рдмрдиреЗрдЧреА, рдФрд░ рдирдП рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдПрдХ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдЕрд╡рд░реЛрдзрди рдХреЛ рдЬрдиреНрдо рджреЗрдЧреАред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдВрдд рдореЗрдВ, рдЕрд╡рд░реЛрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЕрдВрджрд░ ft рдХреЙрд▓ рдХрд╛ рд╕реНрдерд╛рди рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ: рдХреЙрд▓ рдХреЛ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдкреНрд░рд╕реНрддрд╛рд╡рдирд╛ рд╕реЗ рдкрд╣рд▓реЗ (рдЬрд╣рд╛рдВ рд╕реНрдерд╛рди рд╕реНрдерд╛рдиреАрдп рдЪрд░ рдХреЗ рд▓рд┐рдП рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╕реНрдЯреИрдХ рдлреНрд░реЗрдо рдмрдирддрд╛ рд╣реИ) рд╕реЗ рдкрд╣рд▓реЗ рд╣реА рд╕реНрдерд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдпрд╣ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рд╕реБрд╡рд┐рдзрд╛ рд╡рд┐рдХрд▓реНрдк рджреНрд╡рд╛рд░рд╛ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CONFIG_HAVE_FENTRY </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X86_64 рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди i386 рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">I386 рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рд╕реАрдорд╛рдУрдВ рдХреЗ рдХрд╛рд░рдг, рдХрдВрдкрд╛рдЗрд▓рд░ рдлрдВрдХреНрд╢рди рдкреНрд░реЛрд▓реЙрдЧ рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ рдлреНрд░реЗрд╕ рдХреЙрд▓ рдирд╣реАрдВ рдбрд╛рд▓ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП, рдЬрдм рддрдХ рдлреАрд▓реНрд░реЗрд╕ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддрдм рддрдХ рдлрд╝рдВрдХреНрд╢рди рд╕реНрдЯреИрдХ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рдВрд╢реЛрдзрд┐рдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЕрд╡рд░реЛрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдХреЗрд╡рд▓% eip рд░рдЬрд┐рд╕реНрдЯрд░ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИ - рдЖрдкрдХреЛ рдкреНрд░реЛрдпреЛрдЧ рдореЗрдВ рдХрд┐рдП рдЧрдП рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдЙрд▓рдЯрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рднрд┐рдиреНрди рд╣реЛрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдХрд╛рд░рдг рд╕реЗ, ftrace рдЗрдВрдЯрд░рд╕реЗрдкреНрд╢рди x86 32-рдмрд┐рдЯ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЗрд╕реЗ рдХреБрдЫ рдХрд╛рд▓реЗ рдЬрд╛рджреВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ ("рдПрдВрдЯреА-рдкреНрд░реЛрд▓реЙрдЧ" рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдирд╛), рд▓реЗрдХрд┐рди рдлрд┐рд░ рд╕рдорд╛рдзрд╛рди рдХреА рддрдХрдиреАрдХреА рд╕рд╛рджрдЧреА рдХреЛ рднреБрдЧрддрдирд╛ рд╣реЛрдЧрд╛, рдЬреЛ рдлрд╝реБрдЯреНрд░реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдлрд╛рдпрджреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЕрдЪрдВрднрд┐рдд рдЖрд╢реНрдЪрд░реНрдп </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд░реАрдХреНрд╖рдг рдХреЗ рджреМрд░рд╛рди, рд╣рдо рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рд╕рд╛рде</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЖрдП </font><font style="vertical-align: inherit;">: рдХреБрдЫ рд╡рд┐рддрд░рдгреЛрдВ рдкрд░, рд╣реБрдХрд┐рдВрдЧ рдХрд╛рд░реНрдпреЛрдВ рдиреЗ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдХрд╕рдХрд░ рджреБрд░реНрдШрдЯрдирд╛ рдХрд╛ рдХрд╛рд░рдг рдмрдирд╛ рджрд┐рдпрд╛ред рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ, рдпрд╣ рдХреЗрд╡рд▓ рдбреЗрд╡рд▓рдкрд░реНрд╕ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрд▓рд╛рд╡рд╛ рд╣реБрдЖред рд╕рдорд╕реНрдпрд╛ рдХрд┐рд╕реА рднреА рд╡рд┐рддрд░рдг рдФрд░ рдХрд░реНрдиреЗрд▓ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдореВрд▓ рдЕрд╡рд░реЛрдзрди рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдкрд░ рдкреБрди: рдЙрддреНрдкрдиреНрди рдирд╣реАрдВ рд╣реБрдИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдбрд┐рдмрдЧрд┐рдВрдЧ рдиреЗ рджрд┐рдЦрд╛рдпрд╛ рдХрд┐ рд╣реИрдВрдЧ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рдлрдВрдХреНрд╢рди рдХреЗ рдЕрдВрджрд░ рд╣реЛрддрд╛ рд╣реИред рдХрд┐рд╕реА рд░рд╣рд╕реНрдпрдордп рдХрд╛рд░рдг рд╕реЗ, рдЬрдм рдореВрд▓ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓реНрд░реЗрд╕ рдХреЙрд▓рдмреИрдХ рдХреЗ рдЕрдВрджрд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рдерд╛, рддреЛ рдкрддрд╛ </font></font><code>parent_ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд░реИрдкрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЛрдб рдХреЗ рдмрдЬрд╛рдп рдХрд░реНрдиреЗрд▓ рдХреЛрдб рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд░рд╣рд╛ред рдЗрд╕ рд╡рдЬрд╣ рд╕реЗ, рдПрдХ рдЕрдВрддрд╣реАрди рд▓реВрдк рдЙрддреНрдкрдиреНрди рд╣реБрдЖ, рдХреНрдпреЛрдВрдХрд┐ ftrace рдиреЗ рд╣рдорд╛рд░реЗ рд░реИрдкрд░ рдХреЛ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдЙрдкрдпреЛрдЧреА рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЗ рдмрд╛рд░-рдмрд╛рд░ рдмреБрд▓рд╛рдпрд╛ред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрдкрдиреЗ рдирд┐рдкрдЯрд╛рди рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рдФрд░ рдЯреВрдЯреЗ рд╣реБрдП рджреЛрдиреЛрдВ рдХреЛрдб рдереЗ, рдЗрд╕рд▓рд┐рдП рдорддрднреЗрджреЛрдВ рдХреЛ рдЦреЛрдЬрдирд╛ рдХреЗрд╡рд▓ рд╕рдордп рдХреА рдмрд╛рдд рдереАред </font><font style="vertical-align: inherit;">рдХреЛрдб рдХреЛ рдПрдХрдЬреБрдЯ рдХрд░рдиреЗ рдФрд░ рд╕рднреА рдХреЛ рдмрд╛рд╣рд░ рдлреЗрдВрдХрдиреЗ рдХреЗ рдмрд╛рдж, рдЬреЛ рдЕрдирд╛рд╡рд╢реНрдпрдХ рд╣реИ, рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рдмреАрдЪ рдХреЗ рдЕрдВрддрд░ рдХреЛ рдПрдХ рдЖрд╡рд░рдг рд╕рдорд╛рд░реЛрд╣ рдореЗрдВ рд╕реНрдерд╛рдиреАрдпрдХреГрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдиреЗ рдХрд╛рдо рдХрд┐рдпрд╛:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> asmlinkage </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_sys_execve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *envp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ret; pr_debug(<span class="hljs-string"><span class="hljs-string">"execve() called: filename=%p argv=%p envp=%p\n"</span></span>, filename, argv, envp); ret = real_sys_execve(filename, argv, envp); pr_debug(<span class="hljs-string"><span class="hljs-string">"execve() returns: %ld\n"</span></span>, ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд▓реЗрдХрд┐рди рдЗрд╕ рдПрдХ - рдкреНрд░рдгрд╛рд▓реА рдХреЛ рд▓рдЯрдХрд╛ рджрд┐рдпрд╛: </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> asmlinkage </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_sys_execve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *envp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ret; pr_devel(<span class="hljs-string"><span class="hljs-string">"execve() called: filename=%p argv=%p envp=%p\n"</span></span>, filename, argv, envp); ret = real_sys_execve(filename, argv, envp); pr_devel(<span class="hljs-string"><span class="hljs-string">"execve() returns: %ld\n"</span></span>, ret); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рдХреИрд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рд▓реЙрдЧрд┐рдВрдЧ рдХрд╛ рд╕реНрддрд░ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ? рджреЛ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдорд╢реАрди рдХреЛрдб рдХреЗ рдПрдХ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рдЕрдзреНрдпрдпрди рдиреЗ рд╕реНрдерд┐рддрд┐ рдХреЛ рдЬрд▓реНрджреА рд╕реЗ рд╕реНрдкрд╖реНрдЯ рдХрд░ рджрд┐рдпрд╛ рдФрд░ рдХрдВрдкрд╛рдЗрд▓рд░ рдХреЛ рджреЛрд╖ рджреЗрдиреЗ рдкрд░ рдмрд╣реБрдд рднрд╛рд╡рдирд╛ рдкреИрджрд╛ рдХреАред рдЖрдорддреМрд░ рдкрд░ рд╡рд╣ рдмреНрд░рд╣реНрдорд╛рдВрдбреАрдп рдХрд┐рд░рдгреЛрдВ рдХреЗ рдкрд╛рд╕ рдХрд╣реАрдВ рд╕рдВрджрд┐рдЧреНрдз рд╕реВрдЪреА рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рдмрд╛рд░ рдирд╣реАрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрд╛рдд, рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдирд┐рдХрд▓рд╛, pr_devel () рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рд╢реВрдиреНрдп рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рд╣реИрдВред рдкреНрд░рд┐рдВрдЯ рдореИрдХреНрд░реЛ рдХреЗ рдЗрд╕ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд┐рдХрд╛рд╕ рдХреЗ рджреМрд░рд╛рди рд▓реЙрдЧрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдСрдкрд░реЗрд╢рди рдХреЗ рджреМрд░рд╛рди рдРрд╕реА рд▓реЙрдЧ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐рдпрд╛рдБ рджрд┐рд▓рдЪрд╕реНрдк рдирд╣реАрдВ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ DEBUG рдореИрдХреНрд░реЛ рдШреЛрд╖рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╡реЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреЛрдб рд╕реЗ рдмрд╛рд╣рд░ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред рдЙрд╕рдХреЗ рдмрд╛рдж, рд╕рдВрдХрд▓рдХ рдХрд╛ рдХрд╛рд░реНрдп рдЗрд╕ рдореЗрдВ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> asmlinkage </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fh_sys_execve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *filename, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *argv, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> __user *envp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> real_sys_execve(filename, argv, envp); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдпрд╣рд╛рдБ рдЕрдиреБрдХреВрд▓рди рджреГрд╢реНрдп рдкрд░ рдЖрддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ рддрдерд╛рдХрдерд┐рдд рдХрд╛рдо рдХрд┐рдпрд╛ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдиреБрдХреВрд▓рди рдкреВрдВрдЫ рдХреЙрд▓</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (рдкреВрдВрдЫ рдХреЙрд▓ рдЕрдиреБрдХреВрд▓рди)ред </font><font style="vertical-align: inherit;">рдпрд╣ рд╕рдВрдХрд▓рдХ рдХреЛ рдПрдХ рдИрдорд╛рдирджрд╛рд░ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рдХреЛ рдЙрд╕рдХреЗ рд╢рд░реАрд░ рдкрд░ рд╕реАрдзреЗ рдХреВрджрдиреЗ рдХреЗ рд╕рд╛рде рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдпрджрд┐ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рджреВрд╕рд░реЗ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ рдФрд░ рддреБрд░рдВрдд рдЕрдкрдирд╛ рдореВрд▓реНрдп рд╡рд╛рдкрд╕ рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдорд╢реАрди рдХреЛрдб рдореЗрдВ, рдПрдХ рдИрдорд╛рдирджрд╛рд░ рдХреЙрд▓ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ:</font></font><br><br><pre> <code class="hljs xml">0000000000000000 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fh_sys_execve</span></span></span><span class="hljs-tag">&gt;</span></span>: 0: e8 00 00 00 00 callq 5 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fh_sys_execve+0x5</span></span></span><span class="hljs-tag">&gt;</span></span> 5: ff 15 00 00 00 00 callq *0x0(%rip) b: f3 c3 repz retq</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдФрд░ рдЧреИрд░-рдХрд╛рдо - рдЗрд╕ рддрд░рд╣: </font></font><br><br><pre> <code class="hljs perl"><span class="hljs-number"><span class="hljs-number">0000000000000000</span></span> &lt;fh_sys_execve&gt;: <span class="hljs-number"><span class="hljs-number">0</span></span>: e8 <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> callq <span class="hljs-number"><span class="hljs-number">5</span></span> &lt;fh_sys_execve+<span class="hljs-number"><span class="hljs-number">0x5</span></span>&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>b <span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> mov <span class="hljs-number"><span class="hljs-number">0x0</span></span>(%rip),%rax c: ff e<span class="hljs-number"><span class="hljs-number">0</span></span> jmpq *%rax</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓рд╛ CALL рд╕реНрдЯреЗрдЯрдореЗрдВрдЯ рд╕рдорд╛рди __fentry __ () рдХреЙрд▓ рд╣реИ рдЬрд┐рд╕реЗ рдХрдВрдкрд╛рдЗрд▓рд░ рджреНрд╡рд╛рд░рд╛ рд╕рднреА рдлрдВрдХреНрд╢рдиреНрд╕ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рдбрд╛рд▓рд╛ рдЧрдпрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдлрд┐рд░ рд╕рд╛рдорд╛рдиреНрдп рдХреЛрдб рдореЗрдВ, рдЖрдк рдХреЙрд▓ рдХреЛ рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ real_sys_execve (рдореЗрдореЛрд░реА рдореЗрдВ рдкреЙрдЗрдВрдЯрд░ рджреНрд╡рд╛рд░рд╛) рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ fh_sys_execve () рд╕реЗ RET рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд╛рдкрд╕ рдЖ рд╕рдХрддреЗ рд╣реИрдВред рдЯреВрдЯреЗ рд╣реБрдП рдХреЛрдб JMP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реАрдзреЗ real_sys_execve () рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЗрд▓ рдХреЙрд▓ рдХрд╛ рдЕрдиреБрдХреВрд▓рди рдЖрдкрдХреЛ "рдЕрд░реНрдерд╣реАрди" рд╕реНрдЯреИрдХ рдлреНрд░реЗрдо рдХреЗ рдирд┐рд░реНрдорд╛рдг рдкрд░ рдереЛрдбрд╝рд╛ рд╕рдордп рдмрдЪрд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХреЙрд▓ рдирд┐рд░реНрджреЗрд╢ рджреНрд╡рд╛рд░рд╛ рд╕реНрдЯреИрдХ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╡рд╛рдкрд╕реА рдкрддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдорд╛рд░реЗ рд▓рд┐рдП, рд╡рд╛рдкрд╕реА рдкрддреЗ рдХреА рд╢реБрджреНрдзрддрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддреА рд╣реИ - рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ </font></font><code>parent_ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрд╡рд░реЛрдзрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд┐рд░реНрдгрдп рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред рдЕрдиреБрдХреВрд▓рди рдХреЗ рдмрд╛рдж, fh_sys_execve () рдлрд╝рдВрдХреНрд╢рди рдЕрдм рд╕реНрдЯреИрдХ рдкрд░ рдирдП рд░рд┐рдЯрд░реНрди рдПрдбреНрд░реЗрд╕ рдХреЛ рд╕реЗрд╡ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рд╡рд╣реАрдВ рдкреБрд░рд╛рдирд╛ рд░рд╣рддрд╛ рд╣реИ - рдХрд░реНрдиреЗрд▓ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдпреЗ</font></font><code>parent_ip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд╛рднрд┐рдХ рдХреЗ рдЕрдВрджрд░ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦрддрд╛ рд╣реИ, рдЬреЛ рдЕрдВрддрддрдГ рдПрдХ рдЕрдирдВрдд рд▓реВрдк рдХреЗ рдЧрдарди рдХреА рдУрд░ рдЬрд╛рддрд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рднреА рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ рд╕рдорд╕реНрдпрд╛ рдХреЗрд╡рд▓ рдХреБрдЫ рд╡рд┐рддрд░рдгреЛрдВ рдкрд░ рд╣реА рдХреНрдпреЛрдВ рдкреБрди: рдЙрддреНрдкрдиреНрди рд╣реБрдИред рдЬрдм рд╕рдВрдХрд▓рди рдореЙрдбреНрдпреВрд▓, рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рддрд░рдг рд╕рдВрдХрд▓рди рдЭрдВрдбреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╕реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рд╡реНрдпрдерд┐рдд рд╡рд┐рддрд░рдг рдореЗрдВ, рдкреВрдВрдЫ рдХреЙрд▓ рдЕрдиреБрдХреВрд▓рди рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдерд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣рдорд╛рд░реЗ рд▓рд┐рдП рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рдорд╛рдзрд╛рди рд░реИрдкрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдкреВрд░реА рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдЯреЗрд▓ рдХреЙрд▓ рдСрдкреНрдЯрд┐рдорд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рдерд╛:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> GCC optimize(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"-fno-optimize-sibling-calls"</span></span></span><span class="hljs-meta">)</span></span></code> </pre><br><h2>  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдВ рдФрд░ рдХреНрдпрд╛ рдХрд╣ рд╕рдХрддрд╛ рд╣реВрдВ ... рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрди-рд╕реНрддрд░реАрдп рдХреЛрдб рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдирд╛ рдордЬреЗрджрд╛рд░ рд╣реИред </font><font style="vertical-align: inherit;">рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдпрд╣ рдкреНрд░рдХрд╛рд╢рди рдХрд┐рд╕реА рдХреЛ рдЕрдкрдиреА рдкрд╕рдВрдж рдХреЗ рдереНрд░реЛрдЯ рдореЗрдВ рдереЛрдбрд╝рд╛ рд╕рдордп рдмрдЪрд╛рддрд╛ рд╣реИ, рджреБрдирд┐рдпрд╛ рдореЗрдВ рдЕрдкрдирд╛ рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдПрдВрдЯреАрд╡рд╛рдпрд░рд╕ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рд╕реНрд╡рдпрдВ рдЕрд╡рд░реЛрдзрди рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд┐рдердм рдкрд░</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреВрд░реНрдг рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓ рдХреЛрдб рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </font><font style="vertical-align: inherit;">ред</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi413241/">https://habr.com/ru/post/hi413241/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi413231/index.html">рд╕реНрдорд╛рд░реНрдЯ рдХреЙрдиреНрдЯреНрд░реИрдХреНрдЯ рдХрд╛ рдкрд░рд┐рдЪрдп</a></li>
<li><a href="../hi413233/index.html">ULogin рд╕реЗрд╡рд╛ рд░реВрдкреЛрдВ (рдореЗрд▓, рдлреЛрди) рд╕реЗ рдбреЗрдЯрд╛ рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреА рд╕рд╛рдЗрдЯ рдкрд░ рднреЗрдЬрддреА рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪреБрдк рд░рд╣рддреА рд╣реИ</a></li>
<li><a href="../hi413235/index.html">рдмреЗрд╣рддрд░ рднрд╡рд┐рд╖реНрдпрд╡рд╛рдгрд┐рдпреЛрдВ рдкрд░ рд╕рдЯреНрдЯреЗрдмрд╛рдЬреА: рдореМрд╕рдо рдХреЗ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдХреЗ рдирдП рдЧрдгрд┐рдд</a></li>
<li><a href="../hi413237/index.html">рдлреЗрд╕рдмреБрдХ рдбрд┐рд╡рд╛рдЗрд╕ рдирд┐рд░реНрдорд╛рддрд╛рдУрдВ рдХреЛ рдбреЗрд╡рд▓рдкрд░ рдЕрд▓реЗрдХреНрдЬреЗрдВрдбрд░ рдХреЛрдЧрди рдХреЗ рд╕рдорд╛рди рдбреЗрдЯрд╛ рднреЗрдЬрдиреЗ рд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi413239/index.html">рд╕реНрдорд╛рд░реНрдЯрдлреЛрди рдХреЛ рдереЛрдбрд╝рд╛ рдбрдореНрдмрд░ рдХреИрд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдП</a></li>
<li><a href="../hi413243/index.html">рдбреЗрдЯрд╛ рд╕реНрдХреВрд▓: рдЧрдгрд┐рдд рдФрд░ рд╡реНрдпрд╡рд╕рд╛рдп рдХреЛ рдХреИрд╕реЗ рдорд┐рд▓рд╛рдПрдВ</a></li>
<li><a href="../hi413245/index.html">рдбреЙрд▓реНрдмреА рдПрдЯрдореЙрд╕ рдЙрдкрдХрд░рдг рдкрд░ - рдХреЗрд╡рд▓ "рджреЗрд╢реА" рдзреНрд╡рдирд┐ред рдбреЙрд▓реНрдмреА рдЧреИрд░-рджреЗрд╢реА рдЙрддреНрдерд╛рди рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi413247/index.html">рднрдВрдбрд╛рд░рдг рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХреНрдпреЛрдВ рдХрд░реЗрдВ?</a></li>
<li><a href="../hi413249/index.html">рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдореЙрдбреНрдпреВрд▓ рд▓рд┐рдЦрдирд╛: I2C</a></li>
<li><a href="../hi413251/index.html">рдкреЙрд▓рд┐рдорд░реЗрдЬрд╝ рдЪреЗрди рд░рд┐рдПрдХреНрд╢рди рдФрд░ рд╡реНрд▓рд╛рджрд┐рд╡реЛрд╕реНрддреЛрдХ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>