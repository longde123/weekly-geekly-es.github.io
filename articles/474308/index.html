<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõåüèΩ üë©‚ÄçüöÄ üë©üèª‚Äçüéì Tipos de API HTTP escritas en Python: experiencia de Instagram üëé üéÑ üê´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoy publicamos el segundo material de la serie dedicado al uso de Python en Instagram. La √∫ltima vez estaba verificando los tipos de c√≥digo de servido...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tipos de API HTTP escritas en Python: experiencia de Instagram</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/474308/">  Hoy publicamos el segundo material de la serie dedicado al uso de Python en Instagram.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La √∫ltima</a> vez estaba verificando los tipos de c√≥digo de servidor de Instagram.  El servidor es un monolito escrito en Python.  Consiste en varios millones de l√≠neas de c√≥digo y tiene varios miles de puntos finales Django. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/nn/gh/jg/nnghjgmcauejll98mv34awk3cok.jpeg"></a> <br><br>  Este art√≠culo trata sobre c√≥mo Instagram usa los tipos para documentar las API HTTP y hacer cumplir los contratos cuando trabaja con ellos. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Resumen de la situaci√≥n</font> </h2><br>  Cuando abre el cliente m√≥vil de Instagram, a trav√©s de HTTP, accede a la API JSON de nuestro servidor Python (Django). <br><br>  Aqu√≠ hay informaci√≥n sobre nuestro sistema que le permitir√° tener una idea de la complejidad de la API que utilizamos para organizar el trabajo del cliente m√≥vil.  Entonces, esto es lo que tenemos: <br><br><ul><li>  M√°s de 2000 puntos finales en el servidor. </li><li>  M√°s de 200 campos de nivel superior en un objeto de datos del cliente que representa una imagen, video o historia en una aplicaci√≥n. </li><li>  Cientos de programadores que escriben c√≥digo de servidor (y a√∫n m√°s que tratan con el cliente). </li><li>  Cientos de confirmaciones al c√≥digo del servidor realizadas diariamente y modificando la API.  Esto es necesario para proporcionar soporte para las nuevas caracter√≠sticas del sistema. </li></ul><br>  Usamos tipos para documentar nuestras API HTTP complejas y en constante evoluci√≥n y para hacer cumplir los contratos cuando trabajamos con ellas. <br><br><h2>  <font color="#3AC1EF">Tipos</font> </h2><br>  Comencemos desde el principio.  La descripci√≥n de la sintaxis para las anotaciones de tipo en c√≥digo Python apareci√≥ en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PEP 484</a> .  ¬øPor qu√© agregar anotaciones de tipo al c√≥digo? <br><br>  Considere la funci√≥n que descarga informaci√≥n sobre el h√©roe de Star Wars: <br><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_character</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id, calendar)</span></span></span><span class="hljs-function">:</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> id == <span class="hljs-number"><span class="hljs-number">1000</span></span>:         <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Character(             id=<span class="hljs-number"><span class="hljs-number">1000</span></span>,             name=<span class="hljs-string"><span class="hljs-string">"Luke Skywalker"</span></span>,             birth_year=<span class="hljs-string"><span class="hljs-string">"19BBY"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> calendar == Calendar.BBY <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ...         )     ...</code> </pre> <br>  Para comprender esta funci√≥n, debe leer su c√≥digo.  Una vez hecho esto, puede descubrir lo siguiente: <br><br><ul><li>  Toma el identificador entero ( <code>id</code> ) del personaje. </li><li>  Toma el valor de la enumeraci√≥n correspondiente ( <code>calendar</code> ).  Por ejemplo, <code>Calendar.BBY</code> significa "Antes de la batalla de Yavin", es decir, "Antes de la batalla de Yavin". </li><li>  Devuelve informaci√≥n sobre el personaje en forma de una entidad que contiene campos que representan el identificador de este personaje, su nombre y a√±o de nacimiento. </li></ul><br>  La funci√≥n tiene un contrato impl√≠cito, cuyo significado tiene que restaurar el programador cada vez que lee el c√≥digo de la funci√≥n.  Pero el c√≥digo de funci√≥n se escribe solo una vez, y debe leerlo muchas veces, por lo que este enfoque para trabajar con este c√≥digo no es particularmente bueno. <br><br>  Adem√°s, es dif√≠cil verificar que el mecanismo que llama a la funci√≥n se adhiera al contrato impl√≠cito descrito anteriormente.  Del mismo modo, es dif√≠cil verificar que este contrato se respete en el cuerpo de la funci√≥n.  En una base de c√≥digo grande, tales situaciones pueden conducir a errores. <br><br>  Ahora considere la misma funci√≥n que declara anotaciones de tipo: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_character</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: int, calendar: Calendar)</span></span></span><span class="hljs-function"> -&gt; Character:</span></span>    ...</code> </pre> <br>  Las anotaciones de tipo le permiten expresar expl√≠citamente el contrato de esta funci√≥n.  Para entender lo que se necesita ingresar a una funci√≥n y lo que devuelve esta funci√≥n, solo lea su firma.  Un sistema de verificaci√≥n de tipos puede analizar est√°ticamente la funci√≥n y verificar el cumplimiento del contrato en el c√≥digo.  ¬°Esto le permite deshacerse de toda una clase de errores! <br><br><h2>  <font color="#3AC1EF">Tipos para varias API HTTP</font> </h2><br>  Desarrollaremos una API HTTP que le permitir√° recibir informaci√≥n sobre los h√©roes de Star Wars.  Para describir el contrato expl√≠cito utilizado al trabajar con esta API, utilizaremos anotaciones de tipo. <br><br>  Nuestra API debe aceptar el identificador de caracteres ( <code>id</code> ) como un par√°metro de URL y el valor de la enumeraci√≥n del <code>calendar</code> como un par√°metro de solicitud.  La API debe devolver una respuesta JSON con informaci√≥n de caracteres. <br><br>  As√≠ es como se ve la solicitud de API y la respuesta que devuelve: <br><br><pre> <code class="plaintext hljs">curl -X GET https://api.starwars.com/characters/1000?calendar=BBY {    "id": 1000,    "name": "Luke Skywalker",    "birth_year": "19BBY" }</code> </pre> <br>  Para implementar esta API en Django, primero debe registrar la ruta URL y la funci√≥n de vista responsable de recibir la solicitud HTTP realizada a lo largo de esta ruta y de devolver la respuesta. <br><br><pre> <code class="python hljs">urlpatterns = [    url(<span class="hljs-string"><span class="hljs-string">"characters/&lt;id&gt;/"</span></span>, get_character) ]</code> </pre> <br>  La funci√≥n, como entrada, acepta los par√°metros de solicitud y URL (en nuestro caso, <code>id</code> ).  Analiza y convierte el par√°metro de solicitud de <code>calendar</code> , que es el valor de la enumeraci√≥n correspondiente, al tipo requerido.  Carga datos de caracteres de la tienda y devuelve un diccionario serializado en JSON y envuelto en una respuesta HTTP. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_character</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: IGWSGIRequest, id: str)</span></span></span><span class="hljs-function"> -&gt; JsonResponse:</span></span>    calendar = Calendar(request.GET.get(<span class="hljs-string"><span class="hljs-string">"calendar"</span></span>, <span class="hljs-string"><span class="hljs-string">"BBY"</span></span>))    character = Store.get_character(id, calendar)    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JsonResponse(asdict(character))</code> </pre> <br>  Aunque la funci√≥n se proporciona con anotaciones de tipo, no describe expl√≠citamente el contrato duro para la API HTTP.  A partir de la firma de esta funci√≥n no podemos encontrar los nombres o tipos de par√°metros de solicitud, o campos de respuesta y sus tipos. <br><br>  ¬øEs posible hacer que la firma de la representaci√≥n de funci√≥n sea exactamente la misma informativa que la firma de la funci√≥n considerada anteriormente con anotaciones de tipo? <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_character</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: int, calendar: Calendar)</span></span></span><span class="hljs-function"> -&gt; Character:</span></span>    ...</code> </pre> <br>  Los par√°metros de funci√≥n pueden ser par√°metros de consulta (URL, consulta o par√°metros del cuerpo de consulta).  El tipo de valor devuelto por la funci√≥n puede representar el contenido de la respuesta.  Con este enfoque, tendr√≠amos a nuestra disposici√≥n un contrato expl√≠cito y comprensible para la API HTTP, cuya observancia podr√≠a garantizarse mediante un sistema de verificaci√≥n de tipo. <br><br><h2>  <font color="#3AC1EF">Implementaci√≥n</font> </h2><br>  ¬øC√≥mo implementar esta idea? <br><br>  Usamos un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">decorador</a> para convertir una funci√≥n de representaci√≥n fuertemente tipada en una funci√≥n de representaci√≥n de Django.  Este paso no requiere cambios en t√©rminos de trabajo con el marco Django.  Podemos usar el mismo middleware, las mismas rutas y otros componentes a los que estamos acostumbrados. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@api_view def get_character(id: int, calendar: Calendar) -&gt; Character:    ...</span></span></code> </pre> <br>  Considere los detalles de la <code>api_view</code> decorador <code>api_view</code> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api_view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view)</span></span></span><span class="hljs-function">:</span></span>    @functools.wraps(view)    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">django_view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span>        params = {            param_name: param.annotation(extract(request, param))            <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> param_name, param <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> inspect.signature(view).parameters.items()        }        data = view(**params)        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JsonResponse(asdict(data))       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> django_view</code> </pre> <br>  Este es un c√≥digo dif√≠cil de entender.  Analicemos sus caracter√≠sticas. <br>  Nosotros, como valor de entrada, tomamos una funci√≥n de representaci√≥n fuertemente tipada y la envolvemos en una funci√≥n de representaci√≥n Django normal, que devolvemos: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api_view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view)</span></span></span><span class="hljs-function">:</span></span>    @functools.wraps(view)    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">django_view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span>        ...    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> django_view</code> </pre> <br>  Ahora eche un vistazo a la implementaci√≥n de la funci√≥n de vista Django.  Primero necesitamos construir argumentos para una funci√≥n de presentaci√≥n fuertemente tipada.  Utilizamos la introspecci√≥n y el m√≥dulo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">inspecci√≥n</a> para obtener la firma de esta funci√≥n e iterar sobre sus par√°metros: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> param_name, param <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> inspect.signature(view).parameters.items()</code> </pre> <br>  Para cada par√°metro, llamamos a la funci√≥n de <code>extract</code> , que extrae el valor del par√°metro de la solicitud. <br><br>  Luego, convertimos el par√°metro al tipo esperado especificado en la firma (por ejemplo, convierte el <code>calendar</code> cadena a un valor que sea un elemento de la enumeraci√≥n del <code>Calendar</code> ). <br><br><pre> <code class="python hljs">param.annotation(extract(request, param))</code> </pre> <br>  Llamamos a una funci√≥n de vista fuertemente tipada con los argumentos que construimos: <br><br><pre> <code class="python hljs">data = view(**params)</code> </pre> <br>  La funci√≥n devuelve un valor fuertemente tipado de la clase <code>Character</code> .  Tomamos este valor, lo transformamos en un diccionario y lo envolvemos en una respuesta HTTP en formato JSON: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JsonResponse(asdict(data))</code> </pre> <br>  Genial  Ahora tenemos una funci√≥n de vista de Django que envuelve una funci√≥n de vista fuertemente tipada.  Finalmente, eche un vistazo a la funci√≥n de <code>extract</code> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extract</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: HttpRequest, param: Parameter)</span></span></span><span class="hljs-function"> -&gt; Any:</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> request.resolver_match.route.contains(<span class="hljs-string"><span class="hljs-string">f"&lt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{param}</span></span></span><span class="hljs-string">&gt;"</span></span>):        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.resolver_match.kwargs.get(param.name)    <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.GET.get(param.name)</code> </pre> <br>  Cada par√°metro puede ser un par√°metro de URL o un par√°metro de solicitud.  La ruta de la URL de solicitud (la ruta que registramos al principio) est√° disponible en el objeto de ruta del sistema de localizaci√≥n de URL de Django.  Verificamos el nombre del par√°metro en la ruta.  Si hay un nombre, entonces tenemos un par√°metro de URL.  Esto significa que de alguna manera podemos extraerlo de la solicitud.  De lo contrario, este es un par√°metro de consulta y tambi√©n podemos extraerlo, pero de alguna otra manera. <br><br>  Eso es todo  Esta es una implementaci√≥n simplificada, pero ilustra la idea b√°sica de escribir una API. <br><br><h2>  <font color="#3AC1EF">Tipos de datos</font> </h2><br>  El tipo utilizado para representar el contenido de la respuesta HTTP (es decir, <code>Character</code> ) puede representarse mediante una clase de datos o un diccionario escrito. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Una clase de</a> datos es un formato de descripci√≥n de clase compacta que representa datos. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dataclasses <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dataclass @dataclass(frozen=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Character</span></span></span><span class="hljs-class">:</span></span>    id: int    name: str    birth_year: str luke = Character(    id=<span class="hljs-number"><span class="hljs-number">1000</span></span>,    name=<span class="hljs-string"><span class="hljs-string">"Luke Skywalker"</span></span>,    birth_year=<span class="hljs-string"><span class="hljs-string">"19BBY"</span></span> )</code> </pre> <br>  Instagram generalmente usa clases de datos para modelar objetos de respuesta HTTP.  Estas son sus principales caracter√≠sticas: <br><br><ul><li>  Generan autom√°ticamente construcciones de plantillas y varios m√©todos auxiliares. </li><li>  Son comprensibles para los sistemas de verificaci√≥n de tipo, lo que significa que los valores pueden estar sujetos a verificaci√≥n de tipo. </li><li>  Mantienen la inmunidad gracias a la construcci√≥n <code>frozen=True</code> . </li><li>  Est√°n disponibles en la biblioteca est√°ndar de Python 3.7, o como backport en el √çndice de paquetes de Python. </li></ul><br>  Desafortunadamente, Instagram tiene una base de c√≥digo obsoleta que utiliza diccionarios grandes y sin tipo, pasados ‚Äã‚Äãentre funciones y m√≥dulos.  No ser√≠a f√°cil traducir todo este c√≥digo de diccionarios a clases de datos.  Como resultado, nosotros, usando clases de datos para el nuevo c√≥digo, y en c√≥digo obsoleto usamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">diccionarios escritos</a> . <br><br>  El uso de diccionarios mecanografiados nos permite agregar anotaciones de tipo a los objetos del diccionario del cliente y, sin cambiar el comportamiento de un sistema de trabajo, usar las capacidades de verificaci√≥n de tipos. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mypy_extensions <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TypedDict <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Character</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TypedDict)</span></span></span><span class="hljs-class">:</span></span>    id: int    name: str    birth_year: str luke: Character = {<span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>} luke[<span class="hljs-string"><span class="hljs-string">"name"</span></span>] = <span class="hljs-string"><span class="hljs-string">"Luke Skywalker"</span></span> luke[<span class="hljs-string"><span class="hljs-string">"birth_year"</span></span>] = <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-comment"><span class="hljs-comment"># type error, birth_year expects a str luke["invalid_key"] # type error, invalid_key does not exist</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Manejo de errores</font> </h2><br>  Se espera que la funci√≥n de vista devuelva informaci√≥n de caracteres en forma de una entidad de <code>Character</code> .  ¬øQu√© debemos hacer si necesitamos devolver un error al cliente? <br><br>  Puede lanzar una excepci√≥n que ser√° capturada por el marco y convertida en una respuesta HTTP con informaci√≥n de error. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@api_view("GET") def get_character(id: str, calendar: Calendar) -&gt; Character:    try:        return Store.get_character(id)    except CharacterNotFound:        raise Http404Exception()</span></span></code> </pre> <br>  Este ejemplo tambi√©n muestra el m√©todo HTTP en el decorador, que establece los m√©todos HTTP permitidos para esta API. <br><br><h2>  <font color="#3AC1EF">Las herramientas</font> </h2><br>  La API HTTP est√° fuertemente tipada usando el m√©todo HTTP, los tipos de solicitud y los tipos de respuesta.  Podemos introspectar esta API y determinar que debe aceptar una solicitud GET con la cadena de <code>id</code> en la ruta URL y con el valor del <code>calendar</code> relacionado con la enumeraci√≥n correspondiente en la cadena de consulta.  Tambi√©n podemos aprender que, en respuesta a dicha solicitud, se debe proporcionar una respuesta JSON con informaci√≥n sobre la naturaleza de <code>Character</code> . <br><br>  ¬øQu√© se puede hacer con toda esta informaci√≥n? <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OpenAPI</a> es un formato de descripci√≥n de API en base al cual se crea un rico conjunto de herramientas auxiliares.  Este es todo un ecosistema.  Si escribimos alg√∫n c√≥digo para realizar una introspecci√≥n de punto final y generar especificaciones OpenAPI basadas en los datos recibidos, esto significar√° que tendremos las capacidades de estas herramientas. <br><br><pre> <code class="python hljs">paths:  /characters/{id}:    get:      parameters:        - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: path          name: id          schema:            type: integer          required: true        - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: query          name: calendar          schema:            type: string            enum: [<span class="hljs-string"><span class="hljs-string">"BBY"</span></span>]      responses:        <span class="hljs-string"><span class="hljs-string">'200'</span></span>:          content:            application/json:              schema:                type: object                ...</code> </pre> <br>  Podemos generar documentaci√≥n de la API HTTP para la API <code>get_character</code> , que incluye nombres, tipos, informaci√≥n de solicitud y respuesta.  Este es un nivel apropiado de abstracci√≥n para los desarrolladores de clientes que necesitan cumplir solicitudes al punto final apropiado.  No necesitan leer el c√≥digo de implementaci√≥n de Python para este punto final. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/673/e79/28e/673e7928eb5c55d4d6ec83c506eaf450.png"><br>  <i><font color="#999999">Documentaci√≥n API</font></i> <br><br>  Sobre esta base, puede crear herramientas adicionales.  Por ejemplo, un medio para ejecutar una solicitud desde un navegador.  Esto permite a los desarrolladores acceder a las API HTTP que les interesan sin tener que escribir c√≥digo.  Incluso podemos generar un c√≥digo de cliente de tipo seguro para garantizar que los tipos funcionen correctamente tanto en el cliente como en el servidor.  Debido a esto, podemos tener a nuestra disposici√≥n una API estrictamente tipada en el servidor, cuyas llamadas se realizan utilizando un c√≥digo de cliente estrictamente tipado. <br><br>  Adem√°s, podemos crear un sistema de verificaci√≥n de compatibilidad con versiones anteriores.  ¬øQu√© sucede si lanzamos una nueva versi√≥n del c√≥digo del servidor para acceder a la API en cuesti√≥n? Necesitamos usar <code>id</code> , <code>name</code> y <code>birth_year</code> , y luego entendemos que no sabemos los cumplea√±os de todos los personajes.  En este caso, el par√°metro <code>birth_year</code> hacerse opcional, pero las versiones antiguas de clientes que esperan un par√°metro similar pueden simplemente dejar de funcionar.  Aunque nuestras API difieren en la tipificaci√≥n expl√≠cita, los tipos correspondientes pueden cambiar (por ejemplo, la API cambiar√° si el uso del a√±o de nacimiento del personaje fue obligatorio y luego se convirti√≥ en opcional).  Podemos rastrear los cambios de API y advertir a los desarrolladores de API d√°ndoles indicaciones en el momento adecuado de que, al hacer algunos cambios, pueden interrumpir el rendimiento de los clientes. <br><br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>  Existe una amplia gama de protocolos de aplicaci√≥n que las computadoras pueden usar para comunicarse entre s√≠. <br><br>  Un lado de este espectro est√° representado por marcos RPC como Thrift y gRPC.  Se diferencian en que generalmente establecen tipos estrictos para solicitudes y respuestas y generan c√≥digo de cliente y servidor para organizar el funcionamiento de las solicitudes.  Pueden prescindir de HTTP e incluso sin JSON. <br><br>  Por otro lado, hay marcos web no estructurados escritos en Python que no tienen contratos expl√≠citos para solicitudes y respuestas.  Nuestro enfoque brinda oportunidades t√≠picas para marcos estructurados m√°s claramente, pero al mismo tiempo le permite continuar usando el paquete HTTP + JSON y contribuye al hecho de que tiene que hacer un m√≠nimo de cambios en el c√≥digo de la aplicaci√≥n. <br><br>  Es importante tener en cuenta que esta idea no es nueva.  Hay muchos marcos escritos en lenguajes fuertemente tipados que brindan a los desarrolladores las caracter√≠sticas que describimos.  Si hablamos de Python, este es, por ejemplo, el marco <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">APIStar</a> . <br><br>  Hemos encargado con √©xito el uso de tipos para la API HTTP.  Pudimos aplicar el enfoque descrito para escribir la API en toda nuestra base de c√≥digo debido al hecho de que se aplica bien a las funciones de presentaci√≥n existentes.  El valor de lo que hicimos es obvio para todos nuestros programadores.  Es decir, estamos hablando del hecho de que la documentaci√≥n generada autom√°ticamente se ha convertido en un medio efectivo de comunicaci√≥n para aquellos involucrados en el desarrollo del servidor con aquellos que escriben el cliente de Instagram. <br><br>  <b>Estimados lectores!</b>  ¬øC√≥mo aborda el dise√±o de las API HTTP en sus proyectos de Python? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/474308/">https://habr.com/ru/post/474308/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../474294/index.html">Compatibilidad binaria: ahora o nunca</a></li>
<li><a href="../474298/index.html">Implementaci√≥n de una puerta de enlace P2P Operaciones de transferencia de tarjeta a tarjeta</a></li>
<li><a href="../474300/index.html">Respaldo confiable, seguro y vers√°til para U2F</a></li>
<li><a href="../474302/index.html">C√≥mo escribir un script de prueba de usabilidad de aplicaci√≥n efectiva</a></li>
<li><a href="../474306/index.html">Haga que los estilos de apuntar, enfocar y estado activo sean diferentes.</a></li>
<li><a href="../474310/index.html">¬øHay n√∫meros aleatorios en CSS?</a></li>
<li><a href="../474312/index.html">Instalaci√≥n de la GUI en Windows Server Core</a></li>
<li><a href="../474316/index.html">Coche el√©ctrico hecho en casa, parte 1. C√≥mo comenz√≥ todo y c√≥mo obtuve 1,000,000 de visitas en youtube</a></li>
<li><a href="../474318/index.html">¬øQu√© es una mesa de mesa virtual?</a></li>
<li><a href="../474320/index.html">DDD Crisis comunitaria</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>