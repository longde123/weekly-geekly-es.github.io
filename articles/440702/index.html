<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úåüèΩ ü§±üèΩ üâê Precauci√≥n: ¬°GAS! o c√≥mo hicimos contratos inteligentes sin gas ü•® üà¥ üë©üèº‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Blockchain y los contratos inteligentes siguen siendo un tema candente entre los desarrolladores y t√©cnicos. Hay mucha investigaci√≥n y discusi√≥n sobre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Precauci√≥n: ¬°GAS! o c√≥mo hicimos contratos inteligentes sin gas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/waves/blog/440702/"><p><img src="https://habrastorage.org/webt/ps/lh/d4/pslhd4hgoxgjskexszwtn40mivo.png"></p><br><p>  Blockchain y los contratos inteligentes siguen siendo un tema candente entre los desarrolladores y t√©cnicos.  Hay mucha investigaci√≥n y discusi√≥n sobre su futuro y hacia d√≥nde se mueve todo y hacia d√≥nde conducir√°.  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Waves Platform tenemos</a> nuestra propia opini√≥n sobre lo que deber√≠an ser los contratos inteligentes, y en este art√≠culo te dir√© c√≥mo los hicimos, qu√© problemas encontramos y por qu√© no son como los contratos inteligentes de otros proyectos de blockchain (en primer lugar Ethereum). </p><br><p>  Este art√≠culo tambi√©n es una gu√≠a para aquellos que desean comprender c√≥mo funcionan los contratos inteligentes en la red de Waves, tratar de escribir su propio contrato y familiarizarse con las herramientas que los desarrolladores ya tienen a su disposici√≥n. </p><a name="habracut"></a><br><h2 id="kak-my-doshli-do-zhizni-takoy">  ¬øC√≥mo llegamos a tal vida? </h2><br><p>  A menudo nos preguntaron cu√°ndo obtuvimos contratos inteligentes, porque a los desarrolladores les gust√≥ la facilidad de trabajar con la red, la velocidad de la red (gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Waves NG</a> ) y el bajo nivel de comisiones.  Sin embargo, los contratos inteligentes brindan mucho m√°s espacio para la imaginaci√≥n. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Los contratos inteligentes se</a> han vuelto muy populares en los √∫ltimos a√±os debido a la difusi√≥n de la cadena de bloques.  Aquellos que se han encontrado con la tecnolog√≠a blockchain en su trabajo, cuando mencionan contratos inteligentes, generalmente piensan en Ethereum y Solidity.  Pero hay muchas plataformas blockchain con contratos inteligentes, y la mayor√≠a de ellas simplemente repitieron lo que hizo Ethereum (m√°quina virtual + su propio lenguaje de contrato).  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este repositorio hay</a> una lista interesante con diferentes lenguajes y enfoques. </p><br><h2 id="chto-takoe-smart-kontrakt">  ¬øQu√© es un contrato inteligente? </h2><br><p>  En un sentido amplio, un contrato inteligente es un protocolo dise√±ado para respaldar, verificar y hacer cumplir los t√©rminos de una transacci√≥n o la ejecuci√≥n de contratos entre las partes.  La idea fue propuesta por primera vez en 1996 por Nick Szabo, pero los contratos inteligentes se han vuelto populares solo en los √∫ltimos a√±os. </p><br><p>  Desde un punto de vista t√©cnico (que nos interesa m√°s), un contrato inteligente es un algoritmo (c√≥digo) que se ejecuta no en un servidor o computadora, sino en muchos (o todos) nodos en la red blockchain, es decir.  descentralizado </p><br><h2 id="kak-eto-rabotaet">  Como funciona </h2><br><p>  El primer prototipo de un contrato inteligente en la cadena de bloques se considera correctamente Bitcoin Script, incompleto por Turing, un lenguaje basado en pila en la red Bitcoin.  No hay un concepto de cuenta en Bitcoin; en cambio, hay entradas y salidas.  En Bitcoin, al realizar una transacci√≥n (crear una salida), es necesario hacer referencia a la transacci√≥n de recepci√≥n (entrada).  Si est√° interesado en los detalles t√©cnicos del dispositivo Bitcoin, le recomiendo que lea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esta serie de art√≠culos</a> .  Como no hay cuentas en Bitcoin, Bitcoin Script determina en qu√© caso se puede gastar una u otra salida. </p><br><p> Ethereum ofrece muchas m√°s funciones, como  Proporciona Solidity, un lenguaje completo de Turing que se ejecuta en una m√°quina virtual dentro de cada nodo.  Con un gran poder viene una gran responsabilidad, y con una amplia gama de posibilidades: un n√∫mero bastante grande de restricciones, de las que hablaremos m√°s adelante. </p><br><h1 id="smart-kontrakty-waves">  Ondas de contratos inteligentes </h1><br><p>  Como escrib√≠ anteriormente, a menudo nos preguntaban sobre los contratos inteligentes, pero no quer√≠amos hacer "me gusta en el aire" o "me gusta en anyblockchainname", y hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muchas razones para esto</a> .  Por lo tanto, analizamos los casos existentes para contratos y c√≥mo podemos ayudar a resolver problemas reales con su ayuda. </p><br><p>  Despu√©s de analizar los escenarios de uso, descubrimos que hay 2 grandes categor√≠as de tareas que generalmente se resuelven mediante contratos inteligentes: </p><br><ol><li>  Tareas simples y directas como multisig, intercambios at√≥micos o custodia. </li><li>  dApps, aplicaciones descentralizadas completas con l√≥gica de usuario.  Para ser m√°s precisos, este es un back-end para aplicaciones descentralizadas.  Los ejemplos m√°s llamativos son Cryptokitties o Bancor. </li></ol><br><p>  Tambi√©n hay un tercer tipo de contrato m√°s popular: los tokens.  En la red Ethereum, por ejemplo, la gran mayor√≠a de los contratos de trabajo son tokens est√°ndar ERC20.  En Waves, para crear tokens no es necesario hacer contratos inteligentes, ya que  son parte de la cadena de bloques en s√≠, y para emitir un token (con la capacidad de intercambiarlo inmediatamente en un intercambio descentralizado (DEX)) es suficiente enviar una transacci√≥n de tipo de emisi√≥n (transacci√≥n de emisi√≥n). </p><br><p>  Para los dos tipos de tareas anteriores (por simplicidad llamaremos casos simples y complejos), los requisitos para el lenguaje, los contratos y los conceptos son muy diferentes.  S√≠, podemos decir que tener un lenguaje completo de Turing puede resolver problemas simples y complejos, pero hay una condici√≥n importante: el lenguaje debe ayudar a evitar errores.  Este requisito tambi√©n es importante para los idiomas ordinarios, y para los idiomas de contrato inteligente es especialmente importante, porque  las operaciones est√°n relacionadas financieramente, y los contratos a menudo son inmutables, y no hay forma de corregir un error de manera r√°pida y f√°cil. </p><br><p>  Dado el tipo de tareas descritas anteriormente, decidimos movernos gradualmente y dar una herramienta para resolver problemas simples como primer paso, y dar un lenguaje tan f√°cil como el siguiente paso para implementar f√°cilmente cualquier l√≥gica de usuario.  Como resultado, el sistema result√≥ ser mucho m√°s poderoso de lo que imaginamos al comienzo del viaje. </p><br><h2 id="sdelaem-akkaunty-umnymi">  Hagamos cuentas inteligentes </h2><br><p>  Poco a poco, llegamos al concepto de cuentas inteligentes, que est√°n dise√±adas para resolver tareas principalmente simples.  Su idea es muy similar a Bitcoin Script: se pueden agregar reglas adicionales a la cuenta que determinan la validez de la transacci√≥n saliente.  Los principales requisitos para las cuentas inteligentes fueron: </p><br><ol><li>  M√°xima seguridad.  Casi todos los meses puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">noticias de</a> que se encontr√≥ otra vulnerabilidad en los contratos modelo de Ethereum.  Quer√≠amos evitar esto. </li><li>  No hay necesidad de gas, por lo que la comisi√≥n es fija.  Para hacer esto, el script debe ejecutarse en un per√≠odo de tiempo predecible y tener l√≠mites de tama√±o bastante estrictos. </li></ol><br><p>  Antes de continuar con los detalles t√©cnicos de la implementaci√≥n y redacci√≥n de contratos, describimos algunas caracter√≠sticas de la cadena de bloques Waves que ser√°n importantes para una mejor comprensi√≥n: </p><br><ol><li>  La cadena de bloques Waves actualmente tiene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">13 tipos diferentes de transacciones.</a> </li></ol><br><p><img src="https://habrastorage.org/webt/dx/to/mz/dxtomzcjjyp7jgwa9wcsmfana1u.png"></p><br><ol><li>  En la cadena de bloques Waves, no entradas y salidas (como en Bitcoin), sino cuentas (como, por ejemplo, en Nxt).  Una transacci√≥n se realiza en nombre de una cuenta espec√≠fica. </li><li>  Por defecto, la exactitud de una transacci√≥n est√° determinada por el estado actual de la cadena de bloques y la validez de la firma en nombre de la cual se env√≠a la transacci√≥n.  La representaci√≥n JSON de la transacci√≥n parece bastante simple: </li></ol><br><p><img src="https://habrastorage.org/webt/gl/0a/m-/gl0am-s8dyjwnsgnksk0tf1fzyu.png"></p><br><p> Como ya tenemos diferentes tipos de transacciones en la cadena de bloques, decidimos que no har√≠amos una entidad separada como una cuenta inteligente, sino que agregar√≠amos una nueva transacci√≥n que convierta una cuenta normal en una inteligente.  Cualquier cuenta puede convertirse en una cuenta inteligente con reglas de validaci√≥n de transacci√≥n modificadas, para esto, la cuenta simplemente debe enviar una transacci√≥n del tipo <code>SetScriptTransaction</code> , que contiene el contrato compilado. </p><br><p>  En el caso de una cuenta inteligente, el contrato es una regla de validaci√≥n para cada _ transacci√≥n saliente. </p><br><h2 id="a-chto-tam-s-gazom">  ¬øY qu√© hay del gas? </h2><br><p>  Una de las principales tareas que nos proponemos es eliminar el gas para operaciones simples.  Esto no significa que no habr√° comisi√≥n.  Es necesario para que los mineros tengan inter√©s en ejecutar scripts.  Abordamos el tema desde el punto de vista pr√°ctico y decidimos realizar pruebas de rendimiento y calcular la velocidad de varias operaciones.  Para esto, se desarrollaron puntos de referencia con JMH.  Los resultados se pueden ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Las limitaciones resultantes son: </p><br><ol><li>  El script debe ejecutarse m√°s r√°pido que 20 operaciones de verificaci√≥n de firma, lo que significa que las comprobaciones para una cuenta inteligente no ser√°n m√°s de 20 veces m√°s lentas que para una cuenta normal.  El tama√±o del script no debe exceder los 8 KB. </li><li>  Para que sea rentable que los mineros cumplan contratos inteligentes, establecemos una comisi√≥n adicional m√≠nima para cuentas inteligentes por un monto de 0.004 ONDAS.  La comisi√≥n m√≠nima en la red de Waves para una transacci√≥n es 0.001 WAVES, en el caso de una cuenta inteligente - 0.005 WAVES. </li></ol><br><h1 id="yazyk-dlya-smart-kontraktov">  Lenguaje para contratos inteligentes </h1><br><p>  Una de las tareas m√°s dif√≠ciles fue la creaci√≥n de su propio lenguaje de contratos inteligentes.  Tomar cualquier lenguaje existente de turing completo y adaptar (recortar) para nuestras tareas parece estar disparando desde un ca√±√≥n a gorriones: adem√°s de esto, depender de la base de c√≥digo de otra persona en un proyecto de blockchain es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">extremadamente riesgoso</a> . </p><br><p>  Tratemos de imaginar cu√°l deber√≠a ser el lenguaje ideal para contratos inteligentes.  En mi opini√≥n, cualquier lenguaje de programaci√≥n deber√≠a obligar a escribir c√≥digo "correcto" y seguro, es decir  idealmente deber√≠a haber una manera correcta.  S√≠, si lo desea, puede escribir c√≥digo completamente ilegible y no compatible en cualquier idioma, pero esto deber√≠a ser m√°s dif√≠cil que escribirlo correctamente (hola PHP y JavaScript).  Al mismo tiempo, el lenguaje debe ser conveniente para el desarrollo.  Dado que el lenguaje se ejecuta en todos los nodos de la red, es necesario que sea lo m√°s eficiente posible: la ejecuci√≥n diferida puede ahorrar una gran cantidad de recursos.  Tambi√©n quiero tener un sistema de tipos poderoso en el lenguaje, preferiblemente algebraico, porque ayuda a describir el contrato de la manera m√°s clara posible y acercarse al sue√±o del "C√≥digo es ley".  Si formalizamos nuestros requisitos un poco m√°s, obtenemos los siguientes par√°metros de idioma: </p><br><ol><li>  Ser estrictamente y est√°ticamente escrito.  La escritura fuerte elimina autom√°ticamente muchos posibles errores de programador. </li><li>  Tenga un sistema de tipo potente para dificultarle dispararse en el pie. </li><li>  Sea perezoso para no desperdiciar los preciosos ciclos de procesador. </li><li>  Tiene funciones espec√≠ficas en la biblioteca est√°ndar para trabajar con blockchain, por ejemplo, hashes.  Al mismo tiempo, la biblioteca de idiomas est√°ndar no debe sobrecargarse, porque siempre debe haber una forma correcta. </li><li>  No tiene excepciones en tiempo de ejecuci√≥n. </li></ol><br><p>  En nuestro lenguaje RIDE, tratamos de tener en cuenta estas caracter√≠sticas importantes, y dado que desarrollamos mucho en Scala y nos gusta la programaci√≥n funcional, el lenguaje en algunos aspectos es similar a Scala y F #. </p><br><p>  Los mayores problemas en la implementaci√≥n en la pr√°ctica surgieron con el √∫ltimo requisito, porque si no tiene excepciones en el idioma, entonces, por ejemplo, la operaci√≥n de adici√≥n tendr√° que devolver una <em>Opci√≥n</em> , que deber√° verificarse por desbordamiento, lo que definitivamente ser√° un inconveniente para los desarrolladores.  Las excepciones fueron un compromiso, pero sin la capacidad de atraparlas: si hubo una excepci√≥n, entonces la transacci√≥n no era v√°lida.  Otro problema fue transferir al lenguaje todos los modelos de datos que tenemos en la cadena de bloques.  Ya he descrito que en Waves hay 13 tipos diferentes de transacciones que deben admitirse en el idioma y tener acceso a todos sus campos. </p><br><p>  La informaci√≥n completa sobre las operaciones disponibles y los tipos de datos en RIDE se encuentra en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la p√°gina de descripci√≥n del idioma</a> .  Entre las caracter√≠sticas interesantes del lenguaje, tambi√©n podemos destacar el hecho de que el lenguaje est√° basado en expresiones, es decir, todo es expresi√≥n, as√≠ como la presencia de coincidencia de patrones, lo que le permite describir convenientemente las condiciones para los diferentes tipos de transacciones: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">match</span></span> tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> t:<span class="hljs-type"><span class="hljs-type">TransferTransaction</span></span> =&gt; t.recepient <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> t:<span class="hljs-type"><span class="hljs-type">MassTransferTransaction</span></span> =&gt; t.transfers <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> }</code> </pre> <br><p>  Si est√° interesado en aprender c√≥mo se organiza el trabajo con el c√≥digo RIDE, debe consultar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el documento t√©cnico</a> , que describe todas las etapas del trabajo con un contrato: an√°lisis, compilaci√≥n, deserializaci√≥n, c√°lculo de la complejidad y ejecuci√≥n del script.  Las dos primeras etapas: el an√°lisis y la compilaci√≥n se realizan fuera de la cadena, solo el contrato compilado en base64 ingresa a la cadena de bloques.  La deserializaci√≥n, el c√°lculo y la ejecuci√≥n de la complejidad se realizan en cadena y varias veces en diferentes etapas: </p><br><ol><li>  Cuando recibe una transacci√≥n y la agrega a UTX, de lo contrario, el nodo de la cadena de bloques aceptar√° la transacci√≥n, por ejemplo, a trav√©s de la API REST, pero nunca entrar√° en el bloque. </li><li>  Cuando se forma un bloque, el nodo de miner√≠a valida las transacciones y se requiere el script. </li><li>  Tras la recepci√≥n por parte de los nodos no mineros de un bloque y la validaci√≥n de las transacciones incluidas en el mismo. </li></ol><br><p>  Cada optimizaci√≥n en el trabajo con contratos se vuelve valiosa, ya que se realiza muchas veces en muchos nodos de la red.  Ahora los nodos Waves se ejecutan silenciosamente en m√°quinas virtuales por $ 15 en DigitalOcean, a pesar del aumento en las cargas de trabajo despu√©s del lanzamiento de cuentas inteligentes. </p><br><h2 id="a-chto-v-itoge">  Cual es el resultado? </h2><br><p>  Ahora veamos qu√© tenemos en Waves.  Escribamos nuestro primer contrato propio, que sea el contrato multisig est√°ndar 2-de-3.  Para escribir un contrato, puede usar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IDE en l√≠nea</a> (ajuste para el idioma, un tema para un art√≠culo separado).  Cree un nuevo contrato vac√≠o (Nuevo ‚Üí Contrato vac√≠o). </p><br><p>  En primer lugar, anunciaremos las claves p√∫blicas de Alice, Bob y Cooper, que controlar√°n la cuenta.  Necesitar√° 2 de sus 3 firmas: </p><br><pre> <code class="scala hljs">let alicePubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'B1Yz7fH1bJ2gVDjyJnuyKNTdMFARkKEp</span></span>V' let bobPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'7hghYeWtiekfebgAcuCg9ai2NXbRreNz</span></span>c' let cooperPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'BVqYXrapgJP9atQccdBPAgJPwHDKkh6A</span></span>8'</code> </pre> <br><p>  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n describe</a> la funci√≥n <code>sigVerify</code> , que le permite verificar la firma de la transacci√≥n: </p><br><p><img src="https://habrastorage.org/webt/fw/am/py/fwampygopgdhgrmb9v4z67mkszq.png"></p><br><p>  Los argumentos de la funci√≥n son el cuerpo de la transacci√≥n, la firma verificada y la clave p√∫blica.  Un objeto <code>tx</code> est√° disponible en el contrato en el √°mbito global, en el que se almacena la informaci√≥n de la transacci√≥n.  Este objeto tiene un campo <code>tx.bodyBytes</code> que contiene los bytes de la transacci√≥n que se env√≠a.  Tambi√©n hay una variedad de <code>tx.proofs</code> , que almacena firmas, que pueden ser hasta 8. Vale la pena se√±alar que, de hecho, puede enviar no solo firmas a <code>tx.proofs</code> , sino cualquier otra informaci√≥n que pueda ser utilizada por el contrato. </p><br><p>  Podemos asegurarnos de que se presenten todas las firmas y que est√©n en el orden correcto mediante 3 l√≠neas simples: </p><br><pre> <code class="scala hljs">let aliceSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], alicePubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let bobSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">1</span></span>], bobPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let cooperSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">2</span></span>], cooperPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  Bueno, el √∫ltimo paso ser√° verificar que se env√≠en al menos 2 firmas. </p><br><pre> <code class="scala hljs">aliceSigned + bobSigned + cooperSigned &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br><p>  El contrato completo de 2 de 3 firmas m√∫ltiples se ve as√≠: </p><br><pre> <code class="scala hljs">#    let alicePubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'B1Yz7fH1bJ2gVDjyJnuyKNTdMFARkKEp</span></span>V' let bobPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'7hghYeWtiekfebgAcuCg9ai2NXbRreNz</span></span>c' let cooperPubKey = base58<span class="hljs-symbol"><span class="hljs-symbol">'BVqYXrapgJP9atQccdBPAgJPwHDKkh6A</span></span>8' #       let aliceSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], alicePubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let bobSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">1</span></span>], bobPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> let cooperSigned = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sigVerify(tx.bodyBytes, tx.proofs[<span class="hljs-number"><span class="hljs-number">2</span></span>], cooperPubKey )) then <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> # ,      <span class="hljs-number"><span class="hljs-number">2</span></span>   aliceSigned + bobSigned + cooperSigned &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br><p>  Tenga en cuenta: no hay palabras clave como <code>return</code> en el c√≥digo, porque la √∫ltima l√≠nea ejecutada se considera el resultado del script, y es por eso que siempre debe devolver <code>true</code> o <code>false</code> </p><br><p>  En comparaci√≥n, el contrato de firma m√∫ltiple Ethereum com√∫n <a href="">parece mucho m√°s complicado</a> .  Incluso variaciones relativamente simples se ven as√≠: </p><br><pre> <code class="plaintext hljs"> pragma solidity ^0.4.22; contract SimpleMultiSig { uint public nonce; // (only) mutable state uint public threshold; // immutable state mapping (address =&gt; bool) isOwner; // immutable state address[] public ownersArr; // immutable state // Note that owners_ must be strictly increasing, in order to prevent duplicates constructor(uint threshold_, address[] owners_) public { require(owners_.length &lt;= 10 &amp;&amp; threshold_ &lt;= owners_.length &amp;&amp; threshold_ &gt;= 0); address lastAdd = address(0); for (uint i = 0; i &lt; owners_.length; i++) { require(owners_[i] &gt; lastAdd); isOwner[owners_[i]] = true; lastAdd = owners_[i]; } ownersArr = owners_; threshold = threshold_; } // Note that address recovered from signatures must be strictly increasing, in order to prevent duplicates function execute(uint8[] sigV, bytes32[] sigR, bytes32[] sigS, address destination, uint value, bytes data) public { require(sigR.length == threshold); require(sigR.length == sigS.length &amp;&amp; sigR.length == sigV.length); // Follows ERC191 signature scheme: https://github.com/ethereum/EIPs/issues/191 bytes32 txHash = keccak256(byte(0x19), byte(0), this, destination, value, data, nonce); address lastAdd = address(0); // cannot have address(0) as an owner for (uint i = 0; i &lt; threshold; i++) { address recovered = ecrecover(txHash, sigV[i], sigR[i], sigS[i]); require(recovered &gt; lastAdd &amp;&amp; isOwner[recovered]); lastAdd = recovered; } // If we make it here all signatures are accounted for. // The address.call() syntax is no longer recommended, see: // https://github.com/ethereum/solidity/issues/2884 nonce = nonce + 1; bool success = false; assembly { success := call(gas, destination, value, add(data, 0x20), mload(data), 0, 0) } require(success); } function () payable public {} }</code> </pre> <br><p>  El IDE tiene una consola incorporada que le permite compilar inmediatamente un contrato, implementarlo, crear transacciones y ver el resultado de la ejecuci√≥n.  Y si desea trabajar seriamente con los contratos, le recomiendo que busque en las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bibliotecas los diferentes idiomas</a> y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complemento para Visual Studio Code</a> . </p><br><p>  Si tiene picaz√≥n en las manos, al final del art√≠culo encontrar√° los enlaces m√°s importantes para comenzar la inmersi√≥n. </p><br><h2 id="sistema-moschnee-chem-yazyk">  El sistema es m√°s poderoso que el lenguaje. </h2><br><p>  La cadena de bloques Waves tiene tipos de datos especiales para almacenar datos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">transacciones de datos</a> .  Funcionan como almacenamiento de valor clave asociado con una cuenta, es decir, en cierto sentido, este es el estado de la cuenta. </p><br><p><img src="https://habrastorage.org/webt/3o/oh/4h/3ooh4hitfov4sdfhobfhglpec98.png"></p><br><p>  La fecha de transacci√≥n puede contener cadenas, n√∫meros, valores booleanos y conjuntos de bytes de hasta 32 KB por clave.  Un ejemplo de trabajo con Transacciones de datos, que le permite enviar una transacci√≥n solo si el almacenamiento del valor clave de la cuenta ya contiene el n√∫mero 42 en la clave <code>key</code> : </p><br><pre> <code class="scala hljs">let keyName = <span class="hljs-string"><span class="hljs-string">"key"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> (tx) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> tx:<span class="hljs-type"><span class="hljs-type">DataTransaction</span></span> =&gt; let x = extract(getInteger(tx.sender, keyName)) x == <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><blockquote>  Gracias a Data Transaction, las cuentas inteligentes se convierten en una herramienta extremadamente poderosa que le permite trabajar con or√°culos, administrar el estado y describir convenientemente el comportamiento. </blockquote><p><img src="https://habrastorage.org/webt/ew/ce/gf/ewcegfy0nsj4s8t34c6sn2v7hew.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Este art√≠culo</a> describe c√≥mo puede implementar NFT (tokens no fungibles) mediante transacciones de datos y un contrato inteligente que controla el estado.  Como resultado, el estilo de la cuenta contendr√° entradas del formulario: </p><br><pre> <code class="plaintext hljs">+------------+-----------------------------------------------+ | Token Name | Owner Publc Key | +------------+-----------------------------------------------+ | "Token #1" | "6iQaHazE9NVAJfAjMpHifDXMfr1euWcy8fmW6rNcdhr" | | "Token #2" | "3tNLxyJnyxLzDkMkqiZmUjRqXe1UuwFeSyQ14GRYnGL" | | "Token #3" | "3wH7rENpbS78uohErXHq77yKzQwRyKBYhzCR9nKU17q" | | "Token #4" | "6iQaHazE9NVAJfAjMpHifDXMfr1euWcy8fmW6rNcdhr" | | "Token #5" | "6iQaHazE9NVAJfAjMpHifDXMfr1euWcy8fmW6rNcdhr" | +------------+-----------------------------------------------+</code> </pre> <br><p>  El contrato NFT en s√≠ mismo parece extremadamente simple: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">match</span></span> tx { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> dt: <span class="hljs-type"><span class="hljs-type">DataTransaction</span></span> =&gt; let oldOwner = extract(getString(dt.sender, dt.data[<span class="hljs-number"><span class="hljs-number">0</span></span>].key)) let newOwner = getBinary(dt.data, <span class="hljs-number"><span class="hljs-number">0</span></span>) size(dt.data) == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; sigVerify(dt.bodyBytes, dt.proofs[<span class="hljs-number"><span class="hljs-number">0</span></span>], fromBase58String(oldOwner)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre> <br><h1 id="a-chto-dalshe">  Que sigue </h1><br><p>  El desarrollo adicional de los contratos inteligentes de Waves es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ride4DApps</a> , que permitir√° llamar contratos en otras cuentas, y un lenguaje (o sistema) completo de Turing que le permitir√° resolver todo tipo de tareas, activar otras tareas, etc. </p><br><p>  Otra direcci√≥n interesante para el desarrollo de contratos inteligentes en el ecosistema de Waves es Smart Assets, que funciona seg√∫n un principio similar: contratos de Turing incompletos que se relacionan con el token.  El contrato controla las condiciones bajo las cuales se pueden completar las transacciones de tokens.  Por ejemplo, con su ayuda, ser√° posible congelar tokens a una cierta altura de blockchain o prohibir el intercambio de tokens p2p.  Puede leer m√°s sobre activos inteligentes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el blog</a> . </p><br><p>  Bueno, al final volver√© a dar una lista de lo que ser√° necesario para comenzar a trabajar con contratos inteligentes en la red de Waves. </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La documentaci√≥n</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IDE con consola</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Libro blanco para los m√°s curiosos.</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440702/">https://habr.com/ru/post/440702/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440690/index.html">Caracter√≠sticas de trabajar con Mesh en Unity</a></li>
<li><a href="../440692/index.html">¬øQu√© hay de malo con las pruebas A / B?</a></li>
<li><a href="../440694/index.html">Crea una escena b√°sica en A-Frame</a></li>
<li><a href="../440696/index.html">Kit de herramientas de refactorizaci√≥n de bases de datos: Flyway vs. Liquibase</a></li>
<li><a href="../440700/index.html">Ciencia de datos "fuerzas especiales" internamente</a></li>
<li><a href="../440706/index.html">InoThings ++ Professional IoT Conference: qu√© fue y qu√© ser√°</a></li>
<li><a href="../440708/index.html">Webinar abierto "Trabajo: propio y ajeno"</a></li>
<li><a href="../440710/index.html">Dos aspectos de WebView: acerca del inicio r√°pido de proyectos y el robo de datos personales</a></li>
<li><a href="../440712/index.html">La nube es solo la computadora de alguien</a></li>
<li><a href="../440714/index.html">C√≥mo nos afecta la reducci√≥n de la tasa de adquisici√≥n (tarjetahabientes)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>