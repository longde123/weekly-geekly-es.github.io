<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍💻 🏷️ 💪🏿 Automatisez la transition vers React Hooks 🤶 🥈 🍺</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="React 16.18 est la première version stable avec prise en charge des hooks React . Vous pouvez désormais utiliser des hooks sans craindre que l'API cha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatisez la transition vers React Hooks</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441722/"><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">React 16.18</a> est la première version stable avec prise en charge des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hooks</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">React</a> .  Vous pouvez désormais utiliser des hooks sans craindre que l'API change radicalement.  Bien que l' <code>react</code> développement de <code>react</code> conseille d'utiliser la nouvelle technologie uniquement pour les nouveaux composants, beaucoup, y compris moi-même, aimeraient les utiliser pour les composants plus anciens qui utilisent des classes.  Mais comme le refactoring manuel est un processus laborieux, nous allons essayer de l'automatiser.  Les techniques décrites dans cet article conviennent pour automatiser la refactorisation non seulement des composants <code>react</code> , mais également de tout autre code <code>JavaScript</code> . </p><a name="habracut"></a><br><h2 id="osobennosti-react-hooks">  Caractéristiques React Hooks </h2><br><p>  L'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">React Hooks Introduction</a> détaille ce que sont les hameçons et ce avec quoi ils mangent.  En bref, il s'agit d'une nouvelle technologie folle pour créer <code>state</code> composants sans <code>state</code> sans utiliser de classes. </p><br><p>  Considérez le fichier <code>button.js</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {Component} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Button; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Button</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { <span class="hljs-attr"><span class="hljs-attr">enabled</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.toogle = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._toggle.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } _toggle() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ <span class="hljs-attr"><span class="hljs-attr">enabled</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }); } render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {enabled} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{enabled}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.toggle}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); } }</span></span></code> </pre> <br><p>  Avec des crochets, cela ressemblera à ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {useState} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Button; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [enabled, setEnabled] = useState(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ setEnabled(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{enabled}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{toggle}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); }</span></span></code> </pre> <br><p>  Vous pouvez discuter pendant longtemps de la façon dont ce type d'enregistrement est plus évident pour les personnes peu familiarisées avec la technologie, mais une chose est immédiatement claire: le code est plus concis et plus facile à réutiliser.  Des ensembles intéressants de crochets personnalisés peuvent être trouvés sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">usehooks.com</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">streamich.github.io</a> . </p><br><p>  Ensuite, nous analyserons les différences de syntaxe dans les moindres détails et traiterons du processus de conversion de code de programme, mais avant cela, je voudrais parler d'exemples d'utilisation de cette forme de notation. </p><br><h2 id="liricheskoe-otstuplenie-nestandartnoe-ispolzovanie-sintaksisa-destrukturizacii">  Digression lyrique: utilisation non standard de la syntaxe de déstructuration </h2><br><p>  <code>ES2015</code> donné au monde une chose aussi merveilleuse que la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">restructuration des baies</a> .  Et maintenant, au lieu d'extraire chaque élément individuellement: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> letters = [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> first = letters[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> second = letters[<span class="hljs-number"><span class="hljs-number">1</span></span>];</code> </pre> <br><p>  Nous pouvons obtenir tous les éléments nécessaires à la fois: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> letters = [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [first, second] = letters;</code> </pre> <br><p>  Un tel enregistrement est non seulement plus concis, mais aussi moins sujet aux erreurs, car il supprime la nécessité de se souvenir des indices des éléments et vous permet de vous concentrer sur ce qui est vraiment important: l'initialisation des variables. </p><br><p>  Ainsi, nous arrivons à la <code>es2015</code> que si ce n'était pas pour <code>es2015</code> équipe de <code>es2015</code> ne trouverait pas une manière aussi inhabituelle de travailler avec l'État. </p><br><p>  Ensuite, je voudrais considérer plusieurs bibliothèques qui utilisent une approche similaire. </p><br><h4 id="try-catch">  Essayez d'attraper </h4><br><p>  Six mois avant l'annonce de hooks dans la réaction, j'ai eu l'idée que la déstructuration peut être utilisée non seulement pour obtenir des données homogènes du tableau, mais aussi pour obtenir des informations sur une erreur ou le résultat d'une fonction, par analogie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">avec des rappels dans node.js.</a>  Par exemple, au lieu d'utiliser la syntaxe <code>try-catch</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { data = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(<span class="hljs-string"><span class="hljs-string">'xxxx'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { error = e; }</code> </pre> <br><p>  Ce qui semble très lourd, mais porte peu d'informations, et nous oblige à utiliser <code>let</code> , bien que nous n'ayons pas prévu de changer les valeurs des variables.  Au lieu de cela, vous pouvez appeler la fonction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">try-catch</a> , qui fera tout ce dont vous avez besoin, nous sauvant des problèmes répertoriés ci-dessus: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, data] = tryCatch(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse, <span class="hljs-string"><span class="hljs-string">'xxxx'</span></span>);</code> </pre> <br><p>  De cette façon intéressante, nous nous sommes débarrassés de toutes les constructions syntaxiques inutiles, ne laissant que le nécessaire.  Cette méthode présente les avantages suivants: </p><br><ul><li>  la possibilité de spécifier n'importe quel nom de variable qui nous convient (lors de l'utilisation de la déstructuration d'objets, nous n'aurions pas un tel privilège, ou plutôt, il aurait son propre prix encombrant); </li><li>  la possibilité d'utiliser des constantes pour des données qui ne changent pas; </li><li>  syntaxe plus concise, tout ce qui pourrait être supprimé est manquant; </li></ul><br><p>  Et, encore une fois, tout cela grâce à la syntaxe de la déstructuration des tableaux.  Sans cette syntaxe, l'utilisation d'une bibliothèque serait ridicule: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = tryCatch(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse, <span class="hljs-string"><span class="hljs-string">'xxxx'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = result[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = result[<span class="hljs-number"><span class="hljs-number">1</span></span>];</code> </pre> <br><p>  C'est toujours du code valide, mais il perd beaucoup par rapport à la déstructuration.  Je veux également ajouter un exemple de la bibliothèque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">try-to-catch</a> , avec l'avènement de <code>async-await</code> la construction <code>try-catch</code> est toujours pertinente et peut être écrite comme ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, data] = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> tryToCatch(readFile, path, <span class="hljs-string"><span class="hljs-string">'utf8'</span></span>);</code> </pre> <br><p>  Si l'idée d'une telle utilisation de la déstructuration m'est venue, alors pourquoi pas les créateurs de la réaction aussi, car en fait, nous avons quelque chose comme une fonction qui a 2 valeurs de retour: un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tuple</a> d'un Haskell. </p><br><p>  Sur cette digression lyrique, on peut achever et passer à la question de la transformation. </p><br><h2 id="preobrazovanie-klassa-v-react-hooks">  Conversion d'une classe dans React Hooks </h2><br><p>  Pour la conversion, nous utiliserons le transformateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">putout</a> AST, qui vous permet de modifier uniquement ce qui est nécessaire et le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugin @ putout / plugin-react-hooks</a> . </p><br><p>  Afin de convertir la classe héritée de <code>Component</code> en une fonction utilisant <code>react-hooks</code> , les étapes suivantes doivent être effectuées: </p><br><ul><li>  supprimer la <code>bind</code> </li><li>  renommer les méthodes privées en public (supprimer "_"); </li><li>  changer <code>this.state</code> pour utiliser des crochets </li><li>  changer <code>this.setState</code> pour utiliser des crochets </li><li>  enlevez <code>this</code> de partout </li><li>  convertir la <code>class</code> en fonction </li><li>  dans les importations, utilisez <code>useState</code> au lieu de <code>Component</code> </li></ul><br><h3 id="podklyuchenie">  Connexion </h3><br><p>  Installez <code>putout</code> avec le <code>@putout/plugin-react-hooks</code> : </p><br><pre> <code class="plaintext hljs">npm i putout @putout/plugin-react-hooks -D</code> </pre> <br><p>  Ensuite, créez le fichier <code>.putout.json</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"react-hooks"</span></span> ] }</code> </pre> <br><p>  Essayez ensuite la <code>putout</code> en action. </p><br><div class="spoiler">  <b class="spoiler_title">En-tête de spoiler</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">coderaiser@cloudcmd:~/example$ putout button.js /home/coderaiser/putout/packages/plugin-react-hooks/button.js 11:8 error bind should not be used react-hooks/remove-bind 14:4 error name of method "_toggle" should not start from under score react-hooks/rename-method-under-score 7:8 error hooks should be used instead of this.state react-hooks/convert-state-to-hooks 15:8 error hooks should be used instead of this.setState react-hooks/convert-state-to-hooks 21:14 error hooks should be used instead of this.state react-hooks/convert-state-to-hooks 7:8 error should be used "state" instead of "this.state" react-hooks/remove-this 11:8 error should be used "toogle" instead of "this.toogle" react-hooks/remove-this 11:22 error should be used "_toggle" instead of "this._toggle" react-hooks/remove-this 15:8 error should be used "setState" instead of "this.setState" react-hooks/remove-this 21:26 error should be used "state" instead of "this.state" react-hooks/remove-this 26:25 error should be used "setEnabled" instead of "this.setEnabled" react-hooks/remove-this 3:0 error class Button should be a function react-hooks/convert-class-to-function 12 errors in 1 files fixable with the `--fix` option</code> </pre> </div></div><br><p>  <code>putout</code> trouvé 12 endroits qui peuvent être corrigés, essayez: </p><br><pre> <code class="plaintext hljs">putout --fix button.js</code> </pre> <br><p>  Maintenant, <code>button.js</code> ressemble à ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {useState} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Button; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [enabled, setEnabled] = useState(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ setEnabled(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{enabled}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{setEnabled}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); }</span></span></code> </pre> <br><h3 id="programmnaya-realizaciya">  Implémentation logicielle </h3><br><p>  Examinons plus en détail les différentes règles décrites ci-dessus. </p><br><h4 id="ubrat-this-otovsyudu">  Retirez <code>this</code> de partout </h4><br><p>  Puisque nous n'utilisons pas de classes, toutes les expressions de la forme <code>this.setEnabled</code> doivent être converties en <code>setEnabled</code> . </p><br><p>  Pour ce faire, nous allons passer par les nœuds de <a href="">ThisExpression</a> , qui, à leur tour, sont des enfants de la relation à <a href="">MemberExpression</a> , et sont situés dans le champ <code>object</code> , ainsi: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"MemberExpression"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"object"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ThisExpression"</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">"property"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"setEnabled"</span></span> } }</code> </pre> <br><p>  Considérez la mise en œuvre de la règle de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">suppression de cette</a> règle: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//      module.exports.report = ({name}) =&gt; `should be used "${name}" instead of "this.${name}"`; //    module.exports.fix = ({path}) =&gt; { // : MemberExpression -&gt; Identifier path.replaceWith(path.get('property')); }; module.exports.find = (ast, {push}) =&gt; { traverseClass(ast, { ThisExpression(path) { const {parentPath} = path; const propertyPath = parentPath.get('property'); //      const {name} = propertyPath.node; push({ name, path: parentPath, }); }, }); };</span></span></code> </pre> <br><p>  Dans le code décrit ci-dessus, la fonction utilitaire <code>traverseClass</code> pour trouver la classe, elle n'est pas si importante pour une compréhension générale, mais il est toujours logique de l'apporter, pour une plus grande précision: </p><br><div class="spoiler">  <b class="spoiler_title">En-tête de spoiler</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//      function traverseClass(ast, visitor) { traverse(ast, { ClassDeclaration(path) { const {node} = path; const {superClass} = node; if (!isExtendComponent(superClass)) return; path.traverse(visitor); }, }); }; //       Component function isExtendComponent(superClass) { const name = 'Component'; if (isIdentifier(superClass, {name})) return true; if (isMemberExpression(superClass) &amp;&amp; isIdentifier(superClass.property, {name})) return true; return false; }</span></span></code> </pre> </div></div><br><p>  Le test, à son tour, peut ressembler à ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> test = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@putout/test'</span></span>)(__dirname, { <span class="hljs-string"><span class="hljs-string">'remove-this'</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'.'</span></span>), }); test(<span class="hljs-string"><span class="hljs-string">'plugin-react-hooks: remove-this: report'</span></span>, (t) =&gt; { t.report(<span class="hljs-string"><span class="hljs-string">'this'</span></span>, <span class="hljs-string"><span class="hljs-string">`should be used "submit" instead of "this.submit"`</span></span>); t.end(); }); test(<span class="hljs-string"><span class="hljs-string">'plugin-react-hooks: remove-this: transform'</span></span>, (t) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> = <span class="hljs-string"><span class="hljs-string">` class Hello extends Component { render() { return ( &lt;button onClick={this.setEnabled}/&gt; ); } } `</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> to = <span class="hljs-string"><span class="hljs-string">` class Hello extends Component { render() { return &lt;button onClick={setEnabled}/&gt;; } } `</span></span>; t.transformCode(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, to); t.end(); });</code> </pre> <br><h3 id="v-importah-ispolzovat-usestate-vmesto-component">  Dans les importations, utilisez <code>useState</code> au lieu de <code>Component</code> </h3><br><p>  Considérez l'implémentation de la règle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">convert-import-component-to-use-state</a> . </p><br><p>  Afin de remplacer les expressions: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {Component} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span></code> </pre> <br><p>  sur </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, {useState} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span></code> </pre> <br><p>  Vous devez traiter le nœud <a href="">ImportDeclaration</a> : </p><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ImportDeclaration"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"specifiers"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ImportDefaultSpecifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"local"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"React"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"ImportSpecifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"imported"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Component"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"local"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Component"</span></span> } }], <span class="hljs-attr"><span class="hljs-attr">"source"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"StringLiteral"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"react"</span></span> } }</code> </pre> <br><p>  Nous devons trouver <code>ImportDeclaration</code> avec <code>source.value = react</code> , puis faire le tour du tableau des <code>specifiers</code> à la recherche d' <code>ImportSpecifier</code> avec le champ <code>name = Component</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     module.exports.report = () =&gt; 'useState should be used instead of Component'; //    module.exports.fix = (path) =&gt; { const {node} = path; node.imported.name = 'useState'; node.local.name = 'useState'; }; //    module.exports.find = (ast, {push, traverse}) =&gt; { traverse(ast, { ImportDeclaration(path) { const {source} = path.node; //   react,    if (source.value !== 'react') return; const name = 'Component'; const specifiersPaths = path.get('specifiers'); for (const specPath of specifiersPaths) { //    ImportSpecifier -    if (!specPath.isImportSpecifier()) continue; //    Compnent -    if (!specPath.get('imported').isIdentifier({name})) continue; push(specPath); } }, }); };</span></span></code> </pre> <br><p>  Considérez le test le plus simple: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> test = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@putout/test'</span></span>)(__dirname, { <span class="hljs-string"><span class="hljs-string">'convert-import-component-to-use-state'</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'.'</span></span>), }); test(<span class="hljs-string"><span class="hljs-string">'plugin-react-hooks: convert-import-component-to-use-state: report'</span></span>, (t) =&gt; { t.report(<span class="hljs-string"><span class="hljs-string">'component'</span></span>, <span class="hljs-string"><span class="hljs-string">'useState should be used instead of Component'</span></span>); t.end(); }); test(<span class="hljs-string"><span class="hljs-string">'plugin-react-hooks: convert-import-component-to-use-state: transform'</span></span>, (t) =&gt; { t.transformCode(<span class="hljs-string"><span class="hljs-string">`import {Component} from 'react'`</span></span>, <span class="hljs-string"><span class="hljs-string">`import {useState} from 'react'`</span></span>); t.end(); });</code> </pre> <br><p>  Et donc, nous avons examiné en termes généraux l'implémentation logicielle de plusieurs règles, les autres sont construites selon un schéma similaire.  Vous pouvez vous familiariser avec tous les nœuds de l'arborescence du fichier analysé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">button.js</a> dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">astexplorer</a> .  Le code source des plugins décrits peut être trouvé <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans le référentiel</a> . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Aujourd'hui, nous avons examiné l'une des méthodes de refactorisation automatisée des classes de réactifs pour réagir.  Actuellement, le <code>@putout/plugin-react-hooks</code> ne prend <code>@putout/plugin-react-hooks</code> charge que les mécanismes de base, mais il peut être considérablement amélioré si la communauté est intéressée et impliquée.  Je serai heureux de discuter dans les commentaires des commentaires, des idées, des exemples d'utilisation, ainsi que les fonctionnalités manquantes. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441722/">https://habr.com/ru/post/fr441722/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441712/index.html">Solution mathématique aux problèmes de relativité</a></li>
<li><a href="../fr441714/index.html">Comment les locomotives à vapeur ont-elles été disposées?</a></li>
<li><a href="../fr441716/index.html">Programmation pour les non-programmeurs. Biographie de juin</a></li>
<li><a href="../fr441718/index.html">Security Week 09: vulnérabilité de 19 ans dans WinRAR</a></li>
<li><a href="../fr441720/index.html">Chatbot pour Vkontakte sur ASP.NET Core C #</a></li>
<li><a href="../fr441724/index.html">La valorisation du marché des crypto-monnaies atteindra 1 billion de dollars cette année -Prédictions de crypto-monnaie 2019</a></li>
<li><a href="../fr441726/index.html">Kubespray-as-a-Service - ajoutez Kubernetes à n'importe quel cloud</a></li>
<li><a href="../fr441728/index.html">Résumé du concours en ligne pour le jeu Blotto</a></li>
<li><a href="../fr441732/index.html">Notes du Biorobot</a></li>
<li><a href="../fr441736/index.html">Automatisez la conversion des fichiers Word vers d'autres formats</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>