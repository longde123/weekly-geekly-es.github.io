<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëπ üëçüèæ ü•£ Presentaci√≥n de las interfaces virtuales de Linux: t√∫neles üòÄ üïó üë©‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Linux soporta muchos tipos de t√∫neles. Esto confunde a los principiantes a quienes les resulta dif√≠cil comprender las diferencias tecnol√≥gicas y compr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Presentaci√≥n de las interfaces virtuales de Linux: t√∫neles</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/457386/"> Linux soporta muchos tipos de t√∫neles.  Esto confunde a los principiantes a quienes les resulta dif√≠cil comprender las diferencias tecnol√≥gicas y comprender qu√© t√∫nel es mejor usar en una situaci√≥n particular.  El material, cuya traducci√≥n publicamos hoy, brindar√° una breve descripci√≥n de las interfaces de t√∫nel de uso com√∫n del kernel de Linux.  No profundizaremos en este tema, considerando solo las caracter√≠sticas generales de los t√∫neles y las opciones para su uso en Linux. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/-0/wg/hq/-0wghqvj6hymntfthlttl1xu6tm.jpeg"></a> <br><br>  El autor de este material cree que lo que se discutir√° aqu√≠ puede ser de inter√©s para todos los que tengan algo que ver con la administraci√≥n de redes inform√°ticas.  La lista de interfaces de t√∫nel, as√≠ como la informaci√≥n de referencia sobre una configuraci√≥n espec√≠fica, se puede obtener utilizando el comando iproute2 <code>ip link help</code> . <br><br>  Aqu√≠ se cubrir√°n las siguientes interfaces de uso com√∫n: IPIP, SIT, ip6tnl, VTI y VTI6, GRE y GRETAP, GRE6 y GRE6TAP, FOU, GUE, GENEVE, ERSPAN e IP6ERSPAN. <br><br>  Despu√©s de leer este art√≠culo, aprender√° sobre las caracter√≠sticas de estas interfaces y descubrir√° las diferencias entre ellas.  Aprender√° c√≥mo crearlos y aprender√° sobre las situaciones en las que se utilizan mejor. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">IPIP</font> </h2><br>  El t√∫nel IPIP, como su nombre lo indica, es un t√∫nel que funciona en modo IP sobre IP ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 2003</a> ).  El encabezado del paquete del t√∫nel IPIP se muestra a continuaci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/369/49b/92c/36949b92c3d045185f09095a7a23dbfd.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel IPIP</font></i> <br><br>  Tales t√∫neles se usan com√∫nmente para conectar dos subredes IPv4 internas a trav√©s de una red p√∫blica IPv4 (Internet).  El uso de IPIP crea una carga adicional m√≠nima en el sistema, pero solo se puede realizar la transmisi√≥n de datos unidireccional (unidifusi√≥n) en dicho t√∫nel.  Es decir, despu√©s de haber construido dicho t√∫nel, no ser√° posible usarlo para la transmisi√≥n de datos de multidifusi√≥n. <br><br>  Los t√∫neles IPIP admiten los modos IP sobre IP y MPLS sobre IP. <br><br>  Tenga en cuenta que cuando se carga el m√≥dulo ipip, o cuando se crea el dispositivo IPIP por primera vez, el kernel de Linux crear√° un dispositivo <code>tunl0</code> predeterminado en cada espacio de nombres con los atributos <code>local=any</code> y <code>remote=any</code> .  Al recibir paquetes IPIP, el n√∫cleo, en ciertos casos, los redirigir√° a <code>tunl0</code> como dispositivo predeterminado.  Esto sucede cuando el n√∫cleo no puede encontrar otro dispositivo cuyos atributos <code>local/remote</code> coincidan m√°s estrechamente con las direcciones de origen y destino de los paquetes. <br><br>  Aqu√≠ se explica c√≥mo crear un t√∫nel IPIP: <br><br>  En el servidor A: <br><br><pre> <code class="plaintext hljs"># ip link add name ipip0 type ipip local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR # ip link set ipip0 up # ip addr add INTERNAL_IPV4_ADDR/24 dev ipip0 Add a remote internal subnet route if the endpoints don't belong to the same subnet # ip route add REMOTE_INTERNAL_SUBNET/24 dev ipip0</code> </pre> <br>  En el servidor B: <br><br><pre> <code class="plaintext hljs"># ip link add name ipip0 type ipip local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR # ip link set ipip0 up # ip addr add INTERNAL_IPV4_ADDR/24 dev ipip0 # ip route add REMOTE_INTERNAL_SUBNET/24 dev ipip0</code> </pre> <br>  Tenga en cuenta que al usar esta configuraci√≥n, debe alinearse con datos reales.  En particular, <code>LOCAL_IPv4_ADDR</code> , <code>REMOTE_IPv4_ADDR</code> , <code>INTERNAL_IPV4_ADDR</code> y <code>REMOTE_INTERNAL_SUBNET</code> deben reemplazarse con las direcciones utilizadas en su entorno.  Lo mismo es cierto para otros ejemplos de configuraciones, que consideraremos m√°s adelante. <br><br><h2>  <font color="#3AC1EF">Sentarse</font> </h2><br>  SIT (Simple Internet Transition) es una tecnolog√≠a de tunelizaci√≥n cuyo prop√≥sito principal es conectar redes IPv6 aisladas a trav√©s de Internet utilizando el protocolo IPv4. <br><br>  Inicialmente, la tecnolog√≠a SIT solo pod√≠a funcionar en el modo de t√∫nel "IPv6 sobre IPv4".  Sin embargo, a lo largo de los a√±os de desarrollo, se ha ganado el apoyo de varios reg√≠menes m√°s.  En particular, es <code>ipip</code> (lo mismo sucedi√≥ con el t√∫nel IPIP), <code>ip6ip</code> , <code>mplsip</code> y <code>any</code> . <br><br>  <code>any</code> modo se utiliza para trabajar con tr√°fico IP e IPv6, lo que puede ser √∫til en algunas situaciones.  Los t√∫neles SIT tambi√©n son compatibles con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ISATAP</a> .  Aqu√≠ hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un ejemplo del</a> uso de esta tecnolog√≠a. <br><br>  El encabezado del paquete SIT se muestra a continuaci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/193/172/49e/19317249ec76200873dabf9aac6bc755.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel SIT</font></i> <br><br>  Cuando <code>sit</code> carga el m√≥dulo <code>sit</code> , el kernel de Linux crea el <code>sit0</code> predeterminado <code>sit0</code> . <br><br>  Aqu√≠ se explica c√≥mo crear un t√∫nel SIT (estos pasos se deben realizar en los servidores A y B): <br><br><pre> <code class="plaintext hljs"># ip link add name sit1 type sit local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR mode any # ip link set sit1 up # ip addr add INTERNAL_IPV4_ADDR/24 dev sit1</code> </pre> <br><h2>  <font color="#3AC1EF">Ip6tnl</font> </h2><br>  La interfaz ip6tnl funciona en modo IPv4 / IPv6 sobre IPv6.  Es similar a la versi√≥n IPv6 del t√∫nel SIT.  As√≠ es como se ve el encabezado del paquete ip6tnl. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e7/b3b/1b6/9e7b3b1b6862d0f3100c9c64db2171b7.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel ip6tnl</font></i> <br><br>  Los t√∫neles ip6tnl admiten <code>ip6ip6</code> , <code>ipip6</code> y <code>any</code> modo.  El modo <code>ipip6</code> representado por el esquema IPv4 sobre IPv6, el modo <code>ip6ip6</code> es IPv6 sobre IPv6.  <code>any</code> modo admite ambos esquemas. <br><br>  Cuando se <code>ip6tnl</code> m√≥dulo <code>ip6tnl</code> , el kernel de Linux crea un dispositivo predeterminado llamado <code>ip6tnl0</code> . <br><br>  Aqu√≠ se explica c√≥mo crear un t√∫nel ip6tnl: <br><br><pre> <code class="plaintext hljs"># ip link add name ipip6 type ip6tnl local LOCAL_IPv6_ADDR remote REMOTE_IPv6_ADDR mode any</code> </pre> <br><h2>  <font color="#3AC1EF">VTI y VTI6</font> </h2><br>  La interfaz Linux VTI (Virtual Tunnel Interface) es similar a la interfaz Cisco VTI y la implementaci√≥n de Juniper de un t√∫nel seguro (st.xx). <br><br>  Este controlador de tunelizaci√≥n implementa la encapsulaci√≥n de IP, que se puede usar con xfrm para crear t√∫neles seguros y luego usar t√∫neles de enrutamiento a nivel de n√∫cleo sobre dichos t√∫neles. <br><br>  En general, los t√∫neles VTI funcionan de manera muy similar a los t√∫neles IPIP o SIT.  La excepci√≥n es que usan fwmark e IPsec encapsulaci√≥n / decapsulaci√≥n. <br><br>  VTI6 es el equivalente IPv6 de VTI. <br><br>  Aqu√≠ se explica c√≥mo crear un t√∫nel VTI: <br><br><pre> <code class="plaintext hljs"># ip link add name vti1 type vti key VTI_KEY local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR # ip link set vti1 up # ip addr add LOCAL_VIRTUAL_ADDR/24 dev vti1 # ip xfrm state add src LOCAL_IPv4_ADDR dst REMOTE_IPv4_ADDR spi SPI PROTO ALGR mode tunnel # ip xfrm state add src REMOTE_IPv4_ADDR dst LOCAL_IPv4_ADDR spi SPI PROTO ALGR mode tunnel # ip xfrm policy add dir in tmpl src REMOTE_IPv4_ADDR dst LOCAL_IPv4_ADDR PROTO mode tunnel mark VTI_KEY # ip xfrm policy add dir out tmpl src LOCAL_IPv4_ADDR dst REMOTE_IPv4_ADDR PROTO mode tunnel mark VTI_KEY</code> </pre> <br>  Adem√°s, IPsec se puede configurar usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">libreswan</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">strongSwan</a> . <br><br><h2>  <font color="#3AC1EF">GRE y GRETAP</font> </h2><br>  La tecnolog√≠a GRE (encapsulaci√≥n de enrutamiento gen√©rico) se describe en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 2784</a> .  En la tunelizaci√≥n GRE, se agrega un encabezado GRE adicional entre los encabezados de los paquetes IP internos y externos. <br><br>  Te√≥ricamente, GRE puede encapsular paquetes de cualquier protocolo de Capa 3 con un tipo de Ethernet v√°lido.  Esto distingue la tecnolog√≠a GRE de la tecnolog√≠a IPIP, que solo admite la encapsulaci√≥n de paquetes IP.  As√≠ es como se ve el encabezado del paquete cuando se utiliza la tecnolog√≠a GRE. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22d/b74/b09/22db74b090586084bfe845c7df963139.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel GRE</font></i> <br><br>  Tenga en cuenta que los t√∫neles GRE permiten la compatibilidad con multidifusi√≥n e IPv6. <br><br>  Al cargar el m√≥dulo <code>gre</code> , el kernel de Linux crea el <code>gre0</code> predeterminado <code>gre0</code> . <br><br>  Aqu√≠ se explica c√≥mo crear un t√∫nel GRE: <br><br><pre> <code class="plaintext hljs"># ip link add name gre1 type gre local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR [seq] key KEY</code> </pre> <br>  Mientras que los t√∫neles GRE operan en la capa 3 de OSI, los t√∫neles GRETAP operan en la capa 2 de OSI.  Esto significa que uno de los encabezados internos de los paquetes respectivos es encabezados Ethernet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1da/ec8/099/1daec8099c6cede117df740da4791144.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel GRETAP</font></i> <br><br>  Aqu√≠ se explica c√≥mo crear un t√∫nel GRETAP: <br><br><pre> <code class="plaintext hljs"># ip link add name gretap1 type gretap local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR</code> </pre> <br><h2>  <font color="#3AC1EF">GRE6 y GRE6TAP</font> </h2><br>  GRE6 es el equivalente IPv6 de GRE.  Los t√∫neles GRE6 le permiten encapsular cualquier protocolo de capa 3 en IPv6.  As√≠ es como se ve el encabezado del paquete GRE6. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d8c/69e/45a/d8c69e45aab1f77ea5948cf2a6e81c35.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel GRE6</font></i> <br><br>  En los t√∫neles GRE6TAP, como en los t√∫neles GRETAP, hay encabezados Ethernet entre los encabezados de paquetes internos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/72c/290/7c7/72c2907c7c649e6390d1e51156bcac57.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel GRE6TAP</font></i> <br><br>  Aqu√≠ se explica c√≥mo crear un t√∫nel GRE: <br><br><pre> <code class="plaintext hljs"># ip link add name gre1 type gre6 local LOCAL_IPv6_ADDR remote REMOTE_IPv6_ADDR # ip link add name gretap1 type gretap6 local LOCAL_IPv6_ADDR remote REMOTE_IPv6_ADDR</code> </pre> <br><h2>  <font color="#3AC1EF">Fou</font> </h2><br>  La tunelizaci√≥n se puede realizar en diferentes niveles de la pila de red.  Los t√∫neles IPIP, SIT y GRE existen en la capa IP.  Y los t√∫neles FOU (est√°n dispuestos de acuerdo con el esquema "foo over UDP") operan a nivel UDP. <br><br>  Existen algunas ventajas al usar el t√∫nel UDP sobre el t√∫nel IP.  El hecho es que el protocolo UDP funciona con la infraestructura de hardware existente. <br><br>  Por ejemplo, esto es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RSS</a> en tarjetas de red, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ECMP</a> en conmutadores, estas son tecnolog√≠as para calcular sumas de verificaci√≥n sin la participaci√≥n de un procesador central.  La aplicaci√≥n del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parche</a> FOU apropiado a los desarrolladores muestra un aumento significativo en el rendimiento de SIT e IPIP. <br><br>  Actualmente, los t√∫neles FOU admiten la encapsulaci√≥n de protocolos basada en IPIP, SIT y GRE.  As√≠ es como se ver√≠a el encabezado de un paquete FOU. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90d/a66/cb9/90da66cb92c6e3083f29ed97b952e0b6.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel FOU</font></i> <br><br>  Aqu√≠ se explica c√≥mo crear un t√∫nel FOU: <br><br><pre> <code class="plaintext hljs"># ip fou add port 5555 ipproto 4 # ip link add name tun1 type ipip remote 192.168.1.1 local 192.168.1.2 ttl 225 encap fou encap-sport auto encap-dport 5555</code> </pre> <br>  El primer comando configura el puerto FOU de recepci√≥n para IPIP vinculado a 5555. Para usar GRE, debe usar <code>ipproto 47</code> .  El segundo comando configura la nueva interfaz virtual IPIP ( <code>tun1</code> ), dise√±ada para la encapsulaci√≥n FOU, cuyo puerto de destino es 5555. <br><br>  Tenga en cuenta que los t√∫neles FOU no son compatibles con Red Hat Enterprise Linux. <br><br><h2>  <font color="#3AC1EF">Gue</font> </h2><br>  Otro tipo de t√∫nel UDP es introducido por la tecnolog√≠a GUE ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">encapsulaci√≥n UDP gen√©rica</a> ).  La diferencia entre FOU y GUE es que GUE tiene su propio encabezado, que contiene informaci√≥n de protocolo y otros datos. <br><br>  Los t√∫neles GUE actualmente admiten la encapsulaci√≥n interna de IPIP, SIT y GRE.  As√≠ es como se ver√≠a un encabezado de paquete GUE. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/412/d7f/d38/412d7fd38350aa55b24cb0b93865d93c.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel GUE</font></i> <br><br>  Aqu√≠ se explica c√≥mo crear un t√∫nel GUE: <br><br><pre> <code class="plaintext hljs"># ip fou add port 5555 gue # ip link add name tun1 type ipip remote 192.168.1.1 local 192.168.1.2 ttl 225 encap gue encap-sport auto encap-dport 5555</code> </pre> <br>  Gracias a estos comandos, se crear√° un puerto GUE receptor para IPIP vinculado al n√∫mero 5555 y un t√∫nel IPIP configurado para la encapsulaci√≥n GUE. <br><br>  Los t√∫neles GUE no son compatibles con Red Hat Enterprise Linux. <br><br><h2>  <font color="#3AC1EF">GENEVE</font> </h2><br>  Los t√∫neles GENEVE (encapsulaci√≥n de virtualizaci√≥n de red gen√©rica) admiten todas las caracter√≠sticas de XLAN, NVGRE y STT.  La tecnolog√≠a GENEVE est√° dise√±ada para sortear las limitaciones identificadas de estas tres tecnolog√≠as.  Muchos creen que esta tecnolog√≠a es capaz, a largo plazo, de reemplazar por completo estos tres formatos m√°s antiguos.  As√≠ es como se ve el encabezado del paquete de t√∫nel GENEVE. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/767/f30/98e/767f3098ee539caf3f03778143fa6106.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel GENEVE</font></i> <br><br>  Este encabezado es similar al encabezado de un paquete <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VXLAN</a> .  La principal diferencia entre los dos es que el encabezado GENEVE es m√°s flexible.  Hace que sea muy f√°cil implementar nuevas funciones al expandir los encabezados utilizando los campos Tipo-Longitud-Valor (TLV). <br><br>  Los detalles sobre GENEVE se pueden encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  GENEVE se utiliza en la soluci√≥n SDN de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Red Virtual Abierta</a> (OVN) como herramienta de encapsulaci√≥n est√°ndar.  Aqu√≠ se explica c√≥mo crear un t√∫nel GENEVE: <br><br><pre> <code class="plaintext hljs"># ip link add name geneve0 type geneve id VNI remote REMOTE_IPv4_ADDR</code> </pre> <br><h2>  <font color="#3AC1EF">ERSPAN e IP6ERSPAN</font> </h2><br>  La tecnolog√≠a del Analizador de puertos conmutados remotos encapsulados (ERSPAN) utiliza encapsulaci√≥n GRE para extender las capacidades b√°sicas de duplicaci√≥n de puertos de la capa 2 a la capa 3.  Esto le permite reenviar tr√°fico reflejado a trav√©s de una red IP enrutada.  As√≠ es como se ve el encabezado del paquete ERSPAN. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dee/15d/871/dee15d871a6ee9d433f154b9a6a6e048.png"></div><br>  <i><font color="#999999">Encabezado de paquete de t√∫nel ERSPAN</font></i> <br><br>  Los t√∫neles ERSPAN permiten que los hosts Linux act√∫en como una fuente de tr√°fico ERSPAN y env√≠en tr√°fico ERSPAN reflejado a un host remoto o a un destino ERSPAN que recibe y procesa los paquetes ERSPAN generados por los conmutadores Cisco u otros dispositivos que admiten ERSPAN.  Se puede usar un sistema similar para analizar y diagnosticar la red, para detectar tr√°fico malicioso. <br><br>  Linux actualmente admite la mayor√≠a de las caracter√≠sticas de las dos versiones de ERSPAN: v1 (tipo II) y v2 (tipo III). <br><br>  Aqu√≠ se explica c√≥mo crear t√∫neles ERSPAN: <br><br><pre> <code class="plaintext hljs"># ip link add dev erspan1 type erspan local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR seq key KEY erspan_ver 1 erspan IDX</code> </pre> <br>  Tambi√©n puedes hacer esto: <br><br><pre> <code class="plaintext hljs"># ip link add dev erspan1 type erspan local LOCAL_IPv4_ADDR remote REMOTE_IPv4_ADDR seq key KEY erspan_ver 2 erspan_dir DIRECTION erspan_hwid HWID</code> </pre> <br>  Agregue un filtro tc para monitorear el tr√°fico: <br><br><pre> <code class="plaintext hljs"># tc qdisc add dev MONITOR_DEV handle ffff: ingress # tc filter add dev MONITOR_DEV parent ffff: matchall skip_hw action mirred egress mirror dev erspan1</code> </pre> <br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>  Hemos cubierto bastantes tecnolog√≠as de t√∫nel en Linux aqu√≠.  Aqu√≠ hay una tabla resumen para ellos. <br><br><div class="scrollable-table"><table><tbody><tr><td>  T√∫nel / Tipo de conexi√≥n <br></td><td>  Encabezado exterior <br></td><td>  Encabezado Encapsulado <br></td><td>  Encabezado interno <br></td></tr><tr><td>  ipip <br></td><td>  IPv4 <br></td><td>  Ninguno <br></td><td>  IPv4 <br></td></tr><tr><td>  sentarse <br></td><td>  IPv4 <br></td><td>  Ninguno <br></td><td>  IPv4 / IPv6 <br></td></tr><tr><td>  ip6tnl <br></td><td>  IPv4 <br></td><td>  Ninguno <br></td><td>  IPv4 / IPv6 <br></td></tr><tr><td>  vti <br></td><td>  IPv4 <br></td><td>  IPsec <br></td><td>  IPv4 <br></td></tr><tr><td>  vti6 <br></td><td>  IPv6 <br></td><td>  IPsec <br></td><td>  IPv6 <br></td></tr><tr><td>  gre <br></td><td>  IPv4 <br></td><td>  GRE <br></td><td>  IPv4 / IPv6 <br></td></tr><tr><td>  gretap <br></td><td>  IPv4 <br></td><td>  GRE <br></td><td>  Ether + IPv4 / IPv6 <br></td></tr><tr><td>  gre6 <br></td><td>  IPv6 <br></td><td>  GRE <br></td><td>  IPv4 / IPv6 <br></td></tr><tr><td>  gre6tap <br></td><td>  IPv6 <br></td><td>  GRE <br></td><td>  Ether + IPv4 / IPv6 <br></td></tr><tr><td>  fou <br></td><td>  IPv4 / IPv6 <br></td><td>  UDP <br></td><td>  IPv4 / IPv6 / GRE <br></td></tr><tr><td>  gue <br></td><td>  IPv4 / IPv6 <br></td><td>  UDP + GUE <br></td><td>  IPv4 / IPv6 / GRE <br></td></tr><tr><td>  Ginebra <br></td><td>  IPv4 / IPv6 <br></td><td>  UDP + Geneve <br></td><td>  Ether + IPv4 / IPv6 <br></td></tr><tr><td>  Erspan <br></td><td>  IPv4 <br></td><td>  GRE + ERSPAN <br></td><td>  IPv4 / IPv6 <br></td></tr><tr><td>  ip6erspan <br></td><td>  IPv6 <br></td><td>  GRE + ERSPAN <br></td><td>  IPv4 / IPv6 <br></td></tr></tbody></table></div><br>  Tenga en cuenta que todos los t√∫neles, cuyos ejemplos de creaci√≥n se muestran aqu√≠, existen solo hasta que se reinicia el servidor.  Si desea crear un t√∫nel que se recupere despu√©s de reiniciar, considere usar un demonio para configurar la red, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NetworkManager</a> , o use el mecanismo apropiado de la distribuci√≥n de Linux que est√° usando. <br><br>  <b>Estimados lectores!</b>  ¬øQu√© t√∫neles de Linux usas? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/457386/">https://habr.com/ru/post/457386/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457366/index.html">Un fan√°tico, una pieza de hierro o un espectador: ¬øqu√© tipo de jugador eres?</a></li>
<li><a href="../457374/index.html">Reduce el tiempo de construcci√≥n de tus proyectos de Android</a></li>
<li><a href="../457378/index.html">C√≥mo id Software cre√≥ Wolfenstein 3D basado en tecnolog√≠a de Commander Keen</a></li>
<li><a href="../457380/index.html">OpenGL ultramoderno. Parte 2</a></li>
<li><a href="../457382/index.html">7 h√°bitos de programadores de alto rendimiento</a></li>
<li><a href="../457390/index.html">Madagascar - isla de contrastes</a></li>
<li><a href="../457392/index.html">Ahorros en el desarrollo multiplataforma m√≥vil: estudio de caso de Skyeng</a></li>
<li><a href="../457396/index.html">Desbloqueo autom√°tico del contenedor LUKS ra√≠z despu√©s de un arranque en caliente</a></li>
<li><a href="../457398/index.html">¬øPero estoy haciendo estupideces? ¬øPor qu√© los desarrolladores van a gemba?</a></li>
<li><a href="../457400/index.html">El n√∫mero de v√≠ctimas en desastres nucleares como Chernobyl es muy exagerado para el drama</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>