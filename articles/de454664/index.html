<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç£ üò£ üåà Spielen Sie Tetris in AR üë®‚Äçüç≥ ü§≥üèΩ ü§ó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mir kam eine etwas seltsame Idee, dass das Haus eine gute Plattform sein k√∂nnte, um Tetris zu spielen. Nicht weit von mir war nur ein Geb√§ude daf√ºr ge...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spielen Sie Tetris in AR</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454664/">  Mir kam eine etwas seltsame Idee, dass das Haus eine gute Plattform sein k√∂nnte, um Tetris zu spielen.  Nicht weit von mir war nur ein Geb√§ude daf√ºr geeignet.  Das Ergebnis ist im Video zu sehen: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/eGaokauVQ2o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Das Projekt wird auf einer relativ niedrigen Ebene ohne Verwendung einer vorgefertigten L√∂sung durchgef√ºhrt. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quellcode</a> <br><a name="habracut"></a><br>  Meistens verwenden sie zwei Optionen f√ºr die Implementierung von Augmented Reality: <br><br><ul><li>  markerlos, d.h.  Die Position der Kamera wird durch die Bewegung der Schl√ºsselpunkte ihres Videostreams bestimmt. </li><li>  Bild als Markierung relativ zu der Position der Kamera. </li></ul><br>  Diese Implementierungen erfordern keine besonderen Vorbereitungen oder besonderen Bedingungen. <br><br>  Es gibt eine weitere Implementierungsoption: Sie k√∂nnen ein bestimmtes Objekt erkennen und als Marker verwenden.  Dies erfordert zumindest seine Anwesenheit, erm√∂glicht jedoch eine visuelle Steuerung.  Eine der Methoden einer solchen Erkennung ist die Erkennung eines Objekts durch Kanten.  Es hat Einschr√§nkungen - das Markierungsobjekt muss klar definierte Kanten haben, d.h.  Das Objekt sollte h√∂chstwahrscheinlich fest sein. <br><br>  Oder die Kanten sollten klar abgegrenzt sein, wie zum Beispiel die Beleuchtung dieses Geb√§udes: <br><br><img src="https://habrastorage.org/webt/51/y8/nt/51y8ntbjtnm_hdy6iy5v2pmwgsu.jpeg"><br><br>  Es ist ersichtlich, dass die Hintergrundbeleuchtung im Bild leicht getrennt und zur Erkennung verwendet werden kann. <br><br><h2>  Implementierung </h2><br>  Auf Qt.  Mit diesem Framework k√∂nnen Sie auf verschiedenen Plattformen und gleichzeitig in C ++ arbeiten.  Da Leistung f√ºr uns wichtig ist, scheinen die Profis eine naheliegende Wahl zu sein. <br><br>  Obwohl Qt mit Android nicht sehr gut funktionierte (langer Start, Debugging war deaktiviert), wurde dies alles durch die M√∂glichkeit ausgeglichen, den Algorithmus auf dem Desktop zu debuggen. <br><br>  Dreidimensionale Grafiken wurden auf der in Qt eingebetteten OpenGL-Rohdaten visualisiert. <br><br>  Die Arbeit mit der Kamera wurde √ºber Qt durchgef√ºhrt.  Zum Debuggen wurde ein Video aufgenommen, und es war praktisch genug, den Videostream der Kamera durch einen Videostream aus einer Datei zu ersetzen. <br><br>  Die Ausgabe erfolgte √ºber qml-Tools.  Freunde zu finden qml und OpenGL war nicht ohne Probleme, aber wir werden nicht weiter darauf eingehen. <br><br>  Zur Bildverarbeitung ist die OpenCV-Bibliothek angeschlossen. <br><br><h4>  Tracking-Algorithmus </h4><br>  Kommen wir nun zum interessantesten Teil - dem Algorithmus zum Verfolgen eines Objekts entlang seiner Kanten. <br>  Beginnen Sie mit dem Hervorheben der Kanten im Bild.  In unserem Fall haben alle Kanten die Form von geraden Linien. Der erste Gedanke, der mir einf√§llt, ist die Verwendung eines Liniendetektors.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hough-Transformationen</a> k√∂nnten als Zeilendetektor verwendet werden.  Dieser Weg scheint mir jedoch nicht sehr wahr zu sein, da die Hough-Transformation ziemlich teuer ist und dieser Detektor nicht sehr zuverl√§ssig ist (dies ist subjektiv, vielleicht h√§ngt alles von der Aufgabe ab). <br>  Gehen wir stattdessen anders und allgemeiner vor.  Wir werden nicht ber√ºcksichtigen, dass unsere Linien gerade sind, aber wir werden einfach an einem Bin√§rbild arbeiten.  Das Vorhandensein von Kanten wird in das Bin√§rbild codiert.  Das hei√üt,  Ein Pixel mit dem Wert Null bedeutet, dass sich an dieser Stelle eine Kante befindet. Der Pixelwert ist gr√∂√üer als Null. Es gibt keine Kante.  Ein solches Bild kann unter Verwendung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eines Canny-Grenzdetektors</a> oder unter Verwendung einer einfachen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schwellwerttransformation erhalten werden</a> .  Diese Algorithmen finden Sie in OpenCV. <br><br>  OpenCV hat jetzt auch eine andere n√ºtzliche Funktion f√ºr uns - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">distanceTransform</a> , die ein Bin√§rbild am Eingang und ein Bild am Ausgang liefert, in Pixeln, deren Abstand zum n√§chsten Nullpixel codiert ist. <br><br>  Nehmen wir nun an, wir haben bereits die erste gute Ann√§herung, wo sich unser Modell befinden sollte.  Als n√§chstes beschreiben wir die Fehlerfunktion, die beschreibt, inwieweit die Kanten unserer N√§herung nicht mit den Kanten im resultierenden Bild √ºbereinstimmen.  Mit dem Bild von distanceTransform k√∂nnen wir dies bereits tun.  Und dann f√ºhren wir den Funktionsoptimierungsalgorithmus aus und √§ndern nur unsere Ann√§herung an die Position des Objekts im Raum.  Infolgedessen sollte unsere Ann√§herung die tats√§chliche Position des Objekts ziemlich genau beschreiben. <br>  Infolgedessen kann der Algorithmus in zwei Stufen unterteilt werden: <br><br><ol><li>  Bildvorverarbeitung - Bin√§risierung, Filterung und Verwendung der Funktion distanceTransfrom. </li><li>  Tracking - Optimierung der Fehlerfunktion. </li></ol><br><h4>  Bildvorverarbeitung </h4><br>  An dieser Stelle m√ºssen Sie die Kanten im Bild hervorheben.  Sie k√∂nnen den Canny-Grenzdetektor verwenden, aber in unserem Fall funktioniert die √ºbliche Schwellenwertkonvertierung oder ihre adaptive Version besser (in OpenCV sind dies Schwellenwert- oder adaptive Schwellenwertfunktionen).  Es ist klar, dass ein solches Bild Rauschen aufweist, daher ist eine Filterung erforderlich.  Gehen wir wie folgt vor: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">W√§hlen</a> Sie die Kontur mit der OpenCV-Funktion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">findCountours aus</a> und l√∂schen Sie Segmente, die zu klein oder zu wenig wie eine Linie sind. <br><br>  Das Verarbeitungsergebnis ist im Bild zu sehen: <br><br><img src="https://habrastorage.org/webt/ef/g9/ts/efg9tspnpbvzqb1gn2o0cricah8.jpeg"><br><br>  Konsistent: das Originalbild -&gt; nach der Schwellenwerttransformation -&gt; nach dem Filtern. <br><br>  Dieses Bild zeigt uns schon ganz deutlich, wo sich der rechte Rand befindet und wo nicht.  Danach verwenden wir die Funktion distanceTransform. Als Ergebnis erhalten wir Informationen dar√ºber, wie weit jeder Punkt von der Kante entfernt ist.  Das resultierende Bild wird als bezeichnet <img src="https://habrastorage.org/webt/qt/cr/xz/qtcrxzl1ow1zbp0xoducghnxhms.png">  . <br><br>  So sieht es aus, wenn es normalisiert und visualisiert wird: <br><br><img src="https://habrastorage.org/webt/ho/ll/vm/hollvmy8tp4ozcc424szu5pjjuc.jpeg"><br><br>  Als n√§chstes ben√∂tigen wir einige mathematische Werkzeuge. <br><br><h5>  Funktionsoptimierungsalgorithmus </h5><br>  Funktionsoptimierung ist die Aufgabe, das Minimum einer Funktion zu finden. <br><br>  Wenn es sich um ein lineares Gleichungssystem handelt, ist es recht einfach, ein Minimum zu finden.  Stellen Sie sich das Gleichungssystem in Matrixform vor: <img src="https://habrastorage.org/webt/8o/ib/1o/8oib1oj6a6trr7kkhjozgiy3day.png">  , dann unsere L√∂sung: <img src="https://habrastorage.org/webt/ly/rc/qu/lyrcqutfkhebqb6tqlrfix5d1ms.png">  .  Wenn wir ein √ºberbestimmtes Gleichungssystem haben, k√∂nnen wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die Methode der kleinsten Quadrate verwenden</a> : <img src="https://habrastorage.org/webt/ll/4i/ok/ll4iok4um66gxr9zxre_lxlyylm.png">  . <br><br>  Wenn unsere Funktion nicht linear ist, wird die Aufgabe komplizierter.  Um das Minimum zu finden, k√∂nnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Gau√ü-Newton-Algorithmus verwenden</a> .  Der Algorithmus funktioniert wie folgt: <br><br><ol><li>  Es wird davon ausgegangen, dass wir bereits eine erste Ann√§herung an die L√∂sung haben <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  was wir iterativ verfeinern werden. </li><li>  Mit der Taylor-Erweiterung k√∂nnen wir unsere nichtlineare Funktion am aktuellen Approximationspunkt linear approximieren.  Wir l√∂sen das resultierende lineare Gleichungssystem nach der Methode der kleinsten Quadrate <img src="https://habrastorage.org/webt/_l/so/zd/_lsozdiipx0ny5krc_nvtsklixq.png">  .  Infolgedessen ist die resultierende L√∂sung keine L√∂sung, sondern n√§her als die aktuelle N√§herung. </li><li>  Ersetzen Sie die aktuelle N√§herung <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  Entscheidung erhalten <img src="https://habrastorage.org/webt/_l/so/zd/_lsozdiipx0ny5krc_nvtsklixq.png">  und fahren Sie mit Schritt 2 fort. Wiederholen Sie diesen Vorgang, bis der Unterschied zwischen <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  und <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  wird nicht kleiner als ein bestimmter Wert sein. </li></ol><br>  Lassen Sie uns den Algorithmus genauer analysieren. <br><br>  Lass <img src="https://habrastorage.org/webt/vc/j3/mp/vcj3mpo1jjwkew5a0enemocdyoq.png">  - Arbeitsfunktion, <img src="https://habrastorage.org/webt/i5/uo/zz/i5uozzwwbb4_f-ivitxfs2qferi.png">  - ein zuvor bekannter Vektor von Funktionswerten.  Mit der perfekten L√∂sung der Gleichung <img src="https://habrastorage.org/webt/ht/2u/lo/ht2ulowooc32s10ajclpbeug1w4.png">  Die folgende Aussage ist wahr <img src="https://habrastorage.org/webt/m-/dk/pv/m-dkpv_tnys9clufhps155qfxkq.png">  .  Wir haben aber nur eine Ann√§herung <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  .  Dann wird der Fehlervektor aus dieser N√§herung bezeichnet als: <img src="https://habrastorage.org/webt/_v/d4/n1/_vd4n1yd6irh6smzqcnpswmmbjm.png">  .  Ein allgemeiner Fehler der Funktion ist: <img src="https://habrastorage.org/webt/8d/lf/me/8dlfmeklxb1jvlffcyk8w0vb478.png">  .  Jetzt solche finden <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  bei denen <img src="https://habrastorage.org/webt/xl/um/pw/xlumpww55az0itxqrtigh2qofqg.png">  Wenn wir ein Minimum erreichen, erhalten wir eine bessere Ann√§herung an die L√∂sung <img src="https://habrastorage.org/webt/ht/2u/lo/ht2ulowooc32s10ajclpbeug1w4.png">  . <br>  Ausgehend von der Ann√§herung <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  Wir werden es iterativ approximieren und bei jeder Iteration ankommen <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  .  Dazu ben√∂tigen wir jede Iteration, um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die Jacobi-Matrix</a> f√ºr die Funktion zu berechnen <img src="https://habrastorage.org/webt/vc/j3/mp/vcj3mpo1jjwkew5a0enemocdyoq.png">  f√ºr die aktuelle N√§herung, bestehend aus Ableitungen unserer Funktion: <br><img src="https://habrastorage.org/webt/m1/g0/g-/m1g0g-jmv04dlsbyoivbvjbwpwi.png"><br>  Und die folgende Ann√§herung wird gegeben als: <img src="https://habrastorage.org/webt/lm/xc/y4/lmxcy4rjlhtxgwz_lb8kpi1cpys.png">  . <br>  Oft sind Aufgaben so aufgebaut, dass wir eine gro√üe Anzahl von Daten unabh√§ngig voneinander haben (nur von den Werten <img src="https://habrastorage.org/webt/ht/2u/lo/ht2ulowooc32s10ajclpbeug1w4.png">  )  Infolgedessen ist die allgemeine Jacobi-Matrix sehr sp√§rlich.  Es gibt eine M√∂glichkeit, die Berechnungen zu optimieren. <br>  Angenommen, eine gemeinsame Funktion wird aus einer Reihe von Punkten berechnet.  Ab dem <i>j-ten</i> Punkt bekommen wir <img src="https://habrastorage.org/webt/29/lv/wk/29lvwk822xw4y0xlriuxrxx4gli.png">  .  Anstatt die Jacobi-Matrix zu berechnen <img src="https://habrastorage.org/webt/fu/vl/ui/fuvluirwbxatvxammyfzrbkxwug.png">  F√ºr die gesamte Funktion berechnen wir die Jacobi-Matrix speziell f√ºr <img src="https://habrastorage.org/webt/29/lv/wk/29lvwk822xw4y0xlriuxrxx4gli.png">  und bezeichnen es als: <img src="https://habrastorage.org/webt/zf/al/h0/zfalh0ntw3nupwu56dhc7u0fzn0.png">  .  Dann wird die folgende Ann√§herung wie folgt angegeben: <img src="https://habrastorage.org/webt/hl/2k/d6/hl2kd6neuqqtrclxyf6efubd8by.png">  .  Dar√ºber hinaus k√∂nnen Sie mit dieser √Ñnderung die Berechnungen parallelisieren. <br>  Es kann vorkommen, dass der folgende Wert <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  wird einen gr√∂√üeren Fehler geben als <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  .  Um dieses Problem zu l√∂sen, k√∂nnen Sie eine Modifikation des Algorithmus verwenden - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Levenberg-Marquardt-Algorithmus</a> .  Mehrwert schaffen <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  in unsere Formel: <img src="https://habrastorage.org/webt/d-/jv/hi/d-jvhiklwzbaxqihirj97fnyvg4.png">  wo <img src="https://habrastorage.org/webt/hp/qi/1y/hpqi1yohaku8yblniy_qjap0ghe.png">  Ist eine Einheitsmatrix.  Wert <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  wie folgt ausgew√§hlt: <br><ul><li>  Erstens hat es einen eher kleinen Wert (so dass der Algorithmus konvergiert). </li><li>  dann wenn ein Fehler f√ºr <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  mehr als <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  , dann erh√∂hen Sie den Wert <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  und versuchen Sie, den Fehler f√ºr zu berechnen <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  wieder. </li></ul><br>  Je nichtlinearer die Funktion <img src="https://habrastorage.org/webt/vc/j3/mp/vcj3mpo1jjwkew5a0enemocdyoq.png">  Je gr√∂√üer der Wert sein sollte <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  .  Je gr√∂√üer jedoch der Wert <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  Je langsamer der Algorithmus konvergiert. <br><br>  Wir vervollst√§ndigen den Algorithmus, wenn <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  anders als <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  klein genug und nehmen <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  als L√∂sung. <br><br>  Der Algorithmus ist ziemlich universell und kann f√ºr eine Vielzahl von Aufgaben verwendet werden. <br><br><h5>  Mathematisches Verfolgungsmodell </h5><br>  Da es sich um Koordinaten im Raum handelt, ist es klar, dass wir diese Koordinaten manipulieren k√∂nnen m√ºssen.  Angenommen, wir haben einige Punkte <img src="https://habrastorage.org/webt/pi/mv/hb/pimvhb7w8_hegkijjpdddui99ts.png">  .  Und wir m√ºssen sie mit Nullkoordinaten um den Punkt drehen.  Der wahrscheinlich einfachste Weg w√§re die Verwendung der Rotationsmatrix <i>R</i> , die die erforderliche Rotation beschreibt: <img src="https://habrastorage.org/webt/dn/qr/lf/dnqrlfvvkeyngvdbbqy8uwnbgyk.png">  .  Wenn wir die Punkte verschieben m√ºssen, f√ºgen Sie einfach den gew√ºnschten Vektor <i>t hinzu</i> : <img src="https://habrastorage.org/webt/ds/qc/jc/dsqcjcik5lk13aheb3_q78x8x6s.png">  . <br>  So k√∂nnen Sie die Position eines Objekts im Raum beliebig √§ndern.  Es stellt sich heraus, dass die Koordinaten des Objekts durch die dreidimensionale Matrix <i>R</i> und den dreidimensionalen Vektor <i>t bestimmt werden</i> , d.h.  12 Parameter.  Dar√ºber hinaus sind diese Parameter nicht unabh√§ngig voneinander, die Komponenten der Rotationsmatrix sind durch bestimmte Bedingungen miteinander verbunden.  Unter dem Gesichtspunkt der Verwendung dieser Funktionen bei der Optimierung sind diese Parameter daher nicht die beste L√∂sung.  Es gibt mehr Parameter als Freiheitsgrade, es gibt eine Beziehung zwischen ihnen.  Es gibt eine andere Form der Rotation - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Rodrigues Rotationsformel</a> .  Diese Drehung wird durch drei Parameter spezifiziert, die einen dreidimensionalen Vektor bilden. <br><br>  Der normalisierte Vektor ist die Rotationsachse, und die L√§nge dieses Vektors ist der Rotationswinkel um diese Achse. <br><br>  Wir setzen die Rotationsfunktion des Vektors <i>v</i> : <img src="https://habrastorage.org/webt/kl/hc/cz/klhccza_fs2fv8gmvh3uovdnzvw.png">  unter Verwendung der <i>r-</i> Parameter der Rodrigue-Formel.  Daraus ergibt sich folgende Formel: <img src="https://habrastorage.org/webt/_s/sg/p1/_ssgp1pn5q49yx32g-zkluqkn8u.png">  . <br>  Und am Ende k√∂nnen wir die Koordinaten der Position des Objekts mit einem 6-dimensionalen Vektor festlegen: <img src="https://habrastorage.org/webt/mb/mo/dl/mbmodlujklivexjnp7zo0eyup_o.png"><br>  Wir erhalten die folgende Formel: <img src="https://habrastorage.org/webt/ih/ls/hx/ihlshxts9oar5kcqw4l0a0ilj1w.png">  . <br><br><h5>  Lochkameramodell </h5><br>  Nun beschreiben wir ein einfaches mathematisches Modell der im Projekt verwendeten Kamera: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#xA0;vec&amp;#xA0;{p}&amp;#xA0;=&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{pmatrix}&amp;#xA0;p_x&amp;#xA0;&amp;amp;&amp;#xA0;p_y&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{pmatrix}&amp;#xA0;^&amp;#xA0;T&amp;#xA0;=&amp;#xA0;cam&amp;#xA0;(\&amp;#xA0;vec&amp;#xA0;{v})&amp;#xA0;=&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{pmatrix}&amp;#xA0;f_x&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{v_x}&amp;#xA0;{v_z}&amp;#xA0;+&amp;#xA0;c_x&amp;#xA0;&amp;amp;&amp;#xA0;f_y&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{v_y}&amp;#xA0;{v_z}&amp;#xA0;+&amp;#xA0;c_y&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{pmatrix}&amp;#xA0;^&amp;#xA0;T</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">\&nbsp;vec&nbsp;{p}&nbsp;=&nbsp;\&nbsp;begin&nbsp;{pmatrix}&nbsp;p_x&nbsp;&amp;&nbsp;p_y&nbsp;\&nbsp;end&nbsp;{pmatrix}&nbsp;^&nbsp;T&nbsp;=&nbsp;cam&nbsp;(\&nbsp;vec&nbsp;{v})&nbsp;=&nbsp;\&nbsp;begin&nbsp;{pmatrix}&nbsp;f_x&nbsp;\&nbsp;frac&nbsp;{v_x}&nbsp;{v_z}&nbsp;+&nbsp;c_x&nbsp;&amp;&nbsp;f_y&nbsp;\&nbsp;frac&nbsp;{v_y}&nbsp;{v_z}&nbsp;+&nbsp;c_y&nbsp;\&nbsp;end&nbsp;{pmatrix}&nbsp;^&nbsp;T</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>\&nbsp;vec&nbsp;{p}&nbsp;=&nbsp;\&nbsp;begin&nbsp;{pmatrix}&nbsp;p_x&nbsp;&amp;&nbsp;p_y&nbsp;\&nbsp;end&nbsp;{pmatrix}&nbsp;^&nbsp;T&nbsp;=&nbsp;cam&nbsp;(\&nbsp;vec&nbsp;{v})&nbsp;=&nbsp;\&nbsp;begin&nbsp;{pmatrix}&nbsp;f_x&nbsp;\&nbsp;frac&nbsp;{v_x}&nbsp;{v_z}&nbsp;+&nbsp;c_x&nbsp;&amp;&nbsp;f_y&nbsp;\&nbsp;frac&nbsp;{v_y}&nbsp;{v_z}&nbsp;+&nbsp;c_y&nbsp;\&nbsp;end&nbsp;{pmatrix}&nbsp;^&nbsp;T</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> \ vec {p} = \ begin {pmatrix} p_x & p_y \ end {pmatrix} ^ T = cam (\ vec {v}) = \ begin {pmatrix} f_x \ frac {v_x} {v_z} + c_x & f_y \ frac {v_y} {v_z} + c_y \ end {pmatrix} ^ T </script></p>  wo <img src="https://habrastorage.org/webt/4y/1n/eo/4y1neonrkqigjzoumocsltdvi-e.png">  - Brennweite in Pixel; <img src="https://habrastorage.org/webt/en/zb/z6/enzbz61iibgzcsxm0jtasbuek28.png">  - Das optische Zentrum ist ebenfalls in Pixel angegeben.  Dies sind einzelne Kameraparameter, die als intrinsische Parameter der Kamera bezeichnet werden.  Typischerweise sind diese Parameter im Voraus bekannt.  In diesem Projekt werden diese Parameter per Auge ausgew√§hlt. <br><br>  Dieses Modell ber√ºcksichtigt nicht die Objektivverzerrung der Kameras ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verzerrung</a> ).  Angenommen, sie sind es nicht. <br><br>  Mit diesem Modell erhalten wir eine zentrale Projektion, deren Punkte umso mehr zum optischen Zentrum tendieren, je weiter sie von der Kamera entfernt sind.  So erhalten wir die Wirkung einer sich verengenden Eisenbahn: <br><br><img src="https://habrastorage.org/webt/3c/a2/gn/3ca2gngkegajdjw25-gm6zgy3_u.jpeg"><br><br>  Im Raum ist die Kamera mit der <i>z-</i> Achse ausgerichtet, die Bildebene ist parallel zur <i>xy-</i> Ebene.  Wir erg√§nzen unser Modell mit der F√§higkeit, sich im Raum zu bewegen: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi></mrow><mi>j</mi></msub><mo>=</mo><mi>c</mi><mi>a</mi><mi>m</mi><mo stretchy=&quot;false&quot;>(</mo><mi>r</mi><mi>o</mi><mi>t</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi></mrow><mi>r</mi></msub><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>v</mi></mrow><mi>j</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi></mrow><mi>t</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="41.654ex" height="3.021ex" viewBox="0 -832 17934.4 1300.8" role="img" focusable="false" style="vertical-align: -1.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-65" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-63" x="1202" y="0"></use><g transform="translate(1635,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-6A" x="712" y="-326"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMAIN-3D" x="2808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-63" x="3864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-61" x="4298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-6D" x="4827" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMAIN-28" x="5706" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-72" x="6095" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-6F" x="6547" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-74" x="7032" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMAIN-28" x="7394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-76" x="8033" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-65" x="8519" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-63" x="8985" y="0"></use><g transform="translate(9419,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-72" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMAIN-2C" x="10410" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-76" x="11106" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-65" x="11591" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-63" x="12058" y="0"></use><g transform="translate(12491,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-6A" x="686" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMAIN-29" x="13368" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMAIN-2B" x="13980" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-76" x="15231" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-65" x="15716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-63" x="16183" y="0"></use><g transform="translate(16616,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMATHI-74" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjsnGcVBCl5N9xTswAO94E6iWIzEg#MJMAIN-29" x="17544" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>p</mi></mrow><mi>j</mi></msub><mo>=</mo><mi>c</mi><mi>a</mi><mi>m</mi><mo stretchy="false">(</mo><mi>r</mi><mi>o</mi><mi>t</mi><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>x</mi></mrow><mi>r</mi></msub><mo>,</mo><mtext>&nbsp;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>v</mi></mrow><mi>j</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mtext>&nbsp;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>x</mi></mrow><mi>t</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> \ vec {p} _j = cam (rot (\ vec {x} _r, \ vec {v} _j) + \ vec {x} _t) </script></p><br>  So haben wir ein Modell erhalten, mit dem wir in algebraischer Form die Projektion von Punkten von der Au√üenwelt auf das Kamerabild (von den Weltkoordinaten zum Bildschirm) simulieren k√∂nnen.  F√ºr uns sind die Parameter der relativen Position der Kamera im Raum in diesem Modell unbekannt. <img src="https://habrastorage.org/webt/ln/ib/-f/lnib-foisc9iu_aqy0wernf1xgu.png">  .  Diese Parameter werden als extrinsische Parameter der Kamera bezeichnet. <br><br><h5>  Tracking </h5><br>  Bereits ohne OpenCV-Tools implementiert.  Zun√§chst m√ºssen wir die Fehlerfunktion f√ºr unsere oben beschriebene N√§herungsl√∂sung erhalten.  Und wir werden die Berechnung schrittweise schreiben: <br><br><ol><li>  Wir w√§hlen solche Kanten des Verfolgungsmodells aus, die basierend auf den Parametern der aktuellen N√§herung sichtbar sind. </li><li>  Wir verwandeln den ausgew√§hlten Satz von Kanten in einen festen Satz von Punkten, um die Berechnungen zu vereinfachen.  Es ist beispielsweise m√∂glich, die n-te Anzahl von Punkten von jeder Kante zu nehmen oder (eine korrektere Option) eine solche Menge so zu w√§hlen, dass zwischen den Punkten ein fester Abstand in Pixel besteht.  Wir werden sie Kontrollpunkte nennen (im Projekt: controlPoint - Kontrollpunkte und controlPixelDistance - der gleiche feste Abstand in Pixel). </li><li>  Wir projizieren Kontrollpunkte auf das Bild.  Dank <i>distanceImage k√∂nnen</i> wir den Abstand der Projektion des Kontrollpunkts zum Rand im Bild ermitteln.  Im Idealfall sollten alle Kontrollpunkte streng an den Bildr√§ndern liegen, d.h.  Der Abstand zur Rippe sollte Null sein.  Basierend darauf erhalten wir einen Fehler f√ºr einen bestimmten Kontrollpunkt: <img src="https://habrastorage.org/webt/aj/yl/of/ajylofx-nqzxqkzyaaxwcczmd6a.png">  . </li><li>  Wir erhalten folgende Fehlerfunktion: <img src="https://habrastorage.org/webt/o8/u-/8w/o8u-8wwvnt2jhgyulfun8kyzh6k.png"></li></ol><br>  Jetzt bleibt ein Minimum von <i>E.</i> zu finden <i>.</i>  Dazu verwenden wir den oben beschriebenen Levenberg-Marquardt-Algorithmus.  Wie wir bereits wissen, erfordert der Algorithmus die Berechnung der Jacobi-Matrix, d.h.  abgeleitete Funktionen.  Sie k√∂nnen die numerische Ermittlung von Derivaten verwenden.  Sie k√∂nnen auch einige vorgefertigte L√∂sungen f√ºr diesen Algorithmus verwenden.  In diesem Projekt wurde jedoch alles manuell geschrieben, sodass ich den vollst√§ndigen Abschluss der gesamten L√∂sung beschreiben werde. <br><br>  F√ºr jeden Kontrollpunkt erhalten wir eine von anderen Punkten unabh√§ngige Gleichung.  Es wurde bereits oben beschrieben, dass es in diesem Fall m√∂glich ist, diese Gleichungen unabh√§ngig voneinander zu betrachten und die Jacobi-Matrix spezifisch f√ºr jede zu berechnen.  Wir werden es der Reihe nach anhand der Differenzierungsregeln einer komplexen Funktion analysieren: <br><br><img src="https://habrastorage.org/webt/qf/lm/3t/qflm3tr6vrmyirsufolpiwmlte4.png"><br><br>  Wir bezeichnen <img src="https://habrastorage.org/webt/_b/_i/i1/_b_ii1eklzapugxeahtbl7wwuky.png">  dann <img src="https://habrastorage.org/webt/tr/pz/a-/trpza-t1j_sr_otvetkquuvnac8.png"><br><br><img src="https://habrastorage.org/webt/en/k3/2q/enk32qx_j0zgvqzujalzydlfxyi.png"><br><br>  Von hier aus: <br><br><img src="https://habrastorage.org/webt/ld/nh/s1/ldnhs1vypzpsx_mxlu6wjat4qtm.png"><br><br>  Weiter bezeichnen wir <img src="https://habrastorage.org/webt/dl/2z/q0/dl2zq0jren9jpbmbpoaexelsrhw.png">  und <img src="https://habrastorage.org/webt/gb/kc/ps/gbkcpsry9q7nmsdz2kqpq-6br6y.png">  dann: <br><img src="https://habrastorage.org/webt/et/_j/ez/et_jez8fzupc2jtpk3bhteevl7y.png"><br><br>  Die Ableitungen von <i>distanceImage</i> sind numerisch.  Und zur Berechnung von Vektoren <img src="https://habrastorage.org/webt/iq/ur/_3/iqur_3xmxhxrdeia7bnkmonogxi.png">  und <img src="https://habrastorage.org/webt/z-/fy/qz/z-fyqzcgc19axrhujj5y6v0lxcm.png">  Sie m√ºssen Derivate gem√§√ü der Rotationsformel von Rodrigue finden.  Ich fand Jacobian durch diese Formel in der Ver√∂ffentlichung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚ÄûEine kompakte Formel f√ºr die Ableitung einer 3-D-Rotation in</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Exponentialkoordinaten ¬ªGuillermo Gallego, Anthony Yezzi</a> : <br><br><img src="https://habrastorage.org/webt/lb/rr/cr/lbrrcr3knmrvyjbessogjsvjyos.png">  , <br>  wobei <i>R</i> die Rotationsmatrix ist, die durch die Rodrigue-Formel aus dem Rotationsvektor erhalten wird <img src="https://habrastorage.org/webt/qz/bd/pe/qzbdpe7zjfanzdyip7acfhwgwvo.png">  ;; <img src="https://habrastorage.org/webt/bn/9c/-b/bn9c-blmg7tsys7l83pbu-2upny.png">  - der Punkt, den wir drehen;  <i>Ich bin</i> die Identit√§tsmatrix; <img src="https://habrastorage.org/webt/lq/im/g6/lqimg6wecrfth32alae6l435sxk.png">  .  Wie wir hier sehen, haben wir eine Division durch die L√§nge des Rotationsvektors, und wenn der Vektor Null ist, funktioniert die Formel nicht mehr.  Dies liegt wahrscheinlich daran, dass beim Nullvektor die Rotationsachse nicht definiert ist.  Wenn der Rotationsvektor sehr nahe bei Null liegt, verwenden wir diese Formel: <img src="https://habrastorage.org/webt/sm/hk/dc/smhkdchm-zr63paet8-nm_jftwo.png">  . <br>  Es bleibt zu malen <img src="https://habrastorage.org/webt/iq/ur/_3/iqur_3xmxhxrdeia7bnkmonogxi.png">  und <img src="https://habrastorage.org/webt/z-/fy/qz/z-fyqzcgc19axrhujj5y6v0lxcm.png">  (hier wird Index <i>j</i> weggelassen): <br><br><img src="https://habrastorage.org/webt/nt/xz/lf/ntxzlffpi42xgp1imuodytk2bqc.png"><img src="https://habrastorage.org/webt/hx/nz/pb/hxnzpbadbgyhlb2doqetg7f4iea.png"><br>  Somit haben wir die Jacobi-Matrix f√ºr den Punkt erhalten, den wir ben√∂tigen, und k√∂nnen sie f√ºr den oben beschriebenen Optimierungsalgorithmus verwenden. <br><br>  Bei diesem Algorithmus gibt es mehrere Probleme.  Erstens Genauigkeit.  Infolgedessen springt die globale Position der Kamera leicht von Bild zu Bild.  Sie k√∂nnen es ein bisschen beheben.  Wir haben a priori Informationen, dass sich die Kameraposition von Bild zu Bild nicht dramatisch √§ndern kann.  Und wir k√∂nnen diesen Jitter reduzieren, indem wir der Funktion zus√§tzliche Gleichungen hinzuf√ºgen. <br><br>  Es ist zu beachten, dass der Verschiebungsvektor <i>t</i> in unserem Fall nicht die Koordinate der globalen Position der Kamera ist.  Die globale Position ist ein lokaler Punkt mit Nullkoordinaten und kann daher wie folgt abgeleitet werden: <br><br><img src="https://habrastorage.org/webt/ly/zk/bk/lyzkbkk1zig1yfqu2shk9ziogbc.png"><br><br>  Wir erinnern uns an die Position des vorherigen Frames in <i>prevGlobalPosition</i> .  Jetzt sollte die vorherige Position nahe Null sein, d.h.  Vektorl√§nge <img src="https://habrastorage.org/webt/hv/lb/ww/hvlbwwdmw-wcymqnyxvaosx75mc.png">  sollte klein genug sein.  Das hei√üt,  Neben anderen Abweichungswerten muss auch der Vektor <i>d</i> minimiert werden.  Um den Grad des Einflusses dieser Modifikation zu bestimmen, f√ºhren wir den Wert ein <img src="https://habrastorage.org/webt/25/ij/uy/25ijuyi5965hui7hbmywcsgfnuy.png">  und multipliziere den Vektor <i>d</i> durch Addieren mit <img src="https://habrastorage.org/webt/25/ij/uy/25ijuyi5965hui7hbmywcsgfnuy.png">  :: <img src="https://habrastorage.org/webt/pc/eo/6_/pceo6_067ezk979vii2pi4ex8k4.png">  .  Das hei√üt,  im Optimierungsalgorithmus minimieren wir zus√§tzlich den Vektor <i>d '</i> .  Dazu muss nat√ºrlich die Jacobi-Matrix daf√ºr berechnet werden, die auf die gleiche Weise abgeleitet wird, wie wir sie oben bereits f√ºr die allgemeine Fehlerfunktion abgeleitet haben. <br><br>  Das zweite Problem des Algorithmus ist, dass er in lokalen Minima stecken bleiben kann.  In anderen Arbeiten wird dieses Problem mit einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Partikelfilter</a> gel√∂st <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">.</a>  In unserem Fall hat sich diese Option im Prinzip als ausreichend erwiesen. <br><br><h4>  Boni von der Verfolgung eines Objekts </h4><br>  Wenn Sie die Position und Form des Objekts kennen, k√∂nnen Sie sie visuell bearbeiten, was ich im Video zu demonstrieren versucht habe.  Das Objekt wurde mit OpenGL-Shadern verzerrt.  Mit Hilfe unseres Modells habe ich den Punkt des Objekts auf das Bild projiziert und so die Farbe dieses Punktes erhalten.  Dann k√∂nnen Sie diesen Punkt verschieben und interessante Effekte erzielen - zum Beispiel Morphing.  Man muss jedoch bedenken, dass es notwendig ist, dass etwas an seinem Platz bleibt, wenn man den Punkt verschiebt, sonst werden Inkonsistenzen sp√ºrbar.  Abh√§ngig von der Qualit√§t unserer Verfolgung und der Form des Objekts erhalten wir au√üerdem verschiedene unerw√ºnschte Effekte aufgrund von akkumulierten Fehlern, die immer noch auftreten.  Es muss nur irgendwie ber√ºcksichtigt werden.  In dem oben gezeigten Video wollte ich zeigen, dass Augmented Reality etwas weiter verwendet werden kann, als nur virtuelle Objekte auf das Bild zu setzen. <br><br>  √úbrigens implementiert das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vuforia SDK</a> die Verfolgung eines Objekts anhand seiner Form, obwohl ich nicht denke, dass es m√∂glich w√§re, dieses Projekt damit zu implementieren, da es nicht m√∂glich ist, streng definierte Kanten zu verwenden und nicht mit der Beleuchtung des Geb√§udes verbunden werden kann. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de454664/">https://habr.com/ru/post/de454664/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de454646/index.html">@ Pythonetc-Zusammenstellung, Mai 2019</a></li>
<li><a href="../de454648/index.html">Tipps und Tricks von meinem Telegramm-Kanal @pythonetc, Mai 2019</a></li>
<li><a href="../de454652/index.html">D√ºsentriebwerk auf einem 3D-Heimdrucker</a></li>
<li><a href="../de454658/index.html">Beauty Gadgets - Ernstes Gesch√§ft</a></li>
<li><a href="../de454662/index.html">Sorgf√§ltiger Umzug in die Niederlande mit seiner Frau und Hypothek. Teil 1: Jobsuche</a></li>
<li><a href="../de454666/index.html">Software Defined Radio - wie funktioniert es? Teil 7</a></li>
<li><a href="../de454668/index.html">Entwicklerkochbuch: DDD-Rezepte (Teil 5, Prozesse)</a></li>
<li><a href="../de454670/index.html">Die Serie "Tschernobyl": zuschauen und nachdenken</a></li>
<li><a href="../de454672/index.html">Schl√ºssel zum Start: die beste Software und Hardware f√ºr die Computerforensik</a></li>
<li><a href="../de454674/index.html">√úberwachung des armen Mannes oder Server√ºberwachung von der Konsole aus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>