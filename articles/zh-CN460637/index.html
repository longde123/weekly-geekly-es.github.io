<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥋 🐡 🚫 ZigBee上的灯光控制 🙂 👩🏼‍🔬 👩‍❤️‍💋‍👩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="朋友您好！ 今天，我想向您介绍一个远程照明控制系统的有趣发展。 



 现代化的房屋有大量电线，至少可以某种方式减少和简化无线电设备的数量。 实际上，这样的系统并不是新系统，但是在预算有限的情况下，它本身就具有充分的理由。 

 展望未来，我想立即显示控制系统的功能图。 


 图 1个 

 我...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ZigBee上的灯光控制</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460637/"> 朋友您好！ 今天，我想向您介绍一个远程照明控制系统的有趣发展。 <br><br><img src="https://habrastorage.org/webt/ro/yx/l6/royxl62-z2oqpfn6hwt5izou3_y.jpeg" alt="图片"><br><br> 现代化的房屋有大量电线，至少可以某种方式减少和简化无线电设备的数量。 实际上，这样的系统并不是新系统，但是在预算有限的情况下，它本身就具有充分的理由。 <br><br> 展望未来，我想立即显示控制系统的功能图。 <br><br><img src="https://habrastorage.org/webt/fh/ey/gj/fheygj8s-fn_phg3oqnva6ajrye.jpeg" alt="图片"><br>  <i>图</i>  <i>1个</i> <br><br> 我对猫下的某人感兴趣。 <br><a name="habracut"></a><br> 逻辑上的问题是为什么所有这些都需要？ 使用无线灯光控制系统可以： <br><br><ul><li> 减少从每个开关到房间接线盒的电线数量。 </li><li> 实现漫游开关的可能性。 </li><li> 可以灵活地控制任何开关的负载以及使用常闭常开按钮。 </li><li> 实现打开/关闭操作的任何时间延迟的能力。 </li></ul><br> 一开始的技术任务只是言语，看上去非常混乱和难以理解。 关键是，在面积为208平方米的两层平房中，有必要控制内部照明的开/关，该系统应使用220v的电源并开关21-23pcs。 负载（灯）的容量不超过200W。 第一次检查物体时，一切看起来像这样 <br><br><img src="https://habrastorage.org/webt/cz/bi/_b/czbi_bdenvipzshelqjbmh0himq.jpeg"><br>  <i>图</i>  <i>2.通信的主要部分放在地板上，然后全部浇上混凝土找平层</i> <br><br><img src="https://habrastorage.org/webt/sh/h-/7m/shh-7mxsspyefbi-nlti3wisn8m.jpeg"><br>  <i>图</i>  <i>3.在二楼安装配电柜的地方</i> <br><br> 强烈建议使用尽可能少的电线。 理想情况下，只有那些已经铺设在地板，墙壁和天花板上的地板，它们才能从配电盘的安装位置进入每个灯泡。 由于房屋中所有设备的电磁兼容性，因此不建议使用普通Wi-Fi，因为 有无数这样的设备，因此，以此为名的客户很喜欢房子里的设备将开始自己的生活，而随附的慢炖锅会影响浴室或卫生间的光线。 我所做的第一件事就是概述框图，就像我想象的那样，可以解决该问题。 在fig_4上，此选项。 <br><br><img src="https://habrastorage.org/webt/80/wk/x2/80wkx2kcoelxunryvcivzi8n7e8.jpeg"><br>  <i>图</i>  <i>4.照明控制功能图。</i> <br><br> 该基础是由支持ZiegBee技术的德州仪器（TI）CC2530无线电模块采用的，并且非常容易使用IAR-studio 5.5在C ++中进行编程。 直接切换负载是使用WB-MR6继电器模块（线路板）执行的，我之所以选择此元素，是因为在DIN导轨的紧凑型外壳中的DIN导轨上安装了六个具有独立通道的继电器，所有开关通用功率负载的特性都考虑到了t中。小时。 高启动电流：控制LED灯，白炽灯，开关电源。 另外，每个继电器触点都通过压敏电阻提供过压保护。 这些模块中的六个必须安装才能平静地管理给定数量的负载。 所有WB-MR6均通过ModBus接口连接到单个网络中。 每个继电器模块均设置为与接线图相对应的地址，并且整个系统（带输入块，保险丝和断路器）非常牢固地安装在两个配电盘SHCHMP2-1 500x400x450中。 为了紧凑地放置输入3 x1.5（单芯铜线）46电缆，有必要将DIN导轨的传统位置更改为垂直位置。 <br><br><img src="https://habrastorage.org/webt/xv/fx/mn/xvfxmnadqjpt8l0wy8jtzxmaopo.jpeg"><br>  <i>图</i>  <i>5.带有照明控制设备的配电盘。</i> <br><br> 应当指出，WB-MR6极其有用的功能是能够通过将常开按钮简单地连接到底部接线盒来控制继电器输出的能力，这是临时接线图所需要的。  T.K. 在组装和安装配电盘后的五个月后，出现了ModBus控件。 在此期间，所有连接至每个负载的电缆均经过了全面测试和编号。 并已制定了详细的开关方案，并带有开关的控制逻辑-图6中的灯泡。 <br><br><img src="https://habrastorage.org/webt/59/ca/lj/59caljsa6bx9fv1bkzm6x9cgz2g.jpeg"><br>  <i>图</i>  <i>6.照明控制方案以及负载放置和轮询模块。</i> <br><br> 至于调查模块，我可以说以下内容，图7所示的功能图非常实用。 几乎不需要重做，ss2530 RF模块允许您将任何输入分配给任何输出。 唯一的例外是UART（pin20-Tx，pin21-Rx）。大多数元件清单都是在ali上购买的。印刷电路板是按共振定购的。我用手焊接了全部二十块器件，这很费力，花了一周的时间，但没有立即解决需要。 但是获得了安装SMD组件的宝贵经验。 <br><br><img src="https://habrastorage.org/webt/vv/a3/d6/vva3d686ixu6dxa3rh-fxmemqig.jpeg"><br>  <i>图</i>  <i>7.按钮轮询模块的功能图</i> <br><br> 调试系统并使它进入完全运行状态的过程花费了三个多月的时间。 组装Rice_8板，检查电源并连接到编程器后的第一步是编写按钮轮询程序，并通过ModBus总线为WB-MR6继电器模块生成控制命令。 <br><br><img src="https://habrastorage.org/webt/zj/qq/cg/zjqqcgo-dewjpy6dpqvydmmjpu4.jpeg"><br>  <i>图</i>  <i>8.按钮轮询模块</i> <br><br> 事实证明，该过程非常快捷，简单。 到目前为止，一个按钮轮询模块已通过RS485连接到一个继电器模块，而没有网络接口。 立即设法将获得的成功应用到对象pic_9上，预先放置了位于卧室按钮中的双绞线UTP。 随着模块的固定，我并没有变得非常老练，自粘垫和塑料夹对您有很大帮助。 <br><br><img src="https://habrastorage.org/webt/qq/2m/f2/qq2mf2-bsvhphquu_bb_bikcajw.jpeg"><br>  <i>图</i>  <i>9.附加按钮轮询模块。</i> <br><br> 然后，他以编程方式添加了每个模块的地址，该地址是使用DIP开关和相应的交换卡，主/从操作模式以及通过无线电传输的命令来设置的。 向前迈出了严重的一步，因此调试存在许多困难。 最严重的是，一旦激活Zig-bee数据传输协议，就将有关按下按钮的信息传输到连接到Modbus总线的主模块，事实证明，这一切都变得更加复杂。 对于那些看过这里的人来说，我可以说问题是处理器核心中的计时器无法正常工作，更确切地说是在IAR编译器中，您需要在调用计时过程时不断指定其设置。 为了找到解决该问题的方法，增加了无线电发送的数据的监视和控制功能。 在计算机的超级终端中即时显示了在服务模式下按下按钮的控制，该超级终端通过RS485-USB适配器连接到轮询模块。 组织照明控制网络的另一个严重问题是无线电接口的范围不足。 或多或少地，有把握地，一切都只在组装版面的桌子范围内切换。 这是SS2530节能模式功能的结果，它默认为降低辐射功率的功能，在链接形成后，我不知道为什么这样做，但是在逐步调试模式下通过jtag找到了它。 关闭此模式后，网络仅在小屋的一层内开始工作，实际上，服务器仅从位于12-14 m半径内的轮询模块处理了开/关灯命令。 只要没有墙。 为了解决此问题，我们选择了用平面天线替换CC2530模块的方法，而将其替换为带有外部天线的模块（带有IPEX连接器），因为在E18-MSI-IPX版本中成功购买了三个模块以及在圣彼得堡的其中一个中购买天线和电缆，所以非常成功。在线商店。 所有这些都被快速焊接，制作了用于安装天线的角并将其拧紧到图10的转接板上。 <br><br><img src="https://habrastorage.org/webt/es/20/je/es20jewxb7gxff5iefdsr9uzmbu.jpeg"><br>  <i>图</i>  <i>10.外接天线的使用</i> <br><br> 如此升级的结果令我非常困惑-因为范围变化不大，我什至会说它略有下降。 我开始寻找一种方法来优化程序的算法，SS2530的初始设置必须重新阅读数据手册和相关论坛。 目的是使网络上的每个模块都可以用作转发器，尤其是因为默认情况下启用了此功能，并且运行Zig-Bee协议的任何设备都支持该功能。 但就我而言，这并不明显。 结果，我决定在系统中引入一个附加模块，该模块将通过仅在DIP开关上升高pin_6来激活唯一的固件。 他必须在二楼的天花板上，只是广播收到的命令，即 成为信号增强器。 <br><br> 我马上说，这是一个死胡同。 但是在实施此构想的过程中，我意外地测量了“黑色”天线的参数，该天线与CC2530和电缆一起在网上商店出售。 网络分析仪显示的SWR 1.9为2.4 GHz频率-不需要注释，您需要自己制作天线。 向搜索引擎发出的请求会立即给出正确答案，三叶草天线和详细的制造说明。 <br><br><img src="https://habrastorage.org/webt/8f/fo/2s/8ffo2soyaf4iikrhcw75ymoxwwi.jpeg"><br>  <i>图</i>  <i>11.天线及其制造装置。</i> <br><br> 从字面上看，我晚上制作了三根这些天线，检查它们的驻波比是否不低于1.2。 我不能说其他特征，辐射方向图和增益。 但事实是，可靠的命令接收和发送范围已加倍。 图_12 <br><br><img src="https://habrastorage.org/webt/ye/ba/bd/yebabdzcf80hy4yoaoilnapxxz4.jpeg"><br>  <i>图</i>  <i>12.天线测量</i> <br><br> 结果，我们设法在小屋中安装的所有12个轮询模块上实现了正常的服务器信号接收。  T.O. 对传统知识的要求已按时完全满足；我几乎按时完成了任务。 客户满意。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN460637/">https://habr.com/ru/post/zh-CN460637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN460627/index.html">vGPU-使用不可忽略</a></li>
<li><a href="../zh-CN460629/index.html">2名矿工拥有相同世界的概率</a></li>
<li><a href="../zh-CN460631/index.html">80天徽章周围：OFFZONE的另一侧</a></li>
<li><a href="../zh-CN460633/index.html">RSTP和专有扩展环冗余的实现细节</a></li>
<li><a href="../zh-CN460635/index.html">CLRium＃6：并发与并行。 两天：从处理器到异步/等待</a></li>
<li><a href="../zh-CN460641/index.html">YouTokenToMe：来自VKontakte团队的文本快速标记工具</a></li>
<li><a href="../zh-CN460643/index.html">球上点的均匀分布</a></li>
<li><a href="../zh-CN460645/index.html">做坏事：使用Go编写邪恶代码，第1部分</a></li>
<li><a href="../zh-CN460647/index.html">使用pwnable.kr 05-密码解决作业。 通过格式字符串漏洞重写过程链接表</a></li>
<li><a href="../zh-CN460651/index.html">匿名测试人员协会会议：TMS，监视监视，搜索质量评估和本地iOS测试</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>