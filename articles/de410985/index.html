<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¶ üìÖ ‚õΩÔ∏è Open-Source-L√∂sung zur zehnfachen Reduzierung der Datenlatenz mit Apache Cassandra üéÖüèæ üèñÔ∏è üë®üèº‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instagram verf√ºgt √ºber eine der gr√∂√üten Apache Cassandra-Datenbanken der Welt. Das Projekt begann 2012 mit Cassandra, um Redis zu ersetzen und die Imp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Open-Source-L√∂sung zur zehnfachen Reduzierung der Datenlatenz mit Apache Cassandra</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wirex/blog/410985/"><img src="https://habrastorage.org/webt/8h/qz/qy/8hqzqyfytcsvjn_xc9y5uj9j7ns.jpeg"><br><br>  Instagram verf√ºgt √ºber eine der gr√∂√üten Apache Cassandra-Datenbanken der Welt.  Das Projekt begann 2012 mit Cassandra, um Redis zu ersetzen und die Implementierung von Anwendungsfunktionen wie einem Betrugserkennungssystem, Tape und Direct zu unterst√ºtzen.  Zuerst arbeiteten Cassandra-Cluster in AWS, sp√§ter migrierten die Ingenieure sie zusammen mit allen anderen Instagram-Systemen auf die Facebook-Infrastruktur.  Cassandra schnitt in Bezug auf Zuverl√§ssigkeit und Fehlertoleranz sehr gut ab.  Gleichzeitig k√∂nnten die Latenzmetriken beim Lesen von Daten deutlich verbessert werden. <br><br>  Im vergangenen Jahr begann das Instagram-Support-Team von Cassandra mit der Arbeit an einem Projekt, das darauf abzielte, die Latenz beim Lesen von Daten in Cassandra, das von den Ingenieuren Rocksandra genannt wurde, erheblich zu reduzieren.  In diesem Artikel erkl√§rt der Autor, was das Team zur Implementierung dieses Projekts veranlasst hat, welche Schwierigkeiten √ºberwunden werden mussten und welche Leistungsmetriken Ingenieure sowohl in der internen als auch in der externen Cloud-Umgebung verwenden. <br><br><h3>  Gr√ºnde f√ºr den √úbergang </h3><br>  Instagram nutzt Apache Cassandra aktiv und in gro√üem Umfang als Schl√ºsselwertspeicherdienst.  Die meisten Instagram-Anfragen erfolgen online. Um Hunderten von Millionen von Instagram-Nutzern eine zuverl√§ssige und angenehme Benutzererfahrung zu bieten, stellen SLAs hohe Anforderungen an die Leistung des Systems. <a name="habracut"></a><br><br>  Instagram h√§lt sich an eine Zuverl√§ssigkeitsbewertung von f√ºnf bis neun.  Dies bedeutet, dass die Anzahl der Fehler zu einem bestimmten Zeitpunkt 0,001% nicht √ºberschreiten darf.  Um die Leistung zu verbessern, √ºberwachen die Ingenieure aktiv die Bandbreite und Latenzen verschiedener Cassandra-Cluster und stellen sicher, dass 99% aller Anforderungen in einen bestimmten Indikator passen (Verz√∂gerung P99). <br><br>  Unten sehen Sie eine Grafik, die die clientseitige Verz√∂gerung von eins f√ºr einen der Cassandra-Kampfcluster zeigt.  Blau zeigt die durchschnittliche Lesegeschwindigkeit (5 ms) an und Orange zeigt die Lesegeschwindigkeit f√ºr 99% im Bereich von 25 bis 60 ms an.  Die √Ñnderungen h√§ngen stark vom Client-Verkehr ab. <br><br> <a href=""><img src="https://habrastorage.org/webt/hh/w0/qq/hhw0qq_z9ce4zqkys5m8irabeja.png"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/h3/bs/oz/h3bsoz7oxelnn-sm9xse1wcn4u4.png"></a> <br><br>  Die Studie ergab, dass die starken Verz√∂gerungssch√ºbe gr√∂√ütenteils auf den JVM-Garbage Collector zur√ºckzuf√ºhren sind.  Die Ingenieure f√ºhrten eine Metrik mit dem Namen "Prozentsatz der Stopps des CM" ein, um den Prozentsatz der Zeit zu messen, die der Cassandra-Server f√ºr das "Stoppen der Welt" aufgewendet hat, und die von einer Ablehnung von Kundenanfragen begleitet wurde.  Die obige Tabelle zeigt die Zeit (in Prozent), die f√ºr die SM-Stopps ben√∂tigt wurde, am Beispiel eines der Cassandra-Kampfserver.  Der Indikator reichte von 1,25% zu Zeiten des kleinsten Verkehrs bis zu 2,5% zu Zeiten der Spitzenlast. <br><br>  Die Grafik zeigt, dass diese Cassandra-Serverinstanz 2,5% ihrer Zeit damit verbringen k√∂nnte, M√ºll zu sammeln, anstatt Client-Anforderungen zu bearbeiten.  Die vorbeugenden Operationen des Kollektors hatten offensichtlich einen signifikanten Einfluss auf die P99-Verz√∂gerung, und daher wurde klar, dass die Ingenieure die P99-Verz√∂gerungsrate signifikant reduzieren k√∂nnten, wenn wir die CM-Stopprate reduzieren k√∂nnten. <br><br><h3>  L√∂sung </h3><br>  Apache Cassandra ist eine Java-basierte verteilte Datenbank mit einer eigenen Datenspeicher-Engine, die auf LSM-B√§umen basiert.  Ingenieure stellten fest, dass Engine-Komponenten wie eine Speichertabelle, ein Komprimierungswerkzeug, Lese- / Schreibpfade und einige andere viele Objekte im dynamischen Java-Speicher erstellten, was dazu f√ºhrte, dass die JVM viele zus√§tzliche Overhead-Operationen ausf√ºhren musste.  Um die Auswirkungen von Speichermechanismen auf die Arbeit des Garbage Collectors zu verringern, hat das Support-Team verschiedene Ans√§tze in Betracht gezogen und schlie√ülich beschlossen, eine C ++ - Engine zu entwickeln und die vorhandene durch diese zu ersetzen. <br><br>  Die Ingenieure wollten nicht alles von Grund auf neu machen und entschieden sich daher f√ºr RocksDB. <br><br>  RocksDB ist eine leistungsstarke eingebettete Open-Source-Datenbank f√ºr die Speicherung von Schl√ºsselwerten.  Es ist in C ++ geschrieben und seine API verf√ºgt √ºber offizielle Sprachbindungen f√ºr C ++, C und Java.  RocksDB ist f√ºr hohe Leistung optimiert, insbesondere auf schnellen Laufwerken wie SSDs.  Es wird in der Branche h√§ufig als Speicher-Engine f√ºr MySQL, MongoDB und andere beliebte Datenbanken verwendet. <br><br><h3>  Schwierigkeiten </h3><br>  Bei der Implementierung der neuen Speicher-Engine in RocksDB standen die Ingenieure vor drei schwierigen Aufgaben und l√∂sten sie. <br><br>  Die erste Schwierigkeit bestand darin, dass Cassandra immer noch keine Architektur fehlt, mit der Datenprozessoren von Drittanbietern verbunden werden k√∂nnen.  Dies bedeutet, dass die Arbeit der vorhandenen Engine ziemlich eng mit anderen Datenbankkomponenten verbunden ist.  Um ein Gleichgewicht zwischen umfangreichem Refactoring und schnellen Iterationen zu finden, haben die Ingenieure die API der neuen Engine definiert, einschlie√ülich der g√§ngigsten Lese-, Schreib- und Stream-Schnittstellen.  Auf diese Weise konnte das Support-Team neue Datenverarbeitungsmechanismen f√ºr die API implementieren und diese in die entsprechenden Codeausf√ºhrungspfade in Cassandra einf√ºgen. <br><br>  Die zweite Schwierigkeit bestand darin, dass Cassandra strukturierte Datentypen und Tabellenschemata unterst√ºtzte, w√§hrend RocksDB nur Schl√ºsselwertschnittstellen bereitstellte.  Die Ingenieure haben die Codierungs- und Decodierungsalgorithmen sorgf√§ltig definiert, um das Cassandra-Datenmodell als Teil der RocksDB-Datenstrukturen zu unterst√ºtzen, und die Kontinuit√§t der Semantik √§hnlicher Abfragen zwischen den beiden Datenbanken sichergestellt. <br><br>  Die dritte Schwierigkeit war mit einer so wichtigen Komponente f√ºr jede verteilte Datenbankkomponente verbunden, wie das Arbeiten mit Datenstr√∂men.  Wenn ein Knoten zu einem Cassandra-Cluster hinzugef√ºgt oder daraus entfernt wird, muss er die Daten korrekt auf verschiedene Knoten verteilen, um die Last innerhalb des Clusters auszugleichen.  Bestehende Implementierungen dieser Mechanismen basierten auf dem Abrufen detaillierter Daten von der vorhandenen Datenbank-Engine.  Daher mussten die Ingenieure sie voneinander trennen, eine Abstraktionsschicht erstellen und eine neue Option f√ºr die Verarbeitung von Fl√ºssen mithilfe der RocksDB-API implementieren.  Um einen hohen Durchsatz von Streams zu erzielen, verteilt das Support-Team die Daten zun√§chst an tempor√§re sst-Dateien und verwendet dann die spezielle RocksDB-API, um die Dateien zu ‚Äûschlucken‚Äú, sodass sie gleichzeitig in die RocksDB-Instanz geladen werden k√∂nnen. <br><br><h3>  Leistungsindikatoren </h3><br>  Nach fast einem Jahr der Entwicklung und Erprobung haben die Ingenieure die erste Version der Implementierung fertiggestellt und sie erfolgreich auf mehreren Instagram Instagram Cassandra-Clustern ‚Äûeingef√ºhrt‚Äú.  In einem der Kampfcluster sank die P99-Verz√∂gerung von 60 ms auf 20 ms.  Beobachtungen zeigten auch, dass SM-Stopps in diesem Cluster von 2,5% auf 0,3% fielen, dh fast 10-mal! <br><br>  Die Ingenieure wollten auch pr√ºfen, ob Rocksandra in einer √∂ffentlichen Cloud-Umgebung eine gute Leistung erbringen kann.  Das Support-Team richtete in AWS einen Cassandra-Cluster mit drei i3.8 xlarge EC2-Instanzen mit jeweils einem 32-Core-Prozessor, 244 GB RAM und einem Null-Raid von vier NVMe-Flash-Laufwerken ein. <br><br>  F√ºr Vergleichstests haben wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NDBench</a> und das Standardtabellenschema f√ºr das Framework verwendet. <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> emp ( emp_uname <span class="hljs-type"><span class="hljs-type">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIMARY KEY</span></span>, emp_dept <span class="hljs-type"><span class="hljs-type">text</span></span>, emp_first <span class="hljs-type"><span class="hljs-type">text</span></span>, emp_last <span class="hljs-type"><span class="hljs-type">text</span></span> )</code> </pre> <br>  Die Ingenieure haben 250 Millionen 6 Zeilen mit jeweils 6 KB vorinstalliert (auf jedem Server werden ca. 500 GB Daten gespeichert).  Richten Sie als N√§chstes 128 Leser und Schreiber in NDBench ein. <br><br>  Das Support-Team testete verschiedene Lasten und ma√ü die durchschnittlichen Lese- und Schreiblatenzen / P99 / P999.  Die folgenden Grafiken zeigen, dass Rocksandra signifikant geringere und stabilere Lese- und Schreiblatenzen aufwies. <br><br><img src="https://habrastorage.org/webt/sc/7j/im/sc7jim4homfpkase00fbjixjhyq.png"><br><br><img src="https://habrastorage.org/webt/z1/ol/pw/z1olpwd4z6q-bp-kihfcf58j9bo.png"><br><br>  Die Ingenieure √ºberpr√ºften die Last auch im Lesemodus ohne zu schreiben und stellten fest, dass Rocksandra mit derselben P99-Leseverz√∂gerung (2 ms) die Informationslesegeschwindigkeit mehr als verzehnfachen kann (300 K / s f√ºr Rocksandra gegen√ºber 30 K / s f√ºr C. * 3.0). <br><br><img src="https://habrastorage.org/webt/jn/sy/fu/jnsyfumtlax15y1p0tkkalrc_f4.png"><br><br><img src="https://habrastorage.org/webt/iv/js/fs/ivjsfsiexo3bzmuklo_ughr0tju.png"><br><br><h3>  Zukunftspl√§ne </h3><br>  Das Instagram-Support-Team hat den <a href="">Rocksandra-</a> Code und das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Framework zur Bewertung der Leistung</a> ge√∂ffnet.  Sie k√∂nnen sie von Github herunterladen und in Ihrer eigenen Umgebung ausprobieren.  Sagen Sie uns unbedingt, was daraus geworden ist! <br><br>  Als n√§chsten Schritt arbeitet das Team aktiv daran, eine breitere Unterst√ºtzung f√ºr C * -Funktionalit√§ten wie Sekund√§rindizes, Fixes und mehr hinzuzuf√ºgen.  Au√üerdem entwickeln Ingenieure die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Architektur der Plug-in-Datenbank-Engine in C *,</a> um diese Entwicklungen weiter auf die Apache Cassandra-Community zu √ºbertragen. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/4bd/bf6/597/4bdbf659775744b1bdbb4d8a00a0a980.png" alt="Bild"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de410985/">https://habr.com/ru/post/de410985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de410969/index.html">5 Technologien f√ºr den n√§chsten F√ºnfjahreszeitraum: Prognose von IBM</a></li>
<li><a href="../de410973/index.html">Welche Drohnen werden im Weltkino eingesetzt?</a></li>
<li><a href="../de410977/index.html">Ein Versuch, ein universelles Informationseingabeger√§t zu erstellen</a></li>
<li><a href="../de410979/index.html">Das Gehirn mit "Bildwiderspr√ºchen" "hacken"</a></li>
<li><a href="../de410981/index.html">Yandex hat seinem Browser Schutz gegen Crypto Miner hinzugef√ºgt</a></li>
<li><a href="../de410987/index.html">GLONASS wird so genau wie das GPS-Navigationssystem hergestellt</a></li>
<li><a href="../de410989/index.html">Vorg√§nger von Fitnessarmb√§ndern: Schrittz√§hler, Herzfrequenzmesser, Fahrradcomputer</a></li>
<li><a href="../de410991/index.html">Ledger Cryptocurrency Hardware Wallet von 15-j√§hrigem Hacker gehackt</a></li>
<li><a href="../de410993/index.html">Jemand schickt Sexspielzeug von Amazon an Fremde. Amazon wei√ü nicht, wie man sie aufh√§lt</a></li>
<li><a href="../de410997/index.html">Der medizinische Anwalt kommentierte das derzeitige Telemedizingesetz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>