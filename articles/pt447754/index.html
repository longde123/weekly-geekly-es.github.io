<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§¶üèº üì† üèí Aplicativo da barra de menus para o macOS ü§ô ‚ôçÔ∏è üêö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os aplicativos localizados na barra de menus s√£o conhecidos h√° muito tempo pelos usu√°rios do macOS. Alguns desses aplicativos t√™m uma parte "normal", ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aplicativo da barra de menus para o macOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447754/"> Os aplicativos localizados na barra de menus s√£o conhecidos h√° muito tempo pelos usu√°rios do macOS.  Alguns desses aplicativos t√™m uma parte "normal", outros est√£o localizados apenas na barra de menus. <br>  Neste guia, voc√™ escrever√° um aplicativo que exibe v√°rias cita√ß√µes de pessoas famosas em uma janela pop-up.  No processo de cria√ß√£o deste aplicativo, voc√™ aprender√°: <br><br><ul><li>  atribuir √≠cone do aplicativo na barra de menus </li><li>  torne o aplicativo hospedado apenas na barra de menus </li><li>  adicionar menu personalizado </li><li>  mostre uma janela pop-up a pedido do usu√°rio e oculte-a quando necess√°rio, usando o <b>Monitoramento de Eventos</b> </li></ul><br><blockquote>  <b>Nota:</b> este guia pressup√µe que voc√™ esteja familiarizado com o Swift e o macOS. </blockquote><a name="habracut"></a><br><h2>  Introdu√ß√£o </h2><br>  Inicie o Xcode.  Em seguida, no menu <b>Arquivo / Novo / Projeto ...</b> , selecione o modelo <b>macOS / Application / Cocoa App</b> e clique em <b>Avan√ßar</b> . <br><br>  Na pr√≥xima tela, insira Cota√ß√µes como o <b>Nome</b> do <b>produto</b> , selecione o <b>Nome da</b> <b>organiza√ß√£o</b> e o <b>Identificador da organiza√ß√£o</b> .  Em seguida, verifique se Swift est√° selecionado como idioma do aplicativo e a caixa de sele√ß√£o <b>Usar Storyboards</b> est√° marcada.  Desmarque as <b>caixas de sele√ß√£o</b> <b>Criar aplicativo baseado em documento</b> , <b>Usar dados principais</b> , <b>Incluir testes de unidade</b> e <b>Incluir testes de interface do usu√°rio</b> . <br><br><img src="https://habrastorage.org/webt/4c/_f/g6/4c_fg6hmxqq0k_vqkm8-zqrt_ok.png"><br><br>  Por fim, clique em <b>Avan√ßar</b> novamente, especifique o local para salvar o projeto e clique em <b>Criar</b> . <br>  Depois que o novo projeto for criado, abra <b>AppDelegate.swift</b> e adicione a seguinte propriedade √† classe: <br><br><pre><code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> statusItem = <span class="hljs-type"><span class="hljs-type">NSStatusBar</span></span>.system.statusItem(withLength:<span class="hljs-type"><span class="hljs-type">NSStatusItem</span></span>.squareLength)</code> </pre> <br>  Aqui, criamos na barra de menus Item de status (√≠cone do aplicativo) um comprimento fixo que ficar√° vis√≠vel para os usu√°rios. <br><br>  Em seguida, precisamos atribuir nossa imagem a esse novo item na barra de menus para que possamos distinguir nosso novo aplicativo. <br><br>  No navegador do projeto, acesse Assets.xcassets, <a href="">fa√ßa upload de uma imagem</a> e arraste-a para o cat√°logo de ativos. <br><br>  Selecione uma imagem e abra o inspetor de atributos.  Altere a op√ß√£o <b>Renderizar como</b> para <b>Imagem do modelo</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/wv/es/-o/wves-ouas8duyvk97fki1swuedk.png"></a> <br><br>  Se voc√™ usar sua pr√≥pria imagem, verifique se a imagem √© em preto e branco e configure-a como uma <b>imagem de modelo</b> para que o √≠cone fique √≥timo nas barras de menu escura e clara. <br><br>  Volte para <b>AppDelegate.swift</b> e adicione o seguinte c√≥digo ao <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { button.image = <span class="hljs-type"><span class="hljs-type">NSImage</span></span>(named:<span class="hljs-type"><span class="hljs-type">NSImage</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>(<span class="hljs-string"><span class="hljs-string">"StatusBarButtonImage"</span></span>)) button.action = #selector(printQuote(<span class="hljs-number"><span class="hljs-number">_</span></span>:)) }</code> </pre> <br>  Aqui, atribu√≠mos o √≠cone do aplicativo que acabamos de adicionar ao √≠cone do aplicativo e atribu√≠mos uma <b>a√ß√£o</b> quando clicamos nele. <br><br>  Adicione o seguinte m√©todo √† classe: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printQuote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quoteText = <span class="hljs-string"><span class="hljs-string">"Never put off until tomorrow what you can do the day after tomorrow."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quoteAuthor = <span class="hljs-string"><span class="hljs-string">"Mark Twain"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(quoteText) ‚Äî \(quoteAuthor)"</span></span>) }</code> </pre> <br>  Este m√©todo simplesmente imprime a cota√ß√£o no console. <br><br>  Preste aten√ß√£o √† <b>diretiva do</b> m√©todo <b>objc</b> .  Isso permite que voc√™ use esse m√©todo como resposta a um clique no bot√£o. <br><br>  Crie e execute o aplicativo e voc√™ ver√° o novo aplicativo na barra de menus.  Viva! <br>  Cada vez que voc√™ clica no √≠cone na barra de menus, o famoso ditado de Mark Twain √© exibido no console do Xcode. <br><br><h2>  Escondemos a janela principal e o √≠cone no banco dos r√©us </h2><br>  H√° algumas pequenas coisas que precisamos fazer antes de lidar diretamente com a funcionalidade: <br><br><ul><li>  excluir √≠cone de encaixe </li><li>  remover a janela principal do aplicativo desnecess√°rio </li></ul><br>  Para remover o √≠cone da esta√ß√£o, abra <b>Info.plist</b> .  Adicione uma nova chave <b>Application is agent (UIElement)</b> e defina seu valor como <b>YES</b> . <br><br><img src="https://habrastorage.org/webt/-c/g_/pn/-cg_pnrysiiynfs2xfab8fyblhk.png"><br><br>  Agora √© a hora de lidar com a janela principal do aplicativo. <br><br><ul><li>  abra <b>Main.storyboard</b> </li><li>  selecione a <b>cena Window Controller</b> e exclua-a </li><li>  <b>Ver a cena da controladora</b> sair, usaremos em breve </li></ul><br><br> <a href=""><img src="https://habrastorage.org/webt/td/1q/vr/td1qvrwqe8qpgp2xvadbifvu_4o.png"></a> <br><br>  Crie e execute o aplicativo.  Agora, o aplicativo n√£o possui a janela principal e o √≠cone desnecess√°rio no dock.  √ìtimo! <br><br><h2>  Adicionar menu ao item de status </h2><br>  Uma resposta de clique √∫nico claramente n√£o √© suficiente para um aplicativo s√©rio.  A maneira mais f√°cil de adicionar funcionalidade √© adicionar um menu.  Adicione esta fun√ß√£o no final do <b>AppDelegate</b> . <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constructMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> menu = <span class="hljs-type"><span class="hljs-type">NSMenu</span></span>() menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Print Quote"</span></span>, action: #selector(<span class="hljs-type"><span class="hljs-type">AppDelegate</span></span>.printQuote(<span class="hljs-number"><span class="hljs-number">_</span></span>:)), keyEquivalent: <span class="hljs-string"><span class="hljs-string">"P"</span></span>)) menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>.separator()) menu.addItem(<span class="hljs-type"><span class="hljs-type">NSMenuItem</span></span>(title: <span class="hljs-string"><span class="hljs-string">"Quit Quotes"</span></span>, action: #selector(<span class="hljs-type"><span class="hljs-type">NSApplication</span></span>.terminate(<span class="hljs-number"><span class="hljs-number">_</span></span>:)), keyEquivalent: <span class="hljs-string"><span class="hljs-string">"q"</span></span>)) statusItem.menu = menu }</code> </pre> <br>  E adicione essa chamada no final do <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs">constructMenu()</code> </pre> <br>  Criamos o <b>NSMenu</b> , adicionamos 3 inst√¢ncias do <b>NSMenuItem</b> a ele e definimos esse menu como o menu do √≠cone do aplicativo. <br><br>  Alguns pontos importantes: <br><br><ul><li>  <b>O t√≠tulo</b> do item de menu √© o texto que aparece no menu.  Um bom lugar para localizar o aplicativo (se necess√°rio). </li><li>  <b>a√ß√£o</b> , como a <b>a√ß√£o de um</b> bot√£o ou outro controle, √© um m√©todo chamado quando o usu√°rio clica em um item de menu </li><li>  <b>keyEquivalent</b> √© um atalho de teclado que voc√™ pode usar para selecionar um item de menu.  Caracteres min√∫sculos usam <b>Cmd</b> como um modificador e caracteres min√∫sculos usam <b>Cmd + Shift</b> .  Isso s√≥ funciona se o aplicativo estiver no topo e estiver ativo.  No nosso caso, √© necess√°rio que o menu ou alguma outra janela esteja vis√≠vel, pois nosso aplicativo n√£o possui um √≠cone no dock </li><li>  <b>separatorItem</b> √© um item de menu inativo na forma de uma linha cinza entre outros elementos.  Use-o para agrupar </li><li>  <b>printQuote</b> √© o m√©todo que voc√™ j√° definiu no <b>AppDelegate</b> e <b>termina</b> √© o m√©todo definido pelo <b>NSApplication</b> . </li></ul><br>  Inicie o aplicativo e voc√™ ver√° um menu clicando no √≠cone do aplicativo. <br><br><img src="https://habrastorage.org/webt/-w/2v/lv/-w2vlv2nfi_vxgosiihbqd19m5g.png"><br><br>  Tente clicar no menu - selecionar <b>Imprimir cota√ß√£o</b> exibe a cota√ß√£o no console do Xcode e <b>Quit Quote</b> encerra o aplicativo. <br><br><h2>  Adicionar um pop-up </h2><br>  Voc√™ viu como √© f√°cil adicionar um menu a partir do c√≥digo, mas exibir uma cota√ß√£o no console do Xcode claramente n√£o √© o que os usu√°rios esperam do aplicativo.  Agora vamos adicionar um controlador de exibi√ß√£o simples para exibir as cota√ß√µes da maneira correta. <br><br>  V√° para o menu <b>Arquivo / Novo / Arquivo ...</b> , selecione o modelo <b>macOS / Source / Cocoa Class</b> e clique em <b>Avan√ßar</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/m5/vd/7w/m5vd7wewsgjt16zajhbas3ca9mi.png"></a> <br><br><ul><li>  nomeie a classe <b>QuotesViewController</b> </li><li>  tornar um herdeiro do <b>NSViewController</b> </li><li>  verifique se a caixa de sele√ß√£o <b>Tamb√©m criar arquivo XIB para a interface do usu√°rio</b> n√£o <b>est√°</b> marcada </li><li>  defina o idioma para Swift </li></ul><br>  Por fim, clique em <b>Avan√ßar</b> novamente, selecione um local para salvar o arquivo e clique em <b>Criar</b> . <br>  Agora abra <b>Main.storyboard</b> .  Expanda <b>Exibir cena do controlador</b> e selecione <b>Exibir inst√¢ncia do controlador</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/c4/dd/em/c4ddemmj9moxiu_whrzl7ilme_4.png"></a> <br><br>  Primeiro, selecione o <b>Identity Inspector</b> e altere a classe para <b>QuotesViewController</b> , depois defina o <b>Storyboard ID</b> como <b>QuotesViewController</b> <br><br>  Agora adicione o seguinte c√≥digo ao final do arquivo <b>QuotesViewController.swift</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuotesViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// MARK: Storyboard instantiation static func freshController() -&gt; QuotesViewController { //1. let storyboard = NSStoryboard(name: NSStoryboard.Name("Main"), bundle: nil) //2. let identifier = NSStoryboard.SceneIdentifier("QuotesViewController") //3. guard let viewcontroller = storyboard.instantiateController(withIdentifier: identifier) as? QuotesViewController else { fatalError("Why cant i find QuotesViewController? - Check Main.storyboard") } return viewcontroller } }</span></span></code> </pre> <br>  O que est√° acontecendo aqui: <br><br><ol><li>  n√≥s temos um link para <b>Main.storyboard</b> . </li><li>  crie um <b>identificador de cena</b> que corresponda ao que acabamos de instalar logo acima. </li><li>  crie uma inst√¢ncia de <b>QuotesViewController</b> e retorne-a. </li></ol><br>  Como voc√™ cria esse m√©todo, agora todos que usam o <b>QuotesViewController</b> n√£o precisam saber como ele √© criado.  Isso simplesmente funciona. <br><br>  Observe o <b>fatalError</b> dentro da declara√ß√£o de <b>guarda</b> .  Pode ser bom us√°-lo ou <b>assertionFailure</b> para que, se algo no desenvolvimento der errado, voc√™ e os outros membros da equipe de desenvolvimento fiquem sabendo. <br><br>  Agora, de volta ao <b>AppDelegate.swift</b> .  Adicione uma nova propriedade. <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> popover = <span class="hljs-type"><span class="hljs-type">NSPopover</span></span>()</code> </pre> <br>  Em seguida, substitua um <b>pplicationDidFinishLaunching (_ :) pelo</b> seguinte c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applicationDidFinishLaunching</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aNotification: Notification)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { button.image = <span class="hljs-type"><span class="hljs-type">NSImage</span></span>(named:<span class="hljs-type"><span class="hljs-type">NSImage</span></span>.<span class="hljs-type"><span class="hljs-type">Name</span></span>(<span class="hljs-string"><span class="hljs-string">"StatusBarButtonImage"</span></span>)) button.action = #selector(togglePopover(<span class="hljs-number"><span class="hljs-number">_</span></span>:)) } popover.contentViewController = <span class="hljs-type"><span class="hljs-type">QuotesViewController</span></span>.freshController() }</code> </pre><br>  Voc√™ alterou a a√ß√£o de clique para chamar o <b>m√©todo togglePopover (_ :)</b> , que escreveremos um pouco mais tarde.  Al√©m disso, em vez de configurar e adicionar um menu, configuramos uma janela pop-up que mostrar√° algo do <b>QuotesViewController</b> . <br><br>  Adicione os tr√™s m√©todos a <b>seguir</b> ao <b>AppDelegate</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">togglePopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> popover.isShown { closePopover(sender: sender) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { showPopover(sender: sender) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showPopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = statusItem.button { popover.show(relativeTo: button.bounds, of: button, preferredEdge: <span class="hljs-type"><span class="hljs-type">NSRectEdge</span></span>.minY) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closePopover</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { popover.performClose(sender) }</code> </pre> <br>  <b>showPopover ()</b> mostra um pop-up.  Voc√™ apenas indica de onde vem, o macOS posiciona-o e desenha uma seta, como se aparecesse na barra de menus. <br><br>  <b>closePopover ()</b> apenas fecha o pop-up e <b>togglePopover ()</b> √© um m√©todo que mostra ou oculta o pop-up, dependendo do seu estado. <br><br>  Inicie o aplicativo e clique no √≠cone. <br><br><img src="https://habrastorage.org/webt/j6/gu/oq/j6guoqowcbou3xwtqr2cdunm4ns.png"><br><br>  Est√° tudo bem, mas onde est√° o conte√∫do? <br><br><h2>  Implementamos o Quote View Controller </h2><br>  Primeiro, voc√™ precisa de um modelo para armazenar cota√ß√µes e atributos.  V√° para o menu <b>Arquivo / Novo / Arquivo ...</b> e selecione o modelo <b>macOS / Source / Swift File e</b> , em seguida, <b>Avan√ßar</b> .  Nomeie o arquivo como <b>Quote</b> e clique em <b>Create</b> . <br><br>  Abra o arquivo <b>Quote.swift</b> e adicione o seguinte c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quote</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> author: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> all: [<span class="hljs-type"><span class="hljs-type">Quote</span></span>] = [ <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Never put off until tomorrow what you can do the day after tomorrow."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Mark Twain"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Efficiency is doing better what is already being done."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Peter Drucker"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"To infinity and beyond!"</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Buzz Lightyear"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"May the Force be with you."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Han Solo"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"Simplicity is the ultimate sophistication"</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Leonardo da Vinci"</span></span>), <span class="hljs-type"><span class="hljs-type">Quote</span></span>(text: <span class="hljs-string"><span class="hljs-string">"It's not just what it looks like and feels like. Design is how it works."</span></span>, author: <span class="hljs-string"><span class="hljs-string">"Steve Jobs"</span></span>) ] } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Quote</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomStringConvertible</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"\"\(text)\" ‚Äî \(author)"</span></span> } }</code> </pre> <br>  Aqui, definimos uma estrutura de cota√ß√£o simples e uma propriedade est√°tica que retorna todas as cota√ß√µes.  Como tornamos o <b>Quote</b> compat√≠vel com o protocolo <b>CustomStringConvertible</b> , podemos facilmente obter texto formatado de maneira conveniente. <br><br>  H√° progresso, mas ainda precisamos de controles para exibir tudo isso. <br><br><h2>  Adicionar elementos da interface </h2><br>  Abra Main.storyboard e puxe 3 bot√µes ( <b>Push Button</b> ) e a etiqueta ( <b>Multiline Label)</b> no controlador de exibi√ß√£o. <br><br>  Posicione os bot√µes e o r√≥tulo para que eles se pare√ßam com isso: <br><br><img src="https://habrastorage.org/webt/1v/ry/2_/1vry2_ydfrxoqiqdsklo2uouwne.png"><br><br>  Anexe o bot√£o esquerdo √† borda esquerda com um espa√ßo de 20 e centralize verticalmente. <br>  Anexe o bot√£o direito √† borda direita com um espa√ßo de 20 e centralize verticalmente. <br>  Anexe o bot√£o inferior √† borda inferior com um espa√ßo de 20 e centralize horizontalmente. <br>  Anexe as bordas esquerda e direita da marca aos bot√µes com um espa√ßo de 20, centralmente na vertical. <br><br> <a href=""><img src="https://habrastorage.org/webt/jl/zi/tl/jlzitledfqmcexzv636ya6ir6sq.png"></a> <br><br>  Voc√™ ver√° v√°rios erros de layout, pois n√£o h√° informa√ß√µes suficientes para o <b>layout autom√°tico</b> descobrir. <br><br>  Defina a <b>Prioridade de abra√ßo de conte√∫do horizontal</b> como 249 para permitir que o r√≥tulo seja redimensionado. <br><br> <a href=""><img src="https://habrastorage.org/webt/a6/qp/s0/a6qps0r2_vobhsjkbcfiqohklgc.png"></a> <br><br>  Agora fa√ßa o seguinte: <br><br><ul><li>  defina a <b>imagem do</b> bot√£o esquerdo como <b>NSGoLeftTemplate</b> e limpe o <b>t√≠tulo</b> </li><li>  defina a <b>imagem do</b> bot√£o direito como <b>NSGoRightTemplate</b> e limpe o <b>t√≠tulo</b> </li><li>  defina o <b>t√≠tulo do</b> bot√£o abaixo como <b>Quit Quotes</b> . </li><li>  defina o <b>alinhamento do texto da</b> etiqueta para centralizar. </li><li>  verifique se a <b>quebra de linha</b> no r√≥tulo est√° definida como <b>quebra autom√°tica de linha</b> . </li></ul><br><br>  Agora abra <b>QuotesViewController.swift</b> e adicione o seguinte c√≥digo √† implementa√ß√£o da classe <b>QuotesViewController</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textLabel: <span class="hljs-type"><span class="hljs-type">NSTextField!</span></span></code> </pre> <br><br>  Adicione esta extens√£o √† implementa√ß√£o da classe.  Agora, em <b>QuotesViewController.swift, existem</b> duas extens√µes de classe. <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// MARK: Actions extension QuotesViewController { @IBAction func previous(_ sender: NSButton) { } @IBAction func next(_ sender: NSButton) { } @IBAction func quit(_ sender: NSButton) { } }</span></span></code> </pre> <br>  Acabamos de adicionar uma <b>sa√≠da</b> para a etiqueta que usaremos para exibir aspas e tr√™s m√©todos de stub que conectaremos com os bot√µes. <br><br><h2>  Conectando o c√≥digo ao Interface Builder </h2><br>  Nota: O Xcode colocou c√≠rculos √† esquerda do seu c√≥digo - ao lado das palavras-chave <b>IBAction</b> e <b>IBOutlet</b> . <br><br><img src="https://habrastorage.org/webt/kv/48/k_/kv48k_pvgucw0v1jexqsna44dda.png"><br><br>  Vamos us√°-los para conectar o c√≥digo √† interface do usu√°rio. <br><br>  Enquanto mant√©m pressionada a tecla <b>alt</b> , clique em <b>Main.storyboard</b> no <b>navegador</b> do <b>projeto</b> .  Assim, o <b>storyboard √©</b> aberto no <b>Assistente do Editor</b> √† direita e o c√≥digo √† esquerda. <br><br>  Arraste o c√≠rculo √† esquerda do <b>textLabel</b> para o r√≥tulo no <b>construtor de interfaces</b> .  Da mesma forma, combine os m√©todos <b>anterior</b> , <b>pr√≥ximo</b> e <b>sair</b> com os bot√µes esquerdo, direito e inferior, respectivamente. <br><br> <a href=""><img src="https://habrastorage.org/webt/7-/qu/yb/7-quybzu1bexw545popvn_mbeea.png"></a> <br><br>  Inicie seu aplicativo. <br><br><img src="https://habrastorage.org/webt/tr/b2/6w/trb26wseu6kdpeyqyjdbeojwoxu.png"><br><br>  Usamos o tamanho padr√£o do pop-up.  Se voc√™ quiser um pop-up maior ou menor, redimensione-o no <b>storyboard</b> . <br><br><h2>  Escrevendo um c√≥digo para os bot√µes </h2><br>  Se voc√™ ainda n√£o ocultou o <b>Editor Assistente</b> , clique em <b>Cmd-Return</b> ou <b>View&gt; Editor Padr√£o&gt; Mostrar Editor Padr√£o</b> <br><br>  Abra <b>QuotesViewController.swift</b> e adicione as seguintes propriedades √† implementa√ß√£o da classe: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quotes = <span class="hljs-type"><span class="hljs-type">Quote</span></span>.all <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentQuoteIndex: <span class="hljs-type"><span class="hljs-type">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">didSet</span></span> { updateQuote() } }</code> </pre> <br>  A propriedade <b>aspas</b> cont√©m todas as aspas, e <b>currentQuoteIndex</b> √© o √≠ndice da cota√ß√£o que est√° sendo exibida no momento.  <b>CurrentQuoteIndex</b> tamb√©m possui um <b>observador de propriedades</b> para atualizar o conte√∫do do r√≥tulo com uma nova cota√ß√£o quando o √≠ndice for alterado. <br><br>  Agora adicione os seguintes m√©todos: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() currentQuoteIndex = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateQuote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { textLabel.stringValue = <span class="hljs-type"><span class="hljs-type">String</span></span>(describing: quotes[currentQuoteIndex]) }</code> </pre> <br>  Quando a visualiza√ß√£o √© carregada, definimos o √≠ndice de cota√ß√£o como 0, o que, por sua vez, leva a uma atualiza√ß√£o da interface.  <b>updateQuote ()</b> simplesmente atualiza o r√≥tulo do texto para exibir uma cota√ß√£o.  <b>currentQuoteIndex</b> correspondente. <br><br>  Por fim, atualize esses m√©todos com o seguinte c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">previous</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { currentQuoteIndex = (currentQuoteIndex - <span class="hljs-number"><span class="hljs-number">1</span></span> + quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) % quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { currentQuoteIndex = (currentQuoteIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>) % quotes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> } <span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: NSButton)</span></span></span></span> { <span class="hljs-type"><span class="hljs-type">NSApplication</span></span>.shared.terminate(sender) }</code> </pre> <br>  Os m√©todos <b>next ()</b> e <b>previous ()</b> alternam entre todas as cita√ß√µes.  <b>sair</b> fecha o aplicativo. <br><br>  Inicie o aplicativo: <br><br><img src="https://habrastorage.org/webt/wi/qh/ju/wiqhjuzkw5c8f7bmtofythu147k.png"><br><br><h2>  Monitoramento de eventos </h2><br>  H√° mais uma coisa que os usu√°rios esperam do nosso aplicativo: ocultar a janela pop-up quando o usu√°rio clicar em algum lugar fora dela.  Para fazer isso, precisamos de um mecanismo chamado <b>macOS global event monitor</b> . <br><br>  Crie um novo arquivo Swift, chame-o de <b>EventMonitor</b> e substitua seu conte√∫do pelo seguinte c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Cocoa public class EventMonitor { private var monitor: Any? private let mask: NSEvent.EventTypeMask private let handler: (NSEvent?) -&gt; Void public init(mask: NSEvent.EventTypeMask, handler: @escaping (NSEvent?) -&gt; Void) { self.mask = mask self.handler = handler } deinit { stop() } public func start() { monitor = NSEvent.addGlobalMonitorForEvents(matching: mask, handler: handler) } public func stop() { if monitor != nil { NSEvent.removeMonitor(monitor!) monitor = nil } } }</code> </pre> <br>  Ao inicializar uma inst√¢ncia dessa classe, passamos a ela uma m√°scara de evento que iremos ouvir (como pressionamentos de teclas, rolagens da roda do mouse etc.) e um manipulador de eventos. <br>  Quando estivermos prontos para come√ßar a ouvir, <b>start ()</b> chama <b>addGlobalMonitorForEventsMatchingMask (_: handler :)</b> , que retorna o objeto que estamos salvando.  Assim que o evento contido na m√°scara acontece, o sistema chama seu manipulador. <br><br>  Para parar o monitoramento de eventos, <b>removeMonitor</b> <b>()</b> √© chamado em <b>stop ()</b> e exclu√≠mos o objeto, <b>definindo</b> -o como nulo. <br><br>  Tudo o que resta para n√≥s √© chamar <b>start ()</b> e <b>stop ()</b> na hora certa.  A classe tamb√©m chama <b>stop ()</b> no desinicializador para limpar. <br><br><h2>  Conectando o Monitor de Eventos </h2><br>  Abra <b>AppDelegate.swift uma</b> √∫ltima vez e adicione uma nova propriedade: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventMonitor: <span class="hljs-type"><span class="hljs-type">EventMonitor?</span></span></code> </pre> <br>  Em seguida, inclua esse c√≥digo para configurar o <b>monitor de eventos</b> no final do <b>applicationDidFinishLaunching (_ :)</b> <br><br><pre> <code class="swift hljs">eventMonitor = <span class="hljs-type"><span class="hljs-type">EventMonitor</span></span>(mask: [.leftMouseDown, .rightMouseDown]) { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> strongSelf = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, strongSelf.popover.isShown { strongSelf.closePopover(sender: event) } }</code> </pre> <br>  Isso informar√° seu aplicativo quando voc√™ clicar no bot√£o esquerdo ou direito.  Observe: o manipulador n√£o ser√° chamado em resposta aos cliques do mouse dentro do seu aplicativo.  √â por isso que o pop-up n√£o fecha enquanto voc√™ clica dentro dele. <br><br>  Usamos uma refer√™ncia <b>fraca</b> a <b>si pr√≥prio</b> para evitar o perigo de um ciclo de v√≠nculos fortes entre <b>AppDelegate</b> e <b>EventMonitor</b> . <br><br>  Adicione o seguinte c√≥digo no final do m√©todo <b>showPopover (_ :)</b> : <br><br><pre> <code class="swift hljs">eventMonitor?.start()</code> </pre><br>  Aqui come√ßamos a monitorar eventos quando uma janela pop-up aparece. <br><br>  Agora adicione o c√≥digo no final do m√©todo <b>closePopover (_ :)</b> : <br><br><pre> <code class="swift hljs">eventMonitor?.stop()</code> </pre><br>  Aqui terminamos o monitoramento quando o pop-up √© fechado. <br><br>  A aplica√ß√£o est√° pronta! <br><br><h2>  Conclus√£o </h2><br>  <a href="">Aqui</a> voc√™ encontrar√° o c√≥digo completo para este projeto. <br><br>  Voc√™ aprendeu como definir o menu e pop-up no aplicativo localizado na barra de menus.  Por que n√£o experimentar v√°rias tags ou texto formatado para obter uma melhor apar√™ncia das aspas?  Ou conectar um back-end para receber cota√ß√µes da Internet?  Ou voc√™ deseja usar o teclado para navegar entre aspas? <br><br>  Um bom lugar para pesquisar √© a documenta√ß√£o oficial: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NSMenu</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NSPopover</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NSStatusItem</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt447754/">https://habr.com/ru/post/pt447754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt447744/index.html">Escalada Elbrus - Reconhecimento em batalha. Parte t√©cnica 2. Interrup√ß√µes, exce√ß√µes, temporizador do sistema</a></li>
<li><a href="../pt447746/index.html">L√≥gica de neg√≥cios do banco de dados com o SchemaKeeper</a></li>
<li><a href="../pt447748/index.html">Sistemas de arquivos virtuais Linux: por que eles s√£o necess√°rios e como eles funcionam? Parte 2</a></li>
<li><a href="../pt447750/index.html">Novos processadores para data centers - analisamos os an√∫ncios dos √∫ltimos meses</a></li>
<li><a href="../pt447752/index.html">Como fizemos o overclock do CAD COMPASS-3D ‚Üí Parte 3</a></li>
<li><a href="../pt447756/index.html">Novo quadrante da Gartner para solu√ß√µes de monitoramento de aplicativos (APM)</a></li>
<li><a href="../pt447784/index.html">M√∫sica no dia da cosmon√°utica</a></li>
<li><a href="../pt447786/index.html">Antecedentes: Robot Fedor, o que voc√™ √©?</a></li>
<li><a href="../pt447788/index.html">Criamos um agregador de not√≠cias com foco em criptomoedas - intwt.com</a></li>
<li><a href="../pt447790/index.html">Aprendendo a escrever contratos inteligentes do Waves no RIDE e RIDE4DAPPS. Parte 1 (carteira multiusu√°rio)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>