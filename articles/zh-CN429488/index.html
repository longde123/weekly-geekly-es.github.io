<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐊 🍈 🆑 NanoPi Fire3 96核心单板超级计算机 💠 ♋️ 😕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="以不到100英镑（550英镑，包括十二个Fire3）的价格创建具有12个NanoPi-Fire3节点的高性能集群 

 去年，我在Raspberry Pi 3上的最后一个集群引起了公众的极大兴趣，因此我尝试在市场上其他出色的单板计算机上进行类似的项目。 来自中国的FriendlyARM非常慷慨地向我...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>NanoPi Fire3 96核心单板超级计算机</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429488/">  <b>以不到100英镑（550英镑，包括十二个Fire3）的价格创建具有12个NanoPi-Fire3节点的高性能集群</b> <br><br> 去年，我在Raspberry Pi 3上的最后一个集群引起了公众的极大兴趣，因此我尝试在市场上其他出色的单板计算机上进行类似的项目。 来自中国的FriendlyARM非常慷慨地向我发送了12块最新的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">64位ARM NanoPi-Fire3板</a> ，每个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">板</a>均具有<b>八</b>核ARM A53 SoC，工作于1.4 GHz，带有千兆以太网。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f03/00c/337/f0300c3373e6d530f653bb180c64ac0f.jpg" width="500"></div><br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/027/40f/8ae/02740f8ae0c376fdd34d19c64cedd991.jpg" width="500"></div><br><br> 簇的尺寸为146.4（w）×151（h）×216 mm（d），重量为1.67 kg。 <br><br><h1> 要在集群中运行的软件？ </h1><br> 或... <b>为什么需要它？</b> <br><br> 群集通常用于资源密集型任务（医学研究，天气建模，AI /深度学习，加密货币挖掘）和/或高可用性服务（在硬件故障的情况下使用冗余节点）。 从现代超级计算机的角度来看，这个集群当然很慢，但是小型便携式系统非常适合培训或开发分布式软件，然后可以将其转移到功能更强大的系统上。 <br><br> 我计划写几篇文章来评估该集群的挖掘和深度学习。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Docker Swarm</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetes</a>似乎是管理集群的绝佳选择，尽管我还没有尝试过。 <br><br><h1>  NanoPi-Fire3与Raspberry Pi 3 </h1><br> 与树莓派3相比，NanoPi-Fire3在性能和功能方面都更先进，并且外形尺寸更小，同时价格大致相同： <br><br><table><tbody><tr><th></th><th>  NanoPi-Fire3 </th><th>  Raspberry Pi 3模型B </th></tr><tr><td>  <abbr title="片上系统">片上系统</abbr> </td><td> 八核ARM A53 <br>  S5P6818 @ 1.4 GHz </td><td> 四核ARM A53 <br>  BCM2837 @ 1.2 GHz </td></tr><tr><td> 记忆 </td><td>  1 GB DDR3 </td><td>  1 GB DDR2 </td></tr><tr><td> 显卡 </td><td> 马里400 MP4 <br>  500兆赫 </td><td> 博通VideoCore IV <br>  400兆赫 </td></tr><tr><td> 联播网 </td><td>  1000 Mbps的 </td><td>  100 Mbps的 </td></tr><tr><td> 无线上网 </td><td> 没有啦 </td><td>  802.11bgn </td></tr><tr><td> 蓝牙功能 </td><td> 没有啦 </td><td>  4.1 + BLE </td></tr><tr><td> 贮藏 </td><td>  MicroSD卡 </td><td>  MicroSD卡 </td></tr><tr><td>  USB接口 </td><td>  1个连接器 <br>  1个microUSB </td><td>  4个连接器 </td></tr><tr><td> 录影带 </td><td> 微型HDMI 1.4a，RGB-LCD </td><td>  HDMI，DSI </td></tr><tr><td> 摄像头界面 </td><td> 副总裁 </td><td>  CSI </td></tr><tr><td> 音讯 </td><td> 没有啦 </td><td>  3.5毫米 </td></tr><tr><td> 尺码 </td><td>  75×40毫米 </td><td>  85×56毫米 </td></tr><tr><td> 营养学 </td><td>  1.2→3.6瓦 <br> 最大2A，MicroUSB </td><td>  1.2→2.1瓦 <br> 最大2.5A，MicroUSB </td></tr><tr><td> 放行 </td><td>  2017年第四季度 </td><td>  2016年第一季度 </td></tr><tr><td> 价格（英国） </td><td>  £34.30 <sup>1</sup> </td><td>  £33.59 </td></tr><tr><td colspan="3">  <sup>1</sup> Fire3 $ 35 + $ 5运费+ 20％增值税+ 0％进口税=£34.30 </td></tr></tbody></table><img src="https://habrastorage.org/getpro/habr/post_images/d65/928/fa7/d65928fa7fffe412e0c5dbf15bdb1ebd.jpg"><br><img src="https://habrastorage.org/getpro/habr/post_images/7b4/61b/954/7b461b9544c2fe47cd117d1bb3ed1b1f.jpg"><h1> 基准测试 </h1><br><h3> 中央处理器 </h3><br> 大多数现代计算机都具有能够同时执行两个或多个任务的多核处理器。 它可以是不同的应用程序（例如，处理三个网页的Web服务器和一个数据库），也可以是一个任务，该任务被划分为多个线程以实现最大速度（例如，光线跟踪器，文件压缩等）。  <code>hpcc</code>软件包中的此测试使用所有CPU内核，有效地测试了浮点操作中的整体处理器性能。 <br><br><img src="https://habrastorage.org/webt/va/bl/i4/vabli4jp7wxz7hoiar0od_k8tly.png"><br>  <i><font color="gray">Linpack TPP v1.4.1（线性方程式的求解器）。</font></i>  <i><font color="gray">MFLOPS的数量（每秒数百万个浮点操作）</font></i> <br><br>  Fire3主板具有两倍的内核，更高的时钟频率和更快的内存：因此，其结果是Pi 3的<b>6.6倍</b> 。 <br><br>  60,000 MFLOPS-按当前的性能标准来说还不是很多，但是早在2000年，这个由12个Fire3组成的集群将被列入世界上<b>最快的250个超级计算机</b>中（！）。 五个Fire3集群的运行速度比相同大小的Pi 3集群快8.2倍，这可以通过额外的CPU内核，更快的内存和更快的节点间交换数据网络来解释。 <br><br>  16核Cray C90超级计算机于1992年发布，产量为10,780 MFLOPS，但耗资3050万美元，重10.9吨，需要495 kW的功率！ <br><br> 设置集群以获得最大结果是一门完整的技艺：优化编译器，设置数学库等。 但是我们使用默认配置从Ubuntu 16.04.4中的标准<code>hpcc</code>软件包中获取了估算值。 <br><br><div class="spoiler">  <b class="spoiler_title">基准测试的Shell命令</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Setup on each node apt install hpcc swapoff -a adduser mpiuser # Controller node setup su - mpiuser cp /usr/share/doc/hpcc/examples/_hpccinf.txt hpccinf.txt # Edit default hpccinf.txt so that NB=80, N=18560, P=8 and Q=12 (P x Q = 96 cores) sed -i "8s/.*/80\tNBs/; 6s/.*/18560\tNs/; 11s/.*/8\tPs/; 12s/.*/12\tQs/" hpccinf.txt # Generate &amp; copy SSH keys across cluster, so controller can run benchmark on all nodes # (use the hostnames or IP addresses for your nodes) ssh-keygen -t rsa nodes=('controller' 'b1' 'b2' 'b3' 'b4' 'b5' 't1' 't2' 't3' 't4' 't5' 't6') for i in ${nodes[@]} do ssh-copy-id "fire3-$i" echo "fire3-$i slots=8" &gt;&gt; mycluster done mpirun -hostfile mycluster --mca plm_rsh_no_tree_spawn 1 hpcc grep -F -e HPL_Tflops -e PTRANS_GBs -e MPIRandomAccess_GUPs -e MPIFFT_Gflops -e StarSTREAM_Triad -e StarDGEMM_Gflops -e CommWorldProcs -e RandomlyOrderedRingBandwidth_GBytes -e RandomlyOrderedRingLatency_usec hpccoutf.txt</span></span></code> </pre> </div></div><br><h3> 图形 </h3><br>  Fire3和Pi 3都使用四核GPU并行处理计算机图形中的大量数据。 最近，它们还被用于专门的计算，例如加密货币挖掘。 <br><br><img src="https://habrastorage.org/webt/zi/8l/ys/zi8lys-ro-ktaaga3gwiieonlei.png"><br>  <i><font color="gray">glmark2-es2 2014.03（OpenGL ES 2.0）。</font></i>  <i><font color="gray">评分越高越好</font></i> <br><br> 该测试中的Fire3板比Pi 3快<b>7.5倍</b> 。群集结果仅通过节点数进行缩放。 <br><br> 与CPU一样，有许多选项可用于通过使用不同的驱动程序进行编译等来设置图形。 在此测试中，我们仅使用默认配置在Ubuntu 16.04.4上运行了标准glmark2-es2二进制文件。 它使用以下命令启动： <br><br><pre> <code class="bash hljs">sudo apt install glmark2-es2 glmark2-es2 --off-screen</code> </pre> <br>  Pi 3的过时OpenGL渲染功能很弱，但是如果通过<code>rpi-config</code>切换到实验性的Mesa <code>rpi-config</code>渲染，您将获得类似于Fire3的性能。 <br><br> 大多数单板ARM具有相对较旧的GPU，与最新的旗舰智能手机相比，它们的性能非常适中，更不用说具有昂贵的高端图形卡和巨大电源的台式机了。  Fire3中的Mali-400 MP4 GPU可以追溯到2008年，Pi 3中的Broadcom VideoCore-IV可以追溯到2010年。 最近还有几种单板<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">设备</a> ，例如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PINE64</a>的RockPro64，具有更强大和更新的GPU（Mali-T860 MP4），而三星Galaxy S9具有最新一代的Mali-G72 MP18。 <br><br><h3> 联播网 </h3><br> 这些测试验证了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">iPerf中</a>连接到以太网100 / 1000Mpbs交换机的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">两块板之间</a>的实际数据传输速度。 <br><img src="https://habrastorage.org/webt/dt/zr/mc/dtzrmcrbvtakj_hcqtvsmzvmonw.png"><br>  <i><font color="gray">iPerf v2.0.5（TCP，1000Mbps以太网，卡之间），Mbps</font></i> <br><br> 使用默认设置，Fire3上的1000 Mbps接口与Pi 3上的100 Mbps接口相比显示出<b>8.5倍</b>的巨大速度差异。 <br><br><div class="spoiler">  <b class="spoiler_title">基准测试的Shell命令</b> <div class="spoiler_text"><pre> <code class="bash hljs">sudo apt install iperf <span class="hljs-comment"><span class="hljs-comment"># On node1 iperf -s -V # On node2 iperf -c node1 -i 1 -t 20 -V</span></span></code> </pre> </div></div><br> 如果要提高Raspberry Pi（比Pi 3型号B +早）的网络性能，可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">安装一个千兆位USB以太网适配器，</a>而不是标准的内置接口。 它将使速度提高<b>2.8倍</b> ，但是由于USB2的限制，它仍然比实际的1000 Mbps接口慢得多。 该网络接口已集成在最新的Pi 3 B +模型中。 <br><br><h3> 每瓦群集性能 </h3><br> 为了评估每瓦性能，我将MFLOPS中的Linpack测试结果提高了，再除以功耗。 此度量标准通常用于对<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">计算机系统</a>进行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">排名</a> 。 <br><br><img src="https://habrastorage.org/webt/fo/m9/q8/fom9q829loarqz0y7g4ayzsesu4.png"><br>  <i><font color="gray">MFLOPS /瓦</font></i> <br><br> 五节点Fire3群集的能源效率是相同大小的Pi 3群集的<b>5.8倍</b> ，尽管在100％负载下它消耗的功率更多。 <br><br>  <i>在整个集群</i> （包括网络交换机，风扇和电源）的100％负载下测量了功率。  WiFi，蓝牙，HDMI等更多设置保留为默认设置。 <br><br> 上面提到的Cray C90超级计算机在1992年每瓦仅输出0.02 MFLOPS。 <br><br><h1>  3D人体设计 </h1><br> 我在免费版本的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SketchUp中</a>更改了Raspberry Pi集群的原始设计，草绘了粗糙的3D NanoPi-Fire3模板，网络交换机，连接器等。 我决定在模型中不包括通风槽/格栅。 机箱的大小与五个节点的集群完全相同：任务是容纳12个板，风扇和以太网交换机以及所有电缆的数量是原来的两倍！ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/522/877/c09/522877c095c3993a4f9af83025e4d71a.png"></a> <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a96/b14/5a8/a96b145a83d8ff99a42cbedcf1837c0a.png"></a> <br><br>  <b><a href="">下载适用于SketchUp 2013的SKP文件</a></b> <br><br><h1> 激光切割 </h1><br> 我使用免费的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Inkscape</a>程序：它准备将2D模型加载到激光切割机中。 不同的颜色对应不同级别的激光功率/速度。 首先，沿着绿线切割轮廓，并带有用于端口，螺栓和通风的孔。 其他的凹口用粉红色表示，以便于卸下易碎的零件。 然后蚀刻橙色文本和线条，并在面板的最末端沿蓝色轮廓切割。 <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d72/5b9/b00/d725b9b00e3c221b184b398737b6c826.png"></a> <br><br> 您可以下载用于在600×400×3 mm的一张纸上切割的文件，尽管我本人使用透明或黑色纸的不同面板： <br><br><ul><li>  <b><a href="">SVG表</a></b> </li><li>  <b><a href="">DXF工作表</a></b> </li></ul><br> 可选的一小部分是用于（非常明亮！）LED面板的扩散器，可以将其切成亚光的亚克力，或者以三磅的价格购买官方的Pimoroni扩散器。 <br><br> 有关激光切割和无螺纹外壳组装系统的更多信息，请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第一篇文章</a> 。 <br><br><h1> 与Pi 3集群相比的设计更改 </h1><br> 尽管表壳尺寸完全相同，但我进行了许多更改和改进： <br><br><ul><li>  <b>水平安装导轨</b>的设计得以保留，但在Fire3中有M3孔，与Pi中的M2.5相比，此孔更容易找到零件。 而且，孔的位置彼此靠近，因为整体电路板尺寸比Pi小。 将塑料螺母拧紧到水平导轨上有点乏味，我是否想在3D打印机上打印任何塑料夹以沿每个导轨固定电路板，或制作紧的弹性垫圈？ </li><li>  <b>外部电源，而不是内部USB集线器</b> ：我在机箱外部用无风扇交流电源替换了内部USB电源。 这样可以释放内部空间（用于更多Fire3板和两个风扇），并应有助于散热。 每个Fire3最多可拉2A，但实际上，群集的拉力要小得多，而无需考虑USB和GPIO上悬挂的其他外围设备。 </li><li>  <b>用两条microUSB链代替12条单独的电缆</b> ：没有合适的<b>电缆</b>出售，所以我使用更短和更粗的电线（11A额定值）将自己的电缆制成“菊花链”，并焊接了12个microUSB连接器：结果，电缆机箱内部空间很小... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">更多</a> </li><li>  <b>用两个风扇代替一个风扇</b> ：我确定功能更强大的Fire3主板需要更多的主动冷却功能，因此我在机箱上放置了两个92 mm超静音风扇：后风扇将冷空气吸入机箱，而前风扇将热空气吹出。 </li><li>  <b>Gelid Solutions Silent 9风扇代替了Nanoxia Deep Silence</b> ：我对Nanoxia风扇的性能（及其出色的技术支持）感到非常满意，但我想尝试一种更便宜的选择。 胶状橡胶垫圈比Nanoxia厚，所以我将外壳上的安装孔直径增加了0.5 mm。 </li><li>  <b>直接为风扇提供5V电源，而不是通过GPIO提供5V</b> ：在以前的集群中，风扇由其中一块板的GPIO输出供电。 但是考虑到在12V上安装两个风扇，我将升压转换器与机箱的主电源直接相连。 </li><li>  <b>几个通风孔，而不是大量通风孔</b> ：我没有在整个机箱上切割数十个通风孔（这需要时间），而是仅在风扇对面的前后面板上切割孔。 也许这可以优化通过外壳的气流？ </li><li>  <b>机箱上的USB连接器</b> ：这两个集成的USB连接器在我的原始群集中工作正常，但由于长电缆无法正常弯曲，所以我不喜欢它们。 因此，现在我取了两个单独的USB端口，它们的短电缆和连接器呈一定角度，从而在机箱内留出更多空间。 </li><li>  <b>没有用于连接USB集线器的架子</b> ：将电源移至外部简化了外壳的设计，该外壳现在可以从一张600×400 mm的丙烯酸板上切割下来。 卸下架子会降低外壳的刚度，但是如果将水平安装导轨拧到侧板上，则刚度是正常的。 </li><li>  <b>扁平LAN电缆，而不是圆形LAN电缆</b> ：我喜欢RPi3项目提供的多色网络电缆，但是将它们放在机箱内非常困难。 扁平电缆的弯曲容易得多，在如此紧凑的电路板包装中，这一点尤为重要。 最初，我尝试使用25厘米长的电缆，但结果却太长了，但15厘米长的电缆在机箱内留有更多的自由空间。 </li><li>  <b>蓝色的网络电缆，而不是无聊的灰色电缆</b> ：蓝色<i>的确</i>为灰色结构着色...再加上FriendlyARM徽标为蓝色和绿色。 </li><li>  <b>千兆交换机，而不是10千兆交换机</b> ：Fire3具有1000 Mbps网络端口（比Pi快十倍），因此很明显，交换机必须至少为1000 Mbps。  10 GB的交换机将完全消除此地方的瓶颈：因此，十个或更多的Fire3将能够全速与外部网络交换数据。 但是，这种开关仍然很昂贵（200英镑起），而且体积太大。  NETGEAR GS110MX交换机看起来很有希望。 </li><li>  <b>板固定器由4毫米（而不是6毫米）代替</b> ：放下配电盘，我们留出了更多用于布线和换气的空间。 </li><li>  <b>用Micro HDMI代替HDMI</b> ：Fire3板上有Micro HDMI接口，所以我用了最短的Micro HDMI→HDMI电缆（50厘米）。 另一个选择是较短的电缆，带有单独的HDMI→微型HDMI适配器，但它体积大并且会阻塞一个LAN端口。 </li><li>  <b>黑色有机玻璃面板而不是透明面板</b> ：“隐藏”两个风扇，但将所有电子设备放在侧面和俯视图中。 黑色的前面板也引起了Unicorn LED面板的注意。 </li><li>  <b>Unicorn pHAT LED面板而不是板上的简单LED</b> ：群集中有太多节点，因此有必要在机箱的前面板上放置可视状态监控器，以显示每个节点的CPU速度，温度，磁盘和网络活动... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">更多</a> </li></ul><br> 您可以在原始Pi集群中阅读有关某些<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">设计决策的</a>更多信息。 <br><br><a name="3"></a><h1>  MQTT的服务器状态指示器 </h1><br> 我选择了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Pimoroni</a>出色的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Unicorn pHAT 32x RGB LED</a>面板来创建集群的彩色“状态显示”。 它显示每个节点的处理器负载，温度，磁盘和网络活动。 这些低成本板通常直接连接到Raspberry Pi引脚，但是您需要进行一些修补才能将它们连接到另一块板上。 杰里米·加夫（Jeremy Garff）的rpi_ws281x库使用了Raspberry Pi特有的非常智能的低级PWM / DMA代码，因此我将库更改为使用单个SPI引脚来控制LED，该LED几乎可以在任何硬件上工作。 <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/8da/9c5/221/8da9c52219b3fe23e6c9a17a7d9996dd.jpg"></a> <br><br>  Unicorn pHAT仅通过三根线连接到板上：+ 5V，GND和SPI0 MOSI（引脚19）。 在下一篇文章中，我将详细描述这一切的工作方式。  LED非常亮，因此在扩散器后面看起来更好，扩散器通过两个或四个M2.5螺钉固定在外壳的外部。 您可以用哑光丙烯酸切割自己的扩散器，也可以花3英镑购买带有螺丝的Pimoroni模型。 <br><br> 控制器节点上的群集状态由Mosquitto MQTT（消息队列遥测传输）轻量级代理（服务器）控制。 每个节点每秒告诉中介当前的处理器速度，温度，网络活动等。 <br><br><h1> 功率，温度和冷却 </h1><br> 空载情况下，整个系统由十二个Fire3，两个网络交换机和两个7V风扇组成，仅消耗24瓦功率，满载时仅为55瓦功率。 <br><br>  <b>您需要散热器吗？</b>  Fire3 SoC具有两倍于内核的数量，产生的热量比Pi3多得多，因此拥有散热器非常重要。 幸运的是，FriendlyARM提供了一个带有导热油脂的大型散热器，该散热器牢固地安装在Fire3板上。 它比我在市场上看到的其他单板播放器的散热器大得多，它可以完美地降低石头的温度，但风扇仍然不会受伤。 <br><br> 电源适配器最大可提供75 W（在Fire3上为1.1 A），因此外部USB设备（例如硬盘驱动器）很可能需要单独的电源。 我们测量温度： <br><br><pre> <code class="bash hljs">cat /sys/devices/virtual/thermal/thermal_zone0/temp</code> </pre> <br> 我们看到，通过两个12V风扇的冷却，无负载的处理器可加热到39°C。 <br><br> 在风扇负载为100％的情况下，温度达到稳定的58°C： <br><br><pre> <code class="bash hljs">sysbench --<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>=cpu --cpu-max-prime=20000000 --num-threads=8 run &amp;</code> </pre> <br> 如果没有风扇，温度会自动降低时钟频率，从而迅速达到80°C，以避免进一步过热。 处理器可以在此温度下长时间运行，没有任何问题，但是您无法获得最佳性能。 <br><br>  NanoPi Fire2s和Fire2As型号的外壳设计应该完全相同，它们的发热量不如Fire3高，因此一个风扇就足够了。 要冷却一个Fire3，合适的风扇可能要小得多，也许是40-60毫米。 <br><br>  Fire3可以以超低功耗（约5μA）进入睡眠状态，这对于单板计算机而言并不常见，这暗示了有必要降低睡眠状态并将单个节点从睡眠状态中移除的想法。 不幸的是，不支持以太网局域网唤醒，而只有不灵活的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ X分钟后唤醒”</a>设置。 但是，这些板<u>有一个</u> <code>PWR</code>接头连接器。 也许可以将其连接以从控制器上的GPIO引脚远程唤醒？ <br><br><h3> 静音散热 </h3><br> 为了冷却集群，我在机箱中安装了两个92毫米风扇。 我通过对Quietpc.com的评分<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">来</a>搜索<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">最安静的</a>散热器，然后选择Gelid Silent 9，价格为5.40英镑。 <br><br> 要听到至少5V风扇的最小噪音，您需要将耳朵靠近5-7厘米，套件中的橡胶垫可以使外壳免受振动。 但是，在安静的房间中，在12V电压下，风扇的声音非常小（20dBA）。 因此，我一直在寻找一种电压，该电压可以提供足够的散热，但保持安静。 使用升压转换器，我改变了风扇的速度，尝试在5V至12V之间选择电压。 <br><br><table><tbody><tr><th> 粉丝们 </th><th> 散热器？ </th><th> 空载 </th><th>  100％负载 </th><th> 性能表现 </th></tr><tr><td> 后12V，1500 rpm </td><td> 是的 </td><td>  42°摄氏度 </td><td>  66°摄氏度 </td><td> 好啦 </td></tr><tr><td> 后9V ，？ 转数 </td><td> 是的 </td><td>  44°摄氏度 </td><td>  71°摄氏度 </td><td> 好啦 </td></tr><tr><td> 后7V，？ 转数 </td><td> 是的 </td><td>  46°摄氏度 </td><td>  75°摄氏度 </td><td> 降低频率 </td></tr><tr><td> 均为12V，1500 rpm </td><td> 是的 </td><td>  39°摄氏度 </td><td>  58°摄氏度 </td><td> 好啦 </td></tr><tr><td> 都是7V ，？ 转数 </td><td> 是的 </td><td>  40度 </td><td>  65°摄氏度 </td><td> 好啦 </td></tr><tr><td> 都是5V吗？ 转数 </td><td> 是的 </td><td>  46°摄氏度 </td><td>  77°摄氏度 </td><td> 降低频率 </td></tr></tbody></table>  <i>（这是不同节点的平均温度，即平均为71°C，实际上，两块板接近紧急频率降低）。</i> <br><br> 我很惊讶第二个风扇并没有特别影响结果，最后仍然需要在9V的一个风扇或7V的两个风扇之间进行选择，而第二个选项则更凉爽，更安静。 我认为第二个风扇在更大的外壳和/或更复杂的气流路径中更重要？ <br><br><a name="1"></a><h3> 电源线：五件式佐贺 </h3><br> 最困难的事情是找到一个好的解决方案，为12个节点，两个以太网交换机和两个风扇供电。 我试图避免大量焊接和自制电缆... <br><br><ol><li>  Fire3通过像Pi一样的microUSB供电，但是我没有找到12端口15A USB集线器。 我当时正在考虑一个带有六个双面microUSB分配器的6端口集线器，或者甚至是两个单独的6端口USB集线器。 但是第一个选项无法为12个节点提供足够的电源，第二个选项占用了机箱内部太多的空间。 </li><li> 在使用外部“砖”作为交流电源的情况下，我尝试了一些标准的8x和6x分离器。 这些电缆是专为带有倾斜的microUSB→DC连接器的监控摄像机而设计的，但是它们占用的空间很大（不利于空气流通），并且无法通过电流进行额定，这会导致每个Fire3板上的电压降。 </li><li> 如果您使用钢制底盘导轨作为5V + GND的导体？   <i></i> ,  :       0,5        .     ,         ,          .. </li><li> <i> ?</i>   -      12   microUSB?   Fire3    5V+GND,    UART.                    DuPont  microUSB.       ,   ,              …           . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我制作了一条自制的电源线链（菊花链），取一根厚度为0.5毫米（11A，长度为6节）的两芯电缆，并将其焊接到有角的microUSB连接器上。</font><font style="vertical-align: inherit;">事实证明，电缆非常细小，并且电缆在机壳内部的空间很小，从而提供了出色的气流。</font><font style="vertical-align: inherit;">两个电源电路通过单独的插座通过单独的插座离开外壳，以限制通过一个DC连接器的最大电流。</font><font style="vertical-align: inherit;">这也意味着您只能根据</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含</font><font style="vertical-align: inherit;">集群的上半部分或下半部分。</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 两个以太网交换机也都由5V供电，焊接了圆形DC连接器。 </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 建立一个Fire3集群 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构建过程类似于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NanoPC-T3上</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">40核ARM群集</font></a><font style="vertical-align: inherit;">，仅具有更多节点，一个额外的网络交换机和一个风扇。</font><font style="vertical-align: inherit;">Fire3板沿着带有M3螺纹的导轨放置在20毫米的距离处，每个板都用八个螺母固定。</font><font style="vertical-align: inherit;">为了美观，我将5V至12V升压转换器板粘贴到了机箱的背面，并添加了引脚以轻松地打开和关闭风扇。</font><font style="vertical-align: inherit;">某些电缆通过小束线带进行布线和固定。</font><font style="vertical-align: inherit;">显示Pimoroni LED通过三个销GPIO ...连接到控制器板</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">的详细信息</font></a><font style="vertical-align: inherit;">。</font></font><br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/06f/8f9/bcf/06f8f9bcf8636cf6e38531cc421ef348.jpg"></a> <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/0ca/424/1b7/0ca4241b7cbcc10f3f75dae9cf5f900f.jpg"></a> <br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f17/544/f25/f17544f25ee11ea956e2cd2c05b9fd90.jpg"></a> <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/68f/56f/495/68f56f4953dd1383322bb192935cb996.jpg"></a> <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 材料清单 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数物品都来自速卖通或eBay上的不同卖家，这大大增加了邮费。</font><font style="vertical-align: inherit;">如果对集群有足够的需求，则批量购买零件会便宜一些。</font></font><br><br><table><tbody><tr><td>  Edimax ES-5800G V3 Gigabit Ethernet (2 .) </td><td> £19,96 </td></tr><tr><td>   15  Cat6 LAN (12 .) </td><td> £6,79 </td></tr><tr><td>   M3 12  (8  10 ) </td><td> £1,45 </td></tr><tr><td>   M3 4  (8  50 .) </td><td> £0,99 </td></tr><tr><td> 5,5/2,1  DC  (2  5 .) </td><td> £1,49 </td></tr><tr><td> 1    + </td><td> n/a </td></tr><tr><td> 1  2- 0,5    (11A) DC </td><td> £0,99 </td></tr><tr><td>   microUSB   (12  20 .) </td><td> £1,63 </td></tr><tr><td> 5,5/2,1mm  DC     (2  10 .) </td><td> £0,65 </td></tr><tr><td>   10A (4  12) </td><td> £1,29 </td></tr><tr><td>  100  (5  @ 20 )  , 5,5/2,1  +  UK </td><td> £13,51 </td></tr><tr><td>  RJ45   «-» (2 .) </td><td> £1,74 </td></tr><tr><td>   M3 8  (4  5) </td><td> £1,25 </td></tr><tr><td>     M3 150      (8 .) </td><td> £9,20 </td></tr><tr><td>    M3 (120  150) </td><td> £1,73 </td></tr><tr><td> Micro HDMI «»  HDMI «»   50  </td><td> £2,19 </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> USB“母亲”到“父亲”面板安装角25厘米（2个） </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> £2.38 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3毫米透明有机玻璃600×400毫米 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> £5.32 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5V至12V升压转换器 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> £2.04 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 激光切割机充电 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 不适用 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 92毫米Gelid Silent 9风扇（2个） </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> £11.65 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 聚氨酯橡胶脚（10之4） </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> £1.75 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 独角兽pHAT 32x RGB LED面板 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> £10.00 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 黑色螺钉M2.5 10毫米（2-4之20） </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> £1.02 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 小型束线带（10个） </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 不适用 </font></font></td></tr><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 总材料 </font></font></th><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">£97.73</font></font></b> </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NanoPi-Fire3只需$ 35（12个）</font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> £383.38 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> microSDHC卡SanDisk工业级10 8 GB（12个） </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> £62.16 </font></font></td></tr><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 合计 </font></font></th><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">£543.27</font></font></b> </td></tr></tbody></table> <sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NanoPi-Fire3可以免税进口到英国，而从中国发货12块板的成本仅为29美元，但考虑到20％的英国增值税，您将获得383.38英镑。</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 来自其他单板计算机的集群 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 到目前为止，我还构建了： </font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    Raspberry Pi 3</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">40- ARM-  NanoPC-T3</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">   Orange Pi Plus 2e</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">    PINE A64+</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ClusterHAT   Raspberry Pi Zero</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN429488/">https://habr.com/ru/post/zh-CN429488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN429474/index.html">274号移动开发人员的有趣材料摘要（11月5日至11日）</a></li>
<li><a href="../zh-CN429478/index.html">游戏设计：难度级别的新方法</a></li>
<li><a href="../zh-CN429482/index.html">在此过程中代表所有参与者访问个人数据的问题</a></li>
<li><a href="../zh-CN429484/index.html">再谈一次采访，但在国外</a></li>
<li><a href="../zh-CN429486/index.html">JunOS：防止MP-BGP重置会话</a></li>
<li><a href="../zh-CN429490/index.html">没有严格的时间表的时间管理，开发移动应用程序的经验</a></li>
<li><a href="../zh-CN429494/index.html">达加兹：详细信息</a></li>
<li><a href="../zh-CN429496/index.html">自制光剑激光：如何。 第二部分</a></li>
<li><a href="../zh-CN429498/index.html">拖延的4个原因（文字）</a></li>
<li><a href="../zh-CN429500/index.html">“做生意的时间”终于飞逝</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>