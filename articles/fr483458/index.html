<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ŒğŸ¾ ğŸ’†ğŸ¾ ğŸ¬ Assistant de base de donnÃ©es GreenPig ğŸ˜¶ ğŸ¤ğŸ¿ ğŸ¤§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. EntrÃ©e 
2. Connexion Ã  la bibliothÃ¨que 
3. OÃ¹ classe Partie atomique de la demande RequÃªtes compliquÃ©es 
4. Partie atomique de la demande 
5. RequÃª...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Assistant de base de donnÃ©es GreenPig</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483458/"><ol><li>  <a href="https://habr.com/ru/post/483458/">EntrÃ©e</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Connexion Ã  la bibliothÃ¨que</a> </li><li>  <a href="https://habr.com/ru/post/483458/">OÃ¹ classe</a> <br><ul><li>  <a href="https://habr.com/ru/post/483458/">Partie atomique de la demande</a> </li><li>  <a href="https://habr.com/ru/post/483458/">RequÃªtes compliquÃ©es</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/483458/">Rejoignez la classe</a> </li><li>  <a href="https://habr.com/ru/post/483458/">RequÃªte de classe</a> <br><ul><li>  <a href="https://habr.com/ru/post/483458/">SÃ©lection Ã  partir d'une base de donnÃ©es avec des paramÃ¨tres imbriquÃ©s</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Union multiple avec vous-mÃªme au nom de la recherche</a> </li></ul></li></ol><br><pre><code class="sql hljs">â•”â•â•â•â•—â•”â•â•â•â•—â•”â•â•â•â•—â•”â•â•â•â•—â•”â•—â”€â•”â•—â”€â”€â”€â”€â•”â•â•â•â•—â•”â•â•â•—â•”â•â•â•â•— â•‘â•”â•â•â•â•‘â•”â•â•—â•‘â•‘â•”â•â•â•â•‘â•”â•â•â•â•‘â•šâ•â•â•‘â”€â”€â”€â”€â•‘â•”â•â•—â•‘â•šâ•—â•”â•â•‘â•”â•â•â• â•‘â•‘â•”â•â•—â•‘â•šâ•â•â•‘â•‘â•šâ•â•â•—â•‘â•šâ•â•â•—â•‘â•”â•—â”€â•‘â”€â”€â”€â”€â•‘â•šâ•â•â•‘â”€â•‘â•‘â”€â•‘â•‘â•”â•â•— â•‘â•‘â•šâ•—â•‘â•‘â•”â•—â•”â•â•‘â•”â•â•â•â•‘â•”â•â•â•â•‘â•‘â•šâ•—â•‘â”€â”€â”€â”€â•‘â•”â•â•â•â”€â•‘â•‘â”€â•‘â•‘â•šâ•—â•‘ â•‘â•šâ•â•â•‘â•‘â•‘â•‘â•‘â”€â•‘â•šâ•â•â•—â•‘â•šâ•â•â•—â•‘â•‘â”€â•‘â•‘â”€â”€â”€â”€â•‘â•‘â”€â”€â”€â•”â•â•šâ•—â•‘â•šâ•â•â•‘ â•šâ•â•â•â•â•šâ•â•šâ•â”€â•šâ•â•â•â•â•šâ•â•â•â•â•šâ•â”€â•šâ•â”€â”€â”€â”€â•šâ•â”€â”€â”€â•šâ•â•â•â•šâ•â•â•â• 5HHHG HH HHHHHHH 9HHHA HHHHHHHH5 HHHHHHHHHHHHHHHHHH 9HHHHH5 5HHHHHHHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHHHHHHHHH ;HHHHHHHHHHHHHHHHHHHHHHHHHHA H2 HHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHHHH9 HHHHHHHHHHHHHHHHHHHHHHH AHHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHH9 iHS HHHHHHHHHHHHHHHHHHHHHHhh HHHHHHHHHHHHHHHHHH AA HHHHHHHHHHHHHH3 &amp;H Hi HS Hr &amp; H&amp; H&amp; Hi</code> </pre> <a name="habracut"></a><br><h2 id="entry">  EntrÃ©e </h2><br><p>  Je veux vous parler du dÃ©veloppement de ma petite bibliothÃ¨que en php.  Quelles tÃ¢ches rÃ©sout-elle?  Pourquoi ai-je dÃ©cidÃ© de l'Ã©crire et pourquoi pourrait-il vous Ãªtre utile?  Essayez bien de rÃ©pondre Ã  ces questions. </p><br><p>  <strong>GreenPig</strong> (ci-aprÃ¨s <strong>GP</strong> ) est un petit assistant de base de donnÃ©es qui peut complÃ©ter les fonctionnalitÃ©s de n'importe quel framework php que vous utilisez. </p><br><p>  Comme tout outil <strong>GP</strong> , il est affinÃ© pour rÃ©soudre certains problÃ¨mes.  Il vous sera utile si vous prÃ©fÃ©rez Ã©crire des requÃªtes de base de donnÃ©es en SQL pur et que vous n'utilisez pas Active record et d'autres technologies similaires.  Par exemple, nous avons une base de donnÃ©es Oracle au travail et souvent les requÃªtes occupent plusieurs Ã©crans avec des dizaines de jointures, les fonctions plsql, union all, etc. sont toujours utilisÃ©es.  etc., donc il ne reste plus qu'Ã  Ã©crire des requÃªtes en SQL pur. </p><br><p>  Mais avec cette approche, la question se pose: comment gÃ©nÃ©rer oÃ¹ la partie de la requÃªte SQL lorsque les utilisateurs recherchent des informations?  <strong>GP</strong> vise, tout d'abord, une compilation pratique au moyen de php oÃ¹ d'une demande de toute complexitÃ©. </p><br><p>  Mais qu'est-ce qui m'a poussÃ© Ã  Ã©crire cette bibliothÃ¨que (sauf, bien sÃ»r, pour acquÃ©rir une expÃ©rience intÃ©ressante)?  Ce sont trois choses: </p><br><p>  PremiÃ¨rement, la nÃ©cessitÃ© d'obtenir non pas une rÃ©ponse plate standard de la base de donnÃ©es, mais un tableau imbriquÃ© semblable Ã  un arbre. </p><br><div class="spoiler">  <b class="spoiler_title">Voici un exemple d'un exemple de base de donnÃ©es standard:</b> <div class="spoiler_text"><pre> <code class="php hljs">[ [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ], [<span class="hljs-number"><span class="hljs-number">3</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">4</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">5</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">6</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">7</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">8</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">9</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">10</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">11</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">12</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">13</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">14</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ], [<span class="hljs-number"><span class="hljs-number">15</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">16</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">17</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ] ]</code> </pre> </div></div><br><p>  Pour obtenir un tableau arborescent, nous devons soit apporter le rÃ©sultat Ã  la forme souhaitÃ©e nous-mÃªmes, soit effectuer N requÃªtes de base de donnÃ©es pour chaque produit.  Et si nous avons besoin de pagination, et mÃªme de tri?  <strong>GP</strong> est capable de rÃ©soudre ces problÃ¨mes.  Voici un exemple d'Ã©chantillon avec <strong>GP</strong> : </p><br><pre> <code class="php hljs">[ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'prod_type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'properties'</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ] [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ] [<span class="hljs-number"><span class="hljs-number">3</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ] ] ] [<span class="hljs-number"><span class="hljs-number">4</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'prod_type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'properties'</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">10</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ] [<span class="hljs-number"><span class="hljs-number">8</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ] [<span class="hljs-number"><span class="hljs-number">9</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ] ] ] ]</code> </pre> <br><p>  Et bien sÃ»r, en mÃªme temps, une pagination et un tri pratiques: <code>-&gt;pagination(1, 10)-&gt;sort('id')</code> . </p><br><p>  La deuxiÃ¨me raison n'est pas si frÃ©quente, mais nÃ©anmoins elle se produit (et dans mon cas, c'est la raison principale).  Si certaines entitÃ©s sont stockÃ©es dans la base de donnÃ©es et que les propriÃ©tÃ©s de ces entitÃ©s sont dynamiques et dÃ©finies par les utilisateurs, alors lorsque vous devez rechercher des entitÃ©s par leurs propriÃ©tÃ©s, vous devrez ajouter (joindre) la mÃªme table avec les valeurs de propriÃ©tÃ© (autant de fois qu'elles sont utilisÃ©es). propriÃ©tÃ©s lors de la recherche).  Le GP vous aidera donc Ã  connecter toutes les tables et Ã  gÃ©nÃ©rer la requÃªte where avec presque une fonction.  Vers la fin de l'article, j'analyserai ce cas en dÃ©tail. </p><br><p>  Et enfin, tout cela devrait fonctionner Ã  la fois pour la base de donnÃ©es Oracle et pour mySql.  Il existe Ã©galement un certain nombre de fonctionnalitÃ©s dÃ©crites dans la documentation. </p><br><p>  Il est possible que j'aie inventÃ© un autre vÃ©lo, mais j'ai consciencieusement cherchÃ© et je n'ai pas trouvÃ© de solution qui me convienne.  Si vous connaissez une bibliothÃ¨que qui rÃ©sout ces problÃ¨mes - veuillez Ã©crire dans les commentaires. </p><br><p>  Avant de passer directement Ã  un examen de la bibliothÃ¨que elle-mÃªme et Ã  des exemples, je dirai qu'il n'y aura que l'essentiel, sans explications dÃ©taillÃ©es.  Si vous vous intÃ©ressez au fonctionnement du <strong>GP</strong> , vous pouvez consulter la <a href="https://falbin.ru/documentation/greenpig">documentation</a> , j'ai essayÃ© de tout expliquer en dÃ©tail. </p><br><h2 id="libraryconnection">  Connexion Ã  la bibliothÃ¨que </h2><br><p>  La bibliothÃ¨que peut Ãªtre installÃ©e via le compositeur: le <code>composer require falbin/green-pig-dao</code> </p><br><p>  Ensuite, vous devez Ã©crire une usine Ã  travers laquelle vous utiliserez cette bibliothÃ¨que. </p><br><h2 id="where">  OÃ¹ classe </h2><br><p>  En utilisant cette classe, vous pouvez composer la partie where de la requÃªte sql de n'importe quelle complexitÃ©. </p><br><h3 id="partrequest">  Partie atomique de la demande </h3><br><p>  ConsidÃ©rez la plus petite partie atomique d'une requÃªte.  Il est dÃ©crit par un tableau: <code>[, , ]</code> <br>  Exemple: <code>['name', 'like', '%%']</code> </p><br><ul><li>  <strong>Le premier Ã©lÃ©ment du</strong> tableau est juste une chaÃ®ne, insÃ©rÃ©e dans la requÃªte sql sans modifications, et, par consÃ©quent, vous pouvez y Ã©crire des fonctions sql.  Exemple: <code>['LOWER(name)', 'like', '%%']</code> </li><li>  <strong>Le deuxiÃ¨me Ã©lÃ©ment</strong> est Ã©galement une chaÃ®ne insÃ©rÃ©e dans sql sans changement entre deux opÃ©randes.  Il peut prendre les valeurs suivantes: <em>=,&gt;, &lt;,&gt; =, &lt;=, &lt;&gt;, comme, pas comme, entre, pas entre, dans, pas dans</em> . </li><li>  <strong>Le troisiÃ¨me Ã©lÃ©ment du</strong> tableau peut Ãªtre de type numÃ©rique ou chaÃ®ne.  OÃ¹ la classe remplacera automatiquement l'alias gÃ©nÃ©rÃ© dans la requÃªte SQL. </li><li>  <strong>Ã‰lÃ©ment de tableau avec clÃ© sql.</strong>  Parfois, il est nÃ©cessaire que la valeur soit insÃ©rÃ©e dans le code SQL sans modifications.  Par exemple, pour appliquer des fonctions.  Ceci peut Ãªtre rÃ©alisÃ© en spÃ©cifiant 'sql' comme clÃ© (pour le 3Ã¨me Ã©lÃ©ment).  Exemple: <code>['LOWER(name)', 'like', 'sql' =&gt; "LOWER('$name')"]</code> </li><li>  <strong>Un Ã©lÃ©ment de tableau avec la clÃ© de liaison</strong> est un tableau pour stocker des liaisons.  L'exemple ci-dessus est faux du point de vue de la sÃ©curitÃ©.  Vous ne pouvez pas insÃ©rer de variables dans SQL - c'est trop d'injection.  Par consÃ©quent, dans ce cas, vous devrez spÃ©cifier vous-mÃªme des alias, par exemple comme ceci: <code>['LOWER(name)', 'like', 'sql' =&gt; "LOWER(:name)", 'bind'=&gt; ['name' =&gt; $name] ]</code> </li><li>  <strong>L'opÃ©rateur in</strong> peut s'Ã©crire comme ceci: <code>['curse', 'not in', [1, 3, 5]]</code> .  La classe Where convertit une telle entrÃ©e dans le code SQL suivant: <code>curse not in (:al_where_jCgWfr95kh, :al_where_mCqefr95kh, :al_where_jCfgfr9Gkh)</code> </li><li>  <strong>L'instruction entre</strong> peut Ãªtre Ã©crite comme ceci: <code>['curse', ' between', 1, 5]</code> .  La classe Where convertit une telle entrÃ©e dans le code SQL suivant: <code>curse between :al_where_Pi4CRr4xNn and :al_where_WiPPS4NKiG</code> <br>  Mais attention, si les troisiÃ¨me et quatriÃ¨me Ã©lÃ©ments du tableau sont des chaÃ®nes, une logique spÃ©ciale est appliquÃ©e.  Dans ce cas, on pense que la sÃ©lection est Ã  partir d'une plage de dates et, par consÃ©quent, la fonction sql de transtyper une chaÃ®ne en une date est utilisÃ©e.  La fonction de conversion en une date (mySql et Oracle en ont diffÃ©rentes) et ses paramÃ¨tres sont tirÃ©s d'un tableau de paramÃ¨tres (plus dans la documentation).  Le tableau <code>['build_date', 'between', '01.01.2016', '01.01.2019']</code> sera converti en sql: <code>build_date between TO_DATE(:al_where_fkD7nZg5lU, 'dd.mm.yyyy hh24:mi::ss') and TO_DATE(:al_where_LdyVRznPF8, 'dd.mm.yyyy hh24:mi::ss')</code> </li></ul><br><h3 id="complicatedqueries">  RequÃªtes compliquÃ©es </h3><br><p>  CrÃ©ons une instance de la classe via la fabrique: <code>$wh = GP::where();</code> </p><br><p>  Pour indiquer la connexion logique entre les "parties atomiques" de la demande, vous devez utiliser les fonctions <code>linkAnd()</code> ou <code>linkOr()</code> .  Un exemple: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// sql: (old &gt; 18 and old &lt; 50) $wh-&gt;linkAnd([ ['old', '&lt;', 18], ['old', '&gt;', 50] ]); // sql: (old &lt; 18 or old &gt; 50) $wh-&gt;linkOr([ ['old', '&lt;', 18], ['old', '&gt;', 50] ]);</span></span></code> </pre> <br><p>  Lorsque vous utilisez les fonctions <strong>linkAnd / linkOr,</strong> toutes les donnÃ©es sont stockÃ©es dans une instance de la classe Where - $ wh.  De plus, toutes les Â«parties atomiquesÂ» indiquÃ©es dans la fonction <strong>sont entre crochets</strong> . </p><br><p>  Un SQL de toute complexitÃ© peut Ãªtre dÃ©crit par trois fonctions: <code>linkAnd(), linkOr(), getRaw()</code> .  Prenons un exemple: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// sql: curse = 1 and (old &lt; 18 or old &gt; 50) $wh-&gt;linkAnd([ ['curse', '=', 1], $wh-&gt;linkOr([ ['old', '&lt;', 18], ['old', '&gt;', 50] ])-&gt;getRaw() ]);</span></span></code> </pre> <br><p>  La classe Where a une variable privÃ©e qui stocke l'expression brute.  Les <code>linkAnd()</code> et <code>linkOr()</code> cette variable, par consÃ©quent, lors de la construction d'une expression logique, les mÃ©thodes sont imbriquÃ©es ensemble et la variable avec l'expression brute contient des donnÃ©es obtenues Ã  partir de la derniÃ¨re mÃ©thode exÃ©cutÃ©e. </p><br><h2 id="join">  Rejoindre la classe </h2><br><p>  <strong>Join</strong> est une classe qui gÃ©nÃ¨re un fragment de jointure de code SQL.  CrÃ©ons une instance de la classe via l'usine: <code>$jn = GP::leftJoin('coursework', 'student_id', 's.id')</code> , oÃ¹: </p><br><ul><li>  <strong>les cours</strong> sont la table que nous allons rejoindre. </li><li>  <strong>student_id</strong> - une colonne avec une clÃ© Ã©trangÃ¨re de la table des <strong>cours</strong> . </li><li>  <strong>s.id</strong> - la colonne de la table avec laquelle join doit Ãªtre Ã©crite avec l'alias de la table (dans ce cas, l'alias de la table est s). </li></ul><br><p>  SQL gÃ©nÃ©rÃ©: <code>left JOIN coursework coursework_joM9YuTTfW ON coursework_joM9YuTTfW.student_id = s.id</code> </p><br><p>  Lors de la crÃ©ation d'une instance de la classe, nous avons dÃ©jÃ  dÃ©crit la condition pour joindre des tables, mais il peut Ãªtre nÃ©cessaire de clarifier et d'Ã©tendre la condition.  Les fonctions <strong>linkAnd / linkOr</strong> vous aideront Ã  faire ceci: <code>$jn-&gt;linkAnd(['semester_number', '&gt;', 2])</code> </p><br><p>  SQL gÃ©nÃ©rÃ©: <code>inner JOIN coursework coursework_Nd1n5T7c0r ON coursework_Nd1n5T7c0r.student_id = s.id and (semester_number &gt; :al_where_M1kEcHzZyy)</code> </p><br><p>  S'il y a plusieurs tables Ã  joindre, vous pouvez les combiner dans une classe: <strong>CollectionJoin</strong> . </p><br><h2 id="query">  RequÃªte de classe </h2><br><p>  C'est la classe principale pour travailler avec la base de donnÃ©es, Ã  travers elle il y a une sÃ©lection, un enregistrement, une mise Ã  jour et une suppression des donnÃ©es.  Vous pouvez Ã©galement effectuer certains traitements de donnÃ©es obtenues Ã  partir de la base de donnÃ©es. </p><br><p>  Prenons un exemple typique. </p><br><p>  CrÃ©ons une instance de la classe via la fabrique: <code>$qr = GP::query();</code> </p><br><p>  Maintenant, nous allons dÃ©finir le modÃ¨le sql, remplacer les valeurs nÃ©cessaires pour le scÃ©nario donnÃ© dans le modÃ¨le sql et dire que nous voulons obtenir un enregistrement, et en particulier les donnÃ©es de la colonne <strong>average_mark</strong> . </p><br><pre> <code class="php hljs">$rez = $qr-&gt;sql(<span class="hljs-string"><span class="hljs-string">"select /*select*/ from student s inner join mark m on s.id = m.student_id inner join lesson l on l.id = m.lesson_id /*where*/ /*group*/"</span></span>) -&gt;sqlPart(<span class="hljs-string"><span class="hljs-string">'/*select*/'</span></span>, <span class="hljs-string"><span class="hljs-string">'s.name, avg(m.mark) average_mark'</span></span>, []) -&gt;whereAnd(<span class="hljs-string"><span class="hljs-string">'/*where*/'</span></span>, [<span class="hljs-string"><span class="hljs-string">'s.id'</span></span>, <span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) -&gt;sqlPart(<span class="hljs-string"><span class="hljs-string">'/*group*/'</span></span>, <span class="hljs-string"><span class="hljs-string">'group by s.name'</span></span>, []) -&gt;one(<span class="hljs-string"><span class="hljs-string">'average_mark'</span></span>);</code> </pre> <br><p>  RÃ©sultat: <code>3,16666666666666666666666666666666666667</code> </p><br><h3 id="selection">  SÃ©lection Ã  partir d'une base de donnÃ©es avec des paramÃ¨tres imbriquÃ©s </h3><br><p>  Surtout, je n'ai pas eu l'occasion d'obtenir une sÃ©lection de la base de donnÃ©es dans une arborescence, avec des propriÃ©tÃ©s attachÃ©es.  Par consÃ©quent, la bibliothÃ¨que GP a une telle opportunitÃ© et la profondeur d'imbrication n'est pas limitÃ©e. </p><br><p>  La maniÃ¨re la plus simple de considÃ©rer le principe de fonctionnement est basÃ©e sur un exemple.  Pour examen, nous prenons le <strong>schÃ©ma de base de donnÃ©es</strong> suivant <strong>:</strong> </p><br><p><img src="https://habrastorage.org/webt/tt/ih/_o/ttih_oflaq8cvslm1yiutxabp8q.png"></p><br><p>  <strong>Contenu du tableau:</strong> </p><br><p><img src="https://habrastorage.org/webt/z4/v4/aa/z4v4aa7oci4w-9q7nrncht1tceu.png"></p><br><p>  Souvent, lorsque vous interrogez une base de donnÃ©es, vous souhaitez obtenir une rÃ©ponse arborescente et non plate.  Par exemple, en exÃ©cutant cette requÃªte: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> s.id, s.name, c.id title_id, c.title <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> student s <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> coursework c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c. student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> s.id = <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Nous obtenons un rÃ©sultat plat: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Â«Â»    '</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span>=&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span> ] ]</code> </pre> <br><p>  En utilisant GP, vous pouvez obtenir ce rÃ©sultat: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Â«Â»    '</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>] ] ] ]</code> </pre> <br><p>  Pour obtenir ce rÃ©sultat, vous devez passer un tableau avec des options Ã  la fonction <code>all</code> (la fonction renvoie toutes les lignes de requÃªte): </p><br><pre> <code class="php hljs">all([ <span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span> ] ])</code> </pre> <br><p>  Le tableau <code>$option</code> dans l' <strong>agrÃ©gateur de</strong> fonctions <strong>( <code>$option</code> , $ rawData)</strong> et <strong>all ( <code>$options</code> )</strong> est construit selon les rÃ¨gles suivantes: </p><br><ul><li>  <strong>ClÃ©s de tableau</strong> - noms de colonnes.  <strong>Ã‰lÃ©ments de tableau</strong> - nouveaux noms pour les colonnes, vous pouvez entrer l'ancien nom. </li><li>  Il y a un mot rÃ©servÃ© pour les valeurs du tableau - <code>pk</code> .  Il indique que les donnÃ©es seront regroupÃ©es par cette colonne (la clÃ© du tableau est le nom de la colonne). </li><li>  Ã€ chaque niveau, il ne devrait y avoir qu'un seul <code>pk</code> . </li><li>  Dans le tableau agrÃ©gÃ© (rÃ©sultant), les valeurs de la colonne dÃ©clarÃ©e par <code>pk</code> seront utilisÃ©es comme clÃ©s. </li><li>  S'il est nÃ©cessaire de placer une partie des colonnes Ã  un niveau infÃ©rieur, un nouveau nom inventÃ© est utilisÃ© comme clÃ© de tableau, et un tableau construit selon les rÃ¨gles dÃ©crites ci-dessus sera utilisÃ© comme valeur. </li></ul><br><p>  Prenons un exemple plus complexe.  Supposons que nous devions obtenir tous les Ã©tudiants avec le nom de leur cours et avec toutes les notes dans toutes les matiÃ¨res.  Nous aimerions le recevoir non pas sous une forme plate, mais sous forme d'arbre, sans doublons.  Vous trouverez ci-dessous la requÃªte souhaitÃ©e dans la base de donnÃ©es et le rÃ©sultat. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> s.id student_id, s.name student_name, s.semester_number, c.id coursework_id, c.semester_number coursework_semester, c.title coursework_title, l.id lesson_id, l.name lesson, m.id mark_id, m.mark <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> student s <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> coursework c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> mark m <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> m.student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> lesson l <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.id = m.lesson_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> s.id, c.id, l.id, m.id</code> </pre> <br><p>  Le rÃ©sultat ne nous convient pas: </p><br><p><img src="https://habrastorage.org/webt/er/mj/7p/ermj7p5zki1g4hfxausavajfcps.png"></p><br><p>  Pour rÃ©aliser la tÃ¢che, vous devez Ã©crire le tableau <code>$option</code> suivant: </p><br><pre> <code class="php hljs">$option = [ <span class="hljs-string"><span class="hljs-string">'student_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'student_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'coursework_semester'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'coursework_title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span> ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'lesson'</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'mark_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mark'</span></span> ] ] ];</code> </pre> <br><p>  RequÃªte de base de donnÃ©es: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//    Query   .       // (    yii2) $qr = Yii::$app-&gt;gp-&gt;query( "SELECT s.id student_id, s.name student_name, s.semester_number, c.id coursework_id, c.semester_number coursework_semester, c.title coursework_title, l.id lesson_id, l.name lesson, m.id mark_id, m.mark FROM student s LEFT JOIN coursework c ON c.student_id = s.id LEFT JOIN mark m ON m.student_id = s.id LEFT JOIN lesson l ON l.id = m.lesson_id ORDER BY s.id, c.id, l.id, m.id"); //   1,  2   3  //  1 $result = $qr-&gt;all($option); //  2 $result = $qr-&gt;aggregator($option, $qr-&gt;all()); //  3 $qr-&gt;all(); $result = $qr-&gt;aggregator($option, $qr-&gt;rawData());</span></span></code> </pre> <br><p>  La fonction d' <code>aggregator</code> peut traiter n'importe quel tableau avec une structure similaire au rÃ©sultat d'une requÃªte de base de donnÃ©es, selon les rÃ¨gles dÃ©crites dans l' <code>$option</code> . </p><br><p>  La variable <code>$result</code> contient les donnÃ©es suivantes: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'    '</span></span>], ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Â«Â»    '</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>] ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">17</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">18</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">20</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">16</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">19</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>] ] ], ] ] ]</code> </pre> <br><p>  Soit dit en passant, avec la pagination avec une requÃªte agrÃ©gÃ©e, seules les donnÃ©es les plus Ã©lÃ©mentaires sont prises en compte.  Dans l'exemple ci-dessus, il n'y aura que 2 lignes pour la pagination. </p><br><h2 id="union">  Union multiple avec vous-mÃªme au nom de la recherche </h2><br><p>  Comme je l'ai Ã©crit plus tÃ´t, la tÃ¢che principale de ma bibliothÃ¨que est de simplifier la gÃ©nÃ©ration des parties where pour certaines requÃªtes.  Donc, dans ce cas, nous devrons peut-Ãªtre joindre Ã  plusieurs reprises la mÃªme table pour quelle requÃªte?  L'une des options est lorsque nous avons un certain produit dont les propriÃ©tÃ©s ne sont pas connues Ã  l'avance et qu'elles seront ajoutÃ©es par les utilisateurs, et nous devons avoir la possibilitÃ© de rechercher des produits par ces propriÃ©tÃ©s dynamiques.  La faÃ§on la plus simple d'expliquer avec un exemple simplifiÃ©. </p><br><p>  Supposons que nous ayons une boutique en ligne vendant des composants informatiques, que nous n'ayons pas d'assortiment strict et que nous achetions pÃ©riodiquement un composant ou un autre.  Mais nous aimerions dÃ©crire tous nos produits comme une entitÃ© unique et rechercher tous les produits.  Alors, quelles entitÃ©s peuvent Ãªtre distinguÃ©es du point de vue de la logique mÃ©tier: </p><br><ol><li>  <strong>Produit.</strong>  L'entitÃ© la plus importante autour de laquelle tout est construit. </li><li>  <strong>Type de produit.</strong>  Cela peut Ãªtre reprÃ©sentÃ© comme la propriÃ©tÃ© racine de toutes les autres propriÃ©tÃ©s du produit.  Par exemple, dans notre petit magasin, c'est seulement: RAM, SSD et HDD. </li><li>  <strong>PropriÃ©tÃ©s du produit.</strong>  Dans notre mise en Å“uvre, toute propriÃ©tÃ© peut s'appliquer Ã  tout type de produit, le choix reste sur la conscience du manager.  Dans notre magasin, les gestionnaires n'ont crÃ©Ã© que 3 propriÃ©tÃ©s: la taille de la mÃ©moire, le facteur de forme et le DDR. </li><li>  <strong>La valeur des marchandises.</strong>  La valeur que l'acheteur gÃ©nÃ©rera lors de la recherche. </li></ol><br><p>  Toute la logique mÃ©tier dÃ©crite ci-dessus est reflÃ©tÃ©e en dÃ©tail dans l'image ci-dessous. </p><br><p><img src="https://habrastorage.org/webt/z1/gx/um/z1gxum4ba1zhvsilqqdqijndt94.png"></p><br><p>  Par exemple, nous avons un produit: <strong>16 Go de RAM DDR 3</strong> .  Dans le diagramme, cela peut Ãªtre affichÃ© comme suit: </p><br><p><img src="https://habrastorage.org/webt/kz/lp/-x/kzlp-xtvozjhyffgboxtbqr7qri.png"></p><br><p>  La structure et les donnÃ©es de la base de donnÃ©es sont clairement visibles dans la figure suivante: </p><br><p><img src="https://habrastorage.org/webt/es/lk/8a/eslk8aungbzzjqtpjnejscp6ywk.png"></p><br><p>  Comme nous le voyons sur le diagramme, toutes les valeurs de toutes les propriÃ©tÃ©s sont stockÃ©es dans une table de valeurs (au fait, dans notre version simplifiÃ©e, toutes les propriÃ©tÃ©s ont des valeurs numÃ©riques).  Par consÃ©quent, si nous voulons rechercher simultanÃ©ment plusieurs propriÃ©tÃ©s avec un tas de ET, nous obtenons une sÃ©lection vide. </p><br><p>  Par exemple, un acheteur recherche des produits adaptÃ©s Ã  une telle demande: la <em>quantitÃ© de mÃ©moire doit Ãªtre supÃ©rieure Ã  10 Go et le facteur de forme doit Ãªtre de 2,5 pouces</em> .  Si nous Ã©crivons sql comme indiquÃ© ci-dessous, nous obtenons une sÃ©lection vide: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> product p <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> val v <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> v.product_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> (v.property_id = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> v.value &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (v.property_id = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> v.value = <span class="hljs-number"><span class="hljs-number">2.5</span></span>)</code> </pre> <br><p>  Ã‰tant donnÃ© que les valeurs de toutes les propriÃ©tÃ©s sont stockÃ©es dans une table, pour rechercher plusieurs propriÃ©tÃ©s, vous devez joindre la valeur de table pour chaque propriÃ©tÃ© qui sera recherchÃ©e.  Mais il y a une nuance, joindre les tables de jointures Â«horizontalementÂ» (au mot union, toutes les jointures Â«verticalesÂ»), voici un exemple: </p><br><p><img src="https://habrastorage.org/webt/00/th/4d/00th4d4mehwetkemk7vnkvqukr4.png"></p><br><p>  Ce rÃ©sultat ne nous convient pas, nous aimerions voir toutes les valeurs dans une colonne.  Pour ce faire, vous devez joindre la table val 1 fois plus que les propriÃ©tÃ©s par lesquelles la recherche est effectuÃ©e. </p><br><p><img src="https://habrastorage.org/webt/pp/br/rp/ppbrrphdkttykoq0uexraglkcve.png"></p><br><p>  Nous sommes sur le point de gÃ©nÃ©rer automatiquement une requÃªte SQL.  Regardons la fonction <br>  <code>whereWithJoin ($aliasJoin, $options, $aliasWhere, $where)</code> , qui fera tout le travail: </p><br><ul><li>  <strong>$ aliasJoin</strong> - un alias dans le modÃ¨le de base, au lieu duquel la partie SQL avec jointures est remplacÃ©e. </li><li>  <strong>$ options</strong> - un tableau avec des descriptions des rÃ¨gles de gÃ©nÃ©ration de la piÃ¨ce jointe. </li><li>  <strong>$ aliasWhere</strong> - un alias dans le modÃ¨le de base, qui remplace la partie where sql Ã  la place. </li><li>  <strong>$ where</strong> est une instance de la classe Where. </li></ul><br><p>  Regardons un exemple: <code>whereWithJoin('/*join*/', $options, '/*where*/', $wh)</code> . </p><br><p>  CrÃ©ez d'abord la variable <strong>$ options</strong> : <code>$options = ['v' =&gt; ['val', 'product_id', 'p.id']];</code> </p><br><p>  <strong>v</strong> est l'alias de la table.  Si l'alias donnÃ© se trouve dans <strong>$ wh</strong> , une nouvelle table <strong>val</strong> sera connectÃ©e par jointure (oÃ¹ <strong>product_id</strong> est la clÃ© Ã©trangÃ¨re de la table <strong>val</strong> , et <strong>p.id</strong> est la clÃ© primaire de la table avec l'alias <strong>p</strong> ), un nouvel alias et cet alias sont gÃ©nÃ©rÃ©s pour cela remplacera <strong>v</strong> oÃ¹. </p><br><p>  <strong>$ wh</strong> est une instance de la classe Where.  Nous formons la mÃªme demande: <em>la mÃ©moire doit Ãªtre supÃ©rieure Ã  10 Go et le facteur de forme doit Ãªtre de 2,5 pouces.</em> </p><br><pre> <code class="php hljs">$wh-&gt;linkAnd([ $wh-&gt;linkAnd([ [<span class="hljs-string"><span class="hljs-string">'v.property_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], [<span class="hljs-string"><span class="hljs-string">'v.value'</span></span>, <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>] ])-&gt;getRaw(), <span class="hljs-comment"><span class="hljs-comment">//    $wh-&gt;linkAnd([ ['v.property_id', '=', 3], ['v.value', '=', 2.5] ])-&gt;getRaw(),//    ]);</span></span></code> </pre> <br><p>  Lors de la crÃ©ation d'une requÃªte where, il est nÃ©cessaire d'envelopper la partie avec la propriÃ©tÃ© id et sa valeur entre crochets, cela indique Ã  la fonction <code>whereWithJoin()</code> que l'alias de table sera le mÃªme dans cette partie. </p><br><pre> <code class="php hljs">$qr-&gt;sql(<span class="hljs-string"><span class="hljs-string">"select p.id, t.name type_name, pr.id prop_id, pr.name prop_name, v.id val_id, v.value from product p inner join type t on t.id = p.type_id inner join val v on v.product_id = p.id inner join properties pr on pr.id = v.property_id /*join*/ /*where*/"</span></span>) -&gt;whereWithJoin(<span class="hljs-string"><span class="hljs-string">'/*join*/'</span></span>, $options, <span class="hljs-string"><span class="hljs-string">'/*where*/'</span></span>, $wh) <span class="hljs-comment"><span class="hljs-comment">//     . -&gt;all([ 'id' =&gt; 'pk', 'type_name' =&gt; 'type', 'properties' =&gt; [ 'prop_id' =&gt; 'pk', 'prop_name' =&gt; 'name', 'values' =&gt; [ 'val_id' =&gt; 'pk', 'value' =&gt; 'val' ] ] ]);</span></span></code> </pre> <br><p>  Nous examinons le sql gÃ©nÃ©rÃ©, les <code>$qr-&gt;debugInfo()</code> et le temps d'exÃ©cution de la requÃªte: <code>$qr-&gt;debugInfo()</code> : </p><br><pre> <code class="php hljs">[ [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'info'</span></span>, <span class="hljs-string"><span class="hljs-string">'sql'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'select p.id, t.name type_name, pr.id prop_id, pr.name prop_name, v.id val_id, v.value from product p inner join type t on t.id = p.type_id inner join val v on v.product_id = p.id inner join properties pr on pr.id = v.property_id inner JOIN val val_mIQWpnHhdQ ON val_mIQWpnHhdQ.product_id = p.id inner JOIN val val_J0uveMpwEM ON val_J0uveMpwEM.product_id = p.id WHERE ( val_mIQWpnHhdQ.property_id = :al_where_leV5QlmOZN and val_mIQWpnHhdQ.value &gt; :al_where_ycleYAswIw ) and ( val_J0uveMpwEM.property_id = :al_where_dinxDraTOE and val_J0uveMpwEM.value = :al_where_wZJhUqs74i )'</span></span>, <span class="hljs-string"><span class="hljs-string">'binds'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'al_where_leV5QlmOZN'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_ycleYAswIw'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_dinxDraTOE'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_wZJhUqs74i'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], <span class="hljs-string"><span class="hljs-string">'timeQuery'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0384588241577</span></span> ] ]</code> </pre> <br><p>      <code>$qr-&gt;rawData()</code> : </p><br><pre> <code class="php hljs">[ [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">512</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">256</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1024</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ] ]</code> </pre> <br><p>        <code>$qr-&gt;aggregateData()</code> : </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">512</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">256</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">8</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">11</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1024</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">12</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ] ]</code> </pre> <br><p>     ,   ,    <code>whereWithJoin()</code> ,    . </p><br><p>  <code>whereWithJoin()</code> ,    ,      <strong>n</strong>    ,   <strong>m</strong>    .  <strong>n</strong>  <strong>m</strong>     1         id    .        ,      <strong>AND</strong> . </p><br><hr><br><p>        <a href="https://falbin.ru/documentation/greenpig/"></a>     <a href="https://github.com/mrFalbin/green-pig-dao/tree/master">GitHub</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483458/">https://habr.com/ru/post/fr483458/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483440/index.html">Derniers compilateurs D</a></li>
<li><a href="../fr483444/index.html">Rapport DORA 2019: comment amÃ©liorer les performances de DevOps</a></li>
<li><a href="../fr483446/index.html">Les scientifiques ont trouvÃ© une nouvelle faÃ§on de rÃ©duire les niveaux de fer dans l'eau potable</a></li>
<li><a href="../fr483448/index.html">Disney - Le plus grand double sens de l'histoire de l'humanitÃ©</a></li>
<li><a href="../fr483454/index.html">Passer de Mercurial Ã  GIT dans Atlassian Bitbucket avec enregistrer des fichiers en cyrillique</a></li>
<li><a href="../fr483460/index.html">SQL HowTo: crÃ©ation de chaÃ®nes Ã  l'aide de fonctions de fenÃªtre</a></li>
<li><a href="../fr483462/index.html">Tais-toi et prends mon argent</a></li>
<li><a href="../fr483466/index.html">PrÃ©sentation de la mÃ©thode de rÃ©tropropagation</a></li>
<li><a href="../fr483468/index.html">Tests d'intÃ©gration Flutter - C'est facile</a></li>
<li><a href="../fr483470/index.html">Pose de tuiles efficacement (Pro CSS, SVG, motif et plus)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>