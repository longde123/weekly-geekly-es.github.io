<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙌🏾 💆🏾 🐬 Assistant de base de données GreenPig 😶 🤞🏿 🤧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Entrée 
2. Connexion à la bibliothèque 
3. Où classe Partie atomique de la demande Requêtes compliquées 
4. Partie atomique de la demande 
5. Requê...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Assistant de base de données GreenPig</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483458/"><ol><li>  <a href="https://habr.com/ru/post/483458/">Entrée</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Connexion à la bibliothèque</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Où classe</a> <br><ul><li>  <a href="https://habr.com/ru/post/483458/">Partie atomique de la demande</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Requêtes compliquées</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/483458/">Rejoignez la classe</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Requête de classe</a> <br><ul><li>  <a href="https://habr.com/ru/post/483458/">Sélection à partir d'une base de données avec des paramètres imbriqués</a> </li><li>  <a href="https://habr.com/ru/post/483458/">Union multiple avec vous-même au nom de la recherche</a> </li></ul></li></ol><br><pre><code class="sql hljs">╔═══╗╔═══╗╔═══╗╔═══╗╔╗─╔╗────╔═══╗╔══╗╔═══╗ ║╔══╝║╔═╗║║╔══╝║╔══╝║╚═╝║────║╔═╗║╚╗╔╝║╔══╝ ║║╔═╗║╚═╝║║╚══╗║╚══╗║╔╗─║────║╚═╝║─║║─║║╔═╗ ║║╚╗║║╔╗╔╝║╔══╝║╔══╝║║╚╗║────║╔══╝─║║─║║╚╗║ ║╚═╝║║║║║─║╚══╗║╚══╗║║─║║────║║───╔╝╚╗║╚═╝║ ╚═══╝╚╝╚╝─╚═══╝╚═══╝╚╝─╚╝────╚╝───╚══╝╚═══╝ 5HHHG HH HHHHHHH 9HHHA HHHHHHHH5 HHHHHHHHHHHHHHHHHH 9HHHHH5 5HHHHHHHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHHHHHHHHH ;HHHHHHHHHHHHHHHHHHHHHHHHHHA H2 HHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHHHH9 HHHHHHHHHHHHHHHHHHHHHHH AHHHHHHHHHHHHHHHHHHHHHH HHHHHHHHHHHHHHHHHHHHH9 iHS HHHHHHHHHHHHHHHHHHHHHHhh HHHHHHHHHHHHHHHHHH AA HHHHHHHHHHHHHH3 &amp;H Hi HS Hr &amp; H&amp; H&amp; Hi</code> </pre> <a name="habracut"></a><br><h2 id="entry">  Entrée </h2><br><p>  Je veux vous parler du développement de ma petite bibliothèque en php.  Quelles tâches résout-elle?  Pourquoi ai-je décidé de l'écrire et pourquoi pourrait-il vous être utile?  Essayez bien de répondre à ces questions. </p><br><p>  <strong>GreenPig</strong> (ci-après <strong>GP</strong> ) est un petit assistant de base de données qui peut compléter les fonctionnalités de n'importe quel framework php que vous utilisez. </p><br><p>  Comme tout outil <strong>GP</strong> , il est affiné pour résoudre certains problèmes.  Il vous sera utile si vous préférez écrire des requêtes de base de données en SQL pur et que vous n'utilisez pas Active record et d'autres technologies similaires.  Par exemple, nous avons une base de données Oracle au travail et souvent les requêtes occupent plusieurs écrans avec des dizaines de jointures, les fonctions plsql, union all, etc. sont toujours utilisées.  etc., donc il ne reste plus qu'à écrire des requêtes en SQL pur. </p><br><p>  Mais avec cette approche, la question se pose: comment générer où la partie de la requête SQL lorsque les utilisateurs recherchent des informations?  <strong>GP</strong> vise, tout d'abord, une compilation pratique au moyen de php où d'une demande de toute complexité. </p><br><p>  Mais qu'est-ce qui m'a poussé à écrire cette bibliothèque (sauf, bien sûr, pour acquérir une expérience intéressante)?  Ce sont trois choses: </p><br><p>  Premièrement, la nécessité d'obtenir non pas une réponse plate standard de la base de données, mais un tableau imbriqué semblable à un arbre. </p><br><div class="spoiler">  <b class="spoiler_title">Voici un exemple d'un exemple de base de données standard:</b> <div class="spoiler_text"><pre> <code class="php hljs">[ [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ], [<span class="hljs-number"><span class="hljs-number">3</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">4</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">5</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">6</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">7</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">8</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">9</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ], [<span class="hljs-number"><span class="hljs-number">10</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ], [<span class="hljs-number"><span class="hljs-number">11</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ], [<span class="hljs-number"><span class="hljs-number">12</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">13</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">14</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ], [<span class="hljs-number"><span class="hljs-number">15</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ], [<span class="hljs-number"><span class="hljs-number">16</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ], [<span class="hljs-number"><span class="hljs-number">17</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-string"><span class="hljs-string">'type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'val_id'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ] ]</code> </pre> </div></div><br><p>  Pour obtenir un tableau arborescent, nous devons soit apporter le résultat à la forme souhaitée nous-mêmes, soit effectuer N requêtes de base de données pour chaque produit.  Et si nous avons besoin de pagination, et même de tri?  <strong>GP</strong> est capable de résoudre ces problèmes.  Voici un exemple d'échantillon avec <strong>GP</strong> : </p><br><pre> <code class="php hljs">[ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'prod_type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'car'</span></span> [<span class="hljs-string"><span class="hljs-string">'properties'</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">790</span></span> ] [<span class="hljs-number"><span class="hljs-number">2</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> ] [<span class="hljs-number"><span class="hljs-number">3</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">75</span></span> ] ] ] [<span class="hljs-number"><span class="hljs-number">4</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'prod_type'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'phone'</span></span> [<span class="hljs-string"><span class="hljs-string">'properties'</span></span>] =&gt; [ [<span class="hljs-number"><span class="hljs-number">10</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> ] [<span class="hljs-number"><span class="hljs-number">8</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">' ()'</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">0.12</span></span> ] [<span class="hljs-number"><span class="hljs-number">9</span></span>] =&gt; [ [<span class="hljs-string"><span class="hljs-string">'name'</span></span>] =&gt; <span class="hljs-string"><span class="hljs-string">'   '</span></span> [<span class="hljs-string"><span class="hljs-string">'value'</span></span>] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ] ] ] ]</code> </pre> <br><p>  Et bien sûr, en même temps, une pagination et un tri pratiques: <code>-&gt;pagination(1, 10)-&gt;sort('id')</code> . </p><br><p>  La deuxième raison n'est pas si fréquente, mais néanmoins elle se produit (et dans mon cas, c'est la raison principale).  Si certaines entités sont stockées dans la base de données et que les propriétés de ces entités sont dynamiques et définies par les utilisateurs, alors lorsque vous devez rechercher des entités par leurs propriétés, vous devrez ajouter (joindre) la même table avec les valeurs de propriété (autant de fois qu'elles sont utilisées). propriétés lors de la recherche).  Le GP vous aidera donc à connecter toutes les tables et à générer la requête where avec presque une fonction.  Vers la fin de l'article, j'analyserai ce cas en détail. </p><br><p>  Et enfin, tout cela devrait fonctionner à la fois pour la base de données Oracle et pour mySql.  Il existe également un certain nombre de fonctionnalités décrites dans la documentation. </p><br><p>  Il est possible que j'aie inventé un autre vélo, mais j'ai consciencieusement cherché et je n'ai pas trouvé de solution qui me convienne.  Si vous connaissez une bibliothèque qui résout ces problèmes - veuillez écrire dans les commentaires. </p><br><p>  Avant de passer directement à un examen de la bibliothèque elle-même et à des exemples, je dirai qu'il n'y aura que l'essentiel, sans explications détaillées.  Si vous vous intéressez au fonctionnement du <strong>GP</strong> , vous pouvez consulter la <a href="https://falbin.ru/documentation/greenpig">documentation</a> , j'ai essayé de tout expliquer en détail. </p><br><h2 id="libraryconnection">  Connexion à la bibliothèque </h2><br><p>  La bibliothèque peut être installée via le compositeur: le <code>composer require falbin/green-pig-dao</code> </p><br><p>  Ensuite, vous devez écrire une usine à travers laquelle vous utiliserez cette bibliothèque. </p><br><h2 id="where">  Où classe </h2><br><p>  En utilisant cette classe, vous pouvez composer la partie where de la requête sql de n'importe quelle complexité. </p><br><h3 id="partrequest">  Partie atomique de la demande </h3><br><p>  Considérez la plus petite partie atomique d'une requête.  Il est décrit par un tableau: <code>[, , ]</code> <br>  Exemple: <code>['name', 'like', '%%']</code> </p><br><ul><li>  <strong>Le premier élément du</strong> tableau est juste une chaîne, insérée dans la requête sql sans modifications, et, par conséquent, vous pouvez y écrire des fonctions sql.  Exemple: <code>['LOWER(name)', 'like', '%%']</code> </li><li>  <strong>Le deuxième élément</strong> est également une chaîne insérée dans sql sans changement entre deux opérandes.  Il peut prendre les valeurs suivantes: <em>=,&gt;, &lt;,&gt; =, &lt;=, &lt;&gt;, comme, pas comme, entre, pas entre, dans, pas dans</em> . </li><li>  <strong>Le troisième élément du</strong> tableau peut être de type numérique ou chaîne.  Où la classe remplacera automatiquement l'alias généré dans la requête SQL. </li><li>  <strong>Élément de tableau avec clé sql.</strong>  Parfois, il est nécessaire que la valeur soit insérée dans le code SQL sans modifications.  Par exemple, pour appliquer des fonctions.  Ceci peut être réalisé en spécifiant 'sql' comme clé (pour le 3ème élément).  Exemple: <code>['LOWER(name)', 'like', 'sql' =&gt; "LOWER('$name')"]</code> </li><li>  <strong>Un élément de tableau avec la clé de liaison</strong> est un tableau pour stocker des liaisons.  L'exemple ci-dessus est faux du point de vue de la sécurité.  Vous ne pouvez pas insérer de variables dans SQL - c'est trop d'injection.  Par conséquent, dans ce cas, vous devrez spécifier vous-même des alias, par exemple comme ceci: <code>['LOWER(name)', 'like', 'sql' =&gt; "LOWER(:name)", 'bind'=&gt; ['name' =&gt; $name] ]</code> </li><li>  <strong>L'opérateur in</strong> peut s'écrire comme ceci: <code>['curse', 'not in', [1, 3, 5]]</code> .  La classe Where convertit une telle entrée dans le code SQL suivant: <code>curse not in (:al_where_jCgWfr95kh, :al_where_mCqefr95kh, :al_where_jCfgfr9Gkh)</code> </li><li>  <strong>L'instruction entre</strong> peut être écrite comme ceci: <code>['curse', ' between', 1, 5]</code> .  La classe Where convertit une telle entrée dans le code SQL suivant: <code>curse between :al_where_Pi4CRr4xNn and :al_where_WiPPS4NKiG</code> <br>  Mais attention, si les troisième et quatrième éléments du tableau sont des chaînes, une logique spéciale est appliquée.  Dans ce cas, on pense que la sélection est à partir d'une plage de dates et, par conséquent, la fonction sql de transtyper une chaîne en une date est utilisée.  La fonction de conversion en une date (mySql et Oracle en ont différentes) et ses paramètres sont tirés d'un tableau de paramètres (plus dans la documentation).  Le tableau <code>['build_date', 'between', '01.01.2016', '01.01.2019']</code> sera converti en sql: <code>build_date between TO_DATE(:al_where_fkD7nZg5lU, 'dd.mm.yyyy hh24:mi::ss') and TO_DATE(:al_where_LdyVRznPF8, 'dd.mm.yyyy hh24:mi::ss')</code> </li></ul><br><h3 id="complicatedqueries">  Requêtes compliquées </h3><br><p>  Créons une instance de la classe via la fabrique: <code>$wh = GP::where();</code> </p><br><p>  Pour indiquer la connexion logique entre les "parties atomiques" de la demande, vous devez utiliser les fonctions <code>linkAnd()</code> ou <code>linkOr()</code> .  Un exemple: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// sql: (old &gt; 18 and old &lt; 50) $wh-&gt;linkAnd([ ['old', '&lt;', 18], ['old', '&gt;', 50] ]); // sql: (old &lt; 18 or old &gt; 50) $wh-&gt;linkOr([ ['old', '&lt;', 18], ['old', '&gt;', 50] ]);</span></span></code> </pre> <br><p>  Lorsque vous utilisez les fonctions <strong>linkAnd / linkOr,</strong> toutes les données sont stockées dans une instance de la classe Where - $ wh.  De plus, toutes les «parties atomiques» indiquées dans la fonction <strong>sont entre crochets</strong> . </p><br><p>  Un SQL de toute complexité peut être décrit par trois fonctions: <code>linkAnd(), linkOr(), getRaw()</code> .  Prenons un exemple: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// sql: curse = 1 and (old &lt; 18 or old &gt; 50) $wh-&gt;linkAnd([ ['curse', '=', 1], $wh-&gt;linkOr([ ['old', '&lt;', 18], ['old', '&gt;', 50] ])-&gt;getRaw() ]);</span></span></code> </pre> <br><p>  La classe Where a une variable privée qui stocke l'expression brute.  Les <code>linkAnd()</code> et <code>linkOr()</code> cette variable, par conséquent, lors de la construction d'une expression logique, les méthodes sont imbriquées ensemble et la variable avec l'expression brute contient des données obtenues à partir de la dernière méthode exécutée. </p><br><h2 id="join">  Rejoindre la classe </h2><br><p>  <strong>Join</strong> est une classe qui génère un fragment de jointure de code SQL.  Créons une instance de la classe via l'usine: <code>$jn = GP::leftJoin('coursework', 'student_id', 's.id')</code> , où: </p><br><ul><li>  <strong>les cours</strong> sont la table que nous allons rejoindre. </li><li>  <strong>student_id</strong> - une colonne avec une clé étrangère de la table des <strong>cours</strong> . </li><li>  <strong>s.id</strong> - la colonne de la table avec laquelle join doit être écrite avec l'alias de la table (dans ce cas, l'alias de la table est s). </li></ul><br><p>  SQL généré: <code>left JOIN coursework coursework_joM9YuTTfW ON coursework_joM9YuTTfW.student_id = s.id</code> </p><br><p>  Lors de la création d'une instance de la classe, nous avons déjà décrit la condition pour joindre des tables, mais il peut être nécessaire de clarifier et d'étendre la condition.  Les fonctions <strong>linkAnd / linkOr</strong> vous aideront à faire ceci: <code>$jn-&gt;linkAnd(['semester_number', '&gt;', 2])</code> </p><br><p>  SQL généré: <code>inner JOIN coursework coursework_Nd1n5T7c0r ON coursework_Nd1n5T7c0r.student_id = s.id and (semester_number &gt; :al_where_M1kEcHzZyy)</code> </p><br><p>  S'il y a plusieurs tables à joindre, vous pouvez les combiner dans une classe: <strong>CollectionJoin</strong> . </p><br><h2 id="query">  Requête de classe </h2><br><p>  C'est la classe principale pour travailler avec la base de données, à travers elle il y a une sélection, un enregistrement, une mise à jour et une suppression des données.  Vous pouvez également effectuer certains traitements de données obtenues à partir de la base de données. </p><br><p>  Prenons un exemple typique. </p><br><p>  Créons une instance de la classe via la fabrique: <code>$qr = GP::query();</code> </p><br><p>  Maintenant, nous allons définir le modèle sql, remplacer les valeurs nécessaires pour le scénario donné dans le modèle sql et dire que nous voulons obtenir un enregistrement, et en particulier les données de la colonne <strong>average_mark</strong> . </p><br><pre> <code class="php hljs">$rez = $qr-&gt;sql(<span class="hljs-string"><span class="hljs-string">"select /*select*/ from student s inner join mark m on s.id = m.student_id inner join lesson l on l.id = m.lesson_id /*where*/ /*group*/"</span></span>) -&gt;sqlPart(<span class="hljs-string"><span class="hljs-string">'/*select*/'</span></span>, <span class="hljs-string"><span class="hljs-string">'s.name, avg(m.mark) average_mark'</span></span>, []) -&gt;whereAnd(<span class="hljs-string"><span class="hljs-string">'/*where*/'</span></span>, [<span class="hljs-string"><span class="hljs-string">'s.id'</span></span>, <span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]) -&gt;sqlPart(<span class="hljs-string"><span class="hljs-string">'/*group*/'</span></span>, <span class="hljs-string"><span class="hljs-string">'group by s.name'</span></span>, []) -&gt;one(<span class="hljs-string"><span class="hljs-string">'average_mark'</span></span>);</code> </pre> <br><p>  Résultat: <code>3,16666666666666666666666666666666666667</code> </p><br><h3 id="selection">  Sélection à partir d'une base de données avec des paramètres imbriqués </h3><br><p>  Surtout, je n'ai pas eu l'occasion d'obtenir une sélection de la base de données dans une arborescence, avec des propriétés attachées.  Par conséquent, la bibliothèque GP a une telle opportunité et la profondeur d'imbrication n'est pas limitée. </p><br><p>  La manière la plus simple de considérer le principe de fonctionnement est basée sur un exemple.  Pour examen, nous prenons le <strong>schéma de base de données</strong> suivant <strong>:</strong> </p><br><p><img src="https://habrastorage.org/webt/tt/ih/_o/ttih_oflaq8cvslm1yiutxabp8q.png"></p><br><p>  <strong>Contenu du tableau:</strong> </p><br><p><img src="https://habrastorage.org/webt/z4/v4/aa/z4v4aa7oci4w-9q7nrncht1tceu.png"></p><br><p>  Souvent, lorsque vous interrogez une base de données, vous souhaitez obtenir une réponse arborescente et non plate.  Par exemple, en exécutant cette requête: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> s.id, s.name, c.id title_id, c.title <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> student s <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> coursework c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c. student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> s.id = <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Nous obtenons un résultat plat: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'«»    '</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span>=&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span> ] ]</code> </pre> <br><p>  En utilisant GP, vous pouvez obtenir ce résultat: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'«»    '</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>] ] ] ]</code> </pre> <br><p>  Pour obtenir ce résultat, vous devez passer un tableau avec des options à la fonction <code>all</code> (la fonction renvoie toutes les lignes de requête): </p><br><pre> <code class="php hljs">all([ <span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'title_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span> ] ])</code> </pre> <br><p>  Le tableau <code>$option</code> dans l' <strong>agrégateur de</strong> fonctions <strong>( <code>$option</code> , $ rawData)</strong> et <strong>all ( <code>$options</code> )</strong> est construit selon les règles suivantes: </p><br><ul><li>  <strong>Clés de tableau</strong> - noms de colonnes.  <strong>Éléments de tableau</strong> - nouveaux noms pour les colonnes, vous pouvez entrer l'ancien nom. </li><li>  Il y a un mot réservé pour les valeurs du tableau - <code>pk</code> .  Il indique que les données seront regroupées par cette colonne (la clé du tableau est le nom de la colonne). </li><li>  À chaque niveau, il ne devrait y avoir qu'un seul <code>pk</code> . </li><li>  Dans le tableau agrégé (résultant), les valeurs de la colonne déclarée par <code>pk</code> seront utilisées comme clés. </li><li>  S'il est nécessaire de placer une partie des colonnes à un niveau inférieur, un nouveau nom inventé est utilisé comme clé de tableau, et un tableau construit selon les règles décrites ci-dessus sera utilisé comme valeur. </li></ul><br><p>  Prenons un exemple plus complexe.  Supposons que nous devions obtenir tous les étudiants avec le nom de leur cours et avec toutes les notes dans toutes les matières.  Nous aimerions le recevoir non pas sous une forme plate, mais sous forme d'arbre, sans doublons.  Vous trouverez ci-dessous la requête souhaitée dans la base de données et le résultat. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> s.id student_id, s.name student_name, s.semester_number, c.id coursework_id, c.semester_number coursework_semester, c.title coursework_title, l.id lesson_id, l.name lesson, m.id mark_id, m.mark <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> student s <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> coursework c <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> c.student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> mark m <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> m.student_id = s.id <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> lesson l <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> l.id = m.lesson_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> s.id, c.id, l.id, m.id</code> </pre> <br><p>  Le résultat ne nous convient pas: </p><br><p><img src="https://habrastorage.org/webt/er/mj/7p/ermj7p5zki1g4hfxausavajfcps.png"></p><br><p>  Pour réaliser la tâche, vous devez écrire le tableau <code>$option</code> suivant: </p><br><pre> <code class="php hljs">$option = [ <span class="hljs-string"><span class="hljs-string">'student_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'student_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'coursework_semester'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'coursework_title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span> ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'lesson'</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'mark_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pk'</span></span>, <span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mark'</span></span> ] ] ];</code> </pre> <br><p>  Requête de base de données: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//    Query   .       // (    yii2) $qr = Yii::$app-&gt;gp-&gt;query( "SELECT s.id student_id, s.name student_name, s.semester_number, c.id coursework_id, c.semester_number coursework_semester, c.title coursework_title, l.id lesson_id, l.name lesson, m.id mark_id, m.mark FROM student s LEFT JOIN coursework c ON c.student_id = s.id LEFT JOIN mark m ON m.student_id = s.id LEFT JOIN lesson l ON l.id = m.lesson_id ORDER BY s.id, c.id, l.id, m.id"); //   1,  2   3  //  1 $result = $qr-&gt;all($option); //  2 $result = $qr-&gt;aggregator($option, $qr-&gt;all()); //  3 $qr-&gt;all(); $result = $qr-&gt;aggregator($option, $qr-&gt;rawData());</span></span></code> </pre> <br><p>  La fonction d' <code>aggregator</code> peut traiter n'importe quel tableau avec une structure similaire au résultat d'une requête de base de données, selon les règles décrites dans l' <code>$option</code> . </p><br><p>  La variable <code>$result</code> contient les données suivantes: </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'    '</span></span>], ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'courseworks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'«»    '</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>] ], <span class="hljs-string"><span class="hljs-string">'lessons'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">17</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">2</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">18</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">20</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'lesson'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'marks'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">16</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">19</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'mark'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>] ] ], ] ] ]</code> </pre> <br><p>  Soit dit en passant, avec la pagination avec une requête agrégée, seules les données les plus élémentaires sont prises en compte.  Dans l'exemple ci-dessus, il n'y aura que 2 lignes pour la pagination. </p><br><h2 id="union">  Union multiple avec vous-même au nom de la recherche </h2><br><p>  Comme je l'ai écrit plus tôt, la tâche principale de ma bibliothèque est de simplifier la génération des parties where pour certaines requêtes.  Donc, dans ce cas, nous devrons peut-être joindre à plusieurs reprises la même table pour quelle requête?  L'une des options est lorsque nous avons un certain produit dont les propriétés ne sont pas connues à l'avance et qu'elles seront ajoutées par les utilisateurs, et nous devons avoir la possibilité de rechercher des produits par ces propriétés dynamiques.  La façon la plus simple d'expliquer avec un exemple simplifié. </p><br><p>  Supposons que nous ayons une boutique en ligne vendant des composants informatiques, que nous n'ayons pas d'assortiment strict et que nous achetions périodiquement un composant ou un autre.  Mais nous aimerions décrire tous nos produits comme une entité unique et rechercher tous les produits.  Alors, quelles entités peuvent être distinguées du point de vue de la logique métier: </p><br><ol><li>  <strong>Produit.</strong>  L'entité la plus importante autour de laquelle tout est construit. </li><li>  <strong>Type de produit.</strong>  Cela peut être représenté comme la propriété racine de toutes les autres propriétés du produit.  Par exemple, dans notre petit magasin, c'est seulement: RAM, SSD et HDD. </li><li>  <strong>Propriétés du produit.</strong>  Dans notre mise en œuvre, toute propriété peut s'appliquer à tout type de produit, le choix reste sur la conscience du manager.  Dans notre magasin, les gestionnaires n'ont créé que 3 propriétés: la taille de la mémoire, le facteur de forme et le DDR. </li><li>  <strong>La valeur des marchandises.</strong>  La valeur que l'acheteur générera lors de la recherche. </li></ol><br><p>  Toute la logique métier décrite ci-dessus est reflétée en détail dans l'image ci-dessous. </p><br><p><img src="https://habrastorage.org/webt/z1/gx/um/z1gxum4ba1zhvsilqqdqijndt94.png"></p><br><p>  Par exemple, nous avons un produit: <strong>16 Go de RAM DDR 3</strong> .  Dans le diagramme, cela peut être affiché comme suit: </p><br><p><img src="https://habrastorage.org/webt/kz/lp/-x/kzlp-xtvozjhyffgboxtbqr7qri.png"></p><br><p>  La structure et les données de la base de données sont clairement visibles dans la figure suivante: </p><br><p><img src="https://habrastorage.org/webt/es/lk/8a/eslk8aungbzzjqtpjnejscp6ywk.png"></p><br><p>  Comme nous le voyons sur le diagramme, toutes les valeurs de toutes les propriétés sont stockées dans une table de valeurs (au fait, dans notre version simplifiée, toutes les propriétés ont des valeurs numériques).  Par conséquent, si nous voulons rechercher simultanément plusieurs propriétés avec un tas de ET, nous obtenons une sélection vide. </p><br><p>  Par exemple, un acheteur recherche des produits adaptés à une telle demande: la <em>quantité de mémoire doit être supérieure à 10 Go et le facteur de forme doit être de 2,5 pouces</em> .  Si nous écrivons sql comme indiqué ci-dessous, nous obtenons une sélection vide: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> product p <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> val v <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> v.product_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> (v.property_id = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> v.value &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (v.property_id = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> v.value = <span class="hljs-number"><span class="hljs-number">2.5</span></span>)</code> </pre> <br><p>  Étant donné que les valeurs de toutes les propriétés sont stockées dans une table, pour rechercher plusieurs propriétés, vous devez joindre la valeur de table pour chaque propriété qui sera recherchée.  Mais il y a une nuance, joindre les tables de jointures «horizontalement» (au mot union, toutes les jointures «verticales»), voici un exemple: </p><br><p><img src="https://habrastorage.org/webt/00/th/4d/00th4d4mehwetkemk7vnkvqukr4.png"></p><br><p>  Ce résultat ne nous convient pas, nous aimerions voir toutes les valeurs dans une colonne.  Pour ce faire, vous devez joindre la table val 1 fois plus que les propriétés par lesquelles la recherche est effectuée. </p><br><p><img src="https://habrastorage.org/webt/pp/br/rp/ppbrrphdkttykoq0uexraglkcve.png"></p><br><p>  Nous sommes sur le point de générer automatiquement une requête SQL.  Regardons la fonction <br>  <code>whereWithJoin ($aliasJoin, $options, $aliasWhere, $where)</code> , qui fera tout le travail: </p><br><ul><li>  <strong>$ aliasJoin</strong> - un alias dans le modèle de base, au lieu duquel la partie SQL avec jointures est remplacée. </li><li>  <strong>$ options</strong> - un tableau avec des descriptions des règles de génération de la pièce jointe. </li><li>  <strong>$ aliasWhere</strong> - un alias dans le modèle de base, qui remplace la partie where sql à la place. </li><li>  <strong>$ where</strong> est une instance de la classe Where. </li></ul><br><p>  Regardons un exemple: <code>whereWithJoin('/*join*/', $options, '/*where*/', $wh)</code> . </p><br><p>  Créez d'abord la variable <strong>$ options</strong> : <code>$options = ['v' =&gt; ['val', 'product_id', 'p.id']];</code> </p><br><p>  <strong>v</strong> est l'alias de la table.  Si l'alias donné se trouve dans <strong>$ wh</strong> , une nouvelle table <strong>val</strong> sera connectée par jointure (où <strong>product_id</strong> est la clé étrangère de la table <strong>val</strong> , et <strong>p.id</strong> est la clé primaire de la table avec l'alias <strong>p</strong> ), un nouvel alias et cet alias sont générés pour cela remplacera <strong>v</strong> où. </p><br><p>  <strong>$ wh</strong> est une instance de la classe Where.  Nous formons la même demande: <em>la mémoire doit être supérieure à 10 Go et le facteur de forme doit être de 2,5 pouces.</em> </p><br><pre> <code class="php hljs">$wh-&gt;linkAnd([ $wh-&gt;linkAnd([ [<span class="hljs-string"><span class="hljs-string">'v.property_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>], [<span class="hljs-string"><span class="hljs-string">'v.value'</span></span>, <span class="hljs-string"><span class="hljs-string">'&gt;'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>] ])-&gt;getRaw(), <span class="hljs-comment"><span class="hljs-comment">//    $wh-&gt;linkAnd([ ['v.property_id', '=', 3], ['v.value', '=', 2.5] ])-&gt;getRaw(),//    ]);</span></span></code> </pre> <br><p>  Lors de la création d'une requête where, il est nécessaire d'envelopper la partie avec la propriété id et sa valeur entre crochets, cela indique à la fonction <code>whereWithJoin()</code> que l'alias de table sera le même dans cette partie. </p><br><pre> <code class="php hljs">$qr-&gt;sql(<span class="hljs-string"><span class="hljs-string">"select p.id, t.name type_name, pr.id prop_id, pr.name prop_name, v.id val_id, v.value from product p inner join type t on t.id = p.type_id inner join val v on v.product_id = p.id inner join properties pr on pr.id = v.property_id /*join*/ /*where*/"</span></span>) -&gt;whereWithJoin(<span class="hljs-string"><span class="hljs-string">'/*join*/'</span></span>, $options, <span class="hljs-string"><span class="hljs-string">'/*where*/'</span></span>, $wh) <span class="hljs-comment"><span class="hljs-comment">//     . -&gt;all([ 'id' =&gt; 'pk', 'type_name' =&gt; 'type', 'properties' =&gt; [ 'prop_id' =&gt; 'pk', 'prop_name' =&gt; 'name', 'values' =&gt; [ 'val_id' =&gt; 'pk', 'value' =&gt; 'val' ] ] ]);</span></span></code> </pre> <br><p>  Nous examinons le sql généré, les <code>$qr-&gt;debugInfo()</code> et le temps d'exécution de la requête: <code>$qr-&gt;debugInfo()</code> : </p><br><pre> <code class="php hljs">[ [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'info'</span></span>, <span class="hljs-string"><span class="hljs-string">'sql'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'select p.id, t.name type_name, pr.id prop_id, pr.name prop_name, v.id val_id, v.value from product p inner join type t on t.id = p.type_id inner join val v on v.product_id = p.id inner join properties pr on pr.id = v.property_id inner JOIN val val_mIQWpnHhdQ ON val_mIQWpnHhdQ.product_id = p.id inner JOIN val val_J0uveMpwEM ON val_J0uveMpwEM.product_id = p.id WHERE ( val_mIQWpnHhdQ.property_id = :al_where_leV5QlmOZN and val_mIQWpnHhdQ.value &gt; :al_where_ycleYAswIw ) and ( val_J0uveMpwEM.property_id = :al_where_dinxDraTOE and val_J0uveMpwEM.value = :al_where_wZJhUqs74i )'</span></span>, <span class="hljs-string"><span class="hljs-string">'binds'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'al_where_leV5QlmOZN'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_ycleYAswIw'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_dinxDraTOE'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'al_where_wZJhUqs74i'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], <span class="hljs-string"><span class="hljs-string">'timeQuery'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0.0384588241577</span></span> ] ]</code> </pre> <br><p>      <code>$qr-&gt;rawData()</code> : </p><br><pre> <code class="php hljs">[ [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">512</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">256</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1024</span></span> ], [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'type_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'prop_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'val_id'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span> ] ]</code> </pre> <br><p>        <code>$qr-&gt;aggregateData()</code> : </p><br><pre> <code class="php hljs">[ <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">5</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">512</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">4</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SSD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">7</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">256</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">8</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ], <span class="hljs-number"><span class="hljs-number">6</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'HDD'</span></span>, <span class="hljs-string"><span class="hljs-string">'properties'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">11</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1024</span></span>] ] ], <span class="hljs-number"><span class="hljs-number">3</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'values'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">12</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'val'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2.5</span></span>] ] ] ] ] ]</code> </pre> <br><p>     ,   ,    <code>whereWithJoin()</code> ,    . </p><br><p>  <code>whereWithJoin()</code> ,    ,      <strong>n</strong>    ,   <strong>m</strong>    .  <strong>n</strong>  <strong>m</strong>     1         id    .        ,      <strong>AND</strong> . </p><br><hr><br><p>        <a href="https://falbin.ru/documentation/greenpig/"></a>     <a href="https://github.com/mrFalbin/green-pig-dao/tree/master">GitHub</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483458/">https://habr.com/ru/post/fr483458/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483440/index.html">Derniers compilateurs D</a></li>
<li><a href="../fr483444/index.html">Rapport DORA 2019: comment améliorer les performances de DevOps</a></li>
<li><a href="../fr483446/index.html">Les scientifiques ont trouvé une nouvelle façon de réduire les niveaux de fer dans l'eau potable</a></li>
<li><a href="../fr483448/index.html">Disney - Le plus grand double sens de l'histoire de l'humanité</a></li>
<li><a href="../fr483454/index.html">Passer de Mercurial à GIT dans Atlassian Bitbucket avec enregistrer des fichiers en cyrillique</a></li>
<li><a href="../fr483460/index.html">SQL HowTo: création de chaînes à l'aide de fonctions de fenêtre</a></li>
<li><a href="../fr483462/index.html">Tais-toi et prends mon argent</a></li>
<li><a href="../fr483466/index.html">Présentation de la méthode de rétropropagation</a></li>
<li><a href="../fr483468/index.html">Tests d'intégration Flutter - C'est facile</a></li>
<li><a href="../fr483470/index.html">Pose de tuiles efficacement (Pro CSS, SVG, motif et plus)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>