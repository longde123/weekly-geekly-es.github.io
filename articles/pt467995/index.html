<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèûÔ∏è üèø üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø Por dois anos, desenvolvemos nosso sistema de monitoramento. Clique para ... üè≥Ô∏è üçÇ üë©‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! 


 Eu j√° falei neste blog sobre a organiza√ß√£o de um sistema modular de monitoramento para arquitetura de microsservi√ßos e sobre a transi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Por dois anos, desenvolvemos nosso sistema de monitoramento. Clique para ...</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/467995/"><p>  Ol√° pessoal! </p><br><p>  Eu j√° falei neste blog sobre a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">organiza√ß√£o de um sistema modular de monitoramento</a> para arquitetura de microsservi√ßos e sobre a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">transi√ß√£o do Graphite + Whisper para Graphite + ClickHouse para armazenar m√©tricas</a> sob altas cargas.  Depois disso, meu colega <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sergey Noskov</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">escreveu</a> sobre o primeiro link do nosso sistema de monitoramento - o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bioyino</a> desenvolvido por n√≥s, um agregador de m√©tricas escal√°veis ‚Äã‚Äãdistribu√≠das. </p><br><p>  Chegou a hora de atualizar as informa√ß√µes sobre como estamos preparando o monitoramento no Avito - nosso √∫ltimo artigo j√° estava em 2018 e, durante esse per√≠odo, houve v√°rias mudan√ßas interessantes na arquitetura de monitoramento, gerenciamento de gatilhos e notifica√ß√µes, v√°rias otimiza√ß√µes de dados no ClickHouse e outras inova√ß√µes, sobre o qual eu s√≥ quero lhe contar. </p><br><p><img src="https://habrastorage.org/webt/wy/zd/u6/wyzdu6fyb-3ehjdbzwi8jgxhvec.png"></p><a name="habracut"></a><br><p>  Mas vamos come√ßar em ordem. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Em 2017,</a> mostrei um diagrama da intera√ß√£o dos componentes que era relevante naquele momento e gostaria de demonstr√°-lo novamente para que voc√™ n√£o precise alternar as guias novamente. </p><br><p> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/4e9/d52/d3e/4e9d52d3e19df15d928d29d2394095fa.jpg"></a> </p><br><p>  A partir desse momento, aconteceu o seguinte. </p><br><ul><li><p> O n√∫mero de servidores no cluster Graphite aumentou de 3 para 6. <br>  ( <code>56 CPU 2.60GHz, 384GB RAM, 10 SSD SAS 745GB, Raid 6, 10GBit/s Net</code> ). </p><br></li><li><p>  Substitu√≠mos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">brubeck</a> por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bioyino</a> - nossa pr√≥pria implementa√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">StatsD</a> pelo Rust, e at√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">escrevemos um artigo</a> inteiro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sobre isso</a> .  No entanto, ap√≥s o lan√ßamento do artigo, criamos suporte para tags (Graphite) e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Raft nele</a> para selecionar um l√≠der. </p><br></li><li><p>  N√≥s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estudamos</a> a possibilidade de usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bioyino</a> como um agente StatsD e colocamos esses agentes ao lado das inst√¢ncias do mon√≥lito, bem como onde era necess√°rio nos k8s. </p><br></li><li><p>  Finalmente nos livramos do antigo sistema de monitoramento Munin (formalmente ainda o temos, mas seus dados n√£o s√£o mais usados). </p><br></li><li><p>  A coleta de dados dos clusters do Kubernetes foi organizada por meio do Prometheus / Federations, pois o Heapster n√£o era suportado em novas vers√µes do Kubernetes. </p><br></li></ul><br><h1 id="monitoring">  Monitoramento </h1><br><p>  Nos √∫ltimos dois anos, o n√∫mero de m√©tricas aceitas e processadas aumentou cerca de 9 vezes. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/r2/yu/zm/r2yuzm1rt5ok64zh2utwrpdtzbk.png"></a> </p><br><p>  A porcentagem de espa√ßo ocupado no servidor tamb√©m est√° aumentando inexoravelmente e estamos tomando v√°rias medidas para reduzi-lo.  Isso √© claramente vis√≠vel no gr√°fico. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/s2/uj/ml/s2ujmlqnrsoo0yb0kgtxkdcf4ek.png"></a> </p><br><p>  O que exatamente estamos fazendo? </p><br><ul><li>  Come√ßamos a aplicar m√©todos complexos de compacta√ß√£o em colunas de dados. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> graphite.data <span class="hljs-keyword"><span class="hljs-keyword">MODIFY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COLUMN</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span> UInt32 CODEC(Delta, ZSTD)</code> </pre> </li><li>  Continuamos a recolher dados com mais de cinco semanas, de intervalos de trinta segundos a cinco minutos.  Para fazer isso, temos uma tarefa cron, que uma vez por m√™s inicia (aproximadamente) o seguinte procedimento: </li></ul><br><pre> <code class="bash hljs">10 10 10 * * clickhouse-client -q <span class="hljs-string"><span class="hljs-string">"select distinct partition from system.parts where active=1 and database='graphite' and table='data' and max_date between today()-55 AND today()-35;"</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> PART; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> clickhouse-client -u systemXXX --password XXXXXXX -q <span class="hljs-string"><span class="hljs-string">"OPTIMIZE TABLE graphite.data PARTITION ('"</span></span><span class="hljs-variable"><span class="hljs-variable">$PART</span></span><span class="hljs-string"><span class="hljs-string">"') FINAL"</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><ul><li>  N√≥s compartilhamos tabelas de dados.  Agora, temos tr√™s shards com duas r√©plicas, cada uma com uma chave de sharding sharding em nome da m√©trica.  Essa abordagem nos d√° a oportunidade de executar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">procedimentos de rollup</a> , pois todos os valores para uma m√©trica espec√≠fica est√£o no mesmo shard e o espa√ßo em disco em todos os shards √© usado de maneira uniforme. </li></ul><br><p>  O esquema da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tabela distribu√≠da</a> √© o seguinte. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> graphite.data_all ( <span class="hljs-string"><span class="hljs-string">`Path`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span>, <span class="hljs-string"><span class="hljs-string">`Value`</span></span> Float64, <span class="hljs-string"><span class="hljs-string">`Time`</span></span> UInt32, <span class="hljs-string"><span class="hljs-string">`Date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, <span class="hljs-string"><span class="hljs-string">`Timestamp`</span></span> UInt32 ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">Distributed</span></span> ( <span class="hljs-string"><span class="hljs-string">'graphite_cluster'</span></span>, <span class="hljs-string"><span class="hljs-string">'graphite'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span>, jumpConsistentHash(cityHash64(<span class="hljs-keyword"><span class="hljs-keyword">Path</span></span>), <span class="hljs-number"><span class="hljs-number">3</span></span>) )</code> </pre> <br><p>  Tamb√©m atribu√≠mos ao usu√°rio direitos de leitura "padr√£o" e jogamos a execu√ß√£o de procedimentos de grava√ß√£o nas tabelas para um sistema de usu√°rio separado <code>systemXXX</code> . </p><br><p>  A configura√ß√£o do cluster Graphite no ClickHouse √© a seguinte. </p><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remote_servers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graphite_cluster</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse01<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse04<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse02<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse05<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internal_replication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse03<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span>graphite-clickhouse06<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span>9000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">port</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>systemXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span>XXXXXX<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">replica</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shard</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graphite_cluster</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">remote_servers</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Al√©m da carga de grava√ß√£o, o n√∫mero de solicita√ß√µes para ler dados do Graphite aumentou.  Esses dados s√£o usados ‚Äã‚Äãpara: </p><br><ul><li>  processamento de gatilho e gera√ß√£o de alerta; </li><li>  exibindo gr√°ficos em monitores no escrit√≥rio e telas de laptop e PC de um n√∫mero crescente de funcion√°rios da empresa. </li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/ch/rb/wh/chrbwhdiyl3x3cxjqmwgtohph6y.png"></a> </p><br><p>  Para impedir que o monitoramento se afogue sob essa carga, usamos outro hack: armazenamos os dados dos √∫ltimos dois dias em uma placa ‚Äúpequena‚Äù separada e enviamos todas as solicita√ß√µes de leitura dos √∫ltimos dois dias, reduzindo a carga na tabela principal do shard.  Tamb√©m para este tablet "pequeno", usamos um esquema de armazenamento m√©trico reverso, que acelerou bastante a pesquisa dos dados contidos nele e organizou uma parti√ß√£o di√°ria para ele.  O esquema desta placa √© o seguinte. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> graphite.data_reverse ( <span class="hljs-string"><span class="hljs-string">`Path`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span>, <span class="hljs-string"><span class="hljs-string">`Value`</span></span> Float64, <span class="hljs-string"><span class="hljs-string">`Time`</span></span> UInt32 CODEC(Delta(<span class="hljs-number"><span class="hljs-number">4</span></span>), ZSTD(<span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-string"><span class="hljs-string">`Date`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>, <span class="hljs-string"><span class="hljs-string">`Timestamp`</span></span> UInt32 ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span> = ReplicatedGraphiteMergeTree ( <span class="hljs-string"><span class="hljs-string">'/clickhouse/tables/{cluster}/data_reverse'</span></span>, <span class="hljs-string"><span class="hljs-string">'{replica}'</span></span>, <span class="hljs-string"><span class="hljs-string">'graphite_rollup'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Path</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Time</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SETTINGS</span></span> index_granularity = <span class="hljs-number"><span class="hljs-number">4096</span></span></code> </pre> <br><p>  Para direcionar dados, adicionamos uma nova se√ß√£o ao arquivo de configura√ß√£o do aplicativo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">carbon-clickhouse</a> . </p><br><pre> <code class="plaintext hljs">[upload.graphite_reverse] type = "points-reverse" table = "graphite.data_reverse" threads = 2 url = "http://systemXXX:XXXXXXX@localhost:8123/" timeout = "60s" cache-ttl = "6h0m0s" zero-timestamp = true</code> </pre> <br><p>  Para excluir parti√ß√µes com mais de dois dias, escrevemos uma tarefa cron.  Parece algo assim. </p><br><pre> <code class="bash hljs">1 12 * * * clickhouse-client -q <span class="hljs-string"><span class="hljs-string">"select distinct partition from system.parts where active=1 and database='graphite' and table='data_reverse' and max_date&lt;today()-2;"</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> PART; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> clickhouse-client -u systemXXX --password XXXXXXX -q <span class="hljs-string"><span class="hljs-string">"ALTER TABLE graphite.data_reverse DROP PARTITION ('"</span></span><span class="hljs-variable"><span class="hljs-variable">$PART</span></span><span class="hljs-string"><span class="hljs-string">"')"</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><p>  Para ler os dados da tabela, no arquivo de configura√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">grafite-clickhouse</a> , uma se√ß√£o foi adicionada: </p><br><pre> <code class="plaintext hljs">[[data-table]] table = "graphite.data_reverse" max-age = "48h" reverse = true</code> </pre> <br><p>  Como resultado, temos uma tabela com 100% dos dados replicados para todos os seis servidores que processam toda a carga de leitura de solicita√ß√µes com uma janela de menos de dois dias (e temos 95% deles).  E tamb√©m temos uma tabela fragmentada com 1/3 dos dados em cada shard, que fornece a leitura de todos os dados hist√≥ricos.  E mesmo que essas solicita√ß√µes sejam muito menores, a carga delas √© muito maior. </p><br><p>  O que est√° acontecendo com a CPU ?!  Como resultado do aumento no volume de dados gravados e lidos no cluster Graphite, a carga total da CPU nos servidores tamb√©m aumentou.  Parece algo assim. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/_u/mg/m3/_umgm3dd9lgetkopu45jjrqqodw.png"></a> </p><br><p>  Gostaria de chamar a aten√ß√£o para as seguintes nuances: metade da CPU vai para an√°lise e processamento prim√°rio de m√©tricas em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rel√© carbono-c</a> (v3.2 de 05-09-2018, que √© respons√°vel pelo transporte de m√©tricas), localizado em tr√™s dos seis servidores.  Como voc√™ pode ver no gr√°fico, s√£o esses tr√™s servidores que est√£o no TOP. </p><br><h1 id="alerting">  Alerta </h1><br><p>  Como sistema de alerta, ainda temos o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Moira</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cliente</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">moira</a> escritos para ele.  Para um gerenciamento flex√≠vel de gatilhos, notifica√ß√µes e escala√ß√µes, usamos uma descri√ß√£o declarativa chamada alert.yaml.  Ele √© gerado automaticamente quando um servi√ßo √© criado via PaaS (mais sobre isso pode ser encontrado no artigo de Vadim Madison <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúO que sabemos sobre microsservi√ßos‚Äù</a> ) e √© colocado em seu reposit√≥rio.  Para trabalhar com alert.yaml, criamos uma liga√ß√£o no moira-client e chamamos de alert-autoconf (estamos planejando abrir).  H√° uma etapa na montagem do servi√ßo no TeamCity com a exporta√ß√£o de gatilhos e notifica√ß√µes para o Moira via alert-autoconf.  Ao confirmar as altera√ß√µes no alert.yaml, s√£o executados testes autom√°ticos que verificam a validade do arquivo yaml e tamb√©m fazem solicita√ß√µes ao Graphite para cada modelo de m√©trica, a fim de verificar sua corre√ß√£o. </p><br><p>  Para equipes de infraestrutura que n√£o usam PaaS, organizamos um reposit√≥rio separado chamado Alerting.  Ele criou a estrutura do formul√°rio: Team / Project / alert.yaml.  Para cada alert.yaml, geramos um assembly separado no TeamCity, que executa testes e envia o conte√∫do do alert.yaml no Moira. </p><br><p>  Assim, todos os nossos funcion√°rios podem gerenciar seus gatilhos, notifica√ß√µes e escala√ß√µes usando uma √∫nica abordagem. </p><br><p>  Como antes j√° t√≠nhamos gatilhos acionados por meio da GUI, implementamos a capacidade de envi√°-los no formato yaml.  O conte√∫do do documento yaml recebido pode ser inserido em alert.yaml praticamente sem transforma√ß√µes adicionais e, em seguida, envie as altera√ß√µes ao assistente.  Durante a compila√ß√£o, o alert-autoconf entender√° que esse gatilho j√° existe e o registrar√° em nosso registro no Redis. </p><br><p>  E n√£o faz muito tempo, recebemos uma troca de engenheiros 24x7.  Para transferir gatilhos para eles para manuten√ß√£o, basta o seu alerta.yaml preencher corretamente a descri√ß√£o de "o que fazer se voc√™ o vir", colocar a tag [24x7] e enviar as altera√ß√µes ao assistente.  Ap√≥s rolar alert.yaml, todos os gatilhos descritos nele cair√£o automaticamente no monitoramento de turno de 24 horas 24x7.  U - Simplifique!  Beleza! </p><br><h1 id="sbor-biznes-metrik">  Cole√ß√£o de m√©tricas de neg√≥cios </h1><br><p>  Desde o √∫ltimo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> sobre a coleta e o processamento de m√©tricas de neg√≥cios, nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bioyino se</a> tornou ainda melhor. </p><br><ol><li>  Em vez de escolher um l√≠der atrav√©s do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Consul</a> , a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jangada interna √© usada</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">As tags s√£o</a> processadas corretamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no formato Grafite</a> . </li><li>  Agora voc√™ pode usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bioyino</a> (servidor StatsD) como um agente. </li><li>  Para contar valores exclusivos, o formato "set" √© suportado. </li><li>  A agrega√ß√£o final de m√©tricas pode ser feita em v√°rios threads. </li><li>  Os dados podem ser enviados para peda√ßos de grafite em v√°rias conex√µes paralelas. </li><li>  Corrigidos todos os erros encontrados. </li></ol><br><p>  Agora funciona assim. </p><br><p>  Come√ßamos a apresentar ativamente os agentes StatsD ao lado de todos os grandes geradores de m√©tricas grandes: em cont√™ineres com inst√¢ncias de mon√≥lito, em pods de k8s pr√≥ximos a servi√ßos, em hosts com componentes de infraestrutura etc. <br>  O agente Statsd est√° localizado pr√≥ximo ao aplicativo.  Ele leva m√©tricas desse aplicativo da mesma forma sobre o UDP, mas n√£o usa mais o subsistema de rede (devido a otimiza√ß√µes no kernel do Linux).  Todos os eventos s√£o pr√©-agregados e os dados coletados a cada segundo (o intervalo pode ser configurado) s√£o enviados para o cluster principal dos servidores StatsD (bioyino0 [1-3]) no formato Cap'n Proto. </p><br><p>  O processamento e agrega√ß√£o de m√©tricas adicionais, a escolha de um l√≠der no cluster StatsD e o envio das m√©tricas pelo l√≠der √† Graphite permaneceram praticamente inalterados.  Voc√™ pode ler sobre isso em detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em nosso √∫ltimo artigo</a> . </p><br><p>  Quanto aos n√∫meros, eles s√£o os seguintes. </p><br><p>  <em>Gr√°fico de eventos StatsD recebidos</em> <br> <a href=""><img src="https://habrastorage.org/webt/m2/td/56/m2td56sycgexhmsupyp7nfmp2hw.png"></a> <br><img src="https://habrastorage.org/webt/np/5m/hi/np5mhi_4z6pfwpdpbvzfamn7fws.png"></p><br><p>  <em>Gr√°fico de m√©tricas enviadas de StatsD para Graphite</em> <br> <a href=""><img src="https://habrastorage.org/webt/m2/td/56/m2td56sycgexhmsupyp7nfmp2hw.png"></a> </p><br><h1 id="itogo">  Total </h1><br><p>  O esquema geral de intera√ß√£o entre os componentes de monitoramento no momento se parece com isso. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/n6/ym/-b/n6ym-bcuyt3a3ctoda93lassduo.png"></a> </p><br><p>  N√∫mero total de m√©tricas: 2 189 484 898 474. <br>  Profundidade total de armazenamento de m√©tricas: 3 anos. <br>  O n√∫mero de nomes de m√©tricas exclusivos: 6 585 413 171. <br>  N√∫mero de gatilhos: 1053, eles veiculam de 1 a 15 mil m√©tricas. </p><br><p>  <strong>Planos para o futuro pr√≥ximo:</strong> </p><br><ul><li>  come√ßar a mover os servi√ßos do produto para um esquema de armazenamento m√©trico marcado; </li><li>  adicione mais tr√™s servidores ao cluster Graphite; </li><li>  fa√ßa amigos em Moira com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tecido persistente</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Encontre</a> outro desenvolvedor na equipe de monitoramento. </li></ul><br><p>  Ficarei feliz em comentar e fazer perguntas aqui - escreva.  E tamb√©m vou me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">apresentar no Highload ++ no dia 7 de novembro</a> , se voc√™ estiver l√°, podemos conversar. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt467995/">https://habr.com/ru/post/pt467995/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt467981/index.html">Servidor de rack Cisco UCS C240 ‚Äã‚ÄãM5 Anboxing</a></li>
<li><a href="../pt467983/index.html">Por que voc√™ deve expulsar o MVP de seus projetos</a></li>
<li><a href="../pt467987/index.html">Gel√©ia colorida e animada: tomada de decis√£o em n√≠vel de material sem CPU</a></li>
<li><a href="../pt467989/index.html">Como projetar uma unidade de controle de suspens√£o de carro</a></li>
<li><a href="../pt467991/index.html">Quanto os sal√°rios regionais dos desenvolvedores s√£o diferentes de Moscou, dado o custo de vida</a></li>
<li><a href="../pt467997/index.html">A arquitetura do software √© superestimada, o design simples √© subestimado</a></li>
<li><a href="../pt467999/index.html">Para a quest√£o do VNA ou dispositivo japon√™s-chin√™s</a></li>
<li><a href="../pt468001/index.html">Voc√™ n√£o acha: os programas realmente se tornaram mais caros</a></li>
<li><a href="../pt468003/index.html">Ferro de 5 GHz: uma hist√≥ria sobre como criar um VDS superfast</a></li>
<li><a href="../pt468005/index.html">Diga uma palavra sobre apoio glorioso (24 de setembro, Moscou)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>