<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏻‍💼 🐭 👘 Kami menulis bahasa pemrograman kami, bagian 2: representasi program menengah 👩‍⚕️ 🐑 🙎🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pendahuluan 
 Salam kepada semua yang mampir untuk membaca artikel saya berikutnya. 

 Saya ulangi, saya menggambarkan penciptaan bahasa bahasa pemrog...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami menulis bahasa pemrograman kami, bagian 2: representasi program menengah</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435258/"><img src="https://habrastorage.org/getpro/habr/post_images/a7b/73c/8de/a7b73c8de7e52b3cd9fa2869bae47119.png" alt="gambar"><br><br><h3>  Pendahuluan </h3><br>  Salam kepada semua yang mampir untuk membaca artikel saya berikutnya. <br><br>  Saya ulangi, saya menggambarkan penciptaan bahasa bahasa pemrograman berdasarkan karya sebelumnya, yang hasilnya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dijelaskan dalam posting ini</a> . <br><br>  Pada bagian pertama (tautan: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/post/435202</a> ) saya menjelaskan tahapan merancang dan menulis bahasa VM yang akan mengeksekusi aplikasi masa depan kita dalam bahasa masa depan kita. <br>  Pada artikel ini, saya berencana untuk menggambarkan tahapan utama pembuatan bahasa pemrograman perantara yang akan dirangkai menjadi bytecode abstrak untuk eksekusi langsung pada VM kami. <br><br>  Saya pikir tidak ada salahnya untuk segera memberikan tautan ke situs web proyek dan repositori-nya. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Situs</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Repositori</a> <br><a name="habracut"></a><br>  Saya harus segera mengatakan bahwa semua kode ditulis dalam FPC dan saya akan memberikan contohnya. <br><br>  Jadi, kita memulai pencerahan kita. <br><br><h3>  Mengapa kami menyerahkan bahasa perantara? </h3><br>  Penting untuk dipahami bahwa mengonversi program dari bahasa tingkat tinggi langsung ke bytecode yang dapat dieksekusi, yang terdiri dari sekumpulan instruksi terbatas, sangat sepele sehingga lebih baik untuk menyederhanakannya dengan urutan besarnya dengan menambahkan bahasa perantara ke proyek.  Adalah jauh lebih baik untuk menyederhanakan kode secara bertahap daripada segera menyajikan ekspresi matematika, struktur, dan kelas dengan satu set opcodes.  Ngomong-ngomong, ini adalah cara kerja sebagian besar penerjemah dan kompiler pihak ketiga. <br><br>  Dalam artikel saya sebelumnya, saya menulis tentang bagaimana mengimplementasikan VM bahasa.  Sekarang kita perlu mengimplementasikan bahasa seperti assembler untuk itu dan fungsionalitas untuk menulis lebih lanjut penerjemah.  Pada tahap ini, kami meletakkan dasar untuk proyek masa depan.  Perlu dipahami bahwa semakin baik fondasi, semakin curam bangunan. <br><br><h3>  Kami mengambil langkah pertama untuk mewujudkan keajaiban ini </h3><br>  Sebagai permulaan, ada baiknya menetapkan tujuan.  Apa yang sebenarnya akan kita tulis?  Apa karakteristik yang harus dimiliki kode akhir dan apa yang harus dilakukan? <br><br>  Saya dapat membuat daftar bagian fungsional utama yang bagian dari proyek ini harus terdiri: <br><br><ul><li>  Assembler sederhana.  Mengubah instruksi sederhana menjadi satu set opcode untuk VM. </li><li>  Implementasi dasar fungsional untuk mengimplementasikan variabel. </li><li>  Implementasi dasar fungsional untuk bekerja dengan konstanta. </li><li>  Fungsi untuk mendukung titik masuk ke metode dan menghitung alamat mereka pada tahap terjemahan. </li><li>  Mungkin beberapa roti lebih fungsional. </li></ul><br>  Ilustrasi di atas menunjukkan fragmen kode dalam bahasa perantara yang dikonversi menjadi kode untuk VM oleh penerjemah primitif, yang akan dibahas. <br><br>  Jadi, tujuannya sudah ditetapkan, mari kita lanjutkan ke implementasi. <br><br><h3>  Menulis assembler sederhana </h3><br>  Kami bertanya pada diri sendiri apa itu assembler? <br><br>  Sebenarnya, ini adalah program yang melakukan penggantian opcodes alih-alih deskripsi tekstualnya. <br><br>  Pertimbangkan kode ini: <br><br><pre><code class="bash hljs">push 0 push 1 add peek 2 pop</code> </pre> <br>  Setelah memproses kode assembler, kami mendapatkan kode yang dapat dieksekusi untuk VM. <br><br>  Kita melihat bahwa instruksinya bisa bersuku kata satu dan bersuku kata satu.  Tidak ada instruksi yang lebih rumit untuk VM yang ditumpuk. <br><br>  Kami membutuhkan kode yang dapat mengekstrak token dari string (kami memperhitungkan bahwa mungkin ada string di antara mereka). <br><br>  Kami menulisnya: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">; w: word)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (length(s) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (w &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'"'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); Result := copy(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">'"'</span></span>, s) - <span class="hljs-number"><span class="hljs-number">1</span></span>); Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">'"'</span></span>, s)); s := trim(s); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Pos(<span class="hljs-string"><span class="hljs-string">' '</span></span>, s) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := copy(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">' '</span></span>, s) - <span class="hljs-number"><span class="hljs-number">1</span></span>); Delete(s, <span class="hljs-number"><span class="hljs-number">1</span></span>, pos(<span class="hljs-string"><span class="hljs-string">' '</span></span>, s)); s := trim(s); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := s; s := <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; Dec(w); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  Ok, sekarang kita perlu mengimplementasikan sesuatu seperti konstruk kasus saklar untuk setiap pernyataan, dan assembler sederhana kita sudah siap. <br><br><h3>  Variabel </h3><br>  Ingatlah bahwa VM kami memiliki array pointer untuk mendukung variabel dan, karenanya, pengalamatan statis.  Ini berarti bahwa fungsional untuk bekerja dengan variabel dapat direpresentasikan sebagai TStringList, di mana string adalah nama-nama variabel dan indeks mereka adalah alamat statis mereka.  Harus dipahami bahwa duplikasi nama variabel dalam daftar ini tidak dapat diterima.  Saya pikir Anda dapat membayangkan kode yang diperlukan dan / atau bahkan menulisnya sendiri. <br><br>  Jika Anda ingin melihat implementasi yang telah selesai, maka Anda dipersilakan: /lang/u_variables.pas <br><br><h3>  Konstanta </h3><br>  Prinsip di sini sama dengan variabel, tetapi ada satu hal.  Untuk mengoptimalkan, lebih baik mengikat bukan pada nama konstanta, tetapi pada nilainya.  Yaitu  setiap nilai konstan dapat memiliki TStringList, yang akan berfungsi untuk menyimpan nama-nama konstanta dengan nilai ini. <br>  Untuk konstanta, Anda harus menentukan tipe data dan, karenanya, untuk menambahkannya ke bahasa, Anda harus menulis parser kecil. <br><br>  Implementasi: /lang/u_consts.pas <br><br><h3>  Metode Titik Masuk </h3><br>  Untuk menerapkan pemblokiran kode, dukungan untuk desain yang berbeda, dll.  dukungan untuk fungsi ini harus diimplementasikan di tingkat assembler. <br><br>  Pertimbangkan contoh kode: <br><br><pre> <code class="bash hljs">Summ: peek 0 pop peek 1 pop push 0 new peek 2 mov push 2 push 0 add jr</code> </pre> <br>  Di atas adalah contoh terjemahan dari metode Summ: <br><br><pre> <code class="ruby hljs">func Summ(a, b): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Harus dipahami bahwa tidak ada opcode untuk titik masuk.  Apa itu titik masuk ke metode Summ?  Nomor utama ini adalah offset dari titik masuk opcode berikutnya.  (offset opcode adalah jumlah opcode relatif terhadap awal bytecode abstrak yang dapat dieksekusi).  Sekarang kita memiliki tugas - kita perlu menghitung offset ini pada tahap kompilasi dan, sebagai opsi, menyatakan konstanta Summ sebagai angka ini. <br><br>  Kami menulis untuk ini penghitung bobot tertentu untuk setiap operator.  Kami memiliki operator bersuku kata satu sederhana, misalnya "pop".  Mereka menempati 1 byte.  Ada yang lebih kompleks, misalnya, "push 123" - mereka menempati 5 byte, 1 untuk opcode dan 4 untuk tipe int unsigned. <br><br>  Inti dari kode untuk menambahkan dukungan untuk assembler titik masuk: <br><br><ol><li>  Kami memiliki penghitung, misalkan i = 0. </li><li>  Kami menjalankan kode, jika kami memiliki konstruksi tipe "push 123", kemudian tambahkan 5 untuk itu, jika opcode sederhana adalah 1. Jika kami memiliki titik masuk, kemudian lepaskan dari kode dan nyatakan konstanta yang sesuai dengan nilai penghitung dan nama titik masuk. </li></ol><br><h3>  Fungsionalitas lainnya </h3><br>  Ini, misalnya, adalah konversi kode sederhana sebelum diproses. <br><br><h3>  Ringkasan </h3><br>  Kami telah menerapkan assembler kecil kami.  Kami akan membutuhkannya untuk mengimplementasikan penerjemah yang lebih kompleks berdasarkan itu.  Sekarang kita dapat menulis program kecil untuk VM kita.  Dengan demikian, dalam artikel selanjutnya proses penulisan penerjemah yang lebih kompleks akan dijelaskan. <br><br>  Terima kasih telah membaca sampai akhir jika Anda melakukannya. <br><br>  Jika ada sesuatu yang tidak jelas bagi Anda, maka saya menunggu komentar Anda. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id435258/">https://habr.com/ru/post/id435258/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id435248/index.html">Navigasi di dalam aplikasi Android</a></li>
<li><a href="../id435250/index.html">Bagaimana Universitas ITMO bekerja: tur laboratorium cyberphysical kami</a></li>
<li><a href="../id435252/index.html">Jessica Livingston: “Bagaimana Kami Menciptakan Y Combinator. Komponen emosional "</a></li>
<li><a href="../id435254/index.html">Penanganan kesalahan fungsional di Kotlin menggunakan Panah</a></li>
<li><a href="../id435256/index.html">Kami menilai perekrut melalui surat dingin</a></li>
<li><a href="../id435260/index.html">Mengimplementasikan hot reload kode C ++ di Linux</a></li>
<li><a href="../id435262/index.html">Li-Fi: Masa Depan Internet</a></li>
<li><a href="../id435264/index.html">Mengedit harga dalam RMK. 1C: Manajemen Perdagangan 11</a></li>
<li><a href="../id435268/index.html">Jangan perlakukan aku, dokter</a></li>
<li><a href="../id435270/index.html">Amankan kunci SSH</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>