<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüë¶ üóØÔ∏è üëÉüèº ¬øC√≥mo hacemos Sportmaster? üê° üöº üéôÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Estoy seguro de que muchos de ustedes alguna vez han comprado una camiseta, pelota, zapatillas de deporte, bueno, o alg√∫n otro equipo de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øC√≥mo hacemos Sportmaster?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sportmaster_lab/blog/456926/"> Hola a todos!  Estoy seguro de que muchos de ustedes alguna vez han comprado una camiseta, pelota, zapatillas de deporte, bueno, o alg√∫n otro equipo deportivo en nuestras tiendas, pero pocas personas saben qu√© es Sportmaster desde un punto de vista t√©cnico. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/_s/2g/78/_s2g78t3lwucifnjqtiod7yatja.png"></a> <br>  <i>Un poco de 2003 Sportmaster de web.archive.org</i> <br><br>  Mi nombre es Dmitry, soy desarrollador senior de Java en Sportmaster, y hoy me gustar√≠a hablar sobre nuestra tienda en l√≠nea, sobre qu√© camino sigui√≥ para convertirse en la forma en que lo conoces ahora: c√≥mo comenzamos, c√≥mo nos desarrollamos qu√© sucedi√≥ y qu√© no, sobre los problemas de hoy y sobre los planes para el futuro.  Interesante?  ¬°Bienvenido a cat! <br><a name="habracut"></a><br>  La historia de la presencia de nuestra empresa en la web comenz√≥ ya en 1999 con el primer sitio del Sportmaster, que era solo una tarjeta de presentaci√≥n y un cat√°logo de productos para compradores mayoristas.  En realidad, la tienda en l√≠nea de la compa√±√≠a tiene su historia desde 2001.  En aquellos d√≠as, la compa√±√≠a no ten√≠a su propio equipo para desarrollar proyectos en l√≠nea, y la tienda en l√≠nea logr√≥ cambiar varias plataformas de fabricaci√≥n propia (ahora ni siquiera recordamos cu√°ntas).  La primera soluci√≥n relativamente estable para nosotros fue creada por el pr√≥ximo integrador en 2011 en PHP, basado en CMS 1C Bitrix.  El sitio result√≥ ser simple, de hecho, se utiliz√≥ la funcionalidad en caja de Bitrix, con peque√±as personalizaciones para realizar un pedido.  Para el hardware, la configuraci√≥n inicial inclu√≠a 2 servidores de aplicaciones y un servidor de base de datos. <br><br>  Mientras tanto, la compa√±√≠a comenz√≥ a desarrollar activamente sus propias competencias en el campo de las ventas en l√≠nea, principalmente del lado del negocio, que, debo decir, se desarroll√≥ bastante r√°pido, y el equipo de desarrollo se vio obligado a crecer r√°pidamente en todos los sentidos para satisfacer sus necesidades.  En menos de un a√±o, tres equipos comenzaron a responder de inmediato por el desarrollo y el soporte del sitio: el integrador mismo, el equipo interno del Sportmaster, que en ese momento consist√≠a en unas pocas personas y otro contratista, su apariencia, de hecho, se debi√≥ al hecho de que el integrador en ese momento no pod√≠a proporcionar las capacidades que necesit√°bamos para las personas. <br><br>  ¬øQu√© problemas tuvimos en ese momento?  Hubo muchos problemas, pero el m√°s importante es el funcionamiento inestable de nuestra tienda en l√≠nea. <br><br>  Podr√≠amos caer incluso por el hecho de que el negocio llev√≥ a cabo alg√∫n tipo de bolet√≠n informativo, despu√©s del cual ~ 2000-2500 personas llegaron al sitio o, como recuerdo ahora, un banner publicitario en Yandex nos envi√≥ a una profunda ca√≠da.  Por supuesto, tales cosas son inaceptables, porque esto no solo es la p√©rdida de ganancias, sino tambi√©n la imagen de la empresa; en general, entendimos que algo necesitaba ser cambiado.  En primer lugar, se dio cuenta de que las soluciones est√°ndar con nuestras cargas de trabajo (en ese momento no muy grandes, pero a√∫n as√≠ no peque√±as) no funcionar√≠an.  Luego tuvimos ~ 1000 visitantes en l√≠nea normalmente, ~ 2500 en el pico, m√°s planes de desarrollo x2 anualmente. <br><br>  Se intensific√≥ de inmediato en t√©rminos de hardware: agregamos 2 servidores de aplicaciones m√°s e hicimos un cl√∫ster de 2 servidores de bases de datos.  Nuestra pila en ese momento era nginx, MySQL, PHP.  Paralelamente, intentamos optimizar la soluci√≥n actual: buscamos cuellos de botella, intentamos reescribir todo lo que era posible.  Como nuestro cuello de botella era la base, siempre fue el primero en "morir", decidimos descargarlo al m√°ximo.  Se implement√≥ la esfinge para la b√∫squeda de texto completo y la salida de mosaicos con facetas por los filtros seleccionados y las cach√©s conectadas.  Y listo, esas cargas que resultaron ser fatales para nosotros ayer, comenzamos a aguantar con facilidad. <br><br>  Junto con esto, se lanz√≥ un piloto en paralelo, dentro del marco del cual quer√≠an llevar a cabo una actualizaci√≥n tecnol√≥gica del sitio: la transferencia a una plataforma fundamentalmente diferente.  Hab√≠a muchas ideas e ideas: en ese momento, la personalizaci√≥n de todo y de todo, las recomendaciones personales, los correos, los descuentos y otras cosas √∫tiles estaban ganando popularidad, y, por supuesto, tambi√©n quer√≠amos usar todo esto.  Analizamos lo que estaba disponible en el mercado a partir de esto, bueno, y compramos la plataforma m√°s cara seg√∫n el principio de "Una vez m√°s caro, luego m√°s fresco".  La implementaci√≥n se plane√≥ con la ayuda de un integrador, y todav√≠a cont√°bamos con el apoyo y el desarrollo de la IM condicionalmente antigua hasta que la nueva se puso en funcionamiento en la nueva plataforma. <br><br>  Pero dado que la velocidad del desarrollo funcional del sitio actual era muy alta, decidimos que comenzar√≠amos a implementar la nueva plataforma de comercio electr√≥nico desde la tienda en l√≠nea m√°s peque√±a y sencilla de la cadena minorista de Austin, que tambi√©n fue atendida por el equipo IT Sportmaster.  En el proceso, nos dimos cuenta de que la cosa era fuerte y funcionalmente sofisticada, pero tecnol√≥gicamente obsoleta, y encontrar personas para implementarlo completamente result√≥ ser un gran problema.  Adem√°s, el dimensionamiento realizado antes del inicio del proyecto redujo los requisitos de hardware y la cantidad de licencias, la vida result√≥ ser mucho m√°s cruel.  En general, entendimos una cosa: no haremos un Sportmaster al respecto.  Y dado que el equipo para migrar a la plataforma ya estaba en proceso de reclutamiento, los muchachos decidieron comenzar a crear prototipos de su propia soluci√≥n, en funci√≥n de los requisitos establecidos por el negocio para la nueva plataforma. <br><br>  La pila de tecnolog√≠a se seleccion√≥ de la siguiente manera: Java, Spring, Tomcat, ElasticSearch, Hazelcast. <br><br>  Como resultado, a finales de 2014, ten√≠amos una nueva versi√≥n de mensajer√≠a instant√°nea lista, completamente autoescrita, a la que nos cambiamos con √©xito.  Ella es la primera versi√≥n del sitio que ves hoy.  Naturalmente, la versi√≥n actual es mucho m√°s funcional y tecnol√≥gica, pero la plataforma b√°sica es la misma. <br><br><h2>  Tareas principales </h2><br>  Por supuesto, cuando hablamos de una gran tienda en l√≠nea, estamos hablando de la voluntad de hacer frente no solo a las cargas diarias, sino tambi√©n a las cargas m√°ximas, para ser estables para las empresas y los usuarios finales. <br><br>  Los principales enfoques aqu√≠ son la capacidad de escalar horizontalmente y la aplicaci√≥n de enfoques de almacenamiento en cach√© de datos en diferentes niveles.  Y ahora, como hace alg√∫n tiempo, decidimos optimizar el acceso a nuestros datos.  Pero no podemos usar el almacenamiento en cach√© de p√°gina normal.  En general  Este es un requisito comercial, y el requisito es bastante razonable: si muestra un precio incorrecto o la disponibilidad incorrecta de los bienes en un momento determinado al usuario del sitio, lo m√°s probable es que esto conduzca a un rechazo de la compra y una disminuci√≥n de la lealtad del cliente. <br><br>  Y est√° bien si el cliente orden√≥ 15 pares de calcetines por 299 rublos, y en la tienda descubri√≥ que, de hecho, solo hay 14 pares y 300 rublos cada uno, de alguna manera puede vivir con ellos.  Acepta, compra lo que es y vive con esta cicatriz en tu alma.  Pero si las discrepancias en los n√∫meros son graves, o si estaba buscando un tama√±o espec√≠fico, y se agot√≥ mientras le√≠a las rese√±as de los felices propietarios de pantalones cortos a cuadros, aqu√≠ todo es m√°s triste.  Es decir, inmediatamente la p√©rdida de un cliente satisfecho (hasta este punto) y la p√©rdida de tiempo y dinero en el trabajo del centro de llamadas, donde este cliente llamar√° para averiguar qu√© sucedi√≥ y por qu√©. <br><br>  Por lo tanto, el usuario siempre debe ver el √∫ltimo precio y los datos m√°s actuales sobre saldos de productos b√°sicos y, por lo tanto, nuestros cach√©s son inteligentes y saben cu√°ndo cambian los datos en la base de datos.  Para el almacenamiento en cach√© usamos Hazelcast. <br><br><h2>  Por cierto, sobre las sobras </h2><br>  Es importante se√±alar aqu√≠ que la profundidad de los residuos de productos b√°sicos es muy peque√±a.  Y una gran cantidad de pedidos van a recoger (muy).  Por lo tanto, el cliente normalmente debe reservar los productos en la tienda correcta y realizar un seguimiento de los saldos.  En un momento, en Bitrix, el problema de los residuos fue abordado por el hecho de que simplemente consideraban que cualquier remanente de m√°s de 10 unidades era infinito.  Es decir, todo lo que es m√°s de 10 siempre es igual a 10, pero los valores m√°s bajos ya son interesantes para que los calculemos y los tomamos en cuenta, los subimos al sitio. <br><br>  Ahora ya no es posible hacer esto, por lo que descargamos los restos de todas las tiendas cada 15 minutos.  Y tenemos alrededor de 500 tiendas, adem√°s de varios almacenes regionales, adem√°s de varias cadenas minoristas.  Y todo esto debe actualizarse con prontitud.  La clave aqu√≠ es el hecho de que las condiciones de trabajo de las empresas de mensajer√≠a a menudo cambian en la escala de la Federaci√≥n de Rusia, por lo tanto, los par√°metros de entrega tambi√©n deben cargarse.  Adem√°s, se entrega un flujo continuo de bienes a los almacenes de la compa√±√≠a, por lo que se espera que cambie la cantidad de bienes en los almacenes.  Por lo tanto, tambi√©n debe ser retirado nuevamente. <br><br>  Y as√≠ es como se forman los identificadores de art√≠culos de productos b√°sicos (SKU).  Tenemos alrededor de 40,000, los llamados modelos de productos en color.  Si vamos m√°s all√° del tama√±o de los productos, obtenemos aproximadamente 200,000 SKU.  Y para todo esto, 200,000 necesitan ser actualizados en la escala de 500 tiendas. <br><br>  Tambi√©n tenemos decenas de miles de ciudades y pueblos a los que entregamos productos desde tiendas o desde almacenes.  Por lo tanto, resulta que la variabilidad de cach√© para solo una p√°gina de producto (ciudad * SKU) es una millon√©sima parte de un valor.  Nuestro enfoque es el siguiente: el c√°lculo de la disponibilidad de una unidad de producto en particular se produce sobre la marcha cuando el usuario ingresa la tarjeta del producto.  Observamos el trabajo de los correos en la regi√≥n del usuario, observamos su horario de trabajo, calculamos la cadena de entrega y consideramos su duraci√≥n.  Junto con esto, los restos en las tiendas cercanas se analizan en paralelo, desde donde se puede organizar el transporte. <br><br>  Para facilitar la gesti√≥n de todo esto, tenemos un cierto n√∫mero de cach√©s muy r√°pidos en la aplicaci√≥n, gracias a esto podemos obtener r√°pidamente todos los datos necesarios por ID y clasificarlos sobre la marcha.  Lo mismo con los correos: los agrupamos en grupos y luego los grupos ya est√°n guardados en la base de datos.  Cada 15 minutos, todo esto se actualiza, para cada solicitud entrante calculamos un cierto grupo de correos con los par√°metros necesarios, los agregamos y los entregamos r√°pidamente al comprador; todo est√° bien, definitivamente tenemos esos pantalones cortos verdes de tama√±o 50, puede elija con bol√≠grafos en estas tres tiendas cercanas en este momento, o ordene en una tienda al otro lado de la carretera (o incluso en casa) durante 3 d√≠as, elija. <br><br>  Para Mosc√∫, esta situaci√≥n puede parecer innecesaria, pero para las regiones este es un asunto completamente diferente, a menudo solicitan productos a algunas de las tiendas (que, tal vez, tambi√©n es necesario acceder especialmente). <br><br><h2>  Figuras </h2><br>  Ahora el sitio recibe miles de solicitudes por segundo, teniendo en cuenta las estad√≠sticas y 500-1000 solicitudes por segundo a los servidores de aplicaciones.  El n√∫mero de servidores de aplicaciones no ha cambiado, pero su configuraci√≥n ha crecido significativamente.  Se obtiene un promedio de aproximadamente 3,000,000 de visitas por d√≠a. <br><br>  Los DDoS a veces se encuentran en el sitio.  Al mismo tiempo, est√°n tocando con botnets, adem√°s, nuestros familiares de la Federaci√≥n Rusa.  Hace mucho tiempo hubo casos de intentos de tocar redes de bots de M√©xico y Taiw√°n, pero ahora ya no es as√≠. <br><br>  Hay una serie de soluciones para la protecci√≥n de la nube contra DDoS en el mercado, s√≠, y muy buenas.  Pero para ciertas pol√≠ticas de seguridad, no podemos usar este tipo de soluciones en la nube. <br><br><h2>  Que ahora </h2><br>  Comenzamos a hacer una soluci√≥n de plataforma, separando los equipos no verticalmente (algunos de ellos vieron un sitio, y el segundo vio otro), sino horizontalmente, resaltando la capa de plataforma com√∫n, dividi√©ndola en partes, formando un equipo a su alrededor.  Y en ellos ya estamos cerrando el sitio y no solo, incluidos los clientes de la empresa, tanto externos como internos.  Por lo tanto, tenemos mucho trabajo complejo e interesante. <br><br>  La pila en el frente, por razones obvias, realmente no ha cambiado durante este tiempo: Java, Spring, Tomcat, ElasticSearch, Hazelcast siguen siendo buenos para nuestras necesidades.  Otra cosa es que ahora muchos sistemas de back-office en diversas tecnolog√≠as est√°n ocultos detr√°s del sitio.  Y, por supuesto, la reingenier√≠a est√° en marcha (porque las solicitudes de sistemas internos y trabajar con ellos en su conjunto deben optimizarse, adem√°s no nos olvidamos de los requisitos comerciales y las nuevas funciones comerciales). <br><br>  Y puede enviarme de forma segura (en comentarios) cualquier sugerencia sobre c√≥mo mejorar el sitio, tanto en t√©rminos de nuevas caracter√≠sticas como del componente visual y la experiencia general del usuario.  Intentaremos responder r√°pidamente y tener en cuenta todo.  Y si quieres formar parte del equipo y lo viste todo desde adentro, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bienvenido</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/456926/">https://habr.com/ru/post/456926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456910/index.html">Internet project security.txt - conociendo otro archivo .well conocido</a></li>
<li><a href="../456912/index.html">C√≥mo hacer sitios en 2019</a></li>
<li><a href="../456916/index.html">Compilaci√≥n cruzada en docker. Por que no</a></li>
<li><a href="../456920/index.html">Sony Xperia 1 en Rusia - bonificaciones de precio y pre-pedido</a></li>
<li><a href="../456922/index.html">C√≥mo se dise√±an y fabrican los procesadores: los fundamentos de la arquitectura inform√°tica</a></li>
<li><a href="../456928/index.html">JMeter - Cuchillo suizo de prueba (Parte 1)</a></li>
<li><a href="../456930/index.html">Trayendo IoT a las masas: resultados del primer hackathon IoT de GeekBrains y Rostelecom</a></li>
<li><a href="../456932/index.html">OpenGL ultramoderno. Parte 1</a></li>
<li><a href="../456938/index.html">Lanzamiento de una aplicaci√≥n de taxis en Tokio: ¬øC√≥mo lo hace Sony con S. Ride?</a></li>
<li><a href="../456942/index.html">El dios de muchos brazos de la fecha l√≠mite o el uso generalizado de la anal√≠tica.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>