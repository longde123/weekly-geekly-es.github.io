<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÑ üë©‚Äçüî¨ üë©üèø‚Äçü§ù‚Äçüë®üèº Uma porta que nos recebe pelo nome e se abre apenas para funcion√°rios do departamento üßòüèæ ü§∞üèº üë®‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tivemos alguns dias entre grandes projetos e decidimos zombar da porta do chefe da unidade. Apenas por divers√£o. Porque os drones j√° nos reconhecem em...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Uma porta que nos recebe pelo nome e se abre apenas para funcion√°rios do departamento</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/technoserv/blog/416179/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ed/o1/ic/edo1icwv2pvgxsdtgn8g65lbrtm.png"></div><br>  Tivemos alguns dias entre grandes projetos e decidimos zombar da porta do chefe da unidade.  Apenas por divers√£o.  Porque os drones j√° nos reconhecem em nossos rostos - o que torna a porta pior? <br><br>  No in√≠cio do projeto de TI, j√° t√≠nhamos um patch panel impresso em uma impressora 3D.  Por dois dias, fizemos um prot√≥tipo de um dispositivo a partir de ferro, bibliotecas prontas e alguma m√£e, que leva em conta os funcion√°rios ou permite que voc√™ verifique se uma pessoa passou pela catraca por sua passagem. <br><br>  Sem dinheiro  Usamos apenas c√≥digo aberto. <br><br>  Voc√™ pode repetir isso em 15 a 20 minutos com o nosso script. <br><a name="habracut"></a><br><h3>  Id√©ia e abordagem de implementa√ß√£o </h3><br>  Tudo come√ßou com uma resid√™ncia de ver√£o, onde descansamos ap√≥s a conclus√£o de um grande projeto.  Houve um momento em que era muito dif√≠cil acertar o port√£o com a chave.  No sentido em que imediatamente pensamos que era ruim tirar as m√£os dos bolsos no inverno, criamos v√°rias outras aplica√ß√µes, at√© verificar passes e identidades da equipe. <br><br>  Na verdade, quer√≠amos fazer um corredor com raios laser, como no filme Resident Evil, mas n√£o tivemos tempo.  Em geral, eu queria o efeito de intera√ß√£o com o sistema, para que ele tamb√©m respondesse com uma voz. <br><br>  Como quer√≠amos um prot√≥tipo, aqui est√° a orienta√ß√£o m√°xima em termos de funcionalidade e resultados r√°pidos, em detrimento da apar√™ncia, dimens√µes e bela arquitetura.  Acabou assustador, mas r√°pido e funciona. <br><br>  Primeiro, dividimos o controle da porta em m√≥dulos e cada um come√ßou a escrever o seu.  O m√≥dulo de reconhecimento no primeiro dia era externo ao servi√ßo da web do parceiro, ainda havia nosso antigo mecanismo de rede neural interna de outro projeto, al√©m de solu√ß√µes de c√≥digo aberto.  Como resultado, ele ganhou o c√≥digo-fonte aberto: nosso pr√≥prio mecanismo exigia refatora√ß√£o e atualiza√ß√£o (isso levou muito tempo), o recurso da Web do parceiro queria dinheiro e n√£o o deixou entrar, mas o c√≥digo-fonte aberto √© um c√≥digo-fonte aberto. <br><br><h3>  Eletr√¥nica e habita√ß√£o </h3><br>  Inicialmente, eles consideraram a op√ß√£o de simplesmente comprar uma fechadura controlada eletronicamente e substitu√≠-la por uma fechadura interna padr√£o.  Por√©m, devido √† presen√ßa de vidro com persianas na porta, a trava interna era invulgarmente estreita e simplesmente n√£o havia substitui√ß√£o eletr√¥nica no mercado.  Portanto, nosso engenheiro imprimiu um cadeado destac√°vel, fornecendo cont√™ineres para a unidade de controle e a unidade de abertura da trava. <br><br>  Ent√£o, o projeto do edif√≠cio: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1x/cb/d_/1xcbd_x-yxkodnnkdrskk4dyita.png"></div><br>  N√≥s o imprimimos a partir de um modelo que n√≥s mesmos hav√≠amos feito antes do projeto (a modelagem e o ajuste levaram mais tempo do que a escrita do c√≥digo): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tu/lu/71/tulu71ia70l0vpvzupe3wvdlg1m.png"></div><br>  O design do estojo √© feito em Compass-3D.  Como resultado, Dima fez 3 vers√µes do gabinete, desde que ele pudesse escolher o arranjo ideal de elementos e elementos de fixa√ß√£o. <br><br>  Dentro da caixa de bloqueio, um motor MG-995 com uma for√ßa de 10 kg (a for√ßa real de acionamento √© de 5 a 7 kg), um par de sensores infravermelhos para controlar a automa√ß√£o durante a entrada e sa√≠da, um microcontrolador Esp8266 com um m√≥dulo Wi-Fi e um servidor web que, por simplicidade, recebeu comandos de controle para abrir e fechar portas via http.  O mesmo controlador girou as marchas da chave. <br><br>  A parte do software do microcontrolador est√° escrita em C. <br><br>  Imersos nos detalhes da fabrica√ß√£o do estojo e do enchimento, involuntariamente pensamos na complexidade de objetos aparentemente simples. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xx/ry/fu/xxryfuofqvcxbbrczhlqsbnysvy.png"></div><br>  Total: a unidade de controle de bloqueio pode aceitar comandos de abertura via Wi-Fi. <br><br><h3>  Pe√ßa de reconhecimento de rosto </h3><br>  Precisamos de uma unidade de reconhecimento de rosto que envie um comando "aberto" para o castelo, se precisar ser aberto.  Devido √† arquitetura modular, ele pode trabalhar em um mini servidor em uma casa inteligente ou ser um servi√ßo da Web na Internet.  Tamb√©m precisamos de um ponto de Wi-Fi na rede local com a unidade de controle de bloqueio: √© um thin client ou um servidor dom√©stico.  Implantamos o servidor diretamente no laptop antigo, ou seja, combinamos o servidor e o thin client.  Eles conectaram a c√¢mera ao laptop via USB. <br>  Para o pr√≥prio reconhecimento, paramos na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">biblioteca Python de reconhecimento facial</a> sob uma licen√ßa aberta da Universidade de Tecnologia de Massachusetts. <br><br>  V√°rias fotos de cada participante do projeto foram carregadas no modelo - na frente, no perfil e na natureza.  Em teoria, quanto mais fotos voc√™ enviar para o modelo, maior ser√° sua precis√£o, mas na maioria dos casos existem avatares suficientes do Facebook ou fotos do banco de dados de eychars. <br><br>  Implantamos a infraestrutura como um servi√ßo em nossa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nuvem Technoserv</a> e depuramos rapidamente.  A implanta√ß√£o de uma nova m√°quina virtual com todos os servi√ßos levou 20 minutos.  Em seguida, eles carregaram todo o c√≥digo com bibliotecas em um laptop em funcionamento para um trabalho aut√¥nomo. <br><br>  O sistema seleciona a maior face do quadro e a reconhece duas vezes com uma frequ√™ncia de 0,5 segundos. <br><br>  A webcam saiu da caixa de coisas esquecidas dos anos 90.  O que j√° era, mas foi o suficiente. <br><br>  O tempo total de reconhecimento √© de pouco mais de tr√™s segundos.  Isso ocorre porque o laptop √© realmente antigo e n√£o possui uma placa de v√≠deo.  Com o vidyuha e a r√°pida velocidade de reconhecimento da c√¢mera na web, aumentar√° significativamente. <br><br>  Eles escreveram imediatamente um conector para reconhecimento de voz, j√° que apenas o rosto n√£o √© confi√°vel (mais sobre isso mais tarde), dois fatores s√£o necess√°rios. <br><br>  Demorou 6 horas para um prot√≥tipo mais ou menos depurado depois de escolher uma biblioteca. <br><br>  Tamb√©m conectamos um alto-falante bluetooth ao laptop para que ele pudesse conversar.  O laptop em si estava escondido em um arm√°rio com cartas de agradecimento, como um dispositivo incorporado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/c6/qh/jz/c6qhjzieovfchmsdp70qqq0rogg.png"></div><br><h3>  Testes </h3><br>  A descri√ß√£o da biblioteca diz: ‚ÄúConstru√≠do usando o reconhecimento facial de √∫ltima gera√ß√£o da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.google.com/url%3Fq%3Dhttps://www.google.com/url%3Fq%253D">dlib</a> , constru√≠do com aprendizado profundo.  "O modelo tem uma precis√£o de 99,38% no benchmark <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.google.com/url%3Fq%3Dhttps://www.google.com/url%3Fq%253D">Faces rotuladas na natureza</a> ".  Naturalmente, n√£o h√° 99,38%, mas muito menos.  Como voc√™ precisa carregar fotos normais (e mais), defina uma c√¢mera normal e equalize a luz.  Mas, enquanto voc√™ est√° cavando na porta, ela consegue fazer de quatro a cinco quadros, geralmente abre quase imediatamente. <br><br>  Erros: algumas vezes a porta ficou confusa e n√£o nos deixou ir imediatamente.  Estranhos de outros departamentos n√£o podiam entrar pela porta. <br><br>  Voc√™ pode fazer caretas na porta, ela entende tudo e se abre. <br><br>  De acordo com a fotografia do funcion√°rio, √© claro, ela abre.  Adicionamos o m√≥dulo de reconhecimento de pessoa inteira na pr√≥xima vers√£o (fora desses dois dias), e ele come√ßou a abrir apenas para o fracasso. <br><br>  Depois, eles fizeram um teste de cores (a biblioteca de downsamplit e leva imagens em preto e branco para o processamento), movimentos faciais e piscando - voc√™ precisa de uma c√¢mera melhor para ver uma pessoa quando ela ainda estiver em forma e tudo ficar√° bem. <br><br>  Ou seja, como uma substitui√ß√£o importante, √© claro que n√£o, porque um segundo fator √© necess√°rio - por exemplo, voz.  Mas adequado para portas n√£o cr√≠ticas.  Para explicar os funcion√°rios que passam pela porta tamb√©m.  Para verificar se um funcion√°rio tamb√©m corresponde ao passe no ponto de verifica√ß√£o.  Voc√™ tamb√©m pode reconhecer o cachorro voltando para casa pela porta.  Se voc√™ se lembra da hist√≥ria do reconhecimento de padr√µes, uma das primeiras aplica√ß√µes industriais foi que o desenvolvedor americano conseguiu um gato vizinho, uma porcaria no gramado.  Ele reconheceu o gato no semi-agachamento e conectou o sistema de irriga√ß√£o ao seu mini-servidor.  Depois de alguns dias, o gato percebeu que era melhor n√£o cagar.  Nunca.  Em lugar nenhum. <br><br>  O case acabou por ser futurista e volumoso, na vers√£o comercial n√£o deve haver nada na porta, exceto uma c√¢mera com microfone e uma tela pequena com um assistente visual e de √°udio. <br><br><h3>  Repita em casa </h3><br>  Link para a biblioteca acima. <br><br><div class="spoiler">  <b class="spoiler_title">Fa√ßa uma vez</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xt/2p/go/xt2pgow5lznclmhrqzugk78flzk.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O script est√° aqui</a> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Fa√ßa dois</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#/usr/bin/env python """      : """ import os import face_recognition import cv2 import random from pygame import mixer import requests import datetime import time known_faces = [ 'Emp1' , 'Emp2' , 'Emp3' ] faces_folder = 'faces' welcome_folder = 'welcome' known_faces_encodings = [face_recognition.face_encodings(face_recognition.load_image_file(os.path.join(faces_folder, i +".jpg")))[0] for i in known_faces] def init_recognition(): pass def face_detection(face_encodings): name = "Unknown" for face_encoding in face_encodings: matches = face_recognition.compare_faces(known_faces_encodings, face_encoding) if True in matches: first_match_index = matches.index(True) name = known_faces[first_match_index] return name def unlock(): unlock_url = 'http://192.168.4.1/yes' unlock_req = requests.get(unlock_url) #return unlock_req.status_code def lock(): lock_url = 'http://192.168.4.1/no' lock_req = requests.get(lock_url) #return lock_req.status_code def welcome(type): messages = { 'hello': [os.path.join(welcome_folder, file) for file in ['hello_01.wav', 'hello_02.wav', 'hello_03.wav', 'hello_04.wav', 'hello_05.wav']], 'welcome': [os.path.join(welcome_folder, file) for file in ['welcome_01.wav', 'welcome_02.wav', 'welcome_03.wav']], 'unwelcome': [os.path.join(welcome_folder, file) for file in ['unwelcome_01.mp3', 'unwelcome_02.mp3', 'unwelcome_03.wav', 'unwelcome_04.wav', 'unwelcome_05.wav']], 'whoareyou': [os.path.join(welcome_folder, file) for file in ['whoareyou_01.wav', 'whoareyou_02.wav', 'whoareyou_03.wav', 'whoareyou_04.wav']] } mixer.init() mixer.music.load(random.choice(messages[type])) mixer.music.play() def main(): current = datetime.datetime.now() vc = cv2.VideoCapture(0) if vc.isOpened(): is_capturing = vc.read()[0] else: is_capturing = False user_counter = 0 while is_capturing: is_capturing, frame = vc.read() small_frame = cv2.resize(frame, (0, 0), fx=0.25, fy=0.25) rgb_small_frame = small_frame[:, :, ::-1] face_locations = face_recognition.face_locations(rgb_small_frame) face_encodings = face_recognition.face_encodings(rgb_small_frame, face_locations) if len(face_encodings) &gt; 0: user_counter += 1 if user_counter &gt; 6: welcome('hello') print('hello') time.sleep(2) user = face_detection(face_encodings) timing = datetime.datetime.now() - current if timing.seconds &gt; 4: if user in ['Emp3']: welcome('unwelcome') print('go home, ' + user) lock() elif user in known_faces: welcome('welcome') print('welcome, ' + user) unlock() else: welcome('whoareyou') print('who is there?') current = datetime.datetime.now() user_counter = 0 time.sleep(0.5) if __name__ == '__main__': main()</span></span></code> </pre> <br></div></div><br>  No pr√≥prio script, os nomes dos funcion√°rios (Emp1, Emp2) correspondem aos arquivos com suas fotos no diret√≥rio, voc√™ precisa adicionar os seus.  A resolu√ß√£o n√£o importa, voc√™ pode pelo menos 640 x 480.  Existem duas categorias de funcion√°rios - segmentadas, a quem ignorar e aquelas que enviam imediatamente para casa. <br><br>  Como c√¢mera, usamos a webcam mais simples da Logitech.  Em vez de um laptop, √© bem poss√≠vel usar um microcontrolador, mas voc√™ precisa entender como colocar python e bibliotecas selecionadas nele. <br><br><h3>  Resultado </h3><br>  A tecnologia foi sentida por vendedores de departamentos vizinhos que trabalhavam conosco no mesmo andar.  A caixa de bloqueio sobreposta parece especialmente legal e com que som ela abre a porta!  N√£o acredite, mas a promo√ß√£o interna da tecnologia √© t√£o necess√°ria quanto a externa. <br><br>  Nos perguntaram algumas vezes por que fizemos isso depois de horas. <br><br>  A resposta √© que eu realmente queria divertir nossos funcion√°rios, para que eles sentissem as tecnologias que usamos em um dispositivo em funcionamento.  Porque √© um prot√≥tipo de hardware e software imediatamente e √© uma sess√£o de treinamento t√£o pequena antes de projetos maiores.  √â improv√°vel que o pr√≥prio prot√≥tipo seja usado em algum lugar, mas tem uma fun√ß√£o educacional e moralidade. <br><br>  Bem, garantimos a rapidez com que prot√≥tipos industriais podem ser feitos.  Normalmente, fazemos projetos-piloto r√°pidos (2-3 semanas) para produ√ß√£o.  A prop√≥sito, se √© interessante calcular rapidamente algo em termos de automa√ß√£o e criar um piloto - essa √© apenas a especializa√ß√£o de nossa equipe.  <a href="">Envie um email para tmishin@technoserv.com,</a> se houver. <br><br>  Parece que depois de uma boa hackathon. <br><br>  E agora temos um brinquedo. <br><br>  Um colega veio correndo ontem e mostrou um v√≠deo de um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">drone com um lan√ßa-chamas</a> .  Parece que temos algumas id√©ias ... <br><br>  Eu tamb√©m contei tudo isso ao fato de que, literalmente, h√° 3 ou 4 anos, era muito caro e demorado escrever detectores industriais para vigil√¢ncia por v√≠deo.  Controlar o tamanho da fra√ß√£o de material na correia transportadora, parar no caso de objetos estranhos, desligar ao trabalhar em uma zona de perigo e assim por diante.  Hoje est√° sendo feito muito, muito r√°pido.  E muito mais barato.  N√£o √© t√£o r√°pido quanto a porta, mas um piloto em duas semanas √© uma estimativa muito realista. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt416179/">https://habr.com/ru/post/pt416179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt416167/index.html">Peter Norwig: Aprenda Programa√ß√£o em ... 10 Anos</a></li>
<li><a href="../pt416169/index.html">Contentores para adultos (parte 01): um guia pr√°tico de terminologia</a></li>
<li><a href="../pt416171/index.html">Testes de UI codificados do Visual Studio: teoria e pr√°tica da aplica√ß√£o em nossa empresa</a></li>
<li><a href="../pt416175/index.html">Resultados da competi√ß√£o de jovens desenvolvedores de aplicativos AR Epson Moverio BT-300</a></li>
<li><a href="../pt416177/index.html">F√≥rmula de Tupper e implementa√ß√£o do algoritmo em Python</a></li>
<li><a href="../pt416181/index.html">Modula√ß√£o de amplitude nos dedos</a></li>
<li><a href="../pt416183/index.html">Teste de dados: requisitos e n√≠veis</a></li>
<li><a href="../pt416187/index.html">Ap√≥s a reuni√£o "Novos recursos do PostgreSQL 11" (Parte 2)</a></li>
<li><a href="../pt416189/index.html">O tratamento do Scrum "mec√¢nico". Parte 3. Trabalho SM</a></li>
<li><a href="../pt416191/index.html">Implementa√ß√£o de baixo n√≠vel da √°rvore de prefixos trie no PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>