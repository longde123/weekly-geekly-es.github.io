<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí© üßúüèº ‚Ü™Ô∏è Comment se faire des amis PHPstorm, xDebug et les branches distantes compil√©es via Docker? Trop simple ... ü§≤üèΩ üë®‚Äçüî¨ ‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! 

 Il y a un an, mon processus de d√©bogage de code en PHP comprenait deux lignes: 



var_dump($variable); die();  
 De temps en temps,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment se faire des amis PHPstorm, xDebug et les branches distantes compil√©es via Docker? Trop simple ...</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423337/">  Bonjour, Habr! <br><br>  Il y a un an, mon processus de d√©bogage de code en PHP comprenait deux lignes: <br><br><pre><code class="php hljs">var_dump($variable); <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>();</code> </pre> <br>  De temps en temps, bien s√ªr, je devais utiliser des constructions plus "complexes": <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data);</code> </pre><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($variable, JSON_UNESCAPED_UNICODE); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>();</code> </pre> <br>  Non, tu es quoi!  Je savais - √† notre √©poque, ce n'est pas appropri√© pour un programmeur culturel de faire √ßa <br><br><div class="spoiler">  <b class="spoiler_title">artisanat ancien</b> <div class="spoiler_text">  une blague sur un autre ancien m√©tier <br></div></div><br>  Mais honn√™tement, j'avais toujours peur de ce que je ne comprenais pas.  Y compris les <s>imprimantes</s> xDebug, en particulier comment configurer tout cela.  Un beau jour, j'ai r√©ussi √† le faire dans ma voiture et dans un projet local - il n'y avait pas de limite √† la joie.  Plusieurs mois plus tard, je suis tomb√© sur un nouveau probl√®me, comment d√©boguer dans PHPstorm via xDebug, si le projet est construit √† distance par docker via CI. <br><br>  Si vous, comme moi, avez des difficult√©s √† configurer diff√©rentes choses, bienvenue au chat, je parlerai de mon exp√©rience dans la mise en place d'un environnement de d√©bogage avec des mots effrayants comme Docker, xDebug, CI. <br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pour ceux qui n'aiment pas l'eau et veulent aller directement √† l'essence du d√©cor.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a> <br><h3>  Pourquoi devriez-vous vous √©loigner des m√©thodes de d√©bogage moisies et passer √† des technologies ad√©quates? </h3><br>  J'ai un peu tromp√© le chat, j'√©tais engag√© dans un d√©bogage artisanal, non seulement parce que j'avais peur de configurer quelque chose, et non pas parce que c'√©tait trop stupide, mais simplement parce que je n'avais pas besoin de quelque chose de plus pratique.  Le plus souvent, j'ai travaill√© sur des projets localement sur mon ordinateur plut√¥t puissant, et les t√¢ches n'√©taient pas si compliqu√©es que le processus de d√©bogage a commenc√© √† occuper une position assez importante. <br><br>  √Ä un moment donn√©, je me suis rendu compte que j'√©tais mal √† l'aise et j'ai essay√© de me faire des amis xDebug et PHPstorm lorsque je travaillais sur un projet local.  Le probl√®me est que la plupart de la documentation et des guides que j'ai trouv√©s impliquent que la personne qui les lit conna√Æt assez bien le domaine et comprend tout, dans mon cas, ce n'√©tait pas le cas et j'ai d√©pens√© 4-5 sur ma premi√®re configuration de xDebug heures √† 14 h.  C'√©tait une morale assez difficile, je me sentais infiniment stupide.  N√©anmoins, il s'est av√©r√© qu'il fallait configurer, tout fonctionnait! <br><br>  Oui, cela est devenu plus pratique, localement, √† la maison, mais au travail principal, j'ai fait les sites √† distance, et le plus souvent, je n'ai pas pu d√©charger le site localement (en raison d'une machine faible ou d'un processus de d√©ploiement peu pratique), ou affecter les param√®tres du serveur en raison de l'h√©bergement, par cons√©quent, a fait des modifications "en direct" et le d√©bogage s'est engag√© dans print_r commentant html (√† ce travail, c'√©tait "normal", mais pas fier de cette exp√©rience). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cd1/3af/ffdcd13af6a976ca99ff2f26976458e9.jpg" alt="image"><br><br>  Cependant, il y a 3 mois, j'ai d√©m√©nag√© dans une entreprise plus cool et j'ai commenc√© √† me lancer dans un projet vraiment s√©rieux avec une charge √©lev√©e.  Et ici, beaucoup de choses ont chang√© pour moi.  L'infrastructure et le processus de d√©veloppement sont approximativement les suivants: il y a un serveur GitLab, chaque projet a son propre r√©f√©rentiel, les t√¢ches viennent √† Jira, vous cr√©ez une branche par num√©ros de t√¢che, lors de la cr√©ation d'une branche √† l'aide de CI, votre propre sandbox avec le site o√π vous travaillez tranquillement est automatiquement cr√©√©, chaque push r√©assemble la branche, √† la fin du travail que vous lui donnez √† la revue de code, versez la branche dans le ma√Ætre. <br><br>  Tout est cool sauf pour un MAIS, chaque reconstruction d'une branche dans mon cas prend environ 10 secondes.  Dans le processus de d√©veloppement lui-m√™me, c'est une p√©riode insignifiante, car j'ai d√©j√† franchi le stade o√π je devais v√©rifier l'op√©rabilit√© du code presque toutes les lignes en raison de l'incertitude et du peu d'exp√©rience.  Cependant, lorsque je suis pass√© au d√©bogage, ces 10 secondes ont commenc√© √† jouer un r√¥le tangible.  Le processus d'un tel d√©bogage se pr√©sente comme suit: <br><br><ul><li>  Ajouter 2 lignes </li><li>  Pushu commit </li><li>  J'attends 10 secondes </li><li>  V√©rifiez, voyez ce qui ne va pas </li><li>  R√©p√©ter </li></ul><br>  Selon des estimations approximatives, une branche pr√™te pour la fusion avait environ 20% de validations utiles et 80% de validations de d√©bogage.  Supposons que j'ai fini de travailler sur une branche avec 300 validations, dont 240 validations ont essentiellement consomm√© 40 minutes de mon temps de travail (et ce n'est que le temps d'attente pour l'assemblage de la branche, sans prendre en compte les secondes qui totalisent les minutes, pour ajouter 2 lignes puis supprimez-les). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b9a/810/70f/b9a81070f5d6091988cee3ff3ac88463.png" alt="image"><br><br>  √Ä un moment donn√©, j'en ai eu assez et j'ai d√©cid√© de configurer xDebug pour rendre le processus de d√©bogage moins co√ªteux.  Malheureusement, mes coll√®gues actuels n'ont pas utilis√© cette technologie (j'attends une blague sur "J'ai une entreprise sympa o√π personne n'utilise xDebug"), ou ils ne savaient pas / ne se souvenaient pas comment se faire des amis avec l'IDE xDebug lorsque la branche aller √† distance via CI, et comme je n'ai jamais d√©velopp√© et comme je l'ai mentionn√© ci-dessus, le processus de mise en place de quelque chose est un processus assez p√©nible pour moi, il a r√©sult√© en environ 6 heures de temps pur, donc finalement cela a fonctionn√©, et j'ai compris le processus, et ce serait assez pratique. <br><a name="process"></a><br><h3>  Processus d'installation </h3><br>  Je n'entrerai pas dans les d√©tails sur la fa√ßon de fixer CI, Docker, en g√©n√©ral, comment assembler l'infrastructure, il est suppos√© que tout est fait et qu'il ne reste plus qu'√† configurer votre environnement personnel. <br><br>  Disons que notre r√©f√©rentiel a quelque chose comme cette structure: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56d/3ea/285/56d3ea285e90fed97ea116ac79715381.jpg" alt="image"><br><br>  Nous devons d'abord v√©rifier si xDebug lui-m√™me est dans l'image actuelle, pour cela, vous pouvez utiliser <b>phpinfo ();</b> <br><br>  Si xDebug est d√©j√† inclus dans l'assembly - tr√®s bien, sinon, consultez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette source</a> , qui m'a aid√© directement dans la configuration elle-m√™me, cependant, je suis all√© un peu diff√©remment. <br><br><h4>  Configurer php.ini </h4><br>  Pour que tout fonctionne √† la fin, 2 param√®tres xDebug sont importants pour nous: <br><br><ul><li>  xdebug.remote_enable </li><li>  xdebug.remote_host </li></ul><br>  Dans l'assemblage final de la branche distante, <b>remote_enable</b> doit √™tre activ√© et dans <b>remote_host, l'</b> adresse IP de votre ordinateur sur le r√©seau doit √™tre attribu√©e.  Incluons ces param√®tres dans notre build. <br><br>  Vous devez d'abord savoir o√π les param√®tres php sont stock√©s, ils peuvent √™tre situ√©s dans <b>/usr/local/etc/php/conf.d/php.ini</b> , ou le fichier .ini lui-m√™me peut √™tre nomm√© diff√©remment, dans mon cas, il s'agit de <b>/ usr / local / etc / php / conf.d / php-settings.ini</b> .  Vous pouvez le d√©couvrir dans les param√®tres de l'image collect√©e. <br><br>  Nous cr√©ons nos param√®tres suppl√©mentaires dans notre branche via le m√™me fichier php-settings.ini et les <b>pla√ßons</b> dans <b>./build_env/php/php-settings.ini</b> <br>  Nous y √©crivons 2 des param√®tres ci-dessus: <br> <code>xdebug.remote_enable = on <br> xdebug.remote_host = IP...</code> <br> <br>  Ensuite, nous devons ajouter ce fichier aux param√®tres d'image "parent".  Je fais cela √† travers les volumes en ajoutant la ligne √† ./build_env/docker-compose/docker-compose.tmpl: <br> <code>- ${PROJECT_DIR}/build_env/php/php-settings.ini:/usr/local/etc/php/conf.d/php-settings.ini</code> <br> <br>  Voici √† quoi ressemble docker-compose.tmpl dans mon projet: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a9/dfc/03d/6a9dfc03d0adf60127a3c03ede9b0f3e.jpg" alt="image"><br><br>  La prochaine fois que vous construirez la branche, vous pourrez v√©rifier si les nouveaux param√®tres sont li√©s via le m√™me <b>phpinfo ();</b>  si oui - excellent, sinon - vous n'avez pas de chance et vous devrez suivre la m√™me voie que la premi√®re fois :( <br><br><h4>  Personnalisation des mappages dans PHPstorm </h4><br>  Ensuite, vous devez configurer PHPstorm lui-m√™me.  J'ai d√©cid√© de ne pas utiliser le proxy DBgp, afin de ne pas configurer les mappages dans le popup √† chaque fois.  Dans mon cas, j'utilise un mod√®le de serveur qui contiendra les mappages n√©cessaires. <br><br>  Allez dans <b>Param√®tres / Pr√©f√©rences |</b>  <b>Langues et cadres |</b>  <b>Php |</b>  <b>Serveurs</b> <br><br><ol><li>  Cr√©er un mod√®le de serveur </li><li>  Nom: BRANCH </li><li>  h√¥te: tout, cela n'affecte pas </li><li>  port: tout, il n'affecte pas </li><li>  D√©bogueur: xDebug </li><li>  Mettez un point sur l'utilisation des mappages de chemin </li><li>  Nous posons les mappages appropri√©s, les dossiers locaux de travail doivent correspondre aux dossiers sur le serveur o√π se trouvent les branches collect√©es, dans mon cas les builds collect√©s sont dans le dossier / var / www / builds / your_namespace / your_project / your_branch </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/c0b/fb9/268/c0bfb9268a256e387f3464e7ce100cc0.jpg" alt="image"><br><br>  Nous enregistrons ces param√®tres, nous les changerons chaque fois que nous travaillerons avec une nouvelle branche.  Par exemple, si aujourd'hui je travaille avec la branche web-2233, je changerai le mappage en <b>/ var / www / builds / build_path / web-2233</b> <br><br><h4>  Ajoutez une nouvelle variable d'environnement pour que l'EDI r√©cup√®re automatiquement les mappages </h4><br>  Maintenant un point assez important et pas le plus √©vident.  Lorsque nous d√©marrons le d√©bogage, PHPstorm doit comprendre quels fichiers locaux correspondent aux fichiers sur le serveur distant.  Si le serveur ne lui a pas donn√© d'installation sp√©cifique, une fen√™tre contextuelle appara√Ætra dans laquelle vous devrez mapper manuellement les chemins.  Pour que PHPstorm prenne imm√©diatement les mappages d'un serveur portant le nom BRANCH, vous devez ajouter la variable d'environnement <b>PHP_IDE_CONFIG</b> √† notre assembly <br><br>  Dans <b>./build_env/docker-compose/docker-compose.tmpl,</b> cr√©ez une nouvelle variable d'environnement dans l'environnement: <br> <code>PHP_IDE_CONFIG: ${PHP_IDE_CONFIG}</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/793/5d1/274/7935d1274fadf298d10e57a2b6d6aba8.jpg" alt="image"><br><br>  Dans <b>.gitlab-ci.yml, nous</b> d√©finissons cette variable: <br> <code>- export PHP_IDE_CONFIG="serverName=BRANCH"</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/336/529/676/336529676de2d579e86a5820e02f06dc.jpg" alt="image"><br><br><h4>  C'est fait! </h4><br>  Nous n'avons pas besoin d'extensions de navigateur, nous n'avons pas besoin de passer l'URL XDEBUG_SESSION_START = IDE_KEY pour obtenir les param√®tres, nous n'avons pas besoin d'ajouter de configurations suppl√©mentaires. <br><br>  Allumez simplement l'√©coute √©lectronique <img src="https://habrastorage.org/getpro/habr/post_images/f5f/cb7/dbd/f5fcb7dbd0b27a12b5be3ce65f1e9936.jpg" alt="image">  et rafra√Æchir la page du site, d√®s que nous tomberons sur le premier point d'arr√™t, l'application s'arr√™tera dessus <br><br><img src="https://habrastorage.org/getpro/habr/post_images/457/99c/352/45799c352fe12908ae598f93d1271aeb.jpg" alt="image"><br><br>  Merci de votre attention, j'esp√®re que cet article vous sera utile et que quelqu'un gagnera du temps sans marcher sur le m√™me r√¢teau que moi :) <br><br>  Sources que j'ai utilis√©es lors de la configuration initiale: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://gist.github.com/chadrien/c90927ec2d160ffea9c4</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://confluence.jetbrains.com/display/PhpStorm/Docker+Support+in+PhpStorm#DockerSupportinPhpStorm-DebuggingthePHPwebapplicationrunningintheDockercontainer</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423337/">https://habr.com/ru/post/fr423337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423319/index.html">Int√©gration de code Vivaldi. Nos d√©veloppeurs racontent</a></li>
<li><a href="../fr423321/index.html">Protection des r√©f√©rentiels GitHub contre les validations malveillantes</a></li>
<li><a href="../fr423323/index.html">"Vous devez √™tre paresseux pour devenir un bon testeur."</a></li>
<li><a href="../fr423329/index.html">Se pr√©parer pour un entretien avec une entreprise des Big Five</a></li>
<li><a href="../fr423335/index.html">Comment battre le clic dans Y. Direct et AdWords pour 600 mille roubles par mois</a></li>
<li><a href="../fr423339/index.html">Y a-t-il de la vie sous Windows 98, premi√®re partie - √† propos du mat√©riel</a></li>
<li><a href="../fr423341/index.html">Sous la pression du public, Sony a admis que les ≈ìuvres de Bach ne lui appartenaient pas.</a></li>
<li><a href="../fr423343/index.html">Les valeurs culturelles en plastique commencent √† se d√©grader</a></li>
<li><a href="../fr423345/index.html">Noeud de peur</a></li>
<li><a href="../fr423347/index.html">O√π est mon argent: conception et bundles Steam, localisation et distributeurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>