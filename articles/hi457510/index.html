<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тЧ╗я╕П ЁЯСйЁЯП╝тАНЁЯдЭтАНЁЯСйЁЯП╗ ЁЯЦКя╕П рдХреНрд╖реИрддрд┐рдЬ рд░реВрдк рд╕реЗ рдпрд╛рдж рдХрд┐рдП рдЧрдП рдкреИрдорд╛рдиреЗ рдкрд░ mcrouter рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ тЫПя╕П ЁЯУз тЪЩя╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдХрд┐рд╕реА рднреА рднрд╛рд╖рд╛ рдореЗрдВ рдЕрддреНрдпрдзрд┐рдХ рднрд░реА рд╣реБрдИ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдФрд░ рд╡рд┐рд╢реЗрд╖ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЬрдм PHP рдореЗрдВ рдЕрдиреБрдкреНрд░рдп...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдХреНрд╖реИрддрд┐рдЬ рд░реВрдк рд╕реЗ рдпрд╛рдж рдХрд┐рдП рдЧрдП рдкреИрдорд╛рдиреЗ рдкрд░ mcrouter рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/457510/"><img src="https://habrastorage.org/webt/au/eb/x9/auebx9o2ubzy-xbzporaylovqr0.png"><br><br>  рдХрд┐рд╕реА рднреА рднрд╛рд╖рд╛ рдореЗрдВ рдЕрддреНрдпрдзрд┐рдХ рднрд░реА рд╣реБрдИ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдФрд░ рд╡рд┐рд╢реЗрд╖ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЬрдм PHP рдореЗрдВ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреА рдмрд╛рдд рдЖрддреА рд╣реИ, рддреЛ рд╕реНрдерд┐рддрд┐ рдЗрддрдиреА рдмрд┐рдЧрдбрд╝ рд╕рдХрддреА рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдкрдирд╛ рд╕реНрд╡рдпрдВ рдХрд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕рд░реНрд╡рд░</a> ред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд╣рдо рдЙрд╕ рджрд░реНрдж рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗ рдЬреЛ рд╣рд░ рдХреЛрдИ рдЬрд╛рдирддрд╛ рд╣реИ рдХрд┐ рд╕рддреНрд░реЛрдВ рдФрд░ рдХреИрд╢рд┐рдВрдЧ рдбреЗрдЯрд╛ рдХреЗ рд╡рд┐рддрд░рд┐рдд рднрдВрдбрд╛рд░рдг рдХреЗ рд╕рд╛рде рдореЗрдордЪреИрдб рдореЗрдВ рдФрд░ рд╣рдордиреЗ рдЗрди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рдПрдХ "рд╡рд╛рд░реНрдб" рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдХреИрд╕реЗ рд╣рд▓ рдХрд┐рдпрд╛ред <a name="habracut"></a><br><br>  рдЗрд╕ рдЕрд╡рд╕рд░ рдХрд╛ рдирд╛рдпрдХ рдПрдХ PHP рдЕрдиреБрдкреНрд░рдпреЛрдЧ рд╣реИ рдЬреЛ рд╕рд┐рдореНрдлрдиреА 2.3 рдлреНрд░реЗрдорд╡рд░реНрдХ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ, рдЬреЛ рд╡реНрдпрд╡рд╕рд╛рдп рдпреЛрдЬрдирд╛рдУрдВ рдореЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рднреА рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИред  рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдорд╛рдирдХ рд╕рддреНрд░ рдХреЗ рднрдВрдбрд╛рд░рдг рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкрд░рд┐рдпреЛрдЬрдирд╛ рдиреЗ рдкреВрд░реА рддрд░рд╣ <b>рд╕реЗ рдореЗрдордЪреИрдЪ рдореЗрдВ рд╕рдм рдХреБрдЫ рдХреЗ рдХреИрд╢рд┐рдВрдЧ рдХрд╛</b> рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛: рдбреЗрдЯрд╛рдмреЗрд╕ рдФрд░ рдПрдкреАрдЖрдИ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдЬрд╡рд╛рдм, рд╡рд┐рднрд┐рдиреНрди рдЭрдВрдбреЗ, рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд╕рд┐рдВрдХреНрд░рдирд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддрд╛рд▓реЗ, рдФрд░ рдмрд╣реБрдд рдХреБрдЫред  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЖрд╡реЗрджрди рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╡рд┐рдлрд▓рддрд╛ рдШрд╛рддрдХ рд╣реЛ рдЬрд╛рддреА рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХреИрд╢ рдХреА рд╣рд╛рдирд┐ рдХреЗ рдЧрдВрднреАрд░ рдкрд░рд┐рдгрд╛рдо рд╣реЛрддреЗ рд╣реИрдВ: DBMS рддреЗрдЬреА рд╕реЗ рджрд░рд╛рд░ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрддрд╛ рд╣реИ, рдПрдкреАрдЖрдИ рд╕реЗрд╡рд╛рдПрдВ - рдкреНрд░рддрд┐рдмрдВрдз рдЕрдиреБрд░реЛрдз, рдЖрджрд┐ред  рд╕реНрдерд┐рддрд┐ рдХреЗ рд╕реНрдерд┐рд░реАрдХрд░рдг рдореЗрдВ рджрд╕рд┐рдпреЛрдВ рдорд┐рдирдЯ рд▓рдЧ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЗрд╕ рд╕рдордп рдпрд╣ рд╕реЗрд╡рд╛ рдмрд╣реБрдд рдзреАрдореА рд╣реЛ рдЬрд╛рдПрдЧреА рдпрд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рджреБрд░реНрдЧрдо рд╣реЛ рдЬрд╛рдПрдЧреАред <br><br>  рд╣рдореЗрдВ <b>рдЫреЛрдЯреЗ рд░рдХреНрдд рдХреЗ рд╕рд╛рде рдЖрд╡реЗрджрди рдХреЗ рдХреНрд╖реИрддрд┐рдЬ рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдХреА рд╕рдВрднрд╛рд╡рдирд╛</b> рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА, рдЕрд░реНрдерд╛рддреНред  рд╕реНрд░реЛрдд рдХреЛрдб рдореЗрдВ рдиреНрдпреВрдирддрдо рдкрд░рд┐рд╡рд░реНрддрди рдФрд░ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рдкреВрд░реНрдг рд╕рдВрд░рдХреНрд╖рдгред  рдХреИрд╢ рдХреЛ рди рдХреЗрд╡рд▓ рджреЛрд╖ рд╕рд╣рд┐рд╖реНрдгреБ рдмрдирд╛рдУ, рдмрд▓реНрдХрд┐ рдЗрд╕рд╕реЗ рдбреЗрдЯрд╛ рд╣рд╛рдирд┐ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХрд╛ рднреА рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред <br><br><h2>  рдореЗрдореЗрдХреИрдЪреНрдб рдореЗрдВ рдХреНрдпрд╛ рдЧрд▓рдд рд╣реИ? </h2><br>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдмреЙрдХреНрд╕ рдХреЗ рдмрд╛рд╣рд░ PHP рдХреЗ рд▓рд┐рдП рдореЗрдордХрд╛рдЯреЗрдб рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдбреЗрдЯрд╛ рдФрд░ рд╕рддреНрд░реЛрдВ рдХреЗ рд╡рд┐рддрд░рд┐рдд рднрдВрдбрд╛рд░рдг рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред  рд╕реБрд╕рдВрдЧрдд рдХреБрдВрдЬреА рд╣реИрд╢рд┐рдВрдЧ рддрдВрддреНрд░ рдЖрдкрдХреЛ рдХрдИ рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рдбреЗрдЯрд╛ рдХреЛ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рд░рдЦрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд╕рдореВрд╣ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреБрдВрдЬреА рдХреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рдВрдмреЛрдзрд┐рдд рдХрд░рддреЗ рд╣реБрдП, рдФрд░ рдлрд╝реЗрд▓рдУрд╡рд░ рдХреЗ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдЯреВрд▓ рдХреИрд╢рд┐рдВрдЧ рд╕реЗрд╡рд╛ рдХреА рдЙрдЪреНрдЪ рдЙрдкрд▓рдмреНрдзрддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ (рд▓реЗрдХрд┐рди, рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, <b>рдбреЗрдЯрд╛ рдирд╣реАрдВ</b> )ред <br><br>  рднрдВрдбрд╛рд░рдг рд╕рддреНрд░ рдХреЗ рд╕рд╛рде, рдЪреАрдЬреЗрдВ рдереЛрдбрд╝реА рдмреЗрд╣рддрд░ рд╣реЛрддреА рд╣реИрдВ: рдЖрдк <code>memcached.sess_number_of_replicas</code> рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдбреЗрдЯрд╛ рдХреЛ рдПрдХ рд╕рд╛рде рдХрдИ рд╕рд░реНрд╡рд░реЛрдВ рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдПрдХ рдпрд╛рджрдЧрд╛рд░ рдЙрджрд╛рд╣рд░рдг рдХреА рд╡рд┐рдлрд▓рддрд╛ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдбреЗрдЯрд╛ рджреВрд╕рд░реЛрдВ рд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрджрд┐ рд╕рд░реНрд╡рд░ рдбреЗрдЯрд╛ рдХреЗ рдмрд┐рдирд╛ рд╕реЗрд╡рд╛ рдореЗрдВ рд▓реМрдЯрддрд╛ рд╣реИ (рдЬреИрд╕рд╛ рдХрд┐ рдЖрдорддреМрд░ рдкрд░ рдкреБрдирд░рд╛рд░рдВрдн рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдорд╛рдорд▓рд╛ рд╣реЛрддрд╛ рд╣реИ), рдХреБрдВрдЬреА рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдЗрд╕рдХреЗ рдкрдХреНрд╖ рдореЗрдВ рдкреБрдирд░реНрд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдЗрд╕рдХрд╛ рдЕрд░реНрде <b>рд╕рддреНрд░ рдбреЗрдЯрд╛</b> рдХрд╛ <b>рдиреБрдХрд╕рд╛рди</b> рд╣реЛрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдорд┐рд╕ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдХрд┐рд╕реА рдЕрдиреНрдп рдкреНрд░рддрд┐рдХреГрддрд┐ рдХреЗ рд▓рд┐рдП "рдЬрд╛рдиреЗ" рдХрд╛ рдХреЛрдИ рд░рд╛рд╕реНрддрд╛ рдирд╣реАрдВ рд╣реИред <br><br>  рдорд╛рдирдХ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдЙрдкрдХрд░рдг рдореБрдЦреНрдп рд░реВрдк рд╕реЗ <b>рдХреНрд╖реИрддрд┐рдЬ</b> рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рд╕реЗ рд╣реЛрддреЗ рд╣реИрдВ: рд╡реЗ рдЖрдкрдХреЛ рдХреИрд╢ рдХреЛ рд╡рд┐рд╢рд╛рд▓ рдЖрдХрд╛рд░ рдореЗрдВ рдмрдврд╝рд╛рдиреЗ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рд╕рд░реНрд╡рд░реЛрдВ рдкрд░ рд╕реНрдерд┐рдд рдХреЛрдб рд╕реЗ рдЗрд╕рдХреА рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдорд╛рд░реА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╕рдВрдЧреНрд░рд╣реАрдд рдбреЗрдЯрд╛ рдХреА рдорд╛рддреНрд░рд╛ рдХрдИ рдЧреАрдЧрд╛рдмрд╛рдЗрдЯ рд╕реЗ рдЕрдзрд┐рдХ рдирд╣реАрдВ рд╣реИ, рдФрд░ рдПрдХ рдпрд╛ рджреЛ рдиреЛрдбреНрд╕ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд╛рдлреА рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред  рддрджрдиреБрд╕рд╛рд░, рдПрдХ рдЙрдкрдпреЛрдЧреА рдирд┐рдпрдорд┐рдд рд╕рд╛рдзрдиреЛрдВ рд╕реЗ, рд╡реЗ рдХреЗрд╡рд▓ рдХрд╛рдо рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рдПрдХ рдХреИрд╢ рдЙрджрд╛рд╣рд░рдг рдХреЛ рдмрдирд╛рдП рд░рдЦрддреЗ рд╣реБрдП рдореЗрдореЗрдХ рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдореИрдВ рдЗрд╕ рдЕрд╡рд╕рд░ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдореЗрдВ рд╕рдлрд▓ рдирд╣реАрдВ рд╣реБрдЖ ... рдпрд╣рд╛рдБ рд╣рдореЗрдВ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдкреНрд░рдпреБрдХреНрдд рдврд╛рдВрдЪреЗ рдХреА рдкреНрд░рд╛рдЪреАрдирддрд╛ рдХреЛ рдпрд╛рдж рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рд╕реЗ рд╕рд░реНрд╡рд░ рдкреВрд▓ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡реЗрджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЕрд╕рдВрднрд╡ рд╣реЛ рдЧрдпрд╛ред  рд╣рдо рд╕рддреНрд░ рдбреЗрдЯрд╛ рдХреЗ рдиреБрдХрд╕рд╛рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреА рдирд╣реАрдВ рднреВрд▓реЗрдВрдЧреЗ: рдЧреНрд░рд╛рд╣рдХ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд╣рд░ рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ рд▓реЙрдЧрд┐рдВрдЧ рд╕реЗ рдЖрдИ рдЖрдВрдЦред <br><br>  рдЖрджрд░реНрд╢ рд░реВрдк рдореЗрдВ, рдХрд┐рд╕реА рдорд┐рд╕ рдпрд╛ рддреНрд░реБрдЯрд┐ рдХреА рд╕реНрдерд┐рддрд┐ <b>рдореЗрдВ рдПрдХ рд░рд┐рдХреЙрд░реНрдб рдХрд┐рдП рдЧрдП рдкреНрд░рддрд┐рдХреГрддрд┐ рдФрд░ рд░реЗрдВрдЧрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рддрд┐рдХреГрддрд┐рдпреЛрдВ рдХреА рдкреНрд░рддрд┐рдХреГрддрд┐</b> рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереАред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Mcrouter</a> рдиреЗ рд╣рдореЗрдВ рдЗрд╕ рд░рдгрдиреАрддрд┐ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХреАред <br><br><h2>  mcrouter </h2><br>  рдпрд╣ рдлреЗрд╕рдмреБрдХ рджреНрд╡рд╛рд░рд╛ рд╡рд┐рдХрд╕рд┐рдд рдПрдХ рдореЗрдордХрд╛рд░реНрдбреЗрдб рд░рд╛рдЙрдЯрд░ рд╣реИ рдЬреЛ рдЕрдкрдиреА рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред  рдпрд╣ рдореЗрдореНрдХреЗрдб рдЯреЗрдХреНрд╕реНрдЯ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ рдкрд╛рдЧрд▓ рдЖрдХрд╛рд░ рдореЗрдВ <b>рдореЗрдореЙрдЪреНрдб рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рди</b> рдХреЛ <b>рд╕реНрдХреЗрд▓</b> рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕ рдШреЛрд╖рдгрд╛</a> рдореЗрдВ mcrouter рдХрд╛ рд╡рд┐рд╕реНрддреГрдд рд╡рд┐рд╡рд░рдг рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЕрдиреНрдп <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡реНрдпрд╛рдкрдХ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЗ</a> рдмреАрдЪ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">,</a> рд╣рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><ul><li>  рд░рд┐рдХреЙрд░реНрдб рдХреЛ рджреЛрд╣рд░рд╛рдиреЗ; </li><li>  рддреНрд░реБрдЯрд┐ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рдореВрд╣ рдХреЗ рдЕрдиреНрдп рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдХрдордмреИрдХ рдХрд░реЗрдВред </li></ul><br>  рдХрд╛рд░рдг рдХреЗ рд▓рд┐рдП! <br><br><h3>  Mcrouter рд╡рд┐рдиреНрдпрд╛рд╕ </h3><br>  рдореИрдВ рд╕реАрдзреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдкрд░ рдЬрд╛рдКрдВрдЧрд╛: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"pools"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"pool00"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"servers"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"mc-0.mc:11211"</span></span>, <span class="hljs-string"><span class="hljs-string">"mc-1.mc:11211"</span></span>, <span class="hljs-string"><span class="hljs-string">"mc-2.mc:11211"</span></span> }, <span class="hljs-string"><span class="hljs-string">"pool01"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"servers"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"mc-1.mc:11211"</span></span>, <span class="hljs-string"><span class="hljs-string">"mc-2.mc:11211"</span></span>, <span class="hljs-string"><span class="hljs-string">"mc-0.mc:11211"</span></span> }, <span class="hljs-string"><span class="hljs-string">"pool02"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"servers"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"mc-2.mc:11211"</span></span>, <span class="hljs-string"><span class="hljs-string">"mc-0.mc:11211"</span></span>, <span class="hljs-string"><span class="hljs-string">"mc-1.mc:11211"</span></span> }, <span class="hljs-string"><span class="hljs-string">"route"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"OperationSelectorRoute"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"default_policy"</span></span>: <span class="hljs-string"><span class="hljs-string">"AllMajorityRoute|Pool|pool00"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"operation_policies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"get"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"RandomRoute"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"children"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"MissFailoverRoute|Pool|pool02"</span></span>, <span class="hljs-string"><span class="hljs-string">"MissFailoverRoute|Pool|pool00"</span></span>, <span class="hljs-string"><span class="hljs-string">"MissFailoverRoute|Pool|pool01"</span></span> ] } } } }</code> </pre> <br>  рддреАрди рддрд╛рд▓ рдХреНрдпреЛрдВ?  рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдХреНрдпреЛрдВ рджреЛрд╣рд░рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ?  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред <br><br><ul><li>  рдЗрд╕ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ, mcrouter рдЙрд╕ рдкрде рдХрд╛ рдЪрдпрди рдХрд░рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЕрдиреБрд░реЛрдз рдЖрджреЗрд╢ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрдиреБрд░реЛрдз рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред  <code>OperationSelectorRoute</code> SelectorRoute рдЙрд╕реЗ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИред </li><li>  GET рдЕрдиреБрд░реЛрдз, <code>RandomRoute</code> рд╣реИрдВрдбрд▓рд░ рдореЗрдВ рдЖрддреЗ рд╣реИрдВ, рдЬреЛ <code>children</code> рдПрд░реЗ рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рдмреАрдЪ рдПрдХ рдкреВрд▓ рдпрд╛ рд░реВрдЯ рдХрд╛ рдЪрдпрди рдХрд░рддрд╛ рд╣реИред  рдЗрд╕ рд╕рд░рдгреА рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рддрддреНрд╡, рдмрджрд▓реЗ рдореЗрдВ, рдПрдХ <code>MissFailoverRoute</code> рд╣реИрдВрдбрд▓рд░ рд╣реИ рдЬреЛ рдкреВрд▓ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рд╕рд░реНрд╡рд░ рд╕реЗ рдЧреБрдЬрд░рддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рдЙрд╕реЗ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдирд╣реАрдВ рдорд┐рд▓рддреА рд╣реИ, рдЬрд┐рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рд╡рд╛рдкрд╕ рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </li><li>  рдпрджрд┐ рд╣рдо рддреАрди рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдПрдХ рдкреВрд▓ рдХреЗ рд╕рд╛рде рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ <code>MissFailoverRoute</code> рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╕рднреА рдЕрдиреБрд░реЛрдз рдкрд╣рд▓реЗ рдореЗрдореЗрдХреИрд╕реНрдЯ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЖрдПрдВрдЧреЗ, рдФрд░ рдмрд╛рдХреА рдбреЗрдЯрд╛ рдирд╣реАрдВ рд╣реЛрдиреЗ рдкрд░ рдЕрд╡рд╢рд┐рд╖реНрдЯ рд╕рд┐рджреНрдзрд╛рдВрдд рдкрд░ рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗред  рдЗрд╕ рддрд░рд╣ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг <b>рд╕реЗ рд╕реВрдЪреА рдореЗрдВ рдкрд╣рд▓реЗ рд╕рд░реНрд╡рд░ рдХрд╛ рдЕрдзрд┐рднрд╛рд░</b> рд╣реЛрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдЕрдиреБрдХреНрд░рдо рдореЗрдВ рдкрддреЗ рдХреЗ рд╕рд╛рде рддреАрди рдкреВрд▓ рдмрдирд╛рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд░реВрдк рд╕реЗ рдЪреБрдирдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓рд┐рдпрд╛ рдЧрдпрд╛ред </li><li>  рдЕрдиреНрдп рд╕рднреА рдЕрдиреБрд░реЛрдз (рдФрд░ рдпрд╣ рд░рд┐рдХреЙрд░реНрдб) <code>AllMajorityRoute</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдП <code>AllMajorityRoute</code> ред  рдпрд╣ рд╣реИрдВрдбрд▓рд░ рдкреВрд▓ рдХреЗ рд╕рднреА рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИ рдФрд░ рдЙрдирдореЗрдВ рд╕реЗ рдХрдо рд╕реЗ рдХрдо N / 2 + 1 рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХрд╛ рдЗрдВрддрдЬрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдореБрдЭреЗ рд▓реЗрдЦрди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП <code>AllSyncRoute</code> рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЛ рдЫреЛрдбрд╝рдирд╛ рдкрдбрд╝рд╛, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рдкрджреНрдзрддрд┐ рдХреЗ рд▓рд┐рдП рд╕рдореВрд╣ рдХреЗ <b>рд╕рднреА</b> рд╕рд░реНрд╡рд░реЛрдВ рд╕реЗ рд╕рдХрд╛рд░рд╛рддреНрдордХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ - рдЕрдиреНрдпрдерд╛ рдпрд╣ <code>SERVER_ERROR</code> рд▓реМрдЯрд╛ <code>SERVER_ERROR</code> ред  рдпрджреНрдпрдкрд┐ mcrouter рдбреЗрдЯрд╛ рдХреЛ рд╕реБрд▓рдн рдХреИрд╢ рдореЗрдВ рд░рдЦреЗрдЧрд╛, рдХреЙрд▓рд┐рдВрдЧ PHP рдлрд╝рдВрдХреНрд╢рди <b>рдПрдХ рддреНрд░реБрдЯрд┐ рд▓реМрдЯрд╛рдПрдЧрд╛</b> рдФрд░ рдПрдХ рдиреЛрдЯрд┐рд╕ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ред  <code>AllMajorityRoute</code> рдЗрддрдирд╛ рд╕рдЦреНрдд рдирд╣реАрдВ рд╣реИ рдФрд░ рдЙрдкрд░реЛрдХреНрдд рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдмрд┐рдирд╛ рдиреЛрдбреНрд╕ рдХреЗ рдЖрдзреЗ рддрдХ decommissioning рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </li></ul><br>  рдЗрд╕ рдпреЛрдЬрдирд╛ рдХрд╛ <b>рдореБрдЦреНрдп рдиреБрдХрд╕рд╛рди</b> рдпрд╣ рд╣реИ рдХрд┐ рдпрджрд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХреИрд╢ рдореЗрдВ рдХреЛрдИ рдбреЗрдЯрд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП, рдПрди рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреВрд▓ рдореЗрдВ <b>рд╕рднреА</b> рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЖрдк рдкреВрд▓ рдореЗрдВ рд╕рд░реНрд╡рд░реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдХрдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рджреЛ рддрдХ: рднрдВрдбрд╛рд░рдг рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдХрд╛ рддреНрдпрд╛рдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдореЗрдВ рдЧреБрдо рдЪрд╛рдмрд┐рдпреЛрдВ рдХреЗ рдЕрдиреБрд░реЛрдзреЛрдВ рд╕реЗ рдЕрдзрд┐рдХ рдЧрддрд┐ рдФрд░ рдХрдо рднрд╛рд░ рдорд┐рд▓реЗрдЧрд╛ред <br><br>  <i><b>NB</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рдХреА рдореЗрдВ рдкреНрд░рд▓реЗрдЦрди</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдореБрджреНрджреЗ</a> (рдмрдВрдж рд╡рд╛рд▓реЗ рд╕рд╣рд┐рдд), рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдиреНрдпрд╛рд╕реЛрдВ рдХреЗ рдПрдХ рдкреВрд░реЗ рднрдВрдбрд╛рд░ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВ, mcrouter рд╕реАрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд▓рд┐рдВрдХ рднреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред</i> <br><br><h3>  Mcrouter рдмрдирд╛рдПрдБ рдФрд░ рдЪрд▓рд╛рдПрдБ </h3><br>  рдЖрд╡реЗрджрди (рдФрд░ рдЦреБрдж рдХреЛ рдпрд╛рдж рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ) рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдореЗрдВ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ - рдХреНрд░рдорд╢рдГ, рдПрдХ рд╣реА рд╕реНрдерд╛рди рдФрд░ mcrouter рдореЗрдВред  <b>рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП,</b> рд╣рдо <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡реЗрдпрд░рдл рдХрд╛</a> рдЙрдкрдпреЛрдЧ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд░рддреЗ рд╣реИрдВ</a> , рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛: <br><br>  <i><b>рдПрдирдмреА</b> : рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд▓рд┐рд╕реНрдЯрд┐рдВрдЧ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдлрд╝реНрд▓реИрдВрдЯ / mcrouter рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА</a> рдореЗрдВ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХреА рдЧрдИ рд╣реИрдВред</i> <br><br><pre> <code class="plaintext hljs">configVersion: 1 project: mcrouter deploy: namespace: '[[ env ]]' helmRelease: '[[ project ]]-[[ env ]]' --- image: mcrouter from: ubuntu:16.04 mount: - from: tmp_dir to: /var/lib/apt/lists - from: build_dir to: /var/cache/apt ansible: beforeInstall: - name: Install prerequisites apt: name: [ 'apt-transport-https', 'tzdata', 'locales' ] update_cache: yes - name: Add mcrouter APT key apt_key: url: https://facebook.github.io/mcrouter/debrepo/xenial/PUBLIC.KEY - name: Add mcrouter Repo apt_repository: repo: deb https://facebook.github.io/mcrouter/debrepo/xenial xenial contrib filename: mcrouter update_cache: yes - name: Set timezone timezone: name: "Europe/Moscow" - name: Ensure a locale exists locale_gen: name: en_US.UTF-8 state: present install: - name: Install mcrouter apt: name: [ 'mcrouter' ]</code> </pre> <br>  <i>( <a href="">werf.yaml</a> )</i> <br><br>  ... рдФрд░ <b>рд╣реЗрд▓реНрдо рдЪрд╛рд░реНрдЯ рдХреЛ</b> рдлреЗрдВрдХ рджреЗрддреЗ рд╣реИрдВред  рджрд┐рд▓рдЪрд╕реНрдк рд╕реЗ - рдкреНрд░рддрд┐рдХреГрддрд┐рдпреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдХреЗрд╡рд▓ рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдЬрдирд░реЗрдЯрд░ рд╣реИ <i>(рдпрджрд┐ рдХрд┐рд╕реА рдХреЗ рдкрд╛рд╕ рдЕрдзрд┐рдХ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рдФрд░ рд╕реБрд░реБрдЪрд┐рдкреВрд░реНрдг рд╡рд┐рдХрд▓реНрдк рд╣реИ - рдЯрд┐рдкреНрдкрдгрд┐рдпреЛрдВ рдореЗрдВ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ)</i> : <br><br><pre> <code class="plaintext hljs">{{- $count := (pluck .Values.global.env .Values.memcached.replicas | first | default .Values.memcached.replicas._default | int) -}} {{- $pools := dict -}} {{- $servers := list -}} {{- /*     : "0 1 2 0 1 2" */ -}} {{- range until 2 -}} {{- range $i, $_ := until $count -}} {{- $servers = append $servers (printf "mc-%d.mc:11211" $i) -}} {{- end -}} {{- end -}} {{- /*   ,  N : "[0 1 2] [1 2 0] [2 0 1]" */ -}} {{- range $i, $_ := until $count -}} {{- $pool := dict "servers" (slice $servers $i (add $i $count)) -}} {{- $_ := set $pools (printf "MissFailoverRoute|Pool|pool%02d" $i) $pool -}} {{- end -}} --- apiVersion: v1 kind: ConfigMap metadata: name: mcrouter data: config.json: | { "pools": {{- $pools | toJson | replace "MissFailoverRoute|Pool|" "" -}}, "route": { "type": "OperationSelectorRoute", "default_policy": "AllMajorityRoute|Pool|pool00", "operation_policies": { "get": { "type": "RandomRoute", "children": {{- keys $pools | toJson }} } } } }</code> </pre> <br>  <i>( <a href="">10-mcrouter.yaml</a> )</i> <br><br>  рд╣рдо рдкрд░реАрдХреНрд╖рдг рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рд░реЛрд▓ рдЖрдЙрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЬрд╛рдБрдЪ рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># php -a Interactive mode enabled php &gt; #     php &gt; $m = new Memcached(); php &gt; $m-&gt;addServer('mcrouter', 11211); php &gt; var_dump($m-&gt;set('test', 'value')); bool(true) php &gt; var_dump($m-&gt;get('test')); string(5) "value" php &gt; # !   : php &gt; ini_set('session.save_handler', 'memcached'); php &gt; ini_set('session.save_path', 'mcrouter:11211'); php &gt; var_dump(session_start()); PHP Warning: Uncaught Error: Failed to create session ID: memcached (path: mcrouter:11211) in php shell code:1 Stack trace: #0 php shell code(1): session_start() #1 {main} thrown in php shell code on line 1 php &gt; #  тАж   session_id: php &gt; session_id("zzz"); php &gt; var_dump(session_start()); PHP Warning: session_start(): Cannot send session cookie - headers already sent by (output started at php shell code:1) in php shell code on line 1 PHP Warning: session_start(): Failed to write session lock: UNKNOWN READ FAILURE in php shell code on line 1 PHP Warning: session_start(): Failed to write session lock: UNKNOWN READ FAILURE in php shell code on line 1 PHP Warning: session_start(): Failed to write session lock: UNKNOWN READ FAILURE in php shell code on line 1 PHP Warning: session_start(): Failed to write session lock: UNKNOWN READ FAILURE in php shell code on line 1 PHP Warning: session_start(): Failed to write session lock: UNKNOWN READ FAILURE in php shell code on line 1 PHP Warning: session_start(): Failed to write session lock: UNKNOWN READ FAILURE in php shell code on line 1 PHP Warning: session_start(): Unable to clear session lock record in php shell code on line 1 PHP Warning: session_start(): Failed to read session data: memcached (path: mcrouter:11211) in php shell code on line 1 bool(false) php &gt;</span></span></code> </pre> <br>  рдкрд╛рда рдореЗрдВ рдЦреЛрдЬ рдиреЗ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рдирд╣реАрдВ рджреА, рд▓реЗрдХрд┐рди " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">mcrouter php</a> " рдХреЗ рдЕрдиреБрд░реЛрдз рдкрд░ рд╕рдмрд╕реЗ рдкреБрд░рд╛рдиреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдкреНрд░рдпреБрдХреНрдд</a> рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕рдорд╕реНрдпрд╛ рд╕рдмрд╕реЗ рдЖрдЧреЗ рджрд┐рдЦрд╛рдИ рджреА - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореЗрдореЗрдХреИрд▓реНрдб</a> рдмрд╛рдЗрдирд░реА рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдорд░реНрдерди рдХреА рдХрдореА</a> ред <br><br>  <i><b>рдПрдирдмреА</b> : рдореЗрдореЗрдХреИрдб рдореЗрдВ рдПрдПрд╕рд╕реАрдЖрдИрдЖрдИ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдмрд╛рдЗрдирд░реА рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдзреАрдорд╛ рд╣реИ, рд╕рд╛рде рд╣реА рд╕реБрд╕рдВрдЧрдд рдХреБрдВрдЬреА рд╣реИрд╢рд┐рдВрдЧ рдХреЗ рдирд┐рдпрдорд┐рдд рд╕рд╛рдзрди рдЬреЛ рдХреЗрд╡рд▓ рдмрд╛рдЗрдирд░реА рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред</i>  <i>рд▓реЗрдХрд┐рди рдпрд╣ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓реЗ рдХреЗ рд▓рд┐рдП рд╕рдорд╕реНрдпрд╛рдПрдВ рдкреИрджрд╛ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред</i> <br><br>  рдмрд╛рдд рдЯреЛрдкреА рдореЗрдВ рд╣реИ: рдпрд╣ рдХреЗрд╡рд▓ ASCII рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдиреА рд╣реБрдИ рд╣реИ рдФрд░ рдпрд╣ рдХрд╛рдо рдХрд░реЗрдЧреА ...ред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">php.net рдкрд░ рдкреНрд░рд▓реЗрдЦрди</a> рдореЗрдВ рдЬрд╡рд╛рдм <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЦреЛрдЬрдиреЗ</a> рдХреА рдЖрджрдд рдиреЗ рдПрдХ рдХреНрд░реВрд░ рдордЬрд╛рдХ рдЦреЗрд▓рд╛ред  рдЖрдкрдХреЛ рд╡рд╣рд╛рдВ рд╕рд╣реА рдЙрддреНрддрд░ рдирд╣реАрдВ рдорд┐рд▓рд╛ ... рдЬрдм рддрдХ рдХрд┐ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдЖрдк рдЕрдВрдд рддрдХ рдирд╣реАрдВ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ, рдЬрд╣рд╛рдВ <i>"рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдпреЛрдЧрджрд╛рди рдХрд┐рдП рдЧрдП рдиреЛрдЯреНрд╕"</i> рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдПрдХ рд╕рд╣реА рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрд╡рд╛рдВрдЫрдиреАрдп рд░реВрдк рд╕реЗ рдмрдордмрд╛рд░реА рд╡рд╛рд▓рд╛ рдЙрддреНрддрд░ рд╣реЛрдЧрд╛</a> ред <br><br>  рд╣рд╛рдВ, рд╕рд╣реА рд╡рд┐рдХрд▓реНрдк рдХрд╛ рдирд╛рдо <code>memcached.sess_binary_protocol</code> ред  рдЗрд╕реЗ рдЕрдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рд╕рддреНрд░ рдХрд╛рдо рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрдВрдЧреЗред  рдпрд╣ рдХреЗрд╡рд▓ PHP рдХреЗ рд╕рд╛рде рдлрд▓реА рдореЗрдВ mcrouter рдХреЗ рд╕рд╛рде рдХрдВрдЯреЗрдирд░ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдмрдиреА рд╣реБрдИ рд╣реИ! <br><br><h2>  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЕрдХреЗрд▓реЗ рдЕрд╡рд╕рдВрд░рдЪрдирд╛рддреНрдордХ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреА рдорджрдж рд╕реЗ, рд╣рдо рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╣рд▓ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдереЗ: рдореЗрдордХрд╛рд╕реНрдЯреЗрдб рджреЛрд╖ рд╕рд╣рд┐рд╖реНрдгреБрддрд╛ рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛ рд╣рд▓ рд╣реЛ рдЧрдИ рдереА, рдХреИрд╢ рднрдВрдбрд╛рд░рдг рдХреА рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдмрдврд╝ рдЧрдИ рдереАред  рдЖрд╡реЗрджрди рдХреЗ рд▓рд┐рдП рд╕реНрдкрд╖реНрдЯ рд▓рд╛рдн рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕рдиреЗ рдордВрдЪ рдкрд░ рдХрд╛рдо рдХрд░рддреЗ рд╕рдордп рдкреИрдВрддрд░реЗрдмрд╛рдЬрд╝реА рдХреЗ рд▓рд┐рдП рдЬрдЧрд╣ рджреА: рдЬрдм рд╕рднреА рдШрдЯрдХреЛрдВ рдореЗрдВ рдПрдХ рд░рд┐рдЬрд░реНрд╡ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХрд╛ рдЬреАрд╡рди рдмрд╣реБрдд рд╕рд░рд▓ рд╣реЛрддрд╛ рд╣реИред  рд╣рд╛рдВ, рдЗрд╕ рдкрджреНрдзрддрд┐ рдХреА рдХрдорд┐рдпрд╛рдВ рднреА рд╣реИрдВ, рдпрд╣ рдПрдХ "рдмреИрд╕рд╛рдЦреА" рдХреА рддрд░рд╣ рд▓рдЧ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдпрд╣ рдкреИрд╕реЗ рдмрдЪрд╛рддрд╛ рд╣реИ, рд╕рдорд╕реНрдпрд╛ рдХреЛ рджреВрд░ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдирдП рд▓реЛрдЧреЛрдВ рдХрд╛ рдХрд╛рд░рдг рдирд╣реАрдВ рдмрдирддрд╛ рд╣реИ - рдХреНрдпреЛрдВ рдирд╣реАрдВ? <br><br><h2>  рдкреБрдирд╢реНрдЪ </h2><br>  рд╣рдорд╛рд░реЗ рдмреНрд▓реЙрдЧ рдореЗрдВ рднреА рдкрдврд╝реЗрдВ: <br><br><ul><li>  "рдбреИрдк рдХреЗ рд╕рд╛рде рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ" <i>(рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ</i> рд╕рд┐рдореНрдлрдиреА <i>-рдбреЗрдореЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ)</i> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 1 (рд╕рд░рд▓ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг)</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 2 (рд╣реЗрд▓реНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдбреЛрдХрд░ рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рддреИрдирд╛рдд рдХрд░рдирд╛)</a> ; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдЬреАрд╡рди рд╕реЗ: рдХреИрд╕реЗ Spaniards рдиреЗ HTTP рд╕рд░реНрд╡рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╢рд┐рдХрд╛рдпрдд рдирд╣реАрдВ рдХреА</a> ред" </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi457510/">https://habr.com/ru/post/hi457510/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi457494/index.html">"рдФрд░ рдЕрдЧрд░ рдореИрдВ рдЧрдгрд┐рдд рдирд╣реАрдВ рдЬрд╛рдирддрд╛, рддреЛ рдХреНрдпрд╛ рдореИрдВ рдирд┐рд░рд╛рд╢ рд╣реВрдБ?" - рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдЕрдХреНрд╕рд░ рд╡рд┐рдЬреНрдЮрд╛рди рд╡рд┐рдЬреНрдЮрд╛рди рдореЗрдВ рд╡реНрдпрд╡рд╕рд╛рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рд╢реНрдиреЛрдВ рдХреЗ рдЙрддреНрддрд░ рджреЗрддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi457496/index.html">"рдкрд╛рдВрдЪ рдЕрдВрддрд░ рдЦреЛрдЬреЗрдВред" рд╕реНрдХреЗрд▓реЗрдмрд▓ рдФрд░ рдЬреЗрдирд░реЗрд╢рди рдЕрдВрддрд░ - рдЯреЗрд╕реНрдЯ рдХреЗ рдирдП рдмреИрдЪ</a></li>
<li><a href="../hi457500/index.html">рд╣рдордиреЗ рд╕рд░реНрд╡рд┐рд╕ рд╕реНрдЯреЗрд╢рди рдХреЗ рд▓рд┐рдП рдСрдЯреЛрдкрд╛рдпрд▓рдЯ рдХреИрд╕реЗ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi457502/index.html">рдХреИрд╕реЗ RICE рд╕реНрдХреЛрд░рд┐рдВрдЧ рдореЙрдбрд▓ рдЙрддреНрдкрд╛рдж рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИ</a></li>
<li><a href="../hi457504/index.html">рдХреНрдпреЛрдВ 2019 рдореЗрдВ рдЕрдкрдирд╛ рд░рд┐рдПрдХреНрдЯ рдбреЗрдЯрд╛ рдЧреНрд░рд┐рдб рд▓рд┐рдЦреЗрдВ</a></li>
<li><a href="../hi457514/index.html">Nevangery</a></li>
<li><a href="../hi457516/index.html">рдПрдХ рдзрдордХреА рдореЙрдбрд▓ рд▓реЗрдЦрди</a></li>
<li><a href="../hi457518/index.html">рдмреНрд▓реЙрдХрдЪреИрди рд╕реНрдХреЗрд▓реЗрдмрд┐рд▓рд┐рдЯреА рдЯреНрд░рд╛рдЗрд▓реЗрдордорд╛ рдХреЗ рд╕рдорд╛рдзрд╛рди рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд▓рд╛рдЬреНрдорд╛ рдХреИрд╢ рдЪреЗрди</a></li>
<li><a href="../hi457522/index.html">рдЕрдкрдиреА рдореЗрд▓рд┐рдВрдЧ рд╕реВрдЪреА рд╕реЗрд╡рд╛ рдХреЛ рдмрдврд╝рд╛рдПрдВ рдпрд╛ рддреИрдпрд╛рд░ рдХрд┐рдП рдЧрдП рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ? UniSender рдореЗрдВ рдореИрдВрдиреЗ 5 рд╕рд╛рд▓ рдореЗрдВ рдХреНрдпрд╛ рд╕реАрдЦрд╛</a></li>
<li><a href="../hi457524/index.html">рдЧрд╣рд░рд╛рдИ рд╡рд╛рд▓реЗ рдХреИрдорд░реЗ - рдореВрдХ рдХреНрд░рд╛рдВрддрд┐ (рдЬрдм рд░реЛрдмреЛрдЯ рджреЗрдЦреЗрдВрдЧреЗ) рднрд╛рдЧ 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>