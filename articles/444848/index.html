<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è±Ô∏è üé¢ üòö Qu√© f√°cil es entregar un pedido, sabiendo la direcci√≥n del cliente (no muy) üìñ üë©üèæ‚Äç‚öïÔ∏è ‚ô®Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Mi nombre es Denis Girko, soy el arquitecto de sistemas de la plataforma de comercio electr√≥nico en Lamoda. El a√±o pasado habl√© en la co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Qu√© f√°cil es entregar un pedido, sabiendo la direcci√≥n del cliente (no muy)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/444848/"><p>  Hola a todos!  Mi nombre es Denis Girko, soy el arquitecto de sistemas de la plataforma de comercio electr√≥nico en Lamoda.  El a√±o pasado habl√© en la conferencia DevConf con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe</a> que quiero compartir con ustedes. </p><br><p> Este es un informe de revisi√≥n sobre las dificultades que encuentra una gran tienda en l√≠nea en el proceso de entrega de pedidos y qu√© soluciones t√©cnicas pueden ayudar a superarlas (utilizando las soluciones que probamos en Lamoda como ejemplo). </p><br><p><img src="https://habrastorage.org/webt/vc/1p/24/vc1p24p8id79oozynnspkyikg0k.jpeg" alt="imagen"></p><br><p>  ¬øDe qu√© se tratar√°?  Te dir√©: </p><br><ul><li>  Sobre el proceso de entrega e identificar problemas; </li><li>  c√≥mo almacenar efectivamente territorios de entrega en la base de datos; </li><li>  c√≥mo mejorar la calidad de los datos que recibimos del cliente; </li><li>  c√≥mo buscar el destinatario en la base de datos de direcciones para encontrar resultados m√°s precisos. </li></ul><a name="habracut"></a><br><h3 id="obschaya-shema-dostavki-zakaza-lamoda">  Esquema general de entrega de pedidos de Lamoda </h3><br><p>  Lamoda es una tienda en l√≠nea con cuatro pa√≠ses de entrega: Rusia, Ucrania, Kazajst√°n, Bielorrusia.  Entregamos productos al d√≠a siguiente debido a que tenemos nuestro propio servicio de entrega y una docena de socios externos cuyos servicios utilizamos.  La entrega es una gran parte de nuestro negocio. </p><br><p>  Lamoda acepta el pedido, solicita al cliente la direcci√≥n en el momento del registro y la pasa al servicio de mensajer√≠a. </p><br><p><img src="https://habrastorage.org/webt/ng/2d/i1/ng2di1movib3pmlisotbmwq-ffq.png" alt="imagen"></p><cut></cut><br><p>  ¬øQu√© pasa si no tenemos un servicio de mensajer√≠a, sino varios?  Luego se agrega el siguiente paso: para determinar qu√© servicio de entrega tomaremos el pedido. </p><br><p><img src="https://habrastorage.org/webt/1v/6z/7c/1v6z7ceacbfmk5kctkqh1ss1jeg.png" alt="imagen"></p><br><p>  Puede haber algunos criterios de selecci√≥n de negocios.  Pero lo primero que debe pensar es si este servicio de mensajer√≠a tiene entrega a la ciudad seleccionada por el cliente o no.  Por lo tanto, el primer paso para integrar cualquier empresa de mensajer√≠a en nuestro sistema es averiguar su √°rea de cobertura. <br><img src="https://habrastorage.org/webt/_n/xx/wv/_nxxwvl8qncwmm8vhqhgd2g_qo4.png" alt="imagen"><br>  A continuaci√≥n, debe aprender a verificar si la direcci√≥n del cliente se encuentra en este territorio o no. </p><br><p>  El esquema general se mejorar√° y se ver√° as√≠: </p><br><ul><li>  pedir una direcci√≥n; </li><li>  averiguar qu√© servicios de mensajer√≠a pueden entregarlo; </li><li>  seleccione el que desee de los disponibles. </li></ul><br><p><img src="https://habrastorage.org/webt/7r/av/xo/7ravxognqcj0njydxoauolhxsbk.png" alt="imagen"></p><br><p>  Ahora un poco m√°s sobre estos pasos. </p><br><h3 id="sprashivaem-u-klienta-adres">  Le pedimos al cliente la direcci√≥n </h3><br><p>  ¬øC√≥mo puedo preguntarle? </p><br><ol><li>  Solicite completar un campo grande.  El cliente martilla en su direcci√≥n, que adem√°s no necesita ninguna manipulaci√≥n complicada.  La direcci√≥n puede imprimirse en una hoja de papel, entregada al servicio de mensajer√≠a a pie, que luego lo resolver√° √©l mismo. </li><li>  La segunda opci√≥n es m√°s complicada.  Le pedimos al cliente que complete cada componente de la direcci√≥n en su campo.  Aqu√≠ ya puedes hacer algo.  Por ejemplo, compare la ciudad de Mosc√∫ con una lista dada de ciudades.  Pero funcionar√° mal, porque la ciudad de Mosc√∫ se puede escribir de muchas maneras: ‚Äúg.  Mosc√∫ "," Ciudad de Mosc√∫ "," Ciudad de Mosc√∫ "sin espacio, etc. </li><li>  Por lo tanto, hay una opci√≥n a√∫n m√°s avanzada.  Como la lista de ciudades que tenemos es finita, puede precompilar una lista de ciudades y sugerir que el cliente seleccione la que necesita.  La ventaja es que a cada elemento de dicha lista ya podemos asociar alg√∫n identificador aqu√≠.  A los desarrolladores nos encanta trabajar no con cadenas, sino con identificadores que se pueden usar en todos nuestros sistemas como el equivalente de la ciudad seleccionada.  Tengo un √≠ndice de la oficina central de correos en la diapositiva como identificador. <br><img src="https://habrastorage.org/webt/cz/q9/sy/czq9syl4hieoqj8h88c7trupbim.png" alt="imagen"></li></ol><br><h3 id="kakoy-sluzhboy-dostavki-vezem">  ¬øQu√© servicio de entrega estamos transportando? </h3><br><p>  Como tenemos un identificador (√≠ndice), dejemos que el territorio almacenado en nuestra base de datos est√© representado por una lista de √≠ndices.  En este caso, el algoritmo para verificar el ingreso de la ciudad al territorio es muy simple.  As√≠ que hag√°moslo: colocaremos los territorios de entrega recibidos de los servicios de mensajer√≠a en la base de datos en forma de √≠ndices. </p><br><p>  Los √≠ndices tienen sus pros y sus contras.  Dir√© de antemano que al principio Lamoda hizo exactamente eso: el resultado de elegir un cliente de la ciudad fue un √≠ndice, y nuestros √≠ndices se almacenaron en la base de datos.  ¬øPor qu√© un plus?  Como dije, un √≠ndice es algo que todos entienden.  Cualquier gerente que acaba de llegar a trabajar sabe qu√© es un √≠ndice.  Puede recibir de la empresa de mensajer√≠a de la ciudad, de alguna manera convertirlos en √≠ndices y usarlos.  La desventaja es que el √≠ndice es el identificador de la oficina de correos del correo ruso.  Y los asentamientos cercanos pueden compartir el mismo √≠ndice. </p><br><h3 id="pochemu-perestalo-hvatat-indeksov">  ¬øPor qu√© faltan los √≠ndices? </h3><br><p>  Un ejemplo simple: Lyubertsy.  Muy cerca se encuentra el pueblo de Marusino.  Marusino no tiene una oficina de correos; su correspondencia llega a una de las oficinas de correos de Lyubertsy.  Si quisi√©ramos agregar la entrega a Lyubertsy, pero no la entrega a Marusino, ya que puede que no sea rentable para nosotros, no podr√≠amos hacerlo solo por √≠ndice. <br><img src="https://habrastorage.org/webt/xy/5d/am/xy5damiwrmj4accagb5uckr8bma.png" alt="imagen"></p><br><p>  Otro ejemplo es cuando Lamoda se expandi√≥ y abri√≥ un segundo almac√©n de tr√°nsito en Mosc√∫.  Era necesario dividir Mosc√∫ en las mitades norte y sur.  Y ya al momento de realizar el pedido, entienda desde qu√© almac√©n de tr√°nsito se realizar√° la entrega.  En este caso, un √≠ndice por ciudad no ser√≠a suficiente. </p><br><p>  Decidimos usar geocoordenadas junto con √≠ndices.  Tomamos la direcci√≥n del cliente, la ejecutamos a trav√©s del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">geocodificador Yandex</a> .  En la salida, obtenemos no solo el √≠ndice, sino tambi√©n las coordenadas.  Utilizamos √≠ndices en los casos en que los detalles no son importantes.  Y las coordenadas especifican esos casos cuando necesita hacer una divisi√≥n delgada del territorio. </p><br><p>  Proporcionaron una interfaz en su programa de configuraci√≥n para especialistas en log√≠stica, que le permite dibujar un pol√≠gono en la parte superior del mapa.  Es simple: el punto cae en el vertedero - hay entrega, no cae - no. <br><img src="https://habrastorage.org/webt/_2/t3/pk/_2t3pkebkcck78k3imgkk6w8cdi.png" alt="imagen"><br>  <em>Interfaz de creaci√≥n de zona poligonal</em> </p><br><p>  La ventaja de que tenemos coordenadas geogr√°ficas para cada pedido fue la oportunidad de mejorar la interfaz que los especialistas en log√≠stica utilizan para hacer rutas para los representantes de ventas.  La interfaz muestra un mapa en el que se marcan los pedidos de los clientes.  El log√≠stico utiliza la herramienta de lazo, que combina las √≥rdenes adyacentes en una ruta.  Adem√°s, esta ruta va a un representante de ventas, es decir, una persona no necesita ir de un extremo de la ciudad al otro durante el d√≠a para tomar todos sus pedidos, todos est√°n geogr√°ficamente cerca. <br><img src="https://habrastorage.org/webt/4d/aq/ar/4daqar6z4vmutjh3mdumdwn-6ma.png" alt="imagen"><br>  <em>Interfaz de enrutamiento</em> </p><br><p>  La direcci√≥n ingresada por el cliente se convierte en coordenadas.  La probabilidad de que obtengamos las coordenadas de una direcci√≥n determinada depende directamente de la calidad de la direcci√≥n ingresada por el cliente.  Por lo tanto, lo primero que pensamos es c√≥mo aumentar el n√∫mero de direcciones bien reconocidas.  Por lo tanto, debe ayudar al cliente a ingresar la direcci√≥n correcta. </p><br><p>  El hecho es que los clientes a menudo no siguen los escenarios que les proporcionamos, por lo que adquirimos bases de datos de direcciones para cada uno de los 4 pa√≠ses a los que entregamos pedidos.  E hicieron una fiesta no solo por la ciudad, sino tambi√©n por la calle, e incluso por el n√∫mero de la casa.  Para hacer una lista de casas, analizamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">los</a> datos abiertos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de openstreetmap.org</a> . <br><img src="https://habrastorage.org/webt/bb/4n/bd/bb4nbdspyc75buacqdxmmi3jibk.png" alt="imagen"><br>  <em>El formulario de pago ofrece consejos para formalizar datos de direcciones</em> </p><br><h3 id="adresnaya-baza">  Base de direcciones </h3><br><p>  Para hacer un sujest en la base de direcciones, debe mantenerlo en casa.  ¬øD√≥nde obtuvimos todas las bases de direcciones para nuestros cuatro pa√≠ses?  En Rusia, es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FIAS</a> , la base de direcciones que compila y mantiene nuestro servicio de impuestos.  Es bastante completo, aunque no sin fallas.  Nuestros socios de entrega nos han ayudado con otros pa√≠ses. <br><img src="https://habrastorage.org/webt/tp/bi/_m/tpbi_m-s0oxwiiddhd_i5rrw-l8.png" alt="imagen"></p><br><p>  Tambi√©n tenemos un conjunto de scripts PHP que toman el formato con el que nos llega la base de direcciones, y de la misma manera que lo agrega a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PostgreSQL</a> .  ¬øPor qu√© en la misma forma?  Porque una de las tareas es actualizar peri√≥dicamente estas bases de datos de las mismas fuentes.  Esto significa que si proporcion√°ramos la conversi√≥n, tendr√≠a que repetirse con cada actualizaci√≥n. Por lo tanto, los datos van a PostgreSQL, y desde all√≠ se convierten y almacenan en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apache Solr</a> ;  Solr le permite buscarlos r√°pidamente y hacer lo mejor.  Un peque√±o servidor web PHP puede crear solicitudes en Solr, de acuerdo con sus resultados, se crea una lista para el cliente en el sitio para el mejor. </p><br><div class="spoiler">  <b class="spoiler_title">Ejemplo viviente</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ko/s4/cz/kos4czfszfi2egrtx2mnwxcaqwo.png" alt="imagen"></p></div></div><br><p><img src="https://habrastorage.org/webt/py/z_/pw/pyz_pw_qs26ypndty6qpowgilsi.png" alt="imagen"></p><br><p>  Descargamos datos de la fuente en aproximadamente la misma forma en que nos llegaron.  Es decir, con el mismo conjunto de campos, con los mismos tipos de columnas, etc.  Agr√©guelos como est√°n.  Intentamos usar los datos de esta forma desde el principio, y para transformarlos en aquellas estructuras con las que podemos trabajar, escribimos varias vistas.  Como tenemos 4 pa√≠ses, todo esto se multiplic√≥ por 4, y fue muy dif√≠cil y costoso apoyarlo.  Por lo tanto, era necesario hacer algo al respecto. </p><br><p>  Lo primero que eliminamos es la estructura no estructurada, o m√°s bien <em>espec√≠fica</em> , en una etapa temprana.  Es decir, tan pronto como se cargan los datos sin procesar, con la ayuda de las vistas, los transformamos en un formato unificado, con el cual todas nuestras otras transformaciones se configuran m√°s.  Esto nos salv√≥ de multiplicar por 4. Y es en este momento que nos olvidamos de la estructura en la que nos llegaron los datos, y trabajamos solo con lo que hemos inventado para nosotros mismos. <br><img src="https://habrastorage.org/webt/1s/zp/rn/1szprnn0rmejrvuop8uawdzwvaa.png" alt="imagen"></p><br><p>  Si necesita dos fuentes, desc√°rguelo.  Lo principal es que el formato de esta salida de datos despu√©s de la conversi√≥n a vistas es el mismo. <br><img src="https://habrastorage.org/webt/we/ru/dm/werudmivgvezc6ytbrgpmdr0ojm.png" alt="imagen"></p><br><p>  Otro requisito para las bases de datos de direcciones cargadas era que era necesario hacer correcciones de puntos.  Un ejemplo simple: en FIAS, la Rep√∫blica de Chuvash se llama "Representante de Chuvash.  "Chuvasia".  Bueno, queremos solo la Rep√∫blica Chuvash.  ¬øPor qu√© necesitamos este gui√≥n?  Y al mismo tiempo, a√∫n no podemos evitar actualizaciones peri√≥dicas de las fuentes. </p><br><p>  Aqu√≠ est√°n las siguientes capas que tenemos en PostgreSQL. <br><img src="https://habrastorage.org/webt/gf/is/a2/gfisa2hm2svx2gkehzy5raekpim.png" alt="imagen"></p><br><p>  Las tablas de la izquierda son datos sin procesar descargados de la fuente. </p><br><p>  Detr√°s de ellos hay vistas que convierten los datos a un formato est√°ndar. </p><br><p>  <em>Las anulaciones locales</em> son nuestro conjunto de tablas que puntualmente redefinen algunos atributos de los datos de direcci√≥n cargados.  Hemos incluido aqu√≠, por ejemplo, que un registro con dicho identificador deber√≠a recibir en lugar de "Chuvash rep.  - Chuvasia ‚Äùes nuestro nombre elegido. </p><br><p> <em>La tabla de mapeo</em> es nuestro repositorio de identificadores, que nosotros mismos asignamos a los objetos de direcci√≥n que descargamos; esto nos permiti√≥ abstraer nuestros sistemas de la fuente, de esos identificadores que se usan en la fuente, y tambi√©n para ocultar no una fuente, sino incluso varias, bajo una ID Lo contar√© un poco m√°s tarde.  Todo esto junto se combina y se fija en una vista materializada.  Por lo tanto, obtenemos casi el equivalente de la tabla final, que puede actualizarse ejecutando un comando SQL <code>REFRESH MATERIALIZED VIEW</code> . </p><br><p>  <em>Objetos de</em> direcci√≥n: base de direcciones formada con todas las correcciones y adiciones. </p><br><p>  Entonces, en la salida ya hemos corregido los objetos de direcci√≥n, ya con nuevos nombres y nuestros identificadores.  Todo esto se transforma y desnormaliza, como conveniente para la b√∫squeda, y se suma en Solr. </p><br><p>  Dado que ahora tenemos bases de datos de direcciones, ser√≠a genial usarlas no solo para hacer un ajuste para el formulario de pedido, sino tambi√©n para hacer una b√∫squeda.  ¬øD√≥nde puede ser √∫til una b√∫squeda?  Resulta mucho d√≥nde.  Las mismas √°reas de entrega que recibimos de los servicios de mensajer√≠a a menudo est√°n representadas simplemente por una lista de ciudades.  Y la lista de ciudades est√° plagada de los mismos problemas que con la entrada del usuario: las ciudades pueden tener diferentes interpretaciones, diferentes nombres y m√°s. </p><br><p>  Tengo una diapositiva especial aqu√≠, una historia de horror: ¬øqu√© tendr√≠amos que hacer si tom√°ramos todo manualmente para convertirlo a PHP? </p><br><p><img src="https://habrastorage.org/webt/7t/p4/eo/7tp4eoy0jtxnevev1-0pgdk_axi.png" alt="imagen"></p><br><blockquote>  Adici√≥n: en la pantalla, una pieza de c√≥digo real del servicio, que se volvi√≥ innecesaria solo por las soluciones descritas. </blockquote><p>  Hemos clasificado estos problemas. </p><br><p>  1) Nombres equivalentes de los mismos objetos.  Por ejemplo, sin√≥nimos comunes como Chuvasia y la Rep√∫blica de Chuvasia. </p><br><p>  2) Ciudades renombradas.  Ucrania se encuentra ahora en la fase activa de deshacerse del pasado comunista, por lo que literalmente todos los d√≠as hacen cambios en los nombres de sus asentamientos.  Por esta raz√≥n, puede resultar que en una base de datos tengamos nombres antiguos y en otra, nuevos. </p><br><p>  3) Muchos errores.  A menudo se equivoca en el estado de los asentamientos.  Hay un pueblo, aqu√≠ hay un pueblo o aqu√≠ hay un pueblo, hay una granja. </p><br><p>  4) Palabras extranjeras transliteradas al ruso, a menudo el mismo nombre se transcribe de diferentes maneras. </p><br><p>  5) Hay muchos errores en la jerarqu√≠a: Zelenograd, por costumbre, pertenece a la regi√≥n de Mosc√∫, aunque formalmente tambi√©n figura en Mosc√∫ como FIAS.  Escriba correctamente "Ciudad de Mosc√∫, Zelenograd". </p><br><p>  ¬øC√≥mo se nos ocurri√≥ esto? </p><br><p>  Lo primero que hacemos es separar todos los componentes insignificantes de la direcci√≥n de los nombres.  No los tiramos a la basura, participan en la b√∫squeda, sino por separado de las partes importantes. <br><img src="https://habrastorage.org/webt/pj/l-/hm/pjl-hmgtn30iryqakbsqjrll6qy.png" alt="imagen"></p><br><p>  Luego, hicimos una breve lista de sin√≥nimos y abreviaturas comunes que se usan en los nombres.  Donde la fuente lo permiti√≥, cargamos y pusimos todos los nombres en Solr.  No solo los sin√≥nimos y nombres hist√≥ricos m√°s relevantes, sino tambi√©n posibles. </p><br><p>  Para una mejor b√∫squeda, descartamos todas las letras que pueden presentar discrepancias.  Esto se aplica al idioma ruso y aquellos idiomas con los que todav√≠a tenemos que lidiar. </p><br><p>  Corregimos errores tipogr√°ficos y arreglamos el dise√±o. </p><br><p>  Finalmente, se nos ocurrieron padres fantasmas: estos son padres asignados a objetos.  Son relevantes en la b√∫squeda, pero no participan en el resultado de la b√∫squeda.  Por ejemplo, para Zelenograd, agregamos la regi√≥n de Mosc√∫.  Ahora puede buscar "Regi√≥n de Mosc√∫, Zelenograd" y encontrar el objeto que necesitamos, pero en los resultados de b√∫squeda seguir√° siendo el correcto "Mosc√∫, Zelenograd". </p><br><p><img src="https://habrastorage.org/webt/rw/kh/qm/rwkhqme_rixhx9dz1du34m0hrqy.png" alt="imagen"></p><br><p>  Dependiendo de los requisitos comerciales, se necesita una gradaci√≥n diferente de la precisi√≥n de b√∫squeda.  Por lo tanto, tenemos 4 grados, cada uno de ellos da un resultado con una probabilidad m√°s alta, pero con una probabilidad m√°s baja ser√° exactamente el resultado que se busca. <br><img src="https://habrastorage.org/webt/hn/hw/lh/hnhwlh7kyr55fbn5b-eqqqlsxtc.png" alt="imagen"></p><br><p>  ¬øY d√≥nde encontramos esa aplicaci√≥n de b√∫squeda? </p><br><ul><li>  Una vez m√°s, ejecutamos la direcci√≥n ingresada por el cliente a trav√©s de dicha b√∫squeda.  Si no utiliz√≥ nuestros consejos en la p√°gina de pago, entonces tenemos una oportunidad m√°s de convertir las l√≠neas que ingres√≥ en identificadores.  Obtenemos una direcci√≥n formal. </li><li>  Revisamos esta b√∫squeda todo lo que nos env√≠an los servicios de mensajer√≠a: reconocemos las ciudades que nos transmiten.  Esto nos permiti√≥ lanzar solo 10 piezas al d√≠a, esto es relevante para B2B: Lamoda proporciona su entrega a empresas de terceros, por lo que hay muchos servicios de mensajer√≠a nuevos conectados por unidad de tiempo. </li><li>  Esto nos permiti√≥ "encadenar" informaci√≥n √∫til en nuestros identificadores en bases de datos de direcciones.  Por ejemplo, descargamos zonas horarias, direcciones IP, para buscar ciudades por direcciones IP de clientes. </li><li>  Ahora tenemos la oportunidad de ocultar la base de direcciones combinada de dos fuentes con uno de nuestros identificadores.  Es decir, permiti√≥ evitar duplicados y hacer coincidir los mismos objetos de direcci√≥n en ambas bases. </li></ul><br><p>  No nos detenemos  Este es un proceso que a√∫n podemos mejorar. </p><br><p>  En primer lugar, Lamoda trabaja en √≠ndices.  Es decir, nuestros identificadores son √≠ndices, de los cuales conocemos las desventajas.  Casi todos nuestros sistemas han cambiado a la nueva API; operan no con √≠ndices, sino con los mismos identificadores que nosotros mismos asignamos a nuestros objetos de direcci√≥n.  La ventaja es que verificar una ciudad en el territorio es tan simple como con √≠ndices.  Sin embargo, no hay ning√∫n inconveniente en el hecho de que varios asentamientos pueden esconderse detr√°s de una identificaci√≥n. </p><br><blockquote>  Adici√≥n: ha pasado el tiempo desde el momento de mi discurso, y ahora me complace corregirme: nuestros √≠ndices ahora solo permanecen en el caso, cuando el servicio de mensajer√≠a nos da su territorio en forma de una lista de ellos, por ejemplo, Russian Post.  En otros casos, los √≠ndices fueron suplantados por nuestros identificadores de direcci√≥n internos. </blockquote><p>  En la diapositiva hay una parte de la interfaz que le permite configurar manualmente el territorio, pero, de hecho, todo se configura a partir de listas cargadas por lotes de objetos de direcci√≥n en forma de cadenas. <br><img src="https://habrastorage.org/webt/n9/-1/rn/n9-1rnlutwkmd8-tpnyfaxiwuxg.png" alt="imagen"></p><br><p>  Descargamos coordenadas geogr√°ficas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">openstreetmap.org</a> para hogares.  Ahora, en un gran porcentaje de casos, no necesitamos ir a un servicio externo para averiguar la ubicaci√≥n.  Esto nos redujo 10 veces los viajes a Yandex, lo que naturalmente ahorr√≥ dinero. </p><br><p>  Nos deshacemos de PHP en la cadena de b√∫squeda de datos de direcci√≥n.  Reescribimos el c√≥digo que accedi√≥ a Solr en Lua.  Reemplazado nginx con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Openresty</a> , ahora todo es muy r√°pido y puede soportar cargas pesadas.  El 95% de las respuestas de nuestro servicio de b√∫squeda caben en 10 milisegundos, lo cual es m√°s que suficiente para nosotros. </p><br><p><img src="https://habrastorage.org/webt/6b/th/wm/6bthwmdw9aq79khamwrwrqfgbqc.png" alt="imagen"></p><br><blockquote>  Adici√≥n: el uso de Openresty y Lua, que atrajo su desempe√±o, fue una especie de experimento que vali√≥ la pena: el servicio funciona r√°pidamente, es estable bajo carga y se mantiene f√°cilmente.  Pero desde entonces, Lamoda ha adoptado Golang, que tiene las mismas cualidades, como uno de los lenguajes de programaci√≥n para el backend cargado.  Si la decisi√≥n de desarrollar el servicio se tomara ahora, lo preferir√≠amos. </blockquote><br><h3 id="vyvod">  Conclusi√≥n </h3><br><p>  Mi moralidad personal de todo el trabajo realizado es que los datos de direcci√≥n son un √°rea donde no se puede esperar una calidad de datos ideal.  Esto nunca suceder√°.  Nunca recibiremos datos perfectos de un cliente o de fuentes externas.  Por lo tanto, tienes que exprimir al m√°ximo lo que es. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/444848/">https://habr.com/ru/post/444848/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444838/index.html">Meetup de OWASP Rusia</a></li>
<li><a href="../444840/index.html">3. Punto de verificaci√≥n Comenzando R80.20. Preparaci√≥n del dise√±o</a></li>
<li><a href="../444842/index.html">La primera computadora programable de ADN</a></li>
<li><a href="../444844/index.html">¬øHay una marca registrada para registrar? o c√≥mo nos vimos obligados a cambiar el nombre de la aplicaci√≥n</a></li>
<li><a href="../444846/index.html">ML.NET 0.11 - Aprendizaje autom√°tico para .Net</a></li>
<li><a href="../444850/index.html">Mec√°nica cu√°ntica: el fin de la guerra de interpretaciones</a></li>
<li><a href="../444852/index.html">Hogar inteligente - Repensar</a></li>
<li><a href="../444854/index.html">Creaci√≥n de elementos de interfaz mediante programaci√≥n mediante PureLayout (Parte 1)</a></li>
<li><a href="../444858/index.html">En busca del mejor remedio</a></li>
<li><a href="../444860/index.html">OFFZONE 2.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>