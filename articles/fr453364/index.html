<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèø üë≤üèæ üè≠ Une histoire de d√©ploiement qui a tout affect√© üì¶ üëã ‚úèÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ennemis de la r√©alit√© par 12f-2 

 Fin avril, alors que les marcheurs blancs assi√©geaient Winterfell, quelque chose de plus int√©ressant s'est produit ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une histoire de d√©ploiement qui a tout affect√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/453364/"><img src="https://habrastorage.org/webt/kc/5y/q_/kc5yq_bh4rgol9q8lebwmzsldca.jpeg"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ennemis de la r√©alit√©</a> par 12f-2</i> <br><br>  Fin avril, alors que les marcheurs blancs assi√©geaient Winterfell, quelque chose de plus int√©ressant s'est produit pour nous, nous avons fait un d√©ploiement inhabituel.  En principe, nous d√©ployons constamment de nouvelles fonctionnalit√©s dans la prod (comme tout le monde).  Mais celui-ci n'√©tait pas comme tout le monde.  Son √©chelle √©tait telle que toute erreur potentielle que nous pourrions commettre affecterait tous nos services et utilisateurs.  En cons√©quence, nous avons tout d√©ploy√© conform√©ment au plan, dans les temps d'arr√™t pr√©vus et annonc√©s, sans cons√©quences pour la vente.  L'article explique comment nous y sommes parvenus et comment ceux qui le souhaitent peuvent le r√©p√©ter chez eux. <br><a name="habracut"></a><br>  Je ne d√©crirai pas maintenant nos d√©cisions architecturales et techniques, je ne dirai pas comment tout cela fonctionne.  Il s'agit probablement de notes marginales sur la fa√ßon dont s'est d√©roul√© l'un des d√©ploiements les plus difficiles, que j'ai observ√©es et auxquelles j'ai particip√© directement.  Je ne pr√©tends pas √™tre des d√©tails complets ou techniques, peut-√™tre qu'ils appara√Ætront dans un autre article. <br><br><h2>  Contexte + quel type de fonctionnalit√© est-ce </h2><br>  Nous construisons la plateforme cloud <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mail.ru Cloud Solutions</a> (MCS), o√π je travaille en tant que CTO.  Et maintenant - il est temps de se connecter √† notre plateforme IAM (Identity and Access Management), qui fournit une gestion unifi√©e de tous les comptes d'utilisateurs, utilisateurs, mots de passe, r√¥les, services et plus encore.  Pourquoi est-il n√©cessaire dans le cloud est une question √©vidente: toutes les informations utilisateur y sont stock√©es. <br><br>  En r√®gle g√©n√©rale, ces choses commencent √† se construire au tout d√©but d'un projet.  Mais MCS a toujours √©t√© un peu diff√©rent.  MCS a √©t√© construit en deux parties: <br><br><ul><li>  Openstack avec son propre module d'autorisation Keystone, </li><li>  Hotbox (stockage S3) bas√© sur le projet Cloud Mail.ru, </li></ul><br>  autour duquel de nouveaux services sont alors apparus. <br><br>  Il s'agissait essentiellement de deux types d'autorisation diff√©rents.  De plus, nous avons utilis√© des d√©veloppements Mail.ru distincts, par exemple, le stockage g√©n√©ral des mots de passe Mail.ru, ainsi qu'un connecteur openid auto-√©crit, qui permettait la SSO (autorisation directe) dans le panneau Horizon des machines virtuelles (UI native OpenStack). <br><br>  Faire IAM signifiait pour nous de combiner tout cela en un seul syst√®me, compl√®tement le n√¥tre.  Dans le m√™me temps, ne perdez aucune fonctionnalit√© en cours de route, cr√©ez un backlog pour l'avenir, ce qui nous permettra de l'affiner de mani√®re transparente sans refactoring et de le mettre √† l'√©chelle par fonctionnalit√©.  Toujours au d√©but, les utilisateurs sont apparus comme un mod√®le d'acc√®s aux services (RBAC central, contr√¥le d'acc√®s bas√© sur les r√¥les) et quelques autres petites choses. <br><br>  La t√¢che s'est av√©r√©e non triviale: python et perl, plusieurs backends, des services √©crits de mani√®re ind√©pendante, plusieurs √©quipes de d√©veloppement et des administrateurs.  Et surtout, des milliers d'utilisateurs en direct sur le syst√®me de production de combat.  Tout cela devait √™tre √©crit et, surtout, d√©ploy√© sans faire de victimes. <br><br><h2>  Qu'allons-nous d√©ployer </h2><br>  Si c'est tr√®s grossier, quelque part en 4 mois, nous avons pr√©par√© ceci: <br><br><ul><li>  Ils ont cr√©√© plusieurs nouveaux d√©mons qui ont agr√©g√© des fonctions qui fonctionnaient auparavant dans diff√©rentes parties de l'infrastructure.  D'autres services se sont vu imposer un nouveau backend sous la forme de ces d√©mons. </li><li>  Nous avons √©crit notre propre r√©f√©rentiel central de mots de passe et de cl√©s, disponible pour tous nos services, qui peut √™tre librement modifi√© selon nos besoins. </li><li>  √Ä partir de z√©ro, ils ont √©crit 4 nouveaux backends pour Keystone (utilisateurs, projets, r√¥les, attributions de r√¥les), qui, en fait, ont remplac√© sa base et agissent d√©sormais comme un r√©f√©rentiel unique de nos mots de passe utilisateur. </li><li>  Nous avons appris √† tous nos services Openstack √† appliquer leurs strat√©gies √† un service de strat√©gie tiers au lieu de lire ces strat√©gies localement depuis chaque serveur (oui, par d√©faut, Openstack fonctionne comme √ßa!) </li></ul><br>  Une telle modification importante n√©cessite des changements importants, complexes et, surtout, synchrones dans plusieurs syst√®mes √©crits par diff√©rentes √©quipes de d√©veloppement.  Apr√®s l'assemblage, l'ensemble du syst√®me devrait fonctionner. <br><br>  Comment d√©ployer de tels changements et ne pas les g√¢cher?  Tout d'abord, nous avons d√©cid√© de regarder un peu vers l'avenir. <br><br><h2>  D√©ployer la strat√©gie </h2><br><ul><li>  Il serait possible de d√©ployer en plusieurs √©tapes, mais cela augmenterait le temps de d√©veloppement de trois fois.  De plus, pendant un certain temps, nous aurions une d√©synchronisation compl√®te des donn√©es dans les bases de donn√©es.  Je devrais √©crire mes propres outils de synchronisation et vivre avec plusieurs entrep√¥ts de donn√©es pendant longtemps.  Et cela cr√©e une grande vari√©t√© de risques. </li><li>  Tout ce qu'ils pouvaient pr√©parer de mani√®re transparente pour l'utilisateur √©tait fait √† l'avance.  Cela a pris 2 mois. </li><li>  Nous nous sommes permis des temps d'arr√™t pendant plusieurs heures - uniquement pour les op√©rations utilisateur pour cr√©er et modifier des ressources. </li><li>  Pour le travail de toutes les ressources d√©j√† cr√©√©es, les temps d'arr√™t √©taient inacceptables.  Nous avions pr√©vu que lors du d√©ploiement, les ressources devraient fonctionner sans temps d'arr√™t et sans impact pour les clients. </li><li>  Pour r√©duire l'impact sur nos clients, en cas de probl√®me, nous avons d√©cid√© de nous d√©ployer dimanche soir.  La nuit, moins de clients g√®rent les machines virtuelles. </li><li>  Nous avons pr√©venu tous nos clients que pendant la p√©riode choisie pour le d√©ploiement, la gestion des services ne serait pas disponible. </li></ul><br><h2>  Digression: qu'est-ce que le d√©ploiement? </h2><br>  <i>&lt;philosophie de prudence&gt;</i> <br><br>  Chaque sp√©cialiste informatique r√©pondra facilement √† ce qu'est le d√©ploiement.  Vous mettez CI / CD, et automatiquement tout est livr√© au prod.  :) <br><br>  Bien s√ªr, c'est vrai.  Mais la difficult√© est qu'avec les outils modernes d'automatisation de la livraison de code, la compr√©hension du roulement lui-m√™me est perdue.  Comment oubliez-vous l'invention √©pique de la roue, en regardant les v√©hicules modernes.  Tout est tellement automatis√© que le d√©ploiement se fait souvent sans se rendre compte de la situation dans son ensemble. <br><br>  Et l'image est la suivante.  Le d√©ploiement se compose de quatre grands aspects: <br><br><ol><li>  Livraison du code, y compris la modification des donn√©es.  Par exemple, leur migration. </li><li>  Rollback de code - la possibilit√© de revenir en cas de probl√®me.  Par exemple, par la cr√©ation de sauvegardes. </li><li>  L'heure de chaque op√©ration de d√©ploiement / annulation.  Il faut comprendre le calendrier de toute op√©ration des deux premiers points. </li><li>  Fonctionnalit√© affect√©e.  Il est n√©cessaire d'√©valuer √† la fois les effets positifs et n√©gatifs attendus. </li></ol><br>  Tous ces aspects doivent √™tre pris en compte pour un d√©ploiement r√©ussi.  Habituellement, ils n'√©valuent que le premier, au mieux, le deuxi√®me point, puis le d√©ploiement est consid√©r√© comme r√©ussi.  Mais les troisi√®me et quatri√®me sont encore plus importants.  Quel utilisateur l'aimera si le d√©ploiement prend 3 heures au lieu d'une minute?  Ou si quelque chose de superflu affecte le d√©ploiement?  Ou le temps d'arr√™t d'un service entra√Ænera des cons√©quences impr√©visibles? <br><br><h2>  Acte 1..n, pr√©paration √† la lib√©ration </h2><br>  Au d√©but, j'ai pens√© d√©crire bri√®vement nos r√©unions: toute l'√©quipe, ses parties, des tas de discussions en points caf√©, des disputes, des tests, des temp√™tes c√©r√©brales.  J'ai alors pens√© que ce serait superflu.  Quatre mois de d√©veloppement consistent toujours en cela, surtout lorsque vous √©crivez non pas quelque chose qui peut √™tre livr√© en permanence, mais une grande caract√©ristique d'un syst√®me vivant.  Ce qui affecte tous les services, mais les utilisateurs ne devraient rien changer sauf le "bouton unique dans l'interface Web". <br><br>  Notre compr√©hension du d√©ploiement, a chang√© √† chaque nouvelle r√©union, et de mani√®re tr√®s significative.  Par exemple, nous allions mettre √† jour l'ensemble de notre base de facturation.  Mais ils ont calcul√© le temps et se sont rendu compte qu'il √©tait impossible de le faire dans un d√©lai de d√©ploiement raisonnable.  Nous avons mis pr√®s d'une semaine suppl√©mentaire pour partager et archiver la base de donn√©es de facturation.  Et lorsque la vitesse de d√©ploiement attendue n'a pas fonctionn√© apr√®s cela, ils ont command√© un fer suppl√©mentaire, plus puissant, o√π ils ont tra√Æn√© toute la base.  Non pas que nous ne voulions pas le faire plus t√¥t, mais le besoin actuel de d√©ploiement ne nous a laiss√© aucune option. <br><br>  Lorsque l'un de nous a dout√© que le d√©ploiement puisse affecter la disponibilit√© de nos machines virtuelles, nous avons pass√© une semaine √† tester, exp√©rimenter, analyser le code et avons clairement compris que cela ne se produirait pas dans notre production, et m√™me les personnes les plus douteuses √©taient d'accord avec cela. <br><br>  Pendant ce temps, les gars du support technique ont men√© leurs exp√©riences ind√©pendantes pour √©crire aux clients des instructions sur la fa√ßon de se connecter, qui devaient changer apr√®s le d√©ploiement.  Ils ont travaill√© sur une exp√©rience utilisateur conviviale, pr√©par√© des instructions et fourni des conseils personnalis√©s. <br><br>  Nous avons automatis√© toutes les op√©rations de d√©ploiement qui √©taient possibles.  Toute op√©ration √©tait script√©e, m√™me la plus simple, conduisait constamment des tests.  Ils ont discut√© de la meilleure fa√ßon de d√©sactiver le service - r√©duire le d√©mon ou bloquer l'acc√®s au service avec un pare-feu.  Une check-list des √©quipes a √©t√© cr√©√©e pour chaque √©tape de d√©ploiement, elle a √©t√© constamment mise √† jour.  Nous avons dessin√© et constamment mis √† jour le diagramme de Gantt pour tous les travaux de d√©ploiement, avec des horaires. <br><br>  Et donc ... <br><br><h2>  Acte final, avant le d√©ploiement </h2><br>  ... il est temps de se d√©ployer. <br><br>  Comme dit le proverbe, une ≈ìuvre d'art ne peut pas √™tre achev√©e, seulement pour finir de travailler dessus.  Il est n√©cessaire de faire un effort volontaire, en comprenant que vous ne trouverez pas tout, mais en croyant que vous avez fait toutes les hypoth√®ses raisonnables, pr√©vues pour tous les cas possibles, ferm√© tous les bogues critiques et que tous les participants ont fait tout ce qu'ils pouvaient.  Plus vous d√©ployez de code, plus il est difficile de s'en convaincre (d'ailleurs, tout le monde comprend qu'il est impossible de tout pr√©voir). <br><br>  Nous avons d√©cid√© que nous √©tions pr√™ts √† nous d√©ployer lorsque nous avons √©t√© convaincus que nous avions fait tout ce qui √©tait en notre pouvoir pour r√©duire tous les risques pour nos utilisateurs li√©s aux effets et aux temps d'arr√™t inattendus.  C'est-√†-dire que tout peut aller mal sauf: <br><br><ol><li>  L'affect (sacr√© pour nous, le plus pr√©cieux) de l'infrastructure utilisateur, </li><li>  Fonctionnalit√©: l'utilisation de notre service apr√®s le d√©ploiement devrait √™tre la m√™me qu'avant. </li></ol><br><h2>  D√©ployer </h2><br><img src="https://habrastorage.org/webt/mx/vt/yq/mxvtyqnl26yvqbxhego52zj9d8c.png"><br>  <i>Deux roulent, 8 n'interf√®rent pas</i> <br><br>  Nous prenons le temps d'arr√™t pour toutes les demandes des utilisateurs dans les 7 heures.  √Ä l'heure actuelle, nous avons √† la fois un plan de d√©ploiement et un plan de retour en arri√®re. <br><br><ul><li>  Le d√©ploiement lui-m√™me prend environ 3 heures. </li><li>  2 heures - pour les tests. </li><li>  2 heures - une r√©serve pour un √©ventuel retour en arri√®re des modifications. </li></ul><br>  Un diagramme de Gantt a √©t√© compil√© pour chaque action, combien de temps cela prend, ce qui se passe en s√©quence, ce qui se fait en parall√®le. <br><br><img src="https://habrastorage.org/webt/gl/4v/2p/gl4v2pcxxorqbzzhuvlbdsi0jtg.png"><br>  <i>Une tranche du diagramme de d√©ploiement de Gantt, l'une des versions ant√©rieures (sans ex√©cution parall√®le).</i>  <i>L'outil de synchronisation le plus pr√©cieux</i> <br><br>  Tous les participants ont leur r√¥le dans le d√©ploiement, quelles t√¢ches ils font, dont ils sont responsables.  Nous essayons de rendre chaque √©tape automatique, de revenir en arri√®re, de recueillir des commentaires et de recommencer. <br><br><h3>  Chronique des √©v√©nements </h3><br>  Ainsi, 15 personnes sont venues travailler le dimanche 28 avril √† 22h.  En plus des participants cl√©s, certains sont venus simplement pour soutenir l'√©quipe, pour laquelle un merci sp√©cial √† eux. <br><br>  S√©par√©ment, il convient de mentionner que notre testeur de cl√©s est en vacances.  Il est impossible de le d√©ployer sans test, nous travaillons sur des options.  Une coll√®gue accepte de nous tester hors vacances, pour laquelle elle a une immense gratitude de la part de toute l'√©quipe. <br><br>  <b>00:00.</b>  <b>Arr√™ter</b> <br>  Nous arr√™tons les demandes des utilisateurs, suspendons la plaque signal√©tique, disent-ils, les travaux techniques.  La surveillance crie, mais tout est normal.  Nous v√©rifions que rien n'est tomb√©, sauf qu'il devrait.  Et nous commen√ßons √† travailler sur la migration. <br><br>  Tout le monde a un plan de d√©ploiement imprim√© pour les points, tout le monde sait qui fait quoi et √† quel moment.  Apr√®s chaque action, nous v√©rifions les horaires qui ne les d√©passent pas, et tout se passe comme pr√©vu.  Ceux qui ne sont pas directement impliqu√©s dans le d√©ploiement au stade actuel se pr√©parent en lan√ßant un jouet en ligne (Xonotic, type 3 kwaki), afin de ne pas g√™ner les coll√®gues.  :) <br><br>  <b>02h00</b>  <b>D√©ploy√©</b> <br>  Une agr√©able surprise - nous avons termin√© le d√©ploiement une heure plus t√¥t, en raison de l'optimisation de nos bases de donn√©es et de nos scripts de migration.  Le cri universel, "d√©ploy√©!"  Toutes les nouvelles fonctions de la prod, mais jusqu'ici seulement, nous pouvons voir l'interface.  Tout le monde passe en mode test, tri√© en tas et commence √† regarder ce qui s'est finalement pass√©. <br><br>  Cela n‚Äôa pas tr√®s bien fonctionn√©, nous le comprenons au bout de 10 minutes, lorsque rien n‚Äôest connect√© et ne fonctionne pas dans les projets des membres de l‚Äô√©quipe.  Synchronisation rapide, exprimer nos probl√®mes, prioriser, se diviser en √©quipes et d√©boguer. <br><br>  <b>2 h 30</b>  <b>Deux gros probl√®mes contre quatre yeux</b> <br>  Nous trouvons deux gros probl√®mes.  Nous avons r√©alis√© que les clients ne verront pas certains services connect√©s et qu'il y aura des probl√®mes avec les comptes partenaires.  Les deux sont associ√©s √† des scripts de migration imparfaits pour certains cas marginaux.  Nous devons le r√©parer maintenant. <br><br>  Nous √©crivons des requ√™tes qui corrigent cela, au moins 4 yeux.  Nous roulons sur la pr√©-porte pour nous assurer qu'ils fonctionnent et ne cassent rien.  Vous pouvez continuer.  En parall√®le, nos tests d'int√©gration habituels commencent, ce qui d√©tecte quelques probl√®mes suppl√©mentaires.  Tous sont petits, mais doivent √©galement √™tre r√©par√©s. <br><br>  <b>3 h 00</b>  <b>-2 probl√®mes +2 probl√®mes</b> <br>  Les deux grands probl√®mes pr√©c√©dents sont r√©solus, presque tous les probl√®mes mineurs aussi.  Tous les correctifs inoccup√©s travaillent activement dans leurs comptes et signalent ce qu'ils trouvent.  Nous priorisons, distribuons par commandes, laissons sans critique le matin. <br><br>  En ex√©cutant √† nouveau les tests, ils r√©v√®lent deux nouveaux gros probl√®mes.  Toutes les strat√©gies de service ne sont pas arriv√©es correctement, donc certaines demandes des utilisateurs ne s'authentifient pas.  Plus un nouveau probl√®me avec les comptes partenaires.  Nous nous pr√©cipitons pour regarder. <br><br>  <b>03:20.</b>  <b>Synchronisation d'urgence</b> <br>  Un nouveau probl√®me a √©t√© corrig√©.  Pour la seconde, nous organisons une synchronisation d'urgence.  Nous comprenons ce qui se passe: le correctif pr√©c√©dent a r√©solu un probl√®me, mais en a cr√©√© un autre.  Nous prenons une pause pour comprendre comment le faire correctement et sans cons√©quences. <br><br>  <b>3 h 30</b>  <b>Six yeux</b> <br>  Nous sommes conscients de ce que devrait √™tre l'√©tat final de la base pour que tout soit bon pour tous les partenaires.  Nous r√©digeons une demande en 6 yeux, roulons sur la pr√©-tige, testons, roulons sur la prod. <br><br>  <b>04h00.</b>  <b>Tout fonctionne</b> <br>  Tous les tests ont r√©ussi, aucun probl√®me critique n'est visible.  De temps en temps, quelque chose ne fonctionne pas en √©quipe, nous r√©agissons rapidement.  Le plus souvent, l'alarme est fausse.  Mais parfois, quelque chose n'a pas atteint, quelque part une page s√©par√©e ne fonctionne pas.  Nous nous asseyons, r√©parons, r√©parons, r√©parons.  Une √©quipe distincte lance la derni√®re grande fonctionnalit√© - la facturation. <br><br>  <b>04h30.</b>  <b>Point de non retour</b> <br>  Le point de non-retour approche, c'est-√†-dire le moment o√π, si nous commen√ßons √† reculer, nous ne respecterons pas le temps d'arr√™t qui nous est donn√©.  Il y a des probl√®mes avec la facturation, qui sait tout et √©crit, mais qui ne veut pas obstin√©ment annuler l'argent des clients.  Il y a plusieurs bogues sur des pages individuelles, des actions, des statuts.  La fonctionnalit√© principale fonctionne, tous les tests r√©ussissent.  Nous d√©cidons que le d√©ploiement a eu lieu, nous ne reculerons pas. <br><br>  <b>6 h 00</b>  <b>Nous ouvrons du tout dans l'interface utilisateur</b> <br>  Les bugs sont corrig√©s.  Certains utilisateurs non concern√©s sont laiss√©s pour plus tard.  Nous ouvrons l'interface √† tout le monde.  Nous continuons √† √©voquer la facturation, √† attendre les commentaires des utilisateurs et √† surveiller les r√©sultats. <br><br>  <b>07h00</b>  <b>Probl√®mes de chargement d'API</b> <br>  Il devient clair que nous avons une petite charge mal planifi√©e sur notre API et testons cette charge, ce qui n'a pas pu identifier le probl√®me.  En cons√©quence, environ 5% des demandes √©chouent.  Nous nous mobilisons, recherchons une raison. <br><br>  La facturation est t√™tue, ne veut pas travailler non plus.  Nous d√©cidons de le reporter pour plus tard afin d'apporter des modifications en mode calme.  Autrement dit, toutes les ressources qu'il contient sont accumul√©es, mais les radiations des clients ne passent pas.  Bien s√ªr, c'est un probl√®me, mais par rapport au d√©ploiement g√©n√©ral, il ne semble pas fondamental. <br><br>  <b>08h00.</b>  <b>Fix API</b> <br>  Nous avons d√©ploy√© un correctif pour la charge, les √©checs sont rest√©s.  Nous commen√ßons √† rentrer √† la maison. <br><br>  <b>10 h 00</b>  <b>Tous</b> <br>  Tout est r√©par√©.  Dans le suivi et les clients sont silencieux, l'√©quipe se couche progressivement.  La facturation demeure, nous la r√©tablirons demain. <br><br>  Puis, au cours de la journ√©e, des d√©ploiements ont corrig√© les journaux, les notifications, les codes retour et les codes personnalis√©s de certains de nos clients. <br><br>  Le d√©ploiement a donc √©t√© un succ√®s!  Bien s√ªr, cela pourrait √™tre mieux, mais nous avons tir√© des conclusions sur ce que nous n'avions pas assez pour atteindre la perfection. <br><br><h2>  Total </h2><br>  En moins de 2 mois de pr√©paration active au moment du d√©ploiement, 43 t√¢ches ont √©t√© r√©alis√©es, d'une dur√©e de quelques heures √† plusieurs jours. <br><br>  Pendant le d√©ploiement: <br><br><ul><li>  d√©mons nouveaux et modifi√©s - 5 pi√®ces, rempla√ßant 2 monolithes; </li><li>  changements dans les bases de donn√©es - les 6 de nos bases de donn√©es avec les donn√©es des utilisateurs sont affect√©es, les d√©chargements de trois anciennes bases de donn√©es vers une nouvelle sont termin√©s; </li><li>  interface enti√®rement refaite; </li><li>  le nombre de code pomp√© - 33 mille lignes de nouveau code, ‚âà 3 mille lignes de code dans les tests, ‚âà 5 mille lignes de code de migration; </li><li>  toutes les donn√©es sont intactes, pas une seule machine virtuelle du client n'a souffert.  :) </li></ul><br><h2>  Bonnes pratiques pour un bon d√©ploiement </h2><br>  Nous avons √©t√© guid√©s par eux dans cette situation difficile.  Mais, d'une mani√®re g√©n√©rale, il est utile de les observer dans tout d√©ploiement.  Mais plus le d√©ploiement est difficile, plus leur r√¥le est important. <br><br><ol><li>  La premi√®re chose que vous devez faire est de comprendre comment le d√©ploiement peut affecter ou affecter les utilisateurs.  Y aura-t-il des temps d'arr√™t?  Si c'est le cas, quel est le temps d'arr√™t?  Comment cela affectera-t-il les utilisateurs?  Quels sont les meilleurs et les pires sc√©narios?  Et fermez les risques. </li><li>  Planifiez tout.  √Ä chaque √©tape, vous devez comprendre tous les aspects du d√©ploiement: <br><ul><li>  livraison de code; </li><li>  restauration du code; </li><li>  l'heure de chaque op√©ration; </li><li>  fonctionnalit√© affect√©e. </li></ul></li><li>  Jouez des sc√©narios jusqu'√† ce que toutes les √©tapes de d√©ploiement soient claires, ainsi que les risques pour chacune d'elles.  En cas de doute, vous pouvez faire une pause et explorer la sc√®ne douteuse s√©par√©ment. </li><li>  Chaque √©tape peut et doit √™tre am√©lior√©e si elle aide nos utilisateurs.  Par exemple, cela r√©duira les temps d'arr√™t ou supprimera certains risques. </li><li>  Le test de restauration est beaucoup plus important que le test de livraison de code.  Il est n√©cessaire de v√©rifier qu'√† la suite de la restauration, le syst√®me reviendra √† son √©tat d'origine, confirmez-le avec des tests. </li><li>  Tout ce qui peut √™tre automatis√© doit √™tre automatis√©.  Tout ce qui ne peut pas √™tre automatis√© doit √™tre pr√©-√©crit sur la feuille de triche. </li><li>  Enregistrer les crit√®res de r√©ussite.  Quelles fonctionnalit√©s devraient √™tre disponibles et √† quelle heure?  Si cela ne se produit pas, d√©marrez un plan de restauration. </li><li>  Et surtout, les gens.  Chacun doit √™tre conscient de ce qu'il fait, de quoi et de ce qui d√©pend de ses actions en cours de d√©ploiement. </li></ol><br>  Et si en une phrase, alors avec une bonne planification et √©laboration, vous pouvez d√©ployer tout ce que vous voulez sans cons√©quences pour la vente.  M√™me cela affecte tous vos services en prod. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr453364/">https://habr.com/ru/post/fr453364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453352/index.html">Comment les drones d√©livrent des m√©dicaments essentiels au Ghana</a></li>
<li><a href="../fr453354/index.html">Classification de la couverture terrestre √† l'aide de l'eo-learn. 3e partie</a></li>
<li><a href="../fr453356/index.html">Tendances actuelles et recommandations sur l'agglom√©ration des grandes institutions financi√®res</a></li>
<li><a href="../fr453360/index.html">Ville sans embouteillage</a></li>
<li><a href="../fr453362/index.html">HabraConf # 1 - Vers l'arri√®re pour le backend</a></li>
<li><a href="../fr453366/index.html">Comment utiliser les virgules en anglais: 15 r√®gles et exemples d'erreur</a></li>
<li><a href="../fr453368/index.html">R√©cup√©ration de donn√©es √† partir de tables XtraDB sans fichier de structure √† l'aide de l'analyse d'octets du fichier ibd</a></li>
<li><a href="../fr453370/index.html">Confrontation 2019: Jet Security Team a pris la premi√®re place en d√©fense</a></li>
<li><a href="../fr453374/index.html">Les 10 meilleurs fournisseurs d'API et de SDK de chat, d'appel audio et vid√©o pour les entreprises</a></li>
<li><a href="../fr453376/index.html">Comment perdre son temps et ses ressources SSD en vain? Facile et simple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>