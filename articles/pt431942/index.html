<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêì üêª üé¢ Inje√ß√£o de depend√™ncia hier√°rquica no React e MobX State Tree como um modelo de dom√≠nio ‚ùé ‚úçüèæ ü•â</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ap√≥s alguns projetos no React, tive a chance de trabalhar em um aplicativo no Angular 2. Francamente, n√£o fiquei impressionado. Mas uma coisa foi lemb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Inje√ß√£o de depend√™ncia hier√°rquica no React e MobX State Tree como um modelo de dom√≠nio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431942/"><p><img src="https://habrastorage.org/webt/78/ou/57/78ou57kbv7kdv7llnfl-_cwmxpw.png" align="left">  Ap√≥s alguns projetos no React, tive a chance de trabalhar em um aplicativo no Angular 2. Francamente, n√£o fiquei impressionado.  Mas uma coisa foi lembrada - gerenciar a l√≥gica e o estado do aplicativo usando a Inje√ß√£o de Depend√™ncia.  E me perguntei se seria conveniente gerenciar o estado no React usando DDD, uma arquitetura em camadas e inje√ß√£o de depend√™ncia? </p><br><p>  Se voc√™ est√° interessado em como fazer isso, e mais importante, por que - bem-vindo ao corte! </p><a name="habracut"></a><br><p> Para ser honesto, mesmo no back-end, o DI raramente √© usado ao m√°ximo.  A menos que em aplicativos realmente grandes.  E em pequenas e m√©dias empresas, mesmo com uma DI, cada interface geralmente possui apenas uma implementa√ß√£o.  Mas a inje√ß√£o de depend√™ncia ainda tem suas vantagens: </p><br><ul><li>  O c√≥digo √© melhor estruturado e as interfaces agem como contratos expl√≠citos. </li><li>  A cria√ß√£o de stubs em testes de unidade √© simplificada. </li></ul><br><p>  Por√©m, as modernas bibliotecas de teste para JS, como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jest</a> , permitem que voc√™ escreva moki simplesmente com base no sistema modular ES6.  Ent√£o aqui n√£o teremos muito lucro com o DI. </p><br><p>  O segundo ponto permanece - o gerenciamento do escopo e da vida √∫til dos objetos.  No servidor, a vida √∫til geralmente √© vinculada ao aplicativo inteiro (Singleton) ou √† solicita√ß√£o.  E no cliente, a principal unidade de c√≥digo √© o componente.  Estaremos apegados a ele. </p><br><p> Se precisarmos usar o estado no n√≠vel do aplicativo, a maneira mais f√°cil √© definir a vari√°vel no n√≠vel do m√≥dulo ES6 e import√°-la quando necess√°rio.  E se o estado √© necess√°rio apenas dentro do componente - apenas o colocamos neste <strong><code>this.state</code></strong> .  Para todo o resto, h√° <strong><code>Context</code></strong> .  Mas o <strong><code>Context</code></strong> √© de n√≠vel muito baixo: </p><br><ul><li>  N√£o podemos usar o contexto fora da √°rvore do componente React.  Por exemplo, em uma camada de l√≥gica de neg√≥cios. </li><li>  N√£o podemos usar mais de um contexto em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code><strong>Class.contextType</strong></code></a> .  Para determinar a depend√™ncia de v√°rios servi√ßos diferentes, teremos que construir uma "pir√¢mide de horror" de uma nova maneira: </li></ul><br><img src="https://habrastorage.org/webt/as/4r/2n/as4r2ncj0zh_2dmpoxbuahkio74.png"><br><br><p>  O novo Hook <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code><strong>useContext()</strong></code></a> corrige levemente a situa√ß√£o dos componentes funcionais.  Mas n√£o vamos nos livrar de muitos <strong><code>&lt;Context.Provider&gt;</code></strong> .  At√© transformarmos nosso contexto em um localizador de servi√ßo e seu componente pai em uma raiz de composi√ß√£o.  Mas aqui n√£o √© muito longe do DI, ent√£o vamos come√ßar! </p><br><blockquote>  Voc√™ pode pular esta parte e ir diretamente para a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descri√ß√£o da arquitetura.</a> </blockquote><br><h2 id="realizaciya-mehanizma-di">  Implementa√ß√£o do mecanismo de DI </h2><br><p>  Primeiro, precisamos de um contexto de rea√ß√£o: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InjectorContext= React.createContext(<span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre> <br><p>  Como o React usa o construtor de componentes para suas necessidades, usaremos a Inje√ß√£o de propriedades.  Para fazer isso, defina o decorador <strong><code>@inject</code></strong> , que: </p><br><ul><li>  define a propriedade <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code><strong>Class.contextType</strong></code></a> , </li><li>  obt√©m o tipo de depend√™ncia </li><li>  localiza um objeto <strong><code>Injector</code></strong> e resolve a depend√™ncia. </li></ul><br><div class="spoiler">  <b class="spoiler_title">inject.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"reflect-metadata"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target, key</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  static cotextType target.constructor.contextType = InjectorContext; //    const type = Reflect.getMetadata("design:type", target, key); //  property Object.defineProperty(target, key, { configurable: true, enumerable: true, get() { //  Injector       const instance = getInstance(getInjector(this), type); Object.defineProperty(this, key, { enumerable: true, writable: true, value: instance }); return instance; }, // settet     Dependency Injection set(instance) { Object.defineProperty(this, key, { enumerable: true, writable: true, value: instance }); } }); }</span></span></code> </pre> </div></div><br><p>  Agora podemos definir depend√™ncias entre classes arbitr√°rias: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarService</span></span></span><span class="hljs-class"> </span></span>{ @inject foo: FooService; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject foo: FooService; @inject bar: BarService; }</code> </pre> <br><p>  Para aqueles que n√£o aceitam decoradores, definimos a fun√ß√£o <strong><code>inject()</code></strong> com esta assinatura: </p><br><pre> <code class="javascript hljs">type Constructor&lt;T&gt; = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (...args: any[]) =&gt; T; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target: Object, type: Constructor&lt;T&gt; | Function</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">inject.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target, keyOrType</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFunction(keyOrType)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getInstance(getInjector(target), keyOrType); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> </div></div><br><p>  Isso permitir√° que voc√™ defina explicitamente as depend√™ncias: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooService</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BarService</span></span></span><span class="hljs-class"> </span></span>{ foo = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, FooService); } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ foo = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, FooService); bar = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, BarService); <span class="hljs-comment"><span class="hljs-comment">//   static contextType = InjectorContext; }</span></span></code> </pre> <br><p>  E quanto aos componentes funcionais?  Para eles, podemos implementar Hook <strong><code>useInstance()</code></strong> </p><br><div class="spoiler">  <b class="spoiler_title">hooks.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useRef, useContext } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ref = useRef(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> injector = useContext(InjectorContext); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ref.current || (ref.current = getInstance(injector, type)); }</code> </pre> </div></div><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useInstance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MyComponent = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> foo = useInstance(FooService); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bar = useInstance(BarService); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; }</span></span></code> </pre> <br><p>  Agora, determinaremos a apar√™ncia do nosso <strong><code>Injector</code></strong> , como localiz√°-lo e como resolver depend√™ncias.  O injetor deve conter uma refer√™ncia ao pai, um cache de objeto para depend√™ncias que j√° foram resolvidas e um dicion√°rio de regras para as ainda n√£o resolvidas. </p><br><div class="spoiler">  <b class="spoiler_title">injector.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">type Binding = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector: Injector</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> abstract <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Injector</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    Injector _parent?: Injector; //    _bindingMap: Map&lt;Function, Binding&gt;; //      _instanceMap: Map&lt;Function, Object&gt;; }</span></span></code> </pre> </div></div><br><p>  Para componentes React, o <strong><code>Injector</code></strong> est√° dispon√≠vel no campo <strong><code>this.context</code></strong> e, para as classes de depend√™ncia, podemos colocar temporariamente o <strong><code>Injector</code></strong> em uma vari√°vel global.  Para acelerar a pesquisa de um injetor para cada classe, armazenaremos em cache o link para o <strong><code>Injector</code></strong> em um campo oculto. </p><br><div class="spoiler">  <b class="spoiler_title">injector.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INJECTOR = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span> === <span class="hljs-string"><span class="hljs-string">"function"</span></span> ? <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>() : <span class="hljs-string"><span class="hljs-string">"__injector__"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentInjector = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInjector</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> injector = target[INJECTOR]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (injector) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector; } injector = currentInjector || target.context; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (injector <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Injector) { target[INJECTOR] = injector; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> </div></div><br><p>  Para encontrar uma regra de liga√ß√£o espec√≠fica, precisamos subir na √°rvore do injetor usando a fun√ß√£o <strong><code>getInstance()</code></strong> </p><br><div class="spoiler">  <b class="spoiler_title">injector.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector, type</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (injector) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> instance = injector._instanceMap.get(type); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> binding = injector._bindingMap.get(type); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (binding) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prevInjector = currentInjector; currentInjector = injector; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { instance = binding(injector); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { currentInjector = prevInjector; } injector._instanceMap.set(type, instance); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } injector = injector._parent; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>; }</code> </pre> </div></div><br><p>  Finalmente, vamos passar a registrar depend√™ncias.  Para fazer isso, precisamos do <strong><code>provider()</code></strong> HOC <strong><code>provider()</code></strong> , que leva uma matriz de liga√ß√µes de depend√™ncia para suas implementa√ß√µes e registra um novo <strong><code>Injector</code></strong> por meio de <strong><code>InjectorContext.Provider</code></strong> </p><br><div class="spoiler">  <b class="spoiler_title">provider.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> provider = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...definitions</span></span></span><span class="hljs-function">) =&gt;</span></span> Wrapped =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bindingMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); addBindings(bindingMap, definitions); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Provider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Injector</span></span></span><span class="hljs-class"> </span></span>{ _parent = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context; _bindingMap = bindingMap; _instanceMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;InjectorContext.Provider value={this}&gt; &lt;Wrapped {...this.props} /&gt; &lt;/InjectorContext.Provider&gt; ); } static contextType = InjectorContext; static register(...definitions) { addBindings(bindingMap, definitions); } }; };</code> </pre> </div></div><br><p>  E tamb√©m, um conjunto de fun√ß√µes de liga√ß√£o que implementam v√°rias estrat√©gias para criar inst√¢ncias de depend√™ncia. </p><br><div class="spoiler">  <b class="spoiler_title">bindings.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toClass = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">constructor</span></span></span><span class="hljs-function"> =&gt;</span></span> asBinding(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(); if (!instance[INJECTOR]) { instance[INJECTOR] = injector; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toFactory = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">depsOrFactory, factory</span></span></span><span class="hljs-function">) =&gt;</span></span> asBinding( factory ? <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector</span></span></span><span class="hljs-function"> =&gt;</span></span> factory(...depsOrFactory.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function"> =&gt;</span></span> getInstance(injector, type))) : depsOrFactory ); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toExisting = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">type</span></span></span><span class="hljs-function"> =&gt;</span></span> asBinding(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector</span></span></span><span class="hljs-function"> =&gt;</span></span> getInstance(injector, type)); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toValue = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> asBinding(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> value); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IS_BINDING = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span> === <span class="hljs-string"><span class="hljs-string">"function"</span></span> ? <span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>() : <span class="hljs-string"><span class="hljs-string">"__binding__"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asBinding</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">binding</span></span></span><span class="hljs-function">) </span></span>{ binding[IS_BINDING] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> binding; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addBindings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bindingMap, definitions</span></span></span><span class="hljs-function">) </span></span>{ definitions.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">definition</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> token, binding; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.isArray(definition)) { [token, binding = token] = definition; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { token = binding = definition; } bindingMap.set(token, binding[IS_BINDING] ? binding : toClass(binding)); }); }</code> </pre> </div></div><br><p>  Agora podemos registrar liga√ß√µes de depend√™ncia no n√≠vel de um componente arbitr√°rio na forma de um conjunto de pares <strong><code>[&lt;&gt;, &lt;&gt;]</code></strong> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, toClass, toValue, toFactory, toExisting } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; @provider( <span class="hljs-comment"><span class="hljs-comment">//    [FirstService, toClass(FirstServiceImpl)], //     [SecondService, toValue(new SecondServiceImpl())], //    [ThirdService, toFactory( [FirstService, SecondService], (first, second) =&gt; ThirdServiceFactory.create(first, second) )], //      [FourthService, toExisting(FirstService)] ) class MyComponent extends React.Component { // ... }</span></span></code> </pre> <br><p>  Ou de forma abreviada para as classes: </p><br><pre> <code class="javascript hljs">@provider( <span class="hljs-comment"><span class="hljs-comment">// [FirstService, toClass(FirstService)] FirstService, // [SecondService, toClass(SecondServiceImpl)] [SecondService, SecondServiceImpl] ) class MyComponent extends React.Component { // ... }</span></span></code> </pre> <br><p>  Como a vida √∫til de um servi√ßo √© determinada pelo componente do provedor no qual est√° registrado, para cada servi√ßo, podemos definir um m√©todo de limpeza <strong><code>.dispose()</code></strong> .  Nele, podemos cancelar a inscri√ß√£o em alguns eventos, fechar soquetes etc.  Quando voc√™ remove o provedor do DOM, ele chama <strong><code>.dispose()</code></strong> em todos os servi√ßos que cria. </p><br><div class="spoiler">  <b class="spoiler_title">provider.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> provider = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...definitions</span></span></span><span class="hljs-function">) =&gt;</span></span> Wrapped =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... return class Provider extends Injector { // ... componentWillUnmount() { this._instanceMap.forEach(instance =&gt; { if (isObject(instance) &amp;&amp; isFunction(instance.dispose)) { instance.dispose(); } }); } // ... }; };</span></span></code> </pre> </div></div><br><p>  Para separar o c√≥digo e o carregamento lento, talvez seja necess√°rio inverter o m√©todo de registro de servi√ßos nos provedores.  O decorador <strong><code>@registerIn()</code></strong> nos ajudar√° com isso. </p><br><div class="spoiler">  <b class="spoiler_title">provider.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> registrationQueue = []; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> registerIn = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">getProvider, binding</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span> =&gt; { registrationQueue.push(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { getProvider().register(binding ? [<span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>, binding] : <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>); }); return <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>; };</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">injector.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">injector, type</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (registrationQueue.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { registrationQueue.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">registration</span></span></span><span class="hljs-function"> =&gt;</span></span> { registration(); }); registrationQueue.length = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (injector) { <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> </div></div><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { registerIn } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { HomePage } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../components/HomePage"</span></span>; @registerIn(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> HomePage) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyLazyLoadedService</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br><img src="https://habrastorage.org/webt/gu/w5/d-/guw5d-sj0h53wnapsftgqeqnvvg.png"><br><p>  Portanto, para 150 linhas e 1 KB de c√≥digo, voc√™ pode implementar um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cont√™iner DI hier√°rquico</a> quase completo. </p><br><h2 id="arhitektura-prilozheniya">  Arquitetura de aplicativos </h2><br><p>  Finalmente, vamos passar para o principal - como organizar a arquitetura do aplicativo.  Existem tr√™s op√ß√µes poss√≠veis, dependendo do tamanho do aplicativo, da complexidade da √°rea de assunto e da nossa pregui√ßa. </p><br><h3 id="1-the-ugly">  1. O Feio </h3><br><p>  Temos um DOM virtual, o que significa que deve ser r√°pido.  Pelo menos com este molho, o React foi servido no in√≠cio de uma carreira.  Portanto, lembre-se do link para o componente raiz (por exemplo, usando o decorador <strong><code>@observer</code></strong> ).  E chamaremos <strong><code>.forceUpdate()</code></strong> ap√≥s cada a√ß√£o que afeta os servi√ßos compartilhados (por exemplo, usando o decorador <strong><code>@action</code></strong> ) </p><br><div class="spoiler">  <b class="spoiler_title">observer.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">observer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Wrapped</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Observer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ componentDidMount() { observerRef = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } componentWillUnmount() { observerRef = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Wrapped</span></span></span></span><span class="xml"><span class="hljs-tag"> {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...this.props</span></span></span></span><span class="xml"><span class="hljs-tag">} /&gt;</span></span></span><span class="xml">; } } } let observerRef = null;</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">action.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_target, _key, descriptor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> method = descriptor.value; descriptor.value = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result; runningCount++; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = method.apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { runningCount--; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (runningCount === <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; observerRef) { observerRef.forceUpdate(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> runningCount = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> </div></div><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserService</span></span></span><span class="hljs-class"> </span></span>{ @action doSomething() {} } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject userService: UserService; } @provider(UserService) @observer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br><p>  At√© funcionar√°.  Mas ... voc√™ mesmo entende :-) </p><br><h3 id="2-the-bad">  2. O Mau </h3><br><p>  N√£o estamos satisfeitos em renderizar tudo para cada espirro.  Mas ainda queremos usar <del>  quase </del>  objetos regulares e matrizes para armazenamento de estado.  Vamos pegar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MobX</a> ! </p><br><p>  Iniciamos v√°rios armazenamentos de dados com a√ß√µes padr√£o: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observable, action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserStore</span></span></span><span class="hljs-class"> </span></span>{ byId = observable.map&lt;number, User&gt;(); @action add(user: User) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.byId.set(user.id, user); } <span class="hljs-comment"><span class="hljs-comment">// ... } export class PostStore { // ... }</span></span></code> </pre> <br><p>  Colocamos l√≥gica de neg√≥cios, E / S, etc. na camada de servi√ßos: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountService</span></span></span><span class="hljs-class"> </span></span>{ @inject userStore userStore; @action updateUserInfo(userInfo: Partial&lt;User&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> user = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userStore.byId.get(userInfo.id); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(user, userInfo); } }</code> </pre> <br><p>  E n√≥s os distribu√≠mos em componentes: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; @provider(UserStore, PostStore) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{} @provider(AccountService) @observer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountPage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span></span>{} @observer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserForm</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject accountService: AccountService; }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">O mesmo vale para componentes funcionais e sem decoradores</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountService</span></span></span><span class="hljs-class"> </span></span>{ userStore = inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, UserStore); updateUserInfo = action(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">userInfo: Partial&lt;User&gt;</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> user = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userStore.byId.get(userInfo.id); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(user, userInfo); }); }</code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-react-lite"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, useInstance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = provider(UserStore, PostStore)(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... }); const AccountPage = provider(AccountService)(observer(props =&gt; { // ... })); const UserFrom = observer(props =&gt; { const accountService = useInstance(AccountService); // ... });</span></span></code> </pre> </div></div><br><p>  O resultado √© uma arquitetura cl√°ssica de tr√™s camadas. </p><br><h3 id="3-the-good">  3. O Bom </h3><br><p>  √Äs vezes, a √°rea de assunto se torna t√£o complexa que j√° √© inconveniente trabalhar com ela usando objetos simples (ou um modelo an√™mico em termos de DDD).  Isso √© especialmente percept√≠vel quando os dados t√™m uma estrutura relacional com muitos relacionamentos.  Nesses casos, a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MobX State Tree</a> vem em socorro, permitindo que voc√™ aplique os princ√≠pios do Design Orientado a Dom√≠nio na arquitetura do aplicativo front-end. </p><br><p>  O design de um modelo come√ßa com uma descri√ß√£o dos tipos: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// models/Post.ts import { types as t, Instance } from "mobx-state-tree"; export const Post = t .model("Post", { id: t.identifier, title: t.string, body: t.string, date: t.Date, rating: t.number, author: t.reference(User), comments: t.array(t.reference(Comment)) }) .actions(self =&gt; ({ voteUp() { self.rating++; }, voteDown() { self.rating--; }, addComment(comment: Comment) { self.comments.push(comment); } })); export type Post = Instance&lt;typeof Post&gt;;</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">models / User.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { types <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t, Instance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> User = t.model(<span class="hljs-string"><span class="hljs-string">"User"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: t.identifier, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: t.string }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> type User = Instance&lt;<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> User&gt;;</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">models / Comment.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { types <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t, Instance } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { User } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"./User"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Comment = t .model(<span class="hljs-string"><span class="hljs-string">"Comment"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: t.identifier, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: t.string, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: t.Date, <span class="hljs-attr"><span class="hljs-attr">rating</span></span>: t.number, <span class="hljs-attr"><span class="hljs-attr">author</span></span>: t.reference(User) }) .actions(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ voteUp() { self.rating++; }, voteDown() { self.rating--; } })); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> type Comment = Instance&lt;<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> Comment&gt;;</code> </pre> </div></div><br><p>  E o tipo de armazenamento de dados: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// models/index.ts import { types as t } from "mobx-state-tree"; export { User, Post, Comment }; export default t.model({ users: t.map(User), posts: t.map(Post), comments: t.map(Comment) });</span></span></code> </pre> <br><p>  Os tipos de entidade cont√™m o estado do modelo de dom√≠nio e as opera√ß√µes b√°sicas com ele.  Cen√°rios mais complexos, incluindo E / S, s√£o implementados na camada de servi√ßos. </p><br><div class="spoiler">  <b class="spoiler_title">services / DataContext.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Instance, unprotect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Models <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../models"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataContext</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> create() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> models = Models.create(); unprotect(models); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> models; } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface DataContext extends Instance&lt;<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> Models&gt; {}</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">services / AuthService.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { User } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../models"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthService</span></span></span><span class="hljs-class"> </span></span>{ @observable currentUser: User; }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">services / PostService.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Post } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"../models"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostService</span></span></span><span class="hljs-class"> </span></span>{ @inject dataContext: DataContext; @inject authService: AuthService; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> publishPost(postInfo: Partial&lt;Post&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(<span class="hljs-string"><span class="hljs-string">"/posts"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(postInfo) }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { id } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.json(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.savePost(id, postInfo); } @action savePost(id: string, <span class="hljs-attr"><span class="hljs-attr">postInfo</span></span>: Partial&lt;Post&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> post = Post.create({ id, <span class="hljs-attr"><span class="hljs-attr">rating</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(), <span class="hljs-attr"><span class="hljs-attr">author</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.authService.currentUser.id, <span class="hljs-attr"><span class="hljs-attr">comments</span></span>: [], ...postInfo }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataContext.posts.put(post); } }</code> </pre> </div></div><br><p>  A principal caracter√≠stica do MobX State Tree √© o trabalho eficiente com snapshots de dados.  A qualquer momento, podemos obter o estado serializado de qualquer entidade, cole√ß√£o ou mesmo todo o estado do aplicativo usando a fun√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code><strong>getSnapshot()</strong></code></a> .  E da mesma maneira, podemos aplicar a captura instant√¢nea a qualquer parte do modelo usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code><strong>applySnapshot()</strong></code></a> .  Isso nos permite inicializar o estado do servidor em v√°rias linhas de c√≥digo, carregar no LocalStorage ou at√© interagir com ele atrav√©s do Redux DevTools. </p><br><p>  Como usamos um modelo relacional normalizado, precisamos da biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">normalizr</a> para carregar dados.  Ele permite converter o JSON da √°rvore em tabelas simples de objetos agrupados por <strong><code>id</code></strong> , de acordo com o esquema de dados.  Apenas no formato em que a MobX State Tree √© necess√°ria como um instant√¢neo. </p><br><p>  Para fazer isso, defina os esquemas de objetos baixados do servidor: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { schema } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"normalizr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UserSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">"users"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CommentSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">"comments"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">author</span></span>: UserSchema }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PostSchema = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> schema.Entity(<span class="hljs-string"><span class="hljs-string">"posts"</span></span>, { <span class="hljs-comment"><span class="hljs-comment">//   - //      author: UserSchema, comments: [CommentSchema] }); export { UserSchema, PostSchema, CommentSchema };</span></span></code> </pre> <br><p>  E carregue os dados no armazenamento: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { normalize } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"normalizr"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { applySnapshot } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-state-tree"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostService</span></span></span><span class="hljs-class"> </span></span>{ @inject dataContext: DataContext; <span class="hljs-comment"><span class="hljs-comment">// ... async loadPosts() { const response = await fetch("/posts.json"); const posts = await response.json(); const { entities } = normalize(posts, [PostSchema]); applySnapshot(this.dataContext, entities); } // ... }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">posts.json</b> <div class="spoiler_text"><pre> <code class="json hljs">[ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"    React"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"  -     React..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-10T18:18:58.512Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rating"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"John Doe"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"comments"</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span>, <span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hmmm..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-10T18:18:58.512Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rating"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"John Doe"</span></span> } }] }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">234</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Lorem ipsum"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: <span class="hljs-string"><span class="hljs-string">"Lorem ipsum dolor sit amet..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-10T18:18:58.512Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rating"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Marcus Tullius Cicero"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"comments"</span></span>: [] } ]</code> </pre> </div></div><br><p>  Por fim, registre os servi√ßos nos componentes apropriados: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"mobx-react"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { provider, inject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-ioc"</span></span>; @provider(AuthService, PostService, [ DataContext, toFactory(DataContext.create) ]) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ @inject postService: PostService; componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.postService.loadPosts(); } }</code> </pre> <br><p>  Acontece a mesma arquitetura de tr√™s camadas, mas com a capacidade de manter a verifica√ß√£o de estado e tempo de execu√ß√£o dos tipos de dados (no modo DEV).  O √∫ltimo permite garantir que, se nenhuma exce√ß√£o ocorrer, o estado do armaz√©m de dados corresponda √† especifica√ß√£o. </p><br><img src="https://habrastorage.org/webt/po/3u/vi/po3uvia2jujcg9q7w1ptr8kvwzk.png"><br><p><br></p><br><hr><br><p>  Para quem estava interessado, um link para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a> e uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">demonstra√ß√£o</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt431942/">https://habr.com/ru/post/pt431942/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt431932/index.html">Fort Byte Car (e mais) Nativo Americano</a></li>
<li><a href="../pt431934/index.html">Como a intelig√™ncia artificial ajuda a trabalhar com documentos legais? Palestra de Egor Budnikov da ABBYY</a></li>
<li><a href="../pt431936/index.html">Resultados do concurso TechnoText</a></li>
<li><a href="../pt431938/index.html">Raiz de cubo inteiro no Verilog</a></li>
<li><a href="../pt431940/index.html">As pessoas se esgotam se n√£o sentem seu valor. O que fazer sobre isso?</a></li>
<li><a href="../pt431944/index.html">Yealink Meeting Server 2.0 - Novos recursos de videoconfer√™ncia</a></li>
<li><a href="../pt431946/index.html">Semana 49 de seguran√ßa: hackers Dell e Marriott</a></li>
<li><a href="../pt431948/index.html">Deep Mind ensinou sua IA a prever a estrutura das prote√≠nas</a></li>
<li><a href="../pt431950/index.html">Como prever a demanda e automatizar as compras usando o aprendizado de m√°quina: caso Ozon</a></li>
<li><a href="../pt431954/index.html">Ex-vice-presidente da Sun e DEC se torna presidente do MIPS / Wave, fala sobre R√∫ssia e RISC / V</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>