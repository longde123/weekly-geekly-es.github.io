<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèµÔ∏è üë®‚Äçüëß üë®üèΩ Comment nous avons cr√©√© un syst√®me de paiement par crypto-monnaie: cinq probl√®mes principaux üï¥üèæ üéà üèÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! En contact est B2Broker, un fournisseur de solutions de liquidit√© et de technologie pour l'industrie du courtage et de l'√©change. L'un ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons cr√©√© un syst√®me de paiement par crypto-monnaie: cinq probl√®mes principaux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/b2broker/blog/441338/"> Bonjour, Habr!  En contact est B2Broker, un fournisseur de solutions de liquidit√© et de technologie pour l'industrie du courtage et de l'√©change.  L'un de nos produits est la plateforme de trading B2BX.exchange.  Lorsque nous avons lanc√© la plateforme √† l'√©t√© 2017, nous avons r√©fl√©chi √† la mani√®re d'accepter les crypto-monnaies et au traitement √† utiliser.  H√©las, personne √† l'√©poque n'√©tait pr√™t √† donner au moins des garanties sur la vuln√©rabilit√© du contrat, et l'histoire de l'attaque de la plate-forme DAO √©tait toujours √† l'audience.  Nous ne voulions pas suivre les traces du DAO.  De plus, nous avions une certaine exp√©rience dans l'acceptation de paiements via la blockchain.  Nous avons donc d√©cid√© de travailler de mani√®re ind√©pendante sur l'ensemble du cycle des paiements blockchain.  Dans cet article, nous parlerons de ce que nous avons fait et, plus int√©ressant encore, des probl√®mes que nous avons d√ª r√©soudre au cours du processus. <br><br><img src="https://habrastorage.org/webt/uk/hg/wc/ukhgwczsncwbugsyinbvjlnoqg4.jpeg"><br>  <i>Source: ripplecoinnews.com</i> <br><a name="habracut"></a><br>  En travaillant sur le syst√®me de paiement, nous avons r√©alis√© que nous pouvons rendre un service non seulement pour notre plate-forme B2BX.exchange, mais aussi un produit compl√®tement ind√©pendant.  Nous l'avons appel√© B2BinPay. <br><br><h2>  En quoi consiste B2BinPay </h2><br>  Le syst√®me de paiement est divis√© en plusieurs parties de base.  Tous sont √©crits en PHP. <br><br>  <i>La premi√®re partie du syst√®me</i> est charg√©e d'interagir avec les cha√Ænes de blocs, c'est-√†-dire de recevoir, d'envoyer et de suivre les paiements. <br><br>  <i>La deuxi√®me partie</i> est l'API.  Il est engag√© dans l'interaction avec les consommateurs de services et d'√©changes: notifie la r√©ception des fonds, proc√®de √† l'√©change des crypto-monnaies.  L'API est √©crite en utilisant le framework Laravel. <br><br>  <i>La troisi√®me partie</i> est le bureau d'acquisition pour les consommateurs.  Il refl√®te l'√©tat du syst√®me dans son ensemble, les portefeuilles connect√©s et leurs soldes, les transactions actives et les comptes.  Peut-√™tre que bient√¥t nous connecterons l'acquisition de fiat classique.  Pour cr√©er un bureau, nous avons utilis√© Yii2. <br><br>  Un bloc s√©par√© est un syst√®me pour travailler avec des projets ICO.  Il vous permet de distribuer des jetons √† toutes les √©tapes de la vente.  A cela s'ajoute la possibilit√© de d√©velopper un contrat (ERC-20) et un compte personnel.  √Ä l'aide de ces outils, nous fournissons un service ICO cl√© en main. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a55/f8a/420/a55f8a42069d438bd4350ec1b9170d6a.png"><br><br>  Pour des raisons de s√©curit√©, toutes les donn√©es sur les portefeuilles sont stock√©es dans la base de donn√©es sous forme crypt√©e, donc m√™me si un attaquant y acc√®de, il ne pourra pas retirer des fonds des portefeuilles.  L'authentification utilisateur √† deux facteurs est connect√©e.  Enfin, le marchand peut cr√©er une liste blanche d'adresses IP pouvant fonctionner avec l'API. <br><br>  Nous proposons une tol√©rance aux pannes syst√®me avec un grand nombre de serveurs, y compris des serveurs de sauvegarde.  Chaque n≈ìud de la cha√Æne de blocs est situ√© sur un serveur distinct avec un acc√®s limit√© de l'ext√©rieur. <br><br><h2>  Quels probl√®mes avons-nous rencontr√©s? </h2><br>  Les blockchains sont diff√©rentes.  Certains sont mal document√©s et n'ont pas de communaut√© active.  C'√©tait principalement la raison de nos principaux probl√®mes. <br><br>  <b>1. L'API Ethereum n'a pas la possibilit√© de renvoyer des listes de transactions de compte entrantes</b> <br><br>  Lors de la cr√©ation d'un compte, notre syst√®me de paiement g√©n√®re une adresse unique √† laquelle l'utilisateur doit transf√©rer un certain montant dans la devise s√©lectionn√©e.  Avec une fr√©quence donn√©e, nous obtenons une liste des transactions entrantes et v√©rifions leurs adresses de portefeuille.  Ensuite, nous v√©rifions les adresses des portefeuilles avec les adresses des factures impay√©es.  Il s'est av√©r√© que la diffusion ne permet pas de recevoir des informations sur les transactions entrantes. <br><br>  <i>Que faire</i>  Nous avons d√©cid√© de recevoir des transactions en utilisant un service tiers - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">etherscan.io</a> .  Mais il a r√©v√©l√© quelques probl√®mes, alors nous passons √† l'explorateur, un service √©crit par nos programmeurs. <br><br>  <b>2. Certaines blockchains ont une documentation extr√™mement rare</b> <br><br>  Voici un cas typique: nous avons en quelque sorte d√©ploy√© un n≈ìud sur l'une des crypto-monnaies peu connues, et apr√®s quelques jours, il a cess√© d'accepter des transactions sans signaler aucune erreur.  Nous l'avons red√©marr√©, mais quelques jours plus tard, la situation s'est r√©p√©t√©e. <br><br>  <i>Que faire</i>  Quand ils ont commenc√© √† le comprendre, ils ont d√©couvert que le probl√®me se trouvait dans l'un des param√®tres du fichier de configuration.  Il n'y avait pas un mot dans la documentation sur ce param√®tre, j'ai donc d√ª tout configurer par essais et erreurs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/278/407/ad7/278407ad73a6e58552c85444469fe6cc.png"><br><br>  <b>3. La blockchain priv√©e pour tester la fonctionnalit√© est difficile ou simplement impossible √† d√©ployer</b> <br><br>  Une fois, nous devions d√©ployer une cha√Æne de blocs pour la crypto-monnaie NEO.  Nous avons trouv√© une image docker pr√™te, avons tout fait conform√©ment aux instructions et nous avons eu une erreur.  Une analyse rapide des scripts n'a conduit √† rien, Google n'a √©galement rien invit√©. <br><br>  <i>Que faire</i>  Nous avons cr√©√© un probl√®me sur github, pass√© environ un mois √† en discuter et finalement d√©cid√© de d√©ployer testnet.  Mais toutes les crypto-monnaies n'ont pas de testnet.  Et si c'est le cas, le plus souvent, vous devez envoyer une demande de pi√®ces test et attendre un peu.  Le d√©veloppement d'une blockchain priv√©e sur les sites officiels dans la plupart des cas n'est m√™me pas envisag√©, vous devez donc utiliser des solutions tierces. <br><br>  En toute honn√™tet√©, il convient de dire que dans la plupart des cas, vous pouvez obtenir des r√©ponses aux questions li√©es √† l'infrastructure d'une crypto-monnaie particuli√®re.  La ressource la plus utile dans ce sens est Github, alors vous devriez aller sur les forums officiels et Reddit. <br><br>  <b>4. R√©utilisation inappropri√©e du code</b> <br><br>  Bitcoin a finalement beaucoup de copies avec des cha√Ænes de blocs et des blocs individuels - ne les confondez pas avec des fourches.  Dans la plupart des cas, ces crypto-monnaies ont une API Bitcoin absolument identique.  Afin de ne pas multiplier le m√™me code, pour travailler avec de telles copies, nous utilisons la m√™me classe que pour travailler avec la devise de Satoshi Nakamoto. <br><br>  Mais ce n'est peut-√™tre pas si simple.  Lorsque nous avons d√ª int√©grer Dogecoin, nous avons suivi le sc√©nario d√©crit, configur√© et d√©ploy√© testnet.  En cons√©quence, certains tests ont √©chou√© et la cr√©ation de transactions a pos√© des probl√®mes. <br><br>  <i>Que faire</i>  Tout d'abord, nous avons ex√©cut√© le test via le d√©bogueur.  Il s'est av√©r√© que Dogecoin dans la demande de cr√©ation d'une transaction ne permet pas de transf√©rer le montant sous la forme d'une cha√Æne, comme le fait Bitcoin.  Pour cette raison, nous avons d√ª red√©finir la m√©thode dans la classe enfant.  √Ä propos, c'est la seule diff√©rence identifi√©e dans les API Dogecoin et Bitcoin.  Quelle est sa signification est incompr√©hensible. <br><br>  <b>5. Toutes les crypto-monnaies ne permettent pas de g√©n√©rer un nombre illimit√© d'adresses uniques</b> <br><br>  Ici, tout est simple: sans cette g√©n√©ration, nous ne pouvons pas utiliser l'identification de paiement √† l'adresse. <br><br>  <i>Que faire</i>  Dans de telles situations, nous utilisons un message unique qui est joint √† la transaction lors de l'envoi du paiement.  Malheureusement, certains clients oublient d'indiquer ces messages et se demandent alors pourquoi le paiement n'a pas √©t√© cr√©dit√© automatiquement. <br><br><h2>  Comment s'int√©grer au CMS? </h2><br>  Nous avons cr√©√© des plugins B2BinPay pour WordPress, Woocommerce, Magento, PrestaShop.  Ici, l'app√©tit est venu avec manger - au d√©part, nous n'avions pas pr√©vu de promouvoir le syst√®me via des plugins pour CMS.  Pour chaque plugin, nous avons fait une revue du syst√®me.  La chose la plus s√©rieuse s'est produite pour le plugin Magento, nous vous en dirons plus sur cette critique. <br><br>  L'examen est divis√© en deux parties - technique et marketing.  L'inspection technique comprend quatre √©tapes: <br><br><ul><li>  Renifleur de code <br></li><li>  Installation et test de vernis <br></li><li>  Copier coller coller d√©tecteur <br></li><li>  Contr√¥le qualit√© manuel <br></li></ul><br>  Les trois premi√®res √©tapes sont enti√®rement automatis√©es, il est donc pr√©f√©rable de prendre en compte certaines choses au stade du d√©veloppement.  Pour vous simplifier la vie pendant le test, vous devez tout d'abord vous souvenir des r√®gles de Code Sniffer. <br><br>  Les r√®gles Magento pour Code Sniffer sont conformes aux normes PSR-1 et PSR-2, c'est l'un des rares CMS dont les d√©veloppeurs adh√®rent aux approches modernes de d√©veloppement en PHP.  De plus, les gars de Magento ont publi√© un ensemble de r√®gles distinct qui aide √† trouver des erreurs dans les configurations xml de la structure d'extension et compl√®te les v√©rifications g√©n√©ralement accept√©es.  Un script pour v√©rifier le contenu du package fini est √©galement publi√© sur leur compte github, qui doit √©galement √™tre utilis√© avant d'envoyer votre d√©veloppement pour une v√©rification automatis√©e. <br><br>  L'installation de base de Magento contient une classe d'amor√ßage pour phpunit: vous pouvez l'utiliser pour √©crire des tests pour votre plugin.  Honn√™tement, nous n'avons toujours pas d√©termin√© si la disponibilit√© des tests contribue √† l'ach√®vement rapide de l'examen technique. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1b/cb5/134/b1bcb5134b3cd04941ba6f07096d7016.png"><br><br>  Les trois premi√®res √©tapes du contr√¥le technique sont automatiques.  Pour la quatri√®me √©tape et pour Marketing Review, vous devrez √™tre patient: les deux processus sont effectu√©s par des personnes et pour cette raison, des files d'attente sont form√©es. <br><br>  Nous avons attendu les r√©sultats de l'AQ manuelle pendant environ 5 jours, ce qui est fondamentalement normal.  Mais chacune de nos demandes d'examen marketing a √©t√© trait√©e pendant plus d'une semaine.  Ici, il √©tait important pour les testeurs que dans les premiers paragraphes, nous notions l'int√©gration avec quel service nous fournissons et quel est son mod√®le de tarification, et que nous indiquions ensuite les avantages de notre plugin. <br><br><h2>  Plans futurs </h2><br>  Nous pensons que B2BinPay s'est av√©r√© assez simple en termes d'interaction avec les utilisateurs et qu'il sera donc pratique √† la fois pour les nouvelles entreprises du march√© de la cryptographie et pour les entreprises avanc√©es - par exemple, dans le domaine des ventes en ligne - o√π un produit stable et s√©curis√© est n√©cessaire. <br><br>  Au d√©but de la circulation initiale des pi√®ces, nous avons accept√© Bitcoin, Bitcoin CASH, Litecoin, DASH, Ethereum, Monero et autres.  Nous proposons d√©sormais des services aux commer√ßants et aux portefeuilles pour les entreprises clientes sous notre soci√©t√© estonienne, pour lesquels nous avons re√ßu deux licences - pour l'√©change de crypto-monnaies et pour les portefeuilles. <br><br>  Lors de l'int√©gration des clients, nous faisons un KYC √† part enti√®re pour chaque commer√ßant, apr√®s quoi le commer√ßant peut commencer √† accepter les crypto-monnaies, qui sont automatiquement converties en dollars, en euros ou en livres et pay√©es sur le compte bancaire du commer√ßant. <br><br>  Nous serons heureux de r√©pondre √† vos questions sur la cr√©ation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">B2BinPay</a> et sur le produit lui-m√™me en principe.  De plus, nous recherchons maintenant activement des personnes partageant les m√™mes id√©es qui ont des comp√©tences en programmation Python et sont pr√™tes √† rejoindre notre √©quipe.  Maintenant, √† Saint-P√©tersbourg, nous avons ouvert des postes vacants pour chef d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©quipe</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©veloppeur senior</a> .  Nous attendons votre CV avec impatience! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441338/">https://habr.com/ru/post/fr441338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441328/index.html">√Ä propos de l'informatique quantique et du libre arbitre</a></li>
<li><a href="../fr441330/index.html">[spoilers] Movie Wandering Earth: Le soleil se bloque. L'astronaute chinois et un astronaute russe avec un flacon de vodka sauveront tout le monde</a></li>
<li><a href="../fr441332/index.html">Colonie. Chapitre 26: Port Demetrio</a></li>
<li><a href="../fr441334/index.html">"Personnel √©lectrique" - maintenant d√©finitivement</a></li>
<li><a href="../fr441336/index.html">RTOS ou pas RTOS est la question</a></li>
<li><a href="../fr441340/index.html">L'h√©ritage culturel du Kazakhstan en mod√®les 3D</a></li>
<li><a href="../fr441344/index.html">Entrez dans le ciel. Une histoire honn√™te sur une passion s√©rieuse pour le parachutisme</a></li>
<li><a href="../fr441346/index.html">Rencontrez un strat√®ge de contenu: une entrevue avec Dmitry Kabanov, conservateur Techstars Startup Digest et conseiller SXSW</a></li>
<li><a href="../fr441348/index.html">Routage direct et √©quilibrage avec NFT vs Nginx</a></li>
<li><a href="../fr441350/index.html">Haskell est-il vraiment le langage des g√©nies et du monde universitaire?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>