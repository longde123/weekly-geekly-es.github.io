<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé¥ üßïüèø ‚õ∫Ô∏è Revolu√ß√£o ou dor? Relat√≥rio de ganchos de rea√ß√£o do Yandex üåä üîÖ üë®üèª‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Meu nome √© Artyom Berezin, sou desenvolvedor de v√°rios servi√ßos internos Yandex. Nos √∫ltimos seis meses, tenho trabalhado ativamente com o React Hooks...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Revolu√ß√£o ou dor? Relat√≥rio de ganchos de rea√ß√£o do Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/464071/"> Meu nome √© Artyom Berezin, sou desenvolvedor de v√°rios servi√ßos internos Yandex.  Nos √∫ltimos seis meses, tenho trabalhado ativamente com o React Hooks.  No processo, houve algumas dificuldades que tiveram que ser combatidas.  Agora, quero compartilhar essa experi√™ncia com voc√™.  No relat√≥rio, examinei a API do React Hook de um ponto de vista pr√°tico - por que precisamos de ganchos, vale a pena mudar, o que √© melhor considerar ao portar.  √â f√°cil cometer erros durante a transi√ß√£o, mas evit√°-los tamb√©m n√£o √© t√£o dif√≠cil. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/xm/xa/7n/xmxa7ngpjx3l902ndjcetpyhsp0.jpeg"></a> <br><br>  - Ganchos s√£o apenas outra maneira de descrever a l√≥gica de seus componentes.  Permite adicionar aos componentes funcionais alguns recursos que antes eram inerentes apenas aos componentes nas classes. <br><br><a name="habracut"></a><img src="https://habrastorage.org/webt/hd/r8/4b/hdr84b-fmfibqz-gwcb0k8feny8.jpeg"><br><br>  Primeiro de tudo, √© suporte para o estado interno, ent√£o - suporte para efeitos colaterais.  Por exemplo - solicita√ß√µes de rede ou solicita√ß√µes ao WebSocket: assinatura, cancelamento de assinatura de alguns canais.  Ou, talvez, estamos falando de solicita√ß√µes para outras APIs de navegador ass√≠ncronas ou s√≠ncronas.  Al√©m disso, os ganchos nos d√£o acesso ao ciclo de vida do componente, ao seu in√≠cio de vida, ou seja, √† montagem, √† atualiza√ß√£o de seus adere√ßos e √† sua morte. <br><br><img src="https://habrastorage.org/webt/9d/f4/lk/9df4lk5afueo28ftgmebxggxuw0.jpeg"><br><br>  Provavelmente, a maneira mais f√°cil de ilustrar em compara√ß√£o.  Aqui est√° o c√≥digo mais simples que pode estar apenas com um componente nas classes.  O componente est√° mudando alguma coisa.  Este √© um contador regular que pode ser aumentado ou diminu√≠do, apenas um campo no estado.  Em geral, acho que se voc√™ estiver familiarizado com o React, o c√≥digo √© completamente √≥bvio para voc√™. <br><br><img src="https://habrastorage.org/webt/iy/ms/2_/iyms2_hexuxc_nx5cnxwux8crva.jpeg"><br><br>  Um componente semelhante que executa exatamente a mesma fun√ß√£o, mas escrito em ganchos, parece muito mais compacto.  De acordo com meus c√°lculos, em m√©dia, ao transferir de componentes em classes para componentes em ganchos, o c√≥digo diminui cerca de uma vez e meia e √© o que agrada. <br><br>  Algumas palavras sobre como os ganchos funcionam.  Um gancho √© uma fun√ß√£o global que √© declarada dentro do React e √© chamada toda vez que um componente √© renderizado.  O React rastreia as chamadas para essas fun√ß√µes e pode mudar seu comportamento ou decidir o que deve retornar. <br><br><img src="https://habrastorage.org/webt/yy/wy/xf/yywyxfylah95eiqs8saijtqbf-a.jpeg"><br><br>  Existem algumas restri√ß√µes no uso de ganchos que os diferenciam das fun√ß√µes comuns.  Antes de tudo, eles n√£o podem ser usados ‚Äã‚Äãem componentes em classes, apenas uma restri√ß√£o se aplica porque eles n√£o foram criados para eles, mas para componentes funcionais.  Ganchos n√£o podem ser chamados dentro de fun√ß√µes internas, dentro de loops, condi√ß√µes.  Somente no primeiro n√≠vel de aninhamento, dentro das fun√ß√µes do componente.  Essa restri√ß√£o √© imposta pelo pr√≥prio React para poder rastrear quais ganchos foram chamados.  E ele as empilha em uma certa ordem em seu c√©rebro.  Ent√£o, se essa ordem mudar repentinamente ou se alguma desaparecer, ser√£o poss√≠veis erros complexos, esquivos e dif√≠ceis de depurar. <br><br>  Mas se voc√™ tem uma l√≥gica bastante complicada e gostaria de usar, por exemplo, ganchos dentro de ganchos, provavelmente isso √© um sinal de que voc√™ deve fazer um gancho.  Suponha que voc√™ fa√ßa v√°rios ganchos conectados entre si em um gancho personalizado separado.  E dentro dele, voc√™ pode usar outros ganchos personalizados, criando assim uma hierarquia de ganchos, destacando a l√≥gica geral l√°. <br><br><img src="https://habrastorage.org/webt/wr/av/h_/wravh_lbocryqocrjlnwqs8rrr4.jpeg"><br><br>  Ganchos oferecem algumas vantagens sobre as classes.  Primeiro de tudo, como segue o anterior, usando ganchos personalizados, voc√™ pode atrapalhar a l√≥gica muito mais facilmente.  Anteriormente, usando a abordagem com componentes de ordem superior, estabelecemos algum tipo de l√≥gica compartilhada, e era um inv√≥lucro sobre o componente.  Agora colocamos essa l√≥gica dentro de ganchos.  Assim, a √°rvore de componentes √© reduzida: seu aninhamento √© reduzido e torna-se mais f√°cil para o React rastrear altera√ß√µes de componentes, recalcular a √°rvore, recalcular o DOM virtual etc. Isso resolve o problema do chamado wrapper-hell.  Aqueles que trabalham com Redux, eu acho, est√£o familiarizados com isso. <br><br>  O c√≥digo escrito usando ganchos √© muito mais f√°cil de minimizar com minimizadores modernos como o Terser ou o UglifyJS antigo.  O fato √© que n√£o precisamos salvar os nomes dos m√©todos, n√£o precisamos pensar em prot√≥tipos.  Ap√≥s a transpila√ß√£o, se o alvo for ES3 ou ES5, geralmente obtemos v√°rios prot√≥tipos que corrigem.  Aqui tudo isso n√£o precisa ser feito, portanto, √© mais f√°cil minimizar.  E, como resultado do n√£o uso de classes, n√£o precisamos pensar sobre isso.  Para iniciantes, esse costuma ser um grande problema e, provavelmente, uma das principais raz√µes para erros: esquecemos que isso pode ser uma janela, que precisamos vincular um m√©todo, por exemplo, no construtor ou de alguma outra maneira. <br><br>  Al√©m disso, o uso de ganchos permite destacar a l√≥gica que controla qualquer efeito colateral.  Anteriormente, essa l√≥gica, especialmente quando temos v√°rios efeitos colaterais para um componente, tinha que ser dividida em diferentes m√©todos do ciclo de vida do componente.  E, como apareceram os ganchos de minimiza√ß√£o, o React.memo apareceu, agora os componentes funcionais se prestam √† memoriza√ß√£o, ou seja, esse componente n√£o ser√° recriado ou atualizado conosco se seus props n√£o forem alterados.  Isso n√£o podia ser feito antes, agora √© poss√≠vel.  Todos os componentes funcionais podem ser agrupados em memorando.  Tamb√©m dentro do gancho useMemo apareceu, que podemos usar para calcular alguns valores pesados ‚Äã‚Äãou instanciar algumas classes de utilit√°rio apenas uma vez. <br><br>  O relat√≥rio ficar√° incompleto se eu n√£o falar sobre alguns ganchos b√°sicos.  Primeiro de tudo, esses s√£o ganchos de gerenciamento de estado. <br><br><img src="https://habrastorage.org/webt/ud/wg/vl/udwgvlovxonthzvnknxeewerxea.jpeg"><br><br>  Primeiro de tudo - useState. <br><br><img src="https://habrastorage.org/webt/0c/xb/pk/0cxbpky3iayxkvaxutbik_ohbcw.jpeg"><br><br>  Um exemplo √© semelhante ao do in√≠cio do relat√≥rio.  useState √© uma fun√ß√£o que recebe um valor inicial e retorna uma tupla do valor atual e da fun√ß√£o para alterar esse valor.  Toda a magia √© servida pelo React internamente.  Podemos simplesmente ler esse valor ou alter√°-lo. <br><br>  Diferentemente das classes, podemos usar quantos objetos de estado forem necess√°rios, dividir o estado em partes l√≥gicas para n√£o mistur√°-los em um √∫nico objeto, como nas classes.  E essas pe√ßas ser√£o completamente isoladas uma da outra: elas podem ser alteradas independentemente uma da outra.  O resultado, por exemplo, deste c√≥digo: alteramos duas vari√°veis, calculamos o resultado e exibimos os bot√µes que nos permitem alterar a primeira vari√°vel aqui e ali, e a segunda vari√°vel aqui e ali.  Lembre-se deste exemplo, porque mais tarde faremos uma coisa semelhante, mas muito mais complicada. <br><br><img src="https://habrastorage.org/webt/qh/cb/7r/qhcb7rezzu2hu5ymyqw8nw1bl9e.jpeg"><br><br>  Existe um uso desses ester√≥ides para os amantes de Redux.  Permite alterar o estado de maneira mais consistente usando um redutor.  Eu acho que aqueles que est√£o familiarizados com o Redux nem conseguem explicar, para aqueles que n√£o est√£o familiarizados, eu direi. <br><br>  Um redutor √© uma fun√ß√£o que aceita um estado e algum objeto, geralmente chamado a√ß√£o, que descreve como esse estado deve mudar.  Mais precisamente, ele passa alguns par√¢metros e, dentro do redutor, j√° decide, dependendo de seus par√¢metros, como o estado mudar√° e, como resultado, um novo estado deve ser retornado, atualizado. <br><br><img src="https://habrastorage.org/webt/k6/5x/gd/k65xgdpidy6wnhmuxabw3sqqtk0.jpeg"><br><br>  Aproximadamente dessa maneira, √© usado no c√≥digo do componente.  Temos um gancho useReducer, ele assume uma fun√ß√£o redutora e o segundo par√¢metro √© o valor inicial do estado.  Retorna, como useState, o estado atual e a fun√ß√£o para alter√°-lo √© despachado.  Se voc√™ passar um objeto de a√ß√£o para despachar, chamaremos uma mudan√ßa de estado. <br><br><img src="https://habrastorage.org/webt/un/sl/ng/unslngsedmksssjrthxjmzhn7bu.jpeg"><br><br>  Gancho de uso muito importante.  Permite adicionar efeitos colaterais ao componente, oferecendo uma alternativa ao ciclo de vida.  Neste exemplo, usamos um m√©todo simples com useEffect: ele est√° apenas solicitando alguns dados do servidor, com a API, por exemplo, e exibindo esses dados na p√°gina. <br><br><img src="https://habrastorage.org/webt/bb/tc/gf/bbtcgfyw89tgu_jarnwwaagxmnq.jpeg"><br><br>  UseEffect possui um modo avan√ßado; √© quando a fun√ß√£o transmitida para useEffect retorna outra fun√ß√£o; essa fun√ß√£o ser√° chamada no pr√≥ximo loop, quando esse useEffect ser√° aplicado. <br><br>  Esqueci de mencionar, useEffect √© chamado de forma ass√≠ncrona, logo ap√≥s a altera√ß√£o ser aplicada ao DOM.  Ou seja, garante que ser√° executado ap√≥s a renderiza√ß√£o do componente e poder√° levar √† pr√≥xima renderiza√ß√£o se alguns valores forem alterados. <br><br><img src="https://habrastorage.org/webt/gl/yd/cj/glydcjxiui-c60mgjzhnfobsqcm.jpeg"><br><br>  Aqui nos encontramos pela primeira vez com um conceito como depend√™ncias.  Alguns ganchos - useEffect, useCallback, useMemo - aceitam uma matriz de valores como segundo argumento, o que nos permitir√° dizer o que rastrear.  Altera√ß√µes nessa matriz levam a algum tipo de efeito.  Por exemplo, aqui, hipoteticamente, temos algum tipo de componente para escolher um autor de alguma lista.  E um prato com livros deste autor.  E quando o autor mudar, useEffect ser√° chamado.  Quando esse authorId for alterado, uma solicita√ß√£o ser√° chamada e os livros ser√£o carregados. <br><br>  Menciono tamb√©m que, ao passar ganchos como useRef, essa √© uma alternativa ao React.createRef, algo semelhante ao useState, mas as altera√ß√µes no ref n√£o levam √† renderiza√ß√£o.  √Äs vezes, conveniente para alguns hacks.  useImperativeHandle nos permite declarar certos "m√©todos p√∫blicos" no componente.  Se voc√™ usar useRef no componente pai, poder√° usar esses m√©todos.  Para ser sincero, tentei uma vez para fins educacionais, na pr√°tica n√£o foi √∫til.  useContext √© apenas uma coisa boa, pois permite que voc√™ pegue o valor atual do contexto se o provedor definiu esse valor em algum lugar mais alto no n√≠vel da hierarquia. <br><br>  H√° uma maneira de otimizar os aplicativos React nos ganchos: a memoriza√ß√£o.  A memoriza√ß√£o pode ser dividida em interna e externa.  Primeiro sobre o exterior. <br><br><img src="https://habrastorage.org/webt/ao/wq/-e/aowq-evnbye1bnr6lspo9sthw9y.jpeg"><br><br>  Isso √© React.memo, praticamente uma alternativa √† classe React.PureComponent, que rastreia as altera√ß√µes nos adere√ßos e os componentes alterados apenas quando os adere√ßos ou o estado s√£o alterados. <br><br>  Aqui, uma coisa semelhante, no entanto, sem um estado.  Ele tamb√©m monitora as altera√ß√µes nos objetos e, se os objetos foram alterados, ocorre um renderizador.  Se os objetos n√£o foram alterados, o componente n√£o √© atualizado e economizamos nisso. <br><br><img src="https://habrastorage.org/webt/lk/0l/dn/lk0ldneyzriaeesmzxfnvvkl1h4.jpeg"><br><br>  M√©todos internos de otimiza√ß√£o.  Primeiro de tudo, isso √© algo de baixo n√≠vel - useMemo, raramente usado.  Ele permite calcular algum valor e recalcul√°-lo apenas se os valores especificados nas depend√™ncias tiverem sido alterados. <br><br><img src="https://habrastorage.org/webt/ve/fs/ml/vefsmlmbjqbg6-1lejt5_qofoow.jpeg"><br><br>  H√° um caso especial de useMemo para uma fun√ß√£o chamada useCallback.  Ele √© usado principalmente para memorizar o valor das fun√ß√µes do manipulador de eventos que ser√£o passadas aos componentes filhos, para que esses componentes filhos n√£o possam ser renderizados novamente.  √â usado simplesmente.  Descrevemos uma determinada fun√ß√£o, envolvemos-na em useCallback e indicamos de quais vari√°veis ‚Äã‚Äãela depende. <br><br>  Muitas pessoas t√™m uma pergunta, mas precisamos disso?  Precisamos de ganchos?  Estamos nos mudando ou ficando como antes?  N√£o existe uma resposta √∫nica, tudo depende das prefer√™ncias.  Primeiro de tudo, se voc√™ est√° diretamente rigidamente ligado √† programa√ß√£o orientada a objetos, se seus componentes est√£o acostumados a ela como uma classe, eles t√™m m√©todos que podem ser extra√≠dos; ent√£o, provavelmente, isso pode parecer sup√©rfluo para voc√™.  Em princ√≠pio, me pareceu quando ouvi pela primeira vez sobre ganchos que, de alguma forma, era muito complicado demais, algum tipo de m√°gica estava sendo adicionada e n√£o estava claro o porqu√™. <br><br>  Para os amantes de funcionalidades, isso √©, digamos, obrigat√≥rio, porque ganchos s√£o fun√ß√µes e t√©cnicas de programa√ß√£o funcional s√£o aplic√°veis ‚Äã‚Äãa elas.  Por exemplo, voc√™ pode combin√°-los ou fazer qualquer coisa, usando, por exemplo, bibliotecas como Ramda e similares. <br><br><img src="https://habrastorage.org/webt/du/k4/n7/duk4n7l_1_are_xjgrkf4vvbccy.jpeg"><br><br>  Desde que nos livramos das classes, n√£o precisamos mais vincular esse contexto aos m√©todos.  Se voc√™ usar esses m√©todos como retornos de chamada.  Geralmente, isso era um problema, porque era necess√°rio lembrar de vincul√°-los ao construtor ou usar uma extens√£o n√£o oficial da sintaxe da linguagem, como fun√ß√µes de seta como propriedade.  Pr√°tica bastante comum.  Eu usei meu decorador, que tamb√©m √©, em princ√≠pio, experimentalmente, em m√©todos. <br><br><img src="https://habrastorage.org/webt/pn/ew/fi/pnewfifb1wwktxkbddh1zqqk-os.jpeg"><br><br>  H√° uma diferen√ßa em como o ciclo de vida funciona, como gerenci√°-lo.  Os ganchos associam quase todas as a√ß√µes do ciclo de vida ao gancho useEffect, que permite que voc√™ assine o nascimento e a atualiza√ß√£o de um componente e sua morte.  Nas classes, para isso, tivemos que redefinir v√°rios m√©todos, como componentDidMount, componentDidUpdate e componentWillUnmount.  Al√©m disso, o m√©todo shouldComponentUpdate agora pode ser substitu√≠do pelo React.memo. <br><br><img src="https://habrastorage.org/webt/7d/ae/qy/7daeqyxv0yh0on4i1wcdsraoaws.jpeg"><br><br>  H√° uma diferen√ßa bastante pequena em como o estado √© tratado.  Primeiro, as classes t√™m um objeto de estado.  Tivemos que enfiar qualquer coisa l√°.  Em ganchos, podemos dividir o estado l√≥gico em algumas partes, o que seria conveniente para n√≥s operar separadamente. <br><br>  setState () de componentes em classes com permiss√£o para especificar um patch de estado, alterando um ou mais campos do estado.  Em termos gerais, temos que mudar todo o estado como um todo, e isso √© at√© bom, porque est√° na moda usar todo tipo de coisas imut√°veis ‚Äã‚Äãe nunca esperar que nossos objetos sofram muta√ß√µes.  Eles s√£o sempre novos conosco. <br><br>  A principal caracter√≠stica das classes que ganchos n√£o t√™m: poder√≠amos assinar altera√ß√µes de estado.  Ou seja, alteramos o estado e imediatamente assinamos suas altera√ß√µes, processando algo imperativamente imediatamente ap√≥s as altera√ß√µes serem aplicadas.  Em ganchos, isso simplesmente n√£o funciona.  Isso precisa ser feito de uma maneira muito interessante, vou lhe dizer mais adiante. <br><br>  E um pouco sobre a maneira funcional de atualiza√ß√£o.  Ele funciona l√° e ali, quando as fun√ß√µes de mudan√ßa de estado aceitam outra fun√ß√£o, que esse estado n√£o deve mudar, mas criar.  E se, no caso do componente de classe, ele pode retornar algum tipo de patch para n√≥s, ent√£o nos ganchos devemos retornar todo o novo valor. <br><br>  Em geral, √© improv√°vel que voc√™ obtenha uma resposta para mover-se ou n√£o.  Mas aconselho pelo menos tentar, pelo menos pelo novo c√≥digo, senti-lo.  Quando comecei a trabalhar com ganchos, identifiquei imediatamente v√°rios ganchos personalizados que s√£o convenientes para mim no meu projeto.  Basicamente, tentei substituir alguns dos recursos que havia implementado por meio dos componentes de ordem superior. <br><br><img src="https://habrastorage.org/webt/d6/cs/1-/d6cs1-ebiop8wbrdgnrr93wskqm.jpeg"><br><br>  useDismounted - para aqueles que est√£o familiarizados com o RxJS, h√° a oportunidade de cancelar massivamente a inscri√ß√£o de todos os Observ√°veis ‚Äã‚Äãem um √∫nico componente ou em uma √∫nica fun√ß√£o, inscrevendo cada Observ√°vel em um objeto especial, Assunto e, quando fechado, todas as assinaturas s√£o canceladas.  Isso √© muito conveniente se o componente for complexo, se houver muitas opera√ß√µes ass√≠ncronas dentro do Observable, √© conveniente cancelar a assinatura de todas de uma vez, e n√£o de cada uma separadamente. <br><br>  useObservable retorna um valor de Observable quando um novo aparece l√°.  Um gancho useBehaviourSubject semelhante retorna de BehaviourSubject.  Sua diferen√ßa em rela√ß√£o ao Observable √© que ele inicialmente tem algum significado. <br><br>  O conveniente gancho personalizado useDebounceValue nos permite organizar, por exemplo, um sujest para a cadeia de pesquisa, para que nem sempre que voc√™ pressione uma tecla, envie algo ao servidor, mas aguarde at√© que o usu√°rio termine de digitar. <br><br>  Dois ganchos semelhantes.  useWindowResize retorna valores atuais atuais para tamanhos de janela.  O pr√≥ximo gancho para a posi√ß√£o de rolagem √© useWindowScroll.  Eu os uso para recontar alguns pop-ups ou janelas modais, se houver algo complicado que simplesmente n√£o possa ser feito com CSS. <br><br>  E um gancho t√£o pequeno para implementar teclas de atalho, que o componente, quando est√° presente na p√°gina, √© inscrito em alguma tecla de atalho.  Quando ele morre, ocorre um cancelamento autom√°tico da assinatura. <br><br>  Para que servem esses ganchos personalizados?  Que podemos enfiar uma inscri√ß√£o dentro do gancho e n√£o precisamos pensar em cancelar manualmente a inscri√ß√£o em algum lugar do componente em que esse gancho √© usado. <br><br>  H√° n√£o muito tempo atr√°s, eles me deram um link para a biblioteca de uso reativo, e aconteceu que a maioria desses ganchos personalizados j√° estava implementada l√°.  E eu escrevi uma bicicleta.  Isso √†s vezes √© √∫til, mas no futuro, provavelmente, eu provavelmente os jogarei fora e utilizarei o react-use.  E eu recomendo que voc√™ veja tamb√©m se pretende usar ganchos. <br><br><img src="https://habrastorage.org/webt/03/ls/_r/03ls_rryjcv9gax_wky56kv0hye.jpeg"><br><br>  Na verdade, o principal objetivo do relat√≥rio √© mostrar como escrever incorretamente, quais problemas podem ser e como evit√°-los.  A primeira coisa, provavelmente o que qualquer pessoa que esteja estudando esses ganchos e tentando escrever algo, deve usar useEffect incorretamente.  Aqui est√° o c√≥digo semelhante ao qual 100% todos escreviam se tentassem usar ganchos.  Isso se deve ao fato de que useEffect √© inicialmente percebido mentalmente, como uma alternativa ao componentDidMount.  Mas, diferentemente do componentDidMount, que √© chamado apenas uma vez, useEffect √© chamado em cada renderiza√ß√£o.  E o erro aqui √© que ela altera, digamos, a vari√°vel de dados e, ao mesmo tempo, alter√°-la leva a um representante de componente, como resultado, o efeito ser√° solicitado novamente.  Assim, obtemos uma s√©rie intermin√°vel de solicita√ß√µes AJAX para o servidor, e o pr√≥prio componente atualiza constantemente, atualiza√ß√µes, atualiza√ß√µes. <br><br><img src="https://habrastorage.org/webt/ds/jw/cl/dsjwclnhk6kvmnmkxjw04vdrqd8.jpeg"><br><br>  Consert√°-lo √© muito simples.  Voc√™ precisa adicionar aqui uma matriz vazia dessas depend√™ncias das quais depende e altera√ß√µes nas quais reiniciar√° o efeito.  Se tivermos uma lista vazia de depend√™ncias especificadas aqui, o efeito, portanto, n√£o ser√° reiniciado.  Isso n√£o √© algum tipo de hack, √© um recurso b√°sico do uso de useEffect. <br><br><img src="https://habrastorage.org/webt/tx/bw/it/txbwitnnldk_y5r-bf0f4pss7eg.jpeg"><br><br>  Digamos que consertamos.  Agora um pouco complicado.  Temos um componente que renderiza algo que precisa ser retirado do servidor para algum tipo de ID.  Nesse caso, em princ√≠pio, tudo funciona bem at√© alterarmos o entityId no pai, talvez isso n√£o seja relevante para o seu componente. <br><br><img src="https://habrastorage.org/webt/2e/pl/tx/2epltxjdup5yia7c6gsepl-o7xo.jpeg"><br><br>  Mas, provavelmente, se ele mudar ou houver necessidade de alter√°-lo, e voc√™ tiver um componente antigo em sua p√°gina e constatar que n√£o est√° atualizando, √© melhor adicionar o ID da entidade aqui, como uma depend√™ncia, causando a atualiza√ß√£o, atualizando os dados. <br><br><img src="https://habrastorage.org/webt/rd/lc/ep/rdlcepf4e8lzq8ersyffn8ydqgs.jpeg"><br><br>  Um exemplo mais complexo com useCallback.  Aqui, √† primeira vista, est√° tudo bem.  Temos uma certa p√°gina que possui algum tipo de cron√¥metro de contagem regressiva ou, inversamente, um cron√¥metro que simplesmente funciona.  E, por exemplo, uma lista de hosts e, em cima, s√£o filtros que permitem filtrar essa lista de hosts.  Bem, a manuten√ß√£o foi adicionada aqui apenas para ilustrar um valor que muda frequentemente que se traduz em um renderizador. <br><br>    ,   ,    maintenance    ,   ,   ,      onChange.     onChange,        .  ,  HostFilters - , ,      dropdown,     .       ,    .  ,       . <br><br><img src="https://habrastorage.org/webt/bb/08/q1/bb08q1gwb5jzadcu0-bl1w0xsy0.jpeg"><br><br>     onChange    useCallback.         ,      . <br><br>    ,   . , ,  .      Facebook,   React.  , , ,  ,  '.     ,  ,  confusing . <br><br><img src="https://habrastorage.org/webt/xw/lv/et/xwlvetymaukrlaxd7t5cctegg-8.jpeg"><br><br>     ?        ‚Äî     ,   -  , ,     ,      ,  ,         .         . <br><br> ,    ,          ,     ,      ,     , .  , Garbage Collector      ,    .  , ,     ,    ,    .   , , ,       reducer,     ,          . ,      . <br><br>    ,     ,   .     - , ,   setValue  - ,            ,   setState     .   -       useEffect. <br><br>   useEffect   -  ,   -  , ,   ,    useEffect.     useEffect     ,   .        ,    ,  Backbone,  : ,     ,  ,        -  .      ,    ,  -   ,  .    -   . ,  ,      ,    ,    -  . ,  ,  ,   , ,    ,  .     . <br><br>   ,   ,  . ,        ,     .           ,      .        ,     .  ,    , , dropdown  .   ,     .    dropdown  pop-up,     useWindowScroll, useWindowResize         ,  .         ,      , ‚Äî  ,   . <br><br>        ,   ,  . ,       , ,   ,     ,       . , ,   ,      ,   ,         . <br><br><img src="https://habrastorage.org/webt/-r/tu/f_/-rtuf_bbscg5l9i4-oaeh-xpu80.jpeg"><br><br>   ,     ¬´¬ª,   . ,     ,   TypeScript    .      .    ,  reducer  Redux ,    action.  ,   action    ,     action.   ,   ,     ,  . <br><br>    .  ,        action.     ,     , IncrementA  0,  1, 2,   .         . ,    , ,  ,       .     action     action,   -     .   UnionType ‚ÄúAction‚Äù,         ,   ,    action.   . <br><br>   ‚Äî     . ,   initialState,  .   ,       -  .       TypeScript.     . ,    typeState   ,   initialState. <br><br><img src="https://habrastorage.org/webt/_i/fg/79/_ifg793-qpfaiwittpdhffve_zw.jpeg"><br><br>       reducer.   State, Action,    :   switch  action.type.  TypeScript      UnionType:       case,      - ,    type.           action   . <br><br> ,  :  ,    ,     .  . <br><br><img src="https://habrastorage.org/webt/6r/8v/or/6r8vordbm6xpl9og288kzvrgewk.jpeg"><br><br>   ?  ,     .      .      ,   reducer. ,   action creator  ,   ,       dispatch. <br><br><img src="https://habrastorage.org/webt/vg/tg/aw/vgtgawewmkwgpr5su4c24n7hgo8.jpeg"><br><br>     extension   Dev Tools.            .    . <br><br>  ,  ,    .   ,     ,     .      useDebugValue ,        -    Dev Tool.        useConstants,       - , loaded,  ,     ,  . <br><br><img src="https://habrastorage.org/webt/rt/cc/sg/rtccsggw9kekwpt75gmvnwd_w2u.jpeg"><br><br>   ‚Äî  .  ,     .     ,        .    ,   ,  ,    .     ,   ,          ‚Äî   -       ,   ‚Äî   . <br><br>   .  Facebook     ESLint,       .      ,  , .    ,   dependencies  .     ,    ,    ,     . <br><br>       ,  ,     ,  -   ,     .     ,   ,   ,       . .       ,    -   - . <br><br>    ‚Äî       , ,  - .   ,    ,    .      ,   ,  -      . ,             .      .  : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´React hooks ‚Äî   ?¬ª</a> C     .       ,    ,    ,      ,    . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   useEffect</a> .  ,   ,      ,   ,   ,     . . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´useReducer vs useState in React¬ª</a> ,    useReducer,      useState. :     ,  ,    ,    useReducer.    - ,   useState   . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">React Hooks CheatSheets</a> c      . </li><li>   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Usehooks.com</a> ‚Äî   , .     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">react-use</a> ‚Äî ,       ,     . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt464071/">https://habr.com/ru/post/pt464071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt464045/index.html">Como corri quase em tempo real em 1997</a></li>
<li><a href="../pt464053/index.html">Nota: algoritmo de sele√ß√£o e rota√ß√£o de trilhas</a></li>
<li><a href="../pt464055/index.html">Estudamos os dados coletados pelo Xiaomi Mi Band para o ano</a></li>
<li><a href="../pt464057/index.html">Hilbert, Lebesgue ... e o Vazio</a></li>
<li><a href="../pt464063/index.html">Cortando o cabo em 2019</a></li>
<li><a href="../pt464075/index.html">Introdu√ß√£o ao C. Mensagem do s√©culo passado</a></li>
<li><a href="../pt464077/index.html">N√£o, voc√™ n√£o precisa de 50 km / s de delta ve. Voc√™ precisa de tecnologias aditivas (parte 1)</a></li>
<li><a href="../pt464079/index.html">Como fazer uma nave espacial de decolagem e aterrissagem horizontal sem tecnologia milagrosa</a></li>
<li><a href="../pt464083/index.html">Como o ITSM ajudar√° e quem aplica essa metodologia</a></li>
<li><a href="../pt464089/index.html">Automatizando solicita√ß√µes HTTP no contexto do Spring</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>