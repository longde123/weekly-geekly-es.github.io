<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✍🏽 👔 👨🏼‍🏭 Et pour nous, tout est «droit» - SGBD Vertica 🍄 🤸 🐣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Je m'appelle Sergey, je travaille comme ingénieur en chef à Sbertekh. Je travaille dans le domaine informatique depuis environ 10 ans, dont 6 da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Et pour nous, tout est «droit» - SGBD Vertica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/414895/">  Salut  Je m'appelle Sergey, je travaille comme ingénieur en chef à Sbertekh.  Je travaille dans le domaine informatique depuis environ 10 ans, dont 6 dans les bases de données, les processus ETL, DWH et tout ce qui concerne les données.  Dans cet article, je parlerai de Vertica - un SGBD analytique et véritablement en colonnes qui compresse, stocke, fournit rapidement des données de manière efficace et constitue une excellente solution de Big Data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e1/e72/d1c/6e1e72d1cca80f6339ea76e0c27eedec.png"><br><a name="habracut"></a><br><h2>  Informations générales </h2><br>  Le Big Data a commencé à se développer dans les années 2000, et des moteurs étaient nécessaires pour tout digérer.  En réponse à cela, un certain nombre de SGBD en colonnes destinés à cet effet sont apparus - y compris Vertica. <br><br>  Vertica ne stocke pas seulement ses données dans des colonnes, il le fait de manière rationnelle, avec un degré de compression élevé, il planifie également efficacement les requêtes et distribue rapidement les données.  Les informations, qui dans un SGBD classique en minuscules occupent environ 1 To d'espace disque, sur Vertica prendront environ 200-300 Go, ce qui nous permet de réaliser de bonnes économies sur les disques. <br><br>  Vertica a été initialement conçu comme un SGBD de colonne.  D'autres bases essaient simplement d'imiter divers mécanismes de colonnes, mais elles ne réussissent pas toujours car le moteur est toujours conçu pour traiter les chaînes.  En règle générale, les imitateurs transposent simplement la table, puis la traitent avec le mécanisme de ligne habituel. <br><br>  Vertica est tolérant aux pannes, il n'a pas de nœud de contrôle - tous les nœuds sont égaux.  En cas de problème avec l'un des serveurs du cluster, nous recevrons toujours les données.  Très souvent, la réception des données à temps est essentielle pour les clients commerciaux, en particulier à un moment où la déclaration est fermée et où vous devez fournir des informations aux autorités financières. <br><br><h2>  Domaines d'application </h2><br>  Vertica est principalement un entrepôt de données analytiques.  Vous ne devez pas lui écrire dans de petites transactions, vous ne devez le visser sur aucun site, etc.  Vertica doit être considéré comme une sorte de couche batch, où il vaut la peine d'immerger les données dans de grands packs.  Si nécessaire, Vertica est prêt à fournir ces données très rapidement - les requêtes pour des millions de lignes sont effectuées en quelques secondes. <br><br>  Où cela peut-il être utile?  Prenons, par exemple, une entreprise de télécommunications.  Vertica peut y être utilisé pour la géoanalyse, le développement de réseaux, la gestion de la qualité, le marketing ciblé, l'étude des informations provenant des centres de contact, la gestion des sorties de clients et les solutions anti-fraude / anti-spam. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ef/913/bfe/0ef913bfe1510fd3aee6de4bb52e3175.png"><br><br>  Dans d'autres secteurs d'activité, tout est à peu près le même - des analyses fiables et opportunes sont importantes pour le profit.  Dans le commerce, par exemple, tout le monde essaie de personnaliser les clients, de distribuer des cartes de réduction à cet effet, de collecter des données sur où, quoi et quand une personne a acheté, etc.  En analysant les tableaux d'informations de tous ces canaux, nous pouvons les comparer, construire des modèles et prendre des décisions menant à la croissance des bénéfices. <br><br><h2>  Seuil d'entrée </h2><br>  Aujourd'hui, tout employeur a besoin d'un analyste pour comprendre ce qu'est SQL.  Si vous connaissez ANSI SQL, vous pouvez être appelé un utilisateur Vertica sûr.  Si vous pouvez construire des modèles en Python et R, alors vous n'êtes qu'un «masseur» de données.  Si vous maîtrisez Linux et avez des connaissances de base de l'administration Vertica, vous pouvez travailler en tant qu'administrateur.  En général, le seuil d'entrée dans Vertica est bas, mais, bien sûr, toutes les nuances ne peuvent être trouvées qu'en bourrant une main pendant le fonctionnement. <br><br><h2>  Architecture matérielle </h2><br>  Envisagez Vertica au niveau du cluster.  Ce SGBD fournit un traitement de données massivement parallèle (MPP) dans une architecture informatique distribuée - «rien partagé» - où, en principe, n'importe quel nœud est prêt à reprendre les fonctions de tout autre nœud.  Propriétés principales: <br><br><ul><li>  Il n'y a pas de point de défaillance unique <br></li><li>  chaque nœud est indépendant et indépendant, <br></li><li>  Il n'y a pas de point de connexion unique pour l'ensemble du système, <br></li><li>  les nœuds d'infrastructure sont dupliqués, <br></li><li>  les données sur les nœuds de cluster sont automatiquement copiées. <br></li></ul><br>  Le cluster évolue linéairement sans aucun problème.  Nous mettons simplement les serveurs dans une étagère et les connectons via une interface graphique.  En plus des serveurs série, le déploiement sur des machines virtuelles est possible.  Que peut-on réaliser avec l'extension? <br><br><ul><li>  Le volume augmente pour les nouvelles données <br></li><li>  Augmentez la charge de travail maximale <br></li><li>  Amélioration de la résilience.  Plus il y a de nœuds dans le cluster, moins il est probable que le cluster tombe en panne en raison d'une défaillance, et donc, plus nous nous rapprochons de la disponibilité 24/7. <br></li></ul><br>  Mais il y a quelques points à considérer.  Périodiquement, les nœuds doivent être supprimés du cluster pour la maintenance.  Un autre cas assez courant dans les grandes organisations est que les serveurs sortent de la garantie et passent d'un environnement productif à une sorte d'environnement de test.  À leur place, il y en a de nouveaux qui sont sous la garantie du fabricant.  Sur la base des résultats de toutes ces opérations, un rééquilibrage est nécessaire.  Il s'agit d'un processus où les données sont redistribuées entre les nœuds - en conséquence, la charge de travail est redistribuée.  Il s'agit d'un processus gourmand en ressources et sur les clusters contenant une grande quantité de données, il peut réduire considérablement les performances.  Pour éviter cela, vous devez sélectionner la fenêtre de service - l'heure à laquelle la charge est minimale, auquel cas les utilisateurs ne la remarqueront pas. <br><br><h2>  Projections </h2><br>  Pour comprendre comment les données sont stockées dans Vertica, vous devez traiter avec l'un des concepts de base - la projection. <br><br>  Les unités logiques de stockage d'informations sont des diagrammes, des tableaux et des vues.  Les unités physiques sont des projections.  Les projections sont de plusieurs types: <br><br><ul><li>  Superprojection <br></li><li>  Projections spécifiques aux requêtes <br></li><li>  Projections agrégées <br></li></ul><br>  Lors de la création d'une table, une <i>super projection</i> est automatiquement créée qui contient toutes les colonnes de notre table.  Si vous avez besoin d'accélérer l'un des processus habituels, nous pouvons créer une <i>projection orientée requête</i> spéciale qui contiendra, disons, 3 colonnes sur 10. <br><br>  Le troisième type est également destiné aux <i>projections agrégées</i> d'accélération.  Je n'entrerai pas dans leurs sous-classes - ce n'est pas très intéressant.  Je tiens à vous avertir immédiatement qu'il ne vaut pas la peine de résoudre constamment vos problèmes d'exécution de requêtes en créant de nouvelles projections.  Finalement, le cluster commencera à ralentir. <br><br>  Lors de la création de projections, nous devons évaluer si nos requêtes ont suffisamment de superprojections.  Si nous voulons toujours expérimenter, nous ajoutons strictement une nouvelle projection.  Si des problèmes surviennent, il sera plus facile de trouver la cause profonde.  Pour les grands tableaux, créez une projection segmentée.  Il est divisé en segments répartis sur plusieurs nœuds, ce qui augmente la tolérance aux pannes et minimise la charge sur un nœud.  Si les comprimés sont petits, il est préférable de faire des projections non segmentées.  Ils sont entièrement copiés sur chaque nœud et les performances sont ainsi augmentées.  Je vais faire une réservation: pour Vertica, une "petite" table fait environ 1 million de lignes. <br><br><h2>  Tolérance aux pannes </h2><br>  La tolérance aux pannes dans Vertica est implémentée à l'aide du mécanisme K-Safety.  Il est assez simple en termes de description, mais complexe en termes de travail au niveau du moteur.  Il peut être contrôlé à l'aide du paramètre K-Safety - il peut avoir une valeur de 0, 1 ou 2. Ce paramètre définit le nombre de copies de données de projection segmentées. <br><br>  Les copies des projections sont appelées projections de copains.  J'ai essayé de traduire cette phrase par le biais du traducteur Yandex et il s'est avéré quelque chose comme une «projection acolyte».  Google proposait des options et plus intéressantes.  Typiquement, ces projections sont appelées partenaires ou voisines, selon leur fonction.  Ce sont des projections qui sont simplement stockées sur des nœuds voisins et donc réservées.  Les projections non segmentées n'ont pas de projections copain - elles sont copiées complètement. <br><br>  Comment ça marche?  Prenons un cluster de cinq machines.  Soit K-safety égal à 1. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f6b/af4/969/f6baf4969fb15ab90df2d68def4862dd.png"><br><br>  Les nœuds sont numérotés et sous eux se trouvent des projections de partenaires écrites qui sont stockées sur eux.  Supposons que nous ayons un nœud déconnecté.  Que va-t-il se passer? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f5c/adc/696/f5cadc696f5683b45591e3d597ae5cdc.png"><br><br>  Le nœud 1 contient une projection conviviale du nœud 2. Par conséquent, la charge sur le nœud 1 augmentera, mais le cluster ne cessera pas de fonctionner.  Et maintenant, cette situation: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b4/414/8af/2b44148afc4c57bf863e966d527ffa36.png"><br><br>  Le nœud 3 contient la projection du nœud 4 et les nœuds 1 et 3 seront surchargés. <br><br>  Nous compliquons la tâche.  K-Safety = 2, désactivez deux nœuds adjacents. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1bd/741/a31/1bd741a3183af8ec14fa2f953b99dc8a.png"><br><br>  Ici, les nœuds 1 et 4 seront surchargés (le nœud 2 contient la projection du nœud 1 et le nœud 3 contient la projection du nœud 4). <br><br>  Dans de telles situations, le moteur du système reconnaît que l'un des nœuds ne répond pas et la charge est transférée au nœud voisin.  Il sera utilisé jusqu'à ce que le nœud soit à nouveau restauré.  Une fois que cela se produit, la charge et les données sont redistribuées.  Dès que nous perdons plus de la moitié du cluster ou des nœuds contenant toutes les copies de certaines données, le cluster se lève. <br><br><h2>  Stockage de données logique </h2><br>  Vertica possède des zones de stockage optimisées pour l'écriture, des zones optimisées pour la lecture et un mécanisme Tuple Mover qui permet aux données de circuler du premier au second. <br><br>  Lorsque vous utilisez les opérations COPY, INSERT, UPDATE, nous nous retrouvons automatiquement dans WOS (Write Optimized Store), une zone où les données ne sont pas optimisées pour la lecture et triées uniquement sur demande, stockées sans compression ni indexation.  Si les volumes de données sont trop importants pour la zone WOS, alors en utilisant l'instruction DIRECT supplémentaire, ils doivent être écrits immédiatement dans ROS.  Sinon, le WOS sera plein et nous planterons. <br><br>  Une fois le délai spécifié dans les paramètres expiré, les données du WOS sont transférées vers ROS (Read Optimized Store) - une structure de stockage sur disque optimisée et orientée en lecture.  ROS stocke la majeure partie des données, ici elles sont triées et compressées.  Les données ROS sont divisées en conteneurs de stockage.  Un conteneur est un ensemble de lignes créées par des opérateurs de traduction (COPY DIRECT) et est stocké dans un groupe spécifique de fichiers. <br><br>  Peu importe où les données sont écrites - en WOS ou en ROS - elles sont disponibles immédiatement.  Mais la lecture à partir de WOS est plus lente car les données n'y sont pas regroupées. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00e/c1e/e0d/00ec1ee0d4605f51f009febe686c4a44.png"><br><br>  Tuple Mover est un outil de nettoyage qui effectue deux opérations: <br><br><ul><li>  Déplacement - compresse et trie les données dans WOS, les déplace vers ROS et crée de nouveaux conteneurs pour elles dans ROS. <br></li><li>  Mergeout - balayant derrière nous lorsque nous utilisons DIRECT.  Nous ne sommes pas toujours en mesure de charger autant d'informations pour obtenir de gros conteneurs ROS.  Par conséquent, il combine périodiquement de petits conteneurs ROS dans des conteneurs plus grands, nettoie les données marquées pour la suppression, tout en travaillant en arrière-plan (selon l'heure spécifiée dans la configuration). <br></li></ul><br><h2>  Quels sont les avantages du stockage sur colonne? </h2><br>  Si nous lisons des lignes, alors, par exemple, pour exécuter une commande <br><br> <code>SELECT 1,11,15 from table1 <br></code> <br>  nous devrons lire tout le tableau.  C'est une énorme quantité d'informations.  Dans ce cas, l'approche par colonne est plus rentable.  Il vous permet de compter uniquement les trois colonnes dont nous avons besoin, économisant ainsi de la mémoire et du temps. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ee/1b5/69e/6ee1b569e3daa80c154912e1ca3ac6ed.png"><br><br><h2>  Affectation des ressources </h2><br>  Afin d'éviter les problèmes, l'utilisateur doit être un peu limité.  Il y a toujours une chance que l'utilisateur écrive une requête lourde qui engloutira toutes les ressources.  Par défaut, Vertica occupe une partie importante de la zone générale, et en outre, des zones distinctes pour Tuple Mover, WOS et les processus système (récupération, etc.) sont mises en évidence. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e7/008/498/7e70084981be49bb1f041743d31521a1.png"><br><br>  Essayons de partager ces ressources.  Nous créons des zones pour les écrivains, pour les lecteurs et pour les requêtes lentes et de faible priorité. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/be5/895/add/be5895add6099324995b81d8a39f670a.png"><br><br>  Si nous regardons les tables système dans lesquelles nos ressources sont stockées - les pools de ressources - alors nous verrons de nombreux paramètres avec lesquels vous pouvez tout ajuster plus finement.  Au début, vous ne devriez pas vous lancer là-dedans, il vaut mieux se limiter simplement à couper la mémoire pour certaines tâches.  Lorsque vous acquérez de l'expérience et êtes sûr à 100% que vous faites tout correctement, il sera possible d'expérimenter. <br><br>  Les paramètres légers incluent la priorité d'exécution, les sessions compétitives et la quantité de mémoire allouée.  Et même avec des processeurs, nous pouvons corriger quelque chose. Pour travailler avec ces paramètres, vous avez besoin d'avoir pleinement confiance dans l'exactitude de vos actions, il est donc préférable de solliciter le soutien de l'entreprise et d'avoir le droit de faire une erreur. <br><br>  Vous trouverez ci-dessous un exemple de demande par laquelle vous pouvez voir les paramètres du pool général: <br><br> <code>dbadmin =&gt; select * FROM resource_pools WHERE NAME = 'general'; <br> <br> -[ RECORD 1 ]------------+--------------- <br> pool_id | 45035996273721212 <br> name | general <br> is_internal | t <br> memorysize | <br> maxmemorysize | 30G <br> executionparallelism | AUTO <br> priority | 0 <br> runtimepriority | MEDIUM <br> runtimeprioritythreshold | 2 <br> queuetimeout | 0:05 <br> plannedconcurrency | 10 <br> maxconcurrency | 20 <br> runtimecap | <br> singleinitiator | f <br> cpuaffinityset | <br> cpuaffinitymode | ANY <br> cascadeto |</code> <br> <br><h2>  ANSI SQL et autres fonctionnalités </h2><br><ul><li>  Vertica vous permet d'écrire en SQL-99 - toutes les fonctionnalités sont prises en charge. <br></li><li>  Verica possède de grandes capacités d'analyse - même des outils d'apprentissage automatique sont inclus <br></li><li>  Vertica peut indexer des textes <br></li><li>  Vertica traite des données semi-structurées <br></li></ul><br><h2>  Intégration </h2><br>  Vertica, comme tous les outils actuels, est sérieusement intégré à d'autres systèmes.  Capable de bien fonctionner avec HDFS (Hadoop).  Dans les versions antérieures, Vertica ne pouvait télécharger que des données depuis HDFS de certains formats, mais maintenant il peut tout faire, fonctionne avec tous les formats, par exemple, ORC et Parquet.  Il peut même joindre des fichiers en tant que tables externes et stocker ses données dans des conteneurs ROS directement sur HDFS.  Dans la huitième version de Vertica, une optimisation significative de la vitesse de travail avec HDFS, un catalogue de métadonnées et l'analyse de ces formats ont été effectués.  Vous pouvez créer un cluster Vertica directement sur un cluster Hadoop. <br><br>  À partir de la version 7.2, Vertica peut fonctionner avec Apache Kafka - si quelqu'un a besoin d'un courtier de messages. <br><br>  Vertica 8 a un support complet pour Spark.  Il est possible de copier des données de Spark vers Vertica et vice versa. <br><br><h2>  Conclusion </h2><br>  Vertica est une bonne option pour travailler avec des mégadonnées qui ne nécessitent pas beaucoup de connaissances en entrée.  Ce SGBD possède de vastes capacités analytiques.  Parmi les inconvénients - cette solution n'est pas open source, mais vous pouvez essayer de déployer gratuitement avec une limite de 1 To et trois nœuds - cela suffit pour comprendre si vous avez besoin de Vertica ou non. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414895/">https://habr.com/ru/post/fr414895/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414885/index.html">Nous traitons les erreurs et les «béquilles» dans le Registre d'État unifié des entités juridiques - le registre d'État des entités juridiques</a></li>
<li><a href="../fr414887/index.html">Création d'un crochet pour chat dans Unity. Partie 1</a></li>
<li><a href="../fr414889/index.html">Quand les agences numériques ont besoin de l'IaaS</a></li>
<li><a href="../fr414891/index.html">Habitudes des développeurs</a></li>
<li><a href="../fr414893/index.html">Viber, WhatsApp, Telegram - quel est le meilleur?</a></li>
<li><a href="../fr414897/index.html">Accès aux données dans les applications multi-utilisateurs</a></li>
<li><a href="../fr414899/index.html">Comment collecter des analyses et ne pas tuer la productivité</a></li>
<li><a href="../fr414901/index.html">Dell et DROVA: comment jouer à des jeux exigeants même sur un ordinateur portable faible</a></li>
<li><a href="../fr414905/index.html">Composants Web Partie 3: Modèles HTML et importations</a></li>
<li><a href="../fr414907/index.html">Qu'est-ce qui relie la théorie des nombres à la trajectoire de la lumière?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>