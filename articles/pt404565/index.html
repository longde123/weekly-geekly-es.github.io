<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé° üè∑Ô∏è üë©üèª‚Äçü§ù‚Äçüë®üèº SportIduino - Sistema de Marca√ß√£o Eletr√¥nica de Orienta√ß√£o Arduino üëÉüèΩ üßëüèæ‚Äçü§ù‚Äçüßëüèº üâê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sair para o campo √© sempre maravilhoso, mas com um mapa na m√£o e com um objetivo consciente √© sempre mais interessante. Existem tipos de atividades ao...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SportIduino - Sistema de Marca√ß√£o Eletr√¥nica de Orienta√ß√£o Arduino</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/404565/"><img src="https://habrastorage.org/web/6e5/049/cd8/6e5049cd8c2c4ec6907532fd1ab6a8ac.JPG"><br><br>  Sair para o campo √© sempre maravilhoso, mas com um mapa na m√£o e com um objetivo consciente √© sempre mais interessante.  Existem tipos de atividades ao ar livre como orienta√ß√£o, rogains, multi-ra√ßas, participando das quais voc√™ pode se divertir.  A tarefa do orientador √© visitar os pontos de verifica√ß√£o indicados no mapa no menor tempo poss√≠vel.  Para provar o fato de sua visita, eles s√£o usados ‚Äã‚Äãcomo os chamados  Sistemas de marca√ß√£o ‚Äútradicionais‚Äù: l√°pis de cor, s√≠mbolos de c√≥digo, compositores, etc., bem como sistemas eletr√¥nicos.  Apesar da conveni√™ncia deste √∫ltimo, os m√©todos tradicionais ainda s√£o amplamente utilizados em competi√ß√µes amadoras.  Isso se deve ao custo do equipamento (de 3.500 rublos por marca de esta√ß√£o e de 450 rublos por chip), com a possibilidade de roubo de esta√ß√µes instaladas em locais p√∫blicos, a necessidade de fazer um dep√≥sito para o chip.  Portanto, estabeleci o objetivo de criar uma alternativa mais acess√≠vel.  Sua implementa√ß√£o no ambiente do Arduino √© descrita abaixo. <br><a name="habracut"></a><br>  Um sistema de identifica√ß√£o eletr√¥nica geralmente consiste em chips e esta√ß√µes de RFID - dispositivos especiais para grava√ß√£o e leitura.  O sistema funciona da seguinte maneira.  No in√≠cio, o atleta de orienta√ß√£o recebe uma ficha, pega uma carta e come√ßa.  Correndo at√© o PC, ele aplica seu chip na esta√ß√£o de marca√ß√£o, ela registra a hora atual no chip e emite um sinal, ap√≥s o qual o atleta pode continuar.  No final, o atleta passa o chip para o juiz, que l√™ as informa√ß√µes usando a esta√ß√£o de gateway e anuncia o resultado ao atleta - seu tempo √† dist√¢ncia, o n√∫mero de CPs visitados, conformidade com uma determinada dire√ß√£o.  Ele tamb√©m pode imprimir divis√µes - per√≠odos gastos no caminho entre o PC, o que permite ao atleta analisar seu caminho e comparar-se com os outros em um segmento espec√≠fico da dist√¢ncia. <br><br>  Para trabalhar com chips RFID, existe um m√≥dulo RFID-RC522 amplamente dispon√≠vel, para o qual existe uma excelente biblioteca para o arduino, em muitos aspectos esse fato determinou seu uso.  O m√≥dulo opera com uma frequ√™ncia de 13,56 MHz e suporta o padr√£o ISO 14443, trabalha com v√°rios chips, a leitura e a grava√ß√£o ocorrem a uma dist√¢ncia de v√°rios cent√≠metros, o que √© adequado para nossos prop√≥sitos. <br><br><img src="https://habrastorage.org/web/1fa/1a4/186/1fa1a4186195442bba96b58d0405324e.JPG"><br><br>  <b>Chips</b> <br><br>  Para criar um sistema de marca√ß√£o, usei o chip Mifare Classic 1K (S50) devido √† sua ampla disponibilidade em v√°rios designs e baixo custo (11 rublos por chip na forma de um chaveiro).  O chip permite que voc√™ leia e grave informa√ß√µes de maneira r√°pida e confi√°vel.  A mem√≥ria do chip √© estruturalmente dividida em 16 setores, cada um dos quais cont√©m 4 blocos de 16 bytes.  O quarto bloco de cada setor cont√©m chaves que podem ser usadas para escrever / ler blocos no setor.  Al√©m disso, no setor zero, o bloco zero cont√©m o UID e informa√ß√µes sobre o fabricante.  Assim, restam 3 blocos de 16 bytes para escrever nos setores do 1¬∫ ao 15¬∫ e dois blocos no 0¬∫ setor.  A estrutura de grava√ß√£o √© apresentada na tabela abaixo, todos os dados s√£o registrados em triplicado para garantir a confiabilidade. <br><br><img src="https://habrastorage.org/web/7db/d8d/587/7dbd8d5873ba4e6b9c729b9ba17dd39b.png"><br><br>  Este sistema de grava√ß√£o permite gravar 45 marcas na mem√≥ria, incluindo in√≠cio e t√©rmino, para a maioria das competi√ß√µes isso √© suficiente.  Mas se voc√™ otimizar o uso da mem√≥ria e dedicar um pouco mais de tempo, a capacidade poder√° ser significativamente aumentada. <br><br><img src="https://habrastorage.org/web/2dd/01a/6b6/2dd01a6b642c40639634811fa5f71e22.JPG"><br><br>  <b>Esta√ß√µes da esta√ß√£o</b> <br><br>  <i>Esquema e instala√ß√£o</i> <br><br>  Os principais componentes das esta√ß√µes da marca: microcontrolador - Atmega328p-au, m√≥dulo RF522, rel√≥gio DS3231.  Alimentado por 3 pilhas AA atrav√©s do estabilizador linear MCP1700T-33. <br><br><img src="https://habrastorage.org/web/614/c46/d8e/614c46d8e4bf4617b6ba02a2b69e5106.jpg"><br><br>  Eu instalei os componentes em uma placa de circuito impresso, todos os componentes SMD, com a placa RFID que fiz a conex√£o soldando atrav√©s do conector do pino.  As placas foram fabricadas com fotorresistente, faixas de 0,5 mm.  Enquanto o m√©todo estava sendo aperfei√ßoado, fiz muitos casamentos, provavelmente √© mais conveniente criar arquivos gerber e ordenar sua produ√ß√£o de lado, j√° que n√£o √© muito caro. <br><br><img src="https://habrastorage.org/web/887/6a0/176/8876a017695846c184bf5aaac77b5e55.JPG"><br><br>  Eu uso o g1020BF acess√≠vel como o caso.  Fiz um furo na caixa para o LED e cortei o excesso de pl√°stico para entrar no compartimento da bateria.  O orif√≠cio para o LED foi tratado com ep√≥xi e, em seguida, inseriu uma placa de circuito soldada.  Depois que o ep√≥xi endureceu, ele injetou 30 mililitros do composto PK-68, o que era suficiente para cobrir o painel.  Coloquei as pilhas no compartimento e sujei tudo com graxa para impermeabiliza√ß√£o.  Depois de apertar a tampa, a esta√ß√£o est√° pronta para uso. <br><br><img src="https://habrastorage.org/web/dab/19f/14e/dab19f14e7fa4c5b9f56fce173c95b70.jpg"><br><br>  O custo dos componentes e materiais da esta√ß√£o para sua fabrica√ß√£o √© de cerca de 500 rublos.  Demoro cerca de 1,5 horas de tempo puro para criar e configurar uma esta√ß√£o. <br><br>  <i>Firmware da esta√ß√£o</i> <br><br>  Durante a opera√ß√£o da esta√ß√£o, v√°rios tipos de mau funcionamento s√£o poss√≠veis; foi necess√°rio implementar o trabalho de watchdog; portanto, voc√™ precisa usar um Bootloader compat√≠vel para que funcione corretamente.  Uma boa vers√£o do gerenciador de inicializa√ß√£o do Atmega328p e as instru√ß√µes para instal√°-lo est√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Voc√™ tamb√©m deve alterar a biblioteca de cabos padr√£o para sem bloqueio, para que a esta√ß√£o continue a funcionar quando a linha i2c for interrompida e n√£o entre em um loop sem fim.  Carreguei o carregador de inicializa√ß√£o usando outro arduino por meio do firmware do Arduino como isp, conectei os contatos SPI atrav√©s dos pinos que levam ao m√≥dulo RFID, que interrompi ap√≥s uma inicializa√ß√£o bem-sucedida.  Ap√≥s o qual eu instalei o firmware principal. <br><br>  Com o firmware principal, quando a bandeja √© inserida, a esta√ß√£o l√™ um bloco de informa√ß√µes a partir do qual aprende os n√∫meros do √∫ltimo bloco gravado e a esta√ß√£o em que a marca ocorreu.  Se o n√∫mero da esta√ß√£o for diferente, o bloco de informa√ß√µes √© atualizado e o n√∫mero da esta√ß√£o e a hora atual s√£o gravados no pr√≥ximo bloco livre.  A hora e o n√∫mero da esta√ß√£o podem ser ajustados usando chips especiais e a esta√ß√£o de gateway. <br><br>  <i>Nutri√ß√£o</i> <br><br>  Uma das quest√µes mais importantes que valeu a pena resolver foi como maximizar a vida √∫til das esta√ß√µes a partir de um conjunto de baterias.  Isso √© especialmente cr√≠tico para a orienta√ß√£o tur√≠stica, quando as esta√ß√µes s√£o instaladas muito antes da competi√ß√£o e √© necess√°rio garantir que funcionem por mais de um m√™s. <br><br>  Para reduzir o consumo, os modos de suspens√£o s√£o usados ‚Äã‚Äãpara o controlador e tamb√©m para o RC522.  No modo de suspens√£o, a esta√ß√£o consome apenas 0,02 mA versus 20 mA durante a opera√ß√£o.  Para usar a energia de maneira mais econ√¥mica, foram implementados tr√™s modos de opera√ß√£o da esta√ß√£o com diferentes intervalos de tempo de suspens√£o. <br><br>  Por padr√£o, a esta√ß√£o inicia no modo de espera.  Ao mesmo tempo, o chip √© pesquisado a cada segundo, a capacidade da bateria √© suficiente para 160 dias.  Quando o chip √© colocado na bandeja (isso √© feito pelo juiz de produ√ß√£o ou pelo primeiro atleta que correu para a esta√ß√£o), a esta√ß√£o muda para o modo operacional.  No modo operacional, uma pesquisa de chip √© implementada a cada 250 ms.  As pilhas novas duram 45 dias em uso cont√≠nuo.  Ap√≥s 6 horas de inatividade, a esta√ß√£o retorna ao modo de espera. <br><br>  Quando o chip de suspens√£o principal (chip de √°rbitro especial com as configura√ß√µes da esta√ß√£o) √© trazido, a esta√ß√£o muda para o modo de armazenamento (procure o chip uma vez a cada 25 segundos), escolhe 3 vezes e reinicia.  As pilhas novas neste modo duram 5 anos.  Quando uma bandeja √© colocada em qualquer chip, a esta√ß√£o entra no modo de espera e a carga restante da bateria √© medida.  Se a tens√£o cair abaixo de 3.1V, o que indica que cerca de 15% da carga permanece, a esta√ß√£o sinaliza isso. <br><br>  <b>Interface e processamento de dados</b> <br><br>  Uma esta√ß√£o de interface √© fornecida para trabalhar com chips e esta√ß√µes de marca√ß√£o.  Usando a esta√ß√£o gateway, voc√™ pode definir e ajustar os n√∫meros de hora e esta√ß√£o usando chips mestre especiais.  Al√©m disso, a esta√ß√£o de gateway realiza a limpeza e a verifica√ß√£o pr√©-lan√ßamento dos chips, inserindo-os com informa√ß√µes iniciais e um n√∫mero individual.  Bem, √© claro, ele l√™ as fichas e obt√©m os resultados. <br><br>  Tamb√©m adicionei ao circuito um m√≥dulo SD para gravar splits e um m√≥dulo Bluetooth para que a esta√ß√£o possa ser conectada a um telefone ou computador para receber ou transmitir dados. <br><br><img src="https://habrastorage.org/web/311/76a/72a/31176a72ae274e089e98e8f28b6caca1.PNG"><br><br>  Enquanto o circuito e o firmware ainda n√£o est√£o otimizados o suficiente e implementados t√£o longe dos m√≥dulos, no joelho.  No futuro, est√° planejado finalizar para uso mais conveniente. <br><br><img src="https://habrastorage.org/web/26b/aa9/e93/26baa9e935164e8f8bc0e44d5482856e.JPG"><br><br>  No momento, o processamento de dados √© realizado de maneira semi-manual, classificando os arquivos CSV resultantes.  O sistema √© muito flex√≠vel e pode ser facilmente configurado para qualquer competi√ß√£o, para implementar o pr√©-processamento de dados no gateway de maneira conveniente em diferentes casos.  Para o futuro, h√° planos de escrever software para automatizar o processamento de dados. <br><br>  <b>Conclus√£o</b> <br><br>  Eu sou novo em programa√ß√£o e desenvolvimento de dispositivos eletr√¥nicos e fa√ßo isso h√° menos de um ano.  Portanto, as solu√ß√µes de c√≥digo e circuito, possivelmente, est√£o longe de serem √≥timas ou completamente incorretas.  Ficarei muito feliz em criticar, todo o projeto est√° dispon√≠vel gratuitamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no github</a> . <br><br>  Tamb√©m quero expressar gratid√£o √†queles que j√° ajudaram com dicas e se interessaram pelo desenvolvimento. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt404565/">https://habr.com/ru/post/pt404565/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt404555/index.html">An√°lise do Telefone IP Yealink SIP-T27G</a></li>
<li><a href="../pt404557/index.html">O caminh√£o Progress MS-06 entregar√° √† ISS em 16 de junho de 2017: revis√£o de cargas, experimentos e tarefas</a></li>
<li><a href="../pt404559/index.html">O desafio para crian√ßas de cinco anos que se tornou "viral"</a></li>
<li><a href="../pt404561/index.html">Escrit√≥rio no estilo da Canon. Vis√£o geral de dispositivos e solu√ß√µes para neg√≥cios</a></li>
<li><a href="../pt404563/index.html">Alternativa de raio para redes pequenas</a></li>
<li><a href="../pt404567/index.html">Editora Peter. Venda de ver√£o</a></li>
<li><a href="../pt404569/index.html">Part√≠culas, antipart√≠culas e sua aniquila√ß√£o</a></li>
<li><a href="../pt404571/index.html">Redes sociais - uma nova fonte s√©ria de amea√ßas cibern√©ticas</a></li>
<li><a href="../pt404573/index.html">Ganhar o "monstro matem√°tico": n√£o se trata de n√∫meros, mas de aprender a pensar</a></li>
<li><a href="../pt404575/index.html">A IA da Microsoft quebrou o recorde de um homem na Sra. Pac-man</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>