<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë®‚Äçüë¶‚Äçüë¶ üèçÔ∏è ü§´ Condu√ß√£o CAN üë®‚Äçüë®‚Äçüëß‚Äçüëß üîå üññüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introdu√ß√£o 
 O ve√≠culo n√£o tripulado StarLine baseado na plataforma Lexus RX 450h √© um projeto de pesquisa lan√ßado em 2018. O projeto est√° aberto a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Condu√ß√£o CAN</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450140/"><h3>  1. Introdu√ß√£o </h3><br>  <b>O ve√≠culo n√£o tripulado StarLine</b> baseado na plataforma <b>Lexus RX 450h</b> √© um projeto de pesquisa lan√ßado em 2018.  O projeto est√° aberto a profissionais ambiciosos da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Comunidade de C√≥digo Aberto</a> .  Oferecemos a todos que participem do processo de desenvolvimento no n√≠vel do c√≥digo, para testar seus algoritmos em um carro real equipado com equipamentos caros.  Para controlar o carro, decidiu-se usar o Apollo, uma estrutura aberta.  Para o Apollo funcionar, precis√°vamos conectar um conjunto de m√≥dulos.  Esses m√≥dulos ajudam o programa a receber informa√ß√µes sobre o carro e control√°-lo de acordo com os algoritmos especificados. <br><br>  <b>Esses m√≥dulos incluem:</b> <br><br><ul><li>  m√≥dulo para posicionar um carro no espa√ßo usando coordenadas GPS; </li><li>  m√≥dulo para dire√ß√£o, acelera√ß√£o e frenagem de um carro; </li><li>  m√≥dulo do estado dos sistemas automotivos: velocidade, acelera√ß√£o, posi√ß√£o do volante, acionamento dos pedais, etc; </li><li>  m√≥dulo para obter informa√ß√µes sobre o ambiente do carro.  Sensores ultrass√¥nicos, c√¢meras, radares e lidares podem lidar com isso. </li></ul><br>  Antes de tudo, nossa equipe enfrentou a tarefa de aprender a controlar o volante, a acelera√ß√£o e a frenagem do carro.  E tamb√©m receba informa√ß√µes sobre o estado dos sistemas de autom√≥veis.  Para isso, muito trabalho foi feito para estudar o barramento Lexus CAN. <br><a name="habracut"></a><br><h3>  Parte te√≥rica </h3><br><h4>  O que √© um barramento CAN? </h4><br>  Nos carros modernos, os sistemas eletr√¥nicos assumiram o controle de todos os sistemas (Fig. 1.).  Os componentes eletr√¥nicos s√£o computadores especializados, cada um dos quais possui todas as interfaces necess√°rias para a integra√ß√£o com um carro.  Usando interfaces de comunica√ß√£o digital, as unidades s√£o conectadas em rede para trocar informa√ß√µes entre si.  As interfaces digitais mais comuns em carros s√£o CAN, LIN, FLEXRay.  Destes, o CAN √© mais amplamente utilizado. <br><br>  O barramento CAN (Controller Area Network) √© a rede padr√£o da ind√∫stria.  Em 1986, esse padr√£o foi desenvolvido pela Bosch.  E o primeiro carro com um √¥nibus CAN foi o Mercedes-Benz W140, lan√ßado em 1991.  O padr√£o foi desenvolvido para permitir que os dispositivos se comuniquem sem um host.  As informa√ß√µes s√£o trocadas usando mensagens especiais, que consistem em campos de ID, comprimento e dados da mensagem.  Cada bloco possui seu pr√≥prio conjunto de IDs.  Nesse caso, uma mensagem com um ID menor tem prioridade no barramento.  O campo de dados pode transportar informa√ß√µes, por exemplo, sobre o status de sistemas e sensores, comandos para controlar mecanismos etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e6/109/0a4/1e61090a4149347d85f1b19488b27e94.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>1. Barramento CAN do ve√≠culo.</i> <br><br>  No n√≠vel f√≠sico, o barramento √© um par tran√ßado de condutores de cobre.  O sinal √© transmitido diferencial, devido ao qual √© alcan√ßada alta imunidade ao ru√≠do. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/288/59d/b2f/28859db2fc4d7f30bb521f4e6c0a3123.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>2. Representa√ß√£o f√≠sica do sinal no barramento CAN</i> <br><br>  Atrav√©s do barramento CAN, voc√™ pode receber informa√ß√µes sobre o status de v√°rios sensores e sistemas de ve√≠culos.  Tamb√©m via CAN, voc√™ pode controlar os componentes do carro.  S√£o essas oportunidades que usamos para o nosso projeto. <br><br>  Escolhemos o Lexus RX porque sab√≠amos que poder√≠amos gerenciar todos os n√≥s necess√°rios via CAN.  Desde que a coisa mais dif√≠cil ao pesquisar um carro √© protocolos fechados.  Portanto, um dos motivos para a escolha desse modelo de carro espec√≠fico foi a presen√ßa de uma descri√ß√£o da parte do protocolo de barramento CAN no projeto de c√≥digo aberto Openpilot. <br><br>  Dirigir adequadamente um carro significa entender como as partes mec√¢nicas dos sistemas de um carro funcionam.  Precis√°vamos ter um bom entendimento de como trabalhar com um amplificador de pot√™ncia el√©trica ou controlar a desacelera√ß√£o de um carro.  De fato, por exemplo, quando as rodas s√£o giradas, elas criam resist√™ncia √† dire√ß√£o, o que introduz restri√ß√µes na dire√ß√£o ao girar.  Alguns sistemas n√£o podem ser usados ‚Äã‚Äãsem entrar no carro em modos operacionais especiais.  Tivemos que estudar esses e outros detalhes no processo. <br><br><h4>  Dire√ß√£o assistida el√©trica </h4><br>  Dire√ß√£o assistida el√©trica O EPS (Dire√ß√£o assistida el√©trica) √© um sistema projetado para reduzir a for√ßa da dire√ß√£o ao girar (Fig. 3).  O prefixo "electro" fala sobre o tipo de sistema - el√©trico.  Dirigir o volante com este sistema se torna confort√°vel, o motorista gira o volante na dire√ß√£o certa e o motor el√©trico ajuda a gir√°-lo no √¢ngulo desejado. <br><br>  Um amplificador de pot√™ncia el√©trica √© instalado no eixo de dire√ß√£o de um carro, cujas partes s√£o interconectadas por um eixo de tor√ß√£o.  Um sensor de torque (Sensor de torque) √© montado no eixo de tor√ß√£o.  Quando o volante gira, o eixo de tor√ß√£o torce, o que √© registrado pelo sensor de torque.  Os dados recebidos do sensor de torque, dos sensores de velocidade e das rota√ß√µes do virabrequim s√£o enviados √† unidade de controle eletr√¥nico da ECU.  E a ECU, por sua vez, j√° calcula a for√ßa de compensa√ß√£o necess√°ria e d√° um comando ao motor el√©trico do amplificador. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b7/b45/063/5b7b4506386956bd872df48432858d8c.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>3. Diagrama esquem√°tico do sistema de dire√ß√£o hidr√°ulica</i> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Fkgp64e-nNQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>V√≠deo: O sistema LKA dirige um carro usando o sistema EPS.</i> <br><br><h4>  Pedal eletr√¥nico </h4><br>  O acelerador √© um mecanismo para ajustar a quantidade de mistura de combust√≠vel que cair√° no motor.  Quanto mais mistura fica, mais r√°pido o carro passa. <br>  O pedal do acelerador eletr√¥nico √© um sistema que envolve a opera√ß√£o de v√°rios componentes eletr√¥nicos.  O sinal sobre a posi√ß√£o do pedal, quando pressionado, entra na unidade de controle do motor ECM (M√≥dulo de Controle do Motor).  O ECM, com base nesse sinal, calcula a quantidade necess√°ria de combust√≠vel que deve ser fornecida ao motor.  Dependendo da quantidade de combust√≠vel necess√°ria, o ECM ajusta o √¢ngulo de abertura do acelerador. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e8/16b/a1b/6e816ba1b6d687c9849321d8aac3f431.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>4. O sistema eletr√¥nico de pedal do acelerador.</i> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/98brdhB3n04" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>V√≠deo: O pedal eletr√¥nico do acelerador √© usado para operar o controle de cruzeiro.</i> <br><br><h4>  Sistemas eletr√¥nicos de assist√™ncia ao motorista </h4><br>  Compramos um carro equipado com uma variedade de unidades digitais e sistemas de assist√™ncia ao motorista (ADAS).  Em nosso projeto, usamos LKA, ACC e PCS. <br><br>  O LKA (Lane Keep Assist) √© um sistema de reten√ß√£o de tira que consiste em uma c√¢mera frontal e uma unidade de computa√ß√£o.  O LKA mant√©m o carro na pista quando o motorista, por exemplo, est√° distra√≠do.  Os algoritmos na unidade de computa√ß√£o recebem dados da c√¢mera e, com base neles, tomam uma decis√£o sobre as condi√ß√µes do carro na estrada.  O sistema √© capaz de entender que o carro est√° se movendo incontrolavelmente em dire√ß√£o √† faixa direita ou esquerda.  Nesses casos, um bipe soa para atrair a aten√ß√£o do motorista.  Ao atravessar a pista, o pr√≥prio sistema ajustar√° o √¢ngulo de rota√ß√£o das rodas para que o carro permane√ßa na pista.  O sistema s√≥ deve intervir se perceber que a manobra entre as faixas n√£o foi causada pelo motorista. <br><br>  ACC (Adaptive Cruise Control) - um sistema de controle de cruzeiro adapt√°vel que permite definir a velocidade desejada.  O carro em si acelera e diminui a velocidade para manter a velocidade desejada, enquanto o motorista pode retirar o p√© dos pedais do acelerador e do freio.  Este modo √© conveniente de usar ao dirigir em rodovias e rodovias.  O controle de cruzeiro adapt√°vel √© capaz de ver obst√°culos na frente do carro e diminuir a velocidade para evitar colis√£o com eles.  Se outro ve√≠culo a uma velocidade menor avan√ßar, o ACC diminuir√° a velocidade e seguir√°.  Quando um objeto est√°tico √© detectado, o ACC fica mais lento at√© parar.  Para detectar objetos na frente do carro, esse sistema usa um radar com um alcance de comprimento de onda milim√©trico.  Normalmente, esses radares operam a uma frequ√™ncia de 24 a 72 GHz e s√£o capazes de ver objetos com confian√ßa a uma dist√¢ncia de 300 metros.  O radar √© geralmente instalado atr√°s do crach√° frontal na grade. <br><br>  PCS (Sistema de Pr√©-Colis√£o) - sistema de preven√ß√£o de colis√µes.  O sistema foi projetado para evitar uma colis√£o com um carro que est√° se movendo na frente.  Quando uma colis√£o √© inevit√°vel, o sistema minimiza os danos √† colis√£o.  Ele tamb√©m usa radar para estimar a dist√¢ncia do objeto e uma c√¢mera frontal para seu reconhecimento.  A frente do PCS prev√™ a probabilidade de uma colis√£o com base na velocidade do ve√≠culo, dist√¢ncia do objeto e sua velocidade.  Normalmente, um sistema possui dois est√°gios de opera√ß√£o.  A primeira etapa - o sistema soa e √© exibido no painel notificando o motorista do perigo.  O segundo est√°gio - a frenagem de emerg√™ncia √© ativada usando o sistema ABS e os pr√©-tensores do cinto de seguran√ßa s√£o ativados. <br><br><h3>  Parte pr√°tica </h3><br><h4>  Volante </h4><br>  A primeira coisa que nossa equipe queria fazer foi aprender a dirigir.  O volante de um carro pode ser controlado por dois sistemas: assistente de estacionamento IPAS (Intelligent Park Assist) e LKA. <br><br>  O IPAS permite definir o √¢ngulo da dire√ß√£o em graus diretamente.  Como nosso carro n√£o possui esse sistema, √© imposs√≠vel verificar e controlar a dire√ß√£o dessa maneira. <br><br>  Portanto, estudamos os circuitos el√©tricos do carro e descobrimos quais barramentos CAN poderiam ser √∫teis.  Conectamos um analisador de barramento CAN.  O log cont√©m um arquivo de registros de mensagens no barramento em sequ√™ncia cronol√≥gica.  Nossa tarefa era encontrar equipes de dire√ß√£o hidr√°ulica EPS (Dire√ß√£o El√©trica).  Pegamos o registro do volante de um lado para o outro; no registro, encontramos as leituras do √¢ngulo de rota√ß√£o e a velocidade de rota√ß√£o do volante.  Abaixo est√° um exemplo de altera√ß√£o de dados no barramento CAN.  Os dados de interesse para n√≥s s√£o destacados com um marcador. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e9e/2ff/eee/e9e2ffeee019069421b869be9fb6d6d4.gif" alt="imagem"><br>  <i>Dire√ß√£o de 360 ‚Äã‚Äãgraus √† esquerda</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3b5/259/583/3b5259583320120b011d47f3c4517dd8.gif" alt="imagem"><br>  <i>Gire o volante 270 graus para a direita</i> <br><br>  Na pr√≥xima etapa, examinamos o sistema de reten√ß√£o de faixas.  Para isso, fomos a uma rua tranq√ºila e registramos os registros de troca entre a unidade de manuten√ß√£o da pista e a DSU (Driving Support ECU).  Usando o analisador de barramento CAN, conseguimos calcular as mensagens do sistema LKA.  A Figura 6 mostra o comando de controle EPS. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/76f/2a7/159/76f2a7159e1b5b36232ae0702079af45.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>5. Comando de dire√ß√£o usando o sistema LKA</i> <br><br>  O LKA controla o volante, definindo o valor do torque no eixo (STEER_TORQUE_CMD) do volante.  O comando √© aceito pelo m√≥dulo EPS.  Cada mensagem cont√©m um valor de contador (COUNTER) no cabe√ßalho, que √© incrementado a cada envio.  O campo LKA_STATE cont√©m informa√ß√µes de status do LKA.  Para capturar o controle, voc√™ deve definir o bit STEER_REQUEST. <br><br>  As mensagens respons√°veis ‚Äã‚Äãpela opera√ß√£o de sistemas autom√°ticos importantes s√£o protegidas por uma soma de verifica√ß√£o (CHECKSUM) para minimizar os riscos de alarmes falsos.  O carro ignorar√° esse comando se a mensagem contiver uma soma de verifica√ß√£o ou valor do contador incorreto.  Essa √© uma prote√ß√£o criada pelo fabricante contra interfer√™ncia de sistema de terceiros e interfer√™ncia na linha de comunica√ß√£o. <br><br>  O gr√°fico (Fig. 6.) mostra o diagrama de opera√ß√£o do LKA.  Sensor de torque - valor do sensor de torque no eixo de tor√ß√£o.  O Torque Cmd √© uma equipe do LKA para a dire√ß√£o.  A imagem mostra como o LKA √© direcionado para segurar o carro na pista.  Ao atravessar o zero, o sentido de rota√ß√£o do volante muda.  I.e.  um sinal negativo indica uma curva para a direita, um valor positivo para a esquerda.  Manter o comando em zero indica falta de controle do LKA.  Com a interven√ß√£o do motorista, o sistema deixa de emitir controle.  O LKA detecta a interven√ß√£o do motorista com um segundo sensor de torque no eixo do lado do volante. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ac/562/2c8/2ac5622c84943c61207d0ac0c17a20fa.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>6. Cronograma do sistema LKA</i> <br><br>  Tivemos que verificar o trabalho da equipe de dire√ß√£o.  Usando o m√≥dulo StarLine Sigma 10, preparamos o firmware para o teste de controle.  O StarLine Sigma 10 deve emitir comandos no volante para girar o volante para a esquerda ou direita.  Naquela √©poca, n√£o t√≠nhamos uma interface gr√°fica para controlar o m√≥dulo, ent√£o tivemos que usar os meios padr√£o do carro.  Encontramos o status da posi√ß√£o da alavanca de controle de cruzeiro no barramento CAN e programamos o m√≥dulo de modo que a posi√ß√£o superior da alavanca levasse o volante a girar para a direita, a posi√ß√£o inferior - a girar para a esquerda (Fig. 7). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/147/82e/068/14782e068fe5ac6bc3636603d2113cee.gif" alt="imagem"><br>  <i>Fig.</i>  <i>7. As primeiras tentativas de dirigir</i> <br><br>  O v√≠deo mostra que o controle √© realizado em se√ß√µes curtas.  Isso ocorre por v√°rios motivos. <br><br>  A primeira raz√£o √© a falta de feedback.  Se a discrep√¢ncia entre o sinal Torque Cmd e o sensor de torque exceder um determinado valor Œî, o sistema para automaticamente de aceitar comandos (Fig. 8).  Definimos o algoritmo para ajustar o comando de sa√≠da (Torque CMD), dependendo do valor do torque no eixo (Torque Sensor). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3bd/ff5/458/3bdff5458f46a6de9f48598a735db625.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>8. Discrep√¢ncia de sinal leva a erro no sistema</i> <br><br>  A restri√ß√£o a seguir est√° relacionada ao sistema de seguran√ßa incorporado no EPS.  O sistema EPS n√£o permite que as equipes da LKA conduzam uma ampla variedade.  O que √© bastante l√≥gico, porque  ao dirigir na estrada, manobras repentinas n√£o s√£o seguras.  Assim, quando o valor limite do torque no eixo √© excedido, o sistema LKA gera um erro e desliga (Fig. 9). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/360/888/015/3608880153b575b2874efd8db45fe7f8.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>9. Exceder o valor limite do controle de torque no eixo</i> <br><br>  Independentemente de o sistema LKA estar ativado ou n√£o, mensagens com comandos dele est√£o constantemente presentes no barramento.  Instru√≠mos o m√≥dulo EPS a girar as rodas com uma for√ßa espec√≠fica para a esquerda ou direita.  Enquanto isso, o LKA interrompe nossos pacotes com mensagens "vazias".  Depois de nossa equipe com o valor do momento, o padr√£o vem com zero (Fig. 10). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c0a/85b/1a9/c0a85b1a9ad409684dbcb740acfd18ed.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>10. Mensagens regulares v√™m com valores de momento zero e interrompem nosso controle</i> <br><br>  Em seguida, usando o m√≥dulo StarLine Sigma 10, conseguimos filtrar todo o tr√°fego do LKA e bloquear mensagens com o ID 2E4 quando necess√°rio.  Isso resolveu o problema e conseguimos obter um controle de dire√ß√£o suave (Fig. 11). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/712/6ab/cff/7126abcff6446d6a6477c667880747a7.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>11. Ajuste suave do volante sem erros</i> <br><br><h4>  Gerenciamento de g√°s </h4><br>  O sistema ACC Adaptive Cruise Control controla o software de acelera√ß√£o e frenagem atrav√©s do barramento CAN.  A unidade de controle do motor da ECU recebe comandos DSU; se voc√™ precisar acelerar, ativa o pedal do acelerador eletr√¥nico.  A frenagem regenerativa √© usada para frear o carro.  Nesse caso, um comando √© usado para frenagem e acelera√ß√£o, apenas os valores diferem. <br><br>  O comando de controle de acelera√ß√£o ou desacelera√ß√£o √© mostrado na Figura 12. Ele consiste no valor de acelera√ß√£o ACCEL_CMD, um par de bits de sobrecarga e uma soma de verifica√ß√£o de soma de verifica√ß√£o.  Para a acelera√ß√£o do ve√≠culo, ACCEL_CMD √© positivo; para a desacelera√ß√£o, negativo.  A acelera√ß√£o √© definida no intervalo de 0 a 3 m / s ^ 2, a desacelera√ß√£o √© semelhante, mas com um sinal de menos.  Para enviar dados para o barramento, √© necess√°rio recalcular a acelera√ß√£o ou desacelera√ß√£o desejada com um coeficiente de 0,001.  Por exemplo, para acelerar 1 m / s ^ 2, ACCEL_CMD = 1000 (0x03E8). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4fc/0a2/042/4fc0a20425a9718cb90eb40f4b5a127f.jpg" alt="imagem"><br>  <i>Fig.</i>  <i>12. O comando para controlar a acelera√ß√£o / desacelera√ß√£o do carro</i> <br><br>  Removemos os logs do sistema ACC padr√£o e analisamos as equipes.  Comparado com a nossa descri√ß√£o das equipes e iniciado o teste. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f37/e3d/9a4/f37e3d9a42d8164a6b5e1f21c4fba704.gif" alt="imagem"><br>  <i>Fig.</i>  <i>13. Registro de acelera√ß√£o / desacelera√ß√£o do ACC Cruise Control adaptativo (real√ßado com um marcador)</i> <br><br>  N√£o foi sem dificuldades.  Dirigimos em uma estrada com tr√°fego intenso para testar a equipe de acelera√ß√£o.  Os comandos de controle de acelera√ß√£o ou desacelera√ß√£o do ve√≠culo funcionam apenas quando o controle de cruzeiro est√° ativado, n√£o √© suficiente ativ√°-lo com o bot√£o  √â necess√°rio encontrar o carro se movendo na frente e ativar o seguinte modo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9e0/4eb/012/9e04eb01233c579da82c01d623c05c40.gif" alt="imagem"><br>  <i>Fig.</i>  <i>14. A ativa√ß√£o do controle de cruzeiro ocorre quando h√° outro ve√≠culo √† frente</i> <br><br>  Usando o m√≥dulo StarLine Sigma 10, enviamos um comando de acelera√ß√£o e o carro come√ßa a ganhar velocidade.  Nesse ponto, conectamos a interface gr√°fica para controlar o m√≥dulo StarLine Sigma 10. Agora controlamos o volante, a acelera√ß√£o e a frenagem usando os bot√µes do aplicativo. <br><br>  As equipes trabalharam at√© perder o carro √† frente.  O sistema de controle de cruzeiro foi desligado e, portanto, os comandos de acelera√ß√£o pararam de funcionar. <br>  Come√ßamos a estudar a possibilidade de usar equipes sem controle de cruzeiro ativo.  Eu tive que gastar muito tempo analisando os dados no barramento CAN para entender como criar as condi√ß√µes para as equipes trabalharem.  Em primeiro lugar, est√°vamos interessados ‚Äã‚Äãem qual bloco bloqueia a execu√ß√£o de comandos do ACC para acelera√ß√£o ou desacelera√ß√£o.  Eu tive que estudar quais IDs v√™m do DSU, LKA, radar e c√¢mera, afastar os dados falsos de v√°rios sensores. <br><br>  A decis√£o veio tr√™s semanas depois.  Naquela √©poca, t√≠nhamos uma id√©ia de como os blocos do carro interagem, realizamos um estudo do tr√°fego de mensagens e identificamos grupos de mensagens enviadas por cada bloco.  O ECU de Suporte √† Dire√ß√£o (DSU) √© respons√°vel pelo controle de cruzeiro adaptativo ACC.  O DSU emite comandos para acelerar e desacelerar o carro, e √© essa unidade que recebe dados do radar de alcance milim√©trico.  O radar indica ao DSU a que dist√¢ncia da m√°quina o objeto est√° se movendo, a que velocidade relativa e determina sua posi√ß√£o horizontal (√† esquerda, direita ou centro). <br><br>  Nossa id√©ia era substituir os dados do radar.  Removemos o registro para seguir o carro e retiramos os dados do radar no momento seguinte.  Agora, depois de ativar o controle de cruzeiro, enviamos dados falsos sobre a presen√ßa de um carro na frente.  Acontece que enganamos nosso carro, dizendo que outro carro na frente se move a uma dist√¢ncia espec√≠fica. <br><br>  a) <img src="https://habrastorage.org/getpro/habr/post_images/18e/762/ed2/18e762ed2cf1f72b3240fe1bc3647048.gif" alt="imagem">  b) <img src="https://habrastorage.org/getpro/habr/post_images/be9/c16/276/be9c162764819ce5e0f733c67506ac4d.gif" alt="imagem"><br>  <i>Fig.</i>  <i>15. Ativa√ß√£o de cruzeiro: a) tentativa de ativar sem substituir os dados do radar;</i>  <i>b) ativa√ß√£o ao substituir dados do radar.</i> <br><br>  Quando come√ßamos nosso obst√°culo, no painel o √≠cone de presen√ßa do ve√≠culo na frente fica aceso.  Agora podemos testar nossa administra√ß√£o.  Iniciamos o comando de acelera√ß√£o e o carro come√ßa a acelerar rapidamente. <br><br>  Como j√° aprendemos, o comando de acelera√ß√£o e desacelera√ß√£o √© um.  Portanto, eles imediatamente verificaram a desacelera√ß√£o.  Fomos a velocidade com o controle de cruzeiro ativo, lan√ßamos um comando de frenagem e o carro diminuiu a velocidade imediatamente. <br><br>  Como resultado, agora ele acelera e desacelera o carro exatamente como precis√°vamos. <br><br>  O objetivo √© alcan√ßado. <br><br><h4>  O que mais usamos </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para criar um drone, √© necess√°rio controlar sistemas auxiliares: piscas, luzes de freio, alarmes, buzina, etc. Tudo isso tamb√©m pode ser controlado atrav√©s do barramento CAN. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hardware e software </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para trabalhar com o carro hoje, usamos um conjunto de v√°rios equipamentos: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Marathon Bus Analyzer permite conectar e ler dados de dois barramentos simultaneamente. </font><font style="vertical-align: inherit;">O site do fabricante do analisador possui um software de an√°lise de log gratuito. </font><font style="vertical-align: inherit;">Mas usamos software escrito em nossa empresa para uso interno.</font></font></li><li>  StarLine  10         .   CAN  LIN .       C,       .       CAN-.    ,  ID         . </li><li>   Toyota/Lexus.          : , -, ,  . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hoje, est√° em andamento um trabalho ativo para desenvolver um ve√≠culo n√£o tripulado, em um futuro pr√≥ximo, a implementa√ß√£o da frenagem de emerg√™ncia diante de obst√°culos, seu desvio e a reestrutura√ß√£o da rota do carro, dependendo da situa√ß√£o do tr√°fego e das instru√ß√µes do motorista. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O ve√≠culo n√£o tripulado StarLine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© uma plataforma aberta para combinar as melhores mentes de engenharia da R√∫ssia e do mundo com o objetivo de criar tecnologias avan√ßadas de dire√ß√£o n√£o tripulada que tornar√£o nosso futuro seguro e confort√°vel. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projeto Gitlab</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt450140/">https://habr.com/ru/post/pt450140/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt450130/index.html">As equipes sobrevivem ap√≥s o hackathon?</a></li>
<li><a href="../pt450132/index.html">N√£o foi poss√≠vel explicar a m√¥nada</a></li>
<li><a href="../pt450134/index.html">A segunda vida de an√©is e broches: como recriar rapidamente j√≥ias usando a tecnologia 3D</a></li>
<li><a href="../pt450136/index.html">Quando as paredes n√£o s√£o suficientes. Como proteger pontos de extremidade</a></li>
<li><a href="../pt450138/index.html">Product Management Digest # 7 (mar√ßo a abril de 2019)</a></li>
<li><a href="../pt450142/index.html">Em maio: ordenou - para sobreviver</a></li>
<li><a href="../pt450144/index.html">Como as novas tecnologias aproximam o sonho da imortalidade?</a></li>
<li><a href="../pt450146/index.html">Meu erro de bilh√£o de d√≥lares</a></li>
<li><a href="../pt450148/index.html">Um Veeam ONE. Intelig√™ncia, mapas, agentes e muito mais - hoje nos monitores do pa√≠s</a></li>
<li><a href="../pt450150/index.html">Semana 18 de seguran√ßa: ataque do ShadowHammer em detalhes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>