<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôáüèø ü§ì üë©üèΩ‚Äçüéì Quais erros est√£o ocultos no c√≥digo Infer.NET? üéâ ü§õ üö©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A publica√ß√£o do c√≥digo fonte da Microsoft para seus projetos √© um bom motivo para verific√°-los. Desta vez n√£o foi excep√ß√£o, e hoje analisamos os locai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Quais erros est√£o ocultos no c√≥digo Infer.NET?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/429578/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d3f/18a/6a6/d3f18a6a6127aceeae10d53591e0ce65.png"></div><br>  A publica√ß√£o do c√≥digo fonte da Microsoft para seus projetos √© um bom motivo para verific√°-los.  Desta vez n√£o foi excep√ß√£o, e hoje analisamos os locais suspeitos encontrados no c√≥digo Infer.NET.  Abaixo a anota√ß√£o - v√° direto ao ponto! <br><a name="habracut"></a><br><h2>  Um pouco sobre o projeto e o analisador </h2><br>  O Infer.NET √© um sistema de aprendizado de m√°quina desenvolvido por especialistas da Microsoft.  O c√≥digo fonte do projeto ficou recentemente dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> , que foi o motivo da sua verifica√ß√£o.  Mais detalhes sobre o projeto podem ser encontrados, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  O projeto foi verificado usando o analisador est√°tico PVS-Studio vers√£o 6.26.  Deixe-me lembr√°-lo de que o PVS-Studio est√° procurando erros no c√≥digo em C \ C ++ \ C # (e logo em Java) no Windows, Linux, macOS.  No momento, o c√≥digo C # est√° sendo analisado apenas no Windows.  O analisador pode ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">baixado e testado</a> em seu projeto. <br><br>  O cheque em si era extremamente simples e sem problemas.  Anteriormente, descarreguei o projeto do GitHub, restaurei os pacotes necess√°rios (depend√™ncias) e verifiquei se o projeto foi constru√≠do com √™xito.  Isso √© necess√°rio para que o analisador tenha acesso a todas as informa√ß√µes necess√°rias para uma an√°lise completa.  Ap√≥s reunir alguns cliques, lancei a an√°lise da solu√ß√£o por meio do plug-in PVS-Studio para Visual Studio. <br><br>  A prop√≥sito, este n√£o √© o primeiro projeto da Microsoft testado usando o PVS-Studio - havia outros: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Roslyn</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MSBuild</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PowerShell</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CoreFX</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">outros</a> . <br><br>  <b>Nota</b>  Se voc√™ ou seus conhecidos estiverem interessados ‚Äã‚Äãem analisar o c√≥digo Java, escreva-nos para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">suporte</a> selecionando ‚ÄúQuero um analisador para Java‚Äù.  N√£o existe uma vers√£o beta p√∫blica do analisador, mas ela dever√° estar dispon√≠vel em breve.  Em algum lugar de um laborat√≥rio secreto (atrav√©s da parede), os caras est√£o trabalhando ativamente nele. <br><br>  Mas chega de conversa abstrata - vamos ver os problemas no c√≥digo. <br><br><h2>  Isso √© um bug ou um recurso? </h2><br>  Sugiro tentar encontrar o erro voc√™ mesmo - uma tarefa completamente solucion√°vel.  N√£o h√° brincadeiras no esp√≠rito do que estava no artigo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Os 10 principais erros nos projetos C ++ para 2017</a> ", honestamente.  Portanto, n√£o se apresse em ler o aviso do analisador fornecido ap√≥s o trecho de c√≥digo. <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MergeParallelTransitions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( transition1.DestinationStateIndex == transition2.DestinationStateIndex &amp;&amp; transition1.Group == transition2.Group) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (transition1.IsEpsilon &amp;&amp; transition2.IsEpsilon) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!transition1.IsEpsilon &amp;&amp; !transition2.IsEpsilon) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.IsInfinity(transition1.Weight.Value) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.IsInfinity(transition1.Weight.Value)) { newElementDistribution.SetToSum( <span class="hljs-number"><span class="hljs-number">1.0</span></span>, transition1.ElementDistribution, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, transition2.ElementDistribution); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { newElementDistribution.SetToSum( transition1.Weight.Value, transition1.ElementDistribution, transition2.Weight.Value, transition2.ElementDistribution); } .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3001</a> Existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">subexpress√µes</a> id√™nticas 'double.IsInfinity (transit1.Weight.Value)' √† esquerda e √† direita do operador '&amp;&amp;'.  Runtime Automaton.Simplification.cs 479 <br><br>  Como voc√™ pode ver no snippet de c√≥digo, o m√©todo est√° trabalhando com um par de vari√°veis ‚Äã‚Äã- <i>transi√ß√£o1</i> e <i>transi√ß√£o2</i> .  O uso de nomes semelhantes √†s vezes √© bastante justificado, mas vale lembrar que, neste caso, a probabilidade de cometer um erro acidental em algum lugar com o nome aumenta. <br><br>  Foi o <i>que</i> aconteceu ao verificar os n√∫meros para o infinito ( <i>double.IsInfinity</i> ).  Devido a um erro, verificamos o valor da mesma vari√°vel 2 vezes - <i>transi√ß√£o1.Peso.Valor</i> .  O valor verificado na segunda subexpress√£o deveria ser a vari√°vel <i>transit2.Weight.Value</i> . <br><br>  Outro c√≥digo suspeito semelhante. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> MethodBase </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToMethodInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IMethodReference imr</span></span></span><span class="hljs-function">)</span></span> { .... bf |= BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance; .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3001</a> Existem sub-express√µes id√™nticas 'BindingFlags.Public' √† esquerda e √† direita da '|'  operador.  Compilador CodeBuilder.cs 194 <br><br>  Ao formar o valor da vari√°vel <i>bf</i> , o elemento de enumera√ß√£o <i>BindingFlags.Public</i> √© usado duas vezes.  Esse c√≥digo cont√©m uma opera√ß√£o de sinaliza√ß√£o extra ou, em vez do segundo uso de <i>BindingFlags.Public,</i> deve haver um valor de enumera√ß√£o diferente. <br><br>  A prop√≥sito, no c√≥digo-fonte, esse c√≥digo √© escrito em uma linha.  Parece-me que, se estiver formatado no estilo de tabela (como aqui), o problema √© mais f√°cil de detectar. <br><br>  Vamos seguir em frente.  Trago todo o corpo do m√©todo e, novamente, sugiro que voc√™ encontre o erro (ou talvez o erro). <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForEachPrefix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IExpression expr, Action&lt;IExpression&gt; action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// This method must be kept consistent with GetTargets. if (expr is IArrayIndexerExpression) ForEachPrefix(((IArrayIndexerExpression)expr).Target, action); else if (expr is IAddressOutExpression) ForEachPrefix(((IAddressOutExpression)expr).Expression, action); else if (expr is IPropertyReferenceExpression) ForEachPrefix(((IPropertyReferenceExpression)expr).Target, action); else if (expr is IFieldReferenceExpression) { IExpression target = ((IFieldReferenceExpression)expr).Target; if (!(target is IThisReferenceExpression)) ForEachPrefix(target, action); } else if (expr is ICastExpression) ForEachPrefix(((ICastExpression)expr).Expression, action); else if (expr is IPropertyIndexerExpression) ForEachPrefix(((IPropertyIndexerExpression)expr).Target, action); else if (expr is IEventReferenceExpression) ForEachPrefix(((IEventReferenceExpression)expr).Target, action); else if (expr is IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); else if (expr is IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); else if (expr is IMethodInvokeExpression) ForEachPrefix(((IMethodInvokeExpression)expr).Method, action); else if (expr is IMethodReferenceExpression) ForEachPrefix(((IMethodReferenceExpression)expr).Target, action); else if (expr is IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); else if (expr is IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); else if (expr is IDelegateInvokeExpression) ForEachPrefix(((IDelegateInvokeExpression)expr).Target, action); action(expr); }</span></span></code> </pre> <br>  Voc√™ encontrou?  Estamos verificando! <br><br>  <b>Avisos do PVS-Studio</b> : <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3003</a> O uso do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">padr√£o</a> 'if (A) {...} else if (A) {...}' foi detectado.  H√° uma probabilidade de presen√ßa de erro l√≥gico.  Verifique as linhas: 1719, 1727. Compilador CodeRecognizer.cs 1719 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3003</a> O uso do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">padr√£o</a> 'if (A) {...} else if (A) {...}' foi detectado.  H√° uma probabilidade de presen√ßa de erro l√≥gico.  Verifique as linhas: 1721, 1729. Compilador CodeRecognizer.cs 1721 </li></ul><br>  Simplifique um pouco o c√≥digo para tornar os problemas mais √≥bvios. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForEachPrefix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IExpression expr, Action&lt;IExpression&gt; action</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action); .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IUnaryExpression) ForEachPrefix(((IUnaryExpression)expr).Expression, action); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expr <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IAddressReferenceExpression) ForEachPrefix(((IAddressReferenceExpression)expr).Expression, action) .... }</code> </pre> <br>  Express√µes condicionais e ramifica√ß√µes de v√°rias <i>instru√ß√µes if se</i> duplicadas.  Talvez esse c√≥digo tenha sido escrito usando o m√©todo copiar e colar, e √© por isso que o problema surgiu.  Agora acontece que os ramos das duplicatas nunca ser√£o executados, pois: <br><br><ul><li>  se a express√£o condicional for verdadeira, o corpo da primeira <i>instru√ß√£o if</i> do par correspondente ser√° executada; </li><li>  se a express√£o condicional for falsa no primeiro caso, ser√° falsa no segundo. </li></ul><br>  Como os ramos cont√™m as mesmas a√ß√µes, agora parece um c√≥digo redundante que √© confuso.  √â poss√≠vel que este seja um tipo diferente de problema - em vez de tomadas, outras verifica√ß√µes deveriam ter sido realizadas. <br><br>  N√≥s continuamos. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compare</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Pair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; x, Pair&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x.First &lt; y.First) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x.Second &gt;= y.Second) { <span class="hljs-comment"><span class="hljs-comment">// y strictly contains x return 1; } else { // No containment - order by left bound return 1; } } else if (x.First &gt; y.First) { if (x.Second &lt;= y.Second) { // x strictly contains y return -1; } else { // No containment - order by left bound return -1; } } .... }</span></span></code> </pre> <br>  <b>Avisos do PVS-Studio</b> : <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3004</a> A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instru√ß√£o</a> 'then' √© equivalente √† instru√ß√£o 'else'.  Tempo de execu√ß√£o RegexpTreeBuilder.cs 1080 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3004</a> A <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instru√ß√£o</a> 'then' √© equivalente √† instru√ß√£o 'else'.  Tempo de execu√ß√£o RegexpTreeBuilder.cs 1093 </li></ul><br>  O c√≥digo parece extremamente suspeito, pois cont√©m duas instru√ß√µes condicionais com corpos id√™nticos dos ramos <i>then</i> e <i>else</i> .  Nos dois casos, provavelmente vale a pena retornar valores diferentes.  Ou, se esse for um comportamento concebido, ser√° √∫til remover instru√ß√µes condicionais redundantes. <br><br>  Houve ciclos interessantes.  Exemplo abaixo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Set&lt;StochasticityPattern&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntersectPatterns</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;StochasticityPattern&gt; patterns</span></span></span><span class="hljs-function">)</span></span> { Set&lt;StochasticityPattern&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Set&lt;StochasticityPattern&gt;(); result.AddRange(patterns); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> changed; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = result.Count; AddIntersections(result); changed = (result.Count != count); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (changed); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3020</a> Uma 'interrup√ß√£o' incondicional dentro de um loop.  Compilador DefaultFactorManager.cs 474 <br><br>  Devido √† instru√ß√£o incondicional de <i>interrup√ß√£o</i> , exatamente uma itera√ß√£o do loop √© executada e a vari√°vel de controle <i>alterada</i> nem √© usada.  Em geral, o c√≥digo parece estranho e suspeito. <br><br>  O mesmo m√©todo (c√≥pia exata) foi encontrado em outra classe.  Aviso correspondente do analisador: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3020</a> Uma 'quebra' incondicional dentro de um loop.  Visualizers.Windows FactorManagerView.cs 350 <br><br>  A prop√≥sito, um m√©todo encontrou uma declara√ß√£o <i>continue</i> incondicional em um loop (foi encontrada pelo analisador com o mesmo diagn√≥stico), mas houve um coment√°rio acima confirmando que esta √© uma solu√ß√£o tempor√°ria especial: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// TEMPORARY continue;</span></span></code> </pre> <br>  Lembro-me de que n√£o houve tais coment√°rios perto da declara√ß√£o de <i>quebra</i> incondicional. <br><br>  Vamos seguir em frente. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> DependencyInformation </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDependencyInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... IExpression resultIndex = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultIndex != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parameter.IsDefined( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(SkipIfMatchingIndexIsUniformAttribute), <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resultIndex == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InferCompilerException( parameter.Name + <span class="hljs-string"><span class="hljs-string">" has SkipIfMatchingIndexIsUniformAttribute but "</span></span> + StringUtil.MethodNameToString(method) + <span class="hljs-string"><span class="hljs-string">" has no resultIndex parameter"</span></span>); .... } .... } .... }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aviso do</a> <b>PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A</a> express√£o V3022 'resultIndex == null' √© sempre falsa.  Compiler FactorManager.cs 382 <br><br>  Imediatamente, observo que entre a declara√ß√£o e a verifica√ß√£o acima, o valor da vari√°vel <i>resultIndex</i> pode mudar.  No entanto, entre as verifica√ß√µes <i>resultIndex! = Null</i> e <i>resultIndex == null, o</i> valor j√° n√£o pode ser alterado.  Portanto, o resultado da express√£o <i>resultIndex == null</i> sempre ser√° <i>falso</i> , o que significa que uma exce√ß√£o nunca ser√° lan√ßada. <br><br>  Espero que voc√™ tenha interesse em encontrar erros, sem as minhas sugest√µes, para encontrar um problema, mas, apenas no caso, proponho faz√™-lo novamente.  O c√≥digo do m√©todo √© pequeno, eu darei na √≠ntegra. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Tuple&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeMovieGenre</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> feature</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] genres = feature.Split(<span class="hljs-string"><span class="hljs-string">'|'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (genres.Length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; genres.Length &gt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Movies should have between 1 and 3 genres; given {0}."</span></span>, genres.Length)); } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / genres.Length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder( <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"{0}:{1}"</span></span>, offset + MovieGenreBuckets[genres[<span class="hljs-number"><span class="hljs-number">0</span></span>]], <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; genres.Length; ++i) { result.Append( <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"|{0}:{1}"</span></span>, offset + MovieGenreBuckets[genres[i].Trim()], <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tuple&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(MovieGenreBucketCount, result.ToString()); }</code> </pre> <br>  Vamos ver o que acontece aqui.  A sequ√™ncia de entrada √© analisada pelo caractere '|'.  Se o comprimento da matriz n√£o for o esperado, uma exce√ß√£o dever√° ser lan√ßada.  <i>Espere um segundo</i> ... <i>g√™neros.Comprimento &lt;1 e&amp; g√™neros.Comprimento&gt; 3</i> ?  Como n√£o h√° n√∫mero que caia imediatamente no intervalo de valores exigido pela express√£o ( <i>[int.MinValue..1)</i> e <i>(3..int.MaxValue]</i> ), o resultado da express√£o sempre ser√° <i>falso</i> .  Portanto, essa verifica√ß√£o n√£o protege contra nada e a exce√ß√£o esperada n√£o ser√° lan√ßada. <br><br>  √â exatamente isso que o analisador adverte: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3022 A</a> express√£o 'genres.Length &lt;1 &amp;&amp; genres.Length&gt; 3' √© sempre falsa.  Provavelmente o '||'  operador deve ser usado aqui.  Recursos do avaliador.cs 242 <br><br>  Opera√ß√£o de fiss√£o suspeita atendida. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateTrueThetaAndPhi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expectedRepeatOfTopicInDoc = averageDocLength / numUniqueTopicsPerDoc; .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cnt = Poisson.Sample(expectedRepeatOfTopicInDoc); .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3041</a> A express√£o foi convertida implicitamente do tipo 'int' para o tipo 'double'.  Considere utilizar uma convers√£o de tipo expl√≠cita para evitar a perda de uma parte fracion√°ria.  Um exemplo: double A = (double) (X) / Y;  LDA Utilities.cs 74 <br><br>  Isso √© suspeito aqui: a divis√£o inteira √© executada (as vari√°veis <i>averageDocLength</i> e <i>numUniqueTopicsPerDoc</i> s√£o do tipo <i>int</i> ) e o resultado √© gravado em uma vari√°vel do tipo <i>double</i> .  A pergunta √© impl√≠cita: isso foi feito especialmente ou ainda estava impl√≠cita a divis√£o de n√∫meros reais?  Se a vari√°vel <i>esperadoRepeatOfTopicInDoc</i> fosse do tipo <i>int</i> , isso esclareceria poss√≠veis perguntas. <br><br>  Em outros lugares, o m√©todo <i>Poisson.Sample</i> , cujo argumento √© a vari√°vel suspeita <i>expectRepeatOfTopicInDoc</i> , √© usado, por exemplo, conforme descrito abaixo. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numUniqueWordsPerTopic = Poisson.Sample((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)averageWordsPerTopic);</code> </pre> <br>  <i>averageWordsPerTopic</i> √© do tipo <i>int</i> , que j√° foi convertido para <i>dobrar</i> no local de uso. <br><br>  E aqui est√° outro local de uso: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> expectedRepeatOfWordInTopic = ((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)numDocs) * averageDocLength / numUniqueWordsPerTopic; .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cnt = Poisson.Sample(expectedRepeatOfWordInTopic);</code> </pre> <br>  Observe que as vari√°veis ‚Äã‚Äãt√™m os mesmos nomes que no exemplo original, apenas a divis√£o de n√∫meros reais √© usada para inicializar o <i>esperadoRepeatOfWordInTopic</i> (devido √† convers√£o expl√≠cita de <i>numDocs</i> para o <i>dobro</i> ). <br><br>  Em geral, vale a pena observar o ponto de partida em que o analisador emitiu um aviso. <br><br>  Mas reflex√µes sobre se vale a pena editar e como deixar os autores do c√≥digo (eles sabem melhor), mas vamos al√©m.  Para a pr√≥xima divis√£o suspeita. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NonconjugateGaussian </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BAverageLogarithm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v_opt = <span class="hljs-number"><span class="hljs-number">2</span></span> / <span class="hljs-number"><span class="hljs-number">3</span></span> * (Math.Log(mx * mz / Ex2 / <span class="hljs-number"><span class="hljs-number">2</span></span>) - m); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v_opt != v) { .... } .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3041</a> A express√£o foi convertida implicitamente do tipo 'int' para o tipo 'double'.  Considere utilizar uma convers√£o de tipo expl√≠cita para evitar a perda de uma parte fracion√°ria.  Um exemplo: double A = (double) (X) / Y;  Runtime ProductExp.cs 137 <br><br>  O analisador detectou novamente a opera√ß√£o suspeita da divis√£o inteira, como  <i>2</i> e <i>3</i> s√£o literais num√©ricos inteiros, e o resultado da express√£o 2/3 ser√° <i>0</i> .  Como resultado, toda a express√£o assume a forma: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v_opt = <span class="hljs-number"><span class="hljs-number">0</span></span> * expr;</code> </pre> <br>  Concordo, um pouco estranho.  V√°rias vezes voltei a esse aviso, tentando encontrar algum tipo de problema e n√£o tentando adicion√°-lo ao artigo.  O m√©todo est√° cheio de matem√°tica e v√°rias f√≥rmulas (que, francamente, eu realmente n√£o queria desmontar), voc√™ nunca sabe o que esperar.  Al√©m disso, tento ser o mais c√©tico poss√≠vel sobre os avisos que escrevo no artigo e os descrevo somente depois de estud√°-los melhor. <br><br>  Mas ent√£o me dei conta - por que preciso de um fator <i>0</i> , escrito como <i>2/3</i> ?  Portanto, este lugar vale uma olhada de qualquer maneira. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TextWriter writer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> defaultValue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Func&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; converter = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( defaultValue == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Equals(defaultValue)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> stringValue = converter == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.ToString() : converter(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); writer.Write(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string">=\"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{stringValue}</span></span></span><span class="hljs-string">\" "</span></span>); }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3080</a> Poss√≠vel desrefer√™ncia nula.  Considere inspecionar 'valor'.  Compilador WriteHelpers.cs 78 <br><br>  Afirma√ß√£o bastante justa do analisador com base na condi√ß√£o.  A desreferencia√ß√£o de uma refer√™ncia nula pode ocorrer na express√£o <i>value.Equals (defaultValue)</i> se <i>value == null</i> .  Como essa express√£o √© o operando direito do operador ||, para calcul√°-lo, o operando esquerdo deve ser <i>falso</i> e, para isso, basta que pelo menos uma das vari√°veis <i>defaultValue</i> \ <i>value</i> n√£o seja <i>nula</i> .  Como resultado, se <i>defaultValue! = Null</i> e <i>value == null</i> : <br><br><ul><li>  <i>defaultValue == null</i> -&gt; <i>false</i> ; </li><li>  <i>defaultValue == null &amp;&amp; value == null</i> -&gt; <i>false</i> ;  (verifica√ß√£o de <i>valor</i> n√£o ocorreu) </li><li>  <i>value.Equals (defaultValue)</i> -&gt; <i>NullReferenceException</i> , j√° que o <i>valor</i> √© <i>nulo</i> . </li></ul><br>  Vejamos um caso semelhante: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FeatureParameterDistribution</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> GaussianMatrix traitFeatureWeightDistribution, GaussianArray biasFeatureWeightDistribution</span></span></span><span class="hljs-function">)</span></span> { Debug.Assert( (traitFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; biasFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || traitFeatureWeightDistribution.All( w =&gt; w != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; w.Count == biasFeatureWeightDistribution.Count), <span class="hljs-string"><span class="hljs-string">"The provided distributions should be valid and consistent in the number of features."</span></span>); .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3080</a> Poss√≠vel desrefer√™ncia nula.  Considere inspecionar 'traitFeatureWeightDistribution'.  Recomendador FeatureParameterDistribution.cs 65 <br><br>  Jogamos fora o excesso, deixando apenas a l√≥gica para calcular valores booleanos, para que seja mais f√°cil descobrir: <br><br><pre> <code class="cs hljs">(traitFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; biasFeatureWeightDistribution == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || traitFeatureWeightDistribution.All( w =&gt; w != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; w.Count == biasFeatureWeightDistribution.Count)</code> </pre> <br>  Novamente, o operando certo do ||  √â calculado apenas se o resultado do c√°lculo esquerdo for <i>falso</i> .  O operando esquerdo pode ser <i>falso</i> , incluindo quando <i>traitFeatureWeightDistribution == null</i> e <i>biasFeatureWeightDistribution! = Null</i> .  Em seguida, o operando correto do operador || ser√° calculado e uma chamada para <i>traitFeatureWeightDistribution.All</i> gerar√° um <i>ArgumentNullException</i> . <br><br>  Outro peda√ßo interessante de c√≥digo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetQuantile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> probability, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] quantiles</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = quantiles.Length; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (quantiles == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(quantiles)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"quantiles array is empty"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(quantiles)); .... }</code> </pre> <br>  <b>Aviso do PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3095</a> O objeto 'quantiles' foi usado antes de ser verificado com rela√ß√£o a nulo.  Verifique as linhas: 91, 92. Runtime OuterQuantiles.cs 91 <br><br>  Observe que a propriedade <i>quantiles.Length</i> √© <i>acessada primeiro</i> e, em seguida, os <i>quantis s√£o</i> verificados quanto a <i>nulo</i> .  Como resultado, se <i>quantis == nulos</i> , o m√©todo lan√ßar√° uma exce√ß√£o, apenas um pouco errada e um pouco fora do local necess√°rio.  Aparentemente, eles estragaram as linhas em alguns lugares. <br><br>  Se voc√™ lidou com √™xito com a detec√ß√£o dos erros anteriores, sugiro que voc√™ prepare uma x√≠cara de caf√© e tente repetir o feito, encontrando o erro no m√©todo abaixo.  Para torn√°-lo um pouco mais interessante, cito todo o c√≥digo do m√©todo. <br><br>  ( <a href="">Link para tamanho real</a> ) <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c2c/5ff/2d9/c2c5ff2d99aca64bbda4136acfa4b1d4.png" alt="Quadro 2"></p><br><br>  Ok, ok, isso foi uma piada (ou voc√™ conseguiu?!).  Vamos simplificar um pouco a tarefa: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sample.Precision &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { precisionIsBetween = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; lowerBound = <span class="hljs-number"><span class="hljs-number">-1.0</span></span> / v; upperBound = -mean.Precision; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sample.Precision &lt; -mean.Precision) { precisionIsBetween = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; lowerBound = <span class="hljs-number"><span class="hljs-number">0</span></span>; upperBound = -mean.Precision; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// in this case, the precision should NOT be in this interval. precisionIsBetween = false; lowerBound = -mean.Precision; lowerBound = -1.0 / v; }</span></span></code> </pre> <br>  Melhorou?  O analisador emitiu o seguinte aviso para este c√≥digo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3008</a> A vari√°vel 'lowerBound' recebe valores duas vezes sucessivamente.  Talvez isso seja um erro.  Verifique as linhas: 324, 323. Tempo de execu√ß√£o GaussianOp.cs 324 <br><br>  De fato, na √∫ltima ramifica√ß√£o <i>else</i> , o valor da vari√°vel <i>lowerBound</i> √© atribu√≠do duas vezes seguidas.  Aparentemente (e a julgar pelo c√≥digo acima), a vari√°vel <i>upperBound</i> deve estar envolvida em uma das atribui√ß√µes. <br><br>  Seguimos adiante. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAucMatrix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span>; c &lt; classLabelCount; c++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> labelWidth = labels[c].Length; columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>] = labelWidth &gt; MaxLabelWidth ? MaxLabelWidth : labelWidth; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>; r &lt; classLabelCount; r++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> countWidth = MaxValueWidth; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (countWidth &gt; columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { columnWidths[c + <span class="hljs-number"><span class="hljs-number">1</span></span>] = countWidth; } } .... }</code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3081</a> O contador 'r' n√£o √© usado dentro de um loop aninhado.  Considere inspecionar o uso do contador 'c'.  CommandLine ClassifierEvaluationModule.cs 459 <br><br>  Observe que o contador do loop interno - <i>r</i> - n√£o √© usado no corpo desse loop.  Por causa disso, acontece que durante todas as itera√ß√µes do loop interno, as mesmas opera√ß√µes s√£o executadas nos mesmos elementos - afinal, os √≠ndices tamb√©m usam o contador do loop externo ( <i>c</i> ) e n√£o o interno ( <i>r</i> ). <br><br>  Vamos ver o que mais foi encontrado interessante. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegexpFormattingSettings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> putOptionalInSquareBrackets, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> showAnyElementAsQuestionMark, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreElementDistributionDetails, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> truncationLength, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> escapeCharacters, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useLazyQuantifier</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PutOptionalInSquareBrackets = putOptionalInSquareBrackets; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ShowAnyElementAsQuestionMark = showAnyElementAsQuestionMark; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IgnoreElementDistributionDetails = ignoreElementDistributionDetails; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.TruncationLength = truncationLength; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.EscapeCharacters = escapeCharacters; }</code> </pre> <br>  <b>PVS-Studio Warning</b> : O par√¢metro do construtor V3117 'useLazyQuantifier' n√£o √© usado.  Tempo de execu√ß√£o RegexpFormattingSettings.cs 38 <br><br>  O construtor n√£o usa um par√¢metro - <i>useLazyQuantifier</i> .  Isso parece particularmente suspeito no contexto do fato de que uma propriedade com o nome e o tipo correspondente √© definida na classe - <i>UseLazyQuantifier</i> .  Aparentemente, eles esqueceram de inicializ√°-lo atrav√©s do par√¢metro correspondente. <br><br>  Conheci v√°rios manipuladores de eventos potencialmente perigosos.  Um exemplo de um deles √© dado abaixo: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RecommenderRun</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventHandler Started; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Report that the run has been started if (this.Started != null) { this.Started(this, EventArgs.Empty); } .... } .... }</span></span></code> </pre> <br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3083 Chamada n√£o segura</a> do evento 'Started', NullReferenceException √© poss√≠vel.  Considere atribuir um evento a uma vari√°vel local antes de invoc√°-lo.  Recomendador do avaliador <br><br>  O fato √© que, entre a verifica√ß√£o de desigualdade <i>nula</i> e a chamada do manipulador, um evento pode ser cancelado e, se no momento entre a verifica√ß√£o de <i>nulo</i> e a chamada dos manipuladores, o evento n√£o tiver assinantes, uma <i>NullReferenceException</i> ser√° <i>lan√ßada</i> .  Para evitar esses problemas, por exemplo, voc√™ pode salvar o link na cadeia de delegados em uma vari√°vel local ou usar o operador '?.'  chamar manipuladores. <br><br>  Al√©m do snippet de c√≥digo acima, havia 35 desses locais. <br><br>  A prop√≥sito, <b>785</b> avisos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3024</a> tamb√©m foram atendidos.  O aviso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V3024</a> √© emitido ao comparar n√∫meros reais usando os operadores '! =' Or '=='.  N√£o vou me debru√ßar aqui sobre por que essas compara√ß√µes nem sempre s√£o corretas - mais sobre isso est√° escrito na documenta√ß√£o, tamb√©m h√° um link para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">StackOverflow</a> (√© isso). <br><br>  Considerando que as f√≥rmulas e c√°lculos foram frequentemente atendidos, esses avisos tamb√©m podem ser importantes, embora sejam levados ao n√≠vel 3 (pois est√£o longe de ser relevantes em todos os projetos). <br><br>  Se tiver certeza de que esses avisos s√£o irrelevantes, √© poss√≠vel remov√™-los com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">quase um clique</a> , reduzindo o n√∫mero total de opera√ß√µes do analisador. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47e/77b/72d/47e77b72dbb716dadbd1623513150819.png"></div><br><br><h2>  Conclus√£o </h2><br>  De alguma forma, durante muito tempo eu n√£o escrevi artigos sobre verifica√ß√£o de projetos, e tocar nesse processo novamente foi bastante agrad√°vel.  Espero que voc√™ tamb√©m tenha aprendido algo novo / √∫til neste artigo, ou pelo menos tenha lido com interesse. <br><br>  Desejo aos desenvolvedores uma corre√ß√£o precoce das √°reas problem√°ticas e lembro que cometer erros √© normal, mas somos pessoas.  Para isso, s√£o necess√°rias ferramentas adicionais, como analisadores est√°ticos, para encontrar o que uma pessoa perdeu, certo?  Enfim - boa sorte com o projeto, e obrigado pelo trabalho! <br><br>  E lembre-se de que o benef√≠cio m√°ximo de um analisador est√°tico √© alcan√ßado com seu <i>uso regular</i> . <br><br>  Tudo de bom! <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  Se voc√™ deseja compartilhar este artigo com um p√∫blico que fala ingl√™s, use o link para a tradu√ß√£o: Sergey Vasiliev.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Quais erros ocultam no c√≥digo Infer.NET?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429578/">https://habr.com/ru/post/pt429578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429564/index.html">‚ÄúSou apenas um entusiasta do projeto e usu√°rio da linguagem Dart‚Äù - entrevista com Ari Lerner, autor do famoso ng-book</a></li>
<li><a href="../pt429568/index.html">Reduza o tempo de inatividade do Zimbra durante falhas do servidor com o Zextras Backup</a></li>
<li><a href="../pt429570/index.html">Ensinar um agente a jogar Mario Kart com filtros</a></li>
<li><a href="../pt429572/index.html">Interceptando conversas particulares no Skype usando o Devicelock DLP</a></li>
<li><a href="../pt429574/index.html">Check Point gratuito para iniciantes no CheckMates</a></li>
<li><a href="../pt429580/index.html">Microintera√ß√µes no iOS. Palestra Yandex</a></li>
<li><a href="../pt429582/index.html">Indicador anal√≥gico de carga do computador</a></li>
<li><a href="../pt429586/index.html">Como determinar a melhor hora para negociar na bolsa</a></li>
<li><a href="../pt429588/index.html">Toda a verdade sobre o RTOS. Artigo 20. Sem√°foros: Servi√ßos Auxiliares e Estruturas de Dados</a></li>
<li><a href="../pt429590/index.html">An√°lise de voz para call centers baseados em SOLR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>