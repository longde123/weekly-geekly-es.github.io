<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèæ üòΩ üç£ Automatisation des tests End-2-End d'un syst√®me d'information int√©gr√©. Partie 2. Technique üîü üòø üòí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avec cet article, nous continuons une s√©rie de publications sur la fa√ßon dont nous avons automatis√© dans l'un des principaux projets LANIT le processu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatisation des tests End-2-End d'un syst√®me d'information int√©gr√©. Partie 2. Technique</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lanit/blog/477044/">  Avec cet article, nous continuons une s√©rie de publications sur la fa√ßon dont nous avons automatis√© dans l'un des principaux projets LANIT le processus automatique de test manuel (ci-apr√®s d√©nomm√© autotests) d'un grand syst√®me d'information (ci-apr√®s d√©nomm√© Syst√®mes) et ce qui en est r√©sult√©. <br><br>  La deuxi√®me partie de la publication s'adresse principalement aux leaders des groupes d'automatisation UI end-2-end testing et leader de l'automatisation des tests.  Ils y trouveront des recettes sp√©cifiques pour l'organisation architecturale du code et du d√©ploiement, qui soutiennent le d√©veloppement en masse parall√®le de grands groupes de tests face √† la variabilit√© constante des sp√©cifications de test.  Cette partie contient la liste compl√®te des fonctions n√©cessaires aux tests d'interface utilisateur avec quelques d√©tails d'impl√©mentation, ainsi qu'une liste de surprises que vous pourriez rencontrer. <br><br>  <i>Vous trouverez ici la <a href="https://habr.com/ru/company/lanit/blog/473426/"><b>partie 1. (Pourquoi avons-nous eu besoin d'automatisation. Organisation du processus de d√©veloppement et de gestion. Organisation de l'utilisation)</b></a></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e47/985/776/e4798577680ae78fcb67f4c6c8976800.jpg"></div>  <i><a href="https://www.dreamstime.com/">Source</a></i> <br><a name="habracut"></a><br><h1>  Pile d'architecture et de technologie </h1><br><h3>  Structure g√©n√©rale du syst√®me et de son environnement - Conception de haut niveau </h3><br>  Les principales technologies et biblioth√®ques utilis√©es dans le projet: <br><br><ul><li>  JavaSE8 &amp; maven &amp; JUnit - pile de d√©veloppement; </li><li>  <a href="https://www.seleniumhq.org/">Selenium</a> - une biblioth√®que pour automatiser les actions d'un navigateur Web; </li><li>  <a href="https://ru.selenide.org/">Selenide</a> - un module compl√©mentaire pour Selenium, qui poss√®de une √©l√©gante API qui simplifie consid√©rablement l'interaction avec le navigateur et les √©l√©ments de page; </li><li>  <a href="https://aerokube.com/selenoid/latest/">Selenoid &amp; GGR</a> - impl√©mentation de Selenium Grid et d'un √©quilibreur de charge pour ex√©cuter des tests sur un serveur CI + conteneurs pr√©configur√©s avec navigateurs; </li><li>  <a href="http://allure.qatools.ru/">Yandex Allure</a> - pour les rapports sur le serveur CI. </li></ul><br>  Un diagramme g√©n√©ral des composants des autotests et de l'infrastructure Selenoid est pr√©sent√© dans les diagrammes ci-dessous, avec des commentaires explicatifs: <br><br>  <b>Cadre d'autotests</b> <br>  Application pour l'automatisation de la r√©gression de l'interface utilisateur. <br>  Livr√© en code source.  Utilise JUnit4 <br><br>  <b>run.properties</b> <br>  Fichier de configuration pour ex√©cuter les autotests.  D√©finit le nom conditionnel du stand utilis√© et le type d'ex√©cution - local ou via des conteneurs externes et d'autres variables. <br><br>  <b>Plugin Allure</b> <br>  Un fichier ex√©cutable sp√©cial qui s'installe sur un serveur Bamboo. <br>  Cr√©e un rapport HTML de test accessible via un serveur Bamboo. <br><br>  <b>Rapport de test</b> <br>  Rapport de test HTML disponible via le serveur Bamboo. <br>  Il est stock√© sur le serveur Bamboo dans les r√©sultats du plan dans un onglet s√©par√©. <br><br>  <b>Bambou</b> <br>  Fournit le lancement des tests d'int√©gration en mode automatique et manuel. <br>  Stocke les rapports de test au format Allure. <br><br>  <b>ggr-server</b> <br>  Serveur-√©quilibreur de serveurs Selenoid. <br>  Fournit l'√©quilibrage des demandes des autotests (RemoteWebDriver) √† plusieurs instances de serveurs au s√©l√©nium. <br><br>  <b>Docker</b> <br>  Serveur Docker pour ex√©cuter les conteneurs et les navigateurs du serveur Selenoid. <br><br>  <b>Serveur Selenoid</b> <br>  Serveur de test √† distance <br>  Fournit le lancement de tests dans des conteneurs Docker sp√©cialis√©s √† l'aide d'un navigateur "sans t√™te". <br>  Effectue des tests en mode parall√®le selon le nombre sp√©cifi√© de threads simultan√©s. <br><br>  <b>Selenoid-ui</b> <br>  Interface utilisateur du serveur vers le serveur Selenoid. <br>  Permet la surveillance √† la vol√©e de la progression des tests via VNC. <br><br>  <b>S√©l√©no√Øde-webdriver</b> <br>  Un conteneur sp√©cialis√© avec un navigateur sans t√™te pour ex√©cuter des tests √† distance. <br>  Fourni √† partir du r√©f√©rentiel Selenoid. <br><br>  <b>Gitlab</b> <br>  Stocke le code source de l'application Autotests. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c5d/cac/f81/c5dcacf817e4aa1529d7cc4d64be740d.png"></div><br><h3>  Sch√©ma de travail </h3><br>  Le diagramme suivant montre le sch√©ma g√©n√©ral du service AutoTests au niveau de conception de haut niveau. <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/ye/e8/ue/yee8uexl8oqy5spoqirropxglha.png"></a> </div><br><h3>  Installation et d√©ploiement </h3><br>  Les autotests sont bas√©s sur quatre serveurs, dont l'un est le serveur d'ex√©cution, et les trois autres permettent le lancement de navigateurs sans t√™te dans des conteneurs.  La puissance actuelle des autotests fournit 60 flux simultan√©s et peut √™tre √©tendue si n√©cessaire. <br><br>  Le diagramme de d√©ploiement actuel est illustr√© dans le diagramme suivant.  En g√©n√©ral, si vous n'avez pas besoin de plus de 20 navigateurs simultan√©s (tests de threads), il est tout √† fait possible de tout mettre sur un m√™me serveur 12 noyaux + 24 RAM.  Nous avons commenc√© avec cette configuration, mais au fur et √† mesure que les exigences pour la puissance des autotests augmentaient, nous avons d√©couvert empiriquement que la configuration la plus stable et la plus rentable est un serveur ¬´typique¬ª √† 12 noyaux + 24 RAM. <br><br>  D'apr√®s notre exp√©rience, pour tester des syst√®mes avec une interface Web sur Angular, la configuration acceptable du conteneur avec le navigateur devrait √™tre le plancher du noyau + Go de m√©moire.  Une configuration plus petite ralentit le navigateur et peut m√™me entra√Æner des plantages non identifiables. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/152/65f/095/15265f09560a8abd9a744e5c06da1f61.png"></div><br><h1>  Structure et organisation du code </h1><br>  Avant de passer √† la structure et √† l'organisation du code, je vais √† nouveau √©num√©rer les politiques et les restrictions qui ont finalement d√©termin√© l'orientation du d√©veloppement de l'architecture: <br><br><ul><li>  Un grand nombre de scripts de test de bout en bout complexes.  Haute intensit√© de d√©veloppement; </li><li>  volatilit√© √©lev√©e des sc√©narios de test (leur variabilit√©); </li><li>  vitesse continue √©lev√©e de livraison de sc√©narios (d√©veloppement et r√©vision); </li><li>  qualifications initiales des d√©veloppeurs d'autotests; </li><li>  D√©veloppement planifi√© √©lev√© des d√©veloppeurs. </li></ul><br>  Sur la base de ce qui pr√©c√®de, les principaux moteurs architecturaux sont les suivants: <br><br><ul><li>  assurer un code hautement structur√© pour une lisibilit√© et une g√©rabilit√© faciles; </li><li>  s√©paration et isolation maximales entre les impl√©mentations d'applications de tests sp√©cifiques et les classes transversales de fonctionnalit√©s communes; </li><li>  r√©duction maximale des d√©pendances requises pour faciliter le changement; </li><li>  R√©utilisation raisonnable du code au niveau des classes transversales avec une duplication de code possible acceptable au niveau des groupes de test ind√©pendants (sous-syst√®mes fonctionnels) pour r√©duire les d√©pendances et fusionner les conflits au niveau du d√©veloppement; </li><li>  rejet de frameworks complexes tels que spring, aspectJ pour r√©duire le temps d '"entr√©e" des d√©veloppeurs novices dans le projet. </li></ul><br>  En g√©n√©ral, cette approche architecturale a permis de mettre en ≈ìuvre un d√©veloppement rapide ind√©pendant dans des conditions de forte variabilit√© des sc√©narios avec un processus pratiquement continu de livraison de nouveaux tests au productif.  L'architecture et maintenant r√©sister avec succ√®s √† la "charge et le raffinement" malgr√© le fait que le syst√®me a d√©j√† mis en ≈ìuvre plus de 1 500 sc√©narios d'entreprise. <br><br>  La structure g√©n√©rale du code et les descriptions des solutions sp√©cifiques cl√©s sont donn√©es ci-dessous. <br><br><h3>  Structure g√©n√©rale du code et mod√®les de d√©veloppement </h3><br>  La structure g√©n√©rale de l'organisation du code est bas√©e sur une architecture ¬´en couches¬ª (voir sch√©ma), qui h√©rite g√©n√©ralement du mod√®le de page recommand√© par les d√©veloppeurs Selenium.  Nous avons d√©velopp√© ce mod√®le en ajoutant un niveau d'√©l√©ments Web √† la base et en mettant en √©vidence le niveau du sc√©nario de test: <br><br><ul><li>  niveau de la classe de test </li><li>  niveau du sc√©nario de test </li><li>  niveau de la page Web </li><li>  niveau d'√©l√©ment Web </li><li>  cadre de test (illustr√© par une gradation dans le diagramme). </li></ul><br>  Chaque niveau de ce sch√©ma a un ensemble sp√©cifique de responsabilit√©s et de fonctionnalit√©s.  L'intersection fonctionnelle entre les couches ou les d√©pendances ill√©gitimes entre elles n'√©taient pas autoris√©es et √©taient la principale raison du retour de la validation pour r√©vision dans le cadre d'une r√©vision de code avant la demande de fusion. <br><br>  De plus, une structure ¬´en couches¬ª a √©t√© corrig√©e dans la division du code en packages (voir sch√©ma ci-dessous). <br><br>  Un tel sch√©ma a permis de diviser tous les sous-syst√®mes (dont il y avait beaucoup plus que dans le sch√©ma) entre les d√©veloppeurs et, par cons√©quent, a permis de se d√©velopper ind√©pendamment avec un nombre pratiquement disparaissant de conflits de fusion. <br><br>  Le diagramme ci-dessous montre la structure g√©n√©rale de l'impl√©mentation de la classe de test et le sch√©ma de distribution pour l'impl√©mentation des packages de projet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c26/582/00e/c2658200ed322c07b65492aef2479074.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/caf/528/329/caf52832908c9f9d739b891d1aafb29d.png"></div><br><h3>  Niveau de classe de test </h3><br>  Le niveau de classe de test comprend une seule classe pour un test individuel particulier (le test est d√©crit dans le syst√®me de gestion de test comme une s√©quence lin√©aire de scripts de test).  La classe de test est une classe Junit avec l'annotation @ Test de la m√©thode correspondante.  En g√©n√©ral, une classe de test impl√©mente une seule m√©thode de test. <br><br>  Chaque classe de test h√©rite d'une classe de base dont la t√¢che est d'initialiser tous les TestRules dans RuleChain, c'est-√†-dire d'initialiser une infrastructure de test telle que l'initialisation d'un pilote Web, la d√©finition de r√©pertoires temporaires et d'autres gestionnaires d'utilisation √† usage g√©n√©ral. <br><br>  La classe de test est charg√©e d'organiser l'ex√©cution du sc√©nario de test √† travers: <br><br><ol><li>  initialisation des donn√©es m√©tiers de test (sc√®ne de test), </li><li>  appel s√©quentiel de scripts de test individuels (Actions) selon le sc√©nario requis avec le transfert des donn√©es de test initialis√©es √† partir de l'√©tape 2. </li></ol><br>  De plus, √† l'√©tape 2, il devrait y avoir une s√©quence lin√©aire sans branches ni points de d√©cision.  Le mod√®le d'impl√©mentation de classe est illustr√© ci-dessous. <br><br><h3>  Niveau du sc√©nario de test </h3><br>  Le niveau de sc√©nario de test est responsable de la mise en ≈ìuvre de sc√©narios de test sp√©cifiques, comme d√©crit.  Un sc√©nario de test dans ce contexte est une s√©quence d'op√©rations effectu√©es par un utilisateur sur un syst√®me via une interaction avec des √©l√©ments sur les pages Web de l'application. <br><br>  L'objectif principal de la classe de cas de test: <br><br><ul><li>  ex√©cuter la s√©quence donn√©e du script de test en acc√©dant aux m√©thodes des classes inf√©rieures de Page, en utilisant <br><br>  o donn√©es de sc√®ne de test transmises, <br>  o les donn√©es re√ßues des pages Web (des classes de pages); </li><li>  Effectuez les tests commerciaux requis pour la r√©ussite des tests dans le contexte du mod√®le commercial et de la sc√®ne de test.  <b>En d'autres termes, la classe de cas de test NE v√©rifie PAS le balisage, la disponibilit√© et l'accessibilit√© des √©l√©ments, mais fonctionne sur le mod√®le commercial de la sc√®ne de test, effectuant en fait des tests commerciaux.</b> </li></ul><br>  La classe de cas de test est organis√©e comme une "interface fonctionnelle": <br><br><ul><li>  contient une seule m√©thode publique "apply" (@ Step), qui: <br><br>  o fournit l'impl√©mentation du script comme un appel √† une s√©quence "d'actions" (m√©thodes fournies par les classes Page), <br>  o accepte tous les objets m√©tier n√©cessaires en entr√©e, alors qu'il NE CR√âE PAS lui-m√™me d'objets m√©tier et N'interagit PAS directement avec autre chose que les classes de page; </li><li>  contient X m√©thodes priv√©es (@ Step), chacune mettant en ≈ìuvre une √©tape distincte sp√©cifique du script de test (comme d√©crit dans TMS - Test Management System); </li><li>  N'interagit pas (n'appelle pas de m√©thodes) avec d'autres activit√©s, m√™me les activit√©s d'un sous-syst√®me similaire; </li><li>  n'accepte pas d'entr√©e et ne fonctionne pas sur les donn√©es de connexion.  En d'autres termes, ne sait rien des r√¥les √† partir desquels il est lanc√©. </li></ul><br>  Cette organisation de classe vous permet de: <br><br><ul><li>  Fournir un rapport d'auto-documentation.  Chaque m√©thode correspond √† un point sp√©cifique de la sp√©cification de test et est annot√©e par l'annotation d'allure @ Step; </li><li>  r√©utiliser les classes de script de test dans diff√©rents tests, car le script de test 1) ne cr√©e pas de sc√®ne de test et 2) ne d√©pend pas de la connexion de l'utilisateur (l'op√©ration de connexion √† la connexion est effectu√©e au niveau de la classe de test) 3), le test ne d√©pend pas d'autres classes scripting. </li></ul><br><h3>  Niveau de la page Web </h3><br>  Le niveau de page Web est un mod√®le de page classique pour les tests dans Selenium.  La classe de page contient des d√©finitions d'√©l√©ments Web sp√©cifiques et un ensemble de m√©thodes publiques pour effectuer certaines actions de groupe dans le contexte des √©tapes du sc√©nario de test. <br><br>  La classe de page est directement responsable de la saisie des donn√©es commerciales dans des √©l√©ments d'interface sp√©cifiques, de la collaboration avec le pilote Web (lancement de JS, par exemple) et, en cons√©quence, du test des formats, de la v√©rification de la mise en page et de la structure de la page Web pour les v√©rifications de base telles que: l'√©l√©ment n'est pas trouv√© / non disponible et l'article ne contient pas la valeur requise. <br><br>  La classe de page n'inclut pas non plus et ne peut pas acc√©der √† d'autres pages et √† leurs m√©thodes.  De plus, les classes de pages n'effectuent pas de v√©rifications commerciales, se limitant uniquement aux v√©rifications structurelles au niveau des √©l√©ments Web dans le cas g√©n√©ral, fournissant des donn√©es de niveau ¬´jusqu'au¬ª script de test re√ßues des pages. <br><br><h3>  Niveau d'√©l√©ment Web </h3><br>  La couche d'√©l√©ments Web comprend une biblioth√®que d'√©l√©ments finis qui peuvent se trouver sur une page Web.  Il comprend √† la fois des primitives sp√©cifiques et des conglom√©rats plus complexes, constitu√©s de plusieurs √©l√©ments que nous appelons widgets.  Des exemples de widgets peuvent √™tre des constructions telles que des ¬´pajinators¬ª, des menus globaux, divers cadres et fen√™tres modales, des √©l√©ments complexes tels que YandexMap ou un lecteur Youtube.  Les √©l√©ments Web organisent la composition avec des classes de pages sp√©cifiques et ne savent rien des autres √©l√©ments. <br><br>  En g√©n√©ral, si le projet a une identification globale unique de tous les √©l√©ments d'interface avec leur ID, il est logique d'organiser le niveau des √©l√©ments Web en tant que biblioth√®que globale avec demande d'√©l√©ments sp√©cifiques par leur ID via les classes de configuration d'usine ou \ xml dans la biblioth√®que Spring.  Mais ce n'est pas possible dans tous les projets. <br><br><h3>  Cadre de test </h3><br>  Le concept de d√©veloppement d'autotests, tel qu'illustr√© dans le diagramme ci-dessus, est bas√© sur l'id√©e d'un cadre dans lequel un ensemble de fonctions syst√®me est fourni pour tous les autotests - ils sont parfaitement int√©gr√©s et permettent aux d√©veloppeurs d'autotests de se concentrer sur des probl√®mes sp√©cifiques de mise en ≈ìuvre commerciale des classes de test. <br><br>  Le cadre comprend les blocs fonctionnels suivants: <br><br><ul><li>  R√®gles - initialisation et finalisation des composants de l'infrastructure de test comme l'initialisation de WebDriver et la r√©ception d'un test vid√©o (d√©crit plus en d√©tail ci-dessous); </li><li>  WebDriverHandlers - fonctions d'assistance pour travailler avec un pilote Web comme ex√©cuter Java Script ou acc√©der aux journaux du navigateur.  Impl√©ment√© comme un ensemble de m√©thodes statiques sans √©tat; </li><li>  WebElements - une biblioth√®que d'√©l√©ments Web typiques ou de leurs groupes, contient la fonctionnalit√© inter-fonctions requise et le comportement typique.  Dans notre cas, cette fonctionnalit√© comprend une v√©rification √©ventuelle de la fin des op√©rations asynchrones du c√¥t√© du navigateur Web.  Impl√©ment√© en tant qu'extensions d'√©l√©ments Web √† partir des biblioth√®ques Selenium et Selenide. </li></ul><br><h3>  Initialisation de l'environnement de test.  Les r√®gles </h3><br>  La classe cl√© pour toutes les classes de test est BaseTest, dont toutes les classes de test sont h√©rit√©es.  La classe BaseTest d√©finit le ¬´runner¬ª Junit des tests et la RuleChain utilis√©e, comme indiqu√© ci-dessous.  L'acc√®s des classes de test d'application aux fonctions fournies par les classes de r√®gles s'effectue via les m√©thodes statiques des classes de r√®gles en utilisant l'identifiant de thread ¬´thread¬ª comme cl√©. <br><br>  Les d√©tails de l'impl√©mentation des classes de base pour le framework d'autotest seront pr√©sent√©s dans la prochaine partie de l'article: voir Partie 2-1.  Impl√©mentation de la classe de base pour tous les tests et JUnit ChainRule. <br><br><h3>  Documenter les r√©sultats via les rapports Allure. </h3><br>  Pour des rapports d√©taill√©s sur les tests effectu√©s, Allure Framework est utilis√©, int√©gr√© √† Bamboo via le <a href="https://docs.qameta.io/allure/">plugin Allure</a> .  Cela permet aux consommateurs de tests sp√©cifiques (√©quipe de tests fonctionnels) non seulement de recevoir des donn√©es sur le crash d'un test particulier, mais √©galement de restaurer facilement et, si n√©cessaire, de r√©p√©ter un test abandonn√© en mode manuel. <br><br>  Pour documenter le rapport de test, les fonctionnalit√©s suivantes sont utilis√©es: <br><br><ul><li>  Annotations Allure et Junit pour le balisage du rapport par les √©tapes du script de test, ainsi qu'une description statique des m√©tadonn√©es du test; </li><li>  Pi√®ces jointes Allure pour joindre au rapport des informations suppl√©mentaires telles qu'un test vid√©o, une capture d'√©cran, les r√©sultats de diagnostics suppl√©mentaires des raisons de l'accident, les journaux du navigateur Web t√©l√©charg√©s vers / depuis le navigateur de fichiers. </li></ul><br>  Les annotations Allure et Junit suivantes sont utilis√©es pour baliser le rapport. <br><br><ul><li>  Au niveau de la classe de test: <br><br>  o @ Feature - le nom du sous-syst√®me fonctionnel auquel appartient le test; <br>  o @ Story - le nom d'un cas de test sp√©cifique; <br>  o @ Owner - le nom du d√©veloppeur qui a apport√© les derni√®res modifications au test; <br>  o @ TmsLink - lien vers la description du test dans le ¬´syst√®me de gestion des tests¬ª utilis√©. </li><li>  Au niveau de la m√©thode de test (@ Test) de la classe de test: <br><br>  o @ DisplayName - nom complet du script de test.  Il diff√®re de @ Story en ce qu'il vous permet de partager les m√™mes scripts, qui ne diff√®rent que par la composition de la sc√®ne de test; </li><li>  Au niveau des m√©thodes qui correspondent aux √©tapes sp√©cifiques du sc√©nario de test: <br><br>  o @ Step - le nom significatif de l'√©tape de test qui refl√®te l'essence commerciale de ce qui se passe. </li></ul><br>  La d√©nomination des √©tapes de test via @ Step vous permet de cr√©er un rapport d√©taill√© qui r√©p√®te compl√®tement toutes les √©tapes et les √©l√©ments d√©crits dans le sc√©nario de test.  Cela permet aux utilisateurs d'autotests de suivre facilement le d√©roulement du sc√©nario de test et aide √† d√©terminer le point d'incidence. <br><br>  En g√©n√©ral, l'utilisation d'Allure Framework s'est av√©r√©e tr√®s utile et facile, √† l'exception de certaines fonctionnalit√©s li√©es √† l'√©norme quantit√© de donn√©es g√©n√©r√©es dans notre cas pour un grand nombre de scripts de test longs et complexes (d√©crits plus loin dans la section "R√©trospective"). <br><br><h3>  Qu'est-ce qui aurait pu √™tre fait diff√©remment tout de suite?  Utiliser Spring Framework </h3><br>  Malgr√© le fait que lors de la mise en ≈ìuvre des autotests, nous avons intentionnellement refus√© d'utiliser Spring Core, en g√©n√©ral, je consid√®re que son utilisation est justifi√©e et fonctionne.  Le prototype impl√©ment√© a montr√© que l'utilisation de Spring Core fonctionne pour les t√¢ches suivantes (bien que nous ne l'ayons pas test√© compl√®tement): <br><br><ul><li>  initialisation de la sc√®ne de test; </li><li>  initialisation des pages Web et des √©l√©ments. </li></ul><br>  La seule caract√©ristique est la n√©cessit√© d'utiliser le contexte de port√©e "par d√©faut" du niveau prototype. <br><br>  Initialisation de la sc√®ne de test.  Dans les autotests, la sc√®ne de test est initialis√©e par la m√©thode classique de cr√©ation d'instances de classe directement dans la classe de test via une simple fabrique de nouveaux objets ou d'objets.  Ici, il est tout √† fait raisonnable d'utiliser l'initialisation via des classes de configuration ou via des fichiers xml ou fichiers externes.  Les avantages sont les suivants: cela 1) simplifie le code de r√©vision, car les modifications apport√©es √† la sc√®ne de test ne s'appliquent plus aux classes cl√©s, 2) vous permet de connecter diff√©rentes sc√®nes de test pour diff√©rents peuplements ou d'autres conditions.  Maintenant, le point 2 n'est pas utilis√© avec nous. <br><br>  Initialisation des pages Web et des √©l√©ments.  L'injection de classes de pages Web et d'√©l√©ments Web fonctionne gr√¢ce √† l'initialisation paresseuse paresseuse des √©l√©ments Web en s√©l√©niure. <br><br>  Ainsi, il devient possible de cr√©er une biblioth√®que d'√©l√©ments et de pages Web conform√©ment √† une certaine sp√©cification globale de l'interface utilisateur et de recevoir dans le code des liens vers ces √©l√©ments non pas par le chemin absolu et l'id, mais par l'id du projet selon la sp√©cification. <br><br>  Je dois dire tout de suite que je n'ai pas test√© cela tr√®s attentivement, en fait je me suis limit√© √† un test d'impl√©mentation des ¬´pages¬ª de la connexion et de la page ¬´info¬ª de l'utilisateur sur ce principe. <br><br><h1>  R√©trospective.  Surprises </h1><br>  Ici, j'ai d√©crit les surprises inattendues qui se sont produites pendant le d√©veloppement du projet, ainsi que quelques consid√©rations sur ce qui aurait pu √™tre mieux fait si ¬´non¬ª. <br><br><h3>  Balisage frontal compatible avec le s√©l√©nium (angulaire) </h3><br>  L'une des surprises les plus s√©rieuses que nous avons rencontr√©es a √©t√© la mise en page ¬´flottante¬ª, qui a conduit au fait qu'apr√®s la mise √† jour des applications Angular, les tests ont √©chou√© car Selenium n'a pas pu trouver les √©l√©ments car leur ID (id, class ou ng-model) ou des chemins (pour XPath).  Cela a conduit √† l'instabilit√© des tests et √† l'ambigu√Øt√© des raisons de la chute. <br><br>  Malheureusement, ce probl√®me s'est av√©r√© g√©n√©ralement insoluble.  Nous l'avons contourn√© avec des mesures organisationnelles: 1) au d√©but du test d'un nouveau candidat √† la publication, tous les d√©veloppeurs d'autotests se concentrent sur l'√©limination rapide et le raffinement en termes de modification des valeurs des localisateurs d'√©l√©ments Web;  2) √† la fin, nous sommes arriv√©s √† utiliser XPath relatif, ce qui, h√©las, n'am√©liore pas du tout les performances. <br><br>       ‚Äì            ,         -        . <br><br><h3>     ¬´download¬ª  </h3><br>  ¬´¬ª        : <br><br><ul><li>  ¬´¬ª   (    ) ‚Äì   ¬´¬ª          .          ; </li><li>  ¬´¬ª  ( Bamboo)  ¬´¬ª       solenoid : <a href="http://selenoid-host.example.com:4444/download/%257BSESSION_ID%257D/%257BFILE_NAME%257D">selenoid-host.example.com:4444/download/{SESSION_ID}/{FILE_NAME}</a> </li></ul><br>    <a href="https://aerokube.com/selenoid/latest/"></a> . <br><br>            .     ,      ,         .           ,       . <br><br><h3>     </h3><br>         .        ,   ¬´¬ª          . ,                  ,  ,  ,     ,       - (    )  -     . <br><br>  ,       ,    ,       .             . <br><br>    ,    .         ¬´¬ª ,          ,     ,            . <br><br><h3>    </h3><br>              . ,      .      (~ 1000  )       6 . <br><br>          <a href="https://aerokube.com/ggr/latest/">Selenoid-ggr</a> .        junit  20 ( Selenoid-)  60 ( ),        . ¬´¬ª ,          60  . <br><br> ,    ,  ,         3-4 ,        preQA-.    . , ,   AWS c   ,    Selenoid-     ,         AWS   Selenoid,     in/out . <br>   ,       ,             E2E      .              preQA. <br><br><h3>  ¬´¬ª       </h3><br>        ,         60     60 . <br><br>    ¬´Timeline¬ª    ¬´ ¬ª (  ). ,             . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/580/84e/60b/58084e60b239a6157b54db4e8b9c496c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y avait deux raisons. </font><font style="vertical-align: inherit;">La ¬´prise¬ª de d√©part a √©t√© provoqu√©e par l'appel massif au service d'autorisation et au compte personnel. </font><font style="vertical-align: inherit;">Tous les navigateurs commencent simultan√©ment √† se connecter et surchargent le service c√¥t√© banc d'essai. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les ¬´colonnes¬ª suivantes se sont r√©v√©l√©es √™tre li√©es au fait que nos classes de test sont situ√©es dans des dossiers par sous-syst√®me et junit les a ex√©cut√©es presque simultan√©ment, chargeant ainsi un sous-syst√®me fonctionnel sp√©cifique du stand et d√©passant la limite de performance de la configuration du stand. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons r√©solu le premier probl√®me en encapsulant la m√©thode du script de connexion dans l'√©quilibreur, ce qui limitait le nombre maximal d'op√©rations de connexion √† une constante donn√©e.</font></font><br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Step</span></span>(<span class="hljs-string"><span class="hljs-string">":    "</span></span>)     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User user)</span></span></span><span class="hljs-function"> </span></span>{     <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {         LoadCounter.get(); <span class="hljs-comment"><span class="hljs-comment">//   .              try {                 applyLogin(user); //          } catch (Throwable t) {             throw t; //                   } finally {             LoadCounter.release(); //            }         } catch (LoadCounterException e) { //                  throw new StandRuntimeException("Can not get loadcounter for Login action.", e);     }     }</span></span></code> </pre> <br>  Le deuxi√®me probl√®me a √©t√© r√©solu en activant l'option d'ex√©cution de test al√©atoire, que le plugin junit maven poss√®de. <br><br><pre> <code class="java hljs">   &lt;plugin&gt;               &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;         &lt;version&gt;‚Ä¶.&lt;/version&gt;            &lt;configuration&gt;                &lt;!-- Defines the order the tests will be run in. Supported values are <span class="hljs-string"><span class="hljs-string">"alphabetical"</span></span>,                     <span class="hljs-string"><span class="hljs-string">"reversealphabetical"</span></span>, <span class="hljs-string"><span class="hljs-string">"random"</span></span>,<span class="hljs-string"><span class="hljs-string">"hourly"</span></span>, <span class="hljs-string"><span class="hljs-string">"failedfirst"</span></span>, <span class="hljs-string"><span class="hljs-string">"balanced"</span></span> and <span class="hljs-string"><span class="hljs-string">"filesystem"</span></span>. --&gt;                &lt;runOrder&gt;random&lt;/runOrder&gt;                ‚Ä¶</code> </pre><br>  Il convient de noter que ces probl√®mes √©taient li√©s au fait que nous n‚Äôavions pas eu l‚Äôoccasion d‚Äôaugmenter les performances du banc d‚Äôessai en raison de ressources limit√©es, et aussi parce que ces ressources seraient inutilis√©es la plupart du temps. <br><br>  En g√©n√©ral, il s'est av√©r√© que le syst√®me d'autotest int√©gr√© de l'interface utilisateur Web E2E pouvait tr√®s bien √™tre utilis√© pour tester la charge de substitution et contr√¥ler les performances et la stabilit√© du syst√®me test√© dans son ensemble. <br><br><h3>  Charge √©lev√©e sur le serveur Bamboo et son stockage </h3><br>  Si vous avez de nombreux tests avec un grand nombre d'op√©rations (par exemple, le nombre d'op√©rations enregistr√©es via l' <a href="https://habr.com/ru/users/step/" class="user_link">√©tape</a> est de 200 √† 2000 avec le nombre de tests environ 1300), alors le volume du rapport Allure devient plus que significatif.  Si vous ajoutez ici √©galement diverses pi√®ces jointes telles que des captures d'√©cran et des fichiers t√©l√©charg√©s / t√©l√©charg√©s, le volume atteint d√©j√† des centaines de m√©gaoctets.  Par exemple, pour une r√©gression nocturne de 900 tests, la quantit√© de donn√©es t√©l√©charg√©es sur Bamboo Allure √† elle seule est d'environ 600 Mo. <br><br>  Il est clair que les ing√©nieurs DevOps ne sont pas enthousiasm√©s par une telle intensit√© de consommation d'espace disque et expriment activement leur m√©contentement, en particulier en ce qui concerne la n√©cessit√© de stocker les donn√©es pendant au moins un an. <br><br>  Nous voyons un moyen de sortir de cette situation en utilisant un serveur externe pour stocker et traiter des rapports, par exemple, comme Allure Enterprise.  Ce serveur est d√©j√† pay√©, mais nous permet de r√©soudre ce probl√®me.  Nous travaillons actuellement sur les tests et l'int√©gration d'Allure Enterprise dans notre projet. <br><br><h1>  √Ä suivre </h1><br>  Dans le prochain article, mes coll√®gues continueront l'histoire et d√©criront l'histoire fascinante des tests de services Web √† l'aide de Smartbear SoapUI Pro.  Les forces de deux ing√©nieurs en automatisation ont r√©ussi √† automatiser environ 500 scripts de test; √† cette fin, j'ai d√ª impl√©menter un cadre suppl√©mentaire qui √©tend consid√©rablement la fonctionnalit√© des fonctions standard de l'interface utilisateur SOAP, mais plus √† ce sujet plus tard. <br><br>  <b><i>Cet article a √©t√© √©crit en collaboration avec le chef de projet et le propri√©taire du produit <a href="https://habr.com/ru/users/kotalesssk/" class="user_link">kotalesssk</a> .</i></b> <br><br>  <a href="https://habr.com/ru/company/lanit/blog/473426/">Partie 1. Organisation et gestion.</a>  <a href="https://habr.com/ru/company/lanit/blog/473426/">Pourquoi avons-nous eu besoin d'automatisation.</a>  <a href="https://habr.com/ru/company/lanit/blog/473426/">Organisation du processus de d√©veloppement et de gestion.</a>  <a href="https://habr.com/ru/company/lanit/blog/473426/">Organisation d'utilisation</a> <br>  Partie 2. Technique.  Architecture et pile technique.  D√©tails de mise en ≈ìuvre et surprises techniques <br>  Partie 2-1.  Impl√©mentation de la classe de base pour tous les tests et JUnit ChainRule <br>  Partie 2-2.  Impl√©mentation du processus de t√©l√©chargement d'un fichier depuis un conteneur avec un navigateur vers un framework de test.  Recherchez le nom du fichier t√©l√©charg√© par le navigateur <br><br><div class="spoiler">  <b class="spoiler_title">Nous avons des postes vacants, venez √† nous!</b> <div class="spoiler_text"><ul><li>  <a href="https://job.lanit.ru/young/programs/Pages/dks2019testir.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2019-12-03%26utm_campaign%3Ddks">Programme de stage "Tests automatis√©s"</a> </li><li>  <a href="https://job.lanit.ru/young/programs/Pages/dks-2019.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2019-12-03%26utm_campaign%3Ddks">Programme de stage "Test de charge"</a> </li><li>  <a href="https://job.lanit.ru/vacancy/Pages/CH-165.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2019-12-03%26utm_campaign%3Ddks">Stagiaire Ing√©nieur Test</a> </li><li>  <a href="https://job.lanit.ru/vacancy/Pages/BS-72.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2019-12-03%26utm_campaign%3Ddks">Sp√©cialiste principal des tests fonctionnels</a> </li><li>  <a href="https://job.lanit.ru/vacancy/Pages/BS-46.aspx%3Futm_source%3Dhabr%26utm_medium%3Dpost-2019-12-03%26utm_campaign%3Ddks">Ing√©nieur principal des tests automatis√©s</a> </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr477044/">https://habr.com/ru/post/fr477044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr477026/index.html">Septi√®me hackathon annuel JetBrains</a></li>
<li><a href="../fr477032/index.html">De la blockchain au DAG: se d√©barrasser des interm√©diaires</a></li>
<li><a href="../fr477038/index.html">Le meilleur langage de programmation pour les d√©butants</a></li>
<li><a href="../fr477040/index.html">Graphique de Gartner 2019: de quoi parlent tous ces mots √† la mode?</a></li>
<li><a href="../fr477042/index.html">Optimisation de la strat√©gie de blackjack de Monte Carlo</a></li>
<li><a href="../fr477046/index.html">Meetup .Net √† Raiffeisenbank 28/11 + Broadcast</a></li>
<li><a href="../fr477048/index.html">Pourquoi une entreprise avec une capitalisation de 55 milliards de dollars a-t-elle pens√© quitter la bourse</a></li>
<li><a href="../fr477050/index.html">Black Friday 2019 pour la vid√©osurveillance et les nuages.</a></li>
<li><a href="../fr477052/index.html">Reactor, WebFlux, Kotlin Coroutines ou Asynchrony avec un exemple simple</a></li>
<li><a href="../fr477054/index.html">Webasto annonce un syst√®me de batterie automobile modulaire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>