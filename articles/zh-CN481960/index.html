<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¢ ğŸ–– ğŸ˜ 2.å¼¹æ€§å †æ ˆï¼šåˆ†æå®‰å…¨æ—¥å¿—ã€‚ Logstash ğŸ‘¨ğŸ» ğŸ’…ğŸ¾ ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ELKå †æ ˆ ï¼Œå…¶ä¸­åŒ…å«å…¶ç»„æˆçš„è½¯ä»¶äº§å“ã€‚ å·¥ç¨‹å¸ˆä½¿ç”¨ELKå †æ ˆæ—¶é¢ä¸´çš„é¦–è¦ä»»åŠ¡æ˜¯å‘é€æ—¥å¿—ä»¥å­˜å‚¨åœ¨Elasticsearchä¸­ï¼Œä»¥è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚ ä½†æ˜¯ï¼Œè¿™åªæ˜¯å­—é¢ä¸Šçš„æ„æ€ï¼Œelasticsearchä»¥å…·æœ‰æŸäº›å­—æ®µå’Œå€¼çš„æ–‡æ¡£å½¢å¼å­˜å‚¨æ—¥å¿—ï¼Œè¿™æ„å‘³ç€å·¥ç¨‹å¸ˆå¿…é¡»ä½¿ç”¨å„ç§å·¥å…·æ¥è§£æä»...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>2.å¼¹æ€§å †æ ˆï¼šåˆ†æå®‰å…¨æ—¥å¿—ã€‚ Logstash</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tssolution/blog/481960/"><img src="https://habrastorage.org/webt/st/sv/rn/stsvrnlxabc4ixpjalmugzema-g.png"><br><br> åœ¨ä¸Š<a href="https://habr.com/ru/company/tssolution/blog/480570/">ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ</a>æˆ‘ä»¬é‡åˆ°<b>äº†ELKå †æ ˆ</b> ï¼Œå…¶ä¸­åŒ…å«å…¶ç»„æˆçš„è½¯ä»¶äº§å“ã€‚ å·¥ç¨‹å¸ˆä½¿ç”¨ELKå †æ ˆæ—¶é¢ä¸´çš„é¦–è¦ä»»åŠ¡æ˜¯å‘é€æ—¥å¿—ä»¥å­˜å‚¨åœ¨Elasticsearchä¸­ï¼Œä»¥è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚ ä½†æ˜¯ï¼Œè¿™åªæ˜¯å­—é¢ä¸Šçš„æ„æ€ï¼Œelasticsearchä»¥å…·æœ‰æŸäº›å­—æ®µå’Œå€¼çš„æ–‡æ¡£å½¢å¼å­˜å‚¨æ—¥å¿—ï¼Œè¿™æ„å‘³ç€å·¥ç¨‹å¸ˆå¿…é¡»ä½¿ç”¨å„ç§å·¥å…·æ¥è§£æä»ç»ˆç«¯ç³»ç»Ÿå‘é€çš„æ¶ˆæ¯ã€‚ è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®Œæˆ-è‡ªå·±ç¼–å†™ç¨‹åºï¼Œè¿™å°†ä½¿ç”¨APIâ€‹â€‹æˆ–ä½¿ç”¨ç°æˆçš„è§£å†³æ–¹æ¡ˆå°†æ–‡æ¡£æ·»åŠ åˆ°æ•°æ®åº“ä¸­ã€‚ åœ¨æœ¬è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶<b>Logstash</b>è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜¯ELKå †æ ˆçš„ä¸€éƒ¨åˆ†ã€‚ æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•å°†æ—¥å¿—ä»ç»ˆç«¯ç³»ç»Ÿå‘é€åˆ°Logstashï¼Œç„¶åæˆ‘ä»¬å°†é…ç½®é…ç½®æ–‡ä»¶ä»¥è§£æå¹¶é‡å®šå‘åˆ°Elasticsearchæ•°æ®åº“ã€‚ ä¸ºæ­¤ï¼Œè¯·å°†Check Pointé˜²ç«å¢™ä¸­çš„æ—¥å¿—ä½œä¸ºä¼ å…¥ç³»ç»Ÿã€‚ <br><a name="habracut"></a><br> ä½œä¸ºè¯¾ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œä¸è€ƒè™‘å®‰è£…ELKå †æ ˆï¼Œå› ä¸ºæœ‰å¤§é‡å…³äºæ­¤ä¸»é¢˜çš„æ–‡ç« ï¼Œæˆ‘ä»¬å°†è€ƒè™‘é…ç½®ç»„ä»¶ã€‚ <br><br> è®©æˆ‘ä»¬åˆ¶å®šä¸€ä¸ªé…ç½®Logstashçš„è¡ŒåŠ¨è®¡åˆ’ï¼š <br><br><ol><li> éªŒè¯elasticsearchå°†æ¥å—æ—¥å¿—ï¼ˆéªŒè¯ç«¯å£è¿è¡ŒçŠ¶å†µå’Œå¼€æ”¾æ€§ï¼‰ã€‚ </li><li>æˆ‘ä»¬è€ƒè™‘å¦‚ä½•å°†äº‹ä»¶å‘é€åˆ°Logstashï¼Œé€‰æ‹©ä¸€ç§æ–¹æ³•å¹¶å®ç°å®ƒã€‚ </li><li> åœ¨Logstashé…ç½®æ–‡ä»¶ä¸­é…ç½®Inputã€‚ </li><li> æˆ‘ä»¬ä»¥è°ƒè¯•æ–¹å¼åœ¨Logstashé…ç½®æ–‡ä»¶ä¸­é…ç½®Outputï¼Œä»¥äº†è§£æ—¥å¿—æ¶ˆæ¯çš„å¤–è§‚ã€‚ </li><li> é…ç½®è¿‡æ»¤å™¨ã€‚ </li><li> åœ¨ElasticSearchä¸­é…ç½®æ­£ç¡®çš„è¾“å‡ºã€‚ </li><li>  Logstashå¯åŠ¨ã€‚ </li><li> æ£€æŸ¥Kibanaä¸­çš„æ—¥å¿—ã€‚ </li></ol><br> è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è€ƒè™‘æ¯ä¸ªé¡¹ç›®ï¼š <br><br><h3> æ£€æŸ¥elasticsearchå°†æ¥å—æ—¥å¿— </h3><br> ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨curlå‘½ä»¤æ¥éªŒè¯ä»éƒ¨ç½²Logstashçš„ç³»ç»Ÿå¯¹Elasticsearchçš„è®¿é—®ã€‚ å¦‚æœå·²é…ç½®èº«ä»½éªŒè¯ï¼Œåˆ™è¿˜é€šè¿‡curlä¼ é€’ç”¨æˆ·å/å¯†ç ï¼Œå¦‚æœæœªæ›´æ”¹ï¼Œè¯·æŒ‡å®šç«¯å£9200ã€‚ å¦‚æœå‡ºç°ä»¥ä¸‹ç­”æ¡ˆï¼Œåˆ™è¯´æ˜ä¸€åˆ‡æ­£å¸¸ã€‚ <br><br><pre><code class="javascript hljs">[elastic@elasticsearch ~]$ curl -u &lt;&lt;user_name&gt;&gt; : &lt;&lt;password&gt;&gt; -sS -XGET "&lt;&lt;ip_address_elasticsearch&gt;&gt;:9200" { "name" : "elastic-1", "cluster_name" : "project", "cluster_uuid" : "sQzjTTuCR8q4ZO6DrEis0A", "version" : { "number" : "7.4.1", "build_flavor" : "default", "build_type" : "rpm", "build_hash" : "fc0eeb6e2c25915d63d871d344e3d0b45ea0ea1e", "build_date" : "2019-10-22T17:16:35.176724Z", "build_snapshot" : false, "lucene_version" : "8.2.0", "minimum_wire_compatibility_version" : "6.8.0", "minimum_index_compatibility_version" : "6.0.0-beta1" }, "tagline" : "You Know, for Search" } [elastic@elasticsearch ~]$</code> </pre> <br> å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç­”æ¡ˆï¼Œåˆ™å¯èƒ½å­˜åœ¨å¤šç§ç±»å‹çš„é”™è¯¯ï¼šElasticsearchè¿›ç¨‹ä¸èµ·ä½œç”¨ï¼ŒæŒ‡å®šäº†é”™è¯¯çš„ç«¯å£ï¼Œæˆ–è€…è¯¥ç«¯å£è¢«å®‰è£…Elasticsearchçš„æœåŠ¡å™¨ä¸Šçš„é˜²ç«å¢™é˜»æ­¢ã€‚ <br><br><h3> è€ƒè™‘å¦‚ä½•å°†æ—¥å¿—ä»æ£€æŸ¥ç‚¹é˜²ç«å¢™å‘é€åˆ°Logstash </h3><br> ä½¿ç”¨Check Pointç®¡ç†æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨log_exporterå®ç”¨ç¨‹åºé€šè¿‡syslogå°†æ—¥å¿—å‘é€åˆ°Logstashï¼Œæ‚¨å¯ä»¥åœ¨<a href="https://habr.com/ru/company/tssolution/blog/431146/">æœ¬æ–‡</a>ä¸­æ›´è¯¦ç»†åœ°äº†è§£å®ƒï¼Œè¿™é‡Œæˆ‘ä»¬ä»…ä¿ç•™åˆ›å»ºæµçš„å‘½ä»¤ï¼š <br><br>  cp_log_exportæ·»åŠ åç§°check_point_syslogç›®æ ‡æœåŠ¡å™¨&lt;&lt; ip_address_logstash &gt;&gt;ç›®æ ‡ç«¯å£5555åè®®tcpæ ¼å¼é€šç”¨è¯»å–æ¨¡å¼åŠç»Ÿä¸€ <br><br>  &lt;&lt; ip_address_logstash &gt;&gt;-è¿è¡ŒLogstashçš„æœåŠ¡å™¨çš„åœ°å€ï¼Œç›®æ ‡ç«¯å£5555-æˆ‘ä»¬å°†æ—¥å¿—å‘é€åˆ°çš„ç«¯å£ï¼Œé€šè¿‡tcpå‘é€æ—¥å¿—å¯ä»¥åŠ è½½æœâ€‹â€‹åŠ¡å™¨ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè®¾ç½®udpæ›´æ­£ç¡®ã€‚ <br><br><h3> åœ¨Logstashé…ç½®æ–‡ä»¶ä¸­é…ç½®INPUT </h3><br><img src="https://habrastorage.org/webt/kj/ns/qh/kjnsqhfoxgr7fqtku2tpgibgh5y.png"><br><br> é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶ä½äº/etc/logstash/conf.d/ç›®å½•ä¸­ã€‚ é…ç½®æ–‡ä»¶åŒ…å«3ä¸ªæœ‰æ„ä¹‰çš„éƒ¨åˆ†ï¼šINPUTï¼ŒFILTERï¼ŒOUTPUTã€‚ åœ¨<b>INPUTä¸­ï¼Œ</b>æˆ‘ä»¬æŒ‡ç¤ºç³»ç»Ÿå°†ä»ä½•å¤„è·å–æ—¥å¿—ï¼›åœ¨<b>FILTERä¸­ï¼Œæˆ‘ä»¬</b>åˆ†ææ—¥å¿—-é…ç½®å¦‚ä½•å°†æ¶ˆæ¯åˆ’åˆ†ä¸ºå­—æ®µå’Œå€¼ï¼›åœ¨<b>OUTPUTä¸­ï¼Œæˆ‘ä»¬</b>é…ç½®è¾“å‡ºæµ-å°†è§£æçš„æ—¥å¿—å‘é€åˆ°å“ªé‡Œã€‚ <br><br> é¦–å…ˆï¼Œé…ç½®INPUTï¼Œè€ƒè™‘ä¸€äº›å¯èƒ½çš„ç±»å‹-æ–‡ä»¶ï¼Œtcpå’Œexeã€‚ <br><br>  <b>Tcpï¼š</b> <br><br><pre> <code class="javascript hljs">input { tcp { port =&gt; <span class="hljs-number"><span class="hljs-number">5555</span></span> host =&gt; â€œ<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.205</span></span>â€ type =&gt; <span class="hljs-string"><span class="hljs-string">"checkpoint"</span></span> mode =&gt; <span class="hljs-string"><span class="hljs-string">"server"</span></span> } }</code> </pre><br> æ¨¡å¼=&gt;â€œæœåŠ¡å™¨â€ <br> è¯´Logstashæ¥å—è¿æ¥ã€‚ <br><br> ç«¯å£=&gt; 5555 <br> ä¸»æœº=&gt;â€œ 10.10.1.205â€ <br> æˆ‘ä»¬æ¥å—IPåœ°å€10.10.1.205ï¼ˆLogstashï¼‰ç«¯å£5555çš„è¿æ¥-é˜²ç«å¢™ç­–ç•¥å¿…é¡»å…è®¸è¯¥ç«¯å£ã€‚ <br><br> ç±»å‹=&gt;â€œæ£€æŸ¥ç‚¹â€ <br> æˆ‘ä»¬æ ‡è®°äº†æ–‡æ¡£ï¼Œå¦‚æœæ‚¨æœ‰å¤šä¸ªä¼ å…¥è¿æ¥ï¼Œè¿™å°†éå¸¸æ–¹ä¾¿ã€‚ åœ¨ä¸‹é¢ï¼Œå¯¹äºæ¯ä¸ªè¿æ¥ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ifé€»è¾‘æ„é€ ç¼–å†™è‡ªå·±çš„è¿‡æ»¤å™¨ã€‚ <br><br>  <b>æ¡£æ¡ˆï¼š</b> <br><br><pre> <code class="javascript hljs">input { file { path =&gt; <span class="hljs-string"><span class="hljs-string">"/var/log/openvas_report/*"</span></span> type =&gt; <span class="hljs-string"><span class="hljs-string">"openvas"</span></span> start_position =&gt; <span class="hljs-string"><span class="hljs-string">"beginning"</span></span> } }</code> </pre><br> è®¾ç½®è¯´æ˜ï¼š <br> è·¯å¾„=&gt;â€œ / var / log / openvas_report / *â€ <br> æŒ‡å®šå¿…é¡»åœ¨å…¶ä¸­è¯»å–æ–‡ä»¶çš„ç›®å½•ã€‚ <br><br> ç±»å‹=&gt;â€œ openvasâ€ <br> äº‹ä»¶ç±»å‹ã€‚ <br><br>  start_position =&gt;â€œå¼€å§‹â€ <br> æ›´æ”¹æ–‡ä»¶æ—¶ï¼Œå®ƒå°†è¯»å–æ•´ä¸ªæ–‡ä»¶ï¼›å¦‚æœæ‚¨è®¾ç½®â€œ endâ€ï¼Œåˆ™ç³»ç»Ÿç­‰å¾…æ–°æ¡ç›®å‡ºç°åœ¨æ–‡ä»¶æœ«å°¾ã€‚ <br><br>  <b>æ‰§è¡Œï¼š</b> <br><br><pre> <code class="javascript hljs">input { exec { command =&gt; <span class="hljs-string"><span class="hljs-string">"ls -alh"</span></span> interval =&gt; <span class="hljs-number"><span class="hljs-number">30</span></span> } }</code> </pre><br> åœ¨æ­¤è¾“å…¥ä¸Šï¼ˆä»…ï¼ï¼‰ï¼Œå°†å¯åŠ¨shellå‘½ä»¤å¹¶å°†å…¶è¾“å‡ºåŒ…è£…åœ¨æ—¥å¿—æ¶ˆæ¯ä¸­ã€‚ <br><br> å‘½ä»¤=&gt;â€œ ls -alhâ€ <br> æˆ‘ä»¬æ„Ÿå…´è¶£çš„è¾“å‡ºå›¢é˜Ÿã€‚ <br><br> é—´éš”=&gt; 30 <br> å‘½ä»¤è°ƒç”¨é—´éš”ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ <br><br> ä¸ºäº†ä»é˜²ç«å¢™æ¥æ”¶æ—¥å¿—ï¼Œæˆ‘ä»¬è§„å®šäº†<b>tcp</b>æˆ–<b>udp</b>è¿‡æ»¤å™¨ï¼Œå…·ä½“å–å†³äºå°†æ—¥å¿—å‘é€åˆ°Logstashçš„æ–¹å¼ã€‚ <br><br><h3> æˆ‘ä»¬ä»¥è°ƒè¯•æ–¹å¼åœ¨Logstashé…ç½®æ–‡ä»¶ä¸­é…ç½®Outputï¼Œä»¥äº†è§£æ—¥å¿—æ¶ˆæ¯çš„å¤–è§‚ </h3><br> é…ç½®INPUTä¹‹åï¼Œæˆ‘ä»¬éœ€è¦äº†è§£æ—¥å¿—æ¶ˆæ¯çš„å¤–è§‚ï¼Œåº”ä½¿ç”¨ä»€ä¹ˆæ–¹æ³•æ¥é…ç½®æ—¥å¿—çš„è¿‡æ»¤å™¨ï¼ˆè§£æå™¨ï¼‰ã€‚ <br><br> ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿‡æ»¤å™¨åœ¨stdoutä¸­æ˜¾ç¤ºç»“æœï¼Œä»¥æŸ¥çœ‹åŸå§‹æ¶ˆæ¯ï¼Œæ­¤åˆ»çš„å®Œæ•´é…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="javascript hljs">input { tcp { port =&gt; <span class="hljs-number"><span class="hljs-number">5555</span></span> type =&gt; <span class="hljs-string"><span class="hljs-string">"checkpoint"</span></span> mode =&gt; <span class="hljs-string"><span class="hljs-string">"server"</span></span> host =&gt; â€œ<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.205</span></span>â€ } } output { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [type] == <span class="hljs-string"><span class="hljs-string">"checkpoint"</span></span> { stdout { codec=&gt; json } } }</code> </pre><br> è¿è¡Œå‘½ä»¤ä»¥éªŒè¯ï¼š <br>  sudo / usr / share / logstash / bin // logstash -f /etc/logstash/conf.d/checkpoint.conf <br> æˆ‘ä»¬çœ‹åˆ°ç»“æœï¼Œå›¾ç‰‡æ˜¯å¯ç‚¹å‡»çš„ï¼š <br><br> <a href=""><img src="https://habrastorage.org/webt/is/ow/a-/isowa-1j75fxrivpctqdjtvn_x8.png"></a> <br><br> å¦‚æœå¤åˆ¶å®ƒï¼Œå®ƒå°†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="plaintext hljs">action=\"Accept\" conn_direction=\"Internal\" contextnum=\"1\" ifdir=\"outbound\" ifname=\"bond1.101\" logid=\"0\" loguid=\"{0x5dfb8c13,0x5,0xfe0a0a0a,0xc0000000}\" origin=\"10.10.10.254\" originsicname=\"CN=ts-spb-cpgw-01,O=cp-spb-mgmt-01.tssolution.local.kncafb\" sequencenum=\"8\" time=\"1576766483\" version=\"5\" context_num=\"1\" dst=\"10.10.10.10\" dst_machine_name=\"ts-spb-dc-01@tssolution.local\" layer_name=\"TSS-Standard Security\" layer_name=\"TSS-Standard Application\" layer_uuid=\"dae7f01c-4c98-4c3a-a643-bfbb8fcf40f0\" layer_uuid=\"dbee3718-cf2f-4de0-8681-529cb75be9a6\" match_id=\"8\" match_id=\"33554431\" parent_rule=\"0\" parent_rule=\"0\" rule_action=\"Accept\" rule_action=\"Accept\" rule_name=\"Implicit Cleanup\" rule_uid=\"6dc2396f-9644-4546-8f32-95d98a3344e6\" product=\"VPN-1 &amp; FireWall-1\" proto=\"17\" s_port=\"37317\" service=\"53\" service_id=\"domain-udp\" src=\"10.10.1.180\" ","type":"qqqqq","host":"10.10.10.250","@version":"1","port":50620}{"@timestamp":"2019-12-19T14:50:12.153Z","message":"time=\"1576766483\" action=\"Accept\" conn_direction=\"Internal\" contextnum=\"1\" ifdir=\"outbound\" ifname=\"bond1.101\" logid=\"0\" loguid=\"{0x5dfb8c13,</code> </pre><br> é€šè¿‡æŸ¥çœ‹è¿™äº›æ¶ˆæ¯ï¼Œæˆ‘ä»¬äº†è§£åˆ°æ—¥å¿—å…·æœ‰ä»¥ä¸‹å½¢å¼ï¼šfield = valueæˆ–key = valueï¼Œè¿™æ„å‘³ç€ç§°ä¸ºkvçš„è¿‡æ»¤å™¨æ˜¯åˆé€‚çš„ã€‚ ä¸ºäº†ä¸ºæ¯ç§æƒ…å†µé€‰æ‹©åˆé€‚çš„è¿‡æ»¤å™¨ï¼Œæœ€å¥½åœ¨æŠ€æœ¯æ–‡æ¡£ä¸­ç†Ÿæ‚‰è¿‡æ»¤å™¨ï¼Œæˆ–è€…è¯¢é—®æœ‹å‹ã€‚ <br><br><h3> è‡ªå®šä¹‰è¿‡æ»¤å™¨ </h3><br> åœ¨æœ€åé˜¶æ®µï¼Œä»–ä»¬é€‰æ‹©äº†kvï¼Œç„¶åæ˜¾ç¤ºäº†æ­¤è¿‡æ»¤å™¨çš„é…ç½®ï¼š <br><br><pre> <code class="javascript hljs">filter { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [type] == <span class="hljs-string"><span class="hljs-string">"checkpoint"</span></span>{ kv { value_split =&gt; <span class="hljs-string"><span class="hljs-string">"="</span></span> allow_duplicate_values =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } }</code> </pre><br> æˆ‘ä»¬é€‰æ‹©å°†ç”¨æ¥åˆ’åˆ†å­—æ®µå’Œå€¼-â€œ =â€çš„ç¬¦å·ã€‚ å¦‚æœæ—¥å¿—ä¸­æœ‰ç›¸åŒçš„æ¡ç›®ï¼Œåˆ™æˆ‘ä»¬åªä¼šåœ¨æ•°æ®åº“ä¸­ä¿å­˜ä¸€ä¸ªå®ä¾‹ï¼Œå¦åˆ™æ‚¨å°†è·å¾—ä¸€ä¸ªå…·æœ‰ç›¸åŒå€¼çš„æ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬æ”¶åˆ°æ¶ˆæ¯â€œ foo = some foo = someâ€ï¼Œåˆ™ä»…å†™å…¥foo = someã€‚ <br><br><h3> åœ¨ElasticSearchä¸­é…ç½®æ­£ç¡®çš„è¾“å‡º </h3><br> é…ç½®è¿‡æ»¤å™¨åï¼Œå¯ä»¥å°†æ—¥å¿—ä¸Šä¼ åˆ°<b>elasticsearch</b>æ•°æ®åº“ï¼š <br><br><pre> <code class="javascript hljs">output { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [type] == <span class="hljs-string"><span class="hljs-string">"checkpoint"</span></span> { elasticsearch { hosts =&gt; [<span class="hljs-string"><span class="hljs-string">"10.10.1.200:9200"</span></span>] index =&gt; <span class="hljs-string"><span class="hljs-string">"checkpoint-%{+YYYY.MM.dd}"</span></span> user =&gt; <span class="hljs-string"><span class="hljs-string">"tssolution"</span></span> password =&gt; <span class="hljs-string"><span class="hljs-string">"cool"</span></span> } } }</code> </pre><br> å¦‚æœæ–‡æ¡£ä½¿ç”¨æ£€æŸ¥ç‚¹ç±»å‹ç­¾åï¼Œåˆ™å°†äº‹ä»¶ä¿å­˜åˆ°elasticsearchæ•°æ®åº“ï¼Œè¯¥æ•°æ®åº“é»˜è®¤æ¥å—10.10.1.200åˆ°ç«¯å£9200çš„è¿æ¥ã€‚ æ¯ä¸ªæ–‡æ¡£éƒ½ä¿å­˜åœ¨ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•ä¸­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä¿å­˜åœ¨ç´¢å¼•â€œ checkpoint-â€ +å½“å‰æ—¶é—´ä¸­ã€‚ æ¯ä¸ªç´¢å¼•å¯ä»¥å…·æœ‰ä¸€ç»„ç‰¹å®šçš„å­—æ®µï¼Œæˆ–è€…åœ¨æ¶ˆæ¯ä¸­å‡ºç°æ–°å­—æ®µæ—¶è‡ªåŠ¨åˆ›å»ºè¯¥ç´¢å¼•ï¼Œå¯ä»¥åœ¨æ˜ å°„ä¸­æŸ¥çœ‹å­—æ®µè®¾ç½®åŠå…¶ç±»å‹ã€‚ <br><br> å¦‚æœæ‚¨é…ç½®äº†èº«ä»½éªŒè¯ï¼ˆæˆ‘ä»¬å°†åœ¨ä»¥åè®¨è®ºï¼‰ï¼Œåˆ™å¿…é¡»æŒ‡å®šç”¨äºå†™å…¥ç‰¹å®šç´¢å¼•çš„ä¿¡ç”¨ï¼Œåœ¨æœ¬ç¤ºä¾‹ä¸­ä¸ºâ€œ tssolutionâ€ï¼Œå¯†ç ä¸ºâ€œ coolâ€ã€‚ æ‚¨å¯ä»¥åŒºåˆ†åªå°†æ—¥å¿—å†™å…¥ç‰¹å®šç´¢å¼•è€Œä¸èƒ½å†å†™å…¥æ›´å¤šæ—¥å¿—çš„ç”¨æˆ·æƒé™ã€‚ <br><br><h3> å¯åŠ¨Logstashã€‚ </h3><br>  Logstashé…ç½®æ–‡ä»¶ï¼š <br><br><pre> <code class="javascript hljs">input { tcp { port =&gt; <span class="hljs-number"><span class="hljs-number">5555</span></span> type =&gt; <span class="hljs-string"><span class="hljs-string">"checkpoint"</span></span> mode =&gt; <span class="hljs-string"><span class="hljs-string">"server"</span></span> host =&gt; â€œ<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.205</span></span>â€ } } filter { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [type] == <span class="hljs-string"><span class="hljs-string">"checkpoint"</span></span>{ kv { value_split =&gt; <span class="hljs-string"><span class="hljs-string">"="</span></span> allow_duplicate_values =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } } output { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [type] == <span class="hljs-string"><span class="hljs-string">"checkpoint"</span></span> { elasticsearch { hosts =&gt; [<span class="hljs-string"><span class="hljs-string">"10.10.1.200:9200"</span></span>] index =&gt; <span class="hljs-string"><span class="hljs-string">"checkpoint-%{+YYYY.MM.dd}"</span></span> user =&gt; <span class="hljs-string"><span class="hljs-string">"tssolution"</span></span> password =&gt; <span class="hljs-string"><span class="hljs-string">"cool"</span></span> } } }</code> </pre><br> æ£€æŸ¥é…ç½®æ–‡ä»¶ä»¥è¿›è¡Œæ­£ç¡®çš„ç¼–è¯‘ï¼š <br>  / usr / share / logstash / bin // logstash -f checkpoint.conf <br><img src="https://habrastorage.org/webt/lb/1v/w5/lb1vw57djb7xm_lohxwbvzuygwy.png"><br><br> æˆ‘ä»¬å¼€å§‹Logstashæµç¨‹ï¼š <br> é¡»è—¤systemctlå¯åŠ¨logstash <br><br> æ£€æŸ¥è¯¥è¿‡ç¨‹æ˜¯å¦å·²å¼€å§‹ï¼š <br>  sudo systemctlçŠ¶æ€logstash <br><br><img src="https://habrastorage.org/webt/nh/ug/jw/nhugjwysxvwiras5r34w8ajqlxc.png"><br><br> æ£€æŸ¥æ’åº§æ˜¯å¦å‡é«˜ï¼š <br>  netstat -nat | grep 5555 <br><br><img src="https://habrastorage.org/webt/n4/xn/jg/n4xnjgwriabmksyhvdfbskgkeau.png"><br><br><h3> æ£€æŸ¥Kibanaä¸­çš„æ—¥å¿—ã€‚ </h3><br> ä¸€åˆ‡å¼€å§‹ä¹‹åï¼Œè½¬åˆ°Kibana-å‘ç°ï¼Œç¡®ä¿ä¸€åˆ‡é…ç½®æ­£ç¡®ï¼Œå›¾ç‰‡å¯å•å‡»ï¼ <br><br> <a href=""><img src="https://habrastorage.org/webt/dx/4c/mg/dx4cmgg4v5fld2r6ignxbqyqsew.png"></a> <br><br> æ‰€æœ‰æ—¥å¿—éƒ½å·²å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰å­—æ®µåŠå…¶å€¼ï¼ <br><br><h3> ç»“è®º </h3><br> æˆ‘ä»¬ç ”ç©¶äº†å¦‚ä½•ç¼–å†™Logstashé…ç½®æ–‡ä»¶ï¼Œç»“æœå¾—åˆ°äº†æ‰€æœ‰å­—æ®µå’Œå€¼çš„è§£æå™¨ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æŸäº›å­—æ®µè¿›è¡Œæœç´¢å’Œç»˜åˆ¶å›¾è¡¨ã€‚ åœ¨æœ¬è¯¾ç¨‹çš„ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†è€ƒè™‘åœ¨Kibanaä¸­è¿›è¡Œå¯è§†åŒ–ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„ä»ªè¡¨æ¿ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è¦å°†å­—æ®µå€¼ä»æ•°å­—æ›¿æ¢ä¸ºå•è¯æ—¶ï¼Œå¿…é¡»ä¸æ–­æ·»åŠ Logstashé…ç½®æ–‡ä»¶ã€‚ åœ¨åç»­æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å§‹ç»ˆè¿™æ ·åšã€‚ <br><br> æ‰€ä»¥è¯·ç»§ç»­å…³æ³¨ï¼ˆ <a href="https://t.me/tssolution">Telegram</a> ï¼Œ <a href="https://www.facebook.com/groups/tssolution.info/">Facebook</a> ï¼Œ <a href="https://vk.com/ts_solution">VK</a> ï¼Œ <a href="https://tssolution.ru/blog">TS Solution Blog</a> ï¼‰ï¼Œ <a href="https://zen.yandex.ru/id/5c7d2162fa818600ae386a52">Yandex.Zen</a> ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN481960/">https://habr.com/ru/post/zh-CN481960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN481950/index.html">æ•™ç¨‹ï¼šå“åº”å¼Spring Boot</a></li>
<li><a href="../zh-CN481952/index.html">æ—¥ç«‹äººæ­»äºé‡ç—…ï¼Œé‡å‡»å’ŒæŠ€æœ¯æ€§è‚¾ç—…</a></li>
<li><a href="../zh-CN481954/index.html">æˆ‘å¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆå¯ä»¥å…¥ä¾µVR</a></li>
<li><a href="../zh-CN481956/index.html">å¯»æ‰¾å¤±è¸ªçš„ç¨‹åºå‘˜ã€‚ æ–°å¹´çš„è¿½æ±‚</a></li>
<li><a href="../zh-CN481958/index.html">æ‚¨ä»€ä¹ˆæ—¶å€™åœ¨mail.ruä¸­ç­¾åï¼Œæˆ–è€…å¦‚ä½•é€šè¿‡é‚®ä»¶ç•Œé¢ç©¿è¶ŠT-34æˆ˜è½¦</a></li>
<li><a href="../zh-CN481964/index.html">å¦‚ä½•ç»„ç»‡å‘å¸ƒ</a></li>
<li><a href="../zh-CN481970/index.html">â€œè¢«é—å¿˜çš„éŸ³é¢‘æ ¼å¼å’Œåª’ä½“â€ï¼šç´§å‡‘éŸ³é¢‘æ—¶ä»£çš„å¼€å§‹æˆ–ç­’ç®¡çš„â€œé¦–æ¬¡å˜é©â€</a></li>
<li><a href="../zh-CN481974/index.html">ä½¿ç”¨ç¥ç»ç½‘ç»œæµ‹è¯•è¥¿ç“œï¼šå®Œæ•´ç‰ˆã€‚ ä»åŸå‹åˆ°åº”ç”¨ç¨‹åºçš„å¾ªç¯ã€‚ åœ¨Google Play</a></li>
<li><a href="../zh-CN481978/index.html">å¦‚ä½•ç»„ç»‡åˆ†å¸ƒå¼å¸ƒå±€å›¢é˜Ÿçš„æœ‰æ•ˆå·¥ä½œ</a></li>
<li><a href="../zh-CN481980/index.html">æˆ‘ä»¬å¦‚ä½•åœ¨Unityä¸­ä¼˜åŒ–è„šæœ¬</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>