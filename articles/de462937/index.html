<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñåÔ∏è üêÆ üí™üèΩ Das Konzept der persistenten Struktur zur Steuerung der IT-Infrastruktur üë¶üèæ üñêüèº üë®üèæ‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo an alle. Ich werde Ihnen etwas √ºber Microservices erz√§hlen, aber aus einem etwas anderen Blickwinkel als Vadim Madison im Beitrag "Was wissen wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Das Konzept der persistenten Struktur zur Steuerung der IT-Infrastruktur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/462937/"><p>  Hallo an alle.  Ich werde Ihnen etwas √ºber Microservices erz√§hlen, aber aus einem etwas anderen Blickwinkel als Vadim Madison im Beitrag <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Was wissen wir √ºber Microservices?"</a> .  Im Allgemeinen betrachte ich mich als Datenbankentwickler.  Was haben Microservices damit zu tun?  Avito verwendet: Vertica, PostgreSQL, Redis, MongoDB, Tarantool, VoltDB, SQLite ... Insgesamt haben wir mehr als 456 Datenbanken f√ºr mehr als 849 Dienste.  Und irgendwie musst du damit leben. </p><br><p>  In diesem Beitrag werde ich Ihnen erz√§hlen, wie wir die Datenerkennung in der Microservice-Architektur implementiert haben.  Dieser Beitrag ist eine kostenlose Abschrift meines Berichts mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Highload ++ 2018</a> , das Video kann hier angesehen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden</a> . </p><br><p><img src="https://habrastorage.org/webt/bj/wt/e3/bjwte39wtxw3c5gk5w-1bfu_hfk.png"></p><a name="habracut"></a><br><p>  Jeder sollte wissen, wie eine Microservice-Architektur in Bezug auf Basen aufgebaut werden sollte.  Hier ist das Muster, mit dem normalerweise jeder beginnt.  Es gibt eine gemeinsame Basis zwischen den Diensten.  Auf der Folie sind die orangefarbenen Rechtecke Dienste, zwischen denen gibt es eine gemeinsame Basis. </p><br><p><img src="https://habrastorage.org/webt/vc/t7/xw/vct7xwnbj875pu2fusp_xaahcwg.png"></p><br><p>  Sie k√∂nnen nicht so leben, da Sie Dienste nicht isoliert testen k√∂nnen, wenn neben der direkten Kommunikation zwischen ihnen auch die Kommunikation √ºber die Datenbank erfolgt.  Eine Dienstanforderung kann einen anderen Dienst verlangsamen.  Das ist schlecht. </p><br><p><img src="https://habrastorage.org/webt/fv/ax/ze/fvaxzevgnmj7lkfqehybl1jv7uc.png"></p><br><p>  Unter dem Gesichtspunkt der Arbeit mit Datenbanken f√ºr die Microservice-Architektur sollte das DataBase-per-Service-Muster verwendet werden - jeder Service verf√ºgt √ºber eine eigene Datenbank.  Wenn die Datenbank viele Shards enth√§lt, sollte die Basis gemeinsam genutzt werden, damit sie synchronisiert werden.  Dies ist eine Theorie, aber in Wirklichkeit ist es nicht so. </p><br><p><img src="https://habrastorage.org/webt/il/pt/yz/ilptyzfojo0wsiclxhggpj47mag.png"></p><br><p>  In realen Unternehmen verwenden sie nicht nur Microservices, sondern auch einen Monolithen.  Es sind Dienste richtig geschrieben.  Und es gibt alte Dienste, die immer noch ein gemeinsames Basismuster verwenden. </p><br><p>  Vadim Madison zeigte bei seiner Pr√§sentation dieses Bild mit Verbundenheit.  Nur er zeigte es ohne eine Komponente, und das Netzwerk darin war einheitlich.  In diesem Netzwerk in der Mitte gibt es einen Punkt, der mit vielen Punkten verbunden ist (Microservices).  Dies ist ein Monolith.  Es ist klein im Diagramm.  Tats√§chlich ist der Monolith jedoch gro√ü.  Wenn wir √ºber ein echtes Unternehmen sprechen, m√ºssen Sie die Nuancen der Koexistenz von Mikroservice, geborener und aufgeschlossener, aber immer noch wichtiger monolithischer Architektur verstehen. </p><br><p>  Wie schreibt ein Monolith auf Planungsebene in eine Microservice-Architektur um?  Dies ist nat√ºrlich eine Dom√§nenmodellierung.  √úberall hei√üt es, dass Sie eine Dom√§nenmodellierung durchf√ºhren m√ºssen.  Zum Beispiel haben wir in Avito mehrere Jahre lang Microservices ohne Dom√§nenmodellierung erstellt.  Dann habe ich es und die Datenbankentwickler aufgenommen.  Uns sind vollst√§ndige Datenstr√∂me bekannt.  Dieses Wissen hilft beim Entwerfen eines Dom√§nenmodells. </p><br><p><img src="https://habrastorage.org/webt/wr/kk/qa/wrkkqaxqq5wd-2gwilprpsroqhm.png"></p><br><p>  Die Datenermittlung hat eine klassische Interpretation - so wird mit Daten gearbeitet, die √ºber verschiedene Speicher verteilt sind, um zu aggregierten Schlussfolgerungen zu f√ºhren und korrekte Schlussfolgerungen zu ziehen.  Das ist eigentlich alles Marketing-Bullshit.  In diesen Definitionen wird beschrieben, wie alle Daten von Microservices in den Speicher heruntergeladen werden.  Dar√ºber hatte ich vor einigen Jahren Berichte, wir werden nicht weiter darauf eingehen. </p><br><p>  Ich erz√§hle Ihnen von einem anderen Prozess, der dem Prozess der Umstellung auf Microservices n√§her kommt.  Ich m√∂chte einen Weg zeigen, wie Sie die Komplexit√§t eines sich st√§ndig weiterentwickelnden Systems in Bezug auf Daten und Mikrodienste verstehen k√∂nnen.  Wo kann man das ganze Bild von Hunderten von Diensten, St√ºtzpunkten, Teams und Menschen sehen?  Tats√§chlich ist diese Frage die Hauptidee des Berichts. </p><br><p><img src="https://habrastorage.org/webt/uw/_a/l7/uw_al7h6mh9otso2s6sxie3fzhs.png"></p><br><p>  Um in dieser Microservice-Architektur nicht zu sterben, ben√∂tigen Sie einen digitalen Zwilling.  Ihr Unternehmen ist die Gesamtheit von allem, was die technologische Infrastruktur bereitstellt.  Sie m√ºssen ein angemessenes Bild all dieser Schwierigkeiten erstellen, auf dessen Grundlage Sie Probleme schnell l√∂sen k√∂nnen.  Und dies ist kein analytisches Repository. </p><br><p><img src="https://habrastorage.org/webt/85/hf/p_/85hfp_vxlagi-frp4cwssioo_eg.png"></p><br><p>  Welche Aufgaben k√∂nnen wir f√ºr einen solchen digitalen Zwilling stellen?  Schlie√ülich begann alles mit der einfachsten Datenerkennung. </p><br><p>  <strong>Fragen:</strong> </p><br><ul><li>  Welche Dienste speichern wichtige Daten? </li><li>  In welchen personenbezogenen Daten sind keine Daten gespeichert? </li><li>  Sie haben Hunderte von Basen.  Welche pers√∂nlichen Daten gibt es?  Und in welchem ‚Äã‚Äãnicht? </li><li>  Wie flie√üen wichtige Daten zwischen Diensten? </li><li>  Zum Beispiel hatte der Dienst keine pers√∂nlichen Daten, und dann fing er an, den Bus zu h√∂ren, und sie erschienen.  Wo werden die Daten kopiert, wenn sie gel√∂scht werden? </li><li>  Wer kann mit welchen Daten arbeiten? </li><li>  Wer kann direkt √ºber den Dienst zugreifen, einige √ºber die Datenbank, andere √ºber den Bus? </li><li>  Wer kann √ºber einen anderen Dienst das API-Handle (Anfrage) abrufen und etwas herunterladen? </li></ul><br><p>  Die Antwort auf diese Fragen ist fast immer ein Diagramm der Elemente, ein Diagramm der Beziehungen.  Dieses Diagramm muss mit neuen Daten gef√ºllt, aktualisiert und gepflegt werden.  Wir haben uns entschlossen, dieses Diagramm Persistent Fabric (in √úbersetzung - Erinnerung an Fabric) zu nennen.  Hier ist seine Visualisierung. </p><br><p><img src="https://habrastorage.org/webt/9l/qx/fg/9lqxfghwxvo7qdyfpvbz5zyj1m0.png"></p><br><p>  Mal sehen, was in diesem Erinnerungsstoff sein kann. </p><br><p>  <strong>Schnittstellenpunkte</strong> .  Dies sind Elemente der Benutzerinteraktion mit der grafischen Oberfl√§che.  Auf einer Seite k√∂nnen sich mehrere UI-Punkte befinden.  Dies sind relativ gesehen benutzerdefinierte Schl√ºsselaktionen. </p><br><p>  <strong>Endpunkte</strong> .  UI-Punkte ruckeln Endpunkte.  In der russischen Tradition nennt man dies Stifte.  Handles von Dienstleistungen.  Endpunkte ziehen Dienste. </p><br><p>  <strong>Dienstleistungen</strong>  Hunderte von Dienstleistungen.  Dienste sind miteinander verbunden.  Wir verstehen, welcher Dienst den Dienst ziehen kann.  Wir wissen, welcher Aufruf von UI-Punkten welche Dienste in der Kette aufrufen kann. </p><br><p>  <strong>Grundlagen (im logischen Sinne)</strong> .  Die Basis als Speicherbegriff klingt schlecht, da sich dieser Begriff auf etwas Analytisches bezieht.  Nun betrachten wir die Datenbank als Speicher.  Zum Beispiel Redis, PostgreSQL, Tarantool.  Wenn ein Dienst eine Datenbank verwendet, werden normalerweise mehrere Datenbanken verwendet. </p><br><ul><li>  Zur langfristigen Datenspeicherung beispielsweise PostgreSQL. </li><li>  Redis wird als Cache verwendet. </li><li>  Tarantool, das schnell etwas im Datenstrom berechnen kann. </li></ul><br><p>  <strong>Gastgeber</strong>  Die Datenbank verf√ºgt √ºber eine Bereitstellung f√ºr Hosts.  Eine Basis, ein Redis kann tats√§chlich auf 16 Maschinen (Master Ring) und ein weiterer 16 Live Slave leben.  Dies gibt Aufschluss dar√ºber, auf welche Server Sie den Zugriff beschr√§nken m√ºssen, damit einige wichtige Daten nicht verloren gehen. </p><br><p>  <strong>Entit√§ten</strong> .  Entit√§ten werden in den Datenbanken gespeichert.  Beispiele f√ºr Entit√§ten: Benutzer, Ank√ºndigung, Zahlung.  Entit√§ten k√∂nnen in mehreren Datenbanken gespeichert werden.  Und hier ist es wichtig, nicht nur zu wissen, dass diese Entit√§t da ist.  Es ist wichtig zu wissen, dass diese Entit√§t einen Speicher hat, der Golden Source ist.  Goldene Quelle ist die Basis, auf der eine Entit√§t erstellt und bearbeitet wird.  Alle anderen Basen sind funktionale Caches.  Ein wichtiger Punkt.  Wenn eine Entit√§t, Gott bewahre, zwei goldene Quellen hat, ist eine m√ºhsame Koordination der getrennten Quellen notwendig.  Die Entit√§ten in der Datenbank m√ºssen Zugriff auf den Dienst erhalten, wenn wir diesen Dienst mit neuen Funktionen erweitern m√∂chten. </p><br><p>  <strong>Teams</strong> .  Teams, denen die Dienste geh√∂ren.  Ein Dienst, der nicht zu Teams geh√∂rt, ist ein schlechter Dienst.  Es f√§llt ihm schwer, jemanden zu finden, der daf√ºr verantwortlich ist. </p><br><p>  Jetzt werde ich stark mit dem Bericht von Vadim Madison korrelieren, weil er erw√§hnte, dass die Person, die als letzte dort begangen hat, sich in den Diensten widerspiegelt.  Dies ist ein guter Ausgangspunkt.  Aber auf lange Sicht ist das schlecht, weil die Person, die zuletzt dort begangen hat, k√ºndigen kann. </p><br><p>  Daher m√ºssen Sie das Team, die Personen in ihnen und ihre Rolle kennen.  Wir haben ein so einfaches Diagramm, in dem sich auf jeder Ebene mehrere hundert Elemente befinden.  Kennen Sie ein System, in dem all dies gespeichert werden kann? </p><br><p>  Der entscheidende Punkt.  Damit dieser best√§ndige Stoff lebt, muss er sich nicht nur einmal f√ºllen.  Dienste werden erstellt, sie sterben, Speicher wird zugewiesen, sie bewegen sich auf den Servern, Teams werden erstellt, kaputt gemacht, Personen wechseln zu anderen Teams.  Entit√§ten sind neu, werden zu neuen Diensten hinzugef√ºgt und gel√∂scht.  Endpunkte werden erstellt, registriert und Benutzertrajektorien aus Sicht der GUI werden ebenfalls erneuert.  Das Wichtigste ist nicht, dass Sie es irgendwo technisch aufbewahren m√ºssen.  Das Wichtigste ist, dass jede Schicht aus best√§ndigem Stoff frisch und aktuell ist.  Dass es aktualisiert wird. </p><br><p>  Ich schlage vor, durch die Schichten zu gehen.  Ich werde veranschaulichen, wie wir es machen.  Ich werde zeigen, wie dies auf der Ebene einzelner Ebenen m√∂glich ist. </p><br><p><img src="https://habrastorage.org/webt/pw/yn/s1/pwyns16y-x0hlef3sbs3ue3ljry.png"></p><br><p>  Informationen √ºber das Team k√∂nnen der Organisationsstruktur von 1C entnommen werden.  Hier m√∂chte ich veranschaulichen, dass Persistent Fabric nicht das gesamte riesige Diagramm ausf√ºllen muss, um es zu f√ºllen.  Jede Schicht muss korrekt gef√ºllt sein. </p><br><p><img src="https://habrastorage.org/webt/qp/xs/we/qpxswe2pdci_ztpaiogokjmdhdu.png"></p><br><p>  Informationen √ºber Personen k√∂nnen aus LDAP entnommen werden.  Eine Person kann in verschiedenen Teams unterschiedliche Rollen √ºbernehmen.  Das ist absolut normal.  Jetzt haben wir das Avito People-System erstellt und daraus die Bindung von Personen an Teams und deren Rollen.  Das Wichtigste ist, dass solche einfachen Daten so gespeichert werden, dass sie zumindest Links zu den Enden der Links enthalten, sodass die Teamnamen den Teams aus der 1C-Organisationsstruktur entsprechen. </p><br><p><img src="https://habrastorage.org/webt/am/zp/l1/amzpl1b-c9bxgfyraff5hszrh_8.png"></p><br><p>  <strong>Dienstleistungen</strong>  F√ºr den Service ben√∂tigen Sie den Namen und das Team, dem er geh√∂rt.  Die Quelle ist Service Discovery.  Dies ist das System, das Vadim Madison unter dem Namen Atlas erw√§hnte.  Atlas ist ein allgemeines Dienstleistungsregister. </p><br><p>  Es ist hilfreich zu verstehen, dass fast alle Systeme wie Atlas Informationen √ºber 95% der Dienste speichern.  5% der Dienste in solchen Systemen fehlen, weil  alte Dienste ohne Registrierung in Atlas erstellt.  Und wenn Sie anfangen, mit diesem Schema zu arbeiten, sp√ºren Sie, was Ihnen fehlt. </p><br><p><img src="https://habrastorage.org/webt/1e/vc/mo/1evcmoycczxblnbdje8pb3jgbto.png"></p><br><p>  <strong>Speicher</strong> sind generische Repositories.  Es kann PostgreSQL, MongoDB, Memcache, Vertica sein.  Wir haben mehrere Quellen f√ºr die Speichererkennung.  NoSQL-Datenbanken verwenden ihre eigene H√§lfte des Atlas.  F√ºr Informationen zu PostgreSQL-Datenbanken wird Yaml-Parsing verwendet.  Sie m√∂chten jedoch ihre Speichererkennung korrekter gestalten. </p><br><p><img src="https://habrastorage.org/webt/uk/kd/e_/ukkde_ys0c44uyk6wexiycnxlsw.png"></p><br><p>  Speicher und Informationen dar√ºber, was der Dienst verwendet, gut oder besitzt (dies sind verschiedene Arten) Speicher.  Alles, was ich beschrieben habe, ist im Prinzip recht einfach und kann sogar in Google Sheets ausgef√ºllt werden. </p><br><p>  Was kann man damit machen?  Stellen wir uns vor, dies ist eine Grafik.  Wie arbeite ich mit dem Diagramm?  F√ºgen Sie es der Diagrammbasis hinzu.  Zum Beispiel in Neo4j.  Dies sind bereits Beispiele f√ºr reale Abfragen und Beispiele f√ºr die Ergebnisse dieser Abfragen. </p><br><p><img src="https://habrastorage.org/webt/-3/oi/df/-3oidf3lu-h4wxgov4-rwjqequq.png"></p><br><p>  Das erste Szenario.  Wir m√ºssen der Basis Rechte erteilen.  Die Basis sollte ausschlie√ülich in Betrieb sein.  Es sollte nur diesen Service und nur Mitglieder des Teams enthalten, dem der Service geh√∂rt.  Aber wir leben in der realen Welt.  Sehr oft finden es andere Teams n√ºtzlich, zur Basis eines anderen Dienstes zu gehen.  Frage: Wen soll man nach der Gew√§hrung von Rechten fragen?  Das wirklich gro√üe Problem ist, dass Hunderte von St√ºtzpunkten verstehen, wer verantwortlich ist.  Trotz der Tatsache, dass derjenige, der es erstellt hat, vor langer Zeit gek√ºndigt oder in eine andere Position versetzt wurde oder sich √ºberhaupt nicht daran erinnert, wer damit arbeitet. </p><br><p>  Und hier ist die einfachste Grafikabfrage (Neo4j).  Sie ben√∂tigen Zugriff auf den Speicher.  Sie wechseln vom Speicher zum Dienst, dem es geh√∂rt.  Gehen Sie zu dem Team, dem der Service geh√∂rt.  F√ºr den Service erfahren Sie, wen dieses TechLead-Team hat.  In Avito haben Produktteams einen technischen Manager und einen Produktmanager, die bei den Grundlagen nicht helfen k√∂nnen.  Nur die H√§lfte der Anfrage wird tats√§chlich auf der Folie angezeigt.  Der Zugriff auf Speicher ist keine atomare Operation.  Um auf den Speicher zuzugreifen, m√ºssen Sie auf die Server zugreifen, auf denen er installiert ist.  Dies ist eine ziemlich interessante separate Aufgabe. </p><br><p><img src="https://habrastorage.org/webt/jh/tr/mj/jhtrmjkc8podppfie6bfqe5eje8.png"></p><br><p>  Um dies zu l√∂sen, f√ºgen wir eine neue Entit√§t hinzu.  Dies ist eine Installation.  Hier ist das terminologische Problem.  Es gibt Speicher, zum Beispiel Redis Base (Redis: Adresse).  Es gibt einen Host - es kann sich um eine physische Maschine, einen lxc-Container oder Kubernetes handeln.  Die Installation des Speichers auf dem Host wird als Instanz bezeichnet. </p><br><p>  Es kann vier Installationen auf drei Hosts haben, wie im obigen Beispiel gezeigt.  Es ist ratsam, Speicher f√ºr die Produktion auf separaten physischen Maschinen zu installieren, um die Leistung zu steigern.  In einer Entwicklungsumgebung m√ºssen Sie lediglich auf einem Host installieren und Redis verschiedene Ports zuweisen. </p><br><p><img src="https://habrastorage.org/webt/t6/zl/pf/t6zlpfpuqnhzojgr9csffdljnji.png"></p><br><p>  Der erste Antrag auf Erteilung von Rechten an der Basis ging an den Kopf.  Der Leiter best√§tigte, dass die Rechte gew√§hrt werden k√∂nnen. </p><br><p>  Als n√§chstes kommt der zweite Teil der Anfrage.  Die zweite Anforderung vom Speicher geht an die Instanz und den Host.  Diese Anforderung ber√ºcksichtigt alle Installationen f√ºr die entsprechende Umgebung.  Auf der Folie befindet sich ein Beispiel f√ºr eine Produktionsumgebung.  Auf dieser Grundlage werden bereits Rechte zum Herstellen einer Verbindung zu bestimmten Hosts und bestimmten Ports erteilt.  Dies war ein Beispiel f√ºr eine Zuschussanfrage f√ºr einen Mitarbeiter au√üerhalb des Teams. </p><br><p><img src="https://habrastorage.org/webt/dz/aq/hk/dzaqhkkreobrnhfdyivpq078vha.png"></p><br><p>  Stellen Sie sich ein Beispiel vor, wenn ein Team einen neuen Mitarbeiter einstellen muss.  Er muss Zugriff (f√ºr den Anfang - schreibgesch√ºtzt) auf alle Dienste und auf alle Speicher dieses Befehls erhalten.  Auf der Folie das echte Team mit einer unvollst√§ndigen Auswahl.  Gr√ºne Kreise sind Teamleiter.  Rosa Kreise sind Teams.  Gelb sind Dienstleistungen.  Einige gelbe Dienste haben blauen Speicher.  Graue sind Gastgeber.  Violett ist die Installation von Speicher auf Hosts.  Dies ist ein Beispiel f√ºr eine kleine Einheit.  Es gibt jedoch viele Einheiten, deren Dienste nicht 7, sondern 27 sind. F√ºr solche Einheiten ist das Bild gro√ü.  Wenn Sie Persistent Fabric verwenden, k√∂nnen Sie darin Anforderungen stellen und Antworten in einer Liste erhalten. </p><br><p><img src="https://habrastorage.org/webt/40/-v/tv/40-vtvltatfneyrxw7qhfbw10cs.png"></p><br><p>  Lassen Sie uns weiterhin unseren intelligenten Stoff f√ºllen und √ºber Gesch√§ftseinheiten sprechen.  Entit√§ten in Avito sind Ank√ºndigungen, Benutzer, Zahlungen usw.  Aus meinen Ver√∂ffentlichungen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HP Vertica, Entwerfen eines Data Warehouse, Big Data</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vertica + Anchor Modeling =</a> Fangen Sie an, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ihren Pilz zu</a> z√ºchten) √ºber Data Warehouses wissen Sie, dass es in Avito Hunderte dieser Entit√§ten gibt.  Tats√§chlich m√ºssen nicht alle protokolliert werden.  Woher bekomme ich eine Liste der Entit√§ten?  Aus dem Analyse-Repository.  Sie k√∂nnen Informationen dar√ºber hochladen, woher diese Entit√§t stammt.  In der ersten Phase reicht dies aus. </p><br><p>  Dieses Wissen entwickeln wir weiter: F√ºr jede Entit√§t erstellen wir eine Liste der Repositorys, in denen sie sich befinden.  Wir weisen auch darauf hin, dass der Speicher die Entit√§t als Cache speichert oder der Speicher die Entit√§t als goldene Quelle speichert, dh, es ist ihre prim√§re Quelle. </p><br><p><img src="https://habrastorage.org/webt/ly/z-/et/lyz-etcdkr_wuqrgxnuwwar6aec.png"></p><br><p>  Wenn Sie diese Spalte ausf√ºllen, haben Sie die M√∂glichkeit, Anfragen zu stellen.  Sie haben eine Entit√§t, und Sie m√ºssen verstehen: In welchen Diensten lebt die Entit√§t, wo spiegelt sie sich wider, in welchem ‚Äã‚ÄãSpeicher, auf welchen Hosts ist sie installiert?  Wenn Sie beispielsweise personenbezogene Daten verarbeiten, m√ºssen Sie Protokolldateien zerst√∂ren.  Dazu ist es sehr wichtig zu verstehen, auf welchen physischen Computern die Protokolldateien verbleiben k√∂nnen. </p><br><p><img src="https://habrastorage.org/webt/je/fm/ge/jefmgeljgwsrg5oqjckgqyfht8c.png"></p><br><p>  Die Folie zeigt eine einfache Abfrage f√ºr eine imagin√§re Entit√§t.  Der Speicherplatz wird reduziert, sodass das Diagramm auf die Folie passt.  Rote Kreise sind Einheiten.  Blaue Kreise sind die Basen, auf denen sich diese Entit√§t befindet.  Der Rest ist wie auf den vorherigen Folien: Graue Kreise sind Hosts, lila Kreise sind Speicherinstallationen auf Hosts. </p><br><p>  Wenn Sie PCI DSS verwenden m√∂chten, m√ºssen Sie den Zugriff auf bestimmte Entit√§ten beschr√§nken.  Dazu m√ºssen Sie den Zugriff auf die grauen Kreise einschr√§nken.  Wenn Sie einen Echtzeitzugriff ben√∂tigen, schlie√üen wir den Zugriff auf die lila Kreise.  Dies sind statische Informationen. </p><br><p><img src="https://habrastorage.org/webt/_w/dy/tx/_wdytxhtuarcxx4v_elq4eckhpo.png"></p><br><p>  Wenn wir √ºber Microservice-Architektur sprechen, ist das Wichtigste, dass sie sich √§ndert.  Es ist wichtig, nicht nur eine hierarchische Beziehung zwischen Entit√§ten zu haben, sondern auch Geschwisterbeziehungen.  Eine Reihe von Diensten ist ein Beispiel f√ºr einstufige Verbindungen, die wir gut gepumpt und genutzt haben.  Ein B√ºndel des Formulars "Service ruft Service an".  Es gibt Informationen zu direkten Aufrufen - der Dienst ruft die API eines anderen Dienstes auf. </p><br><p>  Es sollten auch Informationen zur Verbindung des Formulars vorhanden sein: Dienst Nr. 1 sendet Ereignisse an den Bus (Warteschlange), und Dienst Nr. 2 hat dieses Ereignis abonniert.  Dies ist wie eine asynchrone langsame Verbindung, die √ºber einen Bus verl√§uft.  Diese Beziehung ist auch im Hinblick auf die Datenbewegung wichtig.  √úber solche Links k√∂nnen Sie den Betrieb von Diensten √ºberpr√ºfen, wenn sich die Version des Dienstes, f√ºr den sie abonniert sind, ge√§ndert hat. </p><br><p><img src="https://habrastorage.org/webt/bx/wu/fe/bxwufe8rh4oqpya2apdmwjs6y7k.png"><br><img src="https://habrastorage.org/webt/o9/6b/zh/o96bzhtcwcpe6le99c5-j80xgk4.png"></p><br><p>  Es gibt eine Entit√§t und wir wissen, dass sie in einem bestimmten Speicher gespeichert ist.  Wenn wir das Problem betrachten, Punkte f√ºr die Verwendung der Entit√§t zu finden, ist die offensichtliche Abfrage, die bei uns auftritt, die Perimeterpr√ºfung.  Speicher geh√∂ren zu einigen Diensten.  Wo kann diese Entit√§t aus dem Umkreis austreten (kopiert werden)?  Es kann durch Serviceanrufe auslaufen.  Der Dienst kontaktierte, empfing und behielt den Benutzer.  Es kann durch die Reifen lecken.  Reifen k√∂nnen Sie mit RabbitMQ, Londiste, miteinander verbinden.  Auf der Londiste-Folie haben wir sie noch nicht geladen.  Die Anrufe sind aber bereits geladen. </p><br><p>  Hier ist ein Beispiel f√ºr eine echte Anfrage: eine Anzeige, zwei Datenbanken, in denen sie gespeichert ist, zwei Dienste, denen diese Datenbanken geh√∂ren.  Nach drei Spalten stehen Dienste, die mit Diensten arbeiten, denen diese Entit√§t geh√∂rt.  Dies sind potenzielle Leckstellen, die hinzugef√ºgt werden sollten. </p><br><p><img src="https://habrastorage.org/webt/f1/cu/hg/f1cuhgk8m_6zltf4vaolu54z1jg.png"></p><br><p>  Endpunkte.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vadim erw√§hnte,</a> dass Sie mithilfe der Dokumentation eine Registrierung von Endpunktdiensten erstellen k√∂nnen.  Sie k√∂nnen diese Informationen auch √ºber die √úberwachung abrufen.  Wenn Endpoint wichtig ist, werden es von den Entwicklern selbst zur √úberwachung hinzugef√ºgt.  Wenn der Endpunkt nicht √ºberwacht wird, ben√∂tigen wir ihn nicht. </p><br><p><img src="https://habrastorage.org/webt/sr/wu/pk/srwupkfwo41g8vdgo_i2-_oejum.png"></p><br><p>  Dementsprechend k√∂nnen Metriken aus der √úberwachung erhalten werden.  Binden von Metriken an Speicher, Dienste, Hosts, Instanzen (Datenbank-Shards) und Endpunkte. </p><br><p><img src="https://habrastorage.org/webt/bu/sc/ec/buscec_nm5a9a5w3jy34_ke0u5y.png"></p><br><p>  Wenn beispielsweise ein Fehler auftritt, gibt der Endpunkt einen HTTP-Code von 500 aus. Um die Ursache des Problems zu ermitteln, m√ºssen Sie eine Anforderung f√ºr diesen Endpunkt stellen.  Gehen Sie vom Endpunkt zum Dienst, zu den Diensten, die dieser Dienst aufruft, von den Diensten zum Speicher, vom Speicher zur Instanz und zu den Hosts. </p><br><p><img src="https://habrastorage.org/webt/m-/lx/hu/m-lxhubwizopmc8tevtkqaxexn4.png"></p><br><p>  Wenn Sie dieses Diagramm durchgehen, k√∂nnen Sie auf seiner Grundlage eine Liste von Kennungen f√ºr die √úberwachung erhalten.  Sie k√∂nnen nach diesem Endpunkt in der gesamten Kette suchen, was zu einem Fehler f√ºhren kann.  In der Microservice-Architektur kann ein Fehler am Endpunkt durch einen Netzwerkfehler auf einem Server verursacht werden, auf dem ein Datenbank-Shard bereitgestellt wird.  Dies zeigt sich in der √úberwachung, aber bei einer gro√üen Servicestruktur ist es sehr m√ºhsam, alle Services in der √úberwachung zu √ºberpr√ºfen. </p><br><p><img src="https://habrastorage.org/webt/ti/qe/bx/tiqebxhp2cezstldxdblhhfj0ik.png"></p><br><p>  Testen.  Um einen Microservice angemessen zu testen, m√ºssen Sie den Service mit anderen Services √ºberpr√ºfen, die f√ºr die Arbeit erforderlich sind.  Sie m√ºssen in Ihrer Testumgebung die aufgerufenen Dienste erh√∂hen.  Und f√ºr die angerufenen Dienste erh√∂hen Sie alle Basen.  In unserem Erinnerungsstoff erhalten wir einen zusammenh√§ngenden Untergraphen.  In dieser Spalte werden nicht alle Verbindungen ben√∂tigt, einige k√∂nnen vernachl√§ssigt werden.  Dieser Teilgraph kann als vollst√§ndig geschlossenes System auf Last getestet werden. </p><br><p>  Es w√§re jetzt gro√üartig, das Avito-Entit√§tsdiagramm zu zeigen, in dem isolierte Teilgraphen von Mikrodiensten, die unabh√§ngig voneinander erstellt werden k√∂nnen, getestet und in der Produktion eingef√ºhrt werden k√∂nnen.  Tats√§chlich stellte sich heraus, dass der Anrufuntergraph von fast jedem Mikrodienst in den Monolithen eintritt und diesen verl√§sst.  Dies ist ein Beispiel f√ºr die Tatsache, dass, wenn Sie Microservices entwickeln und nicht √ºber solche Konsequenzen nachdenken, die Microservice-Architektur ohne Monolithen immer noch nicht funktioniert und keine isolierten Tests zul√§sst. </p><br><p>          ,    .       ,   .     .          . </p><br><p><img src="https://habrastorage.org/webt/9c/vw/o0/9cvwo0htj3q_rzayek1uqdmoivo.png"></p><br><p>   ‚Äî  ,      .        . </p><br><ul><li>        .          .      .         .     storage.   ‚Äî .   endpoint.     ,    ,      ..      . </li><li>          .       ¬´¬ª  .  , ,   ,  connection,  connection ,    .     ,            . (    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anchor Modeling</a> ).           .     ¬´ ¬ª.           .      Neo4j,     . </li><li>     ,           .        . , UI points  frontend ,   backend , storage  DBA,   DevOps ,   . </li></ul><br><h1 id="zadachi-in-progress">  in-progress </h1><br><p>       . <br>           (Londiste, PGQ, RabbitMQ). </p><br><p>       .   UI points          .       .             (Persistent Fabric),        UI points,   Endpoint,   .             , ,   ,       ,    . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de462937/">https://habr.com/ru/post/de462937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de462917/index.html">Web Scraping mit R. Vergleich der Filmbewertungen auf Kinopoisk und IMDB</a></li>
<li><a href="../de462919/index.html">Produktmanager vs Projektmanager: Wie vermeide ich Verwirrung?</a></li>
<li><a href="../de462929/index.html">Ich sehe dich: Taktik der Fledermausmaskierung</a></li>
<li><a href="../de462933/index.html">Funktionsweise der Internetblockierung: Ein √úberblick √ºber moderne Methoden anhand eines realen Beispiels</a></li>
<li><a href="../de462935/index.html">Wie kann man bei der Arbeit in einem Gro√üraumb√ºro konzentriert bleiben?</a></li>
<li><a href="../de462939/index.html">Top 10 C ++ Russia-Berichte und Open Access-Konferenz-Playlist</a></li>
<li><a href="../de462943/index.html">Jagen Sie den Wumpus oder erleben Sie das Schreiben eines klassischen Android-Spiels</a></li>
<li><a href="../de462945/index.html">Generieren Sie Einmalkennw√∂rter f√ºr 2FA in JS mithilfe der Web Crypto API</a></li>
<li><a href="../de462947/index.html">Die Geschichte, wie PVS-Studio einen Fehler in der in ... PVS-Studio verwendeten Bibliothek gefunden hat</a></li>
<li><a href="../de462949/index.html">Die Geschichte, wie PVS-Studio einen Fehler in der in ... PVS-Studio verwendeten Bibliothek gefunden hat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>