<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จ๐พโ๐จ ๐จ๐ฟโ๐ โ๏ธ MVCC ูู PostgreSQL-3. ุฅุตุฏุงุฑุงุช ุงูุตู ๐ค ๐ถ๏ธ ๐ฏ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุญุณููุง ุ ููุฏ ูุงูุดูุง ุจุงููุนู ุงูุนุฒูุฉ ูุฌุนููุง ุงุณุชุทุฑุงุฏุง ุจุฎุตูุต ุจููุฉ ุงูุจูุงูุงุช ููุฎูุถุฉ ุงููุณุชูู . ููุฏ ูุตููุง ุฃุฎูุฑูุง ุฅูู ุฃูุซุฑ ุงูุฃุดูุงุก ุงูุฑุงุฆุนุฉ ุ ุฃู ุฅุตุฏุงุฑุงุช ุงูุตู (tup...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MVCC ูู PostgreSQL-3. ุฅุตุฏุงุฑุงุช ุงูุตู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/477648/" style=";text-align:right;direction:rtl">  ุญุณููุง ุ ููุฏ ูุงูุดูุง ุจุงููุนู <a href="https://habr.com/ru/company/postgrespro/blog/467437/">ุงูุนุฒูุฉ</a> ูุฌุนููุง ุงุณุชุทุฑุงุฏุง ุจุฎุตูุต <a href="https://habr.com/ru/company/postgrespro/blog/469087/">ุจููุฉ ุงูุจูุงูุงุช ููุฎูุถุฉ ุงููุณุชูู</a> .  ููุฏ ูุตููุง ุฃุฎูุฑูุง ุฅูู ุฃูุซุฑ ุงูุฃุดูุงุก ุงูุฑุงุฆุนุฉ ุ ุฃู ุฅุตุฏุงุฑุงุช ุงูุตู (tuples). <br><br><h1 style=";text-align:right;direction:rtl">  ุฑุฃุณ Tuple </h1><br>  ููุง ุฐูุฑูุง ุณุงุจููุง ุ ูููู ุฃู ุชุชููุฑ ุนุฏุฉ ุฅุตุฏุงุฑุงุช ูู ูู ุตู ูู ููุช ูุงุญุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.  ููุญู ุจุญุงุฌุฉ ุฅูู ุงูุชูููุฒ ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุจูู ุฅุตุฏุงุฑ ูุงุญุฏ ูุขุฎุฑ.  ุชุญููููุง ููุฐู ุงูุบุงูุฉ ุ ูุชู <code>xmin</code> ูู ุฅุตุฏุงุฑ ุจู "ุงูููุช" ุงููุนุงู ( <code>xmin</code> ) ูุงูุชูุงุก ุงูุตูุงุญูุฉ "ุงูููุช" ( <code>xmax</code> ).  ุชุดูุฑ ุนูุงูุงุช ุงูุงูุชุจุงุณ ุฅูู ุฃู ุนุฏุงุฏ ุฒูุงุฏุฉ ุฎุงุต ูุณุชุฎุฏู ุจุฏูุงู ูู ุงูููุช ููุณู.  ููุฐุง ุงูุนุฏุงุฏ ูู <em>ูุนุฑู ุงููุนุงููุฉ</em> . <br><br>  (ูุงูุนุงุฏุฉ ุ ูู ุงููุงูุน ูุฐุง ุงูุฃูุฑ ุฃูุซุฑ ุชุนููุฏูุง: ูุง ูููู ุฏุงุฆููุง ุฒูุงุฏุฉ ูุนุฑูู ุงููุนุงููุฉ ูุธุฑูุง ููุฌูุฏ ุนูู ูุญุฏูุฏ ูู ุงูุนุฏุงุฏ. ููููุง ุณูุณุชูุดู ูุฒูุฏูุง ูู ุงูุชูุงุตูู ุญูู ูุฐุง ุงูุฃูุฑ ุนูุฏูุง ูุตู ููุงุดูุง ุฅูู ูุฑุญูุฉ ุงูุชุฌููุฏ.) <br><a name="habracut"></a><br>  ุนูุฏ ุฅูุดุงุก ุตู ุ ูุชู ุชุนููู ูููุฉ <code>xmin</code> ูุณุงููุฉ ููุนุฑู ุงููุนุงููุฉ ุงูุชู ููุฐุช ุฃูุฑ INSERT ุ ุจูููุง ูู ูุชู ููุก <code>xmax</code> . <br><br>  ุนูุฏ ุญุฐู ุฃุญุฏ ุงูุตููู ุ ูุชู <code>xmax</code> ูููุฉ <code>xmax</code> ุงูุฎุงุตุฉ ุจุงูุฅุตุฏุงุฑ ุงูุญุงูู ุจูุนุฑู ุงููุนุงููุฉ ุงูุชู ููุฐุช DELETE. <br><br>  ูููุฐ ุฃูุฑ UPDATE ูุนูููุง ุนูููุชูู ุชุงููุชูู: DELETE ู INSERT.  ูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู ูู ุงูุตู ุ ูุชู ุชุนููู <code>xmax</code> ุนูู ูุฏู ุงููุณุงูุงุฉ ููุนุฑู ุงููุนุงููุฉ ุงูุชู ุฃุฌุฑูุช UPDATE.  ุซู ูุชู ุฅูุดุงุก ุฅุตุฏุงุฑ ุฌุฏูุฏ ูู ููุณ ุงูุตู ุ ุชููู ููู ูููุฉ <code>xmin</code> ูู ููุณ <code>xmax</code> ูู ุงูุฅุตุฏุงุฑ ุงูุณุงุจู. <br><br>  ูุชู ุชุถููู ุญููู <code>xmax</code> ู <code>xmax</code> ูู ุฑุฃุณ ุฅุตุฏุงุฑ ุงูุตู.  ุจุงูุฅุถุงูุฉ ุฅูู ูุฐู ุงูุญููู ุ ูุญุชูู ุฑุฃุณ ุงููุฌููุนุฉ ุนูู ุญููู ุฃุฎุฑู ุ ูุซู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>infomask</code> - ุงูุนุฏูุฏ ูู ูุญุฏุงุช ุงูุจุช ุงูุชู ุชุญุฏุฏ ุฎุตุงุฆุต ูุฌููุนุฉ ูุนููุฉ.  ููุงู ุนุฏุฏ ุบูุฑ ูููู ูููู ุ ูุณูู ููุงูุด ูู ูููู ูุน ูุฑูุฑ ุงูููุช. </li><li style=";text-align:right;direction:rtl">  <code>ctid</code> - ุฅุดุงุฑุฉ ุฅูู ุงูุฅุตุฏุงุฑ ุงูุชุงูู ุ ุงูุฃุญุฏุซ ุ ูู ููุณ ุงูุตู.  <code>ctid</code> ูู ุฃุญุฏุซ ุฅุตุฏุงุฑ ุ ุฅุตุฏุงุฑ ูุญุฏุซ ุ ูุฐุง ุงูุฅุตุฏุงุฑ ุจุงูุฐุงุช.  ุงูุฑูู ูู ุงููููุฐุฌ <code>(x,y)</code> ุ ุญูุซ <code>x</code> ูู ุฑูู ุงูุตูุญุฉ ู <code>y</code> ูู ุฑูู ุชุฑุชูุจ ุงููุคุดุฑ ูู ุงูุตููู. </li><li style=";text-align:right;direction:rtl">  ุงูุตูุฑุฉ ุงูููุทูุฉ NULL ุ ูุงูุชู ุชุญุฏุฏ ูุฐู ุงูุฃุนูุฏุฉ ูู ุฅุตุฏุงุฑ ูุนุทู ูุญุชูู ุนูู NULL.  NULL ููุณุช ูููุฉ ููุชุธูุฉ ูุฃููุงุน ุงูุจูุงูุงุช ุ ูุจุงูุชุงูู ุ ูุชุนูู ุนูููุง ุชุฎุฒูู ูุฐู ุงูุฎุงุตูุฉ ุจุดูู ูููุตู. </li></ul><br>  ูุชูุฌุฉ ูุฐูู ุ ูุธูุฑ ุงูุฑุฃุณ ูุจูุฑูุง ุฌุฏูุง: 23 ุจุงูุช ููู ุชูููุญ ูุญุฏ ุฃุฏูู ุ ูููู ุนุงุฏุฉู ุฃูุจุฑ ุจุณุจุจ ุงูุตูุฑุฉ ุงูููุทูุฉ NULLs.  ุฅุฐุง ูุงู ุงูุฌุฏูู "ุถูู" (ุฃู ุฃูู ูุญุชูู ุนูู ุนุฏุฏ ูููู ูู ุงูุฃุนูุฏุฉ) ุ ูููู ุฃู ุชุดุบู ูุญุฏุงุช ุงูุจุงูุช ุงูุนุงูุฉ ูุณุงุญุฉ ุฃูุจุฑ ูู ุงููุนูููุงุช ุงููููุฏุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ุฅุฏุฑุงุฌ </h1><br>  ุฏุนููุง ููุธุฑ ุจูุฒูุฏ ูู ุงูุชูุตูู ูู ููููุฉ ุฅุฌุฑุงุก ุงูุนูููุงุช ุนูู ุงูุตููู ุนูู ูุณุชูู ููุฎูุถ ุ ููุญู ูุจุฏุฃ ูุน ุฅุฏุฑุงุฌ. <br><br>  ููุชุฌุฑุจุฉ ุ ุณููุดุฆ ุฌุฏูููุง ุฌุฏูุฏูุง ุจู ุนููุฏูู ูููุฑุณ ุนูู ุฃุญุฏููุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> t( id <span class="hljs-type"><span class="hljs-type">serial</span></span>, s <span class="hljs-type"><span class="hljs-type">text</span></span> ); =&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t(s);</code> </pre><br>  ูุจุฏุฃ ูุนุงููุฉ ูุฅุฏุฑุงุฌ ุตู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> t(s) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'FOO'</span></span>);</code> </pre><br>  ูุฐุง ูู ูุนุฑู ุงููุนุงููุฉ ุงูุญุงููุฉ ูุฏููุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> txid_current -------------- 3664 (1 row)</code> </pre><br>  ุฏุนูุง ููุธุฑ ุฅูู ูุญุชููุงุช ุงูุตูุญุฉ.  ุชุชูุญ <code>heap_page_items</code> ูุธููุฉ <code>heap_page_items</code> ูู ููุญู "pageinspect" ุงูุญุตูู ุนูู ูุนูููุงุช ุญูู ุงููุคุดุฑุงุช ูุฅุตุฏุงุฑุงุช ุงูุตู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page_items(get_raw_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)) \gx</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">-[ RECORD 1 ]------------------- lp | 1 lp_off | 8160 lp_flags | 1 lp_len | 32 t_xmin | 3664 t_xmax | 0 t_field3 | 0 t_ctid | (0,1) t_infomask2 | 2 t_infomask | 2050 t_hoff | 24 t_bits | t_oid | t_data | \x0100000009464f4f</code> </pre><br>  ูุงุญุธ ุฃู ูููุฉ "ุงููููุฉ" ูู PostgreSQL ุชุดูุฑ ุฅูู ุงูุฌุฏุงูู.  ูุฐุง ุฃุญุฏ ุงูุงุณุชุฎุฏุงูุงุช ุงูุบุฑูุจุฉ ููุตุทูุญ: ุงููููุฉ ูู <a href="https://en.wikipedia.org/wiki/Heap_(data_structure)">ุจููุฉ ุจูุงูุงุช</a> ูุนุฑููุฉ ุ ูุง ุนูุงูุฉ ููุง ุจุงูุฌุฏูู.  ูุชู ุงุณุชุฎุฏุงู ูุฐู ุงููููุฉ ููุง ุจูุนูู ุฃู "ุงููู ูุชู ุชุฌููุนู" ุ ุนูู ุนูุณ ุงูููุงุฑุณ ุงููุฑุชุจุฉ. <br><br>  ุชูุธูุฑ ูุฐู ุงููุธููุฉ ุงูุจูุงูุงุช "ููุง ูู" ุ ุจุชูุณูู ูุตุนุจ ูููู.  ูุชูุถูุญ ุงูุฃุดูุงุก ุ ูุชุฑู ุฌุฒุกูุง ููุท ูู ุงููุนูููุงุช ูููุณุฑูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'(0,'</span></span>||lp||<span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ctid, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> lp_flags <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'unused'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'normal'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'redirect to '</span></span>||lp_off <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'dead'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> state, t_xmin <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> xmin, t_xmax <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> xmax, (t_infomask &amp; <span class="hljs-number"><span class="hljs-number">256</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> xmin_commited, (t_infomask &amp; <span class="hljs-number"><span class="hljs-number">512</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> xmin_aborted, (t_infomask &amp; <span class="hljs-number"><span class="hljs-number">1024</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> xmax_commited, (t_infomask &amp; <span class="hljs-number"><span class="hljs-number">2048</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> xmax_aborted, t_ctid <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page_items(get_raw_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)) \gx</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">-[ RECORD 1 ]-+------- ctid | (0,1) state | normal xmin | 3664 xmax | 0 xmin_commited | f xmin_aborted | f xmax_commited | f xmax_aborted | t t_ctid | (0,1)</code> </pre><br>  ูุนููุง ูุง ููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชูุช ุฅุถุงูุฉ ุตูุฑ ุฅูู ุฑูู ุงููุคุดุฑ ูุฌุนูู ูุจุฏู ููุฃูู <code>t_ctid</code> : (ุฑูู ุงูุตูุญุฉ ุ ุฑูู ุงููุคุดุฑ). </li><li style=";text-align:right;direction:rtl">  ูุชู ุชูุณูุฑ ุญุงูุฉ ูุคุดุฑ <code>lp_flags</code> .  ุฅูู "ุทุจูุนู" ููุง ุ ููุง ูุนูู ุฃู ุงููุคุดุฑ ูุดูุฑ ูุนูููุง ุฅูู ุฅุตุฏุงุฑ ุตู.  ุณููุงูุด ุงูููู ุงูุฃุฎุฑู ูู ููุช ูุงุญู. </li><li style=";text-align:right;direction:rtl">  ูู ุจูู ูู ุจุชุงุช ุงููุนูููุงุช ุ ุงุฎุชุฑูุง ููุท ุงุซููู ูู ุฃุฒูุงุฌ ุญุชู ุงูุขู.  ุชูุธูุฑ ูุญุฏุงุช ุงูุจุช <code>xmin_aborted</code> ู <code>xmin_aborted</code> ูุง ุฅุฐุง ูุงูุช ุงููุนุงููุฉ ุฐุงุช ุงููุนุฑู <code>xmin</code> ููุชุฒูุฉ (ุชู ุงูุชุฑุงุฌุน).  ูุชุนูู ุฒูุฌ ูู ูุญุฏุงุช ุงูุจุช ุงููุชุดุงุจูุฉ ุจุงูุตููุฉ ุจุงุณุชุฎุฏุงู ูุนุฑูู <code>xmax</code> . </li></ul><br>  ูุงุฐุง ููุงุญุธุ  ุนูุฏ ุฅุฏุฑุงุฌ ุตู ุ ูู ุตูุญุฉ ุงูุฌุฏูู ุ ูุธูุฑ ูุคุดุฑ ูุญุชูู ุนูู ุงูุฑูู 1 ููุดูุฑ ุฅูู ุงูุฅุตุฏุงุฑ ุงูุฃูู ูุงููุญูุฏ ูู ุงูุตู. <br><br>  ูุชู <code>xmin</code> ุญูู <code>xmin</code> ูู ุงููุฌููุนุฉ ุจุงููุนุฑู ุงูุฎุงุต ุจุงููุนุงููุฉ ุงูุญุงููุฉ.  ูุฃู ุงููุนุงููุฉ ูุง ุชุฒุงู ูุดุทุฉ ุ ูุชู ุฅูุบุงุก <code>xmin_committed</code> ูู ูู <code>xmin_committed</code> ู <code>xmin_aborted</code> . <br><br>  <code>ctid</code> ุงูุญูู <code>ctid</code> ุงูุฎุงุต ุจุฅุตุฏุงุฑ ุงูุตู ุฅูู ููุณ ุงูุตู.  ููุฐุง ูุนูู ุฃูู ูุง ููุฌุฏ ุฅุตุฏุงุฑ ุฃุญุฏุซ ูุชุงุญ. <br><br>  ูุชู <code>xmax</code> ุญูู <code>xmax</code> ุงูุชูููุฏู 0 ุญูุซ ูุง ูุชู ุญุฐู ุงููุฌููุนุฉ ุ ููุฐุง ูู ุ ูุง ูุตู ุฅูู ุงูุชุงุฑูุฎ.  ุณูู ุชุชุฌุงูู ุงููุนุงููุงุช ูุฐุง ุงูุฑูู ุจุณุจุจ ูุฌููุนุฉ ุงูุจุช <code>xmax_aborted</code> . <br><br>  ุฏุนูุง ููุชูู ุฎุทูุฉ ุฃุฎุฑู ูุชุญุณูู ูุงุจููุฉ ุงููุฑุงุกุฉ ุนู ุทุฑูู ุฅูุญุงู ุจุชุงุช ุงููุนูููุงุช ุจูุนุฑูุงุช ุงููุนุงููุงุช.  ูุฏุนูุง ููุดุฆ ุงููุธููุฉ ูุฃููุง ุณูุญุชุงุฌ ุฅูู ุงูุงุณุชุนูุงู ุฃูุซุฑ ูู ูุฑุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> heap_page(relname <span class="hljs-type"><span class="hljs-type">text</span></span>, pageno <span class="hljs-type"><span class="hljs-type">integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>(ctid tid, state <span class="hljs-type"><span class="hljs-type">text</span></span>, xmin <span class="hljs-type"><span class="hljs-type">text</span></span>, xmax <span class="hljs-type"><span class="hljs-type">text</span></span>, t_ctid tid) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $$<span class="pgsql"><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> (pageno,lp)::</span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">text</span></span></span><span class="pgsql">::tid </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">AS</span></span></span><span class="pgsql"> ctid, </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">CASE</span></span></span><span class="pgsql"> lp_flags </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHEN</span></span></span><span class="pgsql"> </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">0</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">THEN</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'unused'</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHEN</span></span></span><span class="pgsql"> </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">1</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">THEN</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'normal'</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHEN</span></span></span><span class="pgsql"> </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">2</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">THEN</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'redirect to '</span></span></span><span class="pgsql">||lp_off </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHEN</span></span></span><span class="pgsql"> </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">3</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">THEN</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'dead'</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">END</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">AS</span></span></span><span class="pgsql"> state, t_xmin || </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">CASE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHEN</span></span></span><span class="pgsql"> (t_infomask &amp; </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">256</span></span></span><span class="pgsql">) &gt; </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">0</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">THEN</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">' (c)'</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHEN</span></span></span><span class="pgsql"> (t_infomask &amp; </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">512</span></span></span><span class="pgsql">) &gt; </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">0</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">THEN</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">' (a)'</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">ELSE</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">''</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">END</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">AS</span></span></span><span class="pgsql"> xmin, t_xmax || </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">CASE</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHEN</span></span></span><span class="pgsql"> (t_infomask &amp; </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">1024</span></span></span><span class="pgsql">) &gt; </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">0</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">THEN</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">' (c)'</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHEN</span></span></span><span class="pgsql"> (t_infomask &amp; </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">2048</span></span></span><span class="pgsql">) &gt; </span><span class="hljs-number"><span class="pgsql"><span class="hljs-number">0</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">THEN</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">' (a)'</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">ELSE</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">''</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">END</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">AS</span></span></span><span class="pgsql"> xmax, t_ctid </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> heap_page_items(get_raw_page(relname,pageno)) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">ORDER</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">BY</span></span></span><span class="pgsql"> lp; $$</span><span class="undefined"></span></span><span class="pgsql"><span class="undefined"></span></span> <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span>;</code> </pre><br>  ูุง ูุญุฏุซ ูู ุฑุฃุณ ุฅุตุฏุงุฑ ุงูุตู ุฃูุซุฑ ูุถูุญูุง ูู ูุฐุง ุงููููุฐุฌ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+------+-------+-------- (0,1) | normal | 3664 | 0 (a) | (0,1) (1 row)</code> </pre><br>  ูููููุง ุงูุญุตูู ุนูู ูุนูููุงุช ููุงุซูุฉ ุ ูููู ุฃูู ุชูุตูููุง ุ ูู ุงูุฌุฏูู ููุณู ุจุงุณุชุฎุฏุงู <code>xmin</code> ู <code>xmax</code> ุงูุฒุงุฆูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> xmin, xmax, * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> xmin | xmax | id | s ------+------+----+----- 3664 | 0 | 1 | FOO (1 row)</code> </pre><br><h1 style=";text-align:right;direction:rtl">  ุงุฑุชูุจ </h1><br>  ุนูุฏูุง ุชูุฌุญ ุฅุญุฏู ุงููุนุงููุงุช ุ ูุฌุจ ุฃู ุชุชุฐูุฑ ุญุงูุชูุง ุ ุฃู ูุฌุจ ุฃู ุชููู ุงููุนุงููุฉ ูููุฒุฉ.  ุชุญููููุง ููุฐู ุงูุบุงูุฉ ุ ูุชู ุงุณุชุฎุฏุงู ุจููุฉ XACT.  (ูุจู ุงูุฅุตุฏุงุฑ 10 ุ ูุงู ูุทูู ุนููู CLOG (ุณุฌู ุงูุงูุชุฒุงู) ุ ููุง ูุฒุงู ูู ุงููุญุชูู ุฃู ุชุตุงุฏู ูุฐุง ุงูุงุณู.) <br><br>  XACT ููุณ ุฌุฏูู ูุชุงููุฌ ุงููุธุงู ุ ููููู ูููุงุช ูู ุฏููู PGDATA / pg_xact.  ูุชู ุชุฎุตูุต ุฌุฒุฆูู ูู ูุฐู ุงููููุงุช ููู ูุนุงููุฉ - "ููุชุฒู" ู "ุชู ุฅุญุจุงุท" - ุจููุณ ุงูุทุฑููุฉ ุชูุงููุง ููุง ูู ุงูุญุงู ูู ุฑุฃุณ ุงููุฌููุนุฉ.  ุชูุชุดุฑ ูุฐู ุงููุนูููุงุช ุนุจุฑ ุนุฏุฉ ูููุงุช ููุฑุงุญุฉ ููุท ุ  ุณูู ูุนูุฏ ุฅูู ูุฐุง ุนูุฏูุง ููุงูุด ุงูุชุฌููุฏ.  ูุนูู PostgreSQL ูุน ูุฐู ุงููููุงุช ุตูุญุฉ ุชูู ุงูุฃุฎุฑู ุ ููุง ูู ุงูุญุงู ูุน ุงูุขุฎุฑูู. <br><br>  ูุฐูู ุ ุนูุฏูุง ูุชู ุงุฑุชูุงุจ ูุนุงููุฉ ุ ูุชู ุชุนููู ุจุช "ููุชุฒู" ููุฐู ุงููุนุงููุฉ ูู XACT.  ููุฐุง ูู ูู ูุง ูุญุฏุซ ุนูุฏูุง ูุชู ุชูููุฐ ุงููุนุงููุฉ (ุนูู ุงูุฑุบู ูู ุฃููุง ูู ูุฐูุฑ ุณุฌู ุงููุชุงุจุฉ ุจุนุฏ). <br><br>  ุนูุฏูุง ุชุตู ุจุนุถ ุงููุนุงููุงุช ุงูุฃุฎุฑู ุฅูู ุตูุญุฉ ุงูุฌุฏูู ุงูุชู ููุง ููุธุฑ ุฅูููุง ููุชู ุ ุณูุชุนูู ุนูู ุงูุณุงุจู ุงูุฅุฌุงุจุฉ ุนูู ุจุนุถ ุงูุฃุณุฆูุฉ. <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู <code>xmin</code> ุงููุนุงููุฉ <code>xmin</code> ุ  ุฅุฐุง ูู ููู ุงูุฃูุฑ ูุฐูู ุ ูุฌุจ ุฃูุง ุชููู ุงููุฌููุนุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ูุฑุฆูุฉ. <br>  ูุชู ุงูุชุญูู ูู ุฐูู ูู ุฎูุงู ุงููุธุฑ ูู ุจููุฉ ุฃุฎุฑู ุ ูุงูุชู ุชูุน ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ูููุซูู ูุชุณูู ProcArray.  ุชุญุชูู ูุฐู ุงูุจููุฉ ุนูู ูุงุฆูุฉ ุจุฌููุน ุงูุนูููุงุช ุงููุดุทุฉ ุ ุฅูู ุฌุงูุจ ูุนุฑู ุงููุนุงููุฉ ุงูุญุงููุฉ (ุงููุดุทุฉ) ููู ูููุง. </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ุชู ุฅููุงู ุงููุนุงููุฉ ุ ููู ุชู ุงูุงูุชุฒุงู ุจูุง ุฃู ุงูุชุฑุงุฌุนุ  ุฅุฐุง ุชู ุงูุชุฑุงุฌุน ุ ูุฌุจ ุฃูุง ุชููู ุงููุฌููุนุฉ ูุฑุฆูุฉ ุฃูุถูุง. <br>  ูุฐุง ูู ุจุงูุถุจุท ูุง ูู ูุทููุจ XACT ู.  ูููู ูู ุงููููู ุงูุชุญูู ูู XACT ูู ูู ูุฑุฉ ุ ุนูู ุงูุฑุบู ูู ุฃู ุงูุตูุญุงุช ุงูุฃุฎูุฑุฉ ูู XACT ูุชู ุชุฎุฒูููุง ูู ูุฎุงุฒู ูุคูุชุฉ ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ.  ูุฐูู ุ ุจูุฌุฑุฏ ูุนุฑูุฉ ุงูุญุงูุฉ ุ ุชุชู ูุชุงุจุฉ ุญุงูุฉ ุงููุนุงููุฉ ุฅูู ุจุช <code>xmin_aborted</code> ู <code>xmin_aborted</code> ูู tuple.  ุฅุฐุง ุชู ุชุนููู ุฃู ูู ูุฐู ุงูุจุชุงุช ุ ูุณูุชู ุงูุชุนุงูู ูุน ุญุงูุฉ ุงููุนุงููุฉ ุนูู ุฃููุง ูุนุฑููุฉ ููู ุชุญุชุงุฌ ุงููุนุงููุฉ ุงูุชุงููุฉ ุฅูู ุงูุชุญูู ูู XACT. </li></ol><br>  ููุงุฐุง ูุง ุชููู ุงููุนุงููุฉ ุงูุชู ุชููู ุจุฅุฏุฑุงุฌ insert ุจุชุนููู ูุฐู ุงูุจุชุงุชุ  ุนูุฏูุง ูุชู ุชูููุฐ ุนูููุฉ ุงูุฅุฏุฑุงุฌ ุ ูุฅู ุงูุตููุฉ ููุณุช ุนูู ุนูู ุจูุง ุฅุฐุง ูุงู ุณูุชู ุฅููุงููุง ุจูุฌุงุญ ุฃู ูุง.  ููู ููุช ุงูุงูุชุฒุงู ุ ูู ุบูุฑ ุงููุงุถุญ ุจุงููุนู ุฃู ุงูุตููู ููู ุฃู ุงูุตูุญุงุช ุชู ุชุบููุฑูุง.  ูููู ุฃู ูููู ููุงู ุงููุซูุฑ ูู ูุฐู ุงูุตูุญุงุช ุ ููู ุบูุฑ ุงูุนููู ุชุชุจุนูุง.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููู ุฅุฎูุงุก ุจุนุถ ุงูุตูุญุงุช ุฅูู ุงููุฑุต ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุชุ  ููุฑุงุกุชูุง ูุฑุฉ ุฃุฎุฑู ูู ุฃุฌู ุชุบููุฑ ุงูุจุชุงุช ูุนูู ุชุจุงุทุค ูุจูุฑ ูู ุงูุงูุชุฒุงู. <br><br>  ุงูุฌุงูุจ ุงูุขุฎุฑ ูู ุชูููุฑ ุงูุชูุงููู ูู ุฃูู ุจุนุฏ ุงูุชุญุฏูุซุงุช ุ ูููู ูุฃู ูุนุงููุฉ (ุญุชู ุชูู ุงูุชู ุชููู ุจุฅุฌุฑุงุก SELECT) ุฃู ุชุจุฏุฃ ูู ุชุบููุฑ ุตูุญุงุช ุงูุจูุงูุงุช ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุคูุชุฉ. <br><br>  ูุฐูู ุ ูุญู ููุชุฒู ุงูุชุบููุฑ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br>  ูู ูุชุบูุฑ ุดูุก ูู ุงูุตูุญุฉ (ููููุง ูุนุฑู ุฃู ุญุงูุฉ ุงููุนุงููุงุช ุชูุช ูุชุงุจุชูุง ุจุงููุนู ุฅูู XACT): <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+------+-------+-------- (0,1) | normal | 3664 | 0 (a) | (0,1) (1 row)</code> </pre><br>  ุงูุขู ุณุชุญุชุงุฌ ุงููุนุงููุฉ ุงูุชู ุชุตู ุฅูู ุงูุตูุญุฉ ุฃููุงู ุฅูู ุชุญุฏูุฏ ุญุงูุฉ ุงููุนุงููุฉ <code>xmin</code> ุฅูู ุจุชุงุช ุงููุนูููุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> id | s ----+----- 1 | FOO (1 row)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+----------+-------+-------- (0,1) | normal | 3664 (c) | 0 (a) | (0,1) (1 row)</code> </pre><br><h1 style=";text-align:right;direction:rtl">  ุญุฐู </h1><br>  ุนูุฏ ุญุฐู ุฃุญุฏ ุงูุตููู ุ ุชุชู ูุชุงุจุฉ ูุนุฑูู ูุนุงููุฉ ุงูุญุฐู ุงูุญุงููุฉ ุฅูู ุญูู <code>xmax</code> ุงูุฎุงุต ุจุงูุฅุตุฏุงุฑ <code>xmax_aborted</code> ูุชุชู ุฅุนุงุฏุฉ ุชุนููู ุจุช <code>xmax_aborted</code> . <br><br>  ูุงุญุธ ุฃู ูููุฉ <code>xmax</code> ุงููุทุงุจูุฉ ูููุนุงููุฉ ุงููุดุทุฉ ุชุนูู ูููู ููุตู.  ุฅุฐุง ูุงูุช ููุงู ูุนุงููุฉ ุฃุฎุฑู ุณุชููู ุจุชุญุฏูุซ ูุฐุง ุงูุตู ุฃู ุญุฐูู ุ ูุณูุชุนูู ุนูููุง ุงูุงูุชุธุงุฑ ุญุชู <code>xmax</code> ูุนุงููุฉ <code>xmax</code> .  ุณูุชุญุฏุซ ุนู ุงูุฃููุงู ุจูุฒูุฏ ูู ุงูุชูุตูู ูู ููุช ูุงุญู.  ูู ูุฐู ุงููุฑุญูุฉ ุ ูุงุญุธ ููุท ุฃู ุนุฏุฏ ุฃููุงู ุงูุตู ููุณุช ูุญุฏูุฏุฉ ุนูู ุงูุฅุทูุงู.  ูุง ุชุดุบู ุงูุฐุงูุฑุฉ ููุง ูุชุฃุซุฑ ุฃุฏุงุก ุงููุธุงู ุจูุฐุง ุงูุฑูู.  ููุน ุฐูู ุ ูุฅู ุงููุนุงููุงุช ุทูููุฉ ุงูุฃูุฏ ููุง ุนููุจ ุฃุฎุฑู ุ ูุงูุชู ุณูุชู ููุงูุดุชูุง ูุงุญููุง. <br><br>  ุฏุนูุง ูุญุฐู ุตู <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> txid_current -------------- 3665 (1 row)</code> </pre><br>  ูุฑู ุฃู ูุนุฑู ุงููุนุงููุฉ ููุชูุจ ูู ุญูู <code>xmax</code> ุ ููู ูู ูุชู <code>xmax</code> ุจุชุงุช ุงููุนูููุงุช: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+----------+------+-------- (0,1) | normal | 3664 (c) | 3665 | (0,1) (1 row)</code> </pre><br><h1 style=";text-align:right;direction:rtl">  ุฅุญุจุงุท </h1><br>  ูุนูู ุฅุฌูุงุถ ูุนุงููุฉ ููุงุซูุฉ ูุงุฑุชูุงุจ ุ ุฅูุง ุฃูู ุชู ุชุนููู ุจุช "ุฅุญุจุงุท" ูู XACT.  ูุชู ุฅุญุจุงุท ูู ุฃุณุฑุน ููุช ุงุฑุชูุงุจ.  ุนูู ุงูุฑุบู ูู ุฃู ุงูุฃูุฑ ูุณูู ROLLBACK ุ ูุง ูุชู ุงูุชุฑุงุฌุน ุนู ุงูุชุบููุฑุงุช: ูู ุดูุก ุชุบูุฑุช ุงููุนุงููุฉ ุจุงููุนู ุ ูุจูู ุนูู ุญุงูู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+----------+------+-------- (0,1) | normal | 3664 (c) | 3665 | (0,1) (1 row)</code> </pre><br>  ุนูุฏ ุงููุตูู ุฅูู ุงูุตูุญุฉ ุ ุณูุชู ูุญุต <code>xmax_aborted</code> ูุณูุชู ุชุนููู <code>xmax_aborted</code> ุชูููุญ ุงูุจุช.  ุนูู ุงูุฑุบู ูู ุฃู ุงูุฑูู <code>xmax</code> ููุณู ุณูุจูู ูู ุงูุตูุญุฉ ุ ุฅูุง ุฃูู ูู ูุชู ุงููุธุฑ ุฅููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> id | s ----+----- 1 | FOO (1 row)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+----------+----------+-------- (0,1) | normal | 3664 (c) | 3665 (a) | (0,1) (1 row)</code> </pre><br><h1 style=";text-align:right;direction:rtl">  ุชุญุฏูุซ </h1><br>  ูุนูู ุงูุชุญุฏูุซ ููุง ูู ุชู ุญุฐู ุงูุฅุตุฏุงุฑ ุงูุญุงูู ุฃููุงู ุซู ูุชู ุฅุฏุฎุงู ุฅุตุฏุงุฑ ุฌุฏูุฏ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> s = <span class="hljs-string"><span class="hljs-string">'BAR'</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> txid_current -------------- 3666 (1 row)</code> </pre><br>  ุฅุฑุฌุงุน ุงูุงุณุชุนูุงู ุตู ูุงุญุฏ (ุงูุฅุตุฏุงุฑ ุงูุฌุฏูุฏ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> id | s ----+----- 1 | BAR (1 row)</code> </pre><br>  ูููู ูููููุง ุฃู ูุฑู ููุง ุงูุฅุตุฏุงุฑูู ูู ุงูุตูุญุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+----------+-------+-------- (0,1) | normal | 3664 (c) | 3666 | (0,2) (0,2) | normal | 3666 | 0 (a) | (0,2) (2 rows)</code> </pre><br>  ูุชู ุชุณููุฉ ุงูุฅุตุฏุงุฑ ุงููุญุฐูู ุจูุนุฑู ุงููุนุงููุฉ ุงูุญุงููุฉ ูู ุญูู <code>xmax</code> .  ุนูุงูุฉ ุนูู ุฐูู ุ ููุฏ ุชุฌุงูุฒุช ูุฐู ุงููููุฉ ุงููููุฉ ุงููุฏููุฉ ููุฐ ุฃู ุชู ุงูุชุฑุงุฌุน ุนู ุงููุนุงููุฉ ุงูุณุงุจูุฉ.  ุชุชู ุฅุนุงุฏุฉ ุชุนููู ุจุช <code>xmax_aborted</code> ูุฃู ุญุงูุฉ ุงููุนุงููุฉ ุงูุญุงููุฉ ุบูุฑ ูุนุฑููุฉ ุญุชู ุงูุขู. <br><br>  ูุดูุฑ ุงูุฅุตุฏุงุฑ ุงูุฃูู ูู ุงูุตู ุงูุขู ุฅูู ุงูุฅุตุฏุงุฑ ุงูุซุงูู ุจุงุนุชุจุงุฑู ุฅุตุฏุงุฑูุง ุฃุญุฏุซ. <br><br>  ุชุญุชูู ุตูุญุฉ ุงูููุฑุณ ุงูุขู ุนูู ุงููุคุดุฑ ุงูุซุงูู ูุงูุตู ุงูุซุงูู ุ ูุงูุฐู ูุดูุฑ ุฅูู ุงูุฅุตุฏุงุฑ ุงูุซุงูู ูู ุตูุญุฉ ุงูุฌุฏูู. <br><br>  ุจููุณ ุงูุทุฑููุฉ ุจุงููุณุจุฉ ููุญุฐู ุ ุชุดูุฑ ูููุฉ <code>xmax</code> ูู ุงูุฅุตุฏุงุฑ ุงูุฃูู ุฅูู ุฃู ุงูุตู ูุบูู. <br><br>  ุฃุฎูุฑูุง ุ ููุชุฒู ุจุงููุนุงููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br><h1 style=";text-align:right;direction:rtl">  ุงูููุงุฑุณ </h1><br>  ููุง ูุชุญุฏุซ ููุท ุนู ุตูุญุงุช ุงูุฌุฏูู ุญุชู ุงูุขู.  ูููู ูุงุฐุง ูุญุฏุซ ุฏุงุฎู ุงูููุงุฑุณุ <br><br>  ุชุนุชูุฏ ุงููุนูููุงุช ุงูููุฌูุฏุฉ ูู ุตูุญุงุช ุงูููุฑุณ ุงุนุชูุงุฏูุง ูุจูุฑูุง ุนูู ููุน ุงูููุฑุณ ุงููุญุฏุฏ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูููู ุฃู ุชุญุชูู ุฃููุงุน ุงูููุงุฑุณ ุนูู ุฃููุงุน ูุฎุชููุฉ ูู ุงูุตูุญุงุช.  ุนูู ุณุจูู ุงููุซุงู: ุชุญุชูู ุดุฌุฑุฉ B ุนูู ุตูุญุฉ ุงูุจูุงูุงุช ุงูุฃูููุฉ ูุตูุญุงุช "ุนุงุฏูุฉ". <br><br>  ููุน ุฐูู ุ ุชุญุชูู ุตูุญุฉ ุงูููุฑุณ ุนุงุฏุฉู ุนูู ูุฌููุนุฉ ูู ุงููุคุดุฑุงุช ุฅูู ุงูุตููู ูุงูุตููู ููุณูุง (ุชูุงููุง ูุซู ุตูุญุงุช ุงูุฌุฏูู).  ุนูุงูุฉ ุนูู ุฐูู ุ ูุชู ุชุฎุตูุต ุจุนุถ ุงููุณุงุญุฉ ูู ููุงูุฉ ุงูุตูุญุฉ ููุจูุงูุงุช ุงูุฎุงุตุฉ. <br><br>  ูููู ุฃู ุชุญุชูู ุงูุตููู ูู ุงูููุงุฑุณ ุฃูุถูุง ุนูู ููุงูู ูุฎุชููุฉ ููููุง ูููุน ุงูููุฑุณ.  ุนูู ุณุจูู ุงููุซุงู: ูู ุดุฌุฑุฉ B ุ ุชุญุชูู ุงูุตููู ุงููุฑุชุจุทุฉ ุจุตูุญุงุช ุงูุฃูุฑุงู ุนูู ูููุฉ ููุชุงุญ ุงูููุฑุณุฉ ููุฑุฌุน ( <code>ctid</code> ) ุฅูู ุตู ุงูุฌุฏูู ุงูููุงุณุจ.  ุจุดูู ุนุงู ุ ูููู ููููุฉ ููุฑุณ ุจุทุฑููุฉ ูุฎุชููุฉ ุชูุงููุง. <br><br>  ุงูููุทุฉ ุงูุฃุณุงุณูุฉ ูู ุฃูู ูู ุงูููุงุฑุณ ูู ุฃู ููุน ูุง ุชูุฌุฏ <em>ุฅุตุฏุงุฑุงุช</em> ุงูุตู.  ุฃู ูููููุง ุงุนุชุจุงุฑ ูู ุตู ููุซูู ุฅุตุฏุงุฑ ูุงุญุฏ ููุท.  ุจูุนูู ุขุฎุฑ ุ ูุง ูุญุชูู ุฑุฃุณ ุตู ุงูููุฑุณ ุนูู ุญููู <code>xmax</code> ู <code>xmax</code> .  ูู ุงูููุช ุงูุญุงูู ุ ูููููุง ุงูุชุฑุงุถ ุฃู ุงูุฅุดุงุฑุงุช ูู ุงูููุฑุณ ุชุดูุฑ ุฅูู ุฌููุน ุฅุตุฏุงุฑุงุช ุตููู ุงูุฌุฏูู.  ุญุชู ูุชุณูู ูู ูุนุฑูุฉ ุฃู ูู ุฅุตุฏุงุฑุงุช ุงูุตู ุงููุฑุฆูุฉ ููุนุงููุฉ ูุง ุ ูุญุชุงุฌ PostgreSQL ุฅูู ุงููุธุฑ ูู ุงูุฌุฏูู.  (ูุงูุนุงุฏุฉ ุ ููุณุช ูุฐู ูู ุงููุตุฉ ุจุฃููููุง. ูู ุจุนุถ ุงูุฃุญูุงู ุชุชูุญ ุฎุฑูุทุฉ ุงูุฑุคูุฉ ุชุญุณูู ุงูุนูููุฉ ุ ููููุง ุณููุงูุดูุง ูุงุญููุง.) <br><br>  ููุง ุ ูู ุตูุญุฉ ุงูููุฑุณ ุ ูุฌุฏ ูุคุดุฑุงุช ุฅูู ููุง ุงูุฅุตุฏุงุฑูู: ุงููุญุฏุซุฉ ูุงูุณุงุจูุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> itemoffset, ctid <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> bt_page_items(<span class="hljs-string"><span class="hljs-string">'t_s_idx'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> itemoffset | ctid ------------+------- 1 | (0,2) 2 | (0,1) (2 rows)</code> </pre><br><h1 style=";text-align:right;direction:rtl">  ุงููุนุงููุงุช ุงูุงูุชุฑุงุถูุฉ </h1><br>  ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ุชุณุชููุฏ PostgreSQL ูู ุงูุชุญุณูู ุงูุฐู ูุณูุญ "ุจุฅููุงู" ูุนุฑูุงุช ุงููุนุงููุงุช. <br><br>  ุฅุฐุง ูุงูุช ุงููุนุงููุฉ ุชููู ุจูุฑุงุกุฉ ุงูุจูุงูุงุช ููุท ุ ููู ูุคุซุฑ ุฐูู ุนูู ุธููุฑ ุงูุนูุงูุฉ ุนูู ุงูุฅุทูุงู.  ูุฐูู ุ ุชููู ุงูุนูููุฉ ุงูุฎูููุฉ ุฃููุงู ุจุชุนููู ูุนุฑูู ุธุงูุฑู (xid ุธุงูุฑู) ูููุนุงููุฉ.  ูุชููู ูุฐุง ุงููุนุฑู ูู ูุนุฑู ุงูุนูููุฉ ูุฑูู ูุชุณูุณู. <br><br>  ูุง ูุชุทูุจ ุชุนููู ูุฐุง ุงููุนุฑู ุงูุธุงูุฑู ุงูุชุฒุงูู ุจูู ุฌููุน ุงูุนูููุงุช ูุจุงูุชุงูู ูุชู ุชูููุฐู ุจุณุฑุนุฉ ูุจูุฑุฉ.  ุณูุชุนูู ุณุจุจูุง ุขุฎุฑ ูุงุณุชุฎุฏุงู ูุนุฑูุงุช ุงูุชุฑุงุถูุฉ ุนูุฏูุง ููุงูุด ุงูุชุฌููุฏ. <br><br>  ูุง ุชุฃุฎุฐ ููุทุงุช ุงูุจูุงูุงุช ูู ุงูุงุนุชุจุงุฑ ุงููุนุฑู ุงูุธุงูุฑู ุนูู ุงูุฅุทูุงู. <br><br>  ูู ุฃููุงุช ูุฎุชููุฉ ูู ุงูุฒูู ุ ูููู ูููุธุงู ุฅุฌุฑุงุก ูุนุงููุงุช ุงูุชุฑุงุถูุฉ ุจูุนุฑูุงุช ุชู ุงุณุชุฎุฏุงููุง ุจุงููุนู ุ ููุฐุง ุฌูุฏ.  ูููู ูุง ูููู ูุชุงุจุฉ ูุฐุง ุงููุนุฑู ุนูู ุตูุญุงุช ุงูุจูุงูุงุช ูุฃูู ุนูุฏูุง ูุชู ุงููุตูู ุฅูู ุงูุตูุญุฉ ูู ุงููุฑุฉ ุงููุงุฏูุฉ ุ ูููู ุฃู ูุตุจุญ ุงููุนุฑู ุจูุง ูุนูู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current_if_assigned();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> txid_current_if_assigned -------------------------- (1 row)</code> </pre><br>  ูููู ุฅุฐุง ุจุฏุฃุช ุฅุญุฏู ุงููุนุงููุงุช ูู ุชุบููุฑ ุงูุจูุงูุงุช ุ ูุฅููุง ุชุญุตู ุนูู ูุนุฑู ูุนุงููุฉ ุญูููู ููุฑูุฏ โโูู ููุนู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> amount = amount - <span class="hljs-number"><span class="hljs-number">1.00</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current_if_assigned();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> txid_current_if_assigned -------------------------- 3667 (1 row)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br><h1 style=";text-align:right;direction:rtl">  Subtransactions </h1><br><h2 style=";text-align:right;direction:rtl">  Savepoints </h2><br>  ูู SQL ุ ูุชู ุชุนุฑูู <em>savepoints</em> ุ ูุงูุชู ุชุณูุญ ุจุงุณุชุนุงุฏุฉ ุจุนุถ ุนูููุงุช ุงููุนุงููุฉ ุฏูู ุฅุฌูุงุถูุง ุงููุงูู.  ููู ูุฐุง ุบูุฑ ูุชูุงูู ูุน ุงููููุฐุฌ ุฃุนูุงู ูุฃู ุญุงูุฉ ุงููุนุงููุฉ ูู ูุงุญุฏุฉ ูุฌููุน ุงูุชุบููุฑุงุช ููุง ูุชู ุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช ูุนูููุง. <br><br>  ูุชูููุฐ ูุฐู ุงููุธููุฉ ุ ูุชู ุชูุณูู ุงููุนุงููุฉ ุงูุชู ุชุญุชูู ุนูู ููุทุฉ ุญูุธ ุฅูู ุนุฏุฉ ูุนุงููุงุช ูุฑุนูุฉ ูููุตูุฉ ูููู ุฅุฏุงุฑุฉ ุญุงูุงุชูุง ุจุดูู ูููุตู. <br><br>  ุชููู ุงูุงุฎุชุจุงุฑุงุช ุงููุฑุนูุฉ ูุนุฑูุงุช ุฎุงุตุฉ ุจูุง (ุฃูุจุฑ ูู ูุนุฑู ุงููุนุงููุฉ ุงูุฑุฆูุณูุฉ).  ุชุชู ูุชุงุจุฉ ุญุงูุงุช ุงููุนุงููุงุช ุงููุฑุนูุฉ ุฅูู XACT ุจุงูุทุฑููุฉ ุงููุนุชุงุฏุฉ ุ ููู ุงูุญุงูุฉ ุงูููุงุฆูุฉ ุชุนุชูุฏ ุนูู ุญุงูุฉ ุงููุนุงููุฉ ุงูุฑุฆูุณูุฉ: ุฅุฐุง ุชู ุงูุชุฑุงุฌุน ุ ูุชู ุฅุฑุฌุงุน ุฌููุน ุงููุนุงููุงุช ุงููุฑุนูุฉ ุฃูุถูุง. <br><br>  ูุชู ุชุฎุฒูู ูุนูููุงุช ุญูู ุชุฏุงุฎู ุงููุนุงููุงุช ุงููุฑุนูุฉ ูู ูููุงุช ุฏููู PGDATA / pg_subtrans.  ูุชู ุงููุตูู ุฅูู ูุฐู ุงููููุงุช ูู ุฎูุงู ุงููุฎุงุฒู ุงููุคูุชุฉ ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ูููุซูู ุ ูุงูุชู ูุชู ุชูุธูููุง ุจููุณ ุทุฑููุฉ ุงููุฎุงุฒู ุงููุคูุชุฉ XACT. <br><br>  ูุง ุชุฎูุท ุจูู ุงููุนุงููุงุช ุงููุฑุนูุฉ ูุงููุนุงููุงุช ุงููุณุชููุฉ.  ูุง ุชุนุชูุฏ ุงููุนุงููุงุช ุงููุณุชููุฉ ุจุฃู ุดูู ูู ุงูุฃุดูุงู ุนูู ุจุนุถูุง ุงูุจุนุถ ุ ูู ุญูู ุชุนุชูุฏ ุงููุนุงููุงุช ุงููุฑุนูุฉ.  ูุง ุชูุฌุฏ ูุนุงููุงุช ูุณุชููุฉ ูู PostgreSQL ุงูุนุงุฏูุฉ ุ ูุงูุชู ุฑุจูุง ุชููู ููุฃูุถู: ุฅููุง ูู ุงููุงูุน ูุงุฏุฑุฉ ููุบุงูุฉ ุ ูุชูุงูุฑูุง ูู ููุงุนุฏ ุจูุงูุงุช ุฅุฏุงุฑุฉ ููุงุนุฏ ุงูุจูุงูุงุช ุงูุฃุฎุฑู ูุฏุนู ุฅูู ุฅุณุงุกุฉ ุงูุงุณุชุฎุฏุงู ุ ุงูุฃูุฑ ุงูุฐู ูุนุงููู ุงูุฌููุน. <br><br>  ูููู ุจุฅูุบุงุก ุชุญุฏูุฏ ุงูุฌุฏูู ูุจุฏุก ูุนุงููุฉ ูุฅุฏุฑุงุฌ ุตู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">TRUNCATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> t; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> t(s) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'FOO'</span></span>); =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> txid_current -------------- 3669 (1 row)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> xmin, xmax, * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> xmin | xmax | id | s ------+------+----+----- 3669 | 0 | 2 | FOO (1 row)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+------+-------+-------- (0,1) | normal | 3669 | 0 (a) | (0,1) (1 row)</code> </pre><br>  ูุญู ุงูุขู ุฅูุดุงุก ููุทุฉ ุญูุธ ูุฅุฏุฑุงุฌ ุตู ุขุฎุฑ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SAVEPOINT</span></span> sp; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> t(s) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'XYZ'</span></span>); =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> txid_current -------------- 3669 (1 row)</code> </pre><br>  ูุงุญุธ ุฃู ุงูุฏุงูุฉ <code>txid_current</code> ุจุฅุฑุฌุงุน ูุนุฑู ุงููุนุงููุฉ ุงูุฑุฆูุณูุฉ ุจุฏูุงู ูู ุงูุชุฑุฌูุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> xmin, xmax, * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> xmin | xmax | id | s ------+------+----+----- 3669 | 0 | 2 | FOO 3670 | 0 | 3 | XYZ (2 rows)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+------+-------+-------- (0,1) | normal | 3669 | 0 (a) | (0,1) (0,2) | normal | 3670 | 0 (a) | (0,2) (2 rows)</code> </pre><br>  ุฏุนููุง ุงูุชุฑุงุฌุน ุฅูู savepoint ูุฅุฏุฑุงุฌ ุงูุตู ุงูุซุงูุซ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> sp; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'BAR'</span></span>); =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> xmin, xmax, * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> xmin | xmax | id | s ------+------+----+----- 3669 | 0 | 2 | FOO 3671 | 0 | 4 | BAR (2 rows)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+----------+-------+-------- (0,1) | normal | 3669 | 0 (a) | (0,1) (0,2) | normal | 3670 (a) | 0 (a) | (0,2) (0,3) | normal | 3671 | 0 (a) | (0,3) (3 rows)</code> </pre><br>  ูู ุงูุตูุญุฉ ุ ูุง ุฒููุง ูุฑู ุงูุตู ุงูุฐู ุชูุช ุฅุถุงูุชู ุจูุงุณุทุฉ ุงูุชุฑุฌูุฉ ุงูุชู ุชู ุฅุฑุฌุงุนูุง. <br><br>  ุงุฑุชูุงุจ ุงูุชุบููุฑุงุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> xmin, xmax, * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> xmin | xmax | id | s ------+------+----+----- 3669 | 0 | 2 | FOO 3671 | 0 | 4 | BAR (2 rows)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+----------+-------+-------- (0,1) | normal | 3669 (c) | 0 (a) | (0,1) (0,2) | normal | 3670 (a) | 0 (a) | (0,2) (0,3) | normal | 3671 (c) | 0 (a) | (0,3) (3 rows)</code> </pre><br>  ูู ุงููุงุถุญ ุงูุขู ุฃู ูู ุนูููุฉ ุชุฑุฌูุฉ ููุง ูุฑูุฒูุง ุงูุฎุงุต. <br><br>  ูุงุญุธ ุฃู SQL ูุง ุชุณูุญ ุจุงูุงุณุชุฎุฏุงู ุงููุงุถุญ ูููุนุงููุงุช ุงููุฑุนูุฉ ุ ุฃู ุฃูู ูุง ููููู ุจุฏุก ูุนุงููุฉ ุฌุฏูุฏุฉ ูุจู ุฅููุงู ุงููุนุงููุงุช ุงูุญุงููุฉ.  ุชุชุฏุฎู ูุฐู ุงูุชูููุฉ ุถููููุง ุนูุฏ ุงุณุชุฎุฏุงู ููุงุท ุญูุธ ูุฃูุถูุง ุนูุฏ ุงูุชุนุงูู ูุน ุงุณุชุซูุงุกุงุช PL / pgSQL ุ ููุฐูู ูู ุจุนุถ ุงูููุงูู ุงูุฃุฎุฑู ุงูุฃูุซุฑ ุบุฑุงุจุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">BEGIN</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">WARNING: there is already a transaction in progress BEGIN</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">COMMIT</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">WARNING: there is no transaction in progress COMMIT</code> </pre><br><h2 style=";text-align:right;direction:rtl">  ุงูุฃุฎุทุงุก ู atomicity ุงูุนูููุฉ </h2><br>  ูุงุฐุง ูุญุฏุซ ุฅุฐุง ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชูููุฐ ุงูุนูููุฉุ  ุนูู ุณุจูู ุงููุซุงู ุ ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> id | s ----+----- 2 | FOO 4 | BAR (2 rows)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> s = repeat(<span class="hljs-string"><span class="hljs-string">'X'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>/(id<span class="hljs-number"><span class="hljs-number">-4</span></span>));</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ERROR: division by zero</code> </pre><br>  ุญุฏุซ ุฎุทุฃ.  ุงูุขู ูุชู ุงูุชุนุงูู ูุน ุงููุนุงููุฉ ูุฅุฌูุงุถ ููุง ููุณูุญ ุจุฃู ุนูููุงุช ูููุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ERROR: current transaction is aborted, commands ignored until end of transaction block</code> </pre><br>  ูุญุชู ุฅุฐุง ุญุงูููุง ุงูุงูุชุฒุงู ุจุงูุชุบููุฑุงุช ุ ูุณูู ูููู PostgreSQL ุจุงูุฅุจูุงุบ ุนู ุงูุงุณุชุนุงุฏุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ROLLBACK</code> </pre><br>  ููุงุฐุง ูุณุชุญูู ุงูุงุณุชูุฑุงุฑ ูู ุชูููุฐ ุงูุตููุฉ ุจุนุฏ ุงููุดูุ  ุงูุดูุก ูู ุฃู ุงูุฎุทุฃ ูููู ุฃู ูุญุฏุซ ุญุชู ูุชููู ูู ุงููุตูู ุฅูู ุฌุฒุก ูู ุงูุชุบููุฑุงุช ุ ุฃู ุฃูู ุณูุชู ูุณุฑ ุงูุฐุฑูุฉ ููุณ ููุท ูููุนุงููุฉ ุ ูููู ุญุชู ุจุงููุณุจุฉ ููุดุบู ูุงุญุฏ.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุงููุซุงู ุงูุฎุงุต ุจูุง ุ ูุฏ ูููู ุงููุดุบู ุจุชุญุฏูุซ ุตู ูุงุญุฏ ูุจู ุญุฏูุซ ุงูุฎุทุฃ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page(<span class="hljs-string"><span class="hljs-string">'t'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | state | xmin | xmax | t_ctid -------+--------+----------+-------+-------- (0,1) | normal | 3669 (c) | 3672 | (0,4) (0,2) | normal | 3670 (a) | 0 (a) | (0,2) (0,3) | normal | 3671 (c) | 0 (a) | (0,3) (0,4) | normal | 3672 | 0 (a) | (0,4) (4 rows)</code> </pre><br>  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃู psql ูุฏูู ูุถุน ูุณูุญ ุจููุงุตูุฉ ุงููุนุงููุฉ ุจุนุฏ ุงููุดู ุ ููุง ูู ุฃู ุขุซุงุฑ ุงููุดุบู ุงูุฎุงุทุฆ ูุฏ ุชุฑุงุฌุนุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; \<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ON_ERROR_ROLLBACK <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> id | s ----+----- 2 | FOO 4 | BAR (2 rows)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> s = repeat(<span class="hljs-string"><span class="hljs-string">'X'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>/(id<span class="hljs-number"><span class="hljs-number">-4</span></span>));</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ERROR: division by zero</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> t;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> id | s ----+----- 2 | FOO 4 | BAR (2 rows)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br>  ูู ุงูุณูู ูุนุฑูุฉ ุฃูู ูู ูุฐุง ุงููุถุน ุ ุชูุดุฆ psql ุจุงููุนู ููุทุฉ ุญูุธ ุถูููุฉ ูุจู ูู ุฃูุฑ ูุชุจุฏุฃ ูู ุงูุชุฑุงุฌุน ุฅูููุง ูู ุญุงูุฉ ุงููุดู.  ูุง ูุชู ุงุณุชุฎุฏุงู ูุฐุง ุงููุถุน ุงูุชุฑุงุถููุง ูุฃู ุฅูุดุงุก ููุงุท ุญูุธ (ุญุชู ุจุฏูู ุงูุชุฑุงุฌุน ุนููุง) ูุณุชูุฒู ุญูููุง ูุจูุฑูุง. <br><br>  <a href="https://habr.com/ru/company/postgrespro/blog/479512/">ุงูุฑุฃ ุนูู</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar477648/">https://habr.com/ru/post/ar477648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar477634/index.html">Microservices ูุงููููู ุงูุชูุธููู. ูุง ูู ุฃููุงุน ุงููุฑู ุงูุชู ุณุชุถูู ุงููุฌุงุญุ</a></li>
<li><a href="../ar477638/index.html">ุงุดุชุฑู! = ูู: ุฌูู ุฏูุฑ ูุณุฑู ุงููุฒุงุฑุนูู ูู ุงูุญู ูู ุฅุตูุงุญ ุงูุฌุฑุงุฑุงุช ุงูุฎุงุตุฉ ุจูู</a></li>
<li><a href="../ar477642/index.html">ุฑุคูุฉ ุงููุงูููุฉ (ุงูุฑุงุฏูู) ุนุจุฑ ุงูุฌุฏุฑุงู</a></li>
<li><a href="../ar477644/index.html">ุงุณุชุนุงุฏุฉ UNIX v0 ุฅูู PDP-7: ุชูุงุตูู Backroom</a></li>
<li><a href="../ar477646/index.html">ููุทุน ุนููุงุก ุงูุฑูุงุถูุงุช ุงูุฃุดูุงู ุจุญุซูุง ุนู ุฃุฌุฒุงุก ูู ุงููุนุงุฏูุงุช</a></li>
<li><a href="../ar477650/index.html">ุชุดููุฑ ุญุฑูุฉ ูุฑูุฑ TLS ููููุง ูุฎูุงุฑุฒููุงุช GOST-2012 ุจุงุณุชุฎุฏุงู Stunnel</a></li>
<li><a href="../ar477654/index.html">ุชุฌุฑุจุฉ ูุดุบู ูุซูู ูุญุณู ูู Java 14</a></li>
<li><a href="../ar477656/index.html">ูุฐูู ูุง ูุฒุงู ุ ููุงุฐุง ุชุญุชุงุฌ ุฌุนูุ</a></li>
<li><a href="../ar477658/index.html">ุงุณุชุนุงุฏุฉ ูุดุทุฉ: ูู ูููู ุฃู ูููู ุงูุชุนุงูู ูู ุงูููุงุฑุซ ุฃุณุฑุนุ ุฃุณุฑุน ุจูุซูุฑุ</a></li>
<li><a href="../ar477662/index.html">ุงููุตูู ุฅูู ุฅุทุงุฑุงุช Redd ุนูู FTDI Bridges</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>