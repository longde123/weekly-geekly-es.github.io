<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎟️ ✌🏽 😠 MVVM-Implementierung der WPF-Anwendungskonfiguration, die auf dem Catel-Framework basiert 🧑‍🤝‍🧑 💇 👨🏼‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Implementieren der Verwaltung von Softwareeinstellungen ist wahrscheinlich eines der Dinge, die in fast jeder Anwendung anders implementiert werde...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MVVM-Implementierung der WPF-Anwendungskonfiguration, die auf dem Catel-Framework basiert</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460981/"><p>  Das Implementieren der Verwaltung von Softwareeinstellungen ist wahrscheinlich eines der Dinge, die in fast jeder Anwendung anders implementiert werden.  Die meisten Frameworks und anderen Add-Ons bieten normalerweise ihre eigenen Tools zum Speichern / Laden von Werten aus einem Schlüsselwert der Parameterspeicherung. </p><br><p>  In den meisten Fällen liegt die Implementierung eines bestimmten Einstellungsfensters und damit verbundener Dinge jedoch im Ermessen des Benutzers.  In diesem Artikel möchte ich den Ansatz teilen, zu dem ich gekommen bin.  In meinem Fall muss ich die Arbeit mit Einstellungen im MVVM-freundlichen Stil und unter Verwendung der Besonderheiten des in diesem Fall verwendeten Catel-Frameworks implementieren. </p><br><p> <strong>Haftungsausschluss</strong> : In diesem Hinweis gibt es keine technischen Feinheiten, die schwieriger sind als die grundlegende Reflexion.  Dies ist nur eine Beschreibung des Ansatzes zur Lösung eines kleinen Problems, das ich am Wochenende hatte.  Ich wollte darüber nachdenken, wie ich den Standard-Boilerplate-Code und das Kopieren und Einfügen im Zusammenhang mit dem Speichern / Laden von Anwendungseinstellungen entfernen kann.  Die Lösung selbst erwies sich dank der praktischen verfügbaren .NET / Catel-Tools als eher trivial, aber vielleicht spart jemand ein paar Stunden Zeit oder schlägt nützliche Gedanken vor. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Catel Framework Brief</b> <div class="spoiler_text"><p>  Wie andere WPF-Frameworks (Prism, MVVM Light, Caliburn.Micro usw.) bietet Catel praktische Tools zum Erstellen von Anwendungen im MVVM-Stil. <br>  Die Hauptkomponenten: </p><br><ul><li>  IoC (integriert in MVVM-Komponenten) </li><li>  ModelBase: Eine Basisklasse, die die automatische Implementierung von PropertyChanged (insbesondere in Verbindung mit Catel.Fody), Serialisierung und BeginEdit / CancelEdit / EndEdit (klassisch "apply" / "cancel") bietet. </li><li>  ViewModelBase kann an das Modell binden und dessen Eigenschaften umschließen. </li><li>  Arbeiten Sie mit Ansichten, die automatisch erstellt und an das ViewModel gebunden werden können.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verschachtelte Steuerelemente werden</a> unterstützt. </li></ul></div></div><br><h2 id="trebovaniya">  Anforderungen </h2><br><p>  Wir gehen davon aus, dass wir von den Konfigurationstools Folgendes erwarten: </p><br><ul><li> Einfach strukturierter Zugriff auf die Konfiguration.  Zum Beispiel <br> <code>CultureInfo culture = settings.Application.PreferredCulture;</code> <br> <code>TimeSpan updateRate = settings.Perfomance.UpdateRate;</code>  . <br><ul><li>  Alle Parameter werden als normale Eigenschaften dargestellt.  Die Speichermethode ist im Inneren gekapselt.  Bei einfachen Typen sollte alles automatisch ablaufen, bei komplexeren Typen sollte es möglich sein, die Serialisierung des Werts in eine Zeichenfolge zu konfigurieren. </li></ul></li><li>  Einfachheit und Zuverlässigkeit.  Ich möchte keine fragilen Tools wie die vollständige Serialisierung des gesamten Konfigurationsmodells oder eines Entity Frameworks verwenden.  Auf der unteren Ebene bleibt die Konfiguration ein einfaches Repository von Parameter-Wert-Paaren. </li><li>  Die Möglichkeit, an der Konfiguration vorgenommene Änderungen zu verwerfen, z. B. wenn der Benutzer im Einstellungsfenster auf "Abbrechen" geklickt hat. </li><li>  Möglichkeit, Konfigurationsupdates zu abonnieren.  Beispielsweise möchten wir die Anwendungssprache unmittelbar nach dem Ändern der Konfiguration aktualisieren. </li><li>  Migration zwischen Anwendungsversionen.  Es sollte möglich sein, Aktionen beim Umschalten zwischen Anwendungsversionen festzulegen (Parameter umbenennen usw.). </li><li>  Minimaler Boilerplate-Code, minimale Tippfehler.  Im Idealfall möchten wir nur die Auto-Eigenschaft festlegen und nicht darüber nachdenken, wie sie gespeichert wird, unter welchem ​​Zeichenfolgenschlüssel usw. Wir möchten nicht jede der Eigenschaften im Ansichtsmodell des Einstellungsfensters manuell kopieren, alles sollte automatisch funktionieren. </li></ul><br><h2 id="standartnye-sredstva">  Standardwerkzeuge </h2><br><p>  Catel bietet den IConfigurationService-Dienst, mit dem Werte von Zeichenfolgenschlüsseln aus dem lokalen Speicher (eine Datei auf der Festplatte in der Standardimplementierung) gespeichert und geladen werden können. </p><br><p>  Wenn wir diesen Dienst in seiner reinen Form verwenden möchten, müssen wir diese Schlüssel selbst deklarieren, indem wir beispielsweise folgende Konstanten festlegen: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Application</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String PreferredCulture = <span class="hljs-string"><span class="hljs-string">"Application.PreferredCulture"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> String PreferredCultureDefaultValue = Thread.CurrentThread.CurrentUICulture.ToString(); }</code> </pre> <br><p>  Dann können wir diese Parameter wie folgt erhalten: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> preferredCulture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(configurationService.GetRoamingValue( Application.PreferredCulture, Application.PreferredCultureDefaultValue));</code> </pre> <br><p>  Es ist viel und mühsam zu schreiben. Bei vielen Einstellungen ist es einfach, Tippfehler zu machen.  Darüber hinaus unterstützt der Dienst nur einfache Typen, z. B. kann <code>CultureInfo</code> nicht ohne zusätzliche Transformationen gespeichert werden. </p><br><p>  Um die Arbeit mit diesem Service zu vereinfachen, wurde ein Wrapper erhalten, der aus mehreren Komponenten besteht. </p><br><p>  Der vollständige Beispielcode ist im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub-Repository</a> verfügbar.  Es enthält die einfachste Anwendung mit der Möglichkeit, einige Parameter in den Einstellungen zu bearbeiten und sicherzustellen, dass alles funktioniert.  Ich habe mich nicht um die Lokalisierung gekümmert. Der Parameter "Sprache" in den Einstellungen wird ausschließlich zur Demonstration der Konfiguration verwendet.  Bei Interesse verfügt Catel über praktische <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lokalisierungsmechanismen</a> , auch auf WPF-Ebene.  Wenn Sie Ressourcendateien nicht mögen, können Sie Ihre eigene Implementierung beispielsweise mit GNU gettext erstellen. </p><br><p>  Aus Gründen der Lesbarkeit wurden in den Codebeispielen im Text dieser Veröffentlichung alle xml-doc-Kommentare entfernt. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_9/js/i_/_9jsi_xxzbfegcuhavmkyluowni.png"></div><br><h2 id="servis-konfiguracii">  Konfigurationsdienst </h2><br><p>  Ein Dienst, der über IoC eingebettet werden kann und von überall in der Anwendung auf Einstellungen zugreifen kann. </p><br><p>  Das Hauptziel des Dienstes besteht darin, ein Einstellungsmodell bereitzustellen, das wiederum eine einfache und strukturierte Möglichkeit bietet, auf sie zuzugreifen. </p><br><p>  Zusätzlich zum Einstellungsmodell bietet der Dienst auch die Möglichkeit, an den Einstellungen vorgenommene Änderungen abzubrechen oder zu speichern. </p><br><p>  Schnittstelle: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IApplicationConfigurationProviderService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> TypedEventHandler&lt;IApplicationConfigurationProviderService&gt; ConfigurationSaved; ConfigurationModel Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadSettingsFromStorage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveChanges</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br><p>  Implementierung: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ApplicationConfigurationProviderService</span></span> : <span class="hljs-title"><span class="hljs-title">IApplicationConfigurationProviderService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IConfigurationService _configurationService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplicationConfigurationProviderService</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationService configurationService</span></span></span><span class="hljs-function">)</span></span> { _configurationService = configurationService; Configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConfigurationModel(); LoadSettingsFromStorage(); ApplyMigrations(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> TypedEventHandler&lt;IApplicationConfigurationProviderService&gt; ConfigurationSaved; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ConfigurationModel Configuration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadSettingsFromStorage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Configuration.LoadFromStorage(_configurationService); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveChanges</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Configuration.SaveToStorage(_configurationService); ConfigurationSaved?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplyMigrations</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentVersion = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ApplicationConfigurationProviderService).Assembly.GetName().Version; String currentVersionString = currentVersion.ToString(); String storedVersionString = _configurationService.GetRoamingValue(<span class="hljs-string"><span class="hljs-string">"SolutionVersion"</span></span>, currentVersionString); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (storedVersionString == currentVersionString) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-comment"><span class="hljs-comment">//Either migrations were already applied or we are on fresh install var storedVersion = new Version(storedVersionString); foreach (var migration in _migrations) { Int32 comparison = migration.Version.CompareTo(storedVersion); if (comparison &lt;= 0) continue; migration.Action.Invoke(); } _configurationService.SetRoamingValue("SolutionVersion", currentVersionString); } }</span></span></code> </pre> <br><p>  Die Implementierung ist trivial. Der Inhalt des <code>ConfigurationModel</code> wird in den folgenden Abschnitten beschrieben.  Das einzige, was wahrscheinlich Aufmerksamkeit erregt, ist die <code>ApplyMigrations</code> Methode. </p><br><p>  In der neuen Version des Programms kann sich etwas ändern, z. B. die Methode zum Speichern eines komplexen Parameters oder dessen Name.  Wenn wir unsere Einstellungen nicht nach jedem Update verlieren möchten, bei dem vorhandene Parameter geändert werden, benötigen wir einen Migrationsmechanismus.  Die <code>ApplyMigrations</code> Methode <code>ApplyMigrations</code> sehr einfache Unterstützung für die Ausführung von Aktionen während des Übergangs zwischen Versionen. </p><br><p>  Wenn sich in der neuen Version der Anwendung etwas geändert hat, fügen wir einfach die erforderlichen Aktionen (z. B. Speichern des Parameters unter einem neuen Namen) in der neuen Version zur Liste der in der benachbarten Datei enthaltenen Migrationen hinzu: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IReadOnlyCollection&lt;Migration&gt; _migrations = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Migration[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Migration(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Version(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>), () =&gt; { <span class="hljs-comment"><span class="hljs-comment">//... }) } .OrderBy(migration =&gt; migration.Version) .ToArray(); private class Migration { public readonly Version Version; public readonly Action Action; public Migration(Version version, Action action) { Version = version; Action = action; } }</span></span></code> </pre> <br><h2 id="model-nastroek">  Einstellungsmodell </h2><br><p>  Die Automatisierung von Routineoperationen ist wie folgt.  Die Konfiguration wird als reguläres Modell (Datenobjekt) beschrieben.  Catel bietet eine praktische Basisklasse <code>ModelBase</code> , die den Kern aller MVVM-Tools bildet, z. B. automatische Bindungen zwischen allen drei MVVM-Komponenten.  Insbesondere können Sie problemlos auf die Modelleigenschaften zugreifen, die wir speichern möchten. </p><br><p>  Durch Deklarieren eines solchen Modells können wir seine Eigenschaften abrufen, Zeichenfolgenschlüssel zuordnen, sie aus Eigenschaftsnamen erstellen und dann automatisch Werte aus der Konfiguration laden und speichern.  Mit anderen Worten, binden Sie Eigenschaften und Werte in einer Konfiguration. </p><br><h3 id="obyavlenie-parametrov-konfiguracii">  Konfigurationsoptionen deklarieren </h3><br><p>  Dies ist das Wurzelmodell: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConfigurationModel</span></span> : <span class="hljs-title"><span class="hljs-title">ConfigurationGroupBase</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigurationModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Application = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ApplicationConfiguration(); Performance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PerformanceConfiguration(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ApplicationConfiguration Application { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PerformanceConfiguration Performance { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  <code>ApplicationConfiguration</code> und <code>PerfomanceConfiguration</code> sind Unterklassen, die ihre Einstellungsgruppen beschreiben: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConfigurationModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PerformanceConfiguration</span></span> : <span class="hljs-title"><span class="hljs-title">ConfigurationGroupBase</span></span> { [DefaultValue(<span class="hljs-number"><span class="hljs-number">10</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Int32 MaxUpdatesPerSecond { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre> <br><p>  Unter der Haube wird diese Eigenschaft an den Parameter <code>"Performance.MaxUpdatesPerSecond"</code> gebunden, dessen Name aus dem Namen des Typs <code>PerformanceConfiguration</code> generiert wird. </p><br><p>  Es sollte beachtet werden, dass die Möglichkeit, diese Eigenschaften zu deklarieren, dank der Verwendung von <a href="">Catel.Fody</a> , einem Plug-In für den bekannten .NET-Codegenerator <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fody</a> , so <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">präzise war</a> .  Wenn Sie es aus irgendeinem Grund nicht verwenden möchten, sollten die Eigenschaften gemäß der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> wie gewohnt deklariert werden (visuell ähnlich wie DependencyProperty von WPF). </p><br><p>  Falls gewünscht, kann der Verschachtelungsgrad erhöht werden. </p><br><h3 id="realizaciya-svyazyvaniya-svoystv-s-iconfigurationservice">  Implementieren Sie die Eigenschaftsbindung mit IConfigurationService </h3><br><p>  Die Bindung erfolgt in der Basisklasse <code>ConfigurationGroupBase</code> , die wiederum von ModelBase geerbt wird.  Betrachten Sie den Inhalt genauer. </p><br><p>  Zunächst erstellen wir eine Liste der Eigenschaften, die wir speichern möchten: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConfigurationGroupBase</span></span> : <span class="hljs-title"><span class="hljs-title">ModelBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IReadOnlyCollection&lt;ConfigurationProperty&gt; _configurationProperties; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IReadOnlyCollection&lt;PropertyData&gt; _nestedConfigurationGroups; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigurationGroupBase</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> properties = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetDependencyResolver() .Resolve&lt;PropertyDataManager&gt;() .GetCatelTypeInfo(GetType()) .GetCatelProperties() .Select(property =&gt; property.Value) .Where(property =&gt; property.IncludeInBackup &amp;&amp; !property.IsModelBaseProperty) .ToArray(); _configurationProperties = properties .Where(property =&gt; !property.Type.IsSubclassOf(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ConfigurationGroupBase))) .Select(property =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ReSharper disable once PossibleNullReferenceException String configurationKeyBase = GetType() .FullName .Replace("+", ".") .Replace(typeof(ConfigurationModel).FullName + ".", string.Empty); configurationKeyBase = configurationKeyBase.Remove(configurationKeyBase.Length - "Configuration".Length); String configurationKey = $"{configurationKeyBase}.{property.Name}"; return new ConfigurationProperty(property, configurationKey); }) .ToArray(); _nestedConfigurationGroups = properties .Where(property =&gt; property.Type.IsSubclassOf(typeof(ConfigurationGroupBase))) .ToArray(); } ... private class ConfigurationProperty { public readonly PropertyData PropertyData; public readonly String ConfigurationKey; public ConfigurationProperty(PropertyData propertyData, String configurationKey) { PropertyData = propertyData; ConfigurationKey = configurationKey; } } }</span></span></code> </pre> <br><p>  Hier wenden wir uns einfach dem Analogon der Reflexion für Catel-Modelle zu, erhalten Eigenschaften (durch Filtern von Dienstprogrammen oder solchen, die wir explizit mit dem Attribut <code>[ExcludeFromBackup]</code> markiert haben) und generieren Zeichenfolgenschlüssel für diese.  Eigenschaften, die selbst vom Typ <code>ConfigurationGroupBase</code> , werden in einer separaten Liste aufgeführt. </p><br><p>  Die <code>LoadFromStorage()</code> -Methode schreibt Werte aus der Konfiguration in die zuvor erhaltenen Eigenschaften oder in Standardwerte, wenn diese nicht zuvor gespeichert wurden.  Für Untergruppen heißt <code>LoadFromStorage()</code> : </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadFromStorage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationService configurationService</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> property <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _configurationProperties) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { LoadPropertyFromStorage(configurationService, property.ConfigurationKey, property.PropertyData); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { Log.Error(ex, <span class="hljs-string"><span class="hljs-string">"Can't load from storage nested configuration group {Name}"</span></span>, property.PropertyData.Name); } } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> property <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _nestedConfigurationGroups) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> configurationGroup = GetValue(property) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ConfigurationGroupBase; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (configurationGroup == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Log.Error(<span class="hljs-string"><span class="hljs-string">"Can't load from storage configuration property {Name}"</span></span>, property.Name); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } configurationGroup.LoadFromStorage(configurationService); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadPropertyFromStorage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationService configurationService, String configurationKey, PropertyData propertyData</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> objectConverterService = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetDependencyResolver().Resolve&lt;IObjectConverterService&gt;(); Object <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = configurationService.GetRoamingValue(configurationKey, propertyData.GetDefaultValue()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> String stringValue) <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = objectConverterService.ConvertFromStringToObject(stringValue, propertyData.Type, CultureInfo.InvariantCulture); SetValue(propertyData, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); }</code> </pre> <br><p>  Die <code>LoadPropertyFromStorage</code> Methode bestimmt, wie der Wert von der Konfiguration an die Eigenschaft übertragen wird.  Es ist virtuell und kann für nicht triviale Eigenschaften neu definiert werden. </p><br><p>  Eine kleine Funktion des internen Betriebs des <code>IConfigurationService</code> Dienstes: Sie können die Verwendung von <code>IObjectConverterService</code> .  <code>IConfigurationService.GetValue</code> ist erforderlich, da <code>IConfigurationService.GetValue</code> in diesem Fall mit einem generischen Parameter vom Typ <code>Object</code> <code>IConfigurationService.GetValue</code> In diesem Fall werden die geladenen Zeichenfolgen beispielsweise nicht in Zahlen konvertiert. Sie müssen dies also selbst tun. </p><br><p>  Ähnliches gilt für das Speichern von Parametern: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveToStorage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationService configurationService</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> property <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _configurationProperties) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { SavePropertyToStorage(configurationService, property.ConfigurationKey, property.PropertyData); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { Log.Error(ex, <span class="hljs-string"><span class="hljs-string">"Can't save to storage configuration property {Name}"</span></span>, property.PropertyData.Name); } } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> property <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _nestedConfigurationGroups) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> configurationGroup = GetValue(property) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ConfigurationGroupBase; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (configurationGroup == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Log.Error(<span class="hljs-string"><span class="hljs-string">"Can't save to storage nested configuration group {Name}"</span></span>, property.Name); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } configurationGroup.SaveToStorage(configurationService); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SavePropertyToStorage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationService configurationService, String configurationKey, PropertyData propertyData</span></span></span><span class="hljs-function">)</span></span> { Object <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = GetValue(propertyData); configurationService.SetRoamingValue(configurationKey, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); }</code> </pre> <br><p>  Es ist zu beachten, dass Sie innerhalb des Konfigurationsmodells einfache Namenskonventionen befolgen müssen, um einheitliche Parameterzeichenfolgenschlüssel zu erhalten: </p><br><ul><li>  Die Arten von Einstellungsgruppen (mit Ausnahme des Stamms) sind Unterklassen der "übergeordneten" Gruppe, und ihre Namen enden mit "Konfiguration". </li><li>  Für jeden solchen Typ gibt es eine entsprechende Eigenschaft.  Zum Beispiel die <code>ApplicationSettings</code> Gruppe und die <code>Application</code> Eigenschaft.  Der Name der Eigenschaft hat keine Auswirkungen, dies ist jedoch die logischste und erwartete Option. </li></ul><br><h3 id="nastroyka-sohraneniya-otdelnyh-svoystv">  Einstellung Einzelne Eigenschaften speichern </h3><br><p>  Die automatische <code>IConfigurationService</code> Catel.Fody und <code>IConfigurationService</code> (direktes Speichern des Werts in <code>IConfigurationService</code> und des Attributs <code>[DefaultValue]</code> ) funktioniert nur für einfache Typen und konstante Standardwerte.  Für komplexe Eigenschaften müssen Sie etwas authentischer malen: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConfigurationModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ApplicationConfiguration</span></span> : <span class="hljs-title"><span class="hljs-title">ConfigurationGroupBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CultureInfo PreferredCulture { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DefaultValue(<span class="hljs-string"><span class="hljs-string">"User"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> String Username { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadPropertyFromStorage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationService configurationService, String configurationKey, PropertyData propertyData</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (propertyData.Name) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">case</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nameof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PreferredCulture</span></span></span><span class="hljs-function">): String preferredCultureDefaultValue</span></span> = CultureInfo.CurrentUICulture.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preferredCultureDefaultValue != <span class="hljs-string"><span class="hljs-string">"en-US"</span></span> || preferredCultureDefaultValue != <span class="hljs-string"><span class="hljs-string">"ru-RU"</span></span>) preferredCultureDefaultValue = <span class="hljs-string"><span class="hljs-string">"en-US"</span></span>; String <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = configurationService.GetRoamingValue(configurationKey, preferredCultureDefaultValue); SetValue(propertyData, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CultureInfo(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LoadPropertyFromStorage(configurationService, configurationKey, propertyData); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SavePropertyToStorage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IConfigurationService configurationService, String configurationKey, PropertyData propertyData</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (propertyData.Name) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">case</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nameof</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PreferredCulture</span></span></span><span class="hljs-function">): Object </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">value</span></span></span></span> = GetValue(propertyData); configurationService.SetRoamingValue(configurationKey, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.SavePropertyToStorage(configurationService, configurationKey, propertyData); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } }</code> </pre> <br><p>  Jetzt können wir zum Beispiel im Einstellungsfenster an eine der Modelleigenschaften binden: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Configuration.Application.Username}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Es bleibt zu beachten, dass die Vorgänge beim Schließen des ViewModel-Einstellungsfensters überschrieben werden müssen: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Task&lt;Boolean&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _applicationConfigurationProviderService.SaveChanges(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.SaveAsync(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Task&lt;Boolean&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CancelAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _applicationConfigurationProviderService.LoadSettingsFromStorage(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.CancelAsync(); }</code> </pre> <br><p>  Mit der Erhöhung der Anzahl der Parameter und dementsprechend der Komplexität der Benutzeroberfläche können Sie auf einfache Weise separate Ansichten und ViewModel für jeden Einstellungsabschnitt erstellen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460981/">https://habr.com/ru/post/de460981/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460967/index.html">Troy Hunt: 10 persönliche Finanzstunden für IT-Profis</a></li>
<li><a href="../de460969/index.html">Margaret Hamilton: „Sie hatten Angst, dass Männer rebellieren könnten; aber es ist nicht passiert. "</a></li>
<li><a href="../de460971/index.html">NVIDIA Jetson Nano: Tests und erste Eindrücke - Teil 2, AI-Tests</a></li>
<li><a href="../de460973/index.html">Kontaktschweißen für 18650 Batterien</a></li>
<li><a href="../de460979/index.html">Verjüngungsbiotechnologien sind real und unvermeidlich</a></li>
<li><a href="../de460983/index.html">Ich bin nicht real</a></li>
<li><a href="../de460985/index.html">14 besten Kanban-Tools im Jahr 2019</a></li>
<li><a href="../de460987/index.html">"God Mode for the Internet": Verfolgung von Benutzern über die Erweiterungen Chrome und Firefox</a></li>
<li><a href="../de460989/index.html">Welche Sprache - D, Go oder Rust - hat bessere Aussichten, C zu ersetzen, und warum?</a></li>
<li><a href="../de460991/index.html">Tic Tac Toe, Teil 5: C ++ Backend Boost.Beast, HTTP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>