<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêò üëó üë®üèº‚Äçüé® Modulare Sprite-Charaktere und ihre Animation ‚õ≥Ô∏è ‚öõÔ∏è üëçüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Blog-Beitrag ist ganz meinem Charakter-Animationssystem gewidmet. Er enth√§lt n√ºtzliche Tipps und Code-Schnipsel. 

 In den letzten zwei Monaten...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Modulare Sprite-Charaktere und ihre Animation</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468991/"> Dieser Blog-Beitrag ist ganz meinem Charakter-Animationssystem gewidmet. Er enth√§lt n√ºtzliche Tipps und Code-Schnipsel. <br><br>  In den letzten zwei Monaten habe ich bis zu 9 neue Spieleraktionen (so lustige Dinge wie Blockieren mit einem Schild, Ausweichen vor einem Sprung und Waffen), 17 neue tragbare Gegenst√§nde, 3 R√ºstungss√§tze (Platte, Seide und Leder) und 6 Arten von Frisuren erstellt.  Ich habe auch die gesamte Automatisierung und die Tools fertiggestellt, sodass bereits alles im Spiel verwendet wird.  In dem Artikel werde ich erz√§hlen, wie ich das erreicht habe! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ef/52a/188/2ef52a1887cdbe639fd35d9df414c38d.gif"></div><br>  <i>Ich hoffe, diese Informationen sind n√ºtzlich und beweisen, dass es nicht notwendig ist, ein Genie zu sein, um solche Tools / Automatisierungen unabh√§ngig zu erstellen.</i> <br><br><h2>  Kurzbeschreibung </h2><br>  Zun√§chst wollte ich pr√ºfen, ob es m√∂glich ist, √ºbereinanderliegende Sprites mit synchronisierten Animatoren zu kombinieren, um einen modularen Charakter mit austauschbaren Frisuren, Ger√§ten und tragbaren Gegenst√§nden zu schaffen.  Ist es m√∂glich, handgezeichnete Pixelanimationen mit einem wirklich anpassbaren Charakter zu kombinieren? <br><br>  Nat√ºrlich werden solche Funktionen in 3D- und 2D-Spielen mit vorgerenderten Sprites oder in 2D-Spielen mit Skelettanimation aktiv verwendet, aber meines Wissens gibt es nicht viele Spiele, die manuell erstellte Animationen und modulare Charaktere kombinieren (normalerweise, weil sich herausstellt, dass dies der Fall ist zu eint√∂nig). <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/412/7a9/d23/4127a9d23d4d84e28671deee781495cb.gif"></div><br>  <i>Ich habe dieses alte GIF meines ersten Monats mit Unity entdeckt.</i>  <i>Tats√§chlich war dieses modulare Sprite eines meiner ersten Experimente in der Spieleentwicklung!</i> <br><br>  Ich habe einen Prototyp mit dem Unity-Animationssystem erstellt und dann ein Hemd, eine Hose, eine Frisur und drei Elemente hinzugef√ºgt, um das Konzept zu testen.  Dies erforderte 26 separate Animationen. <br><br>  Zu dieser Zeit habe ich alle meine Animationen in Photoshop erstellt und mich nicht um die Automatisierung des Prozesses gek√ºmmert, daher war es sehr langweilig.  Dann dachte ich: "Also, die Grundidee hat funktioniert, sp√§ter werde ich neue Animationen und Ger√§te hinzuf√ºgen."  Es stellte sich heraus, dass "sp√§ter" einige Jahre sp√§ter ist. <br><br>  Im M√§rz dieses Jahres habe ich das Design einer gro√üen Menge an R√ºstungen gezeichnet (siehe meinen vorherigen Beitrag) und festgestellt, wie dieser Prozess bequemer gestaltet werden kann.  Ich habe die Implementierung weiter verschoben, weil ich trotz der Automatisierung nerv√∂s war, dass nichts funktionieren w√ºrde. <br><br>  Ich hatte erwartet, dass ich die Anpassung des Charakters aufgeben und den einzigen Hauptcharakter erstellen m√ºsste, wie in den meisten Spielen mit manueller Animation.  Aber ich hatte einen Aktionsplan und es war Zeit zu pr√ºfen, ob ich dieses Monster besiegen konnte! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88b/030/c5a/88b030c5a82c6cd801f7ce4d8b08ff6d.gif"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddd/55f/12c/ddd55f12cb35e4fa22093cdddecd63d4.gif" width="500"></div><br>  <i>Spoiler: Alles ist super geworden.</i>  <i>Unten werde ich meine *** Geheimnisse *** enth√ºllen</i> <br><br><h2>  Modulares Sprite-System </h2><br><h4>  I. Kennen Sie Ihre Grenzen </h4><br>  Zuvor habe ich viele Kunst- und Zeitkontrolltests durchgef√ºhrt, um herauszufinden, wie lange solche Arbeiten dauern k√∂nnen und ob ein √§hnliches Qualit√§tsniveau f√ºr mich erreichbar ist. <br><br>  Ich schrieb alle meine Ideen f√ºr Animationen auf, stellte sie in einer Tabelle zusammen und ordnete sie nach verschiedenen Kriterien wie N√ºtzlichkeit, Sch√∂nheit und wiederholter Verwendung.  Zu meiner √úberraschung war das allererste auf dieser Liste die Besetzungsanimation des Gegenstands (Tr√§nke, Bomben, Messer, √Ñxte, Ball). <br><br>  Ich habe f√ºr jede Animation eine numerische Bewertung erstellt und alles mit schlechter Leistung aufgegeben.  Anfangs hatte ich vor, 6 R√ºstungss√§tze zu erstellen, erkannte aber schnell, dass es zu viel war, und warf drei Typen aus. <br><br>  Der Aspekt der Zeiterfassung erwies sich als sehr wichtig, und ich empfehle dringend, ihn zur Beantwortung von Fragen wie "Wie viele Feinde kann ich mir leisten, um ihn im Spiel zu erstellen?" Zu verwenden.  Nach nur wenigen Tests gelang es mir, eine ziemlich genaue Sch√§tzung zu extrapolieren.  Bei weiteren Arbeiten an Animationen verfolgte ich weiterhin die Zeit und √ºberarbeitete meine Erwartungen. <br><br>  <i>Ich werde eine Kopie meines Arbeitstagebuchs der letzten zwei Monate teilen.</i>  <i>Bitte beachten Sie, dass diese Zeit zus√§tzlich zu meiner √ºblichen Arbeit ist, bei der ich 30 Stunden pro Woche verbringe:</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://docs.google.com/spreadsheets/d/1Nbr7lujZTB4pWMsuedVcgBYS6n5V-rHrk1PxeGxr6Ck/edit?usp=sharing</a> <br><br><h4>  II.  √Ñndern der Palette f√ºr eine bessere Zukunft </h4><br>  Wenn Sie die Farben im Sprite-Design mit Bedacht verwenden, k√∂nnen Sie ein Sprite zeichnen und durch √Ñndern der Palette viele verschiedene Variationen erstellen.  Sie k√∂nnen nicht nur Farben √§ndern, sondern auch verschiedene Ein- und Ausschaltelemente erstellen (z. B. Farben durch Transparenz ersetzen). <br><br>  Jeder R√ºstungssatz besteht aus 3 Variationen. Durch Mischen des oberen und unteren Teils erhalten Sie viele Kombinationen.  Ich plane, ein System zu implementieren, in dem Sie einen Satz R√ºstungen f√ºr das Aussehen des Charakters und einen anderen f√ºr seine Eigenschaften (wie in Terraria) sammeln k√∂nnen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/873/80c/0b9/87380c0b99d150828af05b1a0cf33ef6.gif"></div><br>  <i>Dabei war ich angenehm √ºberrascht von den entdeckten merkw√ºrdigen Kombinationen.</i>  <i>Wenn Sie die Plattenoberseite mit einer Seidenunterseite verbinden, k√∂nnen Sie etwas im Stil eines Kriegsmagiers erhalten.</i> <br><br>  Es ist am besten, die Paletten mithilfe der Farben zu √§ndern, die den Wert im Sprite codieren, damit Sie sie sp√§ter verwenden k√∂nnen, um die tats√§chliche Farbe aus der Palette zu ermitteln.  Ich wei√ü, dass ich ein bisschen vereinfache. Hier ist ein Video, um Ihnen den Einstieg zu erleichtern: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/u4Iz5AJa31Q" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Ich werde nicht alles im Detail erkl√§ren, sondern √ºber M√∂glichkeiten zur Implementierung dieser Technik in Unity und deren Vor- und Nachteile sprechen. <br><br><h4>  1. Suchen Sie die Textur f√ºr jede Palette </h4><br>  Dies ist die beste Strategie, um Variationen von Feinden, Hintergr√ºnden und allem zu erstellen, wo viele Sprites dieselbe Palette / dasselbe Material haben.  Verschiedene Materialien k√∂nnen nicht in Chargen gruppiert werden, selbst wenn sie dasselbe Sprite / denselben Atlas verwenden.  Das Arbeiten mit Texturen ist sehr schmerzhaft, aber Sie k√∂nnen Paletten in Echtzeit √§ndern, indem Sie Materialien mit SpriteRenderer.sharedMaterial.SetTexture oder MaterialPropertyBlock ersetzen, wenn Sie f√ºr jede Instanz des Materials unterschiedliche Paletten ben√∂tigen.  Hier ist ein Beispiel f√ºr eine Shader-Fragment-Funktion: <br><br><pre><code class="cpp hljs">sampler2D _MainTex; sampler2D _PaletteTex; float4 _PaletteTex_TexelSize; <span class="hljs-function"><span class="hljs-function">half4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v2f input)</span></span></span><span class="hljs-function"> : SV_TARGET </span></span>{ half4 lookup = tex2D(_MainTex, input.uv); half4 color = tex2D(_PaletteTex, half2(lookup.r * (_PaletteTex_TexelSize.x / <span class="hljs-number"><span class="hljs-number">0.00390625f</span></span>), <span class="hljs-number"><span class="hljs-number">0.5</span></span>)); color.a *= lookup.a; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color * input.color; }</code> </pre> <br><h4>  2. Farbreihe </h4><br>  Ich habe mich f√ºr diese Entscheidung entschieden, weil ich die Paletten jedes Mal ersetzen musste, wenn sich das Aussehen des Charakters √§ndert (z. B. beim Anlegen von Gegenst√§nden), und einige Paletten dynamisch erstellen musste (um die vom Spieler gew√§hlten Haar- und Hautfarben anzuzeigen).  Es schien mir, dass es zur Laufzeit und im Editor f√ºr diese Zwecke viel einfacher w√§re, mit Arrays zu arbeiten. <br><br>  Code: <br><br><pre> <code class="cpp hljs">sampler2D _MainTex; half4 _Colors[<span class="hljs-number"><span class="hljs-number">32</span></span>]; <span class="hljs-function"><span class="hljs-function">half4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v2f input)</span></span></span><span class="hljs-function"> : SV_TARGET </span></span>{ half4 lookup = tex2D(_MainTex, input.uv); half4 color = _Colors[round(lookup.r * <span class="hljs-number"><span class="hljs-number">255</span></span>)]; color.a *= lookup.a; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color * input.color; }</code> </pre> <br>  Ich habe meine Paletten als ScriptableObject-Typ dargestellt und sie mit dem MonoBehaviour-Tool bearbeitet.  Nachdem ich lange Zeit an der Bearbeitung von Paletten gearbeitet hatte, um Animationen in Aseprite zu erstellen, erkannte ich, welche Tools ich ben√∂tigte, und schrieb diese Skripte entsprechend.  Wenn Sie Ihr eigenes Tool zum Bearbeiten von Paletten schreiben m√∂chten, empfehle ich auf jeden Fall folgende Funktionen: <br><br>  - Aktualisieren von Paletten auf verschiedenen Materialien beim Bearbeiten von Farben, um √Ñnderungen in Echtzeit anzuzeigen. <br><br>  - Zuweisen von Namen und √Ñndern der Reihenfolge der Farben in der Palette (verwenden Sie das Feld, um den Farbindex zu speichern, nicht dessen Reihenfolge im Array). <br><br>  - W√§hlen und bearbeiten Sie mehrere Farben gleichzeitig.  (Tipp: Sie k√∂nnen die Farbfelder in Unity kopieren und einf√ºgen: Klicken Sie einfach auf eine Farbe, kopieren Sie, klicken Sie auf eine andere Farbe, f√ºgen Sie sie ein - jetzt sind sie gleich!) <br><br>  - √úberlagerungsfarbe auf die gesamte Palette auftragen <br><br>  - Palette in Textur aufnehmen <br><br><h4>  3. Eine einzelne Suchtextur f√ºr alle Paletten </h4><br>  Wenn Sie die Paletten im laufenden Betrieb wechseln m√∂chten, aber gleichzeitig einen Stapel erstellen m√ºssen, um die Anzahl der Draw-Aufrufe zu verringern, k√∂nnen Sie diese Technik verwenden.  Es kann f√ºr mobile Plattformen n√ºtzlich sein, aber die Verwendung ist ziemlich unpraktisch. <br><br>  Zun√§chst m√ºssen Sie alle Paletten in eine gro√üe Textur packen.  Anschlie√üend verwenden Sie die in der SpriteRenderer-Komponente angegebene Farbe (AKA-Scheitelpunktfarbe), um die Linie zu bestimmen, die aus der Palettentextur in den Shader gelesen werden soll.  Das hei√üt, die Palette dieses Sprites wird √ºber SpriteRenderer.color gesteuert.  Die Scheitelpunktfarbe ist die einzige SpriteRenderer-Eigenschaft, die ge√§ndert werden kann, ohne die Bedingung zu verletzen (vorausgesetzt, alle Materialien sind gleich). <br><br>  In den meisten F√§llen ist es am besten, den Index √ºber den Alphakanal zu steuern, da Sie wahrscheinlich keine Sprites mit unterschiedlicher Transparenz ben√∂tigen. <br><br>  Code: <br><br><pre> <code class="cpp hljs">sampler2D _MainTex; sampler2D _PaletteTex; float4 _PaletteTex_TexelSize; <span class="hljs-function"><span class="hljs-function">half4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v2f input)</span></span></span><span class="hljs-function"> : SV_TARGET </span></span>{ half4 lookup = tex2D(_MainTex, input.uv); half2 paletteUV = half2( lookup.r * _(PaletteTex_TexelSize.x / <span class="hljs-number"><span class="hljs-number">0.00390625f</span></span>), input.color.a * _(PaletteTex_TexelSize.y / <span class="hljs-number"><span class="hljs-number">0.00390625f</span></span>) ) half4 color = tex2D(_PaletteTex, paletteUV); color.a *= lookup.a; color.rgb *= input.color.rgb; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color; }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47c/f90/895/47cf908951a0ba9f8f65a57711a5c85c.gif"></div><br>  <i>Die Wunder des Ersetzens von Paletten und Sprite-Ebenen.</i>  <i>So viele Kombinationen.</i> <br><br><h4>  III.  Automatisieren Sie alles und verwenden Sie die richtigen Werkzeuge. </h4><br>  Um diese Funktion zu implementieren, war eine Automatisierung unbedingt erforderlich, da ich ungef√§hr 300 Animationen und Tausende von Sprites erhielt. <br><br>  Mein erster Schritt bestand darin, einen Exporter f√ºr Aseprite zu erstellen, um mein verr√ºcktes Sprite-Layer-Schema √ºber eine praktische <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Befehlszeilenschnittstelle</a> zu verwalten.  Dies ist nur ein Perl-Skript, das alle Ebenen und Beschriftungen in meiner Aseprite-Datei umgeht und Bilder in ein bestimmtes Verzeichnis und eine bestimmte Namensstruktur exportiert, damit ich sie sp√§ter lesen kann. <br><br>  Dann schrieb ich einen Importeur f√ºr Unity.  Aseprite zeigt eine praktische JSON-Datei mit Rahmendaten an, sodass Sie Animationselemente programmgesteuert erstellen k√∂nnen.  Der Umgang mit Aseprite JSON und das Schreiben dieses Datentyps erwiesen sich als ziemlich m√ºhsam, daher bringe ich sie hierher.  Sie k√∂nnen sie einfach mit JsonUtility.FromJson &lt;AespriteData&gt; in Unity laden. Denken Sie daran, Aseprite mit der Option --format 'json-array' auszuf√ºhren. <br><br>  Code: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">System.Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> AespriteData { [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Size { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h; } [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Position { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h; } [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Frame { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> filename; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Position frame; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> rotated; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> trimmed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Position spriteSourceSize; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Size sourceSize; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> duration; } [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Metadata { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> app; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> version; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> format; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Size size; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> scale; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Frame[] frames; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Metadata meta; }</code> </pre> <br>  Auf der Unity-Seite hatte ich an zwei Stellen ernsthafte Probleme: Laden / Schneiden eines Sprite-Blatts und Erstellen eines Animationsclips.  Ein klares Beispiel w√ºrde mir sehr helfen. Hier ist ein Codeausschnitt meines Importeurs, damit Sie nicht so sehr leiden: <br><br>  Code: <br><br><pre> <code class="cs hljs">TextureImporter textureImporter = AssetImporter.GetAtPath(spritePath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TextureImporter; textureImporter.spriteImportMode = SpriteImportMode.Multiple; SpriteMetaData[] spriteMetaData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpriteMetaData[aespriteData.frames.Length]; <span class="hljs-comment"><span class="hljs-comment">// Slice the spritesheet according to the aesprite data. for (int i = 0; i &lt; aespriteData.frames.Length; i++) { AespriteData.Position spritePosition = aespriteData.frames[i].frame; spriteMetaData[i].name = aespriteData.frames[i].filename; spriteMetaData[i].rect = new Rect(spritePosition.x, spritePosition.y, spritePosition.w, spritePosition.h); spriteMetaData[i].alignment = (int)SpriteAlignment.Custom; // Same as "Pivot" in Sprite Editor. spriteMetaData[i].pivot = new Vector2(0.5f, 0f); // Same as "Custom Pivot" in Sprite Editor. Ignored if alignment isn't "Custom". } textureImporter.spritesheet = spriteMetaData; AssetDatabase.ImportAsset(spritePath, ImportAssetOptions.ForceUpdate); Object[] assets = AssetDatabase.LoadAllAssetsAtPath(spritePath); // The first element in this array is actually a Texture2D (ie the sheet itself). for (int i = 1; i &lt; assets.Length; i++) { sprites[i - 1] = assets[i] as Sprite; } // Create the animation. AnimationClip clip = new AnimationClip(); clip.frameRate = 40f; float frameLength = 1f / clip.frameRate; ObjectReferenceKeyframe[] keyframes = new ObjectReferenceKeyframe[aespriteData.frames.Length + 1]; // One extra keyframe is required at the end to express the last frame's duration. float time = 0f; for (int i = 0; i &lt; keyframes.Length; i++) { bool lastFrame = i == keyframes.Length - 1; ObjectReferenceKeyframe keyframe = new ObjectReferenceKeyframe(); keyframe.value = sprites[lastFrame ? i - 1 : i]; keyframe.time = time - (lastFrame ? frameLength : 0f); keyframes[i] = keyframe; time += lastFrame ? 0f : aespriteData.frames[i].duration / 1000f; } EditorCurveBinding binding = new EditorCurveBinding(); binding.type = typeof(SpriteRenderer); binding.path = ""; binding.propertyName = "m_Sprite"; AnimationUtility.SetObjectReferenceCurve(clip, binding, keyframes); AssetDatabase.CreateAsset(clip, "Assets/Animation/" + name + ".anim"); AssetDatabase.SaveAssets();</span></span></code> </pre> <br>  Wenn Sie es noch nicht getan haben, glauben Sie mir - es ist sehr einfach, eigene Tools zu erstellen.  Der einfachste Trick besteht darin, ein GameObject in der Szene mit dem MonoBehaviour zu platzieren, an das das Attribut [ExecuteInEditMode] angeh√§ngt ist.  F√ºgen Sie einen Knopf hinzu und Sie sind bereit f√ºr den Kampf!  Denken Sie daran, dass Ihre pers√∂nlichen Werkzeuge nicht gut aussehen m√ºssen, sondern rein n√ºtzlich sein k√∂nnen. <br><br>  Code: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ExecuteInEditMode</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyCoolTool</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> button; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (button) { button = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; DoThing(); } } }</code> </pre> <br>  Bei der Arbeit mit Sprites ist es recht einfach, Standardaufgaben zu automatisieren (z. B. das Erstellen von Palettentexturen oder das Ersetzen von Farben durch Stapel in mehreren Sprite-Dateien).  Hier ist ein Beispiel, anhand dessen Sie lernen k√∂nnen, wie Sie Ihre Sprites √§ndern. <br><br>  Code: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = <span class="hljs-string"><span class="hljs-string">"Assets/Whatever/Sprite.png"</span></span>; Texture2D texture = AssetDatabase.LoadAssetAtPath&lt;Texture2D&gt;(path); TextureImporter textureImporter = AssetImporter.GetAtPath(path) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TextureImporter; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!textureImporter.isReadable) { textureImporter.isReadable = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; AssetDatabase.ImportAsset(path, ImportAssetOptions.ForceUpdate); } Color[] pixels = texture.GetPixels(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, texture.width, texture.height); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; pixels.Length; i++) { <span class="hljs-comment"><span class="hljs-comment">// Do something with the pixels, eg replace one color with another. } texture.SetPixels(pixels); texture.Apply(); textureImporter.isReadable = false; // Make sure textures are marked as un-readable when you're done. There's a performance cost to using readable textures in your project that you should avoid unless you plan to change a sprite at runtime. byte[] bytes = ImageConversion.EncodeToPNG(texture); File.WriteAllBytes(Application.dataPath + path.Substring(6), bytes); AssetDatabase.ImportAsset(path, ImportAssetOptions.ForceUpdate);</span></span></code> </pre> <br><h4>  Wie ich Mecanim-M√∂glichkeiten √ºberwunden habe: Beschwerde </h4><br>  Im Laufe der Zeit wurde der Prototyp eines modularen Sprite-Systems, das ich mit Mecanim erstellt habe, zum gr√∂√üten Problem beim Upgrade von Unity, da sich die API st√§ndig √§nderte und schlecht dokumentiert war.  Im Fall einer einfachen Zustandsmaschine ist es ratsam, den Status jedes Clips abzufragen oder die Clips zur Laufzeit zu √§ndern.  Aber nein!  Aus Leistungsgr√ºnden backt Unity Clips in ihrem Zustand und zwingt uns, ein ungeschicktes Neudefinitionssystem zu verwenden, um sie zu √§ndern. <br><br>  Mecanim selbst ist kein so schlechtes System, aber es scheint mir, dass es nicht gelingt, sein deklariertes Hauptmerkmal - die Einfachheit - zu verwirklichen.  Die Idee der Entwickler war es, das Komplizierte und Schmerzhafte (Scripting) durch etwas Einfaches (Visual State Machine) zu ersetzen.  Allerdings: <br><br>  - Jede nicht triviale endliche Zustandsmaschine verwandelt sich schnell in ein wildes Netz von Knoten und Verbindungen, deren Logik √ºber verschiedene Schichten verteilt ist. <br><br>  - Einfache Anwendungsf√§lle werden durch allgemeine Systemanforderungen behindert.  Um eine oder zwei Animationen abzuspielen, m√ºssen Sie einen neuen Controller erstellen und Zust√§nde / √úberg√§nge zuweisen.  Nat√ºrlich gibt es eine √ºberm√§√üige Verschwendung von Ressourcen. <br><br>  - Es ist lustig, dass Sie daher immer noch Code schreiben m√ºssen, denn damit die Zustandsmaschine etwas Interessantes tun kann, ben√∂tigen Sie ein Skript, das Animator.SetBool und √§hnliche Methoden aufruft. <br><br>  - F√ºr die mehrfache Verwendung der Zustandsmaschine mit anderen Clips m√ºssen Sie sie duplizieren und die Clips manuell ersetzen.  In Zukunft m√ºssen Sie an mehreren Stellen √Ñnderungen vornehmen. <br><br>  - Wenn Sie zur Laufzeit den Status √§ndern m√∂chten, treten Probleme auf.  Die L√∂sung ist entweder eine schlechte API oder ein verr√ºckter Graph mit einem Knoten f√ºr jede m√∂gliche Animation. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8VgQ5PpTqjc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>Die Geschichte, wie Firewatch-Entwickler in die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">H√∂lle der visuellen</a> Skripterstellung gerieten.</i>  <i>Das Lustige ist, dass wenn der Sprecher die einfachsten Beispiele zeigt, sie immer noch verr√ºckt aussehen.</i>  <i>Die Zuschauer st√∂hnen buchst√§blich um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">12:41 Uhr</a> .</i>  <i>Wenn Sie enorme Wartungskosten hinzuf√ºgen, werden Sie verstehen, warum ich dieses System nicht mag.</i> <br><br>  Viele dieser Probleme sind nicht einmal die Schuld der Mecanim-Entwickler, sondern einfach das nat√ºrliche Ergebnis inkompatibler Ideen: Sie k√∂nnen kein gemeinsames und gleichzeitig einfaches System erstellen, und die Beschreibung der Logik mithilfe von Bildern ist schwieriger als nur W√∂rter / Symbole (erinnert sich jemand an die UML-Flussdiagramme?) .  Ich habe mich an ein Fragment aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zack McClendons Bericht bei Practice NYC 2018 erinnert</a> , und wenn Sie Zeit haben, empfehle ich Ihnen, das gesamte Video anzuschauen! <br><br>  Ich habe es jedoch herausgefunden.  Visuelles Scripting wird immer von aggressiven Nerds "Write Your Own Engine" zensiert, die die Bed√ºrfnisse des K√ºnstlers nicht verstehen.  Dar√ºber hinaus kann nicht geleugnet werden, dass der gr√∂√üte Teil des Codes wie unverst√§ndlicher Fachjargon aussieht. <br><br>  Wenn Sie bereits ein kleiner Programmierer sind und Spiele mit Sprites erstellen, m√ºssen Sie m√∂glicherweise zweimal √ºberlegen.  Als ich anfing, war ich mir sicher, dass ich nie etwas Besseres √ºber die Engine schreiben k√∂nnte als Unity-Entwickler. <br><br>  Und wei√üt du was?  Es stellte sich heraus, dass der Sprite-Animator nur ein Skript ist, das das Sprite nach einer bestimmten Anzahl von Sekunden √§ndert.  Wie dem auch sei, ich musste immer noch meine eigenen schreiben.  Seitdem habe ich meinem spezifischen Projekt Animationsereignisse und andere Funktionen hinzugef√ºgt, aber die Basisversion, die ich an einem halben Tag geschrieben habe, deckt 90% meiner Bed√ºrfnisse ab.  Es besteht aus nur 120 Zeilen und kann hier kostenlos heruntergeladen werden: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://pastebin.com/m9Lfmd94</a> .  Vielen Dank f√ºr das Lesen meines Artikels.  Bis dann! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468991/">https://habr.com/ru/post/de468991/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468967/index.html">"Technologie" zum Erhalten von Gleichungen der Dynamik von TAU. Und warum ist Systemidentifikation schei√üe und "ehrliche Physik" Regeln</a></li>
<li><a href="../de468969/index.html">Erstellen Sie Google-Nutzer aus PowerShell √ºber die API</a></li>
<li><a href="../de468971/index.html">Schreiben in Java f√ºr Nintendo DS</a></li>
<li><a href="../de468973/index.html">Neuronales Netzwerk zur Klassifizierung von Satellitenbildern mit Tensorflow in Python</a></li>
<li><a href="../de468989/index.html">UEBA-Markt stirbt - Es lebe die UEBA</a></li>
<li><a href="../de468993/index.html">Oculus Quest stellt eine Verbindung zu einem PC her und sieht H√§nde</a></li>
<li><a href="../de468995/index.html">Offenheitsrichtlinie: Wie Benutzer das Projekt beeinflussen</a></li>
<li><a href="../de468997/index.html">Mentoring - ein Muss oder ein sch√∂ner Bonus?</a></li>
<li><a href="../de468999/index.html">Welche L√§nder haben das ‚Äûlangsamste‚Äú Internet und wer korrigiert die Situation in schwer erreichbaren Regionen?</a></li>
<li><a href="../de469001/index.html">Wie man Brei aus Microservices kocht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>