<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçü§ù‚Äçüë®üèª üë®üèº‚Äçüè´ üåµ Escribimos nuestro programa m√°s simple para ARM Cortex-M3 üìõ üë©‚Äçüë©‚Äçüë¶ üëÅÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buenas tardes Hoy quiero decirles c√≥mo escribir un programa m√≠nimo que se ejecute en un ARM Cortex-M3 e imprima "¬°Hola, Mundo!". Intentaremos distingu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Escribimos nuestro programa m√°s simple para ARM Cortex-M3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/421833/"><img src="https://habrastorage.org/files/c92/874/069/c92874069b4e49d4ae65eb48e6d6af19.png" alt="imagen" align="right">  Buenas tardes  Hoy quiero decirles c√≥mo escribir un programa m√≠nimo que se ejecute en un ARM Cortex-M3 e imprima "¬°Hola, Mundo!".  Intentaremos distinguir en pasos el m√≠nimo necesario que necesitamos para esto.  Vamos a ejecutar el emulador QEMU.  Por lo tanto, cualquiera puede reproducirse, incluso si no tiene un trozo de hierro a mano. <br><br>  ¬°Entonces vamos! <br><a name="habracut"></a><br>  El emulador QEMU es compatible con el n√∫cleo Cortex-M3 y emula la plataforma Stellaris LM3S811 de Texas Instruments basada en √©l.  Vamos a correr en esta plataforma.  Necesitamos la cadena de herramientas arm-none-eabi- (puede descargarla <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> ).  A continuaci√≥n, debemos escribir la l√≥gica principal de nuestro programa, el c√≥digo de inicio, que transferir√° el control al programa y el script del vinculador. <br><br>  En un habr ya hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culos</a> bastante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">buenos</a> sobre c√≥mo parpadear un diodo en una pieza de hierro desde cero.  Por lo tanto, aqu√≠ no profundizar√© en qu√© y c√≥mo funciona, sino que dar√© solo el conjunto m√≠nimo de conocimientos necesarios para comenzar. <br><br>  Nuestro hola mundo en el archivo test.c: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UART_DR = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *)<span class="hljs-number"><span class="hljs-number">0x4000c000</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uart_print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *s)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (*s != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) { *UART_DR = *s; s++; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c_entry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ uart_print(<span class="hljs-string"><span class="hljs-string">"Hello, World!\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) ; }</code> </pre> <br>  Esta misma direcci√≥n 0x4000c000 se toma de la documentaci√≥n, all√≠ se encuentra el registro DR cero cero.  <b>No participaremos en la configuraci√≥n del UART</b> (esto deber√° hacerse en el hardware), pero intentaremos colocar los s√≠mbolos directamente en √©l. <br><br>  Ahora, necesitamos transferir de alguna manera el control a nuestra funci√≥n with_entry en el archivo test.c.  Para hacer esto, cree el siguiente c√≥digo (archivo startup.S) y luego p√≥ngalo en la imagen ELF final al principio. <br><br><pre> <code class="cpp hljs">.type start, %function .word stack_top <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> .word start <span class="hljs-comment"><span class="hljs-comment">/*    PC */</span></span> .global start start: ldr r1, =c_entry bx r1</code> </pre><br>  La primera palabra en 0x0 debe ser un puntero a la parte superior de la pila (SP).  En 0x4 hay una PC que, como SP, se carga en los registros.  Tenga en cuenta que start se declara precisamente como una funci√≥n, y no como una etiqueta porque el c√≥digo Cortex-M se ejecuta en modo Thumb (este es un conjunto tan simplificado de comandos ARM), y se requiere que las direcciones de las funciones en el vector de interrupci√≥n est√©n en la forma (direcci√≥n | 0x1) - es decir  el √∫ltimo bit de la direcci√≥n debe ser 1. <br><br>  Luego, la funci√≥n de inicio simplemente carga la direcci√≥n de nuestra funci√≥n c_entry () del archivo test.c y pasa el control a trav√©s de "bx r1" all√≠. <br><br>  Solo queda vincular con √©xito nuestro programa.  Para hacer esto, debe configurar la tarjeta de memoria de nuestro microcontrolador.  En la documentaci√≥n puede encontrar las direcciones y tama√±os de memoria flash (ROM) y RAM (RAM).  Aqu√≠ est√° el script del enlazador test.ld: <br><br><pre> <code class="cpp hljs">SECTIONS { . = <span class="hljs-number"><span class="hljs-number">0x0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*   (ROM) */</span></span> .text : { startup.o(.text) test.o(.text) } . = <span class="hljs-number"><span class="hljs-number">0x20000000</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*     RAM */</span></span> .data : { *(.data) } .bss : { *(.bss) } . = ALIGN(<span class="hljs-number"><span class="hljs-number">8</span></span>); . = . + <span class="hljs-number"><span class="hljs-number">0x1000</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    4 */</span></span> stack_top = .; }</code> </pre><br>  Es importante prestar atenci√≥n a las direcciones.  "."  en la secuencia de comandos del vinculador indica la posici√≥n actual.  Ponemos la secci√≥n .text al comienzo de la ROM (direcci√≥n 0x0), siguiendo el orden: startup.o (.text) va primero.  A continuaci√≥n, vaya a RAM (. = 0x20000000;) y coloque all√≠ los datos (datos globales inicializados) y bss (datos globales no inicializados).  A continuaci√≥n vemos ALIGN (8): ARM requiere la alineaci√≥n del SP (Stack Pointer) por 8. Dado que la pila crece, la asignaci√≥n de espacio debajo de la pila es solo una adici√≥n ‚Äù.  =.  + 0x1000 ".  Conocemos bien nuestro programa, por lo que una pila de 4kB es suficiente con un gran margen. <br><br>  Eso es todo, queda por ponerlo todo junto.  Traigo build.sh: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh arm-none-eabi-as -c -mthumb -mlittle-endian -march=armv7-m -mcpu=cortex-m3 startup.S -o startup.o arm-none-eabi-gcc -c -mthumb -ffreestanding -mlittle-endian -march=armv7-m -mcpu=cortex-m3 test.c -o test.o arm-none-eabi-ld -T test.ld test.o startup.o -o test.elf</span></span></code> </pre><br>  Todo aqu√≠ debe entenderse m√°s o menos, con la excepci√≥n de la bandera libre.  En este caso, no tiene que agregarlo (puede verificarlo), pero como estamos preparando una imagen de metal desnudo desde cero, es mejor decirle al compilador para que no preste atenci√≥n a funciones como main (). <br><br>  Como resultado, obtuvimos el archivo ELF test.elf.  Ejec√∫telo en QEMU: <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> qemu<span class="hljs-literal"><span class="hljs-literal">-system</span></span><span class="hljs-literal"><span class="hljs-literal">-arm</span></span> <span class="hljs-literal"><span class="hljs-literal">-M</span></span> lm3s811evb <span class="hljs-literal"><span class="hljs-literal">-kernel</span></span> test.elf <span class="hljs-literal"><span class="hljs-literal">-nographic</span></span> Hello, World!</code> </pre><br>  Funciona <br><br>  Por supuesto, este es un estudio de caso dise√±ado para comprender lo que est√° sucediendo.  Si necesita una funcionalidad m√°s significativa, debe usar cosas preparadas.  Hemos agregado soporte para esta plataforma en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Embox</a> .  Esta plantilla se llama platform / stellaris / lm3s811evb.  Por lo tanto, si alguien quiere intentar ejecutar algo un poco m√°s serio (consola, temporizador, interrupciones), puede recopilar e intentar.  En este caso, repito, no es necesario tener una placa de hardware. <br><br>  Y aquellos que todav√≠a no tienen suficientes emuladores, o que quieren hacernos preguntas y jugar con las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">piezas de hierro,</a> los esperaremos este s√°bado y domingo en el festival de tecnolog√≠a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">techtrain.ru</a> en San Petersburgo.  Tendremos varias piezas de hierro en el stand, y en la zona de demostraci√≥n intentaremos decir c√≥mo programarlas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es421833/">https://habr.com/ru/post/es421833/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es421819/index.html">ELK Stack para almacenar registros de aplicaciones de Django</a></li>
<li><a href="../es421821/index.html">Usamos mosaico, pixelaci√≥n y m√°scaras geom√©tricas de Voronoi en sombreadores para decorar el sitio.</a></li>
<li><a href="../es421823/index.html">C√≥mo trajimos X-Ray x64</a></li>
<li><a href="../es421827/index.html">¬øQu√© leer sobre Java en este momento?</a></li>
<li><a href="../es421829/index.html">La anomal√≠a de Frango: un romance fant√°stico con personas reales de TI</a></li>
<li><a href="../es421835/index.html">La Comisi√≥n Interagencial desarrolla nueva tecnolog√≠a para bloquear Telegram</a></li>
<li><a href="../es421837/index.html">Creaci√≥n de 1k intro Chaos para ZX-Spectrum</a></li>
<li><a href="../es421839/index.html">Programaci√≥n funcional de Java con Vavr</a></li>
<li><a href="../es421841/index.html">Robotaxi Waymo no est√° listo para acceder a la v√≠a p√∫blica</a></li>
<li><a href="../es421845/index.html">¬øQu√© hacen realmente los analistas de datos? Hallazgos de 35 entrevistas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>