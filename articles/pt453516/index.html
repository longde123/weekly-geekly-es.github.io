<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüíª üë∏üèæ üßíüèæ Automa√ß√£o para o menor. Parte zero. Planejamento üè∑Ô∏è üë©üèæ‚Äçüè´ ü§òüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O SDSM acabou, mas o desejo descontrolado de escrever permanece. 

  

 Por muitos anos, nosso irm√£o sofreu com a realiza√ß√£o de trabalhos de rotina, c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automa√ß√£o para o menor. Parte zero. Planejamento</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453516/"> O SDSM acabou, mas o desejo descontrolado de escrever permanece. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a63/9b0/65d/a639b065d34f28321bd9918e155eb964.jpg" width="800"></a> <br><br>  Por muitos anos, nosso irm√£o sofreu com a realiza√ß√£o de trabalhos de rotina, cruzou os dedos antes de cometer e n√£o teve sono devido a retrocessos noturnos. <br>  Mas os tempos sombrios est√£o chegando ao fim. <br><br>  Com este artigo, come√ßarei uma s√©rie sobre como vejo a automa√ß√£o. <br>  No processo, trataremos das etapas de automa√ß√£o, armazenando vari√°veis, formalizando o design, com RestAPI, NETCONF, YANG, YDK e programaremos muito. <br>  Significa para <i>mim</i> que: a) essa n√£o √© uma verdade objetiva, b) n√£o √© incondicionalmente a melhor abordagem c) minha opini√£o pode mudar mesmo durante o movimento do primeiro ao √∫ltimo artigo - para ser sincero, desde a fase de rascunho at√© a publica√ß√£o, reescrevi tudo duas vezes. <br><br><a name="habracut"></a><br><h1>  Conte√∫do </h1><br><ol><li>  <b>Objetivos</b> <br><ol><li>  A rede √© como um √∫nico organismo </li><li>  Teste de configura√ß√£o </li><li>  Versionamento </li><li>  Servi√ßos de monitoramento e autocorre√ß√£o </li></ol><br></li><li>  <b>Meios</b> <br><ol><li>  Sistema de invent√°rio </li><li>  Sistema de gerenciamento de espa√ßo IP </li><li>  Sistema de descri√ß√£o de servi√ßos de rede </li><li>  Mecanismo de inicializa√ß√£o do dispositivo </li><li>  Modelo de configura√ß√£o independente de fornecedor </li><li>  Driver espec√≠fico do fornecedor </li><li>  O mecanismo para entregar a configura√ß√£o ao dispositivo </li><li>  CI / CD </li><li>  Mecanismo de backup e desvio </li><li>  Sistema de monitoramento </li></ol><br></li><li>  <b>Conclus√£o</b> <br></li></ol><br><hr><br><br>  Vou tentar manter o ADSM em um formato ligeiramente diferente do SDSM.  Grandes artigos numerados detalhados continuar√£o a aparecer e, entre eles, publicarei pequenas notas da experi√™ncia cotidiana.  Vou tentar combater o perfeccionismo aqui e n√£o lamber cada um deles. <br><br><blockquote>  Que engra√ßado que na segunda vez voc√™ tem que seguir o mesmo caminho. <br><br>  Primeiro, eu tive que escrever artigos sobre a pr√≥pria rede devido ao fato de eles n√£o estarem no RuNet. <br><br>  Agora n√£o consegui encontrar um documento abrangente que sistematizasse abordagens para automa√ß√£o e usasse exemplos pr√°ticos simples para analisar as tecnologias acima. <br><br>  Talvez eu esteja enganado, portanto, lance links para recursos adequados.  No entanto, isso n√£o mudar√° minha determina√ß√£o em escrever, porque o objetivo principal √© aprender algo pessoalmente e facilitar a vida do meu vizinho √© um b√¥nus agrad√°vel que acaricia o gene para a dissemina√ß√£o da experi√™ncia. <br></blockquote><br><br>  Vamos tentar pegar um data center de LAN DC de tamanho m√©dio e elaborar todo o esquema de automa√ß√£o. <br>  Farei algumas coisas quase na primeira vez com voc√™. <br><br><blockquote>  Nas id√©ias e ferramentas descritas aqui, n√£o serei original.  Dmitry Figol tem um excelente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">canal com fluxos sobre este t√≥pico</a> . <br>  Artigos em muitos aspectos se sobrep√µem a eles. <br></blockquote><br><br>  O controlador de dom√≠nio local da LAN possui 4 controladores de dom√≠nio, cerca de 250 comutadores, meia d√∫zia de roteadores e alguns firewalls. <br>  N√£o √© o facebook, mas o suficiente para pensar profundamente sobre automa√ß√£o. <br>  No entanto, existe a opini√£o de que, se voc√™ tiver mais de um dispositivo, j√° precisar√° de automa√ß√£o. <br>  De fato, √© dif√≠cil imaginar que algu√©m agora possa viver sem pelo menos um monte de roteiros at√© o joelho. <br>  Embora eu tenha ouvido falar que existem escrit√≥rios onde os endere√ßos IP s√£o mantidos no Excel, e cada um dos milhares de dispositivos de rede √© configurado manualmente e possui sua pr√≥pria configura√ß√£o exclusiva.  √â claro que isso pode ser considerado arte contempor√¢nea, mas os sentimentos do engenheiro certamente ser√£o ofendidos. <br><br><h1>  Objetivos </h1><br>  Agora vamos definir os objetivos mais abstratos: <br><ul><li>  A rede √© como um √∫nico organismo </li><li>  Teste de configura√ß√£o </li><li>  Vers√£o do status da rede </li><li>  Servi√ßos de monitoramento e autocorre√ß√£o </li></ul><br>  Mais adiante neste artigo, analisaremos quais meios usaremos e, a seguir, objetivos e meios em detalhes. <br><br><h2>  A rede √© como um √∫nico organismo </h2><br>  A frase definidora do ciclo, embora √† primeira vista possa n√£o parecer t√£o significativa: <b>configuraremos a rede, n√£o os dispositivos individuais</b> . <br>  Nos √∫ltimos anos, observamos uma mudan√ßa de √™nfase no sentido de tratar a rede como uma entidade √∫nica; portanto, as <i>redes definidas por software</i> , <i>redes direcionadas por inten√ß√µes</i> e redes <i>aut√¥nomas</i> entrando em nossas vidas. <br>  Afinal, o que √© globalmente necess√°rio para aplicativos da rede: conectividade entre os pontos A e B (bem, √†s vezes + B-Z) e isolamento de outros aplicativos e usu√°rios. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b86/c83/12c/b86c8312c49342c64d8ec3c2c471782c.jpg" width="400"><br><br>  E, portanto, nossa tarefa nesta s√©rie √© <b>construir um sistema</b> que suporte a configura√ß√£o atual de <b>toda a rede</b> , que j√° est√° decomposta na configura√ß√£o atual de cada dispositivo, de acordo com sua fun√ß√£o e localiza√ß√£o. <br>  <b>O</b> sistema de gerenciamento de rede implica que, para fazer altera√ß√µes, recorremos a ele e, por sua vez, calcula o estado desejado para cada dispositivo e o configura. <br>  Dessa maneira, minimizamos o uso da CLI em nossas m√£os para quase zero - qualquer altera√ß√£o nas configura√ß√µes do dispositivo ou no design da rede deve ser formalizada e documentada - e somente ent√£o lan√ßamos nos elementos de rede necess√°rios. <br><blockquote>  Ou seja, por exemplo, se decidirmos que a partir de agora os comutadores de montagem em rack em Kazan devem anunciar duas redes em vez de uma, <br><ol><li>  Primeiro, documentamos as mudan√ßas nos sistemas </li><li>  Geramos a configura√ß√£o de destino de todos os dispositivos de rede </li><li>  Iniciamos o programa de atualiza√ß√£o de configura√ß√£o de rede, que calcula o que precisa ser removido em cada n√≥, o que adicionar e leva os n√≥s ao estado desejado. </li></ol><br>  Ao mesmo tempo, com nossas m√£os, fazemos altera√ß√µes apenas no primeiro passo. <br></blockquote><br><br><h2>  Teste de configura√ß√£o </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sabe-se</a> que 80% dos problemas ocorrem durante as altera√ß√µes de configura√ß√£o - a evid√™ncia indireta disso √© que, durante os feriados de Ano Novo, tudo fica calmo. <br>  Eu pessoalmente testemunhei dezenas de paradas globais devido a um erro humano: o comando errado, a configura√ß√£o foi executada no ramo errado, a comunidade esqueceu, demoliu o MPLS globalmente no roteador, configurou cinco peda√ßos de ferro e n√£o percebeu o sexto erro, cometeu as altera√ß√µes antigas feitas por outra pessoa .  Cen√°rios a escurid√£o √© escura. <br><br>  A automa√ß√£o nos permitir√° cometer menos erros, mas em uma escala maior.  Assim, voc√™ pode bloquear n√£o um dispositivo, mas toda a rede de uma s√≥ vez. <br><br>  Desde tempos imemoriais, nossos av√≥s verificaram a corre√ß√£o das mudan√ßas feitas com olhos atentos, ovos de a√ßo e a efici√™ncia da rede depois de lan√ß√°-las. <br>  Os av√≥s, cujo trabalho levou a tempo de inatividade e perdas catastr√≥ficas, deixaram menos filhos e deveriam desaparecer com o tempo, mas a evolu√ß√£o √© um processo lento e, portanto, nem todo mundo verifica as mudan√ßas no laborat√≥rio antes. <br>  No entanto, na vanguarda daqueles que automatizaram o processo de teste da configura√ß√£o e sua aplica√ß√£o adicional √† rede.  Em outras palavras, peguei emprestado o procedimento de CI / CD ( <a href="">integra√ß√£o cont√≠nua, implanta√ß√£o cont√≠nua</a> ) dos desenvolvedores. <br>  Em uma parte, veremos como implementar isso usando um sistema de controle de vers√£o, provavelmente um github. <br><br><blockquote>  Assim que voc√™ se acostumar com a id√©ia de rede CI / CD, durante a noite o m√©todo de verificar a configura√ß√£o aplicando-a √† rede em funcionamento parecer√° uma ignor√¢ncia medieval precoce.  Sobre como martelar uma ogiva com um martelo. <br></blockquote><br><br>  Uma continua√ß√£o org√¢nica das id√©ias sobre <b>o</b> sistema de gerenciamento de rede e o CI / CD √© o versionamento completo da configura√ß√£o. <br><br><h2>  Versionamento </h2><br>  Assumiremos que, com quaisquer altera√ß√µes, mesmo as menores, mesmo em um dispositivo discreto, toda a rede passa de um estado para outro. <br>  E nem sempre executamos o comando no dispositivo, mudamos o estado da rede. <br>  Agora vamos pegar esses estados e cham√°-los de vers√µes? <br><br>  Digamos que a vers√£o atual √© 1.0.0. <br>  O endere√ßo IP da interface de loopback foi alterado em um dos ToRs?  Esta √© uma vers√£o secund√°ria - obtenha o n√∫mero 1.0.1. <br>  Revisou as pol√≠ticas de importa√ß√£o de rota no BGP - um pouco mais s√©rio - j√° 1.1.0 <br>  Decidimos nos livrar do IGP e mudar apenas para o BGP - esta √© uma mudan√ßa radical no design - 2.0.0. <br><br>  Ao mesmo tempo, diferentes controladores de dom√≠nio podem ter vers√µes diferentes - a rede est√° em desenvolvimento, novos equipamentos est√£o sendo instalados, em algum lugar novos n√≠veis de coluna s√£o adicionados, em algum lugar - n√£o, etc. <br><br>  Falaremos sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vers√µes sem√¢nticas</a> em um artigo separado. <br><br>  Repito - qualquer altera√ß√£o (exceto os comandos de depura√ß√£o) √© uma atualiza√ß√£o da vers√£o.  Os administradores devem ser notificados sobre qualquer desvio da vers√£o atual. <br><br>  O mesmo se aplica √† revers√£o de altera√ß√µes - essa n√£o √© a aboli√ß√£o dos √∫ltimos comandos, n√£o √© uma revers√£o pelo sistema operacional do dispositivo - est√° trazendo toda a rede para uma nova vers√£o (antiga). <br><br><h2>  Servi√ßos de monitoramento e autocorre√ß√£o </h2><br>  Essa tarefa evidente em redes modernas vai para um novo n√≠vel. <br>  Freq√ºentemente, grandes provedores de servi√ßos praticam a abordagem de que um servi√ßo ca√≠do deve ser rapidamente finalizado e um novo, criado, em vez de descobrir o que aconteceu. <br>  "Muito" significa que por todos os lados √© necess√°rio manchar profusamente o monitoramento, que em segundos detectar√° os menores desvios da norma. <br>  E aqui n√£o h√° m√©tricas familiares suficientes, como carregar uma interface ou acessibilidade de um n√≥.  N√£o h√° rastreamento manual e suficiente do oficial de servi√ßo para eles. <br>  Para muitas coisas, geralmente deve haver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Autocura</a> - os controles acenderam em vermelho e sa√≠ram da bananeira, onde d√≥i. <br><br>  E aqui tamb√©m monitoramos n√£o apenas dispositivos individuais, mas tamb√©m a sa√∫de da rede como um todo, tanto a caixa branca, que √© relativamente clara, quanto a caixa preta, que j√° √© mais complicada. <br><br><hr><br>  O que precisamos para implementar planos t√£o ambiciosos? <br><ul><li>  Tenha uma lista de todos os dispositivos da rede, localiza√ß√£o, fun√ß√µes, modelos e vers√µes de software. <br>  <i>kazan-leaf-1.lmu.net, Kazan, folha, Juniper QFX 5120, R18.3.</i> <br></li><li>  Tenha um sistema para descrever os servi√ßos de rede. <br>  <i>IGP, BGP, L2 / 3VPN, pol√≠tica, ACL, NTP, SSH.</i> </li><li>  Ser capaz de inicializar o dispositivo. <br>  <i>Nome do host, IP de gerenciamento, rota de gerenciamento, usu√°rios, chaves RSA, LLDP, NETCONF</i> </li><li>  Configure o dispositivo e traga a configura√ß√£o para a vers√£o desejada (incluindo a antiga). </li><li>  Configura√ß√£o de teste </li><li>  Verifique periodicamente o status de todos os dispositivos quanto a desvios do atual e informe quem deve. <br>  <i>√Ä noite, algu√©m silenciosamente adicionou uma regra √† ACL</i> . </li><li>  Monitore o desempenho. </li></ul><br><hr><br><br><h1>  Meios </h1><br>  Parece complicado o suficiente para come√ßar a decompor um projeto em componentes. <br><br>  E haver√° dez deles: <br><ol><li>  Sistema de invent√°rio </li><li>  Sistema de gerenciamento de espa√ßo IP </li><li>  Sistema de descri√ß√£o de servi√ßos de rede </li><li>  Mecanismo de inicializa√ß√£o do dispositivo </li><li>  Modelo de configura√ß√£o independente de fornecedor </li><li>  Driver espec√≠fico do fornecedor </li><li>  O mecanismo para entregar a configura√ß√£o ao dispositivo </li><li>  CI / CD </li><li>  Mecanismo de backup e desvio </li><li>  Sistema de monitoramento </li></ol><br><br><blockquote>  A prop√≥sito, este √© um exemplo de como a vis√£o sobre os objetivos do ciclo mudou - havia quatro componentes nos componentes de rascunho. <br></blockquote><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a5/d86/b10/5a5d86b106e67b2999c659a438394321.png" width="800"><br><br>  Na ilustra√ß√£o, descrevi todos os componentes e o pr√≥prio dispositivo. <br>  Os componentes de interse√ß√£o interagem entre si. <br>  Quanto maior o bloco, mais aten√ß√£o voc√™ precisar√° prestar a este componente. <br><br><hr><br><h2>  Componente 1. Sistema de invent√°rio </h2><br>  Obviamente, queremos saber em que equipamento, onde fica, a que est√° conectado. <br>  O sistema de invent√°rio √© parte integrante de qualquer empresa. <br>  Na maioria dos casos, para dispositivos de rede, a empresa possui um sistema de invent√°rio separado que resolve tarefas mais espec√≠ficas. <br>  Como parte de uma s√©rie de artigos, o chamaremos de DCIM - Data Center Infrastructure Management.  Embora o pr√≥prio termo DCIM, a rigor, inclua muito mais. <br><br>  Para nossas tarefas, armazenaremos as seguintes informa√ß√µes sobre o dispositivo: <br><ul><li>  N√∫mero de invent√°rio </li><li>  T√≠tulo / Descri√ß√£o </li><li>  Modelo ( <i>Huawei CE12800, Juniper QFX5120, etc.</i> ) </li><li>  Par√¢metros t√≠picos ( <i>placas, interfaces, etc.</i> ) </li><li>  Fun√ß√£o ( <i>Folha, Coluna, Roteador de Fronteira, etc.</i> ) </li><li>  Localiza√ß√£o ( <i>regi√£o, cidade, data center, rack, unidade</i> ) </li><li>  Interconex√µes entre dispositivos </li><li>  Topologia de rede </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1fa/be1/8fd/1fabe18fd786b3e5aeb432ee382fee64.png" width="400"><br><br>  √â perfeitamente claro que n√≥s mesmos queremos saber tudo isso. <br>  Mas isso ajudar√° na automa√ß√£o? <br>  Claro. <br>  Por exemplo, sabemos que neste data center em switches Leaf, se for Huawei, as ACLs para filtrar determinado tr√°fego devem ser aplicadas na VLAN e, se for Juniper, na unidade 0 da interface f√≠sica. <br>  Ou voc√™ precisa implantar um novo servidor Syslog para todos os pensionistas da regi√£o. <br><br>  Nele, armazenaremos dispositivos de rede virtual, como roteadores virtuais ou refletores de raiz.  Podemos adicionar um servidor DNS, NTP, Syslog e, geralmente, tudo o que de alguma forma se relaciona √† rede. <br><hr><br><h2>  Componente 2. Sistema de Gerenciamento de Espa√ßo IP </h2><br>  Sim, e em nosso tempo h√° equipes de pessoas que controlam prefixos e endere√ßos IP em um arquivo do Excel.  Mas a abordagem moderna ainda √© um banco de dados, com um frontend no nginx / apache, uma API e amplas fun√ß√µes para levar em conta os endere√ßos IP e as redes com separa√ß√£o no VRF. <br>  IPAM - Gerenciamento de Endere√ßo IP. <br><br>  Para nossas tarefas, armazenaremos as seguintes informa√ß√µes: <br><ul><li>  VLAN </li><li>  VRF </li><li>  Redes / Sub-redes </li><li>  Endere√ßos IP </li><li>  Vinculando endere√ßos a dispositivos, redes a locais e n√∫meros de VLAN </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c77/6f7/0fd/c776f70fd00c9292163c3e85e85b7ab2.png" width="400"><br><br>  Novamente, √© claro que queremos ter certeza de que, ao alocar um novo endere√ßo IP para o loopback do ToR, n√£o trope√ßaremos no fato de que ele j√° foi atribu√≠do a algu√©m.  Ou que usamos o mesmo prefixo duas vezes em extremidades diferentes da rede. <br>  Mas como isso ajuda na automa√ß√£o? <br>  F√°cil. <br>  Solicitamos um prefixo no sistema com a fun√ß√£o Loopbacks, na qual existem endere√ßos IP dispon√≠veis para aloca√ß√£o - se houver, selecione o endere√ßo; caso contr√°rio, solicitamos a cria√ß√£o de um novo prefixo. <br>  Ou, ao criar uma configura√ß√£o de dispositivo, do mesmo sistema podemos descobrir em qual VRF a interface deve estar. <br>  E quando voc√™ inicia um novo servidor, o script entra no sistema, descobre em qual servidor o switch, em qual porta e qual sub-rede est√° atribu√≠da √† interface - ele selecionar√° o endere√ßo do servidor. <br><br><hr><br>  Ele implora o desejo do DCIM e do IPAM de se combinarem em um sistema para n√£o duplicar fun√ß√µes e n√£o servir para duas entidades similares. <br>  Ent√£o vamos fazer. <br><hr><br><h2>  Componente 3. Sistema de descri√ß√£o dos servi√ßos de rede </h2><br>  Se os dois primeiros sistemas armazenam vari√°veis ‚Äã‚Äãque ainda precisam ser usadas, o terceiro descreve para cada fun√ß√£o de dispositivo como deve ser configurada. <br>  Vale destacar dois tipos diferentes de servi√ßos de rede: <br><ul><li>  Infra-estrutura </li><li>  Cliente </li></ul><br><br>  Os primeiros foram projetados para fornecer conectividade b√°sica e gerenciamento de dispositivos.  Isso inclui VTY, SNMP, NTP, Syslog, AAA, protocolos de roteamento, CoPP, etc. <br>  Os segundos organizam o servi√ßo para o cliente: MPLS L2 / L3VPN, GRE, VXLAN, VLAN, L2TP, etc. <br>  Claro, tamb√©m existem casos lim√≠trofes - onde incluir o MPLS LDP, BGP?  Sim, e protocolos de roteamento podem ser usados ‚Äã‚Äãpara clientes.  Mas isso n√£o √© importante. <br><br>  Ambos os tipos de servi√ßos s√£o decompostos em primitivas de configura√ß√£o: <br><ul><li>  interfaces f√≠sicas e l√≥gicas (tag / anteg, mtu) </li><li>  Endere√ßos IP e VRF (IP, IPv6, VRF) </li><li>  ACLs e pol√≠ticas de manipula√ß√£o de tr√°fego </li><li>  Protocolos (IGP, BGP, MPLS) </li><li>  Pol√≠ticas de roteamento (listas de prefixos, comunidade, filtros ASN). </li><li>  Servi√ßos de servi√ßo (SSH, NTP, LLDP, Syslog ...) </li><li>  Etc. </li></ul><br>  Como exatamente faremos isso, ainda n√£o decidirei.  Trataremos de um artigo separado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/40b/ffe/b1b/40bffeb1b4f75f83d690bb96d2ca8ae1.png" width="400"><br><br>  Se um pouco mais perto da vida, poder√≠amos descrever que <br>  Um switch folha deve ter sess√µes BGP com todos os switches Spine conectados, importar redes conectadas ao processo e aceitar apenas redes de um prefixo espec√≠fico dos switches Spine.  Limite o CoPP IPv6 ND a 10 pps, etc. <br>  Por sua vez, os spins realizam sess√µes com todos os corpos conectados, atuando como refletores de raiz, e recebem deles apenas rotas de um certo comprimento e com uma certa comunidade. <br><hr><br><h2>  Componente 4. Mecanismo de inicializa√ß√£o do dispositivo </h2><br>  Sob esse cabe√ßalho, eu combino as muitas a√ß√µes que devem ocorrer para que o dispositivo apare√ßa nos radares e seja acessado remotamente. <br><ol><li>  Inicie o dispositivo no sistema de invent√°rio. </li><li>  Destaque o endere√ßo IP de gerenciamento. </li><li>  Configure o acesso b√°sico a ele: <br>  Nome do host, endere√ßo IP de gerenciamento, rota para a rede de gerenciamento, usu√°rios, chaves SSH, protocolos - telnet / SSH / NETCONF </li></ol><br><br>  Existem tr√™s abordagens: <br><ul><li>  Tudo √© completamente manual.  O dispositivo √© colocado em um ponto em que uma pessoa org√¢nica comum o leva ao sistema, se conecta ao console e configura.  Pode funcionar em pequenas redes est√°ticas. </li><li>  ZTP - Provisionamento Zero Touch.  Iron veio, levantou-se, recebeu um endere√ßo via DHCP, foi para um servidor especial e se configurou. </li><li>  A infraestrutura dos servidores do console, em que a configura√ß√£o inicial ocorre atrav√©s da porta do console no modo autom√°tico. </li></ul><br><br>  Falaremos sobre os tr√™s em um artigo separado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/16e/464/8dd/16e4648dd13249dc1da87a0b341c305c.png" width="400"><br><br><hr><br><h2>  Componente 5. Modelo de configura√ß√£o independente de fornecedor </h2><br>  At√© agora, todos os sistemas estavam espalhados, fornecendo vari√°veis ‚Äã‚Äãe uma descri√ß√£o declarativa do que gostar√≠amos de ver na rede.  Mas, mais cedo ou mais tarde, voc√™ precisa lidar com detalhes. <br>  Nesse est√°gio, para cada dispositivo espec√≠fico, primitivas, servi√ßos e vari√°veis ‚Äã‚Äãs√£o combinadas em um modelo de configura√ß√£o que realmente descreve a configura√ß√£o completa de um dispositivo espec√≠fico, apenas de maneira independente do fornecedor. <br>  O que d√° esse passo?  Por que n√£o configurar imediatamente o dispositivo, que voc√™ pode simplesmente preencher? <br>  De fato, isso nos permite resolver tr√™s problemas: <br><ol><li>  N√£o se adapte a uma interface espec√≠fica para interagir com o dispositivo.  Seja CLI, NETCONF, RESTCONF, SNMP - o modelo ser√° o mesmo. </li><li>  N√£o mantenha o n√∫mero de modelos / scripts pelo n√∫mero de fornecedores na rede e, no caso de uma altera√ß√£o no design, altere o mesmo em v√°rios locais. </li><li>  Fa√ßa o download da configura√ß√£o do dispositivo (backup), coloque-a exatamente no mesmo modelo e compare diretamente a configura√ß√£o de destino e a dispon√≠vel para calcular o delta e preparar o patch de configura√ß√£o, que mudar√° apenas as partes necess√°rias ou para detectar desvios. </li></ol><br><br><img src="https://habrastorage.org/getpro/habr/post_images/eda/ebf/9c0/edaebf9c0fc5b62c45a9bb555cc30824.png" width="400"><br><br>  Como resultado desse est√°gio, obtemos uma configura√ß√£o independente do fornecedor. <br><hr><br><h2>  Componente 6. Driver espec√≠fico da interface do fornecedor </h2><br>  N√£o se console com esperan√ßas de que, uma vez que voc√™ possa configurar um tsiska, isso ser√° poss√≠vel da mesma maneira que um jumper, enviando-o exatamente para as mesmas chamadas.  Apesar da crescente popularidade das caixas brancas e do surgimento de suporte para NETCONF, RESTCONF, OpenConfig, o conte√∫do espec√≠fico que esses protocolos entregam √© diferente do fornecedor para o fornecedor, e essa √© uma das diferen√ßas competitivas que eles simplesmente n√£o desistem. <br>  √â o mesmo que o OpenContrail e o OpenStack, que t√™m RestAPI como interface NorthBound, esperam chamadas completamente diferentes. <br><br>  Portanto, na quinta etapa, o modelo independente do fornecedor deve assumir a forma em que ir√° para o ferro. <br>  E aqui, todos os meios s√£o bons (n√£o): CLI, NETCONF, RESTCONF, SNMP em uma queda simples. <br><br>    ,          :  CLI ,  XML. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/10d/e75/b99/10de75b9994bbfbb08fef4617baf8382.png" width="400"><br><br><hr><br><h2>  7.      </h2><br> -  ,        ‚Äî , ,  . <br> <b>-</b> ,     ,    ?        : <br><ul><li> CLI (telnet, ssh) </li><li> <s>SNMP</s> </li><li> NETCONF </li><li> RESTCONF </li><li> REST API </li><li> OpenFlow (     ,     FIB,   ) </li></ul><br><br>      . CLI ‚Äî  . SNMP‚Ä¶ -. <br> RESTCONF ‚Äî    , REST API   .       NETCONF. <br><br>   ,    ,         ‚Äî         ,   . <br><br> <b>-</b> ,       ? <br>    : <br><ul><li>    .  ncclient  asyncIO    .   ,     ? </li><li> Ansible      . </li><li> Salt          Napalm. </li><li>  Napalm,      ,  . </li><li> Nornir ‚Äî   ,     . </li></ul><br><br>      ‚Äî  . <br><br>    ?   . <br>   .      . <br> ,   commit     ,    . <br>       NETCONF      ‚Äî       .         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFP</a> .      ,          32*100GE .  ? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/368/608/fda/368608fdaff0eafaf308ce37ac008273.png" width="400"><br><hr><br><h2>  8. CI/CD </h2><br>            . <br>   ¬´ ¬ª,        .          ,     . ,         . <br><br> ,    , ,     -,      . <br>       Pipeline CI/CD. <br><blockquote> CI/CD  Continuous Integration, Continuous Deployment.  ,           ,   ,     (Deployment)    ,       ,    (Integration). <br></blockquote><br><br>        ,    , ,        ,  ,   ,    ‚Äî     . <br><br>    ,         CI/CD Pipeline ‚Äî         . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f14/979/119/f14979119a9580b9d2f43c3f31cde326.png" width="400"><br><br><hr><br><h2>  9.       </h2><br>        . <br>             . <br><br>      ‚Äî    -  .      -       ,   ,  -,  ,  . <br> ,   -  ,     ,      .      ‚Äî   ,  -   ,    , ,    ,      . <br><br>             ,         .            .  ,        . <br><blockquote> ,         IP,    ‚Äî    . <br></blockquote><br><br><img src="https://habrastorage.org/getpro/habr/post_images/902/93e/570/90293e570db42ff6e1c9ca25fa8cead7.png" width="400"><br><br><hr><br><h2>  10.   </h2><br>        ‚Äî   ,    .     ,     .          . <br><br>   ‚Äî     CI/CD.     ,    ,        . <br>              ,      ‚Äî   ,   ,  BGP-, OSPF-, End-to-End   . <br>         ,     SFlow-,        ,       -  ? <br><br>        . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c4/347/940/7c4347940b12f7eb41fd05a4102e4564.png" width="400"><br><hr><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ec/0ff/45f/0ec0ff45ff4384becf2ede765a56c091.png" width="800"><br><br><hr><br><h1>  Conclus√£o </h1><br>            ‚Äî L3 Clos Fabric  BGP    . <br>         Juniper,     JunOs ‚Äî  . <br><br>      Open Source     ‚Äî          . <br><br>     : <br>      .   ,    ,   ,           . <br>     : , , . <br>   . <br>  , ,      . <br>        . <br><br>  ,         .  :) <br><br><h5>  Links √∫teis </h5><br><ul><li>  ,    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Python   </a> . , ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> . </li><li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RFC</a>          . </li><li>  ,   Overlay' SDN       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tungsten Fabric</a> ( Open Contrail). </li></ul><br><br><h5>  </h5><br>  .    . <br>  .  . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt453516/">https://habr.com/ru/post/pt453516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt453502/index.html">Meu ancinho: de trapos a riquezas</a></li>
<li><a href="../pt453508/index.html">Homem sem smartphone</a></li>
<li><a href="../pt453510/index.html">Todo seu: Tutorial sobre como criar novas a√ß√µes para o UiPath RPA</a></li>
<li><a href="../pt453512/index.html">Transfer√™ncia de estilo</a></li>
<li><a href="../pt453514/index.html">Guia de ofertas introdut√≥rias no iOS</a></li>
<li><a href="../pt453520/index.html">Acelere o Ansible com Mitogen</a></li>
<li><a href="../pt453522/index.html">Feliz anivers√°rio, Habr ‚ù§</a></li>
<li><a href="../pt453524/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel # 299 (de 20 a 26 de maio)</a></li>
<li><a href="../pt453526/index.html">ITSM - o que √© e por onde come√ßar a implementa√ß√£o</a></li>
<li><a href="../pt453528/index.html">Psion SIBO - PDAs que nem precisam ser emulados</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>