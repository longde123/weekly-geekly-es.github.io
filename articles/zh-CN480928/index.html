<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘ â›¹ğŸ¼ ğŸ‘©ğŸ½â€ğŸ¤ Apache Hadoopä»£ç è´¨é‡ï¼šç”Ÿäº§VSæµ‹è¯• ğŸ”² ğŸ—¾ âœ³ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä¸ºäº†è·å¾—é«˜è´¨é‡çš„ç”Ÿäº§ä»£ç ï¼Œä»…æä¾›æœ€å¤§çš„æµ‹è¯•è¦†ç›–èŒƒå›´è¿˜ä¸å¤Ÿã€‚ æ¯«æ— ç–‘é—®ï¼Œä¸ºäº†è·å¾—è¾ƒé«˜çš„ç»“æœï¼Œä¸»è¦çš„é¡¹ç›®ä»£ç å’Œæµ‹è¯•å¿…é¡»å®Œç¾åœ°ç»“åˆåœ¨ä¸€èµ·ã€‚ å› æ­¤ï¼Œæ‚¨éœ€è¦ä¸ä¸»è¦ä»£ç ä¸€æ ·æ³¨æ„æµ‹è¯•ã€‚ ç¼–å†™è‰¯å¥½çš„æµ‹è¯•æ˜¯èµ¶ä¸Šç”Ÿäº§å›å½’çš„å…³é”®ã€‚ ä¸ºäº†è¯´æ˜æµ‹è¯•ä¸­çš„é”™è¯¯ä¸ä¼šæ¯”ç”Ÿäº§ä¸­çš„é”™è¯¯ä¸¥é‡è¿™ä¸€äº‹å®çš„é‡è¦æ€§ï¼Œæˆ‘ä»¬å°†è€ƒè™‘å¯¹PVS-Studi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apache Hadoopä»£ç è´¨é‡ï¼šç”Ÿäº§VSæµ‹è¯•</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/480928/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c48/f76/cf1/c48f76cf15c8138ce1d944918b1dcc07.png" alt="å›¾1"></div><br> ä¸ºäº†è·å¾—é«˜è´¨é‡çš„ç”Ÿäº§ä»£ç ï¼Œä»…æä¾›æœ€å¤§çš„æµ‹è¯•è¦†ç›–èŒƒå›´è¿˜ä¸å¤Ÿã€‚ æ¯«æ— ç–‘é—®ï¼Œä¸ºäº†è·å¾—è¾ƒé«˜çš„ç»“æœï¼Œä¸»è¦çš„é¡¹ç›®ä»£ç å’Œæµ‹è¯•å¿…é¡»å®Œç¾åœ°ç»“åˆåœ¨ä¸€èµ·ã€‚ å› æ­¤ï¼Œæ‚¨éœ€è¦ä¸ä¸»è¦ä»£ç ä¸€æ ·æ³¨æ„æµ‹è¯•ã€‚ ç¼–å†™è‰¯å¥½çš„æµ‹è¯•æ˜¯èµ¶ä¸Šç”Ÿäº§å›å½’çš„å…³é”®ã€‚ ä¸ºäº†è¯´æ˜æµ‹è¯•ä¸­çš„é”™è¯¯ä¸ä¼šæ¯”ç”Ÿäº§ä¸­çš„é”™è¯¯ä¸¥é‡è¿™ä¸€äº‹å®çš„é‡è¦æ€§ï¼Œæˆ‘ä»¬å°†è€ƒè™‘å¯¹PVS-Studioé™æ€åˆ†æå™¨ä¸­çš„è­¦å‘Šè¿›è¡Œä¸‹ä¸€æ¬¡åˆ†æã€‚ ç›®æ ‡ï¼šApache Hadoopã€‚ <br><a name="habracut"></a><br><h2> å…³äºé¡¹ç›® </h2><br> é‚£äº›æ›¾ç»å¯¹å¤§æ•°æ®æ„Ÿå…´è¶£çš„äººå¯èƒ½å¬è¯´è¿‡æˆ–ä¸<a href="https://hadoop.apache.org/">Apache Hadoop</a>ç­‰é¡¹ç›®åˆä½œã€‚ ç®€è€Œè¨€ä¹‹ï¼ŒHadoopæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå¯ä»¥ç”¨ä½œæ„å»ºå’Œä½¿ç”¨å¤§æ•°æ®ç³»ç»Ÿçš„åŸºç¡€ã€‚ <br><br>  Hadoopç”±å››ä¸ªä¸»è¦æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªæ¨¡å—æ‰§è¡Œå¤§æ•°æ®åˆ†æç³»ç»Ÿæ‰€éœ€çš„ç‰¹å®šä»»åŠ¡ï¼š <br><br><ul><li>  Hadoopå¸¸è§ </li><li>  Mapreduce </li><li>  Hadoopåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆHadoopåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼‰ </li><li> çº±çº¿ </li></ul><br> ä½†æ˜¯ï¼Œæœ‰å¾ˆå¤šèµ„æ–™å¯ä»¥åœ¨Internetä¸Šç†Ÿæ‚‰ã€‚ <br><br><h2> å…³äºéªŒè¯ </h2><br> å¦‚<a href="https://www.viva64.com/ru/m/0044/">æ–‡æ¡£</a>æ‰€ç¤ºï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å°†PVS-Studioé›†æˆåˆ°é¡¹ç›®ä¸­ï¼š <br><br><ul><li> ä½¿ç”¨Mavenæ’ä»¶; </li><li> ä½¿ç”¨gradleæ’ä»¶; </li><li> ä½¿ç”¨IntellJ IDEA </li><li> ç›´æ¥ä½¿ç”¨åˆ†æä»ªã€‚ </li></ul><br>  Hadoopæ˜¯åŸºäºMavenæ„å»ºç³»ç»Ÿæ„å»ºçš„ï¼Œå› æ­¤éªŒè¯æ²¡æœ‰å›°éš¾ã€‚ <br><br> ä»æ–‡æ¡£ä¸­æ•´åˆäº†è„šæœ¬å¹¶ç¨å¾®è°ƒæ•´äº†pom.xmlä¹‹ä¸€ï¼ˆä¾èµ–é¡¹ä¸­æ²¡æœ‰æ¨¡å—ï¼‰ï¼Œåˆ†æå°±å¼€å§‹äº†ï¼ <br><br> åœ¨åˆ†æä¹‹åï¼Œé€‰æ‹©æœ€æœ‰è¶£çš„è­¦å‘Šï¼Œæˆ‘æ³¨æ„åˆ°åœ¨ç”Ÿäº§ä»£ç å’Œæµ‹è¯•ä¸­ï¼Œæˆ‘å…·æœ‰ç›¸åŒæ•°é‡çš„è­¦å‘Šã€‚ é€šå¸¸ï¼Œæˆ‘ä¸è®¤ä¸ºæµ‹è¯•ä¼šè§¦å‘åˆ†æä»ªã€‚ ä½†æ˜¯ï¼Œå°†å®ƒä»¬åˆ†å¼€ï¼Œæˆ‘ä¸ä¼šé”™è¿‡â€œæµ‹è¯•â€ç±»åˆ«çš„è­¦å‘Šã€‚ æˆ‘æƒ³ï¼šâ€œä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿâ€ï¼Œå› ä¸ºæµ‹è¯•ä¸­çš„é”™è¯¯ä¹Ÿä¼šå¸¦æ¥åæœã€‚ å®ƒä»¬å¯èƒ½å¯¼è‡´é”™è¯¯æˆ–éƒ¨åˆ†æµ‹è¯•ï¼Œç”šè‡³å¯¼è‡´åºŸè¯ï¼ˆä»…å‡ºäºæ¼”ç¤ºç›®çš„ï¼Œå› æ­¤å®ƒä»¬å§‹ç»ˆä¸ºç»¿è‰²ï¼‰ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘æ”¶é›†äº†æœ€æœ‰è¶£çš„è­¦å‘Šï¼Œå¹¶æŒ‰ä»£ç ï¼ˆç”Ÿäº§ï¼Œæµ‹è¯•ï¼‰å’Œå››ä¸ªä¸»è¦çš„Hadoopæ¨¡å—è¿›è¡Œäº†åˆ’åˆ†ï¼Œè¯·æ‚¨æ³¨æ„åˆ†æå™¨æ“ä½œçš„åˆ†æã€‚ <br><br><h2> ç”Ÿäº§ä»£ç  </h2><br><h3>  Hadoopå¸¸è§ </h3><br>  <a href="https://www.viva64.com/ru/w/v6033/">V6033</a>å·²ç»æ·»åŠ äº†å…·æœ‰ç›¸åŒé”®â€œ KDC_BIND_ADDRESSâ€çš„é¡¹ç›®ã€‚  MiniKdc.javaï¼ˆ163ï¼‰ï¼ŒMiniKdc.javaï¼ˆ162ï¼‰ <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MiniKdc</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Set&lt;String&gt; PROPERTIES = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;String&gt;(); .... <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { PROPERTIES.add(ORG_NAME); PROPERTIES.add(ORG_DOMAIN); PROPERTIES.add(KDC_BIND_ADDRESS); PROPERTIES.add(KDC_BIND_ADDRESS); <span class="hljs-comment"><span class="hljs-comment">// &lt;= PROPERTIES.add(KDC_PORT); PROPERTIES.add(INSTANCE); .... } .... }</span></span></code> </pre> <br> æ£€æŸ¥é¡¹ç›®æ—¶ï¼Œå‘<i>HashSet</i>ä¸¤æ¬¡æ·»åŠ çš„å€¼æ˜¯å¸¸è§ç¼ºé™·ã€‚ å®é™…ä¸Šï¼Œç¬¬äºŒä¸ªæ·»åŠ é¡¹å°†è¢«å¿½ç•¥ã€‚ å¥½å§ï¼Œå¦‚æœè¿™ç§é‡å¤æ˜¯è’è°¬çš„äº‹æ•…ã€‚ ä½†æ˜¯ï¼Œå¦‚æœçœŸçš„æ„å‘³ç€è¦å¢åŠ å¦ä¸€ä¸ªä»·å€¼å‘¢ï¼Ÿ <br><br><h3>  Mapreduce </h3><br>  <a href="https://www.viva64.com/ru/w/v6072/">V6072æ‰¾åˆ°</a>ä¸¤ä¸ªç›¸ä¼¼çš„ä»£ç ç‰‡æ®µã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™å­—ï¼Œåº”è¯¥ä½¿ç”¨â€œ localFilesâ€å˜é‡è€Œä¸æ˜¯â€œ localArchivesâ€ã€‚  LocalDistributedCacheManager.javaï¼ˆ183ï¼‰ï¼ŒLocalDistributedCacheManager.javaï¼ˆ178ï¼‰ï¼ŒLocalDistributedCacheManager.javaï¼ˆ176ï¼‰ï¼ŒLocalDistributedCacheManager.javaï¼ˆ181ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JobConf conf, JobID jobId)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">// Update the configuration object with localized data. if (!localArchives.isEmpty()) { conf.set(MRJobConfig.CACHE_LOCALARCHIVES, StringUtils .arrayToString(localArchives.toArray(new String[localArchives // &lt;= .size()]))); } if (!localFiles.isEmpty()) { conf.set(MRJobConfig.CACHE_LOCALFILES, StringUtils .arrayToString(localFiles.toArray(new String[localArchives // &lt;= .size()]))); } .... }</span></span></code> </pre> <br> è¯Šæ–­V6072æœ‰æ—¶ä¼šäº§ç”Ÿéå¸¸æœ‰è¶£çš„å‘ç°ã€‚ è¯Šæ–­çš„æœ¬è´¨æ˜¯æœç´¢é€šè¿‡å¤åˆ¶ç²˜è´´å¹¶æ›¿æ¢ä¸€ä¸ªæˆ–ä¸¤ä¸ªå˜é‡è€Œè·å¾—çš„ç›¸åŒç±»å‹çš„ä»£ç ç‰‡æ®µï¼Œä½†åŒæ—¶æŸäº›å˜é‡è¢«â€œä½ä¼°äº†â€ã€‚ <br><br> ä¸Šé¢çš„ä»£ç æ¼”ç¤ºäº†è¿™ä¸€ç‚¹ã€‚ åœ¨ç¬¬ä¸€ä¸ªå—ä¸­ï¼Œä½¿ç”¨<i>localArchives</i>å˜é‡æ‰§è¡Œæ“ä½œï¼Œåœ¨ç›¸åŒç±»å‹çš„ä¸‹ä¸€ä¸ªå—ä¸­ï¼Œä½¿ç”¨<i>localFilesæ‰§è¡Œæ“ä½œ</i> ã€‚ è€Œä¸”ï¼Œå¦‚æœæ‚¨è®¤çœŸç ”ç©¶æ­¤ä»£ç ï¼Œå¹¶ä¸”ä¸åƒä»£ç å®¡æŸ¥é‚£æ ·ç»å¸¸å¿«é€Ÿæµè§ˆå®ƒï¼Œé‚£ä¹ˆè¯·æ³¨æ„å¿˜è®°æ›¿æ¢<i>localArchives</i>å˜é‡çš„ä½ç½®ã€‚ <br><br> è¿™ç§ç–å¿½å¯èƒ½å¯¼è‡´ä»¥ä¸‹æƒ…å†µï¼š <br><br><ul><li> å‡è®¾æˆ‘ä»¬æœ‰<i>localArchives</i> ï¼ˆå¤§å°= 4ï¼‰å’Œ<i>localFiles</i> ï¼ˆå¤§å°= 2ï¼‰; </li><li> å½“åˆ›å»º<i>localFiles.toArray</i>æ•°ç»„<i>ï¼ˆæ–°çš„String [localArchives.sizeï¼ˆï¼‰]ï¼‰æ—¶</i> ï¼Œæˆ‘ä»¬å°†æœ€å2ä¸ªå…ƒç´ è®¾ç½®ä¸º<i>null</i> ï¼ˆ[[pathToFile1â€œï¼Œâ€ pathToFile2â€œï¼Œnullï¼Œnull]ï¼‰ï¼› </li><li> ä¹‹åï¼Œ <i>org.apache.hadoop.util.StringUtils.arrayToString</i>å°†è¿”å›æ•°ç»„çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªæ–‡ä»¶åå°†è¡¨ç¤ºä¸ºâ€œ nullâ€ï¼ˆâ€œ pathToFile1ï¼ŒpathToFile2ï¼Œnullï¼Œnullâ€ <i>ï¼‰</i> ï¼› </li><li> æ‰€æœ‰è¿™äº›éƒ½å°†ç»§ç»­ä¸‹å»ï¼Œè°çŸ¥é“è¿™ç§æƒ…å†µä¸‹è¿›è¡Œå“ªäº›æ£€æŸ¥=ï¼‰ã€‚ </li></ul><br>  <a href="https://www.viva64.com/ru/w/v6007/">V6007</a>è¡¨è¾¾å¼'children.sizeï¼ˆï¼‰&gt; 0'å§‹ç»ˆä¸ºtrueã€‚  Queue.javaï¼ˆ347ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isHierarchySameAs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Queue newState)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (children == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || children.size() == <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(children.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } .... }</code> </pre> <br> ç”±äºè¦å•ç‹¬æ£€æŸ¥0å¤„çš„å…ƒç´ æ•°ï¼Œå› æ­¤è¿›ä¸€æ­¥æ£€æŸ¥<i>children.sizeï¼ˆï¼‰&gt; 0</i>å°†å§‹ç»ˆä¸ºtrueã€‚ <br><br><h3>  HDFS </h3><br>  <a href="https://www.viva64.com/ru/w/v6001/">V6001</a>åœ¨'ï¼…'è¿ç®—ç¬¦çš„å·¦ä¾§å’Œå³ä¾§æœ‰ç›¸åŒçš„å­è¡¨è¾¾å¼'this.bucketSize'ã€‚  RollingWindow.javaï¼ˆ79ï¼‰ <br><br><pre> <code class="java hljs"> RollingWindow(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> windowLenMs, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numBuckets) { buckets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bucket[numBuckets]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numBuckets; i++) { buckets[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bucket(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.windowLenMs = windowLenMs; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bucketSize = windowLenMs / numBuckets; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bucketSize % bucketSize != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= throw new IllegalArgumentException( "The bucket size in the rolling window is not integer: windowLenMs= " + windowLenMs + " numBuckets= " + numBuckets); } }</span></span></code> </pre> <br> è¯¥ç¼ºé™·åœ¨äºä»¥ä¸‹äº‹å®ï¼šå˜é‡è¢«åˆ†æˆäº†è‡ªå·±ã€‚ ç»“æœï¼Œå°†å§‹ç»ˆé€šè¿‡å¤šé‡æ€§æ£€æŸ¥ï¼Œå¹¶ä¸”åœ¨è¾“å…¥æ•°æ®ä¸æ­£ç¡®çš„æƒ…å†µä¸‹ï¼ˆ <i>windowLenMs</i> ï¼Œ <i>numBuckets</i> ï¼‰ï¼Œå°†ä¸ä¼šå¼•å‘å¼‚å¸¸ã€‚ <br><br><h3> çº±çº¿ </h3><br>  <a href="https://www.viva64.com/ru/w/v6067/">V6067</a>ä¸¤ä¸ªæˆ–æ›´å¤šæ¡ˆä»¶åˆ†æ”¯æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚  TimelineEntityV2Converter.javaï¼ˆ386ï¼‰ï¼ŒTimelineEntityV2Converter.javaï¼ˆ389ï¼‰ <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ApplicationReport </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToApplicationReport</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TimelineEntity entity)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (metrics != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> vcoreSeconds = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> memorySeconds = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> preemptedVcoreSeconds = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> preemptedMemorySeconds = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (TimelineMetric metric : metrics) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (metric.getId()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ApplicationMetricsConstants.APP_CPU_METRICS: vcoreSeconds = getAverageValue(metric.getValues().values()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ApplicationMetricsConstants.APP_MEM_METRICS: memorySeconds = ....; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ApplicationMetricsConstants.APP_MEM_PREEMPT_METRICS: preemptedVcoreSeconds = ....; <span class="hljs-comment"><span class="hljs-comment">// &lt;= break; case ApplicationMetricsConstants.APP_CPU_PREEMPT_METRICS: preemptedVcoreSeconds = ....; // &lt;= break; default: // Should not happen.. break; } } .... } .... }</span></span></code> </pre> <br> åœ¨ä¸¤ä¸ª<i>æ¡ˆä¾‹</i>åˆ†æ”¯ä¸­ï¼Œç›¸åŒçš„ä»£ç ç‰‡æ®µã€‚ è¿™æ€»æ˜¯å‘ç”Ÿï¼ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„é”™è¯¯ï¼Œè€Œåªæ˜¯è€ƒè™‘<i>äº¤æ¢æœº</i>é‡æ„çš„ä¸€ä¸ªæœºä¼šã€‚ ä½†å¹¶éé’ˆå¯¹ä¸Šè¿°æƒ…å†µã€‚ åœ¨é‡å¤ä»£ç æ®µä¸­ï¼Œ <i>è®¾ç½®</i>äº†å˜é‡<i>preemptedVcoreSeconds</i>çš„å€¼ã€‚ å¦‚æœæ³¨æ„æ‰€æœ‰å˜é‡å’Œå¸¸é‡çš„åç§°ï¼Œåˆ™å¯ä»¥å¾—å‡ºç»“è®ºï¼Œå¯¹äº<i>metric.getIdï¼ˆï¼‰== APP_MEM_PREEMPT_METRICS</i> ï¼Œåº”è®¾ç½®å˜é‡<i>preemptedMemorySeconds</i>çš„å€¼ï¼Œè€Œä¸æ˜¯<i>preemptedVcoreSeconds</i> ã€‚ åœ¨è¿™æ–¹é¢ï¼Œåœ¨æ‰§è¡Œâ€œ switchâ€è¯­å¥åï¼Œ <i>preemptedMemorySeconds</i>å°†å§‹ç»ˆä¿æŒä¸º0ï¼Œå¹¶ä¸”<i>preemptedVcoreSeconds</i>çš„å€¼å¯èƒ½ä¸æ­£ç¡®ã€‚ <br><br>  <a href="https://www.viva64.com/ru/w/v6046/">V6046</a>æ ¼å¼é”™è¯¯ã€‚ é¢„è®¡ä¼šæœ‰ä¸åŒæ•°é‡çš„æ ¼å¼é¡¹ã€‚ ä¸ä½¿ç”¨çš„å‚æ•°ï¼š2. AbstractSchedulerPlanFollower.javaï¼ˆ186ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">synchronizePlan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Plan plan, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> shouldReplan)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { setQueueEntitlement(planQueueName, ....); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (YarnException e) { LOG.warn(<span class="hljs-string"><span class="hljs-string">"Exception while trying to size reservation for plan: {}"</span></span>, currResId, planQueueName, e); } .... }</code> </pre> <br> è®°å½•æ—¶æœªä½¿ç”¨çš„å˜é‡<i>planQueueName</i> ã€‚ åœ¨è¿™é‡Œï¼Œå®ƒä»¬è¦ä¹ˆå¤åˆ¶å¤ªå¤šï¼Œè¦ä¹ˆæ²¡æœ‰ä¿®æ”¹æ ¼å¼å­—ç¬¦ä¸²ã€‚ ä½†æ˜¯ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œæˆ‘è¿˜æ˜¯å€¾å‘äºæ—§çš„ï¼Œæœ‰æ—¶ä¼šå¸¦æ¥æŸå®³çš„å¤åˆ¶ç²˜è´´ã€‚ <br><br><h2> æµ‹è¯•ç  </h2><br><h3>  Hadoopå¸¸è§ </h3><br>  <a href="https://www.viva64.com/ru/w/v6072/">V6072æ‰¾åˆ°</a>ä¸¤ä¸ªç›¸ä¼¼çš„ä»£ç ç‰‡æ®µã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™å­—ï¼Œåº”è¯¥ä½¿ç”¨'allSecretsB'å˜é‡è€Œä¸æ˜¯'allSecretsA'ã€‚  TestZKSignerSecretProvider.javaï¼ˆ316ï¼‰ï¼ŒTestZKSignerSecretProvider.javaï¼ˆ309ï¼‰ï¼ŒTestZKSignerSecretProvider.javaï¼ˆ306ï¼‰ï¼ŒTestZKSignerSecretProvider.javaï¼ˆ313ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMultiple</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> order)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ .... currentSecretA = secretProviderA.getCurrentSecret(); allSecretsA = secretProviderA.getAllSecrets(); Assert.assertArrayEquals(secretA2, currentSecretA); Assert.assertEquals(<span class="hljs-number"><span class="hljs-number">2</span></span>, allSecretsA.length); <span class="hljs-comment"><span class="hljs-comment">// &lt;= Assert.assertArrayEquals(secretA2, allSecretsA[0]); Assert.assertArrayEquals(secretA1, allSecretsA[1]); currentSecretB = secretProviderB.getCurrentSecret(); allSecretsB = secretProviderB.getAllSecrets(); Assert.assertArrayEquals(secretA2, currentSecretB); Assert.assertEquals(2, allSecretsA.length); // &lt;= Assert.assertArrayEquals(secretA2, allSecretsB[0]); Assert.assertArrayEquals(secretA1, allSecretsB[1]); .... }</span></span></code> </pre> <br> å†æ¬¡æ˜¯V6072ã€‚ æ³¨æ„å˜é‡<i>allSecretsA</i>å’Œ<i>allSecretsB</i> ã€‚ <br><br>  <a href="https://www.viva64.com/ru/w/v6043/">V6043</a>è€ƒè™‘æ£€æŸ¥â€œ forâ€è¿ç®—ç¬¦ã€‚ è¿­ä»£å™¨çš„åˆå§‹å€¼å’Œæœ€ç»ˆå€¼ç›¸åŒã€‚  TestTFile.javaï¼ˆ235ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readPrepWithUnknownLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Scanner scanner, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = start; i &lt; start; i++) { String key = String.format(localFormatter, i); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] read = readKey(scanner); assertTrue(<span class="hljs-string"><span class="hljs-string">"keys not equal"</span></span>, Arrays.equals(key.getBytes(), read)); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { read = readValue(scanner); assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException ie) { <span class="hljs-comment"><span class="hljs-comment">// should have thrown exception } String value = "value" + key; read = readLongValue(scanner, value.getBytes().length); assertTrue("values nto equal", Arrays.equals(read, value.getBytes())); scanner.advance(); } return (start + n); }</span></span></code> </pre> <br> æµ‹è¯•å§‹ç»ˆæ˜¯ç»¿è‰²çš„ï¼Ÿ  =ï¼‰ã€‚ ä½œä¸ºæµ‹è¯•ä¸€éƒ¨åˆ†çš„å¾ªç¯ä¸»ä½“æ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚ è¿™æ˜¯ç”±äºåœ¨<i>for</i>è¯­å¥ä¸­è®¡æ•°å™¨çš„å¼€å§‹å€¼å’Œç»“æŸå€¼åŒ¹é…ã€‚ ç»“æœï¼Œæ¡ä»¶<i>i &lt;å¼€å§‹å°†</i>ç«‹å³ä¸ºæˆ‘ä»¬æä¾›é”™è¯¯ï¼Œè¿™å°†å¯¼è‡´è¿™ç§è¡Œä¸ºã€‚ æˆ‘éå†äº†æ–‡ä»¶å¹¶è¿›è¡Œäº†æµ‹è¯•ï¼Œå¾—å‡ºçš„ç»“è®ºæ˜¯éœ€è¦åœ¨å¾ªç¯<i>i &lt;ï¼ˆstart + nï¼‰</i>çš„æ¡ä»¶ä¸‹è¿›è¡Œå†™æ“ä½œã€‚ <br><br><h3>  Mapreduce </h3><br>  a href =â€œ <a href="https://www.viva64.com/ru/w/v6007/">www.viva64.com/en/w/v6007</a> â€&gt; V6007è¡¨è¾¾å¼'byteAm &lt;0'å§‹ç»ˆä¸ºfalseã€‚  DataWriter.javaï¼ˆ322ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">GenerateOutput </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeSegment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> byteAm, OutputStream out)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> headerLen = getHeaderLength(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (byteAm &lt; headerLen) { <span class="hljs-comment"><span class="hljs-comment">// not enough bytes to write even the header return new GenerateOutput(0, 0); } // adjust for header length byteAm -= headerLen; if (byteAm &lt; 0) { // &lt;= byteAm = 0; } .... }</span></span></code> </pre> <br> æ¡ä»¶<i>byteAm &lt;0</i>å§‹ç»ˆä¸ºfalseã€‚ ä¸ºäº†ç†è§£ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ã€‚ å¦‚æœæµ‹è¯•æ‰§è¡Œåˆ°è¾¾æ“ä½œ<i>byteAm-= headerLen</i> ï¼Œåˆ™æ„å‘³ç€å°†å­˜åœ¨<i>byteAm&gt; = headerLen</i> ã€‚ ä»è¿™é‡Œå¼€å§‹ï¼Œæ‰§è¡Œå‡æ³•åï¼Œ <i>byteAm</i>çš„å€¼å°†æ°¸è¿œä¸ä¼šä¸ºè´Ÿã€‚ éœ€è¦è¯æ˜ã€‚ <br><br><h3>  HDFS </h3><br>  <a href="https://www.viva64.com/ru/w/v6072/">V6072æ‰¾åˆ°</a>ä¸¤ä¸ªç›¸ä¼¼çš„ä»£ç ç‰‡æ®µã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™å­—ï¼Œåº”è¯¥ä½¿ç”¨'normalFile'å˜é‡è€Œä¸æ˜¯'normalDir'ã€‚  TestWebHDFS.javaï¼ˆ625ï¼‰ï¼ŒTestWebHDFS.javaï¼ˆ615ï¼‰ï¼ŒTestWebHDFS.javaï¼ˆ614ï¼‰ï¼ŒTestWebHDFS.javaï¼ˆ624ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWebHdfsErasureCodingFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Path normalDir = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Path(<span class="hljs-string"><span class="hljs-string">"/dir"</span></span>); dfs.mkdirs(normalDir); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Path normalFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Path(normalDir, <span class="hljs-string"><span class="hljs-string">"file.log"</span></span>); .... <span class="hljs-comment"><span class="hljs-comment">// logic block #1 FileStatus expectedNormalDirStatus = dfs.getFileStatus(normalDir); FileStatus actualNormalDirStatus = webHdfs.getFileStatus(normalDir); // &lt;= Assert.assertEquals(expectedNormalDirStatus.isErasureCoded(), actualNormalDirStatus.isErasureCoded()); ContractTestUtils.assertNotErasureCoded(dfs, normalDir); assertTrue(normalDir + " should have erasure coding unset in " + ....); // logic block #2 FileStatus expectedNormalFileStatus = dfs.getFileStatus(normalFile); FileStatus actualNormalFileStatus = webHdfs.getFileStatus(normalDir); // &lt;= Assert.assertEquals(expectedNormalFileStatus.isErasureCoded(), actualNormalFileStatus.isErasureCoded()); ContractTestUtils.assertNotErasureCoded(dfs, normalFile); assertTrue( normalFile + " should have erasure coding unset in " + ....); }</span></span></code> </pre> <br> ä¸è¦ç›¸ä¿¡ï¼Œå†æ¥ä¸€æ¬¡V6072ï¼ åªéœ€éµå¾ª<i>normalDir</i>å’Œ<i>normalFileå˜é‡</i> <br><br>  <a href="https://www.viva64.com/ru/w/v6027/">V6027</a>é€šè¿‡è°ƒç”¨åŒä¸€å‡½æ•°æ¥åˆå§‹åŒ–å˜é‡ã€‚ å¯èƒ½æ˜¯é”™è¯¯æˆ–æœªä¼˜åŒ–çš„ä»£ç ã€‚  TestDFSAdmin.javaï¼ˆ883ï¼‰ï¼ŒTestDFSAdmin.javaï¼ˆ879ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verifyNodesAndCorruptBlocks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numDn, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numLiveDn, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numCorruptBlocks, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numCorruptECBlockGroups, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DFSClient client, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Long highestPriorityLowRedundancyReplicatedBlocks, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Long highestPriorityLowRedundancyECBlocks)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* init vars */</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String expectedCorruptedECBlockGroupsStr = String.format( <span class="hljs-string"><span class="hljs-string">"Block groups with corrupt internal blocks: %d"</span></span>, numCorruptECBlockGroups); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String highestPriorityLowRedundancyReplicatedBlocksStr = String.format( <span class="hljs-string"><span class="hljs-string">"\tLow redundancy blocks with highest priority "</span></span> + <span class="hljs-string"><span class="hljs-string">"to recover: %d"</span></span>, highestPriorityLowRedundancyReplicatedBlocks); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String highestPriorityLowRedundancyECBlocksStr = String.format( <span class="hljs-string"><span class="hljs-string">"\tLow redundancy blocks with highest priority "</span></span> + <span class="hljs-string"><span class="hljs-string">"to recover: %d"</span></span>, highestPriorityLowRedundancyReplicatedBlocks); .... }</code> </pre> <br> åœ¨æ­¤ç‰‡æ®µä¸­ï¼Œå˜é‡<i>highestPriorityLowRedundancyReplicatedBlocksStr</i>å’Œ<i>highestPriorityLowRedundancyECBlocksStr</i>ç”¨ç›¸åŒçš„å€¼åˆå§‹åŒ–ã€‚ é€šå¸¸åº”è¯¥å¦‚æ­¤ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ä¸åº”è¯¥å¦‚æ­¤ã€‚ æ­¤å¤„çš„å˜é‡åç§°å¾ˆé•¿ä¸”å½¼æ­¤ç›¸ä¼¼ï¼Œå› æ­¤å¯¹äºå¤åˆ¶ç²˜è´´æ²¡æœ‰è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ï¼Œæˆ‘å¹¶ä¸æ„Ÿåˆ°æƒŠè®¶ã€‚ ä¸ºäº†çº æ­£è¿™ç§æƒ…å†µï¼Œåœ¨åˆå§‹åŒ–å˜é‡<i>highestPriorityLowRedundancyECBlocksStræ—¶ï¼Œ</i>éœ€è¦ä½¿ç”¨è¾“å…¥å‚æ•°<i>highestPriorityLowRedundancyECBlocks</i> ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œæœ€æœ‰å¯èƒ½çš„æ˜¯ï¼Œæ‚¨ä»ç„¶éœ€è¦ä¿®å¤æ ¼å¼å­—ç¬¦ä¸²ã€‚ <br><br>  <a href="https://www.viva64.com/ru/w/v6019/">V6019</a>æ£€æµ‹<a href="https://www.viva64.com/ru/w/v6019/">ä¸åˆ°</a>ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  TestReplaceDatanodeFailureReplication.javaï¼ˆ222ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verifyFileContent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., SlowWriter[] slowwriters)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ LOG.info(<span class="hljs-string"><span class="hljs-string">"Verify the file"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; slowwriters.length; i++) { LOG.info(slowwriters[i].filepath + ....); FSDataInputStream in = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { in = fs.open(slowwriters[i].filepath); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>, x;; j++) { x = in.read(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((x) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { Assert.assertEquals(j, x); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { IOUtils.closeStream(in); } } }</code> </pre> <br> åˆ†æå™¨å‘èª“ï¼Œæ— æ³•åœ¨å¾ªç¯ä¸­æ›´æ”¹<i>i ++</i>è®¡æ•°å™¨ã€‚ è¿™æ„å‘³ç€åœ¨<i>for</i>å¾ªç¯ä¸­<i>ï¼ˆint i = 0; i &lt;slowwriters.length; i ++ï¼‰{....}</i>å°†ä»…æ‰§è¡Œä¸€æ¬¡è¿­ä»£ã€‚ è®©æˆ‘ä»¬æ‰¾å‡ºåŸå› ã€‚ å› æ­¤ï¼Œåœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæˆ‘ä»¬å°†æµä¸<i>æ…¢é€Ÿå†™å…¥å™¨[0]</i>å¯¹åº”çš„æ–‡ä»¶ç›¸å…³è”ï¼Œä»¥ä¾›è¿›ä¸€æ­¥è¯»å–ã€‚ é€šè¿‡<i>for</i>å¾ªç¯<i>ï¼ˆint j = 0ï¼Œx ;; j ++ï¼‰ï¼Œæˆ‘ä»¬</i>æŒ‰å­—èŠ‚è¯»å–æ–‡ä»¶çš„å†…å®¹ï¼Œå…¶ä¸­ï¼š <br><br><ul><li> å¦‚æœæˆ‘ä»¬è¯»å–äº†è¶³å¤Ÿçš„ä¸œè¥¿ï¼Œåˆ™é€šè¿‡<i>assertEquals</i>å°†è¯»å–çš„å­—èŠ‚ä¸è®¡æ•°å™¨<i>j</i>çš„å½“å‰å€¼è¿›è¡Œæ¯”è¾ƒï¼ˆå¦‚æœéªŒè¯å¤±è´¥ï¼Œåˆ™ä»¥å¤±è´¥é€€å‡ºæµ‹è¯•ï¼‰ï¼› </li><li> å¦‚æœæ–‡ä»¶é€šè¿‡äº†æµ‹è¯•å¹¶ä¸”æˆ‘ä»¬åˆ°è¾¾äº†æ–‡ä»¶çš„æœ«å°¾ï¼ˆè¯»å–ä¸º-1ï¼‰ï¼Œåˆ™é€€å‡ºè¯¥æ–¹æ³•ã€‚ </li></ul><br> å› æ­¤ï¼Œæ— è®ºæ£€æŸ¥<i>æ…¢å†™ç¨‹åº[0]</i>æ—¶å‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Œéƒ½ä¸ä¼šéªŒè¯ä»¥ä¸‹å…ƒç´ ã€‚ æœ€æœ‰å¯èƒ½çš„æ˜¯ï¼Œåº”è¯¥ä½¿ç”¨<i>break</i>è€Œä¸æ˜¯<i>return</i> ã€‚ <br><br><h3> çº±çº¿ </h3><br>  <a href="https://www.viva64.com/ru/w/v6019/">V6019</a>æ£€æµ‹<a href="https://www.viva64.com/ru/w/v6019/">ä¸åˆ°</a>ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  TestNodeManager.javaï¼ˆ176ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCreationOfNodeLabelsProviderService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> InterruptedException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { .... } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Assert.fail(<span class="hljs-string"><span class="hljs-string">"Exception caught"</span></span>); e.printStackTrace(); } }</code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œå°†æ°¸è¿œä¸ä¼šæ‰“å°stacktraceï¼Œå› ä¸º<i>Assert.fail</i>æ–¹æ³•å°†ä¸­æ–­æµ‹è¯•ã€‚ å¦‚æœæœ‰è¶³å¤Ÿçš„æ¶ˆæ¯æ•è·åˆ°å¼‚å¸¸ï¼Œé‚£ä¹ˆä¸ºäº†ä¸å¼•èµ·æ··æ·†ï¼Œéœ€è¦åˆ é™¤stacktrace'aæ‰“å°ã€‚ å¦‚æœéœ€è¦æ‰“å°ï¼Œåˆ™åªéœ€äº¤æ¢å®ƒä»¬ã€‚ <br><br> æœ‰å¾ˆå¤šè¿™æ ·çš„åœ°æ–¹ï¼š <ul><li>  V6019æ£€æµ‹ä¸åˆ°ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  TestResourceTrackerService.javaï¼ˆ928ï¼‰ </li><li>  V6019æ£€æµ‹ä¸åˆ°ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  TestResourceTrackerService.javaï¼ˆ737ï¼‰ </li><li>  V6019æ£€æµ‹ä¸åˆ°ä»£ç ã€‚ å¯èƒ½å­˜åœ¨é”™è¯¯ã€‚  TestResourceTrackerService.javaï¼ˆ685ï¼‰ </li><li>  .... </li></ul><br>  <a href="https://www.viva64.com/ru/w/v6072/">V6072æ‰¾åˆ°</a>ä¸¤ä¸ªç›¸ä¼¼çš„ä»£ç ç‰‡æ®µã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™å­—ï¼Œåº”è¯¥ä½¿ç”¨â€œ publicCacheâ€å˜é‡è€Œä¸æ˜¯â€œ usercacheâ€ã€‚  TestResourceLocalizationService.javaï¼ˆ315ï¼‰ï¼ŒTestResourceLocalizationService.javaï¼ˆ309ï¼‰ï¼ŒTestResourceLocalizationService.javaï¼ˆ307ï¼‰ï¼ŒTestResourceLocalizationService.javaï¼ˆ313ï¼‰ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDirectoryCleanupOnNewlyCreatedStateStore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException, URISyntaxException </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">// verify directory creation for (Path p : localDirs) { p = new Path((new URI(p.toString())).getPath()); // logic block #1 Path usercache = new Path(p, ContainerLocalizer.USERCACHE); verify(spylfs).rename(eq(usercache), any(Path.class), any()); // &lt;= verify(spylfs).mkdir(eq(usercache), ....); // logic block #2 Path publicCache = new Path(p, ContainerLocalizer.FILECACHE); verify(spylfs).rename(eq(usercache), any(Path.class), any()); // &lt;= verify(spylfs).mkdir(eq(publicCache), ....); .... } .... }</span></span></code> </pre> <br> æœ€åï¼Œå†æ¬¡æ˜¯V6072 =ï¼‰ã€‚ ä½¿æ‚¨ç†Ÿæ‚‰å¯ç–‘ä»£ç æ®µçš„å˜é‡ï¼š <i>usercache</i>å’Œ<i>publicCache</i> ã€‚ <br><br><h2> ç»“è®º </h2><br> åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç¼–å†™äº†æ•°åä¸‡è¡Œä»£ç ã€‚ å¦‚æœç”Ÿäº§ä»£ç è¯•å›¾æ¸…é™¤é”™è¯¯ï¼Œç¼ºé™·å’Œç¼ºç‚¹ï¼ˆå¼€å‘äººå‘˜æµ‹è¯•è‡ªå·±çš„ä»£ç ï¼Œè¿›è¡Œä»£ç å®¡æŸ¥ç­‰ç­‰ï¼‰ï¼Œåˆ™æµ‹è¯•æ˜¾ç„¶ä¸å¦‚æ­¤ã€‚ æµ‹è¯•ä¸­çš„ç¼ºé™·å¯ä»¥æ‚„æ‚„åœ°éšè—åœ¨â€œç»¿è‰²åˆ»åº¦â€åé¢ã€‚ ä»ä»Šå¤©å¯¹è­¦å‘Šçš„åˆ†æä¸­å¯ä»¥äº†è§£åˆ°ï¼ŒæˆåŠŸé€šè¿‡æµ‹è¯•å¹¶éæ€»æ˜¯å¯ä»¥ä¿è¯çš„æµ‹è¯•ã€‚ <br><br> åœ¨æ£€æŸ¥Apache Hadoopä»£ç åº“æ—¶ï¼Œé™æ€åˆ†æè¡¨æ˜å®ƒä¸ä»…éœ€è¦æŠ•å…¥ç”Ÿäº§çš„ä»£ç ï¼Œè¿˜éœ€è¦å¯¹åœ¨å¼€å‘ä¸­èµ·é‡è¦ä½œç”¨çš„æµ‹è¯•çš„éœ€æ±‚ã€‚ <br><br> å› æ­¤ï¼Œå¦‚æœæ‚¨å…³å¿ƒä»£ç å’Œæµ‹è¯•åº“çš„è´¨é‡ï¼Œé‚£ä¹ˆæˆ‘å»ºè®®æ‚¨è€ƒè™‘è¿›è¡Œé™æ€åˆ†æã€‚ æˆ‘æ˜¯æµ‹è¯•çš„ç¬¬ä¸€ä½ç”³è¯·äººï¼Œæˆ‘å»ºè®®å°è¯•<a href="https://www.viva64.com/ru/pvs-studio-download/">PVS-Studio</a> ã€‚ <br><br><p> <a href="https://habr.com/en/company/pvs-studio/blog/480918/"><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br> å¦‚æœæ‚¨æƒ³ä¸è®²è‹±è¯­çš„äººåˆ†äº«è¿™ç¯‡æ–‡ç« ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹é“¾æ¥ï¼šMaxim Stefanovã€‚  <a href="https://habr.com/en/company/pvs-studio/blog/480918/">Apache Hadoopä»£ç è´¨é‡ï¼šç”Ÿäº§VSæµ‹è¯•</a> ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN480928/">https://habr.com/ru/post/zh-CN480928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN480918/index.html">Apache Hadoopä»£ç è´¨é‡ï¼šç”Ÿäº§VSæµ‹è¯•</a></li>
<li><a href="../zh-CN480920/index.html">ä½¿ç”¨è¿œç¨‹PoEæµ‹è¯•TP-Linkäº¤æ¢æœºã€‚ å…³äºæ—§å‹å·çš„å‡çº§</a></li>
<li><a href="../zh-CN480922/index.html">Evgeny Usvitskyï¼šâ€œä¸–ç•Œä¸Šæ¯ä¸ªäººéƒ½çŸ¥é“åœ¨å“ªé‡Œå…è´¹è·å–åœ°ç†æ•°æ®-ä»…åœ¨OSMä¸­â€</a></li>
<li><a href="../zh-CN480924/index.html">é‡åˆ¶MediEvilçš„åˆ›å»ºè€…å¦‚ä½•ä»¥åŠä¸ºä½•é‡æ–°è®¾è®¡äº†æ¸¸æˆçš„ç‹‚çƒ­è€æ¿</a></li>
<li><a href="../zh-CN480926/index.html">ç‰©ç†ç²¾ç¡®æ¸²æŸ“çš„æ¦‚ç‡è®º</a></li>
<li><a href="../zh-CN480930/index.html">è¾“å…¥æ‰€æœ‰å†…å®¹</a></li>
<li><a href="../zh-CN480936/index.html">IntelliJ IDEAå¿«é€Ÿå°†UPPER_CASEè½¬æ¢ä¸ºcamelCase</a></li>
<li><a href="../zh-CN480938/index.html">ä¿„ç½—æ–¯æ³•å®˜çœ¼ä¸­çš„åŠ å¯†è´§å¸</a></li>
<li><a href="../zh-CN480940/index.html">åœ¨å…·æœ‰é­…åŠ›æŠ¥å‘Šçš„Gitlab CIä¸­ä½¿ç”¨Cucumberå’ŒSelenoidè¿è¡Œè·¨æµè§ˆå™¨çš„UIæµ‹è¯•</a></li>
<li><a href="../zh-CN480944/index.html">2020å¹´ç”µå­é‚®ä»¶è¥é”€çš„5å¤§è¶‹åŠ¿</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>