<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙇🏽 💅🏻 🛥️ 实用技巧，示例和SSH隧道 🗑️ 🤾🏿 💆🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SSH的实际示例，它将使您的远程系统管理员技能更上一层楼。 命令和技巧将不仅有助于使用SSH ，而且还可以更有效地导航网络。 

 知道一些ssh技巧对任何系统管理员，网络工程师或安全专家都是有用的。 

 实用的SSH示例 


1. SSH袜子代理 
2. SSH隧道（端口转发） 
3. SSH...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>实用技巧，示例和SSH隧道</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435546/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/oz/pn/4x/ozpn4xuna3odpakxmdgnlwqxwto.jpeg"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH的</a>实际示例，它将使您的远程系统管理员技能更上一层楼。 命令和技巧将不仅有助于使用<code>SSH</code> ，而且还可以更有效地导航网络。 <br><br> 知道一些<code>ssh</code>技巧对任何系统管理员，网络工程师或安全专家都是有用的。 <br><a name="habracut"></a><br><h3> 实用的SSH示例 </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH袜子代理</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH隧道（端口转发）</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH隧道到第三台主机</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH反向隧道</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH反向代理</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">通过SSH安装VPN</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">复制SSH密钥（ssh-copy-id）</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">远程命令执行（非交互式）</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在Wireshark中进行远程数据包捕获和查看</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">通过SSH将本地文件夹复制到远程服务器</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">远程SSH X11转发GUI应用程序</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用rsync和SSH进行远程文件复制</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">通过Tor网络进行SSH</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH到EC2实例</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">通过ssh / scp使用VIM编辑文本文件</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用SSHFS将远程SSH挂载为本地文件夹</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH与ControlPath的复用</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用VLC和SFTP的SSH视频流</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">两因素验证</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">主机通过SSH和-J跳转</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用iptables阻止SSH暴力破解尝试</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH Escape更改端口转发</a> </li></ol><br><h1> 基础第一 </h1><br><h4>  SSH命令行解析 </h4><br> 以下示例使用连接到远程<code>SSH</code>服务器时经常发现的常规参数。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -p 22 -C neo@remoteserver</code> </pre> <br><ul><li>  <code>-v</code> ：调试输出在分析身份验证问题时特别有用。 您可以多次使用它来显示其他信息。 </li><li>  <code>- p 22</code> ： <b>用于连接</b>到远程SSH服务器的<b>端口</b> 。 不必指定22，因为这是默认值，但是如果协议在其他端口上，则我们使用<code>-p</code>参数指定它。 侦听端口在<code>sshd_config</code>文件中以<code>Port 2222</code>的格式指定。 </li><li>  <code>-C</code> ：连接的压缩。 如果您的Feed速度慢或正在查看大量文本，则可以加快连接速度。 </li><li>  <code>neo@</code> ：@符号前的行表示远程服务器上用于认证的用户名。 如果未指定，默认情况下将使用当前登录帐户的用户名（〜$ whoami）。 也可以使用<code>-l</code>选项指定用户。 </li><li>  <code>remoteserver</code> ： <code>ssh</code>连接到的主机名，它可以是标准域名，IP地址或本地主机文件中的任何主机。 要连接到同时支持IPv4和IPv6的主机，可以在命令行中添加<code>-4</code>或<code>-6</code>选项以获得适当的分辨率。 </li></ul><br> 除了<code>remoteserver</code>以外，以上所有选项都是可选的。 <br><br><h4> 使用配置文件 </h4><br> 尽管许多人都熟悉<code>sshd_config</code>文件，但也有<code>ssh</code>命令的客户端配置文件。 缺省值为<code>~/.ssh/config</code> ，但是可以将其定义为<code>-F</code>选项的参数。 <br><br><pre> <code class="bash hljs">Host * Port 2222 Host remoteserver HostName remoteserver.thematrix.io User neo Port 2112 IdentityFile /home/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/.ssh/remoteserver.private_key</code> </pre> <br> 上面的示例ssh配置文件有两个主机条目。 第一个指示所有主机，所有端口均使用Port 2222配置参数；第二个指示对于<b>远程服务器</b>主机，使用不同的用户名，端口，FQDN和IdentityFile。 <br><br> 配置文件可以节省大量时间输入字符，从而使您可以在连接到特定主机时自动应用高级配置。 <br><br><h4> 使用SCP通过SSH复制文件 </h4><br>  SSH客户端附带了另外两个非常方便的工具，用于通过<b>加密的ssh连接</b>复制文件。 请参阅以下有关scp和sftp命令的标准用法的示例。 请注意，ssh的许多选项也适用于这些命令。 <br><br><pre> <code class="bash hljs">localhost:~$ scp mypic.png neo@remoteserver:/media/data/mypic_2.png</code> </pre> <br> 在此示例中，文件<b>mypic.png被</b>复制到<b>/ media / data</b>文件夹中的<b>remoteserver</b> <b>并重</b>命名为<b>mypic_2.png</b> 。 <br><br> 不要忘记端口参数的差异。 许多人从命令行运行<code>scp</code> 。 这里的port参数是<code>-P</code> ，而不是<code>-p</code> ，就像ssh客户端中一样！ 您会忘记，但不用担心，每个人都会忘记。 <br><br> 对于熟悉控制台<code>ftp</code> ，许多命令在<code>sftp</code>都是相似的。 您可以按照自己的意愿进行<b>推</b> ， <b>推</b>和<b>推拉</b> 。 <br><br><pre> <code class="bash hljs">sftp neo@remoteserver</code> </pre> <br><h1> 实际例子 </h1><br> 在许多这些示例中，可以通过各种方法获得结果。 与我们所有的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">教科书</a>和示例一样，偏向于简单地完成工作的实际示例。 <br><br><a name="1"></a><h3>  1. SSH袜子代理 </h3><br>  SSH代理位于1号是有充分理由的。 它比许多人想象的要强大，并且使您可以访问几乎任何应用程序都可以访问远程服务器访问的任何系统。  ssh客户端可以使用一个简单的命令来通过SOCKS代理建立流量隧道。 重要的是要了解到远程系统的流量将来自远程服务器，这将在Web服务器日志中指出。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -D 8888 user@remoteserver localhost:~$ netstat -pan | grep 8888 tcp 0 0 127.0.0.1:8888 0.0.0.0:* LISTEN 23880/ssh</code> </pre> <br> 在这里，我们在TCP端口8888上运行socks代理，第二条命令检查该端口在侦听模式下是否处于活动状态。  127.0.0.1表示该服务仅在本地主机上运行。 我们可以使用略有不同的命令来侦听所有接口，包括以太网或wifi，这将允许网络上的其他应用程序（浏览器等）通过ssh socks proxy连接到代理服务。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -D 0.0.0.0:8888 user@remoteserver</code> </pre> <br> 现在，我们可以配置浏览器以连接到袜子代理。 在Firefox中，选择<b>设置|</b>  <b>亮点|</b>  <b>网络设置</b> 指定要连接的IP地址和端口。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/daa/f8b/545/daaf8b54515ce6eee864c8416d41eef9.png"><br><br> 请注意表单底部的选项，以便浏览器DNS查询也可以通过SOCKS代理进行。 如果使用代理服务器加密本地网络上的Web流量，则可能要选择此选项，以便通过SSH连接建立DNS查询通道。 <br><br><h4> 在Chrome中启动袜子代理 </h4><br> 使用某些命令行选项运行Chrome可以激活袜子代理，并通过浏览器建立DNS查询通道。 信任，但要验证。 使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">tcpdump</a>验证DNS查询不再可见。 <br><br><pre> <code class="bash hljs">localhost:~$ google-chrome --proxy-server=<span class="hljs-string"><span class="hljs-string">"socks5://192.168.1.10:8888"</span></span></code> </pre> <br><h4> 使用其他代理应用程序 </h4><br> 请记住，许多其他应用程序也可以使用袜子代理。  Web浏览器只是其中最流行的。 某些应用程序具有用于激活代理服务器的配置选项。 其他人在帮助程序上需要一点帮助。 例如， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">代理链</a>允许<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">您</a>通过袜子代理运行Microsoft RDP等。 <br><br><pre> <code class="bash hljs">localhost:~$ proxychains rdesktop <span class="hljs-variable"><span class="hljs-variable">$RemoteWindowsServer</span></span></code> </pre> <br> 袜子代理配置参数在proxychains配置文件中设置。 <br><br><blockquote> 提示：如果您在Windows上使用Linux上的远程桌面？ 尝试<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">FreeRDP</a>客户端。 与<code>rdesktop</code>相比，这是一种更现代的实现，交互更加顺畅。 </blockquote><br><h4> 通过袜子代理的SSH选项 </h4><br> 您正坐在咖啡厅或旅馆中-被迫使用不太可靠的WiFi。 从笔记本电脑上，在本地启动ssh代理并将ssh隧道安装到本地Rasberry Pi上的家庭网络中。 使用浏览器或其他为袜子代理配置的应用程序，我们可以访问家庭网络上的任何网络服务，或通过家庭连接访问Internet。 便携式计算机和家庭服务器之间的所有内容（通过Wi-Fi和Internet到家庭）都在SSH隧道中加密。 <br><br><a name="2"></a><h3>  2. SSH隧道（端口转发） </h3><br>  SSH隧道以其最简单的形式只是在本地系统上打开一个端口，该端口连接到隧道另一端的另一个端口。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 9999:127.0.0.1:80 user@remoteserver</code> </pre> <br> 让我们研究一下<code>-L</code>选项。 它可以表示为收听的本地端。 因此，在上面的示例中，端口9999在本地主机端被侦听，并通过端口80转发到remoteserver。 请注意，127.0.0.1引用远程服务器上的localhost！ <br><br> 让我们上一步。 在以下示例中，侦听端口与本地网络上的其他节点通信。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 0.0.0.0:9999:127.0.0.1:80 user@remoteserver</code> </pre> <br> 在这些示例中，我们连接到Web服务器上的端口，但是它可以是代理服务器或任何其他TCP服务。 <br><br><a name="3"></a><h3>  3. SSH隧道到第三方主机 </h3><br> 我们可以使用相同的参数将隧道从远程服务器连接到在第三系统上运行的另一服务。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -L 0.0.0.0:9999:10.10.10.10:80 user@remoteserver</code> </pre> <br> 在此示例中，我们将隧道从remoteserver重定向到运行于10.10.10.10的Web服务器。  <b>SSH隧道中不再</b>包含10.10.10.10之前与remoteserver进行的通信。 在10.10.10.10，Web服务器将把remoteserver视为Web请求的源。 <br><br><a name="4"></a><h3>  4.反向SSH隧道 </h3><br> 在这里，我们在远程服务器上配置侦听端口，该侦听端口将连接回本地主机（或其他系统）上的本地端口。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -R 0.0.0.0:1999:127.0.0.1:902 192.168.1.100 user@remoteserver</code> </pre> <br> 在此SSH会话中，建立了从远程服务器上的端口1999到我们本地客户端上的端口902的连接。 <br><br><a name="5"></a><h3>  5.反向SSH代理 </h3><br> 在这种情况下，我们将socks代理安装在我们的ssh连接上，但是，该代理在服务器的远程端进行侦听。 现在，与该远程代理的连接从隧道显示为来自本地主机的流量。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -v -R 0.0.0.0:1999 192.168.1.100 user@remoteserver</code> </pre> <br><h4> 对远程SSH隧道进行故障排除 </h4><br> 如果远程SSH选项有问题，请使用<code>netstat</code>检查侦听端口连接到的其他接口。 尽管我们在示例中指定了0.0.0.0，但是如果<b>sshd_config中</b>的<b>GatewayPorts</b>值设置为<b>no</b> ，则侦听器将仅绑定到localhost（127.0.0.1）。 <br><br><blockquote><h4> 安全警告 </h4><br> 请注意，打开隧道和袜子代理时，内部网络资源可能可用于不受信任的网络（例如Internet！）。 这可能会带来严重的安全风险，因此请确保您了解侦听器是什么以及侦听器可以访问什么。 </blockquote><br><a name="6"></a><h3>  6.通过SSH安装VPN </h3><br> 攻击方法（五分之一等）的专家中的通用术语是“网络的支点”。 在一个系统中建立连接后，该系统成为进一步访问网络的网关。 允许您移动的支点。 <br><br> 对于这样的支点，我们可以使用SSH代理和代理<b>链</b> ，但是存在一些限制。 例如，您将无法直接使用套接字，因此我们将无法通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Nmap</a> <code>SYN</code>扫描网络内部的端口。 <br><br> 使用此更高级的VPN选项，连接下降到<b>3级</b> 。 然后，我们可以使用标准网络路由简单地将流量路由通过隧道。 <br><br> 该方法使用<code>ssh</code> ， <code>iptables</code> ， <code>tun interfaces</code>和路由。 <br><br> 首先，您需要在<code>sshd_config</code>设置这些参数。 由于我们正在更改远程系统和客户端系统的接口，因此我们都<b>需要root特权</b> 。 <br><br><pre> <code class="bash hljs">PermitRootLogin yes PermitTunnel yes</code> </pre> <br> 然后使用请求初始化tun设备的参数建立ssh连接。 <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># ssh -v -w any root@remoteserver</span></span></code> </pre> <br> 现在，在显示接口（ <code># ip a</code> ）时，我们应该有一个tun设备。 下一步将IP地址添加到隧道接口。 <br><br>  SSH客户端： <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># ip addr add 10.10.10.2/32 peer 10.10.10.10 dev tun0 localhost:~# ip tun0 up</span></span></code> </pre> <br>  SSH服务器端： <br><br><pre> <code class="bash hljs">remoteserver:~<span class="hljs-comment"><span class="hljs-comment"># ip addr add 10.10.10.10/32 peer 10.10.10.2 dev tun0 remoteserver:~# ip tun0 up</span></span></code> </pre> <br> 现在，我们有了到另一台主机的直接路由（ <code>route -n</code>和<code>ping 10.10.10.10</code> ）。 <br><br> 您可以通过另一侧的主机路由任何子网。 <br><br><pre> <code class="bash hljs">localhost:~<span class="hljs-comment"><span class="hljs-comment"># route add -net 10.10.10.0 netmask 255.255.255.0 dev tun0</span></span></code> </pre> <br> 在远程端，必须启用<code>ip_forward</code>和<code>iptables</code> 。 <br><br><pre> <code class="bash hljs">remoteserver:~<span class="hljs-comment"><span class="hljs-comment"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward remoteserver:~# iptables -t nat -A POSTROUTING -s 10.10.10.2 -o enp7s0 -j MASQUERADE</span></span></code> </pre> <br>  oom！  <b>网络层3上的SSH隧道上的VPN</b> 。 这已经是胜利。 <br><br> 如果遇到任何问题，请使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">tcpdump</a>和<code>ping</code>确定原因。 由于我们在3级游戏，因此我们的icmp数据包将通过此隧道。 <br><br><a name="7"></a><h3>  7.复制SSH密钥（ssh-copy-id） </h3><br> 有几种方法，但是此命令可以节省时间，以免手动复制文件。 它只是将〜/ .ssh / id_rsa.pub（或默认密钥）从您的系统复制到远程服务器上的<code>~/.ssh/authorized_keys</code> 。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh-copy-id user@remoteserver</code> </pre> <br><a name="8"></a><h3>  8.远程命令执行（非交互式） </h3><br>  <code>ssh</code>命令可以与其他命令关联，以实现通常的用户友好界面。 只需将要在远程主机上运行的命令添加为引号中的最后一个参数即可。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh remoteserver <span class="hljs-string"><span class="hljs-string">"cat /var/log/nginx/access.log"</span></span> | grep badstuff.php</code> </pre> <br> 在此示例中，通过ssh通道下载日志后， <code>grep</code>将在本地系统上运行。 如果文件很大，则在远程运行<code>grep</code>更为方便，只需将两个命令都用双引号引起来即可。 <br><br> 另一个示例执行与示例7中的<code>ssh-copy-id</code>相同的功能。 <br><br><pre> <code class="bash hljs">localhost:~$ cat ~/.ssh/id_rsa.pub | ssh remoteserver <span class="hljs-string"><span class="hljs-string">'cat &gt;&gt; .ssh/authorized_keys'</span></span></code> </pre> <br><a name="9"></a><h3>  9.在Wireshark中进行远程数据包捕获和查看 </h3><br> 我<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">举</a>了一个我们的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">tcpdump示例</a> 。 使用它可以直接在本地Wireshark的GUI中远程拦截数据包。 <br><br><pre> <code class="bash hljs">:~$ ssh root@remoteserver <span class="hljs-string"><span class="hljs-string">'tcpdump -c 1000 -nn -w - not port 22'</span></span> | wireshark -k -i -</code> </pre> <br><a name="10"></a><h3>  10.通过SSH将本地文件夹复制到远程服务器 </h3><br> 一个漂亮的技巧是使用<code>bzip2</code>压缩文件夹（这是<code>tar</code>命令中的-j选项），然后在另一侧提取<code>bzip2</code>流，从而在远程服务器上创建该文件夹的副本。 <br><br><pre> <code class="bash hljs">localhost:~$ tar -cvj /datafolder | ssh remoteserver <span class="hljs-string"><span class="hljs-string">"tar -xj -C /datafolder"</span></span></code> </pre> <br><a name="11"></a><h3>  11.远程SSH X11转发GUI应用程序 </h3><br> 如果客户端和远程服务器安装了X，则可以在本地桌面上的一个窗口中远程执行GUI命令。 此功能已存在很久了，但仍然非常有用。 像在本示例中一样，启动一个远程Web浏览器，甚至是VMWawre Workstation控制台。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -X remoteserver vmware</code> </pre> <br> 在<code>sshd_config</code>文件中需要<code>X11Forwarding yes</code>行。 <br><br><a name="12"></a><h3>  12.使用rsync和SSH进行远程文件复制 </h3><br> 如果需要定期备份目录，大量文件或非常大的文件，则<code>rsync</code>比<code>scp</code>更为方便。 具有从传输故障中恢复并仅复制修改后的文件的功能，从而节省了流量和时间。 <br><br> 本示例使用<code>gzip</code>压缩（-z）和存档模式（-a），从而启用递归复制。 <br><br><pre> <code class="bash hljs">:~$ rsync -az /home/testuser/data remoteserver:backup/</code> </pre> <br><a name="13"></a><h3>  13.通过Tor网络的SSH </h3><br> 匿名的Tor网络可以使用<code>torsocks</code> SSH流量隧道。 以下命令将通过Tor抛出ssh代理。 <br><br><pre> <code class="bash hljs">localhost:~$ torsocks ssh myuntracableuser@remoteserver</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Torsocks</a>将使用端口9050作为本地主机上的代理。 与往常一样，在使用Tor时，您需要认真检查正在传输的流量和其他操作安全性问题（opsec）。  <b>您的DNS查询要去哪里？</b> <br><br><a name="14"></a><h3>  14. SSH到EC2实例 </h3><br> 需要私钥才能连接到EC2实例。 从Amazon EC2控制面板下载它（扩展名.pem）并更改权限（ <code>chmod 400 my-ec2-ssh-key.pem</code> ）。 将密钥保存在安全的地方，或将其放在<code>~/.ssh/</code>文件夹中。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -i ~/.ssh/my-ec2-key.pem ubuntu@my-ec2-public</code> </pre> <br>  <b>-i选项</b>只是告诉ssh客户端使用此开关。  <code>~/.ssh/config</code>文件是连接到ec2主机时自动配置密钥用法的理想选择。 <br><br><pre> <code class="bash hljs">Host my-ec2-public Hostname ec2???.compute-1.amazonaws.com User ubuntu IdentityFile ~/.ssh/my-ec2-key.pem</code> </pre> <br><a name="15"></a><h3>  15.通过ssh / scp使用VIM编辑文本文件 </h3><br> 对于所有<code>vim</code>爱好者，此技巧将节省一些时间。 使用<code>vim</code>可通过一个命令使用scp编辑文件。 该方法只是在<code>/tmp</code>本地创建文件，然后在我们从<code>vim</code>保存文件后将其复制回去。 <br><br><pre> <code class="bash hljs">localhost:~$ vim scp://user@remoteserver//etc/hosts</code> </pre> <br> 注意：格式与常规<code>scp</code>略有不同。 在主持人之后，我们有<code>//</code> 。 这是到绝对路径的链接。 一个斜杠表示相对于<code>users</code>主文件夹的路径。 <br><br><pre> <code class="bash hljs">**warning** (netrw) cannot determine method (format: protocol://[user@]hostname[:port]/[path])</code> </pre> <br> 如果看到此错误，请仔细检查命令的格式。 这通常意味着语法错误。 <br><br><a name="16"></a><h3>  16.使用SSHFS将远程SSH挂载为本地文件夹 </h3><br> 使用<code>ssh</code>文件系统客户端<code>sshfs</code> ，我们可以将本地目录连接到远程位置，并在加密的<code>ssh</code>会话中进行所有文件交互。 <br><br><pre> <code class="bash hljs">localhost:~$ apt install sshfs</code> </pre> <br> 我们在Ubuntu和Debian上安装<code>sshfs</code>软件包，然后将远程位置安装在我们的系统上。 <br><br><pre> <code class="bash hljs">localhost:~$ sshfs user@remoteserver:/media/data ~/data/</code> </pre> <br><a name="17"></a><h3>  17. SSH与ControlPath的复用 </h3><br> 默认情况下，如果您具有使用<code>ssh</code>到远程服务器的现有连接<code>ssh</code>使用<code>ssh</code>或<code>scp</code> <code>ssh</code>第二个连接将建立具有附加身份验证的新会话。  <code>ControlPath</code>选项允许您将现有会话用于所有后续连接。 这将大大加快该过程：即使在本地网络上，效果也很明显，而连接到远程资源时效果更明显。 <br><br><pre> <code class="bash hljs">Host remoteserver HostName remoteserver.example.org ControlMaster auto ControlPath ~/.ssh/control/%r@%h:%p ControlPersist 10m</code> </pre> <br>  ControlPath告诉套接字为活动的<code>ssh</code>会话检查新连接。 最后一个选项意味着即使退出控制台，现有会话仍将保持打开状态10分钟，因此在这段时间内您可以重新连接到现有套接字。 有关更多信息，请参见<code>ssh_config man</code>帮助。 <br><br><a name="18"></a><h3>  18.使用VLC和SFTP通过SSH流传输视频 </h3><br> 当您确实需要在网络上观看视频时，即使<code>ssh</code>和<code>vlc</code> （视频Lan客户端）的长期用户也不总是知道此便捷选项。 在设置<b>文件|</b>  <b>打开Network Stream</b> <code>vlc</code>程序可以将位置输入为<code>sftp://</code> 。 如果需要密码，将出现提示。 <br><br><pre> <code class="bash hljs">sftp://remoteserver//media/uploads/myvideo.mkv</code> </pre> <br><a name="19"></a><h3>  19.两因素认证 </h3><br> 与您的银行帐户或Google帐户相同的两因素身份验证适用于SSH服务。 <br><br> 当然， <code>ssh</code>最初具有双重身份验证功能，即密码和SSH密钥。 硬件令牌或Google Authenticator应用程序的优势在于，它通常是不同的物理设备。 <br><br> 请参阅有关<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用Google Authenticator和SSH的</a> 8分钟指南。 <br><br><a name="20"></a><h3>  20.主机通过ssh和-J跳转 </h3><br> 如果由于网络分段的原因，您必须跨越多个ssh主机才能到达最终的目标网络，则-J快捷方式将节省您的时间。 <br><br><pre> <code class="bash hljs">localhost:~$ ssh -J host1,host2,host3 user@host4.internal</code> </pre> <br> 在这里主要要了解的是，这与<code>ssh host1</code> ，然后与<code>user@host1:~$ ssh host2</code>等类似。-J参数巧妙地使用转发，以便localhost与链中的下一个主机建立会话。 因此，在上面的示例中，我们的本地主机对host4进行身份验证。 也就是说，使用了我们的本地主机密钥，并且从本地主机到host4的会话已完全加密。 <br><br> 为此，请在<b>ssh_config中</b>指定<b>proxyJump</b>配置选项。 如果您必须定期通过多个主机，则通过配置进行自动化将节省大量时间。 <br><br><a name="21"></a><h3>  21.使用iptables阻止SSH暴力破解尝试 </h3><br> 任何运行SSH服务并浏览日志的人都知道每天每小时发生的暴力破解尝试次数。 减少日志中噪音的一种快速方法是将SSH迁移到非标准端口。 使用<b>端口##</b>配置参数更改<code>sshd_config</code>文件。 <br><br> 使用<code>iptables</code> ，您还可以在达到特定阈值后轻松阻止尝试连接到端口的尝试。     —  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OSSEC</a> ,      SSH,             (HIDS). <br><br><a name="22"></a><h3> 22. SSH Escape     </h3><br>     <code>ssh</code>            <code>ssh</code> .   .    ; ,            ,    Microsoft SMB   Windows 2003 (-  ms08-67?). <br><br>  <code>enter</code> ,     <code>~C</code> .     ,      . <br><br><pre> <code class="bash hljs">localhost:~$ ~C ssh&gt; -h Commands: -L[bind_address:]port:host:hostport Request <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> forward -R[bind_address:]port:host:hostport Request remote forward -D[bind_address:]port Request dynamic forward -KL[bind_address:]port Cancel <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> forward -KR[bind_address:]port Cancel remote forward -KD[bind_address:]port Cancel dynamic forward ssh&gt; -L 1445:remote-win2k3:445 Forwarding port.</code> </pre> <br>    ,       1445   Windows 2003,     .    <code>msfconsole</code> ,     (,      ). <br><br><h1> 完成时间 </h1><br>  ,    <code>ssh</code>    ;             ( <code>man ssh</code> , <code>man ssh_config</code> , <code>man sshd_config</code> ). <br><br>              .         <code>ssh</code>       ,   . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN435546/">https://habr.com/ru/post/zh-CN435546/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN435536/index.html">人形机器人：拟人化机制的优点和问题</a></li>
<li><a href="../zh-CN435538/index.html">2018年，德国接收到的“绿色”能源多于燃煤发电</a></li>
<li><a href="../zh-CN435540/index.html">Java中的新关键字</a></li>
<li><a href="../zh-CN435542/index.html">文凭的游戏开发和辩护或“我是如何用一块石头先烤煎饼杀死两只鸟的”</a></li>
<li><a href="../zh-CN435544/index.html">Innopolis University员工获得了Facebook资助</a></li>
<li><a href="../zh-CN435548/index.html">入侵公共服务-如果确实需要，则可以</a></li>
<li><a href="../zh-CN435550/index.html">GitLab 11.6发布了具有无服务器功能和Kubernetes集群的组</a></li>
<li><a href="../zh-CN435552/index.html">进口替代-数字化墓志铭</a></li>
<li><a href="../zh-CN435556/index.html">迁移到数据中心：过去的样子</a></li>
<li><a href="../zh-CN435558/index.html">在Linux上使用HugePages测试PostgreSQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>