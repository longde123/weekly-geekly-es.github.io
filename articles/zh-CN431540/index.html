<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛🏾 🙎🏼 🛶 k8s的软件包和软件包管理器 🐱 🤷🏻 👨🏽‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我们所有人都使用某种包装管理器，包括清洁女工Galya姨妈，她的口袋里有一部iPhone，现在已更新。 但是，关于程序包管理器的功能尚未达成共识，标准的rpm和dpkg操作系统以及构建系统称为程序包管理器。 我们提供有关它们功能的主题的思考-它的功能以及为什么在现代世界中需要它们。 然后，我们将深入...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>k8s的软件包和软件包管理器</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/431540/"> 我们所有人都使用某种包装管理器，包括清洁女工Galya姨妈，她的口袋里有一部iPhone，现在已更新。 但是，关于程序包管理器的功能尚未达成共识，标准的rpm和dpkg操作系统以及构建系统称为程序包管理器。 我们提供有关它们功能的主题的思考-它的功能以及为什么在现代世界中需要它们。 然后，我们将深入研究Kubernetes，并在这些功能方面仔细考虑Helm。 <br><img src="https://habrastorage.org/webt/xs/mf/h5/xsmfh5898yrlawroqge2dn6v_iw.png"><br><br> 我们将理解为什么在此图中仅以绿色突出显示模板功能，以及组装和包装，环境自动化等存在哪些问题。 但请不要担心，本文并不以一切都不好的事实结尾。 社区对此不满意，并提供了替代工具和解决方案-我们将处理它们。 <br><br>  <b>Ivan Glushkov</b> （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">gli</a> ）通过发表有关RIT ++的报告为我们提供了帮助，该报告是以下详细介绍的视频和文本版本。 <br><br><blockquote>  RIT ++上的此DevOps演讲和其他演讲的视频已发布，并可以在我们的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">YouTube频道</a>上免费观看-寻找您正在解决的问题的答案。 <br></blockquote><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/V_DGgD7ihsQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <strong>关于演讲者：</strong> Ivan Glushkov开发软件已有15年了。 我设法在MZ的Echo平台上发表评论，并参与了MCST中Elbrus处理器的编译器开发。 他目前在Postmates从事基础设施项目。  Ivan是主要的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DevZen</a>播客之一，他们在其中讨论我们的会议： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里</a>是RIT ++， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里</a>是HighLoad ++。 <br><br><h2> 包装经理 <br></h2><br> 尽管每个人都使用某种程序包管理器，但是对于它是什么并没有达成一致。 有一个共同的理解，每个都有自己的理解。 <br><br> 让我们回想一下最先想到哪些类型的程序包管理器： <br><br><ul><li> 所有操作系统的标准软件包管理器： <strong>rpm，dpkg，portage</strong> ，... </li><li> 包管理器支持不同的编程语言： <strong>货物，阴谋，钢筋3，混合物</strong> ，... </li></ul><br> 它们的主要功能是执行用于安装软件包，更新软件包，卸载软件包以及管理依赖项的命令。 在编程语言内部的程序包管理器中，事情要复杂一些。 例如，有诸如“启动软件包”或“创建发行版”（构建/运行/发行版）之类的命令。 事实证明，这已经是一个构建系统，尽管我们也称它为包管理器。 <br><img src="https://habrastorage.org/webt/ct/di/ni/ctdinidgmq8e-zcuksmz-cfym2y.png"><br><br> 所有这一切仅是由于您不能随便拿走……让Haskell爱好者原谅这种比较。 您可以运行二进制文件，但不能在Haskell或C中运行该程序，首先需要以某种方式准备它。 而且准备工作相当复杂，用户希望一切都可以自动完成。 <br><br><h3> 发展历程 <br></h3><br> 与GNU libtool一起工作的人（这是为一个包含大量组件的大型项目而制作的）并不嘲笑马戏团。 这确实非常困难，有些情况原则上不能解决，而只能绕开。 <br><br> 相比之下，像Rust的货物这样的现代包装语言管理器要方便得多-只需按一下按钮，一切就可以正常进行。 尽管实际上，在幕后解决了许多问题。 而且，所有这些新功能都需要附加的内容，尤其是数据库。 尽管可以在包管理器中将其随意命名，但我将其称为数据库，因为 数据存储在此处：有关已安装的软件包，其版本，已连接的存储库以及这些存储库中的版本的信息。 所有这些必须存储在某个地方，因此有一个内部数据库。 <br><br> 使用该编程语言进行开发，对该语言进行测试，启动-所有这些都是内置的并且位于内部， <strong>工作变得非常方便</strong> 。 大多数现代语言都支持这种方法。 即使是那些不支持的人也开始支持，因为社区迫切要求并说在现代世界中没有它是不可能的。 <br><br>  <strong>但是任何解决方案总是不仅具有优点，而且具有缺点</strong> 。 缺点是您需要包装器，其他实用程序和内置的“数据库”。 <br><br><h2> 码头工人 <br></h2><br><blockquote> 您是否认为Docker是软件包管理器？ <br></blockquote><br> 无论如何，但本质上是肯定的。 为了将应用程序与所有依赖项完全放在一起并使它在单击按钮时起作用，我不知道更正确的实用程序。 如果不是包管理器，这是什么？ 这是一个很棒的包裹经理！ <br><br>  Maxim Lapshin已经<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">说过</a> ，使用Docker变得更加容易，事实就是如此。  Docker有一个内置的构建系统，所有这些数据库，绑定，实用程序。 <br><br> 所有福利的价格是多少？ 那些与Docker合作的人很少考虑工业应用程序。 我有这样的经验，而且价格实际上很高： <br><br><ul><li> 必须存储在Docker映像中<strong>的信息量</strong> （映像大小）。 所有依赖项，实用程序的一部分，库都必须打包在其中，映像很大，您需要能够使用它。 </li><li>  <strong>范式的转变</strong>要复杂得多。 </li></ul><br> 例如，我有一项任务是转移一个程序以使用Docker。 该程序是由一个团队多年来开发的。 我来了，我们做着书上写的所有事情：我们为用户绘制故事，角色，查看他们的工作方式，标准例程。 <br><br> 我说： <br><br>  -Docker可以解决您的所有问题。 观看如何完成。 <br><br>  -一切都会在按钮上-太好了！ 但是我们希望SSH在Kubernetes容器内进行。 <br><br>  -等待，任何地方都没有SSH。 <br><br>  -是的，是的，一切都很好...但是可以使用SSH吗？ <br><br> 为了将用户的感知转变为新的方向，需要花费大量时间，花费教育工作和大量精力。 <br><br> 另一个价格因素是<strong>Docker注册表</strong>是映像的外部存储库，需要以某种方式安装和控制它。 它有其自身的问题，垃圾收集器等，并且如果您不遵循它，它通常会掉下来，但是这一切都已解决。 <br><br><h2>  Kubernetes <br></h2><br> 终于，我们到达了Kubernetes。 这是一个很酷的OpenSource应用程序管理系统，受到社区的积极支持。 尽管Kubernetes最初是由一家公司创立的，但现在拥有一个庞大的社区，无法跟上它的步伐，实际上没有其他选择。 <br><br> 有趣的是，所有Kubernetes节点本身都通过容器在Kubernetes中工作，所有外部应用程序都通过容器工作- <strong>一切都通过容器工作</strong> ！ 这既是加号也是减号。 <br><br>  Kubernetes具有许多有用的功能和特性：分布，容错，与不同的云服务一起工作的能力以及面向微服务架构的方向。 所有这些都很有趣而且很酷，但是如何在Kubernetes中安装应用程序呢？ <br><br><h3> 如何安装该应用程序？ <br></h3><br><blockquote> 在Docker注册表中安装Docker映像。 </blockquote><br> 这句话的背后是深渊。 您可以想象-您有一个用Ruby编写的应用程序，并且必须将Docker映像放入Docker注册表中。 这意味着您必须： <br><br><ul><li> 准备Docker映像 </li><li> 了解进展情况，基于哪个版本； </li><li> 能够测试； </li><li> 收集并填写您之前安装的Docker注册表。 </li></ul><br> 实际上，这是一个很大的难题。 <br><br> 另外，您仍然需要用k8的术语（资源）描述应用程序清单。 最简单的选择： <br><br><ul><li> 描述部署+ pod，服务+入口（可能）； </li><li> 运行kubectl apply -f resources.yaml命令，并将所有资源转移到该命令。 </li></ul><br><img src="https://habrastorage.org/webt/o9/pj/8w/o9pj8wgukswoi3laskibnzkemg0.png"><br><br> 甘地把手放在幻灯片上-好像我在Kubernetes中找到了程序包管理器。 但是kubectl不是软件包管理器。 他只是说我想看到系统的这种最终状态。 这不是在安装程序包，不是在处理依赖项，也没有在构建-只是“我想看到这种最终状态”。 <br><br><h2> 头盔 <br></h2><br> 终于我们来到了赫尔姆。  Helm是一种多功能工具。 现在，我们将考虑Helm的发展领域以及与之合作的领域。 <br><br><h3> 模板引擎 <br></h3><br> 首先，Helm是模板引擎。 我们讨论了需要准备哪些资源，问题是如何用Kubernetes编写（不仅限于yaml）。 最有趣的是，这些是在特定环境中针对特定应用程序的静态文件。 <br><br> 但是，如果您在多个环境中工作，并且不仅具有生产环境，还具有针对不同团队的暂存，测试，开发和不同环境，则需要具有多个相似的清单。 例如，由于其中一个服务器中有多个服务器，并且您需要具有大量副本，而在另一个服务器中-仅一个副本。 没有数据库，无法访问RDS，您需要在其中安装PostgreSQL。 这是旧版本，我们需要重新编写所有内容。 <br><br> 所有这些多样性导致这样一个事实，即您必须将Kubernetes的清单作为清单，在任何地方复制并在任何地方修复：在此替换一位，在此替换另一位。 这变得非常不舒服。 <br><br> 解决方案很简单-您需要<strong>输入模板</strong> 。 即，您形成一个清单，在其中定义变量，然后将外部定义的变量作为文件提交。 模板创建最终清单。 事实证明，可以在所有环境中重用同一清单，这更加方便。 <br><br> 例如，Helm的清单。 <br><img src="https://habrastorage.org/webt/ls/ys/ms/lsysmsc7kcnrm1vl8epif7ooowu.png"><br><br><ul><li>  Helm中最重要的部分是<strong>Chart.yaml</strong> ，它描述了清单的种类，版本，工作方式。 </li><li>  <strong>模板</strong>只是Kubernetes资源模板，其内部包含某种变量。 这些变量必须在外部文件或命令行中定义，但始终在外部定义。 </li><li>  <strong>values.yaml</strong>是文件的标准名称，其中包含这些模板的变量。 </li></ul><br> 用于安装图表的最简单的启动命令是helm install ./wordpress（文件夹）。 要重新定义一些参数，我们说：“我想精确地重新定义这些参数并设置这样的值。” <br><br>  Helm可以完成这项任务，因此在图中我们将其标记为绿色。 <br><img src="https://habrastorage.org/webt/it/nk/7s/itnk7so3wdowimy9riigh74amhy.png"><br><br> 是的，缺点出现了： <br><br><ul><li>  <strong>细致</strong> 。 资源是完全按照Kubernetes定义的，没有引入其他抽象级别的概念：我们只需编写我们想为Kubernetes编写的所有内容，然后在其中替换变量。 </li><li>  <strong>不要重复自己-不适用。</strong> 通常有必要重复同样的事情。 如果您有两个名称不同的类似服务，则需要完全复制整个文件夹（大多数情况下是这样做）并更改必要的文件。 </li></ul><br> 在深入介绍Helm的方向之前，我将为您介绍所有这些，这是一个包管理器，让我们看一下Helm如何与依赖项一起工作。 <br><br><h3> 处理依赖项 <br></h3><br> 头盔很难与依赖项一起使用。 首先，有一个require.yaml文件适合我们所依赖的文件。 在处理需求时，他会执行requirements.lock-这是所有依赖项的当前状态（块）。 之后，他将它们下载到名为/ chart的文件夹中。 <br><br> 有一些工具可以管理：谁，如何连接，在哪里连接- <strong>标签和条件</strong> ，用于确定在哪个环境中（取决于哪些外部参数）连接或不连接某些依赖项。 <br><br> 假设您有用于暂存环境的PostgreSQL（或用于生产的RDS，或用于测试的NoSQL）。 通过在Production中安装此软件包，您将不会安装PostgreSQL，因为在那里不需要PostgreSQL-仅使用标签和条件即可。 <br><br> 这里有趣的是什么？ <br><br><ul><li>  Helm混合了所有依赖项和应用程序的所有资源； </li><li> 排序-&gt;安装/更新 </li></ul><br> 在/图表中下载了所有依赖项之后（这些依赖项可能是100），Helm将获取并复制其中的所有资源。 渲染模板后，他将所有资源收集到一个位置，并按照自己的顺序进行排序。 您无法影响此顺序。 您必须自己确定程序包所依赖的内容，并且如果程序包具有传递依赖项，则需要将所有它们都包含在requirements.yaml的描述中。 必须牢记这一点。 <br><br><h3> 包装经理 <br></h3><br>  Helm安装应用程序和依赖项，您可以告诉Helm安装-它将安装软件包。 因此，这是一个程序包管理器。 <br><br> 同时，如果您有一个外部资源库，您可以在其中上传软件包，则可以不以本地文件夹的形式访问它，而可以简单地说：“从该资源库中获取此软件包，并使用相同的参数安装它。” <br><br> 有很多软件包的开放存储库。 例如，您可以运行：helm install -f prod / values.yaml stable / wordpress <br><br> 在稳定的存储库中，您将使用wordpress并自行安装。 您可以做所有事情：搜索/升级/删除。 事实证明，Helm是一名包裹经理。 <br><br> 但是有缺点：必须将所有<strong>传递依赖项</strong>都包含在其中。 当可传递依赖项是独立的应用程序并且您想分别使用它们进行测试和开发时，这是一个大问题。 <br><br> 另一个缺点是<strong>端到端配置</strong> 。 当您拥有数据库并且需要将其名称传输到所有软件包时，可以这样做，但是很难做到。 <br><br><img src="https://habrastorage.org/webt/ws/8m/ox/ws8moxa7dp9ekfc_fcb4mcrytae.png"><br><br> 通常，您已经安装了一个小数据包并且可以正常工作。 世界是复杂的：应用程序取决于应用程序，而应用程序又取决于应用程序-您需要以某种方式对其进行巧妙配置。 赫尔姆不知道该如何支持这个问题，或者不知道有什么大的问题来支持它，有时您必须用手鼓跳舞很多才能使它起作用。 这很糟糕，因此图中的“程序包管理器”以红色突出显示。 <br><br><img src="https://habrastorage.org/webt/c5/rj/sz/c5rjszxy-hf_-pulkkcz_tsaie0.png"><br><br><h3> 组装与包装 <br></h3><br>  Kubernetes中的应用程序“您不能只是获取并运行”。 您需要对其进行组装，即制作一个Docker映像，将其写入Docker注册表等。 虽然整个包装在Helm中的定义是。 我们确定程序包是什么，应该包含哪些功能和字段，签名和身份验证（您公司的安全系统将非常高兴）。 因此，一方面，似乎支持组装和打包，另一方面，未配置使用Docker映像的工作。 <br><br><blockquote>  Helm不允许您在没有Docker映像的情况下运行应用程序。 同时，Helm没有配置用于组装和包装，也就是说，实际上，它不知道如何使用Docker映像。 <br></blockquote><br> 这与为某些小型库进行升级安装而导致的情况相同，您将被发送到一个远程文件夹以运行编译器。 <br><br> 因此，我们说Helm不知道如何处理图像。 <br><img src="https://habrastorage.org/webt/am/li/ia/amliiax7srabjlml74xvn2xtyb8.png"><br><br><h3> 发展历程 <br></h3><br> 下一个头痛是发展。 在开发中，我们希望快速方便地更改我们的代码。 在打孔卡上打孔的时间已经过去，结果是5天后获得的。 每个人都习惯在编辑器中用一个字母替换另一个字母，然后按编译，然后已经修改的程序就可以工作了。 <br><br> 事实证明，更改代码时，还需要执行许多其他操作：准备Docker文件； 运行Docker，以便构建映像； 把它推到某个地方 部署到Kubernetes集群 只有这样，您才能在Production上获得所需的内容，然后可以检查代码。 <br><br> 由于具有<strong>破坏性的更新</strong>头盔升级，仍然带来不便。 您查看了一切工作原理，通过kubectl exec查看了容器内部，一切都很好。 此时，您开始更新，下载新映像，启动新资源，删除旧资源-您需要从头开始。 <br><br> 最大的痛苦是<strong>大形象</strong> 。 大多数公司不使用小型应用程序。 通常，如果不是超级整体，则至少是一个小的整体。 随着时间的流逝，年轮增长，代码库增加，并且应用程序逐渐变得很大。 我曾多次遇到大于2 GB的Docker映像。 现在想象一下，您要在程序中的一个字节中进行更改，然后按一个按钮，然后将生成一个2 GB的Docker映像。 然后按下一步按钮，开始向服务器传输2 GB。 <br><br>  Docker允许您处理层，即 检查是否存在一层或另一层，并发送丢失的一层。 但是世界是如此，以至于大多数情况下它将是一个大层次。 虽然2 GB将用于服务器，而2 GB将用于具有Docker注册表的Kubernetes，但它们将以各种方式推出，直到您终于开始使用，您才能放心地喝茶。 <br><br>  Helm对大型Docker映像不提供任何帮助。 我认为这不应该，但是Helm开发人员比所有用户都了解更多，Steve Jobs对此很微笑。 <br><br><img src="https://habrastorage.org/webt/xk/wk/4z/xkwk4zdrvxa1xpejhdf02ogsdgo.png"><br><br> 发展的障碍也变成了红色。 <br><br><img src="https://habrastorage.org/webt/pu/o2/ha/puo2ha8r-gmi9cqnkr_sfdv_mpq.png"><br><br><h3> 环境自动化 <br></h3><br> 最后一个方向-环境自动化-是一个有趣的领域。 在Docker（和相关模型）（以及相关的Kubernetes）领域问世之前，不可能说：“我想在此服务器或这些服务器上安装我的应用程序，以便有n个副本，50个依赖项，并且它们全部自动运行！” 也许有人会说，这是什么，但不是！ <br><br>  Kubernetes提供了此功能，并且以某种方式使用它是合乎逻辑的，例如说：“我正在这里部署新环境，我希望所有已经准备好应用程序的开发团队只需单击一个按钮，所有这些应用程序都将自动安装在新环境中” 。 从理论上讲，Helm应该对此有所帮助，以便可以从任何地方从外部数据源（S3，GitHub）进行配置。 <br><br> 建议在Helm中有一个特殊的按钮“终于做好我了！”  -它会立即变好。  Kubernetes允许您执行此操作。 <br><br> 这特别方便，因为Kubernetes可以在任何地方运行，并且可以通过API运行。 通过在AWS或Google Cloud Engine中本地启动minikube，您可以立即使用Kubernetes，并在任何地方都可以使用Kubernetes：按下按钮，一切都很好。 <br><br> 似乎Helm自然可以允许您这样做。 因为否则，创建Helm的意义何在？ <br><br> 事实证明，不！ <br><img src="https://habrastorage.org/webt/xs/mf/h5/xsmfh5898yrlawroqge2dn6v_iw.png"><br><br> 没有环境的自动化。 <br><br><h2> 替代品 <br></h2><br> 当Kubernetes有一个每个人都在使用的应用程序（现在实际上是解决方案的第一号），但是Helm遇到了上面讨论的问题时，社区不得不做出回应。 它开始创建替代工具和解决方案。 <br><br><h3> 模板引擎 <br></h3><br> 作为模板引擎，Helm似乎解决了所有问题，但社区仍然在创造替代方案。 让我提醒您模板引擎的问题：冗长和代码重用。 <br><br>  <strong>Ksonnet</strong>是一个很好的代表<strong>。</strong> 它使用根本不同的数据和概念模型，并且不适用于Kubernetes资源，但具有自己的定义： <br>  <em>原型（参数）-&gt;组件-&gt;应用程序-&gt;环境。</em> <em><br></em> <br><br> 有一些部分构成了原型。 通过外部数据对原型进行参数化，然后出现组件。 几个组件组成了可以运行的应用程序。 它在不同的环境中运行。 这里有一些到Kubernetes资源的明确链接，但可能没有直接的类比。 <br><br> 当然，Ksonnet的主要目标是<strong>重用资源</strong> 。 他们希望确保一旦编写了代码，以后就可以在任何地方使用它，从而提高了开发速度。 如果您创建一个大型的外部库，则人们可以不断地将其资源发布到那里，并且整个社区都可以重用它们。 <br><br> 从理论上讲，这很方便。     . <br><br><h3>   <br></h3><br>  ,    —   ,  ,  .  Ksonnet  .  Ksonnet    Helm ,         ,       ..   ,    ,     ,       . <br><img src="https://habrastorage.org/webt/-e/ed/76/-eed76zagrsnj_ydzkcqedelf1g.png"><br><br>    ,   ,  ,    ,   .      .    ,      ,   ,      0.1. ,     . <br><img src="https://habrastorage.org/webt/-c/om/sm/-comsmfipyfxjxvsbit48zbwhoe.png"><br><br> ,   —  <strong>KubePack</strong> ,       . <br><br><h3> 发展历程 <br></h3><br>      : <br><br><ol><li>    Helm; <br></li><li>  Helm; <br></li><li>    ,        ; <br></li><li>   ,   . <br></li></ol><br><h4> 1.   Helm <br></h4><br>   —  <strong>Draft</strong> .   —      ,   ,     . Draft    — Heroku-style: <br><br><ul><li>      (pack); </li><li> , ,  Python «Hello, world!»; </li><li>  ,   Docker- (   ); </li><li>   ,   ,   docker-registry,     ; </li><li>    . </li></ul><br>        ,   ,   . <br><br>          Helm,   Draft  Helm-,        production ready,   ,  Draft   Helm-,  .       . <br><br> ,  Draft           ,      Helm-. Draft —     . <br><br><h4> 2.   Helm <br></h4><br>   Helm Charts      Kubernetes-,       Helm Charts.   : <br><br><ul><li> GitKube; </li><li> Skaffold; </li><li> Forge. </li></ul><br>      Helm,    .  ,   ,     command line interface,  Chart ,     git push   . <br><br>   ,     docker build, docker push  kubectl rollout.   ,     Helm,   .        . <br><br><h4> 3.     <br></h4><br>   —    .    — <strong>Metaparticle</strong> . ,     Python,    Python  ,     . <br><br><blockquote>       ,          ,      ,      sysconfig  ..    . <br></blockquote><br>     ,     ,    ,  -           Kubernetes-. <br><br>    :   ,     ;   ,      ;        .. <br><img src="https://habrastorage.org/webt/wn/vg/4-/wnvg4-72i7bhg5dabn9_1zinijw.png"><br><br>   ,  ,     ,    -  ,   Python-     Kubernetes-.     ? <br><br>     - ,    .    . ,  ,       preinstall ,   -     .      Kubernetes-,       Metaparticle,   . <br><br>     ,    ,   Kubernetes-   .  ,       ,  Metaparticle. <br><br><img src="https://habrastorage.org/webt/l1/py/fi/l1pyfi0l2xjkhgatomlhj6sil3s.png"><br><br>    Metaparticle,      Helm .   ,       . <br><br> <strong>Telepresence/Ksync</strong> —   . ,      ,  Helm-,   .   ,   -  ,       - , ,      . ,     Production-,     Production - . <br><br>  Kubernetes  ,        Docker,  registry,   Kubernetes.          .      ,    . <br><br> , ,       ,    Development     .    :  ,   ,   ,     ,     —   ,   ,   ,   Helm,  ,     . <br><br>   ,    . <br><br><h4> 4.   Kubernetes  Kubernetes <br></h4><br>   ,      Kubernetes  Kubernetes.  ,       Helm-    ,         .          ,      .     ,    Docker-compose . <br><br>    Docker-compose ,       ,    ,    ,       Docker,     Kubernetes,    Docker-compose,   .     ,    .   ,       Docker.     . <br><br>        minikube   ,      Docker-compose,    .  ,   ,  Docker-compose —  10     .         ,   . <br><img src="https://habrastorage.org/webt/m2/h4/tt/m2h4tthsizav7rv4tubxlkfo0qg.png"><br><br>     Docker-compose,    ,         . <br><br><h3>    <br></h3><br> ,    —   Helm, , ,  Helm -  .       CI/CD,   ,   .     —      Helm,     ? ,     ,    . <br><br>     CI/CD,     ,      docker',  set-,         ,    —   . <br><br> CI/CD —       ,     . <br><br><h2> 总结 <br></h2><br><img src="https://habrastorage.org/webt/fy/pc/ba/fypcbahu2fgsz16tn-imk2a5vpy.png"><br><br>  5   Helm   .   ,    .     ,  ,       .     ,          ,  ,   . <br><br><h2>  Helm <br></h2><br> ,       ,   Helm  .   ,  Helm    ,   . ,     ,   ,     Helm. <br><br> ,     Road Map.    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kuberneres Helm  community</a> ,          ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Helm V3</a> . <br><br><h3>   Tiller,  cli <br></h3><br>      ,   .  Helm    : <br><br><ol><li>  ,       (cmd  ..). <br></li><li> Tiller —  ,      Kubernetes. <br></li></ol><br> Tiller  ,     Command Line Interface.    : «     Chart» —   Helm  , ,  Tiller',    : «,  - ! ,      Kubernetes-» —  . <br><br>    Helm,    Tiller       ,    .    ,   ,    ,     ,   Tiller' —   namespace .  Tiller      namespace,    ,       .      ,     . <br><br>    V3 Tiller  . <br><img src="https://habrastorage.org/webt/k2/rs/3d/k2rs3djfuxajcdf1cgr2whzob58.png"><br><br>     ?  ,   ,   Command Line Interface,  ,     Kubernetes. ,   Kubernetes      ,    Tiller.      kubectl cli    . <br><br>  Tiller  <strong> </strong> .    ,     Kubernetes  Command Line Interface  : , , , pre-  post-.    . <br><br><h3> Lua-  Chart <br></h3><br>       ,  — ,       <strong>lua-</strong> .    Chart    lua-,     .       . ,  .   ,   ,    ,      . <br><img src="https://habrastorage.org/webt/cr/ie/h1/crieh1qr2o9qc9oocuti_i9bhhm.png"><br><br> Lua      ,      ,   ,  - ,    ,      . <br><br>  ,   ,   .  ,           .       Kubernetes,    - ,    ,    ,   ,    . 让我们看看会发生什么。 <br><br><h3> Release- + secret   <br></h3><br>  ,     ,  <strong>Release-</strong>    ,  Release  .   ,     Release-,     ,  ,   CRD,  , . <br><br><h3>   namespace  <br></h3><br>  Release-     namespace,     ,   -  <strong>   Tiller'</strong>  namespace —  ,      . <br><br><h3> CRD: controller <br></h3><br>        ,   CRD-controller  Helm   ,       push-.        . <br><br><h2>   <br></h2><br>  ,     . <br><img src="https://habrastorage.org/webt/c-/kk/zv/c-kkzvsvdzuwr3werccbixl1an4.png"><br><br>  ,  <strong>Helm</strong> .   ,      ,     ,     .  ,       ,      .  Helm —  -   Kubernetes.      -  ,  ,  . <br><br>  , <strong>CI/CD</strong> ,    .      <strong>  Slack</strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们有一个bot来报告何时有新版本通过master，并且所有测试均成功。</font><font style="vertical-align: inherit;">您告诉他：“我想在Staging中安装它”，然后他安装，您说：“我想在那里进行测试！” </font><font style="vertical-align: inherit;">-他开始了。</font><font style="vertical-align: inherit;">很舒服 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于开发，请使用</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docker-compose或Telepresence。</font></font></strong> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 一项服务的多个版本 </font></font><br></h2><br><img src="https://habrastorage.org/webt/gg/cq/wv/ggcqwvrbonamtzi4wudhx3t9jly.png"><br><br> 最后，我们将分析存在两个应用程序A和B的情况，这两个应用程序C取决于C，但是C的版本不同。 需要解决这个问题： <br><br><ul><li> 进行开发，因为实际上我们必须开发相同的东西，但是要开发两个不同的版本； </li><li> 释放 </li><li> 对于名称冲突，因为在所有标准软件包管理器中，安装两个不同版本的软件包可能会导致问题。 </li></ul><br> 实际上，Kubernetes可以为我们做出一切决定-您只需要正确使用它即可。 <br><br><img src="https://habrastorage.org/webt/wq/ra/mr/wqramrfg3yh1izbnppjmxeuc9hs.png"><br><br> 我建议您根据Helm创建3个图表，3个存储库（对于C存储库，这将是两个不同的分支）。 最有趣的是，针对v1和v2的所有安装都应在其内部包含有关版本或所创建的服务的信息。 幻灯片的一种解决方案，附录C； 发行名称表示这是服务A的版本v1； 服务名称还包含版本。 这是最简单的示例，您可以完全不同地进行操作。 但是最重​​要的是名称是唯一的。 <br><br> 第二个是传递依赖，在这里它更加复杂。 <br><img src="https://habrastorage.org/webt/pi/5l/ya/pi5lyafuuagwemrrfdhkdb_zby4.png"><br><br> 例如，您正在开发一个服务链，并且想要测试A。为此，您必须将A所依赖的所有依赖项（包括可传递的）传递给包的Helm定义。 但是同时，您也想开发B并对其进行测试-如何做到这一点是不可理解的，因为您还需要将所有可传递依赖项都放入其中。 <br><br> 因此，我建议您不要在每个程序包中添加所有依赖项，而应使其独立并不受外部控制。 这很不方便，但这是两个弊端中的较小者。 <br><br><h2> 有用的链接 <br></h2><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">草稿</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitKube</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">头盔</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ksonnet</a> <br><br>  •电报贴纸： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">二</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Sig-Apps</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">KubePack</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">超微粒</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">脚手架</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">头盔v3</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Docker-compose</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ksync</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">网真</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">无人机</a> <br><br>  • <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">锻造</a> <br><br> 发言人Ivan Glushkov在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a>上的个人资料，在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Twitter上</a> ，在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Habr上</a> 。 <br><br><blockquote> 好消息 <br><br> 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">YouTube频道上，</a>我们<strong>打开了RIT ++艺术节上有关DevOps的所有报告的视频</strong> 。 这是一个单独的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">播放列表</a> ，但是在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">完整的</a>视频<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">列表中，</a>还有来自其他会议的许多有用信息。 <br><br> 更好的是，订阅该频道和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">新闻通讯</a> ，因为在来年<strong>我们将有很多发展空间</strong> ：5月，RIT ++框架； 分别在春季，夏季和秋季（作为HighLoad ++的一部分）和单独的秋季<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DevOpsConf Russia进行</a> 。 <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN431540/">https://habr.com/ru/post/zh-CN431540/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN431530/index.html">公开课“ Android Material Design：更新概述”</a></li>
<li><a href="../zh-CN431532/index.html">忆阻器由2 nm厚的部分组成</a></li>
<li><a href="../zh-CN431534/index.html">开发人员中的问题身份</a></li>
<li><a href="../zh-CN431536/index.html">Ceph。 灾难解剖</a></li>
<li><a href="../zh-CN431538/index.html">病案率和商品与Mobio：所有指标分阶段增加</a></li>
<li><a href="../zh-CN431542/index.html">有效开发和维护Ansible角色</a></li>
<li><a href="../zh-CN431544/index.html">将DevOps带入大众</a></li>
<li><a href="../zh-CN431546/index.html">我们为什么要说好？</a></li>
<li><a href="../zh-CN431548/index.html">Solar Dozor-星星背后是什么？</a></li>
<li><a href="../zh-CN431550/index.html">薄膜注塑（IMD）：工作原理</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>