<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤛 👩‍🚒 🛀🏾 Saga yang diatur atau cara membangun transaksi bisnis dalam layanan dengan database per pola layanan 👨🏽‍⚕️ 🏂🏻 👨‍👩‍👦‍👦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai Nama saya Konstantin Evteev, saya bekerja di Avito sebagai pemimpin unit DBA. Tim kami mengembangkan sistem penyimpanan Avito, membantu dalam pemi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Saga yang diatur atau cara membangun transaksi bisnis dalam layanan dengan database per pola layanan</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/418235/"><p>  Hai  Nama saya Konstantin Evteev, saya bekerja di Avito sebagai pemimpin unit DBA.  Tim kami mengembangkan sistem penyimpanan Avito, membantu dalam pemilihan atau penerbitan basis data dan infrastruktur terkait, mendukung Tujuan Tingkat Layanan untuk server basis data, dan kami juga bertanggung jawab untuk efisiensi dan pemantauan sumber daya, memberi nasihat tentang desain, dan mungkin mengembangkan layanan mikro, terkait dengan sistem penyimpanan, atau layanan untuk pengembangan platform dalam konteks penyimpanan. </p><br><p>  Saya ingin memberi tahu Anda bagaimana kami memecahkan salah satu tantangan arsitektur layanan mikro - melakukan transaksi bisnis dalam infrastruktur layanan yang dibangun menggunakan Basis Data per pola layanan.  Saya membuat presentasi tentang topik ini di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">konferensi Highload ++ Siberia 2018</a> . </p><br><img src="https://habrastorage.org/webt/r3/bz/ty/r3bztya5eso1a_fkh9laghkue9k.png" alt="gambar"><a name="habracut"></a><br><p><br></p><br><h2 id="teoriya-maksimalno-kratko">  Teori  Sesingkat mungkin </h2><br><p>  Saya tidak akan menjelaskan secara rinci teori kisah-kisah.  Saya hanya akan memberi Anda pengantar singkat agar Anda memahami konteksnya. </p><br><p>  Seperti sebelumnya (dari awal Avito hingga 2015 - 2016): kami tinggal di monolith, dengan basis monolitik dan aplikasi monolitik.  Pada titik tertentu, kondisi ini mulai mencegah kami tumbuh.  Di satu sisi, kami mengalami kinerja server dengan database utama, tetapi ini bukan alasan utama, karena masalah kinerja dapat diselesaikan, misalnya menggunakan sharding.  Di sisi lain, monolith memiliki logika yang sangat kompleks, dan pada tahap pertumbuhan tertentu, penyampaian perubahan (rilis) menjadi sangat panjang dan tidak dapat diprediksi: ada banyak dependensi yang tidak jelas dan kompleks (semuanya terhubung erat), juga sulit untuk diuji, secara umum ada banyak masalah.  Solusinya adalah beralih ke arsitektur microservice.  Pada tahap ini, kami memiliki pertanyaan dengan transaksi bisnis yang sangat terkait dengan ACID yang disediakan oleh basis monolitik: tidak jelas bagaimana cara melakukan migrasi logika bisnis ini.  Ketika bekerja dengan Avito, ada banyak skenario berbeda yang diterapkan oleh beberapa layanan, ketika integritas dan konsistensi data sangat penting, misalnya, membeli langganan premium, mendebit uang, menerapkan layanan kepada pengguna, membeli paket VAS - jika terjadi keadaan atau kecelakaan yang tidak terduga, semuanya mungkin tidak berjalan secara tak terduga sesuai rencana.  Kami menemukan solusinya dalam kisah-kisah. </p><br><p>  Saya suka <a href="">deskripsi teknis</a> kisah <a href="">-</a> kisah pada tahun 1987 oleh Kenneth Salem dan Hector Garcia-Molina, salah satu anggota dewan direksi Oracle saat ini.  Bagaimana masalah dirumuskan: ada sejumlah kecil transaksi jangka panjang yang untuk waktu yang lama mencegah pelaksanaan operasi kecil, lebih sedikit sumber daya, dan lebih sering.  Sebagai hasil yang diinginkan, Anda dapat memberikan contoh dari kehidupan: yang pasti, banyak dari Anda mengantri untuk menyalin dokumen, dan operator mesin fotokopi, jika ia memiliki tugas menyalin seluruh buku atau hanya banyak salinan, membuat salinan anggota antrian lain dari waktu ke waktu.  Tetapi membuang sumber daya hanyalah sebagian dari masalah.  Situasi ini diperburuk oleh kunci jangka panjang ketika melakukan tugas-tugas yang intensif sumber daya, kaskade yang akan dibangun di DBMS Anda.  Selain itu, kesalahan dapat terjadi selama transaksi panjang: transaksi tidak akan selesai dan rollback akan dimulai.  Jika transaksi itu panjang, maka rollback juga akan memakan waktu lama, dan mungkin akan ada coba lagi dari aplikasi.  Secara umum, "semuanya cukup menarik."  Solusi yang diusulkan dalam deskripsi teknis SAGAS adalah dengan membagi transaksi panjang menjadi beberapa bagian. </p><br><p>  Sepertinya saya banyak yang mendekati ini tanpa membaca dokumen ini.  Kami telah berulang kali berbicara tentang defproc kami (prosedur ditangguhkan diimplementasikan menggunakan pgq).  Misalnya, ketika memblokir pengguna untuk penipuan, kami dengan cepat melakukan transaksi singkat dan menanggapi klien.  Dalam transaksi singkat ini, termasuk, kami menempatkan tugas dalam antrian transaksional, dan kemudian secara serempak, dalam batch kecil, misalnya, sepuluh iklan memblokir iklannya.  Kami melakukan ini dengan menerapkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">antrian transaksional dari Skype</a> . </p><br><p>  Tetapi kisah kita hari ini sedikit berbeda.  Kita perlu melihat masalah-masalah ini dari sisi lain: menggergaji monolith ke dalam layanan-layanan mikro yang dibangun menggunakan basis data per pola layanan. </p><br><p>  Salah satu parameter terpenting bagi kami adalah mencapai kecepatan potong maksimum.  Oleh karena itu, kami memutuskan untuk mentransfer fungsionalitas lama dan semua logikanya ke microservices, tanpa mengubah apa pun.  Persyaratan tambahan yang harus kami penuhi: </p><br><blockquote><ul><li>  Berikan perubahan data dependen untuk data penting bisnis </li><li>  dapat mengatur pesanan yang ketat; </li><li>  mengamati konsistensi seratus persen - mengoordinasikan data bahkan dalam kasus kecelakaan; </li><li>  menjamin operasi transaksi di semua tingkatan. </li></ul><br></blockquote><p>  Di bawah persyaratan di atas, solusi dalam bentuk saga orkestrasi paling cocok. </p><br><h2 id="realizaciya-orkestriruemoy-sagi-v-vide-servisa-pg-saga">  Implementasi saga yang diatur sebagai layanan PG Saga </h2><br><p>  Seperti inilah layanan PG Saga. </p><br><p><img src="https://habrastorage.org/webt/mi/zm/0f/mizm0fidaxgpcv3wxoway4ksgoe.jpeg" alt="gambar"></p><br><p>  PG dalam namanya, karena PostgreSQL sinkron digunakan sebagai repositori layanan.  Apa lagi yang ada di dalam: </p><br><ul><li>  API </li><li>  pelaksana; </li><li>  pemeriksa; </li><li>  pemeriksa kesehatan; </li><li>  kompensator. </li></ul><br><p>  Diagram juga menunjukkan pemilik layanan dari kisah-kisah, dan di bawah ini adalah layanan yang akan melakukan langkah-langkah kisah tersebut.  Mereka mungkin memiliki repositori yang berbeda. </p><br><h4 id="kak-eto-rabotaet">  Bagaimana cara kerjanya </h4><br><p>  Pertimbangkan contoh membeli paket VAS.  VAS (Layanan yang ditambahkan nilai) - layanan berbayar untuk promosi iklan. </p><br><p>  Pertama, pemilik layanan saga harus mendaftarkan pembuatan saga di layanan saga </p><br><p><img src="https://habrastorage.org/webt/6d/yo/zs/6dyozsxy0_qfoqmrtlrbijfaxeu.jpeg" alt="gambar"></p><br><p>  Setelah itu, ia menghasilkan kelas saga yang sudah dengan Payload. </p><br><p><img src="https://habrastorage.org/webt/ul/hr/ic/ulhric8ofs455lgaz4mozdhs2l8.jpeg" alt="gambar"></p><br><p>  Selanjutnya, sudah dalam layanan sag, pelaksana mengambil panggilan saga yang sebelumnya dibuat dari toko dan mulai mengeksekusi dalam langkah-langkah.  Langkah pertama dalam kasus kami adalah membeli langganan premium.  Pada saat ini, uang dicadangkan dalam layanan penagihan. </p><br><p><img src="https://habrastorage.org/webt/hf/re/yi/hfreyiq0vpgiojytn2gts5ws1ww.jpeg" alt="gambar"></p><br><p>  Kemudian dalam layanan pengguna operasi VAS diterapkan. </p><br><p><img src="https://habrastorage.org/webt/cy/lg/_m/cylg_mbibq4b6wfqvu_wz7ylcre.jpeg" alt="gambar"></p><br><p>  Kemudian layanan VAS sudah ada, dan paket Anda dibuat.  Langkah-langkah lain mungkin lebih jauh, tetapi itu tidak begitu penting bagi kita. </p><br><p><img src="https://habrastorage.org/webt/h6/3r/r8/h63rr8iufd3m4tzovgonjywezhu.jpeg" alt="gambar"></p><br><h2 id="avarii">  Kecelakaan </h2><br><p>  Kecelakaan dapat terjadi dalam layanan apa pun, tetapi ada trik terkenal tentang cara mempersiapkannya.  Dalam sistem terdistribusi, penting untuk mengetahui teknik ini.  Sebagai contoh, salah satu batasan terpenting adalah bahwa jaringan tidak selalu dapat diandalkan.  Pendekatan yang akan menyelesaikan masalah interaksi dalam sistem terdistribusi: </p><br><blockquote><ol><li>  Kami coba lagi. </li><li>  Kami menandai setiap operasi dengan kunci idempoten.  Ini diperlukan untuk menghindari duplikasi operasi.  Lebih lanjut tentang kunci idempoten dapat ditemukan di artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini</a> . </li><li>  Kami mengkompensasi transaksi - karakteristik aksi dari kisah-kisah. </li></ol><br></blockquote><br><h4 id="kompensaciya-tranzakciy-kak-eto-rabotaet">  Kompensasi Transaksi: Cara Kerjanya </h4><br><p>  Untuk setiap transaksi positif, kita harus menggambarkan tindakan sebaliknya: skenario bisnis dari langkah jika terjadi kesalahan. </p><br><p>  Dalam implementasi kami, kami menawarkan skenario kompensasi berikut: </p><br><p>  Jika beberapa langkah dari saga itu tidak berhasil, dan kami melakukan banyak percobaan ulang, maka ada kemungkinan bahwa pengulangan terakhir dari operasi itu berhasil, tetapi kami hanya tidak mendapatkan jawaban.  Kami akan mencoba untuk mengkompensasi transaksi, meskipun langkah ini tidak diperlukan jika pelaksana layanan dari langkah masalah benar-benar rusak dan benar-benar tidak dapat diakses. </p><br><p>  Dalam contoh kita, akan terlihat seperti ini: </p><br><ol><li>  Matikan paket VAS. </li></ol><br><p><img src="https://habrastorage.org/webt/rf/6s/94/rf6s943lzidqq_hfyuu-_fnbd_a.jpeg" alt="gambar"></p><br><ol><li>  Batalkan operasi pengguna. </li></ol><br><p><img src="https://habrastorage.org/webt/qv/wl/tx/qvwltxbftjc_diwxtudv5ym0mde.jpeg" alt="gambar"></p><br><ol><li>  Kami membatalkan reservasi dana. </li></ol><br><p><img src="https://habrastorage.org/webt/0b/_r/t9/0b_rt9gobty3zu1xhz6uqjo2cf8.jpeg" alt="gambar"></p><br><h4 id="chto-delat-esli-i-kompensaciya-ne-rabotaet">  Apa yang harus dilakukan jika kompensasi tidak berhasil </h4><br><p>  Jelas, kita harus menindaklanjuti skenario yang sama.  Sekali lagi, terapkan coba lagi, kunci idempoten untuk mengkompensasi transaksi, tetapi jika tidak ada yang keluar saat ini, misalnya, layanan tidak tersedia, Anda perlu menghubungi pemilik layanan saga, memberi tahu Anda bahwa saga telah gagal.  Selanjutnya, tindakan yang lebih serius: meningkatkan masalah, misalnya, untuk uji coba manual atau meluncurkan otomatisasi untuk menyelesaikan masalah tersebut. </p><br><p>  Yang lebih penting: bayangkan bahwa beberapa langkah layanan saga tidak tersedia.  Tentunya pemrakarsa tindakan ini akan mencoba lagi.  Dan pada akhirnya, layanan kisah Anda mengambil langkah pertama, langkah kedua, dan pelaksananya tidak tersedia, Anda membatalkan langkah kedua, membatalkan langkah pertama, dan mungkin juga ada anomali terkait dengan kurangnya isolasi.  Secara umum, layanan saga dalam situasi ini terlibat dalam pekerjaan yang tidak berguna, yang masih menghasilkan beban dan kesalahan. </p><br><p>  Bagaimana cara melakukannya?  Healthchecker harus mewawancarai layanan yang menyelesaikan langkah-langkah melorot dan melihat apakah mereka berfungsi.  Jika layanan menjadi tidak tersedia, maka ada dua cara: untuk mengimbangi kisah-kisah yang sedang beroperasi, dan untuk mencegah kisah-kisah baru dari membuat instance baru (panggilan), atau untuk membuat tanpa membawa mereka untuk bekerja sebagai pelaksana, sehingga layanan tidak tindakan yang tidak perlu. </p><br><h4 id="esche-odin-scenariy-s-avariey">  Skenario kecelakaan lain </h4><br><p>  Bayangkan kita melakukan langganan premium yang sama lagi. </p><br><ol><li>  Kami membeli paket VAS dan memesan uang. </li></ol><br><p><img src="https://habrastorage.org/webt/tn/ms/7p/tnms7pcslyj_8f4hftsqtzzlspm.jpeg" alt="gambar"></p><br><ol><li>  Kami menerapkan layanan kepada pengguna. </li></ol><br><p><img src="https://habrastorage.org/webt/by/ep/fe/byepfee_drperqqj2on1hg3gq-a.jpeg" alt="gambar"></p><br><ol><li>  Kami membuat paket VAS. </li></ol><br><p><img src="https://habrastorage.org/webt/yq/l_/sf/yql_sf9gnlyolfstvyug4gwaday.jpeg" alt="gambar"></p><br><p>  Sepertinya bagus.  Tapi tiba-tiba, ketika transaksi selesai, ternyata replikasi asinkron digunakan dalam layanan pengguna dan kecelakaan telah terjadi pada basis master.  Mungkin ada beberapa alasan untuk lagging replika: beban tertentu pada replika yang memperlambat kecepatan pemutaran replikasi atau memblokir pemutaran replikasi.  Selain itu, sumber (master) dapat kelebihan beban, dan kelambatan pengiriman perubahan muncul di sisi sumber.  Secara umum, untuk beberapa alasan, replika itu tertinggal, dan perubahan langkah yang berhasil diselesaikan setelah kecelakaan tiba-tiba menghilang (hasil / keadaan). </p><br><p><img src="https://habrastorage.org/webt/hu/nh/hu/hunhhuizvvxmajf0hukmvbhzpnu.jpeg" alt="gambar"></p><br><p>  Untuk melakukan ini, kami menerapkan komponen lain dalam sistem - kami menggunakan pemeriksa.  Pemeriksa memeriksa semua langkah kisah sukses melalui waktu yang diketahui lebih besar dari semua kelambatan yang mungkin (misalnya, setelah 12 jam), dan memeriksa apakah semuanya masih berhasil diselesaikan.  Jika langkah itu tiba-tiba gagal, kisahnya kembali. </p><br><p><img src="https://habrastorage.org/webt/kn/9n/cy/kn9ncyccg350yxl-orc9jamngbm.jpeg" alt="gambar"></p><br><p><img src="https://habrastorage.org/webt/hz/af/-m/hzaf-mwke2a8cvi8mdlb_uzquxy.jpeg" alt="gambar"></p><br><p><img src="https://habrastorage.org/webt/jg/ex/dc/jgexdcrgimsuugdqw27gay_i2kw.jpeg" alt="gambar"></p><br><p><img src="https://habrastorage.org/webt/xp/hv/mo/xphvmouowjv2tgln0-o1mf43rts.jpeg" alt="gambar"></p><br><p>  Mungkin juga ada situasi di mana setelah 12 jam sudah tidak ada yang dibatalkan - semuanya berubah dan bergerak.  Dalam hal ini, alih-alih skenario pembatalan, solusinya mungkin dengan memberi sinyal layanan pemilik saga bahwa operasi ini belum selesai.  Jika operasi pembatalan tidak memungkinkan, katakanlah, Anda perlu melakukan pembatalan setelah menagih pengguna, dan saldonya sudah nol, dan uang tidak dapat didebit.  Kami memiliki skenario seperti itu selalu dipecahkan ke arah pengguna.  Anda mungkin memiliki prinsip yang berbeda, ini konsisten dengan perwakilan produk. </p><br><p>  Akibatnya, seperti yang mungkin Anda perhatikan, di tempat yang berbeda untuk integrasi dengan layanan sag Anda perlu menerapkan banyak logika yang berbeda.  Oleh karena itu, ketika tim klien ingin membuat hikayat, mereka akan memiliki serangkaian tugas yang sangat tidak jelas.  Pertama-tama, kami membuat saga sehingga duplikasi tidak berhasil, untuk ini kami bekerja dengan beberapa operasi idempoten untuk membuat saga dan pelacakannya.  Juga, dalam layanan, diwajibkan untuk menyadari kemampuan untuk melacak setiap langkah dari setiap kisah, agar tidak melakukan dua kali di satu sisi, dan, di sisi lain, untuk dapat menjawab apakah itu benar-benar selesai.  Dan semua mekanisme ini perlu dilayani entah bagaimana sehingga repositori layanan tidak meluap.  Selain itu, ada banyak bahasa tempat layanan dapat ditulis, dan banyak pilihan repositori.  Pada setiap tahap, Anda perlu memahami teori dan menerapkan semua logika ini di bagian yang berbeda.  Jika tidak, Anda bisa membuat banyak kesalahan. </p><br><p>  Ada banyak cara yang benar, tetapi ada situasi yang tidak kalah ketika Anda dapat "menembak diri sendiri".  Agar kisah-kisah itu bekerja dengan benar, Anda perlu merangkum semua mekanisme di atas di pustaka klien yang secara transparan akan mengimplementasikannya untuk klien Anda. </p><br><h4 id="primer-logiki-generacii-sagi-kotoruyu-mozhno-skryt-v-klientskoy-biblioteke">  Contoh logika generasi saga yang bisa disembunyikan di perpustakaan klien </h4><br><p>  Ini dapat dilakukan secara berbeda, tetapi saya mengusulkan pendekatan berikut. </p><br><ol><li>  Kami mendapatkan ID permintaan yang dengannya kami harus membuat saga. </li><li>  Kami pergi ke layanan melorot, mendapatkan pengenal unik, menyimpannya di penyimpanan lokal bersama dengan ID permintaan dari titik 1. </li><li>  Jalankan saga dengan payload dalam layanan sag.  Nuansa penting: Saya mengusulkan operasi layanan lokal yang menciptakan hikayat, untuk mendesain, sebagai langkah pertama hikayat. </li><li>  Ada perlombaan tertentu ketika layanan saga dapat melakukan langkah ini (poin 3), dan backend kami, yang memulai penciptaan saga, juga akan melakukan itu.  Untuk melakukan ini, kami melakukan operasi idempoten di mana-mana: satu orang melakukan itu, dan panggilan kedua hanya menerima "OK". </li><li>  Kami memanggil langkah pertama (poin 4) dan hanya setelah itu kami merespons klien yang memulai tindakan ini. </li></ol><br><p>  Dalam contoh ini, kami bekerja dengan saga sebagai database.  Anda dapat mengirim permintaan, dan kemudian koneksi dapat terputus, tetapi tindakan akan dilakukan.  Ini tentang pendekatan yang sama. </p><br><h2 id="kak-eto-vse-proverit">  Bagaimana cara mengecek semuanya </h2><br><p>  Penting untuk mencakup seluruh layanan tes sag.  Kemungkinan besar, Anda akan membuat perubahan, dan tes yang ditulis di awal akan membantu untuk menghindari kejutan yang tidak terduga.  Selain itu, perlu untuk memeriksa kisah-kisah itu sendiri.  Sebagai contoh, bagaimana kita mengatur pengujian layanan sag dan menguji urutan sag dalam satu transaksi.  Ada beberapa blok uji yang berbeda.  Jika kita berbicara tentang layanan jeblok, dia tahu bagaimana melakukan transaksi positif dan kompensasi, jika kompensasi tidak bekerja, dia memberi tahu pemilik jebol layanan.  Kami menulis tes secara umum untuk bekerja dengan kisah abstrak. </p><br><p>  Di sisi lain, transaksi positif dan transaksi kompensasi pada layanan yang melakukan langkah sag adalah API sederhana, dan pengujian bagian ini menjadi tanggung jawab tim yang memiliki layanan ini. </p><br><p>  Dan kemudian tim pemilik saga menulis tes end-to-end, di mana ia memeriksa bahwa semua logika bisnis berfungsi dengan benar ketika kisah tersebut dieksekusi.  Tes end-to-end berjalan pada lingkungan dev penuh, semua instance layanan dinaikkan, termasuk layanan sag, dan skenario bisnis sudah diuji di sana. </p><br><p><img src="https://habrastorage.org/webt/qb/j0/gn/qbj0gnyhcjvk2lz4djeip_qfaqe.png" alt="gambar" width="340" height="233" align="right"><br>  <strong>Total:</strong> </p><br><ul><li>  tulis lebih banyak unit test; </li><li>  tulis tes integrasi; </li><li>  tulis tes ujung ke ujung. <br><br clear="right">  Langkah selanjutnya adalah CDC.  Arsitektur microservice memengaruhi spesifikasi tes.  Di Avito, kami mengambil pendekatan berikut untuk menguji arsitektur layanan-mikro: Kontrak yang Didorong Konsumen.  Pendekatan ini membantu, pertama-tama, untuk menyoroti masalah yang dapat diidentifikasi dalam tes end-to-end, tetapi tes end-to-end "sangat mahal". </li></ul><br><p>  Apa esensi dari CDC?  Ada layanan yang menyediakan kontrak.  Dia memiliki API - ini adalah penyedia.  Dan ada layanan lain yang memanggil API, yaitu menggunakan kontrak - konsumen. </p><br><p>  Layanan konsumen menulis tes untuk kontrak penyedia, dan tes yang hanya akan diperiksa oleh kontrak bukanlah tes fungsional.  Penting bagi kami untuk memastikan bahwa ketika mengubah API, langkah-langkah dalam konteks ini tidak akan rusak.  Setelah kami menulis tes, elemen lain dari broker layanan muncul - informasi tentang tes CDC dicatat di dalamnya.  Setiap kali layanan penyedia diubah, itu akan meningkatkan lingkungan yang terisolasi dan menjalankan tes yang ditulis konsumen.  Apa intinya: tim yang menghasilkan kisah menulis tes untuk semua langkah dari saga dan mendaftarkannya. </p><br><p><img src="https://habrastorage.org/webt/n1/i-/hm/n1i-hmjmyxs9iavcoxzoem2mcly.jpeg" alt="gambar"><br>  Tentang bagaimana Avito menerapkan pendekatan CDC untuk menguji layanan microser, Frol Kryuchkov berbicara di RIT ++.  Abstrak dapat ditemukan di situs web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Backend.conf</a> - Saya sarankan Anda membiasakan diri. </p><br><h2 id="vidy-sag">  Jenis-jenis Sagas </h2><br><h4 id="po-poryadku-vyzova-funkciy">  Dalam urutan panggilan fungsi </h4><br><p>  a) tidak teratur - fungsi hikayat dipanggil dalam urutan apa pun dan jangan menunggu satu sama lain selesai; <br>  b) dipesan - fungsi-fungsi saga dipanggil dalam urutan yang diberikan, satu demi satu, berikutnya tidak dipanggil sampai sebelumnya selesai; <br>  c) campur - untuk sebagian fungsi urutan diatur, tetapi untuk bagian tidak, tetapi diatur sebelum atau setelah tahap apa untuk melaksanakannya. </p><br><p>  Pertimbangkan skenario tertentu.  Dalam skenario yang sama membeli langganan premium, langkah pertama adalah memesan uang.  Sekarang kita dapat membuat perubahan pada pengguna dan membuat paket premium secara paralel, dan kami akan memberi tahu pengguna hanya ketika kedua langkah ini selesai. <br><img src="https://habrastorage.org/webt/d8/a0/r7/d8a0r7wv7mq1a8gdphaq0aug1oe.png" alt="gambar"></p><br><h4 id="po-polucheniyu-rezultata-vyzova-funkciy">  Dengan mendapatkan hasil dari pemanggilan fungsi </h4><br><p>  a) sinkron - hasil fungsi diketahui segera; <br>  b) asinkron - fungsi mengembalikan "OK" dengan segera, dan hasilnya dikembalikan kemudian, melalui panggilan balik ke API layanan sag dari layanan klien. </p><br><p>  Saya ingin memperingatkan Anda tentang kesalahan: lebih baik tidak melakukan langkah-langkah sinkron dari kisah-kisah, terutama ketika menerapkan hikayat yang diatur.  Jika Anda melakukan langkah sag sinkron, layanan sag akan menunggu langkah ini selesai.  Ini adalah beban tambahan, masalah ekstra dalam pelayanan kisah-kisah, karena itu adalah satu, dan ada banyak peserta dalam kisah-kisah. </p><br><h2 id="masshtabirovanie-sag">  Penskalaan sag </h2><br><p>  Penskalaan tergantung pada ukuran sistem yang Anda rencanakan.  Pertimbangkan opsi dengan instance penyimpanan tunggal: </p><br><blockquote><ul><li>  one saga step handler, proseskan langkah-langkah dengan batch; </li><li>  Di penangan, kami menerapkan "sisir" - kami mengambil langkah-langkah untuk sisa divisi: ketika setiap pelaksana mendapatkan langkahnya sendiri. </li><li>  n penangan dan lompat terkunci - akan menjadi lebih efisien dan lebih fleksibel. </li></ul><br></blockquote><p>  Dan hanya kemudian, jika Anda tahu sebelumnya bahwa Anda akan mengalami kinerja satu server dalam DBMS, Anda perlu melakukan sharding - contoh database yang akan bekerja dengan kumpulan data mereka.  Sharding dapat disembunyikan di balik API layanan sag. </p><br><h4 id="bolshe-gibkosti">  Lebih banyak fleksibilitas </h4><br><p>  Selain itu, dalam pola ini, setidaknya secara teori, layanan klien (melakukan langkah saga) dapat mengakses dan masuk ke layanan pelemahan, dan partisipasi dalam kisah dapat opsional juga.  Mungkin juga ada skenario lain: jika Anda sudah mengirim email, tidak mungkin untuk mengkompensasi tindakan - Anda tidak dapat mengembalikan surat itu kembali.  Tetapi Anda dapat mengirim surat baru bahwa yang sebelumnya salah, dan sepertinya begitu-begitu.  Lebih baik menggunakan skenario di mana saga akan dimainkan hanya maju, tanpa kompensasi apa pun.  Jika tidak bermain maju, maka perlu untuk menginformasikan layanan pemilik saga tentang masalah tersebut. </p><br><h4 id="kogda-nuzhen-lok">  Kapan Anda membutuhkan kunci? </h4><br><p>  Sebuah penyimpangan kecil tentang kisah-kisah pada umumnya: jika Anda dapat membuat logika Anda tanpa saga, maka lakukanlah.  Sagas itu sulit.  Dengan kunci, ini hampir sama: lebih baik untuk selalu menghindari kunci. </p><br><p>  Ketika saya datang ke tim penagihan untuk berbicara tentang kisah-kisah, mereka berkata bahwa mereka membutuhkan kunci.  Saya berhasil menjelaskan kepada mereka mengapa lebih baik melakukannya tanpanya dan bagaimana melakukannya.  Tetapi jika Anda masih membutuhkan kunci, maka ini harus diramalkan sebelumnya.  Sebelum layanan pelemahan, kami telah menerapkan kunci dalam kerangka kerja satu DBMS.  Contoh dengan defproc dan skrip untuk memblokir iklan secara tidak sinkron dan memblokir akun secara sinkron, ketika kami pertama kali melakukan bagian dari operasi secara sinkron dan mengatur kunci, dan kemudian kami menyelesaikan sisa pekerjaan dengan batch secara tidak sinkron. </p><br><p>  Bagaimana cara melakukannya?         ,       ,    ,           , ,  -      ,  .          .   .    :       ,       ,            . </p><br><p>   -,  ,    .   ,      ,    .   , ,    .        .       —    ,     ,        . </p><br><h2 id="acid--bez-izolyacii"> ACID —   </h2><br><p>    ,     ,  .            .   —       durability.    .         .  ,     .   - ,  -  - ,          </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mo stretchy=&quot;false&quot;>(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy=&quot;false&quot;>)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="58.618ex" height="2.66ex" viewBox="0 -832 25238.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="8396" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-61" x="9209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6E" x="9738" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="10339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-61" x="10808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-63" x="11338" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="11771" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="12133" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6F" x="12478" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6E" x="12964" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-77" x="13564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="14732" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="15078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="15439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="15906" y="0"></use><g transform="translate(16653,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-54" x="18488" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6A" x="19192" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-28" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6F" x="19994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="20480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-43" x="20931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="21692" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-29" x="22037" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-77" x="22427" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="23143" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="23595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="23940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="24302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="24768" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>T</mi><mi>j</mi><mo stretchy="false">(</mo><mi>o</mi><mi>r</mi><mi>C</mi><mi>i</mi><mo stretchy="false">)</mo><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">Ti reads => other rtransaction writes => Tj (or Ci) writes</script></p><br><p>   <strong></strong>  —      - ,  - , , -    ,      .    , - ,  -   . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.989ex" height="2.057ex" viewBox="0 -780.1 21953.6 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-77" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="1766" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="2218" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="2563" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="2925" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="3391" y="0"></use><g transform="translate(4138,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6F" x="5973" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="6459" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-68" x="6820" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="7397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="7863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="8676" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-61" x="9128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6E" x="9657" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="10258" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-61" x="10727" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-63" x="11257" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="11690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="12052" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6F" x="12397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6E" x="12883" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="13483" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="13935" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-61" x="14401" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-64" x="14931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-43" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="18797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-77" x="19142" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="19859" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="20310" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="20656" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="21017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="21484" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>C</mi><mi>i</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-2">Ti writes => other transaction reads => Ci writes</script></p><br><p>  <strong></strong>  —               . </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&amp;gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.154ex" height="2.419ex" viewBox="0 -780.1 21594.1 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="704" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="1050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="1501" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-61" x="1968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-64" x="2497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="3021" y="0"></use><g transform="translate(3768,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6F" x="5603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="6088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-68" x="6450" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="7026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="7493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="7944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="8306" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-61" x="8757" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6E" x="9287" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="9887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-61" x="10357" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-63" x="10886" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="11320" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="11681" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6F" x="12027" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6E" x="12512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-77" x="13113" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="13829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-69" x="14281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-74" x="14626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="14988" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="15454" y="0"></use><g transform="translate(16201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-54" x="18036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-6A" x="18741" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-72" x="19153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-65" x="19605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-61" x="20071" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-64" x="20601" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/oleg-bunin/blog/418235/&amp;usg=ALkJrhgopIoAIHk9g-IfwCKLBKODa7-7VA#MJMATHI-73" x="21124" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi><mo>=&gt;</mo><mi>o</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>w</mi><mi>r</mi><mi>i</mi><mi>t</mi><mi>e</mi><mi>s</mi><mo>=&gt;</mo><mi>T</mi><mi>j</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">Ti reads =>other transaction writes =>Tj reads</script></p><br><p>   : </p><br><blockquote><ol><li>    ,   , ,  ,      . </li><li> ,        .     ,    ,  ,  ,        ,     . </li><li>           . </li><li>   payload        .    eventual consistency —       ,  ,      ,     .     ,  , ,       -. </li></ol><br></blockquote><br><h2 id="monitoring">  Pemantauan </h2><br><p>             .    ,            .           .       checker.           .   ,   . </p><br><p><img src="https://habrastorage.org/webt/vm/gv/_w/vmgv_wl16ngyd78b78ndyp4v1_4.png" alt="gambar"></p><br><p><img src="https://habrastorage.org/webt/fv/cz/2l/fvcz2luhdac4ixpzmlbbarex_se.png" alt="gambar"></p><br><p>       (50%, 75%, 95%, 99%),        ,  -   . </p><br><p>    ,    —    ,         .         .     ,  -   .  ,       —           . </p><br><p>   .  ,  -   (   )   .    healthchecker   endpoint' info (keep-alive)  . </p><br><p>    .      -.  -,   -  ,           -  .       ,    ,    ,    end-to-end.      - . ,    ,      —    . <br>      .           . </p><br><h2 id="na-chto-stoit-obratit-vnimanie">     : </h2><br><h4 id="izbegat-parazitnyh-nagruzok">    </h4><br><p>    ,    healthchecker,   -    ,     .     ,   .       . </p><br><h4 id="izbegat-slozhnoy-logiki-izbytochnoy-funkcionalnosti-v-servise-sag">         </h4><br><p>       ,        .   ,     ,      .         .  choreography     —       -   .   ,       choreography- ,      .    choreography  ,    .     ,           . ,      ,       ,      . </p><br><h4 id="integrirovatsya-s-klientami">    </h4><br><p>        .     ,      ,         . ,        +               . </p><br><h4 id="versionnost-api">  API </h4><br><p>   ,   -     -  (  API ),    ,      API.                 API   .     —         .           API  ,    ,   100%       . </p><br><p>   ,     ,     ,     ,     .    —    ,    ,    .        . </p><br><h4 id="kompensaciya-pri-avariyah">    </h4><br><p>    ,    ,    ,          .        ( )         . </p><br><h4 id="otsutstvie-izolyacii">   </h4><br><p>     ,            ,  ,      ,        . </p><br><h4 id="blokirovki">  </h4><br><p>   .  ,     ,    . </p><br><h4 id="treysing-po-saga-call-id">   saga call ID </h4><br><p>         .  API   ,          . </p><br><h2 id="itog--chto-vybirat">  —   </h2><br><p> -      legacy .         ,      (       «»                ).    « »?    -  ,     ,    ,   ,    - ,          .     ,  ,           ,         .    ,    « »,     ,         -.  .  —     .  ,          . </p><br><p>      ,     ,        .  ,  ,      ,   ,      . ,  ,      .       . </p><br><p>            ,   .   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id418235/">https://habr.com/ru/post/id418235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id418223/index.html">Kursus MIT "Keamanan Sistem Komputer". Kuliah 7: Kotak Pasir Klien Asli, Bagian 1</a></li>
<li><a href="../id418225/index.html">Kursus MIT "Keamanan Sistem Komputer". Kuliah 7: Native Client Sandbox Bagian 2</a></li>
<li><a href="../id418227/index.html">Kursus MIT "Keamanan Sistem Komputer". Kuliah 7: Kotak Native Client, Bagian 3</a></li>
<li><a href="../id418229/index.html">Kursus MIT "Keamanan Sistem Komputer". Kuliah 8: Model Keamanan Jaringan, Bagian 1</a></li>
<li><a href="../id418233/index.html">BMW mnemonics untuk menemukan nilai batas</a></li>
<li><a href="../id418237/index.html">Mengembangkan Aplikasi Multi-Penyewa pada Platform SAP Cloud di Neo, Bagian 2: Otorisasi dan Otentikasi</a></li>
<li><a href="../id418239/index.html">48 megapiksel untuk smartphone</a></li>
<li><a href="../id418241/index.html">Mengapa Gauss? (100 cara untuk menyelesaikan sistem persamaan)</a></li>
<li><a href="../id418243/index.html">Sejarah astronomi yang populer salah</a></li>
<li><a href="../id418245/index.html">Bagaimana tidak mengembangkan proyek di Bitrix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>