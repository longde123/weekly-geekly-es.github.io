<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçé ‚ôâÔ∏è üëâüèª √âtendre la fonctionnalit√© WDS: ajouter une capacit√© de t√©l√©chargement √† UEFI üìÑ üë®üèª‚Äç‚öñÔ∏è üë©üèª‚Äçü§ù‚Äçüë®üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! 


 Cet article d√©crit les √©tapes que vous devez suivre pour ajouter des options de d√©marrage UEFI √† votre WDS. 


 C'est-√†-dire les i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√âtendre la fonctionnalit√© WDS: ajouter une capacit√© de t√©l√©chargement √† UEFI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448476/"><p>  Bonjour √† tous! </p><br><p>  Cet article d√©crit les √©tapes que vous devez suivre pour ajouter des options de d√©marrage UEFI √† votre WDS. </p><br><p>  C'est-√†-dire  les instructions de cet article supposent que vous avez d√©j√† quelque chose comme la configuration suivante: </p><br><pre><code class="plaintext hljs">1. Windows Server 2012R2 ( ) 2.   DHCP    WDS 3.   WDS 4. IIS 5.      Ubuntu</code> </pre> <br><p>  De plus, voici les actions qui ne m'ont pas apport√© le bon r√©sultat. <br>  <em>Je les ai d√©crits, pour faciliter la recherche et gagner du temps.</em> </p><br><h2 id="predislovie">  Pr√©face </h2><br><p>  Fait en quelque sorte au travail WDS avec beaucoup de goodies, parce que  fatigu√© de courir constamment avec un tas de lecteurs flash et de les √©craser. </p><br><p>  Soit dit en passant, ces articles m'ont aid√© en passant: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ajouter la polyvalence WDS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Menu de d√©marrage PXE avec System Center Configuration Manager</a> </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">√áa ressemble √† √ßa</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ux/kh/ku/uxkhkuhqfxpjw4hmhdhcshmrmzw.png"></p></div></div><br><p>  Et tout allait bien, de nouvelles images ont √©t√© ajout√©es pour le chargement, l'image winPE √©tait envahie de nouvelles fonctionnalit√©s et tout fonctionnait. </p><br><p>  Mais, en aucun cas, tous les p√©riph√©riques ne prennent en charge le mode de d√©marrage BIOS / Legacy, ou s'ils le prennent en charge, son inclusion peut √™tre situ√©e √† un endroit tr√®s peu √©vident. </p><br><p>  Et l'installation de fen√™tres en mode h√©rit√©, quand il est possible d'installer dans UEFI, n'est pas cool. </p><br><p>  √Ä la fin, j'ai d√©cid√© d'ajouter la possibilit√© de t√©l√©charger sur UEFI, et je suis all√© sur Google. </p><br><p>  Mais je n'ai toujours pas trouv√© d'informations structur√©es sur la fa√ßon d'obtenir un WDS + UEFI fonctionnel. <br>  En fait, c'est pourquoi j'ai d√©cid√© d'√©crire cet article. </p><br><p>  Avant de commencer, je d√©crirai le probl√®me qui a pris le plus de temps. </p><br><div class="spoiler">  <b class="spoiler_title">Lors de l'ajout d'UEFI √† WDS, la situation suivante, plut√¥t pas √©vidente, est possible:</b> <div class="spoiler_text"><p>  Si vous ajoutez un fichier de d√©marrage √† WDS et lorsque vous essayez de d√©marrer sur l'appareil <br>  dans UEFI, vous voyez le texte suivant: <br> <code>The selected boot device failed. Press &lt;Enter&gt; to Continue.</code> <br>  Ou <code>Boot Device Not Found</code> <br>  Mais le chargement dans l'h√©ritage fonctionne pour vous. <br>  Ensuite, l'une des options possibles est l'absence du fichier <strong>wdsmgfw.efi</strong> , <br>  chemin suivant: <code>%WDSpath%\Boot\x64\wdsmgfw.efi</code> </p><br><p>  Vous pouvez le prendre ici: <code>C:\Windows\System32\RemInst\boot\x64\wdsmgfw.efi</code> <br>  Ou, si pour une raison quelconque vous n'avez pas ce fichier, je l'ai post√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">google</a> . <br>  Pour cette d√©cision, merci aux gars du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">reddit</a> . </p><br><p>  Avec ce probl√®me, j'ai tu√© le plus de temps depuis  Je pensais que le probl√®me √©tait quelque part dans la configuration WDS ou DHCP. </p><br><p>  Strat√©gies configur√©es en ajoutant des classes de fournisseurs pour diverses architectures et en configurant les options DHCP 060, 066, 067. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Instructions</a> pour configurer les strat√©gies DHCP. </p><br><div class="spoiler">  <b class="spoiler_title">Architectures ASCII pour configurer DHCP</b> <div class="spoiler_text"><p>  PXEClient: Arch: 00000 - BIOS / h√©rit√© <br>  PXEClient: Arch: 00006 - UEFI x86 <br>  PXEClient: Arch: 00007 - UEFI x64 </p></div></div><br><p>  J'ai √©galement essay√© diverses options pour les fichiers de d√©marrage <code>.efi</code> </p><br><ul><li>  syslinux </li><li>  grub 2 </li></ul><br><p>  J'ai √©galement essay√© de trouver le probl√®me dans le journal des √©v√©nements. <br> <code>win + r -&gt; eventvwr -&gt;     -&gt; Microsoft -&gt; Windows -&gt; Deployment-Services-Diagnostics</code> </p> <br><p>  Mais, comme je l'ai dit plus haut, le probl√®me r√©sidait dans le fichier <strong>wdsmgfw.efi</strong> . <br>  Soit je l'ai accidentellement supprim√© moi-m√™me, soit il n'a pas √©t√© copi√© lors de l'installation <br>  et configurer WDS. </p></div></div><br><p>  Eh bien, commen√ßons! </p><br><h2 id="instrukciya">  Manuel d'instructions </h2><br><h4 id="etap-1---proverka-rabotosposobnosti-wds">  √âtape 1 - Bilan de sant√© WDS </h4><br><p>  Prenez n'importe quel appareil ou machine virtuelle qui prend en charge le d√©marrage UEFI sur le r√©seau et essayez de d√©marrer. </p><br><p>  Vous devriez avoir l'image suivante: </p><br><p><img src="https://habrastorage.org/webt/6z/1s/gb/6z1sgbqwvnlt0dm4hxvoykknlck.png"></p><br><p>  Si oui, alors tr√®s bien, vous pouvez continuer. <br>  Sinon, voyez ce que j'ai √©crit dans l'introduction. </p><br><h4 id="etap-2---sborka-zagruzochnogo-fayla-ipxe">  √âtape 2 - Cr√©ez le fichier de d√©marrage iPXE </h4><br><p>  Ex√©cutez Ubuntu pr√©-pr√©par√©, ouvrez le terminal et ins√©rez cette ligne: </p><br><pre> <code class="plaintext hljs">git clone https://git.ipxe.org/ipxe.git ipxe</code> </pre> <br><p><img src="https://habrastorage.org/webt/xx/rm/3m/xxrm3m6uw_ljjlenptc4pxq9spw.png"></p><br><p>  <em>Ici, je voudrais faire une petite remarque sur le fait que vous devrez peut-√™tre ajouter dans Ubuntu les packages n√©cessaires √† la compilation de C et C ++.</em> <em><br></em>  <em>Je viens de les avoir d√©j√† install√©s.</em> </p><br><p>  T√©l√©charg√©?  - G√©nial! <br>  Vous devez maintenant cr√©er un fichier de configuration pour l'assemblage. <br>  Dans le terminal, √©crivez: </p><br><pre> <code class="plaintext hljs">cd ipxe/src gedit chain.ipxe</code> </pre> <br><p>  Et collez dans ce fichier, le code suivant, puis enregistrez: </p><br><pre> <code class="plaintext hljs">#!ipxe dhcp chain http://%IP-address-your-IIS-server%/install.ipxe</code> </pre> <br><p>  Nous revenons au terminal et commen√ßons la compilation: </p><br><pre> <code class="plaintext hljs">make bin-x86_64-efi/ipxe.efi EMBED=chain.ipxe</code> </pre> <br><p><img src="https://habrastorage.org/webt/dv/ur/nz/dvurnzemv1eroll_0udqysn4jhw.png"></p><br><p>  Si tout est en ordre, vous devriez obtenir la sortie suivante dans le terminal: </p><br><p><img src="https://habrastorage.org/webt/kn/cf/is/kncfisuctq18hs9dewvpfwd4ovg.png"></p><br><p>  Et le fichier <strong>ipxe.efi</strong> , le long du chemin: <code>ipxe/src/bin-x86_64-efi/ipxe.efi</code> <br>  <em>Si, pour une raison quelconque, vous ne pouviez pas vous compiler,</em> <em><br></em>  <em>J'ai joint mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dossier</a> .</em> <em><br></em>  <em>Il est compil√© pour t√©l√©chargement √† partir de <code>http://192.168.0.100/install.ipxe</code></em> </p><br><p>  C'est tout avec Ubuntu. </p><br><h4 id="etap-3---dobavlenie-ipxeefi-k-wds">  √âtape 3 - Ajout d'ipxe.efi √† WDS </h4><br><p>  Nous prenons le fichier que nous avons re√ßu dans la deuxi√®me √©tape et copions le long du chemin: <br> <code>%WDSpath%\Boot\x64\%your-boot-folder%\EFI\BOOT\</code> <br>  Apr√®s l'avoir renomm√© BOOTX64.EFI. <br>  <em>Ce n'est pas n√©cessaire, c'est juste plus pratique.</em> </p><br><p>  Ex√©cutez ensuite <strong>cmd en</strong> tant qu'administrateur et √©crivez les commandes suivantes: </p><br><pre> <code class="plaintext hljs">wdsutil /set-server /bootprogram:Boot\x64\%your-boot-folder%\EFI\BOOT\BOOTX 64.EFI /architecture:x64uefi  wdsutil /set-server /N12bootprogram:Boot\x64\%your-boot-folder%\EFI\BOOT\BOOTX 64.EFI /architecture:x64uefi</code> </pre> <br><p>  Cela installera le fichier r√©sultant pour le t√©l√©chargement via WDS. </p><br><p>  V√©rifiez la configuration: </p><br><pre> <code class="plaintext hljs">wdsutil /get-server /Show:Config</code> </pre> <br><p><img src="https://habrastorage.org/webt/a_/70/mo/a_70mobbjq86x8tlyvyw7ywuht8.png"></p><br><p>  <em>J'ai √©galement copi√© le fichier ipxe.efi, renomm√© BOOTIA32.EFI et configur√© le t√©l√©chargement pour cela, juste au cas o√π.</em> <em><code>architecture:x86uefi</code> <br></em>  <em>Mais dans l'ensemble, cela n'a aucun sens, car</em>  <em>Le fichier Bootmgfw.efi ne prend pas en charge x86</em> </p><br><p>  V√©rifiez ce qui s'est pass√©. <br><img src="https://habrastorage.org/webt/nz/oz/pi/nzozpiqidmvmolqo3qf6fr1rurc.png"><br>  Eh bien, WDS envoie notre fichier en t√©l√©chargement et, √† son tour, recherche la configuration le long du chemin: <code>http://192.168.0.100/install.ipxe</code> </p><br><h4 id="etap-4---konfiguraciya-menyu">  √âtape 4 - Configuration du menu </h4><br><p>  Nous allons dans le dossier racine de votre site. <br>  Par d√©faut, c'est: <code>C:\inetpub\wwwroot</code> </p><br><p>  Cr√©ez un fichier texte <strong>install.ipxe</strong> . </p><br><p>  Et configurez-le en fonction de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> et de vos besoins. <br>  Il y a aussi une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">description en</a> russe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des</a> √©quipes. <br>  J'ai utilis√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette</a> instruction lors de la configuration de mon WDS. </p><br><div class="spoiler">  <b class="spoiler_title">Exemple de configuration Install.ipxe</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#!ipxe :start menu Please choose an operating system to start/install item --gap Start Win PE item WinPE-x64 WinPE x64 item --gap ipxe shell item shell Drop to iPXE shell choose target &amp;&amp; goto ${target} :failed echo Booting failed, dropping to shell goto shell :shell echo Type 'exit' to get the back to the menu shell set menu-timeout 0 set submenu-timeout 0 goto start :WinPE-x64 kernel http://192.168.0.100/wimboot initrd http://192.168.0.100/peSE/Boot/bcd initrd http://192.168.0.100/peSE/Boot/boot.sdi initrd http://192.168.0.100/peSE/Boot/peSE64.wim boot || goto failed</code> </pre> </div></div><br><p>  Vous pouvez lire la configuration pour charger winPE <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><h4 id="etap-5---mime-types">  √âtape 5 - Types MIME </h4><br><p>  Apr√®s avoir cr√©√© le menu et ajout√© tous les fichiers n√©cessaires au dossier racine IIS, <br>  vous devez leur donner acc√®s. </p><br><p>  Parce que  m√™me si vous essayez de t√©l√©charger un fichier √† partir du navigateur, vous obtiendrez une erreur √† son adresse: <code>HTTP 404.3 - Not Found</code> . <br><img src="https://habrastorage.org/webt/4c/vi/13/4cvi1361vfaauyhjrikkgt3p7fw.png"></p><br><p>  Pour ce faire, ajoutez les types MIME dans le panneau de configuration IIS, conform√©ment <br>  avec des extensions de fichiers que vous t√©l√©chargerez via http. </p><br><p>  Je n'ai pas cherch√© quel type de MIME est meilleur √† ces fins, et d√©fini l' <code>application/octet-stream</code> , apr√®s quoi tout a fonctionn√©. </p><br><p>  Pour les fichiers sans extension, utilisez un point. </p><br><p>  Comme √ßa: </p><br><p><img src="https://habrastorage.org/webt/zx/5s/-m/zx5s-mjbkbw1vd5z_bwrl0irtyu.png"></p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  En fin de compte, nous avons la possibilit√© de d√©marrer sur le r√©seau local via UEFI. </p><br><p>  Si nous avons tout fait correctement, il y aura quelque chose comme le menu de s√©lection de d√©marrage: </p><br><p><img src="https://habrastorage.org/webt/gw/rw/a4/gwrwa4osswfqlolnyur-xpvbm8g.png"></p><br><p>  Si vous avez pr√©par√© les outils de base et que vous ne vous ennuierez pas avec la configuration, il faut environ 10 √† 20 minutes pour impl√©menter cette fonctionnalit√©. <br>  Cela m'a pris 2 jours ouvrables, car  a d√ª beaucoup google. </p><br><p>  Mise en ≈ìuvre r√©ussie! </p><br><p>  Merci de votre attention et merci beaucoup aux personnes dont les articles m'ont aid√©! <br>  Sur Habr it: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Ingtar</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Deeptown</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448476/">https://habr.com/ru/post/fr448476/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448462/index.html">AppCode 2019.1: Swift 5, r√©tro-√©clairage, navigation et auto-compl√©tion am√©lior√©s, expressions mobiles et bien plus encore</a></li>
<li><a href="../fr448464/index.html">Impl√©mentation simple du multithreading PHP</a></li>
<li><a href="../fr448470/index.html">Marketing de contenu aux √âtats-Unis, en Am√©rique latine et en Asie: conseils, liens et outils utiles pour la promotion du budget</a></li>
<li><a href="../fr448472/index.html">Comment PROCESS_DUP_HANDLE se transforme en PROCESS_ALL_ACCESS</a></li>
<li><a href="../fr448474/index.html">Nous recherchons des fuites de m√©moire dans les applications Python</a></li>
<li><a href="../fr448478/index.html">Mission lunaire ¬´Bereshit¬ª - annonce pr√©liminaire de la cause de l'accident</a></li>
<li><a href="../fr448480/index.html">Utilisateur dans Docker</a></li>
<li><a href="../fr448482/index.html">Test en usine d'un centre de donn√©es modulaire</a></li>
<li><a href="../fr448484/index.html">Les microbes racinaires</a></li>
<li><a href="../fr448486/index.html">¬´En novembre 2018, nous sommes tomb√©s par erreur dans le spam sur tous les fronts.¬ª Comment j'ai enregistr√© les envois d'une entreprise avec une millioni√®me base</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>