<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>答  そ Conexi贸n IPSec VPN entre MikroTik y Kerio Control   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Par谩metros iniciales 



1. La oficina central de la empresa con dos proxies fronterizos Kerio Control v.9.2.9 build 3171 (detr谩s de Kerio hay un swit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conexi贸n IPSec VPN entre MikroTik y Kerio Control</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439736/"><img src="https://habrastorage.org/webt/zg/b9/cd/zgb9cd1ivkh83waulyxllysswwe.png"><br><br>  Par谩metros iniciales <br><br><ol><li>  La oficina central de la empresa con dos proxies fronterizos Kerio Control v.9.2.9 build 3171 (detr谩s de Kerio hay un switch Cisco 3550 que determina la configuraci贸n de la red local de la oficina). </li><li>  Cada Kerio tiene dos canales con equilibrio de carga hasta el ISP (en el diagrama: ISP # 1 e ISP # 2) con IP blancas est谩ticas. </li><li>  Desde el lado de la oficina remota, se instal贸 MikroTik 951G-2HnD (OS v.6.43.11). </li><li>  Dos ISP llegan a MikroTik (en el diagrama est谩n ISP # 3 e ISP # 4). </li></ol><br>  Al momento de escribir, tanto en la oficina central como en la oficina remota, la conexi贸n con los proveedores era un par trenzado. <br><br><h3>  La lista de tareas: </h3><br><ol><li>  Establezca una conexi贸n VPN IPSec entre MikroTik y Kerio Control, donde MikroTik ser谩 el iniciador. </li><li> Garantizar la tolerancia a fallos de la conexi贸n VPN, es decir  Adem谩s del hecho de que MikroTik debe monitorear el rendimiento de sus ISP (art铆culo <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu铆</a></b> ), tambi茅n debe monitorear la disponibilidad de cada servidor Kerio y determinar el acceso a trav茅s de qu茅 canal (a trav茅s de qu茅 ISP de Kerio) se realizar谩 la conexi贸n. </li><li>  Proporcione la capacidad de cambiar la direcci贸n de red con la que MikroTik se conecta a Kerio.  Esto se debe al hecho de que Kerio, y no un enrutador, se encuentra en la sede "fronteriza". </li></ol><a name="habracut"></a><br><br><h3>  驴Qu茅 obtenemos en la salida? </h3><br><ol><li>  Cuando se inicia MikroTik (scheduleStartup), se organizar谩 un canal a la red empresarial (el canal ser谩 iniciado por MikroTik), lo que permite a un usuario remoto trabajar con recursos corporativos sin iniciar Kerio Client y sin configurar una conexi贸n VPN adicional utilizando el sistema operativo; </li><li>  MikroTik implementar谩 Failover, que cambia autom谩ticamente a un ISP en vivo; </li><li>  Puede establecer prioridades para los puntos de conexi贸n a la red empresarial cambiando la afiliaci贸n de los pares configurados para conectarse a Kerio Control a uno u otro Grupo de plantillas de pol铆ticas en MikroTik; </li><li>  MikroTik podr谩 monitorear autom谩ticamente el rendimiento de los servidores Kerio Control, y si la conexi贸n con el punto de prioridad se interrumpe, cambie al canal en vivo de forma independiente; </li><li>  Si sus servidores Kerio Control se publican en servidores DNS externos, MikroTik podr谩 realizar un seguimiento de los cambios en sus direcciones IP (por ejemplo, si su proveedor cambia) y realizar cambios de forma independiente en su configuraci贸n (scriptSetIPSecSADstAddrFromDNS). </li></ol><br><br>  Debo decir de inmediato que este art铆culo no es un tutorial (en principio, me familiaric茅 con los enrutadores y, en particular, con MikroTik solo dos meses (finales de 2017) antes de que se creara la configuraci贸n) y no aborda las preguntas "驴por qu茅?", Estar谩 aqu铆 Se proporciona la descripci贸n de la configuraci贸n de trabajo de MikroTik, que se utiliza en una empresa real. <br><br>  <b>Nota:</b> <br><ol><li>  Para mantener los comentarios en ruso al transferir el c贸digo del script a MikroTik, antes de copiar texto en el b煤fer y antes de insertarlo desde el b煤fer, aseg煤rese de que la distribuci贸n del teclado ruso est茅 activada; </li><li>  Si encuentra que las secuencias de comandos de registro son superfluas, puede comentar o eliminar l铆neas con "advertencia de registro" y "error de registro"; </li><li>  Tambi茅n puede observar comentarios comentados como "advertencia de registro" y "error de registro" en el c贸digo, este es un intento de agregar la capacidad de usar el registro en ingl茅s ... </li></ol><br><br>  Entonces comencemos: <br><br>  <b>Par谩metros b谩sicos:</b> <br><br><ol><li>  La red de la organizaci贸n matriz (detr谩s de Kerio) es 192.168.77.0/24 (aqu铆 usamos la direcci贸n de la red donde se encuentra Kerio en la red empresarial) </li><li>  Red de sucursales (detr谩s de MikroTik) - 192.168.11.0/24 </li><li>  La red a la que se asignar谩 la red de sucursales cuando se conecte a Kerio Control # 1 - 192.168.22.0/24 </li><li>  La red a la que se asignar谩 la red de sucursales cuando se conecte a Kerio Control # 2 - 192.168.33.0/24 </li><li>  Direcci贸n IP del grupo ISP # 1 (Kerio # 1) - 11.11.11.111 </li><li>  Direcci贸n IP del grupo ISP # 2 (Kerio # 1) - 22.22.22.111 </li><li>  Direcci贸n IP del grupo ISP # 1 (Kerio # 2) - 11.11.11.222 </li><li>  La direcci贸n IP del grupo ISP # 2 (Kerio # 2) es 22.22.22.222 </li><li>  Direcci贸n IP del grupo ISP # 3 (MikroTik) - 33.33.33.111 </li><li>  Direcci贸n IP del grupo ISP # 4 (MikroTik) - 44.44.44.111 </li></ol><br>  Lo primero que debe hacer es habilitar DDNS en MikroTik: <br><br><pre><code class="plaintext hljs">/ip cloud set ddns-enabled=yes</code> </pre> <br>  Debido al hecho de que MikroTik no tendr谩 una direcci贸n IP blanca est谩tica, el trabajo adicional de la configuraci贸n y los scripts se basa en el uso de DDNS. <br><br>  Tambi茅n IP ---&gt; Cloud se usa para determinar la direcci贸n IP externa de MikroTik, desde la que se ve en Internet. <br><br>  Ahora configuremos Kerio Control # 1, para que luego no volvamos a 茅l: <br>  Vamos a la secci贸n "Interfaces" y agregamos la nueva interfaz "T煤nel VPN" ... <br><br><div class="spoiler">  <b class="spoiler_title">Configuraci贸n de t煤nel en Kerio Control</b> <div class="spoiler_text">  1. En el campo de nombre, asigne un nombre a la interfaz; <br>  2. Coloque el interruptor en la posici贸n "Pasivo: solo acepta conexiones entrantes"; <br>  3. Escriba leave "IPSec"; <br>  4. La pesta帽a "Autenticaci贸n": <br><br><ul><li>  4.1 En el campo "Clave predefinida:" ingrese la frase clave que se utilizar谩 para conectarse; </li><li>  <b>Nota:</b> <br><br>  隆Recomiendo categ贸ricamente configurar todas las frases clave en todos los t煤neles VPN creados en un servidor Kerio espec铆fico! <br><br>  Esto se debe al hecho de que Kerio tiene un error flotante, que se expresa a continuaci贸n. <br><br>  Imagine que en la configuraci贸n de Kerio, como en mi caso, hay varias interfaces de "t煤nel VPN" configuradas para conectarse a MikroTik, que difieren entre s铆 solo en la configuraci贸n en el campo "ID local:" (se discutir谩 a continuaci贸n). <br><br>  Entonces, al crear (lo llamar茅 as铆) un t煤nel entrante, independientemente de la direcci贸n IP externa que Kerio contactar谩 con MikroTik, Kerio (por alguna raz贸n) activar谩 la primera interfaz que se encuentre, y si la direcci贸n IP especificada en la configuraci贸n el t煤nel en el lado de Kerio es diferente al que MikroTik hace referencia, el t煤nel no est谩 organizado. <br><br>  Y en el caso de que se indiquen diferentes frases clave para todos los t煤neles, este problema se detiene. </li><li>  4.2 En el campo "ID local:", ingrese la direcci贸n IP del grupo de direcciones ISP # 1 (en el ejemplo 11.11.11.111) asignado a la interfaz WAN Kerio Control # 1, a la que MikroTik acceder谩; </li><li>  4.3 En el campo "Remote ID:", ingrese el FQDN, que fue obtenido por nuestro MikroTik de DDNS (IP ---&gt; Cloud ---&gt; DNS Name).  Esta configuraci贸n nos permite no preocuparnos por c贸mo el ISP MikroTik accede a Kerio; </li><li>  4.4 En el campo "Fase 1 cifrado (IKE):" seleccione aes128-sha1-modp2048 de la lista; </li><li>  4.5 En el campo "Cifrado de fase 2 (ESP):" seleccione 3des-sha1-modp2048 de la lista; </li><li>  <b>Nota:</b> <br>  Edici贸n de la configuraci贸n predeterminada utilizada a trav茅s del bot贸n "Cambiar ..."; <br>  Ambas cifras se seleccionan utilizando el "m茅todo de b煤squeda cient铆fica". </li></ul><br>  5. La pesta帽a "Redes remotas": <br><br>  Aqu铆 ingresamos la direcci贸n IP de la red local que MikroTik usar谩 cuando se conecte a este servidor Kerio Control espec铆fico (en el ejemplo: 192.168.22.0/24). <br>  Importante!  En todo lo dem谩s (en mi caso est谩 determinado por el n煤mero de ISP de Kerio) los t煤neles en MikroTik, en este servidor Kerio, 隆debe indicarse la misma direcci贸n IP! <br><br>  Perm铆tame recordarle que esto se debe a la necesidad de configurar la ruta a esta red desde la red de la oficina central. <br><br>  6. La pesta帽a "Redes de 谩rea local": <br><br><ul><li>  6.1 Desmarque la casilla "Usar redes locales detectadas autom谩ticamente"; </li><li>  6.2 Establezca la casilla de verificaci贸n "Usar redes personalizadas:" y agregue la direcci贸n de red "que cubre" todo el rango de direcciones utilizadas en la red local detr谩s de Kerio Control a la lista de redes (en el ejemplo - 192.168.0.0/16). </li></ul><br>  Repetimos todos los pasos anteriores para el segundo t煤nel en el mismo servidor Kerio. <br><br>  La configuraci贸n del segundo t煤nel solo diferir谩 usando una frase de contrase帽a diferente (cl谩usula 4.1) y una direcci贸n IP externa diferente del conjunto de direcciones ISP # 2 (cl谩usula 4.2) (en el ejemplo, 22.22.22.111). <br><br>  La configuraci贸n de Kerio Control # 2 es id茅ntica a la descrita anteriormente, excepto por la direcci贸n de red indicada en la pesta帽a Redes remotas (p. 5) (en el ejemplo, 192.168.33.0/24) y, en consecuencia, las direcciones IP en el campo ID local: Sec. 4.2), que debe seleccionarse de las direcciones IP asignadas a las interfaces WAN Kerio Control # 2 (en el ejemplo, 11.11.11.222 y 22.22.22.222). <br></div></div><br>  A continuaci贸n, creamos una regla de permiso para hacer ping a nuestro Kerio desde MikroTik ... <br><br><div class="spoiler">  <b class="spoiler_title">Regla de ping en Kerio Control</b> <div class="spoiler_text">  Vamos a la secci贸n "Reglas de tr谩fico" y creamos una nueva regla con los siguientes par谩metros: <br><br><ul><li>  fuente: indique el FQDN que recibi贸 nuestro MikroTik de DDNS; </li><li>  Destino - Cortafuegos </li><li>  servicio - Ping; </li><li>  Tambi茅n puede especificar la versi贸n de IP (IPv4), pero esto no es necesario. </li></ul><br>  Guardamos la regla con un nombre que sea comprensible para usted y la arrastramos a la parte superior de la lista de reglas. <br><br>  Repetimos el mismo procedimiento en el segundo servidor Kerio. <br></div></div><br>  No olvide registrar las rutas en la red detr谩s de MikroTik en conmutadores o enrutadores al costado de la oficina central para que la red de la oficina central sepa hacia d贸nde dirigir el tr谩fico (en mi caso, estas son dos rutas est谩ticas en las redes 192.168.22.0/24 y 192.168.33.0/24). <br><br>  Desde la oficina central, hicimos todo, ahora pasamos a MikroTik. <br><br>  Comencemos creando los objetos de configuraci贸n b谩sicos para organizar y probar el t煤nel VPN. <br><br>  El primer paso es crear una lista de direcciones de subred local.  Lo usaremos en las reglas de Firewall. <br><br><pre> <code class="plaintext hljs">/ip firewall address-list #      MikroTik, # IP-      DHCP add address=192.168.11.0/24 list="Local subnet" #  ,        MikroTik #   VPN-  Kerio Control #1 # (     VPN-  Kerio Control #1, #   " ") add address=192.168.22.0/24 list="Local subnet" #  ,        MikroTik #   VPN-  Kerio Control #2 # (     VPN-  Kerio Control #2, #   " ") add address=192.168.33.0/24 list="Local subnet"</code> </pre> <br>  A continuaci贸n, cree una regla de permiso para el tr谩fico IKE y col贸quela en la parte superior de la lista de reglas. <br><br><pre> <code class="plaintext hljs">add action=accept chain=input comment="VPN Allow IKE" dst-port=500 protocol=udp</code> </pre> <br>  Luego agregue dos reglas al Filtro de firewall para trabajar con tr谩fico VPN ... <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=accept chain=forward comment="VPN In IpSec" dst-address-list=\ "Local subnet" ipsec-policy=in,ipsec src-address=192.168.0.0/16 \ src-address-list="!Local subnet" add action=accept chain=forward comment="VPN Out" dst-address=192.168.0.0/16 \ dst-address-list="!Local subnet" src-address-list="Local subnet"</code> </pre> <br>  ... y moverlos a una posici贸n inmediatamente <b>superior a la regla de ca铆da</b> , que proh铆be el tr谩fico entrante desde fuera de la LAN.  En mi configuraci贸n predeterminada, fue con el comentario "defconf: descartar todo lo que no viene de LAN" <br><br>  Vaya a Firewall Mangle y cree las siguientes reglas: <br><br><pre> <code class="plaintext hljs">/ip firewall mangle #      , #  ... add action=mark-connection chain=prerouting comment="VPN In" \ new-connection-mark=VPN_conn_in passthrough=no src-address=192.168.0.0/16 \ src-address-list="!Local subnet" # ...   add action=mark-routing chain=output comment="VPN In" connection-mark=\ VPN_conn_in new-routing-mark=VPN_route_in passthrough=yes #     MikroTik      . #     NAT. add action=mark-connection chain=postrouting comment="VPN Out" dst-address=\ 192.168.0.0/16 dst-address-list="!Local subnet" new-connection-mark=\ VPN_conn_out passthrough=no</code> </pre> <br>  A continuaci贸n, observamos en Firewall NAT: <br><br><pre> <code class="plaintext hljs">/ip firewall nat #     MikroTik     #      , #    Kerio- (:  Kerio Control #1 - 192.168.22.0/24,  Kerio Control #2 - 192.168.33.0/24) # ! # comment=KerioVpnNatOut   ! add action=netmap chain=srcnat comment=KerioVpnNatOut connection-mark=\ VPN_conn_out to-addresses=192.168.22.0/24 #     MikroTik     #          MikroTik add action=netmap chain=dstnat comment=KerioVpnNatIn connection-mark=\ VPN_conn_in to-addresses=192.168.11.0/24 #  MikroTik  Kerio- add action=accept chain=srcnat comment=KerioVpnNatPing out-interface-list=WAN protocol=icmp</code> </pre> <br>  <b>Importante!</b>  Estas reglas deben colocarse por encima de las reglas de enmascaramiento. <br><br>  Ahora vamos a la secci贸n IP ---&gt; IPSec, donde necesitamos crear una pol铆tica, un par, grupos de plantillas de pol铆ticas (discutir茅 su prop贸sito m谩s adelante) y una propuesta para configurar el cifrado de fase 2. <br><br><div class="spoiler">  <b class="spoiler_title">propuesta ip ipsec</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/ip ipsec proposal add enc-algorithms=3des name=KerioVPNProposal#01 pfs-group=modp2048</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">grupo de pol铆ticas ip ipsec</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/ip ipsec policy group add name=1 add name=2 add name=3 add name=4</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">ip ipsec peer</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/ip ipsec peer add address=11.11.11.111/32 comment=vs01-i01-01.domain.ru exchange-mode=\ main-l2tp local-address=33.33.33.111 my-id=\ fqdn:mikrotik.sn.mynetname.net policy-template-group=1 profile=\ profile_4 secret=pass1111</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">pol铆tica ip ipsec</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/ip ipsec policy add comment=KerioVPNPolicy dst-address=192.168.77.0/24 proposal=KerioVPNProposal#01 \ sa-dst-address=11.11.11.111 sa-src-address=33.33.33.111 src-address=\ 192.168.22.0/24 tunnel=yes</code> </pre> <br></div></div><br>  Comentario: <br><br>  1. / propuesta de ip ipsec: ingrese los mismos par谩metros de cifrado que especificamos al configurar Kerio Control en el campo "Cifrado de fase 2 (ESP):". <br><br>  <b>Nota:</b> <br><br>  Preste atenci贸n al par谩metro "nombre = KerioVPNProposal # 01". <br><br>  No es necesario usar este nombre espec铆ficamente, pero si decide usar otro, luego de cambiarlo debe verificar y, si es necesario, cambiar la configuraci贸n de la pol铆tica IPSec asociada, as铆 como cambiar el valor asignado de la variable DefKerioPropName en el script scriptCheckActiveVpnServer, que se discutir谩 discurso adicional. <br><br>  (En realidad, la mayor铆a de los nombres y comentarios de los objetos en la configuraci贸n descrita se usan en scripts, por lo que renombrarlos puede ocasionar algunos inconvenientes debido a la necesidad de realizar cambios en el c贸digo del script. Intentar茅 tomar notas apropiadas en el texto para facilitar la b煤squeda de dichos objetos). <br><br>  2. / grupo de pol铆ticas ip ipsec <br><br>  La creaci贸n de grupos se debe al hecho de que en el futuro procesaremos sus nombres (1, 2, ... n) en scripts y los utilizaremos para priorizar las direcciones IP de los servidores Kerio a los que accederemos. <br><br>  Creo cuatro grupos a la vez porque  Tengo dos ISP, con dos IP externas en cada uno de Kerio.  En esta etapa, estamos usando solo un grupo hasta ahora. <br><br>  3. / ip ipsec peer <br><br>  En igual, especifique: <br><br><ul><li>  Direcci贸n: direcci贸n IP de Kerio, que se contactar谩 con MikroTik.  Debe especificarse la misma direcci贸n que ingresamos en / ip ipsec policy sa-dst-address, solo con la m谩scara "/ 32"; </li><li>  Direcci贸n local: direcci贸n IP de MikroTik, desde la cual se acceder谩 a Kerio.  Se debe especificar la misma direcci贸n que ingresamos en / ip ipsec policy sa-src-address; </li><li>  Auth.  M茅todo: seleccione "clave precompartida" de la lista; </li><li>  Modo de intercambio: seleccione main-l2tp de la lista; </li><li>  Si est谩 configurado, desmarque la casilla "Pasivo"; </li><li>  Secreto: ingrese la frase de contrase帽a que ingresamos cuando configuramos la interfaz VPN en Kerio, en la pesta帽a "Autenticaci贸n", en el campo "Clave predefinida:"; </li><li>  Grupo de plantillas de pol铆ticas: seleccione de la lista el grupo que creamos anteriormente con el nombre "1"; </li><li>  Desmarque el recorrido NAT; </li><li>  Mi tipo de ID: seleccione el valor "fqdn" de la lista; </li><li>  Mi ID: ingrese el FQDN asignado por MikroTik en DDNS; </li><li>  En la pesta帽a "Cifrado", seleccione los par谩metros de cifrado que ingresamos cuando configuramos la interfaz VPN en Kerio, en la pesta帽a "Autenticaci贸n", en el campo "Fase 1 (IKE) Cipher:"; </li><li>  Comentario ( <b>隆Advertencia! 隆Utilizado en scripts!</b> ). </li></ul><br>  En el comentario, indico el FQDN t茅cnico completo de mis servidores, que se publican en los servidores DNS que sirven a mi zona exterior. <br><br>  Adem谩s de usar esta configuraci贸n, esto me permite mantener informaci贸n actualizada sobre las direcciones IP externas de los servidores Kerio utilizados (solo necesito cambiar la direcci贸n IP en el servidor DNS externo y se cambiar谩 autom谩ticamente a MikroTik (art铆culo <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu铆</a></b> )). <br><br>  Para aquellos que son demasiado flojos para entender, cito el c贸digo de trabajo: <br><br><pre> <code class="plaintext hljs">/system script add dont-require-permissions=no name=scriptSetIPSecSADstAddrFromDNS owner=\ admin policy=read,write</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Listado de script scriptSetIPSecSADstAddrFromDNS</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">:if ([:len [/system script job find script=SetIPSecSADstAddrFromDNS]]&gt;1) do={ :error } :local DnsNameFromComment :local ResolvedIpFromComment :local ResolvedIpWithMaskFromComment :local IpPeerAddr :foreach IpSecPeerCount in=[/ip ipsec peer find] do={ :set DnsNameFromComment [/ip ipsec peer get $IpSecPeerCount comment] :if ($DnsNameFromComment!="") do={ :do { :set ResolvedIpFromComment [:resolve $DnsNameFromComment] :set ResolvedIpWithMaskFromComment ($ResolvedIpFromComment . "/32") :set IpPeerAddr [/ip ipsec peer get $IpSecPeerCount address] :if ($ResolvedIpWithMaskFromComment!=$IpPeerAddr) do={ :log warning ("[SetIPSecSADstAddrFromDNS]     " . DnsNameFromComment . "  IP-  " . $IpPeerAddr . "  " . $ResolvedIpFromComment) #:log warning ("[SetIPSecSADstAddrFromDNS] In the peer to the server " . DnsNameFromComment . " changed IP address from " . $IpPeerAddr . " on " . $ResolvedIpFromComment) /ip ipsec peer set $IpSecPeerCount address=$ResolvedIpWithMaskFromComment } } on-error={ :set ResolvedIpFromComment "unknown" :log error ("[SetIPSecSADstAddrFromDNS]     " . $DnsNameFromComment) #:log error ("[SetIPSecSADstAddrFromDNS] Cant resolve name " . $DnsNameFromComment) } } } :log warning ("[SetIPSecSADstAddrFromDNS]  IP- VPN- ") #:log warning ("[SetIPSecSADstAddrFromDNS] The IP-addresses of the VPN-servers are checked")</code> </pre><br></div></div><br>  <b>La regla b谩sica que se aplica al comentario en pares</b> es que el nombre debe comenzar con cualquier letra y / o n煤mero, sin espacios, seguido de un <b>gui贸n OBLIGATORIO</b> ("-"), seguido de cualquier n煤mero de caracteres arbitrarios. <br><br>  Yo uso el siguiente formato: <br><br>  vsNN-pNN-NN.domain.ru <br><br>  Donde: <br><br>  vsNN - vpn-server #NN (Esta parte del comentario se procesa en scripts y se usa en IP ---&gt; Firewall ---&gt; Listas de direcciones (ver m谩s abajo)); <br>  pNN - ISP #NN; <br>  NN: n煤mero de serie de la direcci贸n IP externa en el conjunto de direcciones que me envi贸 el proveedor en Kerio; <br><br>  4. / ip ipsec policy <br><br>  En pol铆tica, definimos: <br><br><ul><li>  Dst.  Direcci贸n: direcci贸n de red detr谩s de Kerio (dst-address); </li><li>  Src.  Direcci贸n: la direcci贸n de la red a la que MikroTik enmascarar谩 (consulte la configuraci贸n de IP ---&gt; Firewall ---&gt; NAT) su red local (direcci贸n src).  Esta direcci贸n de red ser谩 visible desde el lado de Kerio (la especificamos cuando configuramos la interfaz VPN en Kerio, en la pesta帽a Redes remotas); </li><li>  Protocolo - 255 (todos); </li><li>  Acci贸n: cifrar; </li><li>  Nivel - requiere; </li><li>  Protocolos IPSec - esp; </li><li>  establezca el par谩metro tunnel = yes; </li><li>  SA Src.  Direcci贸n: la direcci贸n IP externa de MikroTik, desde la cual se acceder谩 a Kerio (sa-src-address); </li><li>  SA Dst.  Direcci贸n: direcci贸n IP de Kerio, con la que se contactar谩 a MikroTik (sa-dst-address); </li><li>  Propuesta: ingrese el valor asignado al par谩metro de nombre en la secci贸n de propuesta / ip ipsec (en esta configuraci贸n - KerioVPNProposal # 01); </li><li>  Comentario ( <b>隆Advertencia! 隆Utilizado en scripts!</b> ) - KerioVPNPolicy. </li></ul><br>  Si todo se hace correctamente, luego de guardar la pol铆tica, el valor "establecido" deber铆a aparecer en el campo "Estado PH2", que indica la instalaci贸n de un canal VPN entre MikroTik y Kerio. <br>  Puede verificar esto comprobando el estado de la interfaz VPN en Kerio Control.  All铆, en el campo "Informaci贸n", opuesto a la interfaz a la que se realiza la conexi贸n, deber铆a aparecer la inscripci贸n "Se establece la conexi贸n a su_MikroTik_IP_address". <br><br>  Continuamos ... <br><br>  Ahora crearemos pares para todas las direcciones IP restantes de los servidores Kerio (en mi configuraci贸n es necesario crear tres pares m谩s). <br><br>  Para hacer esto, debemos repetir todos los pasos indicados en el p谩rrafo 3 (/ ip ipsec peer), pero preste atenci贸n a los siguientes cambios: <br><br><ul><li>  Direcci贸n: cambie la direcci贸n IP de Kerio; </li><li>  Secreto: ingrese la frase de contrase帽a relacionada con la conexi贸n que se est谩 creando (pass2222, pass3333, ... passNNNN); </li><li>  Grupo de plantillas de pol铆ticas: seleccione el siguiente grupo de la lista de la lista (2, 3, ... n). </li></ul><br>  <b>Nota:</b> <br><br>  Luego puede cambiar la prioridad de sus servidores en cualquier momento cambiando el grupo en la configuraci贸n de pares. <br><br><ul><li>  Comentario: en mi caso, cambia a otro FQDN del servidor Kerio. </li></ul><br>  Todos los dem谩s par谩metros se ingresan igual que en la primera fiesta.  Aquellos que necesitar谩n ser cambiados son procesados por scripts y puede copiarlos sin cambios por ahora. <br><br>  El paso final de la configuraci贸n antes de conectar los scripts al trabajo es hacer que MikroTik funcione como un dep贸sito de constantes, que usaremos en los scripts ... <br>  Agregue dos listas a las Listas de direcciones del firewall ( <b>隆Advertencia! 隆Utilizadas en scripts!</b> ): <br><br><pre> <code class="plaintext hljs">/ip firewall address-list add address=192.168.22.0/24 list=vs01 add address=192.168.33.0/24 list=vs02</code> </pre> <br>  en ellas indicamos las direcciones de las redes con referencia a los prefijos de nombres de Kerio-server, en los que mapearemos el tr谩fico VPN saliente. <br><br>  Bueno, para automatizar el trabajo de toda esta desgracia, agregamos dos scripts y tres programaciones <b>(si decide cambiar el nombre de los scripts, no olvide hacer los cambios apropiados en el c贸digo)</b> . <br><br><pre> <code class="plaintext hljs">/system script add dont-require-permissions=no name=scriptFunctionsList owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Listado de guiones scriptFunctionsList</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   IP --&gt; Cloud   DNS- #  : # # $start (true/false); # #  ""  "updated" :global subUpdateCloudDns do={ put ($start); :if ($start=false) do={ set $CloudDnsStatus; #     set $m 1; log warning ("[subUpdateCloudDns] ---&gt; DDNS  ---&gt;  "); #log warning ("[subUpdateCloudDns] ---&gt; DDNS status ---&gt; CHECK STARTED"); do { log warning ("[subUpdateCloudDns] ---&gt; DDNS ,  ---&gt; " . $m); [/ip cloud force-update]; delay 30000ms; set $CloudDnsStatus ([/ip cloud get status]); set $m ($m+1); :if ($CloudDnsStatus="updated") do={ log warning ("[subUpdateCloudDns] ---&gt; DDNS  ---&gt; " . $CloudDnsStatus); #log warning ("[subUpdateCloudDns] ---&gt; DDNS status ---&gt; " . $CloudDnsStatus); } else={ log error ("[subUpdateCloudDns] ---&gt; DDNS  ---&gt; " . $CloudDnsStatus); #log error ("[subUpdateCloudDns] ---&gt; DDNS status ---&gt; " . $CloudDnsStatus); } } while=(($CloudDnsStatus!="updated") and ($m&lt;10)); return ($CloudDnsStatus); } } #    IP --&gt; Cloud #   : # # 0 - ; # 1 - ,   ; # 2 -    :global subCheckCloudDDNS do={ set $CloudDnsActive ([/ip cloud get ddns-enabled]); #  - ( $m=0 ) set $m 0; :if ($CloudDnsActive=yes) do { #  IP---&gt;Cloud  ( $m=1 ) set $m ($m+1); set $CloudDnsStatus ([/ip cloud get status]); #    IP- (  IP---&gt;Cloud    DNS) set $CloudDnsIP ([/ip cloud get public-address]); set $CheckIpAddr ([resolve [/ip cloud get dns-name]]); :if ($CloudDnsIP!=$CheckIpAddr) do={ #  IP  (  MikroTik  )... set $CloudDnsStatus "updating..."; } :if ($CloudDnsStatus="updated") do { #  IP---&gt;Cloud    ( $m=2 ) set $m ($m+1); } } return ($m); } #       #  : # # $ScriptName ( ) :global subRepeatScript do={ put ($ScriptName); :if ($ScriptName!="") do { [/system script run $ScriptName]; } } #     VPN-   # #   IP- VPN-     :global subGetVpnServers do={ #    IP- VPN-        :foreach IpSecPeerId in=[/ip ipsec peer find passive!=yes] do={ set $CheckIpAddr [/ip ipsec peer get $IpSecPeerId address]; :if ($CheckIpAddr!="") do={ set $MaskPos [find $CheckIpAddr "/"]; set $GroupFromPeer ([/ip ipsec peer get $IpSecPeerId policy-template-group]); set $IpFromPeer ([pick $CheckIpAddr 0 $MaskPos]); set $VpnServersList ($VpnServersList, {{$GroupFromPeer; $IpFromPeer}}); } } return ($VpnServersList); } #        # #    ID   :global subDisableIpSecPeers do={ # ...  ,  (passive=false) ... :foreach IpSecPeerId in=[/ip ipsec peer find passive!=yes] do={ log warning ("[IP IPSec Peer] ---&gt;    ---&gt; " . [/ip ipsec peer get $IpSecPeerId comment]); #log warning ("[IP IPSec Peer] ---&gt; processed peer on ---&gt; " . [/ip ipsec peer get $IpSecPeerId comment]); #  address   ... set $CheckIpAddr [/ip ipsec peer get $IpSecPeerId address]; :if ($CheckIpAddr!="") do={ #  address  ,  IP-  ... set $MaskPos ([find $CheckIpAddr "/"]); set $CheckIpAddr ([pick $CheckIpAddr 0 $MaskPos]); # ...   IPSec- :foreach IpSecPolicyId in=[/ip ipsec policy find sa-dst-address=$CheckIpAddr] do={ :if ($IpSecPolicyId!="") do={ :if ([/ip ipsec policy get $IpSecPolicyId disabled]!=yes) do={ [/ip ipsec policy disable $IpSecPolicyId]; log warning ("[IP IPSec Policy] ---&gt;  " . [/ip ipsec policy get $IpSecPolicyId comment] . " "); #log warning ("[IP IPSec Policy] ---&gt; policy " . [/ip ipsec policy get $IpSecPolicyId comment] . " deactivated"); } #    ID     set $IdList ($IdList, $IpSecPolicyId); } } } # :     ,      :if ([/ip ipsec peer get $IpSecPeerId disabled]!=yes) do={ [/ip ipsec peer disable $IpSecPeerId]; log warning ("[IP IPSec Peer] ---&gt; " . [/ip ipsec peer get $IpSecPeerId comment] . " ---&gt; "); #log warning ("[IP IPSec Peer] ---&gt; " . [/ip ipsec peer get $IpSecPeerId comment] . " ---&gt; deactivated"); } } return ($IdList); } #        #  : # # $PeerID (ID   VPN-); # $PolIdList ( ID  $subDisableIpSecPeers); # $CloudIP (IP MikroTik  DDNS); # $SrcIP (src-address    VPN-) :global subEnableIpSecPeers do={ put ($PeerID); put ($PolIdList); put ($CloudIP); :if (($PeerID!="")&amp;&amp;($PeerID!=nil)&amp;&amp;($PolIdList!="")&amp;&amp;($PolIdList!=nil)&amp;&amp;($CloudIP!="")&amp;&amp;($CloudIP!=nil)) do={ #   VPN- set $ActiveVPN [/ip ipsec peer get $PeerID address]; :if ($ActiveVPN!="") do={ #  ,  IP-   set $MaskPos [find $ActiveVPN "/"]; set $ActiveVPN ([pick $ActiveVPN 0 $MaskPos]); } #   ,      :if ([/ip ipsec peer get $PeerID disabled]=yes) do={ delay 5000ms; [/ip ipsec peer enable $PeerID]; log warning ("[IP IPSec Peer] ---&gt;  peer  ---&gt; " . [/ip ipsec peer get $PeerID address]); #log warning ("[IP IPSec Peer] ---&gt; activated peer on ---&gt; " . [/ip ipsec peer get $PeerID address]); } #    ID   PolIdList, ,    Src. Address, SA Src. Address  SA Dst. Address,   :foreach IpSecPolicyId in=$PolIdList do={ :if ($IpSecPolicyId!="") do={ :if ([/ip ipsec policy get $IpSecPolicyId src-address]!=$SrcIP) do={ [/ip ipsec policy set $IpSecPolicyId src-address=$SrcIP]; log warning ("[IP IPSec Policy] ---&gt;  src-address"); #log warning ("[IP IPSec Policy] ---&gt; src-address changed"); } :if ([/ip ipsec policy get $IpSecPolicyId sa-src-address]!=$CloudIP) do={ [/ip ipsec policy set $IpSecPolicyId sa-src-address=$CloudIP]; log warning ("[IP IPSec Policy] ---&gt;  sa-src-address"); #log warning ("[IP IPSec Policy] ---&gt; sa-src-address changed"); } :if ([/ip ipsec policy get $IpSecPolicyId sa-dst-address]!=$ActiveVPN) do={ [/ip ipsec policy set $IpSecPolicyId sa-dst-address=$ActiveVPN]; log warning ("[IP IPSec Policy] ---&gt;  sa-dst-address"); #log warning ("[IP IPSec Policy] ---&gt; sa-dst-address changed"); } :if ([/ip ipsec policy get $IpSecPolicyId disabled]=yes) do={ delay 3000ms; [/ip ipsec policy enable $IpSecPolicyId]; log warning ("[IP IPSec Policy] ---&gt;  "); #log warning ("[IP IPSec Policy] ---&gt; policy activated"); #  DNS- [/ip dns cache flush] } } } } } #      ID  #  : # # $PeerIP (IP    ); # $CloudIP (IP MikroTik  DDNS); # $action (enable/disable/skip) # #    ID,   ,  :global subGetPoliciesByPeer do={ put ($PeerIP); put ($CloudIP); put ($action); :if (($action="")||($action=nil)) do={ set $action "skip"; } :foreach IpSecPolicyId in=[/ip ipsec policy find sa-dst-address=$PeerIP] do={ :if ($IpSecPolicyId!="") do={ #     $action=disable,   :if (([/ip ipsec policy get $IpSecPolicyId disabled]!=yes)&amp;&amp;($action="disable")) do={ [/ip ipsec policy disable $IpSecPolicyId]; log warning ("[IP IPSec Policy] ---&gt;  "); #log warning ("[IP IPSec Policy] ---&gt; policy deactivated"); } #     $CloudIP  sa-src-address!=$CloudIP ( ISP),     sa-src-address :if (($CloudIP!="")&amp;&amp;($CloudIP!=nil)&amp;&amp;([/ip ipsec policy get $IpSecPolicyId sa-src-address]!=$CloudIP)) do={ [/ip ipsec policy disable $IpSecPolicyId]; [/ip ipsec policy set $IpSecPolicyId sa-src-address=$CloudIP]; log warning ("[IP IPSec Policy] ---&gt;   ---&gt;  sa-src-address ---&gt; " . $CloudIP); #log warning ("[IP IPSec Policy] ---&gt; policy deactivated ---&gt; new sa-src-address ---&gt; " . $CloudIP); #   ,  Kerio   delay 30000ms; } #     $action=enable,   :if (([/ip ipsec policy get $IpSecPolicyId disabled]=yes)&amp;&amp;($action="enable")) do={ [/ip ipsec policy enable $IpSecPolicyId]; log warning ("[IP IPSec Policy] ---&gt;  "); #log warning ("[IP IPSec Policy] ---&gt; policy activated"); #  DNS- [/ip dns cache flush] } #    ID     set $IdList ($IdList, $IpSecPolicyId); } } return ($IdList); } #   local-address  #  : # # $PeerID (ID   VPN-); # $CloudIP (IP MikroTik  DDNS) :global subCheckPeerLocalIp do={ put ($PeerID); put ($CloudIP); :if (($PeerID!="")&amp;&amp;($PeerID!=nil)&amp;&amp;($CloudIP!="")&amp;&amp;($CloudIP!=nil)) do={ #   DDNS-IP :if ([/ip ipsec peer get $PeerID local-address]!=$CloudIP) do={ [/ip ipsec peer set $PeerID local-address=$CloudIP]; log warning ("[IP IPSec Peer] ---&gt;  local-address"); #log warning ("[IP IPSec Peer] ---&gt; local-address changed"); } } }</code> </pre> <br></div></div><br><pre> <code class="plaintext hljs">/system script add dont-require-permissions=no name=scriptCheckActiveVpnServer owner=admin policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon</code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listado de script scriptCheckActiveVpnServer</font></font></b> <div class="spoiler_text"><pre> <code class="plaintext hljs">:if ([:len [/system script job find script=scriptCheckActiveVpnServer]]&gt;1) do={ :error } #      scheduleStartup #   ,       :global subCheckCloudDDNS :global subCheckPeerLocalIp :global subDisableIpSecPeers :global subEnableIpSecPeers :global subGetPoliciesByPeer :global subGetVpnServers :global subUpdateCloudDns :local CheckIP :local CheckPeer #     DDNS ( ) :local CloudDnsStatus ([:put [$subCheckCloudDDNS]]) :local Exit false :local DefMikroTikSrcNet 192.168.11.0/24 :local DefKerioDstNet 192.168.77.0/24 :local DefKerioPropName KerioVPNProposal#01 :local DefKerioPolName KerioVPNPolicy :local IpSecPolicyId :local KerioName :local KerioVpnNatRuleName KerioVpnNatOut :local m :local n 1 :local PeerCount 0 :local PeerDisabled :local PingCount 3 :local PingResult :local PoliciesList :local PublicIp :local VpnServersList #   DDNS ,  ,    IP- MikroTik :if ($CloudDnsStatus=0) do={ #  Cloud DDNS  ,         :log error ("[schedule CheckActiveVpnServer] ---&gt;    VPN-   Cloud DDNS! (IP -&gt; Cloud)") # :log error ("[schedule CheckActiveVpnServer] ---&gt; to connect to the VPN server, you need to activate Cloud DDNS! (IP -&gt; Cloud)") :error } :if ($CloudDnsStatus=1) do={ #  Cloud DDNS ,   ,   ( ) :set CloudDnsStatus [:put [$subUpdateCloudDns start=false]] :if ($CloudDnsStatus="updated") do={ :set CloudDnsStatus 2 } } :if ($CloudDnsStatus=2) do { #  Cloud DDNS    ... #  IP  DDNS :set PublicIp [/ip cloud get public-address] #   VPN-  ,    ( ) :set VpnServersList ([:put [$subGetVpnServers]]) #     :foreach VpnIpId in=$VpnServersList do={ :set PeerCount ($PeerCount+1) } #   VPN-    DDNS-IP ( ,   VPN-    ) :while (($Exit!=true)&amp;&amp;$n&lt;=$PeerCount) do={ :foreach VpnIpId in=$VpnServersList do={ #  IP- VPN-    :if (($VpnIpId-&gt;0)=$n) do={ :set CheckIP ($VpnIpId-&gt;1) :if ($CheckIP!="") do={ #    IP :set PingResult ([:put [/ping address=$CheckIP count=$PingCount src-address=$PublicIp]]) :if ($PingResult=$PingCount) do={ :log warning ("[schedule CheckActiveVpnServer] ---&gt; DDNS-IP ---&gt; " . $PublicIp . " ---&gt; VPN-IP ---&gt; " . $CheckIP . " ---&gt; Ping Result ---&gt; " . $PingResult) #  IP ,     IP- :set CheckPeer (:put [/ip ipsec peer find address=($CheckIP . "/32")]) :if ($CheckPeer!="") do={ #   ,     src- (IP ---&gt; Firewall ---&gt; Address Lists),     Kerio #    Kerio    :set KerioName [/ip ipsec peer get $CheckPeer comment] #    (  ,  FQDN  Kerio   KerioName-Parameter1-...-Parameter_n :if ($KerioName!="") do={ #    :set m ([find $KerioName "-"]) #  KerioName    :set KerioName ([pick $KerioName 0 $m]) #    Firewall -&gt; Address List (       : # Name ---&gt; KerioName (eg srv1) # Address ---&gt; DefMikroTikSrcNet (eg 192.168.99.0/24)) :set m [/ip firewall address-list find list=$KerioName] :set DefMikroTikSrcNet ([/ip firewall address-list get $m address]) } # ...          Kerio :set IpSecPolicyId (:put [/ip ipsec policy find comment="$DefKerioPolName"]) #      ,       # (    )         :if ($IpSecPolicyId="") do={ [/ip ipsec policy add disabled=yes dst-address=$DefKerioDstNet proposal=$DefKerioPropName sa-dst-address=$CheckIP sa-src-address=$PublicIp src-address=$DefMikroTikSrcNet tunnel=yes comment=$DefKerioPolName place-before=0] :log warning ("[schedule CheckActiveVpnServer] ---&gt;   " . $DefKerioPolName . " ---&gt;    ") #:log warning ("[schedule CheckActiveVpnServer] ---&gt; created policy " . $DefKerioPolName . " ---&gt; default parameters used") } else={ #   ,     src-address,   . :if ($DefMikroTikSrcNet!=[/ip ipsec policy get $IpSecPolicyId src-address]) do={ [/ip ipsec policy set $IpSecPolicyId src-address=$DefMikroTikSrcNet]; :log warning ("[schedule CheckActiveVpnServer] ---&gt;  " . $DefKerioPolName . "  ---&gt; src-address   ---&gt; " . $DefMikroTikSrcNet) #:log warning ("[schedule CheckActiveVpnServer] ---&gt; policy " . $DefKerioPolName . " changed ---&gt; src-address changed to ---&gt; " . $DefMikroTikSrcNet) } } #   :set m #  NAT-      Kerio  :set m [/ip firewall nat find comment=$KerioVpnNatRuleName] :if ($m!="") do={ #   src-address   ipsec,       Kerio  :if ([/ip firewall nat get $m to-addresses]!=$DefMikroTikSrcNet) do={ [/ip firewall nat set $m to-addresses $DefMikroTikSrcNet] :log warning ("[IP Firewall NAT] ---&gt;    ---&gt; " . $KerioVpnNatRuleName) #:log warning ("[IP Firewall NAT] ---&gt; netmap rule changed ---&gt; " . $KerioVpnNatRuleName) } } # ... local-address      IP MikroTik,    ( ) :put [$subCheckPeerLocalIp PeerID=$CheckPeer CloudIP=$PublicIp] # ...    :set PeerDisabled ([/ip ipsec peer get $CheckPeer disabled]) :if ($PeerDisabled=true) do={ #   ... #       ( ) :set PoliciesList ([:put [$subDisableIpSecPeers]]) #     VPN-   ( ) :put [$subEnableIpSecPeers PeerID=$CheckPeer PolIdList=$PoliciesList CloudIP=$PublicIp SrcIP=$DefMikroTikSrcNet] } else={ #   ... #      ,    ( ) :set PoliciesList ([:put [$subGetPoliciesByPeer PeerIP=$CheckIP CloudIP=$PublicIp SrcIP=$DefMikroTikSrcNet action="enable"]]) } :set Exit true } } else={ :log error ("[schedule CheckActiveVpnServer] ---&gt; DDNS-IP ---&gt; " . $PublicIp . " ---&gt; VPN-IP ---&gt; " . $CheckIP . " ---&gt; Ping Result ---&gt; " . $PingResult) } } } } :set n ($n+1) } }</code> </pre><br></div></div><br><pre> <code class="plaintext hljs">/system scheduler add interval=1h name=scheduleCheckIPSecSADstAddrFromDNS on-event=\ "/system script run scriptSetIPSecSADstAddrFromDNS" policy=read,write \ start-date=oct/30/2017 start-time=00:10:00 add name=scheduleStartup on-event=":global StartupScript true :global RepeatRun false /system script run scriptFunctionsList" policy=\ ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon \ start-time=startup add interval=5m name=scheduleCheckActiveVpnServer on-event=\ "/system script run scriptCheckActiveVpnServer" policy=\ ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon \ start-date=nov/29/2017 start-time=00:00:00</code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Horario de listado de horario</font></font></b> <div class="spoiler_text"><pre> <code class="plaintext hljs">:global StartupScript true :global RepeatRun false /system script run scriptFunctionsList</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programar listado scheduleCheckIPSecSADstAddrFromDNS</font></font></b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/system script run scriptSetIPSecSADstAddrFromDNS</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lista de programaci贸n scheduleCheckActiveVpnServer</font></font></b> <div class="spoiler_text"><pre> <code class="plaintext hljs">/system script run scriptCheckActiveVpnServer</code> </pre><br></div></div><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El toque final:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para que MikroTik se ponga en contacto correctamente con los servidores DNS de la empresa ubicados detr谩s de Kerio Control, debe agregar registros est谩ticos con sus direcciones en MikroTik, en la secci贸n IP ---&gt; DNS ---&gt; Est谩tica ... 隆 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bueno, en alg煤n lugar as铆! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Espero no haberme equivocado nunca y no haya olvidado nada ...</font></font><br><br>  Gracias por su atencion! <br><br>  ps <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Historia de ediciones y cambios:</font></font></b> <br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se agreg贸 la secci贸n "驴Qu茅 obtenemos en la salida?:"; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se ha agregado un comentario a la direcci贸n de red de la empresa matriz; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cambi贸 las direcciones IP de las redes de los grupos de ISP utilizados en la descripci贸n de la configuraci贸n; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se agreg贸 el elemento "Toque final:"; </font></font></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439736/">https://habr.com/ru/post/439736/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439726/index.html">Lock-in: 驴verdad o ficci贸n?</a></li>
<li><a href="../439728/index.html">Configure la copia de seguridad y recuperaci贸n completas y separadas de Zimbra OSE sin usar Zextras</a></li>
<li><a href="../439730/index.html">Organizaci贸n del reductor a trav茅s de una clase est谩ndar.</a></li>
<li><a href="../439732/index.html">Lazarus - animaci贸n simple usando el componente TImageFragment</a></li>
<li><a href="../439734/index.html">Implementar Kubernetes en el escritorio en minutos con MicroK8s</a></li>
<li><a href="../439738/index.html">En busca del bot贸n "Hacer bien". Zyxel en la red de peque帽as y medianas empresas</a></li>
<li><a href="../439742/index.html">Admisi贸n al programa Master JetBrains en la Universidad ITMO</a></li>
<li><a href="../439744/index.html">Investigadores del MIT dise帽aron "rectenna" que convierte las se帽ales de Wi-Fi en electricidad</a></li>
<li><a href="../439746/index.html">Comprender las promesas de JavaScript</a></li>
<li><a href="../439748/index.html">El resumen de materiales interesantes para el desarrollador m贸vil # 285 (del 4 al 10 de febrero)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>