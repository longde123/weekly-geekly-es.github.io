<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👉🏿 👂 🖍️ Petualangan Malvari yang Sulit dipahami, Bagian III: Skrip VBA yang rumit untuk Tawa dan Keuntungan 🆎 🍩 😥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini adalah bagian dari seri Fileless Malware. Semua bagian seri lainnya: 



- Petualangan Malvari yang Elusif, Bagian I 
- The Adventures of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Petualangan Malvari yang Sulit dipahami, Bagian III: Skrip VBA yang rumit untuk Tawa dan Keuntungan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/varonis/blog/459506/"><img src="https://habrastorage.org/webt/d7/wm/qw/d7wmqwc9d8lggs8ryalumg3ivrm.png"><br><br>  Artikel ini adalah bagian dari seri Fileless Malware.  Semua bagian seri lainnya: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Petualangan Malvari yang Elusif, Bagian I</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">The Adventures of the Elusive Malvari, Bagian II: Script VBA Rahasia</a> </li><li>  The Adventures of the Elusive Malvari, Bagian III: Script VBA yang rumit untuk Tawa dan Keuntungan (We Are Here) </li></ul><br>  Dalam dua posting terakhir (di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> dan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ) kita berbicara tentang metode serangan bebas file, tetapi cukup berbahaya.  Sekarang kita akhirnya siap untuk mengambil malware tanpa filel yang nyata.  Situs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">analisis hibrid</a> (selanjutnya disebut HA) adalah sumber daya yang saya andalkan untuk menemukan "makhluk" berbahaya ini.  Sebagai aturan, informasi yang HA berikan untuk setiap sampel: panggilan sistem, lalu lintas internet, dll.  - cukup untuk memenuhi kebutuhan keamanan TI yang khas.  Saya tertarik untuk terjun ke salah satu contoh kode yang sangat membingungkan ini untuk melihat apa yang sebenarnya terjadi di sana. <br><a name="habracut"></a><br>  Jika Anda ingin mengulangi setelah saya, maka saya sarankan Anda melakukan ini di kotak pasir, misalnya, di Amazon Web Services.  Dan jika Anda memeriksa ini di komputer Anda, pastikan untuk mengomentari panggilan sistem yang meluncurkan PowerShell. <br><br><h2>  Di dalam kode VBA yang membingungkan </h2><br>  Malware yang akhirnya saya temukan di situs analisis hibrid adalah skrip VBA yang tertanam dalam dokumen Word.  Seperti yang saya sebutkan terakhir kali, Anda perlu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OfficeMalScanner</a> milik Frank Baldwin untuk melihat kode sebenarnya. <br>  Setelah mengekstrak skrip, saya mengunduh kode ke perpustakaan makro MS Word, dan kemudian meluncurkan debugging langkah-demi-langkah menggunakan debugger bawaan.  Tujuan saya adalah untuk lebih memahami apa yang tersembunyi di balik kebingungan: untuk memainkan analitik IB dan mengalami keberhasilan dan kekecewaan yang terkait dengan pekerjaan ini. <br><br>  Jika Anda, seperti saya, pertama kali memutuskan untuk melakukan ini di debugger, maka kemungkinan besar Anda akan minum lebih dari satu cangkir teh (atau kopi), membuat jalan Anda melalui kode rumit yang menakjubkan atau mengamati, berkedip, pada variabel L_JEK, yang diberi garis "77767E6C797A6F6" . <br>  Bekerja dengan skrip VBA yang membingungkan ini, saya menyadari bahwa hanya sebagian <i>kecil</i> saja yang berguna.  Sebagian besar kode ada hanya untuk menyesatkan Anda. <br>  Pada akhirnya, saya mengambil tangkapan layar sebagian kecil dari kode yang melakukan semua pekerjaan jahat dengan memulai baris perintah PowerShell, yang akhirnya dipicu oleh makro VBA. <br><br><img src="https://habrastorage.org/webt/ga/6i/of/ga6iofetd7knuemnp840w7yj8kg.jpeg"><br><p>  <i>Tricky: ambil saja nilai hex dan kurangi 7 untuk ASCII nyata.</i> </p><br>  Ini sangat sederhana.  Kode VBA berisi dalam beberapa variabel catatan dari baris perintah akhir dalam notasi heksadesimal, dan kemudian mengubahnya menjadi string karakter.  Satu-satunya "trik" di sini adalah bahwa nilai heksadesimal diimbangi dengan 0x07.  Jadi, misalnya, bagian pertama dari string heksadesimal diperoleh dari L_JEK, yang diberi nilai "77767E6C797A6F6".  Jika Anda mengambil 0x77 dan mengurangi 0x07, Anda mendapatkan hex 0x70.  Lakukan hal yang sama untuk 0x76 dan Anda mendapatkan hex 0x6F.  Lihatlah mereka dalam tabel kode ASCII mana saja, dan Anda akan melihat bahwa itu cocok dengan dua huruf pertama dari “powershell”. <br><br>  Sebenarnya, ini bukan keterjeratan yang paling sulit, tetapi ini tidak diperlukan!  Yang perlu Anda lakukan adalah melewati pemindai antivirus yang lalu untuk mencari kata kunci tertentu atau representasi mereka dalam bentuk string ASCII.  Bahwa sampel ini cukup baik dan bagus.  Akhirnya, setelah skrip membuat ulang baris perintah, skrip menjalankannya melalui fungsi CreateProcess (lihat di bawah): <br><br><img src="https://habrastorage.org/webt/l6/ef/44/l6ef44p-f-k1kyxnhb-68nr4rh4.jpeg"><br><p>  <i>Komentari panggilan sistem atau atur breakpoint di depannya.</i> </p><br>  Pikirkan sebentar.  Dokumen Word dikirim ke karyawan melalui email phishing.  Ketika dokumen dibuka, skrip VBA ini secara otomatis memulai sesi PowerShell untuk memulai fase serangan berikutnya.  Tidak ada file yang dapat dieksekusi, dan skrip yang dikaburkan dengan tenang menghindar dari antivirus dan pemindai lainnya. <br><br>  Ini dia Jahat! <br><br>  Demi rasa ingin tahu, saya mengunduh makro lain dari situs HA (di bawah) untuk melihat apa lagi yang terjadi.  Kode kedua ini kira-kira sama dengan kode di atas. <br><br><img src="https://habrastorage.org/webt/jk/ze/pg/jkzepgkpjqmjjvhx3ibylk1xyt4.jpeg"><br><p>  <i>Kode rahasia tertanam dalam VBA.</i> </p><br>  Tetapi kemudian kode ini sedikit lebih inventif dalam cara mengembalikan baris perintah.  Ada fungsi decoding yang disebut "d" yang menyaring karakter dari string dasar, membandingkannya dengan string kontrol kedua.  Ini sudah merupakan gagasan tingkat sekolah menengah, dan juga melakukan pekerjaan yang sangat baik: dengan mudah menghindari scanner dan trik admin yang hanya melihat log untuk tindakan yang tidak biasa. <br><br><h2>  Perhentian selanjutnya </h2><br>  Dalam seri publikasi pertama saya tentang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kebingungan,</a> saya menunjukkan bahwa log peristiwa Windows mencatat banyak detail dari sesi PowerShell, yaitu, jika Anda mengaktifkan pengaturan yang sesuai untuk dapat melakukan analisis mendalam setelah <i>fakta peretasan</i> . <br><br>  Tentu saja, ini juga memiliki kompleksitas tertentu dari serangan bebas file, karena hampir tidak mungkin untuk menentukan apakah skrip PowerShell melakukan sesuatu yang buruk dengan hanya memeriksa perintah di sana sambil melihat peristiwa log keamanan. <br><br>  Kenapa kamu bertanya? <br><br>  Karena sesi PowerShell dimulai setiap saat, dan kode berbahaya dari sesi PowerShell dari satu peretas dapat diluncurkan pada saat yang sama dengan kode yang sah dari administrator IT PowerShell yang baik.  Jika Anda menerima pemberitahuan setiap kali skrip PS mengunduh sesuatu dari Internet, terlalu banyak kesalahan positif akan dihasilkan. <br><br>  <strong>Kesimpulannya</strong> dapat ditarik sebagai berikut: kita melihat ketidakmampuan alat pertahanan perimeter tradisional untuk menghentikan serangan seperti itu, email phishing dan malware FUD, dan prospek yang bagus untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">analisis perilaku</a> . <br><br>  Singkatnya, ini adalah pertempuran yang sengaja dihilangkan untuk menghentikan peretas masuk ke dalam perimeter.  Strategi terbaik adalah mengidentifikasi akses yang tidak biasa dan mencurigakan ke file dan meluncurkan aplikasi, dan kemudian menanggapinya dengan menonaktifkan akun atau mengambil tindakan lain dalam menanggapi pelanggaran. <br><br>  Pada bagian selanjutnya, kita akan melihat jenis serangan bebas file yang lebih canggih. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id459506/">https://habr.com/ru/post/id459506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id459494/index.html">Cara meluncurkan startup b2c yang berkembang setelah hackathon</a></li>
<li><a href="../id459498/index.html">Slurm - Cara Mudah Untuk Memecah Menjadi Tema Kubernetes</a></li>
<li><a href="../id459500/index.html">HTML adalah web</a></li>
<li><a href="../id459502/index.html">Kami terus mengembangkan platform petualangan untuk Rusia: fitur antarmuka dan preferensi musim panas</a></li>
<li><a href="../id459504/index.html">Kursus Desainer Game Muda: Cara Menghitung Keseimbangan Karakter dan Peralatan tanpa Matematika</a></li>
<li><a href="../id459508/index.html">5 slide yang diabaikan oleh presenter berpengalaman</a></li>
<li><a href="../id459514/index.html">.NET: Alat untuk bekerja dengan multithreading dan asynchrony. Bagian 2</a></li>
<li><a href="../id459518/index.html">Penjelasan tugas python dengan wawancara kerja</a></li>
<li><a href="../id459520/index.html">Sebuah model deret angka dan unsur-unsurnya. Belah ketupat</a></li>
<li><a href="../id459528/index.html">Bagaimana cara kami mengajar ekologi Prancis dan mengumpulkan botol</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>