<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ù§Ô∏è üë©‚Äç‚úàÔ∏è üßëüèº‚Äçü§ù‚Äçüßëüèº Problemas de registro de eventos de seguridad del sistema de Windows üèúÔ∏è ü§ó üëáüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Los sistemas operativos Windows tienen un sistema de registro de eventos de seguridad bastante bueno. Se han escrito muchas cosas buenas sobre ella en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Problemas de registro de eventos de seguridad del sistema de Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476464/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/r3/ka/al/r3kaaljcd70px_fvggsc4jmu4es.jpeg"></a> <br><br>  Los sistemas operativos Windows tienen un sistema de registro de eventos de seguridad bastante bueno.  Se han escrito muchas cosas buenas sobre ella en varias publicaciones y rese√±as, pero este art√≠culo tratar√° sobre otra cosa.  Aqu√≠ hablamos de problemas y deficiencias en este sistema.  Algunos de los problemas considerados no ser√°n cr√≠ticos, solo complicar√°n los procedimientos para analizar eventos, mientras que otros plantear√°n amenazas de seguridad muy graves. <br><br>  Los problemas identificados se probaron en Windows 7 Maximum (versi√≥n rusa), Windows 7 Professional (versi√≥n inglesa), Windows 10 Pro (versi√≥n rusa), Windows Server 2019 Datacenter (versi√≥n rusa).  Todos los sistemas operativos han sido completamente actualizados. <br><a name="habracut"></a><br><h2>  Problema No. 1. Sistema de gesti√≥n de par√°metros de auditor√≠a fallido </h2><br>  <i>El problema se confirma en Windows 7/10 / Server 2019.</i> <br><br><h3>  Descripci√≥n del problema </h3><br>  Tome Windows 7 e inst√°lelo con la configuraci√≥n predeterminada.  No ingresaremos al dominio.  Veamos la configuraci√≥n de auditor√≠a de eventos de seguridad.  Para hacer esto, abra el complemento Pol√≠ticas de seguridad local (secpol.msc o Panel de control -&gt; Herramientas administrativas -&gt; Pol√≠ticas de seguridad local) y observe la configuraci√≥n b√°sica de auditor√≠a (Configuraci√≥n de seguridad -&gt; Pol√≠ticas locales -&gt; Pol√≠ticas de auditor√≠a) ) <br><br><img src="https://habrastorage.org/webt/bd/sm/cw/bdsmcwohkqtxgp9dzcac8p63daw.jpeg"><br><br>  Como puede ver, la auditor√≠a no est√° configurada.  Ahora veamos las pol√≠ticas de auditor√≠a avanzadas ("Configuraci√≥n de seguridad -&gt; Configuraci√≥n de pol√≠tica de auditor√≠a avanzada -&gt; Pol√≠ticas de auditor√≠a del sistema - Objeto de pol√≠tica de grupo local"). <br><br><img src="https://habrastorage.org/webt/om/oy/po/omoypoc15q9ynn0osefv-gawd4i.jpeg"><br><br>  Aqu√≠ la auditor√≠a tampoco est√° configurada.  Si es as√≠, en teor√≠a no deber√≠a haber ning√∫n evento de seguridad en los registros.  Lo comprobamos  Abra el registro de seguridad (eventvwr.exe o "Panel de control -&gt; Herramientas administrativas -&gt; Ver eventos"). <br><br><img src="https://habrastorage.org/webt/j0/s4/ot/j0s4otidlwtntmyx-s02-kom3uk.jpeg"><br><br>  <b>Pregunta: "¬øDe d√≥nde viene el evento en el registro de seguridad si la auditor√≠a no est√° configurada?"</b> <br><br><h3>  Explicaci√≥n </h3><br>  Para comprender la raz√≥n de este comportamiento, debe "ocultarse" al sistema operativo.  Para empezar, trataremos con pol√≠ticas de auditor√≠a b√°sicas y avanzadas. <br><br>  Antes de Windows Vista, solo hab√≠a una pol√≠tica de auditor√≠a, que ahora se llama b√°sica.  El problema era que la granularidad de la gesti√≥n de auditor√≠a en ese momento era muy baja.  Entonces, si se requer√≠a rastrear el acceso a los archivos, entonces inclu√≠an la categor√≠a de la pol√≠tica b√°sica "Auditar el acceso a los objetos".  Como resultado, adem√°s de las operaciones de archivo, un mont√≥n de otros eventos de "ruido" se vertieron en el registro de seguridad.  Esto complic√≥ enormemente el procesamiento de registros y usuarios desconcertados. <br><br>  Microsoft escuch√≥ este "dolor" y decidi√≥ ayudar.  El problema es que Windows se basa en el concepto de compatibilidad con versiones anteriores, y realizar cambios en el mecanismo de gesti√≥n de auditor√≠a existente habr√≠a eliminado esta compatibilidad.  Por lo tanto, el vendedor fue por el otro lado.  Cre√≥ una nueva herramienta y la llam√≥ Pol√≠ticas avanzadas de auditor√≠a. <br><br>  La esencia de la herramienta radica en el hecho de que las categor√≠as de pol√≠ticas avanzadas se hicieron a partir de las categor√≠as de pol√≠ticas b√°sicas de auditor√≠a, y que, a su vez, se dividieron en subcategor√≠as que pueden activarse y desactivarse individualmente.  Ahora, si necesita rastrear el acceso a los archivos en las pol√≠ticas de auditor√≠a avanzadas, debe activar solo la subcategor√≠a "Sistema de archivos", que se incluye en la categor√≠a "Acceso a objetos".  Al mismo tiempo, los eventos de "ruido" relacionados con el acceso al registro o el filtrado del tr√°fico de red no se incluir√°n en el registro de seguridad. <br><br>  Una gran confusi√≥n en todo este esquema es que los nombres de las categor√≠as de pol√≠ticas b√°sicas de auditor√≠a y avanzadas no coinciden, y al principio puede parecer que estas son cosas completamente diferentes, pero esto no es as√≠. <br><br>  Aqu√≠ hay una tabla de conformidad de los nombres de las categor√≠as b√°sicas y avanzadas de gesti√≥n de auditor√≠a. <br><div class="scrollable-table"><table><tbody><tr><td>  <b>Nombre de las pol√≠ticas b√°sicas de auditor√≠a.</b> </td><td>  <b>Nombre de la pol√≠tica de auditor√≠a extendida.</b> </td></tr><tr><td>  Auditor√≠a de acceso al servicio de directorio </td><td>  Acceso al servicio de directorio (DS) </td></tr><tr><td>  Auditor√≠a de acceso a objetos </td><td>  Acceso a las instalaciones </td></tr><tr><td>  Auditor√≠a de privilegios </td><td>  Uso de derechos </td></tr><tr><td>  Auditor√≠a de inicio de sesi√≥n </td><td>  Entrada / salida </td></tr><tr><td>  Auditar eventos de inicio de sesi√≥n </td><td>  Inicio de sesi√≥n de cuenta </td></tr><tr><td>  Cambios en la pol√≠tica de auditor√≠a </td><td>  Cambio de pol√≠tica </td></tr><tr><td>  Auditar eventos del sistema </td><td>  El sistema </td></tr><tr><td>  Auditor√≠a de gesti√≥n de cuenta </td><td>  Gesti√≥n de cuentas </td></tr><tr><td>  Auditor√≠a de seguimiento de procesos </td><td>  Seguimiento detallado </td></tr></tbody></table></div><br>  Es importante comprender que las categor√≠as b√°sicas y avanzadas controlan esencialmente lo mismo.  La inclusi√≥n de una categor√≠a de pol√≠tica de auditor√≠a b√°sica lleva a la inclusi√≥n de la categor√≠a de pol√≠tica de auditor√≠a extendida correspondiente y, como resultado, todas sus subcategor√≠as.  Para evitar consecuencias imprevistas, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Microsoft no recomienda el</a> uso de pol√≠ticas de auditor√≠a b√°sicas y avanzadas al mismo tiempo. <br><br>  Ahora es el momento de averiguar d√≥nde se almacenan las configuraciones de auditor√≠a.  Para comenzar, presentamos una serie de conceptos: <br><br><ol><li>  <i>Pol√≠ticas de auditor√≠a efectivas</i> : informaci√≥n almacenada en la RAM que determina los par√°metros operativos actuales de los m√≥dulos del sistema operativo que implementan funciones de auditor√≠a. </li><li>  <i>Pol√≠ticas de auditor√≠a guardadas</i> : informaci√≥n almacenada en el registro en HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv y utilizada para determinar pol√≠ticas de auditor√≠a efectivas despu√©s de un reinicio del sistema. </li></ol><br>  Consideraremos varias herramientas administrativas e indicaremos qu√© par√°metros de auditor√≠a muestran y qu√© conjunto.  Los datos en la tabla se basan en experimentos. <br><div class="scrollable-table"><table><tbody><tr><td>  <b>Nombre de fondos</b> </td><td>  <b>Pol√≠ticas de auditor√≠a mostradas</b> </td><td>  <b>Pol√≠ticas de auditor√≠a persistentes</b> </td></tr><tr><td>  Pol√≠ticas b√°sicas de auditor√≠a del complemento Pol√≠ticas de seguridad local </td><td>  Pol√≠ticas de auditor√≠a efectivas </td><td>  Pol√≠ticas de auditor√≠a efectivas, pol√≠ticas de auditor√≠a guardadas </td></tr><tr><td>  Pol√≠ticas de auditor√≠a avanzadas del complemento Pol√≠ticas de seguridad local </td><td colspan="2"> Archivo <code>%SystemRoot%\System32\GroupPolicy\Machine\Microsoft\Windows NT\Audit\audit.csv</code> </td></tr><tr><td>  Utilidad Auditpol </td><td>  Configuraci√≥n de auditor√≠a guardada </td><td>  Configuraci√≥n de auditor√≠a efectiva, configuraci√≥n de auditor√≠a guardada </td></tr></tbody></table></div><br>  Expliquemos la tabla con ejemplos. <br><br>  <b>Ejemplo 1</b> <br><br>  Si ejecuta auditpol para ver la configuraci√≥n de auditor√≠a: <br>  <code>auditpol /get /category:*</code> , luego se mostrar√°n las configuraciones de auditor√≠a guardadas, es decir, las almacenadas en el registro en HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv. <br><br>  <b>Ejemplo 2</b> <br><br>  Si ejecuta la misma utilidad, pero ya para establecer los par√°metros: <br>  <code>auditpol /set /category:*</code> , se modificar√° la configuraci√≥n de auditor√≠a efectiva y la configuraci√≥n de auditor√≠a guardada. <br><br>  Un comentario separado requiere el orden en que se muestran las configuraciones de auditor√≠a en las "Pol√≠ticas b√°sicas de auditor√≠a" del complemento "Pol√≠ticas de seguridad local".  La categor√≠a de la pol√≠tica de auditor√≠a b√°sica se muestra como establecida si se instalan todas las subcategor√≠as de la pol√≠tica de auditor√≠a extendida correspondiente.  Si al menos uno de ellos no est√° instalado, la pol√≠tica se mostrar√° como no instalada. <br><br>  <b>Ejemplo 3</b> <br><br>  Usando el <code>auditpol /set /category:*</code> , el <code>auditpol /set /category:*</code> configur√≥ todas las subcategor√≠as de auditor√≠a en el Modo de √©xito de auditor√≠a.  Adem√°s, si va a las "Pol√≠ticas b√°sicas de auditor√≠a" del complemento "Pol√≠ticas de seguridad local", se instalar√° una Auditor√≠a de √©xito frente a cada categor√≠a. <br><br>  <b>Ejemplo 4</b> <br><br>  Ahora el administrador ha <code>auditpol /clear</code> y ha restablecido todas las configuraciones de auditor√≠a.  Luego configur√≥ la auditor√≠a del sistema de archivos ejecutando <code>auditpol /set /subcategory:" "</code> .  Ahora, si va a las "Pol√≠ticas b√°sicas de auditor√≠a" del complemento "Pol√≠ticas de seguridad locales", todas las categor√≠as se definir√°n en el estado "Sin auditor√≠a", ya que no hay una sola categor√≠a de la pol√≠tica de auditor√≠a extendida completamente definida. <br><br>  Ahora, finalmente, podemos responder a la pregunta de d√≥nde provienen los registros en el sistema operativo reci√©n instalado.  La cuesti√≥n es que despu√©s de la instalaci√≥n, la auditor√≠a en Windows se configura y define en la configuraci√≥n de auditor√≠a guardada.  Puede verificar esto ejecutando el <code>auditpol /get /category:*</code> . <br><br><img src="https://habrastorage.org/webt/dx/ot/1s/dxot1swbotmghm7jxzo0zuafvcy.jpeg"><br><br>  En las Pol√≠ticas b√°sicas de auditor√≠a del complemento Pol√≠ticas de seguridad local, esta informaci√≥n de auditor√≠a no se muestra, ya que una o m√°s subcategor√≠as no est√°n definidas en todas las categor√≠as.  En las Pol√≠ticas de auditor√≠a avanzadas del complemento Pol√≠ticas de seguridad local, esta informaci√≥n no se muestra porque el complemento solo funciona con la configuraci√≥n de auditor√≠a almacenada en el archivo% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv. <br><br><h3>  ¬øCu√°l es la esencia del problema? </h3><br>  Al principio puede parecer que todo esto no es un problema, pero no lo es.  El hecho de que todas las herramientas muestren los par√°metros de auditor√≠a de diferentes maneras crea la oportunidad para la manipulaci√≥n maliciosa de las pol√≠ticas y, como resultado, los resultados de la auditor√≠a. <br><br>  <b>Considere el escenario probable</b> <br><br>  Deje que una estaci√≥n de trabajo tecnol√≥gica basada en Windows 7 funcione en la red corporativa. <br><br>  La m√°quina no est√° incluida en el dominio y realiza las funciones de un robot que env√≠a informes diariamente a las autoridades reguladoras.  Los atacantes de una forma u otra obtuvieron acceso remoto con derechos de administrador.  Al mismo tiempo, el objetivo principal de los atacantes es el espionaje, y la tarea es permanecer sin ser detectados en el sistema.  Los atacantes decidieron en secreto que no deber√≠a haber eventos con el c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4719 "Cambios</a> en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pol√≠tica de auditor√≠a"</a> en el registro de seguridad, para deshabilitar la auditor√≠a de acceso a archivos, pero al mismo tiempo que todas las herramientas de administraci√≥n dicen que la auditor√≠a est√° habilitada.  Para lograr la tarea, realizaron las siguientes acciones: <br><br><ol><li>  En la estaci√≥n de trabajo atacada, se otorgaron permisos de escritura a la clave de registro HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv y exportaron esta clave a un archivo llamado "+ fs.reg". </li><li>  Importamos este archivo en otra computadora, lo reiniciamos y luego desactivamos la auditor√≠a del sistema de archivos usando auditpol, despu√©s de lo cual exportamos la clave de registro anterior al archivo "-fs.reg". </li><li>  En la m√°quina atacada, el archivo "-fs.reg" se import√≥ al registro. </li><li>  Hicimos una copia de seguridad del archivo% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv ubicado en la m√°quina atacada y luego eliminamos la subcategor√≠a del sistema de archivos. </li><li>  Reiniciaron la estaci√≥n de trabajo atacada y luego reemplazaron el archivo% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv con una copia de seguridad previamente guardada y tambi√©n importaron el archivo "+ fs.reg" </li></ol><br>  Como resultado de todas estas manipulaciones, no hay entradas de cambio de pol√≠tica en el registro de seguridad, todas las herramientas muestran que la auditor√≠a est√° habilitada, pero en realidad no funciona. <br><br><h2>  Problema No. 2. Registro fallido de operaciones para eliminar archivos, directorios y claves de registro </h2><br>  <i>El problema se confirma en Windows 7/10 / Server 2019.</i> <br><br><h3>  Descripci√≥n del problema </h3><br>  Para que una operaci√≥n elimine un archivo, directorio o clave de registro, el sistema operativo genera una secuencia de eventos con los c√≥digos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4663</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4660</a> .  El problema es que de toda la secuencia de eventos, esta pareja no es tan f√°cil de conectarse entre s√≠.  Para hacer esto, los eventos analizados deben tener los siguientes par√°metros: <br><br>  <i>Evento 1. C√≥digo 4663 "Se intent√≥ obtener acceso al objeto".</i>  Par√°metros del evento: <br>  "ObjectType" = Archivo. <br>  "ObjectName" = nombre del archivo o directorio que se va a eliminar. <br>  "HandleId" = manejar el archivo que se va a eliminar. <br>  "AcessMask" = 0x10000 (Este c√≥digo corresponde a la operaci√≥n ELIMINAR. Puede encontrar el descifrado de todos los c√≥digos de operaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el sitio web de Microsoft</a> ). <br><br><img src="https://habrastorage.org/webt/ez/it/6z/ezit6zapdorhyh5blpomzppv1dc.jpeg"><br><br>  <i>Evento 2. C√≥digo 4660 "Objeto eliminado".</i> <br>  Par√°metros del evento: <br><br>  "HandleId" = "Eventos de HandleId 1" <br>  "System \ EventRecordID" = "System \ EventRecordID del evento 1" + 1. <br><br><img src="https://habrastorage.org/webt/qy/bj/6a/qybj6a3724rrph9wsqki1bpcntm.jpeg"><br><br>  Con la eliminaci√≥n de la clave de registro (clave), todo es igual, solo en el primer evento con el c√≥digo 4663, el par√°metro "ObjectType" = Clave. <br><br>  Tenga en cuenta que la eliminaci√≥n de valores en el registro es descrita por otro evento (c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4657</a> ) y no causa tales problemas. <br><br><h3>  Caracter√≠sticas de eliminar archivos en Windows 10 y Server 2019 </h3><br>  En Windows 10 / Server 2019, hay dos formas de eliminar un archivo. <br><br><ol><li>  Si el archivo se elimina a la papelera, entonces, como antes, la secuencia de eventos 4663 y 4660. </li><li>  Si el archivo se elimina permanentemente (m√°s all√° de la papelera de reciclaje), entonces con un solo evento con el c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4659</a> . </li></ol><br>  Algo extra√±o sucedi√≥.  Si antes, para determinar los archivos eliminados, era necesario monitorear la totalidad de los eventos 4663 y 4660, ahora Microsoft ha "ido a conocer a los usuarios", y en lugar de dos eventos, ahora necesitamos monitorear tres.  Tambi√©n vale la pena se√±alar que el procedimiento para eliminar directorios no ha cambiado; como antes, consta de dos eventos 4663 y 4660. <br><br><h3>  ¬øCu√°l es la esencia del problema? </h3><br>  El problema es que descubrir qui√©n elimin√≥ el archivo o directorio se convierte en una tarea no trivial.  En lugar de la b√∫squeda banal del evento correspondiente en el registro de seguridad, es necesario analizar la secuencia de eventos, lo que es bastante dif√≠cil de hacer manualmente.  En habr incluso sobre esto hab√≠a un art√≠culo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Auditar la eliminaci√≥n y el acceso a archivos y grabar eventos en un archivo de registro usando Powershell"</a> . <br><br><h2>  Problema n√∫mero 3 (cr√≠tico).  Registro fallido de la operaci√≥n de cambio de nombre para archivos, directorios y claves de registro </h2><br>  <i>El problema se confirma en Windows 7/10 / Server 2019.</i> <br><br><h3>  Descripci√≥n del problema </h3><br>  Este problema tiene dos subproblemas: <br><br><ol><li>  En los eventos generados por el sistema durante el cambio de nombre, el nuevo nombre del objeto no se fija en ning√∫n lado. </li><li>  El procedimiento de cambio de nombre es muy similar a la eliminaci√≥n.  Solo se puede distinguir por el hecho de que el primer evento con el c√≥digo 4663, con el par√°metro "AcessMask" = 0x10000 (DELETE) <b>no tiene el</b> evento 4660. </li></ol><br>  Vale la pena se√±alar que con respecto al registro, este problema se aplica solo a las claves.  El cambio de nombre de los valores en el registro se describe mediante una secuencia de eventos 4657 y no causa tales quejas, aunque, por supuesto, ser√≠a mucho m√°s conveniente si solo hubiera un evento. <br><br><h3>  ¬øCu√°l es la esencia del problema? </h3><br>  Adem√°s de la dificultad de buscar operaciones de cambio de nombre de archivos, esta caracter√≠stica del registro en diario no permite el seguimiento del ciclo de vida completo de los objetos del sistema de archivos o las claves de registro.  Como resultado, se vuelve extremadamente dif√≠cil determinar el historial de un archivo que ha sido renombrado muchas veces en un servidor de archivos utilizado activamente. <br><br><h2>  Problema n√∫mero 4 (cr√≠tico).  No se puede rastrear la creaci√≥n de directorios y claves de registro </h2><br>  <i>El problema se confirma en Windows 7/10 / Server 2019.</i> <br><br><h3>  Descripci√≥n del problema </h3><br>  Windows no rastrea la creaci√≥n de un directorio del sistema de archivos y una clave de registro.  Esto consiste en el hecho de que el sistema operativo no genera un evento que contendr√≠a el nombre del directorio creado o la clave de registro, y cuyos par√°metros indicar√≠an que esta es la operaci√≥n de creaci√≥n. <br><br>  Te√≥ricamente, por signos indirectos, el hecho de crear un cat√°logo es posible.  Por ejemplo, si se cre√≥ a trav√©s del "Explorador", durante el proceso de creaci√≥n, se generar√°n eventos de sondeo para los atributos del nuevo directorio.  El problema es que si crea un directorio a trav√©s del comando <code>mkdir</code> , no se genera ning√∫n evento.  Lo mismo es cierto para crear claves en el registro. <br><br><h3>  ¬øCu√°l es la esencia del problema? </h3><br>  Este problema hace que sea muy dif√≠cil investigar los incidentes de seguridad de la informaci√≥n.  No hay una explicaci√≥n razonable para el hecho de que esta informaci√≥n no se registra en las revistas. <br><br><h2>  Problema n√∫mero 5 (cr√≠tico).  Configuraci√≥n de auditor√≠a incorrecta en versiones rusas de Windows </h2><br>  <i>La presencia del problema se confirma en las ediciones rusas de Windows 7/10 / Server 2019.</i> <br><br><h3>  Descripci√≥n del problema </h3><br>  Hay un error en las versiones rusas de Windows que hace que el sistema de gesti√≥n de auditor√≠a de seguridad no funcione. <br><br><h3>  S√≠ntomas </h3><br>  Cambiar las pol√≠ticas de seguridad avanzadas no afecta la configuraci√≥n de auditor√≠a efectiva o, en otras palabras, las pol√≠ticas no se aplican.  Por ejemplo, el administrador activ√≥ la subcategor√≠a "Iniciar sesi√≥n", reinici√≥ el sistema, ejecut√≥ el <code>auditpol /get /category:*</code> y esta subcategor√≠a permanece <code>auditpol /get /category:*</code> .  El problema es relevante tanto para equipos de dominio administrados a trav√©s de pol√≠ticas de grupo como para equipos que no son de dominio administrados usando un GPO local configurado a trav√©s del complemento Pol√≠ticas de seguridad local. <br><br><h3>  Razones </h3><br>  El problema surge si el administrador ha activado al menos una de las subcategor√≠as "fallidas" de las pol√≠ticas de auditor√≠a avanzadas.  Tales categor√≠as fallidas, en particular, incluyen: <br><br><ol><li>  Uso de derechos -&gt; Auditar el uso de derechos que afectan los datos confidenciales.  GUID: {0cce9228-69ae-11d9-bed3-505054503030}. </li><li>  Uso de derechos -&gt; Auditar el uso de derechos que no afectan los datos confidenciales.  GUID: {0cce9229-69ae-11d9-bed3-505054503030}. </li><li>  Acceso a objetos -&gt; Auditar eventos creados por aplicaciones.  GUID: {0cce9222-69ae-11d9-bed3-505054503030}. </li></ol><br><h3>  Recomendaciones para resolver el problema. </h3><br>  Si el problema a√∫n no se ha producido, no active las subcategor√≠as "fallidas" indicadas.  Si los eventos de estas subcategor√≠as son muy necesarios, utilice la utilidad auditpol para activarlos o administre la auditor√≠a utilizando pol√≠ticas b√°sicas. <br><br>  Si ocurre un problema, debe: <br><br><ol><li>  Desde el directorio de directivas de grupo de dominio, elimine el archivo \ Machine \ microsoft \ windows nt \ Audit \ audit.csv </li><li>  De todas las computadoras que tienen problemas con la auditor√≠a, elimine los archivos:% SystemRoot% \ security \ audit \ audit.csv,% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv </li></ol><br><h3>  ¬øCu√°l es la esencia del problema? </h3><br>  La presencia de este problema reduce la cantidad de eventos de seguridad que se pueden monitorear regularmente a trav√©s de pol√≠ticas de auditor√≠a avanzadas, y tambi√©n crea amenazas para desconectar, bloquear y desestabilizar la administraci√≥n del sistema de auditor√≠a en la red corporativa. <br><br><h2>  Problema n√∫mero 6 (cr√≠tico).  Maldici√≥n "Nuevo texto document.txt ... as√≠ como Nuevo bitmap.bmp" </h2><br>  <i>El problema se ha confirmado en Windows 7. Falta el problema en Windows 10 / Server 2019.</i> <br><br><h3>  Descripci√≥n del problema </h3><br>  Este es un problema muy extra√±o que fue descubierto por accidente.  La esencia del problema es que el sistema operativo tiene un vac√≠o que le permite evitar la auditor√≠a de la creaci√≥n de archivos. <br><br>  <b>Parte preparatoria:</b> <br><br><ol><li>  Tome un Windows 7 reci√©n instalado. </li><li>  Restablezca todas las configuraciones de auditor√≠a utilizando el <code>auditpol /clear</code> .  Este art√≠culo es opcional y sirve solo para la conveniencia de analizar revistas. </li><li>  Configuramos la auditor√≠a del sistema de archivos ejecutando <code>auditpol /set /subcategory:" "</code> . </li><li>  Creemos el directorio C: \ TEST y asignemos par√°metros de auditor√≠a para la cuenta "Everything": "Crear archivos / Escribir datos", "Crear carpetas / Escribir datos", "Escribir atributos", "Escribir atributos adicionales", "Eliminar subcarpetas y archivos "," Eliminar "," Cambio de permisos "," Cambio de propiedad ", es decir, todo lo relacionado con la escritura de datos en el sistema de archivos. </li></ol><br>  Para mayor claridad, antes de cada experimento, borraremos el registro de seguridad del sistema operativo. <br><br>  <b>Experimento 1.</b> <br>  <b>Nosotros hacemos:</b> <br><br>  Desde la l√≠nea de comando, ejecute el comando: <code>echo &gt; "c:\test\  .txt"</code> <br>  <b>Observamos:</b> <br><br>  Tras la creaci√≥n del archivo, apareci√≥ un evento con el c√≥digo 4663 en el registro de seguridad que contiene el nombre del archivo que se est√° creando en el campo "ObjectName" y 0x2 en el campo "AccessMask" ("Escribir datos o agregar un archivo"). <br><br><img src="https://habrastorage.org/webt/k3/cn/6l/k3cn6ltuqg-gclek4pgtn7u_tea.jpeg"><br><br>  Para realizar los siguientes experimentos, borramos la carpeta y el registro de eventos. <br><br>  <b>Experimento 2.</b> <br>  <b>Nosotros hacemos:</b> <br><br>  Abra la carpeta C: \ TEST a trav√©s del Explorador y use el men√∫ contextual "Crear -&gt; Documento de texto", llamado haciendo clic derecho, cree el archivo "Nuevo documento de texto.txt". <br><br><img src="https://habrastorage.org/webt/cc/nh/gj/ccnhgj_6_2xrciyj4m6ubv9hmpk.jpeg"><br><br>  <b>Observamos:</b> <br><br>  ¬°Esta acci√≥n no se reflej√≥ en el registro de eventos!  Adem√°s, no habr√° entradas si se usa el mismo men√∫ contextual para crear un "mapa de bits". <br><br><img src="https://habrastorage.org/webt/-y/52/4b/-y524b96wuzs9eszx5cybyrwsdk.jpeg"><br><br>  <b>Experimento 3.</b> <br>  <b>Nosotros hacemos:</b> <br><br>  Usando el Explorador, abra la carpeta C: \ TEST y usando el men√∫ contextual "Crear -&gt; Documento en formato RTF", llamado haciendo clic derecho, cree el archivo "Nuevo documento en formato RTF.rtf". <br><br>  <b>Observamos:</b> <br><br>  Como en el caso de la creaci√≥n del archivo a trav√©s de la l√≠nea de comando, un evento con el c√≥digo 4663 y el contenido correspondiente apareci√≥ en el registro. <br><br><img src="https://habrastorage.org/webt/de/pf/wq/depfwqhwv1umoii77gpofddmoro.jpeg"><br><br><h3>  ¬øCu√°l es la esencia del problema? </h3><br>  Por supuesto, crear documentos de texto o im√°genes no es particularmente da√±ino.  Sin embargo, si el "Explorador" puede omitir el registro de las operaciones de archivos, entonces el malware podr√° hacerlo. <br><br>  Este problema es quiz√°s el m√°s significativo de todos los considerados, ya que socava seriamente la credibilidad de los resultados de la auditor√≠a de las operaciones de archivos. <br><br><h2>  Conclusi√≥n </h2><br>  La lista de problemas anterior no es exhaustiva.  En el proceso, logramos tropezar con un n√∫mero a√∫n bastante grande de varios defectos menores, que incluyen el uso de constantes localizadas como valores de par√°metros para una serie de eventos, lo que nos obliga a escribir nuestros scripts de an√°lisis para cada localizaci√≥n del sistema operativo, la divisi√≥n il√≥gica de los c√≥digos de eventos en operaciones de significado cercano, por ejemplo, eliminar una clave de registro es una secuencia de eventos 4663 y 4660, y eliminar un valor en el registro es 4657, bueno, e incluso las peque√±as cosas ... <br><br>  Para ser justos, observamos que a pesar de todas las deficiencias, el sistema de registro de eventos de seguridad en Windows tiene una gran cantidad de aspectos positivos.  La soluci√≥n de los problemas cr√≠ticos enumerados aqu√≠ podr√≠a devolver la corona a una mejor soluci√≥n para registrar eventos de seguridad fuera de la caja. <br><br>  ¬°HAGA QUE EL EVENTO DE SEGURIDAD DE WINDOWS REGISTRE DE NUEVO! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/476464/">https://habr.com/ru/post/476464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../476450/index.html">Descripci√≥n general de cPanel: una consola basada en web para administrar sitios y hosting</a></li>
<li><a href="../476452/index.html">Almacenamiento de valor clave o c√≥mo nuestras aplicaciones se han vuelto m√°s convenientes</a></li>
<li><a href="../476454/index.html">Se acerca el 5G: qu√© empresas garantizar√°n la introducci√≥n de nuevas tecnolog√≠as en 2020</a></li>
<li><a href="../476456/index.html">El sistema de cr√©dito social chino no es, en primer lugar, un sistema de evaluaci√≥n ciudadana, sino un API masivo</a></li>
<li><a href="../476460/index.html">El primer formato de archivo de √©xito en Internet no era MP3, sino MIDI</a></li>
<li><a href="../476466/index.html">El libro "Arquitectos de inteligencia"</a></li>
<li><a href="../476468/index.html">Nuevo curso gratuito de an√°lisis de texto de redes neuronales en l√≠nea de Samsung</a></li>
<li><a href="../476474/index.html">Devolvemos Keenetic en el soporte KN-1310 del m√≥dem usb</a></li>
<li><a href="../476476/index.html">Mostrar Gmail solo en html</a></li>
<li><a href="../476478/index.html">Etapas de la introducci√≥n de modelos de aprendizaje autom√°tico en grandes empresas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>