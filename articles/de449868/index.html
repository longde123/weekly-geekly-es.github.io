<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôà ü§¶ ‚õàÔ∏è Versionskontrollmechanismus der GIT-Datenbank (MySQL-Dump-Management) üôã üñ®Ô∏è üë¥üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habra-Liebhaber! Heute habe ich beschlossen, meine Version der Datensicherung von MySql zu teilen und dar√ºber zu sprechen, wie sie f√ºr die Versi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Versionskontrollmechanismus der GIT-Datenbank (MySQL-Dump-Management)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449868/"><p>  Hallo Habra-Liebhaber!  Heute habe ich beschlossen, meine Version der Datensicherung von MySql zu teilen und dar√ºber zu sprechen, wie sie f√ºr die Versionskontrolle in Git verwendet werden kann.  Wenn Sie wissen m√∂chten, wie Sie den Status der Datenbank in allen Entwicklungsphasen √ºberwachen oder einfach die <strong>richtigen</strong> Sicherungen Ihrer Projektdatenbank erstellen und jederzeit bereitstellen k√∂nnen, lesen Sie diese bitte! <a name="habracut"></a></p><br><h3 id="chto-eto">  Was ist das? </h3><br><p>  Dies ist eine Reihe von in BASH geschriebenen Skripten, mit denen sie auf fast jedem Computer arbeiten k√∂nnen, auf dem diese Shell funktioniert, um die Erstellung und Bereitstellung von Sicherungen zu erleichtern.  Die urspr√ºngliche Idee war, dass Sie Datenbank-Haltepunkte erstellen k√∂nnen, wenn Sie ein Projekt von einem Entwicklerteam schreiben und in einer Gita speichern. Ich wei√ü, dass es f√ºr diesen Zweck ernstere Dinge gibt, und diese L√∂sung behauptet nicht, an ihrer Stelle zu sein. </p><br><h3 id="dlya-kogo">  F√ºr wen? </h3><br><p> Sie m√∂chten die Site beispielsweise lieber sofort auf dem Hosting des Kunden entwickeln und den Entwicklungsfortschritt und die √Ñnderungen in der Datenbank √ºberwachen.  Entweder haben Sie wenig Geld (oder die Kr√∂te erw√ºrgt), um es f√ºr gute Datenbankversionskontrollprodukte auszugeben.  Sie k√∂nnen das Projekt auch als Datensicherung f√ºr bestimmte Regeln verwenden, die von Crown verwendet werden k√∂nnen.  Und nat√ºrlich ist es praktisch, wenn Sie ein unerfahrener Entwickler sind und gerade erst anfangen, die Grundlagen der Entwicklung zu erlernen. Sie haben regelm√§√üig den 500. und wissen nicht warum.  Oder Sie entwickeln ein Produkt als Team und m√∂chten es automatisch mit der Produktion synchronisieren, wenn Sie sich an den Master wenden, um den Kunden zu bewerten. </p><br><p>  Betrachten Sie ein Beispiel f√ºr die Standard-Site-Entwicklung auf der Host-Seite (in den meisten F√§llen): </p><br><ol><li>  Es gibt einen Server, auf dem sich das Projekt dreht, und h√∂chstwahrscheinlich handelt es sich entweder um einen lokalen Computer oder um einen Client, auf dem das aktuelle Projekt gehostet wird. </li><li>  Es gibt einen lokalen Computer, f√ºr den Sie arbeiten und der traditionell dort Dateien und Schnappsch√ºsse von Zust√§nden speichert. </li><li>  Und in der Produktion wird hier das Endprodukt zusammengef√ºhrt - es kann aber auch das erste Element sein, nur ein weiterer Ordner. </li></ol><br><h3 id="kak-s-etim-rabotat">  Wie arbeite ich damit? </h3><br><p>  Um die Versionskontrolle der Datenbank mit git zu gew√§hrleisten, m√ºssen Sie die Dumps nat√ºrlich in einigen Phasen abrufen, wo sie irgendwo gespeichert werden sollen, und beim Wechseln der Zweige diesen Punkt ber√ºcksichtigen.  Daf√ºr habe ich Git-Hooks verwendet, die die Dateien der entsprechenden Skripte sind (sie m√ºssen auf dem lokalen Computer installiert sein, auf dem Git verwendet wird).  Abh√§ngig von den Einstellungen der Konfigurationsdatei kann der Arbeitsprozess wie folgt aussehen: </p><br><p>  Wir erstellen einen Zweig (Sicherung erfolgte automatisch) und wechseln, arbeiten, f√ºgen Dateien hinzu, erstellen ein Commit (Sicherung erfolgte automatisch) ... <br>  auf Master-Verifikation umgestellt, die Datenbank auf den vorherigen Zustand umgestellt ... <br>  kehrte zur Entwicklung zur√ºck, fusionierte Niederlassungen, begann.  Das hei√üt,  Backups werden automatisch w√§hrend Commits erstellt. <br>  Entweder vor dem Auschecken erzwungen, wird das Verhalten in der Konfiguration konfiguriert.  Sie k√∂nnen den Export oder Import der Datenbank auf dem Server von Ihrem lokalen Computer aus manuell aufrufen, indem Sie das entsprechende Skript ausf√ºhren. </p><br><p>  F√ºr jedes Skript k√∂nnen Sie mithilfe der Argumente -h oder --help auf klassische Weise Hilfe erhalten. </p><br><p> Ich empfehle nicht, die gesamte Datenbank zu sichern, git mag keine gro√üen Dateien, und in den meisten F√§llen ist dies nicht erforderlich.  Daher k√∂nnen Sie die Konfiguration einfach mit <code>config.ini</code> Da die Einstellungen sowohl auf der Serverseite (auf der mySql ausgel√∂st wird) als auch auf der Clientseite (dem Computer des Entwicklers) verwendet werden, ist dieselbe Datei f√ºr die Konfiguration verantwortlich.  Und nat√ºrlich kann es derselbe Computer sein, wenn Sie lokal entwickeln. </p><br><h3 id="chto-mozhno-nastraivat-dlya-sozdaniya-dampa">  Was kann konfiguriert werden, um einen Speicherauszug zu erstellen </h3><br><ul><li>  Datenbankverbindungseinstellungen und Speicherauszugspfade </li><li>  Angabe eines Anbieters, der nicht nur Datenbankverbindungsdaten abrufen kann, sondern <br>  und leeren Sie den Cache auf dem Server korrekt, wenn Sie die Zweige wechseln. </li><li>  Exportieren Sie die gesamte Datenbank </li><li>  Liste der Tabellen, die vom Export ausgeschlossen werden sollen </li><li>  Oder exportieren Sie bestimmte Tabellen </li><li>  Speichern einer Struktur ohne Einf√ºgen von Daten in bestimmte Tabellen </li><li>  Angeben von Feldern f√ºr Tabellen, deren Werte nicht exportiert werden sollen und sollten <br>  durch Standardwerte ersetzt werden. </li><li>  Separate Regels√§tze in einer Konfiguration, mit denen Sie verschiedene Sicherungen von CRON durchf√ºhren k√∂nnen </li></ul><br><p>  Um den Prozess der Erstellung von Dumps zu erleichtern.  Ich habe Dateianbieter verwendet.  Und einrichten (bisher die einzige) f√ºr die CMS MODX-Revolution.  Basierend darauf k√∂nnen Sie f√ºr jedes CMS denselben Anbieter schreiben. </p><br><h3 id="kratkie-shagi-k-nachalu-raboty">  Kurze Schritte, um loszulegen </h3><br><pre> <code class="plaintext hljs"> ,       .git,   ,     git [git clone ](https://github.com/Setest/.git-db-watcher)          chmod +x install.sh;   ./install.sh   ,     ./install.sh -nh</code> </pre> <br><p>  Jetzt m√ºssen Sie √Ñnderungen an <code>config.ini</code> .  Zum Beispiel so: </p><br><pre> <code class="plaintext hljs">;  [hooks] ; H_CHECK_DB_HASH_BEFORE_CHECKOUT=1 ;      checkout      ;           ;  git checkout -b new_branch_name H_CHECKOUT_FORCE=0 ;        H_CHECKOUT_EVERCOM=1 ;       H_CHECKOUT_CLEARCACHE=1 [common] ;       EXPORT_FILE="db.sql" ;           ;   ./export.sh [develop] ;  db_export.sh   CLI_DB_EXPORT="ssh host '/path/to/project/on/server/.git-db-watcher/db_export.sh'" CLI_DB_IMPORT="ssh host '/path/to/project/on/server/.git-db-watcher/db_import.sh'" ;   [server] PHP_PATH="/usr/local/bin/php" CONFIG_INC_PATH="/path/to/project/on/server/core/config/config.inc.php" PROVIDER=modx DB_TABLES_INCLUDE=site_content DB_TABLES_AUTOPREFIX=1 [server_full_site] PHP_PATH="/usr/local/bin/php" CONFIG_INC_PATH="/path/to/project/on/server/core/config/config.inc.php" ; '' -       DB_CONFIG_     ;  providers PROVIDER=modx ;          DB_CONFIG_HOST= DB_CONFIG_TYPE= DB_CONFIG_USER= DB_CONFIG_PASSWORD= DB_CONFIG_CONNECTION_CHARSET= DB_CONFIG_DBASE= DB_CONFIG_TABLE_PREFIX= DB_CONFIG_DATABASE_DSN= ;        ( ) ;     ; DB_TABLES_INCLUDE=manager_log register_messages user_attributes ; DB_TABLES_INCLUDE=site_content ;    ; DB_TABLES_EXCLUDE=session register_messages mse2_words ec_messages ; ,    ,    DB_TABLES_AUTOPREFIX=1 ;       INSERT DB_TABLES_REMOVE_INSERT="manager_log session register_messages" ; DB_TABLES_REMOVE_INSERT="manager_log" ;        ; DB_TABLES_DEFAULT=user_attributes users DB_TABLES_DEFAULT=user_attributes ;   ,     ;       ,     ;    DB_TABLES_DEFAULT_user_attributes=sessionid logincount lastlogin thislogin ; DB_TABLES_DEFAULT_users=session_stale ;  ,     [only_users] DB_TABLES_INCLUDE=user user_attributes EXPORT_FILE="users.sql" DB_TABLES_DEFAULT=user_attributes user DB_TABLES_DEFAULT_user_attributes=sessionid logincount lastlogin thislogin DB_TABLES_DEFAULT_users=session_stale</code> </pre> <br><p>  Wenn alles richtig konfiguriert ist, k√∂nnen Sie <code>./export.sh</code> und Sie sollten <br>  Auf dem lokalen Computer und auf dem Server wird ein Datenbankspeicherauszug angezeigt. </p><br><h3 id="ostalnye-voprosy">  Andere Fragen </h3><br><blockquote>  Ich muss das Ergebnis auf dem Server an einem anderen Ort speichern: </blockquote><br><pre> <code class="plaintext hljs"> ./db_export.sh --output 1&gt;./xxx.sql</code> </pre> <br><blockquote>  Ich m√∂chte mit den Daten in meinem Abschnitt der Konfigurationsdatei auf den Server exportieren: </blockquote><br><pre> <code class="plaintext hljs"> ./db_export.sh -=only_users --output 1&gt;./users.sql</code> </pre> <br><blockquote>  Ich m√∂chte eine Datenbankdatei importieren, dies jedoch nicht √ºber GIT-Interceptors. </blockquote><br><pre> <code class="plaintext hljs"> ./import.sh ./import.sh EXPORT_FILE=site_name.sql ./import.sh DB_BACKUP_FILE=/.../../site_name.sql ./import.sh --config=site DB_BACKUP_FILE=./site_name.sql</code> </pre> <br><blockquote>  Wie importiere ich auf dem Server? </blockquote><br><pre> <code class="plaintext hljs"> ./db_import.sh &lt; db_backup/db.sql</code> </pre> <br><blockquote>  In verschiedenen Projekten verwende ich CMS xxx und habe es satt, jedes Mal Daten einzugeben <br>  Wie kann ich den Prozess f√ºr die Datenbankverwaltung vereinfachen? </blockquote><p>  Dazu m√ºssen Sie Ihre Provider-Datei analog zu den vorhandenen schreiben. </p><br><blockquote>  Ich habe einen CRON-Job und eine Konfiguration mit dem PHP-Anbieter erstellt, aber es <br>  l√§uft nicht oder der CMS-Site-Cache wird nicht geleert. Was k√∂nnte los sein? </blockquote><p>  Abh√§ngig von den Servereinstellungen und dem Job selbst k√∂nnen CRON-Jobs in einer v√∂llig anderen Umgebung ausgef√ºhrt werden, in der sich der Pfad zum PHP-Pr√§prozessor unterscheiden kann. Infolgedessen wird eine v√∂llig andere Version von PHP ausgef√ºhrt, die nicht mit der Version kompatibel ist, auf der Ihr CMS ausgef√ºhrt wird. </p><br><h3 id="posleslovie">  Nachwort </h3><br><p>  Ich habe nie Skripte auf BASH geschrieben und daher wahrscheinlich <del>  Nagovokodil </del>  Ich bin sicher, es gibt kompetente Leute, die bei Interesse ihre √Ñnderungen hinzuf√ºgen k√∂nnen.  Ich werde das Projekt als das ankommende Interesse und die Identifizierung von Fehlern in der Arbeit entwickeln. </p><br><p>  Und stinken Sie nicht sofort, dass nichts funktioniert. Vielleicht k√∂nnen Sie nicht herausfinden, wie Sie es richtig konfigurieren und installieren (insbesondere, wenn Sie unter Windows arbeiten, BASH jedoch eine Linux-Umgebung ist). </p><br><p>  Installations- und Gebrauchsanweisungen finden Sie in README.  Ich habe versucht, sofort auf Englisch zu schreiben, aber auch wegen meines Amateurlevels wird vielleicht nicht alles klar sein, in Zukunft werde ich auf Russisch schreiben.  Wenn Sie √Ñnderungen an der √úbersetzung oder am Code vornehmen m√∂chten, geben Sie Ihre Gesundheit!  Und wenn es gute Ratschl√§ge gibt - teilen Sie sie. </p><br><p>  PS: Wenn du ganz unten liest, wurde es interessant und wollte es unbedingt versuchen :-) </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dann gehen Sie mutiger zu dieser Referenz!</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de449868/">https://habr.com/ru/post/de449868/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de449858/index.html">Schall√ºbertragung durch Amplitudenmodulation von Ultraschall</a></li>
<li><a href="../de449860/index.html">Cloud Box Office, meine bescheidene Erfahrung</a></li>
<li><a href="../de449862/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 296 (vom 22. bis 26. April)</a></li>
<li><a href="../de449864/index.html">ResNet50. Eigene Implementierung</a></li>
<li><a href="../de449866/index.html">M√∂gliche Angriffe auf HTTPS und wie man sich gegen sie verteidigt</a></li>
<li><a href="../de449870/index.html">Generischer JSONDecoder</a></li>
<li><a href="../de449872/index.html">RxVMS-Grundlagen: RxCommand und GetIt</a></li>
<li><a href="../de449876/index.html">Innovation SSI-2001: Die Geschichte einer der seltensten Soundkarten f√ºr den IBM PC (und seine Nachbildung)</a></li>
<li><a href="../de449878/index.html">Patentforschung in der IT. Der Kurs des jungen K√§mpfers. Teil I. Wie man Kundenanforderungen versteht und eine Berichtsvorlage erstellt</a></li>
<li><a href="../de449880/index.html">Agile Lite: Speziell gegen Burnout</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>