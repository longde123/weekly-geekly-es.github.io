<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôáüèæ üÉè üëÇüèº Comment j'ai appris √† l'IA √† jouer √† Tetris pour NES. Partie 2: AI üë©üèø‚Äçüè≠ ‚ûó üë®‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La premi√®re partie (analyse de code) est ici: https://habr.com/post/420725/ . 

 Algorithme 
 La description 
 L'algorithme effectue en continu les √©t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment j'ai appris √† l'IA √† jouer √† Tetris pour NES. Partie 2: AI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421065/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/2c5/a7e/cfd2c5a7e44131bfc188c3eea6ad5139.png" alt="image"></div><br>  La premi√®re partie (analyse de code) est ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://habr.com/post/420725/</a> . <br><br><h2>  Algorithme </h2><br><h3>  La description </h3><br>  L'algorithme effectue en continu les √©tapes suivantes: <br><br><ol><li>  Il attend qu'un nouveau tetrimino soit cr√©√©. </li><li>  V√©rifie le type du tetrimino nouvellement cr√©√©, le type du tetrimino suivant (figure dans le champ d'aper√ßu) et le contenu du terrain de jeu. </li><li>  Explore toutes les fa√ßons possibles d'ajouter deux tetriminos au terrain de jeu et √©value chaque probabilit√©. </li><li>  D√©place le t√©trimino nouvellement cr√©√© pour qu'il corresponde √† l'emplacement de la meilleure probabilit√© d√©tect√©e. </li></ol><br>  Chacune de ces √©tapes est d√©crite en d√©tail ci-dessous. <br><br><h3>  Verrouiller la recherche </h3><br>  Prenons une version simplifi√©e de Tetris, dans laquelle les formes ne tombent pas automatiquement.  La seule fa√ßon de faire baisser le chiffre est de l'abaisser doucement.  Apr√®s avoir supprim√© les temps du jeu, nous pouvons d√©crire compl√®tement l'√©tat du tetrimino actif par sa position et son orientation.  La figure a un lieu connu de cr√©ation initiale, et les op√©rations suivantes sont utilis√©es pour convertir d'un √©tat √† un autre: <br><br><ul><li>  Un pas vers le bas </li><li>  Un pas √† gauche </li><li>  D√©placer d'un pas vers la droite </li><li>  Tournez d'un pas dans le sens antihoraire </li><li>  Rotation dans le sens horaire </li></ul><a name="habracut"></a><br>  Ces op√©rations ne sont applicables que lorsque les carr√©s du t√©trimino r√©sultant correspondent √† des cellules vides du terrain de jeu.  Lorsqu'il est impossible de descendre d'une √©tape, l'√©tat est consid√©r√© comme bloqu√©.  Cependant, comme nous avons simplifi√© Tetris et que l'attente de verrouillage est essentiellement infinie, l'√©tat verrouill√© peut √™tre transform√© par d'autres op√©rations par glissement et d√©filement. <br><br>  De nombreux √©tats bloqu√©s avec une s√©quence minimale d'op√©rations qui les cr√©ent peuvent √™tre trouv√©s √† l'aide de la recherche en largeur (BFS).  Comme indiqu√© ci-dessous, il utilise une file d'attente pour stocker les r√©sultats interm√©diaires. <br><br><ol><li>  Nous mettons en file d'attente l'√©tat √† la cr√©ation. </li><li>  Nous d√©duisons l'√©tat de la file d'attente. </li><li>  Nous obtenons les √©tats suivants en utilisant l'op√©ration de conversion. </li><li>  S'il n'y a pas de mouvement vers le bas entre eux, l'√©tat qui est supprim√© de la file d'attente est bloqu√©. </li><li>  Nous mettons en file d'attente les √©tats suivants que nous n'avons pas encore visit√©s. </li><li>  Si la file d'attente n'est pas vide, r√©p√©tez √† partir de l'√©tape 2. </li></ol><br>  Le programme repr√©sente chaque √©tat comme un objet avec les champs suivants: <br><br> <code>{ x, y, rotation, visited, predecessor }</code> <br> <br>  En cours de pr√©paration, le programme cr√©e un tableau tridimensionnel d'objets d'√©tat (20 lignes √ó 10 colonnes √ó 4 tours), initialisant <code>x</code> , <code>y</code> et la <code>rotation</code> cons√©quence. <br><br>  Le champ <code>visited</code> est marqu√© lorsque l'√©tat est mis en file d'attente.  Dans BFS, cela est valide car chaque √©tat suivant augmente la longueur totale du chemin de 1. Autrement dit, en augmentant la longueur du chemin, il est impossible de cr√©er un √©tat suivant qui doit √™tre ins√©r√© ailleurs qu'√† la fin de la file d'attente pour maintenir l'ordre. <br><br>  Le champ <code>predecessor</code> indique l'objet d'√©tat √† partir duquel l'√©tat actuel est d√©riv√©.  Il est d√©fini lorsque l'√©tat est mis en file d'attente.  L'√©tat de cr√©ation n'a pas d'√©tats pr√©c√©dents. <br><br>  L'ensemble des √©tats bloqu√©s d√©tect√©s lors de la recherche est d√©termin√© par le type de tetrimino et les blocs remplis sur le terrain de jeu.  La s√©quence des mouvements qui les ont g√©n√©r√©s peut √™tre clarifi√©e (dans l'ordre inverse) en suivant les liens <code>predecessor</code> vers l'√©tat de cr√©ation.  Lorsque la constante <code>PLAY_FAST</code> est d√©finie sur <code>true</code> au d√©but du programme, elle ignore compl√®tement les √©tats pr√©c√©dents en mettant directement tetrimino sur le terrain et en le bloquant. <br><br>  Un tableau tridimensionnel d'objets d'√©tat, une file d'attente et BFS sont regroup√©s dans une classe.  Il a une m√©thode de recherche qui re√ßoit le terrain de jeu (tableau bidimensionnel), le type de tetrimino et l'auditeur.  Chaque fois qu'un √©tat verrouill√© est d√©tect√©, le terrain de jeu est mis √† jour en ajoutant du tetrimino √† l'emplacement appropri√©.  Ensuite, le terrain de jeu modifi√© ainsi que des informations sur les changements sont transmis √† l'auditeur pour traitement.  Une fois que l'auditeur a termin√© le retour, le terrain de jeu est restaur√©. <br><br>  L'auditeur est utilis√© pour combiner plusieurs op√©rations de recherche dans une cha√Æne, ce qui permet de trouver toutes les fa√ßons possibles d'ajouter deux (ou plus) tetriminos au terrain de jeu.  Le premier moteur de recherche de la cha√Æne n'ex√©cute BFS qu'une seule fois.  Cependant, le deuxi√®me moteur de recherche ex√©cute BFS chaque fois que la premi√®re recherche d√©tecte un √©tat verrouill√©.  Et ainsi de suite, s'il existe d'autres moteurs de recherche dans la cha√Æne. <br><br>  L'auditeur du dernier moteur de recherche √©value le terrain de jeu modifi√©.  Lorsqu'il trouve le terrain de jeu meilleur que ce qui a √©t√© √©tudi√© pr√©c√©demment, il √©crit l'objet utilis√© de l'√©tat verrouill√©, qui utilise actuellement le premier moteur de recherche de la cha√Æne.  √âtant donn√© que le premier moteur de recherche ex√©cute BFS une seule fois, les champs <code>predecessor</code> de ses objets d'√©tat restent valides jusqu'√† la fin de l'ensemble du processus de recherche.  C'est-√†-dire que le dernier auditeur enregistre essentiellement le chemin sur lequel le premier t√©trimino doit aller afin d'arriver √† la meilleure configuration du terrain de jeu en cons√©quence. <br><br><h3>  Fonction d'√©valuation </h3><br>  La fonction de notation attribue une valeur au terrain de jeu modifi√© - une somme pond√©r√©e de divers param√®tres d'influence.  La fonction d'√©valuation utilis√©e dans ce cas est bas√©e sur la fonction d√©velopp√©e par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Islam Al-Ashi</a> .  Il utilise les param√®tres suivants: <br><br><ul><li>  <b>Nombre total de lignes effac√©es</b> : il s'agit du nombre total de lignes qui seront effac√©es par l'ajout de deux tetriminos. </li><li>  <b>Hauteur de blocage totale</b> : la <b>hauteur de blocage</b> est la hauteur au-dessus du sol du terrain de jeu √† laquelle la figure est verrouill√©e.  Il s'agit de la distance verticale √† laquelle une figure verrouill√©e tomberait si vous supprimez tous les autres carr√©s occup√©s du terrain de jeu et gardez l'orientation de la figure.  La hauteur totale de blocage est la somme des hauteurs de blocage des deux t√©triminos. </li><li>  <b>Nombre total de cellules ¬´puits¬ª</b> : une cellule puits est une cellule vide situ√©e au-dessus de toutes les cellules occup√©es dans une colonne de sorte que ses voisins gauche et droit sont des cellules occup√©es;  lors de la d√©termination des puits, les murs du terrain de jeu sont consid√©r√©s comme des cellules occup√©es.  L'id√©e est qu'un puits est une structure ouverte en haut, ferm√©e en bas et entour√©e de murs des deux c√¥t√©s.  La probabilit√© d'intervalles intermittents dans les parois du puits signifie que les cellules du puits ne se produisent pas n√©cessairement en tas continu dans une colonne. </li><li>  <b>Nombre total de trous dans les colonnes</b> : le trou dans la colonne est une cellule vide situ√©e imm√©diatement en dessous de la cellule occup√©e.  Le sexe du terrain de jeu n'est pas compar√© √† la cellule au-dessus.  Il n'y a pas de trous dans les colonnes vides. </li><li>  <b>Nombre total de transitions dans les colonnes</b> : une transition dans les colonnes est une cellule vide adjacente √† une cellule occup√©e (ou vice versa) dans une seule colonne.  La combinaison du bloc de colonnes occup√© le plus haut avec un espace vide au-dessus n'est pas consid√©r√©e comme une transition.  De m√™me, le sol du terrain de jeu n'est pas non plus compar√© √† la cellule au-dessus.  Par cons√©quent, il n'y a aucune transition dans une colonne compl√®tement vide. </li><li>  <b>Nombre total de transitions dans les lignes</b> : une transition dans les lignes est une cellule vide adjacente √† une cellule occup√©e (ou vice versa) dans la m√™me ligne.  Les cellules vides pr√®s des murs du terrain de jeu sont consid√©r√©es comme des transitions.  Le montant total est calcul√© pour toutes les lignes du terrain de jeu.  Cependant, les lignes compl√®tement vides ne sont pas prises en compte dans le nombre total de transitions. </li></ul><br>  El-Ashi a sugg√©r√© que des poids utiles peuvent √™tre trouv√©s en utilisant l'algorithme d'optimisation des essaims de particules (PSO), qui am√©liore de mani√®re it√©rative l'ensemble des solutions en imitant le comportement de l'essaim observ√© dans la nature.  Dans notre cas, chaque solution est un vecteur de poids, et l'ad√©quation de l'option est d√©termin√©e par le jeu dans Tetris;  c'est le nombre total de tetriminos pendant lesquels il a surv√©cu jusqu'√† la fin de la partie. <br><br>  Ces id√©es sont appliqu√©es dans la version Java d√©crite ci-dessous;  il s'ex√©cute en dehors de FCEUX et peut √™tre configur√© pour un jeu en m√©moire non graphique fonctionnant √† une vitesse beaucoup plus √©lev√©e.  Apr√®s avoir pr√©par√© le PSO, j'ai √©t√© surpris de voir que l'algorithme ne bouge plus apr√®s l'it√©ration initiale.  Apr√®s cette it√©ration, plusieurs variantes de solutions g√©n√©r√©es al√©atoirement fonctionnaient d√©j√† assez bien.  Pendant plusieurs jours, la taille de cet ensemble a diminu√© jusqu'√† ce qu'il ne reste qu'une option.  Voici les valeurs de cette solution: <br><br><table><tbody><tr><th>  Param√®tre </th><th>  Le poids </th></tr><tr><td>  Nombre total de lignes effac√©es </td><td> <code>1.000000000000000</code> </td> </tr><tr><td>  Hauteur totale de blocage </td><td> <code>12.885008263218383</code> </td> </tr><tr><td>  Nombre total de cellules de puits </td><td> <code>15.842707182438396</code> </td> </tr><tr><td>  Le nombre total de trous dans les colonnes </td><td> <code>26.894496507795950</code> </td> </tr><tr><td>  Le nombre total de transitions dans les colonnes </td><td> <code>27.616914062397015</code> </td> </tr><tr><td>  Total des sauts de ligne </td><td> <code>30.185110719279040</code> </td> </tr></tbody></table><br>  Le terrain de jeu a √©t√© estim√© en multipliant les param√®tres par leurs poids respectifs et en additionnant les r√©sultats.  Plus la valeur est basse, meilleure est la solution.  √âtant donn√© que tous les param√®tres et poids ont des valeurs positives, tous les param√®tres nuisent √† l'√©valuation globale;  chacun d'eux doit √™tre minimis√©.  Cela signifie √©galement que le meilleur score est 0. <br><br>  √âtant donn√© que ces poids ont √©t√© s√©lectionn√©s au hasard, la plage de valeurs appropri√©es peut √™tre tr√®s large.  Cet ensemble particulier de nombres et l'importance relative estim√©e de chaque param√®tre peuvent ne pas √™tre pertinents.  N√©anmoins, il sera int√©ressant de les observer de pr√®s. <br><br>  Le param√®tre le moins nuisible est le nombre total de lignes effac√©es.  Le fait que cette option soit nuisible est contre-intuitif.  Mais le principal objectif de l'IA est la survie.  Il ne cherche pas le plus de points.  Au lieu de cela, il joue de fa√ßon conservatrice, effa√ßant g√©n√©ralement les rangs un √† la fois.  Pour obtenir le Double, le Triple ou le Tetris, vous devez faire cro√Ætre un groupe qui va √† l'encontre de l'objectif √† long terme. <br><br>  Dans la liste, la hauteur totale de blocage est la suivante.  Il peut √™tre minimis√© en abaissant le tetrimino aussi pr√®s du sol que possible.  Il s'agit d'une strat√©gie simple qui contribue √† long terme √† la survie et √† court terme √† un emballage de qualit√© des pi√®ces. <br><br>  Le poids attribu√© au nombre total de cellules de puits semble un peu surprenant, car les joueurs exp√©riment√©s construisent g√©n√©ralement intentionnellement des puits profonds pour collecter plusieurs Tetris (combinaisons √† quatre lignes) d'affil√©e.  Mais comme mentionn√© ci-dessus, c'est un jeu risqu√©, contrairement √† l'objectif principal - la survie.  De plus, le nombre de puits est un indicateur de la ¬´rugosit√©¬ª du pieu.  Un certain niveau d'in√©galit√© est b√©n√©fique lors du placement de certaines figures ou combinaisons de figures.  Mais une rugosit√© √©lev√©e endommage l'emballage √©tanche. <br><br>  Le nombre total de trous dans les colonnes repr√©sente environ la moiti√© du nombre total de transitions dans les colonnes.  Ces param√®tres peuvent √™tre combin√©s et regroup√©s en un param√®tre connexe commun, obtenant un param√®tre plus √©tendu et plus nuisible: le nombre total de transitions. <br><br>  Les zones dens√©ment peupl√©es ont un petit nombre de transitions dans toutes les directions.  Par cons√©quent, la strat√©gie principale, conduite par l'intelligence artificielle, peut √™tre bri√®vement d√©crite comme suit: emballer les pi√®ces aussi pr√®s que possible les unes des autres. <br><br><h3>  Autres options </h3><br>  Voici une liste de quelques param√®tres suppl√©mentaires que j'ai exp√©riment√©s lors du d√©veloppement de l'IA: <br><br><ul><li>  <b>Hauteur du tas</b> : les blocs occup√©s peuvent pendre au-dessus des cellules vides, cr√©ant des saillies et des trous;  cependant, il n'est pas possible de verrouiller des blocs occup√©s sur des lignes compl√®tement vides.  Par cons√©quent, la hauteur de segment est le nombre de lignes qui contiennent au moins un bloc occup√©. </li><li>  <b>Nombre total de colonnes occup√©es</b> : il s'agit du nombre de colonnes contenant au moins une cellule occup√©e. </li><li>  <b>Nombre total de cellules occup√©es</b> : le nombre de cellules occup√©es sur le terrain de jeu. </li><li>  <b>Nombre total de zones connect√©es</b> : l'algorithme de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">remplissage</a> est utilis√© ici pour calculer le nombre de zones connect√©es en continu.  En plus de trouver des "√Æles" occup√©es, il d√©couvre des trous qui s'√©tendent le long des deux axes. </li><li>  <b>Dispersion de la hauteur de la colonne</b> : Il s'agit d'une mesure statistique de la variation de la hauteur des colonnes.  C'est un indicateur de rugosit√© de surface. </li><li>  <b>Valeur d'adaptation totale</b> : calcule la valeur d'adaptation du tas pour le prochain chiffre inconnu.  Il compte le nombre total de fa√ßons dont 7 types de formes peuvent √™tre ajout√©s au terrain de jeu sans l'apparition de nouveaux trous.  Pour un comptage pr√©cis, l'utilisation r√©p√©t√©e de BFS sera n√©cessaire.  Mais pour un calcul approximatif, l'arbre de recherche peut √™tre consid√©rablement tronqu√©. </li><li>  <b>Note moyenne pour la figure suivante</b> : ce param√®tre approfondit la recherche en analysant toutes les possibilit√©s pour la prochaine figure inconnue.  Il utilise d'autres param√®tres pour s√©parer l'emplacement de chaque type de figure, puis renvoie la moyenne pour 7 notes.  Pour chaque placement de la figure, BFS est requis. </li><li>  <b>Jeu simul√© moyen</b> : le param√®tre simule une s√©rie de jeux dans Tetris, s√©lectionnant des pi√®ces √† l'aide de son propre g√©n√©rateur de nombres pseudo-al√©atoires et utilisant l'IA pour travailler avec eux.  √Ä la fin de chaque partie, le terrain de jeu est √©valu√© √† l'aide d'autres param√®tres.  La valeur moyenne de tous les lots est renvoy√©e. </li></ul><br>  Tous les param√®tres peuvent √™tre personnalis√©s en ajoutant des facteurs personnalis√©s.  Par exemple, au lieu de simplement calculer les lignes effac√©es, vous pouvez attribuer vos propres poids pour Simple, Double, Triple et Tetris, en simulant un syst√®me de points.  Si le nettoyage simultan√© de plusieurs rang√©es nuit √† l'objectif √† long terme de survie, un poids n√©gatif peut √™tre attribu√© √† des rang√©es uniques, tandis que d'autres peuvent devenir positifs. <br><br>  Un autre facteur utile est la valeur de d√©calage.  Par exemple, une surface parfaitement plate d'un tas a une dispersion de hauteurs de colonne de 0. Mais une surface parfaitement plate ne s'adapte pas √† S et Z, ainsi qu'√† d'autres combinaisons de formes.  Par cons√©quent, en soustrayant la constante, la variance doit √™tre centr√©e autour de la rugosit√© optimale. <br><br>  Les param√®tres ajust√©s et biais√©s peuvent √™tre augment√©s dans une certaine mesure de sorte qu‚Äôavant de calculer la somme pond√©r√©e, ils peuvent √™tre mis √† l‚Äô√©chelle logarithmique ou exponentielle.  Toutes ces probabilit√©s peuvent √™tre consid√©r√©es comme des poids suppl√©mentaires qui peuvent potentiellement √™tre optimis√©s par des m√©thodes telles que PSO. <br><br>  De nombreux param√®tres permettent de comprendre dans quelle mesure le tas peut g√©rer des pi√®ces suppl√©mentaires, par exemple, celles qui traitent de la rugosit√© de la surface, mais la ¬´quantit√© totale d'adaptation¬ª, ¬´note moyenne de la figure suivante¬ª et ¬´jeu simul√© moyen¬ª √©valuent le terrain de jeu modifi√© ins√©rer des chiffres qui ne sont pas inclus dans les deux connus.  Dans l'√©tude des chiffres ult√©rieurs, en raison de l'√©limination rapide de la s√©rie, la quantit√© de connaissances suppl√©mentaires obtenues diminue avec la profondeur.  Cela signifie que le cours du parti depuis longtemps n'est pas si important, et le cours du parti dans un avenir lointain n'est pas non plus tr√®s important.  En fait, si une courte s√©quence de chiffres est mal d√©finie au hasard, l'IA restaure rapidement le jeu, en utilisant les quelques chiffres suivants pour effacer les lignes affect√©es.  La d√©termination de la valeur optimale pour l'analyse des chiffres ult√©rieurs n√©cessite des recherches suppl√©mentaires. <br><br>  Un autre aspect de l'utilit√© d'un param√®tre est le co√ªt de calcul.  Les co√ªts sont consid√©rablement augment√©s car la fonction d'√©valuation est appel√©e pour chaque placement possible de deux figures.  √âtant donn√© que l'IA doit pouvoir jouer √† Tetris en temps r√©el, les facteurs de co√ªt qui fournissent des informations pr√©cieuses peuvent √™tre √©chang√©s contre des techniques plus approximatives qui s'ex√©cutent plus rapidement. <br><br><h3>  Formation IA </h3><br>  Il existe des s√©quences pathologiques qui peuvent conduire √† Game Over, quelle que soit la strat√©gie.  L'exemple le plus simple est la s√©quence sans fin de tetrimino S et Z, qui, comme le montre l'animation, conduit rapidement l'IA √† perdre. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb2/66a/2ba/cb266a2ba3575a43876e33f6a2948737.gif"></div><br>  Puisqu'il faut des jours pour ex√©cuter la variante AI avant l'ach√®vement de plusieurs lots et calculer la moyenne, il est compl√®tement impossible d'utiliser la dur√©e moyenne des lots comme m√©trique de contr√¥le PSO.  Au lieu de cela, vous pouvez augmenter la complexit√© du jeu √† une vitesse contr√¥l√©e en augmentant la fr√©quence de S et Z, ce qui, au fil du temps, entra√Ænera la cr√©ation alternative de cette seule paire de chiffres. <br><br>  J'ai essay√© d'utiliser cette m√©thode d'enseignement, mais j'ai d√©couvert qu'enseigner l'IA √† travailler avec des S et Z fr√©quents nuit en fait √† la capacit√© de faire face √† des formes al√©atoires uniform√©ment r√©parties. <br><br>  Dans une m√©thode alternative inspir√©e du jeu de type B, la m√©trique PSO contr√¥le la fr√©quence de nettoyage des rang√©es.  Le terrain de jeu est un diagramme de 10 lignes de blocs d'ordures al√©atoires, et chaque fois que la ligne est effac√©e, une nouvelle ligne d'ordures appara√Æt en dessous, r√©tablissant la hauteur du tas.  √âtant donn√© que le terrain de jeu a une largeur de 10 colonnes et que chaque tetrimino se compose de 4 carr√©s, en moyenne, l'IA devrait effacer une ligne tous les 2,5 tetrimino.  Et pour se d√©barrasser des ordures, il doit le faire encore plus vite. <br><br>  Malheureusement, cette technique n'a pas non plus am√©lior√© les performances.  Une raison probable est que les trous d'ordures al√©atoires ne correspondent pas exactement aux cha√Ænes avec lesquelles l'IA traite dans le vrai jeu.  De plus, le nettoyage de la rang√©e est un objectif √† court terme;  le nettoyage gourmand des rangs n'am√©liore pas n√©cessairement la survie √† long terme.  De temps en temps, les lignes ne doivent pas √™tre touch√©es pour traiter certaines combinaisons de figures suivantes. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Colin Fei a</a> sugg√©r√© une approche diff√©rente sur sa page Web.  Il a cr√©√© des histogrammes qui montrent le pourcentage de formes qui sont bloqu√©es dans chaque rang√©e pendant les lots d'essai.  Fait int√©ressant, tous les histogrammes semblent presque identiques quel que soit le nombre de figures cr√©√©es.  Sur cette base, il a sugg√©r√© que vous puissiez utiliser une image approximative de la fonction pour tout lot d'essai lors de l'√©valuation de l'attente statistique de bloquer une figure dans la ligne de cr√©ation, obtenant ainsi le temps pendant lequel l'IA jouera jusqu'√† la fin du jeu.  J'ai d√©cid√© d'explorer cette possibilit√©. <br><br>  Vous trouverez ci-dessous une carte thermique de nombreux lots d'essai contenant au total 2 039 900 000 t√©trimino.  Chaque cellule est color√©e en fonction du pourcentage de formes qui y sont verrouill√©es.  Pour am√©liorer le contraste visuel, une palette non lin√©aire est s√©lectionn√©e.  La carte a √©t√© cr√©√©e en normalisant les valeurs des cellules en divisant par le pourcentage maximal de cellules, puis en annon√ßant √† la puissance de 0,19 (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"correction gamma"</a> ). <br><br><table><tbody><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d13/bcd/196/d13bcd1968b1f71c3311f7007c6f573e.png"></div></td><td><table><tbody><tr><th>  La couleur </th><th>  Pourcentage </th></tr><tr><td>  <font color="#000000">‚ñ†</font> </td><td> <code>0.00000000</code> </td> </tr><tr><td>  <font color="#0066FF">‚ñ†</font> </td><td> <code>0.00000315</code> </td> </tr><tr><td>  <font color="#00CCFF">‚ñ†</font> </td><td> <code>0.00024227</code> </td> </tr><tr><td>  <font color="#00FFCC">‚ñ†</font> </td><td> <code>0.00307038</code> </td> </tr><tr><td>  <font color="#00FF66">‚ñ†</font> </td><td> <code>0.01860818</code> </td> </tr><tr><td>  <font color="#00FF00">‚ñ†</font> </td><td> <code>0.07527774</code> </td> </tr><tr><td>  <font color="#66FF00">‚ñ†</font> </td><td> <code>0.23582574</code> </td> </tr><tr><td>  <font color="#CCFF00">‚ñ†</font> </td><td> <code>0.61928352</code> </td> </tr><tr><td>  <font color="#FFCC00">‚ñ†</font> </td><td> <code>1.42923040</code> </td> </tr><tr><td>  <font color="#FF6600">‚ñ†</font> </td><td> <code>2.98867416</code> </td> </tr><tr><td>  <font color="#FF0000">‚ñ†</font> </td><td> <code>5.78182519</code> </td> </tr></tbody></table></td></tr></tbody></table><br>  Les rayures orange fonc√© et rouges sur les lignes 17 et 18 signifient que la grande majorit√© des personnages s'y retrouvent.  La teinte vert p√¢le d'en bas est une cons√©quence de la g√©om√©trie des figures: seuls 4 des 7 types de t√©trimino peuvent appara√Ætre sur la ligne du bas.  Les coins inf√©rieurs sont noirs car il est impossible de s'y rendre. <br><br>  La couleur le long de chaque ligne est presque uniforme, ce qui sugg√®re que les formes sont r√©parties uniform√©ment horizontalement.  De l√©g√®res lacunes peuvent √™tre expliqu√©es en regardant les histogrammes des diff√©rents types de formes: <br><br><table><tbody><tr><td>  <b>T</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82c/fb3/c14/82cfb3c1456fce7726985859554021d8.png"></div></td><td>  <b>J</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebd/f38/1a2/ebdf381a25323b9c73eaed6c467064b5.png"></div></td><td>  <b>Z</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/381/986/389/38198638921c4dcbc3a8f1978e665b89.png"></div></td><td>  <b>O</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/669/be1/5e4/669be15e4ba1b9becffb4ee97e398cbb.png"></div></td><td>  <b>S</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc8/79c/2a5/dc879c2a52f1020a69f76e9554fca978.png"></div></td><td>  <b>L</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbf/204/acb/fbf204acb6d376818fc6e98f8f517e4e.png"></div></td><td>  <b>Je</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7bb/e41/92b/7bbe4192bbb2204d4b677a9a36354da2.png"></div></td></tr></tbody></table><br>  T s'av√®re √™tre le type le plus universel: son histogramme est plus uniforme que tous les autres.  Anomalies dans l'histogramme J - le r√©sultat de l'influence des murs;  seuls <code>Jr</code> et <code>Jl</code> peuvent √™tre dans les colonnes lat√©rales, ce qui fait que l'IA utilise plus souvent les colonnes 1 et 9 pour compenser. Il en va de m√™me pour L. Les histogrammes Z et S sont approximativement les m√™mes, ce qui souligne le d√©s√©quilibre d√ª au fait que <code>Zv</code> et <code>Sv</code> ne sont pas des images miroir parfaites les unes des autres.  Le type O est limit√© √† un terrain de jeu de 19 √ó 9, et il semble que l'IA soit plus susceptible d'utiliser O sur les c√¥t√©s qu'au centre.  Tetrimino I est d√©cal√© vers la droite, car son point de d√©part se trouve l√†;  par cons√©quent, le verrouillage dans la colonne 1 est rare. <br><br>  Le tableau montre le pourcentage de chiffres bloqu√©s dans chaque ligne. <br><br><table><tbody><tr><th>  String </th><th>  Pourcentage </th></tr><tr><td>  0 </td><td>  0.0000000000 </td></tr><tr><td>  1 </td><td>  0.0000000000 </td></tr><tr><td>  2 </td><td>  0.0000004902 </td></tr><tr><td>  3 </td><td>  0,0000026472 </td></tr><tr><td>  4 </td><td>  0,0000066180 </td></tr><tr><td>  5 </td><td>  0,0000172557 </td></tr><tr><td>  6 </td><td>  0,0000512280 </td></tr><tr><td>  7 </td><td>  0.0001759400 </td></tr><tr><td>  8 </td><td>  0.0006681210 </td></tr><tr><td>  9 </td><td>  0,0023187901 </td></tr><tr><td>  10 </td><td>  0,0077928820 </td></tr><tr><td>  11 </td><td>  0,0259672043 </td></tr><tr><td>  12 </td><td>  0,0866187068 </td></tr><tr><td>  13 </td><td>  0,2901315751 </td></tr><tr><td>  14 </td><td>  0,9771663807 </td></tr><tr><td>  15 </td><td>  3.3000408353 </td></tr><tr><td>  16 </td><td>  10.6989059268 </td></tr><tr><td>  17 </td><td>  28.5687976371 </td></tr><tr><td>  18 </td><td>  50.0335706162 </td></tr><tr><td>  19 </td><td>  6.0077671454 </td></tr></tbody></table><br>  Voici un graphique des valeurs: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a6/943/9d8/8a69439d8d818e46921cc5c9b75bd345.png"></div><br>  Si la ligne 19 n'est pas prise en compte, le graphique montre une croissance exponentielle. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voici une liste des ratios du nombre de formes verrouill√©es dans les rang√©es adjacentes. </font></font><br><br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / String </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></sub> </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ratio (%) </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1/2 </font></font></td><td>  0,00 </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2/3 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 18,52 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3/4 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 40,00 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4/5 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 38,35 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5/6 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 33,68 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6/7 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29/12 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7/8 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 26,33 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8/9 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 28,81 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9/10 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,76 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10/11 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 30/01 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11/12 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,98 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 12/13 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,85 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 13/14 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 29,69 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 14/15 </font></font></td><td>  29,61 </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 15/16 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 30,84 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 16/17 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 37,45 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 17/18 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 57,10 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 18/19 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 832.81 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les lignes </font></font><code>16‚Äì19</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prennent en compte les figures qui interagissent avec le sol du terrain de jeu, afin qu'elles puissent √™tre jet√©es. En lignes, la </font></font><code>0‚Äì5</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s√©lection est trop petite pour √™tre significative. Les rapports restants, les paires 6 / 7‚Äì14 / 15, sont presque identiques; leur valeur moyenne est de 29,24%. Cela signifie que la probabilit√© que le tas croisse d'une ligne est approximativement la m√™me quelle que soit la hauteur du tas. Cela est logique, car les r√®gles de Tetris limitent l'interaction en haut du tas lorsqu'il est bien emball√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le graphique suivant montre le log de </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> % des chiffres des lignes 6 √† 15.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd6/7ec/745/fd67ec745b6509ae7c165ae0ebabedcc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elle est proche d'une ligne parfaitement droite avec un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">coefficient de d√©termination</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> proche de 1 </font><font style="vertical-align: inherit;">. La formule d√©riv√©e de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©gression lin√©aire</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> montr√©e ci-dessus </font><font style="vertical-align: inherit;">nous donne l'intersection avec l'axe Y, en supposant que le pourcentage de formes dans la ligne 0 est d'environ 10 </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-7,459</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> %. L'inverse de cette valeur nous donne une attente statistique de 2 877 688 349 tetrimino ou 1 151 175 340 lignes jusqu'√† la fin de la partie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela nous fait comprendre que le journal </font></font><sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></sub><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le pourcentage de chiffres dans chaque ligne reste lin√©aire jusqu'√† la ligne 0. Cependant, lorsque le tas atteint presque le plafond du terrain de jeu, la libert√© de mouvement est limit√©e √† un point tel que cette propri√©t√© est viol√©e. De plus, bloquer une pi√®ce sur la ligne 0 ne signifie pas n√©cessairement que la partie est termin√©e; vous pouvez toujours √™tre sauv√© s'il y a un endroit pour cr√©er de nouvelles figures. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre fa√ßon d'√©valuer la force de l'IA est de mesurer le nombre moyen de formes cr√©√©es entre un nettoyage complet du terrain de jeu. Un nettoyage complet peut √™tre obtenu avec seulement 5 tetriminos. Par exemple, entre autres possibilit√©s, cela peut √™tre r√©alis√© par cinq chiffres O dispos√©s sur le sol du terrain de jeu. En g√©n√©ral, √©tant donn√© que chaque tetrimino se compose de 4 carr√©s et que la largeur du terrain de jeu est de 10 carr√©s, le nombre de chiffres cr√©√©s entre un nettoyage complet doit √™tre un multiple de 5 ( depuis</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 √ó 5n = 2 √ó 10n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mon IA a un nombre moyen de formes cr√©√©es entre 1 181 nettoyages sur le terrain - un nombre assez petit. Puisqu'un nettoyage complet est comme le red√©marrage d'un jeu, un lot complet peut √™tre vu comme une s√©rie extr√™mement longue de red√©marrages de jeu, suivie d'une avance rapide pour terminer le jeu. Comme la s√©quence d'alternatives d√©crite ci-dessus </font></font><code>SZ</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, les s√©quences pathologiques menant √† la fin du jeu sont g√©n√©ralement tr√®s courtes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'histogramme ci-dessous montre la probabilit√© (en pourcentage) que l'IA obtienne un effacement complet du champ apr√®s le nombre sp√©cifi√© de figures cr√©√©es.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7f/665/112/f7f66511246ef114d27d325a21c9b785.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ordre des degr√©s dans la formule ci-dessus d√©termine le taux de diminution et, vraisemblablement, la force de l'IA. Selon cette formule, environ 0,4%, soit environ 1 match sur 253 commen√ßant avec un terrain de jeu vide, se termine par un nettoyage complet apr√®s seulement 5 t√©triminos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrairement √† ce que Faye a sugg√©r√©, les constantes dans les approximations lin√©aires et exponentielles n√©cessitent une tr√®s grande taille d'√©chantillon pour que R </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">approch√© 1, donc cette m√©thode n'est pas applicable pour PSO. </font><font style="vertical-align: inherit;">Cependant, les constantes obtenues avec des lots longs peuvent √™tre utilis√©es pour optimiser la fonction d'approximation qui cr√©e des valeurs constantes possibles pour des lots courts. </font><font style="vertical-align: inherit;">Dans une sorte de boucle de r√©troaction de d√©veloppement, la fonction d'approximation optimis√©e peut √™tre utilis√©e dans le PSO, ce qui am√©liore l'IA, qui √† son tour peut √™tre utilis√©e pour calculer de nouvelles constantes, servant de crit√®res de r√©f√©rence pour la fonction d'approximation.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Version Java </font></font></h3><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √Ä propos du programme </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour les d√©veloppeurs peu familiers avec Lua, j'ai ajout√© un </font><font style="vertical-align: inherit;">port Java AI </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">au fichier zip source</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Les classes sont des traductions quasi lin√©aires </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'objets Lua bas√©es sur des fermetures</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Forfaits </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le code est divis√© en deux packages: </font></font><br><br><ul><li> <code>tetris.ai</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient des classes et des interfaces AI. </font></font></li><li> <code>tetris.gui</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©e un mod√®le graphique du terrain de jeu. </font></font></li></ul><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Classes et interfaces IA </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une classe avec le nom appropri√© </font></font><code>Tetriminos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©crit le t√©trimino. </font><font style="vertical-align: inherit;">Il est utilis√© de la m√™me mani√®re </font></font><code>enum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et contient des constantes pour tous les types de t√©trimino:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> NONE = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> T = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> J = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Z = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> O = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> S = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> L = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> I = <span class="hljs-number"><span class="hljs-number">6</span></span>;</code> </pre> <br> <code>NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">signifie une valeur non affect√©e. </font><font style="vertical-align: inherit;">Il est utilis√© pour les cellules vides du terrain de jeu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contient √©galement </font></font><code>Tetriminos</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deux mod√®les de la table d'orientation. </font></font><code>PATTERNS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- il s'agit d'un tableau entier √† 4 dimensions (type √ó rotation √ó carr√© √ó coordonn√©es) contenant les coordonn√©es relatives des carr√©s; </font><font style="vertical-align: inherit;">les lignes sont dispos√©es de sorte que dans chaque type, l'orientation de cr√©ation de la forme soit la premi√®re. </font></font><code>ORIENTATIONS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est un autre mod√®le, un tableau bidimensionnel (type √ó rotation) d'objets </font></font><code>Orientation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Chacun </font></font><code>Orientation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient les coordonn√©es du carr√© sous forme de tableau d'objets </font></font><code>Point</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il contient √©galement des champs qui d√©crivent la plage de positions autoris√©es pour l'orientation correspondante.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Orientation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Point[] squares = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point[<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> minX; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxX; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxY; ... }</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Point</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La rotation tetrimino (le deuxi√®me index dans les deux tables d'orientation) est utilis√©e dans les objets </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que BFS manipule.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rotation; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> visited; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> State predecessor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> State next; ... }</code> </pre> <br> <code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et en </font></font><code>rotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√™me temps d√©crire la position et l' </font><font style="vertical-align: inherit;">orientation de la figure. √âtant donn√© que le type Tetrimino reste constant du moment de la cr√©ation au blocage, un champ pour celui-ci est facultatif. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La classe </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui contient l'algorithme BFS cr√©e un ensemble complet de tous les objets possibles </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lors de sa cr√©ation:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ states = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State[AI.PLAYFIELD_HEIGHT][AI.PLAYFIELD_WIDTH][<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; AI.PLAYFIELD_HEIGHT; y++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; AI.PLAYFIELD_WIDTH; x++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rotation = <span class="hljs-number"><span class="hljs-number">0</span></span>; rotation &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; rotation++) { states[y][x][rotation] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> State(x, y, rotation); } } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien que Java poss√®de une API de collections riche, elle </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient sa propre impl√©mentation de la file d'attente. La classe </font></font><code>Queue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilise </font></font><code>State.next</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour joindre des objets </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans une liste cha√Æn√©e. √âtant donn√© que tous les objets </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont pr√©d√©finis et que chacun </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne peut √™tre ajout√© √† la file d'attente qu'une seule fois, la file d'attente peut fonctionner en place, ce qui √©limine le besoin d'objets conteneurs temporaires inutiles utilis√©s dans les impl√©mentations g√©n√©rales de la file d'attente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le ¬´c≈ìur¬ª de BFS est la m√©thode illustr√©e ci-dessous </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxRotation = Tetriminos.ORIENTATIONS[tetriminoType].length - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mark = globalMark++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!addChild(playfield, tetriminoType, mark, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(queue.isNotEmpty()) { State state = queue.dequeue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxRotation != <span class="hljs-number"><span class="hljs-number">0</span></span>) { addChild(playfield, tetriminoType, mark, state, state.x, state.y, state.rotation == <span class="hljs-number"><span class="hljs-number">0</span></span> ? maxRotation : state.rotation - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxRotation != <span class="hljs-number"><span class="hljs-number">1</span></span>) { addChild(playfield, tetriminoType, mark, state, state.x, state.y, state.rotation == maxRotation ? <span class="hljs-number"><span class="hljs-number">0</span></span> : state.rotation + <span class="hljs-number"><span class="hljs-number">1</span></span>); } } addChild(playfield, tetriminoType, mark, state, state.x - <span class="hljs-number"><span class="hljs-number">1</span></span>, state.y, state.rotation); addChild(playfield, tetriminoType, mark, state, state.x + <span class="hljs-number"><span class="hljs-number">1</span></span>, state.y, state.rotation); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!addChild(playfield, tetriminoType, mark, state, state.x, state.y + <span class="hljs-number"><span class="hljs-number">1</span></span>, state.rotation)) { lockTetrimino(playfield, tetriminoType, id, state); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il g√©n√®re une file d'attente avec l'√©tat du t√©trimino cr√©√©, puis r√©cup√®re s√©quentiellement les √©l√©ments enfants des √©tats qui sont supprim√©s de la file d'attente, en les ajoutant √† la file d'attente lorsqu'ils apparaissent sur le terrain de jeu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">champ de jeu contenant une combinaison de cellules occup√©es et vides, le type Tetrimino cr√©√© et un identifiant arbitraire est transmis √† la </font><font style="vertical-align: inherit;">m√©thode </font><font style="vertical-align: inherit;">. Pendant l'ex√©cution du BFS, un √©couteur est appel√© chaque fois qu'une position de verrouillage est d√©tect√©e.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ISearchListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, State state)</span></span></span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'auditeur re√ßoit un terrain de jeu modifi√© contenant un tetrimino verrouill√© en place. Le type de Tetrimino cr√©√© et un identifiant arbitraire sont √©galement transmis. Le dernier param√®tre est celui </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans lequel le t√©trimino est bloqu√©. En suivant la cha√Æne de liens </font></font><code>State.predecessor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous pouvez restaurer la </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cr√©ation d'une forme. </font></font><br><br> <code>State.visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pourrait √™tre mis en ≈ìuvre comme </font></font><code>boolean</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; mais avec tous les √©quipements n√©cessaires pour trier avant de </font><font style="vertical-align: inherit;">chercher </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour le </font><font style="vertical-align: inherit;">soulagement </font></font><code>visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Au lieu de cela, j'ai fait une </font></font><code>visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur </font></font><code>int</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">par rapport √† un compteur, en incr√©mentant √† chaque appel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La m√©thode</font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">met en file d'attente les √©tats suivants. L'√©tat suivant doit √™tre dans le champ et √™tre situ√© sur 4 cellules vides du terrain de jeu. De plus, l'√©tat suivant ne doit pas √™tre visit√© </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si la position est valide, </font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retourne </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√™me si l'√©tat suivant n'a pas pu √™tre mis en file d'attente car il a d√©j√† √©t√© visit√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La m√©thode </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilise la </font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur de </font><font style="vertical-align: inherit;">retour </font><font style="vertical-align: inherit;">pour d√©terminer si une forme peut √™tre cr√©√©e. Si la figure ne peut pas √™tre cr√©√©e, le tas a atteint le sommet et la recherche ne peut plus √™tre effectu√©e; donc il revient </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Retournable</font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on √©tudie √©galement la possibilit√© de franchir une autre √©tape. Si cela ne peut pas √™tre fait, l'√©tat actuel est la position de verrouillage et l'appel commence </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La m√©thode </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modifie le terrain de jeu, appelle l'auditeur, puis restaure le terrain de jeu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque ligne du tableau </font></font><code>playfield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient 1 √©l√©ment suppl√©mentaire, qui stocke le nombre de cellules occup√©es dans la ligne. L'incr√©mentation d'un √©l√©ment est effectu√©e par la m√©thode </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">car elle marque les cellules comme occup√©es. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque l'auditeur re√ßoit un terrain de jeu modifi√©, il appelle</font></font><code>PlayfieldUtil.clearRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour supprimer des lignes remplies la m√©thode les reconna√Æt en v√©rifiant la valeur dans l'√©l√©ment suppl√©mentaire du tableau. Pour supprimer une cha√Æne, le code profite du fait qu'en Java, les tableaux bidimensionnels sont essentiellement des tableaux de tableaux; il pousse simplement les liens vers les cha√Ænes. </font></font><code>PlayfieldUtil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient des lignes libres; il termine le processus de nettoyage en ins√©rant un lien vers l'un d'eux. Avant d'effectuer le d√©calage, l'index de la ligne effac√©e est stock√© dans un √©l√©ment de ligne suppl√©mentaire. Ensuite, le lien vers la ligne est pouss√© sur la pile. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, l'auditeur appelle</font></font><code>PlayfieldUtil.restoreRows</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour annuler les modifications apport√©es au terrain de jeu. </font><font style="vertical-align: inherit;">Les √©tapes sont annul√©es dans l'ordre inverse. </font><font style="vertical-align: inherit;">D'abord, nous obtenons une rang√©e gratuite par le haut. </font><font style="vertical-align: inherit;">Ensuite, la ligne remplie est r√©cup√©r√©e de la pile et l'index de l'√©l√©ment suppl√©mentaire est restaur√©. </font><font style="vertical-align: inherit;">Il est utilis√© pour d√©caler les r√©f√©rences de ligne et revenir √† l'emplacement de la ligne supprim√©e. </font><font style="vertical-align: inherit;">Enfin, un √©l√©ment suppl√©mentaire est restaur√©, on lui attribue la valeur de la largeur du terrain de jeu - le nombre de cellules occup√©es dans la ligne remplie. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe </font></font><code>PlayfieldUtil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©galement une m√©thode </font></font><code>evaluatePlayfield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui calcule et √©crit 4 param√®tres d'√©valuation dans la classe de conteneur illustr√©e ci-dessous.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayfieldEvaluation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> holes; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> columnTransitions; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowTransitions; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> wells; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La classe g√®re tout cela </font></font><code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il contient deux objets </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connect√©s ensemble par l'auditeur ci-dessous.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, State state)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id == <span class="hljs-number"><span class="hljs-number">0</span></span>) { result0 = state; } Orientation orientation = Tetriminos.ORIENTATIONS[tetriminoType][state.rotation]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rows = playfieldUtil.clearRows(playfield, state.y); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalTotalRows = totalRows; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalTotalDropHeight = totalDropHeight; totalRows += rows; totalDropHeight += orientation.maxY - state.y; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nextID = id + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextID == tetriminoIndices.length) { playfieldUtil.evaluatePlayfield(playfield, e); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> fitness = computeFitness(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fitness &lt; bestFitness) { bestFitness = fitness; bestResult = result0; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { searchers[nextID].search(playfield, tetriminoIndices[nextID], nextID); } totalDropHeight = originalTotalDropHeight; totalRows = originalTotalRows; playfieldUtil.restoreRows(playfield, rows); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une classe </font></font><code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut g√©rer n'importe quel nombre d'objets </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais Nintendo Tetris n'affiche qu'une seule forme √† l'avance. Les objets </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont stock√©s dans un tableau et le code ci-dessus sert d'√©couteur commun. L'identifiant al√©atoire transmis √† la m√©thode </font></font><code>Searcher.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est en fait l'index du tableau, qui est √©galement la profondeur de la recherche. Lorsque l'auditeur est appel√©, l'identifiant dirige l'appel vers le suivant </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la cha√Æne. S'il atteint la fin du tableau, √©value alors le terrain de jeu. Et quand il trouve un terrain de jeu avec un score de fitness plus √©lev√©, il √©crit celui qui est bloqu√© </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√®s le premier </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de la cha√Æne. </font></font><br><br> <code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient une m√©thode </font></font><code>search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui re√ßoit le terrain de jeu et un tableau contenant les types du tetrimino cr√©√© et du suivant. Il revient</font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contenant la position et la rotation dans lesquelles le premier t√©trimino doit √™tre bloqu√©. </font><font style="vertical-align: inherit;">Il ne se concentre pas sur le deuxi√®me tetrimino; </font><font style="vertical-align: inherit;">la prochaine fois qu'il est appel√©, il recalcule le score. </font><font style="vertical-align: inherit;">Si le tas est trop haut et que la cha√Æne </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne place pas les deux tetriminos, il </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reviendra </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> State </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] tetriminoIndices)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tetriminoIndices = tetriminoIndices; bestResult = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; bestFitness = Double.MAX_VALUE; searchers[<span class="hljs-number"><span class="hljs-number">0</span></span>].search(playfield, tetriminoIndices[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bestResult; }</code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D√©fi IA </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que la version Java n'est pas li√©e √† FCEUX, elle peut potentiellement √™tre utilis√©e pour d'autres projets. Pour ceux qui souhaitent int√©grer l'IA ailleurs, cette section d√©crit tout ce dont vous avez besoin. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, cr√©ez une instance </font></font><code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, une instance </font></font><code>PlayfieldUtil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et un tableau pour contenir tous les types connus de tetrimino. De plus, cr√©ez une </font></font><code>PlayfieldUtil.createPlayfield</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instance du terrain de jeu en </font><font style="vertical-align: inherit;">appelant </font><font style="vertical-align: inherit;">; il renvoie un tableau √† deux dimensions avec une colonne suppl√©mentaire, que nous avons examin√©e ci-dessus. Vous aurez probablement aussi besoin d'un g√©n√©rateur de nombres al√©atoires.</font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(); PlayfieldUtil playfieldUtil = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlayfieldUtil(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] tetriminos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[AI.TETRIMINOS_SEARCHED]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[][] playfield = playfieldUtil.createPlayfield(); Random random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au d√©part, le terrain de jeu est vide et toutes les cellules sont pertinentes </font></font><code>Tetriminos.NONE</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si vous remplissez les cellules par programme, n'oubliez pas de noter le </font></font><code>playfield[rowIndex][AI.PLAYFIELD_WIDTH]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nombre de cellules occup√©es dans chaque ligne. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remplissez le tableau des types tetrimino avec les types de la forme initialement cr√©√©e et de la forme suivante, qui sont g√©n√©ralement s√©lectionn√©s manuellement.</font></font><br><br><pre> <code class="java hljs">tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, nous passons le terrain de jeu et le tableau des types √† la m√©thode </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il reviendra </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans lequel vous devrez bloquer le premier tetrimino. </font><font style="vertical-align: inherit;">S'il revient </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la partie est in√©vitable.</font></font><br><br><pre> <code class="java hljs">State state = ai.search(playfield, tetriminos);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez besoin d'un moyen de cr√©er une figure au verrouillage, passez-le √† la </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©thode </font></font><code>AI.buildStateList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs">State[] states = ai.buildStatesList(state);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour mettre √† jour le terrain de jeu, nous le transmettrons </font></font><code>PlayfieldUtil.lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec son type et son objet </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cette m√©thode efface automatiquement les lignes remplies.</font></font><br><br><pre> <code class="java hljs">playfieldUtil.lockTetrimino(playfield, tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>], state);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avant d'appeler √† nouveau, </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous devez s√©lectionner au hasard le prochain tetrimino.</font></font><br><br><pre> <code class="java hljs">tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>]; tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ensemble, cela ressemble √† ceci: </font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(); PlayfieldUtil playfieldUtil = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlayfieldUtil(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] tetriminos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[AI.TETRIMINOS_SEARCHED]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[][] playfield = playfieldUtil.createPlayfield(); Random random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); tetriminos[<span class="hljs-number"><span class="hljs-number">0</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); tetriminos[<span class="hljs-number"><span class="hljs-number">1</span></span>] = random.nextInt(<span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// ... print playfield ... State state = ai.search(playfield, tetriminos); if (state == null) { break; // game over } playfieldUtil.lockTetrimino(playfield, tetriminos[0], state); tetriminos[0] = tetriminos[1]; tetriminos[1] = random.nextInt(7); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Au lieu d'afficher le terrain de jeu sous forme de texte, vous pouvez utiliser une fa√ßon plus int√©ressante d'afficher ce qui se passe ... </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Affichage du terrain de jeu </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La classe </font></font><code>TetrisFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imite les graphiques de Nintendo Tetris, y compris les fonctionnalit√©s comportementales d√©crites dans la partie pr√©c√©dente de l'article.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d58/dac/a4c/d58daca4c668408a42efa51ad7508d75.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour le voir en action, ex√©cutez-le </font></font><code>tetris.gui.Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Comme avec la version Lua, nous pouvons ajuster la vitesse du jeu en changeant la valeur constante au d√©but du fichier.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> PLAY_FAST = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;</code> </pre> <br> <code>TetrisFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dispose de 4 m√©thodes pour manipuler l'√©cran. </font><font style="vertical-align: inherit;">La m√©thode </font></font><code>displayTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rend le tetrimino actif dans les coordonn√©es sp√©cifi√©es. </font><font style="vertical-align: inherit;">Il re√ßoit un param√®tre de d√©lai, qui fait attendre la m√©thode avant de renvoyer le nombre sp√©cifi√© d'images d'animation.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">displayTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delay)</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La m√©thode </font></font><code>lockTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verrouille la figure en place. </font><font style="vertical-align: inherit;">Le compteur de lignes, les points, le niveau et les couleurs tetrimino sont mis √† jour en cons√©quence, d√©montrant le comportement curieux attendu lorsque les valeurs d√©passent les valeurs autoris√©es. </font><font style="vertical-align: inherit;">L'attribution d'une </font></font><code>animate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeur </font><font style="vertical-align: inherit;">√† un param√®tre </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comprend des animations de nettoyage des lignes et un scintillement de l'√©cran lors de la r√©ception de Tetris. </font><font style="vertical-align: inherit;">La m√©thode est bloqu√©e jusqu'√† la fin de l'animation.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lockTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animate)</span></span></span></span></code> </pre> <br> <code>updateStatisticsAndNext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> effectue un incr√©ment du compteur de statistiques pour le t√©trimino nouvellement cr√©√© et met √† jour l'affichage de la figure suivante. </font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStatisticsAndNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> activeTetrimino, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nextTetrimino)</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La m√©thode </font></font><code>dropTetrimino</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cr√©e une forme et lui permet de descendre sous l'influence de la ¬´gravit√©¬ª, sans tenter de la faire pivoter ou de la d√©placer. </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'utilise pour les deux derniers chiffres lors de son </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retour </font></font><code>null</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Si le param√®tre est </font></font><code>animate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">important </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, alors s'il est impossible de cr√©er une figure, le rideau de fin de partie tombera. Comme pour toutes les autres m√©thodes, cette m√©thode se bloque jusqu'√† la fin de l'animation. Il </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne </font><font style="vertical-align: inherit;">revient </font><font style="vertical-align: inherit;">que lorsqu'il peut cr√©er une figure sur un terrain de jeu occup√©.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dropTetrimino</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animate)</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ces 4 m√©thodes doivent √™tre appel√©es par le workflow, mais </font></font><code>TetrisFrame</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doivent √™tre cr√©√©es dans le thread de r√©partition d'√©v√©nements lui-m√™me. Pour voir comment cela se fait, consultez la classe </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par int√©r√™t, il </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilise une classe </font></font><code>Randomizer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui simule un g√©n√©rateur de nombres pseudo-al√©atoires biais√© de Nintendo Tetris. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le package </font></font><code>tetris.gui.images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient des fichiers li√©s √† l'affichage. </font></font><code>tiles.png</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Il s'agit d'un tableau de motifs contenant tous les graphiques de tuiles. </font></font><code>background.dat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stocke les identifiants des tuiles qui composent l'arri√®re-plan; donn√©es extraites de </font></font><code>$BF3F</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Et il </font></font><code>colors.dat</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient des octets qui g√©n√®rent des couleurs carr√©es inhabituelles qui apparaissent √† partir du niveau 138. Il </font></font><br><br> <code>ImageLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient un tableau de palettes NES, et l' </font></font><code>ImagePane</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ensemble complet des valeurs de niveau affich√©es est stock√©.</font></font><br><br><h4>  Autres projets </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Potentiellement, le code peut √™tre utilis√© au lieu d'√©crire pour le mode d√©mo. En fait, une telle d√©mo peut √™tre rendue pour toujours, profitant de la rapidit√© avec laquelle l'IA est en mesure d'effacer tout le terrain de jeu. Pour y parvenir, dans le g√©n√©rateur de nombres pseudo-al√©atoires, vous devez utiliser une constante arbitraire comme graine, ce qui nous donnera une s√©quence tetrimino d√©terministe. Les deux premi√®res s√©quences tetrimino seront enregistr√©es. Lorsque l'IA atteint un nettoyage complet du champ, les deux prochains t√©triminos seront compar√©s aux deux premiers de la s√©quence. S'ils correspondent (cet √©v√©nement est attendu tous les 49 nettoyages de champs complets), le g√©n√©rateur de nombres pseudo-al√©atoires peut recevoir la m√™me constante que seed, ce qui cr√©era une boucle de d√©monstration infinie. La dur√©e du cycle peut √™tre tr√®s longue pour masquer le fait qu'il s'agit d'un cycle. Aussila d√©mo peut commencer √† un point al√©atoire de la boucle, cr√©ant une nouvelle d√©mo √† chaque fois.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre possibilit√© d'utiliser l'IA est de cr√©er un mode ¬´joueur contre ordinateur¬ª. Dans le Tetris multijoueur, tout en effa√ßant plusieurs lignes en m√™me temps, des lignes d'ordures apparaissent dans la partie inf√©rieure du terrain de l'adversaire, augmentant le terrain de jeu. L'IA doit pouvoir se prot√©ger des d√©bris pour la m√™me raison qu'elle peut jouer √† des jeux de type B. Cependant, comme indiqu√© pr√©c√©demment, l'IA joue de mani√®re conservatrice, s'effor√ßant g√©n√©ralement d'effacer une ligne √† la fois. Autrement dit, il sera en mesure de se d√©fendre contre les attaques, mais il ne sera pas en mesure d'attaquer. Pour pouvoir changer son comportement, j'ai cr√©√© une interface appel√©e </font></font><code>IChildFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IChildFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] playfield, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tetriminoType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rotation)</span></span></span></span>; }</code> </pre> <br> <code>AI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a un constructeur alternatif qui obtient une impl√©mentation </font></font><code>IChildFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. S'il est disponible, </font></font><code>IChildFilter.validate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il sert de v√©rification suppl√©mentaire de l'autorisation de l'√âtat enfant; s'il revient </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, l'√©tat enfant n'est pas mis en file d'attente. </font></font><br><br> <code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Est une impl√©mentation</font></font><code>IChildFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">visant √† ramasser quatre rang√©es (Tetris). </font><font style="vertical-align: inherit;">Comme les joueurs vivants, elle construit progressivement un puits dans la colonne la plus √† droite du terrain de jeu, en augmentant ligne par ligne de bas en haut. </font><font style="vertical-align: inherit;">Puisqu'il fonctionne ligne par ligne, il rejette les √©tats enfants qui ajoutent un carr√© √† la colonne la plus √† droite. </font><font style="vertical-align: inherit;">Lorsque la ligne enti√®re, √† l'exception de la colonne de puits, est compl√®tement pleine, l'IA passe √† la ligne suivante. </font><font style="vertical-align: inherit;">Lorsque 4 ou plus de ces lignes sont pr√™tes, cela permet au ¬´b√¢ton¬ª de tomber dans le puits et d'obtenir Tetris. </font><font style="vertical-align: inherit;">De plus, la hauteur du tas est suivie; </font><font style="vertical-align: inherit;">s'il devient trop gros, il </font></font><code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cesse d'affecter l'IA.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82b/c27/710/82bc27710c0e5200d599be07bf549206.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour le tester en fonctionnement, apportez les </font></font><code>Main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modifications suivantes:</font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WellFilter());</code> </pre> <br> <code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionne, mais pas particuli√®rement efficace. Il contient une heuristique simple con√ßue pour d√©montrer le concept. Pour obtenir Tetris plus souvent, vous devez utiliser une strat√©gie plus sophistiqu√©e, peut-√™tre qui peut √™tre optimis√©e √† l'aide de PSO. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, vous pouvez utiliser le filtrage des √©tats enfants pour g√©n√©rer des mod√®les. Voici un exemple de ce dont il est capable </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/569/e21/15f/569e2115f8936fc3391d1bb330017d8a.png"></div><br> <code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Construit les images ligne par ligne de bas en haut, de la m√™me mani√®re que cela fonctionne </font></font><code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">cependant, au lieu de conserver la colonne la plus √† droite, il </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">approuve uniquement les √©tats enfants qui correspondent √† un mod√®le particulier. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le constructeur </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtient le nom d'une des images du package </font></font><code>tetris.gui.patterns</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qu'il utilise comme mod√®le. </font><font style="vertical-align: inherit;">Chaque image 20 √ó 10 contient des pixels noir et blanc correspondant aux cellules du terrain de jeu.</font></font><br><br><pre> <code class="java hljs">AI ai = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AI(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PatternFilter(<span class="hljs-string"><span class="hljs-string">"tetriminos"</span></span>));</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La ligne de code ci-dessus cr√©e les silhouettes de sept types de tetrimino. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb3/0c8/d79/cb30c8d795e12e41d3831a0735637a55.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Un autre exemple avec un grand tetrimino T tourn√© en biais. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf0/f95/14c/cf0f9514c3a08b88c4f67117614ade91.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre exemple. </font><font style="vertical-align: inherit;">Si vous regardez attentivement, vous verrez le nom du jeu.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a26/712/284/a267122840a2373e7bb5fb6fa6282018.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme </font></font><code>WellFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ce </font></font><code>PatternFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'est rien de plus qu'une preuve de concept. </font><font style="vertical-align: inherit;">Les mod√®les qu'il traite sont limit√©s au fond du terrain de jeu, car les tentatives pour les obtenir se terminent g√©n√©ralement par la fin du jeu. </font><font style="vertical-align: inherit;">Cependant, c'est une id√©e int√©ressante qui m√©rite une √©tude plus approfondie.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Version de la manette de jeu </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le script Lua et le programme Java ignorent la gravit√©; pour eux, la vitesse de descente n'est pas importante, car en fonction de la configuration, ils t√©l√©portent les chiffres imm√©diatement √† l'endroit souhait√© ou tra√Ænent le long du chemin choisi. D'une certaine mani√®re, ils imitent simplement Tetris, pas le jouent. Cependant, dans le </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier zip avec les sources,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il y a un autre script Lua qui joue en g√©n√©rant les signaux des boutons de la manette de jeu, ce qui permet au jeu de contr√¥ler le mouvement des figures, la gravit√© et tout le reste. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'ajout de gravit√© √©largit consid√©rablement l'espace de recherche, for√ßant l'IA √† prendre en compte les r√®gles astucieuses de la manipulation des formes. Le d√©tail de ces r√®gles est d√©crit dans la premi√®re partie de l'article, et peut √™tre pleinement appr√©ci√© par une √©tude directe du code.</font></font> Voici les plus importants: <br><br><ul><li>       : ,   . </li><li>   ¬´¬ª   . </li><li>   ¬´¬ª  ¬´¬ª    . </li><li>         . </li><li>          . </li><li>          . </li><li>          . </li><li>   ,        . </li><li>   A  B           . </li><li>  ¬´¬ª  ¬´¬ª       6      16 .     ¬´¬ª  ¬´¬ª   ,     . </li><li>  ¬´¬ª            3 . </li><li>       96 .    ,    ‚Äî . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour tenir compte de toutes ces r√®gles, les informations historiques doivent √™tre int√©gr√©es dans les √©tats de recherche. Ils ont besoin de champs dans lesquels le nombre de cadres de maintien pour chaque bouton et le nombre de cadres apr√®s la derni√®re version automatique seront stock√©s. Chaque ensemble unique de valeurs, y compris les coordonn√©es </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et la rotation tetrimino caract√©risent un √©tat s√©par√© et unique. Malheureusement, le nombre de possibilit√©s est si vaste qu'une recherche compl√®te de cet espace est impossible. La version AI pour la manette de jeu n'en explore qu'un sous-ensemble. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AI utilise un objet </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avec les champs suivants:</font></font><br><br><pre> <code class="java hljs">{ x, y, rotation, Left, Right, Down, A, B, fallTimer, visited, predecessor }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au lieu d'utiliser le d√©calage AI automatique dans des images alternatives, appuyez et rel√¢chez le bouton Shift. </font><font style="vertical-align: inherit;">Par cons√©quent, il n'a besoin de contr√¥ler que si le bouton est enfonc√© et non pendant combien de temps. </font><font style="vertical-align: inherit;">Puisque aucune rotation automatique, la m√™me id√©e s'applique aux boutons A et B. Par </font><font style="vertical-align: inherit;">cons√©quent , </font><font style="vertical-align: inherit;">le champ </font></font><code>Left</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>A</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut √™tre interpr√©t√© comme une liste contenant des valeurs suivantes:</font></font><br><br><pre> <code class="java hljs">{ RELEASED, PRESSED }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> En revanche, pour une descente en douceur, vous devez dans un premier temps maintenir enfonc√© le bouton ¬´Bas¬ª pour trois images, ce qui n√©cessite l'existence de 4 √©tats: </font></font><br><br><pre> <code class="java hljs">{ RELEASED, PRESSED_FOR_1_FRAME, PRESSED_FOR_2_FRAMES, PRESSED_FOR_3_FRAMES }</code> </pre> <br> <code>Down</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">augmente progressivement de la valeur </font></font><code>RELEASED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† </font></font><code>PRESSED_FOR_3_FRAMES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, √† laquelle une descente douce se produit. Apr√®s cela, il peut recevoir une valeur </font></font><code>RELEASED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou revenir √† </font></font><code>PRESSED_FOR_2_FRAMES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, provoquant une descente en douceur toutes les deux images apr√®s le d√©lai initial. Cela ne peut pas √™tre </font></font><code>RELEASED</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de </font></font><code>PRESSED_FOR_1_FRAME</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou de </font></font><code>PRESSED_FOR_2_FRAMES</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, le code Lua utilise une constante enti√®re, mais le principe est le m√™me. De </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√™me, </font></font><code>visited</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>predecessor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il est attribu√© la valeur obtenue lors de l' </font><font style="vertical-align: inherit;">√©criture dans l'√©tat de file d'attente subsidiaire; ce </font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera un de plus que la valeur de l'√©tat parent. Condition contenant</font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui est √©gale √† la vitesse de descente, implique que la descente automatique se produit dans cette trame, et l'√©tat suivant de cet √©tat </font></font><code>fallTimer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sera 0. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque </font></font><code>Searcher</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©d√©finit un </font></font><code>8-</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tableau contenant tous les √©tats possibles ( </font></font><code>20  √ó 10  √ó 4  √ó 2  √ó 2  √ó 4  √ó 2 A √ó 2 B</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), et BFS est ex√©cut√© de mani√®re similaire √† la m√©thode indiqu√©e pour le </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tableau. </font><font style="vertical-align: inherit;">Le pseudo-code ci-dessous d√©crit comment les √©tats suivants sont obtenus √† partir des √©tats de repos.</font></font><br><br><pre> <code class="cpp hljs">Slide = (Left == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (Right == PRESSED) Rotate = (A == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (B == PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == RELEASED <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Down == PRESSED_FOR_3_FRAMES then <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == RELEASED then nextDown = PRESSED_FOR_1_FRAME <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nextDown = PRESSED_FOR_2_FRAMES end addChild(Down = nextDown) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED, Down = nextDown) addChild(B = PRESSED, Down = nextDown) end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Slide then addChild() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED) addChild(B = PRESSED) end <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> addChild(Left = PRESSED) addChild(Right = PRESSED) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(Left = PRESSED, A = PRESSED) addChild(Left = PRESSED, B = PRESSED) addChild(Right = PRESSED, A = PRESSED) addChild(Right = PRESSED, B = PRESSED) end end <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == PRESSED_FOR_1_FRAME then nextDown = PRESSED_FOR_2_FRAMES <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nextDown = PRESSED_FOR_3_FRAMES end addChild(Down = nextDown) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Rotate then addChild(A = PRESSED, Down = nextDown) addChild(B = PRESSED, Down = nextDown) end end</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme indiqu√© dans le pseudo-code ci-dessous, la fonction </font></font><code>addChild</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend en compte l'ordre des √©v√©nements qui se produisent dans chaque image (par exemple, d√©calage, rotation et descente).</font></font><br><br><pre> <code class="cpp hljs">nextFallTimer = fallTimer + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Left == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x - <span class="hljs-number"><span class="hljs-number">1</span></span>, y, rotation) then x = x - <span class="hljs-number"><span class="hljs-number">1</span></span> elseif Right == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x + <span class="hljs-number"><span class="hljs-number">1</span></span>, y, rotation) then x = x + <span class="hljs-number"><span class="hljs-number">1</span></span> end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> A == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x, y, nextClockwiseRotation) then rotation = nextClockwiseRotation elseif B == PRESSED <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> testPosition(x, y, nextCounterclockwiseRotation) then rotation = nextCounterclockwiseRotation end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Down == PRESSED_FOR_3_FRAMES <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> nextFallTimer &gt;= dropSpeed then <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> testPosition(x, y + <span class="hljs-number"><span class="hljs-number">1</span></span>, rotation) then y = y + <span class="hljs-number"><span class="hljs-number">1</span></span> nextFallTimer = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> lockTetrimino() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> end end childState = states[y][x][rotation][Left][Right][Down][A][B] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> childState.visited then childState.visited = mark childState.predecessor = state childState.fallTimer = nextFallTimer <span class="hljs-built_in"><span class="hljs-built_in">queue</span></span>.enqueue(childState) end</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme dans la version pr√©c√©dente, il </font></font><code>AI.search</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renvoie une cha√Æne d'objets </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mais dans ce cas, chacun </font></font><code>State</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient de nombreux boutons qui doivent √™tre enfonc√©s dans chaque image. Champ </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>rotation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne sont pas utilis√©s pour manipuler les chiffres, mais il </font><font style="vertical-align: inherit;">peut √™tre utilis√© pour v√©rifier l'exactitude du mouvement des chiffres. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien que l'espace de recherche ait √©t√© consid√©rablement r√©duit en raison des limitations d√©crites ci-dessus, il faut 1 √† 3 secondes pour terminer la recherche. Si vous l'ex√©cutez, vous remarquerez une pause apr√®s la cr√©ation de chaque tetrimino. De plus, les mouvements semblent tr√®s peu naturels; g√©n√©ralement, un virage est effectu√© un instant avant le verrouillage. Cependant, cette IA joue presque de la m√™me mani√®re que la version qui ignorait la gravit√©, m√™me √† vitesse maximale.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour le v√©rifier, ex√©cutez-le </font></font><code>lua/NintendoTetrisAIGamepadVersion.lua</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, situ√© dans le </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier zip avec les sources</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un moyen plus simple de tenir compte de la gravit√© consiste √† limiter le mouvement des figures uniquement en tournant, suivi d'un d√©calage, puis en descendant vers le bas. </font><font style="vertical-align: inherit;">L'id√©e est que si vous vous d√©barrassez du glissement et du d√©filement, la vitesse verticale des figures aura peu d'effet sur l'IA; </font><font style="vertical-align: inherit;">tout ce qu'il doit faire est de livrer la figure √† la colonne souhait√©e, et la gravit√© fera le reste. </font><font style="vertical-align: inherit;">Un autre avantage de cette technique est que l'espace de recherche est tr√®s petit, ce qui vous permet de jouer en temps r√©el, sans d√©lai pour les calculs. </font><font style="vertical-align: inherit;">Cependant, l'inconv√©nient de cette approche est que sans glissement et d√©filement, l'IA joue bien pire. </font><font style="vertical-align: inherit;">Cependant, le Tetris AI, incapable de jouer en temps r√©el, est pratiquement sans valeur.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Addition </font></font></h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfd/2c5/a7e/cfd2c5a7e44131bfc188c3eea6ad5139.png" alt="Tetris"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus t√¥t, j'ai √©crit un plugin qui simulait proc√©duralement un joueur dans Tetris. </font><font style="vertical-align: inherit;">Cependant, mon projet avait quelques inconv√©nients:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le bot a d√©sactiv√© la gravit√©, vous permettant d'effectuer des glissements et des d√©filements, d√©passant les capacit√©s du joueur au niveau tr√®s minimal de Nintendo Tetris. </font><font style="vertical-align: inherit;">Il n'augmente jamais les chiffres, mais la seule fa√ßon de les abaisser est une descente douce contr√¥l√©e. </font><font style="vertical-align: inherit;">Autrement dit, il joue dans un monde th√©orique id√©alis√©. </font><font style="vertical-align: inherit;">Pour le dire franchement, il triche.</font></font></li><li>   .    ‚Äî  ,      .     Double, Triple  Tetris,         ‚Äî  ,    .         90.    ,   ,       29   -     . </li><li>          .      .       .     ,  Tetris      . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans cette section, je vais parler d'un bot avanc√© qui joue √† Nintendo Tetris sans d√©sactiver la gravit√©. </font><font style="vertical-align: inherit;">Il √©value le risque et le g√®re, s'effor√ßant agressivement d'obtenir le maximum de points avant d'atteindre une vitesse de descente √©lev√©e.</font></font><br><br><hr><br><h1>  Vid√©o </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Regardez le bot gagner le nombre maximum de points Nintendo Tetris √† partir du niveau 19 dans toutes les vid√©os pr√©sent√©es ci-dessous. </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/l2YOt_GdfA0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zsd3eAYMlN0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/efh-_zeQH4Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><hr><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> T√©l√©chargez </font></font></h1><br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TetrisAI_2018-01-28.zip</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le fichier </font></font><code>.zip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient:</font></font><br><br><ul><li> <code>src</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - arbre de code source. </font></font></li><li> <code>TetrisAI.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - fichier binaire compil√©. </font></font></li><li> <code>lgpl-2.1.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - licence de logiciel libre. </font></font></li></ul><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lancement </font></font></h1><br><h2>  Pr√©requis </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nintaco</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un √©mulateur NES / Famicom.</font></font></li><li> <code>Tetris (U) [!].nes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Fichier ROM Nintendo Tetris. </font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lancement du plugin </font></font></h2><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lancez Nintaco et ouvrez </font></font><code>Tetris (U) [!].nes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extrait </font></font><code>TetrisAI.jar</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du t√©l√©chargement </font></font><code>.zip</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez la fen√™tre Ex√©cuter le programme en choisissant Outils | </font><font style="vertical-align: inherit;">Ex√©cuter le programme ...</font></font></li><li>        JAR        Find JAR‚Ä¶ . </li><li>  Load JAR,   . </li><li>  Run. </li><li>        ,       <code>GAME TYPE</code>  <code>MUSIC TYPE</code> .   <code>D-pad</code> (     )  <code>A-TYPE</code>   .   Start (Enter),      . </li><li>    <code>A-TYPE</code>  <code>D-pad</code> (  )   <code>LEVEL 9</code> . ,    <code>A</code>    Start (   <code>X</code>   Enter),     19,    . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il convient de noter que le bot est con√ßu uniquement pour le niveau 19 et sup√©rieur. </font><font style="vertical-align: inherit;">Aux niveaux inf√©rieurs, il ne pourra pas contr√¥ler les pi√®ces.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R√©f√©rence de vitesse </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour acc√©l√©rer le jeu, s√©lectionnez Machine | </font><font style="vertical-align: inherit;">Vitesse | </font><font style="vertical-align: inherit;">Max</font></font><br><br><hr><br><h1>  D√©tails </h1><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Plateau </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En dessous du niveau 10, la vitesse de descente √† chaque niveau est l√©g√®rement sup√©rieure √† celle du pr√©c√©dent. </font><font style="vertical-align: inherit;">Mais au niveau de 10 et au-dessus il y a plusieurs plateaux o√π la vitesse reste constante pour plusieurs niveaux. </font><font style="vertical-align: inherit;">C'est une cons√©quence du fonctionnement du m√©canisme de d√©clenchement. </font><font style="vertical-align: inherit;">La vitesse est pr√©sent√©e comme le nombre d'images par descente, qui est une valeur enti√®re. </font><font style="vertical-align: inherit;">Autrement dit, pour les niveaux sup√©rieurs, il n'y a pas beaucoup d'options disponibles: 10‚Äì12, 13‚Äì15, 16‚Äì18, 19‚Äì28 et 29+ sont 5, 4, 3, 2 et 1 image pour la descente.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le bot a √©t√© d√©velopp√© en ne prenant en compte que le plateau 19-28. Dans les images paires, il clique sur la manette de jeu "Gauche", "Droite", A, B ou rien. Et dans des cadres impairs, il permet une descente automatique sans appuyer sur aucun bouton. Il semble que le jeu ne per√ßoive pas le mouvement horizontal co√Øncidant avec la rotation; par cons√©quent, chaque bouton est appuy√© ind√©pendamment dans des images paires. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Contrairement aux ma√Ætres qui jouent √† des niveaux √©lev√©s, le bot ne profite pas du d√©calage automatique diff√©r√© (DAS), √©galement connu sous le nom de r√©p√©tition automatique, et des techniques connexes. Son travail rappelle davantage </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la technique du pouce vibrant de Thor Akerlund</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cependant, cela augmente la fr√©quence des vibrations au maximum th√©orique autoris√© par le jeu.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les joueurs sont r√©compens√©s par 40, 100, 300 et 1200 points pour Single, Double, Triple et Tetris. </font><font style="vertical-align: inherit;">Et les points sont multipli√©s par le nombre de niveaux plus 1. En d'autres termes, pour obtenir le score maximum, le joueur doit viser le nombre maximum de Tetris, en jouant le plus longtemps possible √† des niveaux √©lev√©s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le niveau 19 est le plus √©lev√© pouvant √™tre s√©lectionn√© comme niveau initial, ce qui permet au bot de sauter directement sur le plateau 19-28. </font><font style="vertical-align: inherit;">Cependant, en raison d'un bug dans le m√©canisme de calcul de niveau que j'ai mentionn√© dans la partie pr√©c√©dente, le jeu passera au niveau 20 apr√®s avoir effac√© 140 lignes, au lieu des 200 attendus. Apr√®s cela, le jeu changera de niveau toutes les 10 lignes. </font><font style="vertical-align: inherit;">Cependant, apr√®s avoir atteint 230 rang√©es, le bot se l√®vera du plateau et abandonnera rapidement. </font><font style="vertical-align: inherit;">Autrement dit, il doit composer autant de Tetris que possible avant de nettoyer 230 lignes.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Descente douce </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La descente en douceur peut √©galement augmenter le nombre de points. </font><font style="vertical-align: inherit;">Pour obtenir des points, la figurine doit √™tre doucement abaiss√©e pour se verrouiller sur le terrain de jeu. </font><font style="vertical-align: inherit;">Toute descente douce √† court terme qui se produit en cours de route lors du positionnement d'une figure n'affectera pas le score. </font><font style="vertical-align: inherit;">Si la descente est r√©ussie, le joueur recevra un point pour chaque ligne franchie lors de la descente en douceur. </font><font style="vertical-align: inherit;">Et la valeur r√©sultante n'est pas multipli√©e par le num√©ro de niveau, m√™me si une descente douce conduit √† effacer les lignes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La descente en douceur a peu d'effet sur le score global. </font><font style="vertical-align: inherit;">Cependant, si possible, le bot termine le placement de la figure en cliquant sur ¬´Bas¬ª pour obtenir ces points. </font><font style="vertical-align: inherit;">Dans de rares cas, il peut faire la moyenne de la diff√©rence entre un score tr√®s √©lev√© et d√©passer le score maximum.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algorithme d'IA </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lors de la cr√©ation d'une forme, le bot explore tous les emplacements possibles des formes actuelles et suivantes. Le placement autoris√© est la position dans laquelle la figurine repose soit sur des cellules occup√©es, soit sur le sol du terrain de jeu. Depuis le lieu de cr√©ation de la figure, cette position peut √™tre atteinte par une s√©quence de mouvements horizontaux, de virages et de descentes. Les emplacements valides et les s√©quences de chemins sont trouv√©s √† l'aide de BSF. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Placer un morceau sur le terrain de jeu a des cons√©quences: 4 cellules vides deviennent occup√©es, et toutes les lignes remplies sont effac√©es, laissant les lignes descendre. Pour chaque placement autoris√© de la figure actuelle et les cons√©quences qui y sont associ√©es, le bot v√©rifie chaque placement autoris√© de la figure suivante, √©valuant la combinaison des cons√©quences. Une telle cha√Æne de recherche est pr√©sent√©e </font></font><code>SearchChain</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chacune des cons√©quences combin√©es est transf√©r√©e vers une fonction d'√©valuation qui calcule le contenu du terrain de jeu. </font><font style="vertical-align: inherit;">La combinaison avec le score le plus bas gagne et la pi√®ce actuelle est plac√©e en cons√©quence. </font><font style="vertical-align: inherit;">Les r√©sultats de la cha√Æne de recherche affectent uniquement la forme actuelle. </font><font style="vertical-align: inherit;">Lors de la cr√©ation de la figure suivante, elle est √©valu√©e en combinaison avec la figure qui la suit, etc.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fonction d'√©valuation </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> La fonction d'√©valuation est une somme pond√©r√©e des param√®tres suivants: </font></font><br><br><ul><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le nombre total de lignes effac√©es</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est le nombre de lignes effac√©es par l'ajout des deux t√©triminos.</font></font></li><li> <strong>  </strong> ‚Äì      ,   .     ‚Äî   ,        ,       . </li><li> <strong>  -</strong> ‚Äì    . </li><li> <strong>   </strong> ‚Äì  ,     -. </li><li> <strong>    </strong> ‚Äì   ,      .         .     . </li><li> <strong>     </strong> ‚Äì      .       ,   1.   ,         ,           . </li><li> <strong>     </strong> ‚Äì         ,    .  ‚Äî        ,    ‚Äî          . </li><li> <strong>    </strong> ‚Äì     .   ,         (20). </li><li> <strong>    </strong> ‚Äì     .   ,      0. </li><li> <strong>    </strong> ‚Äì   ,     ( )    . </li><li> <strong>    </strong> :    ‚Äî   ,     ( )    .         .        .          . </li><li> <strong>   </strong> ‚Äì           . ,   1  ,   1,     ‚Äî  0. </li><li> <strong> </strong> ‚Äì   . </li><li> <strong>  </strong> ‚Äì         . </li><li> <strong>   </strong> ‚Äì      . </li><li> <strong>    </strong> ‚Äì     .     . </li><li> <strong>  </strong> ‚Äì        . </li></ul><br><h2>  Apprentissage automatique </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour trouver les poids de la fonction d'√©valuation, nous avons utilis√© une variante de la m√©thode d'optimisation des essaims de particules (PSO) d√©crite dans la note de bas de page [1]. Pour obtenir un bon comportement convergent, les coefficients d'inertie et d'acc√©l√©ration propos√©s sont appliqu√©s. Et les tailles maximales des pas de particules sont d√©termin√©es par la limitation de leurs valeurs de vitesse. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au cours de chaque it√©ration, les particules ont √©t√© √©valu√©es en parall√®le pour utiliser pleinement les ressources informatiques disponibles. De plus, une fois la convergence d√©tect√©e (aucune am√©lioration apr√®s un certain nombre d'it√©rations), le PSO a √©t√© configur√© pour red√©marrer automatiquement avec des poids s√©lectionn√©s au hasard, ce qui nous a permis d'explorer davantage l'espace de recherche.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque vecteur de position des particules a √©t√© √©valu√© en simulant l'ach√®vement de 100 lots sur un plateau de niveaux 19 √† 28. Un lot complet implique le nettoyage de 230 lignes, mais beaucoup se sont termin√©es par un d√©bordement du champ. Les scores des lots ont √©t√© tri√©s et les scores des particules ont √©t√© d√©termin√©s comme la moyenne de 33 lots sur 100. L'id√©e √©tait de choisir en fonction de l'agressivit√©. Les particules du tiers sup√©rieur ne s'habituent qu'aux s√©quences de chiffres souhait√©es, ce qui limite la n√©cessit√© d'un jeu conservateur. En cons√©quence, ils ont tendance √† pousser le jeu habituel au bord du gouffre, en attendant le prochain ¬´b√¢ton¬ª.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des s√©quences de motifs pour 100 lots ont √©t√© g√©n√©r√©es avant la PSO, et les m√™mes s√©quences ont √©t√© utilis√©es encore et encore. Cela √©tait n√©cessaire pour fixer l'espace de recherche, afin que les options de solution puissent √™tre compar√©es les unes aux autres. Les s√©quences ont √©t√© cr√©√©es en utilisant la logique d'un vrai PRNG Nintendo Tetris, qui est con√ßu pour r√©duire les chances de doublons les uns apr√®s les autres. Mais PRNG a √©galement des faiblesses (voir la section ¬´Choisir Tetrimino¬ª d'un article pr√©c√©dent): il ne s√©lectionne pas les chiffres de mani√®re uniforme. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les premi√®res tentatives ont conduit les bots √† agir de mani√®re trop agressive. S'ils surmontaient le plateau 19-28, ils atteignaient g√©n√©ralement le score maximum. Mais, malheureusement, elles ont souvent conduit trop t√¥t √† des d√©bordements sur le terrain. En r√©ponse √† cela, quatre mesures ont √©t√© prises pour ¬´calmer¬ª les robots:</font></font><br><br><ol><li>    :        Tetris,   .      ¬´¬ª          .          .     ;     230 .  ,      Tetris   .        Single, Double  Triple.          ;        . </li><li>          .      ,   ,      7 .         . </li><li>  ,          ,           .        ,       7 . </li><li>          ,      ,      .       ,       .         ,      . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Apr√®s avoir appliqu√© toutes ces r√®gles pour ¬´calmer¬ª les bots, la m√©thode PSO a donn√© les poids suivants: </font></font><br><br><table><tbody><tr><th>  Param√®tre </th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le poids </font></font></th></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nombre total de lignes effac√©es </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0,286127095297893900 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hauteur totale de blocage </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.701233676909959200 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nombre total de cellules de puits </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0,711304230768307700 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nombre total de puits profonds </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0,910665415998680400 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le nombre total de trous dans les colonnes </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.879338064244357000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Total des trous de colonne pond√©r√©s </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2.168463848297177000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nombre total de profondeurs de trous dans les colonnes </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí0,265587111961757270 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Profondeur minimale du trou de colonne </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0,289886584949610500 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Profondeur maximale du trou de colonne </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0,362361055261181730 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le nombre total de transitions dans les colonnes </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí0,028668795795469625 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Total des sauts de ligne </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0,874179981113233100 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hauteur totale des colonnes </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí0,507409683144361900 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hauteur de tas </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí2.148676202831281000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dispersion des hauteurs de colonne </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí1.187558540281141700 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nombre total de cellules occup√©es </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚àí2,645656132241128000 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nombre total pond√©r√© de cellules occup√©es </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0,242043416268706620 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dispersion des hauteurs de colonne </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0,287838126164431440 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que la cha√Æne cherche une combinaison qui minimise la fonction d'√©valuation, les param√®tres qui ont des poids positifs peuvent √™tre consid√©r√©s comme des bonus, et le reste - des amendes. </font><font style="vertical-align: inherit;">Mais les poids ne montrent pas n√©cessairement la signification des param√®tres correspondants; </font><font style="vertical-align: inherit;">ils ne sont pas normalis√©s, ils ne peuvent donc pas √™tre compar√©s.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Force de l'IA </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour √©valuer la force de l'IA, environ 1,7 million de r√©sultats (en points) de jeux simul√©s ont √©t√© collect√©s sur un plateau de 19 √† 28. Le score ne refl√®te pas le jeu au niveau 29 ou sup√©rieur et ne prend pas en compte les points obtenus en descente douce. Cependant, il comprend des parties pr√©matur√©ment termin√©es en raison de d√©bordements sur le terrain. La logique Nintendo Tetris PRNG a √©t√© utilis√©e pour g√©n√©rer les s√©quences Tetrimino. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parmi ces r√©sultats, le score le plus √©lev√© est de 1 313 600. Le minimum est de 0. La </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moyenne est de 816 379, et il semble √™tre faible. Mais comme mentionn√© ci-dessous, les donn√©es sont d√©form√©es, de sorte que le score m√©dian de 989 200 points donne une meilleure id√©e de la valeur typique.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme indiqu√© ci-dessus, les poids optimis√©s par PSO sont bas√©s sur la moyenne du meilleur tiers des lots. </font><font style="vertical-align: inherit;">Dans ce cas, le score moyen du meilleur tiers est de 1 108 860. En fait, le score moyen des meilleurs 75% est de 1 000 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000. </font><font style="vertical-align: inherit;">Le </font><font style="vertical-align: inherit;">bot a une probabilit√© de 47% d'atteindre la limite de points au niveau 29. Il a une probabilit√© de 61% d'obtenir 900 000 points au niveau 29. Le graphique ci-dessous montre les probabilit√©s de marquer jusqu'au niveau 29.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a8/082/43a/5a808243a35de546e886bcf6cc8663aa.png" alt="densit√© de probabilit√©"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il semble que la probabilit√© diminue lin√©airement √† environ 900 000 points. </font><font style="vertical-align: inherit;">Il entre ensuite dans une courbe sigmo√Øde invers√©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous trouverez ci-dessous un histogramme liss√© avec le nombre de parties pour chacun des points marqu√©s. </font><font style="vertical-align: inherit;">Sa forme est d√©termin√©e par la d√©riv√©e du graphique ci-dessus.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b4/cf4/a7c/7b4cf4a7cfc06203bedef3b81243d20b.png" alt="histogramme"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous ignorez les fluctuations, alors jusqu'√† environ 900 000, il est plat, puis passe dans une distribution normale avec le centre autour de 1 050 000 points. </font><font style="vertical-align: inherit;">Les raisons des fluctuations ne sont pas claires. </font><font style="vertical-align: inherit;">Il semble que le nombre de points pr√©f√®re sauter par incr√©ments de 20 000 points. </font><font style="vertical-align: inherit;">Cela est peut-√™tre d√ª au cycle de construction du tas et √† l'obtention de Tetris.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Allocation de RAM et de ROM </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour manipuler la m√©moire du processeur, transmettre des clics sur les boutons et recevoir des √©v√©nements de rendu d'image, le plugin utilise l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API Nintaco</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Toutes les adresses m√©moire ont √©t√© d√©couvertes √† l'aide des outils de d√©bogage Nintaco et des informations ont √©t√© ajout√©es au </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wiki Data Crystal ROMhacking.net</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans le code source, ils ressemblent √† des constantes dans l'interface </font></font><code>Addresses</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les r√©f√©rences </font></font></h1><br><ol><li> van den Bergh, F.; Engelbrecht, AP (2006) <br> A study of particle swarm optimization particle trajectories <br> In: <i>Information Sciences 176 (2006)</i> (pp. 937‚Äì971) <br> Retrieved from <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://researchspace.csir.co.za/dspace/bitstream/handle/10204/1155/van%20den%20bergh_2006_D.pdf</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr421065/">https://habr.com/ru/post/fr421065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr421055/index.html">D√©veloppement Web personnalis√©: comment √©voluer sur un projet en constante √©volution</a></li>
<li><a href="../fr421057/index.html">Comment assembler des wagons pour les trains de voyageurs</a></li>
<li><a href="../fr421059/index.html">Acc√©l√©rer les sites avec les premiers conseils</a></li>
<li><a href="../fr421061/index.html">PostgreSQL: comment et pourquoi le WAL se gonfle</a></li>
<li><a href="../fr421063/index.html">Nouveaux livres sur la programmation pour enfants √† gratter</a></li>
<li><a href="../fr421067/index.html">Comment nous avons d√©velopp√© l'application AR pour examiner les lieux historiques</a></li>
<li><a href="../fr421069/index.html">Sac √† dos Bobby Urban: Inside the Castle</a></li>
<li><a href="../fr421071/index.html">Mod et reste ne sont pas les m√™mes</a></li>
<li><a href="../fr421073/index.html">√âpisode 1. Co√ªt du piratage</a></li>
<li><a href="../fr421075/index.html">Dictionnaire num√©rique de A √† Z</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>