<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍂 👆🏻 🎀 使用OpenVPN组织到工业PLC的远程连接的指南 🤙🏿 🤹🏻 😅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本文中，我想谈谈通过基于KEENETIC 4G Internet中心的预算解决方案组织对工业可编程逻辑控制器（以下称为PLC）的远程访问所获得的经验。 

 对于那些询问远程访问的组织但不知道从哪里开始的过程控制系统领域的专家来说，本文将特别有趣。 

 因此，让我们开始吧！ 
 在此示例中，我们...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用OpenVPN组织到工业PLC的远程连接的指南</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481028/"><img src="https://habrastorage.org/webt/3i/sk/nc/3isknctx60njaa-migvm12k3hli.png" alt="图片"><br><br> 在本文中，我想谈谈通过基于KEENETIC 4G Internet中心的预算解决方案组织对工业可编程逻辑控制器（以下称为PLC）的远程访问所获得的经验。 <br><br> 对于那些询问远程访问的组织但不知道从哪里开始的过程控制系统领域的专家来说，本文将特别有趣。 <br><a name="habracut"></a><br><h2> 因此，让我们开始吧！ </h2><br> 在此示例中，我们考虑最常见的选项，即： <br><br><ol><li> 本地计算机将是安装了用于PLC编程的TIA Portal软件包的OpenVPN服务器。  （局域网192.168.1.0） </li><li> 具有外部白色IP地址的企业路由器（例如217.196.58.128）。 </li><li>  KEENETIC 4G Internet Center，其已安装的OpenVPN客户端已连接到移动通信。 </li><li> 可编程逻辑控制器SIMATIC S7-1500（LAN 192.168.112.0）。 </li></ol><br> 各方之一上存在外部白色IP地址是OpenVPN服务器正常工作的先决条件（OpenVPN服务器必须位于白色IP地址的侧面）。 <br><br> 要在KEENETIC Internet Center和工作站之间建立VPN连接，我们需要安装以下软件： <br><br><ol><li>  <a href="https://openvpn.net/community-downloads/">OpenVPN-用于创建安全的虚拟专用网络，与服务器的远程连接的程序</a> </li><li>  <a href="https://www.hohnstaedt.de/xca/index.php/download">XCA-使用图形界面轻松创建证书的程序</a> </li><li>  <a href="https://notepad-plus-plus.org/downloads/">记事本++-文本编辑器（可选）</a> </li></ol><br><h3> 在Windows上安装OpenVPN软件包。 </h3><br> 安装EasyRSA组件（用于使用内置工具（可选）创建证书。 <br><br><img src="https://habrastorage.org/webt/bf/7g/xa/bf7gxa6zvllo29oail2qstdg-co.jpeg" alt="图片"><br><br> 如果出现有关安装驱动程序的消息，请单击“安装”。 <br><br><img src="https://habrastorage.org/webt/r2/s5/rh/r2s5rh8r8ornoxklsgxhfvaprg4.jpeg" alt="图片"><br><br> 如果需要安装多个虚拟适配器，或者虚拟适配器安装不正确，请转到下面的地址并运行“ addtab.bat”脚本： <br>  C：\ Program Files文件\ TAP Windows \ bin <br><br><img src="https://habrastorage.org/webt/ge/m0/dp/gem0dp_mchsh0vkis-bmlhzqboy.jpeg" alt="图片"><br><br><h2> 创建X.509证书 </h2><br><h4>  1.安装XCA </h4><br>  <a href="https://www.hohnstaedt.de/xca/index.php/download">XCA-使用图形界面轻松创建证书的程序</a> <br><br><h4>  2.创建一个数据库 </h4><br> 单击“文件”-&gt;“新数据库”，程序将要求输入密码，输入密码或将字段保留为空，然后单击“确定”。 <br><br><img src="https://habrastorage.org/webt/er/fl/3s/erfl3ss-uhrge4kzooky7r0998i.jpeg" alt="图片"><br><br><h4>  3.创建证书颁发机构（CA）的证书 </h4><br> 为此，请切换到“证书”选项卡，然后单击“新证书”按钮 <br><br><img src="https://habrastorage.org/webt/az/dg/ex/azdgexomfppvs1tqbl9wqpro2ki.jpeg" alt="图片"><br><br> 接下来，切换到“主题”选项卡并填写必填字段（红色突出显示的名称应具有唯一名称）。 <br><br><img src="https://habrastorage.org/webt/fz/ko/lt/fzkoltel9co6savlmnvuyvgdcdc.jpeg" alt="图片"><br><br> 单击“生成新密钥”，然后单击“创建”按钮确认操作。 <br><br><img src="https://habrastorage.org/webt/jf/xz/ce/jfxzceulmlnzxbwovjjm19d9ucw.jpeg" alt="图片"><br><br> 切换到“扩展名”选项卡，选择证书“证书颁发机构”的类型并配置证书有效期（CA证书的有效期必须比稍后创建的计算机证书更长。） <br><br><img src="https://habrastorage.org/webt/88/2n/zu/882nzumclm0gokjy8sfioql74jg.jpeg" alt="图片"><br><br> 单击“确定”，现在我们可以开始配置计算机证书了。 <br><br><h4>  4.创建计算机证书模板 </h4><br> 为了简化机器证书的创建，我们将使用预先准备的模板。 切换到“模板”选项卡，然后单击“新模板”按钮。 <br><br><img src="https://habrastorage.org/webt/cd/qh/xj/cdqhxjo7h1jhlf_ohhdm5fjgw2s.jpeg" alt="图片"><br><br> 选择“空模板”，然后继续编辑我们的模板，尖括号中的名称将来应该是唯一的。 <br><br><img src="https://habrastorage.org/webt/1j/0r/xm/1j0rxmktxgsn-2uuqbqqbkbx0ek.jpeg" alt="图片"><br><br> 我们转到“扩展名”选项卡，将类型设置为“最终主题”，并配置计算机证书的有效期限（该期限不得超过认证中心的证书）。 <br><br><img src="https://habrastorage.org/webt/pm/ft/ms/pmftmsgb6zuerbm0jx9aekbrbxm.jpeg" alt="图片"><br><br> 单击确定以创建模板。 <br> 现在，该模板可用作创建由我们的认证中心签名的机器证书的基础模板。 <br><br><h4>  5.使用模板创建计算机证书 </h4><br> 切换到“证书”选项卡，然后单击“新证书”按钮，选择“使用此证书进行签名”选项，选择我们的&lt;My_Machine&gt;模板作为模板，然后单击“全部应用”按钮。 <br><br><img src="https://habrastorage.org/webt/r6/lj/i8/r6lji8nwfwn-0bjq8isxvtqt2nq.jpeg" alt="图片"><br><br> 接下来，转到“主题”选项卡，输入唯一的名称，例如“ My_Server”，生成密钥。 <br><br><img src="https://habrastorage.org/webt/xi/9z/jk/xi9zjkd6fblpi8zntftye3eqfco.jpeg" alt="图片"><br><br> 因此，我们创建了服务器证书。 我们对客户端证书（My_Client）执行相同的过程。 <br><br><img src="https://habrastorage.org/webt/la/xk/6c/laxk6cujtstogpz5cqwr0z5nmfc.jpeg" alt="图片"><br><br><h4>  6.导出机器证书和密钥 </h4><br> 要创建OpenVPN客户端（KEENETIC）和服务器（Windows PC）的配置文件，我们需要导出认证中心的证书，服务器证书，客户端证书，服务器私钥，客户端私钥。 <br><br> 为此，请转到“证书”选项卡，选择My_CA证书颁发机构的证书，单击“导出”按钮，然后上载到桌面上以前创建的文件夹，例如My_Keys。 <br><br><img src="https://habrastorage.org/webt/kf/fv/_b/kffv_bjghn_sirpt851efwjnmag.jpeg" alt="图片"><br><br> 我们对客户端证书（My_Client）和服务器证书（My_Server）进行相同的操作。 <br><br> 切换到“私有密钥”选项卡，选择My_Client密钥，单击“导出”并上传到我们的文件夹。 <br><br><img src="https://habrastorage.org/webt/t8/ns/ms/t8nsmsnb0szgsaenlfzmaxcrffi.jpeg" alt="图片"><br><br> 我们对服务器密钥执行相同的过程。 <br><br><h4>  7.创建Diffie-Hellman参数 </h4><br> 要配置服务器参数，我们还需要Diffie-Hellman参数 <br> 要创建参数，请单击“高级”选项卡，然后选择“生成Diphia-Hellman参数”选项。 <br><br><img src="https://habrastorage.org/webt/ij/54/gv/ij54gvdkpwzzlpi1edtkrk3udbu.jpeg" alt="图片"><br><br> 接下来，选择参数长度，例如2048。接下来，使用键将我们的参数上传到文件夹。 <br><br><img src="https://habrastorage.org/webt/fp/pu/ax/fppuaxshiqd8gnsl-g1sueq_pye.jpeg" alt="图片"><br><br> 因此，以下文件应位于我们的文件夹中： <br><br><ol><li> 证书颁发机构证书My_CA.crt </li><li> 客户端证书My_Client.crt </li><li> 服务器证书My_Server.crt </li><li> 客户端私钥My_Client.pem </li><li> 服务器My_Server.pem的私钥 </li><li>  Diphia-Hellman参数dh2048.pem </li></ol><br><img src="https://habrastorage.org/webt/k4/k1/ng/k4k1ng5oqqcd_1fgzp_ub3frntg.jpeg" alt="图片"><br><br><h2> 创建客户端和服务器配置文件 </h2><br> 因为 由于S7-1500工业通信协议是Profinet，因此要建立与PLC的连接，我们需要组织一个L2连接，在这种情况下为TAP接口。 <br><br><h3> 配置OpenVPN服务器 </h3><br> 要创建服务器配置文件，请转到包含OpenVPN配置文件的文件夹[C：\ Program Files \ OpenVPN \ config]，然后创建扩展名为.ovpn的TAP_Server文件。 <br><br><img src="https://habrastorage.org/webt/l6/se/y8/l6sey8_ftv5zvrjj8lm7ccxu_ew.jpeg" alt="图片"><br><br> 使用文本文件查看器（例如，记事本++）打开TAP_Server.ovpn文件，然后复制以下文本： <br><br><pre><code class="plaintext hljs">#    L2  dev tap # ,   Windows  #    TAP-Windows  dev-node MyTap #       TAP  server-bridge #       IP proto udp4 #   ,     OpenVPN port 50501 #   10       120  #     ,  . keepalive 10 120 #    cipher AES-256-CBC #    verb 3 #       &lt;ca&gt; &lt;/ca&gt; #      &lt;cert&gt; &lt;/cert&gt; #      &lt;key&gt; &lt;/key&gt; #     () Diffie-Hellman (-). &lt;dh&gt; &lt;/dh&gt;</code> </pre> <br> 然后打开文本文件查看器My_CA.crt，My_Server.crt，My_Server.pem，dh2048.pem，然后从以下位置复制文本： <br>  &lt;ca&gt; &lt;/ ca&gt;中的My_CA.crt <br>  &lt;cert&gt; &lt;/ cert&gt;中的My_Server.crt <br>  &lt;key&gt; &lt;/ key&gt;中的My_Server.pem <br>  &lt;dh&gt; &lt;/ dh&gt;中的dh2048.pem <br><br><img src="https://habrastorage.org/webt/x5/tk/ow/x5tkowkf3whirnr8gfan-a8cola.jpeg" alt="图片"><br><br> 结果，我们得到以下信息： <br><pre> <code class="plaintext hljs">dev tap dev-node MyTap server-bridge proto udp4 port 50501 keepalive 10 120 cipher AES-256-CBC verb 3 &lt;ca&gt; -----BEGIN CERTIFICATE----- MIIDqjCCApKgAwIBAgIIJJ8tf67Csf4wDQYJKoZIhvcNAQELBQAwgYsxCzAJBgNV BAYTAlJVMRQwEgYDVQQIEwtLUkFTTk9ZQVJTSzEUMBIGA1UEBxMLS1JBU05PWUFS U0sxDjAMBgNVBAoTBU15T1JHMQ4wDAYDVQQLEwVNeU9SRzEOMAwGA1UEAwwFTXlf Q0ExIDAeBgkqhkiG9w0BCQEWEW15ZW1haWxAbXlob3N0Lnh4MB4XDTE5MTIxMzAw MDAwMFoXDTQ5MTIxMjIzNTk1OVowgYsxCzAJBgNVBAYTAlJVMRQwEgYDVQQIEwtL UkFTTk9ZQVJTSzEUMBIGA1UEBxMLS1JBU05PWUFSU0sxDjAMBgNVBAoTBU15T1JH MQ4wDAYDVQQLEwVNeU9SRzEOMAwGA1UEAwwFTXlfQ0ExIDAeBgkqhkiG9w0BCQEW EW15ZW1haWxAbXlob3N0Lnh4MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC AQEA3dJoAVl7foXZMavZIr9RTB59h+El26OYll7KMBHritf+x8DEVjcg86uyDSf0 yzLtAR+8J013W3SRDVpl3gqdk3t1qb7Paz1OUrV2Hu3N5Ws1s4elpENTQAe1HFZS u0NRhXBCxTTyToNdb1pKcIJziVNLXdTL+pud0T8FNs6q37t14XFkfDOw85m7y3py vU8+ucmQEd5vOKPjcY1jklVZkQJKcGTI77x/R2k6HK7ryul5uIepi/RrVrgTNe5W rYWuk6wlmmFLvgdzoVaBJO8edo89M7oJIQFMNN9x3cpbths6/3ZummBktfgVa7xy 3fs//M5v1pjnYeJ5wd5tiCXkpQIDAQABoxAwDjAMBgNVHRMEBTADAQH/MA0GCSqG SIb3DQEBCwUAA4IBAQDbNhPy3IftjPVNyaUH/5AW6R0Fjqoct/55ZMDrdWlLY1mo iTTxhFPv1DbilUE/nr+SwGvZV2MQs4G1hi9PgGqY5a+lJCSios8BJ7zlrt/LLQQ/ st0r2wzpCYROxoi+zu9YNGZJPP9GI3KdcVye9Rt3vbLbL8LQ8kKKwn3Ju5i1SUMy gzvGTNUPtqOKVJid39IIdva3iMUBspfMGv2EcaGaRWekW9Pni/gBS2eHkBH1/X6n KiopjtZw7A4RPHzC58jp+ypT/X63tPwf5+kWsMDeLG1XTKnLoPeAVNtszMhGsgzE DoZUuL4pb8XbpcnrPlgp0WSkrf1RJrJGuArvUDLu -----END CERTIFICATE----- &lt;/ca&gt; &lt;cert&gt; -----BEGIN CERTIFICATE----- MIIDyzCCArOgAwIBAgIIINPrUqBedY8wDQYJKoZIhvcNAQELBQAwgYsxCzAJBgNV BAYTAlJVMRQwEgYDVQQIEwtLUkFTTk9ZQVJTSzEUMBIGA1UEBxMLS1JBU05PWUFS U0sxDjAMBgNVBAoTBU15T1JHMQ4wDAYDVQQLEwVNeU9SRzEOMAwGA1UEAwwFTXlf Q0ExIDAeBgkqhkiG9w0BCQEWEW15ZW1haWxAbXlob3N0Lnh4MB4XDTE5MTIxMzAw MDAwMFoXDTQ5MTIxMjIzNTk1OVowgY8xCzAJBgNVBAYTAlJVMRQwEgYDVQQIEwtL UkFTTk9ZQVJTSzEUMBIGA1UEBxMLS1JBU05PWUFSU0sxDjAMBgNVBAoTBU15T1JH MQ4wDAYDVQQLEwVNeU9SRzESMBAGA1UEAwwJTXlfU2VydmVyMSAwHgYJKoZIhvcN AQkBFhFNeUVtYWlsQE15SG9zdC54eDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC AQoCggEBAJhJYVC8WJneQTTO9p7NJvS803W1lq/8Z78Vx8J5jejVhXXZa0NYfXX8 iiXUr26vdhXN5htSNgktz9Tr5zUHwKhzpq+yYICPS44AmzMJByPBhjHUq7/HjnOA e78k80OTzqL5XH8olrQc7690K1GW3b0PduH+bYykDGijQ8vlkwBKQhgxeo7zkTrm VWsgmFJEbrdGoZPnwyHrStMHM0f6UMkEWqooughphaxtJWzS4GJES09z3VSN/3CV FuV2Jn3UGyoEHKrZUa/kFgRx9j9AqRx3//WFusm2KPUim+IA4SLoXP5M6pZXaxvA Z4y5b2xIc/OFFX5DfaCSpAMFwzZFYXkCAwEAAaMtMCswCQYDVR0TBAIwADAeBglg hkgBhvhCAQ0EERYPeGNhIGNlcnRpZmljYXRlMA0GCSqGSIb3DQEBCwUAA4IBAQAZ EXHnqu9Ilz6+w4SB/wfl5HG3UyS2n8oNpTHbFkX1Sn2+2FFuSCZlxhQYyhZKUjRq NsbWMMcwRDST9V6cPw6iaTPfz2G8zaBFjsemnyYD6YttNmdqXgv5wiik3btP2Jk2 3msmg8MlA/EgeZWSFe0ee4yE+L145JgtEQeg0xb7t8J9OOt3W1GVnoX1hQa2GePH PlKqc5ooPAuzIW4kWzxQefqcV5j1Rof98/dQJwJwCatRYgFciOZe26rcsu0R1iKF yS6NB+HwJxZY1ExPcSDmiVu5cyeasSLp1bxcqb9V7a3e9YxNZ8AVmjh/NfOcb2a/ /Mx8QxPEP7g+B6tWfF/Q -----END CERTIFICATE----- &lt;/cert&gt; &lt;key&gt; -----BEGIN RSA PRIVATE KEY----- MIIEpAIBAAKCAQEAmElhULxYmd5BNM72ns0m9LzTdbWWr/xnvxXHwnmN6NWFddlr Q1h9dfyKJdSvbq92Fc3mG1I2CS3P1OvnNQfAqHOmr7JggI9LjgCbMwkHI8GGMdSr v8eOc4B7vyTzQ5POovlcfyiWtBzvr3QrUZbdvQ924f5tjKQMaKNDy+WTAEpCGDF6 jvOROuZVayCYUkRut0ahk+fDIetK0wczR/pQyQRaqii6CGmFrG0lbNLgYkRLT3Pd VI3/cJUW5XYmfdQbKgQcqtlRr+QWBHH2P0CpHHf/9YW6ybYo9SKb4gDhIuhc/kzq lldrG8BnjLlvbEhz84UVfkN9oJKkAwXDNkVheQIDAQABAoIBAGZFmapr4yDqx2Xc vHmnk0r3aRf7LMjhvRbyXKZ5ldlRVIDx0/x1eER9ppWDgZHXGnnIPooIqyt87b+z 8iGGJFe826vRIsgT9AzY0WHz5SyZMjNS/Ukdjsh4+CJFgW3X3QVMbFclfhhV+o4d eV4g8KegtBlQEmhKX98CDmznr9KYAxBtiMODkG3gi523+8qgOH5Nqgr+0CGxwcJU 4fDHadjbSj7+12ZrY3TVZm451fEzgh2nPAseyAoNYe0CM9hExmq4jeNxjZFQHNBv refghZaPmyuRWSOfzNbEwRsLCZeLUHDdrNvsPRnFvmLcFhtFKwctngvkGK5lPs1w dCgs8pUCgYEAyJOsi+ZTAWTjJC1pCr3FRJEjoqfqZGw/OLCKV7PBF8Yf2DIB+LDD gfgoMi39sK/HkaH1H6CqD1Gter8WE67gAURvo5UjK4vFAGhmQSbiwhRUCRKRljwT zB4k649XpD8fiOzd9S12uKyr8EvvDbOz9x1XcxQELcqURIunTuDH4CsCgYEAwl3F twSkSOPYG2AeLnuwf8sYtFbcvSYL/8cGovOuZ0GlSLpHO2k1qhUzl6HrpIhEyVom IQRJW9S5lB7z5lU/CVcbGmYLwu4y5/tl4MeG8NOEj1o8FR9RzUw92dSSKoMfCMad lz/RmOrBnX4pwqICs7r7h7VsnOsr/AYn5H04zusCgYEAwHHv+8rhmVTTGsL3Jfcu brtTFZ1Gp1O01Q+NrNgrTEQsCaLxgUsYSntvFbZK0lvVf0WFivL8N/aGHF97Lyd6 hbzD4JAXTpCsU9fXRGuq5cvbVVkblqnN1OqXQewmitCF0TpzO+qDHm2OCuDQXLUu 1sqwPRnXaJgV6i6UOHozTEECgYEAgmguFqxrmWgdf8iOl3tvoV5f1eeNtO7JEDS1 1DEQ68CUp+YrksX1NoeBFRSTqNGw7TOp728T1SQ12xalZ/38DEVALwcWjxQIXbND 2HumowAXqaLOOxHHbangub0w0IsnEFlKNMeh1ipz+zpBxI+0pmgnCReFpwb2fOKY c2o86j8CgYAWTWn/Y1/bNgtStzya6fbxpc4Mc2nCZu6bTQpAgA44r+nRJuHpVm0T cGDKj4NZ8H4wqMmk58GoOreAVsX4qXeN9QkdfAR5dA8eWVz42faC328W3G4VA5cc GvTqDMzq0j3bz+4csHMn3BHatHymjgsg0sgc8FshuD6dQk0NNruk9A== -----END RSA PRIVATE KEY----- &lt;/key&gt; &lt;dh&gt; -----BEGIN DH PARAMETERS----- MIIBCAKCAQEAlpVUnvCTJ1XF9mnwhf+P+QZhVWsNyRaqEgLuO2a/fGUqPESU9KRo bDa489awzJs6j/JCKh1xR5H5JLE+Ho6XdgIXH9LTr03BV3PsPQiA28ZiluekBGGY ps7dTLr0Ex4V6Ae3+E+Z7lM/Yhsa4w6fl+GNRkastD42Nx4g4iN+cIerLMFCRPl1 P7Go36VbEtO/aNX/zNExmcDsYSqiLkBeGrNxXen2Loqex5AlwE9WOliUbak6Ra/W vf21Wi03TvBBfjEDKtM/Bsyo8Ar2lgBYIrANvylU/0Gg8OyRWqcIoQjwPyjavAHd v14V1igYDa1xP9WQ262DMHfHLhqwjOW2GwIBAg== -----END DH PARAMETERS----- &lt;/dh&gt;</code> </pre><br><br><h3> 配置OpenVPN客户端配置 </h3><br> 要创建客户端配置文件，请转到包含OpenVPN配置文件的文件夹[C：\ Program Files \ OpenVPN \ config]，然后创建扩展名为.ovpn的TAP_Client文件。 <br> 使用文本文件查看器（例如Notepad ++）打开TAP_Server.ovpn文件，然后复制以下文本： <br><br><pre> <code class="plaintext hljs"># ,      client #    L2  dev tap0 #       IP proto udp4 #   ,     OpenVPN port 50501 #  ,      #    IP  DNS. remote 217.196.58.128 #    cipher AES-256-CBC #    verb 3 #       &lt;ca&gt; &lt;/ca&gt; #      &lt;cert&gt; &lt;/cert&gt; #       &lt;key&gt; &lt;/key&gt;</code> </pre><br> 然后打开文本文件查看器My_CA.crt，My_Client.crt，My_Client.pem并从以下位置复制文本： <br>  &lt;ca&gt; &lt;/ ca&gt;中的My_CA.crt <br>  &lt;cert&gt; &lt;/ cert&gt;中的My_Client.crt <br>  &lt;key&gt; &lt;/ key&gt;中的My_Client.pem <br><br><img src="https://habrastorage.org/webt/lk/pr/yy/lkpryyecjvigt-pko17zttdl9pu.jpeg" alt="图片"><br><br> 结果，我们得到以下信息： <br><br><pre> <code class="plaintext hljs">client dev tap0 proto udp4 port 50501 remote 217.196.58.128 cipher AES-256-CBC verb 3 &lt;ca&gt; -----BEGIN CERTIFICATE----- MIIDqjCCApKgAwIBAgIIJJ8tf67Csf4wDQYJKoZIhvcNAQELBQAwgYsxCzAJBgNV BAYTAlJVMRQwEgYDVQQIEwtLUkFTTk9ZQVJTSzEUMBIGA1UEBxMLS1JBU05PWUFS U0sxDjAMBgNVBAoTBU15T1JHMQ4wDAYDVQQLEwVNeU9SRzEOMAwGA1UEAwwFTXlf Q0ExIDAeBgkqhkiG9w0BCQEWEW15ZW1haWxAbXlob3N0Lnh4MB4XDTE5MTIxMzAw MDAwMFoXDTQ5MTIxMjIzNTk1OVowgYsxCzAJBgNVBAYTAlJVMRQwEgYDVQQIEwtL UkFTTk9ZQVJTSzEUMBIGA1UEBxMLS1JBU05PWUFSU0sxDjAMBgNVBAoTBU15T1JH MQ4wDAYDVQQLEwVNeU9SRzEOMAwGA1UEAwwFTXlfQ0ExIDAeBgkqhkiG9w0BCQEW EW15ZW1haWxAbXlob3N0Lnh4MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC AQEA3dJoAVl7foXZMavZIr9RTB59h+El26OYll7KMBHritf+x8DEVjcg86uyDSf0 yzLtAR+8J013W3SRDVpl3gqdk3t1qb7Paz1OUrV2Hu3N5Ws1s4elpENTQAe1HFZS u0NRhXBCxTTyToNdb1pKcIJziVNLXdTL+pud0T8FNs6q37t14XFkfDOw85m7y3py vU8+ucmQEd5vOKPjcY1jklVZkQJKcGTI77x/R2k6HK7ryul5uIepi/RrVrgTNe5W rYWuk6wlmmFLvgdzoVaBJO8edo89M7oJIQFMNN9x3cpbths6/3ZummBktfgVa7xy 3fs//M5v1pjnYeJ5wd5tiCXkpQIDAQABoxAwDjAMBgNVHRMEBTADAQH/MA0GCSqG SIb3DQEBCwUAA4IBAQDbNhPy3IftjPVNyaUH/5AW6R0Fjqoct/55ZMDrdWlLY1mo iTTxhFPv1DbilUE/nr+SwGvZV2MQs4G1hi9PgGqY5a+lJCSios8BJ7zlrt/LLQQ/ st0r2wzpCYROxoi+zu9YNGZJPP9GI3KdcVye9Rt3vbLbL8LQ8kKKwn3Ju5i1SUMy gzvGTNUPtqOKVJid39IIdva3iMUBspfMGv2EcaGaRWekW9Pni/gBS2eHkBH1/X6n KiopjtZw7A4RPHzC58jp+ypT/X63tPwf5+kWsMDeLG1XTKnLoPeAVNtszMhGsgzE DoZUuL4pb8XbpcnrPlgp0WSkrf1RJrJGuArvUDLu -----END CERTIFICATE----- &lt;/ca&gt; &lt;cert&gt; -----BEGIN CERTIFICATE----- MIIDyzCCArOgAwIBAgIII6a7Y3h+sS0wDQYJKoZIhvcNAQELBQAwgYsxCzAJBgNV BAYTAlJVMRQwEgYDVQQIEwtLUkFTTk9ZQVJTSzEUMBIGA1UEBxMLS1JBU05PWUFS U0sxDjAMBgNVBAoTBU15T1JHMQ4wDAYDVQQLEwVNeU9SRzEOMAwGA1UEAwwFTXlf Q0ExIDAeBgkqhkiG9w0BCQEWEW15ZW1haWxAbXlob3N0Lnh4MB4XDTE5MTIxMzAw MDAwMFoXDTQ5MTIxMjIzNTk1OVowgY8xCzAJBgNVBAYTAlJVMRQwEgYDVQQIEwtL UkFTTk9ZQVJTSzEUMBIGA1UEBxMLS1JBU05PWUFSU0sxDjAMBgNVBAoTBU15T1JH MQ4wDAYDVQQLEwVNeU9SRzESMBAGA1UEAwwJTXlfQ2xpZW50MSAwHgYJKoZIhvcN AQkBFhFNeUVtYWlsQE15SG9zdC54eDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCC AQoCggEBAM1xGkTl0fTge3jacEgSkrMoN3wgIr94Y1uD574XqxKYdH11hEdldTLa gx8MGLIYaXN/HQTEYuhxpk+EX0Mqns9TazGouvE2/poP4KiO8iSHVO9PaaKO0OKq Y7ctt4TVBdnD2UjiHCq5DfQ/T6UGv4bOR61RCqymyBnnVQ/KyR0DX4/U+jLx9wxS d5OLD0SSqOjdLTnI1gBpEphRuPo6705I+eM7cATyoL17GMgAQ1W4zLzq3ojNPCo3 U/P0tPvQi6hHoJv5Rj8EfgK7eID7kUqvCrG4Vvg+iKjC7m1ABweOjBXVpk7UsKin 97I/Gz0PGOwnsh3a3J/WNZu1DuPfw9UCAwEAAaMtMCswCQYDVR0TBAIwADAeBglg hkgBhvhCAQ0EERYPeGNhIGNlcnRpZmljYXRlMA0GCSqGSIb3DQEBCwUAA4IBAQDd v4iq13jCqRI6yeFlB8ouMVtuVpI+p7w6KBYyc+phbDuzqI4iFkMyhj0H+cx/760M ziQMuLR/pRrSPKPI03JgFI5dFh1txnNFkelQutZ+6qe4c1y9OhKhwg3n6jS2PevG Tvlrl1utoiNOVXhcvH0CxuD5AJEyQa9SH/vO3TRQC9g5zbfULTgOhpUmaVPYBkX/ tBnvnKFdmsLqwgrKvdqfJF3WqJuQSdHtyp4MVZN1d/T+HoQ5YfN5nGXpLLgLdGaq KvtAtFACkltO0A7R2WeLw1WNiXGHNxd3OFuVedapub1zXCSiYZNC+8MX7PkQnV9e p1JB/AWXg/Z7uQSua3+c -----END CERTIFICATE----- &lt;/cert&gt; &lt;key&gt; -----BEGIN RSA PRIVATE KEY----- MIIEpAIBAAKCAQEAzXEaROXR9OB7eNpwSBKSsyg3fCAiv3hjW4PnvherEph0fXWE R2V1MtqDHwwYshhpc38dBMRi6HGmT4RfQyqez1NrMai68Tb+mg/gqI7yJIdU709p oo7Q4qpjty23hNUF2cPZSOIcKrkN9D9PpQa/hs5HrVEKrKbIGedVD8rJHQNfj9T6 MvH3DFJ3k4sPRJKo6N0tOcjWAGkSmFG4+jrvTkj54ztwBPKgvXsYyABDVbjMvOre iM08KjdT8/S0+9CLqEegm/lGPwR+Art4gPuRSq8KsbhW+D6IqMLubUAHB46MFdWm TtSwqKf3sj8bPQ8Y7CeyHdrcn9Y1m7UO49/D1QIDAQABAoIBAQC6dsyL+jf9VX5b 6497qvfhikAJ9jTzqjYsCuXcwCiygRNCB9ae4rRkCrZ2CImlo8iaXqYc/I51QSnd BF1eXiG0NZeWg/nhE7Q0avLSqqOWigqKBn7vX0ayZEqLKQBnnN1pkHv3zdoY4MuM g6YrN5vApBukcGkK2XnHIRMweTLek9/qAeDgcE4ZVXIgHkNjqAc9y/kd5Sx+fL+N k/dGQeTne2xgzJZsiu4uoS9jnBE7g1hQpfLpbyoREaRjWob/KP2IDFIjInjnHrb9 mO5Xuqsv8mHp4+67Ium8IN5jDldoObayEd8giE6x3r/3x60RSmV8IDHKPIs507qD 2hoCXz8hAoGBAObhKqowjp5TuqPt9Nrm+cVZKroDvz8bXb8ejOMn22Wj171cdNy3 gxbt5ksLXsHmjPWm9fK5ZL8m33U+uMwcgqIUbHILo40AQK9FtwkjyeTQne1OBjJa 2tjCc3ySo0icEswRFJrCu9Rcszehj56WlJzmvE0CiM2QGG3ExOxl8LNtAoGBAOPL Zv5nkG0RAuOg5w+tLi2H14BcD1ICpPcq232mXdqzEeeXSysvgpwDaOWPGXtgWvIK ScIw9xqW7tonk5EjKnsgPajV8OvG+vAqC2liHy00IxZ+YB+vzE66uUEpYXUpzI2n F+pb+rQDSQo3beyamjeL1wYEjntDyWqfRmQfQSkJAoGAMP1CIk6fVHULu1D4jaJJ CVj8OfAlmmxiHfWLi3+fjBeR5XpCybqetDTSksXc22PiMRW2RkSUXgMPkz810wmR pnaS9DgIAhk1oHs4dVYEtuqVOA9APVsN6MSJ4Lr0rql/S5GsP5JmbI8m7/z2Dn6B FjHXbrfE82lJ5bDE4CxZQJkCgYAvmtJrWDlWkbeI2pdvL0H3QexHZvXMrcDL5qj4 GUyD5+hV/cg3vjYNZKkHUGCC6CAZdQz1CEabx+8iqCKusiqukI5SOmOe4naOujqo S1k4mSy8Bq0P8i1ARsVwWLWFRrb443KcB5zdAdLBz9OpHqYb9Z16JHmiSQhOv/p1 8hIsAQKBgQCvHQu6NKsdNDogXCiwEt52jlqBRs4NEjspupOKzV+HlEfek6ijKMce P9o4U+vpiG5ZmIYPzgTfAlaWxoMi5ynRZhiMA8dFzX53uyJiYJetXm+zb71l9BW8 kmsch0B5z5yAjEA+CWIqDJ05O7QTLMLC69QU4UICswbyJy1MFUfrbg== -----END RSA PRIVATE KEY----- &lt;/key&gt;</code> </pre><br> 这样，客户端和服务器配置文件的创建将被视为完成。 <br><br><h2> 企业路由器设置 </h2><br> 因为 由于我们的个人计算机不是通过外部白色IP直接连接到线路，而是通过企业路由器直接连接到线路，然后才能通过外部网络访问具有本地IP地址的计算机，因此有必要转发我们在服务器配置中指定的端口（50501）。 <br><br> 端口转发过程可能会有所不同，具体取决于您的路由器型号。 <br> 以下屏幕截图显示了设置企业路由器（而不是我们的KEENETIC 4G）的示例。 <br><br><img src="https://habrastorage.org/webt/vj/sz/1j/vjsz1j1gklcppxcucvsndpuwiui.png" alt="图片"><br><br><h2> 在个人计算机上运行OpenVPN服务器 </h2><br> 我们的配置文件已准备就绪，仍需继续在基于Windows的系统上配置OpenVPN的细微差别，为此，我们将继续配置适配器设置并将TAP-Windows Adapter V9重命名为MyTap（与名称dev-node一致）。 <br><br><img src="https://habrastorage.org/webt/e5/gl/yz/e5glyzs2wksvc55oaceguxsisne.jpeg" alt="图片"><br><br> 并配置适配器的本地地址（必须将其分配给控制器本地网络的<u><b>空闲IP地址</b></u> ，例如192.168.112.230） <br><br><img src="https://habrastorage.org/webt/3o/jq/lu/3ojqlus9g_e1elkqinnswm8l1rs.jpeg" alt="图片"><br><br> 接下来，启动OpenVPN服务器： <br><br>  1.启动位于C：\ Program Files \ OpenVPN \ bin \ openvpn-gui.exe的应用程序（或单击桌面上的快捷方式） <br><br><img src="https://habrastorage.org/webt/mh/dr/6q/mhdr6q3rhquwfqrkfzwig-ph42s.jpeg" alt="图片"><br><br>  2.转到托盘，选择创建的配置文件“ TAP_Server”，然后单击“连接” <br><br><img src="https://habrastorage.org/webt/yl/xt/_y/ylxt_yc5yhzg44stx5pkilyftkc.jpeg" alt="图片"><br><br>  3.确保我们的服务器正在运行，然后继续设置KEENETIC 4G Internet Center <br><br><img src="https://habrastorage.org/webt/sc/y1/ta/scy1taywqsvhcn9y3lavnfvll_u.jpeg" alt="图片"><br><br><h2> 设置KEENETIC 4G Internet Center </h2><br> 默认情况下，KEENETIC 4G不包含OpenVPN客户端，因此我们应该首先安装它。 为此，我们以各种方式（通过电缆，Wi-Fi或使用4G调制解调器）将KEENETIC 4G连接到Internet，然后转到“常规设置”并单击“更改组件集”按钮。 <br><br><img src="https://habrastorage.org/webt/sk/g0/qs/skg0qsorsk9yqnb3aqslphvnbm8.jpeg" alt="图片"><br><br> 我们选择所需的组件（在这种情况下，已经安装了OpenVPN Client，因此显示了另一个组件），然后单击“安装更新”按钮。 <br><br><img src="https://habrastorage.org/webt/iy/xq/tl/iyxqtlsyavy1on1ki9geari-5k0.jpeg" alt="图片"><br><br> 接下来，让我们继续设置网络，为此，我们选择“家庭网络”并配置路由器的IP地址，例如192.168.112.101（它也应该是免费的）。 <br><br><img src="https://habrastorage.org/webt/5q/jl/vc/5qjlvc-edpe_n4io3ey_nvd3t-c.jpeg" alt="图片"><br><br> 接下来，我们应该配置我们的OpenVPN连接，为此，我们选择“其他连接”，单击“添加连接”按钮。 <br> 输入连接名称（任意，例如TAP_Client_PLC），选择连接类型（OpenVPN），将我们为客户端创建的文件中的文本复制到OpenVPN配置（TAP_Client.ovpn）中，然后单击保存按钮以应用更改。 <br><br><img src="https://habrastorage.org/webt/nb/lz/vz/nblzvzf-cr3x9_2uf3qsozjpdeq.jpeg" alt="图片"><br><br> 接下来，我们应该在主网桥中包含OpenVPN接口，但是在执行此过程之前，我们将必须安装telnet客户端。 为此，请转到控制面板，然后“打开或关闭Windows组件”，选择Telnet客户端，然后单击“确定”。 <br><br><img src="https://habrastorage.org/webt/va/al/fa/vaalfa3q9qrsd395ea2r2fiapwa.jpeg" alt="图片"><br><br> 安装telnet客户端后-连接到我们的KEENETIC 4G：在键盘上，按组合键WIN + R，输入cmd <br><br><img src="https://habrastorage.org/webt/hp/st/ua/hpstuakyh_1nmtscsbtznc5jt78.png" alt="图片"><br><br> 输入telnet [IP_OUR_KEENETIC]命令（例如telnet 192.168.112.101） <br><br><img src="https://habrastorage.org/webt/gw/bd/yw/gwbdywgl0qlvpi9zw4cjjs9ocpg.jpeg" alt="图片"><br><br> 我们将进行授权过程（输入用户名和密码（如果已配置）），然后输入以下命令： <br><br><pre> <code class="plaintext hljs">interface Bridge0 include OpenVPN0 system configuration save</code> </pre><br> 检查我们配置的正确性： <br><br><pre> <code class="plaintext hljs">show running-config</code> </pre><br> 最后，我们应该看到如下所示： <br><br><img src="https://habrastorage.org/webt/f7/uw/th/f7uwthmd7v0c5bdvjgyp6duoye0.jpeg" alt="图片"><br><br> 我注意到，仅在创建OpenVPN连接之后才创建OpenVPN0接口。 <br><br> 我们包括我们的OpenVPN客户端。 <br><br><img src="https://habrastorage.org/webt/fz/of/qg/fzofqgta_w1xth5a1lldhf9eawm.jpeg" alt="图片"><br><br> 我们看到KEENETIC 4G已连接到我们的服务器，然后继续配置S7-1500控制器。 <br><br><img src="https://habrastorage.org/webt/bt/ye/ex/btyeexdlihyf-06asr7viqhjea0.jpeg" alt="图片"><br><br><h2> 组态S7-1500可编程逻辑控制器 </h2><br> 在控制器的设置中，设置路由器的本地地址就足够了： <br><br><ol><li> 设置“使用路由器”复选框 </li><li> 我们在KEENETIC 4G的家庭网络地址（192.168.112.101）中开车 </li></ol><br><img src="https://habrastorage.org/webt/0h/vb/cd/0hvbcdeyy8ttar8t0qykw4zkugi.jpeg" alt="图片"><br><br> 加载配置后，控制器将可以通过远程连接进行访问。 <br><br><img src="https://habrastorage.org/webt/xd/s_/wv/xds_wvc2mq1_q8ga5mfuusnaklc.jpeg" alt="图片"><br><br> 这样就完成了我们的远程连接的配置。 <br><br> 感谢您的关注！ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN481028/">https://habr.com/ru/post/zh-CN481028/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN481014/index.html">我/我们不是Ayhor托管。 或如何面对行业吐痰</a></li>
<li><a href="../zh-CN481016/index.html">VonmoTrade实验。 第1部分：交流与现代技术</a></li>
<li><a href="../zh-CN481018/index.html">关于保护虚拟基础架构</a></li>
<li><a href="../zh-CN481020/index.html">使用纯JavaScript编写触摸打字模拟器：第2部分</a></li>
<li><a href="../zh-CN481024/index.html">为什么我放弃了Google Maps API</a></li>
<li><a href="../zh-CN481030/index.html">我想为自己做什么样的Cyber​​dec</a></li>
<li><a href="../zh-CN481032/index.html">为什么可能会被黑客入侵？ 可能是因为攻击者</a></li>
<li><a href="../zh-CN481034/index.html">通过NAT提供程序在计算机之间的直接VPN隧道（不使用VUN，使用STUN服务器和Yandex.Disk）</a></li>
<li><a href="../zh-CN481036/index.html">Firefox开发人员工具的30个实用程序</a></li>
<li><a href="../zh-CN481038/index.html">addict悔的设计迷。 一个月内我们如何制作“ IT Alchemy”游戏</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>