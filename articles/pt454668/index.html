<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîª üåÉ üÖ∞Ô∏è Livro de receitas do desenvolvedor: Receitas DDD (parte 5, processos) üßëüèΩ‚Äçü§ù‚ÄçüßëüèΩ üë©‚Äçüè≠ üï∫üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introdu√ß√£o 


 Nos artigos anteriores, descrevemos: escopo , fundamentos metodol√≥gicos , um exemplo de arquitetura e estrutura . Neste artigo, gost...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Livro de receitas do desenvolvedor: Receitas DDD (parte 5, processos)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454668/"><h1 id="vvedenie">  1. Introdu√ß√£o </h1><br><p> Nos artigos anteriores, descrevemos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">escopo</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fundamentos metodol√≥gicos</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">um exemplo de arquitetura</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">estrutura</a> .  Neste artigo, gostaria de descrever como descrever os processos, sobre os princ√≠pios de coleta de requisitos, como os requisitos de neg√≥cios diferem dos funcionais, como passar dos requisitos para o c√≥digo.  Fale sobre os princ√≠pios do uso do Caso de Uso e como eles podem nos ajudar.  Explore exemplos de op√ß√µes de implementa√ß√£o para padr√µes de design do Interactor e da camada de servi√ßo. </p><br><p><img src="https://habrastorage.org/webt/wo/je/ct/woject0sgeuwc_4xnnzugty-5jg.png" alt="likeyourgrandmom"></p><br><p>  Os exemplos fornecidos no artigo s√£o fornecidos com a nossa solu√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">LunaPark</a> , que o ajudar√° nas primeiras etapas das abordagens descritas. </p><br><h1 id="otdelyaem-funkcionalnye-trebovaniya-ot-biznes-trebovaniy">  Separe os requisitos funcionais dos requisitos de neg√≥cios. </h1><br><p>  Repetidas vezes, acontece que muitas id√©ias de neg√≥cios n√£o se transformam realmente no produto final pretendido.  Isso geralmente ocorre devido √† incapacidade de entender a diferen√ßa entre os requisitos de neg√≥cios e os requisitos funcionais, o que leva a uma coleta inadequada de requisitos, documenta√ß√£o desnecess√°ria, atrasos no projeto e grandes falhas no projeto. </p><br><p>  Ou √†s vezes nos deparamos com situa√ß√µes em que, embora a solu√ß√£o final atenda √†s necessidades dos clientes, mas de alguma forma as metas de neg√≥cios n√£o s√£o atingidas. </p><br><p>  Portanto, √© imperativo separar os requisitos de neg√≥cios dos requisitos funcionais at√© voc√™ come√ßar a defini-los.  Vamos dar um exemplo. </p><a name="habracut"></a><br><p>  Suponha que estamos escrevendo um pedido para uma empresa de entrega de pizzas e decidimos criar um sistema de rastreamento de correio.  Os requisitos de neg√≥cios s√£o os seguintes: </p><br><p>  <em>"Introduzir um sistema baseado na Web e um sistema m√≥vel de rastreamento de funcion√°rios que captura mensageiros em suas rotas e melhora a efici√™ncia, monitorando a atividade dos mensageiros, sua aus√™ncia no trabalho e na produtividade do trabalho".</em> </p><br><p>  Aqui, podemos distinguir v√°rios recursos caracter√≠sticos que indicam que esses s√£o requisitos do neg√≥cio: </p><br><ul><li>  os requisitos de neg√≥cios s√£o sempre escritos do ponto de vista do cliente; </li><li>  Esses s√£o requisitos amplos e de alto n√≠vel, mas ainda orientados para partes; </li><li>  eles n√£o s√£o objetivos da empresa, mas ajudam a empresa a atingir objetivos; </li><li>  responda √†s perguntas " <strong>por que</strong> " e "o <strong>que</strong> ".  O que a empresa deseja receber?  E por que ela precisa disso? </li></ul><br><p>  Requisitos funcionais s√£o <em>a√ß√µes</em> que o sistema deve executar para implementar os requisitos de neg√≥cios.  Assim, os requisitos funcionais est√£o relacionados √† solu√ß√£o ou software desenvolvido.  Formulamos os requisitos funcionais para o exemplo acima: </p><br><ul><li>  o sistema deve exibir a longitude e latitude do funcion√°rio via GPS / GLONASS; </li><li>  o sistema deve exibir as posi√ß√µes dos funcion√°rios no mapa; </li><li>  o sistema deve permitir que os gerentes enviem notifica√ß√µes para seus subordinados de campo. </li></ul><br><p>  Destacamos os seguintes recursos: </p><br><ul><li>  os requisitos funcionais s√£o sempre escritos do ponto de vista do sistema; </li><li>  eles s√£o mais espec√≠ficos e detalhados; </li><li>  √© gra√ßas ao cumprimento dos requisitos funcionais que √© desenvolvida uma solu√ß√£o eficaz que atende √†s necessidades do neg√≥cio e aos objetivos do cliente; </li><li>  responda a pergunta " <strong>como</strong> ".  Como o sistema resolve os requisitos de neg√≥cios. </li></ul><br><p>  Algumas palavras devem ser ditas sobre requisitos n√£o funcionais (tamb√©m conhecidos como "requisitos de qualidade"), que imp√µem restri√ß√µes ao design ou implementa√ß√£o (por exemplo, requisitos de desempenho, seguran√ßa, disponibilidade, confiabilidade).  Tais requisitos respondem √† pergunta "o <strong>que</strong> " deve ser o sistema. </p><br><p>  Desenvolvimento √© a tradu√ß√£o de requisitos de neg√≥cios em funcionais.  A programa√ß√£o aplicada √© a implementa√ß√£o de requisitos funcionais e o sistema - n√£o funcional. </p><br><h1 id="varianty-ispolzovaniya-use-cases">  Casos de uso </h1><br><p>  A implementa√ß√£o de requisitos funcionais geralmente √© a mais complexa em sistemas comerciais.  Em uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">arquitetura pura, os</a> requisitos funcionais s√£o implementados atrav√©s da camada de <em>Caso de Uso</em> . </p><br><p>  Mas, para come√ßar, quero recorrer √† fonte.  Ivar Jacobson - o autor da defini√ß√£o de <em>Caso</em> de <em>Uso</em> , um dos autores da UML, e da metodologia RUP, em seu artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Caso de Uso 2.0 - O Hub de Desenvolvimento de Software</a> identifica 6 princ√≠pios para o uso de <em>casos de</em> uso: </p><br><ol><li>  torn√°-los simples atrav√©s da narrativa; </li><li>  tenha um plano estrat√©gico, esteja ciente de todo o cen√°rio; </li><li>  foco no significado; </li><li>  alinhar o sistema em camadas; </li><li>  entregue o sistema passo a passo; </li><li>  atender √†s necessidades da equipe. </li></ol><br><p>  Consideramos brevemente cada um desses princ√≠pios, eles s√£o √∫teis para uma melhor compreens√£o.  Abaixo est√° minha tradu√ß√£o gratuita, com abrevia√ß√µes e inser√ß√µes, eu recomendo fortemente que voc√™ se familiarize com o original. </p><br><h3 id="prostota-cherez-povestvovanie">  Simplicidade atrav√©s da narrativa </h3><br><p>  <em>A narra√ß√£o faz parte da nossa cultura;</em>  <em>Essa √© a maneira mais f√°cil e eficaz de transferir conhecimento e informa√ß√µes de uma pessoa para outra.</em>  <em>Essa √© a melhor maneira de comunicar o que o sistema deve fazer e ajudar a equipe a se concentrar em objetivos comuns.</em> </p><br><p>  <em>Os casos de uso refletem os objetivos do sistema.</em>  <em>Para entender o Caso de Uso, contamos uma hist√≥ria.</em>  <em>A hist√≥ria conta como atingir uma meta e resolver problemas que surgem ao longo do caminho.</em>  <em>Os casos de uso, como um livro de hist√≥rias, fornecem uma maneira de identificar e cobrir todas as hist√≥rias diferentes, por√©m relacionadas, de uma maneira simples e abrangente.</em>  <em>Isso facilita a coleta, distribui√ß√£o e compreens√£o dos requisitos do sistema.</em> </p><br><p>  Este princ√≠pio se correlaciona com a linguagem Ubiques a partir da abordagem DDD. </p><br><h3 id="ponimanie-kartiny-v-celom">  Compreendendo o quadro geral </h3><br><p>  <em>Independentemente de qual sistema voc√™ est√° desenvolvendo, grande, pequeno, software, hardware ou empresa, √© muito importante entender o panorama geral.</em>  <em>Sem entender o sistema como um todo, voc√™ n√£o pode tomar as decis√µes corretas sobre o que incluir no sistema, o que descartar, quanto custar√° e quais benef√≠cios trar√°.</em> </p><br><p>  Ivar Jacobson sugere usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o diagrama de casos de uso</a> , que √© muito conveniente para coletar requisitos.  Se os requisitos forem compilados e claros, o mapa de contexto de Eric Evans √© a melhor op√ß√£o.  Freq√ºentemente, a abordagem Scrum √© interpretada para que as pessoas n√£o dediquem tempo a um plano estrat√©gico, considerando o planejamento, mais de duas semanas depois, de uma rel√≠quia do passado.  A propaganda de Jeff Sutherland caiu sobre o fluxo de √°gua, e as pessoas que conclu√≠ram o treinamento de duas semanas para o Scrum Masters, que tiveram permiss√£o para gerenciar projetos, fizeram o seu trabalho.  Mas o senso comum reconhece a import√¢ncia do planejamento estrat√©gico.  N√£o h√° necessidade de fazer um plano estrat√©gico detalhado, mas deveria ser. </p><br><h3 id="fokus-na-znachenii">  Foco no valor </h3><br><p>  <em>Ao tentar entender como o sistema ser√° usado, √© sempre importante focar no valor que ele fornecer√° a seus usu√°rios e outras partes interessadas.</em>  <em>O valor √© formado apenas quando o sistema √© usado.</em>  <em>Portanto, √© muito melhor focar em como o sistema ser√° aplicado do que em longas listas de recursos ou recursos que ele pode oferecer.</em> </p><br><p>  <em>Os casos de uso fornecem esse foco, ajudando voc√™ a se concentrar em como o sistema ser√° usado por um usu√°rio espec√≠fico para atingir seu objetivo.</em>  <em>Os casos de uso abrangem v√°rias maneiras de usar o sistema: aqueles que atingem seus objetivos com sucesso e aqueles que resolvem quaisquer dificuldades que surjam.</em> </p><br><p>  Al√©m disso, o autor fornece um esquema maravilhoso, que deve ser prestado a maior aten√ß√£o: </p><br><p><img src="https://habrastorage.org/webt/5g/nk/ma/5gnkmae4chv6_azevvzhg2euglc.png"></p><br><p>  O diagrama mostra um caso de uso, ‚ÄúRetirada de dinheiro em um caixa eletr√¥nico‚Äù.  A maneira mais f√°cil de atingir a meta √© descrita em <em>Dire√ß√£o</em> b√°sica (Fluxo b√°sico).  Outros casos s√£o descritos como fluxo alternativo.  Essas instru√ß√µes ajudam na narrativa, estruturam o sistema e na escrita de testes. </p><br><h3 id="posloynoe-postroenie">  Camadas </h3><br><p>  <em>A maioria dos sistemas exige muito trabalho antes de estarem prontos para uso.</em>  <em>Eles t√™m muitos requisitos, a maioria dos quais depende de outros requisitos, devem ser implementados antes que os requisitos sejam atendidos e avaliados.</em> </p><br><p>  <em>√â um grande erro criar esse sistema de cada vez.</em>  <em>O sistema deve ser constru√≠do a partir de pe√ßas, cada uma com um valor claro para os usu√°rios.</em> </p><br><p>  Essas id√©ias ressoam com abordagens √°geis e com id√©ias de <em>dom√≠nio</em> . </p><br><h3 id="poshagovyy-vyvod-produkta-na-rynok">  Lan√ßamento passo a passo do produto </h3><br><p>  <em>A maioria dos sistemas de software evoluiu ao longo de muitas gera√ß√µes.</em>  <em>Eles n√£o s√£o produzidos de cada vez;</em>  <em>eles s√£o criados como uma s√©rie de lan√ßamentos, cada um dos quais √© constru√≠do em um release anterior.</em>  <em>Mesmo os lan√ßamentos em si geralmente n√£o saem de uma vez, mas desenvolvem-se atrav√©s de uma s√©rie de vers√µes intermedi√°rias.</em>  <em>Cada etapa fornece uma vers√£o clara e utiliz√°vel do sistema.</em>  <em>√â assim que todos os sistemas devem ser criados.</em> </p><br><h3 id="udovletvoryat-potrebnosti-komandy">  Atenda √†s necessidades da equipe </h3><br><p>  <em>Infelizmente, n√£o h√° solu√ß√£o universal para problemas de desenvolvimento de software;</em>  <em>equipes diferentes e situa√ß√µes diferentes exigem estilos diferentes e diferentes n√≠veis de detalhe.</em>  <em>Independentemente dos m√©todos e t√©cnicas que voc√™ escolher, verifique se eles s√£o adapt√°veis ‚Äã‚Äão suficiente para atender √†s necessidades atuais da equipe.</em> </p><br><p>  Eric Evans, em seu livro, recomenda que voc√™ n√£o gaste muito tempo descrevendo todos os processos por meio da UML.  Basta usar qualquer esquema visual.  Equipes diferentes, projetos diferentes exigem um n√≠vel diferente de detalhes, pois o pr√≥prio autor da UML fala sobre isso. </p><br><h1 id="realizaciya">  Implementa√ß√£o </h1><br><p>  Na arquitetura pura, Robert Martin define os seguintes <em>casos de uso</em> : </p><br><blockquote>  Esses casos de uso orquestram o fluxo de dados de e para as entidades e direcionam essas entidades a usar suas Regras de Neg√≥cios Cr√≠ticas para atingir os objetivos do caso de uso. </blockquote><p>  Vamos tentar traduzir essas id√©ias em c√≥digo.  Vamos relembrar o esquema a partir do terceiro princ√≠pio de uso dos <em>Casos de</em> Uso e tom√°-lo como base.  Considere um processo de neg√≥cios realmente complexo: ‚ÄúCozinhando uma torta de repolho‚Äù. </p><br><p>  Vamos tentar decompor: </p><br><ul><li>  verifique a disponibilidade do produto; </li><li>  tir√°-los do estoque; </li><li>  amasse a massa; </li><li>  deixe a massa subir; </li><li>  prepare o recheio; </li><li>  fa√ßa uma torta; </li><li>  assar uma torta. </li></ul><br><p>  Implementamos toda essa sequ√™ncia por meio do <em>Interator</em> , e cada etapa ser√° implementada por meio de uma fun√ß√£o ou Objeto Funcional na Camada de Servi√ßo. </p><br><h1 id="posledovatelnost-deystviy-interactor">  Sequ√™ncia de a√ß√µes (Interator) </h1><br><p><img src="https://habrastorage.org/webt/6b/vk/ra/6bvkra2chr3b8d43dmtxebpjaj4.png" alt="passo a passo"></p><br><p>  Eu recomendo iniciar o desenvolvimento de um processo de neg√≥cios complexo com a <em>Sequ√™ncia de A√ß√µes</em> .  Mais precisamente, n√£o √© assim, voc√™ deve determinar o <em>dom√≠nio do dom√≠nio</em> ao qual o processo de neg√≥cios pertence.  Esclare√ßa todos os requisitos de neg√≥cios.  Identifique todas as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>entidades</em></a> envolvidas no processo.  Documente os requisitos e defini√ß√µes de cada <em>Entidade</em> na base de conhecimento. </p><br><p>  Pinte tudo no papel em etapas.  √Äs vezes voc√™ precisa de um diagrama de sequ√™ncia.  Seu autor √© o mesmo que inventou o Caso de Uso - Ivar Jacobson.  O diagrama foi inventado por ele quando estava desenvolvendo um sistema de manuten√ß√£o de rede telef√¥nica para Erickson, baseado no circuito de rel√©s.  Eu realmente gosto deste diagrama, e o termo <em>Sequ√™ncia</em> , na minha opini√£o, √© mais expressivo do que o termo <em>Interator</em> .  Mas, tendo em vista a maior preval√™ncia deste √∫ltimo, usaremos o termo familiar - <em>Interator</em> . </p><br><p>  Uma pequena dica ao descrever um processo de neg√≥cios √© uma boa ajuda para voc√™, a principal regra do gerenciamento de documentos pode se tornar: ‚ÄúComo resultado de qualquer atividade comercial, um documento deve ser elaborado‚Äù.  Por exemplo, estamos desenvolvendo um sistema de descontos.  Com um desconto, de fato, do ponto de vista comercial, conclu√≠mos um acordo entre a empresa e o cliente.  Todas as condi√ß√µes devem ser definidas neste contrato.  Ou seja, no dom√≠nio DiscountSystem, voc√™ ter√° Entites :: Contract.  N√£o vincule o desconto ao cliente, mas crie um Contrato de <em>entidade</em> , que descreve as regras para seu fornecimento. </p><br><p>  Voltemos √† descri√ß√£o do nosso processo de neg√≥cios, depois que ele se tornou transparente para todas as pessoas envolvidas no seu desenvolvimento, e todo o seu conhecimento foi corrigido.  Eu recomendo que voc√™ comece a escrever c√≥digo com a <em>sequ√™ncia de a√ß√µes</em> . </p><br><p>  O Modelo de Design de <em>Sequ√™ncia</em> √© respons√°vel por: </p><br><ul><li>  sequ√™ncia de <em>a√ß√µes</em> ; </li><li>  coordena√ß√£o dos dados transmitidos entre as <em>a√ß√µes</em> ; </li><li>  processar erros cometidos por <em>a√ß√µes</em> durante sua execu√ß√£o; </li><li>  retorno do resultado do conjunto de <em>a√ß√µes</em> comprometidas; </li><li>  <strong>IMPORTANTE</strong> : a responsabilidade mais importante desse padr√£o de design √© a implementa√ß√£o da l√≥gica de neg√≥cios. </li></ul><br><p>  Eu gostaria de me debru√ßar sobre a √∫ltima responsabilidade com mais detalhes se tivermos algum tipo de processo complexo - devemos descrev√™-la de maneira que fique claro o que acontece sem entrar em detalhes t√©cnicos.  <strong>Voc√™ deve descrev√™-lo da maneira mais expressiva poss√≠vel</strong> .  Confie esta classe ao membro mais experiente da sua equipe. </p><br><p>  Vamos voltar ao assunto: vamos tentar descrever o processo de sua prepara√ß√£o atrav√©s do <em>Interactor</em> . </p><br><h2 id="realizaciya-1">  Implementa√ß√£o </h2><br><p>  Dou um exemplo de implementa√ß√£o com nossa solu√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">LunaPark</a> , que apresentamos em um artigo anterior. </p><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequences</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CookingPieWith</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbage</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TEMPERATURE</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Temperature</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(180, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unit</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cel</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::CheckProductsAvailability</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dough</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::BeatDough</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository::Products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::Make</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbageFiller</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository::Products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::MakePie</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dough</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::BakePie</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">temp</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TEMPERATURE</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sleep</span></span></span><span class="hljs-class"> 5.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">min</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">until</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients_list</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beat_ingredients_list</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filler_ingredients_list</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Como podemos ver, a <code>call!</code>  descreve toda a l√≥gica comercial do processo de assar bolos.  E √© conveniente usar para entender a l√≥gica do aplicativo. </p><br><p>  Al√©m disso, podemos descrever facilmente o processo de assar torta de peixe, substituindo o <code>MakeabbageFiller</code> pelo <code>MakeFishFiller</code> .  Assim, mudamos muito rapidamente o processo de neg√≥cios, sem modifica√ß√µes significativas no c√≥digo.  Al√©m disso, podemos deixar as duas <em>sequ√™ncias</em> ao mesmo tempo, dimensionando os casos de neg√≥cios. </p><br><h3 id="dogovorennosti">  Arranjos </h3><br><ul><li>  M√©todo de <code>call!</code>  √© um m√©todo necess√°rio e descreve a ordem das <em>a√ß√µes</em> . </li><li>  Cada par√¢metro de inicializa√ß√£o pode ser descrito atrav√©s de um setter ou <code>attr_acessor</code> : </li></ul><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... private attr_accessor :bar end Foo.call(bar: 42)</span></span></span></span></code> </pre> <br><ul><li>  O restante dos m√©todos deve ser privado. </li></ul><br><h2 id="primer-ispolzovaniya">  Exemplo de uso </h2><br><pre> <code class="ruby hljs">beat_ingredients = [ Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:flour</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:oil</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:salt</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:milk</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:ml</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:egg</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:unit</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:yeast</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span> ] filler_ingredients = [ Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:cabbage</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:gr</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:salt</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span>, Entity::Product.new <span class="hljs-symbol"><span class="hljs-symbol">:pepper</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:spoon</span></span> ] cooking = CookingPieWithabbage.call( <span class="hljs-symbol"><span class="hljs-symbol">beat_ingredients:</span></span> beat_ingredients, <span class="hljs-symbol"><span class="hljs-symbol">filler_ingredients:</span></span> filler_ingredients ) <span class="hljs-comment"><span class="hljs-comment">#   : cooking.success? # =&gt; true cooking.fail # =&gt; false cooking.fail_message # =&gt; '' cooking.data # =&gt; Entity::Pie #   : cooking.success? # =&gt; false cooking.fail # =&gt; true cooking.fail_message # =&gt; 'The pie burned out' cooking.data # =&gt; nil</span></span></code> </pre> <br><p>  O processo √© representado atrav√©s do objeto e temos todos os m√©todos necess√°rios para cham√°-lo - a chamada teve √™xito, ocorreu algum erro durante a chamada e, em caso afirmativo, qual? </p><br><h2 id="obrabotka-oshibok">  Tratamento de erros </h2><br><p>  Se agora recordarmos o terceiro princ√≠pio do aplicativo Caso de Uso, prestamos aten√ß√£o ao fato de que, al√©m da <em>linha Principal</em> , tamb√©m t√≠nhamos dire√ß√µes <em>alternativas</em> .  Estes s√£o os erros que devemos tratar.  Considere um exemplo: certamente n√£o queremos que os eventos continuem assim, mas n√£o podemos fazer nada a respeito, a dura realidade √© que as tortas queimam periodicamente. </p><br><p>  <em>O Interactor</em> intercepta todos os erros herdados da <code>LunaPark::Errors::Processing</code> . </p><br><p>  Como podemos acompanhar o bolo?  Para fazer isso, defina o erro <code>BakePie</code> <em>a√ß√£o</em> <code>BakePie</code> . </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Errors</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Burned</span></span></span><span class="hljs-class"> &lt; LunaPark::Errors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processing</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  E durante o cozimento, verifique se nossa torta n√£o est√° queimada: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kitchen</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BakePie</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... rescue Errors::Burned, 'The pie burned out' if pie.burned? # ... end end end end</span></span></span></span></code> </pre> <br><p>  Nesse caso, a intercepta√ß√£o de erros funcionar√° e poderemos lidar com eles nos <code></code> . <br>  Erros n√£o herdados do <code>Processing</code> s√£o percebidos como erros do sistema e ser√£o interceptados no n√≠vel do servidor.  Salvo indica√ß√£o em contr√°rio, o usu√°rio receber√° um 500 ServerError. </p><br><h2 id="praktika-ispolzovaniya">  Pr√°tica de uso </h2><br><h3 id="1-staraytes-opisyvat-vse-vyzovy-v-metode-call">  1. Tente descrever todas as chamadas no m√©todo de chamada! </h3><br><p>  Voc√™ n√£o deve implementar cada <em>a√ß√£o em um</em> m√©todo separado, isso torna o c√≥digo mais inchado.  Voc√™ precisa olhar a classe inteira v√°rias vezes para entender como ela funciona.  Mime a receita para assar uma torta: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CookingPieWith</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abbage</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">check_products_availability</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_cabbage_filler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bake</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">check_products_availability</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services::CheckProductsAvailability</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ingredients</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end</span></span></span></span></code> </pre> <br><p>  Use a chamada de a√ß√£o diretamente na sala de aula.  Do ponto de vista do ruby, essa abordagem pode parecer incomum, por isso parece mais leg√≠vel: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DrivingStart</span></span></span><span class="hljs-class"> &lt; LunaPark::Interactors::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sequence</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::CheckEngine</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::StartUpTheIgnition</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::ChangeGear</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gear_box</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">drive</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service::StepOnTheGas</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">car</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pedals</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">right</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><h3 id="2-po-vozmozhnosti-ispolzuyte-metod-klassa-call">  2. Se poss√≠vel, use o m√©todo de classe de chamada </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># good - ,   ,  . #    . Sequence::RingingToPerson.call(params) # good -   ,      e, #    ,     , #    . ring = Sequence::RingingToPerson.new(person) unless ring.success? ring.call sleep 5.min end</span></span></code> </pre><br><h3 id="3-ne-sozdavayte-_funkcionalnye-obekty_-radi-tipizacii-koda-smotrite-po-situacii">  3. N√£o crie <em>objetos funcionais</em> para digitar o c√≥digo; procure de acordo com a situa√ß√£o </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad -        ,  #     . module Services class BuildUser &lt; LunaPark::Callable def initialize(first_name:, last_name:, phone:) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@first</span></span></span><span class="hljs-comment">_name = first_name </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@last</span></span></span><span class="hljs-comment">_name = last_name </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@phone</span></span></span><span class="hljs-comment"> = phone end def call Entity::User.new( first_name: first_name, last_name: last_name, phone: phone ) end private attr_reader :first_name, :last_name, :phone end end module Sequences class RegisteringUser &lt; LunaPark::Interactors::Sequence attr_accessor :first_name, :last_name, :phone def call! user = Service::BuildUser.call(first_name: first_name, last_name: last_name, phone: phone) end end end # good -     ,  . #        , #       . module Sequences class RegisteringUser &lt; LunaPark::Interactors::Sequence attr_accessor :first_name, :last_name, :phone def call! user #... end private def user </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@user</span></span></span><span class="hljs-comment"> = Entity::User.new( first_name: first_name, last_name: last_name, phone: phone ) end end end</span></span></code> </pre> <br><h1 id="servisnyy-sloy-service-layer">  Camada de servi√ßo </h1><br><p><img src="https://habrastorage.org/webt/1-/qv/ip/1-qvipbbxxz2i0cveslcf02b7c0.png" alt="lsd"></p><br><p>  <em>O</em> Interator, como dissemos, descreve a l√≥gica de neg√≥cios no n√≠vel mais alto.  <em>A camada de servi√ßo</em> ( <em>camada de</em> servi√ßo) j√° revela os detalhes da implementa√ß√£o dos requisitos funcionais.  Se estamos falando de fazer uma torta, ent√£o, no n√≠vel do Interator, simplesmente dizemos ‚Äúamasse a massa‚Äù, sem entrar em detalhes sobre como amassar.  O processo de amassar √© descrito no <em>n√≠vel de servi√ßo</em> .  Vamos voltar √† fonte original, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">grande livro azul</a> : </p><br><p>  <em>No dom√≠nio aplicado, existem opera√ß√µes que n√£o conseguem encontrar um local natural em um objeto do tipo Entidade ou Objeto de Valor.</em>  <em>Eles s√£o inerentemente n√£o objetos, mas atividades.</em>  <em>Mas como a base do nosso paradigma de modelagem √© a abordagem de objetos, tentaremos transform√°-los em objetos.</em> </p><br><p>  <em>Nesse ponto, √© f√°cil cometer um erro comum: abandone a tentativa de colocar a opera√ß√£o em um objeto adequado para ela e, portanto, fa√ßa a programa√ß√£o procedural.</em>  <em>Mas se voc√™ for√ßar uma opera√ß√£o em um objeto com uma defini√ß√£o estranha a ele, isso far√° com que o pr√≥prio objeto perca sua pureza, dificultando a compreens√£o e a refatora√ß√£o.</em>  <em>Se voc√™ implementar muitas opera√ß√µes complexas em um objeto simples, pode se tornar incompreens√≠vel o que, o que voc√™ est√° fazendo n√£o est√° claro o que.</em>  <em>Tais opera√ß√µes geralmente envolvem outros objetos da √°rea de assunto e a coordena√ß√£o entre eles √© realizada para executar uma tarefa conjunta.</em>  <em>A responsabilidade adicional cria cadeias de depend√™ncia entre objetos, misturando conceitos que podem ser considerados independentemente.</em> </p><br><p>  Ao escolher um local para a implementa√ß√£o de um funcional, use sempre o bom senso.  Sua tarefa √© tornar o modelo mais expressivo.  Vejamos um exemplo: "Precisamos cortar madeira": </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wood</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre> <br><p>  Este m√©todo ser√° um erro.  A lenha n√£o se corta, precisamos de um machado: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Axe</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sacrifice</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre> <br><p>  Se usarmos um modelo de neg√≥cios simplificado, isso ser√° suficiente.  Mas, se o processo precisar ser modelado com mais detalhes, precisaremos de uma pessoa que corte essa lenha e, talvez, algum log que ser√° usado como suporte para o processo. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Human</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chop_firewood</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wood</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">axe</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chock</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end end</span></span></span></span></code> </pre><br><p>  Como voc√™ provavelmente j√° adivinhou, essa n√£o √© uma boa ideia.  Nem todos n√≥s estamos empenhados em cortar madeira, isso n√£o √© um dever direto de uma pessoa.  Frequentemente, vemos como est√£o sobrecarregados os modelos no Ruby on Rails, que cont√™m uma l√≥gica semelhante: obter descontos, adicionar mercadorias √† cesta, retirar dinheiro para a balan√ßa.  Essa l√≥gica n√£o se aplica √† entidade, mas ao processo em que essa entidade est√° envolvida. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChopFirewood</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end</span></span></span></span></code> </pre> <br><p>  Depois de descobrirmos a l√≥gica que armazenamos nos <em>Servi√ßos,</em> tentaremos implementar uma delas.  Na maioria das vezes, os servi√ßos s√£o implementados atrav√©s de m√©todos ou objetos funcionais. </p><br><h2 id="funkcionalnye-obekty">  Objetos Funcionais </h2><br><p>  Um objeto funcional atende a um requisito funcional.  Na sua forma mais primitiva, um objeto funcional possui um √∫nico m√©todo p√∫blico - <code>call</code> . </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serivices</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Tais objetos t√™m v√°rias vantagens: s√£o concisos, s√£o muito simples de testar.  Existe uma desvantagem: esses objetos podem se tornar um n√∫mero grande.  Existem v√°rias maneiras de agrupar objetos semelhantes; em parte de nossos projetos, os dividimos por tipo: </p><br><ul><li>  <em>Objeto de servi√ßo</em> (Servi√ßo) - um objeto, cria um novo objeto; </li><li>  <em>Comando</em> (Comando) - altera o objeto atual; </li><li>  <em>Guardi√£o</em> (Guarda) - retorna um erro se algo der errado. </li></ul><br><h2 id="servisnyy-obekt-service">  Objeto de servi√ßo </h2><br><p>  Em nossa implementa√ß√£o, <em>Servi√ßo</em> - implementa um requisito funcional e sempre retorna um valor. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FindMilk</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GLASS_SIZE</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Unit</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> '200</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">g</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">:) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelfs</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">find</span></span></span><span class="hljs-class"> { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelf</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shelf</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">has?</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GLASS_SIZE</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">milk</span></span></span><span class="hljs-class">) } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FindMilk</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">the_red_one</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; #&lt;Glass: ... &gt;</span></span></span></span></code> </pre> <br><h2 id="komanda-command">  Comando </h2><br><p>  Em nossa implementa√ß√£o, <em>Command</em> - executa uma <em>a√ß√£o</em> , modifica o objeto, se true retornar true.  De fato, a <em>equipe</em> n√£o cria um objeto, mas modifica um existente. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Commands</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FillGlass</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class">:) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">content</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> &lt;&lt; content </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Glass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">empty</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">milk</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Milk</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(200, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">gr</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">glass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">empty?</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; true FillGlass.call glass, with: milk # =&gt; true glass.empty? # =&gt; false</span></span></span></span></code> </pre> <br><h2 id="vahter-guard">  Guardi√£o (Guarda) </h2><br><p>  <em>O vigia</em> realiza uma verifica√ß√£o l√≥gica e, em caso de falha, gera um erro de processamento.  Esse tipo de objeto n√£o afeta a <em>Dire√ß√£o Principal de</em> nenhuma maneira, mas nos muda para a <em>Dire√ß√£o Alternativa</em> se algo der errado. </p><br><p>  Ao servir leite, √© importante garantir que ele seja fresco: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KorovaMilkBar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Guards</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsFresh</span></span></span><span class="hljs-class"> &lt; LunaPark::Callable </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">product</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">products</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">each</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">product</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">raise</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Errors::Rotten</span></span></span><span class="hljs-class">, "</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#{product.title} is not fresh" if product.expiration_date &gt; Date.today end nil end private attr_reader :products end end end</span></span></span></span></code> </pre> <br><p>  Voc√™ pode achar conveniente separar objetos funcionais por tipo.  Voc√™ pode adicionar seu pr√≥prio, por exemplo, <em>Builder</em> - cria um objeto com base em par√¢metros. </p><br><h3 id="dogovorennosti-1">  Arranjos </h3><br><ul><li>  O m√©todo de <code>call</code> √© o √∫nico m√©todo p√∫blico obrigat√≥rio. </li><li>  O m√©todo <code>initialize</code> √© o √∫nico m√©todo p√∫blico opcional. </li><li>  O restante dos m√©todos deve ser privado. </li><li>  Erros l√≥gicos devem ser herdados da <code>LunaPark::Errors::Processing</code> . </li></ul><br><h2 id="obrabotka-oshibok-1">  Tratamento de erros </h2><br><p>  Existem 2 tipos de erros que podem ocorrer durante a opera√ß√£o de uma <em>a√ß√£o</em> . </p><br><h5 id="oshibki-processa-vypolneniya">  Erros de tempo de execu√ß√£o </h5><br><p>  Tais erros podem ocorrer como resultado da viola√ß√£o da l√≥gica de processamento. </p><br><p>  Por exemplo: </p><br><ul><li>  ao criar um email de usu√°rio √© reservado; </li><li>  quando voc√™ tenta beber leite, acaba; </li><li>  outro microsservi√ßo rejeitou a a√ß√£o (por um motivo l√≥gico, e n√£o porque o servi√ßo n√£o est√° dispon√≠vel). </li></ul><br><p>  Com toda a probabilidade, o usu√°rio desejar√° saber sobre esses erros.  Al√©m disso, esses s√£o provavelmente os erros <br>  que podemos prever. </p><br><p>  Tais erros devem ser herdados do <code>LunaPark::Errors::Processing</code> </p><br><h5 id="sistemnyy-oshibki">  Erros de sistema </h5><br><p>  Erros que ocorreram como resultado de uma falha do sistema. </p><br><p>  Por exemplo: </p><br><ul><li>  o banco de dados n√£o funciona; </li><li>  algo dividido por zero. </li></ul><br><p>  Provavelmente, n√£o podemos prever esses erros e n√£o podemos dizer nada ao usu√°rio, exceto que tudo est√° muito ruim, e enviar aos desenvolvedores um relat√≥rio pedindo a√ß√£o.  Esses erros devem ser herdados do <code>SystemError</code> </p><br><p>  H√° tamb√©m <strong>erros de valida√ß√£o</strong> , que discutiremos em mais detalhes no pr√≥ximo artigo. </p><br><h2 id="praktika-ispolzovaniya-1">  Pr√°tica de uso </h2><br><h3 id="1-ispolzuyte-peremennye-chtoby-povysit-chitaemost">  1. Use vari√°veis ‚Äã‚Äãpara aumentar a legibilidade </h3><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fishing</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># bad -   Serivices::Catch.call(fish, rod) # bad -  Serivices::Catch.call(fish: fish, rod: rod) # good -   Serivices::Catch.call(fish, with: rod) module Serivices class Catch def initialize(fish, with:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@fish</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = fish </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@rod</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = with #      #   . end # ... private attr_reader :fish, :rod end end end</span></span></span></span></code> </pre> <br><h3 id="2-peredavayte-obekty-a-ne-parametry">  2. Passe objetos, n√£o par√¢metros </h3><br><p>  Tente simplificar o inicializador se o processamento de par√¢metros n√£o for o seu objetivo. <br>  Passe objetos, n√£o par√¢metros. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># bad -        -.  #      ,   . class Foo def initialize(foo_params:, bar_params:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@foo</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Values::Foo.new(*foo_params) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@bar</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Values::Bar.new(*bar_params) end # ... end Services::Foo.call(foo: {a: 1, b: 2}, bar: 34) # good -   -. class Bar def initialize(foo:, bar:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@foo</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = foo </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@bar</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = bar # ... end end foo = Values::Foo.new(a: 1, b: 2) bar = Values::Bar.new(34) Services::Bar.call(foo: foo, bar: bar) # good -       - Builder. class BuildFoo def initialize(param_1:, param_2:) </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="hljs-class"><span class="hljs-comment">_1 = param_1 </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="hljs-class"><span class="hljs-comment">_1 = param_1 end def call Foo.new( param_1: param_1.foo, param_2: param_2.bar, param_3: some_magick ) end # ... end end</span></span></span></span></code> </pre> <br><h3 id="3-ispolzuyte-v-nazvanie-deystviya---glagol-deystviya-i-obekt-vozdeystviya">  3. Use o nome Actions - o verbo da a√ß√£o e o objeto de influ√™ncia. </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad module Services class Milk; end class Work; end class FooBuild; end class PasswordGenerator; end end # good module Services class GetMilk; end class WorkOnTable; end class BuildFoo; end class GeneratePassword; end end</span></span></code> </pre> <br><h3 id="4-po-vozmozhnosti-ispolzuyte-metod-klassa-call">  4. Se poss√≠vel, use o m√©todo de classe de chamada </h3><br><p>  Geralmente, uma inst√¢ncia da classe <em>Actions</em> , raramente usada, exceto a escrita, para fazer uma chamada. </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># good -    . Services::BuildFoo.call(params) # good -     Services::BuildFoo.(params) # good -   ,      , #    ,     ,   #  . ring = Services::RingToPhone.new(phone: neighbour) 10.times do ring.call end</span></span></code> </pre> <br><h3 id="5-obrabotka-oshibok-ne-yavlyaetsya-zadachey-servisa">  5. O tratamento de erros n√£o √© uma tarefa de servi√ßo </h3><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># bad -    ,   . def call #... rescue SystemError =&gt; e return false end</span></span></code> </pre> <br><h2 id="moduli">  M√≥dulos </h2><br><p>  At√© esse momento, consideramos a implementa√ß√£o da <em>camada Servi√ßo</em> como um conjunto de objetos funcionais.  Mas podemos facilmente colocar m√©todos nessa camada: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sum</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> + </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Outro problema que nos confronta √© um grande n√∫mero de instala√ß√µes de servi√ßo.  Em vez do ‚Äúmodelo gordo rails‚Äù, que chegamos ao limite, obtemos a ‚Äúpasta gorda de servi√ßos‚Äù.  Existem v√°rias maneiras de organizar a estrutura para reduzir a escala da trag√©dia.  Eric Evans resolve isso combinando v√°rias fun√ß√µes em uma classe.  Imagine que precisamos modelar os processos de neg√≥cios da bab√°, Arina Rodionovna, ela pode alimentar Pushkin e coloc√°-lo na cama: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoonService</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arina_radionovna</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pushkin</span></span></span><span class="hljs-class">) </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end def to_feed # ... end def to_sleep # ... end end</span></span></span></span></code> </pre> <br><p>  Essa abordagem √© mais correta do ponto de vista do POO.  Mas sugerimos abandon√°-lo, pelo menos nos est√°gios iniciais.  Programadores pouco experientes come√ßam a escrever muito c√≥digo nesta classe, o que acaba levando a um aumento da conectividade.  Em vez disso, voc√™ pode usar o m√≥dulo, representando a atividade como alguma abstra√ß√£o: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Services</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Noon</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToFeed</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call!</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># ... end end class &lt;&lt; self #    ,   #    def to_feed(arina_radionovna, pushkin) ToFeed.new(arina_radionovna, pushkin).call end #    ,    def to_sleep(arina_radionovna, pushkin) arina_radionovna.tell_story pushkin pushkin.state = :sleep end end end end</span></span></span></span></code> </pre> <br><p>  Ao dividir em m√≥dulos, um baixo acoplamento externo (baixo acoplamento) deve ser observado com alta coes√£o interna (alta coes√£o), mas usamos m√≥dulos como Servi√ßos ou Interatores, o que tamb√©m contraria as id√©ias da arquitetura pura.  Esta √© uma escolha consciente que facilita a percep√ß√£o.  Pelo nome do arquivo, entendemos qual padr√£o de design essa ou aquela classe implementa, se para um programador experiente isso √© √≥bvio, para um iniciante esse nem sempre √© o caso.  Quando sua equipe estiver pronta, descarte esse excesso. </p><br><p>  Para citar outro pequeno trecho do grande livro azul: </p><br><p>  <em>Escolha os m√≥dulos que contam o hist√≥rico do sistema e cont√™m conjuntos coerentes de conceitos.</em>  <em>A partir disso, muitas vezes surge uma baixa depend√™ncia dos m√≥dulos um do outro.</em>  <em>Mas se n√£o for assim, encontre uma maneira de mudar o modelo de maneira a separar os conceitos, ou procure o conceito que estava faltando no modelo, que poderia se tornar a base do m√≥dulo e, assim, reunir os elementos do modelo de maneira natural e significativa.</em>  <em>Atingir baixa depend√™ncia de m√≥dulos um no outro, no sentido de que conceitos em diferentes m√≥dulos podem ser analisados ‚Äã‚Äãe percebidos independentemente um do outro.</em>  <em>Refine o modelo at√© que os limites naturais apare√ßam nele, de acordo com os conceitos de alto n√≠vel da √°rea de assunto, e o c√≥digo correspondente n√£o seja dividido de acordo.</em> </p><br><p>  <em>D√™ os nomes dos m√≥dulos que ser√£o inclu√≠dos no IDIOMA UNIFICADO.</em>  <em>Ambos os m√≥dulos e seus nomes devem refletir o conhecimento e a compreens√£o da √°rea de assunto.</em> </p><br><p>  O t√≥pico dos m√≥dulos √© amplo e interessante, mas na √≠ntegra claramente vai al√©m do t√≥pico deste artigo.  Da pr√≥xima vez, falaremos com voc√™ sobre <em>Reposit√≥rios</em> e <em>Adaptadores</em> .  Abrimos um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">canal de telegrama acolhedor,</a> onde gostar√≠amos de compartilhar materiais sobre o tema DDD.  Suas perguntas e feedback s√£o bem-vindos. </p><br><hr><br><div class="spoiler">  <b class="spoiler_title">Fontes de inspira√ß√£o</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.netsolutions.com/insights/business-and-functional-requirements-what-is-the-difference-and-why-should-you-care/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://magazines.russ.ru/nz/2007/54/gi3.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.microtool.de/en/knowledge-base/how-use-case-2-0-works/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.researchgate.net/publication/220059381_Use_cases_-_Yesterday_today_and_tomorrow</a> </li><li>  Projeto Orientado a Problemas, Eric J. Evans </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt454668/">https://habr.com/ru/post/pt454668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt454652/index.html">Motor a jato em uma impressora 3D dom√©stica</a></li>
<li><a href="../pt454658/index.html">Gadgets de beleza - neg√≥cios s√©rios</a></li>
<li><a href="../pt454662/index.html">Mudan√ßa cuidadosa para a Holanda com sua esposa e hipoteca. Parte 1: Pesquisa de emprego</a></li>
<li><a href="../pt454664/index.html">Jogue Tetris em AR</a></li>
<li><a href="../pt454666/index.html">R√°dio definido por software - como funciona? Parte 7</a></li>
<li><a href="../pt454670/index.html">A s√©rie "Chernobyl": assista e pense</a></li>
<li><a href="../pt454672/index.html">Chave para o in√≠cio: o melhor software e hardware para computa√ß√£o forense</a></li>
<li><a href="../pt454674/index.html">Monitoramento de pobre homem ou monitoramento de servidor a partir do console</a></li>
<li><a href="../pt454676/index.html">Rel√≥gio GPS no Arduino</a></li>
<li><a href="../pt454678/index.html">Programa√ß√£o de GPU Idiomatic em Rust: Emu Library</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>