<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ› ğŸ¥• â™¥ï¸ Jarak Levenshtein dan cari pengontrol â˜®ï¸ ğŸ‘¨ğŸ½â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ˜˜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mungkin, di setiap kota di Belarus di mana terdapat troli, ada grup VK atau obrolan di Telegram di mana orang melacak lokasi pengontrol. Hal ini terut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jarak Levenshtein dan cari pengontrol</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478490/">  Mungkin, di setiap kota di Belarus di mana terdapat troli, ada grup VK atau obrolan di Telegram di mana orang melacak lokasi pengontrol.  Hal ini terutama dilakukan agar tidak membayar untuk perjalanan dan perjalanan gratis, meskipun deskripsi grup hampir selalu berisi catatan tambahan â€œBayar untuk perjalananâ€. <br><a name="habracut"></a><br>  Dalam VC, biasanya terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/ti/eh/cd/tiehcdyeskmccfofp3adt2ko_qe.png" alt="gambar"><br><br>  Komentar khas terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/ki/kp/s0/kikps0wwqqptfwyro8hrf81rtzg.png" alt="gambar"><br><br>  Strukturnya sangat sederhana.  Dalam komentar ada nama-nama perhentian di mana pengendali saat ini diperhatikan, ada juga arah mereka berdiri: <br><br><img src="https://habrastorage.org/webt/no/gy/2l/nogy2l1lrraa8gte90lcyuwsume.png" alt="gambar"><br><br>  Komentar, sebagai hasilnya, adalah objek dengan stop, waktu dan tanggal, serta id unik yang dengannya kami dapat mengidentifikasinya.  Dengan ini, Anda dapat menghitung lokasi di mana pengendali berada. <br><br><h4>  Persiapan </h4><br>  Pertama, Anda perlu menentukan target publik, dari mana kami akan menguraikan data.  Grup harus memiliki cukup banyak aktivitas dalam komentar, jika tidak, kita berisiko mendapatkan data terlalu sedikit <br><br>  Dalam kasus saya, ini adalah grup "Control Gomel". <br><br>  Kami akan mengurai komentar menggunakan API VKontakte resmi untuk Python <br><br>  Kami mengautentikasi dengan kunci akses pengguna, karena beberapa grup mungkin ditutup, dan akses ke komentar mereka hanya dapat diperoleh jika Anda diterima ke dalam grup. <br>  Setelah itu, Anda dapat mulai mengekstraksi komentar: <br><br><h4>  Terima komentar </h4><br>  Untuk memulainya, kita mendapatkan posting terakhir yang tersedia di grup untuk menarik komentar melalui vk.wall.getComments, dan menginisialisasi DataFrame, di mana kita akan menyimpan data. <br><br>  Setiap pos komentar memiliki tulisan "Semoga harimu menyenangkan, bayar ongkosnya, dan jangan terkendali", jadi unduh komentarnya, periksa konten kiriman dan dapatkan serangkaian komentar yang dapat digunakan untuk mengambil data. <br><br>  Saya mengambil komentar dari posting selama 3 bulan terakhir, mengingat bahwa 1 posting diposting setiap hari (sekarang akhir November, tahun sekolah dimulai pada bulan September, dan pengawas kemungkinan besar mempertimbangkan ini dan mengubah tempat biasa mereka).  Pada prinsipnya, tanda-tanda lain dapat diperhitungkan, seperti, misalnya, waktu tahun. <br><br>  Beberapa komentar tersumbat dengan pesan seperti "Apakah ada orang di Barykin?"  Jika Anda melihat komentar seperti itu (tidak perlu), Anda dapat menyorot beberapa tanda: <br><br><ul><li>  Teks berisi kata-kata "bersih", "kiri", "tidak ada" dan sejenisnya </li><li>  Kata-kata "katakan padaku", "siapa", "apa", "bagaimana" </li><li>  Simbol, seperti emotikon, misalnya </li></ul><br>  Setelah itu, kita pergi melalui serangkaian komentar dan mengeluarkan id unik, teks, waktu, tanggal dan hari dalam seminggu dari mereka, yang kita masukkan ke dalam DataFrame yang sudah dibuat. <br><br><div class="spoiler">  <b class="spoiler_title">Terima komentar</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> check_correctness <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(lp.login, lp.password) vk_session.auth() vk = vk_session.get_api() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vk <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataFromComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vk, groupID)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     posts = vk.wall.get(owner_id=groupID, offset=1, count=90) print("\n") data = pd.DataFrame(columns=['text', 'post_id', "date", "day_in_week", "hour","minute", "day_in_month"]) for post in posts.get("items"): # id     postID = post.get("id") if "  ,       " not in post.get("text"): continue #  commentary       comments = vk.wall.getComments(owner_id=groupID, post_id=postID, count=200) #           dataframe for comment in comments.get("items"): text = comment.get("text") text = re.sub(r"A-Za-z--0123456789 ", "", str(text)) commentaryIsNice = check_correctness.detection(text) if commentaryIsNice: print(text) date = comment.get("date") time_struct = time.gmtime(date) post_id = comment.get("post_id") data = data.append({"text": text, "post_id" : post_id, "date": date,"day_in_week" : time_struct.tm_wday, "hour": (time_struct.tm_hour+3), "minute": time_struct.tm_min, "day_in_month": time_struct.tm_mday}, ignore_index=True) # print(data[:10]) # print(data.info()) print("dataset is ready") return data</span></span></code> </pre> <br></div></div><br>  Jadi, kami menerima DataFrame dengan teks komentar, id mereka, hari dalam seminggu, jam dan menit di mana komentar itu ditulis.  Kita hanya perlu hari dalam seminggu, jam menulis dan teks.  Itu terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/cd/hs/cy/cdhscyg3rx4f5kejgvjdguuscui.png" alt="gambar"><br><br><h4>  Pembersihan data </h4><br>  Sekarang kita perlu menghapus data.  Penting untuk menghapus arah dari komentar untuk membuat lebih sedikit kesalahan saat mencari jarak Levenshtein.  Kami menemukan ekspresi "ke samping", "pergi", "bagaimana", "dekat", karena biasanya diikuti dengan nama perhentian kedua, dan kami menghapusnya bersama dengan apa yang datang setelahnya, serta mengganti beberapa nama jargon perhentian dengan yang biasa . <br><br><div class="spoiler">  <b class="spoiler_title">Hapus data</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> fuzzywuzzy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> process <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear_commentary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    -     """</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span> splitted = text.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, s <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(splitted): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(splitted) == <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> np.NaN <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s)) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>): index = i <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> index &lt; len(splitted) - <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): splitted.remove(splitted[index]) string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = (string.lower()) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: splitted = splitted[:index] string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = string.lower() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted).lower() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clean_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: clear_commentary(s)) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) print(<span class="hljs-string"><span class="hljs-string">"cleaned"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4>  Konversi menggunakan jarak Levenshtein </h4><br>  Kami langsung melanjutkan ke jarak Levenshane.  Sedikit bantuan: Levenshtein distance - jumlah operasi minimum untuk memasukkan satu karakter, menghapus satu karakter dan mengganti satu karakter dengan yang lain, diperlukan untuk mengubah satu baris menjadi yang lain. <br><br>  Kami akan menemukannya menggunakan perpustakaan <a href="https://github.com/seatgeek/fuzzywuzzy">fuzzywuzzy</a> .  Ini membantu Anda dengan cepat dan mudah menghitung jarak Levenshtein.  Untuk mempercepat pekerjaan, penulis perpustakaan juga merekomendasikan menginstal perpustakaan python-Levenshtein. <br><br>  Untuk mendapatkan pemberhentian dari komentar, kami membutuhkan daftar pemberhentian.  Itu diberikan kepada saya oleh pengembang aplikasi GoTrans, Alexander Kozlov. <br><br>  Daftar itu harus diperluas, menambahkan ada beberapa perhentian yang tidak ada di sana, dan mengubah sebagian nama sehingga mereka lebih baik berada. <br><br><div class="spoiler">  <b class="spoiler_title">Berhenti</b> <div class="spoiler_text">  stops = ['supermarket', 'meadow', 'remybtekhnika', 'Leningrad', 'Yaroslavl', 'Polesskaya', <br>  'Yaroslavl', 'timofeenko', '8 Maret, <br>  'Rumah dagang Rechitsky', 'Jalan Rechitsky', 'sirkus', 'department store', 'Chongarskaya', <br>  'chongarka', 'ggu', 'skorina', 'universitas', 'appliance', '1000 hal-hal kecil', 'maya', 'station', <br>  'taman lulusan', 'perdagangan dan ekonomi', 'ulang tahun', 'mikrodistrik 18', 'bandara', 'akan datang', <br>  'gomelgeodezcentr', 'kristal', 'danau lyubenskoye', 'pasar davydovsky', 'davydovka', <br>  'sungai sozh', 'gomeldrev', <br>  'Sevruki', 'gmu No. 1', 'dll. Rechitsky', 'kostum', 'rumah sakit penyakit menular', 'kamp camar', <br>  Volotova, Coral, Gomeltorgmash, Gomelproekt, Vneshgomelstroy, Surat Kabar, <br>  'Kalenikova', 'Eremino', 'penyulingan', 'otomatisasi industri khusus', '2nd School', 'Barykina', <br>  'unit mesin', 'pemuda', 'badan casting', 'ahli kimia', 'golovatsky', 'budenny', <br>  'spu67', '35', 'gagarin', '50 tahun ke pabrik Gomselmash ',' hill ',' pabrik radio ', <br>  'nenek', 'pabrik kaca', 'berangan', 'mesin mulai', 'astronot', <br>  'awal rtsrm', 'bykhovskaya', 'lembaga kementerian situasi darurat', 'dk gomselmash', 'toko', 'rechitsky', <br>  'Sevruks', 'Osovtsy', 'turis', 'pabrik daging', 'Trinitas Suci', 'kota medis', 'Oktober', <br>  'depot minyak', 'gomelloblavtotrans', 'milkavita', 'bakunin', 'zip', 'oma', 'resin', <br>  'pasar konstruksi ksk', 'pembangun jalan', 'lapangan', 'kamenetskaya', 'bolshevik', 'jakubovka', <br>  'Borodina', 'hippo hypermarket', 'pahlawan bawah tanah', '9 Mei,' kastanye ',' prosthetist ', <br>  'stasiun iput', 'komunis internasional', 'perguruan pedagogis musik', 'perusahaan pertanian', 'jalan pintas', 'kemenangan', <br>  'barat', 'mutiara', 'Vladimir', 'kering', 'apotik', 'Ivanova', <br>  'pembuatan mesin', 'birch', '60 tahun ',' insinyur listrik ',' centrolite ', <br>  'klinik onkologis', 'jarak tembak', 'golovintsy', 'karang', 'selatan', 'musim semi', <br>  Efremova, Perbatasan, Belgut, Gomelstroy, Borisenko, Istana Atletik, <br>  'Michurinsky', 'solar', 'gastello', 'militer', 'auto centre', 'plumbing', 'uza', <br>  'perguruan tinggi kedokteran', 'taman kanak-kanak 11', 'Bolshevik', 'anak anjing', 'Davydovsky', 'lautan', 'kemajuan', <br>  'Dobrushskaya', 'putih', 'GSK', 'davydovka', 'peralatan listrik', 'persahabatan', <br>  '70 tahun ',' perbaikan mobil ',' bukit swedia ',' sirkuit ',' saluran air ',' mesin gomel ', <br>  Volotova, Pelopor, RCM, Khimtorg, 2nd Meadow Lane, Bochkina, Baths, <br>  'klinik onkologis', 'kotak', 'Lenin', 'sekolah pertama', 'toko selatan', <br>  'gomelagrotrans', 'penggiling', 'lyubensky', 'kantor pendaftaran militer', 'rumah sakit', 'uza', 'rtsrm', <br>  'lysyukovyh', 'shop iput', 'raton', 'pompa bensin', 'randovsky', 'rumah pertanian', 'chestnut', 'ropovsky', <br>  'Romanovichi', 'Ilyich', 'dayung', 'perusahaan konstruksi', 'menular', <br>  'pabrik gemuk', 'layanan mobil', 'layanan pertanian', 'lengket', 'Nikolskaya', <br>  'pemanen self-propelled', 'tukang batu', 'bahan bangunan', 'mesin perbaikan', 'administrasi', <br>  'Oktober', 'dongeng hutan', 'Tatiana', 'Boris Tsarikov', 'Zharkovsky', 'Zaitseva', <br>  'relokasi', 'Karpovich', 'pabrik pembangunan rumah', 'transportasi listrik kota', 'zlin', <br>  'stadium gomselmash', 'ap 6', 'penggerak hidrolik', 'depo lokomotif', 'pasar mobil osovtsy', <br>  'kehidupan baru', 'Zhukova', 'unit militer', 'sekolah ke-3', 'hutan', 'mercusuar merah', <br>  'regional', 'Davydovskaya', 'Karbysheva', 'satelit dunia', 'pemuda', 'lokomotif stadion', <br>  'solar', 'Ladaservice', 'Î¼R 21', 'Aresa', 'internasionalis', 'Kosareva', <br>  'Bogdanova', 'Gomel iron-concrete', 'Î¼r 20a', 'Î¼r Rechitsky', 'peralatan medis', 'Juraeva', <br>  'perguruan tinggi kerajinan seni', 'es', 'festival dk', 'pusat perbelanjaan', <br>  'Kuibyshevsky', 'festival', 'garasi koop 27', 'teknik seismik', 'milcha', 'rumah sakit tabung', <br>  'ptu179', 'produk kimia', 'pemadam kebakaran', 'rumah sakit', 'depot bus', <br>  'kompleks surat kabar', 'kemenangan', 'klenkovsky', 'berlian', 'perbaikan mesin', 'mkr 19'] <br></div></div><br>  Menggunakan .map dan fuzzywuzzy.process.extractOne, kami menemukan pemberhentian dengan jarak Levenshtein minimum dalam daftar, setelah itu kami mengganti teks komentar dengan nama pemberhentian, yang memungkinkan kami mendapatkan dataset dengan nama pemberhentian. <br><br>  Dataset yang dihasilkan terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/gd/pd/c8/gdpdc8lwdppzpastghnasxbqsbi.png"><br><br><div class="spoiler">  <b class="spoiler_title">Komentar berubah menjadi berhenti</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_from_comment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""              """</span></span> dict = process.extractOne(text.lower(), stops) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dict[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">75</span></span>: text = dict[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = np.nan print(<span class="hljs-string"><span class="hljs-string">"wait"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_dataset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      """</span></span> print(<span class="hljs-string"><span class="hljs-string">"remap started. wait"</span></span>) data.text = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> comment: get_category_from_comment(str(comment))) print(<span class="hljs-string"><span class="hljs-string">"remap ends"</span></span>) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4>  Output data </h4><br>  Sekarang kita dapat mengasumsikan di mana pengendali kemungkinan besar berada pada jam yang diberikan. <br><br>  Kami mencari dalam catatan data yang dihasilkan untuk jam dan hari tertentu dalam seminggu.  Misalnya, pada hari Selasa, jam 9 pagi: <br><br><pre> <code class="python hljs">&lt;code&gt;data[(data[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == day) &amp; (data[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == hour)]&lt;/code&gt;</code> </pre> <br><img src="https://habrastorage.org/webt/t4/gg/dg/t4ggdgmwezje8lgllisorbqrqwa.png"><br>  <i>(ini tidak semua data)</i> <br><br>  Setelah itu, kami menemukan jumlah pemberhentian unik, dan hanya menampilkan pemberhentian, dan jumlah mereka: <br><br><pre> <code class="python hljs">df[(df[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp; (df[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == <span class="hljs-number"><span class="hljs-number">9</span></span>)][<span class="hljs-string"><span class="hljs-string">"text"</span></span>].value_counts()</code> </pre> <br><img src="https://habrastorage.org/webt/yq/az/if/yqazifl3gkclyqw4ifykvemsrky.png"><br><br>  Sekarang kita dapat mengatakan bahwa pada jam 9 pagi, pada hari Selasa, pengendali kemungkinan besar akan terlihat di halte Myasokombinat, ul.  Lugovaya, BelGUT, TD "Oma". <br><br>  Kelemahan utama dalam metode ini adalah kurangnya data.  Tidak untuk semua hari dan jam ada entri dalam komentar yang diberikan selama jam sibuk, ketika orang menggunakan transportasi umum lebih dari data dalam jam kurang populer, tetapi jika Anda menambahkan data, misalnya, tidak hanya dari komentar satu kelompok, tetapi juga dari grup alternatif, atau obrolan telegram, dengan jumlah entri, semuanya akan menjadi lebih mudah. <br><br><h4>  Bot dengan VK LongPoll API </h4><br>  Untuk memungkinkan saya menerima data di lokasi pengendali, tergantung pada waktu, dan tanpa terikat ke komputer, saya membuat bot untuk grup di VKontakte yang merespons pesan apa pun dengan mengirimkan jumlah pemberhentian dalam catatan, dengan mempertimbangkan jam dan hari dalam seminggu. <br><br><div class="spoiler">  <b class="spoiler_title">Kode bot</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> randint <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> get_stops_from_data <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_stops_by_time <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_bot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data, token)</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(token=token) vk = vk_session.get_api() print(<span class="hljs-string"><span class="hljs-string">"bot started"</span></span>) longPoll = vk.groups.getLongPollServer(group_id=<span class="hljs-number"><span class="hljs-number">183524419</span></span>) server, key, ts = longPoll[<span class="hljs-string"><span class="hljs-string">'server'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'key'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'ts'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-comment"><span class="hljs-comment">#  :   ts longPoll = post('%s' % server, data={'act': 'a_check', 'key': key, 'ts': ts, 'wait': 25}).json() if longPoll['updates'] and len(longPoll['updates']) != 0: for update in longPoll['updates']: if update['type'] == 'message_new': #        vk.messages.markAsRead(peer_id=update['object']['user_id']) user = update['object']["user_id"] text = get_stops_by_time(data) if text is None or text == {}: message = "Ã­Ã¥Ã² Ã§Ã Ã¯Ã¨Ã±Ã¥Ã©" vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) print(message) ts = longPoll['ts'] continue message = "   -     \n" \ "\n \n" for i in text.items(): message += i[0] + " " message += str(i[1]) message += "\n" #    vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) ts = longPoll['ts']</span></span></code> </pre> <br></div></div><br><h4>  Kesimpulan </h4><br>  Kualitas hipotesis semacam itu telah diuji oleh saya lebih dari satu kali dalam praktik, dan semuanya bekerja dengan baik.  Ternyata pengendali, pada dasarnya, berada di halte yang sama, meskipun perkiraan yang benar-benar benar tidak dapat diberikan, dan probabilitas keberhasilannya tidak 100%.  Jarak Levenshtein memiliki lusinan aplikasi yang berbeda, dari mengoreksi kesalahan dalam satu kata, hingga membandingkan gen, kromosom dan protein, tetapi juga memiliki potensi dalam masalah yang diterapkan tersebut. <br><br>  Semoga harimu menyenangkan, dan bayar ongkosnya. <br><br>  Semua kode bot dan manipulasi data diterbitkan di <a href="https://github.com/dingdongyouarewrong/vk_controllers_bot">sini</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id478490/">https://habr.com/ru/post/id478490/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id478474/index.html">Brother Pablo Escobar juga merilis smartphone yang fleksibel</a></li>
<li><a href="../id478480/index.html">Kecerdasan buatan, ITSM dan, secara umum, di mana LEAN?</a></li>
<li><a href="../id478482/index.html">Pengembang membuka bilah untuk pengembang dan menyelenggarakan pertemuan di sana tentang Angular, tata letak, PHP</a></li>
<li><a href="../id478484/index.html">SCADA di Raspberry: mitos atau kenyataan?</a></li>
<li><a href="../id478486/index.html">Era chip 10-nm - yang mengembangkan prosesor seperti itu dan apa yang menanti industri di masa depan</a></li>
<li><a href="../id478492/index.html">Escherichia coli melakukan diet CO2: alat baru dalam perang melawan pemanasan global?</a></li>
<li><a href="../id478494/index.html">Solusi Heat Treatment Winnum TRP: Pengaturan dan Penggunaan</a></li>
<li><a href="../id478496/index.html">50 tahun yang lalu di kamar nomor 3420 Internet lahir</a></li>
<li><a href="../id478498/index.html">1. Fortinet Getting Started v 6.0. Pendahuluan</a></li>
<li><a href="../id478500/index.html">Mengapa ada begitu sedikit konferensi di musim panas?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>