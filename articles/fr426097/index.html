<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧕🏿 🛀🏽 🌹 Arduino Projet "RoboCar4W Robot Machine" ♊️ 😭 🛁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vous comprenez, "expliqua le rédacteur en chef," que cela devrait être divertissant, frais, plein d'aventures intéressantes ... pour que le lecteur ne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arduino Projet "RoboCar4W Robot Machine"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426097/"><p>  <em>Vous comprenez, "expliqua le rédacteur en chef," que cela devrait être divertissant, frais, plein d'aventures intéressantes ... pour que le lecteur ne puisse pas se détacher.</em> <br>  I. Ilf, E. Petrov <em>"Comment a été créé Robinson"</em> . </p><br><p>  Débuter avec Arduino, comme avec n'importe quelle autre plate-forme logicielle ou matérielle, est toujours plus intéressant à partir d'un vrai projet.  Dans le même temps, les programmeurs écrivent du code qui affiche "Bonjour, monde", les Arduinistes clignotent une LED.  Et tout le monde est heureux comme des enfants. </p><br><p>  J'ai décidé de commencer par un projet avancé, notamment avec l'espoir secret d'arracher la jeune génération à Counter-Strike (échoué). </p><br><p>  Comme vous pouvez le deviner d'après le nom RoboCar4W, le premier projet était une voiture robot à quatre roues.  En commençant le travail, j'avais déjà une expérience en programmation, j'ai déjà su souder pendant longtemps, mais je ne connaissais même pas du tout les brochages Arduino et je n'ai pas lu du tout la documentation.  J'ai étudié toute la sagesse au cours du jeu et Google m'a aidé. </p><a name="habracut"></a><br><p>  Le projet lui-même n'étant fondamentalement pas nouveau, de telles descriptions dans le réseau suffisent, tous les composants sont connus, aucune surprise n'était attendue.  Par conséquent, l'idée a été formulée dans les termes les plus généraux et l'objectif principal était de vous immerger dans le "monde des choses" en utilisant Arduino, comme plate-forme de prototypage rapide.  Dans cet opus, peut-être que quelqu'un se reconnaît au tout début du voyage. </p><br><p>  Tout le matériel a été acheté sur ebay, et d'après ma propre expérience, je veux dire qu'il est plus facile d'acheter un kit de démarrage tout de suite (recherchez-le dans les termes du kit de démarrage Arduino), plutôt que de l'assembler en détail.  Oui, et tous se rejoignent en même temps.  Il a été décidé de ne pas jouer, d'acheter un châssis normal, des roues normales, des moteurs normaux, pour que ce soit "cher". </p><br><p>  Le secret principal des achats réussis sur eBay est d'acheter auprès des meilleurs vendeurs et de lire attentivement la description du produit.  Il existe de nombreux articles à ce sujet sur Internet. </p><br><p>  Quelle carte Arduino choisir? </p><br><p>  J'ai pris Arduino UNO, beaucoup de projets avec des descriptions pour ça.  Mais maintenant, je prendrais l'Arduino Mega 2560, il a plus de sorties numériques et analogiques et une compatibilité totale sur les projets avec UNO. </p><br><h1 id="obschee-opisanie-proekta">  Description générale du projet </h1><br><p>  Dans le monde du développement logiciel, cela est également appelé «configuration système». </p><br><p>  L'idée du projet était la suivante.  La première version de la machine robot appelée RoboCar4W devrait effectuer des actions simples: </p><br><ul><li>  avancer, reculer, effectuer des virages </li><li>  mesurer la distance aux obstacles </li><li>  être capable de contourner automatiquement les obstacles devant. </li></ul><br><p>  La deuxième version de la machine doit être contrôlée manuellement via Bluetooth depuis un téléphone Android. </p><br><p>  Pour que vous ayez mieux travaillé ici, c'est le projet RoboCar4W final assemblé (ici sans Bluetooth). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/457/929/cc8/457929cc8554ef727654f53704ece195.jpg" alt="Arduino RoboCar4W"></p><br><p>  Voici une vidéo des essais en mer. </p><br><p>  Dans la première vidéo, RoboCar4W roule automatiquement en évitant les obstacles sur deux versions différentes du «firmware», c'est-à-dire  esquissez donc si quelqu'un est le plus vif et a remarqué que le comportement du robot dans différents épisodes est légèrement différent. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/a05/27c/f11/a0527cf11325d83a2b91826412b151b9.jpg" alt="Robot voiture RoboCar4W"></a> </p><br><p>  Dans la deuxième vidéo, RoboCar4W se déplace à l'aide de commandes transmises par le «conducteur» via Bluetooth à partir d'un téléphone mobile sous Android.  «Bluetooth RC Car» est installé sur le téléphone.  De plus, s'il y a un obstacle à l'avant, le robot s'arrête, c'est-à-dire  éperonner quelque chose ne fonctionnera pas (cependant, il y a un bouton "secret" qui désactive le mode sans échec). </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/173/997/d9c/173997d9c4f497310ab582b11007d468.jpg" alt="Robot voiture RoboCar4W"></a> </p><br><p>  Dans la troisième vidéo, RoboCar4W montre un programme de mouvement de démonstration préprogrammé avec tours.  Le programme de démonstration est activé sur commande à partir du même téléphone mobile Android.  Le robot roule juste un moment et fait des virages. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/820/a73/9f5/820a739f5e40ca959f0c441e53552e4d.jpg" alt="Robot voiture RoboCar4W"></a> </p><br><h1 id="algoritm-upravleniya-dvizheniem">  Algorithme de contrôle de mouvement </h1><br><p>  C’est une erreur d’appeler notre méthode «algorithme d’évitement d’obstacles» ou «détection de chemin».  Ce sont des disciplines mathématiques distinctes, des mathématiques pures.  Si vous aimez vraiment, vraiment les mathématiques, alors google ces phrases, vous aurez la lecture pendant six mois. </p><br><p>  En attendant, nous nous intéressons beaucoup plus facilement aux choses.  Par conséquent, nous l'appellerons simplement - l'algorithme de contrôle de mouvement d'un robot à 4 roues.  Bien sûr, nous parlons de contrôle automatique sans intervention humaine. </p><br><p>  Voici cet algorithme simple écrit en mots, pour des algorithmes plus complexes il faut (que vous le vouliez ou non) composer des diagrammes. </p><br><p>  Maintenant, regardez en même temps le code source de l'esquisse <a href="">RoboCar4W-1.ino</a> . </p><br><ol><li>  Nous mesurons la distance à l'obstacle en face. </li><li> Si cette distance mesurée est inférieure à la valeur <code>DST_TRH_BACK</code> (abréviation de seuil de distance), alors on s'arrête et on <code>DST_TRH_BACK</code> en tournant.  Le sens de rotation est choisi comme suit: si vous avez précédemment tourné à gauche, tournez à droite et vice versa. </li><li>  Si la distance mesurée est supérieure à <code>DST_TRH_BACK</code> , mais inférieure à <code>DST_TRH_TURN</code> , <code>DST_TRH_TURN</code> simplement pivoter.  Le sens de rotation est choisi au hasard. </li><li>  Si vous êtes loin de l'obstacle, alors allez-y. </li><li>  Nous répétons encore et encore. </li></ol><br><p>  Qu'est-ce qui est bien d'avoir 4 roues motrices et une transmission intégrale?  Nous pouvons effectuer (programmer) plusieurs types de virages: </p><br><ul><li>  Rotation douce.  Toutes les roues tournent, mais les roues d'un côté tournent plus vite. </li><li>  Un virage serré.  Les roues ne tournent que d'un côté. </li><li>  Demi-tour en place.  Comme un tracteur, les roues tournent d'un côté vers l'arrière et de l'autre vers l'avant. </li></ul><br><p>  Dans la deuxième version du programme, lors du contrôle à partir d'un téléphone Android, le mode sans échec, lorsque le robot essaie d'empêcher les collisions frontales, peut être désactivé si le programme est appuyé deux fois <br><img src="https://habrastorage.org/getpro/habr/post_images/2d3/256/454/2d3256454e390ed508f62d212ffb1d15.jpg" alt="Bouton"></p><br><p>  et rallumé en appuyant une fois. </p><br><p>  <em>Remarque importante</em> .  Toute la logique est sous le contrôle d'Arduino.  Android agit ici comme une console de jeu (sans cervelle) à partir de la console, sa tâche consiste à transmettre stupidement les pressions de boutons (c'est-à-dire les commandes) via Bluetooth à l'Arduino RoboCar4W. </p><br><h1 id="komponenty">  Composants </h1><br><p>  Initialement, la machine comprenait un servomoteur qui faisait tourner le télémètre à ultrasons d'un certain angle pour les mesures dans trois directions.  Mais pendant les tests, en raison d'une manipulation imprudente, le servo a grillé, alors maintenant le capteur de distance est simplement fixé rigidement devant le boîtier. </p><br><p>  Il n'y a pas de doublure argentée, mais le croquis est devenu un peu plus facile. </p><br><p>  Pour l'avenir, achetez le servo le plus simple et le moins cher, une puissance spéciale, une vitesse et une précision de rotation à un angle donné ne sont pas nécessaires, et il est assez facile de désactiver un servo, comme il s'est avéré.  SG90 vaut 2 $ est un bon ajustement. </p><br><p>  Ainsi, les composants du projet RoboCar4W, une description en anglais est donnée pour faciliter la recherche sur ebay et similaires: </p><br><ul><li>  Arduino UNO R3 </li><li>  Châssis prêt à l'emploi 4 roues motrices Mobile Robot Platform Smart Car Châssis Arduino Compatible </li><li>  Moteurs à courant continu avec rotation dans les deux sens - 4 pcs. </li><li>  Roues - 4 pièces </li><li>  Carte de commande de 4 moteurs à courant continu Motor Drive Shield L293D </li><li>  Mesureur de distance à ultrasons HC-SR04 Capteur de mesure de distance à module ultrasonique </li><li>  Piles Ni-MH 1,2 V - 8 pièces. </li><li>  Porte-boîte en plastique pour piles, Porte-boîte à piles 4 piles AA - 2 pcs. </li><li>  Type de batterie "Krona" 8,4 V - 1 pc. </li><li>  Interrupteur à bascule en option - interrupteur d'alimentation </li></ul><br><p>  Le châssis, les moteurs à courant continu et les roues ont été achetés immédiatement dans le kit et même avec les instructions de montage. </p><br><h1 id="raspinovka">  Brochage </h1><br><p>  Les entrées analogiques peuvent être utilisées comme broches numériques des ports d'E / S.  Les broches Arduino correspondant aux entrées analogiques sont numérotées de 14 à 19. Cela s'applique uniquement aux broches Arduino, pas aux numéros de broches physiques du microcontrôleur Atmega. </p><br><p>  Vous n'avez pas à dessiner, vous pouvez simplement tout mettre dans un tableau.  Je l'ai fait de cette façon. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/504/d24/fff/504d24fff6bdc78120e1a28a39848967.png" alt="Brochage"></p><br><p>  Les broches D4, D7, D8, D12 seront occupées si des moteurs CC ou des moteurs pas à pas sont utilisés. </p><br><p>  Les broches D9 (commande Servo # 1), D10 (commande Servo # 2) seront utilisées uniquement si des servomoteurs sont utilisés. </p><br><p>  La broche Arduino n'occupe pas les broches Arduino pour contrôler le Motor Drive Shield L293D. </p><br><p>  Les broches d'alimentation 3,3 V, 5 V et la masse sont dupliquées sur le blindage de l'entraînement du moteur en quantités suffisantes.  Par conséquent, il n'est pas nécessaire de s'inquiéter de leur pénurie. </p><br><p>  Si vous voulez toujours dessiner magnifiquement, le programme gratuit Fritzing vous aidera. </p><br><h1 id="pitanie">  La nutrition </h1><br><p>  C'est le deuxième point très important.  Cela dépend beaucoup de la nutrition.  Par exemple, un servomoteur qui tourne l'arbre à un angle donné commence à consommer beaucoup de courant.  Dans le même temps, si le servo est alimenté par un Arduino 5 V, il y a alors un "abaissement" de la tension et le reste du circuit commence à échouer, et l'Arduino peut même redémarrer en même temps. </p><br><p>  Dans tous les cas, si vous utilisez des moteurs dans l'engin, un bouclier d'entraînement de moteur est nécessaire (ou un circuit similaire). </p><br><p>  Nous avons donc 4 moteurs CC, un servo variateur, la carte Arduino elle-même et plusieurs capteurs.  Les moteurs sont les plus gourmands, mais les capteurs peuvent être alimentés avec succès à partir des connecteurs de la carte Arduino elle-même, donc tout est simple avec eux.  Pour plus de commodité, j'ai réduit l'ensemble de l'économie dans une seule table. </p><br><table><thead><tr><th></th><th>  Tension recommandée ou typique.  Consommation actuelle </th><th>  Tension maximale </th><th>  Ce qui est prévu pour nourrir </th><th>  Remarques </th></tr></thead><tbody><tr><td>  Arduino UNO R3 Board </td><td>  7 - 12V, 200mA (moyenne) </td><td>  6 - 20 </td><td>  "Krone 9V" Li-ion 650mAh, 8.4V </td><td>  Connecteur central </td></tr><tr><td>  Servomoteur MG-995 </td><td>  5-6 V, 0,1 - 0,3A (crête) </td><td>  4,8 - 7,2 </td><td>  Piles (5) pcs.  Ni-Mh 1,2 V = 6 V </td><td>  Nourriture uniquement d'une source distincte.  Si vous alimentez Arduino, tout échouera.  4 batteries de batterie Ni-Mh  * 1,2 V = 4,8 V n'est pas suffisant.  Certains soutiennent que ce servo ne devrait pas être utilisé à 6 volts seulement 4,8 </td></tr><tr><td>  Moteurs à courant continu (4 pièces) </td><td>  6 - 8V, courant de 70mA à 250mA </td><td>  3 - 12 </td><td>  piles (5 + 3) pcs.  Ni-Mh 1,2 V = 9,6 V </td><td>  Vous ne pourrez pas démarrer les moteurs normalement à partir d'une batterie 9V, alors ne perdez même pas de temps (et de batteries)! </td></tr><tr><td>  Bouclier d'entraînement de moteur L293D </td><td>  non requis </td><td>  4,5 - 36 </td><td>  non requis </td><td></td></tr><tr><td>  Module Bluetooth HC-0506 </td><td>  3,3 V, 50 mA </td><td>  1,8—3,6 </td><td>  Avec carte Arduino pin 3.3V </td><td></td></tr><tr><td>  Télémètre à ultrasons HC-SR04 </td><td>  5 V, 2 mA </td><td>  5 </td><td>  Avec carte Arduino pin 5V </td><td></td></tr></tbody></table><br><p>  Je n'avais pas de convertisseur de tension DC / DC.  La Krona 9V n'était pas une très bonne source d'énergie, je l'avais déjà. </p><br><p>  Mais j'ai refusé d'utiliser des batteries Li-ion haute capacité.  Premièrement, en raison du coût élevé, et deuxièmement, dans les achats en ligne chinois, il est facile de tomber sur un faux.  Plus précisément, pas «facile», mais «toujours».  De plus, le Li-ion nécessite une manipulation spéciale et n'est pas sûr. </p><br><p>  Donc, comme nous le voyons dans le tableau, nous avons besoin de 3 sources d'alimentation indépendantes: </p><br><ul><li>  Pour carte Arduino et capteurs. </li><li>  Pour servomoteur. </li><li>  Pour 4 moteurs DC. </li></ul><br><p>  Où puis-je obtenir autant?  Dans tous les cas, la carte Arduino elle-même doit être alimentée par une source distincte, comme  lorsque la tension «s'affaisse», par exemple, lors de la mise sous tension des moteurs, la carte peut redémarrer ou simplement échouer.  Ici, nous utilisons la batterie du facteur de forme Krona 9V, et le connecteur qui sera connecté à l'Arduino devrait être avec un «plus au centre». </p><br><p>  Pour un servomoteur et 4 moteurs à courant continu, vous pouvez le faire avec une seule source d'alimentation.  Le seul problème est que le servomoteur est conçu pour une tension de 5-6V (maximum 7.2V) et un courant de 100-300mA (crête), et les moteurs à courant continu ont besoin de 6-8V (maximum 12V) et un courant de 250mA. </p><br><p>  Pour résoudre le problème, il existe des convertisseurs DC-DC, mais je n'en avais pas.  En conséquence, j'ai appliqué mon schéma de câblage "propriétaire" (sans aucun circuit électronique abaisseur, uniquement une tension et un courant respectueux de l'environnement!): J'ai connecté 8 pièces.  Batteries 1,2 V en série et prises au bon endroit, comme indiqué sur le schéma. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f13/3f4/b82/f133f4b82dc88cf2de958804735c73b3.png" alt="La nutrition"></p><br><p>  6V est allé au servomoteur et 9,6 aux moteurs à courant continu.  Il est clair que les batteries 1 à 5 verront leur charge augmenter. </p><br><p>  Pour contrôler les servomoteurs et les moteurs à courant continu, j'ai utilisé un bouclier d'entraînement de moteur à 4 canaux basé sur la puce L293D. </p><br><h1 id="sborka">  Assemblage </h1><br><p>  L'assemblage du châssis fini est un petit problème.  Mais ne pensez pas que sans dopage, vous obtiendrez tout de suite.  Par conséquent, préparez les fichiers. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/058/f4a/d8b/058f4ad8b7a7b76295d5295dcd63afba.jpg" alt="Assemblage"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5bb/d2d/32c/5bbd2d32c5caa7a97d8201bddabae96c.jpg" alt="Assemblage"></p><br><p>  Il n'est pas possible de connecter plusieurs moteurs normalement, un servomoteur ou un moteur pas à pas directement à l'Arduino.  Depuis les broches (conclusions) de l'Arduino sont à faible courant.  Pour résoudre le problème, il existe un module de commande d'entraînement supplémentaire - Motor Drive Shield basé sur la puce L293D, qui est l'une des puces les plus courantes conçues à cet effet.  La puce L293D est également connue sous le nom de H-Bridge. </p><br><p>  J'ai utilisé une carte qui fournit 4 canaux pour se connecter sur deux puces L293D et un registre à décalage.  Acheté sur eBay pour 5 $. </p><br><p>  Cette carte de module de commande de variateur a les spécifications suivantes. </p><br><ul><li>  Blindage d'entraînement de moteur L293D compatible avec Arduino Mega 1280 et 2560, UNO, Duemilanove, Diecimila </li><li>  Contrôle 4 canaux </li><li>  moteurs alimentés de 4,5 V à 36 V </li><li>  courant de charge admissible 600mA par canal, courant de crête - 1,2A </li><li>  protection contre la surchauffe </li><li>  2 interfaces avec une minuterie Arduino exacte (il n'y aura pas de "gigue") pour connecter les servomoteurs à 5V, si la tension d'alimentation doit être plus élevée, alors la connexion d'alimentation doit être refaite comme décrit ci-dessous </li><li>  4 moteurs collecteurs CC bidirectionnels ou 2 moteurs pas à pas et 2 servomoteurs peuvent être commandés simultanément </li><li>  4 moteurs CC bidirectionnels sont chacun connectés à un bus 8 bits pour une sélection de vitesse individuelle </li><li>  connexion jusqu'à 2 entraînements pas à pas (unipolaires ou bipolaires), avec une bobine, une double bobine ou des étapes alternées </li><li>  connecteur pour connecter une source externe pour l'alimentation séparée de la logique de commande et des moteurs </li><li>  Bouton RESET Arduino </li><li>  La bibliothèque Adafruit AFMotor est utilisée pour la gestion. </li></ul><br><p>  Motor Drive Shield a besoin d'un peu de raffinement pour que vous puissiez connecter quoi que ce soit après.  J'ai soudé les connecteurs nécessaires sur le dessus, c'est ce qui s'est passé. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/470/943/060/47094306049d3d9ff9dbe393bd203b1a.jpg" alt="Blindage d'entraînement du moteur"></p><br><p>  Les moteurs peuvent être connectés à une alimentation supplémentaire par rapport à la carte Arduino.  Je recommande uniquement cette méthode de connexion.  Pour ce faire, retirez, ouvrez le cavalier, comme indiqué sur l'image. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a18/6c0/d8b/a186c0d8b3c77c02a7e260411eb1cbd9.jpg" alt="Bouclier d'entraînement de moteur L293D à 4 canaux.  Cavalier pour alimentation externe"></p><br><p>  Dans ce cas, l'Arduino est alimenté et les moteurs sont alimentés indépendamment les uns des autres. </p><br><p>  La LED sur le bouclier du moteur s'allume lorsqu'il y a de l'énergie pour les moteurs, si elle n'est pas allumée, alors les moteurs ne fonctionneront pas. </p><br><p>  Nouveau problème. </p><br><p>  La position du cavalier d'alimentation ne s'applique pas aux servos, ils seront toujours alimentés par 5V Arduino.  Étant donné que les servomoteurs consomment généralement beaucoup de courant et si la puissance est insuffisante, alors l'ensemble de l'appareil commence à tomber en panne, dans le «meilleur» cas, seul le servo variateur tombera en panne - il ne tournera pas à l'angle défini, ou tout le temps avant chaque virage tourner d'abord à 0 degrés, et seulement ensuite à un angle donné (et si vous pouvez suivre).  Par conséquent, je recommande d'alimenter le servo également à partir d'une source d'alimentation supplémentaire.  Pour ce faire, vous devrez refaire légèrement le schéma de connexion: mordre le fil plus (généralement rouge) du connecteur standard et le connecter directement au plus de la source d'alimentation. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d2f/6ea/fa1/d2f6eafa1d5721a6e36a38429aa4ad9e.jpg" alt="Finalisation pour connecter la puissance du servomoteur"></p><br><p>  Lors de la connexion d'un blindage de moteur, les broches analogiques ne sont pas utilisées.  Les broches numériques 2, 13 ne sont pas utilisées. </p><br><p>  Les broches suivantes sont utilisées uniquement si les moteurs CC ou les moteurs pas à pas correspondants sont connectés et utilisés: </p><br><ul><li>  D11: Moteur DC # 1 / Stepper # 1 (activation et contrôle de vitesse) </li><li>  D3: Moteur DC # 2 / Stepper # 1 (activation et contrôle de vitesse) </li><li>  D5: Moteur DC # 3 / Stepper # 2 (activation et contrôle de vitesse) </li><li>  D6: Moteur DC # 4 / Stepper # 2 (activation et contrôle de vitesse) </li></ul><br><p>  Ces broches seront occupées si des DC / steppers sont utilisés: D4, D7, D8, D12. </p><br><p>  Les broches suivantes ne seront occupées que si les servomoteurs appropriés sont utilisés: </p><br><ul><li>  D9: Contrôle du servo # 1 </li><li>  D10: Commande servo # 2 </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/27f/dd4/746/27fdd474619f83391b6c486a576a31fa.png" alt="Table de connexion"></p><br><p>  Pour commencer avec Motor Drive Shield, vous devez télécharger et installer la bibliothèque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Adafruit AFMotor</a> . </p><br><p>  Exemple de code pour contrôler les moteurs: </p><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;AFMotor.h&gt;</span></span></span><span class="hljs-meta"> //   Adafruit #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Servo.h&gt;</span></span></span><span class="hljs-meta"> //     AF_DCMotor motor(1); //   ,    DC    Motor Shiled , ,  frequency Servo servo; //    servo.attach(10); //     9  10 (    Motor Shiled) motor.setSpeed(speed); //   DC   0 ()  255 ( ) motor.run(RELEASE); // DC   motor.run(FORWARD); // DC   motor.run(BACKWARD); // DC   servo.write(90); //    90 .</span></span></code> </pre> <br><p>  Le moteur à courant continu a commencé à tourner uniquement en indiquant une vitesse supérieure à 100, sinon moins, il bourdonne juste.  Vous devrez déterminer expérimentalement la vitesse minimale de votre moteur. </p><br><p>  Pour les moteurs connectés à M1 et M2, vous pouvez régler la fréquence: MOTOR12_64KHZ, MOTOR12_8KHZ, MOTOR12_2KHZ, MOTOR12_1KHZ.  La vitesse de rotation la plus élevée est atteinte à 64 KHz, cette fréquence sera entendue, la fréquence et la vitesse inférieures à 1 KHz mais utilisent également moins d'énergie.  Les moteurs 3 et 4 fonctionnent toujours à 1 KHz; les autres valeurs sont ignorées.  La valeur par défaut est 1 kHz partout. </p><br><p>  Après cela, il est nécessaire d'effectuer un test des moteurs.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le croquis pour les tests peut être pris ici</a> .  Au début de l'esquisse, changez le numéro de moteur sur une ligne (ou en lignes) du type: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">motor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">…</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  Une esquisse fait tourner le moteur pendant un certain temps vers l'avant le long du mouvement du robot, puis vers l'arrière.  Regardez attentivement pour voir si le moteur tourne dans cette direction et changez la polarité de la connexion si nécessaire. </p><br><p>  Nous connectons le module ultrasonique du télémètre à ultrasons HC-SR04.  Brochage: </p><br><ul><li>  Vcc </li><li>  Déclenchement (T) </li><li>  Écho (r) </li><li>  GND </li></ul><br><p>  Le temps passé par le télémètre à ultrasons sur les mesures (déterminé empiriquement): </p><br><ul><li>  240 ms maximum si la distance est trop longue (hors plage) </li><li>  au moins 1 ms si la distance est trop courte </li><li>  une distance de 1,5 m est déterminée en environ 10 ms </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/de0/071/18e/de007118e81cee628722e426d8e83800.jpg" alt="Module ultrasonique de mètre de distance HC-SR04"></p><br><p>  Un télémètre à ultrasons, en raison de sa nature physique, et non pas parce que la Chine, dans certains cas, détermine mal la distance à un obstacle: </p><br><ul><li>  si l'obstacle est de forme complexe, les ultrasons sont réfléchis sous différents angles et le capteur est erroné, </li><li>  les ultrasons sont parfaitement absorbés (c'est-à-dire non réfléchis) par les meubles rembourrés ou les jouets, et le capteur pense qu'il n'y a rien devant. </li></ul><br><p>  En d'autres termes, pour un télémètre à ultrasons, il serait idéalement excellent si tous les obstacles étaient sous la forme d'un plan solide perpendiculaire à la direction du rayonnement ultrasonore. </p><br><p>  Certains problèmes peuvent être résolus avec un capteur de distance infrarouge.  Mais ce n'est pas parfait non plus: </p><br><ul><li>  petite portée maximale par rapport à l'échographie: 0,3-0,8 m contre 4 m </li><li>  grande distance minimale par rapport à l'échographie: 10 cm vs 2 cm </li><li>  dépendance de la sensibilité du capteur à l'éclairage global. </li></ul><br><p>  Bien que si vous installez ces télémètres par paire, l'efficacité de leur travail augmenterait considérablement. </p><br><h1 id="podklyuchaem-bluetooth-hc-05">  Connectez Bluetooth HC-05 </h1><br><p>  Comme vous pouvez le voir sur la fiche technique, les broches principales du HC-05 «nu»: </p><br><ul><li>  Transmission TX (broche 1) </li><li>  Réception RX (broche 2) </li><li>  Alimentation 3,3 V (broche 12) 3,3 V </li><li>  Masse GND (broche 13) </li><li>  Indicateur de mode PIO8 (broche 31) </li><li>  État de connexion PIO9 (broche 32), si la connexion est établie, la sortie sera élevée </li><li>  PIO11 (broche 34) pour activer le mode de commande AT </li></ul><br><p>  Notre module est soudé à la carte de répartition / base, où il y a déjà un diviseur de tension, il a donc une plage de tension de travail de 3,3 V à 6 V. </p><br><p>  Nous connectons notre module Bluetooth: </p><br><ul><li>  Arduino (TX) - (RX) HC-05 </li><li>  Arduino (RX) - (TX) HC-05 </li><li>  Arduino (+ 5V) - (VCC) Bluetooth </li><li>  Arduino (GND) - (GND) Bluetooth </li><li>  LED, les broches KEY ne sont pas utilisées </li></ul><br><p>  Une fois que le module Bluetooth HC-05 est alimenté, le voyant DEL doit clignoter, ce qui signifie que le Bluetooth fonctionne. </p><br><p>  Activez le Bluetooth sur le mobile, recherchez l'appareil portant le nom HC-05 et connectez-vous, mot de passe 1234. </p><br><p>  Pour les tests, remplissez un simple croquis en Arduino: </p><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Test Arduino + Bluetooth. http://localhost"); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { count++; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Count = "); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(count); delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); }</code> </pre> <br><p>  Sur le téléphone Android, installez le terminal Bluetooth.  Nous sommes connectés à l'appareil HC-05 et nous observons sur l'écran du téléphone des lignes rampantes avec un compteur croissant. </p><br><p>  Pour que le module puisse recevoir des commandes AT, vous devez le mettre dans le mode approprié - pour cela, vous devez définir la sortie KEY (PIO11) sur la valeur logique 1. Sur certaines cartes Breakout / Base Board, au lieu de la sortie KEY, il y a une sortie EN (ENABLE), qui peut ou non être soudé à la broche sur la puce elle-même.  Cela s'applique uniquement aux puces HC05.  C'est juste que ma sortie de borne EN n'est soudée nulle part.  Par conséquent, il peut être soudé avec un fil séparé à la borne KEY (PIO11) de la puce.  Ou, pendant le fonctionnement, pour mettre le HC05 en mode de commande AT, court-circuitez la sortie de la puce KEY (PIO11) sur la sortie d'alimentation Vcc pendant quelques secondes.  Pour HC06, la broche KEY n'est pas nécessaire. </p><br><h1 id="programmnoe-obespechenie">  Logiciels </h1><br><p>  Remarque  Avant chaque téléchargement du programme sur Arduino, assurez-vous que le module Bluetooth n'est pas connecté à l'Arduino.  Cela entraînera des problèmes de remplissage d'esquisse.  Débranchez simplement l'alimentation du module Bluetooth ou des fils reliant les broches du module Arduino et RX, TX. </p><br><p>  Au début de l'esquisse, modifiez les numéros de moteur dans les lignes du type: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">motor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">…</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  <a href="">Esquisse pour le mode automatique avec téléchargement d'évitement d'obstacles ici</a> . </p><br><p>  Si vous remplacez la chaîne </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">debug</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><p>  sur </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">debug</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre> <br><p>  Cela activera le mode de débogage. </p><br><p>  En mode débogage, le RoboCar4W ne roulera pas vraiment ni ne roulera.  Au lieu de cela, activez le moniteur de port série et vous y verrez comment il "conduit" virtuellement.  Au lieu d'un véritable entraînement vers l'avant, la chaîne «Forward» sera écrite sur le moniteur du port série, au lieu d'être inversée avec un virage à gauche, «Turn Back L (eft)», etc.  Le capteur de distance à ultrasons ne fait rien non plus, au lieu de cela les distances aux obstacles sont générées par programme et de manière aléatoire. </p><br><p>  Ce mode de débogage est pratique si vous changez l'algorithme de mouvement et au lieu d'attraper une machine à écrire dans la pièce, vérifiez tout au ralenti. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Croquis Bluetooth pour le contrôle manuel à télécharger ici</a> .  L'esquisse n'a pas de mode de débogage, car tout y est transparent.  Vous appuyez sur le bouton - le robot s'en va. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Programme pour Adnroid Bluetooth RC Car</a> . </p><br><p>  Eh bien, c'est tout!  Bon voyage! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/32b/8dc/98f/32b8dc98ff44592014df2bf2f736f9d5.jpg" alt="Bon voyage!"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426097/">https://habr.com/ru/post/fr426097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426087/index.html">Signature d'un PDF dans JS et collage d'une signature en C # à l'aide de Crypto PRO</a></li>
<li><a href="../fr426089/index.html">Une startup américaine a développé des lunettes-AdBlock</a></li>
<li><a href="../fr426091/index.html">8 analyseurs de journaux cloud pour évaluer l'environnement de travail</a></li>
<li><a href="../fr426093/index.html">Monétisation des données des utilisateurs par rapport à la publicité intégrée: avantages et inconvénients</a></li>
<li><a href="../fr426095/index.html">Webinaire ouvert «Comment ne pas écrire en Python»</a></li>
<li><a href="../fr426099/index.html">Typegram News</a></li>
<li><a href="../fr426101/index.html">Intégrité des données dans une architecture de microservices - comment la garantir sans transactions distribuées et connectivité étroite</a></li>
<li><a href="../fr426103/index.html">Webinaire «Avez-vous besoin de Kubernetes» le 15 octobre à 19h00</a></li>
<li><a href="../fr426105/index.html">Ma prise en une semaine</a></li>
<li><a href="../fr426111/index.html">Google va toujours lancer un service de recherche censuré en Chine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>