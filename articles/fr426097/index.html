<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßïüèø üõÄüèΩ üåπ Arduino Projet "RoboCar4W Robot Machine" ‚ôäÔ∏è üò≠ üõÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vous comprenez, "expliqua le r√©dacteur en chef," que cela devrait √™tre divertissant, frais, plein d'aventures int√©ressantes ... pour que le lecteur ne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arduino Projet "RoboCar4W Robot Machine"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426097/"><p>  <em>Vous comprenez, "expliqua le r√©dacteur en chef," que cela devrait √™tre divertissant, frais, plein d'aventures int√©ressantes ... pour que le lecteur ne puisse pas se d√©tacher.</em> <br>  I. Ilf, E. Petrov <em>"Comment a √©t√© cr√©√© Robinson"</em> . </p><br><p>  D√©buter avec Arduino, comme avec n'importe quelle autre plate-forme logicielle ou mat√©rielle, est toujours plus int√©ressant √† partir d'un vrai projet.  Dans le m√™me temps, les programmeurs √©crivent du code qui affiche "Bonjour, monde", les Arduinistes clignotent une LED.  Et tout le monde est heureux comme des enfants. </p><br><p>  J'ai d√©cid√© de commencer par un projet avanc√©, notamment avec l'espoir secret d'arracher la jeune g√©n√©ration √† Counter-Strike (√©chou√©). </p><br><p>  Comme vous pouvez le deviner d'apr√®s le nom RoboCar4W, le premier projet √©tait une voiture robot √† quatre roues.  En commen√ßant le travail, j'avais d√©j√† une exp√©rience en programmation, j'ai d√©j√† su souder pendant longtemps, mais je ne connaissais m√™me pas du tout les brochages Arduino et je n'ai pas lu du tout la documentation.  J'ai √©tudi√© toute la sagesse au cours du jeu et Google m'a aid√©. </p><a name="habracut"></a><br><p>  Le projet lui-m√™me n'√©tant fondamentalement pas nouveau, de telles descriptions dans le r√©seau suffisent, tous les composants sont connus, aucune surprise n'√©tait attendue.  Par cons√©quent, l'id√©e a √©t√© formul√©e dans les termes les plus g√©n√©raux et l'objectif principal √©tait de vous immerger dans le "monde des choses" en utilisant Arduino, comme plate-forme de prototypage rapide.  Dans cet opus, peut-√™tre que quelqu'un se reconna√Æt au tout d√©but du voyage. </p><br><p>  Tout le mat√©riel a √©t√© achet√© sur ebay, et d'apr√®s ma propre exp√©rience, je veux dire qu'il est plus facile d'acheter un kit de d√©marrage tout de suite (recherchez-le dans les termes du kit de d√©marrage Arduino), plut√¥t que de l'assembler en d√©tail.  Oui, et tous se rejoignent en m√™me temps.  Il a √©t√© d√©cid√© de ne pas jouer, d'acheter un ch√¢ssis normal, des roues normales, des moteurs normaux, pour que ce soit "cher". </p><br><p>  Le secret principal des achats r√©ussis sur eBay est d'acheter aupr√®s des meilleurs vendeurs et de lire attentivement la description du produit.  Il existe de nombreux articles √† ce sujet sur Internet. </p><br><p>  Quelle carte Arduino choisir? </p><br><p>  J'ai pris Arduino UNO, beaucoup de projets avec des descriptions pour √ßa.  Mais maintenant, je prendrais l'Arduino Mega 2560, il a plus de sorties num√©riques et analogiques et une compatibilit√© totale sur les projets avec UNO. </p><br><h1 id="obschee-opisanie-proekta">  Description g√©n√©rale du projet </h1><br><p>  Dans le monde du d√©veloppement logiciel, cela est √©galement appel√© ¬´configuration syst√®me¬ª. </p><br><p>  L'id√©e du projet √©tait la suivante.  La premi√®re version de la machine robot appel√©e RoboCar4W devrait effectuer des actions simples: </p><br><ul><li>  avancer, reculer, effectuer des virages </li><li>  mesurer la distance aux obstacles </li><li>  √™tre capable de contourner automatiquement les obstacles devant. </li></ul><br><p>  La deuxi√®me version de la machine doit √™tre contr√¥l√©e manuellement via Bluetooth depuis un t√©l√©phone Android. </p><br><p>  Pour que vous ayez mieux travaill√© ici, c'est le projet RoboCar4W final assembl√© (ici sans Bluetooth). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/457/929/cc8/457929cc8554ef727654f53704ece195.jpg" alt="Arduino RoboCar4W"></p><br><p>  Voici une vid√©o des essais en mer. </p><br><p>  Dans la premi√®re vid√©o, RoboCar4W roule automatiquement en √©vitant les obstacles sur deux versions diff√©rentes du ¬´firmware¬ª, c'est-√†-dire  esquissez donc si quelqu'un est le plus vif et a remarqu√© que le comportement du robot dans diff√©rents √©pisodes est l√©g√®rement diff√©rent. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/a05/27c/f11/a0527cf11325d83a2b91826412b151b9.jpg" alt="Robot voiture RoboCar4W"></a> </p><br><p>  Dans la deuxi√®me vid√©o, RoboCar4W se d√©place √† l'aide de commandes transmises par le ¬´conducteur¬ª via Bluetooth √† partir d'un t√©l√©phone mobile sous Android.  ¬´Bluetooth RC Car¬ª est install√© sur le t√©l√©phone.  De plus, s'il y a un obstacle √† l'avant, le robot s'arr√™te, c'est-√†-dire  √©peronner quelque chose ne fonctionnera pas (cependant, il y a un bouton "secret" qui d√©sactive le mode sans √©chec). </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/173/997/d9c/173997d9c4f497310ab582b11007d468.jpg" alt="Robot voiture RoboCar4W"></a> </p><br><p>  Dans la troisi√®me vid√©o, RoboCar4W montre un programme de mouvement de d√©monstration pr√©programm√© avec tours.  Le programme de d√©monstration est activ√© sur commande √† partir du m√™me t√©l√©phone mobile Android.  Le robot roule juste un moment et fait des virages. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/820/a73/9f5/820a739f5e40ca959f0c441e53552e4d.jpg" alt="Robot voiture RoboCar4W"></a> </p><br><h1 id="algoritm-upravleniya-dvizheniem">  Algorithme de contr√¥le de mouvement </h1><br><p>  C‚Äôest une erreur d‚Äôappeler notre m√©thode ¬´algorithme d‚Äô√©vitement d‚Äôobstacles¬ª ou ¬´d√©tection de chemin¬ª.  Ce sont des disciplines math√©matiques distinctes, des math√©matiques pures.  Si vous aimez vraiment, vraiment les math√©matiques, alors google ces phrases, vous aurez la lecture pendant six mois. </p><br><p>  En attendant, nous nous int√©ressons beaucoup plus facilement aux choses.  Par cons√©quent, nous l'appellerons simplement - l'algorithme de contr√¥le de mouvement d'un robot √† 4 roues.  Bien s√ªr, nous parlons de contr√¥le automatique sans intervention humaine. </p><br><p>  Voici cet algorithme simple √©crit en mots, pour des algorithmes plus complexes il faut (que vous le vouliez ou non) composer des diagrammes. </p><br><p>  Maintenant, regardez en m√™me temps le code source de l'esquisse <a href="">RoboCar4W-1.ino</a> . </p><br><ol><li>  Nous mesurons la distance √† l'obstacle en face. </li><li> Si cette distance mesur√©e est inf√©rieure √† la valeur <code>DST_TRH_BACK</code> (abr√©viation de seuil de distance), alors on s'arr√™te et on <code>DST_TRH_BACK</code> en tournant.  Le sens de rotation est choisi comme suit: si vous avez pr√©c√©demment tourn√© √† gauche, tournez √† droite et vice versa. </li><li>  Si la distance mesur√©e est sup√©rieure √† <code>DST_TRH_BACK</code> , mais inf√©rieure √† <code>DST_TRH_TURN</code> , <code>DST_TRH_TURN</code> simplement pivoter.  Le sens de rotation est choisi au hasard. </li><li>  Si vous √™tes loin de l'obstacle, alors allez-y. </li><li>  Nous r√©p√©tons encore et encore. </li></ol><br><p>  Qu'est-ce qui est bien d'avoir 4 roues motrices et une transmission int√©grale?  Nous pouvons effectuer (programmer) plusieurs types de virages: </p><br><ul><li>  Rotation douce.  Toutes les roues tournent, mais les roues d'un c√¥t√© tournent plus vite. </li><li>  Un virage serr√©.  Les roues ne tournent que d'un c√¥t√©. </li><li>  Demi-tour en place.  Comme un tracteur, les roues tournent d'un c√¥t√© vers l'arri√®re et de l'autre vers l'avant. </li></ul><br><p>  Dans la deuxi√®me version du programme, lors du contr√¥le √† partir d'un t√©l√©phone Android, le mode sans √©chec, lorsque le robot essaie d'emp√™cher les collisions frontales, peut √™tre d√©sactiv√© si le programme est appuy√© deux fois <br><img src="https://habrastorage.org/getpro/habr/post_images/2d3/256/454/2d3256454e390ed508f62d212ffb1d15.jpg" alt="Bouton"></p><br><p>  et rallum√© en appuyant une fois. </p><br><p>  <em>Remarque importante</em> .  Toute la logique est sous le contr√¥le d'Arduino.  Android agit ici comme une console de jeu (sans cervelle) √† partir de la console, sa t√¢che consiste √† transmettre stupidement les pressions de boutons (c'est-√†-dire les commandes) via Bluetooth √† l'Arduino RoboCar4W. </p><br><h1 id="komponenty">  Composants </h1><br><p>  Initialement, la machine comprenait un servomoteur qui faisait tourner le t√©l√©m√®tre √† ultrasons d'un certain angle pour les mesures dans trois directions.  Mais pendant les tests, en raison d'une manipulation imprudente, le servo a grill√©, alors maintenant le capteur de distance est simplement fix√© rigidement devant le bo√Ætier. </p><br><p>  Il n'y a pas de doublure argent√©e, mais le croquis est devenu un peu plus facile. </p><br><p>  Pour l'avenir, achetez le servo le plus simple et le moins cher, une puissance sp√©ciale, une vitesse et une pr√©cision de rotation √† un angle donn√© ne sont pas n√©cessaires, et il est assez facile de d√©sactiver un servo, comme il s'est av√©r√©.  SG90 vaut 2 $ est un bon ajustement. </p><br><p>  Ainsi, les composants du projet RoboCar4W, une description en anglais est donn√©e pour faciliter la recherche sur ebay et similaires: </p><br><ul><li>  Arduino UNO R3 </li><li>  Ch√¢ssis pr√™t √† l'emploi 4 roues motrices Mobile Robot Platform Smart Car Ch√¢ssis Arduino Compatible </li><li>  Moteurs √† courant continu avec rotation dans les deux sens - 4 pcs. </li><li>  Roues - 4 pi√®ces </li><li>  Carte de commande de 4 moteurs √† courant continu Motor Drive Shield L293D </li><li>  Mesureur de distance √† ultrasons HC-SR04 Capteur de mesure de distance √† module ultrasonique </li><li>  Piles Ni-MH 1,2 V - 8 pi√®ces. </li><li>  Porte-bo√Æte en plastique pour piles, Porte-bo√Æte √† piles 4 piles AA - 2 pcs. </li><li>  Type de batterie "Krona" 8,4 V - 1 pc. </li><li>  Interrupteur √† bascule en option - interrupteur d'alimentation </li></ul><br><p>  Le ch√¢ssis, les moteurs √† courant continu et les roues ont √©t√© achet√©s imm√©diatement dans le kit et m√™me avec les instructions de montage. </p><br><h1 id="raspinovka">  Brochage </h1><br><p>  Les entr√©es analogiques peuvent √™tre utilis√©es comme broches num√©riques des ports d'E / S.  Les broches Arduino correspondant aux entr√©es analogiques sont num√©rot√©es de 14 √† 19. Cela s'applique uniquement aux broches Arduino, pas aux num√©ros de broches physiques du microcontr√¥leur Atmega. </p><br><p>  Vous n'avez pas √† dessiner, vous pouvez simplement tout mettre dans un tableau.  Je l'ai fait de cette fa√ßon. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/504/d24/fff/504d24fff6bdc78120e1a28a39848967.png" alt="Brochage"></p><br><p>  Les broches D4, D7, D8, D12 seront occup√©es si des moteurs CC ou des moteurs pas √† pas sont utilis√©s. </p><br><p>  Les broches D9 (commande Servo # 1), D10 (commande Servo # 2) seront utilis√©es uniquement si des servomoteurs sont utilis√©s. </p><br><p>  La broche Arduino n'occupe pas les broches Arduino pour contr√¥ler le Motor Drive Shield L293D. </p><br><p>  Les broches d'alimentation 3,3 V, 5 V et la masse sont dupliqu√©es sur le blindage de l'entra√Ænement du moteur en quantit√©s suffisantes.  Par cons√©quent, il n'est pas n√©cessaire de s'inqui√©ter de leur p√©nurie. </p><br><p>  Si vous voulez toujours dessiner magnifiquement, le programme gratuit Fritzing vous aidera. </p><br><h1 id="pitanie">  La nutrition </h1><br><p>  C'est le deuxi√®me point tr√®s important.  Cela d√©pend beaucoup de la nutrition.  Par exemple, un servomoteur qui tourne l'arbre √† un angle donn√© commence √† consommer beaucoup de courant.  Dans le m√™me temps, si le servo est aliment√© par un Arduino 5 V, il y a alors un "abaissement" de la tension et le reste du circuit commence √† √©chouer, et l'Arduino peut m√™me red√©marrer en m√™me temps. </p><br><p>  Dans tous les cas, si vous utilisez des moteurs dans l'engin, un bouclier d'entra√Ænement de moteur est n√©cessaire (ou un circuit similaire). </p><br><p>  Nous avons donc 4 moteurs CC, un servo variateur, la carte Arduino elle-m√™me et plusieurs capteurs.  Les moteurs sont les plus gourmands, mais les capteurs peuvent √™tre aliment√©s avec succ√®s √† partir des connecteurs de la carte Arduino elle-m√™me, donc tout est simple avec eux.  Pour plus de commodit√©, j'ai r√©duit l'ensemble de l'√©conomie dans une seule table. </p><br><table><thead><tr><th></th><th>  Tension recommand√©e ou typique.  Consommation actuelle </th><th>  Tension maximale </th><th>  Ce qui est pr√©vu pour nourrir </th><th>  Remarques </th></tr></thead><tbody><tr><td>  Arduino UNO R3 Board </td><td>  7 - 12V, 200mA (moyenne) </td><td>  6 - 20 </td><td>  "Krone 9V" Li-ion 650mAh, 8.4V </td><td>  Connecteur central </td></tr><tr><td>  Servomoteur MG-995 </td><td>  5-6 V, 0,1 - 0,3A (cr√™te) </td><td>  4,8 - 7,2 </td><td>  Piles (5) pcs.  Ni-Mh 1,2 V = 6 V </td><td>  Nourriture uniquement d'une source distincte.  Si vous alimentez Arduino, tout √©chouera.  4 batteries de batterie Ni-Mh  * 1,2 V = 4,8 V n'est pas suffisant.  Certains soutiennent que ce servo ne devrait pas √™tre utilis√© √† 6 volts seulement 4,8 </td></tr><tr><td>  Moteurs √† courant continu (4 pi√®ces) </td><td>  6 - 8V, courant de 70mA √† 250mA </td><td>  3 - 12 </td><td>  piles (5 + 3) pcs.  Ni-Mh 1,2 V = 9,6 V </td><td>  Vous ne pourrez pas d√©marrer les moteurs normalement √† partir d'une batterie 9V, alors ne perdez m√™me pas de temps (et de batteries)! </td></tr><tr><td>  Bouclier d'entra√Ænement de moteur L293D </td><td>  non requis </td><td>  4,5 - 36 </td><td>  non requis </td><td></td></tr><tr><td>  Module Bluetooth HC-0506 </td><td>  3,3 V, 50 mA </td><td>  1,8‚Äî3,6 </td><td>  Avec carte Arduino pin 3.3V </td><td></td></tr><tr><td>  T√©l√©m√®tre √† ultrasons HC-SR04 </td><td>  5 V, 2 mA </td><td>  5 </td><td>  Avec carte Arduino pin 5V </td><td></td></tr></tbody></table><br><p>  Je n'avais pas de convertisseur de tension DC / DC.  La Krona 9V n'√©tait pas une tr√®s bonne source d'√©nergie, je l'avais d√©j√†. </p><br><p>  Mais j'ai refus√© d'utiliser des batteries Li-ion haute capacit√©.  Premi√®rement, en raison du co√ªt √©lev√©, et deuxi√®mement, dans les achats en ligne chinois, il est facile de tomber sur un faux.  Plus pr√©cis√©ment, pas ¬´facile¬ª, mais ¬´toujours¬ª.  De plus, le Li-ion n√©cessite une manipulation sp√©ciale et n'est pas s√ªr. </p><br><p>  Donc, comme nous le voyons dans le tableau, nous avons besoin de 3 sources d'alimentation ind√©pendantes: </p><br><ul><li>  Pour carte Arduino et capteurs. </li><li>  Pour servomoteur. </li><li>  Pour 4 moteurs DC. </li></ul><br><p>  O√π puis-je obtenir autant?  Dans tous les cas, la carte Arduino elle-m√™me doit √™tre aliment√©e par une source distincte, comme  lorsque la tension ¬´s'affaisse¬ª, par exemple, lors de la mise sous tension des moteurs, la carte peut red√©marrer ou simplement √©chouer.  Ici, nous utilisons la batterie du facteur de forme Krona 9V, et le connecteur qui sera connect√© √† l'Arduino devrait √™tre avec un ¬´plus au centre¬ª. </p><br><p>  Pour un servomoteur et 4 moteurs √† courant continu, vous pouvez le faire avec une seule source d'alimentation.  Le seul probl√®me est que le servomoteur est con√ßu pour une tension de 5-6V (maximum 7.2V) et un courant de 100-300mA (cr√™te), et les moteurs √† courant continu ont besoin de 6-8V (maximum 12V) et un courant de 250mA. </p><br><p>  Pour r√©soudre le probl√®me, il existe des convertisseurs DC-DC, mais je n'en avais pas.  En cons√©quence, j'ai appliqu√© mon sch√©ma de c√¢blage "propri√©taire" (sans aucun circuit √©lectronique abaisseur, uniquement une tension et un courant respectueux de l'environnement!): J'ai connect√© 8 pi√®ces.  Batteries 1,2 V en s√©rie et prises au bon endroit, comme indiqu√© sur le sch√©ma. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f13/3f4/b82/f133f4b82dc88cf2de958804735c73b3.png" alt="La nutrition"></p><br><p>  6V est all√© au servomoteur et 9,6 aux moteurs √† courant continu.  Il est clair que les batteries 1 √† 5 verront leur charge augmenter. </p><br><p>  Pour contr√¥ler les servomoteurs et les moteurs √† courant continu, j'ai utilis√© un bouclier d'entra√Ænement de moteur √† 4 canaux bas√© sur la puce L293D. </p><br><h1 id="sborka">  Assemblage </h1><br><p>  L'assemblage du ch√¢ssis fini est un petit probl√®me.  Mais ne pensez pas que sans dopage, vous obtiendrez tout de suite.  Par cons√©quent, pr√©parez les fichiers. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/058/f4a/d8b/058f4ad8b7a7b76295d5295dcd63afba.jpg" alt="Assemblage"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5bb/d2d/32c/5bbd2d32c5caa7a97d8201bddabae96c.jpg" alt="Assemblage"></p><br><p>  Il n'est pas possible de connecter plusieurs moteurs normalement, un servomoteur ou un moteur pas √† pas directement √† l'Arduino.  Depuis les broches (conclusions) de l'Arduino sont √† faible courant.  Pour r√©soudre le probl√®me, il existe un module de commande d'entra√Ænement suppl√©mentaire - Motor Drive Shield bas√© sur la puce L293D, qui est l'une des puces les plus courantes con√ßues √† cet effet.  La puce L293D est √©galement connue sous le nom de H-Bridge. </p><br><p>  J'ai utilis√© une carte qui fournit 4 canaux pour se connecter sur deux puces L293D et un registre √† d√©calage.  Achet√© sur eBay pour 5 $. </p><br><p>  Cette carte de module de commande de variateur a les sp√©cifications suivantes. </p><br><ul><li>  Blindage d'entra√Ænement de moteur L293D compatible avec Arduino Mega 1280 et 2560, UNO, Duemilanove, Diecimila </li><li>  Contr√¥le 4 canaux </li><li>  moteurs aliment√©s de 4,5 V √† 36 V </li><li>  courant de charge admissible 600mA par canal, courant de cr√™te - 1,2A </li><li>  protection contre la surchauffe </li><li>  2 interfaces avec une minuterie Arduino exacte (il n'y aura pas de "gigue") pour connecter les servomoteurs √† 5V, si la tension d'alimentation doit √™tre plus √©lev√©e, alors la connexion d'alimentation doit √™tre refaite comme d√©crit ci-dessous </li><li>  4 moteurs collecteurs CC bidirectionnels ou 2 moteurs pas √† pas et 2 servomoteurs peuvent √™tre command√©s simultan√©ment </li><li>  4 moteurs CC bidirectionnels sont chacun connect√©s √† un bus 8 bits pour une s√©lection de vitesse individuelle </li><li>  connexion jusqu'√† 2 entra√Ænements pas √† pas (unipolaires ou bipolaires), avec une bobine, une double bobine ou des √©tapes altern√©es </li><li>  connecteur pour connecter une source externe pour l'alimentation s√©par√©e de la logique de commande et des moteurs </li><li>  Bouton RESET Arduino </li><li>  La biblioth√®que Adafruit AFMotor est utilis√©e pour la gestion. </li></ul><br><p>  Motor Drive Shield a besoin d'un peu de raffinement pour que vous puissiez connecter quoi que ce soit apr√®s.  J'ai soud√© les connecteurs n√©cessaires sur le dessus, c'est ce qui s'est pass√©. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/470/943/060/47094306049d3d9ff9dbe393bd203b1a.jpg" alt="Blindage d'entra√Ænement du moteur"></p><br><p>  Les moteurs peuvent √™tre connect√©s √† une alimentation suppl√©mentaire par rapport √† la carte Arduino.  Je recommande uniquement cette m√©thode de connexion.  Pour ce faire, retirez, ouvrez le cavalier, comme indiqu√© sur l'image. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a18/6c0/d8b/a186c0d8b3c77c02a7e260411eb1cbd9.jpg" alt="Bouclier d'entra√Ænement de moteur L293D √† 4 canaux.  Cavalier pour alimentation externe"></p><br><p>  Dans ce cas, l'Arduino est aliment√© et les moteurs sont aliment√©s ind√©pendamment les uns des autres. </p><br><p>  La LED sur le bouclier du moteur s'allume lorsqu'il y a de l'√©nergie pour les moteurs, si elle n'est pas allum√©e, alors les moteurs ne fonctionneront pas. </p><br><p>  Nouveau probl√®me. </p><br><p>  La position du cavalier d'alimentation ne s'applique pas aux servos, ils seront toujours aliment√©s par 5V Arduino.  √âtant donn√© que les servomoteurs consomment g√©n√©ralement beaucoup de courant et si la puissance est insuffisante, alors l'ensemble de l'appareil commence √† tomber en panne, dans le ¬´meilleur¬ª cas, seul le servo variateur tombera en panne - il ne tournera pas √† l'angle d√©fini, ou tout le temps avant chaque virage tourner d'abord √† 0 degr√©s, et seulement ensuite √† un angle donn√© (et si vous pouvez suivre).  Par cons√©quent, je recommande d'alimenter le servo √©galement √† partir d'une source d'alimentation suppl√©mentaire.  Pour ce faire, vous devrez refaire l√©g√®rement le sch√©ma de connexion: mordre le fil plus (g√©n√©ralement rouge) du connecteur standard et le connecter directement au plus de la source d'alimentation. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d2f/6ea/fa1/d2f6eafa1d5721a6e36a38429aa4ad9e.jpg" alt="Finalisation pour connecter la puissance du servomoteur"></p><br><p>  Lors de la connexion d'un blindage de moteur, les broches analogiques ne sont pas utilis√©es.  Les broches num√©riques 2, 13 ne sont pas utilis√©es. </p><br><p>  Les broches suivantes sont utilis√©es uniquement si les moteurs CC ou les moteurs pas √† pas correspondants sont connect√©s et utilis√©s: </p><br><ul><li>  D11: Moteur DC # 1 / Stepper # 1 (activation et contr√¥le de vitesse) </li><li>  D3: Moteur DC # 2 / Stepper # 1 (activation et contr√¥le de vitesse) </li><li>  D5: Moteur DC # 3 / Stepper # 2 (activation et contr√¥le de vitesse) </li><li>  D6: Moteur DC # 4 / Stepper # 2 (activation et contr√¥le de vitesse) </li></ul><br><p>  Ces broches seront occup√©es si des DC / steppers sont utilis√©s: D4, D7, D8, D12. </p><br><p>  Les broches suivantes ne seront occup√©es que si les servomoteurs appropri√©s sont utilis√©s: </p><br><ul><li>  D9: Contr√¥le du servo # 1 </li><li>  D10: Commande servo # 2 </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/27f/dd4/746/27fdd474619f83391b6c486a576a31fa.png" alt="Table de connexion"></p><br><p>  Pour commencer avec Motor Drive Shield, vous devez t√©l√©charger et installer la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Adafruit AFMotor</a> . </p><br><p>  Exemple de code pour contr√¥ler les moteurs: </p><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;AFMotor.h&gt;</span></span></span><span class="hljs-meta"> //   Adafruit #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Servo.h&gt;</span></span></span><span class="hljs-meta"> //     AF_DCMotor motor(1); //   ,    DC    Motor Shiled , ,  frequency Servo servo; //    servo.attach(10); //     9  10 (    Motor Shiled) motor.setSpeed(speed); //   DC   0 ()  255 ( ) motor.run(RELEASE); // DC   motor.run(FORWARD); // DC   motor.run(BACKWARD); // DC   servo.write(90); //    90 .</span></span></code> </pre> <br><p>  Le moteur √† courant continu a commenc√© √† tourner uniquement en indiquant une vitesse sup√©rieure √† 100, sinon moins, il bourdonne juste.  Vous devrez d√©terminer exp√©rimentalement la vitesse minimale de votre moteur. </p><br><p>  Pour les moteurs connect√©s √† M1 et M2, vous pouvez r√©gler la fr√©quence: MOTOR12_64KHZ, MOTOR12_8KHZ, MOTOR12_2KHZ, MOTOR12_1KHZ.  La vitesse de rotation la plus √©lev√©e est atteinte √† 64 KHz, cette fr√©quence sera entendue, la fr√©quence et la vitesse inf√©rieures √† 1 KHz mais utilisent √©galement moins d'√©nergie.  Les moteurs 3 et 4 fonctionnent toujours √† 1 KHz; les autres valeurs sont ignor√©es.  La valeur par d√©faut est 1 kHz partout. </p><br><p>  Apr√®s cela, il est n√©cessaire d'effectuer un test des moteurs.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le croquis pour les tests peut √™tre pris ici</a> .  Au d√©but de l'esquisse, changez le num√©ro de moteur sur une ligne (ou en lignes) du type: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">motor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">‚Ä¶</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  Une esquisse fait tourner le moteur pendant un certain temps vers l'avant le long du mouvement du robot, puis vers l'arri√®re.  Regardez attentivement pour voir si le moteur tourne dans cette direction et changez la polarit√© de la connexion si n√©cessaire. </p><br><p>  Nous connectons le module ultrasonique du t√©l√©m√®tre √† ultrasons HC-SR04.  Brochage: </p><br><ul><li>  Vcc </li><li>  D√©clenchement (T) </li><li>  √âcho (r) </li><li>  GND </li></ul><br><p>  Le temps pass√© par le t√©l√©m√®tre √† ultrasons sur les mesures (d√©termin√© empiriquement): </p><br><ul><li>  240 ms maximum si la distance est trop longue (hors plage) </li><li>  au moins 1 ms si la distance est trop courte </li><li>  une distance de 1,5 m est d√©termin√©e en environ 10 ms </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/de0/071/18e/de007118e81cee628722e426d8e83800.jpg" alt="Module ultrasonique de m√®tre de distance HC-SR04"></p><br><p>  Un t√©l√©m√®tre √† ultrasons, en raison de sa nature physique, et non pas parce que la Chine, dans certains cas, d√©termine mal la distance √† un obstacle: </p><br><ul><li>  si l'obstacle est de forme complexe, les ultrasons sont r√©fl√©chis sous diff√©rents angles et le capteur est erron√©, </li><li>  les ultrasons sont parfaitement absorb√©s (c'est-√†-dire non r√©fl√©chis) par les meubles rembourr√©s ou les jouets, et le capteur pense qu'il n'y a rien devant. </li></ul><br><p>  En d'autres termes, pour un t√©l√©m√®tre √† ultrasons, il serait id√©alement excellent si tous les obstacles √©taient sous la forme d'un plan solide perpendiculaire √† la direction du rayonnement ultrasonore. </p><br><p>  Certains probl√®mes peuvent √™tre r√©solus avec un capteur de distance infrarouge.  Mais ce n'est pas parfait non plus: </p><br><ul><li>  petite port√©e maximale par rapport √† l'√©chographie: 0,3-0,8 m contre 4 m </li><li>  grande distance minimale par rapport √† l'√©chographie: 10 cm vs 2 cm </li><li>  d√©pendance de la sensibilit√© du capteur √† l'√©clairage global. </li></ul><br><p>  Bien que si vous installez ces t√©l√©m√®tres par paire, l'efficacit√© de leur travail augmenterait consid√©rablement. </p><br><h1 id="podklyuchaem-bluetooth-hc-05">  Connectez Bluetooth HC-05 </h1><br><p>  Comme vous pouvez le voir sur la fiche technique, les broches principales du HC-05 ¬´nu¬ª: </p><br><ul><li>  Transmission TX (broche 1) </li><li>  R√©ception RX (broche 2) </li><li>  Alimentation 3,3 V (broche 12) 3,3 V </li><li>  Masse GND (broche 13) </li><li>  Indicateur de mode PIO8 (broche 31) </li><li>  √âtat de connexion PIO9 (broche 32), si la connexion est √©tablie, la sortie sera √©lev√©e </li><li>  PIO11 (broche 34) pour activer le mode de commande AT </li></ul><br><p>  Notre module est soud√© √† la carte de r√©partition / base, o√π il y a d√©j√† un diviseur de tension, il a donc une plage de tension de travail de 3,3 V √† 6 V. </p><br><p>  Nous connectons notre module Bluetooth: </p><br><ul><li>  Arduino (TX) - (RX) HC-05 </li><li>  Arduino (RX) - (TX) HC-05 </li><li>  Arduino (+ 5V) - (VCC) Bluetooth </li><li>  Arduino (GND) - (GND) Bluetooth </li><li>  LED, les broches KEY ne sont pas utilis√©es </li></ul><br><p>  Une fois que le module Bluetooth HC-05 est aliment√©, le voyant DEL doit clignoter, ce qui signifie que le Bluetooth fonctionne. </p><br><p>  Activez le Bluetooth sur le mobile, recherchez l'appareil portant le nom HC-05 et connectez-vous, mot de passe 1234. </p><br><p>  Pour les tests, remplissez un simple croquis en Arduino: </p><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Test Arduino + Bluetooth. http://localhost"); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { count++; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Count = "); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(count); delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); }</code> </pre> <br><p>  Sur le t√©l√©phone Android, installez le terminal Bluetooth.  Nous sommes connect√©s √† l'appareil HC-05 et nous observons sur l'√©cran du t√©l√©phone des lignes rampantes avec un compteur croissant. </p><br><p>  Pour que le module puisse recevoir des commandes AT, vous devez le mettre dans le mode appropri√© - pour cela, vous devez d√©finir la sortie KEY (PIO11) sur la valeur logique 1. Sur certaines cartes Breakout / Base Board, au lieu de la sortie KEY, il y a une sortie EN (ENABLE), qui peut ou non √™tre soud√© √† la broche sur la puce elle-m√™me.  Cela s'applique uniquement aux puces HC05.  C'est juste que ma sortie de borne EN n'est soud√©e nulle part.  Par cons√©quent, il peut √™tre soud√© avec un fil s√©par√© √† la borne KEY (PIO11) de la puce.  Ou, pendant le fonctionnement, pour mettre le HC05 en mode de commande AT, court-circuitez la sortie de la puce KEY (PIO11) sur la sortie d'alimentation Vcc pendant quelques secondes.  Pour HC06, la broche KEY n'est pas n√©cessaire. </p><br><h1 id="programmnoe-obespechenie">  Logiciels </h1><br><p>  Remarque  Avant chaque t√©l√©chargement du programme sur Arduino, assurez-vous que le module Bluetooth n'est pas connect√© √† l'Arduino.  Cela entra√Ænera des probl√®mes de remplissage d'esquisse.  D√©branchez simplement l'alimentation du module Bluetooth ou des fils reliant les broches du module Arduino et RX, TX. </p><br><p>  Au d√©but de l'esquisse, modifiez les num√©ros de moteur dans les lignes du type: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">AF_DCMotor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">motor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">‚Ä¶</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  <a href="">Esquisse pour le mode automatique avec t√©l√©chargement d'√©vitement d'obstacles ici</a> . </p><br><p>  Si vous remplacez la cha√Æne </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">debug</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><p>  sur </p><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> <span class="hljs-built_in"><span class="hljs-built_in">debug</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre> <br><p>  Cela activera le mode de d√©bogage. </p><br><p>  En mode d√©bogage, le RoboCar4W ne roulera pas vraiment ni ne roulera.  Au lieu de cela, activez le moniteur de port s√©rie et vous y verrez comment il "conduit" virtuellement.  Au lieu d'un v√©ritable entra√Ænement vers l'avant, la cha√Æne ¬´Forward¬ª sera √©crite sur le moniteur du port s√©rie, au lieu d'√™tre invers√©e avec un virage √† gauche, ¬´Turn Back L (eft)¬ª, etc.  Le capteur de distance √† ultrasons ne fait rien non plus, au lieu de cela les distances aux obstacles sont g√©n√©r√©es par programme et de mani√®re al√©atoire. </p><br><p>  Ce mode de d√©bogage est pratique si vous changez l'algorithme de mouvement et au lieu d'attraper une machine √† √©crire dans la pi√®ce, v√©rifiez tout au ralenti. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Croquis Bluetooth pour le contr√¥le manuel √† t√©l√©charger ici</a> .  L'esquisse n'a pas de mode de d√©bogage, car tout y est transparent.  Vous appuyez sur le bouton - le robot s'en va. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Programme pour Adnroid Bluetooth RC Car</a> . </p><br><p>  Eh bien, c'est tout!  Bon voyage! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/32b/8dc/98f/32b8dc98ff44592014df2bf2f736f9d5.jpg" alt="Bon voyage!"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426097/">https://habr.com/ru/post/fr426097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426087/index.html">Signature d'un PDF dans JS et collage d'une signature en C # √† l'aide de Crypto PRO</a></li>
<li><a href="../fr426089/index.html">Une startup am√©ricaine a d√©velopp√© des lunettes-AdBlock</a></li>
<li><a href="../fr426091/index.html">8 analyseurs de journaux cloud pour √©valuer l'environnement de travail</a></li>
<li><a href="../fr426093/index.html">Mon√©tisation des donn√©es des utilisateurs par rapport √† la publicit√© int√©gr√©e: avantages et inconv√©nients</a></li>
<li><a href="../fr426095/index.html">Webinaire ouvert ¬´Comment ne pas √©crire en Python¬ª</a></li>
<li><a href="../fr426099/index.html">Typegram News</a></li>
<li><a href="../fr426101/index.html">Int√©grit√© des donn√©es dans une architecture de microservices - comment la garantir sans transactions distribu√©es et connectivit√© √©troite</a></li>
<li><a href="../fr426103/index.html">Webinaire ¬´Avez-vous besoin de Kubernetes¬ª le 15 octobre √† 19h00</a></li>
<li><a href="../fr426105/index.html">Ma prise en une semaine</a></li>
<li><a href="../fr426111/index.html">Google va toujours lancer un service de recherche censur√© en Chine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>