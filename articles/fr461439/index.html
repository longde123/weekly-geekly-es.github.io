<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöø üëçüèΩ ü§µüèæ D√©marrage de la biblioth√®que de composants React et TypeScript üö¥üèø ‚ÜîÔ∏è üëò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La plupart de mon travail, j'√©cris des backends, mais l'autre jour, il y avait une t√¢che pour d√©marrer une biblioth√®que de composants sur React. Il y ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©marrage de la biblioth√®que de composants React et TypeScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461439/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/nc/57/zc/nc57zcknvdousryimpgxxqsiz1i.jpeg"></div><br><p>  La plupart de mon travail, j'√©cris des backends, mais l'autre jour, il y avait une t√¢che pour d√©marrer une biblioth√®que de composants sur React.  Il y a quelques ann√©es, alors que la version React √©tait aussi petite que mon exp√©rience en d√©veloppement frontal, j'ai d√©j√† adopt√© une approche du projectile et il s'est av√©r√© maladroitement et maladroitement.  Compte tenu de la maturit√© de l'√©cosyst√®me React actuel et de mon exp√©rience grandissante, j'ai √©t√© inspir√© cette fois pour tout faire correctement et commod√©ment.  En cons√©quence, j'avais un blanc pour la future biblioth√®que, et afin de ne rien oublier et de tout rassembler en un seul endroit, cet article de triche a √©t√© √©crit, ce qui devrait √©galement aider ceux qui ne savent pas par o√π commencer.  Voyons voir ce que j'ai fait. </p><a name="habracut"></a><br><p>  <strong><em>TL / DR: le code d'une biblioth√®que pr√™te √† d√©marrer peut √™tre consult√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a></em></strong> </p><br><p>  Le probl√®me peut √™tre abord√© de deux c√¥t√©s: </p><br><ol><li>  Trouver un kit de d√©marrage, un passe-partout ou un g√©n√©rateur cli pr√™ts √† l'emploi </li><li>  Collectionnez tout vous-m√™me </li></ol><br><p>  La premi√®re m√©thode est bonne pour un d√©marrage rapide, lorsque vous ne voulez absolument pas g√©rer la configuration et la connexion des packages n√©cessaires.  En outre, cette option convient aux d√©butants qui ne savent pas par o√π commencer et quelle devrait √™tre la diff√©rence entre la biblioth√®que et l'application r√©guli√®re. </p><br><p>  Au d√©but, je suis all√© dans le premier sens, mais j'ai ensuite d√©cid√© de mettre √† jour les d√©pendances et de fixer quelques paquets suppl√©mentaires, puis toutes sortes d'erreurs et d'incoh√©rences ont plu.  En cons√©quence, il a retrouss√© ses manches et a tout fait lui-m√™me.  Mais je mentionnerai le g√©n√©rateur de biblioth√®que. </p><br><h2 id="create-react-library">  Cr√©er une biblioth√®que React </h2><br><p>  La plupart des d√©veloppeurs qui traitent avec React ont entendu parler d'un d√©marreur d'application React pratique qui vous permet de minimiser la configuration du projet et fournit des valeurs par d√©faut raisonnables - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Create React App</a> (CRA).  En principe, il pourrait √™tre utilis√© pour la biblioth√®que ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">il y a un article sur le Habr√©</a> ).  Cependant, la structure du projet et l'approche du d√©veloppement de l'ui-kit sont l√©g√®rement diff√©rentes de la SPA habituelle.  Nous avons besoin d'un r√©pertoire s√©par√© avec les codes sources des composants (src), un bac √† sable pour leur d√©veloppement et d√©bogage (exemple), un outil de documentation et de d√©monstration ("showcase") et un r√©pertoire s√©par√© avec des fichiers pr√©par√©s pour l'exportation (dist).  De plus, les composants de biblioth√®que ne seront pas ajout√©s √† l'application SPA, mais seront export√©s via un fichier d'index.  En y r√©fl√©chissant, je suis all√© chercher et j'ai rapidement d√©couvert un package CRA similaire - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Creat React Library</a> (CRL). </p><br><p>  CRL, comme CRA, est un utilitaire CLI facile √† utiliser.  En l'utilisant, vous pouvez g√©n√©rer un projet.  Il contiendra: </p><br><ul><li>  Rollup configur√© pour cr√©er des modules cjs et es et une carte source avec prise en charge des modules css </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">babel</a> pour la transpilation dans ES5 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plaisanterie</a> pour les tests </li><li>  TypeScript (TS) comme option que nous aimerions utiliser </li></ul><br><p>  Pour g√©n√©rer le projet de biblioth√®que, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nous</a> pouvons le faire ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npx</a> nous permet de ne pas installer les packages globalement): </p><br><pre><code class="bash hljs">npx create-react-library</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Nous r√©pondons aux questions propos√©es.</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wd/ql/qq/wdqlqqfmjrgntiqz6zphcdyccdw.png" alt="Questions CLR"></p></div></div><br><p>  Et gr√¢ce √† l'utilitaire, nous obtenons un projet g√©n√©r√© et pr√™t √† travailler de la biblioth√®que de composants. </p><br><div class="spoiler">  <b class="spoiler_title">Avec une certaine structure</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vs/d4/l2/vsd4l2o2g1wn3n0folb_yr30ui8.png" alt="Arbre clr"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Et puis quelque chose s'est mal pass√© ...</b> <div class="spoiler_text"><p>  Les d√©pendances sont un peu d√©pass√©es aujourd'hui, j'ai donc d√©cid√© de toutes les mettre √† jour vers les derni√®res versions en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npm-check</a> : </p><br><pre> <code class="bash hljs">npx npm-check -u</code> </pre> <br><p>  Un autre fait triste est que l'application sandbox dans le r√©pertoire d' <code>example</code> est g√©n√©r√©e en js.  Vous devrez le r√©√©crire manuellement dans TypeScript, en ajoutant <code>tsconfig.json</code> et certaines d√©pendances (par exemple, <code>typescript</code> lui-m√™me et <code>@types</code> base). </p><br><p>  Le package <code>react-scripts-ts</code> est √©galement d√©clar√© <code>deprecated</code> et n'est plus pris en charge.  Au lieu de cela, vous devez installer <code>react-scripts</code> , car depuis un certain temps maintenant CRA (dont le package est <code>react-scripts</code> ) prend en charge TypeScript √† partir de la bo√Æte (en utilisant Babel 7). </p><br><p>  En cons√©quence, je n'ai pas r√©ussi √† tirer la <code>react-scripts</code> sur mon id√©e de la biblioth√®que.  Pour autant que je m'en souvienne, le Jest de ce package n√©cessitait l'option de compilateur <code>isolatedModules</code> , qui allait √† l'encontre de mon d√©sir de g√©n√©rer et d'exporter <code>d.ts</code> partir de la biblioth√®que (tout cela est en quelque sorte li√© aux limitations de Babel 7, qui est utilis√© par Jest et <code>react-scripts</code> pour compiler TS )  J'ai donc fait une <code>eject</code> pour les <code>react-scripts</code> de <code>react-scripts</code> , regard√© le r√©sultat et tout refait avec mes mains, dont je parlerai plus tard. </p></div></div><br><h2 id="tsdx">  tsdx </h2><br><p>  Merci √† l'utilisateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">StanEgo</a> , qui a parl√© d'une excellente alternative √† Create React Library - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tsdx</a> .  Ce cli-utilitaire est √©galement similaire √† CRA et dans une commande cr√©era la base de votre biblioth√®que avec Rollup, TS, Prettier, husky, Jest et React configur√©s.  Et React est disponible en option.  Assez simple √† faire: </p><br><pre> <code class="bash hljs">npx tsdx create mytslib</code> </pre> <br><p>  Et par cons√©quent, les nouvelles versions n√©cessaires des packages seront install√©es et tous les param√®tres d√©finis.  Obtenez un projet de type CRL.  La principale diff√©rence avec CRL est Zero-config.  Autrement dit, la configuration Rollup nous est cach√©e dans tsdx (tout comme CRA le fait). </p><br><p>  Ayant rapidement parcouru la documentation, je n'ai pas trouv√© les m√©thodes recommand√©es pour une configuration plus fine ou quelque chose comme √©jecter comme dans CRA.  Apr√®s avoir examin√© la question du projet, j'ai constat√© que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jusqu'√† pr√©sent, il n'y a pas une telle possibilit√©</a> .  Pour certains projets, cela peut √™tre critique, auquel cas vous devrez travailler un peu avec vos mains.  Si vous n'en avez pas besoin, alors tsdx est un excellent moyen de d√©marrer rapidement. </p><br><h2 id="beryom-upravlenie-v-svoi-ruki">  Prenez le contr√¥le entre nos mains </h2><br><p>  Mais que se passe-t-il si vous suivez la deuxi√®me voie et que vous collectez tout vous-m√™me?  Commen√ßons donc depuis le d√©but.  Ex√©cutez <code>npm init</code> et g√©n√©rez <code>package.json</code> pour la biblioth√®que.  Ajoutez-y quelques informations sur notre forfait.  Par exemple, nous √©crivons les versions minimales pour node et npm dans le champ <code>engines</code> .  Les fichiers collect√©s et export√©s seront plac√©s dans le r√©pertoire <code>dist</code> .  Nous l'indiquons dans le champ des <code>files</code> .  Nous cr√©ons une biblioth√®que de composants react, nous esp√©rons donc que les utilisateurs auront les packages n√©cessaires - nous <code>peerDependencies</code> versions minimales requises de <code>peerDependencies</code> <code>react-dom</code> dans le champ <code>peerDependencies</code> . </p><br><p>  Installez maintenant les packages react et react <code>react-dom</code> et les types n√©cessaires (puisque nous scierons des composants sur TypeScript) en tant que devDependencies (comme tous les packages de cet article): </p><br><pre> <code class="bash hljs">npm install --save-dev react react-dom @types/react @types/react-dom</code> </pre> <br><p>  Installez TypeScript: </p><br><pre> <code class="bash hljs">npm install --save-dev typescript</code> </pre> <br><p>  Cr√©ons des fichiers de configuration pour le code principal et les tests: <code>tsconfig.json</code> et <code>tsconfig.test.json</code> .  Notre <code>target</code> sera en <code>es5</code> , nous g√©n√©rerons <code>sourceMap</code> , etc.  Une liste compl√®te des options possibles et leur signification peut √™tre trouv√©e dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> .  N'oubliez pas d' <code>include</code> r√©pertoire source dans l' <code>include</code> , et ajoutez les <code>node_modules</code> et <code>dist</code> dans l' <code>exclude</code> .  Dans <code>package.json</code> nous indiquons dans le champ <code>typings</code> o√π trouver les types pour notre biblioth√®que - <code>dist/index</code> . </p><br><p>  Cr√©ez le r√©pertoire <code>src</code> pour les composants source de la biblioth√®que.  Ajoutez toutes sortes de petites choses, comme <code>.gitignore</code> , <code>.editorconfig</code> , un fichier avec une licence et <code>README.md</code> . </p><br><h3 id="rollup">  Rollup </h3><br><p>  Nous utiliserons Rollup pour l'assemblage, comme sugg√©r√© par CRL.  Paquets et config requis, j'ai aussi espionn√© CRL.  En g√©n√©ral, j'ai entendu l'opinion que Rollup est bon pour les biblioth√®ques et Webpack pour les applications.  Cependant, je n'ai pas configur√© Webpack (ce que CRA fait pour moi), mais Rollup est vraiment bon, simple et beau. </p><br><p>  Installer: </p><br><pre> <code class="bash hljs">npm install --save-dev rollup rollup-plugin-babel rollup-plugin-commonjs rollup-plugin-node-resolve rollup-plugin-peer-deps-external rollup-plugin-postcss rollup-plugin-typescript2 rollup-plugin-url @svgr/rollup</code> </pre> <br><p>  Dans <code>package.json</code> ajoutez les champs avec la distribution des ensembles de biblioth√®ques collect√©s, comme le recommande le <code>rollup</code> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pkg.module</a> : </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"jsnext:main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Cr√©ez le fichier de configuration rollup.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> typescript <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-typescript2'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> commonjs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-commonjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> external <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-peer-deps-external'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> postcss <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-postcss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> resolve <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-node-resolve'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-url'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> svgr <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@svgr/rollup'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pkg <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./package.json'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">input</span></span>: <span class="hljs-string"><span class="hljs-string">'src/index.tsx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.main, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'cjs'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.module, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'es'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ external(), postcss({ <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">extract</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">minimize</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourceMap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), url(), svgr(), resolve(), typescript({ <span class="hljs-attr"><span class="hljs-attr">rollupCommonJSResolveHack</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">clean</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), commonjs() ] };</code> </pre> </div></div><br><p>  La config est un fichier js, ou plut√¥t un objet export√©.  Dans le champ de <code>input</code> , sp√©cifiez le fichier dans lequel les exportations de notre biblioth√®que sont enregistr√©es.  <code>output</code> - d√©crit nos attentes sur la sortie - dans quel module compiler dans le format et o√π le mettre. </p><br><div class="spoiler">  <b class="spoiler_title">Vient ensuite le terrain avec une liste et la configuration des plugins</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-peer-deps-external</a> - vous permet d'exclure <code>peerDependencies</code> du <code>bundle</code> pour r√©duire sa taille.  Ceci est raisonnable, car <code>peerDependencies</code> est attendu de l'utilisateur de la biblioth√®que. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-postcss</a> - int√®gre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PostCss</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rollup</a> .  Ici, nous d√©sactivons les modules css, incluons css dans le package d'exportation de notre biblioth√®que, le minimisons et activons la cr√©ation de sourceMap.  Si vous n'exportez aucun css autre que celui utilis√© par les composants de la biblioth√®que, l' <code>extract</code> peut √™tre √©vit√©e - les css n√©cessaires dans les composants seront ajout√©s √† la balise head sur la page si n√©cessaire √† la fin.  Cependant, dans mon cas, il est n√©cessaire de distribuer des CSS suppl√©mentaires (grille, couleurs, etc.), et le client devra se connecter explicitement √† la biblioth√®que css-bundle. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-url</a> - vous permet d'exporter diverses ressources, telles que des images </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">svgr</a> - transforme svg en composants React </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-node-resolution</a> - d√©finit l'emplacement des modules tiers dans node_modules </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-typescript2</a> - connecte le compilateur TypeScript et offre la possibilit√© de le configurer </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-commonjs</a> - convertit les modules de d√©pendance commonjs en modules es afin qu'ils puissent √™tre inclus dans le bundle </li></ul></div></div><br><p>  Ajoutez une commande dans le champ <code>scripts</code> <code>package.json</code> √† construire ( <code>"build": "rollup -c"</code> ) et d√©marrez l'assemblage en mode veille pendant le d√©veloppement ( <code>"start": "rollup -c -w &amp;&amp; npm run prettier-watch"</code> ) . </p><br><h3 id="pervyy-komponent-i-eksportnyy-fayl">  Le premier composant et fichier d'exportation </h3><br><p>  Nous allons maintenant √©crire le composant React le plus simple pour v√©rifier le fonctionnement de notre assemblage.  Chaque composant de la biblioth√®que sera plac√© dans un r√©pertoire s√©par√© du r√©pertoire parent - <code>src/components/ExampleComponent</code> .  Ce r√©pertoire contiendra tous les fichiers associ√©s au composant - <code>tsx</code> , <code>css</code> , <code>test.tsx</code> et ainsi de suite. <br>  Cr√©ons un fichier de styles pour le composant et <code>tsx</code> fichier <code>tsx</code> du composant lui-m√™me. </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @class ExampleComponent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Props { <span class="hljs-comment"><span class="hljs-comment">/** * Simple text prop **/</span></span> text: string; } <span class="hljs-comment"><span class="hljs-comment">/** My First component */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Props</span></span></span><span class="hljs-class">&gt; </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { text } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"test"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Example Component: {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Coool!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ExampleComponent;</code> </pre> </div></div><br><p>  De plus, dans <code>src</code> vous devez cr√©er un fichier avec des types communs aux biblioth√®ques, o√π un type sera d√©clar√© pour css et svg (jet√© un ≈ìil √† CRL). </p><br><div class="spoiler">  <b class="spoiler_title">typings.d.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Default CSS definition for typescript, * will be overridden with file-specific definitions by rollup */</span></span> declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.css'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content: { [className: string]: string }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> content; } interface SvgrComponent extends React.FunctionComponent&lt;React.SVGAttributes&lt;SVGElement&gt;&gt; {} declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.svg'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgUrl: string; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgComponent: SvgrComponent; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> svgUrl; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { svgComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ReactComponent }; }</code> </pre> </div></div><br><p>  Tous les composants export√©s et css doivent √™tre sp√©cifi√©s dans le fichier d'exportation.  Nous l'avons - <code>src/index.tsx</code> .  Si certains css ne sont pas utilis√©s dans le projet et ne sont pas r√©pertori√©s comme faisant partie de ceux import√©s dans <code>src/index.tsx</code> , ils seront alors rejet√©s de l'assembly, ce qui est correct. </p><br><div class="spoiler">  <b class="spoiler_title">src / index.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent, Props } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./export.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { ExampleComponent, Props };</code> </pre> </div></div><br><p>  Vous pouvez maintenant essayer de construire la biblioth√®que - <code>npm run build</code> .  En cons√©quence, le <code>rollup</code> d√©marre et collecte notre biblioth√®que en bundles, que nous trouverons dans le r√©pertoire <code>dist</code> . </p><br><p>  Ensuite, nous ajoutons quelques outils pour am√©liorer la qualit√© de notre processus de d√©veloppement et son r√©sultat. </p><br><h3 id="zabyvaem-o-formatirovanii-koda-s-prettier">  Oublier la mise en forme du code avec Prettier </h3><br><p>  Je d√©teste dans une r√©vision de code pour souligner une mise en forme n√©gligente ou non standard pour un projet, et encore plus pour en discuter.  De telles failles devraient naturellement √™tre corrig√©es, mais les d√©veloppeurs devraient se concentrer sur ce que fait et comment le code fait, plut√¥t que sur son apparence.  Ces correctifs sont le premier candidat √† l'automatisation.  Il y a un paquet merveilleux pour cette t√¢che - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus joli</a> .  Installez-le: </p><br><pre> <code class="bash hljs">npm install --save-dev prettier</code> </pre> <br><p>  Ajoutez une configuration pour un petit raffinement des r√®gles de formatage. </p><br><div class="spoiler">  <b class="spoiler_title">.prettierrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"tabWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"singleQuote"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"jsxBracketSameLine"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arrowParens"</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"printWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bracketSpacing"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> </div></div><br><p>  Vous pouvez voir la signification des r√®gles disponibles dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> .  WebStrom apr√®s avoir cr√©√© le fichier de configuration lui-m√™me sugg√©rera une utilisation <code>prettier</code> lors du d√©marrage du formatage via l'EDI.  Pour √©viter que le formatage ne perde du temps, ajoutez les <code>/node_modules</code> et <code>/dist</code> aux exceptions √† l'aide du fichier <code>.prettierignore</code> (le format est similaire √† <code>.gitignore</code> ).  Vous pouvez maintenant ex√©cuter <code>prettier</code> en appliquant des r√®gles de mise en forme au code source: </p><br><pre> <code class="bash hljs">prettier --write <span class="hljs-string"><span class="hljs-string">"**/*"</span></span></code> </pre> <br><p>  Afin de ne pas ex√©cuter la commande explicitement √† chaque fois avec vos mains et pour √™tre s√ªr que le code des autres d√©veloppeurs de projet sera √©galement plus <code>prettier</code> , ajoutez la <code>prettier</code> ex√©cution sur le <code>precommit-hook</code> de <code>precommit-hook</code> pour les fichiers marqu√©s comme interm√©diaires (via <code>git add</code> ).  Pour une telle chose, nous avons besoin de deux outils.  Premi√®rement, il est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hasky</a> , responsable de l'ex√©cution des commandes avant de valider, de pousser, etc.  Et deuxi√®mement, il est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par √©tapes</a> , qui peut ex√©cuter diff√©rents linters sur les fichiers interm√©diaires.  Nous devons ex√©cuter une seule ligne pour livrer ces packages et ajouter des commandes de lancement √† <code>package.json</code> : </p><br><pre> <code class="bash hljs">npx mrm lint-staged</code> </pre> <br><p>  Nous ne pouvons pas attendre le formatage avant de nous engager, mais assurez-vous que le <code>prettier</code> travaille constamment sur les fichiers modifi√©s dans le processus de notre travail.  Oui, nous avons besoin d'un autre package - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">onchange</a> .  Il vous permet de surveiller les modifications apport√©es aux fichiers dans le projet et d'ex√©cuter imm√©diatement la commande n√©cessaire pour eux.  Installer: </p><br><pre> <code class="bash hljs">npm install --save-dev --save-exact onchange</code> </pre> <br><p>  Ensuite, nous ajoutons aux commandes de champ de <code>scripts</code> dans <code>package.json</code> : </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"prettier-watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange 'src/**/*' -- prettier --write {{changed}}"</span></span></code> </pre> <br><p>  Sur ce point, tous les litiges concernant la mise en forme dans le projet peuvent √™tre consid√©r√©s comme clos. </p><br><h3 id="izbegaem-oshibok-s-eslint">  √âviter les erreurs avec ESLint </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ESLint</a> est depuis longtemps devenu un standard et peut √™tre trouv√© dans presque tous les projets js et ts.  Il nous aidera aussi.  Dans la configuration ESLint, je fais confiance √† CRA, alors prenez simplement les packages n√©cessaires de CRA et branchez-les dans notre biblioth√®que.  De plus, ajoutez des configurations pour TS et <code>prettier</code> (pour √©viter les conflits entre <code>ESLint</code> et <code>prettier</code> ): </p><br><pre> <code class="bash hljs">npm install --save-dev eslint eslint-config-react-app eslint-loader eslint-plugin-flowtype eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks @typescript-eslint/eslint-plugin @typescript-eslint/parser babel-eslint eslint-config-prettier eslint-plugin-prettier</code> </pre> <br><p>  <code>ESLint</code> √† l'aide du fichier de configuration. </p><br><div class="spoiler">  <b class="spoiler_title">.eslintrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"plugin:@typescript-eslint/recommended"</span></span>, <span class="hljs-string"><span class="hljs-string">"react-app"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier/@typescript-eslint"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"@typescript-eslint"</span></span>, <span class="hljs-string"><span class="hljs-string">"react"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/no-empty-interface"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-function-return-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-member-accessibility"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span> } }</code> </pre> </div></div><br><p>  Ajoutez la commande <code>lint</code> - <code>eslint src/**/* --ext .ts,.tsx --fix</code> au champ <code>scripts</code> de <code>package.json</code> .  Vous pouvez maintenant ex√©cuter eslint via <code>npm run lint</code> . </p><br><h3 id="testiruem-s-jest">  Tester avec Jest </h3><br><p>  Pour √©crire des tests unitaires pour les composants de biblioth√®que, installez et configurez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jest</a> , une biblioth√®que de test de Facebook.  Cependant, depuis  nous compilons TS non via babel 7, mais via tsc, nous devons √©galement installer le paquet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ts-jest</a> : </p><br><pre> <code class="bash hljs">npm install --save-dev jest ts-jest @types/jest</code> </pre> <br><p>  Pour que Jest accepte correctement les importations de fichiers CSS ou autres, vous devez les remplacer par Mokami.  Cr√©ez le r√©pertoire <code>__mocks__</code> et cr√©ez-y deux fichiers. <br>  <code>styleMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = {};</code> </pre> <br><p>  <code>fileMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-string"><span class="hljs-string">'test-file-stub'</span></span>;</code> </pre> <br><p>  Cr√©ez maintenant la configuration de plaisanterie. </p><br><div class="spoiler">  <b class="spoiler_title">jest.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">preset</span></span>: <span class="hljs-string"><span class="hljs-string">'ts-jest'</span></span>, <span class="hljs-attr"><span class="hljs-attr">testEnvironment</span></span>: <span class="hljs-string"><span class="hljs-string">'node'</span></span>, <span class="hljs-attr"><span class="hljs-attr">moduleNameMapper</span></span>: { <span class="hljs-string"><span class="hljs-string">'\\.(css|less|sass|scss)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/styleMock.ts'</span></span>, <span class="hljs-string"><span class="hljs-string">'\\.(gif|ttf|eot|svg)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/fileMock.ts'</span></span> } };</code> </pre> </div></div><br><p>  Nous allons √©crire le test le plus simple pour notre <code>ExampleComponent</code> dans son r√©pertoire. </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.test.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'is truthy'</span></span>, () =&gt; { expect(ExampleComponent).toBeTruthy(); }); });</code> </pre> </div></div><br><p>  Ajoutez la commande <code>test</code> - <code>npm run lint &amp;&amp; jest</code> au champ <code>scripts</code> de <code>package.json</code> .  Pour plus de fiabilit√©, nous conduirons √©galement le linter.  Vous pouvez maintenant ex√©cuter nos tests et vous assurer qu'ils r√©ussissent - <code>npm run test</code> .  Et pour que les tests ne tombent pas dans <code>dist</code> lors de l'assemblage, ajoutez le champ d' <code>exclude</code> du plug-in de configuration Rollup au champ d' <code>exclude</code> - <code>['src/**/*.test.(tsx|ts)']</code> .  Sp√©cifiez l'ex√©cution des tests dans le <code>husky pre-commit hook</code> avant d'ex√©cuter <code>lint-staged</code> - <code>"pre-commit": "npm run test &amp;&amp; lint-staged"</code> . </p><br><h3 id="razrabatyvaem-dokumentiruem-i-lyubuemsya-komponentami-s-storybook">  Concevoir, documenter et admirer des composants avec un livre d'histoires </h3><br><p>  Chaque biblioth√®que a besoin d'une bonne documentation pour une utilisation r√©ussie et productive.  Quant √† la biblioth√®que de composants d'interface, non seulement je veux en savoir plus, mais aussi voir √† quoi ils ressemblent, et il vaut mieux les toucher et les changer.  Pour prendre en charge une telle liste de souhaits, il existe plusieurs solutions.  J'avais l'habitude d'utiliser un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Styleguidist</a> .  Ce package vous permet d'√©crire de la documentation au format markdown, ainsi que d'y ins√©rer des exemples des composants React d√©crits.  En outre, la documentation est collect√©e et √† partir de celle-ci, un catalogue de site-vitrine est obtenu, o√π vous pouvez trouver le composant, lire la documentation √† son sujet, conna√Ætre ses param√®tres et y pousser une baguette. </p><br><p>  Cependant, cette fois, j'ai d√©cid√© de regarder de plus pr√®s son concurrent - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Storybook</a> .  Aujourd'hui, il semble plus puissant avec son syst√®me de plugins.  De plus, il est en constante √©volution, poss√®de une grande communaut√© et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commencera bient√¥t</a> √©galement √† g√©n√©rer ses pages de documentation √† l'aide de fichiers de d√©marques.  Un autre avantage du Storybook est qu'il s'agit d'un bac √† sable - un environnement pour le d√©veloppement de composants isol√©s.  Cela signifie que nous n'avons pas besoin d'exemples d'applications √† part enti√®re pour le d√©veloppement de composants (comme le sugg√®re CRL).  Dans le livre d'histoires, nous √©crivons des <code>stories</code> - des fichiers ts dans lesquels nous transf√©rons nos composants avec des <code>props</code> entr√©e vers des fonctions sp√©ciales (il est pr√©f√©rable de regarder le code pour le rendre plus clair).  En cons√©quence, une application vitrine est assembl√©e √† partir de ces <code>stories</code> . </p><br><p>  Ex√©cutez le script qui initialise le livre d'histoires: </p><br><pre> <code class="bash hljs">npx -p @storybook/cli sb init</code> </pre> <br><p>  Maintenant, faites-vous des amis avec TS.  Pour ce faire, nous avons besoin de quelques packages suppl√©mentaires, et en m√™me temps, nous mettrons quelques modules compl√©mentaires utiles: </p><br><pre> <code class="bash hljs">npm install --save-dev awesome-typescript-loader @types/storybook__react @storybook/addon-info react-docgen-typescript-loader @storybook/addon-actions @storybook/addon-knobs @types/storybook__addon-info @types/storybook__addon-knobs webpack-blocks</code> </pre> <br><p>  Le script a cr√©√© un r√©pertoire avec la configuration du <code>storybook</code> - <code>.storybook</code> et un exemple de r√©pertoire que nous <code>.storybook</code> impitoyablement.  Et dans le r√©pertoire de configuration, nous changeons les extensions et la <code>config</code> en <code>ts</code> .  Nous ajoutons des addons au fichier <code>addons.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-actions/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-links/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/register'</span></span>;</code> </pre> <br><p>  Maintenant, vous devez aider le livre d'histoires √† l'aide de la configuration du <code>.storybook</code> dans le r√©pertoire <code>.storybook</code> . </p><br><div class="spoiler">  <b class="spoiler_title">webpack.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ config }</span></span></span><span class="hljs-function">) =&gt;</span></span> { config.module.rules.push({ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.(ts|tsx)$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.resolve(<span class="hljs-string"><span class="hljs-string">'awesome-typescript-loader'</span></span>) }, <span class="hljs-comment"><span class="hljs-comment">// Optional { loader: require.resolve('react-docgen-typescript-loader') } ] }); config.resolve.extensions.push('.ts', '.tsx'); return config; };</span></span></code> </pre> </div></div><br><p>  <code>config.ts</code> un peu la configuration <code>config.ts</code> , en ajoutant des d√©corateurs pour connecter des modules compl√©mentaires √† toutes nos histoires. </p><br><div class="spoiler">  <b class="spoiler_title">config.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { configure } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { addDecorator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withInfo } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-info'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withKnobs } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// automatically import all files ending in *.stories.tsx const req = require.context('../src', true, /\.stories\.tsx$/); function loadStories() { req.keys().forEach(req); } configure(loadStories, module); addDecorator(withInfo); addDecorator(withKnobs);</span></span></code> </pre> </div></div><br><p>  Nous allons √©crire notre premi√®re <code>story</code> dans le r√©pertoire des composants <code>ExampleComponent</code> </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.stories.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { storiesOf } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { text } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stories = storiesOf(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>); stories.add(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; &lt;ExampleComponent text={text('text', 'Some text')} /&gt;, { info: { inline: true }, text: ` ### Notes Simple example component ### Usage ~~~js &lt;ExampleComponent text="Some text" /&gt; ~~~ ` });</code> </pre> <br><p>  Nous avons utilis√© des addons: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">boutons</a> - permet de changer les accessoires en temps r√©el dans le composant affich√© dans le livre d'histoires.  Pour ce faire, enveloppez les accessoires dans des fonctions sp√©ciales dans les histoires </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">info</a> - vous permet d'ajouter de la documentation et une description des accessoires √† la page d'histoire </li></ul></div></div><br><p>  Notez maintenant que le script d'initialisation du livre d'histoires a ajout√© la commande storybook √† notre <code>package.json</code> .  Utilisez-le pour ex√©cuter le <code>npm run storybook</code> .  Le livre de contes sera assembl√© et ex√©cut√© √† l' <code>http://localhost:6006</code> .  N'oubliez pas d'ajouter √† l'exception pour le module <code>typescript</code> dans la configuration <code>Rollup</code> - <code>'src/**/*.stories.tsx'</code> . </p><br><h3 id="razrabatyvaem">  Nous d√©veloppons </h3><br><p>  Ainsi, apr√®s vous √™tre entour√© de nombreux outils pratiques et les avoir pr√©par√©s pour le travail, vous pouvez commencer √† d√©velopper de nouveaux composants.  Chaque composant sera plac√© dans son r√©pertoire dans <code>src/components</code> avec le nom du composant.  Il contiendra tous les fichiers qui lui sont associ√©s - css, le composant lui-m√™me dans le fichier tsx, les tests, les histoires.  Nous commen√ßons le livre d'histoires, cr√©ons des histoires pour le composant, et l√† nous √©crivons la documentation pour celui-ci.  Nous cr√©ons des tests et testons.  L'import-export du composant fini est √©crit dans <code>index.ts</code> . </p><br><p>  De plus, vous pouvez vous connecter √† <code>npm</code> et publier votre biblioth√®que en tant que nouveau package npm.  Et vous pouvez le connecter directement √† partir du r√©f√©rentiel git √† la fois du ma√Ætre et d'autres branches.  Par exemple, pour ma pi√®ce, vous pouvez faire: </p><br><pre> <code class="bash hljs">npm i -s git+https://github.com/jmorozov/react-library-example.git</code> </pre> <br><p>  Pour que dans l'application consommateur de biblioth√®que du r√©pertoire <code>node_modules</code> , il n'y ait que le contenu du r√©pertoire <code>dist</code> √† l'√©tat assembl√©, vous devez ajouter la commande <code>"prepare": "npm run build"</code> au champ <code>scripts</code> . </p><br><p>  De plus, gr√¢ce √† TS, l'auto-compl√©tion dans l'EDI fonctionnera. </p><br><h2 id="podvodim-itogi">  Pour r√©sumer </h2><br><p>  √Ä la mi-2019, vous pouvez commencer assez rapidement √† d√©velopper votre biblioth√®que de composants sur React et TypeScript, √† l'aide d'outils de d√©veloppement pratiques.  Ce r√©sultat peut √™tre obtenu √† la fois √† l'aide d'un utilitaire automatis√© et en mode manuel.  La deuxi√®me fa√ßon est pr√©f√©rable si vous avez besoin de packages actuels et de plus de contr√¥le.  L'essentiel est de savoir o√π creuser, et √† l'aide d'un exemple dans cet article, j'esp√®re que cela est devenu un peu plus facile. </p><br><p>  Vous pouvez √©galement emporter la pi√®ce r√©sultante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  Entre autres choses, je ne pr√©tends pas √™tre la v√©rit√© ultime et, en g√©n√©ral, je suis engag√© dans le front-end dans la mesure o√π.  Vous pouvez choisir d'autres packages et options de configuration et r√©ussir √† cr√©er votre biblioth√®que de composants.  Je serais heureux si vous partagez vos recettes dans les commentaires.  Bon codage! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461439/">https://habr.com/ru/post/fr461439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461425/index.html">Comment devenir chef de produit et √©voluer</a></li>
<li><a href="../fr461431/index.html">¬´Aime et n'aime pas¬ª: DNS sur HTTPS</a></li>
<li><a href="../fr461433/index.html">Utilisation d'Identity Server 4 dans Net Core 3.0</a></li>
<li><a href="../fr461435/index.html">Reconnaissance des √©motions √† l'aide d'un r√©seau neuronal convolutif</a></li>
<li><a href="../fr461437/index.html">370 ampoules</a></li>
<li><a href="../fr461441/index.html">Rapports sur l'√©tat du stockage √† l'aide de R. Calcul parall√®le, graphiques, xlsx, e-mail et tout cela</a></li>
<li><a href="../fr461443/index.html">Post-analyse: ce que l'on sait de la derni√®re attaque contre le r√©seau de serveurs de cl√©s cryptographiques SKS Keyserver</a></li>
<li><a href="../fr461447/index.html">L'√©pop√©e des administrateurs syst√®me en tant qu'esp√®ce menac√©e</a></li>
<li><a href="../fr461449/index.html">PhpStorm 2019.2: propri√©t√©s typ√©es PHP 7.4, recherche de doublons, EditorConfig, scripts de shell, etc.</a></li>
<li><a href="../fr461451/index.html">Mon deuxi√®me jour avec Haiku: ravi, mais pas encore pr√™t √† partir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>