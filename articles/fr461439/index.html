<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚿 👍🏽 🤵🏾 Démarrage de la bibliothèque de composants React et TypeScript 🚴🏿 ↔️ 👘</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La plupart de mon travail, j'écris des backends, mais l'autre jour, il y avait une tâche pour démarrer une bibliothèque de composants sur React. Il y ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Démarrage de la bibliothèque de composants React et TypeScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461439/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/nc/57/zc/nc57zcknvdousryimpgxxqsiz1i.jpeg"></div><br><p>  La plupart de mon travail, j'écris des backends, mais l'autre jour, il y avait une tâche pour démarrer une bibliothèque de composants sur React.  Il y a quelques années, alors que la version React était aussi petite que mon expérience en développement frontal, j'ai déjà adopté une approche du projectile et il s'est avéré maladroitement et maladroitement.  Compte tenu de la maturité de l'écosystème React actuel et de mon expérience grandissante, j'ai été inspiré cette fois pour tout faire correctement et commodément.  En conséquence, j'avais un blanc pour la future bibliothèque, et afin de ne rien oublier et de tout rassembler en un seul endroit, cet article de triche a été écrit, ce qui devrait également aider ceux qui ne savent pas par où commencer.  Voyons voir ce que j'ai fait. </p><a name="habracut"></a><br><p>  <strong><em>TL / DR: le code d'une bibliothèque prête à démarrer peut être consulté sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a></em></strong> </p><br><p>  Le problème peut être abordé de deux côtés: </p><br><ol><li>  Trouver un kit de démarrage, un passe-partout ou un générateur cli prêts à l'emploi </li><li>  Collectionnez tout vous-même </li></ol><br><p>  La première méthode est bonne pour un démarrage rapide, lorsque vous ne voulez absolument pas gérer la configuration et la connexion des packages nécessaires.  En outre, cette option convient aux débutants qui ne savent pas par où commencer et quelle devrait être la différence entre la bibliothèque et l'application régulière. </p><br><p>  Au début, je suis allé dans le premier sens, mais j'ai ensuite décidé de mettre à jour les dépendances et de fixer quelques paquets supplémentaires, puis toutes sortes d'erreurs et d'incohérences ont plu.  En conséquence, il a retroussé ses manches et a tout fait lui-même.  Mais je mentionnerai le générateur de bibliothèque. </p><br><h2 id="create-react-library">  Créer une bibliothèque React </h2><br><p>  La plupart des développeurs qui traitent avec React ont entendu parler d'un démarreur d'application React pratique qui vous permet de minimiser la configuration du projet et fournit des valeurs par défaut raisonnables - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Create React App</a> (CRA).  En principe, il pourrait être utilisé pour la bibliothèque ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">il y a un article sur le Habré</a> ).  Cependant, la structure du projet et l'approche du développement de l'ui-kit sont légèrement différentes de la SPA habituelle.  Nous avons besoin d'un répertoire séparé avec les codes sources des composants (src), un bac à sable pour leur développement et débogage (exemple), un outil de documentation et de démonstration ("showcase") et un répertoire séparé avec des fichiers préparés pour l'exportation (dist).  De plus, les composants de bibliothèque ne seront pas ajoutés à l'application SPA, mais seront exportés via un fichier d'index.  En y réfléchissant, je suis allé chercher et j'ai rapidement découvert un package CRA similaire - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Creat React Library</a> (CRL). </p><br><p>  CRL, comme CRA, est un utilitaire CLI facile à utiliser.  En l'utilisant, vous pouvez générer un projet.  Il contiendra: </p><br><ul><li>  Rollup configuré pour créer des modules cjs et es et une carte source avec prise en charge des modules css </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">babel</a> pour la transpilation dans ES5 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plaisanterie</a> pour les tests </li><li>  TypeScript (TS) comme option que nous aimerions utiliser </li></ul><br><p>  Pour générer le projet de bibliothèque, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nous</a> pouvons le faire ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npx</a> nous permet de ne pas installer les packages globalement): </p><br><pre><code class="bash hljs">npx create-react-library</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Nous répondons aux questions proposées.</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wd/ql/qq/wdqlqqfmjrgntiqz6zphcdyccdw.png" alt="Questions CLR"></p></div></div><br><p>  Et grâce à l'utilitaire, nous obtenons un projet généré et prêt à travailler de la bibliothèque de composants. </p><br><div class="spoiler">  <b class="spoiler_title">Avec une certaine structure</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vs/d4/l2/vsd4l2o2g1wn3n0folb_yr30ui8.png" alt="Arbre clr"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Et puis quelque chose s'est mal passé ...</b> <div class="spoiler_text"><p>  Les dépendances sont un peu dépassées aujourd'hui, j'ai donc décidé de toutes les mettre à jour vers les dernières versions en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npm-check</a> : </p><br><pre> <code class="bash hljs">npx npm-check -u</code> </pre> <br><p>  Un autre fait triste est que l'application sandbox dans le répertoire d' <code>example</code> est générée en js.  Vous devrez le réécrire manuellement dans TypeScript, en ajoutant <code>tsconfig.json</code> et certaines dépendances (par exemple, <code>typescript</code> lui-même et <code>@types</code> base). </p><br><p>  Le package <code>react-scripts-ts</code> est également déclaré <code>deprecated</code> et n'est plus pris en charge.  Au lieu de cela, vous devez installer <code>react-scripts</code> , car depuis un certain temps maintenant CRA (dont le package est <code>react-scripts</code> ) prend en charge TypeScript à partir de la boîte (en utilisant Babel 7). </p><br><p>  En conséquence, je n'ai pas réussi à tirer la <code>react-scripts</code> sur mon idée de la bibliothèque.  Pour autant que je m'en souvienne, le Jest de ce package nécessitait l'option de compilateur <code>isolatedModules</code> , qui allait à l'encontre de mon désir de générer et d'exporter <code>d.ts</code> partir de la bibliothèque (tout cela est en quelque sorte lié aux limitations de Babel 7, qui est utilisé par Jest et <code>react-scripts</code> pour compiler TS )  J'ai donc fait une <code>eject</code> pour les <code>react-scripts</code> de <code>react-scripts</code> , regardé le résultat et tout refait avec mes mains, dont je parlerai plus tard. </p></div></div><br><h2 id="tsdx">  tsdx </h2><br><p>  Merci à l'utilisateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">StanEgo</a> , qui a parlé d'une excellente alternative à Create React Library - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tsdx</a> .  Ce cli-utilitaire est également similaire à CRA et dans une commande créera la base de votre bibliothèque avec Rollup, TS, Prettier, husky, Jest et React configurés.  Et React est disponible en option.  Assez simple à faire: </p><br><pre> <code class="bash hljs">npx tsdx create mytslib</code> </pre> <br><p>  Et par conséquent, les nouvelles versions nécessaires des packages seront installées et tous les paramètres définis.  Obtenez un projet de type CRL.  La principale différence avec CRL est Zero-config.  Autrement dit, la configuration Rollup nous est cachée dans tsdx (tout comme CRA le fait). </p><br><p>  Ayant rapidement parcouru la documentation, je n'ai pas trouvé les méthodes recommandées pour une configuration plus fine ou quelque chose comme éjecter comme dans CRA.  Après avoir examiné la question du projet, j'ai constaté que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jusqu'à présent, il n'y a pas une telle possibilité</a> .  Pour certains projets, cela peut être critique, auquel cas vous devrez travailler un peu avec vos mains.  Si vous n'en avez pas besoin, alors tsdx est un excellent moyen de démarrer rapidement. </p><br><h2 id="beryom-upravlenie-v-svoi-ruki">  Prenez le contrôle entre nos mains </h2><br><p>  Mais que se passe-t-il si vous suivez la deuxième voie et que vous collectez tout vous-même?  Commençons donc depuis le début.  Exécutez <code>npm init</code> et générez <code>package.json</code> pour la bibliothèque.  Ajoutez-y quelques informations sur notre forfait.  Par exemple, nous écrivons les versions minimales pour node et npm dans le champ <code>engines</code> .  Les fichiers collectés et exportés seront placés dans le répertoire <code>dist</code> .  Nous l'indiquons dans le champ des <code>files</code> .  Nous créons une bibliothèque de composants react, nous espérons donc que les utilisateurs auront les packages nécessaires - nous <code>peerDependencies</code> versions minimales requises de <code>peerDependencies</code> <code>react-dom</code> dans le champ <code>peerDependencies</code> . </p><br><p>  Installez maintenant les packages react et react <code>react-dom</code> et les types nécessaires (puisque nous scierons des composants sur TypeScript) en tant que devDependencies (comme tous les packages de cet article): </p><br><pre> <code class="bash hljs">npm install --save-dev react react-dom @types/react @types/react-dom</code> </pre> <br><p>  Installez TypeScript: </p><br><pre> <code class="bash hljs">npm install --save-dev typescript</code> </pre> <br><p>  Créons des fichiers de configuration pour le code principal et les tests: <code>tsconfig.json</code> et <code>tsconfig.test.json</code> .  Notre <code>target</code> sera en <code>es5</code> , nous générerons <code>sourceMap</code> , etc.  Une liste complète des options possibles et leur signification peut être trouvée dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> .  N'oubliez pas d' <code>include</code> répertoire source dans l' <code>include</code> , et ajoutez les <code>node_modules</code> et <code>dist</code> dans l' <code>exclude</code> .  Dans <code>package.json</code> nous indiquons dans le champ <code>typings</code> où trouver les types pour notre bibliothèque - <code>dist/index</code> . </p><br><p>  Créez le répertoire <code>src</code> pour les composants source de la bibliothèque.  Ajoutez toutes sortes de petites choses, comme <code>.gitignore</code> , <code>.editorconfig</code> , un fichier avec une licence et <code>README.md</code> . </p><br><h3 id="rollup">  Rollup </h3><br><p>  Nous utiliserons Rollup pour l'assemblage, comme suggéré par CRL.  Paquets et config requis, j'ai aussi espionné CRL.  En général, j'ai entendu l'opinion que Rollup est bon pour les bibliothèques et Webpack pour les applications.  Cependant, je n'ai pas configuré Webpack (ce que CRA fait pour moi), mais Rollup est vraiment bon, simple et beau. </p><br><p>  Installer: </p><br><pre> <code class="bash hljs">npm install --save-dev rollup rollup-plugin-babel rollup-plugin-commonjs rollup-plugin-node-resolve rollup-plugin-peer-deps-external rollup-plugin-postcss rollup-plugin-typescript2 rollup-plugin-url @svgr/rollup</code> </pre> <br><p>  Dans <code>package.json</code> ajoutez les champs avec la distribution des ensembles de bibliothèques collectés, comme le recommande le <code>rollup</code> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pkg.module</a> : </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"jsnext:main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Créez le fichier de configuration rollup.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> typescript <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-typescript2'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> commonjs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-commonjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> external <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-peer-deps-external'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> postcss <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-postcss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> resolve <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-node-resolve'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-url'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> svgr <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@svgr/rollup'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pkg <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./package.json'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">input</span></span>: <span class="hljs-string"><span class="hljs-string">'src/index.tsx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.main, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'cjs'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.module, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'es'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ external(), postcss({ <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">extract</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">minimize</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourceMap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), url(), svgr(), resolve(), typescript({ <span class="hljs-attr"><span class="hljs-attr">rollupCommonJSResolveHack</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">clean</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), commonjs() ] };</code> </pre> </div></div><br><p>  La config est un fichier js, ou plutôt un objet exporté.  Dans le champ de <code>input</code> , spécifiez le fichier dans lequel les exportations de notre bibliothèque sont enregistrées.  <code>output</code> - décrit nos attentes sur la sortie - dans quel module compiler dans le format et où le mettre. </p><br><div class="spoiler">  <b class="spoiler_title">Vient ensuite le terrain avec une liste et la configuration des plugins</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-peer-deps-external</a> - vous permet d'exclure <code>peerDependencies</code> du <code>bundle</code> pour réduire sa taille.  Ceci est raisonnable, car <code>peerDependencies</code> est attendu de l'utilisateur de la bibliothèque. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-postcss</a> - intègre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PostCss</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rollup</a> .  Ici, nous désactivons les modules css, incluons css dans le package d'exportation de notre bibliothèque, le minimisons et activons la création de sourceMap.  Si vous n'exportez aucun css autre que celui utilisé par les composants de la bibliothèque, l' <code>extract</code> peut être évitée - les css nécessaires dans les composants seront ajoutés à la balise head sur la page si nécessaire à la fin.  Cependant, dans mon cas, il est nécessaire de distribuer des CSS supplémentaires (grille, couleurs, etc.), et le client devra se connecter explicitement à la bibliothèque css-bundle. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-url</a> - vous permet d'exporter diverses ressources, telles que des images </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">svgr</a> - transforme svg en composants React </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-node-resolution</a> - définit l'emplacement des modules tiers dans node_modules </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-typescript2</a> - connecte le compilateur TypeScript et offre la possibilité de le configurer </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rollup-plugin-commonjs</a> - convertit les modules de dépendance commonjs en modules es afin qu'ils puissent être inclus dans le bundle </li></ul></div></div><br><p>  Ajoutez une commande dans le champ <code>scripts</code> <code>package.json</code> à construire ( <code>"build": "rollup -c"</code> ) et démarrez l'assemblage en mode veille pendant le développement ( <code>"start": "rollup -c -w &amp;&amp; npm run prettier-watch"</code> ) . </p><br><h3 id="pervyy-komponent-i-eksportnyy-fayl">  Le premier composant et fichier d'exportation </h3><br><p>  Nous allons maintenant écrire le composant React le plus simple pour vérifier le fonctionnement de notre assemblage.  Chaque composant de la bibliothèque sera placé dans un répertoire séparé du répertoire parent - <code>src/components/ExampleComponent</code> .  Ce répertoire contiendra tous les fichiers associés au composant - <code>tsx</code> , <code>css</code> , <code>test.tsx</code> et ainsi de suite. <br>  Créons un fichier de styles pour le composant et <code>tsx</code> fichier <code>tsx</code> du composant lui-même. </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @class ExampleComponent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Props { <span class="hljs-comment"><span class="hljs-comment">/** * Simple text prop **/</span></span> text: string; } <span class="hljs-comment"><span class="hljs-comment">/** My First component */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Props</span></span></span><span class="hljs-class">&gt; </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { text } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"test"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Example Component: {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Coool!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ExampleComponent;</code> </pre> </div></div><br><p>  De plus, dans <code>src</code> vous devez créer un fichier avec des types communs aux bibliothèques, où un type sera déclaré pour css et svg (jeté un œil à CRL). </p><br><div class="spoiler">  <b class="spoiler_title">typings.d.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Default CSS definition for typescript, * will be overridden with file-specific definitions by rollup */</span></span> declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.css'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content: { [className: string]: string }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> content; } interface SvgrComponent extends React.FunctionComponent&lt;React.SVGAttributes&lt;SVGElement&gt;&gt; {} declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.svg'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgUrl: string; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgComponent: SvgrComponent; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> svgUrl; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { svgComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ReactComponent }; }</code> </pre> </div></div><br><p>  Tous les composants exportés et css doivent être spécifiés dans le fichier d'exportation.  Nous l'avons - <code>src/index.tsx</code> .  Si certains css ne sont pas utilisés dans le projet et ne sont pas répertoriés comme faisant partie de ceux importés dans <code>src/index.tsx</code> , ils seront alors rejetés de l'assembly, ce qui est correct. </p><br><div class="spoiler">  <b class="spoiler_title">src / index.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent, Props } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./export.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { ExampleComponent, Props };</code> </pre> </div></div><br><p>  Vous pouvez maintenant essayer de construire la bibliothèque - <code>npm run build</code> .  En conséquence, le <code>rollup</code> démarre et collecte notre bibliothèque en bundles, que nous trouverons dans le répertoire <code>dist</code> . </p><br><p>  Ensuite, nous ajoutons quelques outils pour améliorer la qualité de notre processus de développement et son résultat. </p><br><h3 id="zabyvaem-o-formatirovanii-koda-s-prettier">  Oublier la mise en forme du code avec Prettier </h3><br><p>  Je déteste dans une révision de code pour souligner une mise en forme négligente ou non standard pour un projet, et encore plus pour en discuter.  De telles failles devraient naturellement être corrigées, mais les développeurs devraient se concentrer sur ce que fait et comment le code fait, plutôt que sur son apparence.  Ces correctifs sont le premier candidat à l'automatisation.  Il y a un paquet merveilleux pour cette tâche - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus joli</a> .  Installez-le: </p><br><pre> <code class="bash hljs">npm install --save-dev prettier</code> </pre> <br><p>  Ajoutez une configuration pour un petit raffinement des règles de formatage. </p><br><div class="spoiler">  <b class="spoiler_title">.prettierrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"tabWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"singleQuote"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"jsxBracketSameLine"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arrowParens"</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"printWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bracketSpacing"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> </div></div><br><p>  Vous pouvez voir la signification des règles disponibles dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> .  WebStrom après avoir créé le fichier de configuration lui-même suggérera une utilisation <code>prettier</code> lors du démarrage du formatage via l'EDI.  Pour éviter que le formatage ne perde du temps, ajoutez les <code>/node_modules</code> et <code>/dist</code> aux exceptions à l'aide du fichier <code>.prettierignore</code> (le format est similaire à <code>.gitignore</code> ).  Vous pouvez maintenant exécuter <code>prettier</code> en appliquant des règles de mise en forme au code source: </p><br><pre> <code class="bash hljs">prettier --write <span class="hljs-string"><span class="hljs-string">"**/*"</span></span></code> </pre> <br><p>  Afin de ne pas exécuter la commande explicitement à chaque fois avec vos mains et pour être sûr que le code des autres développeurs de projet sera également plus <code>prettier</code> , ajoutez la <code>prettier</code> exécution sur le <code>precommit-hook</code> de <code>precommit-hook</code> pour les fichiers marqués comme intermédiaires (via <code>git add</code> ).  Pour une telle chose, nous avons besoin de deux outils.  Premièrement, il est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hasky</a> , responsable de l'exécution des commandes avant de valider, de pousser, etc.  Et deuxièmement, il est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par étapes</a> , qui peut exécuter différents linters sur les fichiers intermédiaires.  Nous devons exécuter une seule ligne pour livrer ces packages et ajouter des commandes de lancement à <code>package.json</code> : </p><br><pre> <code class="bash hljs">npx mrm lint-staged</code> </pre> <br><p>  Nous ne pouvons pas attendre le formatage avant de nous engager, mais assurez-vous que le <code>prettier</code> travaille constamment sur les fichiers modifiés dans le processus de notre travail.  Oui, nous avons besoin d'un autre package - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">onchange</a> .  Il vous permet de surveiller les modifications apportées aux fichiers dans le projet et d'exécuter immédiatement la commande nécessaire pour eux.  Installer: </p><br><pre> <code class="bash hljs">npm install --save-dev --save-exact onchange</code> </pre> <br><p>  Ensuite, nous ajoutons aux commandes de champ de <code>scripts</code> dans <code>package.json</code> : </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"prettier-watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange 'src/**/*' -- prettier --write {{changed}}"</span></span></code> </pre> <br><p>  Sur ce point, tous les litiges concernant la mise en forme dans le projet peuvent être considérés comme clos. </p><br><h3 id="izbegaem-oshibok-s-eslint">  Éviter les erreurs avec ESLint </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ESLint</a> est depuis longtemps devenu un standard et peut être trouvé dans presque tous les projets js et ts.  Il nous aidera aussi.  Dans la configuration ESLint, je fais confiance à CRA, alors prenez simplement les packages nécessaires de CRA et branchez-les dans notre bibliothèque.  De plus, ajoutez des configurations pour TS et <code>prettier</code> (pour éviter les conflits entre <code>ESLint</code> et <code>prettier</code> ): </p><br><pre> <code class="bash hljs">npm install --save-dev eslint eslint-config-react-app eslint-loader eslint-plugin-flowtype eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks @typescript-eslint/eslint-plugin @typescript-eslint/parser babel-eslint eslint-config-prettier eslint-plugin-prettier</code> </pre> <br><p>  <code>ESLint</code> à l'aide du fichier de configuration. </p><br><div class="spoiler">  <b class="spoiler_title">.eslintrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"plugin:@typescript-eslint/recommended"</span></span>, <span class="hljs-string"><span class="hljs-string">"react-app"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier/@typescript-eslint"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"@typescript-eslint"</span></span>, <span class="hljs-string"><span class="hljs-string">"react"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/no-empty-interface"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-function-return-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-member-accessibility"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span> } }</code> </pre> </div></div><br><p>  Ajoutez la commande <code>lint</code> - <code>eslint src/**/* --ext .ts,.tsx --fix</code> au champ <code>scripts</code> de <code>package.json</code> .  Vous pouvez maintenant exécuter eslint via <code>npm run lint</code> . </p><br><h3 id="testiruem-s-jest">  Tester avec Jest </h3><br><p>  Pour écrire des tests unitaires pour les composants de bibliothèque, installez et configurez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jest</a> , une bibliothèque de test de Facebook.  Cependant, depuis  nous compilons TS non via babel 7, mais via tsc, nous devons également installer le paquet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ts-jest</a> : </p><br><pre> <code class="bash hljs">npm install --save-dev jest ts-jest @types/jest</code> </pre> <br><p>  Pour que Jest accepte correctement les importations de fichiers CSS ou autres, vous devez les remplacer par Mokami.  Créez le répertoire <code>__mocks__</code> et créez-y deux fichiers. <br>  <code>styleMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = {};</code> </pre> <br><p>  <code>fileMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-string"><span class="hljs-string">'test-file-stub'</span></span>;</code> </pre> <br><p>  Créez maintenant la configuration de plaisanterie. </p><br><div class="spoiler">  <b class="spoiler_title">jest.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">preset</span></span>: <span class="hljs-string"><span class="hljs-string">'ts-jest'</span></span>, <span class="hljs-attr"><span class="hljs-attr">testEnvironment</span></span>: <span class="hljs-string"><span class="hljs-string">'node'</span></span>, <span class="hljs-attr"><span class="hljs-attr">moduleNameMapper</span></span>: { <span class="hljs-string"><span class="hljs-string">'\\.(css|less|sass|scss)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/styleMock.ts'</span></span>, <span class="hljs-string"><span class="hljs-string">'\\.(gif|ttf|eot|svg)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/fileMock.ts'</span></span> } };</code> </pre> </div></div><br><p>  Nous allons écrire le test le plus simple pour notre <code>ExampleComponent</code> dans son répertoire. </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.test.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'is truthy'</span></span>, () =&gt; { expect(ExampleComponent).toBeTruthy(); }); });</code> </pre> </div></div><br><p>  Ajoutez la commande <code>test</code> - <code>npm run lint &amp;&amp; jest</code> au champ <code>scripts</code> de <code>package.json</code> .  Pour plus de fiabilité, nous conduirons également le linter.  Vous pouvez maintenant exécuter nos tests et vous assurer qu'ils réussissent - <code>npm run test</code> .  Et pour que les tests ne tombent pas dans <code>dist</code> lors de l'assemblage, ajoutez le champ d' <code>exclude</code> du plug-in de configuration Rollup au champ d' <code>exclude</code> - <code>['src/**/*.test.(tsx|ts)']</code> .  Spécifiez l'exécution des tests dans le <code>husky pre-commit hook</code> avant d'exécuter <code>lint-staged</code> - <code>"pre-commit": "npm run test &amp;&amp; lint-staged"</code> . </p><br><h3 id="razrabatyvaem-dokumentiruem-i-lyubuemsya-komponentami-s-storybook">  Concevoir, documenter et admirer des composants avec un livre d'histoires </h3><br><p>  Chaque bibliothèque a besoin d'une bonne documentation pour une utilisation réussie et productive.  Quant à la bibliothèque de composants d'interface, non seulement je veux en savoir plus, mais aussi voir à quoi ils ressemblent, et il vaut mieux les toucher et les changer.  Pour prendre en charge une telle liste de souhaits, il existe plusieurs solutions.  J'avais l'habitude d'utiliser un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Styleguidist</a> .  Ce package vous permet d'écrire de la documentation au format markdown, ainsi que d'y insérer des exemples des composants React décrits.  En outre, la documentation est collectée et à partir de celle-ci, un catalogue de site-vitrine est obtenu, où vous pouvez trouver le composant, lire la documentation à son sujet, connaître ses paramètres et y pousser une baguette. </p><br><p>  Cependant, cette fois, j'ai décidé de regarder de plus près son concurrent - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Storybook</a> .  Aujourd'hui, il semble plus puissant avec son système de plugins.  De plus, il est en constante évolution, possède une grande communauté et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commencera bientôt</a> également à générer ses pages de documentation à l'aide de fichiers de démarques.  Un autre avantage du Storybook est qu'il s'agit d'un bac à sable - un environnement pour le développement de composants isolés.  Cela signifie que nous n'avons pas besoin d'exemples d'applications à part entière pour le développement de composants (comme le suggère CRL).  Dans le livre d'histoires, nous écrivons des <code>stories</code> - des fichiers ts dans lesquels nous transférons nos composants avec des <code>props</code> entrée vers des fonctions spéciales (il est préférable de regarder le code pour le rendre plus clair).  En conséquence, une application vitrine est assemblée à partir de ces <code>stories</code> . </p><br><p>  Exécutez le script qui initialise le livre d'histoires: </p><br><pre> <code class="bash hljs">npx -p @storybook/cli sb init</code> </pre> <br><p>  Maintenant, faites-vous des amis avec TS.  Pour ce faire, nous avons besoin de quelques packages supplémentaires, et en même temps, nous mettrons quelques modules complémentaires utiles: </p><br><pre> <code class="bash hljs">npm install --save-dev awesome-typescript-loader @types/storybook__react @storybook/addon-info react-docgen-typescript-loader @storybook/addon-actions @storybook/addon-knobs @types/storybook__addon-info @types/storybook__addon-knobs webpack-blocks</code> </pre> <br><p>  Le script a créé un répertoire avec la configuration du <code>storybook</code> - <code>.storybook</code> et un exemple de répertoire que nous <code>.storybook</code> impitoyablement.  Et dans le répertoire de configuration, nous changeons les extensions et la <code>config</code> en <code>ts</code> .  Nous ajoutons des addons au fichier <code>addons.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-actions/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-links/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/register'</span></span>;</code> </pre> <br><p>  Maintenant, vous devez aider le livre d'histoires à l'aide de la configuration du <code>.storybook</code> dans le répertoire <code>.storybook</code> . </p><br><div class="spoiler">  <b class="spoiler_title">webpack.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ config }</span></span></span><span class="hljs-function">) =&gt;</span></span> { config.module.rules.push({ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.(ts|tsx)$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.resolve(<span class="hljs-string"><span class="hljs-string">'awesome-typescript-loader'</span></span>) }, <span class="hljs-comment"><span class="hljs-comment">// Optional { loader: require.resolve('react-docgen-typescript-loader') } ] }); config.resolve.extensions.push('.ts', '.tsx'); return config; };</span></span></code> </pre> </div></div><br><p>  <code>config.ts</code> un peu la configuration <code>config.ts</code> , en ajoutant des décorateurs pour connecter des modules complémentaires à toutes nos histoires. </p><br><div class="spoiler">  <b class="spoiler_title">config.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { configure } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { addDecorator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withInfo } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-info'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withKnobs } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// automatically import all files ending in *.stories.tsx const req = require.context('../src', true, /\.stories\.tsx$/); function loadStories() { req.keys().forEach(req); } configure(loadStories, module); addDecorator(withInfo); addDecorator(withKnobs);</span></span></code> </pre> </div></div><br><p>  Nous allons écrire notre première <code>story</code> dans le répertoire des composants <code>ExampleComponent</code> </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.stories.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { storiesOf } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { text } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stories = storiesOf(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>); stories.add(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; &lt;ExampleComponent text={text('text', 'Some text')} /&gt;, { info: { inline: true }, text: ` ### Notes Simple example component ### Usage ~~~js &lt;ExampleComponent text="Some text" /&gt; ~~~ ` });</code> </pre> <br><p>  Nous avons utilisé des addons: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">boutons</a> - permet de changer les accessoires en temps réel dans le composant affiché dans le livre d'histoires.  Pour ce faire, enveloppez les accessoires dans des fonctions spéciales dans les histoires </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">info</a> - vous permet d'ajouter de la documentation et une description des accessoires à la page d'histoire </li></ul></div></div><br><p>  Notez maintenant que le script d'initialisation du livre d'histoires a ajouté la commande storybook à notre <code>package.json</code> .  Utilisez-le pour exécuter le <code>npm run storybook</code> .  Le livre de contes sera assemblé et exécuté à l' <code>http://localhost:6006</code> .  N'oubliez pas d'ajouter à l'exception pour le module <code>typescript</code> dans la configuration <code>Rollup</code> - <code>'src/**/*.stories.tsx'</code> . </p><br><h3 id="razrabatyvaem">  Nous développons </h3><br><p>  Ainsi, après vous être entouré de nombreux outils pratiques et les avoir préparés pour le travail, vous pouvez commencer à développer de nouveaux composants.  Chaque composant sera placé dans son répertoire dans <code>src/components</code> avec le nom du composant.  Il contiendra tous les fichiers qui lui sont associés - css, le composant lui-même dans le fichier tsx, les tests, les histoires.  Nous commençons le livre d'histoires, créons des histoires pour le composant, et là nous écrivons la documentation pour celui-ci.  Nous créons des tests et testons.  L'import-export du composant fini est écrit dans <code>index.ts</code> . </p><br><p>  De plus, vous pouvez vous connecter à <code>npm</code> et publier votre bibliothèque en tant que nouveau package npm.  Et vous pouvez le connecter directement à partir du référentiel git à la fois du maître et d'autres branches.  Par exemple, pour ma pièce, vous pouvez faire: </p><br><pre> <code class="bash hljs">npm i -s git+https://github.com/jmorozov/react-library-example.git</code> </pre> <br><p>  Pour que dans l'application consommateur de bibliothèque du répertoire <code>node_modules</code> , il n'y ait que le contenu du répertoire <code>dist</code> à l'état assemblé, vous devez ajouter la commande <code>"prepare": "npm run build"</code> au champ <code>scripts</code> . </p><br><p>  De plus, grâce à TS, l'auto-complétion dans l'EDI fonctionnera. </p><br><h2 id="podvodim-itogi">  Pour résumer </h2><br><p>  À la mi-2019, vous pouvez commencer assez rapidement à développer votre bibliothèque de composants sur React et TypeScript, à l'aide d'outils de développement pratiques.  Ce résultat peut être obtenu à la fois à l'aide d'un utilitaire automatisé et en mode manuel.  La deuxième façon est préférable si vous avez besoin de packages actuels et de plus de contrôle.  L'essentiel est de savoir où creuser, et à l'aide d'un exemple dans cet article, j'espère que cela est devenu un peu plus facile. </p><br><p>  Vous pouvez également emporter la pièce résultante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><p>  Entre autres choses, je ne prétends pas être la vérité ultime et, en général, je suis engagé dans le front-end dans la mesure où.  Vous pouvez choisir d'autres packages et options de configuration et réussir à créer votre bibliothèque de composants.  Je serais heureux si vous partagez vos recettes dans les commentaires.  Bon codage! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461439/">https://habr.com/ru/post/fr461439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461425/index.html">Comment devenir chef de produit et évoluer</a></li>
<li><a href="../fr461431/index.html">«Aime et n'aime pas»: DNS sur HTTPS</a></li>
<li><a href="../fr461433/index.html">Utilisation d'Identity Server 4 dans Net Core 3.0</a></li>
<li><a href="../fr461435/index.html">Reconnaissance des émotions à l'aide d'un réseau neuronal convolutif</a></li>
<li><a href="../fr461437/index.html">370 ampoules</a></li>
<li><a href="../fr461441/index.html">Rapports sur l'état du stockage à l'aide de R. Calcul parallèle, graphiques, xlsx, e-mail et tout cela</a></li>
<li><a href="../fr461443/index.html">Post-analyse: ce que l'on sait de la dernière attaque contre le réseau de serveurs de clés cryptographiques SKS Keyserver</a></li>
<li><a href="../fr461447/index.html">L'épopée des administrateurs système en tant qu'espèce menacée</a></li>
<li><a href="../fr461449/index.html">PhpStorm 2019.2: propriétés typées PHP 7.4, recherche de doublons, EditorConfig, scripts de shell, etc.</a></li>
<li><a href="../fr461451/index.html">Mon deuxième jour avec Haiku: ravi, mais pas encore prêt à partir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>