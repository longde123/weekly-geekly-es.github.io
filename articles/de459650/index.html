<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👉🏼 👘 ✊🏽 So verlieren Sie kein Geld in der Black Box: Abrechnungstestmethoden 🌨️ 📗 🤱🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Validierung kostenpflichtiger Dienste ist eines der wichtigsten technischen Probleme beim Testen von Badoo. Unsere Anwendung ist in 70 Zahlungsanb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So verlieren Sie kein Geld in der Black Box: Abrechnungstestmethoden</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/459650/">  Die Validierung kostenpflichtiger Dienste ist eines der wichtigsten technischen Probleme beim Testen von Badoo.  Unsere Anwendung ist in 70 Zahlungsanbieter in 250 Ländern der Welt integriert, und ein Fehler in mindestens einem von ihnen kann zu unvorhersehbaren Konsequenzen führen. <br><br>  In diesem Artikel werde ich über die Testmethoden sprechen, die wir in Badoo verwenden, und über die Grenzen der Anwendbarkeit dieser Methoden - die Testphasen, in denen sie am effektivsten sind. <br><br>  Dieser Artikel ist nützlich für Tester, Entwickler und Produktmanager, deren Projekte bereits in Zahlungsanbieter integriert sind oder deren Integrationsprozess gerade erst beginnt.  Wenn Sie bei Ihrer Arbeit vor dem Problem stehen, Testmethoden für solche Integrationen auszuwählen, sind Sie bei cat willkommen! <br><br><img src="https://habrastorage.org/webt/u0/dg/6k/u0dg6kdremnwjnqjqiabc_wq1m8.jpeg"><br><br><a name="habracut"></a><br>  <i>Mein Name ist Vladimir Solodov, ich bin Billing QA Engineer bei Badoo: Ich beschäftige mich mit der Überprüfung von Testintegrationen und der Zahlungsabwicklung.</i>  <i>Mein Kollege Viktor Koronevich half mir bei der Vorbereitung des Textes: Zusammen mit ihm haben wir auf der Heisenbug-Konferenz einen Bericht erstellt ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video</a> ).</i>  <i>In dem Artikel haben wir den Beschreibungsbereich auf alle Integrationen mit Zahlungsanbietern erweitert, die in Badoo verwendet werden, und die Praxis des Entfernens externer Abhängigkeiten detaillierter klassifiziert und beschrieben.</i> <br><br>  Am Beispiel von Geschäftsfallstudien erkläre ich Ihnen, warum Sie dem Testen kostenpflichtiger Dienste mehr Aufmerksamkeit schenken sollten und wie Sie Probleme nicht verschlimmern können, wenn sie dennoch auftreten.  Anschließend werden die technischen Probleme beim Testen der Integration und Möglichkeiten zu deren Lösung beschrieben. <br><br>  Der zweite Teil des Artikels, in dem wir mehr über die Automatisierung des Testens von kostenpflichtigen Diensten in iOS-Anwendungen sprechen, ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Lass uns gehen! <br><br><h2>  Besonderheiten des Abrechnungstests </h2><br>  In der Regel besteht das Ziel eines Unternehmens darin, Umsatz zu generieren.  In Badoo, einem sozialen Netzwerk für Dating, wird das Einkommen durch Kredite und Prämienabonnements verdient.  Kredite sind die interne Währung von Badoo.  Mit ihrer Hilfe können Sie beispielsweise Ihr Profil in den Suchergebnissen an erster Stelle erhöhen, einem anderen Benutzer ein Geschenk machen und vieles mehr.  Das Premium-Abonnement ist für einen bestimmten Zeitraum gültig und bietet Ihnen mehrere Optionen gleichzeitig: Aktivieren Sie den "unsichtbaren" Modus, sehen Sie Personen, die Interesse an Ihnen gezeigt haben, bestätigen Sie die Authentizität Ihres Kontos und vieles mehr. <br><br>  Damit diese kostenpflichtigen Dienste funktionieren, verwenden wir Integrationen mit mehr als 70 Zahlungsanbietern.  Die Wahl des Anbieters hängt von der Plattform, dem Land, dem Gerät, dem Mobilfunkbetreiber und anderen Faktoren ab.  Daher ist das Problem des Testens kostenpflichtiger Dienste sehr dringend. <br><br>  Überlegen Sie zunächst, warum das Testen kostenpflichtiger Dienste mit besonderer Aufmerksamkeit angegangen werden sollte.  Es gibt zwei Gründe. <br><br><h4>  1. Abrechnungsfehler sind für das Geschäft von entscheidender Bedeutung. </h4><br>  Das erste Problem ist der Ruf.  Der Benutzer, der für den Dienst bezahlt hat, wird empfindlicher (und weniger tolerant) gegenüber Fehlern in der Anwendung.  Jedes Feedback im öffentlichen Raum, sei es eine Überprüfung einer Blog-Anwendung oder ein Kommentar im App Store oder bei Google Play, von einem Benutzer, der auf einen Fehler in einem kostenpflichtigen Dienst stößt, ist emotionaler - dies ist ein Faktor, der zu Reputationsverlusten führt. <br><br>  Das zweite Problem besteht darin, dass Sie, sobald Sie von einem Benutzer Geld für einen Dienst erhalten, Gegenstand eines Gesetzes werden, das den Verbraucher des Dienstes schützt.  Und Reputationsverluste können leicht zu finanziellen werden. <br><br>  Unternehmen verlieren auf drei Arten Geld. <br><br>  Der erste Weg sind <b>Rückerstattungen</b> .  Angenommen, ein Benutzer stellt fest, dass Sie ihm einen Dienst verkauft haben, der seinen Erwartungen nicht ganz entspricht.  In diesem Fall wird er Ihr Support-Team kontaktieren.  Die Mitarbeiter führen eine Untersuchung durch und stellen fest, dass die Erwartungen des Benutzers aufgrund eines Fehlers in der Anwendung tatsächlich nicht erfüllt wurden.  Sie veranlassen eine Rückerstattung.  In diesem Fall gibt es eine Rückerstattung: Infolgedessen ist das Unternehmen mit entgangenen Gewinnen konfrontiert, und dies ist der harmloseste Weg, um Geld zu verlieren. <br><br>  Der zweite Weg sind <b>Rückbuchungen</b> .  Angenommen, die gleiche Situation ist aufgetreten, nur der Benutzer hat sich nicht an Ihren Support-Service gewandt, sondern an die Bank, die ihm die Karte ausgestellt hat, oder an den Zahlungsanbieter.  Bank / Anbieter veranlasst eine Rückerstattung.  In diesem Fall handelt es sich um eine Rückbuchung.  Die Gefahr für das Geschäft besteht hier nicht nur in entgangenen Gewinnen.  Nach einer bestimmten Anzahl von Rückbuchungen erhält das Unternehmen eine Geldstrafe und seine Risikobewertung nimmt ab.  Die Herabstufung führt wiederum zu einem Anstieg der Kosten für die Dienstleistungen von Zahlungsanbietern. <br><br>  Der dritte Weg - <b>Klagen (Ansprüche)</b> .  In den am meisten vernachlässigten Fällen können Klagen (einschließlich kollektiver) stattfinden, die zu den schwerwiegendsten Konsequenzen führen.  Nach einer Klage der Regulierungsbehörde von Ofgem war British Gas 2015 gezwungen, Nutzern, die aufgrund eines Fehlers im Ladesystem eine höhere Gebühr erhoben, eine Entschädigung in Höhe von mehreren Millionen Dollar zu zahlen.  Lesen Sie hier mehr darüber. <br><br><h4>  2. Zum Testen von Integrationen werden Wissen und Know-how benötigt. </h4><br>  Teams, die gerade erst mit der Integration mit Zahlungsanbietern beginnen, sind häufig mit diesem Problem konfrontiert.  Da sie nicht alle möglichen Abrechnungsfälle kennen, übersehen sie wichtige Nuancen, wenn sie die Reaktion des Systems auf Benachrichtigungen von Zahlungsanbietern erkennen. <br><br>  Dies kann zu unvorhersehbaren Konsequenzen führen - von entgangenen Gewinnen bis zu unzufriedenen Benutzern. <br><br>  Schauen wir uns das Schema an, in dem die Arten der kostenpflichtigen Dienste aufgeführt sind, und betrachten wir das Problem genauer. <br><br><img src="https://habrastorage.org/webt/k0/qu/he/k0quhers6cgrorlijjpdjb8pex4.jpeg"><br>  <i><font color="gray">Abbildung 1. Mögliche Abrechnungsfälle</font></i> <br><br>  Es gibt drei Hauptfälle: einen Fehler, eine erfolgreiche Zahlung und eine Rückerstattung an den Benutzer.  Aber jeder Fall hat Details, jeder Fall muss Ihr System anders behandeln. <br><br>  <b>Fehler</b> können kritisch und unkritisch sein.  Ein Benachrichtigungsfehler kann auf eine nicht kritische Blockierung der Zahlungsmethode des Benutzers zurückgeführt werden, wenn der Zahlungsanbieter über den Mangel an Guthaben auf dem Benutzerkonto informiert und kritisch.  Und wenn Sie im ersten Fall versuchen können, später zu zahlen, dann im zweiten Fall - es wäre schön herauszufinden, warum die Methode blockiert ist.  Möglicherweise wurde der Benutzer bei Betrug bemerkt und Sie sollten bei seinen Transaktionen vorsichtiger sein. <br><br>  <b>Rückerstattungen</b> .  Sie wissen bereits, dass es zwei Arten von Rückgaben gibt: Rückerstattungen und Rückbuchungen.  Ihr System muss anders darauf reagieren.  Beispielsweise ist es nach einer Rückbuchung sinnvoll, einige Funktionen Ihrer Anwendung für den Benutzer zu blockieren, da die Rückbuchung eine der beliebtesten Betrugsmethoden ist. <br><br>  <b>Eine erfolgreiche Zahlung</b> kann eine einmalige <b>Zahlung</b> oder ein Abonnement sein. <br><br>  Einmalige Zahlungen können verbrauchbar und nicht verbrauchbar sein.  Ein Beispiel für eine ausgegebene Zahlung haben wir ganz am Anfang des Artikels untersucht - dies sind Kredite in Badoo.  Ein Beispiel für eine nicht entbehrliche Zahlung kann aus Spielen gegeben werden.  Angenommen, Sie haben einen Charakter, den Sie spielen.  Sie wollen für ihn Superkräfte kaufen, die es schon seit einiger Zeit gibt.  In diesem Fall gehört der Kauf zur Klasse der nicht verbrauchbaren Zahlungen. <br><br>  <b>Abonnements</b>  Hier ist die größte Vielfalt von Fällen.  Zusätzlich zum erstmaligen Kauf eines Abonnements haben Sie möglicherweise: <br><br><ul><li>  Verlängerung eines Abonnements (Verlängerung); <br></li><li>  Abonnement schließen (Abonnement kündigen); <br></li><li>  Testabonnement (Testversion); <br></li><li>  Nachfrist-Abonnement: Wenn wir das Abonnement nicht verlängern können und erneut versuchen, für einen als Nachfrist bezeichneten Zeitraum erneut zu zahlen.  Für den Benutzer sieht die Nachfrist so aus.  Angenommen, Sie haben ein monatliches Zeitungsabonnement gekauft.  Das Unternehmen, das Ihnen Zeitungen sendet, versucht, die Zahlung für den nächsten Abonnementmonat nach dem Ende des ersten Monats abzuschreiben, kann dies jedoch nicht tun (aufgrund einer Kartensperre, fehlender Mittel auf dem Konto usw.).  Wenn die Gültigkeitsdauer der Nachfrist zehn Tage beträgt, versucht das Unternehmen während dieser Zeit, die Zahlung abzuschreiben, während das Abonnement gültig bleibt.  Wenn das Unternehmen das Geld nicht abschreiben kann, wird das Abonnement gekündigt.  Wenn dies der Fall ist, wird das Abonnement ab dem Datum der letzten Zahlung verlängert. <br></li><li>  Teilzahlung (Teilabrechnung).  Mit PayPal können Sie beispielsweise Teilzahlungen vornehmen, wenn das Konto des Benutzers nicht über genügend Guthaben verfügt (Teilzahlung), oder die Zahlung in Teile aufteilen (Teilrechnung). <br></li></ul><br>  Sie müssen außerdem zwei Merkmale berücksichtigen, die vollständig vom Zahlungsanbieter abhängen: Das Abonnement kann von Ihrer Anwendung gesteuert oder extern verwaltet werden. <br><br><ul><li>  Ein intern verwaltetes Abonnement ist beispielsweise ein Abonnement mit Kreditkarten oder PayPal, wenn Sie nach der ersten Zahlung einen Token erhalten, mit dem Sie sich erneut beim Anbieter bewerben, ohne die Zahlungsdetails des Benutzers zu haben. <br></li><li>  Bei einem extern verwalteten Abonnement übernimmt der Zahlungsaggregator die vollständige Kontrolle über Ihre Abonnements und sendet Ihnen einfach Benachrichtigungen über deren aktuellen Status. <br></li></ul><br>  In der Abbildung sind die offensichtlichsten Bereiche, auf die normalerweise zuerst reagiert wird, violett hervorgehoben.  Alle anderen werden erst viel später als Anhäufung von Fachwissen berücksichtigt.  Dies wird weitgehend durch die fehlerhafte Anwendung iterativer Entwicklungsmethoden im Bereich der Abrechnung erleichtert. <br><br><img src="https://habrastorage.org/webt/7x/kf/bj/7xkfbjf-z3shfhzuftrl3p0tms4.jpeg"><br>  <i><font color="gray">Abbildung 2. Abrechnungsfälle, die hauptsächlich in Systemen implementiert sind</font></i> <br><br>  Eine solche schrittweise Implementierung kann zu unvorhersehbaren Konsequenzen führen.  In einem der Projekte, an denen ich vor Badoo gearbeitet habe, wurde beispielsweise die Möglichkeit einer Rückerstattung nicht berücksichtigt.  Infolgedessen wurden alle Rückgaben nicht durch Rückerstattungen, sondern durch Rückbuchungen erzielt, was sich negativ auf die Risikobewertung des Unternehmens auswirkte und zu Fehlern bei der Erfassung der Einkommensstatistik führte.  Das Ignorieren der Vielzahl von Abrechnungsfällen kann zu entgangenen Gewinnen oder zur Anfälligkeit des Unternehmens für Benutzer führen, die sich betrogen fühlen. <br><br>  Einerseits sollten Fehler in der Zahlungsabwicklung vor der Veröffentlichung gefunden werden, da sie zu den negativsten Konsequenzen führen können.  Wenn dies nicht möglich war, ist es wichtig, schnell zu erkennen, dass der Fehler in die Release-Version der Anwendung gelangt ist, ihn zu beheben und vor allem, was viele Leute vergessen, Benutzer, die auf diesen Fehler stoßen, zu „beruhigen“. <br><br>  Andererseits wird die Situation durch die Tatsache kompliziert, dass die Integration mit Zahlungsanbietern immer eine Interaktion mit der Black Box ist, die dem Testprozess viele Variablen hinzufügt. <br><br><h2>  Technische Probleme beim Abrechnungstest </h2><br>  Betrachten wir sie am Beispiel der Badoo-Integration in den App Store. <br><br>  Abonnements im App Store gehören zur Klasse der extern verwalteten, dh sie werden vollständig vom Anbieter verwaltet, und unser System kann nur den aktuellen Status anfordern oder eine Benachrichtigung über seine Änderung erhalten. <br><br>  Wir haben uns speziell für diese Integration entschieden, da sie die komplexeste ist und die unterschiedlichsten Fälle enthält, die bei der Integration des Dienstes in andere Zahlungsanbieter auftreten können. <br><br>  Zunächst wenden wir uns einem einmaligen Verbrauchskauf zu. <br><br><img src="https://habrastorage.org/webt/ob/xi/rd/obxirdlzjhofj6uvioqwixp-r2k.png"><br>  <i><font color="gray">Abbildung 3. Der Vorgang der Ausführung einer einmaligen Verbrauchszahlung</font></i> <br><br>  In Schritt 1 fordert der Benutzer den Kauf des Dienstes an.  Der Antrag entscheidet, dass die Zahlung erfolgen soll, und in Schritt 2 wird die Kontrolle an den Zahlungsanbieter (App Store) übertragen.  Schritt 3: Dem Benutzer wird ein Formular zur Zahlung angezeigt.  Schritt 4: Der Benutzer stellt Daten zur Zahlung bereit.  Schritt 5: Der Anbieter schließt die Transaktion ab und meldet das Ergebnis an die Anwendung. Er sendet eine Quittung mit vollständigen Informationen zum Kauf (Datum, Service, Status usw.) zurück.  Schritt 6: Der mit Benutzerdaten ergänzte Scheck wird zur Verarbeitung an den Server gesendet.  Der Server verarbeitet die Prüfdaten und generiert im siebten Schritt eine Push-Benachrichtigung für die Anwendung.  Im achten Schritt wird dem Benutzer die Benachrichtigung angezeigt. <br><br>  Das Problem ist, dass die Schritte 3, 4 und 5 auf der Seite des Zahlungsanbieters ausgeführt werden, praktisch nicht von uns kontrolliert werden und verschiedene Variationen aufweisen können.  Somit hat der Prozess tatsächlich keine lineare Struktur, wie in Abbildung 2 gezeigt, sondern eine verzweigte (siehe Abbildung 4), und jede Verzweigung muss von der Anwendung anders behandelt werden. <br><br><img src="https://habrastorage.org/webt/8h/ur/mv/8hurmv5_d6mact7vy90jcdb9s_i.png"><br>  <i><font color="gray">Abbildung 4. Verzweigen eines Diagramms für den einmaligen Zahlungsstatus</font></i> <br><br>  Der Kauf von Abonnements beginnt auf die gleiche Weise wie eine einmalige Zahlung, aber eine weitere Kontrolle des Prozesses ist ziemlich schwierig zu kontrollieren. <br><br><img src="https://habrastorage.org/webt/lj/di/eb/ljdiebqce8tfo236xv8gir0jaa4.png"><br>  <i><font color="gray">Abbildung 5. Extern verwaltete Abonnementstatus</font></i> <br><br>  Ich möchte Sie daran erinnern, dass das Apple-Abonnement, das wir als Beispiel betrachten, extern verwaltet wird.  Dies bedeutet, dass der Benutzer es nach dem Kauf asynchron verwalten kann: Schließen, Ablaufdatum ändern, Rückerstattung beantragen.  Wir sehen dies in Schritt 9. Da die Aktion außerhalb unseres Systems stattfindet, habe ich sie in der Abbildung mit einer gepunkteten Linie markiert. <br><br>  In Schritt 10 kann der App Store den Abonnementstatus ändern: Erneuern, Schließen, Geben Sie die Kulanzfrist in das Fenster ein. <br><br>  Damit wir herausfinden können, in welchem ​​Status sich das Abonnement befindet, gibt es Schritt 11, der für Aggregatoren wie den App Store und Google Wallet spezifisch ist.  In diesem Schritt sendet das System ein Token, das als Quittung verwendet wird, die zu Beginn beim Kauf eines Abonnements oder nach seiner vorherigen Verlängerung eingeht. <br><br>  Schritt 12 ist die Antwort des Anbieters.  Wir erhalten einen Scheck mit dem aktuellen Status des Abonnements.  Das Ergebnis in diesem Schritt hängt von den asynchronen Schritten 9 und 10 ab. <br><br>  Im Herbst 2018 hat Apple for all einen Mechanismus für <b>Server-zu-Server-Benachrichtigungen</b> implementiert, mit dem Sie über Änderungen benachrichtigen können, die bei einem Abonnement aufgetreten sind.  Der Empfang einer solchen Benachrichtigung wird in Schritt 13 gezeigt. Für die meisten anderen Anbieter ist der Server-zu-Server-Benachrichtigungsmechanismus der einzige, sodass argumentiert werden kann, dass das Apple-Beispiel die gesamte Vielfalt der Fälle abdeckt.  Bei anderen Anbietern können Sie in Schritt 13 die Schritte 11 und 12 vom Schema ausschließen. <br><br>  In Schritt 14 generiert der Server eine Antwort für die Anwendung, um den Status des Abonnements zu ändern. <br><br>  So haben wir ein vollständiges Diagramm der Zustände erhalten, die übergeben werden müssen, um bezahlte Dienste zu überprüfen. <br><br><img src="https://habrastorage.org/webt/tg/he/vx/tghevxtlppxvc9xuqt4wczbav0s.png"><br>  <i><font color="gray">Abbildung 6. Der vollständige Prozess zum Ändern des Zahlungsstatus (am Beispiel eines extern verwalteten Abonnements)</font></i> <br><br>  Die Teile, die wir in unserem System nicht steuern, sind orange gefärbt und für uns schwarze Kästchen. <br><br><h2>  Abrechnungsprüfverfahren </h2><br>  Das technische Hauptproblem beim Testen von kostenpflichtigen Diensten ist das Vorhandensein von „Black Boxes“, über deren Status wir nur sehr wenig Kontrolle haben.  Dies definiert eine Reihe von Methoden, die die gesamte Vielfalt der Fälle abdecken können. <br><br>  Es gibt nicht viele dieser Methoden, und wir haben sie in drei Kategorien unterteilt: reale Zahlungen, Sandboxen und Beseitigung externer Abhängigkeiten von den "Black Boxes". <br><br><h3>  Echte Zahlungen </h3><br>  Reale Zahlungen als Testmethode sind insofern gut, als sie eine klare Vorstellung vom Integrationszustand vermitteln.  Ein Fehler bei der tatsächlichen Zahlung ist ein bedingungsloser Beweis für einen Fehler. <br><br>  Ansonsten sind echte Zahlungen schlecht.  Erstens ist es teuer: Es ist offensichtlich, dass Sie echtes Geld ausgeben müssen, um eine echte Zahlung zu leisten.  Sie irren sich, wenn Sie der Meinung sind, dass am Ende der gesamte Betrag an das Unternehmen zurückgegeben wird: Erstens erheben die Anbieter für jede Transaktion eine Gebühr, deren Größe, wie oben beschrieben, von der Risikobewertung der Organisation abhängt und 40% (und sogar mehr) erreichen kann. ;;  Zweitens können Sie beim Testen von Zahlungen in anderen Ländern aufgrund der Währungsspanne Geld verlieren - der Differenz zwischen den Kauf- und Verkaufskursen der Währung (Sie tätigen den Kauf zum Fremdwährungskurs der Bank, und die Rendite erfolgt zum Kaufkurs). <br><br>  Darüber hinaus kann diese Methode sehr lange dauern, da Sie auf das Ende der Verlängerungsfrist für das Abonnement und den Ablauf der Nachfrist warten müssen. Dies können Monate sein. <br><br><h3>  Sandkästen </h3><br>  Sandkästen sind wunderschön.  Dies ist in der Tat die gleiche Funktionalität, die uns ein Zahlungsanbieter im Falle einer echten Zahlung bietet, ohne jedoch echtes Geld auszugeben.  Es wird vom Anbieter vollständig unterstützt, was bedeutet, dass die Integration in die Sandbox kostengünstig ist. <br><br>  Das Problem der Dauer des Testens im Laufe der Zeit wird in der Regel mit verschiedenen Tricks gelöst.  Beispielsweise verwendet die App Store-Sandbox die folgende Konvertierung zum Ablauf des Abonnements. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Echtzeit-Abonnement <br></td><td>  Apple Sandbox-Abonnementzeit <br></td></tr><tr><td>  1 Woche <br></td><td>  3 Minuten <br></td></tr><tr><td>  1 Monat <br></td><td>  5 Minuten <br></td></tr><tr><td>  2 Monate <br></td><td>  10 Minuten <br></td></tr><tr><td>  3 Monate <br></td><td>  15 Minuten <br></td></tr><tr><td>  6 Monate <br></td><td>  30 Minuten <br></td></tr><tr><td>  1 Jahr <br></td><td>  1 Stunde <br></td></tr></tbody></table></div>  <i><font color="gray">Tabelle 1. Das Verhältnis der Gültigkeitsdauer eines echten Abonnements und eines Abonnements in der Sandbox von Apple</font></i> <br><br>  Die Standardabonnements für die Google Wallet-Sandbox sind in Tabelle 2 aufgeführt und können in der Verkäuferkonsole konfiguriert werden. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Echtzeit-Abonnement <br></td><td>  Abonnementzeit für Google Sandbox <br></td></tr><tr><td>  1 Woche <br></td><td>  5 Minuten <br></td></tr><tr><td>  1 Monat <br></td><td>  5 Minuten <br></td></tr><tr><td>  3 Monate <br></td><td>  10 Minuten <br></td></tr><tr><td>  6 Monate <br></td><td>  15 Minuten <br></td></tr><tr><td>  1 Jahr <br></td><td>  30 Minuten <br></td></tr></tbody></table></div>  <i><font color="gray">Tabelle 2. Festlegen der Dauer eines Abonnements in der Google Sandbox</font></i> <br><br>  Im Gegensatz zur Apple-Sandbox können Sie auch die Testversion, die Kulanzfrist usw. in der Google-Sandbox anhand des Verhältnisses aus Tabelle 3 überprüfen. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Echtzeit-Abonnement <br></td><td>  Abonnementzeit für Google Sandbox <br></td></tr><tr><td>  Probezeit <br></td><td>  3 Minuten <br></td></tr><tr><td>  Probezeit (Einführung) <br></td><td>  Entspricht dem Zeitpunkt des entsprechenden Abonnements <br></td></tr><tr><td>  Nachfrist (3/7 Tage) <br></td><td>  5 Minuten <br></td></tr><tr><td>  Vorübergehende Kontosperrung (halten) <br></td><td>  10 Minuten <br></td></tr><tr><td>  Pause (1/2/3 Monate) <br></td><td>  5/10/15 Minuten (jeweils) <br></td></tr></tbody></table></div>  <i><font color="gray">Tabelle 3. Gültigkeit zusätzlicher Abonnementfunktionen in der Google Sandbox</font></i> <br><br>  Das Schließen eines Abonnements kann auch auf verschiedene Arten implementiert werden: In der Sandbox des App Store erfolgt das Schließen nach der fünften Verlängerung und in Google Wallet über die Konsole des Verkäufers oder auf dem Gerät aus dem Play Store. <br><br>  Das Problem bei Sandboxen ist, dass Anbieter eine andere Einstellung zu ihrer Qualität haben.  Unsere Erfahrung zeigt, dass von den mehr als 70 in Badoo integrierten Zahlungsanbietern nur zwei Sandboxen über volle Funktionalität und stabilen Betrieb verfügen.  Dies sind die Sandkästen von Adyen und PayPal.  Andere Anbieter haben entweder stabile, aber hinsichtlich der Funktionalität abgeschnittene Sandboxen (wie Google Wallet) oder instabile und stark abgeschnittene Funktionen (wie App Store und Fortumo).  Und es gibt Anbieter, die keine Sandbox haben und überhaupt nicht haben werden. <br><br><img src="https://habrastorage.org/webt/iz/as/im/izasimha0d95e0w214ym9kyfhcy.png"><br>  <i><font color="gray">Abbildung 7. Klassifizierung von Sandkästen nach Stabilität und Funktionalität</font></i> <br><br><h3>  Externe Abhängigkeiten entfernen </h3><br>  Wenn wir Sie davon überzeugt haben, dass das Testen mit realen Zahlungen teuer und ineffizient ist und Zahlungsanbieter keine Sandboxen mit der richtigen Qualität bereitstellen, müssen wir uns verschiedenen Möglichkeiten zuwenden, um externe Abhängigkeiten zu beseitigen.  Es gibt nur drei davon: Moki, Fakes und Stubs. <br><br>  Moki bei der Abrechnung ist die Bildung der Reaktionen Ihres Systems auf Anfragen mit vorgegebenen Parametern ohne einen echten Anruf beim Zahlungsanbieter (siehe Abb. 8).  Beispielsweise wird eine Anforderung an einen SMS-Zahlungsanbieter unter der Nummer + 7111-111-11-11 abgefangen, wenn eine Anforderung an den Anbieter gesendet wird, und eine Systemantwort in Form einer erfolgreichen Zahlung generiert.  Die Anforderung an die Nummer + 7111-111-11-12 wird ebenfalls abgefangen, führt jedoch zu einer Reaktion auf einen Fehler mit dem Code "Es ist nicht genügend Geld vorhanden, um die Transaktion abzuschließen." <br><br><img width="340" src="https://habrastorage.org/webt/cb/zi/xy/cbzixy8v5c16-fjdnobzksxoij4.png"><br>  <i><font color="gray">Abbildung 8. Mock-Diagramm</font></i> <br><br>  Fälschungen bei der Abrechnung sind Fälschungen von Benachrichtigungen (als ob sie von einem echten Anbieter stammen) (siehe Abb. 9).  Die Integration mit jedem Anbieter impliziert eine begrenzte Anzahl von Systemreaktionen auf eine begrenzte Anzahl von Arten von Benachrichtigungen oder Zurücksetzungen.             (      ),          . <br><br><img width="340" src="https://habrastorage.org/webt/t5/nz/_h/t5nz_hwuq-49im9ow_csqennjh4.png"><br> <i><font color="gray"> 9.  </font></i> <br><br>    —               (. . 10),                        . <br><br><img width="340" src="https://habrastorage.org/webt/-z/3p/f8/-z3pf8attjz-fiitaqbanlhmbbe.png"><br> <i><font color="gray"> 10.  </font></i> <br><br>          ,      ,                     .      (, , )      .  ,      , ,             ,   . <br><br>      .  3, 4, 5    :    ,      .             -   :          ,    —   ,    —  .     «  ». <br><br><img src="https://habrastorage.org/webt/2p/cu/w-/2pcuw-rvhju4ngyzr3ez7rqlhco.png"><br> <i><font color="gray"> 11.            (     App Store)</font></i> <br><br>   ,       (,      ).   —      ,     .       . ,   ,           ,            .    ,          . ,              . <br><br><h2>     </h2><br>      .   ,          ?        : <br><br><ul><li>    —          ? <br></li><li>   end-to-end —    :             -  ? <br></li><li>  —   :     ,        . <br></li></ul><br>      . <br><br><img src="https://habrastorage.org/webt/ck/sn/re/cksnrehqrplo3q14juwsyrar31m.png"><br> <i><font color="gray"> 4.     </font></i> <br><br> <b> .</b>    .     .     ,      .   :     ,   . <br><br> <b>.</b> , ,  Apple  Google, .        (   ).      end-to-end :           .  , ,   . <br><br> <b>, , </b> —   .      .            .  :         . <br><br><h2>    </h2><br>    ,       ,     . <br><br>      ,        .         . <br><br>      :     .  ,     , —            . <br><br>         ,    :     — , , ;     —    :    . <br><br><img src="https://habrastorage.org/webt/hc/rg/ka/hcrgka-jxqtj6rftvexttwrlvqw.jpeg"><br> <i><font color="gray"> 12.        </font></i> <br><br><h2>     </h2><br>   ,  ,       ,      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> . <br><br>      ,      12,      Badoo. <br><br><h4>     </h4><br>          .       .    QA-      .   ,    . ,  -   ,              ,   .   ,         . <br><br>  :      . <br><br><h4>      </h4><br>  ,      , —     . ,    Apple      .         .   ,     .       :            -  . <br><br>   — ,   . -,       . -,    ,  -,   ,          . <br><br>      —    :                    ,   Apple   .       1  — ,         . <br><br><h4>      </h4><br>            .          ,       .        ,     -    . <br><br>          ,             (       ). <br><br><h2>  Schlussfolgerungen </h2><br><ol><li>      ,          . <br></li><li>       (     )         .           ,          . <br></li><li>     « »  ,     .     -         —     .     ,  : ,    —  ,     —     . <br></li><li>   ,     ,     , ,   ,        .          ,   . <br></li></ol><br>  ,             iOS-,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> . <br><br>   !      ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de459650/">https://habr.com/ru/post/de459650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de459638/index.html">Schaffung einer globalen Wissensbasis über Batterien</a></li>
<li><a href="../de459640/index.html">Dokumente als Code. Teil 1: Automatisieren Sie das Update</a></li>
<li><a href="../de459642/index.html">Sicherer Zugriff auf Registerfelder in C ++ ohne Einbußen bei der Effizienz (am Beispiel von CortexM)</a></li>
<li><a href="../de459644/index.html">LED-Dimmer</a></li>
<li><a href="../de459648/index.html">Im Analysator sollte alles in Ordnung sein: sowohl Funktionalität als auch Schnittstelle ... Wir untersuchen die neue Solar AppScreener 3.1-Schnittstelle</a></li>
<li><a href="../de459652/index.html">Automatisierter Regressionstestansatz</a></li>
<li><a href="../de459656/index.html">OData-Dienst ohne Code schreiben</a></li>
<li><a href="../de459658/index.html">PVS-Studio wollte, konnte aber keine Fehler in robots.txt finden</a></li>
<li><a href="../de459662/index.html">PVS-Studio wollte, konnte aber keine Fehler in robots.txt finden</a></li>
<li><a href="../de459668/index.html">Erkennen von Text auf einem Foto: Neue Funktionen des Vision-Frameworks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>