<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëâüèº üëò ‚úäüèΩ So verlieren Sie kein Geld in der Black Box: Abrechnungstestmethoden üå®Ô∏è üìó ü§±üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Validierung kostenpflichtiger Dienste ist eines der wichtigsten technischen Probleme beim Testen von Badoo. Unsere Anwendung ist in 70 Zahlungsanb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>So verlieren Sie kein Geld in der Black Box: Abrechnungstestmethoden</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/459650/">  Die Validierung kostenpflichtiger Dienste ist eines der wichtigsten technischen Probleme beim Testen von Badoo.  Unsere Anwendung ist in 70 Zahlungsanbieter in 250 L√§ndern der Welt integriert, und ein Fehler in mindestens einem von ihnen kann zu unvorhersehbaren Konsequenzen f√ºhren. <br><br>  In diesem Artikel werde ich √ºber die Testmethoden sprechen, die wir in Badoo verwenden, und √ºber die Grenzen der Anwendbarkeit dieser Methoden - die Testphasen, in denen sie am effektivsten sind. <br><br>  Dieser Artikel ist n√ºtzlich f√ºr Tester, Entwickler und Produktmanager, deren Projekte bereits in Zahlungsanbieter integriert sind oder deren Integrationsprozess gerade erst beginnt.  Wenn Sie bei Ihrer Arbeit vor dem Problem stehen, Testmethoden f√ºr solche Integrationen auszuw√§hlen, sind Sie bei cat willkommen! <br><br><img src="https://habrastorage.org/webt/u0/dg/6k/u0dg6kdremnwjnqjqiabc_wq1m8.jpeg"><br><br><a name="habracut"></a><br>  <i>Mein Name ist Vladimir Solodov, ich bin Billing QA Engineer bei Badoo: Ich besch√§ftige mich mit der √úberpr√ºfung von Testintegrationen und der Zahlungsabwicklung.</i>  <i>Mein Kollege Viktor Koronevich half mir bei der Vorbereitung des Textes: Zusammen mit ihm haben wir auf der Heisenbug-Konferenz einen Bericht erstellt ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video</a> ).</i>  <i>In dem Artikel haben wir den Beschreibungsbereich auf alle Integrationen mit Zahlungsanbietern erweitert, die in Badoo verwendet werden, und die Praxis des Entfernens externer Abh√§ngigkeiten detaillierter klassifiziert und beschrieben.</i> <br><br>  Am Beispiel von Gesch√§ftsfallstudien erkl√§re ich Ihnen, warum Sie dem Testen kostenpflichtiger Dienste mehr Aufmerksamkeit schenken sollten und wie Sie Probleme nicht verschlimmern k√∂nnen, wenn sie dennoch auftreten.  Anschlie√üend werden die technischen Probleme beim Testen der Integration und M√∂glichkeiten zu deren L√∂sung beschrieben. <br><br>  Der zweite Teil des Artikels, in dem wir mehr √ºber die Automatisierung des Testens von kostenpflichtigen Diensten in iOS-Anwendungen sprechen, ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  Lass uns gehen! <br><br><h2>  Besonderheiten des Abrechnungstests </h2><br>  In der Regel besteht das Ziel eines Unternehmens darin, Umsatz zu generieren.  In Badoo, einem sozialen Netzwerk f√ºr Dating, wird das Einkommen durch Kredite und Pr√§mienabonnements verdient.  Kredite sind die interne W√§hrung von Badoo.  Mit ihrer Hilfe k√∂nnen Sie beispielsweise Ihr Profil in den Suchergebnissen an erster Stelle erh√∂hen, einem anderen Benutzer ein Geschenk machen und vieles mehr.  Das Premium-Abonnement ist f√ºr einen bestimmten Zeitraum g√ºltig und bietet Ihnen mehrere Optionen gleichzeitig: Aktivieren Sie den "unsichtbaren" Modus, sehen Sie Personen, die Interesse an Ihnen gezeigt haben, best√§tigen Sie die Authentizit√§t Ihres Kontos und vieles mehr. <br><br>  Damit diese kostenpflichtigen Dienste funktionieren, verwenden wir Integrationen mit mehr als 70 Zahlungsanbietern.  Die Wahl des Anbieters h√§ngt von der Plattform, dem Land, dem Ger√§t, dem Mobilfunkbetreiber und anderen Faktoren ab.  Daher ist das Problem des Testens kostenpflichtiger Dienste sehr dringend. <br><br>  √úberlegen Sie zun√§chst, warum das Testen kostenpflichtiger Dienste mit besonderer Aufmerksamkeit angegangen werden sollte.  Es gibt zwei Gr√ºnde. <br><br><h4>  1. Abrechnungsfehler sind f√ºr das Gesch√§ft von entscheidender Bedeutung. </h4><br>  Das erste Problem ist der Ruf.  Der Benutzer, der f√ºr den Dienst bezahlt hat, wird empfindlicher (und weniger tolerant) gegen√ºber Fehlern in der Anwendung.  Jedes Feedback im √∂ffentlichen Raum, sei es eine √úberpr√ºfung einer Blog-Anwendung oder ein Kommentar im App Store oder bei Google Play, von einem Benutzer, der auf einen Fehler in einem kostenpflichtigen Dienst st√∂√üt, ist emotionaler - dies ist ein Faktor, der zu Reputationsverlusten f√ºhrt. <br><br>  Das zweite Problem besteht darin, dass Sie, sobald Sie von einem Benutzer Geld f√ºr einen Dienst erhalten, Gegenstand eines Gesetzes werden, das den Verbraucher des Dienstes sch√ºtzt.  Und Reputationsverluste k√∂nnen leicht zu finanziellen werden. <br><br>  Unternehmen verlieren auf drei Arten Geld. <br><br>  Der erste Weg sind <b>R√ºckerstattungen</b> .  Angenommen, ein Benutzer stellt fest, dass Sie ihm einen Dienst verkauft haben, der seinen Erwartungen nicht ganz entspricht.  In diesem Fall wird er Ihr Support-Team kontaktieren.  Die Mitarbeiter f√ºhren eine Untersuchung durch und stellen fest, dass die Erwartungen des Benutzers aufgrund eines Fehlers in der Anwendung tats√§chlich nicht erf√ºllt wurden.  Sie veranlassen eine R√ºckerstattung.  In diesem Fall gibt es eine R√ºckerstattung: Infolgedessen ist das Unternehmen mit entgangenen Gewinnen konfrontiert, und dies ist der harmloseste Weg, um Geld zu verlieren. <br><br>  Der zweite Weg sind <b>R√ºckbuchungen</b> .  Angenommen, die gleiche Situation ist aufgetreten, nur der Benutzer hat sich nicht an Ihren Support-Service gewandt, sondern an die Bank, die ihm die Karte ausgestellt hat, oder an den Zahlungsanbieter.  Bank / Anbieter veranlasst eine R√ºckerstattung.  In diesem Fall handelt es sich um eine R√ºckbuchung.  Die Gefahr f√ºr das Gesch√§ft besteht hier nicht nur in entgangenen Gewinnen.  Nach einer bestimmten Anzahl von R√ºckbuchungen erh√§lt das Unternehmen eine Geldstrafe und seine Risikobewertung nimmt ab.  Die Herabstufung f√ºhrt wiederum zu einem Anstieg der Kosten f√ºr die Dienstleistungen von Zahlungsanbietern. <br><br>  Der dritte Weg - <b>Klagen (Anspr√ºche)</b> .  In den am meisten vernachl√§ssigten F√§llen k√∂nnen Klagen (einschlie√ülich kollektiver) stattfinden, die zu den schwerwiegendsten Konsequenzen f√ºhren.  Nach einer Klage der Regulierungsbeh√∂rde von Ofgem war British Gas 2015 gezwungen, Nutzern, die aufgrund eines Fehlers im Ladesystem eine h√∂here Geb√ºhr erhoben, eine Entsch√§digung in H√∂he von mehreren Millionen Dollar zu zahlen.  Lesen Sie hier mehr dar√ºber. <br><br><h4>  2. Zum Testen von Integrationen werden Wissen und Know-how ben√∂tigt. </h4><br>  Teams, die gerade erst mit der Integration mit Zahlungsanbietern beginnen, sind h√§ufig mit diesem Problem konfrontiert.  Da sie nicht alle m√∂glichen Abrechnungsf√§lle kennen, √ºbersehen sie wichtige Nuancen, wenn sie die Reaktion des Systems auf Benachrichtigungen von Zahlungsanbietern erkennen. <br><br>  Dies kann zu unvorhersehbaren Konsequenzen f√ºhren - von entgangenen Gewinnen bis zu unzufriedenen Benutzern. <br><br>  Schauen wir uns das Schema an, in dem die Arten der kostenpflichtigen Dienste aufgef√ºhrt sind, und betrachten wir das Problem genauer. <br><br><img src="https://habrastorage.org/webt/k0/qu/he/k0quhers6cgrorlijjpdjb8pex4.jpeg"><br>  <i><font color="gray">Abbildung 1. M√∂gliche Abrechnungsf√§lle</font></i> <br><br>  Es gibt drei Hauptf√§lle: einen Fehler, eine erfolgreiche Zahlung und eine R√ºckerstattung an den Benutzer.  Aber jeder Fall hat Details, jeder Fall muss Ihr System anders behandeln. <br><br>  <b>Fehler</b> k√∂nnen kritisch und unkritisch sein.  Ein Benachrichtigungsfehler kann auf eine nicht kritische Blockierung der Zahlungsmethode des Benutzers zur√ºckgef√ºhrt werden, wenn der Zahlungsanbieter √ºber den Mangel an Guthaben auf dem Benutzerkonto informiert und kritisch.  Und wenn Sie im ersten Fall versuchen k√∂nnen, sp√§ter zu zahlen, dann im zweiten Fall - es w√§re sch√∂n herauszufinden, warum die Methode blockiert ist.  M√∂glicherweise wurde der Benutzer bei Betrug bemerkt und Sie sollten bei seinen Transaktionen vorsichtiger sein. <br><br>  <b>R√ºckerstattungen</b> .  Sie wissen bereits, dass es zwei Arten von R√ºckgaben gibt: R√ºckerstattungen und R√ºckbuchungen.  Ihr System muss anders darauf reagieren.  Beispielsweise ist es nach einer R√ºckbuchung sinnvoll, einige Funktionen Ihrer Anwendung f√ºr den Benutzer zu blockieren, da die R√ºckbuchung eine der beliebtesten Betrugsmethoden ist. <br><br>  <b>Eine erfolgreiche Zahlung</b> kann eine einmalige <b>Zahlung</b> oder ein Abonnement sein. <br><br>  Einmalige Zahlungen k√∂nnen verbrauchbar und nicht verbrauchbar sein.  Ein Beispiel f√ºr eine ausgegebene Zahlung haben wir ganz am Anfang des Artikels untersucht - dies sind Kredite in Badoo.  Ein Beispiel f√ºr eine nicht entbehrliche Zahlung kann aus Spielen gegeben werden.  Angenommen, Sie haben einen Charakter, den Sie spielen.  Sie wollen f√ºr ihn Superkr√§fte kaufen, die es schon seit einiger Zeit gibt.  In diesem Fall geh√∂rt der Kauf zur Klasse der nicht verbrauchbaren Zahlungen. <br><br>  <b>Abonnements</b>  Hier ist die gr√∂√üte Vielfalt von F√§llen.  Zus√§tzlich zum erstmaligen Kauf eines Abonnements haben Sie m√∂glicherweise: <br><br><ul><li>  Verl√§ngerung eines Abonnements (Verl√§ngerung); <br></li><li>  Abonnement schlie√üen (Abonnement k√ºndigen); <br></li><li>  Testabonnement (Testversion); <br></li><li>  Nachfrist-Abonnement: Wenn wir das Abonnement nicht verl√§ngern k√∂nnen und erneut versuchen, f√ºr einen als Nachfrist bezeichneten Zeitraum erneut zu zahlen.  F√ºr den Benutzer sieht die Nachfrist so aus.  Angenommen, Sie haben ein monatliches Zeitungsabonnement gekauft.  Das Unternehmen, das Ihnen Zeitungen sendet, versucht, die Zahlung f√ºr den n√§chsten Abonnementmonat nach dem Ende des ersten Monats abzuschreiben, kann dies jedoch nicht tun (aufgrund einer Kartensperre, fehlender Mittel auf dem Konto usw.).  Wenn die G√ºltigkeitsdauer der Nachfrist zehn Tage betr√§gt, versucht das Unternehmen w√§hrend dieser Zeit, die Zahlung abzuschreiben, w√§hrend das Abonnement g√ºltig bleibt.  Wenn das Unternehmen das Geld nicht abschreiben kann, wird das Abonnement gek√ºndigt.  Wenn dies der Fall ist, wird das Abonnement ab dem Datum der letzten Zahlung verl√§ngert. <br></li><li>  Teilzahlung (Teilabrechnung).  Mit PayPal k√∂nnen Sie beispielsweise Teilzahlungen vornehmen, wenn das Konto des Benutzers nicht √ºber gen√ºgend Guthaben verf√ºgt (Teilzahlung), oder die Zahlung in Teile aufteilen (Teilrechnung). <br></li></ul><br>  Sie m√ºssen au√üerdem zwei Merkmale ber√ºcksichtigen, die vollst√§ndig vom Zahlungsanbieter abh√§ngen: Das Abonnement kann von Ihrer Anwendung gesteuert oder extern verwaltet werden. <br><br><ul><li>  Ein intern verwaltetes Abonnement ist beispielsweise ein Abonnement mit Kreditkarten oder PayPal, wenn Sie nach der ersten Zahlung einen Token erhalten, mit dem Sie sich erneut beim Anbieter bewerben, ohne die Zahlungsdetails des Benutzers zu haben. <br></li><li>  Bei einem extern verwalteten Abonnement √ºbernimmt der Zahlungsaggregator die vollst√§ndige Kontrolle √ºber Ihre Abonnements und sendet Ihnen einfach Benachrichtigungen √ºber deren aktuellen Status. <br></li></ul><br>  In der Abbildung sind die offensichtlichsten Bereiche, auf die normalerweise zuerst reagiert wird, violett hervorgehoben.  Alle anderen werden erst viel sp√§ter als Anh√§ufung von Fachwissen ber√ºcksichtigt.  Dies wird weitgehend durch die fehlerhafte Anwendung iterativer Entwicklungsmethoden im Bereich der Abrechnung erleichtert. <br><br><img src="https://habrastorage.org/webt/7x/kf/bj/7xkfbjf-z3shfhzuftrl3p0tms4.jpeg"><br>  <i><font color="gray">Abbildung 2. Abrechnungsf√§lle, die haupts√§chlich in Systemen implementiert sind</font></i> <br><br>  Eine solche schrittweise Implementierung kann zu unvorhersehbaren Konsequenzen f√ºhren.  In einem der Projekte, an denen ich vor Badoo gearbeitet habe, wurde beispielsweise die M√∂glichkeit einer R√ºckerstattung nicht ber√ºcksichtigt.  Infolgedessen wurden alle R√ºckgaben nicht durch R√ºckerstattungen, sondern durch R√ºckbuchungen erzielt, was sich negativ auf die Risikobewertung des Unternehmens auswirkte und zu Fehlern bei der Erfassung der Einkommensstatistik f√ºhrte.  Das Ignorieren der Vielzahl von Abrechnungsf√§llen kann zu entgangenen Gewinnen oder zur Anf√§lligkeit des Unternehmens f√ºr Benutzer f√ºhren, die sich betrogen f√ºhlen. <br><br>  Einerseits sollten Fehler in der Zahlungsabwicklung vor der Ver√∂ffentlichung gefunden werden, da sie zu den negativsten Konsequenzen f√ºhren k√∂nnen.  Wenn dies nicht m√∂glich war, ist es wichtig, schnell zu erkennen, dass der Fehler in die Release-Version der Anwendung gelangt ist, ihn zu beheben und vor allem, was viele Leute vergessen, Benutzer, die auf diesen Fehler sto√üen, zu ‚Äûberuhigen‚Äú. <br><br>  Andererseits wird die Situation durch die Tatsache kompliziert, dass die Integration mit Zahlungsanbietern immer eine Interaktion mit der Black Box ist, die dem Testprozess viele Variablen hinzuf√ºgt. <br><br><h2>  Technische Probleme beim Abrechnungstest </h2><br>  Betrachten wir sie am Beispiel der Badoo-Integration in den App Store. <br><br>  Abonnements im App Store geh√∂ren zur Klasse der extern verwalteten, dh sie werden vollst√§ndig vom Anbieter verwaltet, und unser System kann nur den aktuellen Status anfordern oder eine Benachrichtigung √ºber seine √Ñnderung erhalten. <br><br>  Wir haben uns speziell f√ºr diese Integration entschieden, da sie die komplexeste ist und die unterschiedlichsten F√§lle enth√§lt, die bei der Integration des Dienstes in andere Zahlungsanbieter auftreten k√∂nnen. <br><br>  Zun√§chst wenden wir uns einem einmaligen Verbrauchskauf zu. <br><br><img src="https://habrastorage.org/webt/ob/xi/rd/obxirdlzjhofj6uvioqwixp-r2k.png"><br>  <i><font color="gray">Abbildung 3. Der Vorgang der Ausf√ºhrung einer einmaligen Verbrauchszahlung</font></i> <br><br>  In Schritt 1 fordert der Benutzer den Kauf des Dienstes an.  Der Antrag entscheidet, dass die Zahlung erfolgen soll, und in Schritt 2 wird die Kontrolle an den Zahlungsanbieter (App Store) √ºbertragen.  Schritt 3: Dem Benutzer wird ein Formular zur Zahlung angezeigt.  Schritt 4: Der Benutzer stellt Daten zur Zahlung bereit.  Schritt 5: Der Anbieter schlie√üt die Transaktion ab und meldet das Ergebnis an die Anwendung. Er sendet eine Quittung mit vollst√§ndigen Informationen zum Kauf (Datum, Service, Status usw.) zur√ºck.  Schritt 6: Der mit Benutzerdaten erg√§nzte Scheck wird zur Verarbeitung an den Server gesendet.  Der Server verarbeitet die Pr√ºfdaten und generiert im siebten Schritt eine Push-Benachrichtigung f√ºr die Anwendung.  Im achten Schritt wird dem Benutzer die Benachrichtigung angezeigt. <br><br>  Das Problem ist, dass die Schritte 3, 4 und 5 auf der Seite des Zahlungsanbieters ausgef√ºhrt werden, praktisch nicht von uns kontrolliert werden und verschiedene Variationen aufweisen k√∂nnen.  Somit hat der Prozess tats√§chlich keine lineare Struktur, wie in Abbildung 2 gezeigt, sondern eine verzweigte (siehe Abbildung 4), und jede Verzweigung muss von der Anwendung anders behandelt werden. <br><br><img src="https://habrastorage.org/webt/8h/ur/mv/8hurmv5_d6mact7vy90jcdb9s_i.png"><br>  <i><font color="gray">Abbildung 4. Verzweigen eines Diagramms f√ºr den einmaligen Zahlungsstatus</font></i> <br><br>  Der Kauf von Abonnements beginnt auf die gleiche Weise wie eine einmalige Zahlung, aber eine weitere Kontrolle des Prozesses ist ziemlich schwierig zu kontrollieren. <br><br><img src="https://habrastorage.org/webt/lj/di/eb/ljdiebqce8tfo236xv8gir0jaa4.png"><br>  <i><font color="gray">Abbildung 5. Extern verwaltete Abonnementstatus</font></i> <br><br>  Ich m√∂chte Sie daran erinnern, dass das Apple-Abonnement, das wir als Beispiel betrachten, extern verwaltet wird.  Dies bedeutet, dass der Benutzer es nach dem Kauf asynchron verwalten kann: Schlie√üen, Ablaufdatum √§ndern, R√ºckerstattung beantragen.  Wir sehen dies in Schritt 9. Da die Aktion au√üerhalb unseres Systems stattfindet, habe ich sie in der Abbildung mit einer gepunkteten Linie markiert. <br><br>  In Schritt 10 kann der App Store den Abonnementstatus √§ndern: Erneuern, Schlie√üen, Geben Sie die Kulanzfrist in das Fenster ein. <br><br>  Damit wir herausfinden k√∂nnen, in welchem ‚Äã‚ÄãStatus sich das Abonnement befindet, gibt es Schritt 11, der f√ºr Aggregatoren wie den App Store und Google Wallet spezifisch ist.  In diesem Schritt sendet das System ein Token, das als Quittung verwendet wird, die zu Beginn beim Kauf eines Abonnements oder nach seiner vorherigen Verl√§ngerung eingeht. <br><br>  Schritt 12 ist die Antwort des Anbieters.  Wir erhalten einen Scheck mit dem aktuellen Status des Abonnements.  Das Ergebnis in diesem Schritt h√§ngt von den asynchronen Schritten 9 und 10 ab. <br><br>  Im Herbst 2018 hat Apple for all einen Mechanismus f√ºr <b>Server-zu-Server-Benachrichtigungen</b> implementiert, mit dem Sie √ºber √Ñnderungen benachrichtigen k√∂nnen, die bei einem Abonnement aufgetreten sind.  Der Empfang einer solchen Benachrichtigung wird in Schritt 13 gezeigt. F√ºr die meisten anderen Anbieter ist der Server-zu-Server-Benachrichtigungsmechanismus der einzige, sodass argumentiert werden kann, dass das Apple-Beispiel die gesamte Vielfalt der F√§lle abdeckt.  Bei anderen Anbietern k√∂nnen Sie in Schritt 13 die Schritte 11 und 12 vom Schema ausschlie√üen. <br><br>  In Schritt 14 generiert der Server eine Antwort f√ºr die Anwendung, um den Status des Abonnements zu √§ndern. <br><br>  So haben wir ein vollst√§ndiges Diagramm der Zust√§nde erhalten, die √ºbergeben werden m√ºssen, um bezahlte Dienste zu √ºberpr√ºfen. <br><br><img src="https://habrastorage.org/webt/tg/he/vx/tghevxtlppxvc9xuqt4wczbav0s.png"><br>  <i><font color="gray">Abbildung 6. Der vollst√§ndige Prozess zum √Ñndern des Zahlungsstatus (am Beispiel eines extern verwalteten Abonnements)</font></i> <br><br>  Die Teile, die wir in unserem System nicht steuern, sind orange gef√§rbt und f√ºr uns schwarze K√§stchen. <br><br><h2>  Abrechnungspr√ºfverfahren </h2><br>  Das technische Hauptproblem beim Testen von kostenpflichtigen Diensten ist das Vorhandensein von ‚ÄûBlack Boxes‚Äú, √ºber deren Status wir nur sehr wenig Kontrolle haben.  Dies definiert eine Reihe von Methoden, die die gesamte Vielfalt der F√§lle abdecken k√∂nnen. <br><br>  Es gibt nicht viele dieser Methoden, und wir haben sie in drei Kategorien unterteilt: reale Zahlungen, Sandboxen und Beseitigung externer Abh√§ngigkeiten von den "Black Boxes". <br><br><h3>  Echte Zahlungen </h3><br>  Reale Zahlungen als Testmethode sind insofern gut, als sie eine klare Vorstellung vom Integrationszustand vermitteln.  Ein Fehler bei der tats√§chlichen Zahlung ist ein bedingungsloser Beweis f√ºr einen Fehler. <br><br>  Ansonsten sind echte Zahlungen schlecht.  Erstens ist es teuer: Es ist offensichtlich, dass Sie echtes Geld ausgeben m√ºssen, um eine echte Zahlung zu leisten.  Sie irren sich, wenn Sie der Meinung sind, dass am Ende der gesamte Betrag an das Unternehmen zur√ºckgegeben wird: Erstens erheben die Anbieter f√ºr jede Transaktion eine Geb√ºhr, deren Gr√∂√üe, wie oben beschrieben, von der Risikobewertung der Organisation abh√§ngt und 40% (und sogar mehr) erreichen kann. ;;  Zweitens k√∂nnen Sie beim Testen von Zahlungen in anderen L√§ndern aufgrund der W√§hrungsspanne Geld verlieren - der Differenz zwischen den Kauf- und Verkaufskursen der W√§hrung (Sie t√§tigen den Kauf zum Fremdw√§hrungskurs der Bank, und die Rendite erfolgt zum Kaufkurs). <br><br>  Dar√ºber hinaus kann diese Methode sehr lange dauern, da Sie auf das Ende der Verl√§ngerungsfrist f√ºr das Abonnement und den Ablauf der Nachfrist warten m√ºssen. Dies k√∂nnen Monate sein. <br><br><h3>  Sandk√§sten </h3><br>  Sandk√§sten sind wundersch√∂n.  Dies ist in der Tat die gleiche Funktionalit√§t, die uns ein Zahlungsanbieter im Falle einer echten Zahlung bietet, ohne jedoch echtes Geld auszugeben.  Es wird vom Anbieter vollst√§ndig unterst√ºtzt, was bedeutet, dass die Integration in die Sandbox kosteng√ºnstig ist. <br><br>  Das Problem der Dauer des Testens im Laufe der Zeit wird in der Regel mit verschiedenen Tricks gel√∂st.  Beispielsweise verwendet die App Store-Sandbox die folgende Konvertierung zum Ablauf des Abonnements. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Echtzeit-Abonnement <br></td><td>  Apple Sandbox-Abonnementzeit <br></td></tr><tr><td>  1 Woche <br></td><td>  3 Minuten <br></td></tr><tr><td>  1 Monat <br></td><td>  5 Minuten <br></td></tr><tr><td>  2 Monate <br></td><td>  10 Minuten <br></td></tr><tr><td>  3 Monate <br></td><td>  15 Minuten <br></td></tr><tr><td>  6 Monate <br></td><td>  30 Minuten <br></td></tr><tr><td>  1 Jahr <br></td><td>  1 Stunde <br></td></tr></tbody></table></div>  <i><font color="gray">Tabelle 1. Das Verh√§ltnis der G√ºltigkeitsdauer eines echten Abonnements und eines Abonnements in der Sandbox von Apple</font></i> <br><br>  Die Standardabonnements f√ºr die Google Wallet-Sandbox sind in Tabelle 2 aufgef√ºhrt und k√∂nnen in der Verk√§uferkonsole konfiguriert werden. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Echtzeit-Abonnement <br></td><td>  Abonnementzeit f√ºr Google Sandbox <br></td></tr><tr><td>  1 Woche <br></td><td>  5 Minuten <br></td></tr><tr><td>  1 Monat <br></td><td>  5 Minuten <br></td></tr><tr><td>  3 Monate <br></td><td>  10 Minuten <br></td></tr><tr><td>  6 Monate <br></td><td>  15 Minuten <br></td></tr><tr><td>  1 Jahr <br></td><td>  30 Minuten <br></td></tr></tbody></table></div>  <i><font color="gray">Tabelle 2. Festlegen der Dauer eines Abonnements in der Google Sandbox</font></i> <br><br>  Im Gegensatz zur Apple-Sandbox k√∂nnen Sie auch die Testversion, die Kulanzfrist usw. in der Google-Sandbox anhand des Verh√§ltnisses aus Tabelle 3 √ºberpr√ºfen. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Echtzeit-Abonnement <br></td><td>  Abonnementzeit f√ºr Google Sandbox <br></td></tr><tr><td>  Probezeit <br></td><td>  3 Minuten <br></td></tr><tr><td>  Probezeit (Einf√ºhrung) <br></td><td>  Entspricht dem Zeitpunkt des entsprechenden Abonnements <br></td></tr><tr><td>  Nachfrist (3/7 Tage) <br></td><td>  5 Minuten <br></td></tr><tr><td>  Vor√ºbergehende Kontosperrung (halten) <br></td><td>  10 Minuten <br></td></tr><tr><td>  Pause (1/2/3 Monate) <br></td><td>  5/10/15 Minuten (jeweils) <br></td></tr></tbody></table></div>  <i><font color="gray">Tabelle 3. G√ºltigkeit zus√§tzlicher Abonnementfunktionen in der Google Sandbox</font></i> <br><br>  Das Schlie√üen eines Abonnements kann auch auf verschiedene Arten implementiert werden: In der Sandbox des App Store erfolgt das Schlie√üen nach der f√ºnften Verl√§ngerung und in Google Wallet √ºber die Konsole des Verk√§ufers oder auf dem Ger√§t aus dem Play Store. <br><br>  Das Problem bei Sandboxen ist, dass Anbieter eine andere Einstellung zu ihrer Qualit√§t haben.  Unsere Erfahrung zeigt, dass von den mehr als 70 in Badoo integrierten Zahlungsanbietern nur zwei Sandboxen √ºber volle Funktionalit√§t und stabilen Betrieb verf√ºgen.  Dies sind die Sandk√§sten von Adyen und PayPal.  Andere Anbieter haben entweder stabile, aber hinsichtlich der Funktionalit√§t abgeschnittene Sandboxen (wie Google Wallet) oder instabile und stark abgeschnittene Funktionen (wie App Store und Fortumo).  Und es gibt Anbieter, die keine Sandbox haben und √ºberhaupt nicht haben werden. <br><br><img src="https://habrastorage.org/webt/iz/as/im/izasimha0d95e0w214ym9kyfhcy.png"><br>  <i><font color="gray">Abbildung 7. Klassifizierung von Sandk√§sten nach Stabilit√§t und Funktionalit√§t</font></i> <br><br><h3>  Externe Abh√§ngigkeiten entfernen </h3><br>  Wenn wir Sie davon √ºberzeugt haben, dass das Testen mit realen Zahlungen teuer und ineffizient ist und Zahlungsanbieter keine Sandboxen mit der richtigen Qualit√§t bereitstellen, m√ºssen wir uns verschiedenen M√∂glichkeiten zuwenden, um externe Abh√§ngigkeiten zu beseitigen.  Es gibt nur drei davon: Moki, Fakes und Stubs. <br><br>  Moki bei der Abrechnung ist die Bildung der Reaktionen Ihres Systems auf Anfragen mit vorgegebenen Parametern ohne einen echten Anruf beim Zahlungsanbieter (siehe Abb. 8).  Beispielsweise wird eine Anforderung an einen SMS-Zahlungsanbieter unter der Nummer + 7111-111-11-11 abgefangen, wenn eine Anforderung an den Anbieter gesendet wird, und eine Systemantwort in Form einer erfolgreichen Zahlung generiert.  Die Anforderung an die Nummer + 7111-111-11-12 wird ebenfalls abgefangen, f√ºhrt jedoch zu einer Reaktion auf einen Fehler mit dem Code "Es ist nicht gen√ºgend Geld vorhanden, um die Transaktion abzuschlie√üen." <br><br><img width="340" src="https://habrastorage.org/webt/cb/zi/xy/cbzixy8v5c16-fjdnobzksxoij4.png"><br>  <i><font color="gray">Abbildung 8. Mock-Diagramm</font></i> <br><br>  F√§lschungen bei der Abrechnung sind F√§lschungen von Benachrichtigungen (als ob sie von einem echten Anbieter stammen) (siehe Abb. 9).  Die Integration mit jedem Anbieter impliziert eine begrenzte Anzahl von Systemreaktionen auf eine begrenzte Anzahl von Arten von Benachrichtigungen oder Zur√ºcksetzungen.             (      ),          . <br><br><img width="340" src="https://habrastorage.org/webt/t5/nz/_h/t5nz_hwuq-49im9ow_csqennjh4.png"><br> <i><font color="gray"> 9.  </font></i> <br><br>    ‚Äî               (. . 10),                        . <br><br><img width="340" src="https://habrastorage.org/webt/-z/3p/f8/-z3pf8attjz-fiitaqbanlhmbbe.png"><br> <i><font color="gray"> 10.  </font></i> <br><br>          ,      ,                     .      (, , )      .  ,      , ,             ,   . <br><br>      .  3, 4, 5    :    ,      .             -   :          ,    ‚Äî   ,    ‚Äî  .     ¬´  ¬ª. <br><br><img src="https://habrastorage.org/webt/2p/cu/w-/2pcuw-rvhju4ngyzr3ez7rqlhco.png"><br> <i><font color="gray"> 11.            (     App Store)</font></i> <br><br>   ,       (,      ).   ‚Äî      ,     .       . ,   ,           ,            .    ,          . ,              . <br><br><h2>     </h2><br>      .   ,          ?        : <br><br><ul><li>    ‚Äî          ? <br></li><li>   end-to-end ‚Äî    :             -  ? <br></li><li>  ‚Äî   :     ,        . <br></li></ul><br>      . <br><br><img src="https://habrastorage.org/webt/ck/sn/re/cksnrehqrplo3q14juwsyrar31m.png"><br> <i><font color="gray"> 4.     </font></i> <br><br> <b> .</b>    .     .     ,      .   :     ,   . <br><br> <b>.</b> , ,  Apple  Google, .        (   ).      end-to-end :           .  , ,   . <br><br> <b>, , </b> ‚Äî   .      .            .  :         . <br><br><h2>    </h2><br>    ,       ,     . <br><br>      ,        .         . <br><br>      :     .  ,     , ‚Äî            . <br><br>         ,    :     ‚Äî , , ;     ‚Äî    :    . <br><br><img src="https://habrastorage.org/webt/hc/rg/ka/hcrgka-jxqtj6rftvexttwrlvqw.jpeg"><br> <i><font color="gray"> 12.        </font></i> <br><br><h2>     </h2><br>   ,  ,       ,      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> . <br><br>      ,      12,      Badoo. <br><br><h4>     </h4><br>          .       .    QA-      .   ,    . ,  -   ,              ,   .   ,         . <br><br>  :      . <br><br><h4>      </h4><br>  ,      , ‚Äî     . ,    Apple      .         .   ,     .       :            -  . <br><br>   ‚Äî ,   . -,       . -,    ,  -,   ,          . <br><br>      ‚Äî    :                    ,   Apple   .       1  ‚Äî ,         . <br><br><h4>      </h4><br>            .          ,       .        ,     -    . <br><br>          ,             (       ). <br><br><h2>  Schlussfolgerungen </h2><br><ol><li>      ,          . <br></li><li>       (     )         .           ,          . <br></li><li>     ¬´ ¬ª  ,     .     -         ‚Äî     .     ,  : ,    ‚Äî  ,     ‚Äî     . <br></li><li>   ,     ,     , ,   ,        .          ,   . <br></li></ol><br>  ,             iOS-,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> . <br><br>   !      ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de459650/">https://habr.com/ru/post/de459650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de459638/index.html">Schaffung einer globalen Wissensbasis √ºber Batterien</a></li>
<li><a href="../de459640/index.html">Dokumente als Code. Teil 1: Automatisieren Sie das Update</a></li>
<li><a href="../de459642/index.html">Sicherer Zugriff auf Registerfelder in C ++ ohne Einbu√üen bei der Effizienz (am Beispiel von CortexM)</a></li>
<li><a href="../de459644/index.html">LED-Dimmer</a></li>
<li><a href="../de459648/index.html">Im Analysator sollte alles in Ordnung sein: sowohl Funktionalit√§t als auch Schnittstelle ... Wir untersuchen die neue Solar AppScreener 3.1-Schnittstelle</a></li>
<li><a href="../de459652/index.html">Automatisierter Regressionstestansatz</a></li>
<li><a href="../de459656/index.html">OData-Dienst ohne Code schreiben</a></li>
<li><a href="../de459658/index.html">PVS-Studio wollte, konnte aber keine Fehler in robots.txt finden</a></li>
<li><a href="../de459662/index.html">PVS-Studio wollte, konnte aber keine Fehler in robots.txt finden</a></li>
<li><a href="../de459668/index.html">Erkennen von Text auf einem Foto: Neue Funktionen des Vision-Frameworks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>