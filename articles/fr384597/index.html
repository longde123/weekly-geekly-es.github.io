<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐷 🏑 🧑🏿‍🤝‍🧑🏻 Mesure de l'électricité. Partie 1. Mesure de tension et de courant 🚥 🆓 🚑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="introduction
 Bonjour à tous! Après la fin du cycle sur les capteurs, il a été question d'un plan différent pour mesurer les paramètres de consommatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mesure de l'électricité. Partie 1. Mesure de tension et de courant</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384597/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/4df/1f8/1cd/4df1f81cd86c4e2a8f5afa1441fb88e5.jpg" alt="image" align="left"></a><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">introduction</font></font></b></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonjour à tous! </font><font style="vertical-align: inherit;">Après la fin du cycle sur les capteurs, il a été question d'un plan différent pour mesurer les paramètres de consommation des appareils ménagers et peu électriques. </font><font style="vertical-align: inherit;">Qui consomme combien, comment connecter quoi mesurer, quelles subtilités se produisent, etc. </font><font style="vertical-align: inherit;">Il est temps de révéler toutes les cartes de cette zone. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette série d'articles, nous aborderons le sujet de la mesure des paramètres de l'électricité. </font><font style="vertical-align: inherit;">Ces paramètres sont en fait un très grand nombre, que je vais essayer de raconter progressivement en petites séries. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jusqu'à présent, les plans sont en trois séries:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesure de l'électricité. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La qualité de l'électricité.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Appareils pour mesurer les paramètres de l'électricité.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le processus d'analyse, nous allons résoudre certains problèmes pratiques sur les microcontrôleurs jusqu'à ce qu'un résultat soit atteint. </font><font style="vertical-align: inherit;">Bien sûr, la majeure partie de ce cycle sera consacrée à la mesure de la tension alternative et peut être utile à tous les ventilateurs pour contrôler les appareils électriques de leur maison intelligente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la base des résultats de l'ensemble du cycle, nous fabriquerons un certain compteur électrique intelligent avec accès Internet. </font><font style="vertical-align: inherit;">Des ventilateurs très connus pour contrôler les appareils électriques de leur maison intelligente peuvent apporter toute l'assistance possible dans la mise en œuvre de la partie communication sur la base, par exemple, de MajorDomo. </font><font style="vertical-align: inherit;">Faisons de OpenSource une maison intelligente meilleure, pour ainsi dire. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette série en deux parties, nous aborderons les questions suivantes:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion de capteurs de courant et de tension dans des appareils CC, ainsi que des circuits CA monophasés et triphasés;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesure des valeurs actuelles de courant et de tension;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mesure du facteur de puissance;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pleine puissance active et réactive;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consommation d'énergie;</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par tacle, vous trouverez les réponses aux deux premières questions de cette liste. </font><font style="vertical-align: inherit;">Je n'ai pas délibérément abordé les problèmes de précision des indicateurs de mesure et de cette série je ne suis satisfait que des résultats obtenus avec une précision de plus ou moins de sabots. </font><font style="vertical-align: inherit;">Je consacrerai certainement un article séparé à cette question dans la troisième série.</font></font><br>
<a name="habracut"></a><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Connexion des capteurs</font></font></b></h4><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/ueE-XPjVkRY%3Ffeature%3Doembed&amp;usg=ALkJrhgWbhGfOGki4JNoamIXPr2BbqbrAw" frameborder="0" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la dernière série sur les capteurs de tension et de courant, j'ai parlé des types de capteurs, mais je n'ai pas expliqué comment les utiliser et où les placer. </font><font style="vertical-align: inherit;">Il est temps de le réparer</font></font><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Connexion de capteurs DC</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il est clair que l'ensemble du cycle sera consacré aux systèmes à courant alternatif, mais nous passerons également rapidement en revue les circuits à courant continu, car cela peut nous être utile lors du développement d'alimentations à courant continu. Prenons, par exemple, un </font><i><font style="vertical-align: inherit;">convertisseur abaisseur </font></i></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classique </font><font style="vertical-align: inherit;">: </font></font><br>
<img src="https://habrastorage.org/files/d35/255/0f2/d352550f2c04401ea57bcda120ee3790.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 1. Un convertisseur abaisseur PWM</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Notre objectif est de fournir une tension de sortie stable. De plus, sur la base des informations du capteur de courant, il est possible de contrôler le mode de fonctionnement de l'inductance L1, en empêchant sa saturation, et également de mettre en œuvre une protection en courant du convertisseur. Et franchement, il n'y a pas d'options particulières pour installer des capteurs.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un capteur de tension sous la forme d'un diviseur résistif R1-R2, qui est le seul capable de fonctionner en courant continu, est installé en sortie du convertisseur. En règle générale, un microcircuit de convertisseur spécialisé possède une entrée de rétroaction et met tout en œuvre pour garantir qu'à cette entrée (3) il existe un certain niveau de tension prescrit dans la documentation du microcircuit. Par exemple, 1,25 V. Si notre tension de sortie correspond à ce niveau - tout va bien - nous appliquons directement la tension de sortie à cette entrée. Sinon, réglez le séparateur. Si nous devons fournir une tension de sortie de 5 V, le diviseur doit fournir un facteur de division de 4, c'est-à-dire, par exemple, R1 = 30 k, R2 = 10 k.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un capteur de courant est généralement installé entre la source d'alimentation et le convertisseur et sur la puce. A partir de la différence de potentiel entre les points 1 et 2, et avec une résistance connue, les résistances Rs peuvent déterminer la valeur actuelle du courant de notre inductance. L'installation d'un capteur de courant entre les sources et la charge n'est pas une bonne idée, car le condensateur de filtrage sera coupé par la résistance des consommateurs de courants pulsés. L'installation d'une résistance dans l'espace du fil commun ne promet également rien de bon - il y aura deux niveaux de terre avec lesquels il est toujours amusant de jouer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les problèmes de chute de tension peuvent être évités en utilisant des capteurs de courant sans contact - par exemple, des capteurs à effet Hall: </font></font><br>
<img src="https://habrastorage.org/files/90c/b6b/1e2/90cb6b1e298b4d408bd27d971218781e.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 2. Capteur de courant sans contact</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, il existe un moyen plus délicat de mesurer le courant. Après tout, la tension chute également sur le transistor et le même courant circule que l'inductance qui le traverse. Par conséquent, par la chute de tension à travers elle, vous pouvez également déterminer la valeur actuelle du courant. Honnêtement, si vous regardez la structure interne des circuits de conversion, par exemple de Texas Instruments, cette méthode se retrouve aussi souvent que les précédentes. La précision de cette méthode n'est certainement pas la plus élevée, mais cela suffit pour que la coupure actuelle fonctionne. </font></font><br>
<img src="https://habrastorage.org/files/2fd/ecb/bab/2fdecbbab26c483ea476483e32e2a0c9.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 3. Transistor comme capteur de courant Nous faisons de</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
même dans d'autres circuits de convertisseurs similaires, qu'ils soient boosters ou inverseurs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cependant, il est nécessaire de mentionner séparément les convertisseurs linéaires et flyback des transformateurs.</font></font><br>
<img src="https://habrastorage.org/files/1d7/ebd/4b1/1d7ebd4b13214a919014f35a8a672b24.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 4. Connexion des capteurs de courant dans les convertisseurs flyback</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Ils peuvent également utiliser soit une résistance externe, soit un transistor dans son rôle. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Avec cela, nous avons connecté les capteurs aux convertisseurs DC / DC. </font><font style="vertical-align: inherit;">Si vous avez des suggestions pour d'autres options, je serai heureux d'y ajouter un article.</font></font><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 Connexion des capteurs aux circuits CA monophasés</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les circuits AC, nous avons une sélection beaucoup plus large de capteurs possibles. </font><font style="vertical-align: inherit;">Examinons plusieurs options. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le plus simple est l'utilisation d'un diviseur de tension résistif et d'un shunt de courant. </font></font><br>
<img src="https://habrastorage.org/files/458/c52/e43/458c52e436ac451d96927f6d3a14d772.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 5. Connexion de capteurs à résistance,</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
mais elle présente quelques inconvénients importants:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Premièrement, nous fournirons soit une amplitude significative du signal provenant du shunt actuel, en lui allouant une grande quantité d'énergie, soit nous serons satisfaits de la petite amplitude du signal et nous l'amplifierons ensuite. Et d'autre part, la résistance crée une différence de potentiel entre le neutre du réseau et le neutre de l'appareil. Si l'appareil est isolé, peu importe, si l'appareil a une borne de mise à la terre, nous risquons de rester sans signal du capteur de courant, car nous le court-circuiterons. Vous devriez peut-être essayer des capteurs qui fonctionnent sur d'autres principes.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Par exemple, nous utilisons des transformateurs de courant et de tension, ou un capteur de courant à effet Hall et un transformateur de tension. </font><font style="vertical-align: inherit;">Ici, il y a beaucoup plus de possibilités de travailler avec des équipements, car le fil neutre n'a pas de pertes, et surtout - dans les deux cas, il y a une isolation galvanique de l'équipement de mesure, ce qui peut souvent être utile. </font><font style="vertical-align: inherit;">Cependant, il faut garder à l'esprit que les capteurs de courant et de tension du transformateur ont une réponse en fréquence limitée et si nous voulons mesurer la composition harmonique des distorsions, ce n'est pas un fait qui fonctionnera. </font></font><br>
<img src="https://habrastorage.org/files/b59/304/c28/b59304c2821d45ef87501f76acfa232a.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 6. Connexion du transformateur et des capteurs de courant et de tension sans contact</font></font></i><br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 Connexion de capteurs à des circuits ca multiphasés</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les réseaux multiphasiques, notre capacité à connecter des capteurs de courant est légèrement inférieure. Cela est dû au fait que le shunt de courant ne peut pas être utilisé du tout, car la différence de potentiel entre les shunts de phase fluctuera à des centaines de volts et je ne connais aucun contrôleur à usage général dont les entrées analogiques peuvent résister à une telle moquerie. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, il existe une façon d'utiliser les shunts de courant - pour chaque canal, il est nécessaire de faire une entrée analogique isolée galvaniquement. Mais il est beaucoup plus facile et plus fiable d'utiliser d'autres capteurs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon analyseur de qualité, j'utilise des diviseurs de tension résistifs et des capteurs de courant à effet Hall à distance. </font></font><br>
<img src="https://habrastorage.org/files/3e5/d90/547/3e5d90547af64b41a48bcfe42ee82429.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig.7 Capteurs de courant dans un réseau triphasé</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme le montre la figure, nous utilisons une connexion à quatre fils. </font><font style="vertical-align: inherit;">Bien sûr, au lieu de capteurs de courant sur l'effet Hall, vous pouvez prendre des transformateurs de courant ou des boucles de Rogowski. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au lieu de diviseurs résistifs, des transformateurs de tension peuvent être utilisés, à la fois pour un système à quatre fils et à trois fils. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans ce dernier cas, les enroulements primaires des transformateurs de tension sont reliés par un triangle, et le secondaire par une étoile, dont le point commun est le point commun du circuit de mesure </font></font><br>
<img src="https://habrastorage.org/files/e4d/100/cf4/e4d100cf4d3048338dd15cacdb92a373.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 8. Utilisation de transformateurs de tension dans un réseau triphasé</font></font></i><br>
<h4><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 Valeur actuelle de la tension et du courant</font></font></b></h4><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/TOaW9xvr8NE%3Ffeature%3Doembed&amp;usg=ALkJrhhxR3qR2_41ES0Nx7DPLOCD_yJJ1g" frameborder="0" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le moment est venu de résoudre le problème de la mesure de nos signaux. La signification pratique pour nous est principalement la valeur actuelle du courant et de la tension. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Permettez-moi de vous rappeler le matériel du cycle du capteur. À l'aide de l'ADC de notre microcontrôleur à intervalles réguliers, nous fixerons la valeur de tension instantanée. Ainsi, pendant la période de mesure, nous aurons un tableau de données du niveau de la valeur de tension instantanée (pour le courant, tout est similaire). </font></font><br>
<img src="https://habrastorage.org/files/f70/ca7/063/f70ca706313a41a784c27c270cbd6eb2.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 9. Une série de valeurs de tension instantanées</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Notre tâche consiste à calculer la valeur efficace. Pour commencer, nous utilisons la formule intégrale: </font></font><br>
<img src="https://habrastorage.org/files/417/546/27d/41754627def647e89dce0c4037146eba.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(1) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans un système numérique, nous devons nous limiter à un certain quantum temporel, nous allons donc à la somme: </font></font><br>
<img src="https://habrastorage.org/files/17c/f0a/b23/17cf0ab2355a4a86a67504036f331c6b.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(2) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Où </font></font><img src="https://habrastorage.org/files/c7c/ac5/dec/c7cac5dece7f4d03b262ad4c8ad30317.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est la période d'échantillonnage de notre signal, et</font></font><img src="https://habrastorage.org/files/289/63f/958/28963f958bf74b1888aeef21b047c567.gif"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- le nombre d'échantillons pour la période de mesure. Quelque part ici, dans une vidéo, je commence à frotter le jeu sur l'égalité des zones. J'ai dû dormir ce jour-là. =) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans les microcontrôleurs MSP430FE4252, qui sont utilisés dans les compteurs électriques Mercury monophasés, 4096 relevés sont effectués pour une période de mesure de 1, 2 ou 4 secondes. Sur T = 1s et N = 4096, nous nous appuierons plus loin. De plus, 4096 points par seconde nous permettront d'utiliser des algorithmes de transformée de Fourier rapides pour déterminer le spectre harmonique jusqu'à 40 harmoniques, comme l'exige GOST. Mais plus à ce sujet dans la prochaine série.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous décrivons l'algorithme de notre programme. Nous devons assurer un démarrage stable de l'ADC toutes les 1/8192 secondes, car nous avons deux canaux et nous mesurerons ces données en alternance. Pour ce faire, configurez la minuterie et le signal d'interruption redémarrera automatiquement l'ADC. Tous les ADC le font. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous écrirons le futur programme sur Arduino, comme beaucoup l'ont sous la main. Jusqu'à présent, nous avons un intérêt purement académique. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ayant une fréquence de quartz système de 16 MHz et une minuterie 8 bits (pour que la vie ne ressemble pas à du miel), nous devons assurer la fréquence de fonctionnement de toute interruption de minuterie avec une fréquence de 8192 Hz. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes tristes du fait que 16 MHz n'est pas complètement divisé comme nous en avons besoin et que la fréquence finale de la minuterie est de 8198 Hz. Nous fermons les yeux sur une erreur de 0,04% et lisons encore 4096 échantillons par canal.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous sommes tristes que l'interruption de débordement dans arduino soit occupée à calculer le temps (il est responsable des millis et du retard, donc cela cessera de fonctionner normalement), nous utilisons donc l'interruption en comparaison. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et nous réalisons soudain que le signal nous parvient bipolaire, et que msp430fe4252 s'en sort parfaitement. Nous nous contentons d'un ADC unipolaire, par conséquent, nous assemblons un simple convertisseur d'un signal bipolaire en un unipolaire sur un amplificateur opérationnel: </font></font><br>
<img src="https://habrastorage.org/files/18f/0dd/c20/18f0ddc202544b24be6d684ce9d98c23.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 10. Un convertisseur d'un signal bipolaire en unipolaire</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
De plus, notre tâche est de nous assurer que notre sinusoïde oscille par rapport à la moitié de la tension de référence - alors nous allons soit soustraire la moitié de la plage ou activer l'option dans les paramètres ADC et obtenez les valeurs des signes.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'Arduino a un ADC 10 bits, donc nous soustrayons la moitié du résultat non signé dans 0-1023 et obtenons -512-511. Nous </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
vérifions le modèle assemblé dans LTSpiceIV et nous assurons que tout fonctionne comme il se doit. </font><font style="vertical-align: inherit;">Dans le matériel vidéo, nous vérifions également expérimentalement. </font></font><br>
<img src="https://habrastorage.org/files/3de/320/1f6/3de3201f66f94937b29504236ded1044.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 11. Résultat de la simulation. </font><font style="vertical-align: inherit;">Le vert est le signal d'origine, le bleu est la sortie</font></font></i><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esquisse pour Arduino pour un canal</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
</span>{<font></font>
  autoadcsetup();<font></font>
  DDRD |=(<span class="hljs-number">1</span>&lt;&lt;PD2)|(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
  Serial.begin(<span class="hljs-number">38400</span>);<font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-keyword">double</span> urms = <span class="hljs-number">0</span>;
<span class="hljs-keyword">double</span> utemp = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> umoment = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> N = <span class="hljs-number">0</span>;
<span class="hljs-keyword">int</span> flag = <span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span>
</span>{
  <span class="hljs-keyword">if</span> (flag){<font></font>
    flag = <span class="hljs-number">0</span>;<font></font>
    Serial.println(urms);<font></font>
  }<font></font>
}<font></font>
<span class="hljs-keyword">int</span> i = <span class="hljs-number">255</span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">autoadcsetup</span><span class="hljs-params">()</span></span>{
  <span class="hljs-comment">//set up TIMER0 to  4096Hz</span>
  <span class="hljs-comment">//TIMER0_OVF will be the trigger for ADC</span>
  <span class="hljs-comment">/*normal mode, prescaler 16
   16MHz / 64 / 61 = 4098 Hz 0.04% to 4096Hz*/</span>
  TCCR0B = (<span class="hljs-number">1</span> &lt;&lt; CS01)|(<span class="hljs-number">1</span> &lt;&lt; CS00);<span class="hljs-comment">//timer frequency = clk/64</span>
  OCR0A = <span class="hljs-number">60</span>;<span class="hljs-comment">//61-1</span>
  TIMSK0 = (<span class="hljs-number">1</span>&lt;&lt;OCIE0A);
  <span class="hljs-comment">//set ADC.</span>
  ADMUX =  (<span class="hljs-number">1</span> &lt;&lt; REFS0);<span class="hljs-comment">//8-bit mode, ADC0 channel, AVVCC as ref</span>
  ADCSRA = (<span class="hljs-number">1</span> &lt;&lt; ADEN) | (<span class="hljs-number">1</span> &lt;&lt; ADATE) | (<span class="hljs-number">1</span> &lt;&lt; ADIE) | (<span class="hljs-number">1</span> &lt;&lt; ADPS2);<span class="hljs-comment">//TUrn ADC On, trigger enable, Interrupt enable, sysclk/16=1MHz_ADC_clk=76kHz conv freq(13ticks per conversion)</span>
  ADCSRB = (<span class="hljs-number">1</span>&lt;&lt; ADTS1) | (<span class="hljs-number">1</span>&lt;&lt;ADTS0) | (<span class="hljs-number">1</span>&lt;&lt;MUX5);<span class="hljs-comment">//Auto trigger source</span><font></font>
}<font></font>
<font></font>
ISR(TIMER0_COMPA_vect){<font></font>
  <span class="hljs-keyword">if</span> (PIND &amp; (<span class="hljs-number">1</span>&lt;&lt;PD2)){<font></font>
    PORTD &amp;= ~(<span class="hljs-number">1</span>&lt;&lt;PD2);<font></font>
  }<font></font>
  <span class="hljs-keyword">else</span>{<font></font>
    PORTD |=(<span class="hljs-number">1</span>&lt;&lt;PD2);<font></font>
  }<font></font>
  TCNT0 = <span class="hljs-number">0</span>;<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
ISR(ADC_vect){<font></font>
<font></font>
  <span class="hljs-keyword">if</span>( ( UCSR0A &amp; (<span class="hljs-number">1</span>&lt;&lt;UDRE0)) ){<font></font>
    umoment = ADCL;<span class="hljs-comment">//copy result.</span>
    umoment += (ADCH&lt;&lt;<span class="hljs-number">8</span>);<font></font>
    umoment = umoment - <span class="hljs-number">512</span>;<font></font>
    utemp = utemp + <span class="hljs-built_in">pow</span>((<span class="hljs-keyword">double</span>)(umoment),<span class="hljs-number">2</span>)/<span class="hljs-number">4096</span>;<font></font>
    N++;<font></font>
    <span class="hljs-keyword">if</span> (N == <span class="hljs-number">4095</span>){<font></font>
      urms = <span class="hljs-built_in">sqrt</span>(utemp)/<span class="hljs-number">102</span>;<font></font>
      N = <span class="hljs-number">0</span>;<font></font>
      utemp = <span class="hljs-number">0</span>;<font></font>
      flag = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">if</span> (PIND &amp; (<span class="hljs-number">1</span>&lt;&lt;PD3)){<font></font>
        PORTD &amp;= ~(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
      }<font></font>
      <span class="hljs-keyword">else</span>{<font></font>
        PORTD |=(<span class="hljs-number">1</span>&lt;&lt;PD3);<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le programme est écrit dans l'IDE Arduino pour le microcontrôleur ATmega1280. </font><font style="vertical-align: inherit;">Sur ma carte de débogage, les 8 premiers canaux sont routés pour les besoins internes de la carte, donc le canal ADC8 est utilisé. </font><font style="vertical-align: inherit;">Il est possible d'utiliser ce croquis pour une carte avec ATmega168, cependant, vous devez sélectionner le canal correct. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À l'intérieur des interruptions, nous secouons quelques broches de service pour voir visuellement la fréquence de numérisation de travail. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelques mots sur l'origine du coefficient 102. Au premier démarrage, un signal d'amplitudes différentes a été fourni par le générateur, une indication de la valeur de tension effective a été lue sur l'oscilloscope et la valeur calculée en unités absolues de l'ADC a été prise à partir de la console.</font></font><br>
<table>
<tbody><tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Umax, V</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Urms, In</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dénombré</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,08</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">212</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,73</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">176</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,38</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">141</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,03</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">106</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,684</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">71</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,5</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,358</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,25</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,179</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dix-neuf</font></font></td>
</tr>
</tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En divisant les valeurs de la troisième colonne par les valeurs de la seconde, nous obtenons une moyenne de 102. Ce sera notre coefficient «d'étalonnage». Cependant, on peut noter que lorsque la tension diminue, la précision diminue fortement. Cela est dû à la faible sensibilité de notre ADC. En fait, 10 décharges pour des calculs précis sont désastreusement faibles et si la tension dans la prise peut être mesurée de cette manière, alors mettre un ADC 10 bits pour mesurer le courant consommé par la charge sera un crime contre la métrologie. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À ce stade, nous nous arrêterons. Dans la partie suivante, nous examinerons les trois autres questions de cette série et procéderons en douceur à la création de l'appareil lui-même.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le firmware présenté, ainsi que les autres firmware de cette série (puisque je filme du matériel vidéo plus vite que la préparation d'articles), vous le trouverez dans le référentiel sur GitHub: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/radiolok/arduino_rms_count</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Quant au développement du compteur électrique, la référence de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TI SimpleLink WiFi CC3200</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera prise comme base </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">SmartPlug</font></a><font style="vertical-align: inherit;"> , dont les nouvelles juste l'autre jour ont volé à mon courrier. </font><font style="vertical-align: inherit;">J'aime vraiment le microcontrôleur CC3200, nous allons donc développer un booster pour le lunchpad existant et réaliser toutes les fonctionnalités qui nous intéressent. </font><font style="vertical-align: inherit;">N'oubliez pas de le faire fonctionner si bien sur d'autres microcontrôleurs. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les commentaires sont invités  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">progchip666</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pour commentaires et ajouts au matériel, ainsi que  </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smart_alex</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> comme précédemment intéressé à mesurer le courant et la tension en utilisant Arduino.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr384597/">https://habr.com/ru/post/fr384597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr384583/index.html">Les fans de "My Little Pony" collectent des fonds pour un jeu de combat basé sur la série animée (mais avec de nouveaux personnages)</a></li>
<li><a href="../fr384585/index.html">Une histoire détaillée de l'échec de la préoccupation Volkswagen avec une contrefaçon de tests de respect de l'environnement</a></li>
<li><a href="../fr384589/index.html">Parler avec une ampoule - VOCCA Smart Cartridge Review</a></li>
<li><a href="../fr384593/index.html">[MISE À JOUR ISS] Éclipse totale de Super Moon le 28 septembre</a></li>
<li><a href="../fr384595/index.html">Risque de rayonnement: réacteurs à fission versus réacteurs à fusion</a></li>
<li><a href="../fr384599/index.html">Pourquoi changer les ampoules en LED</a></li>
<li><a href="../fr384603/index.html">Évaluation de Lima: service cloud personnel illimité</a></li>
<li><a href="../fr384605/index.html">Rendre un micro-ondes conventionnel plus intelligent avec IFTTT et OpenHAB</a></li>
<li><a href="../fr384607/index.html">Quelle est la forme d'Internet?</a></li>
<li><a href="../fr384611/index.html">Photos spatiales de la semaine (21/09/27/09)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>