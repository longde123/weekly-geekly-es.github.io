<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕞 ✴️ 🐷 Optimieren Sie die Rack-Verteilung von Servern 🍌 🚵🏽 🚣🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In einem der Chats wurde mir eine Frage gestellt: 

 - Und es gibt etwas zu lesen, wie man Server richtig in Racks packt? 

 Mir wurde klar, dass ich ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Optimieren Sie die Rack-Verteilung von Servern</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474112/"> In einem der Chats wurde mir eine Frage gestellt: <br><br>  - Und es gibt etwas zu lesen, wie man Server richtig in Racks packt? <br><br>  Mir wurde klar, dass ich einen solchen Text nicht kannte, also schrieb ich meinen eigenen. <br><br>  Erstens handelt dieser Text von physischen Servern in physischen Rechenzentren (DCs).  Zweitens glauben wir, dass es viele Server gibt: Hunderte oder Tausende, für eine kleinere Anzahl macht dieser Text keinen Sinn.  Drittens glauben wir, dass wir drei Begrenzer haben: physischen Platz in den Racks, Stromversorgung des Racks und Lassen der Racks in Reihen, sodass wir einen ToR-Switch verwenden können, um Server in benachbarten Racks zu verbinden. <br><a name="habracut"></a><br>  Die Antwort auf die Frage hängt stark davon ab, welchen Parameter wir optimieren und was wir variieren können, um das beste Ergebnis zu erzielen.  Zum Beispiel brauchen wir nur ein Minimum an Platz, um mehr für weiteres Wachstum zu lassen.  Oder wir haben die Freiheit, die Höhe der Racks, die Leistung pro Rack, die Sockel in der PDU, die Anzahl der Racks in einer Gruppe von Schaltern (ein Schalter pro 1, 2 oder 3 Racks), die Länge der Drähte und die Zugarbeit (dies ist an den Enden der Reihen kritisch: Bei 10 Racks hintereinander und 3 Racks an einem Switch müssen Sie die Drähte in einer anderen Reihe ziehen oder die Anschlüsse im Switch nicht ausreichend nutzen.  Separate Storys: Serverauswahl und DC-Auswahl, wir gehen davon aus, dass sie ausgewählt sind. <br><br>  Es wäre schön, einige der Nuancen und Details zu verstehen, insbesondere den durchschnittlichen / maximalen Verbrauch von Servern und wie wir mit Strom versorgt werden.  Wenn wir also eine russische Stromversorgung von 230 V und eine Phase pro Rack haben, kann eine 32A-Maschine ~ 7 kW halten.  Angenommen, wir zahlen nominell für 6 kW pro Rack.  Wenn ein Anbieter unseren Verbrauch nur für eine Serie von 10 Racks misst und nicht für jedes Rack, und wenn die Maschine einen konventionellen Grenzwert von 7 kW hat, können wir technisch 6,9 kW in einem separaten Rack verschlingen, in einem weiteren 5,1 kW, und alles ist in Ordnung - nicht strafbar. <br><br>  Normalerweise ist es unser Hauptziel, die Kosten zu minimieren.  Das beste Messkriterium ist die Reduzierung der Gesamtbetriebskosten (TCO).  Es besteht aus folgenden Teilen: <br><br><ul><li>  CAPEX: Beschaffung von DC-Infrastruktur, Servern, Netzwerkhardware und Verkabelung </li><li>  OPEX: DC-Vermietung, Stromverbrauch, Wartung.  OPEX hängt von der Lebensdauer ab.  Es ist vernünftig anzunehmen, dass es 3 Jahre entspricht. </li></ul><br><img src="https://habrastorage.org/webt/ub/ur/zi/uburzia_hkzpiosfd3k6i2agrwq.jpeg"><br><br>  Je nachdem, wie groß die einzelnen Stücke in der gesamten Torte sind, müssen wir die teuersten optimieren und den Rest alle verbleibenden Ressourcen so effizient wie möglich nutzen lassen. <br><br>  Angenommen, wir haben einen vorhandenen Gleichstrom, es gibt eine Rackhöhe von H-Einheiten (z. B. H = 47), Strom für das Rack-P- <sub>Rack</sub> (P- <sub>Rack</sub> = 6 kW), und wir haben uns für die Verwendung von Servern mit zwei Einheiten von h = 2U entschieden.  Wir entfernen 2..4 Einheiten aus dem Rack zu den Schaltern, Patchfeldern und Organisatoren.  Das heißt  physikalisch haben wir S <sub>h</sub> = Rounddown ((H-2..4) / h) -Server in unserem Rack (d. <sub>h.</sub> S <sub>h</sub> = Rounddown ((47-4) / 2) = 21 Server pro Rack).  Denken Sie daran, dies ist S <sub>h</sub> . <br><br>  Im einfachen Fall sind alle Server im Rack gleich.  Insgesamt, wenn wir das Rack mit Servern hämmern, können wir auf jedem Server durchschnittlich die Leistung P <sub>serv</sub> = P <sub>Rack</sub> / S <sub>h</sub> (P <sub>serv</sub> = 6000 W / 21 = 287 W) <sub>ausgeben</sub> .  Der Einfachheit halber ignorieren wir hier den Schalterverbrauch. <br><br>  Wir treten einen Schritt zur Seite und bestimmen, wie hoch der maximale Serververbrauch P <sub>max ist</sub> .  Wenn es sehr einfach, sehr ineffizient und absolut sicher ist, lesen wir, was auf dem Netzteil des Servers steht - fertig. <br><br>  Wenn es komplizierter und effizienter ist, nehmen wir das TDP (Thermal Design Package) aller Komponenten und fassen es zusammen (dies ist nicht sehr richtig, kann aber so sein). <br><br>  Normalerweise kennen wir die TDP-Komponenten nicht (mit Ausnahme der CPU), daher gehen wir am korrektesten, aber auch am schwierigsten vor (wir benötigen ein Labor). Wir nehmen einen experimentellen Server mit der erforderlichen Konfiguration und laden ihn beispielsweise mit Linpack (CPU und Speicher) und fio (Festplatten). Verbrauch messen.  Wenn Sie es ernst nehmen, müssen Sie während der Tests auch die wärmste Umgebung im kalten Korridor schaffen, da dies sowohl den Lüfterverbrauch als auch den CPU-Verbrauch beeinflusst.  Unter diesen bestimmten Bedingungen erhalten wir unter dieser bestimmten Last den maximalen Verbrauch eines bestimmten Servers mit einer bestimmten Konfiguration.  Wir meinen nur, dass die neue Firmware des Systems, eine andere Version der Software, andere Bedingungen das Ergebnis beeinflussen können. <br><br>  Insgesamt kehren wir zu P <sub>serv zurück</sub> und wie vergleichen wir es mit P <sub>max</sub> .  Hier geht es darum zu verstehen, wie die Dienste funktionieren und wie stark Ihre Nerven bei Ihrem Technikfreak sind. <br><br>  Wenn Sie es überhaupt nicht riskieren, glauben wir, dass alle Server sofort beginnen können, ihr Maximum zu verbrauchen.  Gleichzeitig kann ein Eingang zum Gleichstrom gebildet werden.  Infra sollte unter diesen Bedingungen einen Dienst erbringen, daher P <sub>serv</sub> ≡ P <sub>max</sub> .  Dies ist ein Ansatz, bei dem Zuverlässigkeit von entscheidender Bedeutung ist. <br><br>  Wenn der Techdir nicht nur an perfekte Sicherheit denkt, sondern auch an das Geld des Unternehmens und mutig genug ist, dann können wir das entscheiden <br><br><ul><li>  Wir beginnen mit der Verwaltung unserer Lieferanten. Insbesondere verbieten wir die geplante Wartung zum Zeitpunkt der geplanten Spitzenlast, um den Abfall einer Eingabe zu minimieren. </li><li>  und / oder unsere Architektur ermöglicht es Ihnen, das Rack / die Zeile / den DC zu verlieren, und die Dienste funktionieren weiterhin. </li><li>  und / oder wir verteilen die Last horizontal gut auf die Racks, sodass unsere Services niemals den maximalen Verbrauch in einem Rack zusammen erreichen. </li></ul><br>  Hier ist es sehr nützlich, nicht nur zu raten, sondern auch den Verbrauch zu überwachen und zu wissen, wie sehr die Server unter normalen Bedingungen und unter Spitzenbedingungen Strom verbrauchen.  Daher komprimiert das techdir nach einiger Analyse alles, was es hat, und sagt: „Wir entscheiden absichtlich, dass der maximal erreichbare Durchschnitt des maximalen Serververbrauchs pro Rack ** so viel ** niedriger ist als der maximale Verbrauch“, bedingt P <sub>serv</sub> = 0,8 * P <sub>max</sub> . <br><br>  Und dann gelangen nicht 16 Server mit P <sub>max</sub> = 375 W, sondern 20 Server mit P <sub>serv</sub> = 375 W \ * 0,8 = 300 W in ein 6-kW-Rack.  Das heißt  25% mehr Server.  Dies ist eine sehr große Einsparung - schließlich benötigen wir sofort 25% weniger Racks (wir sparen auch PDUs, Switches und Kabel).  Ein ernstes Minus einer solchen Entscheidung - es ist notwendig zu überwachen, dass unsere Annahmen immer noch wahr sind.  Dass die neue Version der Firmware den Betrieb der Lüfter und den Verbrauch nicht wesentlich verändert, dass die Entwicklung einer neuen Version plötzlich nicht mehr viel effizienter mit dem Server begann (lesen Sie, wir haben mehr Last und mehr Verbrauch auf dem Server).  Schließlich werden unsere anfänglichen Annahmen und Schlussfolgerungen sofort falsch.  Dies ist ein Risiko, das verantwortungsbewusst eingegangen (oder vermieden und dann für offensichtlich unterlastete Racks bezahlt werden muss). <br><br>  Ein wichtiger Hinweis: Wenn möglich, sollten Sie versuchen, Server von verschiedenen Diensten horizontal auf Racks zu verteilen.  Dies ist notwendig, damit keine Storys auftreten, wenn ein Serverstapel für einen Dienst eintrifft. Die Racks sind vertikal damit verstopft, um die "Dichte" zu erhöhen (weil dies einfacher ist).  In Wirklichkeit stellt sich heraus, dass ein Rack mit denselben niedrig ausgelasteten Servern eines Dienstes überfüllt ist und der andere gleichermaßen hoch ausgelastet ist.  Die Wahrscheinlichkeit eines Sturzes der Sekunde ist viel höher,  Das Lastprofil ist das gleiche, und alle Server in diesem Rack verbrauchen aufgrund der erhöhten Last dieselbe Menge. <br><br>  Zurück zur Verteilung der Server in den Racks.  Wir haben die physischen Einschränkungen des Rack-Platzes und die Leistungsbeschränkungen untersucht und sehen uns nun das Netzwerk an.  Sie können Switches an 24/32/48 Ports N verwenden (zum Beispiel haben wir ToR-Switches mit 48 Ports).  Glücklicherweise gibt es nicht viele Optionen, wenn Sie nicht an Breakout-Kabel denken.  Wir betrachten die Szenarien, wenn wir einen Switch pro Rack haben, einen Switch auf zwei oder drei Racks in der R- <sub>Netzgruppe</sub> .  Es scheint mir, dass mehr als drei Racks in der Gruppe schon zu viel sind, weil  Das Problem der Verkabelung zwischen Racks wird viel größer. <br><br>  Für jedes Netzwerkszenario (1, 2 oder 3 Racks in einer Gruppe) verteilen wir den Server in Racks: <br><br>  S <sub>Rack</sub> = min (S <sub>h</sub> , Abrundung (P <sub>Rack</sub> / P <sub>Serv</sub> ), Abrundung (N / R <sub>netto</sub> )) <br><br>  Für die Option mit 2 Racks in der Gruppe: <br><br>  S <sub>Rack</sub> <sup>2</sup> = min (21, Rounddown (6000/300), Rounddown (48/2)) = min (21, 20, 24) = 20 Server pro Rack. <br><br>  Ebenso betrachten wir die verbleibenden Optionen: <br><br>  S <sub>Rack</sub> <sup>1</sup> = 20 <br>  S <sub>Rack</sub> <sup>3</sup> = 16 <br><br>  Und wir sind fast da.  Wir zählen die Anzahl der Racks für die Verteilung aller unserer S-Server (sei es 1000): <br><br>  R = Aufrundung (S / (S- <sub>Rack</sub> * R- <sub>Netz</sub> )) * R- <sub>Netz</sub> <br><br>  R <sub>1</sub> = Aufrundung (1000 / (20 * 1)) * 1 = 50 * 1 = 50 Racks <br><br>  R <sub>2</sub> = Aufrundung (1000 / (20 * 2)) * 2 = 25 * 2 = 50 Racks <br><br>  R <sub>3</sub> = Aufrundung (1000 / (16 * 3)) * 3 = 21 * 3 = 63 Racks <br><br>  Als nächstes betrachten wir die Gesamtbetriebskosten für jede Option basierend auf der Anzahl der Racks, der erforderlichen Anzahl von Switches, der Verkabelung usw.  Wir wählen die Option, bei der die Gesamtbetriebskosten geringer sind.  Gewinn! <br><br>  Beachten Sie, dass die erforderliche Anzahl von Racks für die Optionen 1 und 2 zwar gleich ist, der Preis jedoch unterschiedlich ist, da  Die Anzahl der Schalter für die zweite Option ist halb so hoch und die Länge der erforderlichen Kabel ist länger. <br><br>  PS Wenn die Möglichkeit besteht, ein Rack und die Rackhöhe mit Strom zu versorgen, erhöht sich die Variabilität.  Der Prozess kann jedoch auf das oben Genannte reduziert werden, indem nur die Optionen sortiert werden.  Ja, es wird mehr Kombinationen geben, aber immer noch eine sehr begrenzte Anzahl - die Leistung pro Rack für die Berechnung kann in Schritten von 1 kW erhöht werden, typische Racks haben eine begrenzte Anzahl von Größen: 42U, 45U, 47U, 48U, 52U.  Und hier kann die Was-wäre-wenn-Analyse von Excel im Datentabellenmodus zur Berechnung beitragen.  Wir schauen uns die erhaltenen Platten an und wählen das Minimum aus. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de474112/">https://habr.com/ru/post/de474112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de474092/index.html">Backend-Bereich bei DUMP Kazan: Cloud-Anwendungsarchitektur, ausgehende Microservices, DDD und mehr</a></li>
<li><a href="../de474094/index.html">Blockdiagramm-Editor - über die Freundschaft zwischen Vue.js und MxGraph</a></li>
<li><a href="../de474096/index.html">Beliebte Programmiersprachen 2019 von hh.ru-Nutzern</a></li>
<li><a href="../de474104/index.html">Eine universelle Möglichkeit, das Erscheinungsbild einer WinForms-Anwendung anzupassen (am Beispiel von FAQ.Net).</a></li>
<li><a href="../de474106/index.html">Semantik der Tools zur Abhängigkeitsauflösung</a></li>
<li><a href="../de474114/index.html">Wir laden Sie zum GDG DevFest Moscow 2019 ein - einer informellen IT-Konferenz</a></li>
<li><a href="../de474116/index.html">Wie Sie keine Einwilligung zur Verarbeitung personenbezogener Daten einholen müssen</a></li>
<li><a href="../de474118/index.html">Das Buch "inDriver: von Jakutsk ins Silicon Valley. Die Geschichte der Gründung eines globalen Technologieunternehmens "</a></li>
<li><a href="../de474122/index.html">Von der Theorie zur Praxis: Wie die Blockchain in der Luftfahrt eingesetzt wird</a></li>
<li><a href="../de474124/index.html">Wir brauchen noch eine 1C-Bitrix, Teil 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>