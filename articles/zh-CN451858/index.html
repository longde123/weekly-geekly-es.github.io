<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ„ ğŸ˜œ ğŸ˜ åœ¨Springä¸­åˆ¶ä½œä¸€ä¸ªåŸºäºç¼“å­˜çš„ç®€å•æ–­è·¯å™¨ ğŸ‘©ğŸ¾â€âœˆï¸ ğŸ‘¨ğŸ½â€ğŸŒ¾ ğŸš£ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ¬æ–‡é€‚ç”¨äºé‚£äº›åœ¨å…¶åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æœ‰æ•ˆç¼“å­˜å¹¶å¸Œæœ›ä¸ä»…å‘åº”ç”¨ç¨‹åºè€Œä¸”å‘æ•´ä¸ªç¯å¢ƒå¢åŠ ç¨³å®šæ€§çš„äººï¼Œåªéœ€å‘é¡¹ç›®ä¸­æ·»åŠ 1ç±»å³å¯ã€‚ 

 å¦‚æœæ‚¨è®¤è¯†è‡ªå·±ï¼Œè¯·ç»§ç»­é˜…è¯»ã€‚ 

 ä»€ä¹ˆæ˜¯æ–­è·¯å™¨ï¼Ÿ 


 è¿™ä¸ªä¸»é¢˜åƒä¸–ç•Œä¸€æ ·åˆ»è–„ï¼Œæˆ‘ä¸ä¼šåŒå€¦æ‚¨ï¼Œå¢åŠ ç†µå¹¶é‡å¤åŒæ ·çš„äº‹æƒ…ã€‚ ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œé©¬ä¸Â·ç¦å‹’ï¼ˆMartin Fowle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Springä¸­åˆ¶ä½œä¸€ä¸ªåŸºäºç¼“å­˜çš„ç®€å•æ–­è·¯å™¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451858/"> æœ¬æ–‡é€‚ç”¨äºé‚£äº›åœ¨å…¶åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æœ‰æ•ˆç¼“å­˜å¹¶å¸Œæœ›ä¸ä»…å‘åº”ç”¨ç¨‹åºè€Œä¸”å‘æ•´ä¸ªç¯å¢ƒå¢åŠ ç¨³å®šæ€§çš„äººï¼Œåªéœ€å‘é¡¹ç›®ä¸­æ·»åŠ 1ç±»å³å¯ã€‚ <br><br> å¦‚æœæ‚¨è®¤è¯†è‡ªå·±ï¼Œè¯·ç»§ç»­é˜…è¯»ã€‚ <br><br><h2> ä»€ä¹ˆæ˜¯æ–­è·¯å™¨ï¼Ÿ </h2><br><img src="https://habrastorage.org/webt/w-/bn/xj/w-bnxjrhl9n7nnjby9grw571koa.png" alt="ç”µå½±ä¸­çš„ç›¸æ¡†å›åˆ°æœªæ¥"><br><a name="habracut"></a><br> è¿™ä¸ªä¸»é¢˜åƒä¸–ç•Œä¸€æ ·åˆ»è–„ï¼Œæˆ‘ä¸ä¼šåŒå€¦æ‚¨ï¼Œå¢åŠ ç†µå¹¶é‡å¤åŒæ ·çš„äº‹æƒ…ã€‚ ä»æˆ‘çš„è§’åº¦æ¥çœ‹ï¼Œé©¬ä¸Â·ç¦å‹’ï¼ˆMartin Fowlerï¼‰åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a>è¯´å¾—æœ€å¥½ï¼Œä½†æˆ‘ä¼šå°½åŠ›å°†å…¶å®šä¹‰å†™æˆä¸€å¥è¯ï¼š <br>  <i>è¯¥åŠŸèƒ½å¯é˜²æ­¢å¯¹ä¸å¯ç”¨æœåŠ¡çš„æ˜çŸ¥æ³¨å®šçš„è¯·æ±‚ï¼Œä»è€Œä½¿å…¶â€œç«™èµ·æ¥â€å¹¶ç»§ç»­æ­£å¸¸è¿è¡Œ</i> ã€‚ <br><br> ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸ºé˜²æ­¢å¤±è´¥çš„è¯·æ±‚ï¼Œæ–­è·¯å™¨ï¼ˆä»¥ä¸‹ç®€ç§°CBï¼‰ä¸åº”ç ´åæ‚¨çš„åº”ç”¨ç¨‹åºã€‚ å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå¦‚æœä¸æ˜¯æœ€æ–°æ•°æ®ï¼Œä½†ä»ç„¶ç›¸å…³ï¼ˆâ€œä¸çŠ¯è§„â€ï¼‰ï¼Œæˆ–è€…å¦‚æœæ— æ³•åšåˆ°ï¼Œåˆ™è¿”å›ä¸€äº›é»˜è®¤å€¼ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ã€‚ <br><br>
<h2> ç›®æ ‡ </h2><br> æˆ‘ä»¬é€‰å‡ºä¸»è¦å†…å®¹ï¼š <br><br><ol><li> å¿…é¡»å…è®¸æ•°æ®æºæ¢å¤ï¼Œæš‚æ—¶åœæ­¢å¯¹å…¶æŸ¥è¯¢ </li><li> å¦‚æœåœæ­¢å¯¹ç›®æ ‡æœåŠ¡çš„è¯·æ±‚ï¼Œåˆ™éœ€è¦æä¾›ï¼ˆå³ä½¿ä¸æ˜¯æœ€æ–°çš„ä½†ä»æ˜¯ç›¸å…³çš„ï¼‰æ•°æ® </li><li> å¦‚æœç›®æ ‡æœåŠ¡ä¸å¯ç”¨å¹¶ä¸”æ²¡æœ‰ç›¸å…³æ•°æ®ï¼Œè¯·æä¾›è¡Œä¸ºç­–ç•¥ï¼ˆè¿”å›é»˜è®¤å€¼æˆ–å…¶ä»–é€‚åˆç‰¹å®šæƒ…å†µçš„ç­–ç•¥ï¼‰ </li></ol><br><h2> æ‰§è¡Œæœºåˆ¶ </h2><br><h3> æ¡ˆä¾‹ï¼šæœåŠ¡å¯ç”¨ï¼ˆç¬¬ä¸€ä¸ªè¯·æ±‚ï¼‰ </h3><br><ol><li> è®©æˆ‘ä»¬å»ç¼“å­˜ã€‚ æŒ‰é”®ï¼ˆCRTï¼Œè¯·å‚è§ä¸‹æ–‡ï¼‰ã€‚ æˆ‘ä»¬çœ‹åˆ°ç¼“å­˜ä¸­æ²¡æœ‰ä»»ä½•å†…å®¹ </li><li> æˆ‘ä»¬å»äº†ç›®æ ‡æœåŠ¡ã€‚ æˆ‘ä»¬è·å¾—ä»·å€¼ </li><li> æˆ‘ä»¬å°†å€¼å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå°†å…¶è®¾ç½®ä¸ºTTLï¼Œå®ƒå°†è¦†ç›–ç›®æ ‡æœåŠ¡ä¸å¯ç”¨çš„æœ€å¤§å¯èƒ½æ—¶é—´ï¼Œä½†æ˜¯åŒæ—¶ï¼Œå®ƒåº”è¯¥ä¸è¶…è¿‡æ‚¨å‡†å¤‡æä¾›ç»™å®¢æˆ·ç«¯çš„æ•°æ®çš„ç›¸å…³æ€§æœŸé™ï¼Œä»¥é˜²ä¸ç›®æ ‡æœåŠ¡çš„è¿æ¥æ–­å¼€ </li><li> é«˜é€Ÿç¼“å­˜åˆ·æ–°æ—¶é—´ï¼ˆCRTï¼‰å­˜å‚¨åœ¨é«˜é€Ÿç¼“å­˜ä¸­ï¼Œä»¥è·å–ç¬¬3æ¡ä¸­çš„å€¼-åœ¨è¯¥æ—¶é—´ä¹‹åï¼Œæ‚¨éœ€è¦å°è¯•è½¬åˆ°ç›®æ ‡æœåŠ¡å¹¶æ›´æ–°è¯¥å€¼ </li><li> å°†ç¬¬2é¡¹ä¸­çš„å€¼è¿”å›ç»™ç”¨æˆ· </li></ol><br><h3> æ¡ˆä¾‹ï¼šCRTæ²¡æœ‰è¿‡æœŸ </h3><br><ol><li> è®©æˆ‘ä»¬å»ç¼“å­˜ã€‚ é€šè¿‡é”®ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†CRTã€‚ æˆ‘ä»¬çœ‹åˆ°è¿™æ˜¯ç›¸å…³çš„ </li><li> ä»ç¼“å­˜ä¸­è·å–å®ƒçš„å€¼ã€‚ </li><li> å°†å€¼è¿”å›ç»™ç”¨æˆ·ã€‚ </li></ol><br><h3> æ¡ˆä¾‹ï¼šCRTè¿‡æœŸï¼Œç›®æ ‡æœåŠ¡å¯ç”¨ </h3><br><ol><li> è®©æˆ‘ä»¬å»ç¼“å­˜ã€‚ é€šè¿‡é”®ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†CRTã€‚ æˆ‘ä»¬çœ‹åˆ°è¿™æ— å…³ç´§è¦ </li><li> æˆ‘ä»¬å»äº†ç›®æ ‡æœåŠ¡ã€‚ æˆ‘ä»¬è·å¾—ä»·å€¼ </li><li> æ›´æ–°ç¼“å­˜ä¸­çš„å€¼åŠå…¶TTL </li><li> é€šè¿‡æ·»åŠ ç¼“å­˜åˆ·æ–°å‘¨æœŸï¼ˆCRPï¼‰ä¸ºå…¶æ›´æ–°CRT-è¿™æ˜¯éœ€è¦æ·»åŠ åˆ°CRTä»¥è·å¾—ä¸‹ä¸€ä¸ªCRTçš„å€¼ </li><li> å°†å€¼è¿”å›ç»™ç”¨æˆ·ã€‚ </li></ol><br><h3> æ¡ˆä¾‹ï¼šCRTè¿‡æœŸï¼Œç›®æ ‡æœåŠ¡ä¸å¯ç”¨ </h3><br><ol><li> è®©æˆ‘ä»¬å»ç¼“å­˜ã€‚ é€šè¿‡é”®ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†CRTã€‚ æˆ‘ä»¬çœ‹åˆ°è¿™æ— å…³ç´§è¦ </li><li> æˆ‘ä»¬å»äº†ç›®æ ‡æœåŠ¡ã€‚ ä»–ä¸å¯ç”¨ </li><li> ä»ç¼“å­˜ä¸­è·å–å€¼ã€‚ ä¸æ˜¯æœ€æ–°çš„ï¼ˆCRTçƒ‚äº†ï¼‰ï¼Œä½†ä»ç„¶æœ‰æ„ä¹‰ï¼Œå› ä¸ºå®ƒçš„TTLå°šæœªè¿‡æœŸ </li><li> æˆ‘ä»¬å°†å…¶é€€è¿˜ç»™ç”¨æˆ· </li></ol><br><h3> æ¡ˆä¾‹ï¼šCRTè¿‡æœŸï¼Œç›®æ ‡æœåŠ¡ä¸å¯ç”¨ï¼Œç¼“å­˜ä¸­æ²¡æœ‰ä»»ä½•å†…å®¹ </h3><br><ol><li> è®©æˆ‘ä»¬å»ç¼“å­˜ã€‚ é€šè¿‡é”®ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†CRTã€‚ æˆ‘ä»¬çœ‹åˆ°è¿™æ— å…³ç´§è¦ </li><li> æˆ‘ä»¬å»äº†ç›®æ ‡æœåŠ¡ã€‚ ä»–ä¸å¯ç”¨ </li><li> ä»ç¼“å­˜ä¸­è·å–å€¼ã€‚ ä»–ä¸æ˜¯ </li><li> å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æ­£åœ¨å°è¯•é‡‡ç”¨ç‰¹æ®Šçš„ç­–ç•¥ã€‚ ä¾‹å¦‚ï¼Œè¿”å›æŒ‡å®šå­—æ®µçš„é»˜è®¤å€¼æˆ–â€œæ­¤ä¿¡æ¯å½“å‰ä¸å¯ç”¨â€ç±»å‹çš„ç‰¹æ®Šå€¼ã€‚ é€šå¸¸ï¼Œå¦‚æœå¯èƒ½ï¼Œæœ€å¥½è¿”å›ä¸€äº›å†…å®¹è€Œä¸ç ´ååº”ç”¨ç¨‹åºã€‚ å¦‚æœä¸å¯èƒ½ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦å¯¹å¼‚å¸¸ç”¨æˆ·åº”ç”¨å¼‚å¸¸æŠ›å‡ºç­–ç•¥å’Œå¿«é€Ÿå“åº”ã€‚ </li></ol><br><h2> æˆ‘ä»¬å°†ä½¿ç”¨ä»€ä¹ˆ </h2><br> æˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Spring Boot 1.5ï¼Œä»ç„¶æ²¡æœ‰æ—¶é—´å‡çº§åˆ°ç¬¬äºŒä¸ªç‰ˆæœ¬ã€‚ <br><br> é‚£ç¯‡æ–‡ç« æ²¡æœ‰å†å‘è¡¨2éï¼Œæˆ‘å°†ä½¿ç”¨Lombokã€‚ <br><br> ä½œä¸ºé”®å€¼å­˜å‚¨ï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºKVï¼‰ï¼Œæˆ‘ä½¿ç”¨Redis 5.0.3ï¼Œä½†æ˜¯æˆ‘æ•¢è‚¯å®šï¼ŒHazelcastæˆ–ç±»ä¼¼äº§å“éƒ½å¯ä»¥ã€‚ æœ€ä¸»è¦çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªCacheManageræ¥å£çš„å®ç°ã€‚ å°±æˆ‘è€Œè¨€ï¼Œè¿™æ˜¯spring-boot-starter-data-redisä¸­çš„RedisCacheManagerã€‚ <br><br><h2> å®ä½œ </h2><br> ä¸Šé¢çš„â€œå®æ–½æœºåˆ¶â€éƒ¨åˆ†ä¸­ï¼Œåšäº†ä¸¤ä¸ªé‡è¦çš„å®šä¹‰ï¼šCRTå’ŒCRPã€‚ æˆ‘å°†å†æ¬¡è¯¦ç»†ä»‹ç»å®ƒä»¬ï¼Œå› ä¸º å®ƒä»¬å¯¹äºç†è§£ä»¥ä¸‹ä»£ç éå¸¸é‡è¦ï¼š <br><br> ç¼“å­˜åˆ·æ–°æ—¶é—´ï¼ˆ <b>CRT</b> ï¼‰æ˜¯KVä¸­çš„ä¸€ä¸ªå•ç‹¬æ¡ç›®ï¼ˆé”®+åç¼€â€œ _crtâ€ï¼‰ï¼Œå®ƒæ˜¾ç¤ºäº†åˆ°ç›®æ ‡æœåŠ¡è·å–æœ€æ–°æ•°æ®çš„æ—¶é—´ã€‚ ä¸TTLä¸åŒï¼ŒCRTçš„å‡ºç°å¹¶ä¸æ„å‘³ç€æ‚¨çš„æ•°æ®â€œçƒ‚äº†â€ï¼Œè€Œåªæ˜¯æ„å‘³ç€å®ƒå¾ˆå¯èƒ½åœ¨ç›®æ ‡æœåŠ¡ä¸­å˜å¾—æ›´æ–°ã€‚ æ–°é²œäº†-å¥½å§ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œç”µæµä¼šä¸‹é™ã€‚ <br><br> ç¼“å­˜åˆ·æ–°å‘¨æœŸï¼ˆ <b>CRP</b> ï¼‰æ˜¯åœ¨è½®è¯¢ç›®æ ‡æœåŠ¡åæ·»åŠ åˆ°CRTçš„å€¼ï¼ˆæ— è®ºæˆåŠŸä¸å¦éƒ½æ— å…³ç´§è¦ï¼‰ã€‚ å¤šäºäº†å¥¹ï¼Œè¿œç¨‹æœåŠ¡äººå‘˜èƒ½å¤Ÿåœ¨æ‘”å€’æ—¶â€œå±ä½å‘¼å¸â€å¹¶æ¢å¤å·¥ä½œã€‚ <br><br> å› æ­¤ï¼Œä¼ ç»Ÿä¸Šï¼Œæˆ‘ä»¬ä»è®¾è®¡ä¸»ç•Œé¢å¼€å§‹ã€‚ é€šè¿‡å®ƒï¼Œå¦‚æœéœ€è¦CBé€»è¾‘ï¼Œå°±éœ€è¦ä½¿ç”¨ç¼“å­˜ã€‚ å®ƒåº”è¯¥å°½å¯èƒ½ç®€å•ï¼š <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CircuitBreakerService</span></span></span><span class="hljs-class"> </span></span>{ &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStableValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EvictValueParameter parameter)</span></span></span></span>; }</code> </pre> <br> æ¥å£å‚æ•°ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StableValueParameter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String cachePrefix; <span class="hljs-comment"><span class="hljs-comment">//    private String objectCacheKey; private long crpInSeconds; // Cache Refresh Period private Supplier&lt;T&gt; targetServiceAction; //      private DisasterStrategy disasterStrategy; //   : CRT ,   ,     public StableValueParameter( String cachePrefix, String objectCacheKey, long crpInSeconds, Supplier&lt;T&gt; targetServiceAction ) { this.cachePrefix = cachePrefix; this.objectCacheKey = objectCacheKey; this.crpInSeconds = crpInSeconds; this.targetServiceAction = targetServiceAction; this.disasterStrategy = new ThrowExceptionDisasterStrategy(); } }</span></span></code> </pre><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EvictValueParameter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String cachePrefix; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String objectCacheKey; }</code> </pre><br> è¿™æ˜¯æˆ‘ä»¬å°†å¦‚ä½•ä½¿ç”¨å®ƒï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AccountDataResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAccount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String accountId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> StableValueParameter&lt;?&gt; parameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StableValueParameter&lt;&gt;( ACCOUNT_CACHE_PREFIX, accountId, properties.getCrpInSeconds(), () -&gt; bankClient.findById(accountId) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> circuitBreakerService.getStableValue(parameter); }</code> </pre><br> å¦‚æœæ‚¨éœ€è¦æ¸…é™¤ç¼“å­˜ï¼Œåˆ™ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictAccount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String accountId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EvictValueParameter parameter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EvictValueParameter( ACCOUNT_CACHE_PREFIX, accountId ); circuitBreakerService.evictValue(parameter); }</code> </pre><br> ç°åœ¨ï¼Œæœ€æœ‰è¶£çš„æ˜¯å®ç°ï¼ˆåœ¨ä»£ç çš„æ³¨é‡Šä¸­è¯´æ˜ï¼‰ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStableValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cache cache = cacheManager.getCache(parameter.getCachePrefix()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logAndThrowUnexpectedCacheMissing(parameter.getCachePrefix(), parameter.getObjectCacheKey()); } <span class="hljs-comment"><span class="hljs-comment">//   .   CRT final String crtKey = parameter.getObjectCacheKey() + CRT_CACHE_POSTFIX; //  CRT  ,    final LocalDateTime crt = Optional.ofNullable(cache.get(crtKey, LocalDateTime.class)) .orElseGet(() -&gt; DateTimeUtils.now().minusSeconds(1)); if (DateTimeUtils.now().isBefore(crt)) { //  CRT   ,     final Optional&lt;T&gt; valueFromCache = getFromCache(parameter, cache); if (valueFromCache.isPresent()) { return valueFromCache.get(); } } //  CRT  ,        return getFromTargetServiceAndUpdateCache(parameter, cache, crtKey, crt); } private static &lt;T&gt; Optional&lt;T&gt; getFromCache(StableValueParameter parameter, Cache cache) { return (Optional&lt;T&gt;) Optional.ofNullable(cache.get(parameter.getObjectCacheKey())) .map(Cache.ValueWrapper::get); }</span></span></code> </pre><br> å¦‚æœç›®æ ‡æœåŠ¡ä¸å¯ç”¨ï¼Œè¯·å°è¯•ä»ç¼“å­˜ä¸­è·å–ä»ç„¶ç›¸å…³çš„æ•°æ®ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromTargetServiceAndUpdateCache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( StableValueParameter parameter, Cache cache, String crtKey, LocalDateTime crt )</span></span></span><span class="hljs-function"> </span></span>{ T result; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = getFromTargetService(parameter); } <span class="hljs-comment"><span class="hljs-comment">/* Circuit breaker exceptions */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (WebServiceIOException ex) { log.warn( <span class="hljs-string"><span class="hljs-string">"[CircuitBreaker] Service responded with error: {}. Try get from cache {}: {}"</span></span>, ex.getMessage(), parameter.getCachePrefix(), parameter.getObjectCacheKey()); result = getFromCacheOrDisasterStrategy(parameter, cache); } cache.put(parameter.getObjectCacheKey(), result); cache.put(crtKey, crt.plusSeconds(parameter.getCrpInSeconds())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromTargetService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) parameter.getTargetServiceAction().get(); }</code> </pre><br> å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰å®é™…æ•°æ®ï¼ˆå®ƒä»¬å·²è¢«TTLåˆ é™¤ï¼Œå¹¶ä¸”ç›®æ ‡æœåŠ¡ä»ç„¶ä¸å¯ç”¨ï¼‰ï¼Œåˆ™æˆ‘ä»¬ä½¿ç”¨DisasterStrategyï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromCacheOrDisasterStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter, Cache cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) getFromCache(parameter, cache).orElseGet(() -&gt; parameter.getDisasterStrategy().getValue()); }</code> </pre><br> ä»ç¼“å­˜ä¸­åˆ é™¤æ²¡æœ‰ä»€ä¹ˆæœ‰è¶£çš„ï¼Œè¿™é‡Œä»…å‡ºäºå®Œæ•´æ€§è€ƒè™‘ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromCacheOrDisasterStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StableValueParameter parameter, Cache cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) getFromCache(parameter, cache).orElseGet(() -&gt; parameter.getDisasterStrategy().getValue()); }</code> </pre><br> ä»ç¼“å­˜ä¸­åˆ é™¤æ²¡æœ‰ä»€ä¹ˆæœ‰è¶£çš„ï¼Œè¿™é‡Œä»…å‡ºäºå®Œæ•´æ€§è€ƒè™‘ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evictValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EvictValueParameter parameter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Cache cache = cacheManager.getCache(parameter.getCachePrefix()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cache == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { logAndThrowUnexpectedCacheMissing(parameter.getCachePrefix(), parameter.getObjectCacheKey()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String crtKey = parameter.getObjectCacheKey() + CRT_CACHE_POSTFIX; cache.evict(crtKey); }</code> </pre><br><h2> ç¾éš¾ç­–ç•¥ </h2><br><img src="https://habrastorage.org/webt/ka/fw/_0/kafw_0jvueyuguwcdbjz4eksnz8.png" alt="ç”µå½±ä¸­çš„ç›¸æ¡†å›åˆ°æœªæ¥"><br><br> å®é™…ä¸Šï¼Œè¿™æ˜¯åœ¨CRTè¿‡æœŸï¼Œç›®æ ‡æœåŠ¡ä¸å¯ç”¨ä»¥åŠç¼“å­˜ä¸­æ²¡æœ‰ä»»ä½•å†…å®¹æ—¶å‘ç”Ÿçš„é€»è¾‘ã€‚ <br><br> æˆ‘æƒ³åˆ†åˆ«æè¿°è¿™ç§é€»è¾‘ï¼Œå› ä¸º è®¸å¤šäººä¸æ„¿è€ƒè™‘å¦‚ä½•å®æ–½å®ƒã€‚ ä½†è¿™å®é™…ä¸Šæ˜¯ä½¿æˆ‘ä»¬çš„ç³»ç»ŸçœŸæ­£ç¨³å®šçš„åŸå› ã€‚ <br><br> å½“æ‰€æœ‰åªèƒ½å¤±è´¥çš„äº‹ç‰©éƒ½è¢«æ‹’ç»å¹¶ä¸”æ‚¨çš„ç³»ç»Ÿä»ç„¶å¯ä»¥è¿è¡Œæ—¶ï¼Œæ‚¨æ˜¯å¦ä¸æƒ³å¯¹è‡ªå·±çš„æƒ³æ³•æ„Ÿåˆ°è‡ªè±ªï¼Ÿ å³ä½¿äº‹å®ä¸Šï¼Œä¾‹å¦‚ï¼Œå¹¶éåœ¨â€œä»·æ ¼â€å­—æ®µä¸­æ˜¾ç¤ºå•†å“çš„å®é™…ä»·æ ¼ï¼Œè€Œæ˜¯é¢˜è¯ï¼šâ€œç°åœ¨æ­£åœ¨æŒ‡å®šâ€ï¼Œä½†è¿™æ¯”ç­”æ¡ˆâ€œ 500æœåŠ¡ä¸å¯ç”¨â€è¦å¥½å¾—å¤šã€‚ æ¯•ç«Ÿï¼Œä¾‹å¦‚å‰©ä½™çš„10ä¸ªå­—æ®µï¼šäº§å“è¯´æ˜ç­‰ã€‚ ä½ å›æ¥äº†ã€‚ è¿™æ ·çš„æœåŠ¡è´¨é‡ä¼šåœ¨å¤šå¤§ç¨‹åº¦ä¸Šå‘ç”Ÿå˜åŒ–ï¼Ÿ..æˆ‘çš„ç”µè¯æ˜¯è¦æ›´åŠ æ³¨æ„ç»†èŠ‚ï¼Œä½¿ç»†èŠ‚æ›´å¥½ã€‚ <br><br> å®ŒæˆæŠ’æƒ…ç¦»é¢˜ã€‚ å› æ­¤ï¼Œç­–ç•¥ç•Œé¢å¦‚ä¸‹ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br> æ‚¨åº”æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©å®ç°ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¯ä»¥è¿”å›ä¸€äº›é»˜è®¤å€¼ï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultValueDisasterStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"   "</span></span>; } }</code> </pre><br> æˆ–è€…ï¼Œå¦‚æœåœ¨ç‰¹å®šæƒ…å†µä¸‹æ ¹æœ¬ä¸éœ€è¦è¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™å¯ä»¥å¼•å‘å¼‚å¸¸ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThrowExceptionDisasterStrategy</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DisasterStrategy</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Object</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CircuitBreakerNullValueException(<span class="hljs-string"><span class="hljs-string">"Ops! Service is down and there's null value in cache"</span></span>); } }</code> </pre><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒCRTå°†ä¸ä¼šå¢åŠ ï¼Œå¹¶ä¸”ä¸‹ä¸€ä¸ªè¯·æ±‚å°†å†æ¬¡è·Ÿéšç›®æ ‡æœåŠ¡ã€‚ <br><br><h2> ç»“è®º </h2><br> æˆ‘åšæŒä»¥ä¸‹è§‚ç‚¹-å¦‚æœæ‚¨æœ‰æœºä¼šä½¿ç”¨ç°æˆçš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸å¿…å¤§æƒŠå°æ€ªï¼Œå®é™…ä¸Šï¼Œè™½ç„¶å¾ˆç®€å•ï¼Œä½†åœ¨æœ¬æ–‡ä¸­è¿˜æ˜¯å€¼å¾—ä¸€æçš„ã€‚ ä½¿ç”¨æœ¬æ–‡äº†è§£å…¶å·¥ä½œåŸç†ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ“ä½œæŒ‡å—ã€‚ <br><br> ç°æˆçš„è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Spring Boot 2ï¼Œä¾‹å¦‚Hystrixã€‚ <br><br> è¦äº†è§£çš„æœ€é‡è¦çš„äº‹æƒ…æ˜¯ï¼Œè¯¥è§£å†³æ–¹æ¡ˆåŸºäºç¼“å­˜ï¼Œå…¶æœ‰æ•ˆæ€§ç­‰äºç¼“å­˜çš„æœ‰æ•ˆæ€§ã€‚ å¦‚æœç¼“å­˜æ— æ•ˆï¼ˆå¾ˆå°‘å‘½ä¸­ï¼Œå¾ˆå¤šæœªå‘½ä¸­ï¼‰ï¼Œé‚£ä¹ˆæ–­è·¯å™¨å°†åŒæ ·æ— æ•ˆï¼šæ¯æ¬¡ç¼“å­˜æœªå‘½ä¸­éƒ½ä¼šä¼´éšç€å¯¹ç›®æ ‡æœåŠ¡çš„è®¿é—®ï¼Œè¿™å¯èƒ½åœ¨æ­¤æ—¶æ­¤åˆ»æ˜¯ç—›è‹¦çš„å’Œç—›è‹¦çš„ï¼Œè¯•å›¾å¢åŠ ã€‚ <br><br> åœ¨åº”ç”¨æ­¤æ–¹æ³•ä¹‹å‰ï¼Œè¯·åŠ¡å¿…è¯„ä¼°ç¼“å­˜çš„æœ‰æ•ˆæ€§ã€‚ å¯ä»¥é€šè¿‡â€œç¼“å­˜å‘½ä¸­ç‡â€ =å‘½ä¸­æ•°/ï¼ˆå‘½ä¸­æ•°+æœªå‘½ä¸­æ•°ï¼‰æ¥å®Œæˆï¼Œå®ƒåº”è¯¥è¶‹å‘äº1ï¼Œè€Œä¸æ˜¯0ã€‚ <br><br> æ˜¯çš„ï¼Œæ²¡æœ‰äººä¼šæ‰“æ‰°æ‚¨ä¸€æ¬¡ä½¿ç”¨æœ€èƒ½è§£å†³ç‰¹å®šé—®é¢˜çš„CBå“ç§ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN451858/">https://habr.com/ru/post/zh-CN451858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN451842/index.html">å…³äºå‘ç°è‡ªå·±</a></li>
<li><a href="../zh-CN451848/index.html">ä½¿ç”¨DNS-01æŒ‘æˆ˜å’ŒAWSè‡ªåŠ¨åŒ–è®©æˆ‘ä»¬åŠ å¯†SSLè¯ä¹¦ç®¡ç†</a></li>
<li><a href="../zh-CN451852/index.html">RDPä¸­çš„è¿œç¨‹ä»»æ„ä»£ç æ‰§è¡Œ</a></li>
<li><a href="../zh-CN451854/index.html">é¢è¯•-å…³äºSwiftçš„10ä¸ªé—®é¢˜ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN451856/index.html">å®‰è£…openmeetings 5â€‹â€‹.0.0-M1ã€‚ æ²¡æœ‰Flashçš„WEBä¼šè®®</a></li>
<li><a href="../zh-CN451860/index.html">æ•°å­¦å®¶å‘ç°ä¹˜æ•°çš„å®Œç¾æ–¹æ³•</a></li>
<li><a href="../zh-CN451862/index.html">ä¹”Â·è¿ªæ™®é‡Œå§†ï¼ˆJoe Diprimï¼‰çš„ã€ŠéŸ³ä¹é—ªç”µã€‹ï¼šè‡ªå­¦æˆæ‰çš„å·¥ç¨‹å¸ˆåˆ¶ä½œç‰¹æ–¯æ‹‰çº¿åœˆè¿›è¡Œå¨±ä¹å’Œèµšé’±</a></li>
<li><a href="../zh-CN451864/index.html">åœ¨Windows OSä¸­æ£€æµ‹åˆ°EternalBlueçº§åˆ«çš„ä¸¥é‡RCEæ¼æ´</a></li>
<li><a href="../zh-CN451866/index.html">é€‰æ‹©ç½‘ç»œä¸­æœ€è¿‘çš„èŠ‚ç‚¹</a></li>
<li><a href="../zh-CN451870/index.html">æ‰€æœ‰ç¨‹åºå‘˜éƒ½éœ€è¦äº†è§£çš„ç°ä»£C ++åŠŸèƒ½</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>