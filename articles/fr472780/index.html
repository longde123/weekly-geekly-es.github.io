<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🌾 👈🏼 🤸🏽 Pourquoi éviter les amis ou comment j'ai perdu tous mes avantages 🧔🏻 ♨️ 🍿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, Habr. 


 Il y a quelques jours, je suis tombé sur ce tweet: 


 C ++ - Stateful TMP #cpp #cplusplus # Cpp20 https://t.co/Q3sh3XtiHC pic.twitte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pourquoi éviter les amis ou comment j'ai perdu tous mes avantages</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472780/"><p>  Salut, Habr. </p><br><p>  Il y a quelques jours, je suis tombé sur ce tweet: </p><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: absolute; visibility: hidden; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;"></twitter-widget><blockquote class="twitter-tweet" data-lang="en_US" data-twitter-extracted-i1581693469182936936="true"><p lang="en" dir="ltr">  C ++ - Stateful TMP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">#cpp</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">#cplusplus</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="># Cpp20</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://t.co/Q3sh3XtiHC</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pic.twitter.com/AkCRB2zvrT</a> </p>  - Kris Jusiak (@krisjusiak) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">21 octobre 2019</a> </blockquote><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><p>  En bref: une fois de plus, en C ++, ils ont trouvé une sorte de merde qui y apparaissait elle-même, émergente-convergente, comme la boue d'une courte histoire de science-fiction que j'ai lue dans mon enfance, qui a surgi accidentellement dans les égouts urbains et est devenue un solvant organique universel. </p><br><p>  Voyons cela, car ce ne sera pas long (selon le texte de la norme, je n'ai pas sauté plus de quelques heures).  Et amusant, les liens vers Standard sont toujours amusants. </p><a name="habracut"></a><br><p>  Voici tout le code: </p><br><pre><code class="cpp">#include &lt;cstdio&gt;

class tag;

template&lt;class&gt;
struct type { friend constexpr auto get(type); };

template&lt;class TKey, class TValue&gt;
struct set { friend constexpr auto get(TKey) { return TValue{}; } };

void foo() {            // never called
  if constexpr(false) { // never true
    if (false) {        // never true
        constexpr auto call = [](auto value) { std::printf("called %d", value); };
        void(set&lt;type&lt;tag&gt;, decltype(call)&gt;{});
    }
  }
}

int main() {
  get(type&lt;tag&gt;{})(42); // prints called 42
}</code></pre><br>
<p>   .</p><br>
<pre><code class="cpp">class tag;</code></pre><br>
<p>,   .</p><br>
<pre><code class="cpp">template&lt;class&gt;
struct type { friend constexpr auto get(type); };</code></pre><br>
<p>  <code>type</code>. ,   <em></em>    <code>get</code>  -  .</p><br>
<p> ,   (<a href="">13.9.1/1</a>) <code>type&lt;T&gt;</code>   <code>T</code>?    (     ,  <em>  argument-dependent lookup</em>,  !)    <code>get(T)</code> (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">9.8.1.2/3</a>, <a href="">13.9.1/4</a>),     (<a href="">6.2/2.1</a>).</p><br>
<pre><code class="cpp">template&lt;class TKey, class TValue&gt;
struct set { friend constexpr auto get(TKey) { return TValue{}; } };</code></pre><br>
<p>  <code>set</code>. ,   , <em></em>    <code>get</code>  - .</p><br>
<p> ,   <code>set&lt;K, V&gt;</code>   <code>K</code>, <code>V</code>?       <code>get(K)</code>,      (<a href="">6.2/2</a>).</p><br>
<pre><code class="cpp">void foo() {
  if constexpr(false) {
    if (false) {
        constexpr auto call = [](auto value) { std::printf("called %d", value); };
        void(set&lt;type&lt;tag&gt;, decltype(call)&gt;{});
    }
  }
}</code></pre><br>
<p>,  <code>if (false)</code>           ,     ,    :</p><br>
<pre><code class="cpp">void foo() {
  if constexpr(false) {
    constexpr auto call = [](auto value) { std::printf("called %d", value); };
    set&lt;type&lt;tag&gt;, decltype(call)&gt;{};
  }
}</code></pre><br>
<p>  ,  <code>if constexpr</code>    ,         .    ?</p><br>
<p>   <code>if constexpr</code> : <a href="">8.5.1/2</a>.      :</p><br>
<blockquote>If the value of the converted condition is false, the first substatement is a discarded statement</blockquote><p> ,    <code>call</code>  <code>set</code> — discarded statement.   .</p><br>
<p>   :</p><br>
<blockquote>During the instantiation of an enclosing templated entity, if the condition is not value-dependent after its instantiation, the discarded substatement (if any) is not instantiated.</blockquote><p>    discarded statement,    ,    . <code>false</code>, ,  value-dependent,    «».     «enclosing template entity»,    enclosing entity —  <code>foo</code>,        . ,   ,     ,  <code>if constexpr</code>   .</p><br>
<p>  .  ,  <code>type&lt;tag&gt;</code>,   <code>get(type&lt;tag&gt;)</code>   ,   ADL,    <code>get</code>    <code>type&lt;tag&gt;</code> ( 9.8.1.2/3).   <code>set&lt;type&lt;tag&gt;, decltype(call)&gt;</code>,  <em></em>  <code>get(type&lt;tag&gt;)</code>,     <code>type&lt;tag&gt;</code>.        <code>decltype(call)</code>,    <code>call</code>   ,   C++20         (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">7.5.5.1/13</a>),     .  <code>main</code>    <code>get(type&lt;tag&gt;{})</code>,       <code>get</code>   ADL.   ,  <code>call</code>,      ,   42.</p><br>
<p> .</p><br>
<p>,     —  discarded statement  enclosing <em>template</em> entity. ,   <code>void foo()</code>  <code>template&lt;typename&gt; void foo()</code>,       </p><br>
<div class="spoiler"><b class="spoiler_title">- </b><div class="spoiler_text"><pre><code class="cpp">#include &lt;cstdio&gt;

class tag;

template&lt;class&gt;
struct type { friend constexpr auto get(type); };

template&lt;class TKey, class TValue&gt;
struct set { friend constexpr auto get(TKey) { return TValue{}; } };

template&lt;typename&gt;
void foo() {
  if constexpr(false) { // never true
    if (false) {        // never true
        constexpr auto call = [](auto value) { std::printf("called %d", value); };
        void(set&lt;type&lt;tag&gt;, decltype(call)&gt;{});
    }
  }
}

int main() {
  foo&lt;int&gt;();
  get(type&lt;tag&gt;{})(42); // prints called 42
}</code></pre></div></div><br>
<p>  <del></del> <del></del> <del>                 </del>   :</p><br>
<pre><code class="plaintext">prog.cc:23:3: error: function 'get' with deduced return type cannot be used before it is defined
  get(type&lt;tag&gt;{})(42); // prints called 42
  ^
prog.cc:6:37: note: 'get' declared here
struct type { friend constexpr auto get(type); };
                                    ^</code></pre><br>
<p> ,  C++ - —    ,    (     -),     ( SFINAE, detector idiom    ). ,       -   C++?</p><br>
<p>       ,    ,    C++.   ,  —     ,    -     .    —   - ,      ,  -  -    template  ,      .      ,    , chaotic evil.   —       ,  , ,    ,   .</p><br>
<p>,      .  -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>    C++14,     C++11,   03.</p><br>
<p> ?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>:</p><br>
<blockquote>Defining a friend function in a template, then referencing that function later provides a means of capturing and retrieving metaprogramming state. This technique is arcane and should be made ill-formed.<br>
Notes from the May, 2015 meeting:<br>
CWG agreed that such techniques should be ill-formed, although the mechanism for prohibiting them is as yet undetermined.</blockquote><p>  ,     — , .</p><br>
<div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f00/f7d/2e3/f00f7d2e36848b56eeceb90cfa2981fb.jpg" alt=" — , ?"></div><br>
<br>
<p>  ,  !</p></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr472780/">https://habr.com/ru/post/fr472780/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr472768/index.html">Comment recruter, licencier et revenir de la gestion au développement: vidéo du Badoo Techleads Meetup # 5</a></li>
<li><a href="../fr472770/index.html">Organisation de l'interface dans Unity avec UI Canvas</a></li>
<li><a href="../fr472772/index.html">Recherchez des incidents et des réclamations similaires. Mesures et optimisation</a></li>
<li><a href="../fr472776/index.html">Sauvegarde, partie 7: Conclusions</a></li>
<li><a href="../fr472778/index.html">5 façons d'utiliser le Raspberry Pi</a></li>
<li><a href="../fr472782/index.html">Pourquoi 3D Headache / Part 8 Defocus et l'avenir de la 3D</a></li>
<li><a href="../fr472790/index.html">Antiquités: i-Mate Jasjar, un communicateur pour les entreprises</a></li>
<li><a href="../fr472792/index.html">Ordinateur basé sur les vannes NOR: à l'intérieur de l'ordinateur de commande embarqué Apollo</a></li>
<li><a href="../fr472796/index.html">OUI flanche FAANG * ou [guide pratique] sur la recherche d'emploi aux USA / Europe pour spécialiste informatique</a></li>
<li><a href="../fr472798/index.html">Cartes Yandex pour l'application Taxi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>