<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüåæ ü•ã üîπ Arc es un sistema de control de versiones para un monorepository. Informe Yandex üñãÔ∏è üôÑ ü•û</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Los sistemas de control de versiones han sido durante mucho tiempo una herramienta diaria para los desarrolladores. En los grandes repositorios, los r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arc es un sistema de control de versiones para un monorepository. Informe Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/482926/"> Los sistemas de control de versiones han sido durante mucho tiempo una herramienta diaria para los desarrolladores.  En los grandes repositorios, los requisitos para ellos son muy espec√≠ficos.  Debido a esto, las empresas adaptan las soluciones existentes, como lo hace Facebook con Mercurial y Microsoft con Git, o desarrollan sus propios sistemas: Piper y CitC en Google y Arc VCS en Yandex. <br><br>  En el informe, el desarrollador Vladimir Kikhtenko <a href="https://habr.com/ru/users/kikht/" class="user_link">kikht</a> explica por qu√© Yandex necesitaba su propio sistema de control de versiones y c√≥mo funciona.  Consid√©relo desde el lado de un desarrollador ordinario: c√≥mo acceder al c√≥digo fuente, reservar una rama para el desarrollo e integrar los cambios en una base de c√≥digo com√∫n.  Miramos debajo del cap√≥: aprendemos sobre la representaci√≥n interna de los datos y su visualizaci√≥n en un sistema de archivos virtual con una copia de trabajo.  Discutiremos las dificultades para implementar las funciones de VCS en un sistema de archivos virtual y al cargar datos de manera perezosa.  Hablemos sobre c√≥mo garantizar la fiabilidad de la infraestructura del servidor del repositorio.  <a href="https://habr.com/ru/company/yandex/blog/482926">Al final,</a> puede ver un registro no oficial del informe. <br><br>  - Buenas tardes a todos, mi nombre es Vladimir.  Todos escucharon discursos sobre no escribir bicicletas.  Mi informe estar√° al otro lado de la barricada. <br><a name="habracut"></a><br>  De hecho, Yandex tiene un monorepository en el que hay mucho c√≥digo.  Y llegamos a la conclusi√≥n de que estamos desarrollando nuestro propio sistema de control de versiones. <br><br><img src="https://habrastorage.org/webt/l3/y8/lq/l3y8lqxua4etd-ukds2vvc5kxkg.jpeg"><br><br>  ¬øC√≥mo llegamos a tal vida?  Hist√≥ricamente, este monorepositivo vivi√≥ con nosotros en SVN.  Practica el desarrollo basado en troncales.  No hay sucursales con muy pocas excepciones.  Todo el c√≥digo primero debe ingresar al tronco y luego llenarse. <br><br>  Con el crecimiento del repositorio, la √∫nica forma posible de trabajar con √©l era el pago selectivo, ya que es compatible con SVN.  Cargar todo el repositorio para usted no es del todo imposible, pero trabajar con √©l es muy dif√≠cil. <br><br><img src="https://habrastorage.org/webt/rw/i0/wa/rwi0wambw-yjb_ahmiwoytmvytk.jpeg"><br><br>  ¬øCu√°l es la escala de nuestro problema?  Aqu√≠ hay algunos n√∫meros: 6 millones de confirmaciones, casi 2 millones de archivos individuales.  El tama√±o total con el historial completo del repositorio es de 2 TB.  Para dejar en claro lo que significan estos n√∫meros en comparaci√≥n con otros repositorios t√≠picos, aqu√≠ hay un gr√°fico.  La mediana de GitHub es el tama√±o medio del repositorio en GitHub, 1 MB.  El percentil 90 en GitHub es lo que mis colegas llamaron el "dep√≥sito del hijo de la novia de mi madre".  Y todo lo dem√°s son los famosos grandes repositorios. <br><br><img src="https://habrastorage.org/webt/sb/dd/ek/sbddeks2vvyhyzwwmwsotp-etne.jpeg"><br><br>  Que yo sepa, el repositorio m√°s grande del mundo est√° con Google.  Se da una estimaci√≥n de su tama√±o de un art√≠culo en 2015, probablemente desde entonces han crecido.  Como puede ver, la escala es logar√≠tmica.  Se puede ver que tambi√©n somos bastante grandes. <br><br>  ¬øC√≥mo funcionan los diferentes sistemas de control de versiones al intentar descargar todo este repositorio?  Naturalmente, no comenzamos de inmediato a desarrollar nuestro sistema de control de versiones.  Intentamos convertir nuestro repositorio a diferentes sistemas.  El intento m√°s serio se hizo con Mercurial.  Y los resultados del tiempo de las operaciones t√≠picas a√∫n no nos satisfacen. <br><br><img src="https://habrastorage.org/webt/xu/ww/bz/xuwwbztsv7_qyoptjukm2pu3nay.jpeg"><br><br>  Durante la preparaci√≥n del informe, desafortunadamente, git-svn no pudo convertir todo nuestro repositorio.  Convirti√≥ una porci√≥n de un peque√±o n√∫mero de confirmaciones, por lo que no puedo estimar cu√°ntas operaciones relacionadas con el historial funcionan.  En un segmento son r√°pidos, y c√≥mo ser√° para 6 millones de confirmaciones no est√° muy claro. <br><br>  Al final est√°n los n√∫meros de nuestro sistema de control de versiones.  Puede obtener instant√°neamente una copia de trabajo.  En el primer inicio, las operaciones de registro se ralentizan ligeramente; en el segundo inicio, todo funciona r√°pidamente. <br><br>  Y el √∫ltimo d√≠gito.  Dado que nuestro sistema de control de versiones carga todos los datos de manera perezosa, solo los c√≥digos fuente que realmente resolvimos, que realmente usamos, est√°n en el disco.  Esto es significativamente menos que descargar el conjunto. <br><br><img src="https://habrastorage.org/webt/ig/8e/oh/ig8eohthc8a_mfyfyiaxjslhrka.jpeg"><br><br>  ¬øC√≥mo logramos esto?  La caracter√≠stica principal: la copia de trabajo que creamos no es un archivo real en el disco.  Este es un sistema de archivos virtual.  En Linux y Mac, esto se hace con fusible, en Windows con ProjFS.  Cargamos todos los datos de manera perezosa, por lo que se utiliza tanto espacio en disco como realmente necesitamos, no estamos tratando de cargar todo por adelantado.  Y llevamos a cabo todo tipo de operaciones pesadas en el servidor.  En particular, la operaci√≥n del registro y algo m√°s. <br><br><img src="https://habrastorage.org/webt/ig/jg/jw/igjgjww9nzy70irbsg-svup6_vi.jpeg"><br><br>  La interfaz de nuestro sistema de control de versiones, en general, repite Git, por lo que no mostrar√© c√≥mo es un flujo de trabajo t√≠pico.  Imagina a Git.  Todo es igual: finalice la compra para obtener la revisi√≥n deseada, ramifique para crear ramificaciones, confirme para confirmar, el escondite tambi√©n es compatible de la misma manera.  ¬øQu√© aporta este enfoque?  Reducimos significativamente el umbral de entrada.  La mayor√≠a de los desarrolladores dentro y fuera de Yandex pueden trabajar con Git.  No tienen que aprender nada nuevo. <br><br>  Por otro lado, no tenemos el objetivo de dejar caer el reemplazo de Git.  Hablar√© de esto m√°s adelante con m√°s detalle.  Para soportar toda la variedad de equipos git parece una locura, casi no los necesitamos a todos. <br><br><img src="https://habrastorage.org/webt/u2/fh/ke/u2fhkejztyav2rfuwrcsvmwmzv4.jpeg"><br><br>  Te contar√© un poco sobre el interior, sobre c√≥mo funciona todo.  Comencemos con el modelo de datos.  Nuestro modelo de datos es muy similar al geogr√°fico, con algunas diferencias.  Del mismo modo, todos los objetos que creamos en su interior son inmutables, se dirigen a ellos mediante un hash de su contenido y, en su interior, se almacenan en buffers planos. <br><br><img src="https://habrastorage.org/webt/0y/xn/5f/0yxn5fgiyjkgkuatsacat0igx44.jpeg"><br><br>  ¬øC√≥mo se ve la estructura?  Hay objetos de confirmaci√≥n, cada confirmaci√≥n tiene uno o varios antepasados.  Y de esta manera construyen algunas historias de DAG (gr√°fico ac√≠clico dirigido). <br><br><img src="https://habrastorage.org/webt/vj/gq/ai/vjgqaiudbezdynjexr6ys2qnh30.jpeg"><br><br>  Lo que tenemos y lo que no apareci√≥ inmediatamente en Git son los n√∫meros de generaci√≥n.  Usando un algoritmo simple, consideramos una cierta distancia desde la ra√≠z del √°rbol.  ¬øPor qu√© necesitamos esto?  Todo esto est√° cosido en la estructura de los objetos, una vez arreglado, y nunca cambia de nuevo. <br><br>  Una operaci√≥n bastante importante para un sistema de control de versiones es encontrar el ancestro com√∫n m√°s peque√±o para los dos commits.  En la versi√≥n b√°sica, se puede implementar simplemente dando vueltas en ancho, comenzando desde unos dos puntos, marcando todas las confirmaciones alcanzadas all√≠ con uno u otro signo, tan pronto como encuentren una confirmaci√≥n que tenga estos dos signos, existe el antepasado menos com√∫n. <br><br>  ¬øC√≥mo funcionar√° esto en una implementaci√≥n ingenua?  Algo como esto: ve y encuentra nuestro compromiso deseado. <br><br><img src="https://habrastorage.org/webt/_k/ua/ra/_kuarauekfozlpunbtufesyaxem.gif"><br><br>  El problema es con B, que es superfluo.  Parece que no pudimos entrar, pero lo miramos.  Y cuanto m√°s tengamos la diferencia entre una rama y un tronco usando un ejemplo, m√°s confirmaciones adicionales encontraremos.  En el caso de un monorepository, cuando la tasa de confirmaciones en un tronco es lo suficientemente alta, esta distancia puede ser muy grande.  Y habr√° decenas de miles de tales compromisos adicionales. <br><br><img src="https://habrastorage.org/webt/ls/qe/ko/lsqekoyn9trz8dxsqejf8tfkvdy.jpeg"><br><br><img src="https://habrastorage.org/webt/b2/_i/ld/b2_ild3rkleepwd-w2gwvnoegak.gif"><br><br>  En el caso de que haya n√∫meros de generaci√≥n, podemos usar la cola de prioridad al rastrear, y el rastreo se ver√° m√°s o menos as√≠: una vez, e inmediatamente encontrar√° lo que necesita. <br><br><img src="https://habrastorage.org/webt/xq/dy/hx/xqdyhxj1w29lm5r0j_xdftsmg8y.jpeg"><br><br>  Este es un ejemplo de la diferencia entre nuestro modelo.  En Git, esto era compatible anteriormente, usaban marcas de tiempo de n√∫meros de generaci√≥n, pero esto solo funcionar√° si los tiempos para crear confirmaciones son consistentes con el gr√°fico de confirmaci√≥n. <br><br><img src="https://habrastorage.org/webt/l2/nz/ob/l2nzobltj8dcwjfefjrp_dpea68.jpeg"><br><br>  Desafortunadamente, este no es el caso de nuestro historial de repositorios.  Hay confirmaciones que resultan de la migraci√≥n de otro repositorio, y el tiempo comienza a retroceder en ellas.  En Git, esto fue compatible en alg√∫n momento, pero no siempre es aplicable all√≠, porque en Git puede reemplazar el objeto de confirmaci√≥n con otro localmente.  La inmunidad del modelo sufre de esto, por lo tanto, esos n√∫meros de generaci√≥n que no se registran, a veces no son aplicables a lo que est√° escrito en ellos, esto no es cierto.  No tenemos tal problema. <br><br>  Otra ventaja de esta optimizaci√≥n es que es completamente local.  Para usar estos n√∫meros, no necesitamos tener todo el gr√°fico de compromiso.  Y, por lo general, no lo tenemos en absoluto, con nosotros se carga perezosamente.  Cuanto menos cargamos perezosamente, mejor vivimos. <br><br>  Adem√°s de commits, el modelo es muy similar a Git.  Cada confirmaci√≥n apunta a un determinado objeto de √°rbol, el √°rbol consta de registros, cada registro es otro √°rbol, y as√≠ es como se muestra la jerarqu√≠a de directorios en nosotros, o esto es un blob, alg√∫n archivo.  Adem√°s, tenemos algo como BlobRef, cuando el archivo es muy grande, lo dividimos en pedazos y lo presentamos en un objeto especial.  Eso es todo, como en Git. <br><br><img src="https://habrastorage.org/webt/zx/ma/yb/zxmaybpia7hh2rnjgzledt6ikg8.jpeg"><br><br>  ¬øQu√© no nos gusta en Git?  A esto le llamamos copy-info.  Si el archivo se copi√≥ en alg√∫n tipo de confirmaci√≥n, Git no guarda esta informaci√≥n de ninguna manera, y luego intenta restaurarla con heur√≠stica cuando muestra diferencias y estados.  Guardamos esta informaci√≥n en el gr√°fico.  Los registros pueden tener alg√∫n enlace de informaci√≥n de copia a otra confirmaci√≥n, a la ruta dentro del repositorio en esta confirmaci√≥n, por lo que sabemos que este archivo se copi√≥ en esta confirmaci√≥n. <br><br>  Tambi√©n hay deduplicaci√≥n, ya que, por otro lado, este blob se almacena una vez.  Pero la deduplicaci√≥n ser√≠a la misma, porque el contenido del archivo no cambi√≥; habr√≠a sido deduplicado por hash. <br><br>  ¬øC√≥mo se organizan los backends?  Si Git tiene un sistema de control de versiones distribuido, no necesita backends.  Sentimos esto especialmente cuando GitHub est√° ca√≠do.  Entendemos claramente que Git no necesita backends.  Nuestro sistema es cliente-servidor, almacena todos los datos en el servidor y se necesita disponibilidad del servidor para descargar aquellos objetos que a√∫n no est√°n en el cliente. <br><br><img src="https://habrastorage.org/webt/tn/ra/uz/tnrauzebvya5hi9zuvdjsorttxe.jpeg"><br><br>  Todos los datos que almacenamos en la base de datos Yandex.  Esta es una base de datos muy interesante que proporciona la transacci√≥n, el nivel necesario de confiabilidad.  Tiene todo lo que necesitamos, y esto nos salv√≥ de muchos problemas. <br><br>  Gracias a esto, los backends en s√≠ mismos son completamente ap√°tridas, todo el estado est√° en la base de datos y los backends podemos escalar f√°cilmente todo lo que necesitamos. <br><br>  Y para la interacci√≥n que con los clientes, la del interservidor, usamos gRPC, hoy hubo un informe detallado al respecto. <br><br><img src="https://habrastorage.org/webt/ce/xh/at/cexhatxlfxthnfdofvi1wedwexq.jpeg"><br><br>  ¬øC√≥mo se integra nuestro sistema con SVN?  El repositorio SVN contin√∫a vivo.  Adem√°s, nuestro sistema de control de versiones a√∫n no es autosuficiente.  ¬øC√≥mo trabaja ella en esta parte?  Inicialmente, hay alg√∫n componente Convertidor que monitorea el estado del repositorio SVN y convierte las confirmaciones SVN en confirmaciones Arc: nuestro sistema de control de versiones. <br><br>  A continuaci√≥n, hay un cliente que monta una copia de trabajo y va al servidor para obtener datos.  Cuando un desarrollador confirma algo, primero se env√≠a al servidor Arc, pero para que estos cambios vayan a troncal, nuestra rama principal, deben pasar por el sistema de solicitud de grupo y el sistema de revisi√≥n de c√≥digo.  Aqu√≠ viene otro servicio que monitorea las ramas de Arc, y si se actualizan, env√≠a una solicitud de grupo a nuestra revisi√≥n del c√≥digo del sistema.  El siguiente es el sistema de revisi√≥n de c√≥digo, cuando se decide que este parche debe fusionarse, lo confirma en SVN.  No del todo simple: agrega una cierta cantidad de metadatos all√≠ que esta confirmaci√≥n es en realidad una fusi√≥n de tal y tal rama de Arc.  Y luego este commit ya ve el convertidor, encuentra estos metadatos en √©l y crea un commit en el servidor Arc.  Este es el ciclo de commits.  Por lo tanto, si bien no podemos vivir sin SVN, porque tenemos troncal en SVN. <br><br>  La rama principal est√° constantemente sincronizada con nuestro servidor, pero no permitimos comprometernos directamente con ella. <br><br><img src="https://habrastorage.org/webt/gi/a0/-1/gia0-1aqpsq2bt3xsikjhilcr2g.jpeg"><br><br>  Sobre la fiabilidad de los backends.  Por supuesto, planeamos que todos los desarrolladores de Yandex usen esta cosa, por lo que es importante para nosotros que no se rompa.  Este es un est√°ndar dentro del √≠ndice: nuestros servicios deben sobrevivir a la falla de cualquier centro de datos.  El sistema de control de versiones no es una excepci√≥n.  Aqu√≠, nos salva enormemente el hecho de que YDB lo admite.  Y nuestros backends no tienen estado, hay diferentes partes implementadas de maneras ligeramente diferentes.  Los servidores que operan en objetos Arc operan en ramas, no tienen estado, se replican.  Los convertidores que convierten constantemente desde SVN se replican de acuerdo con el esquema activo-activo.  Hay varios convertidores trabajando simult√°neamente, se convierten al mismo tiempo, y en el momento en que intentan actualizar la rama Arc, resuelven los conflictos.  Uno tuvo √©xito, el otro fall√≥.  √âl est√° tratando de convertir algo m√°s. <br><br>  El servicio de solicitud de agrupaci√≥n es replicado por maestro-esclavo.  Hay uno principal funcionando.  Si falla, se selecciona uno nuevo a trav√©s de YDB.  Hay algo tan maravilloso como los sem√°foros, que tienen serias garant√≠as de accesibilidad y fiabilidad.  Los accesos a los sem√°foros est√°n completamente serializados.  Utilizamos sem√°foros tanto para el servicio de descubrimiento de solicitud de grupo como para seleccionar l√≠deres. <br><br>  Un poco sobre c√≥mo funciona el cliente.  Esta es la parte m√°s dif√≠cil de nuestro sistema de control de versiones, porque hay un sistema de archivos virtual.  De hecho, nos vemos obligados a implementar todas las operaciones en los archivos por nuestra cuenta.  Revisar√© algunas operaciones b√°sicas, describir√© con los dedos lo que sucede dentro cuando las hacemos. <br><br><img src="https://habrastorage.org/webt/is/sg/5l/issg5lt5g8ozy9hfmjalxuhhbig.jpeg"><br><br>  Por ejemplo, abrimos un archivo para grabar.  Cuando abrimos el archivo para escribir, encontramos el blob correspondiente de nuestro modelo de objetos.  Si es necesario, suba algo del servidor.  Si creamos f√≠sicamente un archivo en una tienda especial, todas las solicitudes adicionales que se dirijan a este archivo se enviar√°n por proxy all√≠.  Por lo tanto, hasta que se confirmen los cambios localizados (en Git se llama sin etapas), se almacenan temporalmente.  Llamamos a tales archivos materializados. <br><br><img src="https://habrastorage.org/webt/wi/ig/ar/wiigarboe1byzw6g2dm1tpj3mda.jpeg"><br><br>  Si abrimos el archivo para leer, entonces no podemos materializar nada, sino simplemente dar datos directamente desde nuestro blob. <br><br><img src="https://habrastorage.org/webt/kt/4w/qg/kt4wqgxgb6p155jfrcsmej5kxek.jpeg"><br><br>  Este es el momento en que agregamos el archivo al √≠ndice.  En este punto, debe ver si tenemos algo materializado.  ¬øHay un archivo que ha cambiado?  Si es as√≠, cree un blob para √©l y gu√°rdelo en el √≠ndice. <br><br><img src="https://habrastorage.org/webt/-d/qj/lx/-dqjlxli2tamjacrjl2aus-iinu.jpeg"><br><br>  La siguiente operaci√≥n es el estado del arco.  Es interesante porque es lo que en los sistemas de control de versiones convencionales en tales tama√±os es lento, porque tiene que atravesar todo el √°rbol de archivos.  No tenemos que recorrer todo el √°rbol de archivos, porque todas las solicitudes de cambio de archivos pasan por nuestro controlador de fusibles, e inmediatamente sabemos qu√© archivos vale la pena verificar si hay cambios.  Verificamos lo que logramos escribir en el √≠ndice e imprimimos la respuesta. <br><br><img src="https://habrastorage.org/webt/wa/7f/0e/wa7f0emrhfllexxyj8asf0kplso.jpeg"><br><br>  Comprometer el tiempo  Todo parece estar claro.  Hay un √≠ndice, ya hemos creado blobs para estos objetos, crear objetos de √°rbol que corresponden a este estado, crear un nuevo objeto de confirmaci√≥n, escribirlo en el almacenamiento de objetos. <br><br><img src="https://habrastorage.org/webt/eb/p4/uj/ebp4ujcdu2jg9vk18vnsgg9by9o.jpeg"><br><br>  A continuaci√≥n, cambiamos la copia de trabajo a la nueva confirmaci√≥n.  Esta es una operaci√≥n complicada, claramente se puede hacer con el comando de pago.  Y aqu√≠ puede pensar que todos nuestros cambios locales parecen haberse materializado, podemos suponer que deber√≠amos devolver los archivos que no se materializan a partir de nuevas confirmaciones.  Y eso es todo.  Todas las operaciones posteriores se env√≠an simplemente a otro √°rbol y blobs. <br><br><img src="https://habrastorage.org/webt/ne/qa/cu/neqacudmw91qauhiaoonre_49zm.jpeg"><br><br>  ¬øPor qu√© podr√≠a no funcionar esto?  La primera versi√≥n fue sobre esto.  El problema est√° en todo tipo de operaciones complicadas como el restablecimiento de arco ‚Äìsoft.  Nos cambian un interruptor de √°rbol, pero no materializan archivos.  Siguen existiendo en alg√∫n lugar sagrado.  Tambi√©n tenemos archivos sin seguimiento e ignorados, que tambi√©n deben procesarse de manera especial.  En este lugar, recolectamos muchos rastrillos y finalmente llegamos a la conclusi√≥n de que todav√≠a necesitamos tomar un √°rbol (ahora una copia de trabajo) durante el proceso de pago, tomar el √°rbol del compromiso al que nos estamos cambiando, tomar el √≠ndice y ponerlo en orden. espera <br><br>  Pero en t√©rminos de la complejidad de los algoritmos, no perdimos nada aqu√≠: todos estos √°rboles de cambios locales son proporcionales a los cambios que hicimos.  Por lo tanto, no deber√≠amos recorrer todo el repositorio con estas operaciones, todav√≠a funcionan bastante r√°pido. <br><br>  Al mismo tiempo, estamos haciendo algo de magia para que las marcas de tiempo que le damos a los archivos sean m√°s o menos correctas.  Si solo almacenamos archivos en el sistema de archivos, lo controla y el tiempo siempre avanza.  Aqu√≠ nosotros mismos debemos recordar de alguna manera qu√© archivo vio el usuario en qu√© momento.  Y si cambi√≥ a una confirmaci√≥n anterior, no empiece a darle una oportunidad anterior.  Debido a que los sistemas de ensamblaje, todos los IDE no est√°n listos para esto, eliminan muchas cosas. <br><br><img src="https://habrastorage.org/webt/r7/h7/fd/r7h7fdedl8-aip9z49ovoeb3zci.jpeg"><br><br>  En nuestro sistema de control de versiones, el soporte para el desarrollo basado en troncales est√° clavado.  En primer lugar, lo que ya he dicho: todos los cambios pasan por las solicitudes de grupo y el enlace troncal.  Hay un par de puntos m√°s.  No tenemos soporte de sucursal grupal.  Las ramas creadas en Arc est√°n vinculadas a un usuario espec√≠fico, y solo √©l puede comprometerse all√≠.  Esto nos permite evitar ramas de larga vida.  En SVN, esto no fue particularmente porque all√≠ es inconveniente hacer ramas.  Y es conveniente hacerlos en Arc, y si esto no se controla, tememos que algunas partes de nuestro mono-repositorio se ir√°n a sus ramas y llevar√°n a cabo su desarrollo all√≠.  Esto es contrario al modelo que queremos hacer. <br><br><img src="https://habrastorage.org/webt/uq/9a/bv/uq9abvkh2dunwxijq1vpuqefh7a.jpeg"><br><br>  En segundo lugar, no tenemos un comando de fusi√≥n.  Todas las fusiones de sucursales se producen bajo nuestro estricto control.  Ahora estamos desarrollando sucursales para lanzamientos, en los que tambi√©n ser√° posible fusionar.  Esto tambi√©n ser√° llevado a cabo no por alg√∫n equipo de usuarios, sino por la maquinaria del servidor, muy probablemente. <br><br><img src="https://habrastorage.org/webt/qa/dk/yl/qadkylvgcbgyx8lwuvc3n93ix7e.jpeg"><br><br>  ¬øCuales son nuestros planes?  El 20% de los desarrolladores de monorepository ya utilizan nuestro sistema de control de versiones.  Ya hemos salido de alg√∫n tipo de estado infantil, este es un sistema muy utilizado, es simplemente imposible descartarlo as√≠.  El objetivo final es convertirse en el principal sistema de control de versiones en Yandex.  De alguna manera debemos convencer al 80% restante de los desarrolladores de que somos bastante estables, confiables y utilizables.  Est√° claro que para esto necesita corregir todos los errores y finalizar las funciones que est√°n en Git. <br><br>  Naturalmente, en cierta perspectiva, planeamos volvernos autosuficientes, abandonar el convertidor o implementarlo en la direcci√≥n opuesta, de modo que primero todos los cambios vayan a Arc, y luego a SVN para los programadores m√°s persistentes. <br><br>  Ahora tenemos un gran desaf√≠o: la integraci√≥n del sistema de control de versiones en nuestro ensamblaje autom√°tico, en nuestro CI y otras tuber√≠as.  El desaf√≠o es que las personas son d√©biles en esp√≠ritu, escriben c√≥digo lentamente y se comprometen lentamente.  Y se descargan el c√≥digo demasiado lentamente.  Y los robots se ven privados de este inconveniente. <br><br>    ‚Äî    ,   CI        Arc, - .         ,       .     .      ,      ++-  ,  ,      .     . <br><br>   .      ¬´  Git¬ª.       :   Git.      ,   ,     . <br><br>   .  Git  .      ,       .     -  .       ,        checkout  reset,       .   ,     ,       .   :    Git. ¬´    ,   ¬ª.  Git   . <br><br>        .       Git,  git begin-wave-stash? <br><br>  : <br> ‚Äî  . <br><br> ‚Äî   ,  Git    ?     ‚Äî         ,   ,      ,   .  ,     .  Git   .         ,      .  Gracias <br><br><a name="video"></a><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/PQWdvuo6Gzc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/482926/">https://habr.com/ru/post/482926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../482908/index.html">La segunda parte de la traducci√≥n del libro de David Kouchner Masters of Doom. Cap√≠tulos 6-12</a></li>
<li><a href="../482912/index.html">La idea de una red social descentralizada de pr√≥xima generaci√≥n</a></li>
<li><a href="../482918/index.html">Guardar datos en una EEPROM en un Arduino transaccionalmente</a></li>
<li><a href="../482920/index.html">C√≥mo el piloto autom√°tico entr√≥ en nuestras vidas, pero no nos dimos cuenta</a></li>
<li><a href="../482922/index.html">Drupal Digest - 2019 / diciembre</a></li>
<li><a href="../482928/index.html">Predator Vision: efecto de visi√≥n t√©rmica</a></li>
<li><a href="../482930/index.html">Investigaci√≥n geneal√≥gica: libros de m√©tricas, censos, archivos, bases de datos abiertas</a></li>
<li><a href="../482932/index.html">IIoT - o c√≥mo ayudar a los empleados a usar su cerebro seg√∫n lo previsto</a></li>
<li><a href="../482934/index.html">Fracaso del proyecto ERP (Liqui Moly, Otto y otros como √©l)</a></li>
<li><a href="../482936/index.html">Introducci√≥n a ASGI: construcci√≥n de un ecosistema web as√≠ncrono de Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>