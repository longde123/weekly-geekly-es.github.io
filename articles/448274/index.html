<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≤üèø ü§¥üèæ ‚òùüèº Monitoreo por SMS del peso de tres colmenas por $ 35 ü•© üßñüèΩ üë®üèº‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ha pasado bastante tiempo desde la publicaci√≥n anterior sobre el sistema por $ 30 . 


 ¬øQu√© ha cambiado en el √∫ltimo mes lunar? 


1. Se ha agregado ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoreo por SMS del peso de tres colmenas por $ 35</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448274/"><p><img src="https://habrastorage.org/getpro/habr/post_images/77d/797/12a/77d79712a55957a17ca74a0995a7844d.jpg" alt="Newbee"></p><br><p>  Ha pasado bastante tiempo desde la publicaci√≥n anterior <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sobre el sistema por $ 30</a> . </p><br><p>  ¬øQu√© ha cambiado en el √∫ltimo mes lunar? </p><br><ol><li>  Se ha agregado una bater√≠a solar: el tiempo de funcionamiento es casi ilimitado. </li><li>  Se agreg√≥ informaci√≥n de env√≠o en una llamada. </li><li>  La capacidad de trabajar con todos los tipos de m√≥dulos de comunicaci√≥n que he visto: AiThinker, Goouu tech, SIM800 / 900, Neoway M590 * </li></ol><br><p>  Pero lo m√°s importante es que el m√≥dulo de comunicaci√≥n y el microcontrolador ahora est√°n f√≠sicamente separados, lo que elimina la interferencia en su funcionamiento con el HX711. </p><br><p>  Y todo esto gracias a las cr√≠ticas constructivas de los residentes y apicultores de Habrovsk que se unieron a la discusi√≥n del sistema. </p><br><p>  El resto de las caracter√≠sticas de rendimiento permanecieron iguales: el peso m√°ximo de las colmenas es de 200 kg, despu√©s del atardecer, se realiza la medici√≥n y se env√≠an los indicadores. </p><br><p>  Anticipando las cr√≠ticas con respecto a la no utilizaci√≥n de los modos de suspensi√≥n y las l√≠neas de se√±al adicionales de los m√≥dulos GSM, dir√© lo siguiente: </p><br><p>  Cada m√≥dulo de comunicaci√≥n tiene sus propios detalles: algunos se quedan dormidos a un nivel de se√±al bajo, otros a un nivel alto, otros con un doble toque. </p><br><p>  Los detalles de "h√°galo usted mismo" implica una cierta parte creativa, y vale la pena mostrarlo aqu√≠. </p><br><p>  Tambi√©n hice un sistema con miras al desarrollo posterior de la supervisi√≥n de otros par√°metros de la colmena, donde el sue√±o no es particularmente necesario. </p><br><p>  En general, en la tabla de t√≠tulos: <del>  Android puro </del>  sistema b√°sico desde el que puedes bailar en cualquier lugar con el dise√±o y el n√∫mero / conjunto de sensores, m√≥dulos, etc. </p><br><p>  Este art√≠culo trata sobre escalas y, debajo del corte, mi visi√≥n personal y la implementaci√≥n del sistema. </p><br><p>  En una palabra: ¬°BIENVENIDO!  Vamos! </p><a name="habracut"></a><br><p>  Para empezar, este sistema no duerme ... en absoluto, porque una bater√≠a solar de dos celdas y 6 voltios produce 5 voltios y hasta cien miliamperios incluso en tiempo nublado. </p><br><p>  Y el consumo de todo el sistema es de 17 mA, en modo de espera (en el est√°ndar GSM1800) y alrededor de treinta en el GSM900. </p><br><p>  Adem√°s, como ya se mencion√≥, esto se hizo con el objetivo de implementar funciones de monitoreo adicionales en tiempo real (un enjambre, por ejemplo, puede salir en 5 minutos); no hay tiempo para dormir ;-) </p><br><p>  Desea un ahorro absoluto de energ√≠a, por lo que estar√° en la pr√≥xima publicaci√≥n, pero ser√° completamente diferente <del>  la historia </del>  El sistema. </p><br><h4 id="da-esche-po-povodu-snoski-o-modulyah-svyazi---ne-to-chtoby-ya-stal-adeptom-aithinker-prosto-neoway-nuzhno-esche-samomu-sobirat-a-moduli-sim800l-trebuyut-otdelnoy-stati-s-likbezom-po-rabote-s-nimi">  * S√≠, en lo que respecta a la nota al pie sobre los m√≥dulos de comunicaci√≥n, no es que me haya convertido en un seguidor de AiThinker, solo necesito armar a Neoway yo mismo, y los m√≥dulos SIM800L requieren un art√≠culo separado con un programa educativo para trabajar con ellos. </h4><br><p>  En una palabra, los GSM seleccionados son IMHO, los √∫nicos que pueden funcionar con 4 cables, incluida la alimentaci√≥n, sin bailes adicionales con panderetas. </p><br><p>  Necesitaremos el siguiente conjunto de equipos / materiales: </p><br><ol><li>  Arduino Pro Mini 3V <br>  Debe prestar atenci√≥n al microchip convertidor lineal (debe ser exactamente 3,3 V) en el chip de marcado KB 33 / LB 33 / DE A10: los chinos han mezclado algo conmigo y todo el lote <br>  Las placas de circuito en la tienda resultaron ser con reguladores de 5 voltios y cuarzo de 16MHz. </li><li>  USB-Ttl en un chip CH340: puede incluso 5 voltios, pero luego, durante el firmware del microcontrolador, Arduino deber√° desconectarse del m√≥dulo GSM para no quemar el √∫ltimo. <br>  Las placas en el chip PL2303 no funcionan en Windows 10. </li><li>  M√≥dulo de comunicaci√≥n GSM Goouu Tech IOT GA-6-B o AI-THINKER A-6 Mini. </li><li>  Antena GSM GPRS "YG-01" <br><img src="https://habrastorage.org/getpro/habr/post_images/ff7/aa9/69e/ff7aa969e86e53e60122bcdb2ca47c04.jpg"><br>  C√≥mo lograron tal aumento, un acertijo, tal vez esto sea relativo a la ausencia total del mismo ;-). </li><li>  Paquete de inicio para un operador que tiene una buena cobertura en la ubicaci√≥n de su colmenar. <br>  S√≠, el paquete debe activarse primero en un tel√©fono normal, DESHABILITAR la SOLICITUD DE PIN en la entrada y reponer la cuenta. </li><li>  alambre dupont 20cm madre madre - 4 piezas  (para conectar Arduino a USB-TTL) </li><li>  3 piezas  HX711 - ADC para b√°sculas </li><li>  6 c√©lulas de carga que pesan hasta 50 kg </li><li>  15 metros de cable telef√≥nico de 4 n√∫cleos: para conectar m√≥dulos de pesas y GSM con ARDUINO. </li><li>  Fotoresistor GL5528 (esto es importante, con una resistencia oscura de 1MOhm y una resistencia a la luz de 10-20kOhm). </li><li>  dos pares de enchufes y enchufes 6P6C - tel√©fono, enchufes - con "colas" </li><li>  Cinta de 50 cm de doble cara de 10 mm de ancho: para fijar el panel solar a la carcasa del m√≥dulo GSM. </li><li>  Cargador basado en TP4056 para bater√≠as LiIon </li><li>  El soporte de la bater√≠a 18650 y, de hecho, la bater√≠a en s√≠. </li><li>  Un poco de cera o parafina (vela de tableta con l√°mpara de aroma) - para protecci√≥n contra la humedad HX711 </li><li>  Una pieza de viga de madera de 25x50x300mm para la base de las celdas de carga. </li><li>  Una docena de tornillos autorroscantes con una arandela de presi√≥n de 4.2x19 mm para montar los sensores en la base. </li><li>  Bater√≠a solar 5-6V 2W (no hab√≠a en el siguiente radio mago: tom√© dos diodos de un solo vatio y un par de 1N4148) <br><img src="https://habrastorage.org/getpro/habr/post_images/397/805/59c/39780559cbbd169641e5371eba3ec8e3.jpg" alt="Vista trasera de paneles"><br>  No hay corriente inversa a trav√©s del cargador, pero los m√≥dulos solares paralelos se deben encender correctamente a trav√©s de diodos </li><li>  Una caja para un m√≥dulo de comunicaci√≥n y una bater√≠a solar (tama√±o 60x100mm): puede llevar una distribuci√≥n adecuada de productos el√©ctricos, mi pl√°stico de tarjetas de visita 30x60x100 idealmente adecuado. </li></ol><br><p>  Adem√°s, requerir√° manos torcidas, un soldador EPSN-25, colofonia y soldadura POS-60. </p><br><p>  Para carpinter√≠a, una sierra para madera / metal, un cincel y un taladro con un taladro de 3 mm son suficientes. </p><br><p>  El dise√±o del sistema es el siguiente: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d34/875/ffc/d34875ffca19e80ac4658a8e439f749e.jpg" alt="Dise√±o"></p><br><p>  En cualquier caso, no debe colocar el m√≥dulo GSM a menos de un metro del Arduino; con una alta potencia de se√±al en el est√°ndar GSM900, ¬°esto puede hacer que el microcontrolador se reinicie! </p><br><p>  Bueno, el m√≥dulo de comunicaci√≥n con la bater√≠a solar, debe instalarse en un poste, y la recepci√≥n ser√° mejor, y m√°s lejos de las abejas. </p><br><p>  Ahora comencemos el ensamblaje: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/eba/218/027/eba21802786557630e811458e9a07eaa.jpg" alt="GSM A6"></p><br><p>  Para empezar, se sueldan dos LED del m√≥dulo GSM (el lugar donde se rodearon en un √≥valo naranja). </p><br><p>  Insertamos la tarjeta SIM con las almohadillas en la placa de circuito impreso, la esquina biselada en la foto se indica con la flecha. </p><br><p>  Adem√°s, desde la bater√≠a y el cable que va al controlador, se suelda directamente al condensador (4). </p><br><p>  El hecho es que el m√≥dulo de comunicaci√≥n en s√≠ mismo requiere 3.4-4.2V para su fuente de alimentaci√≥n, y su contacto PWR est√° conectado a un convertidor reductor, por lo que para la operaci√≥n del voltaje de iones de litio debe aplicarse sin pasar por esta parte del circuito. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b89/f94/1c2/b89f941c27d96e91f2d7ec3c970e453d.jpg" alt="Arduino Pro Mini 3v"></p><br><p>  Luego realizamos un procedimiento similar con el LED en la placa Arduino (el √≥valo a la derecha del chip cuadrado). </p><br><p>  Soldamos el peine en cuatro contactos (1), siempre horizontalmente, a lo largo del tablero. </p><br><p>  Acortamos las patas del fotorresistor a 10 mm y lo soldamos con conductores de 20 cm a los terminales GND y D2 de la placa (2). </p><br><p>  Suministramos energ√≠a a trav√©s de un convertidor lineal: a bajas corrientes, la ca√≠da de voltaje de ca√≠da es de 0.1V. </p><br><p>  Pero al suministrar un voltaje estabilizado a los m√≥dulos HX711, nos libramos de la necesidad de refinarlos a un voltaje m√°s bajo (y al mismo tiempo aumentamos el ruido como resultado de esta operaci√≥n). </p><br><p>  Ahora debe tomar 5 metros de un cable telef√≥nico de cuatro hilos y soldarlo entre el microcontrolador y el m√≥dulo de comunicaci√≥n de acuerdo con el diagrama al comienzo del art√≠culo (los colores de los cables corresponden a la realidad). </p><br><p>  Tambi√©n soldamos el soporte de la bater√≠a, haremos el resto un poco m√°s tarde. </p><br><p>  Y ahora, por un tiempo, nos alejamos del soldador y pasamos a la parte del software. <br>  Describir√© la secuencia de acciones para Windows: <br>  En primer lugar, debe descargar e instalar / descomprimir el programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Arduino IDE</a> : la versi√≥n actual es 1.8.9, pero uso 1.6.4 </p><br><p>  Por simplicidad, desempaquetamos el archivo en la carpeta C: \ arduino- "your_version_number", dentro tendremos las carpetas / dist, drivers, ejemplos, hardware, java, lib, bibliotecas, referencias, herramientas, as√≠ como el archivo ejecutable arduino (entre otros). </p><br><p>  Ahora necesitamos una biblioteca para trabajar con el ADC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HX711</a> - el bot√≥n verde "clonar o descargar" - descargar ZIP. </p><br><p>  El contenido (carpeta HX711-master) se coloca en el directorio C: \ arduino- "your_version_number" \ bibliotecas </p><br><p>  Y, por supuesto, el controlador para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">USB-TTL es</a> del mismo github: desde el archivo desempaquetado, simplemente se inicia el archivo de instalaci√≥n del instalador. </p><br><p>  Para aquellos que son reacios a molestarse con las bibliotecas, empaqu√© mi ensamblaje del programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Arduino IDE</a> , solo descargue y desempaquete. </p><br><p>  Comenzamos y configuramos el programa C: \ arduino- "your_version_number" \ arduino </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2fd/429/2d5/2fd4292d54f67c31052b54ca853be5b3.jpg" alt="Interfaz de programa"></p><br><p>  Vamos al elemento "Herramientas": seleccione la placa "Arduino Pro o Pro Mini", el procesador Atmega 328 3.3V 8 MHz, el puerto es el n√∫mero que no sea el sistema COM1 (aparece despu√©s de instalar el controlador CH340 con el adaptador USB-TTL conectado). </p><br><p>  Ok, copie el siguiente boceto (programa) y p√©guelo en la ventana Arduino IDE </p><br><pre><code class="plaintext hljs">char phone_no[]="+123456789012"; // Your phone number that receive SMS with counry code // NeverSleep #include &lt;SoftwareSerial.h&gt; // Sofrware serial library #include "HX711.h" // HX711 lib. https://github.com/bogde/HX711 #include &lt;EEPROM.h&gt; // EEPROM lib. HX711 scale0(10, 14); HX711 scale1(11, 14); HX711 scale2(12, 14); #define SENSORCNT 3 HX711 *scale[SENSORCNT]; SoftwareSerial mySerial(5, 4); // Set I/O-port TXD, RXD of GSM-shield float delta00; // delta weight from start float delta10; float delta20; float delta01; // delta weight from yesterday float delta11; float delta21; float raw00; //raw data from sensors on first start float raw10; float raw20; float raw01; //raw data from sensors on yesterday float raw11; float raw21; float raw02; //actual raw data from sensors float raw12; float raw22; word calibrate0=20880; //calibration factor for each sensor word calibrate1=20880; word calibrate2=20880; word daynum=0; //numbers of day after start int notsunset=0; boolean setZero=false; boolean forceSend=false; char ch = 0; char ch1 = 0; char ch2 = 0; char ch3 = 0; char ch4 = 0; void readVcc() // read battery capacity { ch = mySerial.read(); while (mySerial.available() &gt; 0) { ch = mySerial.read(); } // empty input buffer from modem mySerial.println("AT+CBC?"); //ask gprs for battery status (for sim800 and neoway command must be "AT+CBC" ) delay(200); while (mySerial.available() &gt; 0) { //read input string between coma and CR ch = mySerial.read(); if (ch ==','){ ch1 = mySerial.read(); ch2 = mySerial.read(); ch3 = mySerial.read(); ch4 = mySerial.read(); } } } // ********************************************************************** void SendStat() { detachInterrupt(digitalPinToInterrupt(0)); // turn off external interrupt digitalWrite(13, HIGH); if (!forceSend){ notsunset=0; for (int i=0; i &lt;= 250; i++){ if ( !digitalRead(2) ){ notsunset++; } //is a really sunset now? you shure? delay(360); } } if ( notsunset==0 || forceSend ) { raw01=raw02; raw11=raw12; raw21=raw22; raw02=scale0.get_units(16); //read data from scales raw12=scale1.get_units(16); raw22=scale2.get_units(16); daynum++; delta00=(raw02-raw00)/calibrate0; // calculate weight changes delta01=(raw02-raw01)/calibrate0; delta10=(raw12-raw10)/calibrate1; delta11=(raw12-raw11)/calibrate1; delta20=(raw22-raw20)/calibrate2; delta21=(raw22-raw21)/calibrate2; readVcc(); delay(200); mySerial.println("AT+CMGF=1"); // Part of SMS sending delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.print("Turn "); mySerial.println(daynum); mySerial.print("Hive1 "); mySerial.print(delta01); mySerial.print(" "); mySerial.println(delta00); mySerial.print("Hive2 "); mySerial.print(delta11); mySerial.print(" "); mySerial.println(delta10); mySerial.print("Hive3 "); mySerial.print(delta21); mySerial.print(" "); mySerial.println(delta20); mySerial.print("Battery capacity is "); mySerial.print(ch1); mySerial.print(ch2); mySerial.print(ch3); mySerial.print(ch4); mySerial.println(" %"); if (forceSend) {mySerial.print("Forced SMS");} mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); } forceSend=false; digitalWrite(13, LOW); attachInterrupt(0, SendStat , RISING); // Interrupt by HIGH level } // ************************************************************************************************* void switchto9600() { mySerial.begin(115200); // Open software serial port delay(16000); // wait for boot mySerial.println("AT"); delay(200); mySerial.println("AT"); delay(200); mySerial.println("AT+IPR=9600"); // Change Serial Speed delay(200); mySerial.begin(9600); mySerial.println("AT&amp;W0"); delay(200); mySerial.println("AT&amp;W"); } void setup() { // Setup part run once, at start pinMode(13, OUTPUT); // Led pin init pinMode(2, INPUT_PULLUP); // Set pullup voltage Serial.begin(9600); // ------------------------------------------------------------------------------- switchto9600(); // switch module port speed // ------------------------------------------------------------------------------- mySerial.begin(9600); delay(200); scale[0] = &amp;scale0; //init scale scale[1] = &amp;scale1; scale[2] = &amp;scale2; scale0.set_scale(); scale1.set_scale(); scale2.set_scale(); delay(200); setZero=digitalRead(2); //if (EEPROM.read(500)==EEPROM.read(501) || setZero) // first boot/reset with hiding photoresistor if (setZero) { raw00=scale0.get_units(16); //read data from scales raw10=scale1.get_units(16); raw20=scale2.get_units(16); EEPROM.put(500, raw00); //write data to eeprom EEPROM.put(504, raw10); EEPROM.put(508, raw20); for (int i = 0; i &lt;= 24; i++) { //blinking LED13 on reset/first boot digitalWrite(13, HIGH); delay(500); digitalWrite(13, LOW); delay(500); } } else { EEPROM.get(500, raw00); // read data from eeprom after battery change EEPROM.get(504, raw10); EEPROM.get(508, raw20); digitalWrite(13, HIGH); // turn on LED 13 on 12sec. delay(12000); digitalWrite(13, LOW); } delay(200); // Test SMS at initial boot readVcc(); delay(200); mySerial.println("AT+CMGF=1"); delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.println("INITIAL BOOT OK"); mySerial.print("Battery capacity is "); mySerial.print(ch1); mySerial.print(ch2); mySerial.print(ch3); mySerial.print(ch4); mySerial.println(" %"); mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); raw02=raw00; raw12=raw10; raw22=raw20; attachInterrupt(0, SendStat , RISING); // Interrupt by HIGH level } void loop() { digitalWrite(13, LOW); ch=mySerial.read(); if ( ch=='R' ) { //wait first lerrer from "RING" string forceSend=true; mySerial.println("ATH"); SendStat(); ch=' '; } }</code> </pre> <br><p>  En la primera l√≠nea, entre comillas char phone_no [] = "+ 123456789012";  - en lugar de 123456789012 ponemos nuestro n√∫mero de tel√©fono con el c√≥digo del pa√≠s al que se enviar√°n los SMS. </p><br><p>  Haga clic en el bot√≥n de verificaci√≥n (encima del n√∫mero uno en la captura de pantalla anterior): si la compilaci√≥n est√° debajo (debajo del triple en la captura de pantalla), entonces podemos flashear el microcontrolador. </p><br><p>  Entonces, el USB-TTL est√° conectado al ARDUINO y a la computadora (como en la foto de arriba), colocamos la bater√≠a cargada en el soporte (generalmente en un nuevo arduino, el LED comienza a parpadear una vez por segundo). </p><br><p>  Ahora el firmware, estamos entrenando para presionar el bot√≥n rojo (plateado) del microcontrolador, ¬°esto tendr√° que hacerse estrictamente en un momento determinado! </p><br><p>  Hay  Haga clic en el bot√≥n "Cargar" (arriba de los dos en la captura de pantalla) y mire cuidadosamente la l√≠nea en la parte inferior de la interfaz (debajo de las tres pantallas). </p><br><p>  Tan pronto como la inscripci√≥n "compilaci√≥n" sea reemplazada por "descarga" - presione el bot√≥n rojo (reiniciar) - si todo est√° bien - el adaptador USB-TTL parpadea alegremente y la inscripci√≥n "Descargado" en la parte inferior de la interfaz </p><br><p>  Mientras esperamos que llegue el SMS de prueba al tel√©fono, le dir√© c√≥mo funciona el programa: </p><br><p>  La primera vez que se enciende el sistema, verifica los bytes 500 y 501 de la EEPROM; si son iguales, entonces los datos de calibraci√≥n no se han registrado y el algoritmo pasa a la secci√≥n de configuraci√≥n. </p><br><p>  Lo mismo sucede si, cuando se enciende, el fotorresistor est√° sombreado (con una tapa de un bol√≠grafo): se activa el modo de restablecimiento de par√°metros. </p><br><p>  Los medidores de tensi√≥n ya deber√≠an estar instalados debajo de las colmenas, ya que simplemente fijamos el nivel inicial de cero y luego medimos el cambio de peso (ahora vendr√°n ceros, ya que todav√≠a no hemos conectado nada). </p><br><p>  En arduino, el LED incorporado del pin 13 parpadear√°. <br>  Si no se produce el reinicio, el LED se ilumina durante 12 segundos. <br>  Despu√©s de eso, se env√≠a un SMS de prueba con el mensaje "INITIAL BOOT OK" y el porcentaje de carga de la bater√≠a. </p><br><p>  Adem√°s, tenemos una interrupci√≥n en el fotosensor que funciona en el segundo pin (m√°s la elevaci√≥n est√° habilitada por la funci√≥n pullup). <br>  En este caso, despu√©s de disparar durante otros 3 minutos, se verifica el estado del fotorresistor para excluir los positivos repetidos / falsos. <br>  Para evitar que el sistema se reinicie cada vez que se enciende, al menos el primer m√≥dulo HX711 debe estar conectado (pines DT-D10, SCK-A0) </p><br><p>  Luego se toman las lecturas de la celda de carga, se calcula el cambio de peso de la operaci√≥n anterior (el primer n√∫mero en la l√≠nea despu√©s de Hive) y desde el primer inicio, se verifica el voltaje de la bater√≠a y esta informaci√≥n se env√≠a en forma de SMS: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c63/a89/992/c63a89992a1311d828e3d9380ba45036.jpg" alt="Sistema de muestra"></p><br><p>  Por cierto, ¬ørecibiste SMS?  Felicidades  Estamos a medio camino!  Si bien la bater√≠a se puede quitar del soporte, ya no necesitaremos una computadora. </p><br><p>  Procedemos a la fabricaci√≥n de sensores, para empezar, veamos el dise√±o de los sensores: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/182/43b/cec/18243bcecc904c4018d7b2217cc72d9b.jpg" alt="Ubicaci√≥n del sensor"></p><br><p>  Este es el plan de la colmena: vista superior. </p><br><p>  Cl√°sicamente, se instalan 4 sensores en las esquinas (1,2,3,4) </p><br><p>  Mediremos de manera diferente.  O m√°s bien, incluso en el tercero.  Como los chicos de BroodMinder hacen diferente: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b49/fbe/1f3/b49fbe1f378d3e5b4b7320bf6ac83520.jpg" alt="Broodminder"></p><br><p>  En este dise√±o, los sensores se instalan en las posiciones 1 y 2, los puntos 3.4 se basan en el haz. <br>  Entonces solo la mitad del peso cae sobre los sensores. <br>  S√≠, tal m√©todo tiene menos precisi√≥n, pero es dif√≠cil imaginar que las abejas construyeron todos los marcos con "lenguas" de los panales a lo largo de una pared de la colmena. </p><br><p>  Por lo tanto, propongo reducir los sensores al punto 5 por completo, entonces no hay necesidad de proteger el sistema, y ‚Äã‚Äãcuando se usan colmenas ligeras, es completamente necesario hacerlo con un sensor. </p><br><p>  Entonces, en una colmena, instalaremos dos celdas de carga y un m√≥dulo HX711, el diagrama de cableado es el siguiente: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6d2/39b/bef/6d239bbef099b427b0f6127a323a7e69.jpg"></p><br><p>  Desde la placa ADC hasta el arduino hay 5 metros de un cable telef√≥nico de 4 n√∫cleos (en el caso de los m√≥dulos de peso 2 y 3), el primer sensor est√° conectado con una "cola" de 10 cm, pero m√°s sobre eso m√°s adelante. </p><br><p>  En general, en los sensores dejamos "colas" de 8 cm, limpiamos el par trenzado y soldamos todo como en la foto de arriba. </p><br><p>  Antes de comenzar la carpinter√≠a, coloque cera / parafina en un recipiente adecuado para derretir en un ba√±o de agua. </p><br><p>  Ahora tomamos nuestro haz y lo dividimos en tres segmentos de 100 mm. </p><br><p>  A continuaci√≥n, marque una ranura longitudinal de 25 mm de ancho, 7-8 mm de profundidad, con una sierra para metales y un cincel eliminamos el exceso; debe salir un perfil en forma de U. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/509/226/d98/509226d98d5b52f993b21c9e6679fc1a.jpg" alt="Los fundamentos"></p><br><p>  De hecho, necesitamos una parte en forma de H 1 y dos: P-shki, todas de 10 cm de largo. </p><br><p>  ¬øPor qu√© N-ka? No lo creas, esconde el Arduino en √©l: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/096/e6b/89d/096e6b89d4442e3bf898be19dae38566.jpg" alt="el milagro de la tecnolog√≠a hostil"></p><br><p>  Adem√°s, los enchufes 6P6C para conectar los sensores 2 y 3 tambi√©n est√°n conectados aqu√≠. </p><br><p>  Cera calentada?  - sumergemos nuestros tableros de ADC all√≠ - esto los proteger√° de la humedad / niebla: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/672/7f1/a576727f1b4385933b640b0dd1ef2a01.jpg" alt="Protecci√≥n ADC contra la humedad"></p><br><p>  Lo tenemos todo sobre una base de madera (es necesario tratarlo con un antis√©ptico contra la descomposici√≥n): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/a6b/347/a57a6b34743c1f8b8add453e729fadea.jpg" alt="Asamblea"></p><br><p>  Y finalmente, arreglamos los sensores con tornillos: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/94d/e43/541/94de435418f3d001e47b181935612e5f.jpg" alt="Sensor listo"></p><br><p>  A continuaci√≥n, soldamos todos los componentes restantes de acuerdo con el esquema en el encabezado y el sentido com√∫n. </p><br><h4 id="v-plane-raspolozheniya-komponentov-zhelatelno-proyavit-fantaziyu-stoit-uchityvat-odno---rasstoyanie-mezhdu-mikrokontrollerom-i-gsm-modulem-dolzhno-sostavlyat-ne-menee-odnogo-metra">  En t√©rminos de ubicaci√≥n de componentes, es recomendable mostrar imaginaci√≥n, una cosa a tener en cuenta: ¬°la distancia entre el microcontrolador y el m√≥dulo GSM debe ser de al menos un metro! </h4><br><p>  Tengo el siguiente dise√±o: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/828/60b/f5a/82860bf5acb8465591e4fa82f0d284da.jpg" alt="Final"></p><br><p>  S√≠, tom√© el √°ngulo de instalaci√≥n de los paneles 45 grados, debido a la simplicidad de fabricaci√≥n, pero est√° cerca de los cuarenta grados √≥ptimos para el verano en la latitud de Kiev. </p><br><p>  Eso es todo, ahora para la verificaci√≥n final, coloque los sensores en los sectores del c√≠rculo, en la parte superior: una pieza de madera contrachapada, ponga a cero el controlador (encienda el sistema con la tapa en el fotodiodo de la pluma estilogr√°fica). </p><br><p>  En este caso, el LED del arduino deber√≠a parpadear y deber√≠a aparecer un SMS de prueba. </p><br><p>  Luego retiramos la tapa de la fotoc√©lula y vamos a recoger agua en una botella de pl√°stico de 6 litros. <br>  Ponemos la botella en madera contrachapada y, si ya han pasado varios minutos desde que se encendi√≥, vuelva a colocar la tapa en el fotorresistor (simulando la puesta de sol). </p><br><p>  Al mismo tiempo, el LED del arduino se iluminar√° y deber√≠a recibir un SMS con un valor de peso de aproximadamente 4 kg en todas las posiciones. </p><br><p>  Felicidades  ¬°El sistema se ha ensamblado con √©xito! </p><br><p>  Si ahora hacemos que el sistema vuelva a funcionar, entonces en la primera columna del peso obtenemos ceros. </p><br><p>  S√≠, en condiciones reales es deseable orientar la fotorresistencia verticalmente hacia arriba. </p><br><p>  Ahora dar√© un breve manual sobre el uso de: </p><br><ol><li>  Instale medidores de tensi√≥n debajo de las paredes traseras de las colmenas (debajo de la parte delantera sustituya una viga / tabla de ~ 30 mm de espesor) </li><li>  Instale un m√≥dulo de comunicaci√≥n con paneles solares en una elevaci√≥n, a pocos metros de las colmenas. <br>  La orientaci√≥n de los paneles solares, hacia el sur, se puede abarcar (no atraparemos el verdadero). </li><li>  Sombree el fotorresistor y coloque la bater√≠a: el LED deber√≠a parpadear y deber√≠a aparecer un SMS de prueba con el texto "INICIAL INICIAL" <br>  Cada tarde, despu√©s del atardecer, los SMS llegar√°n con un cambio de peso por d√≠a y desde el momento del lanzamiento. <br>  Al hacer una llamada al n√∫mero de la tarjeta SIM del m√≥dulo GSM, el controlador se descuelga (escuchamos "El suscriptor no puede recibir la llamada") y llega un SMS con mediciones extraordinarias. <br>  En dicho mensaje habr√° una l√≠nea adicional: "SMS forzado"; </li></ol><br><p>  Queda muy poco para la belleza completa del sistema: </p><br><ol><li>  Agregue el sistema autom√°tico del dispositivo en el fotosensor. </li><li>  Verifique otros tipos de m√≥dulos de comunicaci√≥n. </li><li>  Para hacer todo bajo ESP-8266, en primer lugar, admite actualizaciones de firmware "por aire", es conveniente. </li></ol><br><p>  En segundo lugar, puede proporcionar estad√≠sticas en forma de p√°ginas web simples. <br>  Y finalmente, si tiene Wi-Fi, puede rechazar completamente GSM-ki. </p><br><p>  Ah, s√≠, estoy cansado de que algo est√© jugando con cables, y promet√≠ un sistema con ahorro de energ√≠a "absoluto". </p><br><p>  En una palabra, decid√≠ jugar un poco "tonto" y hacerlo todo. <br>  ¬°Cu√°nto √©xito, lea la publicaci√≥n en un mes! </p><br><p>  Nos vemos en las p√°ginas de Habr-a, <br>  Apicultor el√©ctrico Andrey </p><br><p>  PD Para nuevas publicaciones sobre este tema, vea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">beefree.xyz</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448274/">https://habr.com/ru/post/448274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448264/index.html">Nada de l√≠pidos fr√≠os: previene la cristalizaci√≥n del agua a -263 ¬∞ C</a></li>
<li><a href="../448266/index.html">Telefoneado! C√≥mo armar tu marcador web en una hora</a></li>
<li><a href="../448268/index.html">Sistemas telef√≥nicos en caja</a></li>
<li><a href="../448270/index.html">Cambiar la configuraci√≥n del programa mientras se mantiene la configuraci√≥n personal</a></li>
<li><a href="../448272/index.html">¬øPor qu√© roci√≥ espec√≠ficamente el avi√≥n antes de la salida, y qu√© suceder√° si esto no se hace?</a></li>
<li><a href="../448276/index.html">C√≥mo vive Alfa Bank en un per√≠odo de cambio y qu√© logramos hacer al combinar el desarrollo de TI y Alfa Lab</a></li>
<li><a href="../448278/index.html">Hipoteca t√©cnica: qu√© y a qui√©n debe el equipo</a></li>
<li><a href="../448280/index.html">Test drive nanoCAD SPDS Metalwork 1.2. Parte 2</a></li>
<li><a href="../448286/index.html">Noticias del mundo de OpenStreetMap No. 455 (04/02/2019 - 04/04/2019)</a></li>
<li><a href="../448288/index.html">Usar C ++ y plantillas con un n√∫mero variable de argumentos al programar microcontroladores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>