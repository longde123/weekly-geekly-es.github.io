<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüéì ‚èπÔ∏è üé∏ Go pratique: conseils pour √©crire des programmes pris en charge dans le monde r√©el üèº üë∞üèº üëéüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article se concentre sur les meilleures pratiques pour √©crire du code Go. Il est compos√© dans le style de pr√©sentation, mais sans les diapositives...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Go pratique: conseils pour √©crire des programmes pris en charge dans le monde r√©el</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441842/">  Cet article se concentre sur les meilleures pratiques pour √©crire du code Go.  Il est compos√© dans le style de pr√©sentation, mais sans les diapositives habituelles.  Nous allons essayer de parcourir bri√®vement et clairement chaque √©l√©ment. <br><br>  Vous devez d'abord convenir de ce que signifient les <i>meilleures</i> pratiques pour un langage de programmation.  Ici, vous pouvez vous rappeler les mots de Russ Cox, directeur technique de Go: <br><br><blockquote>  Le g√©nie logiciel est ce qui arrive √† la programmation, si vous ajoutez le facteur temps et d'autres programmeurs. </blockquote><br>  Ainsi, Russ fait la distinction entre les concepts de <i>programmation</i> et <i>de g√©nie logiciel</i> .  Dans le premier cas, vous √©crivez un programme pour vous-m√™me, dans le second, vous cr√©ez un produit sur lequel d'autres programmeurs travailleront au fil du temps.  Les ing√©nieurs vont et viennent.  Les √©quipes s'agrandissent ou se r√©tr√©cissent.  De nouvelles fonctionnalit√©s sont ajout√©es et des bugs sont corrig√©s.  Telle est la nature du d√©veloppement logiciel. <br><a name="habracut"></a><br><a name="0"></a><h1>  Table des mati√®res </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Table des mati√®res</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1. Principes fondamentaux</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Simplicit√©</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lisibilit√©</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1.3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La productivit√©</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2. Identifiants</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Identificateurs de nom bas√©s sur la clart√© plut√¥t que sur la bri√®vet√©</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Longueur ID</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ne nommez pas les variables par type</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Utilisez un seul style de d√©nomination</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Utilisez un style de d√©claration unique</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2.6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Travailler pour l'√©quipe</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3. Commentaires</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les commentaires dans les variables et les constantes doivent d√©crire leur contenu, pas leur objectif</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Documentez toujours les caract√®res accessibles au public</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4. Structure du package</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un bon package commence par un bon nom</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âvitez les noms comme base, commun ou util</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Revenez rapidement sans plonger profond√©ment</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rendre la valeur nulle utile</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4.5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âvitez l'√©tat au niveau du package</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5. Structure du projet</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Moins de paquets mais plus gros</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le plus petit paquet principal</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6. Structure de l'API</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API de conception difficiles √† abuser par conception</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Concevoir une API pour un cas d'utilisation de base</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6.3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Laissez les fonctions d√©terminer le comportement souhait√©.</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">7. Gestion des erreurs</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">7.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√âlimine le besoin de gestion des erreurs en supprimant les erreurs elles-m√™mes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">7.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Traiter l'erreur une seule fois</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">8. Concurrence</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">8.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Faites du travail tout le temps.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">8.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Laisser le parall√©lisme √† l'appelant</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">8.3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ne courez jamais de goroutine sans savoir quand elle s'arr√™tera</a> </li></ul></li></ul><br><a name="1"></a><h1>  1. Principes fondamentaux </h1><br>  Je suis peut-√™tre l'un des premiers utilisateurs de Go parmi vous, mais ce n'est pas mon opinion personnelle.  Ces principes de base sous-tendent Go lui-m√™me: <br><br><ol><li>  Simplicit√© </li><li>  Lisibilit√© </li><li>  La productivit√© </li></ol><br>  <i>Remarque</i>  <i>Veuillez noter que je n'ai pas mentionn√© ¬´performance¬ª ou ¬´simultan√©it√©¬ª.</i>  <i>Il existe des langues plus rapides que Go, mais elles ne peuvent certainement pas √™tre compar√©es en termes de simplicit√©.</i>  <i>Il existe des langages qui placent le parall√©lisme au premier rang des priorit√©s, mais ils ne peuvent √™tre compar√©s en termes de lisibilit√© ou de productivit√© de programmation.</i> <i><br><br></i>  <i>Les performances et la simultan√©it√© sont des attributs importants, mais pas aussi importants que la simplicit√©, la lisibilit√© et la productivit√©.</i> <br><br><a name="1_1"></a><h2>  Simplicit√© </h2><br><blockquote>  <i>¬´La simplicit√© est une condition pr√©alable √† la fiabilit√©¬ª</i> - Edsger Dijkstra </blockquote><br>  Pourquoi viser la simplicit√©?  Pourquoi est-il important que les programmes Go soient simples? <br><br>  Chacun de nous est tomb√© sur un code incompr√©hensible, non?  Lorsque vous avez peur de faire un changement, car cela interrompra une autre partie du programme que vous ne comprenez pas bien et que vous ne savez pas comment r√©soudre.  Telle est la difficult√©. <br><br><blockquote>  <i>¬´Il y a deux fa√ßons de concevoir un logiciel: la premi√®re consiste √† le rendre si simple qu'il n'y a pas de d√©fauts √©vidents, et la seconde est de le rendre si complexe qu'il n'y a pas de d√©fauts √©vidents.</i>  <i>Le premier est beaucoup plus difficile. ¬ª</i> - C.E. R. Hoar </blockquote><br>  La complexit√© transforme un logiciel fiable en peu fiable.  La complexit√© est ce qui tue les projets logiciels.  Par cons√©quent, la simplicit√© est l'objectif ultime de Go.  Quels que soient les programmes que nous √©crivons, ils devraient √™tre simples. <br><br><a name="1_2"></a><h2>  1.2.  Lisibilit√© </h2><br><blockquote>  <i>¬´La lisibilit√© fait partie int√©grante de la maintenabilit√©¬ª</i> - Mark Reinhold, JVM Conference, 2018 </blockquote><br>  Pourquoi est-il important que le code soit lisible?  Pourquoi devrions-nous nous efforcer de lisibilit√©? <br><br><blockquote>  <i>¬´Les programmes doivent √™tre √©crits pour les gens, et les machines doivent simplement les ex√©cuter¬ª</i> - Hal Abelson et Gerald Sassman, ¬´Structure et interpr√©tation des programmes informatiques¬ª </blockquote><br>  Non seulement les programmes Go, mais g√©n√©ralement tous les logiciels sont √©crits par des personnes pour des personnes.  Le fait que les machines traitent √©galement le code est secondaire. <br><br>  Une fois √©crit, le code sera lu √† plusieurs reprises par des personnes: des centaines, voire des milliers de fois. <br><br><blockquote>  <i>¬´La comp√©tence la plus importante pour un programmeur est la capacit√© de communiquer efficacement des id√©es.¬ª</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gaston Horker</a> </blockquote><br>  La lisibilit√© est la cl√© pour comprendre ce que fait un programme.  Si vous ne comprenez pas le code, comment le maintenir?  Si le logiciel ne peut pas √™tre pris en charge, il sera r√©√©crit;  et c'est peut-√™tre la derni√®re fois que votre entreprise utilise Go. <br><br>  Si vous √©crivez un programme pour vous-m√™me, faites ce qui vous convient.  Mais si cela fait partie d'un projet commun ou si le programme sera utilis√© assez longtemps pour changer les exigences, les fonctions ou l'environnement dans lequel il fonctionne, alors votre objectif est de rendre le programme maintenable. <br><br>  La premi√®re √©tape pour √©crire un logiciel pris en charge est de s'assurer que le code est clair. <br><br><a name="1_3"></a><h2>  1.3.  La productivit√© </h2><br><blockquote>  <i>¬´Le design est l'art d'organiser le code pour qu'il fonctionne aujourd'hui, mais il soutient toujours le changement.¬ª</i> - Sandy Mets </blockquote><br>  Comme dernier principe de base, je veux nommer la productivit√© du d√©veloppeur.  C'est un gros sujet, mais cela se r√©sume au rapport: combien de temps vous passez sur un travail utile et combien - en attendant une r√©ponse d'outils ou d'errances d√©sesp√©r√©es dans une base de code incompr√©hensible.  Les programmeurs de Go devraient sentir qu'ils peuvent g√©rer beaucoup de travail. <br><br>  C'est une blague que le langage Go a √©t√© d√©velopp√© pendant la compilation du programme C ++.  La compilation rapide est une caract√©ristique cl√© de Go et un facteur cl√© pour attirer de nouveaux d√©veloppeurs.  Bien que les compilateurs soient am√©lior√©s, en g√©n√©ral, la compilation de minutes dans d'autres langues prend quelques secondes sur Go.  Les d√©veloppeurs de Go sont donc aussi productifs que les programmeurs dans les langages dynamiques, mais sans aucun probl√®me avec la fiabilit√© de ces langages. <br><br>  Si nous parlons fondamentalement de la productivit√© des d√©veloppeurs, les programmeurs Go comprennent que la lecture de code est essentiellement plus importante que son √©criture.  Dans cette logique, Go va m√™me jusqu'√† utiliser les outils pour formater tout le code dans un certain style.  Cela √©limine la moindre difficult√© √† apprendre le dialecte sp√©cifique d'un projet particulier et aide √† identifier les erreurs car elles <i>semblent</i> fausses par rapport au code normal. <br><br>  Les programmeurs Go ne passent pas des jours √† d√©boguer des erreurs de compilation √©tranges, des scripts de construction complexes ou √† d√©ployer du code dans un environnement de production.  Et surtout, ils ne perdent pas de temps √† essayer de comprendre ce qu'un coll√®gue a √©crit. <br><br>  Lorsque les d√©veloppeurs Go parlent d' <i>√©volutivit√©</i> , ils parlent de productivit√©. <br><br><a name="2"></a><h1>  2. Identifiants </h1><br>  Le premier sujet que nous aborderons - les <i>identificateurs</i> , est un synonyme de <i>noms</i> : noms de variables, fonctions, m√©thodes, types, packages, etc. <br><br><blockquote>  <i>¬´Le mauvais nom est un sympt√¥me d'une mauvaise conception¬ª</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dave Cheney</a> </blockquote><br>  √âtant donn√© la syntaxe limit√©e de Go, les noms d'objets ont un impact √©norme sur la lisibilit√© du programme.  La lisibilit√© est un facteur cl√© d'un bon code, il est donc crucial de choisir de bons noms. <br><br><a name="2_1"></a><h2>  2.1.  Identificateurs de nom bas√©s sur la clart√© plut√¥t que sur la bri√®vet√© </h2><br><blockquote>  <i>¬´Il est important que le code soit √©vident.</i>  <i>Ce que vous pouvez faire en une ligne, vous devez le faire en trois. ¬ª</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ukia Smith</a> </blockquote><br>  Go n'est pas optimis√© pour les lignes simples d√©licates ou le nombre minimum de lignes dans un programme.  Nous n'optimisons pas la taille du code source sur le disque, ni le temps n√©cessaire pour taper le programme dans l'√©diteur. <br><br><blockquote>  <i>¬´Un bon nom est comme une bonne blague.</i>  <i>Si vous avez besoin de l'expliquer, alors ce n'est plus dr√¥le. ¬ª</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dave Cheney</a> </blockquote><br>  La cl√© d'une clart√© maximale r√©side dans les noms que nous choisissons pour identifier les programmes.  Quelles qualit√©s sont inh√©rentes √† une bonne r√©putation? <br><br><ul><li>  <b>Un bon nom est concis</b> .  Il ne doit pas n√©cessairement √™tre le plus court, mais ne contient pas d'exc√®s.  Il a un rapport signal / bruit √©lev√©. </li><li>  <b>Un bon nom est descriptif</b> .  Il d√©crit l'utilisation d'une variable ou d'une constante, <i>pas le</i> contenu.  Un bon nom d√©crit le r√©sultat d'une fonction ou le comportement d'une m√©thode, <i>pas une</i> impl√©mentation.  Le but de l'emballage, <i>pas</i> son contenu.  Plus le nom d√©crit avec pr√©cision la chose qui l'identifie, mieux c'est. </li><li>  <b>Un bon nom est pr√©visible</b> .  Par un nom, vous devez comprendre comment l'objet sera utilis√©.  Les noms doivent √™tre descriptifs, mais il est √©galement important de suivre la tradition.  C'est ce que les programmeurs Go veulent dire quand ils disent <i>"idiomatique"</i> . </li></ul><br>  Examinons plus en d√©tail chacune de ces propri√©t√©s. <br><br><a name="2_2"></a><h2>  2.2.  Longueur ID </h2><br>  Parfois, le style de Go est critiqu√© pour les noms de variables courts.  Comme l'a dit Rob Pike, "les programmeurs Go veulent des identifiants de la <i>bonne</i> longueur." <br><br>  Andrew Gerrand propose des identifiants plus longs pour indiquer l'importance. <br><br><blockquote>  <i>¬´Plus la distance entre la d√©claration d'un nom et l'utilisation d'un objet est grande, plus le nom doit √™tre long¬ª</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Andrew Gerrand</a> </blockquote><br>  Ainsi, quelques recommandations peuvent √™tre faites: <br><br><ul><li>  Les noms de variables courts sont bons si la distance entre la d√©claration et la <i>derni√®re</i> utilisation est petite. <br></li><li>  Les noms de variables longs doivent se justifier;  plus ils sont longs, plus ils devraient √™tre importants.  Les titres verbeux contiennent peu de signal par rapport √† leur poids sur la page. <br></li><li>  N'incluez pas le nom du type dans le nom de la variable. <br></li><li>  Les noms de constantes doivent d√©crire la valeur interne, pas comment la valeur est utilis√©e. <br></li><li>  Pr√©f√©rez les variables √† une lettre pour les boucles et les branches, des mots s√©par√©s pour les param√®tres et les valeurs de retour, plusieurs mots pour les fonctions et les d√©clarations au niveau du package. <br></li><li>  Pr√©f√©rez des mots simples pour les m√©thodes, les interfaces et les packages. <br></li><li>  N'oubliez pas que le nom du package fait partie du nom que l'appelant utilise pour r√©f√©rence. </li></ul><br>  Prenons un exemple. <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Person <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Age <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> } <span class="hljs-comment"><span class="hljs-comment">// AverageAge returns the average age of people. func AverageAge(people []Person) int { if len(people) == 0 { return 0 } var count, sum int for _, p := range people { sum += p.Age count += 1 } return sum / count }</span></span></code> </pre> <br>  Dans la dixi√®me ligne, une variable de plage <code>p</code> d√©clar√©e et elle n'est appel√©e qu'une seule fois √† partir de la ligne suivante.  Autrement dit, la variable vit sur la page pendant tr√®s peu de temps.  Si le lecteur s'int√©resse au r√¥le de <code>p</code> dans le programme, il n'a qu'√† lire deux lignes. <br><br>  A titre de comparaison, les <code>people</code> d√©clar√©es dans les param√®tres de fonction et sept lignes sont en direct.  Il en va de m√™me pour la <code>sum</code> et le <code>count</code> , ils justifient donc leurs noms plus longs.  Le lecteur doit scanner plus de code pour les trouver: cela justifie les noms les plus distingu√©s. <br><br>  Vous pouvez choisir <code>s</code> pour <code>sum</code> et <code>c</code> (ou <code>n</code> ) pour <code>count</code> , mais cela r√©duit l'importance de toutes les variables du programme au m√™me niveau.  Vous pouvez remplacer les <code>people</code> par <code>p</code> , mais il y aura un probl√®me, comment appeler la variable d'it√©ration <code>for ... range</code> .  Une seule <code>person</code> aura l'air √©trange, car une variable d'it√©ration de courte dur√©e obtient un nom plus long que plusieurs valeurs dont elle est d√©riv√©e. <br><br><blockquote>  <b>Astuce</b> .  S√©parez le flux de fonctions par des lignes vides, car les lignes vides entre les paragraphes interrompent le flux de texte.  Dans <code>AverageAge</code> , nous avons trois op√©rations cons√©cutives.  Tout d'abord, v√©rifier la division par z√©ro, puis la conclusion de l'√¢ge total et du nombre de personnes, et la derni√®re - le calcul de l'√¢ge moyen. </blockquote><br><h3>  2.2.1.  L'essentiel est le contexte </h3><br>  Il est important de comprendre que la plupart des conseils de d√©nomination sont sp√©cifiques au contexte.  J'aime dire que c'est un principe, pas une r√®gle. <br><br>  Quelle est la diff√©rence entre <code>i</code> et <code>index</code> ?  Par exemple, vous ne pouvez pas dire sans √©quivoque qu'un tel code <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> index := <span class="hljs-number"><span class="hljs-number">0</span></span>; index &lt; <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(s); index++ { <span class="hljs-comment"><span class="hljs-comment">// }</span></span></code> </pre> <br>  fondamentalement plus lisible que <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(s); i++ { <span class="hljs-comment"><span class="hljs-comment">// }</span></span></code> </pre> <br>  Je crois que la deuxi√®me option n'est pas pire, car dans ce cas, la r√©gion <code>i</code> ou l' <code>index</code> limit√©e par le corps de la boucle <code>for</code> , et la verbosit√© suppl√©mentaire ajoute peu √† la compr√©hension du programme. <br><br>  Mais laquelle de ces fonctions est la plus lisible? <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s *SNMP)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(oid []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, index </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span></code> </pre> <br>  ou <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s *SNMP)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(o []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, i </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span></code> </pre> <br>  Dans cet exemple, <code>oid</code> est une abr√©viation de SNMP Object ID, et l'abr√©viation suppl√©mentaire de <code>o</code> oblige lors de la lecture du code √† passer d'une notation document√©e √† une notation plus courte dans le code.  De m√™me, la r√©duction de l' <code>index</code> √† <code>i</code> rend la compr√©hension plus difficile, car dans les messages SNMP, la sous-valeur de chaque OID est appel√©e index. <br><br><blockquote>  <b>Astuce</b> .  Ne combinez pas les param√®tres formels longs et courts dans une seule annonce. </blockquote><br><a name="2_3"></a><h2>  2.3.  Ne nommez pas les variables par type </h2><br>  Vous n'appelez pas vos animaux de compagnie "chien" et "chat", non?  Pour la m√™me raison, vous ne devez pas inclure le nom du type dans le nom de la variable.  Il doit d√©crire le contenu, pas son type.  Prenons un exemple: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> usersMap <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]*User</code> </pre> <br>  √Ä quoi sert cette annonce?  Nous voyons que c'est une carte, et cela a quelque chose √† voir avec le <code>*User</code> type d' <code>*User</code> : c'est probablement bon.  Mais <code>usersMap</code> est <i>vraiment une</i> carte, et Go en tant que langage de type statique ne permettra pas d'utiliser accidentellement un tel nom o√π une variable scalaire est requise, donc le suffixe <code>Map</code> est redondant. <br><br>  Consid√©rez une situation o√π d'autres variables sont ajout√©es: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ( companiesMap <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]*Company productsMap <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]*Products )</code> </pre> <br>  Nous avons maintenant trois variables de type map: <code>usersMap</code> , <code>companiesMap</code> et <code>productsMap</code> , et toutes les lignes sont mapp√©es √† diff√©rents types.  Nous savons que ce sont des cartes et nous savons √©galement que le compilateur g√©n√©rera une erreur si nous essayons d'utiliser <code>companiesMap</code> l√† o√π le code attend <code>map[string]*User</code> .  Dans cette situation, il est clair que le suffixe <code>Map</code> n'am√©liore pas la clart√© du code, ce ne sont que des caract√®res suppl√©mentaires. <br><br>  Je sugg√®re d'√©viter tout suffixe qui ressemble au type d'une variable. <br><br><blockquote>  <b>Astuce</b> .  Si le nom des <code>users</code> ne d√©crit pas l'essence de mani√®re suffisamment claire, alors <code>usersMap</code> aussi. </blockquote><br>  Cette astuce s'applique √©galement aux param√®tres de fonction.  Par exemple: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Config <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { <span class="hljs-comment"><span class="hljs-comment">// } func WriteConfig(w io.Writer, config *Config)</span></span></code> </pre> <br>  Le nom de <code>*Config</code> param√®tre <code>*Config</code> est redondant.  Nous savons d√©j√† qu'il s'agit de <code>*Config</code> , il est imm√©diatement √©crit √† c√¥t√©. <br><br>  Dans ce cas, consid√©rez <code>conf</code> ou <code>c</code> si la dur√©e de vie de la variable est suffisamment courte. <br><br>  Si √† un moment donn√© dans notre r√©gion il y a plus d'une <code>*Config</code> , alors les noms <code>conf1</code> et <code>conf2</code> moins significatifs que l' <code>original</code> et <code>updated</code> , car ces derniers sont plus difficiles √† m√©langer. <br><br><blockquote>  <b>Remarque</b>  Ne laissez pas les noms de package voler de bons noms de variables. <br><br>  Le nom de l'identifiant import√© contient le nom du package.  Par exemple, le type de <code>Context</code> dans le package de <code>context</code> sera appel√© <code>context.Context</code> .  Cela rend impossible l'utilisation d'une variable ou d'un type de <code>context</code> dans votre package. <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context context.Context, message </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre> <br>  Cela ne se compilera pas.  C'est pourquoi lors de la d√©claration de types <code>ctx</code> localement, par exemple, des noms comme <code>ctx</code> sont traditionnellement utilis√©s. <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx context.Context, message </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span></code> </pre> </blockquote><br><a name="2_4"></a><h2>  2.4.  Utilisez un seul style de d√©nomination </h2><br>  Une autre propri√©t√© d'une bonne r√©putation est qu'elle doit √™tre pr√©visible.  Le lecteur doit le comprendre imm√©diatement.  S'il s'agit d'un nom <i>commun</i> , le lecteur a le droit de supposer qu'il n'a pas chang√© le sens par rapport √† la fois pr√©c√©dente. <br><br>  Par exemple, si le code fait le tour du descripteur de base de donn√©es, chaque fois que le param√®tre est affich√©, il doit avoir le m√™me nom.  Au lieu de toutes sortes de combinaisons comme <code>d *sql.DB</code> , <code>dbase *sql.DB</code> , <code>DB *sql.DB</code> et <code>database *sql.DB</code> il est pr√©f√©rable d'utiliser une chose: <br><br><pre> <code class="go hljs">db *sql.DB</code> </pre> <br>  Il est plus facile de comprendre le code.  Si vous voyez <code>db</code> , alors vous savez qu'il s'agit de <code>*sql.DB</code> et qu'il est d√©clar√© localement ou fourni par l'appelant. <br><br>  Conseils similaires concernant les destinataires d'une m√©thode;  utilisez le m√™me nom de destinataire pour chaque m√©thode de ce type.  Il sera donc plus facile pour le lecteur d'apprendre l'utilisation du destinataire parmi les diff√©rentes m√©thodes de ce type. <br><br><blockquote>  <b>Remarque</b>  L'accord sur le nom abr√©g√© du destinataire Go est en contradiction avec les recommandations exprim√©es pr√©c√©demment.  C'est l'un de ces cas o√π le choix fait √† un stade pr√©coce devient le style standard, comme l'utilisation de <code>CamelCase</code> au lieu de <code>snake_case</code> . </blockquote><br><blockquote>  <b>Astuce</b> .  Le style Go pointe vers des noms √† une seule lettre ou des abr√©viations pour les destinataires d√©riv√©s de leur type.  Il peut s'av√©rer que le nom du destinataire entre parfois en conflit avec le nom du param√®tre dans la m√©thode.  Dans ce cas, il est recommand√© d'allonger un peu le nom du param√®tre et de ne pas l'oublier. </blockquote><br>  Enfin, certaines variables d'une lettre sont traditionnellement associ√©es aux boucles et au comptage.  Par exemple, <code>i</code> , <code>j</code> et <code>k</code> sont g√©n√©ralement des variables inductives dans les boucles <code>for</code> , <code>n</code> g√©n√©ralement associ√© √† un compteur ou un additionneur cumulatif, <code>v</code> est une abr√©viation typique pour la valeur dans une fonction de codage, <code>k</code> g√©n√©ralement utilis√© pour une cl√© de mappage et <code>s</code> souvent utilis√© comme abr√©viation pour les param√®tres de type <code>string</code> . <br><br>  Comme avec l'exemple <code>db</code> ci-dessus, les programmeurs <i>s'attendent</i> <code>i</code> <i>ce que</i> <code>i</code> soit une variable inductive.  S'ils le voient dans le code, ils s'attendent √† voir une boucle bient√¥t. <br><br><blockquote>  <b>Astuce</b> .  Si vous avez tellement de boucles imbriqu√©es que vous n'avez plus de variables <code>i</code> , <code>j</code> et <code>k</code> , vous souhaiterez peut-√™tre diviser la fonction en unit√©s plus petites. </blockquote><br><a name="2_5"></a><h2>  2.5.  Utilisez un style de d√©claration unique </h2><br>  Go a au moins six fa√ßons diff√©rentes de d√©clarer une variable. <br><br><ul><li><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </li><li><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </li><li><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>; x = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </li><li><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> </li><li><pre> <code class="go hljs">x := <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </li></ul><br>  Je suis s√ªr que je ne me suis pas encore souvenu de tout.  Les d√©veloppeurs de Go consid√®rent probablement cela comme une erreur, mais il est trop tard pour changer quoi que ce soit.  Avec ce choix, comment assurer un style uniforme? <br><br>  Je veux proposer un style de d√©claration de variables que j'essaie moi-m√™me d'utiliser dans la mesure du possible. <br><br><ul><li>  <b>Lorsque vous d√©clarez une variable sans initialisation, utilisez <code>var</code></b> . <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> players <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-comment"><span class="hljs-comment">// 0 var things []Thing // an empty slice of Things var thing Thing // empty Thing struct json.Unmarshall(reader, &amp;thing)</span></span></code> </pre> <br>  <code>var</code> agit comme un indice que cette variable est <i>intentionnellement</i> d√©clar√©e comme une valeur nulle du type sp√©cifi√©.  Ceci est coh√©rent avec l'exigence de d√©clarer des variables au niveau du package avec <code>var</code> par opposition √† la syntaxe de d√©claration courte, bien que je soutienne plus tard que les variables au niveau du package ne devraient pas √™tre utilis√©es du tout. </li><li>  <b>Lors de la d√©claration avec initialisation, utilisez <code>:=</code></b> .  Cela montre clairement au lecteur que la variable √† gauche de <code>:=</code> intentionnellement initialis√©e. <br><br>  Pour expliquer pourquoi, regardons l'exemple pr√©c√©dent, mais cette fois nous initialisons sp√©cialement chaque variable: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> players <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> things []Thing = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thing *Thing = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(Thing) json.Unmarshall(reader, thing)</code> </pre> </li></ul><br>  √âtant donn√© que Go n'a pas de conversions automatiques d'un type √† un autre, dans les premier et troisi√®me exemples, le type sur le c√¥t√© gauche de l'op√©rateur d'affectation doit √™tre identique au type sur le c√¥t√© droit.  Le compilateur peut d√©duire le type de la variable d√©clar√©e √† partir du type de droite, donc l'exemple peut √™tre √©crit de mani√®re plus concise: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> players = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> things []Thing = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thing = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(Thing) json.Unmarshall(reader, thing)</code> </pre> <br>  Ici, les <code>players</code> explicitement initialis√©s √† <code>0</code> , ce qui est redondant, car la valeur initiale des <code>players</code> est nulle dans tous les cas.  Par cons√©quent, il est pr√©f√©rable de pr√©ciser que nous voulons utiliser une valeur nulle: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> players <span class="hljs-keyword"><span class="hljs-keyword">int</span></span></code> </pre> <br>  Et le deuxi√®me op√©rateur?  Nous ne pouvons pas d√©terminer le type et √©crire <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> things = <span class="hljs-literal"><span class="hljs-literal">nil</span></span></code> </pre> <br>  Parce que <code>nil</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pas de type</a> .  Au lieu de cela, nous avons le choix: ou nous utilisons une valeur nulle pour trancher ... <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> things []Thing</code> </pre> <br>  ... ou cr√©er une tranche avec z√©ro √©l√©ment? <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> things = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>([]Thing, <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  Dans le second cas, la valeur de la tranche n'est <i>pas</i> nulle, et nous le pr√©cisons au lecteur en utilisant une forme courte de d√©claration: <br><br><pre> <code class="go hljs">things := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>([]Thing, <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  Cela indique au lecteur que nous avons d√©cid√© d'initialiser explicitement les <code>things</code> . <br><br>  Nous arrivons donc √† la troisi√®me d√©claration: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thing = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(Thing)</code> </pre> <br>  Ici, √† la fois l'initialisation explicite de la variable et l'introduction du <code>new</code> mot-cl√© ¬´unique¬ª, que certains programmeurs Go n'aiment pas.  Utilisation des rendements de syntaxe courts recommand√©s <br><br><pre> <code class="go hljs">thing := <span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(Thing)</code> </pre> <br>  Cela montre clairement que la <code>thing</code> explicitement initialis√©e au r√©sultat de <code>new(Thing)</code> , mais laisse toujours un <code>new</code> atypique.  Le probl√®me pourrait √™tre r√©solu en utilisant un litt√©ral: <br><br><pre> <code class="go hljs">thing := &amp;Thing{}</code> </pre> <br>  Ce qui est similaire √† <code>new(Thing)</code> , et une telle duplication d√©range certains programmeurs Go.  Cependant, cela signifie que nous initialisons explicitement la <code>thing</code> avec un pointeur sur <code>Thing{}</code> et une valeur <code>Thing</code> de z√©ro. <br><br>  Mais il vaut mieux prendre en compte le fait que la <code>thing</code> d√©clar√©e avec une valeur nulle, et utiliser l'adresse de l'op√©rateur pour passer l'adresse de la <code>thing</code> dans <code>json.Unmarshall</code> : <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thing Thing json.Unmarshall(reader, &amp;thing)</code> </pre> <br><blockquote>  <b>Remarque</b>  Bien s√ªr, il existe des exceptions √† toute r√®gle.  Par exemple, parfois deux variables sont √©troitement li√©es, il sera donc √©trange d'√©crire <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> min <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> max := <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre> <br>  D√©claration plus lisible: <br><br><pre> <code class="go hljs">min, max := <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre> </blockquote><br>  Pour r√©sumer: <br><br><ul><li>  Lorsque vous d√©clarez une variable sans initialisation, utilisez la syntaxe <code>var</code> . <br></li><li>  Lors de la d√©claration et de l'initialisation explicite d'une variable, utilisez <code>:=</code> . </li></ul><br><blockquote>  <b>Astuce</b> .  Soulignez explicitement des choses complexes. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> length <span class="hljs-keyword"><span class="hljs-keyword">uint32</span></span> = <span class="hljs-number"><span class="hljs-number">0x80</span></span></code> </pre> <br>  Ici, la <code>length</code> peut √™tre utilis√©e avec la biblioth√®que, qui n√©cessite un type num√©rique sp√©cifique, et cette option indique plus clairement que la longueur du type est sp√©cifiquement choisie comme uint32 que dans la d√©claration courte: <br><br><pre> <code class="go hljs">length := <span class="hljs-keyword"><span class="hljs-keyword">uint32</span></span>(<span class="hljs-number"><span class="hljs-number">0x80</span></span>)</code> </pre> <br>  Dans le premier exemple, j'ai viol√© intentionnellement ma r√®gle en utilisant la d√©claration var avec une initialisation explicite.  Une d√©rogation √† la norme fait comprendre au lecteur que quelque chose d'inhabituel se produit. </blockquote><br><a name="2_6"></a><h2>  2.6.  Travailler pour l'√©quipe </h2><br>  J'ai d√©j√† dit que l'essence du d√©veloppement logiciel est la cr√©ation de code pris en charge lisible.  La majeure partie de votre carri√®re sera probablement consacr√©e √† des projets communs.  Mon conseil dans cette situation: suivez le style adopt√© dans l'√©quipe. <br><br>  Changer de style au milieu du fichier est ennuyeux.  La coh√©rence est importante, mais au d√©triment des pr√©f√©rences personnelles.  Ma r√®gle d'or est la suivante: si le code passe par <code>gofmt</code> , le probl√®me ne vaut g√©n√©ralement pas la peine d'√™tre discut√©. <br><br><blockquote>  <b>Astuce</b> .  Si vous souhaitez renommer tout au long de la base de code, ne m√©langez pas cela avec d'autres modifications.  Si quelqu'un utilise git bisect, il n'aimera pas parcourir des milliers de renommages pour trouver un autre code modifi√©. </blockquote><br><h1>  3. Commentaires </h1><br>  Avant de passer √† des points plus importants, je voudrais prendre quelques minutes pour commenter. <br><br><blockquote>  <i>¬´Un bon code a beaucoup de commentaires et un mauvais code a besoin de beaucoup de commentaires.¬ª</i> - Dave Thomas et Andrew Hunt, programmeur pragmatique </blockquote><br>  Les commentaires sont tr√®s importants pour la lisibilit√© du programme.  Chaque commentaire doit faire une - et une seule - de trois choses: <br><br><ol><li>  Expliquez <i>ce que fait le</i> code. </li><li>  Expliquez <i>comment</i> il le fait. </li><li>  Expliquez <i>pourquoi</i> . </li></ol><br>  Le premier formulaire est id√©al pour commenter des personnages publics: <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Open     . //           .</span></span></code> </pre> <br>  Le second est id√©al pour les commentaires √† l'int√©rieur d'une m√©thode: <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//     var results []chan error for _, dep := range a.Deps { results = append(results, execute(seen, dep)) }</span></span></code> </pre> <br>  La troisi√®me forme (¬´pourquoi¬ª) est unique en ce qu'elle ne remplace ni ne remplace les deux premi√®res.  Ces commentaires expliquent les facteurs externes qui ont conduit √† l'√©criture du code dans sa forme actuelle.  Souvent sans ce contexte, il est difficile de comprendre pourquoi le code est √©crit de cette mani√®re. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;v2.Cluster_CommonLbConfig{ <span class="hljs-comment"><span class="hljs-comment">//  HealthyPanicThreshold HealthyPanicThreshold: &amp;envoy_type.Percent{ Value: 0, }, }</span></span></code> </pre> <br>  Dans cet exemple, il peut ne pas √™tre imm√©diatement clair ce qui se passe lorsque HealthyPanicThreshold est d√©fini sur z√©ro pour cent.  Le commentaire est destin√© √† pr√©ciser qu'une valeur de 0 d√©sactive le seuil de panique. <br><br><a name="3_1"></a><h2>  3.1.  Les commentaires dans les variables et les constantes doivent d√©crire leur contenu, pas leur objectif </h2><br>  J'ai dit plus t√¥t que le nom d'une variable ou d'une constante devrait d√©crire son objectif.  Mais un commentaire sur une variable ou une constante doit d√©crire exactement le <i>contenu</i> , pas le <i>but</i> . <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> randomNumber = <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-comment"><span class="hljs-comment">//    </span></span></code> </pre> <br>  Dans cet exemple, un commentaire d√©crit <i>pourquoi</i> <code>randomNumber</code> sur 6 et d'o√π il provient.  Le commentaire ne d√©crit pas o√π <code>randomNumber</code> sera utilis√©.  Voici quelques exemples suppl√©mentaires: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( StatusContinue = <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-comment"><span class="hljs-comment">// RFC 7231, 6.2.1 StatusSwitchingProtocols = 101 // RFC 7231, 6.2.2 StatusProcessing = 102 // RFC 2518, 10.1 StatusOK = 200 // RFC 7231, 6.3.1</span></span></code> </pre> <br>  <i>Dans le contexte de HTTP, le</i> nombre <code>100</code> appel√© <code>StatusContinue</code> , tel que d√©fini dans la RFC 7231, section 6.2.1. <br><br><blockquote>  <b>Astuce</b> .  Pour les variables sans valeur initiale, le commentaire doit d√©crire qui est responsable de l'initialisation de cette variable. <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// sizeCalculationDisabled ,   //     . . dowidth. var sizeCalculationDisabled bool</span></span></code> </pre> <br>  Ici, un commentaire indique au lecteur que la fonction <code>dowidth</code> responsable du maintien de l'√©tat de <code>sizeCalculationDisabled</code> . </blockquote><br><blockquote>  <b>Astuce</b> .  Cachez-vous en vue.  Voici les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conseils de Kate Gregory</a> .  Parfois, le meilleur nom d'une variable est masqu√© dans les commentaires. <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">//   SQL var registry = make(map[string]*sql.Driver)</span></span></code> </pre> <br>  Un commentaire a √©t√© ajout√© par l'auteur parce que le <code>registry</code> noms n'explique pas suffisamment son but - c'est un registre, mais qu'est-ce que le registre? <br><br>  Si vous renommez une variable en sqlDrivers, il devient clair qu'elle contient des pilotes SQL. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sqlDrivers = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]*sql.Driver)</code> </pre> <br>  Maintenant, le commentaire est devenu redondant et peut √™tre supprim√©. </blockquote><br><a name="3_2"></a><h2>  3.2.  Documentez toujours les caract√®res accessibles au public </h2><br>  La documentation de votre package est g√©n√©r√©e par godoc, vous devez donc ajouter un commentaire √† chaque caract√®re public d√©clar√© dans le package: une variable, une constante, une fonction et une m√©thode. <br><br>  Voici deux consignes du Google Style Guide: <br><br><ul><li>  Toute fonction publique qui n'est pas √† la fois √©vidente et concise doit √™tre comment√©e. <br></li><li>  Toute fonction de la biblioth√®que doit √™tre comment√©e, quelle que soit sa longueur ou sa complexit√©. </li></ul><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ioutil <span class="hljs-comment"><span class="hljs-comment">// ReadAll   r      (EOF)   // ..    err == nil, not err == EOF. //  ReadAll     ,     //  . func ReadAll(r io.Reader) ([]byte, error)</span></span></code> </pre> <br>  Il existe une exception √† cette r√®gle: vous n'avez pas besoin de documenter les m√©thodes qui impl√©mentent l'interface.  Plus pr√©cis√©ment, ne proc√©dez pas ainsi: <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Read   io.Reader func (r *FileReader) Read(buf []byte) (int, error)</span></span></code> </pre> <br>  Ce commentaire ne veut rien dire.  Il ne dit pas ce que fait la m√©thode: pire, il envoie quelque part chercher de la documentation.  Dans cette situation, je propose de supprimer compl√®tement le commentaire. <br><br>  Voici un exemple du package <code>io</code> . <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// LimitReader  Reader,    r, //    EOF  n . //   *LimitedReader. func LimitReader(r Reader, n int64) Reader { return &amp;LimitedReader{r, n} } // LimitedReader   R,     //   N .   Read  N  //    . // Read  EOF,  N &lt;= 0    R  EOF. type LimitedReader struct { R Reader // underlying reader N int64 // max bytes remaining } func (l *LimitedReader) Read(p []byte) (n int, err error) { if lN &lt;= 0 { return 0, EOF } if int64(len(p)) &gt; lN { p = p[0:lN] } n, err = lRRead(p) lN -= int64(n) return }</span></span></code> </pre> <br>  Notez que la d√©claration <code>LimitedReader</code> est imm√©diatement pr√©c√©d√©e de la fonction qui l'utilise et la d√©claration <code>LimitedReader.Read</code> suit la d√©claration de <code>LimitedReader</code> elle-m√™me.  Bien que <code>LimitedReader.Read</code> lui-m√™me ne soit pas document√©, il peut √™tre compris qu'il s'agit d'une impl√©mentation d' <code>io.Reader</code> . <br><br><blockquote>  <b>Astuce</b> .  Avant d'√©crire une fonction, √©crivez un commentaire la d√©crivant.  Si vous trouvez difficile d'√©crire un commentaire, cela signifie que le code que vous √™tes sur le point d'√©crire sera difficile √† comprendre. </blockquote><br><h3>  3.2.1.  Ne commentez pas le mauvais code, r√©√©crivez-le </h3><br><blockquote>  <i>¬´Ne commentez pas le mauvais code - r√©√©crivez-le¬ª</i> - Brian Kernighan </blockquote><br>  Il ne suffit pas d'indiquer dans les commentaires la difficult√© du fragment de code.  Si vous rencontrez l'un de ces commentaires, vous devez commencer un ticket avec un rappel de refactoring.  Vous pouvez vivre avec une dette technique tant que son montant est connu. <br><br>  Il est habituel de laisser des commentaires dans la biblioth√®que standard dans le style TODO avec le nom de l'utilisateur qui a remarqu√© le probl√®me. <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// TODO(dfc)  O(N^2),     .</span></span></code> </pre> <br>  Ce n'est pas une obligation de r√©soudre le probl√®me, mais l'utilisateur sp√©cifi√© peut √™tre la meilleure personne √† contacter pour une question.  D'autres projets accompagnent TODO avec une date ou un num√©ro de ticket. <br><br><h3>  3.2.2.  Au lieu de commenter le code, refactorisez-le </h3><br><blockquote>  <i>¬´Un bon code est la meilleure documentation.</i>  <i>Lorsque vous √™tes sur le point d'ajouter un commentaire, posez-vous la question: "Comment am√©liorer le code pour que ce commentaire ne soit pas n√©cessaire?"</i>  <i>Refactorisez et laissez un commentaire pour le rendre encore plus clair. ¬ª</i> - Steve McConnell </blockquote><br>  Les fonctions ne doivent effectuer qu'une seule t√¢che.  Si vous souhaitez √©crire un commentaire car un fragment n'est pas li√© au reste de la fonction, envisagez de l'extraire dans une fonction distincte. <br><br>  Les fonctionnalit√©s plus petites sont non seulement plus claires, mais plus faciles √† tester s√©par√©ment les unes des autres.  Lorsque vous avez isol√© le code dans une fonction distincte, son nom peut remplacer un commentaire. <br><br><a name="4"></a><h1>  4. Structure du package </h1><br><blockquote>  <i>¬´√âcrivez un code modeste: des modules qui ne montrent rien de superflu aux autres modules et qui ne d√©pendent pas de l'impl√©mentation d'autres modules¬ª</i> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dave Thomas</a> </blockquote><br>  Chaque package est essentiellement un petit programme Go distinct.  Tout comme l'impl√©mentation d'une fonction ou d'une m√©thode n'a pas d'importance pour l'appelant, l'impl√©mentation des fonctions, des m√©thodes et des types qui composent l'API publique de votre package n'a pas d'importance non plus. <br><br>  Un bon package Go aspire √† une connectivit√© minimale avec d'autres packages au niveau du code source, de sorte que, √† mesure que le projet se d√©veloppe, les modifications d'un package ne sont pas r√©percut√©es dans la base de code.  De telles situations emp√™chent consid√©rablement les programmeurs de travailler sur cette base de code. <br><br>  Dans cette section, nous parlerons de la conception d'un package, y compris son nom et des conseils pour √©crire des m√©thodes et des fonctions. <br><br><a name="4_1"></a><h2>  4.1.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Un bon package commence par un bon nom </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un bon forfait Go commence par un nom de qualit√©. </font><font style="vertical-align: inherit;">Consid√©rez-le comme une courte pr√©sentation limit√©e √† un seul mot. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme les noms de variables dans la section pr√©c√©dente, le nom du package est tr√®s important. </font><font style="vertical-align: inherit;">Pas besoin de penser aux types de donn√©es de ce package, il vaut mieux se poser la question: "Quel service ce package propose-t-il?" </font><font style="vertical-align: inherit;">Habituellement, la r√©ponse n'est pas ¬´Ce package fournit le type X¬ª, mais ¬´Ce package vous permet de vous connecter via HTTP¬ª.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Choisissez un nom de package par sa fonctionnalit√© et non par son contenu.</font></font></blockquote><br><h3>  4.1.1.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Les bons noms de colis doivent √™tre uniques </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque package a un nom unique dans le projet. </font><font style="vertical-align: inherit;">Il n'y a aucune difficult√© si vous avez suivi les conseils de donner des noms aux fins des packages. </font><font style="vertical-align: inherit;">S'il s'av√®re que les deux packages portent le m√™me nom, le plus probable:</font></font><br><br><ol><li>     . </li><li>       .       ,     . </li></ol><br><a name="4_2"></a><h2> 4.2.    <code>base</code> , <code>common</code>  <code>util</code> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une raison courante des mauvais noms est les soi-disant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">packages de services</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o√π au fil du temps divers assistants et codes de service s'accumulent. Puisqu'il est difficile d'y trouver un nom unique. Cela conduit souvent au fait que le nom du package est d√©riv√© de ce qu'il </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contient</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : les utilitaires. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des noms comme </font></font><code>utils</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou se </font></font><code>helpers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trouvent g√©n√©ralement dans les grands projets, dans lesquels une profonde hi√©rarchie de packages est enracin√©e, et les fonctions auxiliaires sont partag√©es. Si vous extrayez une fonction dans un nouveau package, l'importation √©choue. Dans ce cas, le nom du package ne refl√®te pas l'objectif du package, mais uniquement le fait que la fonction d'importation a √©chou√© en raison d'une mauvaise organisation du projet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans de telles situations, je recommande d'analyser d'o√π les packages sont appel√©s.</font></font><code>utils</code> <code>helpers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et, si possible, d√©placez les fonctions correspondantes vers le paquet appelant. </font><font style="vertical-align: inherit;">M√™me si cela implique la duplication d'un code auxiliaire, c'est mieux que d'introduire une d√©pendance d'importation entre deux packages.</font></font><br><br><blockquote> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´[Un peu] de duplication est beaucoup moins cher qu'une mauvaise abstraction¬ª</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Sandy Mets</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si les fonctions utilitaires sont utilis√©es dans de nombreux endroits, au lieu d'un package monolithique avec des fonctions utilitaires, il est pr√©f√©rable de cr√©er plusieurs packages, chacun se concentrant sur un aspect. </font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Utilisez le pluriel pour les packages de services. </font><font style="vertical-align: inherit;">Par exemple, </font></font><code>strings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour les utilitaires de traitement de cha√Æne.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les packages portant des noms tels que </font></font><code>base</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>common</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont souvent trouv√©s lorsqu'un certain package de fonctionnalit√©s communes de deux ou plusieurs impl√©mentations ou types communs est fusionn√© dans un package distinct pour le client et le serveur. </font><font style="vertical-align: inherit;">Je pense que dans de tels cas, il est n√©cessaire de r√©duire le nombre de packages en combinant le client, le serveur et le code commun dans un package avec un nom qui correspond √† sa fonction. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, pour </font></font><code>net/http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne pas faire les paquets individuels </font></font><code>client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, √† la </font><font style="vertical-align: inherit;">place, il y a des </font><font style="vertical-align: inherit;">fichiers </font></font><code>client.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>server.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les types de donn√©es correspondants, ainsi que </font></font><code>transport.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour le transport total.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il est important de se rappeler que le nom de l'identifiant inclut le nom du package.</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une fonction </font></font><code>Get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'un package </font></font><code>net/http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devient un </font></font><code>http.Get</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lien √† partir d'un autre package.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un type </font></font><code>Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'un package est </font></font><code>strings</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transform√© en lors de son importation dans d'autres packages </font></font><code>strings.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'interface </font></font><code>Error</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">du package est </font></font><code>net</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clairement associ√©e √† des erreurs de r√©seau.</font></font></li></ul></blockquote><br><a name="4_3"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.3. </font><font style="vertical-align: inherit;">Revenez rapidement sans plonger profond√©ment</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que Go n'utilise pas d'exceptions dans le flux de contr√¥le, il n'est pas n√©cessaire de creuser profond√©ment dans le code pour fournir une structure de niveau sup√©rieur pour les blocs </font></font><code>try</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>catch</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Au lieu d'une hi√©rarchie √† plusieurs niveaux, le code Go descend l'√©cran pendant que la fonction progresse. </font><font style="vertical-align: inherit;">Mon ami Matt Ryer appelle cette pratique une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´ligne de vue¬ª</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est r√©alis√© en utilisant </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des op√©rateurs de limites</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : des blocs conditionnels avec une condition pr√©alable √† l'entr√©e de la fonction. </font><font style="vertical-align: inherit;">Voici un exemple du package </font></font><code>bytes</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b *Buffer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnreadRune</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> b.lastRead &lt;= opInvalid { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors.New(<span class="hljs-string"><span class="hljs-string">"bytes.Buffer: UnreadRune: previous operation was not a successful ReadRune"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> b.off &gt;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(b.lastRead) { b.off -= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(b.lastRead) } b.lastRead = opInvalid <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En entrant dans la fonction </font></font><code>UnreadRune</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, l'√©tat est v√©rifi√© </font></font><code>b.lastRead</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et si l'op√©ration pr√©c√©dente ne l'√©tait pas </font></font><code>ReadRune</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, une erreur est imm√©diatement renvoy√©e. Le reste de la fonction fonctionne en fonction de ce qui est </font></font><code>b.lastRead</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sup√©rieur √† </font></font><code>opInvalid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comparez avec la m√™me fonction, mais sans l'op√©rateur de fronti√®re:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b *Buffer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnreadRune</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> b.lastRead &gt; opInvalid { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> b.off &gt;= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(b.lastRead) { b.off -= <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(b.lastRead) } b.lastRead = opInvalid <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> errors.New(<span class="hljs-string"><span class="hljs-string">"bytes.Buffer: UnreadRune: previous operation was not a successful ReadRune"</span></span>) }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le corps d'une branche r√©ussie plus probable est int√©gr√© dans la premi√®re condition </font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et la condition pour une sortie r√©ussie </font></font><code>return nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre d√©couverte en faisant correspondre soigneusement les </font><font style="vertical-align: inherit;">crochets de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fermeture</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La derni√®re ligne de la fonction renvoie maintenant une erreur et vous devez suivre l'ex√©cution de la fonction jusqu'au </font><font style="vertical-align: inherit;">crochet d' </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ouverture</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correspondant </font><font style="vertical-align: inherit;">pour savoir comment y parvenir. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette option est plus difficile √† lire, ce qui d√©grade la qualit√© de la programmation et la prise en charge du code, donc Go pr√©f√®re utiliser les op√©rateurs de limites et renvoyer les erreurs √† un stade pr√©coce.</font></font><br><br><a name="4_4"></a><h2>  4.4.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rendre la valeur nulle utile </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chaque d√©claration de variable, en supposant l'absence d'un initialiseur explicite, sera automatiquement initialis√©e avec une valeur correspondant au contenu de la m√©moire mise √† z√©ro, c'est-√†-dire </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">z√©ro</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Le type de valeur est d√©termin√© par l'une des options: pour les types num√©riques - z√©ro, pour les types de pointeurs - nul, le m√™me pour les tranches, les cartes et les canaux. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La possibilit√© de toujours d√©finir une valeur par d√©faut connue est importante pour la s√©curit√© et l'exactitude de votre programme et peut rendre vos programmes Go plus faciles et plus compacts. C'est ce que les programmeurs Go ont en t√™te lorsqu'ils disent: ¬´Donnez aux structures une valeur z√©ro utile¬ª. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consid√©rons un type </font></font><code>sync.Mutex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui contient deux champs entiers repr√©sentant l'√©tat interne du mutex. Ces champs sont automatiquement nuls dans toute d√©claration.</font></font><code>sync.Mutex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ce fait est pris en compte dans le code, donc le type peut √™tre utilis√© sans initialisation explicite.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> MyInt <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { mu sync.Mutex val <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i MyInt <span class="hljs-comment"><span class="hljs-comment">// i.mu is usable without explicit initialisation. i.mu.Lock() i.val++ i.mu.Unlock() }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre exemple de type avec une valeur nulle utile est </font></font><code>bytes.Buffer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vous pouvez le d√©clarer et commencer √† y √©crire sans initialisation explicite.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b bytes.Buffer b.WriteString(<span class="hljs-string"><span class="hljs-string">"Hello, world!\n"</span></span>) io.Copy(os.Stdout, &amp;b) }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La valeur z√©ro de cette structure signifie que les </font></font><code>len</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deux </font></font><code>cap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont √©gaux </font></font><code>0</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et y </font></font><code>array</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le pointeur vers la m√©moire avec le contenu du tableau de tranches de sauvegarde, valeur </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cela signifie que vous n'avez pas besoin de couper explicitement, vous pouvez simplement le d√©clarer.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// s := make([]string, 0) // s := []string{} var s []string s = append(s, "Hello") s = append(s, "world") fmt.Println(strings.Join(s, " ")) }</span></span></code> </pre> <br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><code>var s []string</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">similaire aux deux lignes comment√©es en haut, mais pas identique √† elles. </font><font style="vertical-align: inherit;">Il existe une diff√©rence entre une valeur de tranche nulle et une valeur de tranche de longueur nulle. </font><font style="vertical-align: inherit;">Le code suivant s'imprime faux.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s1 = []<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s2 []<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fmt.Println(reflect.DeepEqual(s1, s2)) }</code> </pre> </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une propri√©t√© utile, quoique inattendue, des variables de pointeur non initialis√©es - pointeurs nil - est la possibilit√© d'appeler des m√©thodes sur des types qui sont nuls. </font><font style="vertical-align: inherit;">Cela peut √™tre utilis√© pour fournir facilement des valeurs par d√©faut.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Config <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { path <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *Config)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Path</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> c == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"/usr/home"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c.path } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c1 *Config <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c2 = &amp;Config{ path: <span class="hljs-string"><span class="hljs-string">"/export"</span></span>, } fmt.Println(c1.Path(), c2.Path()) }</code> </pre> <br><a name="4_5"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5. </font><font style="vertical-align: inherit;">√âvitez l'√©tat au niveau du package</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La cl√© pour √©crire des programmes faciles √† prendre en charge dans des environnements mal coupl√©s est que la modification d'un package devrait avoir une faible probabilit√© d'affecter un autre package qui ne d√©pend pas directement du premier. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe deux excellents moyens d'obtenir une connectivit√© faible dans Go:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Utilisez des interfaces pour d√©crire le comportement requis par les fonctions ou les m√©thodes. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √âvitez le statut global. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans Go, nous pouvons d√©clarer des variables dans la port√©e d'une fonction ou d'une m√©thode, ainsi que dans la port√©e d'un package. </font><font style="vertical-align: inherit;">Lorsqu'une variable est accessible au public, avec un identifiant avec une majuscule, sa port√©e est en fait globale pour tout le programme: n'importe quel package </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† tout moment</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> voit le type et le contenu de cette variable. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'√©tat global mutable fournit une relation √©troite entre les parties ind√©pendantes du programme, car les variables globales deviennent un param√®tre invisible pour chaque fonction du programme! </font><font style="vertical-align: inherit;">Toute fonction qui s'appuie sur une variable globale peut √™tre viol√©e lorsque le type de cette variable change. </font><font style="vertical-align: inherit;">Toute fonction qui d√©pend de l'√©tat d'une variable globale peut √™tre viol√©e si une autre partie du programme modifie cette variable.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comment r√©duire la connectivit√© cr√©√©e par une variable globale: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D√©placez les variables correspondantes sous forme de champs vers les structures qui en ont besoin. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Utilisez des interfaces pour r√©duire la connexion entre le comportement et la mise en ≈ìuvre de ce comportement. </font></font></li></ol><br><a name="5"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5. Structure du projet </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parlons de la fa√ßon dont les packages sont combin√©s dans un projet. </font><font style="vertical-align: inherit;">Il s'agit g√©n√©ralement d'un seul r√©f√©rentiel Git. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme le package, chaque projet doit avoir un objectif clair. </font><font style="vertical-align: inherit;">S'il s'agit d'une biblioth√®que, elle doit faire une chose, par exemple, l'analyse XML ou la journalisation. </font><font style="vertical-align: inherit;">Vous ne devez pas combiner plusieurs objectifs dans un m√™me projet, cela vous √©vitera une biblioth√®que effrayante </font></font><code>common</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">D'apr√®s mon exp√©rience, le r√©f√©rentiel </font></font><code>common</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est en fin de compte √©troitement associ√© au plus grand consommateur, ce qui rend difficile d'apporter des corrections aux versions pr√©c√©dentes (correctifs de port arri√®re) sans mettre √† jour √† la fois le </font></font><code>common</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le consommateur au stade du blocage, ce qui conduit √† de nombreux changements non li√©s, et ils se brisent en cours de route API</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez une application (application web, contr√¥leur Kubernetes, etc.), le projet peut avoir un ou plusieurs packages principaux. </font><font style="vertical-align: inherit;">Par exemple, dans mon contr√¥leur Kubernetes, il existe un package </font></font><code>cmd/contour</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui sert de serveur d√©ploy√© dans un cluster Kubernetes et de client de d√©bogage.</font></font><br><br><a name="5_1"></a><h2>  5.1.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Moins de paquets mais plus gros </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la revue de code, j'ai remarqu√© l'une des erreurs typiques des programmeurs qui sont pass√©s √† Go √† partir d'autres langues: ils ont tendance √† abuser des packages. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go ne fournit pas le syst√®me complexe de visibilit√©: la langue n'est pas assez modificateurs d'acc√®s comme dans Java ( </font></font><code>public</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>protected</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>private</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et implicite </font></font><code>default</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Il n'y a pas d'analogue des classes amies de C ++. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans Go, nous n'avons que deux modificateurs d'acc√®s: ce sont des identifiants publics et priv√©s, qui sont indiqu√©s par la premi√®re lettre de l'identifiant (majuscule / minuscule). </font><font style="vertical-align: inherit;">Si l'identifiant est public, son nom commence par une lettre majuscule, il peut √™tre r√©f√©renc√© par tout autre package Go.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">On pouvait entendre les mots ¬´export√©¬ª ou ¬´non export√©¬ª comme synonymes de public et priv√©.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Compte tenu des fonctionnalit√©s de contr√¥le d'acc√®s limit√©es, quelles m√©thodes peuvent √™tre utilis√©es pour √©viter les hi√©rarchies de packages trop complexes? </font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans chaque package, en plus </font></font><code>cmd/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>internal/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit √™tre pr√©sent le code source.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai dit √† plusieurs reprises qu'il vaut mieux pr√©f√©rer moins de gros paquets. </font><font style="vertical-align: inherit;">Votre position par d√©faut doit √™tre de ne pas cr√©er de nouveau package. </font><font style="vertical-align: inherit;">Cela fait que trop de types deviennent publics, cr√©ant une large et petite √©tendue d'API disponibles. </font><font style="vertical-align: inherit;">Ci-dessous, nous consid√©rons cette th√®se plus en d√©tail.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous √™tes venu de Java? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous venez du monde Java ou C #, souvenez-vous de la r√®gle tacite: un package Java est √©quivalent √† un seul fichier source </font></font><code>.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Le package Go est √©quivalent √† l'ensemble du module Maven ou de l'assembly .NET.</font></font></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.1. </font><font style="vertical-align: inherit;">Tri du code par fichier √† l'aide des instructions d'importation</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous organisez des packages par service, devez-vous faire de m√™me pour les fichiers du package? </font><font style="vertical-align: inherit;">Comment savoir quand diviser un fichier </font></font><code>.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en plusieurs? </font><font style="vertical-align: inherit;">Comment savoir si vous √™tes all√© trop loin et devez penser √† fusionner des fichiers? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici les recommandations que j'utilise:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D√©marrez chaque package avec un fichier </font></font><code>.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Donnez √† ce fichier le m√™me nom que le r√©pertoire. </font><font style="vertical-align: inherit;">Par exemple, le package </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit se trouver dans un fichier </font></font><code>http.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans un r√©pertoire </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au fur et √† mesure que le package se d√©veloppe, vous pouvez diviser les diff√©rentes fonctions en plusieurs fichiers. </font><font style="vertical-align: inherit;">Par exemple, le fichier </font></font><code>messages.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contiendra des types </font></font><code>Request</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>Response</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, un </font></font><code>client.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type de </font></font><code>Client</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fichier </font></font><code>server.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, un serveur de type </font><font style="vertical-align: inherit;">fichier </font><font style="vertical-align: inherit;">.</font></font><br></li><li>       ,    .  ,       . <br></li><li>        . , <code>messages.go</code>     HTTP-       , <code>http.go</code>      , <code>client.go</code>  <code>server.go</code> ‚Äî    HTTP     . </li></ul><br><blockquote> <b></b> .      . </blockquote><br><blockquote> <b></b> .  Go    .      <i></i> ( ‚Äî      Go).           . </blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1.2. </font><font style="vertical-align: inherit;">Pr√©f√©rez les tests internes aux tests externes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'outil </font></font><code>go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend en charge le package </font></font><code>testing</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† deux endroits. </font><font style="vertical-align: inherit;">Si vous avez un package </font></font><code>http2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous pouvez √©crire un fichier </font></font><code>http2_test.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et utiliser la d√©claration de package </font></font><code>http2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Il compile le code </font></font><code>http2_test.go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il fait partie du paquet </font></font><code>http2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dans le langage courant, un tel test est appel√© interne. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'outil </font></font><code>go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend √©galement en charge une d√©claration de package sp√©ciale qui se termine par </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">test</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-√†-dire </font></font><code>http_test</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela permet aux fichiers de test de vivre dans un seul package avec le code, mais lorsque ces tests sont compil√©s, ils ne font pas partie du code de votre package, mais vivent dans leur propre package. </font><font style="vertical-align: inherit;">Cela vous permet d'√©crire des tests comme si un autre paquet appelait votre code. </font><font style="vertical-align: inherit;">Ces tests sont appel√©s externes.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je recommande d'utiliser des tests internes pour les tests unitaires unitaires. Cela vous permet de tester directement chaque fonction ou m√©thode, en √©vitant la bureaucratie des tests externes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais il est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√©cessaire</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de placer des exemples de fonctions de test ( </font></font><code>Example</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">dans un fichier de test externe </font><font style="vertical-align: inherit;">. Cela garantit que lorsqu'ils sont visualis√©s dans godoc, les exemples re√ßoivent le pr√©fixe de package appropri√© et peuvent √™tre facilement copi√©s.</font></font><br><br><blockquote> <b></b> .    ,     . <br><br>   ,    ,   Go      <code>go</code> . ,  <code>net/http</code>       <code>net</code> . <br><br>           <code>.go</code> , ,    . </blockquote><br><h3> 5.1.3.   ,     API </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si votre projet comporte plusieurs packages, vous pouvez trouver des fonctions export√©es destin√©es √† √™tre utilis√©es par d'autres packages, mais pas pour l'API publique. </font><font style="vertical-align: inherit;">Dans une telle situation, l'outil </font></font><code>go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reconna√Æt un nom de dossier sp√©cial </font></font><code>internal/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui peut √™tre utilis√© pour placer du code ouvert pour votre projet, mais ferm√© aux autres. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour cr√©er un tel package, placez-le dans un r√©pertoire avec un nom </font></font><code>internal/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou dans son sous-r√©pertoire. </font><font style="vertical-align: inherit;">Lorsque l'√©quipe </font></font><code>go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voit l'importation du package avec le chemin d'acc√®s </font></font><code>internal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, elle v√©rifie l'emplacement du package appelant dans un r√©pertoire ou un sous-r√©pertoire </font></font><code>internal/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, un package </font></font><code>.../a/b/c/internal/d/e/f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut importer uniquement un package √† partir d'une arborescence de r√©pertoires </font></font><code>.../a/b/c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais pas du tout </font></font><code>.../a/b/g</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou tout autre r√©f√©rentiel (voir</font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><a name="5_2"></a><h2>  5.2.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le plus petit paquet principal </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une fonction </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et un package </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doivent avoir des fonctionnalit√©s minimales, car ils </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agissent comme un singleton: un programme ne peut avoir qu'une seule fonction </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, y compris les tests. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme il </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s'agit d'un singleton, il existe de nombreuses restrictions sur les objets appel√©s: ils ne sont appel√©s que pendant </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>main.init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> seule </font><i><font style="vertical-align: inherit;">fois</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cela rend difficile l'√©criture de tests pour le code </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ainsi, vous devez vous efforcer de tirer le plus de logique possible de la fonction principale et, id√©alement, du package principal.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><code>func main()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">doit analyser les indicateurs, ouvrir les connexions aux bases de donn√©es, les enregistreurs, etc., puis transf√©rer l'ex√©cution vers un objet de haut niveau.</font></font></blockquote><br><a name="6"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Structure de l'API </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le dernier conseil de conception pour le projet que je consid√®re comme le plus important. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes les phrases pr√©c√©dentes ne sont en principe pas contraignantes. </font><font style="vertical-align: inherit;">Ce ne sont que des recommandations bas√©es sur l'exp√©rience personnelle. </font><font style="vertical-align: inherit;">Je ne pousse pas trop ces recommandations dans une revue de code. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'API est une autre affaire. Ici, les erreurs sont prises plus au s√©rieux, car tout le reste peut √™tre corrig√© sans briser la compatibilit√© descendante: pour la plupart, ce ne sont que des d√©tails d'impl√©mentation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En ce qui concerne les API publiques, il convient de consid√©rer s√©rieusement la structure d√®s le d√©but, car les modifications ult√©rieures seront destructrices pour les utilisateurs.</font></font><br><br><a name="6_1"></a><h2>  6.1.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API de conception difficiles √† abuser par conception </font></font></h2><br><blockquote> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Les API doivent √™tre simples pour une utilisation correcte et difficiles pour des erreurs¬ª</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Josh Bloch</font></font></a> </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les conseils de Josh Bloch sont peut-√™tre les plus pr√©cieux de cet article. </font><font style="vertical-align: inherit;">Si l'API est difficile √† utiliser pour des choses simples, chaque appel d'API est plus compliqu√© que n√©cessaire. </font><font style="vertical-align: inherit;">Lorsqu'un appel d'API est complexe et non √©vident, il est probable qu'il soit ignor√©.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.1. </font><font style="vertical-align: inherit;">Soyez prudent avec les fonctions qui acceptent plusieurs param√®tres du m√™me type.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un bon exemple d'une API simple √† premi√®re vue, mais difficile √† utiliser, est lorsqu'elle n√©cessite deux ou plusieurs param√®tres du m√™me type. </font><font style="vertical-align: inherit;">Comparez deux signatures de fonction:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Max</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CopyFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to, from </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle est la diff√©rence entre ces deux fonctions? </font><font style="vertical-align: inherit;">√âvidemment, l'un renvoie un maximum de deux nombres et l'autre copie le fichier. </font><font style="vertical-align: inherit;">Mais ce n'est pas la question.</font></font><br><br><pre> <code class="go hljs">Max(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-comment"><span class="hljs-comment">// 10 Max(10, 8) // 10</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Max est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commutatif</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : l'ordre des param√®tres n'a pas d'importance. </font><font style="vertical-align: inherit;">Un maximum de huit et dix est √©gal √† dix, que huit et dix ou dix et huit soient compar√©s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais dans le cas de CopyFile, ce n'est pas le cas.</font></font><br><br><pre> <code class="go hljs">CopyFile(<span class="hljs-string"><span class="hljs-string">"/tmp/backup"</span></span>, <span class="hljs-string"><span class="hljs-string">"presentation.md"</span></span>) CopyFile(<span class="hljs-string"><span class="hljs-string">"presentation.md"</span></span>, <span class="hljs-string"><span class="hljs-string">"/tmp/backup"</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lequel de ces op√©rateurs sauvegardera votre pr√©sentation et lequel la remplacera par la version de la semaine derni√®re? </font><font style="vertical-align: inherit;">Vous ne pouvez pas le dire avant d'avoir v√©rifi√© la documentation. </font><font style="vertical-align: inherit;">Au cours de la r√©vision du code, il n'est pas clair si l'ordre des arguments est correct ou non. </font><font style="vertical-align: inherit;">Encore une fois, regardez la documentation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une solution possible consiste √† introduire un type auxiliaire responsable de l'appel correct </font></font><code>CopyFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Source <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(src Source)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CopyTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dest </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CopyFile(dest, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(src)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> from Source = <span class="hljs-string"><span class="hljs-string">"presentation.md"</span></span> from.CopyTo(<span class="hljs-string"><span class="hljs-string">"/tmp/backup"</span></span>) }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il est </font></font><code>CopyFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">toujours appel√© correctement ici - cela peut √™tre d√©clar√© √† l'aide d'un test unitaire - et peut √™tre effectu√© en priv√©, ce qui r√©duit encore plus la probabilit√© d'une utilisation incorrecte.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Une API avec plusieurs param√®tres du m√™me type est difficile √† utiliser correctement.</font></font></blockquote><br><a name="6_2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2. </font><font style="vertical-align: inherit;">Concevoir une API pour un cas d'utilisation de base</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a quelques ann√©es, j'ai fait une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pr√©sentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur l'utilisation </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des options fonctionnelles</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour rendre l'API plus simple par d√©faut. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'essence de la pr√©sentation √©tait que vous deviez d√©velopper une API pour le cas d'utilisation principal. </font><font style="vertical-align: inherit;">En d'autres termes, l'API ne doit pas obliger l'utilisateur √† fournir des param√®tres suppl√©mentaires qui ne l'int√©ressent pas.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.1. </font><font style="vertical-align: inherit;">L'utilisation de nil comme param√®tre n'est pas recommand√©e</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai commenc√© par dire qu'il ne fallait pas forcer l'utilisateur √† fournir des param√®tres API qui ne l'int√©ressaient pas. </font><font style="vertical-align: inherit;">Cela signifie </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">concevoir les API pour le cas d'utilisation principal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (option par d√©faut). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici un exemple du package net / http.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> http <span class="hljs-comment"><span class="hljs-comment">// ListenAndServe listens on the TCP network address addr and then calls // Serve with handler to handle requests on incoming connections. // Accepted connections are configured to enable TCP keep-alives. // // The handler is typically nil, in which case the DefaultServeMux is used. // // ListenAndServe always returns a non-nil error. func ListenAndServe(addr string, handler Handler) error {</span></span></code> </pre> <br> <code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepte deux param√®tres: une adresse TCP pour √©couter les connexions entrantes et </font></font><code>http.Handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour traiter une requ√™te HTTP entrante. </font></font><code>Serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permet au deuxi√®me param√®tre d'√™tre </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dans les commentaires, il est √† noter qu'en g√©n√©ral, l'objet appelant </font><font style="vertical-align: inherit;">passera </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">effectivement</font></font></i><font style="vertical-align: inherit;"></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , indiquant une volont√© de l'utiliser </font></font><code>http.DefaultServeMux</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comme param√®tre implicite. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, l'appelant </font></font><code>Serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a deux fa√ßons de faire de m√™me.</font></font><br><br><pre> <code class="go hljs">http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, http.DefaultServeMux)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les deux options font la m√™me chose. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette application </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se propage comme un virus. </font><font style="vertical-align: inherit;">Le package a √©galement </font></font><code>http</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une aide </font></font><code>http.Serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous pouvez donc imaginer la structure de la fonction </font></font><code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ListenAndServe</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(addr </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, handler Handler)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { l, err := net.Listen(<span class="hljs-string"><span class="hljs-string">"tcp"</span></span>, addr) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> l.Close() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Serve(l, handler) }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puisqu'il </font></font><code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permet √† l'appelant de passer </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour le deuxi√®me param√®tre, il </font></font><code>http.Serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend √©galement en charge ce comportement. </font><font style="vertical-align: inherit;">En fait, c'est dans la </font></font><code>http.Serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">logique impl√©ment√©e "si le gestionnaire est √©gal </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, utilisez </font></font><code>DefaultServeMux</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">". </font><font style="vertical-align: inherit;">L'acceptation </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d'un param√®tre peut amener l'appelant √† penser qu'il peut √™tre transmis </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour les deux param√®tres. </font><font style="vertical-align: inherit;">Mais tel</font></font><code>Serve</code> <br><br><pre> <code class="go hljs">http.Serve(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conduit √† une terrible panique. </font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ne m√©langez pas les param√®tres dans la m√™me signature de fonction </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et non </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'auteur a </font></font><code>http.ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tent√© de simplifier la vie des utilisateurs d'API pour le cas par d√©faut, mais la s√©curit√© a √©t√© affect√©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En pr√©sence, </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il </font><font style="vertical-align: inherit;">n'y a </font><font style="vertical-align: inherit;">pas de diff√©rence de nombre de lignes entre utilisation explicite et indirecte </font></font><code>DefaultServeMux</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> root = http.Dir(<span class="hljs-string"><span class="hljs-string">"/htdocs"</span></span>) http.Handle(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, http.FileServer(root)) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> compar√© √† </font></font><br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> root = http.Dir(<span class="hljs-string"><span class="hljs-string">"/htdocs"</span></span>) http.Handle(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, http.FileServer(root)) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, http.DefaultServeMux)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vaut-il la peine de garder une ligne? </font></font><br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> root = http.Dir(<span class="hljs-string"><span class="hljs-string">"/htdocs"</span></span>) mux := http.NewServeMux() mux.Handle(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, http.FileServer(root)) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, mux)</code> </pre> <br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">R√©fl√©chissez s√©rieusement au temps que les fonctions d'assistance permettront au programmeur. </font><font style="vertical-align: inherit;">La clart√© vaut mieux que la bri√®vet√©.</font></font></blockquote><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√âvitez les API publiques avec des param√®tres dont seuls les tests ont besoin. </font><font style="vertical-align: inherit;">√âvitez d'exporter des API avec des param√®tres dont les valeurs ne diff√®rent que pendant les tests. </font><font style="vertical-align: inherit;">Au lieu de cela, exportez les fonctions d'encapsuleur qui masquent le transfert de ces param√®tres et, dans les tests, utilisez des fonctions d'assistance similaires qui transmettent les valeurs n√©cessaires au test.</font></font></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.2.2. </font><font style="vertical-align: inherit;">Utilisez des arguments de longueur variable au lieu de [] T</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tr√®s souvent, une fonction ou une m√©thode prend une tranche de valeurs. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShutdownVMs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ids []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce n'est qu'un exemple invent√©, mais c'est tr√®s courant. Le probl√®me est que ces signatures supposent qu'elles seront appel√©es avec plusieurs enregistrements. Comme l'exp√©rience le montre, ils sont souvent appel√©s avec un seul argument, qui doit √™tre ¬´compress√©¬ª √† l'int√©rieur de la tranche afin de r√©pondre aux exigences de la signature de fonction. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, puisque le param√®tre </font></font><code>ids</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est une tranche, vous pouvez passer une tranche vide ou z√©ro √† la fonction, et le compilateur sera content. Cela ajoute une charge de test suppl√©mentaire car les tests devraient couvrir de tels cas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour donner un exemple d'une telle classe d'API, j'ai r√©cemment refactoris√© la logique qui n√©cessitait l'installation de certains champs suppl√©mentaires si au moins un des param√®tres n'√©tait pas nul. La logique ressemblait √† ceci:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> svc.MaxConnections &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> || svc.MaxPendingRequests &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> || svc.MaxRequests &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> || svc.MaxRetries &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-comment"><span class="hljs-comment">// apply the non zero parameters }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que l'op√©rateur </font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devenait tr√®s long, je voulais tirer la logique de validation dans une fonction distincte. </font><font style="vertical-align: inherit;">Voici ce que j'ai trouv√©:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// anyPostive indicates if any value is greater than zero. func anyPositive(values ...int) bool { for _, v := range values { if v &gt; 0 { return true } } return false }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cela a permis d'indiquer clairement la condition dans laquelle l'unit√© int√©rieure sera ex√©cut√©e: </font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> anyPositive(svc.MaxConnections, svc.MaxPendingRequests, svc.MaxRequests, svc.MaxRetries) { <span class="hljs-comment"><span class="hljs-comment">// apply the non zero parameters }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, il y a un probl√®me avec </font></font><code>anyPositive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, quelqu'un pourrait l'appeler accidentellement comme ceci:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> anyPositive() { ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, </font></font><code>anyPositive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reviendra </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ce n'est pas la pire option. </font><font style="vertical-align: inherit;">Pire si </font></font><code>anyPositive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retourn√© </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en l'absence d'arguments. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, il serait pr√©f√©rable de pouvoir modifier la signature de anyPositive pour garantir qu'au moins un argument est pass√© √† l'appelant. </font><font style="vertical-align: inherit;">Cela peut √™tre fait en combinant les param√®tres des arguments normaux et des arguments de longueur variable (varargs):</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// anyPostive indicates if any value is greater than zero. func anyPositive(first int, rest ...int) bool { if first &gt; 0 { return true } for _, v := range rest { if v &gt; 0 { return true } } return false }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, </font></font><code>anyPositive</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous ne pouvez pas appeler avec moins d'un argument.</font></font><br><br><a name="6_3"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.3. </font><font style="vertical-align: inherit;">Laissez les fonctions d√©terminer le comportement souhait√©.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supposons que l'on m'ait donn√© la t√¢che d'√©crire une fonction qui pr√©serve la structure </font></font><code>Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur le disque.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Save      f. func Save(f *os.File, doc *Document) error</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je pourrais √©crire une fonction </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui √©crit </font></font><code>Document</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans un fichier </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Mais il y a quelques probl√®mes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La signature </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©limine la possibilit√© d'enregistrer des donn√©es sur le r√©seau. Si une telle exigence appara√Æt √† l'avenir, la signature de la fonction devra √™tre modifi√©e, ce qui affectera tous les objets appelants. </font></font><br><br> <code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©galement d√©sagr√©able √† tester, car il fonctionne directement avec les fichiers sur disque. Ainsi, pour v√©rifier son fonctionnement, le test doit lire le contenu du fichier apr√®s l'√©criture. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et je dois m'assurer qu'il est </font></font><code>f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©crit dans un dossier temporaire puis supprim√©. </font></font><br><br> <code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©finit √©galement de nombreuses m√©thodes qui ne sont pas li√©es </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, par exemple, √† la lecture de r√©pertoires et √† la v√©rification si un chemin est un lien symbolique. Eh bien, si la signature</font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©crit uniquement les parties pertinentes </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br>  Que peut-on faire? <br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Save      // ReadWriterCloser. func Save(rwc io.ReadWriteCloser, doc *Document) error</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä l'aide de </font></font><code>io.ReadWriteCloser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">celui </font><font style="vertical-align: inherit;">- </font><font style="vertical-align: inherit;">ci, vous pouvez appliquer le principe de s√©paration d'interface - et le red√©finir </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur une interface qui d√©crit les propri√©t√©s plus g√©n√©rales du fichier. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s une telle modification, tout type qui impl√©mente l'interface </font></font><code>io.ReadWriteCloser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peut √™tre remplac√© par le pr√©c√©dent </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela √©tend simultan√©ment la port√©e </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et clarifie √† l'appelant quels types de m√©thodes </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sont li√©s √† son fonctionnement. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et l'auteur </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne peut plus appeler ces m√©thodes ind√©pendantes </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car il est cach√© derri√®re l'interface </font></font><code>io.ReadWriteCloser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais nous pouvons √©tendre encore plus le principe de la s√©paration des interfaces. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord si</font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> suit le principe de la responsabilit√© unique, il est peu probable qu'il lise le fichier qu'il vient d'√©crire pour v√©rifier son contenu - un autre code devrait le faire. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Save      // WriteCloser. func Save(wc io.WriteCloser, doc *Document) error</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par cons√©quent, vous pouvez affiner les sp√©cifications de l'interface pour </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simplement √©crire et fermer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deuxi√®mement, le m√©canisme de fermeture des threads y </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est un h√©ritage du temps o√π il fonctionnait avec le fichier. </font><font style="vertical-align: inherit;">La question est de savoir dans quelles circonstances </font></font><code>wc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">il sera ferm√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que ce </font><font style="vertical-align: inherit;">soit la </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cause de </font></font><code>Close</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mani√®re inconditionnelle, que ce </font><font style="vertical-align: inherit;">soit dans le cas de succ√®s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela pr√©sente un probl√®me pour l'appelant car il peut souhaiter ajouter des donn√©es au flux une fois le document √©crit.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Save      // Writer. func Save(w io.Writer, doc *Document) error</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La meilleure option est de red√©finir Enregistrer pour ne fonctionner qu'avec </font></font><code>io.Writer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en sauvant l'op√©rateur de toutes les autres fonctionnalit√©s, √† l'exception de l'√©criture de donn√©es dans le flux. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s avoir appliqu√© le principe de s√©paration d'interface, la fonction est devenue √† la fois plus sp√©cifique en termes d'exigences (elle n'a besoin que d'un objet o√π elle peut √™tre √©crite), et plus g√©n√©rale en termes de fonctionnalit√©, puisque maintenant nous pouvons l'utiliser </font></font><code>Save</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour enregistrer des donn√©es partout o√π elle est impl√©ment√©e </font></font><code>io.Writer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><a name="7"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. Gestion des erreurs </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai donn√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plusieurs pr√©sentations</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">√©crit </font></a></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beaucoup</font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur ce sujet sur le blog, donc je ne le r√©p√©terai pas. </font><font style="vertical-align: inherit;">Au lieu de cela, je veux couvrir deux autres domaines li√©s √† la gestion des erreurs.</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><a name="7_1"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1. </font><font style="vertical-align: inherit;">√âlimine le besoin de gestion des erreurs en supprimant les erreurs elles-m√™mes</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> J'ai fait de nombreuses suggestions pour am√©liorer la syntaxe de gestion des erreurs, mais la meilleure option est de ne pas les g√©rer du tout. </font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je ne dis pas ¬´supprimer la gestion des erreurs¬ª. </font><font style="vertical-align: inherit;">Je sugg√®re de changer le code afin qu'il n'y ait aucune erreur de traitement.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le r√©cent livre sur la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">philosophie du d√©veloppement logiciel de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> John Osterhout m'a inspir√© pour faire cette suggestion </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">L'un des chapitres est intitul√© ¬´√âliminer les erreurs de la r√©alit√©¬ª. </font><font style="vertical-align: inherit;">Essayons d'appliquer ce conseil.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1.1. </font><font style="vertical-align: inherit;">Nombre de lignes</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous allons √©crire une fonction pour compter le nombre de lignes dans un fichier. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CountLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r io.Reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ( br = bufio.NewReader(r) lines <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> err error ) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { _, err = br.ReadString(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) lines++ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != io.EOF { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lines, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme nous suivons les conseils des sections pr√©c√©dentes, </font></font><code>CountLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepte </font></font><code>io.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, non </font></font><code>*os.File</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; c‚Äôest d√©j√† la t√¢che de l‚Äôappelant de fournir </font></font><code>io.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">le contenu dont nous voulons compter. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous cr√©ons </font></font><code>bufio.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis appelons la m√©thode en boucle </font></font><code>ReadString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, en augmentant le compteur, jusqu'√† ce que nous atteignions la fin du fichier, puis nous renvoyons le nombre de lignes lues. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au moins, nous voulons √©crire un tel code, mais la fonction est g√™n√©e par la gestion des erreurs. Par exemple, il y a une construction si √©trange:</font></font><br><br><pre> <code class="go hljs"> _, err = br.ReadString(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) lines++ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous augmentons le nombre de lignes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">avant de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rechercher des erreurs - cela semble √©trange. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La raison pour laquelle nous devons l'√©crire de cette fa√ßon est qu'il </font></font><code>ReadString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retournera une erreur s'il rencontre la fin du fichier plus t√¥t que le caract√®re de nouvelle ligne. </font><font style="vertical-align: inherit;">Cela peut se produire s'il n'y a pas de nouvelle ligne √† la fin du fichier. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour essayer de r√©soudre ce probl√®me, modifiez la logique du compteur de lignes, puis voyez si nous devons quitter la boucle.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cette logique n'est pas encore parfaite, pouvez-vous trouver une erreur?</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais nous n'avons pas fini de v√©rifier les erreurs. </font></font><code>ReadString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retournera </font></font><code>io.EOF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quand il rencontrera la fin du fichier. </font><font style="vertical-align: inherit;">C'est la situation attendue, donc pour que </font></font><code>ReadString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous ayez besoin de dire "arr√™tez, il n'y a plus rien √† lire". </font><font style="vertical-align: inherit;">Par cons√©quent, avant de renvoyer l'erreur √† l'objet appelant </font></font><code>CountLine</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, vous devez v√©rifier que l'erreur n'est pas li√©e √† </font></font><code>io.EOF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, puis la transmettre, sinon nous revenons </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et disons que tout va bien. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je pense que c'est un bon exemple de la th√®se de Russ Cox sur la fa√ßon dont la gestion des erreurs peut masquer la fonction. </font><font style="vertical-align: inherit;">Regardons la version am√©lior√©e.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CountLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r io.Reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { sc := bufio.NewScanner(r) lines := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> sc.Scan() { lines++ } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lines, sc.Err() }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette version am√©lior√©e utilise √† la </font></font><code>bufio.Scanner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">place </font></font><code>bufio.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sous le capot </font></font><code>bufio.Scanner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilise </font></font><code>bufio.Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mais ajoute un bon niveau d'abstraction, ce qui permet de supprimer la gestion des erreurs.</font></font><br><br><blockquote> <b></b> . <code>bufio.Scanner</code>    ,      . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La m√©thode </font></font><code>sc.Scan()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renvoie une valeur </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si le scanner a rencontr√© une cha√Æne et n'a pas trouv√© d'erreur. Ainsi, le corps de la boucle n'est </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">appel√© que s'il y a une ligne de texte dans le tampon du scanner. Cela signifie que le nouveau </font></font><code>CountLines</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g√®re les cas lorsqu'il n'y a pas de nouvelle ligne ou lorsque le fichier est vide. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deuxi√®mement, puisqu'il </font></font><code>sc.Scan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">revient </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lorsqu'une erreur est d√©tect√©e, le cycle </font></font><code>for</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se termine lorsqu'il atteint la fin du fichier ou qu'une erreur est d√©tect√©e. Le type se </font></font><code>bufio.Scanner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">souvient de la premi√®re erreur qu'il a rencontr√©e, et en utilisant la m√©thode, </font></font><code>sc.Err()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous pouvons restaurer cette erreur d√®s que nous quittons la boucle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, il </font></font><code>sc.Err()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prend en charge le traitement </font></font><code>io.EOF</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le convertit </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si la fin du fichier est atteinte sans erreur.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si vous rencontrez un traitement d'erreur excessif, essayez d'extraire certaines op√©rations dans un type d'assistance.</font></font></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.1.2. </font><font style="vertical-align: inherit;">Writeresponse</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mon deuxi√®me exemple est inspir√© de l'article </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Les erreurs sont des valeurs¬ª</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plus t√¥t, nous avons vu des exemples de la fa√ßon dont un fichier est ouvert, √©crit et ferm√©. </font><font style="vertical-align: inherit;">Il existe une gestion des erreurs, mais ce n'est pas trop, car les op√©rations peuvent √™tre encapsul√©es dans des assistants, tels que </font></font><code>ioutil.ReadFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>ioutil.WriteFile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Mais lorsque vous travaillez avec des protocoles r√©seau de bas niveau, il est n√©cessaire de cr√©er une r√©ponse directement √† l'aide de primitives d'E / S. </font><font style="vertical-align: inherit;">Dans ce cas, la gestion des erreurs peut devenir intrusive. </font><font style="vertical-align: inherit;">Consid√©rons un fragment d'un serveur HTTP qui cr√©e une r√©ponse HTTP.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Header <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Key, Value <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Status <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Code <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Reason <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, st Status, headers []Header, body io.Reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { _, err := fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"HTTP/1.1 %d %s\r\n"</span></span>, st.Code, st.Reason) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, h := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> headers { _, err := fmt.Fprintf(w, <span class="hljs-string"><span class="hljs-string">"%s: %s\r\n"</span></span>, h.Key, h.Value) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> _, err := fmt.Fprint(w, <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } _, err = io.Copy(w, body) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Commencez par cr√©er la barre d'√©tat avec </font></font><code>fmt.Fprintf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et v√©rifiez l'erreur. Ensuite, pour chaque rubrique, nous √©crivons une cl√© et une valeur de rubrique, v√©rifiant √† chaque fois une erreur. Enfin, nous compl√©tons la section d'en-t√™te par une autre </font></font><code>\r\n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, v√©rifions l'erreur et copions le corps de la r√©ponse au client. Enfin, bien que nous n'ayons pas besoin de v√©rifier l'erreur </font></font><code>io.Copy</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nous devons la traduire de deux valeurs de retour √† la seule qui retourne </font></font><code>WriteResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est beaucoup de travail monotone. Mais vous pouvez faciliter votre t√¢che en appliquant un petit type d'emballage </font></font><code>errWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <code>errWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">satisfait le contrat </font></font><code>io.Writer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il peut donc √™tre utilis√© comme emballage. </font></font><code>errWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transmet les enregistrements via la fonction jusqu'√† ce qu'une erreur soit d√©tect√©e. Dans ce cas, il rejette les entr√©es et renvoie l'erreur pr√©c√©dente.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> errWriter <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { io.Writer err error } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e *errWriter)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(buf []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, e.err } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n, e.err = e.Writer.Write(buf) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, st Status, headers []Header, body io.Reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { ew := &amp;errWriter{Writer: w} fmt.Fprintf(ew, <span class="hljs-string"><span class="hljs-string">"HTTP/1.1 %d %s\r\n"</span></span>, st.Code, st.Reason) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, h := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> headers { fmt.Fprintf(ew, <span class="hljs-string"><span class="hljs-string">"%s: %s\r\n"</span></span>, h.Key, h.Value) } fmt.Fprint(ew, <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) io.Copy(ew, body) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ew.err }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'il est appliqu√© </font></font><code>errWriter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† </font></font><code>WriteResponse</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la clart√© du code est consid√©rablement am√©lior√©e. </font><font style="vertical-align: inherit;">Vous n'avez plus besoin de v√©rifier les erreurs dans chaque op√©ration individuelle. </font><font style="vertical-align: inherit;">Le message d'erreur se d√©place √† la fin de la fonction en tant que v√©rification de champ </font></font><code>ew.err</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, √©vitant la traduction g√™nante des valeurs io.Copy renvoy√©es.</font></font><br><br><a name="7_2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2. </font><font style="vertical-align: inherit;">Traiter l'erreur une seule fois</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enfin, je tiens √† noter que les erreurs ne doivent √™tre trait√©es qu'une seule fois. </font><font style="vertical-align: inherit;">Le traitement signifie v√©rifier la signification de l'erreur et prendre une </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seule</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©cision.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// WriteAll writes the contents of buf to the supplied writer. func WriteAll(w io.Writer, buf []byte) { w.Write(buf) }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous prenez moins d'une d√©cision, vous ignorez l'erreur. </font><font style="vertical-align: inherit;">Comme nous le voyons ici, l'erreur de est </font></font><code>w.WriteAll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ignor√©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais prendre </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plus d'une</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d√©cision en r√©ponse √† une erreur est √©galement une erreur. </font><font style="vertical-align: inherit;">Voici le code que je rencontre souvent.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, buf []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { _, err := w.Write(buf) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"unable to write:"</span></span>, err) <span class="hljs-comment"><span class="hljs-comment">// annotated error goes to log file return err // unannotated error returned to caller } return nil }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans cet exemple, si une erreur se produit pendant le temps </font></font><code>w.Write</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, la ligne est √©crite dans le journal et √©galement renvoy√©e √† l'objet appelant, qui, peut-√™tre, le journalisera √©galement et le transmettra, jusqu'au niveau sup√©rieur du programme. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tr√®s probablement, l'appelant fait de m√™me:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, conf *Config)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { buf, err := json.Marshal(conf) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Printf(<span class="hljs-string"><span class="hljs-string">"could not marshal config: %v"</span></span>, err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := WriteAll(w, buf); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Println(<span class="hljs-string"><span class="hljs-string">"could not write config: %v"</span></span>, err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ainsi, une pile de lignes r√©p√©titives est cr√©√©e dans le journal. </font></font><br><br><pre> <code class="go hljs">unable to write: io.EOF could not write config: io.EOF</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mais en haut du programme, vous obtenez une erreur d'origine sans aucun contexte. </font></font><br><br><pre> <code class="go hljs">err := WriteConfig(f, &amp;conf) fmt.Println(err) <span class="hljs-comment"><span class="hljs-comment">// io.EOF</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Je souhaite analyser ce sujet plus en d√©tail, car je ne consid√®re pas le probl√®me du renvoi simultan√© d'une erreur et de l'enregistrement de mes pr√©f√©rences personnelles. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, conf *Config)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { buf, err := json.Marshal(conf) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Printf(<span class="hljs-string"><span class="hljs-string">"could not marshal config: %v"</span></span>, err) <span class="hljs-comment"><span class="hljs-comment">// oops, forgot to return } if err := WriteAll(w, buf); err != nil { log.Println("could not write config: %v", err) return err } return nil }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je rencontre souvent un probl√®me qu'un programmeur oublie de renvoyer d'une erreur. Comme nous l'avons dit plus t√¥t, le style de Go est d'utiliser des op√©rateurs de limites, de v√©rifier les pr√©requis lors de l'ex√©cution de la fonction et de revenir t√¥t. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans cet exemple, l'auteur a v√©rifi√© l'erreur, l'a enregistr√©e, mais a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oubli√©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de revenir. Pour cette raison, un probl√®me subtil se pose. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le contrat de gestion des erreurs Go indique qu'en pr√©sence d'une erreur, aucune hypoth√®se ne peut √™tre √©mise sur le contenu des autres valeurs de retour. Comme le marshaling JSON a √©chou√©, le contenu est </font></font><code>buf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inconnu: il peut ne rien contenir, mais pire, il peut contenir un fragment JSON √† moiti√© √©crit.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que le programmeur a oubli√© de revenir apr√®s avoir v√©rifi√© et enregistr√© l'erreur, le tampon endommag√© sera transf√©r√© </font></font><code>WriteAll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">L'op√©ration est susceptible de r√©ussir et le fichier de configuration ne sera donc pas √©crit correctement. </font><font style="vertical-align: inherit;">Cependant, la fonction se termine normalement et le seul signe qu'un probl√®me s'est produit est une ligne dans le journal o√π le marshaling JSON a √©chou√©, et non un √©chec d'enregistrement de configuration.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2.1. </font><font style="vertical-align: inherit;">Ajout de contexte aux erreurs</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une erreur s'est produite car l'auteur tentait d'ajouter du contexte au message d'erreur. </font><font style="vertical-align: inherit;">Il a tent√© de laisser une marque pour indiquer la source de l'erreur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voyons une autre fa√ßon de faire de m√™me </font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, conf *Config)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { buf, err := json.Marshal(conf) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt.Errorf(<span class="hljs-string"><span class="hljs-string">"could not marshal config: %v"</span></span>, err) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := WriteAll(w, buf); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt.Errorf(<span class="hljs-string"><span class="hljs-string">"could not write config: %v"</span></span>, err) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w io.Writer, buf []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { _, err := w.Write(buf) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt.Errorf(<span class="hljs-string"><span class="hljs-string">"write failed: %v"</span></span>, err) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous combinez l'enregistrement d'erreur avec le retour sur une seule ligne, il est plus difficile d'oublier de revenir et d'√©viter une continuation accidentelle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si une erreur d'E / S se produit lors de l'√©criture du fichier, la m√©thode </font></font><code>Error()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">produira quelque chose comme ceci:</font></font><br><br><pre> <code class="go hljs">could not write config: write failed: input/output error</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.2.2. </font><font style="vertical-align: inherit;">Erreur d'encapsulation avec github.com/pkg/errors</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le mod√®le </font></font><code>fmt.Errorf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionne bien pour l'enregistrement </font><font style="vertical-align: inherit;">des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">messages d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erreur, mais le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type d'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erreur passe par le chemin. </font><font style="vertical-align: inherit;">J'ai soutenu que la gestion des erreurs en tant que valeurs opaques est importante pour </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> projets √† </font><i><font style="vertical-align: inherit;">couplage l√¢che</font></i><font style="vertical-align: inherit;"> , donc le type de l'erreur d'origine ne devrait pas avoir d'importance si nous avons seulement besoin de travailler avec sa valeur:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Assurez-vous qu'il n'est pas nul. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Affichez-le √† l'√©cran ou enregistrez-le. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, il arrive que vous deviez restaurer l'erreur d'origine. </font><font style="vertical-align: inherit;">Pour annoter de telles erreurs, vous pouvez utiliser quelque chose comme mon package </font></font><code>errors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { f, err := os.Open(path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, errors.Wrap(err, <span class="hljs-string"><span class="hljs-string">"open failed"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> f.Close() buf, err := ioutil.ReadAll(f) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, errors.Wrap(err, <span class="hljs-string"><span class="hljs-string">"read failed"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { home := os.Getenv(<span class="hljs-string"><span class="hljs-string">"HOME"</span></span>) config, err := ReadFile(filepath.Join(home, <span class="hljs-string"><span class="hljs-string">".settings.xml"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> config, errors.WithMessage(err, <span class="hljs-string"><span class="hljs-string">"could not read config"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { _, err := ReadConfig() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Println(err) os.Exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant, le message devient un joli bug de style K &amp; D: </font></font><br><br><pre> <code class="go hljs">could not read config: open failed: open /Users/dfc/.settings.xml: no such file or directory</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et sa valeur contient un lien vers la raison d'origine. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { _, err := ReadConfig() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Printf(<span class="hljs-string"><span class="hljs-string">"original error: %T %v\n"</span></span>, errors.Cause(err), errors.Cause(err)) fmt.Printf(<span class="hljs-string"><span class="hljs-string">"stack trace:\n%+v\n"</span></span>, err) os.Exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ainsi, vous pouvez restaurer l'erreur d'origine et afficher la trace de la pile: </font></font><br><br><pre> <code class="plaintext hljs">original error: *os.PathError open /Users/dfc/.settings.xml: no such file or directory stack trace: open /Users/dfc/.settings.xml: no such file or directory open failed main.ReadFile /Users/dfc/devel/practical-go/src/errors/readfile2.go:16 main.ReadConfig /Users/dfc/devel/practical-go/src/errors/readfile2.go:29 main.main /Users/dfc/devel/practical-go/src/errors/readfile2.go:35 runtime.main /Users/dfc/go/src/runtime/proc.go:201 runtime.goexit /Users/dfc/go/src/runtime/asm_amd64.s:1333 could not read config</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le package </font></font><code>errors</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous permet d'ajouter du contexte aux valeurs d'erreur dans un format pratique pour une personne et une machine. </font><font style="vertical-align: inherit;">Lors d'une r√©cente pr√©sentation, je vous ai dit que dans la prochaine version de Go, un tel wrapper appara√Ætra dans la biblioth√®que standard.</font></font><br><br><a name="8"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8. Concurrence </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go est souvent choisi en raison de ses capacit√©s de concurrence. Les d√©veloppeurs ont fait beaucoup pour augmenter son efficacit√© (en termes de ressources mat√©rielles) et sa productivit√©, mais les fonctions de parall√©lisme de Go peuvent √™tre utilis√©es pour √©crire du code qui n'est ni productif ni fiable. √Ä la fin de l'article, je veux donner quelques conseils sur la fa√ßon d'√©viter certains des pi√®ges des fonctions de concurrence de Go. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La prise en charge simultan√©e de premier ordre de Go est fournie par des canaux, ainsi que des instructions </font></font><code>select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et</font></font><code>go</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Si vous avez √©tudi√© la th√©orie du Go dans des manuels ou dans une universit√©, vous avez peut-√™tre remarqu√© que la section sur le parall√©lisme est toujours l'une des derni√®res du cours. </font><font style="vertical-align: inherit;">Notre article n'est pas diff√©rent: j'ai d√©cid√© de parler du parall√©lisme √† la fin, comme quelque chose en plus des comp√©tences habituelles que le programmeur Go devrait apprendre. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe une certaine dichotomie, car la caract√©ristique principale de Go est notre mod√®le simple et facile de parall√©lisme. </font><font style="vertical-align: inherit;">En tant que produit, notre langue se vend aux d√©pens de presque cette seule fonction. </font><font style="vertical-align: inherit;">D'un autre c√¥t√©, la simultan√©it√© n'est en fait pas si facile √† utiliser, sinon les auteurs n'en auraient pas fait le dernier chapitre de leurs livres, et nous n'aurions pas regard√© avec regret notre code. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette section traite de certains des pi√®ges de l'utilisation na√Øve des fonctions de concurrence Go.</font></font><br><br><a name="8_1"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.1. </font><font style="vertical-align: inherit;">Faites du travail tout le temps.</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quel est le probl√®me avec ce programme? </font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Fprintln(w, <span class="hljs-string"><span class="hljs-string">"Hello, GopherCon SG"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } }() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le programme fait ce que nous voulions: il sert un simple serveur Web. </font><font style="vertical-align: inherit;">En m√™me temps, il passe du temps CPU dans une boucle infinie, car </font></font><code>for{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans la derni√®re ligne, il </font></font><code>main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloque gorutin main, sans effectuer d'E / S, il n'y a pas d'attente pour bloquer, envoyer ou recevoir des messages, ou une sorte de connexion avec le sheduler. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que le temps d'ex√©cution Go est g√©n√©ralement servi par un sheduler, ce programme s'ex√©cute de mani√®re insens√©e sur le processeur et peut se retrouver dans un verrou actif (live-lock). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comment y rem√©dier? </font><font style="vertical-align: inherit;">Voici une option.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> <span class="hljs-string"><span class="hljs-string">"runtime"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Fprintln(w, <span class="hljs-string"><span class="hljs-string">"Hello, GopherCon SG"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } }() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> { runtime.Gosched() } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela peut sembler idiot, mais c'est une solution courante qui me vient √† l'esprit dans la vraie vie. </font><font style="vertical-align: inherit;">Il s'agit d'un sympt√¥me d'une mauvaise compr√©hension du probl√®me sous-jacent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous √™tes un peu plus exp√©riment√© avec Go, vous pouvez √©crire quelque chose comme √ßa.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Fprintln(w, <span class="hljs-string"><span class="hljs-string">"Hello, GopherCon SG"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } }() <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> {} }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une instruction vide est </font></font><code>select</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloqu√©e pour toujours. </font><font style="vertical-align: inherit;">C'est utile, car maintenant nous ne faisons pas tourner le processeur entier juste pour un appel </font></font><code>runtime.GoSched()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cependant, nous ne traitons que le sympt√¥me, pas la cause. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je veux vous montrer une autre solution qui, je l'esp√®re, vous est d√©j√† venue √† l'esprit. </font><font style="vertical-align: inherit;">Au lieu de courir </font></font><code>http.ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans goroutine, laissant le probl√®me principal de goroutine, ex√©cutez simplement </font></font><code>http.ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dans le goroutine principal.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si vous quittez la fonction </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le programme Go se termine inconditionnellement, ind√©pendamment de ce que font les autres goroutines en cours d'ex√©cution pendant l'ex√©cution du programme.</font></font></blockquote><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { fmt.Fprintln(w, <span class="hljs-string"><span class="hljs-string">"Hello, GopherCon SG"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est donc mon premier conseil: si le goroutin ne peut pas progresser tant qu'il n'a pas re√ßu le r√©sultat d'un autre, alors il est souvent plus facile de faire le travail soi-m√™me, plut√¥t que de le d√©l√©guer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela √©limine souvent beaucoup de suivi d'√©tat et de manipulation de canal n√©cessaires pour retransf√©rer le r√©sultat de la goroutine √† l'initiateur du processus.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">De nombreux programmeurs Go abusent des goroutines, surtout au d√©but. </font><font style="vertical-align: inherit;">Comme tout le reste de la vie, la cl√© du succ√®s est la mod√©ration.</font></font></blockquote><br><a name="8_2"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.2. </font><font style="vertical-align: inherit;">Laisser le parall√©lisme √† l'appelant</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quelle est la diff√©rence entre les deux API? </font></font><br><br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// ListDirectory returns the contents of dir. func ListDirectory(dir string) ([]string, error)</span></span></code> </pre> <br><pre> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// ListDirectory returns a channel over which // directory entries will be published. When the list // of entries is exhausted, the channel will be closed. func ListDirectory(dir string) chan string</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous mentionnons les diff√©rences √©videntes: le premier exemple lit le r√©pertoire dans une tranche, puis retourne la tranche enti√®re ou l'erreur en cas de probl√®me. Cela se produit de mani√®re synchrone, l'appelant bloque </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jusqu'√† ce que toutes les entr√©es du r√©pertoire aient √©t√© lues. Selon la taille du r√©pertoire, cela peut prendre beaucoup de temps et potentiellement beaucoup de m√©moire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prenons le deuxi√®me exemple. C'est un peu plus comme la programmation Go classique, ici elle </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">renvoie le canal par lequel les entr√©es du r√©pertoire seront transmises. Lorsque le canal est ferm√©, cela signifie qu'il n'y a plus d'entr√©es de catalogue. Puisque le remplissage du canal a lieu apr√®s le retour </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, on peut supposer que les goroutines commencent √† remplir le canal.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dans la deuxi√®me option, il n'est pas n√©cessaire d'utiliser r√©ellement goroutine: vous pouvez s√©lectionner un canal suffisant pour stocker toutes les entr√©es du r√©pertoire sans les bloquer, le remplir, le fermer, puis renvoyer le canal √† l'appelant. </font><font style="vertical-align: inherit;">Mais cela est peu probable, car dans ce cas, les m√™mes probl√®mes se poseront lors de l'utilisation d'une grande quantit√© de m√©moire pour mettre en m√©moire tampon tous les r√©sultats dans le canal.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La version du </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canal a deux autres probl√®mes:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisation d'un canal ferm√© comme signal qu'il n'y a plus d'√©l√©ments √† traiter </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne peut pas informer l'appelant d'un ensemble d'√©l√©ments incomplet en raison d'une erreur. </font><font style="vertical-align: inherit;">L'appelant n'a aucun moyen de transmettre la diff√©rence entre un r√©pertoire vide et une erreur. </font><font style="vertical-align: inherit;">Dans les deux cas, il semble que la cha√Æne sera imm√©diatement ferm√©e.</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'appelant doit continuer √† lire √† partir du canal lorsqu'il est ferm√©, car c'est la seule fa√ßon de comprendre que le goroutine de remplissage du canal a cess√© de fonctionner. </font><font style="vertical-align: inherit;">Il s'agit d'une s√©rieuse restriction d'utilisation </font></font><code>ListDirectory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: l'appelant passe du temps √† lire sur le canal, m√™me s'il a re√ßu toutes les donn√©es n√©cessaires. </font><font style="vertical-align: inherit;">C'est probablement plus efficace en termes d'utilisation de la m√©moire pour les r√©pertoires moyens et grands, mais la m√©thode n'est pas plus rapide que la m√©thode bas√©e sur la tranche d'origine.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dans les deux cas, la solution consiste √† utiliser un rappel: une fonction qui est appel√©e dans le contexte de chaque entr√©e de r√©pertoire lors de son ex√©cution. </font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ListDirectory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, fn </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">func</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">)</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sans surprise, la fonction </font></font><code>filepath.WalkDir</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonctionne de cette fa√ßon.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si votre fonction lance goroutine, vous devez fournir √† l'appelant un moyen d'arr√™ter explicitement cette routine. </font><font style="vertical-align: inherit;">Il est souvent plus facile de laisser le mode d'ex√©cution asynchrone √† l'appelant.</font></font></blockquote><br><a name="8_3"></a><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3. </font><font style="vertical-align: inherit;">Ne jamais courir de goroutine sans savoir quand elle s'arr√™tera</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'exemple pr√©c√©dent, la goroutine a √©t√© utilis√©e inutilement. </font><font style="vertical-align: inherit;">Mais l'une des principales forces de Go est ses capacit√©s de concurrence de premi√®re classe. </font><font style="vertical-align: inherit;">En effet, dans de nombreux cas, un travail parall√®le est tout √† fait appropri√©, et il est alors n√©cessaire d'utiliser des goroutines. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette application simple sert le trafic http sur deux ports diff√©rents: le port 8080 pour le trafic d'application et le port 8001 pour l'acc√®s au point de terminaison </font></font><code>/debug/pprof</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> _ <span class="hljs-string"><span class="hljs-string">"net/http/pprof"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { mux := http.NewServeMux() mux.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resp http.ResponseWriter, req *http.Request)</span></span></span></span> { fmt.Fprintln(resp, <span class="hljs-string"><span class="hljs-string">"Hello, QCon!"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:8001"</span></span>, http.DefaultServeMux) <span class="hljs-comment"><span class="hljs-comment">// debug http.ListenAndServe("0.0.0.0:8080", mux) // app traffic }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien que le programme ne soit pas compliqu√©, il est le fondement d'une v√©ritable application. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'application dans sa forme actuelle pr√©sente plusieurs probl√®mes qui appara√Ætront au fur et √† mesure de leur croissance, alors examinons imm√©diatement certains d'entre eux.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveApp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { mux := http.NewServeMux() mux.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resp http.ResponseWriter, req *http.Request)</span></span></span></span> { fmt.Fprintln(resp, <span class="hljs-string"><span class="hljs-string">"Hello, QCon!"</span></span>) }) http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, mux) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveDebug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:8001"</span></span>, http.DefaultServeMux) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> serveDebug() serveApp() }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gestionnaires de </font><font style="vertical-align: inherit;">rupture </font></font><code>serveApp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>serveDebug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de fonctions distinctes, nous avons s√©par√© les de </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Nous avons √©galement suivi les conseils et pr√©c√©dent assur√©s </font></font><code>serveApp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et </font></font><code>serveDebug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laisser la t√¢che d'assurer le parall√©lisme de l'appelant. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais il y a quelques probl√®mes avec la performance d'un tel programme. </font><font style="vertical-align: inherit;">Si nous quittons </font></font><code>serveApp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puis </font><font style="vertical-align: inherit;">quittons </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le programme se termine et sera red√©marr√© par le gestionnaire de processus.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tout comme les fonctions de Go laissent le parall√©lisme √† l'appelant, les applications doivent cesser de surveiller leur √©tat et red√©marrer le programme qui les a appel√©es. </font><font style="vertical-align: inherit;">Ne rendez pas vos applications responsables du red√©marrage elles-m√™mes: cette proc√©dure est mieux g√©r√©e depuis l'ext√©rieur de l'application.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, il </font></font><code>serveDebug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">commence dans un goroutine s√©par√©, et en cas de sortie, le goroutine se termine, tandis que le reste du programme continue. </font><font style="vertical-align: inherit;">Vos d√©veloppeurs n'aimeront pas le fait que vous ne puissiez pas obtenir de statistiques sur les applications, car le gestionnaire </font></font><code>/debug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a longtemps cess√© de fonctionner. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous devons nous assurer que l'application est ferm√©e si </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> goroutine le servant </font><font style="vertical-align: inherit;">s'arr√™te </font><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveApp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { mux := http.NewServeMux() mux.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resp http.ResponseWriter, req *http.Request)</span></span></span></span> { fmt.Fprintln(resp, <span class="hljs-string"><span class="hljs-string">"Hello, QCon!"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, mux); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveDebug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:8001"</span></span>, http.DefaultServeMux); err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(err) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> serveDebug() <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> serveApp() <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> {} }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, </font></font><code>serverApp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ils </font></font><code>serveDebug</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√©rifient les erreurs </font></font><code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et, si n√©cessaire, les appellent </font></font><code>log.Fatal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Puisque les deux gestionnaires travaillent dans des goroutines, nous √©tablissons la routine principale en </font></font><code>select{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette approche pose un certain nombre de probl√®mes:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S'il </font></font><code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">revient avec une erreur </font></font><code>nil</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, il n'y aura pas d'appel </font></font><code>log.Fatal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et le service HTTP sur ce port se fermera sans arr√™ter l'application.</font></font><br></li><li> <code>log.Fatal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les appels </font></font><code>os.Exit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui quittent inconditionnellement le programme; </font><font style="vertical-align: inherit;">les appels diff√©r√©s ne fonctionneront pas, les autres goroutines ne seront pas inform√©s de la fermeture, le programme s'arr√™tera simplement. </font><font style="vertical-align: inherit;">Cela rend difficile l'√©criture de tests pour ces fonctions.</font></font></li></ol><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Utiliser uniquement </font></font><code>log.Fatal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sur les fonctions </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>init</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fait, nous voulons transmettre toute erreur qui se produit au cr√©ateur de la goroutine, afin qu'il puisse d√©couvrir pourquoi elle a arr√™t√© et termin√© proprement le processus.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveApp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { mux := http.NewServeMux() mux.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resp http.ResponseWriter, req *http.Request)</span></span></span></span> { fmt.Fprintln(resp, <span class="hljs-string"><span class="hljs-string">"Hello, QCon!"</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"0.0.0.0:8080"</span></span>, mux) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serveDebug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">"127.0.0.1:8001"</span></span>, http.DefaultServeMux) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { done := <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> error, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { done &lt;- serveDebug() }() <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { done &lt;- serveApp() }() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-built_in"><span class="hljs-built_in">cap</span></span>(done); i++ { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err := &lt;-done; err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Println(<span class="hljs-string"><span class="hljs-string">"error: %v"</span></span>, err) } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le statut de retour de la goroutine peut √™tre obtenu via le canal. La taille du canal est √©gale au nombre de goroutines que nous voulons contr√¥ler, donc l'envoi vers le canal </font></font><code>done</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne sera pas bloqu√©, car cela bloquera l'arr√™t des goroutines et provoquera une fuite. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que le canal </font></font><code>done</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne peut pas √™tre ferm√© en toute s√©curit√©, nous ne pouvons pas utiliser l'idiome pour le cycle du canal </font></font><code>for range</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jusqu'√† ce que tous les goroutines aient signal√©. Au lieu de cela, nous ex√©cutons tous les goroutines en cours d'ex√©cution dans un cycle, qui est √©gal √† la capacit√© du canal. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons maintenant un moyen de quitter proprement chaque goroutine et de corriger toutes les erreurs qu'ils rencontrent. Il ne reste plus qu'√† envoyer un signal pour terminer le travail du premier goroutine √† tout le monde. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'appel √†</font></font><code>http.Server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√† propos de l'ach√®vement, j'ai donc envelopp√© cette logique dans une fonction d'aide. </font><font style="vertical-align: inherit;">L'assistant </font></font><code>serve</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accepte l'adresse et </font></font><code>http.Handler</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, de m√™me </font></font><code>http.ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, le canal </font></font><code>stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que nous utilisons pour ex√©cuter la m√©thode </font></font><code>Shutdown</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(addr </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, handler http.Handler, stop &lt;-</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">chan</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">struct</span></span></span></span><span class="hljs-function"><span class="hljs-params">{})</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span></span> { s := http.Server{ Addr: addr, Handler: handler, } <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { &lt;-stop <span class="hljs-comment"><span class="hljs-comment">// wait for stop signal s.Shutdown(context.Background()) }() return s.ListenAndServe() } func serveApp(stop &lt;-chan struct{}) error { mux := http.NewServeMux() mux.HandleFunc("/", func(resp http.ResponseWriter, req *http.Request) { fmt.Fprintln(resp, "Hello, QCon!") }) return serve("0.0.0.0:8080", mux, stop) } func serveDebug(stop &lt;-chan struct{}) error { return serve("127.0.0.1:8001", http.DefaultServeMux, stop) } func main() { done := make(chan error, 2) stop := make(chan struct{}) go func() { done &lt;- serveDebug(stop) }() go func() { done &lt;- serveApp(stop) }() var stopped bool for i := 0; i &lt; cap(done); i++ { if err := &lt;-done; err != nil { fmt.Println("error: %v", err) } if !stopped { stopped = true close(stop) } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, pour chaque valeur du canal, </font></font><code>done</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nous </font></font><code>stop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fermons le </font><font style="vertical-align: inherit;">canal </font><font style="vertical-align: inherit;">, ce qui fait que chaque gorutine sur ce canal se ferme </font></font><code>http.Server</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">√Ä son tour, cela conduit √† un retour de tous les goroutines restants </font></font><code>ListenAndServe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Lorsque tous les gorutins en cours d'ex√©cution se sont arr√™t√©s, il </font></font><code>main.main</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se termine et le processus s'arr√™te proprement.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Astuce</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">√âcrire une telle logique par vous-m√™me est un travail r√©p√©titif et le risque d'erreurs. </font><font style="vertical-align: inherit;">Regardez quelque chose comme </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce package</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui fera la plupart du travail pour vous.</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441842/">https://habr.com/ru/post/fr441842/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441826/index.html">Ce qui se passe sur le march√© du streaming audio: discuter du d√©veloppement des plateformes de streaming</a></li>
<li><a href="../fr441830/index.html">Guide de l'utilisateur Kibana. Visualisation. Partie 4</a></li>
<li><a href="../fr441832/index.html">Qui est le chef de projet de l'avis du propri√©taire d'entreprise et comment y faire face</a></li>
<li><a href="../fr441834/index.html">Ne prenez pas au travail. Mais que faire si l'affaire est en vous?</a></li>
<li><a href="../fr441836/index.html">One Cloud Story: Huawei + 3data = Cloud</a></li>
<li><a href="../fr441844/index.html">iRobot Scooba: exp√©rience et solutions aux probl√®mes courants d'un robot de lavage</a></li>
<li><a href="../fr441848/index.html">Stages pour d√©veloppeurs √† Avito: missions de combat et travail avec des mentors exp√©riment√©s</a></li>
<li><a href="../fr441850/index.html">Dire la fortune sur les r√©seaux de neurones: si l'auteur lui-m√™me l'a not√© dans les commentaires sur le post</a></li>
<li><a href="../fr441852/index.html">42 Silicon Valley: comment √™tre s√©lectionn√©</a></li>
<li><a href="../fr441854/index.html">REPOS? Prenez un JSON-RPC stupide</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>