<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Ω üë∏üèΩ üé™ L'histoire de la cr√©ation d'un cloud domestique. Partie 2. Cr√©er un serveur - configurer LAMP dans Debian üë®‚Äç‚öïÔ∏è ‚è∏Ô∏è ü§ô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sur le chemin de la cr√©ation de notre propre service cloud, nous venons de nous habituer au syst√®me Debian . Le moment est maintenant venu pour la pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L'histoire de la cr√©ation d'un cloud domestique. Partie 2. Cr√©er un serveur - configurer LAMP dans Debian</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409915/">  Sur le chemin de la cr√©ation de notre propre service cloud, nous venons de nous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">habituer au syst√®me Debian</a> .  Le moment est maintenant venu pour la prochaine √©tape - la cr√©ation et la configuration d'un serveur Web, sur la base duquel Nextcloud peut √™tre lanc√©. <img src="https://habrastorage.org/webt/ke/r5/x8/ker5x8nlot-vrpcr5iuvyrauhvm.png"><a name="habracut"></a><br><hr><a name="chap0"></a><br><h3>  Table des mati√®res </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Partie 1. Configurer votre environnement Debian pour un usage quotidien</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Partie 2. Cr√©er un serveur - configurer LAMP dans Debian</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Partie 3. Cr√©ation d'un cloud personnel - installation et configuration de Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Partie 4. Mise √† jour 2018 - Debian 9 et Nextcloud 13</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 5. Mise √† jour 2019 - PHP 7.2, MariaDB 10.4 et Nextcloud 17</a> <br><br><hr><br><h3>  Navigation rapide dans les chapitres </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pr√©face</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Installation du logiciel</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configurer le serveur Web Apache2 et y acc√©der via les protocoles HTTP et HTTPS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©glage SQL</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration PHP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Param√®tres d'acc√®s SSH</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Protection d'acc√®s</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©f√©rence du serveur Web</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©f√©rence MySQL</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mat√©riel de r√©f√©rence Fail2ban</a> <br><br><hr><a name="chap1"></a><br><h3>  Pr√©face </h3><br>  La premi√®re partie de cette histoire a montr√© l'une des options possibles pour configurer l'interface graphique Debian pour une utilisation pratique et famili√®re (point de vue exclusivement subjectif de l'auteur) par une personne venue √† Linux depuis Windows.  Et si je n'utilisais que le syst√®me h√¥te pour configurer la machine virtuelle avec Debian, je travaillais sp√©cifiquement uniquement sur cette machine virtuelle, recherchant des informations sur Internet, prenant des notes dans Notepadqq ou gedit, √©coutant de la musique via Audacious, ouvrant des fichiers via LibreOffice et autres.  De cette fa√ßon, vous pouvez vous habituer et vous sentir beaucoup plus profond et appr√©cier de travailler avec le syst√®me d'exploitation et son environnement, qui est assez complet et fonctionnel dans le paquet Debian standard. <br><br>  √Ä l'heure actuelle, notre syst√®me est configur√© de telle mani√®re qu'√† l'avenir, vous ne pourrez utiliser la ligne de commande qu'avec un √©diteur de texte de console, par exemple nano, ou utiliser le gestionnaire de fichiers Double Commander avec l'√©diteur Notepadqq int√©gr√©.  Il est possible de combiner ces deux m√©thodes, par exemple, en naviguant dans le syst√®me et en √©ditant les fichiers de configuration via le gestionnaire de fichiers et toutes les autres commandes via la console.  Toutes les m√©thodes sont √©quivalentes pour obtenir le r√©sultat final. <br><br>  L'objectif actuel est de cr√©er un serveur, auquel cette partie sera consacr√©e.  Le serveur peut √™tre configur√© √† la fois avec l'installation et l'utilisation de l'interface graphique, et sans elle.  Dans le deuxi√®me cas, √† partir de la partie pr√©c√©dente, vous pouvez simplement ignorer les sections concernant l'installation et la configuration du logiciel pour l'interface graphique et ses param√®tres, l'installation de packages de logiciels graphiques et de vmware-tools. <br><br>  Je ne vois rien de mal √† utiliser l'interface graphique lors de la cr√©ation d'un serveur: s'il est plus familier, plus pratique et confortable pour une personne de cr√©er son premier ou son deuxi√®me serveur avec un environnement graphique - pourquoi pas?  Au final, mon serveur web avec une interface graphique a fonctionn√© pendant un an et fonctionnera autant d'ann√©es que n√©cessaire.  Cependant, vous devez garder √† l'esprit certains points. <br><br>  Id√©alement, une fois configur√©, le syst√®me devra fonctionner sans notre intervention pendant tr√®s longtemps.  Mon serveur dans la version "finish" a √©t√© configur√© en deux jours, et a fonctionn√© sans intervention pendant pr√®s d'un an.  Cela signifie que l'interface graphique a √©t√© utilis√©e √† 0,05% de l'existence active du serveur (l'ordinateur ne fonctionne que pendant une demi-journ√©e) et en m√™me temps a consomm√© des ressources: RAM, espace disque, temps processeur.  Toutes ces ressources sont mieux d√©pens√©es pour assurer le fonctionnement du serveur lui-m√™me: par exemple, augmentez memory_limit pour PHP ou stockez plus de donn√©es utilisateur sur le disque dur.  De plus, en cas de probl√®mes et de dysfonctionnements lors de l'utilisation d'un vrai serveur distant, il est souvent beaucoup plus simple d'utiliser l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">acc√®s SSH</a> .  Dans ce contexte, la pr√©sence d'une interface graphique n'est pas souhaitable et c'est pourquoi le deuxi√®me serveur sur mon r√©seau √©tait d√©j√† une machine virtuelle sans environnement graphique sur lequel seul Midnight Commander a √©t√© install√© √† partir du logiciel graphique, que j'ai utilis√© pour naviguer dans le syst√®me de fichiers et √©diter les fichiers de configuration via son √©diteur mcedit .  Par cons√©quent, ce qui suit est une instruction universelle: des commandes donn√©es mettant l'accent sur l'utilisation de la ligne de commande, cependant, il est entendu que pour la toute premi√®re fois, l'utilisateur configure la machine avec un environnement graphique, ce qui est d√ª √† l'utilisation d'un navigateur pour v√©rifier localement la disponibilit√© des sites cr√©√©s et certaines fonctionnalit√©s de la configuration du programme de messagerie. <br><br>  Dans le processus de cr√©ation du serveur et lors de l'ajout de nouveaux sites, j'ai accumul√© des informations de fond qui peuvent √™tre utiles √† un utilisateur novice.  Je l'ai d√©crit apr√®s le mat√©riel sur l'installation et la configuration du serveur. <br><br>  <b>Remarque</b> <br>  Suite √† la lecture des constructions du formulaire http: // 127.0.0.1 (https: // 127.0.0.1), l'espace apr√®s http: // (https: //) doit √™tre supprim√© lors de la saisie de la barre d'adresse du navigateur.  Un espace a √©t√© ins√©r√© lors de la publication de cet article afin d'emp√™cher le moteur de convertir automatiquement le texte en liens. <br><br><hr><a name="chap2"></a><br><h3>  Installation du logiciel </h3><br>  Apache et Nginx sont une paire de serveurs Web open source sur lesquels environ 55% des serveurs dans le monde sont construits.  Apache est le serveur Web le plus populaire depuis 1995 et je l'ai choisi en esp√©rant une bonne documentation, une popularit√© et, pour ainsi dire, je voulais recommencer depuis le d√©but.  Cela ne signifie pas que Nginx est pire: Nginx est plus efficace pour consommer des ressources et travailler sous charge.  Dans le segment russe d'Internet, le serveur Nginx occupe environ 65%, tandis qu'Apache - environ 18%.  Un bon article comparatif de deux serveurs est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">publi√© sur le hub</a> <br><br>  Installation du serveur Web Apache2: <br><br>  <b># apt-get install apache2 apache2-doc</b> <br><br>  Et c'est tout.  Une vingtaine de m√©gaoctets et un serveur web sont d√©j√† install√©s.  Aucun red√©marrage ou r√©glage n'est n√©cessaire - le serveur sait d√©j√† ouvrir des pages <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">HTML</a> .  Cependant, un site Web moderne sur Internet n'est pas seulement un ensemble de fichiers statiques, de styles, de polices, etc., comme il y a vingt ans.  Un site moderne contient des scripts √©crits en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">PHP</a> et les informations dynamiques (par exemple, le contenu texte, les commentaires, les profils utilisateur) ne sont pas √©crites dans des fichiers √† c√¥t√© des fichiers PHP, mais dans une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">base de donn√©es SQL</a> sp√©ciale.  Pour un serveur complet, vous devez prendre en charge ces technologies.  De plus, ce n'est pas difficile: <br><br>  <b># apt-get install mysql-server mysql-client phpmyadmin</b> <br>  <b># apt-get install php5 php5-mysql libapache2-mod-php5</b> <br><br>  Pendant l'installation de MySQL, il vous sera demand√© de d√©finir le mot de passe du superutilisateur mysql et vous devrez s√©lectionner le serveur apache2 pour configurer automatiquement le travail avec mysql.  Lors de l'installation du paquet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">phpmyadmin</a> , j'ai accept√© de configurer automatiquement le paquet et partout entr√© le mot de passe root mysql.  L'installation de PHP se produit sans aucune demande. <br><br>  Je n'ai pas utilis√© PHP7 plus rapide ou MariaDB gratuit comme remplacement SQL ouvert alternatif et j'ai d√©cid√© de construire mon serveur sur le LAMP ¬´canonique¬ª = Linux + Apache + MySQL + PHP, en utilisant des solutions anciennes et √©prouv√©es, en cas de probl√®mes avec lesquels je pouvais rapidement et trouver facilement des informations sur Internet. <br><br>  Trois √©quipes (qui en fait peuvent √™tre r√©duites √† une) et nous avons install√© localement un serveur √† part enti√®re et moderne.  C'est tr√®s simple! <br><br>  Mais la configuration du serveur prend beaucoup plus de temps que l'installation de ses composants.  Initialement, dans cette partie, je voulais montrer mes erreurs typiques, les fausses solutions aux probl√®mes et les r√©sultats qu'ils ont conduits, mais il s'est av√©r√© que beaucoup de choses avaient √©t√© effac√©es de ma m√©moire en un an, j'ai d√ª r√©cup√©rer beaucoup de choses dans les dossiers, donc ci-dessous ne pr√©sentera qu'une instruction de travail avec de petites commentaires, permettant d'atteindre un r√©sultat de travail universel. <br><br><hr><a name="chap3"></a><br><h3>  Configurer le serveur Web Apache2 </h3><br>  Vous devez d'abord vous assurer que le serveur Web fonctionne.  Pour ce faire, ouvrez un navigateur et composez l'adresse http: // 127.0.0.1 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">localhost</a> ).  Une inscription encourageante devrait s'ouvrir: ¬´Apache2 Debian Default Page.  √áa marche! ¬ª  Le serveur fonctionne vraiment.  Si vous avez un ensemble de fichiers de site pour l'an 2000, vous pouvez le placer dans le r√©pertoire / var / www / html et il s'ouvrira probablement sur notre serveur. <br><br><img src="https://habrastorage.org/webt/3t/q6/x-/3tq6x-2ahadvbbshmoxl2_3hfhc.png"><br><br>  Tous les param√®tres de base du serveur Web sont stock√©s dans le chemin / etc / apache2.  Si vous ouvrez ce r√©pertoire, vous pouvez voir le fichier de configuration principal apache2.conf et les r√©pertoires conf-available, mod-available, sites-available.  Ces r√©pertoires contiennent des fichiers pr√©configur√©s avec des param√®tres (les soi-disant extraits), que vous pouvez simplement utiliser par d√©faut, avec vos propres modifications, ou les prendre comme mod√®le pour cr√©er vos propres configurations.  Par exemple, dans le r√©pertoire sites-disponibles se trouve le fichier de configuration d'h√¥te par d√©faut 000-default.conf.  Si vous l'ouvrez et l'√©tudiez, il s'av√®re que ce fichier d√©finit simplement le chemin par lequel notre site Web s'ouvre √† l'adresse http: // 127.0.0.1: ¬´DocumentRoot / var / www / html¬ª.  De plus, la ligne ¬´&lt;VirtualHost *: 80&gt;¬ª signifie que si je lib√®re ma machine sur un r√©seau local et y acc√®de sur le port 80 (port pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">HTTP</a> ), j'ouvrirai un site situ√© sur le chemin / var / www / html.  Comment v√©rifier cela? <br><br>  Vous devez d'abord conna√Ætre l'adresse IP qui a √©t√© attribu√©e √† la machine virtuelle apr√®s son chargement.  Pour afficher la configuration des adaptateurs r√©seau, ex√©cutez: <br><br>  <b># ifconfig</b> <br><br>  Dans les informations affich√©es sur la console, il est facile de d√©terminer que l'adresse suivante est d√©finie pour l'adaptateur eth0: <br><br> <code>inet addr:192.168.233.138</code> <br> <br>  Maintenant sur la machine h√¥te, j'ouvre l'adresse du navigateur http: // 192.168.233.138 dans le navigateur et je m'attends √† ce qu'une page famili√®re s'ouvre.  Mais ... elle n'ouvre pas.  Apr√®s un certain temps, mon navigateur √©crit: "La connexion a expir√©."  Et il √©crit correctement.  En effet, dans la premi√®re partie j'ai allum√© le pare-feu, mais le port 80 ne s'est pas ouvert!  Corrigeons ceci: <br><br>  <b># ufw allow 80</b> <br><br>  Encore une fois, essayez d'ouvrir l'adresse http: // 192.168.233.138 et assurez-vous que la page attendue s'ouvre.  L'h√¥te virtuel dans la machine virtuelle s'est ouvert de l'ext√©rieur de toute cette virtualisation.  Nous avons fait un petit pas dans la construction de notre propre petit Internet virtuel. <br><br>  En plus des r√©pertoires disponibles, il existe √©galement des r√©pertoires activ√©s qui contiennent ce qui est actuellement ¬´inclus¬ª.  Si vous les regardez, vous pouvez voir que ces r√©pertoires contiennent des liens vers des fichiers situ√©s dans les r√©pertoires disponibles.  Il n'y a actuellement qu'un seul lien dans le r√©pertoire activ√© pour les sites - le fichier /etc/apache2/sites-available/000-default.conf.  C'est tr√®s pratique - nous pouvons contr√¥ler les raccourcis sur ou hors des h√¥tes sans modifier leurs fichiers de configuration.  De plus, la source de la configuration est de savoir si un fichier de configuration est inclus ind√©pendamment ou non maintenant, ce qui √©vite les erreurs lorsqu'un √©l√©ment est corrig√© dans un fichier et oubli√© dans un autre.  Pour d√©sactiver notre h√¥te, vous devez supprimer le raccourci requis et pour l'activer, cr√©ez-le.  Afin de ne pas supprimer ou cr√©er des raccourcis manuellement, il est plus facile et plus fiable d'utiliser des utilitaires sp√©ciaux. <br><br>  D√©sactivez l'h√¥te virtuel: <br><br>  <b># a2dissite 000-default</b> <br><br>  Activez l'h√¥te virtuel: <br><br>  <b># a2enssite 000-default</b> <br><br>  Apr√®s chaque modification, vous devez red√©marrer les configurations d'h√¥te ou red√©marrer le serveur: <br><br>  <b># service apache2 reload</b> <br><br>  ou <br><br>  <b># service apache2 restart</b> <br><br>  Ainsi, une compr√©hension de base de la fa√ßon de configurer des h√¥tes r√©guliers dans apache est maintenant disponible, puis je montrerai un exemple de la fa√ßon dont j'ai configur√© mon serveur pour fonctionner sur les protocoles HTTP et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">HTTPS</a> . <br><br>  Vous devez commencer par le fait que lors de la d√©connexion de l'h√¥te virtuel 000 par d√©faut, la d√©connexion en tant que telle ne se produit pas.  C'est-√†-dire que le site est ouvert de l'int√©rieur et de l'ext√©rieur de la machine virtuelle - et s'ouvrira, que sa configuration se trouve ou non dans le dossier compatible avec les sites.  C'√©tait inattendu et j'ai pass√© un temps relativement long √† comprendre si j'avais bien fait ou bien compris.  Jusqu'√† la fin, je ne comprenais toujours pas cela, apparemment cela est d√ª au fait que le chemin / var / www / html est d√©fini globalement comme r√©pertoire par d√©faut pour DocumentRoot.  Comme je ne voulais pas que quelque chose d'inutile soit inclus et accessible, j'ai d√©cid√© de me d√©barrasser du r√©pertoire html lui-m√™me, et pour tout / var / www imbriqu√©, de refuser l'acc√®s par d√©faut. <br><br>  Pour configurer l'h√¥te virtuel par d√©faut, j'ai √©dit√© son fichier de configuration: <br><br>  <b># nano /etc/apache2/sites-available/000-default.conf</b> <br><br>  Le contenu du fichier de configuration est le suivant: <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;VirtualHost *:80&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span></span></span> localhost ServerAdmin user@localhost DocumentRoot /var/www &lt;Directory /var/www&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> denied &lt;/Directory&gt; ErrorLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/error.log CustomLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/access.log combined &lt;/VirtualHost&gt;</code> </pre> <br>  Avec cette configuration, j'ai r√©initialis√© le r√©pertoire par d√©faut sur / var / www, autoris√© le serveur √† suivre les liens symboliques dans ce r√©pertoire, autoris√© le serveur √† ex√©cuter toutes les directives d√©clar√©es dans les fichiers .htaccess trouv√©s et refus√© l'acc√®s √† ce r√©pertoire.  La logique de ces actions est que je peux contr√¥ler l'acc√®s √† ce r√©pertoire sans acc√©der aux param√®tres du serveur Web et sans le red√©marrer.  Vous devez maintenant v√©rifier cette solution. <br>  Transf√©rez le fichier: <br><br>  <b># mv /var/www/html/index.html /var/www/index.html</b> <br><br>  Et supprimez le r√©pertoire: <br><br>  <b># rm / var / www / html</b> <br><br>  Nous red√©marrons le serveur pour que les nouveaux param√®tres par d√©faut de l'h√¥te virtuel prennent effet: <br><br>  <b># service apache2 restart</b> <br><br>  Cr√©ez un fichier: <br><br>  <b># nano /var/www/.htaccess</b> <br><br>  Dans lequel nous √©crivons une ligne (sans guillemets): "Exiger tout accord√©". <br><br>  Pour r√©sumer.  Maintenant, il n'y a pas de chemin / var / www / html, mais l'h√¥te est par d√©faut reconfigur√© sur le chemin / var / www, o√π se trouve le fichier index.html, et par d√©faut, au niveau du serveur Web, l'acc√®s √† ce r√©pertoire est refus√©, mais le contenu est autoris√© localement le fichier .htaccess qui s'y trouve. <br><br>  Ouvrez le navigateur http: // 127.0.0.1 et consultez la page d√©j√† famili√®re ¬´Apache2 Debian Default Page.  √áa marche. "  V√©rifions maintenant l'op√©rabilit√© du contr√¥le d'acc√®s "local": <br>  Supprimez le fichier .htaccess: <br><br>  <b># rm /var/www/.htaccess</b> <br><br>  Et nous mettons √† jour la page ouverte dans le navigateur - la page avec l'avis de restriction d'acc√®s (Interdit) devrait s'ouvrir.  Oui, tout cela fonctionne, donc tout est fait correctement. <br><br>  En principe, ces param√®tres simples sont suffisants pour permettre un fonctionnement sans tracas suppl√©mentaire du serveur Web.  Mais cela ne me semblait pas suffisant.  Maintenant, notre serveur Web ne peut fonctionner qu'en utilisant le protocole HTTP.  Mais qu'en est-il du protocole HTTPS?  Apr√®s tout, si √† l'avenir pour apporter des projets bas√©s sur ce serveur Web √† Internet, la possibilit√© de travailler sur ce protocole est au moins souhaitable.  Et j'ai d√©cid√© d'organiser le support HTTPS bas√© sur la cr√©ation d'un certificat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">SSL</a> auto-sign√©. <br><br>  Vous devez d'abord obtenir un certificat SSL qui sera install√© sur notre serveur.  Nous n'avons pas de domaine et nous n'avons pas non plus d'adresse IP statique.  Mais tout cela n'a pas d'importance, car je vais g√©n√©rer le certificat moi-m√™me, en utilisant les outils de mon syst√®me. <br><br>  Attention!  Les instructions ci-dessous supposent que le serveur est install√© sur une machine sans nom.  S'il existe un v√©ritable IP ou nom de domaine, alors ils doivent √™tre sp√©cifi√©s √† TROIS endroits: &lt;Nom commun IP / Domaine&gt;;  &lt;ServerName IP / Domain&gt;;  &lt;Redirection "/" "https: // IP / Domaine /"&gt; - dans les constructions appropri√©es, remplacez IP / Domaine par une adresse IP ou un nom de domaine.  Dans le texte ci-dessous, localhost est utilis√© √† la place de IP / Domain. <br><br>  G√©n√©rez un certificat SSL: <br><br>  <b># openssl req -x509 -nodes -days 3650 -newkey rsa: 2048 -keyout /etc/ssl/private/apache-selfsigned.key -out /etc/ssl/certs/apache-selfsigned.crt</b> <br><br>  Cette commande cr√©era un certificat auto-sign√© de la norme X.509 tout de suite pendant 10 ans en ignorant l'option de protection de certificat avec une phrase secr√®te - cela est n√©cessaire pour qu'au d√©marrage du serveur Apache puisse lire le fichier sans intervention de l'utilisateur, car en d√©finissant un mot de passe, vous devrez l'entrer apr√®s chaque d√©marrage ou red√©marrage serveur.  Avec le certificat, une nouvelle cl√© RSA pour 2048 bits sera cr√©√©e, avec laquelle le certificat sera sign√©.  Les options ‚Äìkeyout et ‚Äìout indiquent les chemins le long desquels OpenSSL doit g√©n√©rer la cl√© et le certificat. <br><br>  Dans le processus de cr√©ation du certificat, des questions seront pos√©es, auxquelles j'ai indiqu√© les donn√©es suivantes: <br><br><blockquote>  Nom du pays = MW <br>  Nom de l'√âtat ou de la province = Sun System <br>  Nom de la localit√© = Lunaire <br>  Nom de l'organisation = Hellium Inc. <br>  Nom de l'unit√© organisationnelle = 2 <br>  Nom commun = localhost <br>  Adresse e-mail = utilisateur @ localhost </blockquote><br>  Ensuite, cr√©ez les cl√©s Diffie-Hellman pour fournir un support <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">PFS</a> : <br><br>  <b># openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048</b> <br><br>  Les points et les avantages s'ex√©cuteront dans le terminal et apr√®s la fin du dessin anim√©, vous pouvez cr√©er le fichier ssl-params.conf dans lequel les param√®tres SSL du serveur seront d√©finis: <br><br>  <b># nano /etc/apache2/conf-available/ssl-params.conf</b> <br><br>  Pour une configuration s√©curis√©e et √† jour, j'ai utilis√© le code g√©n√©r√© dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">g√©n√©rateur pour configurer SSL sur mozilla.github.io</a> .  Dans le g√©n√©rateur, j'ai s√©lectionn√© le serveur Apache2, le profil Modern et d√©fini correctement les versions du serveur et d'OpenSSL, qui peuvent √™tre reconnues par les commandes suivantes: <br><br>  <b># apache2 -v</b> <b><br></b>  <b># version openssl</b> <br><br>  En cons√©quence, j'ai obtenu le texte suivant: <br><br><pre> <code class="apache hljs"><span class="hljs-comment"><span class="hljs-comment"># 14-01-2018 / for apache2 2.4.10 &amp; openssl 1.0.1t # from https://mozilla.github.io/server-side-tls/ssl-config-generator/ # parametrs help: https://raymii.org/s/tutorials/Strong_SSL_Security_On_Apache2.html # modern configuration, tweak to your needs SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1 SSLCipherSuite ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256 SSLHonorCipherOrder on SSLCompression off # OCSP Stapling, only in httpd 2.3.3 and later SSLUseStapling on SSLStaplingResponderTimeout 5 SSLStaplingReturnResponderErrors off SSLStaplingCache shmcb:/var/run/ocsp(128000)</span></span></code> </pre> <br>  Configurez maintenant l'h√¥te virtuel avec le support SSL: <br><br>  <b># nano /etc/apache2/sites-available/default-ssl.conf</b> <br><br>  J'ai apport√© le texte de ce fichier sous la forme suivante: <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;IfModule mod_ssl.c&gt;</span></span> <span class="hljs-section"><span class="hljs-section">&lt;VirtualHost _default_:443&gt;</span></span> <span class="hljs-attribute"><span class="hljs-attribute">ServerAdmin</span></span> user@localhost ServerName localhost DocumentRoot /var/www &lt;Directory /var/www&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> denied &lt;/Directory&gt; # HSTS (mod_headers is required) (15768000 seconds = 6 months) Header always set Strict-Transport-Security <span class="hljs-string"><span class="hljs-string">"max-age=15768000"</span></span> ErrorLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/error.log CustomLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/access.log combined SSLEngine <span class="hljs-literal"><span class="hljs-literal">on</span></span> SSLCertificateFile /etc/ssl/certs/apache-selfsigned.crt SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key &lt;FilesMatch <span class="hljs-string"><span class="hljs-string">"\.(cgi|shtml|phtml|php)$"</span></span>&gt; SSLOptions +StdEnvVars &lt;/FilesMatch&gt; &lt;Directory /usr/lib/cgi-bin&gt; SSLOptions +StdEnvVars &lt;/Directory&gt; BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [2-6]"</span></span> \ nokeepalive ssl-unclean-shutdown \ downgrade-1.0 force-response-1.0 BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [17-9]"</span></span> ssl-unclean-shutdown &lt;/VirtualHost&gt; &lt;/IfModule&gt;</code> </pre> <br>  De ce qui pr√©c√®de, il s'ensuit que nous avons √©galement / var / www d√©fini comme le r√©pertoire DocumentRoot, dont l'acc√®s est configur√© de mani√®re similaire aux param√®tres pr√©c√©dents.  Le m√©canisme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">HSTS</a> est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">activ√©</a> , ce qui permet de forcer la connexion via le protocole HTTPS.  La prise en charge SSL est incluse avec le certificat et la cl√© utilis√©s, ainsi que la prise en charge du traitement des donn√©es de certificat dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">les</a> scripts PHP et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">CGI</a> .  La derni√®re section est con√ßue pour assurer la compatibilit√© avec les versions ant√©rieures d'Internet Explorer et, en g√©n√©ral, n'est pas n√©cessaire. <br><br>  Maintenant, faisons la touche finale. <br><br>  Ouvrons le port pour SSL: <br><br>  <b># ufw allow 443</b> <br><br>  Activez les modules apache pour la prise en charge SSL et HSTS: <br><br>  <b># a2enmod ssl</b> <b><br></b>  <b># en-t√™tes a2enmod</b> <br><br>  Activer la configuration SSL: <br><br>  <b># a2enconf ssl-params</b> <br><br>  Activer l'h√¥te virtuel compatible SSL: <br><br>  <b># a2ensite default-ssl</b> <br><br>  Red√©marrez le serveur pour accepter tous les nouveaux param√®tres: <br><br>  <b># service apache2 restart</b> <br><br>  Le moment int√©ressant est donc venu: v√©rifier l'op√©rabilit√© des nouvelles fonctionnalit√©s du syst√®me configur√©. <br><br>  Cr√©ez un fichier: <br><br>  <b># nano /var/www/.htaccess</b> <br><br>  Dans lequel nous prescrivons une ligne: "Exiger que tout soit accord√©". <br><br>  Ouvrez dans le navigateur https: // 127.0.0.1.  Une page sur un certificat inconnu devrait s'ouvrir, apr√®s l'avoir accept√©e (autorisation unique ou permanente), une page famili√®re avec une notification sur un serveur Web en cours d'ex√©cution s'ouvrira. <br><br>  Supprimez le fichier .htaccess: <br><br>  <b># rm /var/www/.htaccess</b> <br><br>  Et nous mettons √† jour la page ouverte dans le navigateur - la page avec l'avis de restriction d'acc√®s (Interdit) devrait s'ouvrir.  Tout fonctionne correctement.  D√©sormais, nos sites sont accessibles via HTTP et HTTPS. <br><br>  L'acc√®s HTTP peut √™tre laiss√© activ√©, d√©sactiv√© ou forc√© √† rediriger vers HTTPS. <br><br>  Pour l'acc√®s activ√© HTTP, rien n'est √† faire, car le serveur traite les demandes pour les ports 80 et 443 individuellement et notre site dans le dossier / var / www s'ouvrira √† la fois via HTTP et via HTTPS. <br><br>  Pour d√©sactiver l'acc√®s HTTP, il vous suffit de d√©sactiver l'h√¥te virtuel correspondant et de red√©marrer le serveur Web: <br><br>  <b># a2dissite 000-default</b> <b><br></b>  <b># service apache2 restart</b> <br><br>  Maintenant, si vous ouvrez http: // 127.0.0.1 dans un navigateur, une page avec une notification concernant l'absence de page (Not Found) devrait s'ouvrir. <br><br>  La troisi√®me option la plus int√©ressante.  Dans ce cas, HTTP reste officiellement activ√©, mais le traitement des donn√©es sera redirig√© de force via HTTPS. <br><br>  Pour ce faire, activez d'abord le module de redirection: <br><br>  <b># a2enmod r√©√©criture</b> <br><br>  Ouvrez maintenant le fichier 000-default.conf: <br><br>  <b># nano /etc/apache2/sites-available/000-default.conf</b> <br><br>  Et avant la balise de fermeture, ajoutez le texte suivant: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">On</span></span> RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{HTTPS}</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span> RewriteRule (.*) https://<span class="hljs-variable"><span class="hljs-variable">%{HTTP_HOST}</span></span><span class="hljs-variable"><span class="hljs-variable">%{REQUEST_URI}</span></span><span class="hljs-meta"><span class="hljs-meta"> [NC,R=301,L]</span></span></code> </pre> <br>  Red√©marrez le serveur: <br><br>  <b># service apache2 restart</b> <br><br>  Cr√©ez un fichier: <br><br>  <b># nano /var/www/.htaccess</b> <br><br>  Dans lequel nous prescrivons une ligne: "Exiger que tout soit accord√©". <br><br>  Maintenant, si vous ouvrez l'adresse http: // 127.0.0.1 dans un navigateur, nous serons automatiquement redirig√©s vers https: // 127.0.0.1 avec un avertissement concernant un certificat inconnu (s'il n'a pas √©t√© pr√©c√©demment ajout√© √† la liste d'exclusion dans le navigateur), apr√®s l'avoir accept√©e, une d√©j√† famili√®re s'ouvrira page de notification du serveur Web. <br><br><hr><a name="chap4"></a><br><h3>  R√©glage SQL </h3><br>  Pour la configuration initiale de mysql, ex√©cutez simplement la commande suivante: <br><br>  <b># mysql_secure_installation</b> <br><br>  Apr√®s avoir entr√© le mot de passe du superutilisateur mysql, j'ai r√©pondu aux questions pos√©es dans l'ordre suivant: <br><br><ul><li>  a refus√© de changer le mot de passe root; </li><li>  a confirm√© la suppression des utilisateurs anonymes de la base de donn√©es; </li><li>  Confirm√© le blocage de la connexion distante pour root (pour des raisons de s√©curit√©, root n'est connect√© que localement); </li><li>  a confirm√© la suppression des bases de donn√©es de tests; </li><li>  accept√© de recharger les tables de privil√®ges. </li></ul><br>  Pour v√©rifier l'int√©grit√© de mysql, vous pouvez ex√©cuter la commande suivante: <br><br>  <b># mysql -uroot -p</b> <br><br>  Apr√®s avoir entr√© le mot de passe du superutilisateur mysql, nous voyons l'invite mysql - cela signifie que le service est op√©rationnel.  Vous pouvez quitter le terminal mysql en entrant la commande exit. <br><br>  Pour v√©rifier les performances de phpmyadmin, ouvrez l'adresse http: // 127.0.0.1/phpmyadmin dans le navigateur.  Si une page s'ouvre avec une invitation √† entrer dans phpmyadmin, alors le service est op√©rationnel. <br><br><hr><a name="chap5"></a><br><h3>  Configuration PHP </h3><br>  Apr√®s avoir install√© PHP, j'ai ouvert son fichier de param√®tres: <br><br>  <b># nano /etc/php5/apache2/php.ini</b> <br><br>  Et il a apport√© quelques param√®tres √† la forme suivante: <br><br><ul><li>  memory_limit = 1024M </li><li>  default_charset = "UTF-8" </li><li>  upload_max_filesize = 256M </li><li>  sendmail_path = /usr/bin/fake_sendmail.sh </li></ul><br>  En utilisant le module PHP, vous pouvez fournir la mise en cache des donn√©es en m√©moire.  La mise en cache est utile en cas de charge √©lev√©e du serveur pour les donn√©es, dont la g√©n√©ration n√©cessite une grande quantit√© de ressources, par exemple, les r√©sultats des requ√™tes vers la base de donn√©es ou le traitement de morceaux "lourds" d'un mod√®le de site.  En tant que serveur de mise en cache, j'ai choisi le module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">memcached</a> . <br><br>  Installez memcache: <br><br>  <sup>[ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">Ce texte a √©t√©</a> √©crit sp√©cifiquement pour le site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">geektimes.ru</a> par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">AlexanderS</a> .</sup> <sup><br></sup>  <sup>Le lien vers la source est facultatif, mais sa r√©f√©rence est hautement souhaitable!</sup>  <sup>]</sup> <br><br>  <b># apt-get install memcached php5-memcached</b> <br><br>  Regardons les param√®tres de configuration du service: <br><br>  <b># nano /etc/memcached.conf</b> <br><br>  Dans les param√®tres, j'ai augment√© la taille de la m√©moire utilis√©e pour la mise en cache: -m 64 -&gt; -m 256. Et j'ai v√©rifi√© la disponibilit√© du mode de fonctionnement uniquement dans la zone locale: -l 127.0.0.1. <br><br>  Nous red√©marrons le service de mise en cache et le serveur Web: <br><br>  <b># red√©marrage memcached de service</b> <b><br></b>  <b># service apache2 restart</b> <br><br>  Vous devez maintenant vous assurer que le service fonctionne.  Pour ce faire, cr√©ez un fichier: <br><br>  <b># nano /var/www/info.php</b> <br><br>  Et ajoutez-y le texte suivant: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> phpinfo (); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  N'oubliez pas de v√©rifier l'existence du fichier .htaccess dans le r√©pertoire / var / www avec le contenu permissif correspondant, s'il n'est pas l√†, cr√©ez-le. <br><br>  Vous pouvez maintenant ouvrir dans votre navigateur http: // 127.0.0.1/info.php - une page contenant des informations sur PHP devrait s'ouvrir, dans laquelle vous devez v√©rifier la section memcached.  Si le tableau appara√Æt - PHP fonctionne. <br><br>  Vous pouvez v√©rifier le service memcached en cours d'ex√©cution comme ceci: <br><br>  <b>$ ps -aux |</b>  <b>grep memcached</b> <br><br>  Le terminal doit renvoyer une cha√Æne contenant des param√®tres memcached. <br><br>  <b>Cr√©ation d'un talon de messagerie pour PHP</b> <br><br>  Dans les param√®tres PHP, un script shell a √©t√© sp√©cifi√© comme param√®tre sendmail_path.  La fonction de ce script est de sauvegarder les lettres envoy√©es via la fonction standard php mail () sur la machine locale, dans un dossier pratique, et de ne pas les envoyer quelque part. <br><br>  Cr√©ez un fichier: <br><br>  <b># nano /usr/bin/fake_semdmail.sh</b> <br><br>  Avec le contenu suivant: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh prefix="/var/mail/sendmail/new" numPath="/var/mail/sendmail" if [ ! -f $numPath/num ]; then echo "0" &gt; $numPath/num fi num=`cat $numPath/num` num=$(($num + 1)) echo $num &gt; $numPath/num name="$prefix/letter_$num.txt" while read line do echo $line &gt;&gt; $name done chmod 777 $name /bin/true</span></span></code> </pre> <br>  Rendez ce fichier ex√©cutable: <br><br>  <b># chmod + x /usr/bin/fake_semdmail.sh</b> <br><br>  Cr√©ez les r√©pertoires n√©cessaires dont vous pourriez avoir besoin si vous configurez la collecte de lettres par le programme de messagerie: <br><br>  <b># mkdir / var / mail / sendmail / var / mail / sendmail / cur / var / mail / sendmail / new / var / mail / sendmail / tmp</b> <br><br>  Et nous attribuons des droits pour que le serveur puisse √©crire des fichiers dans ce dossier: <br><br>  <b># chmod 777 -R / var / mail / sendmail</b> <br><br>  Maintenant, tout le courrier sortant sera ajout√© √† / var / mail / sendmail.  Ils peuvent √™tre consult√©s avec un √©diteur de texte, ou peuvent √™tre collect√©s par le programme de messagerie.  Le logiciel pr√©install√© Debian est livr√© avec un client de messagerie Evolution.  Lors de la configuration d'un compte, s√©lectionnez ¬´R√©pertoires de messagerie au format Maildir¬ª comme type de serveur et sp√©cifiez le chemin d'acc√®s au r√©pertoire de messagerie (/ var / mail / sendmail), puis s√©lectionnez ¬´Sendmail¬ª comme serveur. <br><br>  C‚Äôest tout.  En g√©n√©ral, nous avons termin√© avec le serveur - une machine virtuelle universelle est obtenue, sur la base de laquelle vous pouvez cr√©er vos services r√©seau.  J'ai quitt√© les acc√®s HTTP et HTTPS.  Cependant, apr√®s avoir acquis de l'exp√©rience dans la cr√©ation et la configuration d'un serveur, ainsi que dans l'ajout de sites (voir ci-dessous), je recommanderais de cr√©er une nouvelle machine virtuelle avec un serveur sans interface graphique comme consommation de ressources la plus optimale. <br><br><hr><a name="chap6"></a><br><h3>  Param√®tres d'acc√®s SSH </h3><br>  Un serveur ne serait pas un serveur complet sans acc√®s via SSH.  Le soi-disant ¬´shell¬ª vous permet de vous connecter rapidement et en toute s√©curit√© √† un serveur distant, en utilisant, par exemple, un petit programme de mastic - sur l'ordinateur local, nous avons un acc√®s direct au terminal du serveur distant. <br><br>  Installation du service: <br><br>  <b># apt-get install ssh</b> <br><br>  Ouvrons le port pour SSH (en fait, le port par d√©faut devrait √™tre au num√©ro 22, mais ci-dessous j'ai red√©fini le port dans la configuration SSH): <br><br>  <b># ufw allow 106</b> <br><br>  Pour organiser l'acc√®s pour notre utilisateur utilisateur, ouvrez le fichier: <br><br>  <b># nano / etc / ssh / sshd_config</b> <br><br>  Et ajoutez la directive √† la fin du fichier: <br><br><blockquote>  Utilisateur AllowUsers </blockquote><br>  De plus, pour des raisons de s√©curit√©, j'ai apport√© les modifications suivantes √† ce fichier: <br><br><ul><li>  port chang√© de 22 √† un autre ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="nofollow">liste des ports</a> ): Port 22 -&gt; Port 106 </li><li>  d√©sactiv√© le protocole h√©rit√©: Protocole 2.1 -&gt; Protocole 2 </li><li>  acc√®s distant d√©sactiv√© pour root: PermitRootLogin oui (ou PermitRootLogin sans mot de passe) -&gt; PermitRootLogin non </li></ul><br>  Red√©marrez ensuite le service: <br><br>  <b># service sshd restart</b> <br><br>  Maintenant, je peux ex√©cuter le programme putty sur la machine h√¥te et me connecter √† mon serveur en mode console en entrant l'adresse de connexion 192.168.233.138, le port 106 et le nom d'utilisateur.             user.      ,       su. <br><br><hr><a name="chap7"></a><br><h3>   </h3><br>      -  DDoS,  ,       VPS/VDS,     ,      ¬´¬ª  ,           .   Slow HTTP DDoS          ,       ,     IP . <br><br>  DDoS       - .   ,     ,   .    -     SSH,      ,     ,       SSH ‚Äì  . <br><br>    ,    ‚Äì   ,       SSH.     ¬´¬ª           IP     ,     ,       ,             SSH  FTP. ,        -,           ,          . <br><br>    ,     fail2ban: <br><br> <b># apt-get install fail2ban</b> <br><br>                        ,       .   fail2ban   ‚Äì       ,   ,    . <br><br>     : <br><br> <b># nano /etc/fail2ban/jail.local</b> <br><br>      ,       .    : <br><br> <code>#   <br> [DEFAULT] <br> ignoreip = 127.0.0.1 <br> bantime = 2592000 <br> findtime = 43200 <br> maxretry = 6 <br> banaction = iptables-multiport <br> #      <br> destemail = user@localhost <br> sendername = Fail2Ban <br> mta = sendmail <br> action = %(action_mwl)s <br> <br> #  SSH <br> [ssh] <br> enabled = true <br> port = 106 <br> filter = sshd <br> logpath = /var/log/auth.log <br> <br> #      <br> [apache] <br> enabled = true <br> port = http,https <br> filter = apache-auth <br> logpath = /var/log/apache*/*error.log <br> <br> #        php  <br> [apache-noscript] <br> enabled = true <br> port = http,https <br> filter = apache-noscript <br> logpath = /var/log/apache*/*error.log <br> <br> #     <br> [apache-overflows] <br> enabled = true <br> port = http,https <br> filter = apache-overflows <br> logpath = /var/log/apache*/*error.log <br> maxretry = 2 <br> <br> #          <br> [apache-nohome] <br> enabled = true <br> port = http,https <br> filter = apache-nohome <br> logpath = /var/log/apache*/*error.log <br> maxretry = 2</code> <br> <br>        ,         12   IP  ,  iptables,  30 .        SSH,    ,     -. <br><br><hr><a name="chap8"></a><br><h3>    - </h3><br> ,    : <br><br> <b># service apache2 start <br> # service apache2 stop <br> # service apache2 restart</b> <br><br>   : <br><br> <b># service apache2 reload</b> <br><br>     test: <br><br> <b># a2ensite test <br> # a2dissite test</b> <br><br>     test: <br><br> <b># a2enconf test <br> # a2disconf test</b> <br><br>    ( : ¬´Syntax OK¬ª): <br><br> <b># apache2ctl configtest</b> <br><br> <b>      HTTP  HTTPS    </b> <br><br> ,       ,    site.com,   /home/user/www.    ,    user            . <br><br>      (  ): <br><br> <b># chmod 755 /home/user</b> <br><br>    : <br><br> <b>$ mkdir /home/user/www /home/user/www/site.com</b> <br><br>      : <br><br> <b># ln -s /home/user/www/site.com /var/www/site.com</b> <br><br>     HTTP  : <br><br> <b># nano /etc/apache2/sites-available/000-default.conf</b> <br><br>      HTTPS  : <br><br>  <b># nano /etc/apache2/sites-available/default-ssl.conf</b> <br><br>           /VirtualHost: <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;Directory /var/www/site.com&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">Options</span></span></span></span> FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt;</code> </pre> <br>  -: <br><br> <b># service apache2 restart</b> <br><br>      http:// 127.0.0.1/site.com  https:// 127.0.0.1/site.com (  ‚Äî . ).   ,          .htaccess,        : ¬´Require all granted¬ª. <br><br> <b>      HTTP  HTTPS             ,   IP</b> <br><br>   ‚Äì  ,   : ,       ,    site.com,   /home/user/www.                . <br><br>      (  ): <br><br> <b># chmod 755 /home/user</b> <br><br>    : <br><br> <b>$ mkdir /home/user/www/site.com</b> <br><br>      : <br><br> <b># ln -s /home/user/www/site.com /var/www/site.com</b> <br><br>     HTTP  : <br><br> <b># nano /etc/apache2/sites-available/site.com.conf</b> <br><br>      : <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;VirtualHost *:80&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span></span></span> site.com ServerAlias www.site.com ServerAdmin user@localhost DocumentRoot /var/www/site.com &lt;Directory /var/www/site.com&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt; # Redirect HTTP-&gt;HTTPS #RewriteEngine <span class="hljs-literal"><span class="hljs-literal">On</span></span> #RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{HTTPS}</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span> #RewriteRule (.*) https://<span class="hljs-variable"><span class="hljs-variable">%{HTTP_HOST}</span></span><span class="hljs-variable"><span class="hljs-variable">%{REQUEST_URI}</span></span><span class="hljs-meta"><span class="hljs-meta"> [NC,R=301,L] ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined &lt;/VirtualHost&gt;</span></span></code> </pre> <br>      HTTPS  : <br><br> <b># nano /etc/apache2/sites-available/site.com-ssl.conf</b> <br><br>      : <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;IfModule mod_ssl.c&gt;</span></span> <span class="hljs-section"><span class="hljs-section">&lt;VirtualHost _default_:443&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span></span></span> site.com ServerAlias www.site.com ServerAdmin user@localhost DocumentRoot /var/www/site.com &lt;Directory /var/www/site.com&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt; # HSTS (mod_headers is required) (15768000 seconds = 6 months) Header always set Strict-Transport-Security <span class="hljs-string"><span class="hljs-string">"max-age=15768000"</span></span> ErrorLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/error.log CustomLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/access.log combined SSLEngine <span class="hljs-literal"><span class="hljs-literal">on</span></span> SSLCertificateFile /etc/ssl/certs/apache-selfsigned.crt SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key &lt;FilesMatch <span class="hljs-string"><span class="hljs-string">"\.(cgi|shtml|phtml|php)$"</span></span>&gt; SSLOptions +StdEnvVars &lt;/FilesMatch&gt; &lt;Directory /usr/lib/cgi-bin&gt; SSLOptions +StdEnvVars &lt;/Directory&gt; BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [2-6]"</span></span> \ nokeepalive ssl-unclean-shutdown \ downgrade-1.0 force-response-1.0 BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [17-9]"</span></span> ssl-unclean-shutdown &lt;/VirtualHost&gt; &lt;/IfModule&gt;</code> </pre> <br>  /etc/hosts   ¬´127.0.0.1 site.com¬ª: <br><br> <b># echo &gt;&gt; /etc/hosts 127.0.0.1 site.com</b> <br><br>  HTTP : <br><br> <b># a2ensite site.com.conf</b> <br><br>   HTTPS : <br><br> <b># a2ensite site.com-ssl.conf</b> <br><br>  -: <br><br> <b># service apache2 restart</b> <br><br>      http:// site.com  https:// site.com (  ‚Äì . ).   ,          .htaccess,        : ¬´Require all granted¬ª. <br><br>       .    ¬´¬ª     .  Ce n'est pas difficile.      IP   .    Windows,     c:\Windows\System32\drivers\etc\hosts       : <br><br><blockquote> 192.168.233.138 site.com </blockquote><br>         . ,      site.com         . ,             . <br><br>  ,         HTTPS,        HTTP   : <br><br> ‚Äî   /etc/apache2/sites-available/site.com.conf   ,     <br> ‚Äî   /etc/apache2/sites-available/site.com.conf    RewriteEngine/RewriteCond/RewriteRule <br> ‚Äî   site.com.conf,     <br> ‚Äî  : # service apache2 restart <br><br> <b>   </b> <br><br>       ‚Äî       index.html  - . <br><br>   index.html: <br><br> <b>$ nano /home/user/www/site.com/index.html</b> <br><br>      : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>TEST OK<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>TEST OK<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>           http:// 127.0.0.1/site.com (https:// 127.0.0.1/site.com)  http:// site.com (https:// site.com) ‚Äî      ¬´TEST OK¬ª. <br><br><hr><a name="chap9"></a><br><h3>    MySQL </h3><br>   user123   pass123    db123  . <br><br>   mysql,    mysql  : <br><br> <b># mysql -u root -p</b> <br><br>     ( ¬´mysql&gt;¬ª   ,      ): <br><br> <b>mysql&gt; CREATE DATABASE `db123`;</b> <br><br>   user123   pass123: <br><br> <b>mysql&gt; CREATE USER 'user123'@'localhost' IDENTIFIED BY 'pass123';</b> <br><br>      : <br><br> <b>mysql&gt; GRANT ALL PRIVILEGES ON `db123`.* TO 'user123'@'localhost';</b> <br><br>   : <br><br> <b>mysql&gt; FLUSH PRIVILEGES;</b> <br><br>   mysql: <br><br> <b>mysql&gt; exit</b> <br><br>     http:// 127.0.0.1/phpmyadmin      user123/ pass123.       db123. <br><br>    root mysql c pass123  pass456: <br><br> <b># mysqladmin -uroot -ppass123 password pass456</b> <br><br>    user123 c pass123  pass456: <br><br> <b># mysqladmin -uuser123 -ppass123 password pass456</b> <br><br>   user123: <br><br> <b>mysql&gt; DROP USER 'user123'@'localhost';</b> <br><br>   db123: <br><br> <b>mysql&gt; DROP DATABASE `db123`;</b> <br><br><hr><a name="chap10"></a><br><h3>    fail2ban </h3><br>  : <br><br> <b># service fail2ban restart</b> <br><br>   : <br><br> <b># fail2ban-client status</b> <br><br>     sshd: <br><br> <b># fail2ban-client status ssh</b> <br><br> : <br><br> <b># fail2ban-client set ssh unbanip Banned_IP</b> <br><br><hr><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> ,  </a> . <br><br><hr><br>  L'histoire de la cr√©ation d'un cloud domestique.  2.   ‚Äî  LAMP  Debian. <br>  : 1.0.1. <br>   : 30.01.2018. <br>   : 15.01.2020. <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> 1.0.1 [15-01-2020] <br>  . <br><br> 1.0.0 [30-01-2018] <br>  . <br>     LAMP  Debian 8.7.x. <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr409915/">https://habr.com/ru/post/fr409915/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr409901/index.html">Vous pouvez toujours entrer deux fois dans la m√™me rivi√®re</a></li>
<li><a href="../fr409903/index.html">Pourquoi les √©quations les plus complexes de la physique sont-elles si difficiles?</a></li>
<li><a href="../fr409905/index.html">Comment utiliser un smartphone pour am√©liorer la sant√©</a></li>
<li><a href="../fr409907/index.html">Roulette russe Ecola</a></li>
<li><a href="../fr409911/index.html">Les nouvelles r√©visions des modules bas√©s sur ESP8266 ne peuvent pas √©crire dans Flash SPI</a></li>
<li><a href="../fr409917/index.html">R√©sultats d'une √©tude de 4 ans sur les r√©cifs coralliens: le plastique tue le corail</a></li>
<li><a href="../fr409919/index.html">Demandez √† Ethan: dans quelle mesure sommes-nous proches de la th√©orie de tout?</a></li>
<li><a href="../fr409921/index.html">Rapport de fiabilit√© du disque dur Backblaze: statistiques de 2013 √† 2017</a></li>
<li><a href="../fr409923/index.html">Les math√©maticiens ont trouv√© un probl√®me dans les fameuses √©quations pour la description des liquides</a></li>
<li><a href="../fr409925/index.html">Tricherie en direct sur l'accident d'Ariane 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>