<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïµüèΩ ü•É üë©üèæ‚ÄçüöÄ Python como o caso final de C ++. Parte 2/2 üóÇÔ∏è üë®üèø‚Äçüé® üõå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Para ser continuado. Come√ßando em Python como o caso final de C ++. Parte 1/2 ". 
 Vari√°veis ‚Äã‚Äãe tipos de dados 


 Agora que finalmente descobrimos a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Python como o caso final de C ++. Parte 2/2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464405/"><p>  Para ser continuado.  Come√ßando em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Python como o caso final de C ++.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1/2</a> ". </p><br><h1>  Vari√°veis ‚Äã‚Äãe tipos de dados </h1><br><p>  Agora que finalmente descobrimos a matem√°tica, vamos decidir o que as vari√°veis ‚Äã‚Äãdevem significar em nossa linguagem. </p><br><p>  No C ++, um programador tem uma op√ß√£o: use vari√°veis ‚Äã‚Äãautom√°ticas colocadas na pilha ou mantenha valores na mem√≥ria de dados do programa, colocando apenas ponteiros para esses valores na pilha.  E se escolhermos apenas uma dessas op√ß√µes para Python? </p><br><p>  Obviamente, nem sempre podemos usar apenas os valores das vari√°veis, pois grandes estruturas de dados n√£o cabem na pilha ou seu movimento constante na pilha cria problemas de desempenho.  Portanto, usaremos apenas ponteiros no Python.  Isso simplificar√° conceitualmente o idioma. </p><a name="habracut"></a><br><p>  Ent√£o a express√£o </p><br><pre><code class="python hljs">a = <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  significa que criamos um objeto ‚Äú3‚Äù na mem√≥ria de dados do programa (a chamada ‚Äúpilha‚Äù) e fizemos do nome ‚Äúa‚Äù uma refer√™ncia a ele.  E a express√£o </p><br><pre> <code class="python hljs">b = a</code> </pre> <br><p>  neste caso, significa que for√ßamos a vari√°vel "b" a se referir ao mesmo objeto na mem√≥ria a que "a" se refere, ou seja, copiamos o ponteiro. </p><br><p>  Se tudo √© um ponteiro, quantos tipos de lista precisamos implementar em nosso idioma?  Claro, apenas um √© uma lista de indicadores!  Voc√™ pode us√°-lo para armazenar n√∫meros inteiros, seq√º√™ncias de caracteres, outras listas, o que for - afinal, esses s√£o indicadores. </p><br><p>  Quantos tipos de tabelas de hash precisamos implementar?  (No Python, esse tipo √© chamado de "dicion√°rio" - <code>dict</code> .) Um!  Deixe associar ponteiros √†s chaves e ponteiros aos valores. </p><br><p>  Portanto, n√£o precisamos implementar em nossa linguagem uma grande parte da especifica√ß√£o C ++ - modelos, pois executamos todas as opera√ß√µes nos objetos, e os objetos sempre s√£o acess√≠veis pelo ponteiro.  Obviamente, os programas escritos em Python n√£o precisam se limitar ao trabalho com ponteiros: existem bibliotecas como o NumPy, com as quais os cientistas trabalham com matrizes de dados na mem√≥ria, como faria no Fortran.  Mas a base da linguagem - express√µes como "a = 3" - sempre funciona com ponteiros. </p><br><p>  O conceito de "tudo √© um ponteiro" tamb√©m simplifica a composi√ß√£o dos tipos at√© o limite.  Quer uma lista de dicion√°rios?  Basta criar uma lista e colocar dicion√°rios l√°!  Voc√™ n√£o precisa pedir permiss√£o ao Python, n√£o precisa declarar tipos adicionais, tudo funciona imediatamente. </p><br><p>  Mas e se quisermos usar objetos compostos como chaves?  A chave no dicion√°rio deve ter um valor imut√°vel; caso contr√°rio, como procurar valores por ela?  As listas est√£o sujeitas a altera√ß√µes, portanto, n√£o podem ser usadas nessa capacidade.  Para tais situa√ß√µes, o Python possui um tipo de dados que, como uma lista, √© uma sequ√™ncia de objetos, mas, diferentemente de uma lista, essa sequ√™ncia n√£o muda.  Esse tipo √© chamado de tupla ou <code>tuple</code> (pronunciada "tupla" ou "tupla"). </p><br><p>  As tuplas no Python resolvem um problema de longa data da linguagem de script.  Se voc√™ n√£o est√° impressionado com esse recurso, provavelmente nunca tentou usar linguagens de script para trabalhos s√©rios com dados, nos quais √© poss√≠vel usar apenas cadeias ou apenas tipos primitivos como chave nas tabelas de hash. </p><br><p>  Outra possibilidade que as tuplas nos d√£o √© retornar v√°rios valores de uma fun√ß√£o sem precisar declarar tipos de dados adicionais para isso, como voc√™ deve fazer em C e C ++.  Al√©m disso, para facilitar o uso desse recurso, o operador de atribui√ß√£o recebeu a capacidade de descompactar automaticamente as tuplas em vari√°veis ‚Äã‚Äãseparadas. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_address</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> host, port host, port = get_address()</code> </pre> <br><p>  A descompacta√ß√£o tem v√°rios efeitos colaterais √∫teis, por exemplo, a troca de valores de vari√°veis ‚Äã‚Äãpode ser escrita da seguinte maneira: </p><br><pre> <code class="python hljs">x, y = y, x</code> </pre> <br><p>  Tudo √© um ponteiro, o que significa que fun√ß√µes e tipos de dados podem ser usados ‚Äã‚Äãcomo dados.  Se voc√™ conhece o livro ‚ÄúDesign Patterns‚Äù dos autores de ‚ÄúThe Gang of Four‚Äù, lembre-se dos m√©todos complexos e confusos que ele oferece para parametrizar a escolha do tipo de objeto criado pelo seu programa em tempo de execu√ß√£o.  De fato, em muitas linguagens de programa√ß√£o isso √© dif√≠cil de fazer!  No Python, todas essas dificuldades desaparecem, porque sabemos que uma fun√ß√£o pode retornar um tipo de dados, que fun√ß√µes e tipos de dados s√£o apenas links e links podem ser armazenados, por exemplo, em dicion√°rios.  Isso simplifica a tarefa at√© o limite. </p><br><p>  David Wheeler disse: "Todos os problemas de programa√ß√£o s√£o resolvidos criando um n√≠vel adicional de indire√ß√£o".  O uso de links no Python √© o n√≠vel de indire√ß√£o tradicionalmente usado para resolver muitos problemas em v√°rias linguagens, incluindo C ++.  Mas se for usado explicitamente l√°, e isso complica os programas, no Python √© usado implicitamente, de maneira uniforme em rela√ß√£o a dados de todos os tipos, e √© f√°cil de usar. </p><br><p>  Mas se tudo √© um link, a que esses links se referem?  Idiomas como C ++ t√™m muitos tipos.  Vamos deixar no Python apenas um tipo de dados - um objeto!  Especialistas no campo da teoria dos tipos balan√ßam a cabe√ßa com desaprova√ß√£o, mas acredito que um tipo de dado de origem, do qual todos os outros tipos na linguagem s√£o derivados, √© uma boa id√©ia que garanta a uniformidade da linguagem e sua facilidade de uso. </p><br><p>  Para conte√∫dos espec√≠ficos da mem√≥ria, v√°rias implementa√ß√µes do Python (PyPy, Jython ou MicroPython) podem gerenciar a mem√≥ria de maneiras diferentes.  Mas, para entender melhor como a simplicidade e a uniformidade do Python s√£o implementadas, para formar o modelo mental correto, √© melhor recorrer √† implementa√ß√£o de refer√™ncia do Python em C chamada CPython, que pode ser baixada em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">python.org</a> . </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typeobject</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ob_type</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* followed by object's data */</span></span> }</code> </pre> <br><p>  O que veremos no c√≥digo fonte do CPython √© uma estrutura que consiste em um ponteiro para informa√ß√µes sobre o tipo de uma determinada vari√°vel e uma carga √∫til que define o valor espec√≠fico da vari√°vel. </p><br><p>  Como as informa√ß√µes de tipo funcionam?  Vamos nos aprofundar no c√≥digo fonte do CPython novamente. </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typeobject</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> getattrfunc tp_getattr; setattrfunc tp_setattr; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> newfunc tp_new; freefunc tp_free; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> binaryfunc nb_add; binaryfunc nb_subtract; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> richcmpfunc tp_richcompare; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>  Vemos indicadores de fun√ß√µes que fornecem todas as opera√ß√µes poss√≠veis para um determinado tipo: adi√ß√£o, subtra√ß√£o, compara√ß√£o, acesso a atributos, indexa√ß√£o, fatiamento etc. Essas opera√ß√µes sabem como trabalhar com a carga √∫til localizada na mem√≥ria abaixo de um ponteiro para digitar informa√ß√µes, seja um n√∫mero inteiro, sequ√™ncia ou objeto de um tipo criado pelo usu√°rio. </p><br><p>  Isso √© radicalmente diferente de C e C ++, no qual as informa√ß√µes de tipo est√£o associadas a nomes, n√£o a valores de vari√°veis.  No Python, todos os nomes est√£o associados aos links.  O valor por refer√™ncia, por sua vez, √© do tipo.  Essa √© a ess√™ncia das linguagens din√¢micas. </p><br><p>  Para entender todos os recursos da linguagem, basta definir duas opera√ß√µes nos links.  Um dos mais √≥bvios √© copiar.  Quando atribu√≠mos um valor a uma vari√°vel, a um slot em um dicion√°rio ou a um atributo de um objeto, copiamos os links.  Esta √© uma opera√ß√£o simples, r√°pida e completamente segura: copiar links n√£o altera o conte√∫do do objeto. </p><br><p>  A segunda opera√ß√£o √© uma chamada de fun√ß√£o ou m√©todo.  Como mostramos acima, um programa Python pode interagir com a mem√≥ria apenas atrav√©s de m√©todos implementados em objetos internos.  Portanto, n√£o pode causar um erro relacionado ao acesso √† mem√≥ria. </p><br><p>  Voc√™ pode ter uma pergunta: se todas as vari√°veis ‚Äã‚Äãcont√™m refer√™ncias, como posso proteger o valor de uma vari√°vel das altera√ß√µes passando sua fun√ß√£o como par√¢metro? </p><br><pre> <code class="python hljs">n = <span class="hljs-number"><span class="hljs-number">3</span></span> some_function(n) <span class="hljs-comment"><span class="hljs-comment"># Q: I just passed a pointer! # Could some_function() have changed ‚Äú3‚Äù?</span></span></code> </pre> <br><p>  A resposta √© que tipos simples em Python s√£o imut√°veis: eles simplesmente n√£o implementam o m√©todo respons√°vel por alterar seu valor.  O imut√°vel (imut√°vel) <code>int</code> , <code>float</code> , <code>tuple</code> ou <code>str</code> fornece em linguagens como "tudo √© um ponteiro" o mesmo efeito sem√¢ntico que vari√°veis ‚Äã‚Äãautom√°ticas fornecem em C. </p><br><p>  Tipos e m√©todos unificados simplificam o uso de programa√ß√£o generalizada, ou gen√©ricos, tanto quanto poss√≠vel.  As fun√ß√µes <code>min()</code> , <code>max()</code> , <code>sum()</code> e similares s√£o incorporadas, n√£o h√° necessidade de import√°-las.  E eles funcionam com todos os tipos de dados nos quais as opera√ß√µes de compara√ß√£o para <code>min()</code> e <code>max()</code> s√£o implementadas, adi√ß√µes para <code>sum()</code> , etc. </p><br><h1>  Criar objetos </h1><br><p>  Descobrimos em termos gerais como os objetos devem se comportar.  Agora vamos determinar como vamos cri√°-los.  Esta √© uma quest√£o de sintaxe da linguagem.  O C ++ suporta pelo menos tr√™s maneiras de criar um objeto: </p><br><ol><li>  Autom√°tico, declarando uma vari√°vel desta classe: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">my_class </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(arg)</span></span></span></span>;</code> </pre> </li><li>  Usando o <code>new</code> operador: <br><pre> <code class="cpp hljs">my_class *c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> my_class(arg);</code> </pre> </li><li>  Factory, chamando uma fun√ß√£o arbitr√°ria que retorna um ponteiro: <br><pre> <code class="cpp hljs">my_class *c = my_factory(arg);</code> </pre> </li></ol><br><p>  Como voc√™ provavelmente j√° adivinhou, tendo estudado a maneira de pensar dos criadores de Python nos exemplos acima, agora devemos escolher um deles. </p><br><p>  Do mesmo livro, The Gangs of Four, aprendemos que uma f√°brica √© a maneira mais flex√≠vel e universal de criar objetos.  Portanto, apenas esse m√©todo √© implementado no Python. </p><br><p>  Al√©m da universalidade, esse m√©todo √© bom, pois voc√™ n√£o precisa sobrecarregar a linguagem com sintaxe desnecess√°ria para garantir: uma chamada de fun√ß√£o j√° est√° implementada em nossa linguagem e uma f√°brica nada mais √© do que uma fun√ß√£o. </p><br><p>  Outra regra para criar objetos em Python √© a seguinte: qualquer tipo de dados √© sua pr√≥pria f√°brica.  Obviamente, voc√™ pode escrever qualquer n√∫mero de f√°bricas personalizadas adicionais (que ser√£o fun√ß√µes ou m√©todos comuns, √© claro), mas a regra geral permanecer√° v√°lida: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Let's make type objects # their own type's factories! c = MyClass() i = int('7') f = float(length) s = str(bytes)</span></span></code> </pre> <br><p>  Todos os tipos s√£o chamados objetos e todos retornam valores de seu tipo, determinados pelos argumentos transmitidos na chamada. </p><br><p>  Assim, usando apenas a sintaxe b√°sica da linguagem, qualquer manipula√ß√£o na cria√ß√£o de objetos, como os padr√µes ‚ÄúArena‚Äù ou ‚ÄúAdapta√ß√£o‚Äù, pode ser encapsulada, pois outra √≥tima id√©ia emprestada do C ++ √© que o pr√≥prio tipo determina como isso acontece gerando seus objetos, como o <code>new</code> operador trabalha para ele. </p><br><h1>  E quanto a NULL? </h1><br><p>  O manuseio de um ponteiro nulo aumenta a complexidade do programa, portanto, proibimos o uso de NULL.  A sintaxe do Python torna imposs√≠vel criar um ponteiro nulo.  Duas opera√ß√µes elementares em ponteiros, sobre as quais falamos anteriormente, s√£o definidas de tal maneira que qualquer vari√°vel aponta para algum objeto. </p><br><p>  Como resultado, o usu√°rio n√£o pode usar o Python para criar um erro relacionado a um acesso √† mem√≥ria, como um erro de segmenta√ß√£o ou fora dos limites do buffer.  Em outras palavras, os programas Python n√£o s√£o afetados pelos dois tipos de vulnerabilidades mais perigosos que amea√ßam a seguran√ßa da Internet nos √∫ltimos 20 anos. </p><br><p>  Voc√™ pode perguntar: "Se a estrutura das opera√ß√µes nos objetos n√£o for alterada, como vimos anteriormente, como os usu√°rios criar√£o suas pr√≥prias classes, com m√©todos e atributos n√£o listados nessa estrutura?" </p><br><p>  A m√°gica est√° no fato de que, para classes personalizadas, o Python possui uma "prepara√ß√£o" muito simples, com um pequeno n√∫mero de m√©todos implementados.  Aqui est√£o os mais importantes: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typeobject</span></span></span><span class="hljs-class"> {</span></span> getattrfunc tr_getattr; setattrfunc tr_setattr; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> newfunc tp_new; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>  <code>tp_new()</code> cria uma tabela de hash para a classe de usu√°rio, a mesma do tipo <code>dict</code> .  <code>tp_getattr()</code> extrai algo dessa tabela de hash e <code>tp_setattr()</code> , pelo contr√°rio, coloca algo l√°.  Assim, a capacidade das classes arbitr√°rias de armazenar quaisquer m√©todos e atributos √© fornecida n√£o no n√≠vel das estruturas da linguagem C, mas em um n√≠vel superior - uma tabela de hash.  (Obviamente, com exce√ß√£o de alguns casos relacionados √† otimiza√ß√£o de desempenho.) </p><br><h1>  Modificadores de acesso </h1><br><p>  O que fazemos com todas as regras e conceitos criados em torno das palavras-chave C ++ <code>private</code> e <code>protected</code> ?  Python, sendo uma linguagem de script, n√£o precisa deles.  J√° temos partes "protegidas" do idioma - esses s√£o dados de tipos internos.  Sob nenhuma circunst√¢ncia o Python permitir√° que um programa, por exemplo, manipule os bits de um n√∫mero de ponto flutuante!  Esse n√≠vel de encapsulamento √© suficiente para manter a integridade do pr√≥prio idioma.  N√≥s, criadores do Python, acreditamos que a integridade da linguagem √© o √∫nico bom pretexto para ocultar informa√ß√µes.  Todas as outras estruturas e dados do programa do usu√°rio s√£o considerados p√∫blicos. </p><br><p>  Voc√™ pode escrever um sublinhado ( <code>_</code> ) no in√≠cio de um nome de atributo de classe para avisar um colega: voc√™ n√£o deve confiar nesse atributo.  Mas o restante do Python aprendeu as li√ß√µes do in√≠cio dos anos 90: ent√£o muitos acreditavam que a principal raz√£o pela qual escrevemos programas inchados, ileg√≠veis e com erros √© a falta de vari√°veis ‚Äã‚Äãprivadas.  Acho que os pr√≥ximos 20 anos convenceram a todos na ind√∫stria de programa√ß√£o: vari√°veis ‚Äã‚Äãprivadas n√£o s√£o as √∫nicas e est√£o longe de ser o rem√©dio mais eficaz para programas inchados e com erros.  Portanto, os criadores do Python decidiram nem se preocupar com vari√°veis ‚Äã‚Äãprivadas e, como voc√™ pode ver, elas n√£o falharam. </p><br><h1>  Gerenciamento de mem√≥ria </h1><br><p>  O que acontece com nossos objetos, n√∫meros e seq√º√™ncias de caracteres em um n√≠vel inferior?  Como exatamente eles s√£o armazenados na mem√≥ria, como o CPython fornece acesso compartilhado a eles, quando e sob quais condi√ß√µes eles s√£o destru√≠dos? </p><br><p>  E, nesse caso, escolhemos a maneira mais geral, previs√≠vel e produtiva de trabalhar com a mem√≥ria: do lado do programa C, todos os nossos objetos s√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ponteiros compartilhados</a> . </p><br><p>  Com esse conhecimento em mente, as estruturas de dados que examinamos anteriormente na se√ß√£o "Vari√°veis ‚Äã‚Äãe tipos de dados" devem ser complementadas da seguinte maneira: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> Py_ssize_t ob_refcnt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typeobject</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ob_type</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* followed by object's data */</span></span> } }</code> </pre> <br><p>  Portanto, todo objeto em Python (queremos dizer a implementa√ß√£o do CPython, √© claro) tem seu pr√≥prio contador de refer√™ncia.  Depois de zero, o objeto pode ser exclu√≠do. </p><br><p>  O mecanismo de contagem de links n√£o depende de c√°lculos adicionais ou processos em segundo plano - um objeto pode ser destru√≠do instantaneamente.  Al√©m disso, fornece alta localidade dos dados: geralmente, a mem√≥ria come√ßa a ser usada novamente imediatamente ap√≥s ser liberada.  O objeto rec√©m-destru√≠do provavelmente foi usado recentemente, o que significa que estava no cache do processador.  Portanto, o objeto rec√©m-criado permanecer√° no cache.  Esses dois fatores - simplicidade e localidade - tornam a contagem de links uma maneira muito produtiva de coleta de lixo. </p><br><p>  (Como objetos em programas reais geralmente se referem um ao outro, o contador de refer√™ncia em certos casos n√£o pode cair para zero, mesmo quando os objetos n√£o s√£o mais usados ‚Äã‚Äãno programa. Portanto, o CPython tamb√©m possui um segundo mecanismo de coleta de lixo - um segundo, baseado em em gera√ß√µes de objetos - <em>aproximadamente tradu√ß√£o</em> ) </p><br><h1>  Erros de desenvolvedor Python </h1><br><p>  Tentamos desenvolver uma linguagem que fosse simples o suficiente para iniciantes, mas tamb√©m atraente o suficiente para profissionais.  Ao mesmo tempo, n√£o fomos capazes de evitar erros no entendimento e no uso das ferramentas que n√≥s mesmos criamos. </p><br><p>  O Python 2, devido √† in√©rcia do pensamento associado √†s linguagens de script, tentou converter tipos de string, como faria uma linguagem com digita√ß√£o fraca.  Se voc√™ tentar combinar uma sequ√™ncia de bytes com uma sequ√™ncia em Unicode, o int√©rprete converte implicitamente a sequ√™ncia de bytes em Unicode usando a tabela de c√≥digos dispon√≠vel no sistema e apresenta o resultado em Unicode: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-string"><span class="hljs-string">'byte string '</span></span> + <span class="hljs-string"><span class="hljs-string">u'unicode string'</span></span> <span class="hljs-string"><span class="hljs-string">u'byte string unicode string'</span></span></code> </pre> <br><p>  Como resultado, alguns sites funcionaram bem enquanto seus usu√°rios usavam o ingl√™s, mas eles produziram erros enigm√°ticos ao usar caracteres de outros alfabetos. </p><br><p>  Este erro de design de linguagem foi corrigido no Python 3: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-string"><span class="hljs-string">b'byte string '</span></span> + <span class="hljs-string"><span class="hljs-string">u'unicode string'</span></span> TypeError: can<span class="hljs-string"><span class="hljs-string">'t concat bytes to str</span></span></code> </pre> <br><p>  Um erro semelhante no Python 2 estava relacionado √† classifica√ß√£o "ing√™nua" de listas que consistem em elementos incompar√°veis: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>sorted([<span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>]) [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>]</code> </pre> <br><p>  O Python 3, neste caso, deixa claro para o usu√°rio que ele est√° tentando fazer algo n√£o muito significativo: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>sorted([<span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>]) TypeError: unorderable types: int() &lt; str()</code> </pre> <br><h1>  Abusos </h1><br><p>  De vez em quando, os usu√°rios √†s vezes abusam da natureza din√¢mica da linguagem Python e, nos anos 90, quando as pr√°ticas recomendadas ainda n√£o eram amplamente conhecidas, isso acontecia com frequ√™ncia: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, host, port)</span></span></span><span class="hljs-function">:</span></span> self.host = host self.port = port</code> </pre> <br><p>  "Mas isso n√£o √© o ideal!"  - Alguns disseram: - ‚ÄúE se a porta n√£o diferir do valor padr√£o?  De qualquer forma, gastamos um atributo de classe inteiro em seu armazenamento! ‚Äù  E o resultado √© algo como </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, host, port=None)</span></span></span><span class="hljs-function">:</span></span> self.host = host <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> port <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-comment"><span class="hljs-comment"># so terrible self.port = port</span></span></code> </pre> <br><p>  Portanto, objetos do mesmo tipo aparecem no programa, que, no entanto, n√£o podem ser operados de maneira uniforme, pois alguns deles t√™m um determinado atributo, enquanto outros n√£o!  E n√£o podemos tocar nesse atributo sem verificar sua presen√ßa com anteced√™ncia: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># code was forced to use introspection # (terrible!) if hasattr(addr, 'port'): print(addr.port)</span></span></code> </pre> <br><p>  Atualmente, a abund√¢ncia de <code>hasattr()</code> , <code>isinstance()</code> e outras introspec√ß√µes √© um sinal seguro de c√≥digo incorreto e √© considerado uma boa pr√°tica tornar atributos sempre presentes no objeto.  Isso fornece uma sintaxe mais simples ao acess√°-lo: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># today's best practice: # every atribute always present if addr.port is not None: print(addr.port)</span></span></code> </pre> <br><p>  Portanto, os primeiros experimentos com atributos exclu√≠dos e adicionados dinamicamente terminaram, e agora analisamos as classes no Python da mesma maneira que no C ++. </p><br><p>  Outro mau h√°bito do Python inicial era o uso de fun√ß√µes nas quais um argumento pode ter tipos completamente diferentes.  Por exemplo, voc√™ pode pensar que pode ser muito dif√≠cil para o usu√°rio criar uma lista de nomes de colunas a cada vez e permitir que ele os passe tamb√©m como uma √∫nica linha, onde os nomes de colunas individuais s√£o separados por, por exemplo, uma v√≠rgula: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dataframe</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, columns)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(columns, str): columns = columns.split(<span class="hljs-string"><span class="hljs-string">','</span></span>) self.columns = columns</code> </pre> <br><p>  Mas essa abordagem pode dar origem a seus problemas.  Por exemplo, e se um usu√°rio acidentalmente nos fornecer uma linha que n√£o se destina a ser usada como uma lista de nomes de colunas?  Ou se o nome da coluna deve conter uma v√≠rgula? </p><br><p>  Al√©m disso, esse c√≥digo √© mais dif√≠cil de manter, depurar e especialmente testar: nos testes, apenas um dos dois tipos suportados por n√≥s pode ser verificado, mas a cobertura ainda ser√° 100% e n√£o testaremos o outro tipo. </p><br><p>  Como resultado, chegamos √† conclus√£o de que o Python permite que o usu√°rio passe argumentos de qualquer tipo para fun√ß√µes, mas a maioria deles na maioria das situa√ß√µes usar√° uma fun√ß√£o da mesma maneira que em C: passar√° um argumento do mesmo tipo para ela. </p><br><p>  A necessidade de usar <code>eval()</code> em um programa √© considerada um erro de c√°lculo expl√≠cito da arquitetura.  Provavelmente, voc√™ simplesmente n√£o descobriu como fazer o mesmo de uma maneira normal.     ‚àí ,      Jupyter notebook  -       ‚àí  <code>eval()</code>  ,      Python   ! ,     C++    . </p><br><p>     ,  ( <code>getattr()</code> , <code>hasattr()</code> , <code>isinstance()</code> )          .   ,   ,   ,      ,       : , ,  , ! </p><br><h1>   </h1><br><p>      :     ,           . 20             ,   C++  Python.   ,     ,    .         . </p><br><p>        ,    <code>shared_ptr</code>  TensorFlow   2016  2018 . </p><br><p> TensorFlow ‚àí       C++-,         Python- ( C++ ‚àí     TensorFlow, ). </p><br><p><img src="https://habrastorage.org/webt/dm/1g/zo/dm1gzovjtl2qbda7muz5wjzzjhq.png" alt="imagem"></p><br><p>         TensorFlow,  <code>shared_ptr</code> ,     .     ,     . </p><br><p>      C++?       .    ,   ?     ,     ,  C++  Python! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt464405/">https://habr.com/ru/post/pt464405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt464391/index.html">10 relat√≥rios interessantes de confer√™ncias de hackers</a></li>
<li><a href="../pt464393/index.html">Como encontrar cursos de programa√ß√£o e quais s√£o as garantias de emprego</a></li>
<li><a href="../pt464395/index.html">Aleat√≥rio baseado em blockchain RSA</a></li>
<li><a href="../pt464399/index.html">Raspagem da Web no R, Parte 2. Acelerando o processo com computa√ß√£o paralela e usando o pacote Rcrawler</a></li>
<li><a href="../pt464403/index.html">Como executar um projeto java em um shell runner ao enviar para um reposit√≥rio GitLab</a></li>
<li><a href="../pt464407/index.html">Como funcionam os maiores sistemas de vigil√¢ncia por v√≠deo do mundo</a></li>
<li><a href="../pt464409/index.html">Como a pol√≠tica do s√©culo XIX afetou hoje as localiza√ß√µes de data centers</a></li>
<li><a href="../pt464411/index.html">PVS-Studio: Motor do progresso</a></li>
<li><a href="../pt464413/index.html">PVS-Studio - mecanismo de progresso</a></li>
<li><a href="../pt464415/index.html">Novo servi√ßo de dica para pesquisar hh.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>