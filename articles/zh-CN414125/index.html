<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🆖 ⚗️ 🕌 我们如何测试VMware vSAN™：为何在实践中起作用 📩 🚮 🧘🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="一年前，我从一堆Intel NUC组装了一个数据中心 。 有一个软件存储系统，清洁女工无法破坏，集群崩溃了几次。 

 现在，我们决定以良好的配置在多台服务器上运行vSAN，以便全面评估该解决方案的性能和容错能力。 当然，我们为客户在生产中实现了许多成功的实施，其中vSAN成功解决了设定的任务，但无...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我们如何测试VMware vSAN™：为何在实践中起作用</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/croc/blog/414125/"> 一年前，我<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">从一堆Intel NUC组装了一个数据中心</a> 。 有一个软件存储系统，清洁女工无法破坏，集群崩溃了几次。 <br><br> 现在，我们决定以良好的配置在多台服务器上运行vSAN，以便全面评估该解决方案的性能和容错能力。 当然，我们为客户在生产中实现了许多成功的实施，其中vSAN成功解决了设定的任务，但无法进行全面的测试。 实际上，我今天想分享测试结果。 <br><br> 我们将用负载折磨存储，将其掉落并以各种可能的方式测试容错能力。 有关详细信息，我邀请所有人来参加。 <br><a name="habracut"></a><br><h3> 一般而言，什么是VMware vSAN？为什么要加入？ </h3><br> 有一个用于虚拟机的常规服务器群集。 它具有许多独立的组件，系统管理程序直接在硬件上运行，并且基于DAS，NAS或SAN分别配置存储。  HDD上的数据变慢，SSD上的数据变热。 一切都很熟悉。 但是，这里出现了该动物园的部署和管理问题。 在来自不同供应商的系统各个元素的情况下，它变得特别有趣。 出现问题时，来自不同制造商的技术支持票对接有其特殊的气氛。 <br><br> 有单独的铁片，从服务器的角度来看，它们看起来像是用于记录的光盘。 <br><br> 还有超融合系统。 在它们中，为您提供了一个通用单元，该单元将承担网络，磁盘，处理器，内存以及在其上旋转的虚拟机之间的交互的全部麻烦。 所有数据都流入一个控制面板，如果需要，您可以简单地增加几个单元来补偿增加的负载。 管理大大简化和标准化。 <br><br><img src="https://habrastorage.org/webt/xi/4m/uw/xi4muweeppbjng1b8mrpc-bzi3m.png"><br>  VMware vSAN仅指基于其部署的解决方案 <br> 超融合基础架构。 该产品的关键功能是与虚拟化平台VMware vSphere紧密集成，该平台是虚拟化解决方案的领导者，可让您在几分钟内为虚拟机上的虚拟机部署软件存储。  vSAN直接以较低的级别控制I / O操作，以最佳方式分配负载，缓存读/写操作，并以最小的内存和处理器负载进行更多操作。 系统的透明度略有降低，但结果一切正常，正如他们所说，vSAN可以自动配置为混合存储，并采用全闪存版本的形式。 通过在群集中添加新节点来水平扩展，并在垂直方向上扩展，以增加单个节点中的磁盘数量。 由于与其他产品的紧密集成，因此使用自己的vSphere Web Client进行管理非常方便。 <br><br> 我们选择了干净的全闪存配置，这在价格和性能方面应该是最佳的。 显然，与使用磁盘的混合配置相比，总容量要低一些，但是在这里，我们决定检查如何使用擦除编码以及动态重复数据删除和压缩来部分避免这种情况。 结果，存储效率变得更接近混合解决方案，但是却以最小的开销显着提高了存储效率。 <br><br><h3> 测试方法 </h3><br> 为了测试性能，我们使用了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">HCIBench v1.6.6</a>软件，该软件可以自动创建多个虚拟机，然后编译结果。 性能测试本身是使用Vdbench软件进行的，该软件是最流行的合成负载测试软件之一。  Iron具有以下配置选项： <br><br><ol><li> 全闪存-2个磁盘组：1个NVMe SSD三星PM1725 800 GB + 3个SATA </li><li>  SSD东芝HK4E 1.6 TB。 </li><li> 全闪存-1个磁盘组：1个NVMe SSD三星PM1725 800 GB + 6个SATA SSD东芝HK4E 1.6 TB。 </li><li> 全闪存-1个磁盘组：1个NVMe SSD三星PM1725 800GB + 6个SATA SSD东芝HK4E 1.6 TB +空间效率（重复数据删除和压缩）。 </li><li> 全闪存-1个磁盘组：1个NVMe SSD三星PM1725 800GB + 6个SATA SSD东芝HK4E 1.6 TB +擦除编码（RAID 5/6）。 </li><li> 全闪存-1个磁盘组：1个NVMe SSD三星PM1725 800GB + 6个SATA SSD东芝HK4E 1.6 TB +擦除编码（RAID 5/6）+空间效率（重复数据删除和压缩）。 </li></ol><br> 在测试期间，我们模拟了应用程序使用的三种不同的活动数据量：1 TB（每台服务器250 GB），2 TB（每台服务器500 GB）和4 TB（每台1 TB）。 <br><br> 对于每种配置，使用以下负载配置文件执行了相同的测试集： <br><br><ol><li>  0读取/ 100写入，随机50％，块大小-4k。 </li><li>  30次读取/ 70次写入，随机50％，块大小-4k。 </li><li>  70次读取/ 30次写入，随机50％，块大小-4k。 </li><li>  100次读取/ 0次写入，随机50％，块大小-4k。 </li></ol><br> 需要第一个和第四个选项来了解系统在最大和最小负载下的行为。 但是第二和第三个尽可能接近实际的典型用例：例如，30读/ 70写-VDI。 我在生产中遇到的那些负载非常接近它们。 在此过程中，我们测试了vSAN数据管理机制的有效性。 <br><br> 总的来说，该系统被证明是非常好的。 根据测试结果，我们意识到我们可以依靠每个节点2万IOPS的性能。 对于普通任务和重负载任务，考虑到5 ms的延迟，这些都是很好的指标。 下面我给出了带有结果的图表： <br><br><img src="https://habrastorage.org/webt/2w/l5/q3/2wl5q38sg-f3f0t5a9smo2nz9m0.png"><br><img src="https://habrastorage.org/webt/fn/zm/bf/fnzmbff0apti4eqq8dk9o3emrym.png"><br><img src="https://habrastorage.org/webt/lc/_c/yv/lc_cyvqfd1hwe15iggyo8lxxagg.png"><br><img src="https://habrastorage.org/webt/i6/at/yu/i6atyu48yarwd5d31qgcstxx2so.png"><br><img src="https://habrastorage.org/webt/ih/y3/8o/ihy38oa_emlvkdokq9ryzt3hhum.png"><br><br> 汇总表及测试结果： <br><img src="https://habrastorage.org/webt/1v/xg/tm/1vxgtm0tpyiwqzujesrkzjcjlj8.jpeg"><br> 绿色表示已完全缓存的活动数据。 <br><br><h3> 容错能力 </h3><br> 尽管机器很恼火，但我还是一个接一个地削减了一个节点，并研究了整个系统的反应。 断开第一个节点的连接后，除了性能下降约10-15％以外，什么都没有发生。 我放出第二个节点-一些虚拟机关闭，但其余虚拟机继续工作，但性能略有下降。 总体生存能力令人满意。 重新启动所有节点-系统稍微思考一下，然后再次同步，没有任何问题，所有虚拟机都启动了，没有任何问题。 就像一次在NUC上一样。 数据的完整性也不受影响，这非常令人高兴。 <br><br><h3> 总体印象 </h3><br> 软件定义存储系统（SDS）已经是一项成熟的技术。 <br><br> 如今，阻碍实施vSAN的关键因素之一是卢布的许可费用相当高。 如果从头开始创建基础架构，可能会发现具有类似配置的传统存储系统的成本大约相同。 但是在管理和扩展方面，灵活性都将降低。 因此，今天，当选择在vSphere虚拟化平台上存储虚拟机数据的解决方案时，最好权衡使用传统解决方案和实施软件定义的存储技术的利弊。 <br><br> 您可以在相同的Ceph或GlusterFS上构建解决方案，但是在使用VMware基础架构时，vSAN与各个组件的紧密集成以及易于管理，部署和明显更高的性能（尤其是在少数节点上）尤其令人着迷。 因此，如果您已经在使用VMware基础架构，那么部署起来会容易得多。 您实际上只需单击一下即可获得可用的SDS。 <br><br> 部署vSAN的另一个动机是将其用于分支机构，这使您可以将远程单元中的节点镜像到数据中心中的见证主机。 此配置仅在两个节点上为具有所有vSAN技术和性能的虚拟机提供容错存储。 顺便说一下，要使用vSAN，有一个针对虚拟机数量的单独许可方案，与传统的处理器vSAN许可方案相比，它可以降低成本。 <br><br> 在架构上，该解决方案需要10 Gb以太网，每个节点具有两个链路，以便在使用全闪存解决方案时进行适当的流量分配。 与传统系统相比，通过消除光纤通道以支持更通用的以太网标准，可以节省机架空间并节省SAN网络。 为了确保容错能力，至少需要三个节点，将在两个具有数据的对象副本上存储该数据，在第三个节点上-用于该数据的见证对象，解决了裂脑的问题。 <br><br> 现在给您几个问题： <br><br><ol><li> 在决定存储系统时，什么标准对您最重要？ </li><li> 在实现软件定义的存储系统的过程中，您看到哪些停止因素？ </li><li> 您基本上将哪些软件定义的存储系统视为实施的选择？ </li></ol><br><br>  UPD：我完全忘记编写支架配置和载荷参数： <br><br>  1.铁的描述。 例如： <br> 服务器-4xDellR630，每个服务器： <br>  •2xE5-2680v4 <br>  •128GB RAM <br>  •2x10GbE <br>  •2x1GbE用于管理/ VM网络 <br>  •戴尔HBA330 <br> 存储配置＃1： <br>  2个PM1725 800GB <br>  6x东芝HK4E 1.6TB <br> 存储配置＃2： <br>  1个PM1725 800GB <br>  6x东芝HK4E 1.6TB <br><br>  2.软件版本说明： <br>  vSphere 6.5U1（7967591）（vSAN 6.6.1），即 崩溃/幽灵后的补丁 <br>  vCenter 6.5U1克 <br>  vSAN和ESXi支持所有组件的最新驱动程序和固件 <br> 用于vSAN和vMotion流量的LACP（启用了NIOC共享/限制/预留） <br> 所有其他设置均为默认设置 <br><br>  3.加载参数： <br>  •HCIBench 1.6.6 <br>  •Oracle Vdbench-2006年4月5日 <br>  •每个群集40VM（每个节点10个） <br>  •每个VM 10个vmdk <br>  •10 GB的vmdk大小和100/50/25％的工作负载设置百分比 <br>  •预热时间-1800秒（0.5小时），测试时间3600（1小时） <br>  •每个vmdk 1个线程 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN414125/">https://habr.com/ru/post/zh-CN414125/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN414111/index.html">PostgreSQL流复制中的调试和故障排除</a></li>
<li><a href="../zh-CN414115/index.html">什么是惰性FP状态还原：英特尔处理器中发现的新漏洞</a></li>
<li><a href="../zh-CN414119/index.html">由于火星上的沙尘暴，机会入睡了。 目前尚不清楚流动站能否再次工作</a></li>
<li><a href="../zh-CN414121/index.html">DIY独立无人机与互联网控制</a></li>
<li><a href="../zh-CN414123/index.html">我们将文本协议升级为二进制文件，并在C ++用户组会议上与旧代码作斗争</a></li>
<li><a href="../zh-CN414127/index.html">在主机上安装3CX的费用为每月2.99欧元。 在10分钟内</a></li>
<li><a href="../zh-CN414129/index.html">圣彼得堡国立大学理论计算机科学硕士</a></li>
<li><a href="../zh-CN414131/index.html">信号频率对自由空间中无线电链路能量的影响</a></li>
<li><a href="../zh-CN414133/index.html">以《阴影》为例的益智游戏设计</a></li>
<li><a href="../zh-CN414135/index.html">如何将游戏移植到PSVita可以改善整体性能</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>