<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👩🏽 🤺 🎅🏽 Zeitlose Klassiker oder eine Übersicht über neue Angriffsmethoden über Microsoft Office 👦 🎊 🧑🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hacker nutzen seit Jahrzehnten menschliche Leichtgläubigkeit und Nachlässigkeit. Die meisten Benutzer öffnen ohne zu zögern einen harmlosen E-Mail-Anh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zeitlose Klassiker oder eine Übersicht über neue Angriffsmethoden über Microsoft Office</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/433142/"><p><img src="https://habrastorage.org/webt/kw/nd/ax/kwndax-gdv9ffqc1p4xjlvt98ig.png" alt="Bild"><br>  Hacker nutzen seit Jahrzehnten menschliche Leichtgläubigkeit und Nachlässigkeit.  Die meisten Benutzer öffnen ohne zu zögern einen harmlosen E-Mail-Anhang auf den ersten Blick und starten, ohne es zu wissen, Malware.  Um sich vor solchen Angriffen zu schützen, müssen Sie den Feind persönlich kennen.  Heute werden wir versuchen herauszufinden, wie die drei neuen Techniken zur Ausführung von Code in Office-Anwendungen, die in diesem Jahr entdeckt wurden, angeordnet sind und welche Methoden zum Schutz gegen sie existieren. </p><a name="habracut"></a><br><h4 id="xlm-makrosy">  Xlm-Makros </h4><br><p> Outflank-Experten haben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine</a> neue Methode eingeführt, um Code in MS Office Excel über sogenannte XLM-Makros auszuführen (nicht zu verwechseln mit XML).  Obwohl die XLM-Makrotechnologie seit über 26 Jahren verwendet wird (erstmals in Excel 4.0 für Windows 3.0 / 3.1 verfügbar), wird sie von allen Versionen von Microsoft Office Excel bis Office 2016 weiterhin unterstützt. </p><br><p>  Um ein XLM-Makro in Excel zu erstellen, müssen Sie die folgenden Schritte ausführen: <br>  Wählen Sie im Kontextmenü der Excel-Tabelle „Einfügen“. </p><br><p><img src="https://habrastorage.org/webt/67/xk/4z/67xk4zajwn9lfivlx22sepe8mfo.png" alt="Bild"></p><br><p>  Wählen Sie als nächstes "MS Excel 4.0". </p><br><p><img src="https://habrastorage.org/webt/hn/jm/px/hnjmpxngzz89cnn55udbpqrvwvi.png" alt="Bild"></p><br><p>  Infolgedessen wird das Blatt „Macro1“ angezeigt, in dessen Zelle mit der Funktion „EXEC“ der gewünschte Prozess gestartet werden kann.  Um ein Makro automatisch auszuführen, muss die erste Zelle in "Auto_open" umbenannt werden (ähnlich der AutoOpen () -Prozedur in VBA-Makros). </p><br><p>  Nach dem Öffnen eines gespeicherten Dokuments wird eine Standardbenachrichtigung mit der Aufforderung zum Ausführen eines Makros angezeigt. </p><br><p><img src="https://habrastorage.org/webt/am/yg/v_/amygv_5ssyott6a0rovv6tmztdw.png" alt="Bild"></p><br><p>  Das Makroblatt kann durch Auswahl von „Ausblenden“ im Kontextmenü ausgeblendet werden. </p><br><p>  Zusätzlich zur Möglichkeit, Prozesse zu starten, können XLM-Makros mithilfe der Funktionen REGISTER und CALL auf die Win32-API zugreifen.  Das Folgende ist der PoC-Code für ein Makro, das eine Shellcode-Injektionstechnik implementiert. </p><br><p><img src="https://habrastorage.org/webt/xf/2i/zw/xf2izwfzcskz31cimua40hxayb4.png" alt="Bild"></p><br><p>  Gleichzeitig wird die CHAR-Codierungsfunktion verwendet, um die Zeichen des Shell-Codes in der Makrozelle zu speichern.  Um Null-Bytes zu entfernen, können Sie das Dienstprogramm msfvenom verwenden, das Teil des Metasploit Framework ist. </p><br><p>  Durch die Speichermethode in einer Excel-Datei unterscheiden sich XLM-Makros erheblich von den klassischen VBA-Makros, die ein Jahr später in Excel 5.0 angezeigt wurden.  Im neuen Excel-XLSM-Format, bei dem es sich um ein ZIP-Archiv handelt, werden XLM-Makros in einer XML-Datei im Makrosheets-Verzeichnis gespeichert.  Im XLSL-Format (Excel 97-2003) wird das Makro in einem OLE-Stream gespeichert. </p><br><p>  Ferner ist zu sehen, dass das VBA-Makro in einem separaten Container (in der Abbildung links) gespeichert ist, während sich die XLM-Makros im selben Datencontainer befinden. </p><br><p><img src="https://habrastorage.org/webt/vk/b4/ah/vkb4ahksxymoxkgyrtfcjo0igci.png" alt="Bild"></p><br><p>  Diese Unterschiede bei den Methoden zum Speichern von Makros wirken sich erheblich auf die Qualität ihrer Erkennung durch Virenschutzprogramme aus. Insbesondere die AMSI-Technologie (Antimalware Scanning Interface) unterstützt XLM trotz der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">behaupteten</a> Unterstützung durch Office 365 nicht. </p><br><p>  Beispielsweise wurde der Metasploit Powershell-Code web_delivery in Excel mithilfe von VBA- und XLM-Makros implementiert (in den folgenden Abbildungen). </p><br><p><img src="https://habrastorage.org/webt/mp/pg/30/mppg30vb0ssgy9znbnmomcayq9e.png" alt="Bild"></p><br><p><img src="https://habrastorage.org/webt/2j/n3/z4/2jn3z4x3budl5irzemobw6li3vm.png" alt="Bild"></p><br><p>  In Virustotal löste ein Excel-Dokument mit einem VBA-Makro 21 von 59 Antivirenprogrammen aus. </p><br><p><img src="https://habrastorage.org/webt/xk/7x/tn/xk7xtnip5rsocfra6wmqk3ydobu.png" alt="Bild"></p><br><p>  Gleichzeitig erregte ein ähnliches Dokument mit einem XLM-Makro keinen Verdacht auf Virenschutz. </p><br><p><img src="https://habrastorage.org/webt/6w/5z/pn/6w5zpnmshm7pmwhuxgon_ootlcg.png" alt="Bild"></p><br><p>  <strong>Demonstration</strong> <br>  Codeausführung über XLM-Makros in Office </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/G-2uir9TeFQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4 id="microsoft-office-online-video">  Microsoft Office Online-Video </h4><br><p>  Das Cumulate-Forschungsteam hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine</a> neue Möglichkeit gefunden, Code in Word auszuführen, indem Videos mithilfe von Online-Videos eingefügt werden.  Mit diesem Element können Sie dem Dokument YouTube-Videos hinzufügen und den Link dazu durch JavaScript-Code ersetzen, der in Internet Explorer ausgeführt wird, wenn Sie das Dokument öffnen und auf das Video klicken.  Die folgenden Vektoren eignen sich am besten für Social Engineering: </p><br><ul><li>  Hinzufügen eines Exploit-Codes für IE / Flash in einem Iframe mit einem YouTube-Video. </li><li>  Hinzufügen von JavaScript-Code im Iframe mit dem YouTube-Video mithilfe der msSaveOrOpenBlob-Methode, über die empfohlen wird, die schädliche Datei herunterzuladen und auszuführen.  Der Hauptteil der Datei ist in Base64-Javascript enthalten. </li></ul><br><p>  So erstellen Sie eine Datei mit der Erweiterung docx  Bei der beschriebenen Belastung müssen Sie folgende Schritte ausführen: </p><br><p>  1. Fügen Sie ein YouTube-Video über „Einfügen - Online-Video“ hinzu. </p><br><p><img src="https://habrastorage.org/webt/ty/kg/ea/tykgeapsiwbx7kq1gp7egsv3zma.png" alt="Bild"></p><br><p>  2. Speichern Sie die erstellte docx-Datei. </p><br><p>  3. Entpacken Sie das gespeicherte Dokument.  Docx-Format  ist ein Zip-Archiv mit folgenden Inhalten: <br><img src="https://habrastorage.org/webt/wm/pp/fb/wmppfb5hpuuv7g-tvhtqjbom7ye.png" alt="Bild"></p><br><p>  4. Fügen Sie im Word-Verzeichnis in der Datei document.xml im Element embeddedHtml Ihren JavaScript-Code hinzu, indem Sie ihn in den iframe-Text einfügen oder den entsprechenden Link (src) im iframe ersetzen. </p><br><p>  5. Erstellen Sie ein Zip-Archiv (mit der Erweiterung docx) mit den vorgenommenen Änderungen. </p><br><p>  Außerdem muss der Benutzer beim Öffnen der generierten docx-Datei auf den Videolink klicken und die heruntergeladene Datei starten.  Alternativ können Sie einen Screenshot mit einem Vorschlag zum Aktualisieren von Flash Player anzeigen und den Benutzer auffordern, die Datei herunterzuladen und auszuführen.  Es werden keine Sicherheitswarnungen angezeigt. </p><br><p><img src="https://habrastorage.org/webt/hx/0z/fx/hx0zfxdxfl5dhfkckbt_g2mo50s.png" alt="Bild"></p><br><p>  Wie bei XLM-Makros wird diese Technik der Codeausführung von keinem Virenschutzprogramm auf Virustotal erkannt und sieht für Virenschreiber sehr attraktiv aus. Sie ist auch im Rahmen von Penetrationstests im Social Engineering üblich. </p><br><p>  <strong>Demonstration</strong> <br>  Codeausführung über Online-Video in Office </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/E4lqdRNyA9Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4 id="vba-stomping">  Vba stampft </h4><br><p>  Auf der Derbycon 2018-Konferenz wurde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine</a> Technik zum Starten von VBA-Makros in Office-Dokumenten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorgestellt</a> , die als VBA-Stomping bezeichnet wird.  Die Essenz der Technik besteht darin, den VBA-Quellcode im Hauptteil des Office-Dokuments zu löschen / zu ändern (als Alternative zum Füllen mit Nullen), wobei der kompilierte Makrocode namens p-Code unberührt bleibt.  Der VBA-Code sowie seine kompilierte Version befinden sich in der Datei vbaProject.bin im Zip-Archiv (Datei mit der Erweiterung .docm, .xslm). </p><br><p><img src="https://habrastorage.org/webt/2h/o0/62/2ho062u42yrxr81jebhqf1zegyu.png" alt="Bild"></p><br><p>  Daher läuft die Technik darauf hinaus, einen Teil der Datei vbaProject.bin zu löschen / mit Nullen zu füllen. </p><br><p><img src="https://habrastorage.org/webt/me/jq/iq/mejqiqu1zpf6w2nethawrkz7ao4.png" alt="Bild"></p><br><p>  Infolgedessen verursacht das Dokument keinen Verdacht bei Antivirenprogrammen, die ein Makro nur anhand seines Quellcodes analysieren.  Mithilfe dieser Technik konnten die Forscher beispielsweise die Anzahl der Antiviren-Antworten auf den Emotet-Banking-Trojaner, der über Office-Dateien verteilt wird, auf Virustotal von 36/59 auf 7/58 reduzieren. </p><br><p><img src="https://habrastorage.org/webt/wo/bi/2c/wobi2cimjqfwlp_mxurz8v8ruoa.png" alt="Bild"></p><br><p><img src="https://habrastorage.org/webt/d8/bk/ni/d8bknikd5av_ae0e1yk1szf0bqm.png" alt="Bild"></p><br><p>  Diese Technik macht es auch schwierig, die Datei zu analysieren, da kein einziges Tool ohne Rückgriff auf die Dekompilierung den VBA-Quellcode extrahieren kann, der auch erst im Office-Makro-Editor angezeigt wird, wenn er aufgelöst ist. </p><br><h4 id="zaschita">  Schutz </h4><br><p>  Empfehlungen zum Gegensteuern der beschriebenen Techniken sind traditionell zum Schutz vor Social-Engineering-Methoden: </p><br><ol><li>  Sensibilisierung der Mitarbeiter für Fragen der Informationssicherheit. </li><li>  Verbieten Sie die Verwendung von Makros in Microsoft Office. </li><li>  Ein integrierter Ansatz zur Gewährleistung der Informationssicherheit, einschließlich der Verwendung von Endpoint-Lösungen sowie von Perimeter-Sicherheitstools (Firewalls der nächsten Generation, UTM-Lösungen, Mail-Gateways). </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de433142/">https://habr.com/ru/post/de433142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de433130/index.html">Möge Gewalt mit uns sein: unsere eigene Immunität gegen Krebs</a></li>
<li><a href="../de433132/index.html">"Testerkalender" für Dezember. Versuchen Sie einen anderen Ansatz</a></li>
<li><a href="../de433136/index.html">System.Transactions-Infrastruktur in der .NET-Welt</a></li>
<li><a href="../de433138/index.html">Fünf Prinzipien des Produktdesigns bei Booking</a></li>
<li><a href="../de433140/index.html">Bereites Google Pay Client-Modul</a></li>
<li><a href="../de433144/index.html">.NET Core 2.2 veröffentlicht. Was gibt's Neues? (1 von 3)</a></li>
<li><a href="../de433146/index.html">[Wettbewerb] Top 25 Spielekonsolen (alte Zeiten erschüttern)</a></li>
<li><a href="../de433152/index.html">Wir übertragen Zimbra von einer Einzelserver- auf eine Multiserverinfrastruktur</a></li>
<li><a href="../de433154/index.html">5G NR Benutzererfahrung in der realen Welt erwartet</a></li>
<li><a href="../de433156/index.html">Dell geht an die Börse und strebt die Hybrid Cloud an</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>