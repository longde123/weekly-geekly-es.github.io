<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤴🏿 🛌🏻 💷 Evaluación de Cavium ThunderX2: El sueño del servidor Arm se hace realidad (Parte 2) 🤳🏾 🥁 👩🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La primera parte, "Evaluación de Cavium ThunderX2: El sueño de un servidor Arm hecho realidad" está aquí 

 Configuración de prueba y metodología 
 Pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Evaluación de Cavium ThunderX2: El sueño del servidor Arm se hace realidad (Parte 2)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/413973/">  La primera parte, "Evaluación de Cavium ThunderX2: El sueño de un servidor Arm hecho realidad" está <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> <br><br><h2>  Configuración de prueba y metodología </h2><br>  Para la revisión de ThunderX2, todas nuestras pruebas se llevaron a cabo en Ubuntu Server 17.10, Linux 4.13 kernel de 64 bits.  Usualmente usamos la versión LTS, pero como Cavium viene con esta versión particular de Ubuntu, no nos arriesgamos a cambiar el sistema operativo.  La distribución de Ubuntu incluye el compilador GCC 7.2. <br><br><img src="https://habrastorage.org/webt/x6/z7/5j/x6z75jaf9myymohvcozvis4hahg.jpeg"><br><a name="habracut"></a><br>  Notará que la cantidad de DRAM varía en las configuraciones de nuestro servidor.  La razón es simple: Intel tiene 6 canales de memoria y el ThunderX2 de Cavium tiene 8 canales de memoria. <br><br><img src="https://habrastorage.org/webt/y6/bk/-o/y6bk-o84sznxye2h5qmthabjgzs.png"><br><br><img src="https://habrastorage.org/webt/ur/ke/am/urkeam0eb6bdadnpga9w8gj9zek.png"><br><br>  La configuración típica del BIOS se puede ver a continuación.  Vale la pena señalar que se incluyen hyperthreading y la tecnología de virtualización Intel. <br><br>  <b>Otras notas</b> <br><br>  Ambos servidores funcionan de acuerdo con el estándar europeo: 230 V (máximo 16 amperios).  La temperatura del aire interior es controlada y mantenida a 23 ° C por nuestros instrumentos Airwell CRAC. <br><br><h3>  Consumo de energia </h3><br>  Vale la pena mencionar que el sistema Gigabyte "Sabre" consumía 500 vatios si solo estaba ejecutando Linux (es decir, estaba inactivo).  Sin embargo, bajo carga, el sistema consume aproximadamente 800 W, lo que en principio cumplió con nuestras expectativas, ya que tenemos dos chips TDP de 180 W en el interior.  Como suele ser el caso con los primeros sistemas de prueba, no podemos hacer comparaciones de potencia precisas. <br><br>  De hecho, Cavium afirma que los sistemas actuales de HP, Gigabyte y otros serán mucho más eficientes.  El sistema de prueba Sabre que se utilizó tenía varios problemas con la administración de energía: control incorrecto del firmware del ventilador, error de BMC y unidad de fuente de alimentación con demasiada potencia (1600 W). <br><br><h2>  Subsistema de memoria: ancho de banda </h2><br>  El uso del benchmark de ancho de banda Stream de John McCalpin en los últimos procesadores se está volviendo cada vez más difícil de medir todo el potencial del ancho de banda del sistema a medida que crece el número de canales centrales y de memoria.  Como puede ver en los resultados a continuación, estimar el rendimiento no es fácil.  El resultado depende en gran medida de la configuración seleccionada. <br><br><img src="https://habrastorage.org/webt/c9/os/6j/c9os6j-7kv1qveahmtwwphvn_qm.png"><br><br>  Teóricamente, ThunderX2 tiene un 33% más de ancho de banda que Intel Xeon, ya que el SoC tiene 8 canales de memoria en comparación con seis canales de Intel.  Estos números de alto rendimiento solo se logran en condiciones muy específicas y requieren algunos ajustes para evitar el uso de memoria remota.  En particular, debemos asegurarnos de que los flujos no se transporten de un zócalo a otro. <br><br>  Para empezar, tratamos de lograr los mejores resultados en ambas arquitecturas.  En el caso de Intel, el compilador ICC siempre ha arrojado mejores resultados con algunas optimizaciones de bajo nivel dentro de los bucles de transmisión.  En el caso del Cavium, seguimos las instrucciones del Cavium.  En términos generales, la imagen resultante es una idea del ancho de banda que estos procesadores pueden alcanzar en sus picos.  Para ser honesto con Intel, con la configuración ideal (AVX-512) puede alcanzar 200 GB / s. <br><br>  Sin embargo, es obvio que el sistema ThunderX2 puede proporcionar de 15 a 28% más de ancho de banda a sus núcleos de procesador.  El resultado es 235 GB / s, o aproximadamente 120 GB / s por ranura.  Esto, a su vez, es aproximadamente 3 veces más grande que el ThunderX original. <br><br><h3>  Subsistema de memoria: retraso </h3><br>  Aunque las mediciones de ancho de banda se aplican solo a una pequeña parte del mercado de servidores, casi todas las aplicaciones dependen en gran medida de la latencia del subsistema de memoria.  En los intentos de medir la latencia de caché y memoria, utilizamos LMBench.  Los datos que queremos ver como resultado son "Retraso en carga aleatoria, paso = 16 bytes".  Tenga en cuenta que expresamos la latencia L3 y el retraso del tiempo DRAM en nanosegundos, ya que no tenemos valores exactos de reloj de caché L3. <br><br><img src="https://habrastorage.org/webt/br/qi/ei/brqieilk38mydtce6aox_5amcgu.png"><br><br>  Se accede a la caché ThunderX2 L2 con una latencia muy baja, y cuando se usa una sola transmisión, la caché L3 se parece a un competidor de la caché L3 integrada de Intel.  Sin embargo, cuando llegamos a DRAM, Intel mostró una latencia significativamente menor. <br><br><h3>  Subsistema de memoria: TinyMemBench </h3><br>  Para obtener una comprensión más profunda de las arquitecturas respectivas, se utilizó la prueba de código abierto TinyMemBench.  El código fuente se compiló con GCC 7.2 y el nivel de optimización se estableció en -O3.  La estrategia de prueba está bien descrita en el manual de referencia: <br><br><blockquote>  El tiempo promedio se mide para accesos aleatorios de memoria en buffers de varios tamaños.  Cuanto más grande es el búfer, mayor es la contribución relativa de los errores de caché TLB, L1 / L2 y accesos DRAM.  Todos los números representan el tiempo extra que debe agregarse a la latencia del caché L1 (4 ciclos). </blockquote><br><br>  Probamos con una y dos lecturas aleatorias (sin grandes páginas), porque queríamos ver cómo el sistema de memoria manejaba varias solicitudes de lectura. <br><br><img src="https://habrastorage.org/webt/yx/3g/2w/yx3g2w3ls_hsixhz7gfit43n8xk.png"><br><br>  Uno de los principales inconvenientes del ThunderX original fue la incapacidad de soportar múltiples errores pendientes.  La concurrencia de nivel de memoria es una característica importante para cualquier núcleo de procesador moderno de alto rendimiento: con su ayuda, evita errores de caché que pueden causar "hambre" de back-end.  Por lo tanto, un caché sin bloqueo es una característica clave para núcleos grandes. <br><br>  ThunderX2 no sufre este problema en absoluto, gracias a su caché sin bloqueo.  Al igual que el núcleo de Skylake en Xeon 8176, la segunda lectura aumenta la latencia total solo en un 15-30%, no en un 100%.  Según TinyMemBench, el núcleo de Skylake tiene una latencia significativamente mejor.  El punto de referencia de 512 KB es fácil de explicar: el núcleo Skylake todavía se está recuperando de su rápido L2, y el núcleo ThunderX2 debe acceder a L3.  Pero los números de 1 y 2 MB muestran que los prefetchers de Intel ofrecen una gran ventaja, ya que la latencia es el promedio de caché L2 y L3.  Las tasas de latencia son similares en el rango de 8 a 16 MB, pero tan pronto como vamos más allá de L3 (64 MB), Intel's Skylake ofrece memoria de menor latencia. <br><br><h2>  Rendimiento de un solo subproceso: SPEC CPU2006 </h2><br>  Comenzando a medir el rendimiento informático real, comenzamos con el paquete SPEC CPU2006.  Los lectores expertos señalarán que SPEC CPU2006 quedó en desuso cuando apareció SPEC CPU2017.  Pero debido al tiempo de prueba limitado y al hecho de que no pudimos volver a probar ThunderX, decidimos seguir con CPU2006. <br><br>  Dado que SPEC es casi tan buen punto de referencia del compilador como el hardware, creemos que será apropiado formular nuestra filosofía de prueba.  Debe evaluar los indicadores reales y no inflar los resultados de la prueba.  Por lo tanto, es importante crear, en la medida de lo posible, condiciones "como en el mundo real" con las siguientes configuraciones (las críticas constructivas sobre este tema son bienvenidas): <br><br><ul><li>  Gcc de 64 bits: el compilador más utilizado en Linux, un buen compilador que no intenta "interrumpir" las pruebas (libquantum ...) </li><li>  -Ofast: optimización del compilador que muchos desarrolladores pueden usar </li><li>  -fno-estricto-alias: requerido para compilar algunas subpruebas </li><li>  ejecución base: cada subprueba se compila de la misma manera </li></ul><br>  Primero, debe medir el rendimiento en aplicaciones en las que, por alguna razón, se produce un retraso debido a un "entorno hostil multiproceso".  En segundo lugar, debe comprender qué tan bien funciona la arquitectura ThunderX LLC con un solo subproceso en comparación con la arquitectura Skylake de Intel.  Tenga en cuenta que en ese modelo Skylake en particular, puede overclockear la frecuencia a 3.8 GHz.  El chip funcionará a una frecuencia de 2.8 GHz en casi todas las situaciones (28 subprocesos están activos) y admitirá 3.4 GHz con 14 subprocesos activos. <br><br>  En general, Cavium posiciona al ThunderX2 CN9980 ($ 1795) como "mejor que 6148" ($ 3072), un procesador que funciona a 2.6 GHz (20 hilos) y alcanza 3.3 GHz sin ningún problema (hasta 16 hilos activos )  Por otro lado, Intel-SKU tendrá una ventaja significativa del 30 por ciento en la velocidad del reloj en muchas situaciones (3.3 GHz versus 2.5 GHz). <br><br>  Cavium decidió compensar el déficit de frecuencia por el número de núcleos, ofreciendo 32 núcleos, que es un 60% más que el Xeon 6148 (20 núcleos).  Vale la pena señalar que una mayor cantidad de núcleos conducirá a una disminución en el rendimiento en muchas aplicaciones (por ejemplo, Amdahl).  Por lo tanto, si Cavium quiere sacudir la posición dominante de Intel con ThunderX2, cada núcleo debería ofrecer al menos un rendimiento competitivo en el mundo real.  O en este caso, ThunderX2 debería proporcionar al menos un 66% (2.5 frente a 3.8) de rendimiento de Skylake de subproceso único. <br><br><img src="https://habrastorage.org/webt/nf/q9/bo/nfq9boumsku_k_xxjphasfqzcvk.png"><br><br>  Los resultados son borrosos porque ThunderX2 funciona con el código ARMv8 (AArch64) y Xeon usa el código x86-64. <br><br>  Pruebas de seguimiento de punteros: el procesamiento XML (también grandes buffers OoO) y la búsqueda de rutas que generalmente dependen de una gran caché L3 para reducir el impacto de la latencia de acceso son los peores para ThunderX2.  Se puede suponer que una mayor latencia del sistema DRAM degrada el rendimiento. <br><br>  Las cargas de trabajo en las que la influencia de la predicción de bifurcación es mayor (al menos en x86-64: un mayor porcentaje de elección de la bifurcación incorrecta) - gobmk, sjeng, hmmer - no son las mejores cargas en ThunderX2. <br><br>  También vale la pena señalar que se sabe que las instrucciones perlbench, gobmk, hmmer y h264ref se benefician del caché L2 más grande de Skylake (512 KB).  Le mostramos algunas piezas del rompecabezas, pero juntas pueden ayudar a armar la imagen. <br><br>  En el lado positivo, ThunderX2 funcionó bien para gcc, que funciona principalmente dentro del caché L1 y L2 (por lo tanto, depende de una baja latencia L2), y el impacto del rendimiento del predictor de ramificación es mínimo.  En general, la mejor prueba para TunderX2 es mcf (distribución de vehículos en transporte público), que, como usted sabe, omite casi por completo el caché de datos L1, confiando en el caché L2, y este es el punto fuerte de ThunderX2.  Mcf también exige ancho de banda de memoria.  Libquantum es una prueba que tiene la mayor necesidad de ancho de banda de memoria.  El hecho de que Skylake ofrezca un ancho de banda bastante simple mediocre es probablemente también la razón por la que ThunderX2 funcionó tan bien en libquantum y mcf. <br><br><h2>  SPEC CPU2006 Cont: rendimiento basado en el núcleo con SMT </h2><br>  Más allá del rendimiento de un solo subproceso, también debe considerarse el rendimiento de varios subprocesos dentro de un solo núcleo.  La arquitectura del procesador Vulcan fue diseñada originalmente para usar SMT4 para mantener sus núcleos cargados y aumentar el rendimiento general, y hablaremos de eso ahora. <br><br><img src="https://habrastorage.org/webt/ap/ts/yn/aptsyn5moaghkebzplkrendccls.png"><br><br>  En primer lugar, el núcleo ThunderX2 ha "experimentado" muchas mejoras significativas sobre el primer núcleo ThunderX.  Incluso con libquantum en mente, esta prueba puede ejecutarse fácilmente 3 veces más rápido en el núcleo ThunderX anterior después de algunas mejoras y optimizaciones para el compilador.  Bueno, el nuevo ThunderX2 es no menos de 3,7 veces más rápido que su hermano mayor.  Esta superioridad de IPC elimina cualquier ventaja del ThunderX anterior. <br><br>  Al observar el impacto de SMT, en promedio vemos que SMT de 4 vías mejora el rendimiento de ThunderX2 en un 32%.  Esto varía de 8% para codificación de video a 74% para Pathfinding.  Mientras tanto, Intel está ganando un 18% de su SMT de 2 vías, del 4% al 37% en los mismos escenarios. <br><br>  En general, el aumento de rendimiento de ThunderX2 es del 32%, lo cual es bastante bueno.  Pero aquí surge la pregunta obvia: ¿en qué se diferencia de otras arquitecturas SMT4?  Por ejemplo, IBM POWER8, que también admite SMT4, muestra un aumento del 76% en el mismo escenario. <br><br>  Sin embargo, esto no es una comparación de lo similar con lo similar, ya que el chip de IBM tiene un back-end mucho más amplio: puede procesar 10 instrucciones, mientras que el núcleo ThunderX2 está limitado a 6 instrucciones por ciclo.  El núcleo POWER8 es más glotón: el procesador podría acomodar solo 10 de estos núcleos "ultraanchos" en un presupuesto de potencia de 190 W a un proceso de 22 nm.  Lo más probable es que un aumento adicional en el rendimiento del uso de SMT4 requerirá núcleos aún más grandes y, a su vez, afectará seriamente la cantidad de núcleos disponibles dentro de ThunderX2.  Sin embargo, es interesante observar este aumento del 32% en el futuro. <br><br>  En la siguiente (3) parte: <br><br><ul><li>  Rendimiento de Java </li><li>  Rendimiento de Java: páginas enormes </li><li>  Apache Spark 2.x Benchmarking </li><li>  Resumen </li></ul><br>  Gracias por quedarte con nosotros.  ¿Te gustan nuestros artículos?  ¿Quieres ver más materiales interesantes?  <b>Apóyenos</b> haciendo un pedido o recomendándolo a sus amigos, un <b>descuento del 30% para los usuarios de Habr en un análogo único de servidores de nivel de entrada que inventamos para usted:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">toda la verdad sobre VPS (KVM) E5-2650 v4 (6 núcleos) 10GB DDR4 240GB SSD 1Gbps de $ 20 o cómo dividir el servidor?</a>  (las opciones están disponibles con RAID1 y RAID10, hasta 24 núcleos y hasta 40GB DDR4). <br><br>  <b>Dell R730xd 2 veces más barato?</b>  ¡Solo tenemos <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 TV desde $ 249</a> en los Países Bajos y los Estados Unidos!</b>  Lea sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cómo construir un edificio de infraestructura.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">clase utilizando servidores Dell R730xd E5-2650 v4 que cuestan 9,000 euros por un centavo?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413973/">https://habr.com/ru/post/es413973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413963/index.html">Mini CRM para pequeñas empresas</a></li>
<li><a href="../es413965/index.html">Revisión de código: lo estás haciendo mal</a></li>
<li><a href="../es413967/index.html">Animal Crossing Developer Mode Ingeniería inversa</a></li>
<li><a href="../es413969/index.html">Technopark Russky: desarrollo innovador de miles de millones de presupuesto</a></li>
<li><a href="../es413971/index.html">Más de 10 medios de comunicación en inglés para estudiantes de idiomas</a></li>
<li><a href="../es413977/index.html">Creación de un sistema de protección antivirus ampliado para una pequeña empresa. Parte 3</a></li>
<li><a href="../es413979/index.html">Mitap "¿Cómo administrar gremios y comunidades?" de Tutu.ru y AgileVerse</a></li>
<li><a href="../es413981/index.html">Semana de la seguridad 21: cientos de vulnerabilidades de Adobe Flash</a></li>
<li><a href="../es413983/index.html">Evaluación de Cavium ThunderX2: El sueño del servidor Arm se hace realidad (Parte 3)</a></li>
<li><a href="../es413987/index.html">Hogwarts rojos. Serie 7. Estudiantes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>