<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öôÔ∏è ‚úåüèΩ üîù Enterprise DevOps: como uma grande empresa coleta microsservi√ßos üé≤ üèÜ üìØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! 


 A Netracker desenvolve e fornece aplicativos corporativos para o mercado global de operadoras de telecomunica√ß√µes h√° muitos anos. O d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Enterprise DevOps: como uma grande empresa coleta microsservi√ßos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/netcracker/blog/421423/"><p>  Ol√° pessoal! </p><br><p>  A Netracker desenvolve e fornece aplicativos corporativos para o mercado global de operadoras de telecomunica√ß√µes h√° muitos anos.  O desenvolvimento de tais solu√ß√µes √© bastante complicado: centenas de pessoas participam de projetos e o n√∫mero de projetos ativos nas dezenas. </p><br><p>  Anteriormente, os produtos eram monol√≠ticos, mas agora estamos avan√ßando com confian√ßa para aplicativos de microsservi√ßo.  O DevOps enfrentou uma tarefa bastante ambiciosa - fornecer esse salto tecnol√≥gico. </p><br><p>  Como resultado, obtivemos um conceito de montagem bem-sucedido, que queremos compartilhar como uma pr√°tica recomendada.  A descri√ß√£o da implementa√ß√£o com detalhes t√©cnicos ser√° bastante volumosa; n√£o faremos isso dentro da estrutura deste artigo. </p><a name="habracut"></a><br><p>  <i>No caso geral, montagem √© a transforma√ß√£o de alguns artefatos em outros.</i> <i><br></i> </p><br><h2>  Quem estar√° interessado </h2><br><p>  As empresas que fornecem software pronto para uma organiza√ß√£o completamente terceirizada e s√£o pagas por isso. </p><br><p>  Veja como o desenvolvimento pode parecer sem entrega externa: </p><br><ul><li>  O departamento de TI da f√°brica desenvolve software para sua empresa. </li><li> A empresa est√° envolvida na terceiriza√ß√£o para um cliente estrangeiro.  O cliente compila e opera esse c√≥digo independentemente em seu pr√≥prio servidor web. </li><li>  A empresa fornece software para clientes externos, mas sob uma licen√ßa de c√≥digo aberto.  A maior parte da responsabilidade √© assim aliviada. </li></ul><br><p>  Se voc√™ n√£o se deparar com suprimentos externos, grande parte do que est√° escrito abaixo parecer√° redundante ou at√© paran√≥ico. </p><br><p>  Na pr√°tica, tudo deve ser feito em conformidade com os requisitos internacionais para as licen√ßas e criptografia usadas, caso contr√°rio, pelo menos, conseq√º√™ncias legais surgir√£o. </p><br><p>  Um exemplo de viola√ß√£o √© pegar o c√≥digo de uma biblioteca com uma licen√ßa GPL3 e incorpor√°-lo em um aplicativo comercial. </p><br><h2>  O surgimento de microsservi√ßos requer mudan√ßas </h2><br><p>  Adquirimos uma vasta experi√™ncia na montagem e entrega de aplica√ß√µes monol√≠ticas. </p><br><p>  V√°rios servidores Jenkins, milhares de trabalhos de CI, v√°rias linhas de montagem totalmente automatizadas baseadas no Jenkins, dezenas de engenheiros de vers√£o dedicados, seu pr√≥prio grupo de especialistas em gerenciamento de configura√ß√µes. </p><br><p>  Historicamente, a abordagem da empresa era a seguinte: os desenvolvedores escrevem o c√≥digo-fonte e o DevOps inventa e escreve a configura√ß√£o do sistema de montagem. </p><br><p>  Como resultado, tivemos duas ou tr√™s configura√ß√µes t√≠picas de montagem projetadas para opera√ß√£o no ecossistema corporativo.  Esquematicamente, fica assim: </p><br><img src="https://habrastorage.org/webt/pr/hi/rm/prhirmtpwufl-vfhheebwfaujpg.png"><br><p>  A ferramenta de compila√ß√£o geralmente √© ant ou maven, e algo √© implementado por plug-ins publicamente dispon√≠veis, algo √© escrito por si s√≥.  Isso funciona bem quando uma empresa usa um conjunto restrito de tecnologias. </p><br><p>  <i>Os microsservi√ßos diferem das aplica√ß√µes monol√≠ticas principalmente na variedade de tecnologias.</i> </p><br><p>  Acontece muitas configura√ß√µes de montagem para pelo menos cada linguagem de programa√ß√£o.  O controle centralizado se torna imposs√≠vel. </p><br><p>  √â necess√°rio simplificar o m√°ximo poss√≠vel os scripts de montagem e permitir que os desenvolvedores os editem independentemente. </p><br><p>  Al√©m da compila√ß√£o e empacotamento simples (no diagrama em <font color="green">verde</font> ), esses scripts cont√™m muito c√≥digo para integra√ß√£o com o ecossistema corporativo (no diagrama em <font color="red">vermelho</font> ). </p><br><p>  Portanto, decidiu-se perceber a montagem como uma "caixa preta", na qual um ambiente de montagem "inteligente" pode resolver todos os problemas, exceto a compila√ß√£o e a pr√≥pria embalagem. </p><br><p>  No in√≠cio do trabalho, n√£o estava claro como obter esse sistema.  Tomar decis√µes de arquitetura para tarefas do DevOps requer experi√™ncia e conhecimento.  Como obt√™-los?  As op√ß√µes poss√≠veis est√£o abaixo: </p><br><ul><li>  Pesquise informa√ß√µes na Internet. </li><li>  Experi√™ncia e conhecimento pr√≥prios da equipe de DevOps.  Para fazer isso, √© bom fazer dessa equipe de programadores uma experi√™ncia vers√°til. </li><li>  Experi√™ncia e conhecimento adquiridos fora da equipe do DevOps.  Muitos desenvolvedores da empresa t√™m boas id√©ias - voc√™ precisa ouvi-las.  A comunica√ß√£o √© √∫til. </li><li>  N√≥s inventamos e experimentamos! </li></ul><br><h2>  Preciso de automa√ß√£o? </h2><br><p>  Para responder a essa pergunta, voc√™ precisa entender em que est√°gio da evolu√ß√£o nossas abordagens de montagem s√£o.  Em geral, uma tarefa passa pelos seguintes n√≠veis. </p><br><ol><li>  N√≠vel inconsciente <br><br><img width="150" src="https://habrastorage.org/webt/an/e2/uv/ane2uvhcdznwqj-bncv49oo58p8.jpeg"><br><br><p>  Precisamos liberar uma montagem por semana, nosso pessoal est√° indo bem.  Isso √© natural, por que falar sobre isso? </p></li><li>  O n√≠vel de "artes√£o", eventualmente se transformando no n√≠vel de "trapaceiro" <br><br><img width="150" src="https://habrastorage.org/webt/ck/mc/-a/ckmc-a4-76nvtsanjjwf4ilsf-i.gif"><br><br><p>  √â necess√°rio produzir duas montagens por dia de forma est√°vel e sem erros.  Temos Vasya, ele √© legal, e ningu√©m al√©m dele passa esse tempo. </p></li><li>  N√≠vel de Fabrica√ß√£o <br><br><img width="150" src="https://habrastorage.org/webt/hw/_x/57/hw_x572z1bstsfv4gcp9ntekdho.jpeg"><br><br><p>  As coisas foram longe.  Voc√™ precisa de 20 assembl√©ias por dia, Vasya n√£o aguenta e agora uma equipe de dez pessoas j√° est√° sentada.  Eles t√™m um chefe, planos, f√©rias, licen√ßa m√©dica, motiva√ß√£o, forma√ß√£o de equipes, treinamentos, tradi√ß√µes e regras.  Esta √© uma especializa√ß√£o, seu trabalho deve ser estudado. <br></p><br><p>  Nesse n√≠vel, a tarefa √© separada do executor concreto e, assim, se transforma em um processo. </p><br><p>  O resultado ser√° uma descri√ß√£o clara, elaborada, executada e corrigida centenas de vezes do processo com texto. </p></li><li>  O n√≠vel de "produ√ß√£o automatizada" <br><br><img width="150" src="https://habrastorage.org/webt/mw/2c/pt/mw2cptkfee3fmatsj6aw-21eka4.jpeg"><br><br><p>  Os requisitos modernos para montagens est√£o crescendo: tudo deve ser r√°pido, confi√°vel, 800 montagens devem ser fornecidas por dia.  Isso √© cr√≠tico, porque sem esses volumes a empresa perder√° vantagens competitivas. </p><br><p>  A automa√ß√£o cara est√° ocorrendo e alguns DevOps qualificados podem manter o processo em execu√ß√£o.  Escalas adicionais n√£o s√£o mais um problema. </p></li></ol><br><p>  <i>Nem todas as tarefas devem atingir o √∫ltimo est√°gio de automa√ß√£o.</i> </p><br><p>  Muitas vezes, um artes√£o com uma linha de comando resolve problemas de maneira f√°cil e eficaz. </p><br><p>  A automa√ß√£o ‚Äúcongela‚Äù o processo, reduz o custo da opera√ß√£o e aumenta o custo da mudan√ßa. </p><br><p>  Voc√™ pode ir imediatamente √† montagem do carro, mas o sistema ser√° inconveniente, n√£o acompanhar√° os requisitos da empresa e, como resultado, ficar√° obsoleto. </p><br><h2>  O que s√£o as montagens e por que o problema n√£o √© resolvido pelos sistemas de montagem prontos <br></h2><br><img src="https://habrastorage.org/webt/0s/s1/dk/0ss1dkrnmpubpcllntnzuuwofw0.png"><br><p>  Usamos a seguinte classifica√ß√£o para determinar os n√≠veis de agrega√ß√£o de montagem. <br><br></p><ul><li><p>  L1  Uma pequena parte independente de um aplicativo grande.  Pode ser um componente, microsservi√ßo ou uma biblioteca auxiliar.  A montagem L1 √© uma solu√ß√£o para problemas t√©cnicos lineares: compila√ß√£o, empacotamento, trabalho com depend√™ncias.  Maven, gradle, npm, grunt e outros sistemas de compila√ß√£o fazem um √≥timo trabalho nisso.  Existem centenas deles. </p><p>  <i>A montagem L1 deve ser feita usando ferramentas de terceiros prontas.</i> </p></li><li><p>  L2 +.  Entidades de integra√ß√£o.  As entidades L1 s√£o combinadas em forma√ß√µes maiores, por exemplo, em aplicativos de microsservi√ßo de pleno direito.  V√°rios desses aplicativos podem ser agrupados como uma solu√ß√£o √∫nica.  Usamos o sinal ‚Äú+‚Äù, pois, dependendo do n√≠vel de agrega√ß√£o da montagem, um n√≠vel de L3 ou mesmo L4 pode ser atribu√≠do. </p><br><p>  Um exemplo desses assemblies no mundo de terceiros √© a prepara√ß√£o de distribui√ß√µes Linux.  Meta-pacotes l√°. </p><br><p>  Al√©m de tarefas t√©cnicas bastante complexas (como esta: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ru.wikipedia.org/wiki/Dependency_hell</a> ).  As montagens L2 + geralmente s√£o o produto final e, portanto, t√™m muitos requisitos de processo: um sistema de direitos, fixa√ß√£o de pessoas respons√°veis, aus√™ncia de erros legais, fornecimento de v√°rias documenta√ß√µes. </p><br><p>  <i>No L2 +, os requisitos do processo s√£o priorizados pela automa√ß√£o.</i> </p><br><p>  Se a solu√ß√£o autom√°tica n√£o funcionar, pois √© conveniente para as pessoas interessadas, ela n√£o ser√° implementada. </p><br><p>  As montagens L2 + provavelmente ser√£o executadas por uma ferramenta propriet√°ria adaptada especificamente aos processos da empresa.  Voc√™ acha que os gerenciadores de pacotes do Linux prop√µem isso? </p></li></ul><br><br><h2>  Nossas melhores pr√°ticas </h2><br><h3>  A infraestrutura </h3><br><h4>  Disponibilidade permanente de ferro </h4><br><p>  Toda a infraestrutura de montagem est√° localizada em servidores fechados dentro da rede corporativa.  Em alguns casos, servi√ßos comerciais em nuvem s√£o poss√≠veis. <br></p><br><h4>  Autonomia </h4><br><p>  Em todos os processos de IC, a Internet n√£o est√° dispon√≠vel.  Todos os recursos necess√°rios s√£o espelhados e armazenados em cache internamente.  Parcialmente at√© github.com (obrigado, npm!) A maioria desses problemas √© resolvida pelo Artifactory. </p><br><p>  Portanto, somos calmos ao excluir artefatos da central central ou fechar reposit√≥rios populares.  H√° um exemplo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">community.oracle.com/community/java/javanet-forge-sunset</a> . </p><br><p>  O espelhamento reduz significativamente o tempo de montagem, libera o canal corporativo da Internet.  Menos recursos cr√≠ticos de rede aumentam a estabilidade da constru√ß√£o. </p><br><h4>  Tr√™s reposit√≥rios para cada tipo de artefato </h4><br><ol><li>  Dev √© um reposit√≥rio onde qualquer pessoa pode publicar artefatos de qualquer origem.  Aqui voc√™ pode experimentar abordagens fundamentalmente novas sem adapt√°-las aos padr√µes corporativos desde o primeiro dia. </li><li>  A prepara√ß√£o √© um reposit√≥rio preenchido apenas com um pipeline de montagem. </li><li>  Libera√ß√£o - montagens √∫nicas, prontas para entrega externa.  √â preenchido com uma opera√ß√£o de transfer√™ncia especial com confirma√ß√£o manual. </li></ol><br><h4>  Regra de 30 dias <br></h4><br><p>  Nos reposit√≥rios Dev e Staging, exclu√≠mos tudo com mais de 30 dias.  Isso ajuda a garantir que todos tenham oportunidades iguais de publica√ß√£o gastando uma quantidade finita de espa√ßo em disco do servidor. </p><br><p>  A libera√ß√£o √© armazenada para sempre, o arquivamento √© feito, se necess√°rio. </p><br><h4>  Ambiente de montagem limpo <br></h4><br><p>  Geralmente, ap√≥s as montagens, os arquivos auxiliares permanecem no sistema, o que pode afetar outros processos de montagem.  Exemplos t√≠picos: </p><br><ul><li>  o problema mais comum √© um cache danificado por um assembly incorreto (como lidar com caches, descritos abaixo); </li><li>  alguns utilit√°rios, como o npm, deixam os arquivos de servi√ßo no diret√≥rio $ HOME que afetam todas as ativa√ß√µes subsequentes desses utilit√°rios; </li><li>  um assembly espec√≠fico pode gastar todo o espa√ßo em disco em alguma parti√ß√£o / tmp, o que levar√° a uma indisponibilidade geral do ambiente. </li></ul><br><p>  Portanto, √© melhor abandonar o ambiente unificado em favor dos cont√™ineres de docker.  Os cont√™ineres devem conter apenas o software necess√°rio para um conjunto espec√≠fico com vers√µes fixas. </p><br><p>  O DevOps mant√©m uma cole√ß√£o de imagens da janela de encaixe de montagem, que √© constantemente atualizada.  No in√≠cio, havia cerca de seis, depois tinha menos de 30 anos, e ent√£o configuramos a gera√ß√£o autom√°tica de imagens a partir da lista de softwares.  Agora, basta especificar requisitos como require ('maven 3.3.9', 'python') - e o ambiente estar√° pronto. </p><br><h4>  Auto diagn√≥stico </h4><br><p>  N√£o √© apenas necess√°rio organizar o suporte ao usu√°rio para solicita√ß√µes, devemos analisar o comportamento de nosso pr√≥prio sistema.  Coletamos registros constantemente, procuramos neles palavras-chave que mostram problemas. </p><br><p>  Em um sistema "ativo", basta escrever de 20 a 30 express√µes regulares para que, para cada montagem, voc√™ possa dizer o motivo de sua queda no n√≠vel: </p><br><ul><li>  Falha no servidor Git </li><li>  espa√ßo em disco acabou por a√≠; </li><li>  erro de constru√ß√£o devido √† falha do desenvolvedor; </li><li>  Erro conhecido no Docker. </li></ul><br><p>  Se algo caiu, mas nenhum problema conhecido foi detectado, esta √© uma ocasi√£o para reabastecer a cole√ß√£o de m√°scaras. </p><br><p>  Em seguida, vamos ao usu√°rio e dizemos que ele tem uma compila√ß√£o e isso pode ser corrigido dessa maneira. </p><br><p>  Voc√™ ficar√° surpreso com quantos problemas os usu√°rios n√£o relatam no suporte.  √â melhor repar√°-los com anteced√™ncia e em um momento conveniente.  Freq√ºentemente, um pequeno erro de publica√ß√£o √© ignorado por duas semanas e, na sexta-feira √† noite, ocorre que isso bloqueia a sa√≠da externa. </p><br><h4>  Escolhemos cuidadosamente de quais sistemas a montagem depende <br></h4><br><p>  Idealmente, em geral, para garantir total autonomia da montagem, mas na maioria das vezes isso √© imposs√≠vel.  Para montagens baseadas em java, √© necess√°rio pelo menos Artifactory para espelhamento - veja acima para autonomia.  Cada sistema integrado aumenta o risco de falha.  √â desej√°vel que todos os sistemas funcionem no modo HA decente. </p><br><h3>  Interface da linha de montagem </h3><br><h4>  Interface √∫nica para chamar o assembly </h4><br><p>  Fazemos qualquer tipo de montagem com um sistema.  As montagens de todos os n√≠veis (L1, L2 +) s√£o descritas pelo c√≥digo do programa e s√£o chamadas por meio de um trabalho Jenkins. </p><br><p>  No entanto, essa abordagem n√£o √© ideal.  √â melhor usar os mecanismos de gera√ß√£o autom√°tica de tarefas Jenkins: por exemplo, 1 tarefa = 1 reposit√≥rio git ou 1 tarefa = 1 ramifica√ß√£o git.  Isso alcan√ßar√° o seguinte: </p><br><ul><li>  logs de assembl√©ias heterog√™neas n√£o s√£o confundidos em uma hist√≥ria na p√°gina de trabalho da Jenkins; </li><li>  de fato, voc√™ obt√©m trabalhos alocados confort√°veis ‚Äã‚Äãpara uma equipe ou para um desenvolvedor;  a sensa√ß√£o de conforto pode ser aprimorada ajustando os gr√°ficos dos resultados de junit, cobertura, sonar. </li></ul><br><h4>  Liberdade de escolha da tecnologia <br></h4><br><p>  Iniciando a constru√ß√£o √© uma chamada para o script bash ‚Äú./build.sh‚Äù.  E ent√£o - quaisquer sistemas de montagem, linguagens de programa√ß√£o e tudo o mais necess√°rio para concluir uma tarefa de neg√≥cios.  Isso fornece uma abordagem para montagem como uma caixa preta. </p><br><h4>  Postagem inteligente </h4><br><p>  A linha de montagem intercepta publica√ß√µes da caixa preta e as coloca no armazenamento corporativo.  Para isso, problemas chatos, como gerar nomes de imagens do docker e escolher o reposit√≥rio certo para publica√ß√£o, s√£o resolvidos automaticamente. </p><br><p>  Os reposit√≥rios de prepara√ß√£o e libera√ß√£o sempre t√™m ordem.  √â necess√°rio dar suporte √†s especificidades de publica√ß√µes de diferentes tipos: maven, npm, file, docker. </p><br><h4>  Descritor de montagem <br></h4><br><p>  Build.sh descreve como compilar c√≥digo, mas isso n√£o √© suficiente para um cont√™iner de assembly. </p><br><p>  Voc√™ tamb√©m deve saber: </p><br><ol><li>  qual ambiente de montagem usar; </li><li>  vari√°veis ‚Äã‚Äãde ambiente dispon√≠veis no build.sh; </li><li>  quais publica√ß√µes ser√£o realizadas; </li><li>  outras op√ß√µes espec√≠ficas. </li></ol><br><p>  Optamos por uma maneira conveniente de descrever essas informa√ß√µes na forma de um arquivo yaml que lembra remotamente o arquivo .gitlab-ci.yaml. </p><br><h4>  Parametriza√ß√£o de montagem <br></h4><br><p>  O usu√°rio pode especificar par√¢metros arbitr√°rios sem executar o comando git commit logo no in√≠cio da montagem. </p><br><p>  Implementamos isso definindo vari√°veis ‚Äã‚Äãde ambiente diretamente da interface do trabalho Jenkins. </p><br><p>  Por exemplo, transferimos a vers√£o da biblioteca dependente para esse par√¢metro de assembly e, em alguns casos, redefinimos essa vers√£o para outra experimental.  Sem esse mecanismo, o usu√°rio teria que executar o comando "git commit" a cada vez. </p><br><h4>  Portabilidade do sistema <br></h4><br><p>  Voc√™ deve poder reproduzir o processo de montagem n√£o apenas no servidor de IC principal, mas tamb√©m no computador do desenvolvedor.  Isso ajuda na depura√ß√£o de scripts de compila√ß√£o complexos.  Al√©m disso, em vez de Jenkins, √†s vezes ser√° mais conveniente usar o Gitlab CI.  Portanto, o sistema de constru√ß√£o deve ser um aplicativo java independente.  N√≥s o implementamos como um plugin gradle. </p><br><h4>  Um artefato pode ser publicado com nomes diferentes. <br></h4><br><p>  Existem dois requisitos opostos para publica√ß√£o que podem surgir simultaneamente. </p><br><p>  Por um lado, para armazenamento de longo prazo e gerenciamento de libera√ß√£o, √© necess√°rio garantir a exclusividade dos nomes dos artefatos publicados.  Isso proteger√° pelo menos os artefatos de serem substitu√≠dos. </p><br><p>  Por outro lado, √†s vezes √© conveniente ter um artefato real com um nome fixo como o mais recente.  Por exemplo, o desenvolvedor n√£o precisa saber a vers√£o exata da depend√™ncia a cada vez, basta trabalhar com a mais recente. </p><br><p>  O artefato nesse caso √© publicado com dois ou mais nomes, pois √© adequado a todos. </p><br><p>  Por exemplo: </p><br><ol><li>  um nome exclusivo com carimbo de data / hora ou UUID - para quem precisa de precis√£o; </li><li>  o nome "mais recente" - para seus desenvolvedores, que sempre escolhem o c√≥digo mais recente; </li><li>  o nome "&lt;vers√£o principal&gt; .x-latest" √© para uma equipe vizinha pronta para pegar as vers√µes mais recentes, mas apenas dentro da estrutura de uma determinada vers√£o principal. </li></ol><br><p>  Maven faz algo semelhante em sua abordagem ao INSTANT√ÇNEO. </p><br><h4>  Menos restri√ß√µes de seguran√ßa <br></h4><br><p>  Todos podem come√ßar a montagem.  Isso n√£o far√° mal a ningu√©m, uma vez que a montagem cria apenas artefatos. </p><br><h3>  Conformidade legal </h3><br><h4>  Controle de intera√ß√µes externas do processo de montagem </h4><br><p>  A montagem n√£o pode usar nada proibido no processo de seu trabalho. </p><br><p>  Para isso, √© implementado o registro do tr√°fego de rede e o acesso aos caches de arquivos.  N√≥s obtemos o log da atividade de rede do assembly na forma de uma lista de URLs com sha256 hashes dos dados recebidos.  Al√©m disso, cada URL √© validado: </p><br><ol><li>  lista de permiss√µes est√°tica; </li><li>  banco de dados din√¢mico de artefatos permitidos (por exemplo, para depend√™ncias maven, rpm-, npm).  Cada v√≠cio √© considerado individualmente.  Uma permiss√£o autom√°tica ou uma proibi√ß√£o de uso pode funcionar, e uma longa discuss√£o com advogados tamb√©m pode come√ßar. </li></ol><br><h4>  Conte√∫do transparente de artefatos publicados <br></h4><br><p>  √Äs vezes, a tarefa √© fornecer uma lista de software de terceiros dentro de qualquer montagem.  Para fazer isso, eles criaram um analisador de composi√ß√£o simples que analisa todos os arquivos e arquivos da montagem, reconhece os terceiros por hashes e faz um relat√≥rio. </p><br><h4>  O c√≥digo-fonte emitido n√£o pode ser removido do GIT <br></h4><br><p>  √Äs vezes, voc√™ pode precisar encontrar o c√≥digo-fonte observando o artefato bin√°rio compilado h√° dois anos.  Para fazer isso, √© necess√°rio alocar tags no Git automaticamente com sa√≠da externa, al√©m de proibir sua remo√ß√£o. </p><br><h3>  Log√≠stica e Contabilidade <br></h3><br><h4>  Todos os assemblies s√£o armazenados no banco de dados. </h4><br><p>  Usamos o reposit√≥rio de arquivos no Artifactory para esses fins.  Ele cont√©m todas as informa√ß√µes de suporte: quem o lan√ßou, quais foram os resultados das verifica√ß√µes, quais artefatos foram publicados, qual git hash foi usado etc. </p><br><h4>  Sabemos como reproduzir a montagem com a maior precis√£o poss√≠vel </h4><br><p>  De acordo com os resultados da montagem, armazenamos as seguintes informa√ß√µes: </p><br><ul><li>  o estado exato do c√≥digo que foi coletado; </li><li>  com quais par√¢metros o lan√ßamento foi feito; </li><li>  quais comandos foram chamados; </li><li>  que acesso a recursos externos ocorreu; </li><li>  ambiente de montagem usado. </li></ul><br><p>  Se necess√°rio, podemos responder com precis√£o √† quest√£o de como foi montada. </p><br><h4>  Comunica√ß√£o bidirecional da montagem com o ticket JIRA <br></h4><br><p>  Certifique-se de poder resolver os seguintes problemas: </p><br><ol><li>  para montagem, crie uma lista de tickets do JIRA inclu√≠dos nele; </li><li>  escreva no ticket do JIRA em que montagens ele est√° inclu√≠do. </li></ol><br><p>  √â fornecida uma comunica√ß√£o bidirecional estreita entre o assembly e o commit do git.  E, a partir do texto dos coment√°rios, voc√™ j√° pode descobrir todos os links para o JIRA. </p><br><h3>  Velocidade </h3><br><h4>  Caches do sistema de montagem </h4><br><p>  A aus√™ncia de um cache automatizado pode aumentar o tempo de compila√ß√£o em uma hora. </p><br><p>  O cache viola o isolamento do ambiente de montagem e a limpeza da montagem.  Esse problema pode ser resolvido determinando sua origem para cada artefato em cache.  Cada arquivo de cache est√° associado a um link https do qual foi baixado uma vez.  Al√©m disso, processamos a leitura de um cache como endere√ßo de rede. </p><br><h4>  Cache de Recursos de Rede </h4><br><p>  O crescimento geogr√°fico da empresa leva √† necessidade de transferir arquivos de 300 MB entre continentes.  Muito tempo √© gasto, especialmente se voc√™ tiver que fazer isso com frequ√™ncia. </p><br><p>  Reposit√≥rios Git, imagens de encaixe de ambientes de montagem, armazenamento de arquivos - tudo precisa ser cuidadosamente armazenado em cache.  Bem, √© claro, periodicamente limpo. </p><br><h4>  Montagem - o mais r√°pido poss√≠vel, tudo o resto - </h4><br><p>  A primeira etapa: fazemos a montagem e imediatamente, sem gestos desnecess√°rios, damos o resultado. </p><br><p>  A segunda etapa: valida√ß√£o, an√°lise, contabilidade e outras burocracias.  Isso j√° pode ser feito em um trabalho separado da Jenkins e sem prazos estritos. </p><br><h2>  Qual √© o resultado </h2><br><ol><li>  O principal √© que a <i>montagem ficou clara para os desenvolvedores</i> , eles mesmos podem desenvolver e otimizar. </li><li>  A funda√ß√£o foi criada para criar processos de neg√≥cios que dependem da montagem: instala√ß√£o, gerenciamento de problemas, testes, gerenciamento de vers√µes, etc. </li><li>  A equipe do DevOps n√£o escreve mais scripts de montagem: os desenvolvedores fazem isso. </li><li>  Requisitos corporativos complexos se transformaram em um relat√≥rio transparente com uma lista final de verifica√ß√µes. </li><li>  Qualquer pessoa pode criar qualquer reposit√≥rio simplesmente chamando build.sh atrav√©s de uma √∫nica interface.  √â o suficiente para ele simplesmente especificar as coordenadas git do c√≥digo fonte.  Essa pessoa pode ser gerente de equipe, engenheiro de controle de qualidade / TI etc. </li></ol><br><p>  E alguns n√∫meros </p><br><ol><li>   .   15    Jenkins job    build.sh.   15    docker-,   ,  .      .        . </li><li>  .         .      2200 .   ‚Äî  on-commit-. </li><li>      300 git-,     . </li><li>      30   ,   (25 ) ‚Äî  docker. </li><li>      ,     : <br><ol><li> glide, golang, promu; </li><li> maven, gradle; </li><li> python &amp; pip; </li><li> ruby; </li><li> nodejs &amp; npm; </li><li> docker; </li><li> rpm build tools &amp; gcc; </li><li>  Android   ADT; </li><li>  ; </li><li>    legacy-; </li><li>   . </li></ol><br></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt421423/">https://habr.com/ru/post/pt421423/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt421413/index.html">Acesso adequado aos m√©todos de interface padr√£o atrav√©s da reflex√£o em Java 8, 9, 10</a></li>
<li><a href="../pt421415/index.html">Salto m√°gico - lixo triste</a></li>
<li><a href="../pt421417/index.html">M√°quina de caf√© para viciados em caf√© ou m√°quina de caf√© m√≥vel Wacaco</a></li>
<li><a href="../pt421419/index.html">Ode ao n√≠quel ‚Äúespumado‚Äù, safiras inexistentes e ao vice-ministro sovi√©tico: o ic√¥nico OTTO SX-P1 no Jap√£o, nos EUA e na URSS</a></li>
<li><a href="../pt421421/index.html">LAppS: Meio milh√£o de mensagens de 1 KB-WebSocket por segundo com TLS em uma CPU</a></li>
<li><a href="../pt421425/index.html">Domesticar e consolidar: a hist√≥ria da mudan√ßa para o Oracle Supercluster</a></li>
<li><a href="../pt421429/index.html">LSTM - ANN Pre√ßos Din√¢micos no Varejo de Bens Dom√©sticos</a></li>
<li><a href="../pt421431/index.html">Gerenciamento de tempo ou gerenciamento eficaz do caos</a></li>
<li><a href="../pt421433/index.html">Faltava exatamente um dia para o in√≠cio do servidor.</a></li>
<li><a href="../pt421435/index.html">"Por que todos n√≥s estamos fazendo isso?" - Criador do Prisma e ex-l√≠der do projeto VK sobre seu novo projeto secreto</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>