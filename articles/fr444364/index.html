<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚈 🍕 🖐🏼 Jeu Rust 24 heures: expérience de développement personnel 🚂 🔣 🦉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je parlerai de mon expérience personnelle dans le développement d'un petit jeu à Rust. Il a fallu environ 24 heures pour créer une v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jeu Rust 24 heures: expérience de développement personnel</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skillbox/blog/444364/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/019/753/9bf/0197539bf7364b198561856cd6dfd961.png" alt="image"></div><br>  Dans cet article, je parlerai de mon expérience personnelle dans le développement d'un petit jeu à Rust.  Il a fallu environ 24 heures pour créer une version de travail (j'ai principalement travaillé le soir ou le week-end).  Le jeu est loin d'être terminé, mais je pense que l'expérience sera utile.  Je vais vous dire ce que j'ai appris et certaines des observations faites lors de la construction du jeu à partir de zéro. <br><a name="habracut"></a><br><blockquote>  <b>Skillbox recommande:</b> Cours pratique de deux ans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Je suis un développeur Web PRO</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"</a> <br><br>  <b>Nous vous rappelons:</b> <i>pour tous les lecteurs de «Habr» - une remise de 10 000 roubles lors de l'inscription à un cours Skillbox en utilisant le code promo «Habr».</i> </blockquote><br><h3>  Pourquoi rouiller? </h3><br>  J'ai choisi ce langage parce que j'en ai beaucoup entendu parler et je vois qu'il devient de plus en plus populaire dans le domaine du développement de jeux.  Avant d'écrire le jeu, j'avais peu d'expérience dans le développement d'applications simples dans Rust.  C'était juste assez pour ressentir une certaine liberté lors de l'écriture du jeu. <br><br><h3>  Pourquoi exactement le jeu et quel genre de jeu? </h3><br>  Faire des jeux est amusant!  Je voudrais pour plus de raisons, mais pour des projets «maison» je choisis des sujets qui ne sont pas trop étroitement liés à mon travail habituel.  Quel genre de jeu?  Je voulais faire quelque chose comme un simulateur de tennis, qui combine Cities Skylines, Zoo Tycoon, Prison Architect et tennis lui-même.  En général, il s'est avéré un jeu sur une académie de tennis, où les gens viennent jouer. <br><br><h3>  Formation technique </h3><br>  Je voulais utiliser Rust, mais je ne savais pas exactement comment «à partir de zéro» je devrais commencer.  Je ne voulais pas écrire de pixel shaders et utiliser le glisser-déposer, donc je cherchais les solutions les plus flexibles. <br><br>  J'ai trouvé des ressources utiles que je partage avec vous: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sommes-nous encore en jeu</a> - une liste des éléments Rust nécessaires au développement du jeu; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rust su dev subreddit;</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pixel art gratuit.</a> </li></ul><br>  J'ai exploré plusieurs moteurs de jeux Rust, en choisissant finalement Piston et ggez.  Je les ai rencontrés en travaillant sur un projet précédent.  Au final, j'ai choisi ggez, car il me semblait plus adapté à l'implémentation d'un petit jeu 2D.  La structure modulaire de Piston est trop complexe pour un développeur débutant (ou quelqu'un qui travaille avec Rust pour la première fois). <br><br><h3>  Structure du jeu </h3><br>  J'ai passé un peu de temps à réfléchir à l'architecture du projet.  La première étape consiste à aménager le «terrain», les gens et les courts de tennis.  Les gens doivent se déplacer dans les tribunaux et attendre.  Les joueurs doivent avoir des compétences qui s'améliorent avec le temps.  De plus, il devrait y avoir un éditeur qui vous permet d'ajouter de nouvelles personnes et de nouveaux tribunaux, mais ce n'est plus gratuit. <br><br>  En réfléchissant à tout, je me mis au travail. <br><br><h3>  Création de jeux </h3><br>  <b>Début: cercles et abstractions</b> <br><br>  J'ai pris un exemple de ggez et j'ai un cercle sur l'écran.  Incroyable  Maintenant quelques abstractions.  Il m’a semblé agréable d’ignorer l’idée d’un objet de jeu.  Chaque objet doit être rendu et mis à jour comme indiqué ici: <br><br><pre><code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// the game object trait trait GameObject { fn update(&amp;mut self, _ctx: &amp;mut Context) -&gt; GameResult&lt;()&gt;; fn draw(&amp;mut self, ctx: &amp;mut Context) -&gt; GameResult&lt;()&gt;; } // a specific game object - Circle struct Circle { position: Point2, } impl Circle { fn new(position: Point2) -&gt; Circle { Circle { position } } } impl GameObject for Circle { fn update(&amp;mut self, _ctx: &amp;mut Context) -&gt; GameResult&lt;()&gt; { Ok(()) } fn draw(&amp;mut self, ctx: &amp;mut Context) -&gt; GameResult&lt;()&gt; { let circle = graphics::Mesh::new_circle(ctx, graphics::DrawMode::Fill, self.position, 100.0, 2.0)?; graphics::draw(ctx, &amp;circle, na::Point2::new(0.0, 0.0), 0.0)?; Ok(()) } }</span></span></code> </pre> <br>  Ce morceau de code m'a permis d'obtenir une excellente liste d'objets que je peux mettre à jour et rendre dans une boucle tout aussi excellente. <br><br><pre> <code class="rust hljs">mpl event::EventHandler <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> MainState { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, context: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Context) -&gt; GameResult&lt;()&gt; { <span class="hljs-comment"><span class="hljs-comment">// Update all objects for object in self.objects.iter_mut() { object.update(context)?; } Ok(()) } fn draw(&amp;mut self, context: &amp;mut Context) -&gt; GameResult&lt;()&gt; { graphics::clear(context); // Draw all objects for object in self.objects.iter_mut() { object.draw(context)?; } graphics::present(context); Ok(()) } }</span></span></code> </pre> <br>  main.rs est nécessaire car il contient toutes les lignes de code.  J'ai passé un peu de temps à séparer les fichiers et à optimiser la structure des répertoires.  Voici comment tout a commencé à s'occuper de cela: <br><br>  <i>ressources -&gt; c'est là que se trouvent tous les actifs (images)</i> <i><br></i>  <i>src</i> <i><br></i>  <i>- entités</i> <i><br></i>  <i>- game_object.rs</i> <i><br></i>  <i>- circle.rs</i> <i><br></i>  <i>- main.rs -&gt; boucle principale</i> <br><br>  <b>Personnes, sols et images</b> <br><br>  L'étape suivante consiste à créer un objet de jeu Personne et à charger des images.  Tout devrait être basé sur des carreaux de 32 * 32. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/642/4c6/65c/6424c665cb9442c5471a49d987954880.png"><br><br>  <b>Courts de tennis</b> <br><br>  Après avoir étudié l'apparence des courts de tennis, j'ai décidé de les fabriquer avec des tuiles 4 * 2.  Initialement, il était possible de faire une image de cette taille ou de faire ensemble 8 tuiles distinctes.  Mais j'ai réalisé que seulement deux tuiles uniques sont nécessaires, et c'est pourquoi. <br><br>  Au total, nous avons deux de ces tuiles: 1 et 2. <br><br>  Chaque section du terrain se compose de la tuile 1 ou de la tuile 2. Elles peuvent être disposées comme d'habitude ou être retournées de 180 degrés. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/26d/de1/e6f/26dde1e6f7ec2459c89752754a048c04.png"><br><br>  <b>Le principal mode de construction (assemblage)</b> <br><br>  Après avoir réussi à obtenir le rendu des sites, des personnes et des cartes, j'ai réalisé qu'un mode de construction de base était également nécessaire.  Il a été implémenté comme ceci: lorsque le bouton est enfoncé, l'objet est sélectionné et le clic le place au bon endroit.  Ainsi, le bouton 1 vous permet de sélectionner un terrain, et le bouton 2 vous permet de sélectionner un joueur. <br><br>  Mais vous devez toujours vous souvenir de ce que nous voulons dire 1 et 2, j'ai donc ajouté un filaire pour qu'il soit clair quel objet est sélectionné.  Voici à quoi ça ressemble. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e96/63d/e17/e9663de17e6b402f43cab61e3905c874.gif"></div><br>  <b>Questions d'architecture et de refactoring</b> <br><br>  Maintenant, j'ai plusieurs objets de jeu: les gens, les courts et les sols.  Mais pour que les wireframes fonctionnent, vous devez indiquer à chaque entité de l'objet si les objets eux-mêmes sont en mode démonstration ou si un cadre est simplement dessiné.  Ce n'est pas très pratique. <br><br>  Il m'a semblé que je devais repenser l'architecture afin de révéler certaines limites: <br><br><ul><li>  la présence d'une entité qui s'affiche et se met à jour est un problème, car cette entité ne pourra pas «savoir» ce qu'elle doit rendre - une image et un filaire; </li><li>  absence d'outil pour l'échange de propriétés et de comportements entre des entités individuelles (par exemple, la propriété is_build_mode ou le comportement de rendu).  L'héritage peut être utilisé, bien qu'il n'existe aucun moyen normal de l'implémenter dans Rust.  Ce dont j'avais vraiment besoin, c'était de la mise en page; </li><li>  un outil pour l'interaction des entités entre elles était nécessaire pour assigner des personnes aux tribunaux; </li><li>  les entités elles-mêmes étaient un mélange de données et de logique, qui est rapidement devenu incontrôlable. </li></ul><br><blockquote>  <i>J'ai fait d'autres recherches et découvert l'architecture <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ECS - Entity Component System</a> , qui est couramment utilisée dans les jeux.</i>  <i>Voici les avantages d'ECS:</i> <i><br><br></i> <ul><li>  les données sont séparées de la logique; </li><li>  mise en page au lieu de l'héritage; </li><li>  architecture orientée données. </li></ul></blockquote><br>  ECS se caractérise par trois concepts de base: <br><br><ul><li>  entités - le type d'objet auquel l'identifiant fait référence (il peut s'agir d'un joueur, d'une balle ou de quelque chose d'autre); </li><li>  composants - les entités en sont constituées.  Un exemple est un composant de rendu, une disposition et autres.  C'est un entrepôt de données; </li><li>  systèmes - ils utilisent à la fois des objets et des composants, et ils contiennent un comportement et une logique basés sur ces données.  Un exemple est un système de rendu qui itère sur toutes les entités avec des composants pour le rendu et est engagé dans le rendu. </li></ul><br>  Après avoir étudié, il est devenu clair qu'ECS résout de tels problèmes: <br><br><ul><li>  utiliser la disposition au lieu de l'héritage pour l'organisation système des entités; </li><li>  se débarrasser d'un hachage de code en raison des systèmes de contrôle; </li><li>  en utilisant des méthodes comme is_build_mode pour stocker la logique du filaire au même endroit - dans le système de rendu. </li></ul><br>  Voici ce qui s'est passé après la mise en œuvre d'ECS. <br><br>  <i>ressources -&gt; c'est là que se trouvent tous les actifs (images)</i> <i><br></i>  <i>src</i> <i><br></i>  <i>- composants</i> <i><br></i>  <i>- position.rs</i> <i><br></i>  <i>- person.rs</i> <i><br></i>  <i>- tennis_court.rs</i> <i><br></i>  <i>- floor.rs</i> <i><br></i>  <i>- wireframe.rs</i> <i><br></i>  <i>- mouse_tracked.rs</i> <i><br></i>  <i>- ressources</i> <i><br></i>  <i>- mouse.rs</i> <i><br></i>  <i>- systèmes</i> <i><br></i>  <i>- rendu.rs</i> <i><br></i>  <i>- constants.rs</i> <i><br></i>  <i>- utils.rs</i> <i><br></i>  <i>- world_factory.rs -&gt; fonctions d'usine du monde</i> <i><br></i>  <i>- main.rs -&gt; boucle principale</i> <br><br><h3>  Affecter des personnes aux tribunaux </h3><br>  ECS a rendu la vie plus facile.  Maintenant, j'avais un moyen systématique d'ajouter des données aux entités et d'ajouter une logique basée sur ces données.  Et cela, à son tour, a permis d'organiser la répartition des personnes par voie judiciaire. <br><br>  Ce que j'ai fait: <br><br><ul><li>  ajouté des données sur les tribunaux assignés à la personne; </li><li>  ajouté des données sur les personnes distribuées à TennisCourt; </li><li>  ajouté CourtChoosingSystem, qui vous permet d'analyser des personnes et des sites, de trouver des terrains disponibles et de leur distribuer des joueurs; </li><li>  a ajouté le système PersonMovementSystem, qui recherche les personnes affectées aux tribunaux, et si elles ne sont pas là, il envoie des personnes si nécessaire. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b0/c8e/c95/7b0c8ec951007ad4d5895716c3ca7618.gif"></div><br><h3>  Pour résumer </h3><br>  J'ai vraiment aimé travailler sur ce jeu simple.  De plus, je suis heureux d'avoir utilisé Rust pour l'écrire, car: <br><br><ul><li>  La rouille vous donne ce dont vous avez besoin; </li><li>  il a une excellente documentation, Rust est très élégant; </li><li>  la constance est cool; </li><li>  Vous n'avez pas à recourir au clonage, à la copie ou à d'autres actions similaires, ce que j'ai souvent fait en C ++; </li><li>  Les options sont très pratiques pour le travail, elles gèrent également parfaitement les erreurs; </li><li>  si le projet pouvait être compilé, alors à 99% il fonctionne, et exactement comme il se doit.  Il me semble que les messages d'erreur du compilateur sont les meilleurs que j'ai vus. </li></ul><br>  Le développement de jeux sur Rust ne fait que commencer.  Mais il existe déjà une communauté stable et assez importante pour ouvrir Rust à tout le monde.  Par conséquent, je regarde l'avenir de la langue avec optimisme, dans l'attente des résultats de notre travail commun. <br><br><blockquote>  <b>Skillbox recommande:</b> <br><br><ul><li>  Cours en ligne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Profession frontend-developer"</a> . </li><li>  Cours pratique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Mobile Developer PRO"</a> . </li><li>  Cours pratique annuel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Développeur PHP de 0 à PRO"</a> . </li></ul><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444364/">https://habr.com/ru/post/fr444364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444352/index.html">Kontur.Kampus: nous vous invitons à un camp étudiant gratuit de développement industriel près de Saint-Pétersbourg</a></li>
<li><a href="../fr444356/index.html">Tutoriel React, partie 24: Leçon sur les seconds formulaires</a></li>
<li><a href="../fr444358/index.html">Enumerable: comment générer une valeur commerciale</a></li>
<li><a href="../fr444360/index.html">Injustice Google Play comme une bonne expérience de vie</a></li>
<li><a href="../fr444362/index.html">Unity et Havok travaillent sur un nouveau moteur physique</a></li>
<li><a href="../fr444366/index.html">Séminaire "Exigences de sécurité de l'information: comment les entreprises peuvent vivre avec elles"</a></li>
<li><a href="../fr444368/index.html">Nous venons d'imprimer le microphone sur une imprimante 3D dans le laboratoire - puis il y aura de la science-fiction complète</a></li>
<li><a href="../fr444370/index.html">De quoi le format Mini PCI-e est-il capable?</a></li>
<li><a href="../fr444372/index.html">Orientation longue distance de la machine grâce à un apprentissage renforcé</a></li>
<li><a href="../fr444374/index.html">Effet hipster: pourquoi les non-conformistes se ressemblent souvent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>