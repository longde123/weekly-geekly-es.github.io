<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë§ üë©üèæ‚Äçüç≥ üë©üèΩ‚Äçüé§ Monitoramento por SMS do peso de tr√™s colmeias por US $ 30 üö† ü•î üâê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="N√£o, essa n√£o √© uma oferta comercial; √© o custo dos componentes do sistema que voc√™ pode coletar ap√≥s a leitura do artigo. 


 Um pouco de fundo: 


 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoramento por SMS do peso de tr√™s colmeias por US $ 30</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444326/"><p><img src="https://habrastorage.org/getpro/habr/post_images/f9b/e29/cd3/f9be29cd3be301fe1554f261ae6d0dcb.jpg" alt="Meu logo"></p><br><p>  N√£o, essa n√£o √© uma oferta comercial; √© o custo dos componentes do sistema que voc√™ pode coletar ap√≥s a leitura do artigo. </p><br><p>  Um pouco de fundo: </p><br><p>  Algum tempo atr√°s, eu decidi pegar abelhas, e elas apareceram ... por toda a temporada, mas n√£o sa√≠ram do inverno. <br>  E isso apesar do fato de que tudo parecia estar indo bem - atra√ß√£o do outono, esquentando diante do frio. <br>  A colm√©ia era um sistema Dadan de madeira cl√°ssico com 10 quadros de uma placa de 40 mm. <br>  Mas naquele inverno, at√© os apicultores experientes perderam muito mais do que o normal por causa das varia√ß√µes de temperatura. </p><br><p>  Ent√£o surgiu a id√©ia de um sistema de monitoramento de condi√ß√µes de colm√©ia. <br>  Ap√≥s a publica√ß√£o de v√°rios artigos sobre o Habr-e e a comunica√ß√£o no f√≥rum dos apicultores, decidi ir do simples ao complexo. <br>  O peso √© o √∫nico par√¢metro indiscut√≠vel, mas, como regra, os sistemas existentes monitoram apenas uma se√ß√£o de "refer√™ncia". <br>  Se algo der errado com ele (por exemplo, fuga de um enxame, doen√ßa de abelha), os indicadores se tornam irrelevantes. </p><br><p>  Portanto, decidiu-se monitorar a altera√ß√£o de peso de tr√™s colmeias ao mesmo tempo com um microcontrolador e adicionar os outros "p√£ezinhos" depois. <br>  O resultado √© um sistema aut√¥nomo com um tempo de execu√ß√£o de cerca de um m√™s com uma √∫nica carga da bateria 18650 e o envio de estat√≠sticas uma vez por dia. <br>  Tentei simplificar o design o m√°ximo poss√≠vel, para que ele pudesse ser repetido mesmo sem esquemas, de acordo com uma fotografia. </p><br><p>  A l√≥gica do trabalho √© a seguinte: no primeiro start / reset, as leituras dos sensores instalados sob as colmeias s√£o armazenadas na EEPROM. <br>  Al√©m disso, todos os dias, ap√≥s o p√¥r do sol, o sistema "acorda", l√™ o testemunho e envia SMS com uma mudan√ßa de peso por dia e a partir do momento em que √© ligado. <br>  Al√©m disso, o valor da tens√£o da bateria √© transmitido e, quando ela √© baixada para 3,5 V, √© emitido um aviso sobre a necessidade de carregamento, porque abaixo de 3,4 V o m√≥dulo de comunica√ß√£o n√£o liga e as indica√ß√µes de peso j√° est√£o "flutuando". </p><a name="habracut"></a><br><p>  "Voc√™ se lembra como tudo come√ßou. Tudo foi a primeira vez e novamente." <br><img src="https://habrastorage.org/getpro/habr/post_images/2f2/432/274/2f24322742ff9b620f05bb2804a5bb03.jpg" alt="Como come√ßa"><br>  Sim, era um conjunto de "ferro" que era originalmente, embora apenas c√©lulas e fios de carga sobrevivessem at√© a vers√£o final, mas primeiro as primeiras coisas. <br>  De fato, o compartimento de cabos n√£o √© necess√°rio, mas acabou sendo o mesmo pre√ßo que 30m sem problemas. </p><br><p>  Se voc√™ n√£o tem medo de desmontar 3 LEDs smd e meio ponto de solda normal (sa√≠da) - ent√£o v√°! </p><br><p>  Portanto, precisamos do seguinte conjunto de equipamentos / materiais: </p><br><ol><li>  Arduino Pro Mini 3V <br>  Voc√™ deve prestar aten√ß√£o ao microchip do conversor linear - deve ser exatamente 3,3V - no chip de marca√ß√£o KB 33 / LB 33 / DE A10 - os chineses misturaram algo comigo e todo o lote <br>  as placas de circuito na loja eram de reguladores de 5 volts e quartzo de 16 MHz. </li><li>  USB-Ttl em um chip CH340 - voc√™ pode at√© 5 volts, mas, durante o firmware do microcontrolador, o Arduino precisar√° ser desconectado do m√≥dulo GSM, para n√£o queimar o √∫ltimo. <br>  As placas no chip PL2303 n√£o funcionam no Windows 10. </li><li>  M√≥dulo de comunica√ß√£o GSM Goouu Tech IOT GA-6-B ou AI-THINKER A-6 Mini. <br>  Por que voc√™ parou nisso?  O Neoway M590 - um projetista que exige dan√ßas separadas com pandeiros, o GSM SIM800L - n√£o gostou do n√≠vel l√≥gico de 2,8 V n√£o padr√£o, exigindo coordena√ß√£o mesmo com um arduino de tr√™s volts. <br>  Al√©m disso, a solu√ß√£o da AiThinker possui um consumo m√≠nimo de energia (ao enviar SMS, n√£o vi uma corrente acima de 100mA). </li><li>  Antena GSM GPRS 3DBI (na foto acima - um len√ßo retangular com uma ‚Äúcauda‚Äù, por 9 horas) </li><li>  Pacote inicial para um operador com boa cobertura no local do seu api√°rio. <br>  Sim, o pacote deve primeiro ser ativado em um telefone comum, DESATIVAR o PEDIDO DE PIN na entrada e reabastecer a conta. <br>  Agora, existem muitas op√ß√µes com nomes no estilo de "Sensor", "IoT" - eles t√™m taxas mensais um pouco mais baixas. </li><li>  dupont wire 20cm m√£e m√£e - 3 unid.  (para conectar o Arduino ao USB-TTL) </li><li>  3pcs  HX711 - ADC para balan√ßas </li><li>  6 c√©lulas de carga com peso at√© 50 kg </li><li>  15 metros de cabo telef√¥nico de 4 n√∫cleos - para conectar m√≥dulos de peso com o ARDUINO. </li><li>  Fotorresistor GL5528 (isso √© importante, com uma resist√™ncia escura de 1MOhm e uma resist√™ncia √† luz de 10-20kOhm) e dois resistores convencionais de 20k </li><li>  Um peda√ßo de fita adesiva dupla face de 18x18 mm de espessura - para conectar o arduino ao m√≥dulo de comunica√ß√£o. </li><li>  O suporte da bateria 18650 e, de fato, a pr√≥pria bateria ~ 2600mAh. </li><li>  Um pouco de cera ou parafina (vela de tablet com l√¢mpada de aroma) - para prote√ß√£o contra umidade HX711 </li><li>  Um peda√ßo de viga de madeira 25x50x300mm para a base das c√©lulas de carga. </li><li>  Uma d√∫zia de parafusos autorroscantes com uma arruela de press√£o de 4,2x19 mm para montar sensores na base. </li></ol><br><p>  A bateria pode ser retirada da desmontagem dos laptops - muitas vezes mais baratos que os novos, e a capacidade ser√° muito maior do que a do UltraFire chin√™s - consegui 1.500 contra 450 (isso √© do firewall 6800 ;-) </p><br><p>  Al√©m disso, ser√£o necess√°rias m√£os tortas, ferro de solda EPSN-25, resina e solda POS-60. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0a9/222/e6a/0a9222e6acd4d43631f777dfa995dcab.jpg" alt="Ferro de solda"></p><br><p>  H√° cinco anos, usei um ferro de solda sovi√©tico com uma picada de cobre (n√£o consegui esta√ß√µes de solda - tomei-o para um test drive e terminei o circuito EPSN). <br>  Mas ap√≥s seu fracasso e v√°rios monstruosos chineses sob (d) √°rvores de Natal, este √∫ltimo foi chamado Esparta - algo t√£o grave quanto o nome parou <br>  em um produto com um controlador de temperatura. </p><br><p>  Ent√£o vamos l√°! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/eba/218/027/eba21802786557630e811458e9a07eaa.jpg" alt="GSM A6"></p><br><p>  Para come√ßar, dois LEDs s√£o soldados no m√≥dulo GSM (o local em que foram circulados em um oval laranja) <br>  N√≥s inserimos o cart√£o SIM com os blocos na placa de circuito impresso, o canto chanfrado da foto √© indicado pela seta. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/463/027/4e6/4630274e63f3710ea1b69f94a3d2dd8b.jpg" alt="Arduino Pro Mini 3v"></p><br><p>  Em seguida, realizamos um procedimento semelhante com o LED na placa Arduino (o oval √† esquerda do chip quadrado), <br>  Solde o pente em quatro contatos (1), <br>  Tomamos dois resistores de 20k, tor√ßamos os fios de um lado, soldamos o tor√ß√£o no orif√≠cio de contato A5, os demais fios nos arduques RAW e GND (2), <br>  Reduzimos o fotorresistor para 10 mm e o soldamos √†s conclus√µes das placas GND e D2 (3). </p><br><p>  Agora √© hora <del>  fita isolante azul </del>  fita dupla face - cole-a no suporte do cart√£o SIM do m√≥dulo de comunica√ß√£o e, na parte superior - arduino - o bot√£o vermelho (prateado) est√° voltado para n√≥s e est√° localizado acima do cart√£o SIM. </p><br><p>  Solde a energia: mais do capacitor do m√≥dulo de comunica√ß√£o (4) ao pino RAW do arduino. <br>  O fato √© que o pr√≥prio m√≥dulo de comunica√ß√£o requer 3,4-4,2V para sua fonte de alimenta√ß√£o e seu contato PWR √© conectado a um conversor abaixador, de modo que, para opera√ß√£o a partir de √≠ons de l√≠tio, a tens√£o deve ser aplicada contornando esta parte do circuito. </p><br><p>  No arduino, pelo contr√°rio, iniciamos a fonte de alimenta√ß√£o atrav√©s de um conversor linear - em correntes baixas, a queda de tens√£o de queda √© de 0,1V. <br>  Mas, ao fornecer uma tens√£o estabilizada aos m√≥dulos HX711, eliminamos a necessidade de refin√°-los em uma tens√£o mais baixa (e ao mesmo tempo aumentamos o ru√≠do como resultado dessa opera√ß√£o). </p><br><p>  Em seguida, soldamos os jumpers (5) entre os contatos de PWR-A1, URX-D4 e UTX-D5, o terra GND-G (6) e, finalmente, a energia do suporte da bateria 18650 (7), conecte a antena (8). <br>  Agora pegamos o conversor USB-TTL e conectamos os contatos RXD-TXD e TXD-RXD, GND-GND com os fios da Dupont ao ARDUINO (pente 1): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/651/7dc/8ff/6517dc8ffbb81e4be9f1793db3eb66aa.jpg" alt="Primeira vers√£o"></p><br><p>  Na foto acima - a primeira vers√£o (de tr√™s) do sistema, que foi usada para depura√ß√£o. </p><br><p>  E agora, por algum tempo, nos desviamos do ferro de soldar e passamos √† parte do software. <br>  Vou descrever a sequ√™ncia de a√ß√µes para o Windows: <br>  Primeiro, voc√™ precisa baixar e instalar / descompactar o programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">IDE</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Arduino</a> - a vers√£o atual √© 1.8.9, mas eu uso o 1.6.4 </p><br><p>  Por uma quest√£o de simplicidade, descompactamos o arquivo na pasta C: \ arduino- "your_version_number", onde teremos / dist, drivers, exemplos, hardware, java, lib, bibliotecas, refer√™ncias, pastas de ferramentas, al√©m do arquivo execut√°vel do arduino (entre outros). </p><br><p>  Agora precisamos de uma biblioteca para trabalhar com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HX711</a> ADC - o bot√£o verde "clonar ou baixar" - fa√ßa o download do ZIP. <br>  O conte√∫do (pasta HX711-master) √© colocado no diret√≥rio C: \ arduino- "your_version_number" \ library </p><br><p>  E, √© claro, o driver para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">USB-TTL √©</a> do mesmo github - do arquivo descompactado, o arquivo SETUP do instalador √© simplesmente iniciado. </p><br><p>  Ok, execute e configure o programa C: \ arduino- "your_version_number" \ arduino </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2fd/429/2d5/2fd4292d54f67c31052b54ca853be5b3.jpg" alt="Interface do programa"></p><br><p>  Vamos para o item "Ferramentas" - selecione a placa "Arduino Pro ou Pro Mini", o processador Atmega 328 3.3V 8 MHz, a porta √© o n√∫mero diferente do COM1 do sistema (aparece ap√≥s a instala√ß√£o do driver CH340 com o adaptador USB-TTL conectado) </p><br><p>  Ok, copie o seguinte esbo√ßo (programa) e cole-o na janela do IDE do Arduino </p><br><pre><code class="plaintext hljs">char phone_no[]="+123456789012"; // Your phone number that receive SMS with counry code #include &lt;avr/sleep.h&gt; // ARDUINO sleep mode library #include &lt;SoftwareSerial.h&gt; // Sofrware serial library #include "HX711.h" // HX711 lib. https://github.com/bogde/HX711 #include &lt;EEPROM.h&gt; // EEPROM lib. HX711 scale0(10, 14); HX711 scale1(11, 14); HX711 scale2(12, 14); #define SENSORCNT 3 HX711 *scale[SENSORCNT]; SoftwareSerial mySerial(5, 4); // Set I/O-port TXD, RXD of GSM-shield byte pin2sleep=15; // Set powerON/OFF pin float delta00; // delta weight from start float delta10; float delta20; float delta01; // delta weight from yesterday float delta11; float delta21; float raw00; //raw data from sensors on first start float raw10; float raw20; float raw01; //raw data from sensors on yesterday float raw11; float raw21; float raw02; //actual raw data from sensors float raw12; float raw22; word calibrate0=20880; //calibration factor for each sensor word calibrate1=20880; word calibrate2=20880; word daynum=0; //numbers of day after start int notsunset=0; boolean setZero=false; float readVcc() { // Read battery voltage function long result1000; float rvcc; result1000 = analogRead(A5); rvcc=result1000; rvcc=6.6*rvcc/1023; return rvcc; } void setup() { // Setup part run once, at start pinMode(13, OUTPUT); // Led pin init pinMode(2, INPUT_PULLUP); // Set pullup voltage Serial.begin(9600); mySerial.begin(115200); // Open Software Serial port to work with GSM-shield pinMode(pin2sleep, OUTPUT);// Itit ON/OFF pin for GSM digitalWrite(pin2sleep, LOW); // Turn ON modem delay(16000); // Wait for its boot scale[0] = &amp;scale0; //init scale scale[1] = &amp;scale1; scale[2] = &amp;scale2; scale0.set_scale(); scale1.set_scale(); scale2.set_scale(); delay(200); setZero=digitalRead(2); if (EEPROM.read(500)==EEPROM.read(501) || setZero) // first boot/reset with hiding photoresistor //if (setZero) { raw00=scale0.get_units(16); //read data from scales raw10=scale1.get_units(16); raw20=scale2.get_units(16); EEPROM.put(500, raw00); //write data to eeprom EEPROM.put(504, raw10); EEPROM.put(508, raw20); for (int i = 0; i &lt;= 24; i++) { //blinking LED13 on reset/first boot digitalWrite(13, HIGH); delay(500); digitalWrite(13, LOW); delay(500); } } else { EEPROM.get(500, raw00); // read data from eeprom after battery change EEPROM.get(504, raw10); EEPROM.get(508, raw20); digitalWrite(13, HIGH); // turn on LED 13 on 12sec. delay(12000); digitalWrite(13, LOW); } delay(200); // Test SMS at initial boot // mySerial.println("AT+CMGF=1"); // Send SMS part delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.println("INITIAL BOOT OK"); mySerial.print("V Bat= "); mySerial.println(readVcc()); if (readVcc()&lt;3.5) {mySerial.print("!!! CHARGE BATTERY !!!");} delay(500); mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); // raw02=raw00; raw12=raw10; raw22=raw20; //scale0.power_down(); //power down all scales //scale1.power_down(); //scale2.power_down(); } void loop() { attachInterrupt(0, NULL , RISING); // Interrupt on high lewel set_sleep_mode(SLEEP_MODE_PWR_DOWN); //Set ARDUINO sleep mode digitalWrite(pin2sleep, HIGH); // Turn OFF GSM-shield delay(2200); digitalWrite(pin2sleep, LOW); // Turn OFF GSM-shield delay(2200); digitalWrite(pin2sleep, HIGH); digitalWrite(13, LOW); scale0.power_down(); //power down all scales scale1.power_down(); scale2.power_down(); delay(90000); sleep_mode(); // Go to sleep detachInterrupt(digitalPinToInterrupt(0)); // turn off external interrupt notsunset=0; for (int i=0; i &lt;= 250; i++){ if ( !digitalRead(2) ){ notsunset++; } //is a really sunset now? you shure? delay(360); } if ( notsunset==0 ) { digitalWrite(13, HIGH); digitalWrite(pin2sleep, LOW); // Turn-ON GSM-shield scale0.power_up(); //power up all scales scale1.power_up(); scale2.power_up(); raw01=raw02; raw11=raw12; raw21=raw22; raw02=scale0.get_units(16); //read data from scales raw12=scale1.get_units(16); raw22=scale2.get_units(16); daynum++; delta00=(raw02-raw00)/calibrate0; // calculate weight changes delta01=(raw02-raw01)/calibrate0; delta10=(raw12-raw10)/calibrate1; delta11=(raw12-raw11)/calibrate1; delta20=(raw22-raw20)/calibrate2; delta21=(raw22-raw21)/calibrate2; delay(16000); mySerial.println("AT+CMGF=1"); // Send SMS part delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.print("Turn "); mySerial.println(daynum); mySerial.print("Hive1 "); mySerial.print(delta01); mySerial.print(" "); mySerial.println(delta00); mySerial.print("Hive2 "); mySerial.print(delta11); mySerial.print(" "); mySerial.println(delta10); mySerial.print("Hive3 "); mySerial.print(delta21); mySerial.print(" "); mySerial.println(delta20); mySerial.print("V Bat= "); mySerial.println(readVcc()); if (readVcc()&lt;3.5) {mySerial.print("!!! CHARGE BATTERY !!!");} delay(500); mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); } }</code> </pre> <br><p>  Na primeira linha, entre aspas char phone_no [] = "+ 123456789012";  - em vez de 123456789012, inserimos nosso n√∫mero de telefone com o c√≥digo do pa√≠s para o qual o SMS ser√° enviado. </p><br><p>  Agora clique no bot√£o de verifica√ß√£o (acima do n√∫mero um na captura de tela acima) - se a compila√ß√£o estiver abaixo (abaixo do triplo na captura de tela), podemos piscar o microcontrolador. </p><br><p>  Assim, o USB-TTL est√° conectado ao ARDUINO e ao computador, colocamos a bateria carregada no suporte (geralmente em um novo arduino, o LED come√ßa a piscar uma vez por segundo). </p><br><p>  Agora o firmware - estamos treinando para pressionar o bot√£o vermelho (prateado) do microcontrolador - isso precisar√° ser feito estritamente em um determinado momento !!! <br>  Existe  Clique no bot√£o "Upload" (acima dos dois na captura de tela) e observe atentamente a linha na parte inferior da interface (nas tr√™s telas). <br>  Assim que a inscri√ß√£o "compila√ß√£o" for substitu√≠da por "download" - pressione o bot√£o vermelho (redefinir) - se estiver tudo bem - o adaptador USB-TTL pisca com alegria e a inscri√ß√£o "Downloaded" na parte inferior da interface </p><br><p>  Agora, enquanto aguardamos a chegada do SMS de teste no telefone, mostrarei como o programa funciona: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/bb0/555/3f9/bb05553f9fb11ef00ae30a92be52839b.jpg" alt="A segunda vers√£o do suporte de depura√ß√£o"></p><br><p>  Na foto - a segunda vers√£o do suporte de depura√ß√£o. </p><br><p>  Na primeira vez em que o sistema √© ligado, ele verifica os bytes 500 e 501 da EEPROM; se forem iguais, os dados de calibra√ß√£o n√£o foram gravados e o algoritmo segue para a se√ß√£o de configura√ß√£o. <br>  O mesmo acontece se, quando ligado, o fotorresistor estiver sombreado (com uma tampa de uma caneta) - o modo de redefini√ß√£o de par√¢metro √© ativado. </p><br><p>  Os strain gauges j√° devem ser instalados sob as colmeias, pois simplesmente fixamos o n√≠vel inicial de zero e medimos a mudan√ßa de peso (agora zeros vir√£o, pois ainda n√£o conectamos nada). <br>  No arduino, o LED embutido do pino 13 pisca. <br>  Se a redefini√ß√£o n√£o ocorrer, o LED acender√° por 12 segundos. <br>  Depois disso, um SMS de teste √© enviado com a mensagem "INICIAL BOOT OK" e a voltagem da bateria. <br>  O m√≥dulo de comunica√ß√£o √© desligado e, ap√≥s 3 minutos, a placa Arduino coloca as placas ADX HX711 no modo de suspens√£o e adormece sozinha. <br>  Esse atraso foi feito para n√£o capturar interfer√™ncias de um m√≥dulo GSM em funcionamento (depois de deslig√°-lo, ele "fontes" por algum tempo). </p><br><p>  Al√©m disso, temos uma interrup√ß√£o no fotossensor trabalhando no segundo pino (mais a eleva√ß√£o √© ativada pela fun√ß√£o pullup). <br>  Nesse caso, depois de disparar por mais 3 minutos, o estado do fotorresistor √© verificado para excluir positivos repetidos / falsos. <br>  O que √© caracter√≠stico, sem nenhum ajuste, o sistema funciona 10 minutos ap√≥s o p√¥r do sol astron√¥mico em tempo nublado e ap√≥s 20 em tempo claro. <br>  Sim, para que toda vez que o sistema n√£o reinicie, pelo menos o primeiro m√≥dulo HX711 deve ser conectado (pinos DT-D10, SCK-A0) </p><br><p>  Em seguida, s√£o feitas as leituras das c√©lulas de carga, calculada a altera√ß√£o de peso da opera√ß√£o anterior (o primeiro n√∫mero na linha ap√≥s o Hive) e, desde o primeiro in√≠cio, a tens√£o da bateria √© verificada e essas informa√ß√µes s√£o enviadas na forma de SMS: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c05/360/360/c05360360e4ac01a63cd0daa0f138a99.png" alt="Sistema de amostra"></p><br><p>  A prop√≥sito, voc√™ recebeu SMS?  Parab√©ns!  Estamos a meio caminho!  Enquanto a bateria puder ser removida do suporte, n√£o precisaremos de mais um computador. </p><br><p>  A prop√≥sito, o centro de controle de v√¥o acabou sendo t√£o compacto que pode caber em uma jarra de maionese, no meu caso, uma caixa transl√∫cida de tamanho 30x60x100mm (de cart√µes de visita) se encaixa perfeitamente. </p><br><p>  Sim, o sistema adormecido consome ~ 2.3mA - 90% devido ao m√≥dulo de comunica√ß√£o - ele n√£o desliga completamente, mas entra no modo de espera. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/26b/994/07e/26b99407efab87e00ffe017eea588666.jpg" alt="N√£o houston"></p><br><p>  Prosseguimos na fabrica√ß√£o de sensores, para come√ßar, vamos tocar no layout dos sensores: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/182/43b/cec/18243bcecc904c4018d7b2217cc72d9b.jpg" alt="Localiza√ß√£o do sensor"></p><br><p>  Este √© o plano da colm√©ia. </p><br><p>  Classicamente, 4 sensores s√£o instalados nos cantos (1,2,3,4) </p><br><p>  Vamos medir de forma diferente.  Ou melhor, mesmo no terceiro.  Como os caras do BroodMinder fazem diferente: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b49/fbe/1f3/b49fbe1f378d3e5b4b7320bf6ac83520.jpg" alt="Broodminder"></p><br><p>  Neste projeto, os sensores s√£o instalados nas posi√ß√µes 1 e 2, os pontos 3.4 s√£o baseados na viga. <br>  Ent√£o, apenas metade do peso cai nos sensores. <br>  Sim, esse m√©todo tem menos precis√£o, mas √© dif√≠cil imaginar que as abelhas construam todos os quadros com "l√≠nguas" dos favos de mel ao longo de uma parede da colm√©ia. </p><br><p>  Ent√£o, proponho reduzir os sensores para o ponto 5 completamente - ent√£o n√£o h√° necessidade de proteger o sistema e, ao usar colmeias de luz, √© completamente necess√°rio fazer um sensor. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/67b/10b/4cc/67b10b4ccdaf51f4f81574927ac21ca3.jpg" alt="Sensor e op√ß√µes de sensores"></p><br><p>  Em geral, testamos dois tipos de m√≥dulos no HX711, dois tipos de sensores e duas op√ß√µes para conect√°-los - com uma ponte Wheatstone completa (2 sensores) e meio quando a segunda parte √© complementada com resistores de 1k com uma toler√¢ncia de 0,1%. <br>  Mas o √∫ltimo m√©todo √© indesej√°vel e nem recomendado pelos fabricantes de sensores, portanto descreverei apenas o primeiro. </p><br><p>  Portanto, em uma se√ß√£o, instalaremos duas c√©lulas de carga e um m√≥dulo HX711, o diagrama de fia√ß√£o √© o seguinte: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6d2/39b/bef/6d239bbef099b427b0f6127a323a7e69.jpg"></p><br><p>  Da placa ADC ao arduino, existem 5 metros de cabo telef√¥nico de 4 n√∫cleos - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lembramos como as abelhas n√£o gostam de dispositivos GSM na colm√©ia</a> . </p><br><p>  Em geral, nos sensores deixamos "caudas" de 8 cm, limpamos o par tran√ßado e vendemos tudo como na foto acima. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/30d/ab9/f9c/30dab9f9cc87cd43929d9b86fec36f62.jpg" alt="Observe uma polaridade!"></p><br><p>  Repito mais uma vez - observe a polaridade! </p><br><p>  Se o fio preto da c√©lula de carga estiver conectado ao E + da placa HX711, o vermelho passar√° para A + </p><br><p>  Caso contr√°rio, em vez de ganhar peso, voc√™ receber√° uma redu√ß√£o, mas isso n√£o importa, neste caso, basta trocar os fios vermelhos das c√©lulas de carga (A + e A-) na placa ADC. </p><br><p>  Antes de iniciar a carpintaria, coloque cera / parafina em um recipiente adequado para derreter em banho-maria. </p><br><p>  Agora pegamos nossa viga e dividimos em tr√™s segmentos de 100 mm </p><br><p>  Em seguida, marcamos uma ranhura longitudinal de 25 mm de largura e 7-8 mm de profundidade. Usando uma serra e um cinzel, removemos o excesso - um perfil em forma de u deve sair. </p><br><p>  Cera aquecida?  - mergulhamos nossas placas ADC l√° - isso as proteger√° da umidade / n√©voa: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/672/7f1/a576727f1b4385933b640b0dd1ef2a01.jpg" alt="Prote√ß√£o ADC contra umidade"></p><br><p>  Temos tudo em uma base de madeira (√© necess√°rio trat√°-lo com um anti-s√©ptico por decomposi√ß√£o): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/a6b/347/a57a6b34743c1f8b8add453e729fadea.jpg" alt="Assembl√©ia"></p><br><p>  E, finalmente, consertamos os sensores com parafusos: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/94d/e43/541/94de435418f3d001e47b181935612e5f.jpg" alt="Sensor pronto"></p><br><p>  Havia outra op√ß√£o com uma fita isolante azul, mas por raz√µes de humanidade eu n√£o a trago ;-) </p><br><p>  Do lado do Arduino, fazemos o seguinte: </p><br><p>  Limpamos nossos cabos telef√¥nicos, enrolamos os fios coloridos, min√∫sculos. </p><br><p>  Depois disso, soldamos os contatos do quadro como na foto: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a0c/6fc/0fe/a0c6fc0fedd0bc6a1c4f1e6929d5e4bc.jpg" alt="Final"></p><br><p>  √â isso, agora, para a verifica√ß√£o final, coloque os sensores nos setores do c√≠rculo, em cima - um peda√ßo de madeira, zere o controlador (coloque a bateria com a tampa no fotodiodo da caneta-tinteiro). </p><br><p>  Nesse caso, o LED no arduino deve piscar e um SMS de teste deve aparecer. </p><br><p>  Depois, removemos as tampas da fotoc√©lula e vamos coletar √°gua em uma garrafa de pl√°stico de 1,5 litro. <br>  Colocamos a garrafa no compensado e, se j√° passaram v√°rios minutos ap√≥s lig√°-la, colocamos a tampa de volta no fotorresistor (simulando um p√¥r do sol). </p><br><p>  Ap√≥s tr√™s minutos, o LED do arduino acender√° e voc√™ dever√° receber um SMS com um valor de peso de cerca de 1 kg em todas as posi√ß√µes. </p><br><p>  Parab√©ns!  O sistema foi montado com sucesso! </p><br><p>  Se agora fizermos o sistema funcionar novamente, na primeira coluna do peso obteremos zeros. </p><br><p>  Sim, em condi√ß√µes reais, √© desej√°vel orientar o fotorresistor verticalmente para cima. </p><br><p>  Agora vou dar um breve manual sobre o uso de: </p><br><ol><li>  Instale extens√¥metros sob as paredes traseiras das colmeias (sob a frente, substitua uma viga / placa com aproximadamente 30 mm de espessura) </li><li>  Proteja o fotorresistor e coloque a bateria - o LED deve piscar e um SMS de teste com o texto "INICIAL BOOT OK" deve aparecer </li><li>  Posicione a unidade central o mais longe poss√≠vel das colmeias e para que os fios n√£o interfiram ao trabalhar com abelhas. <br>  Todas as noites, ap√≥s o p√¥r do sol, o SMS chega com uma altera√ß√£o de peso por dia e a partir do momento do lan√ßamento. <br>  Quando a tens√£o da bateria atingir 3,5V, o SMS terminar√° com a linha "!!! CHARGE BATTERY !!!" <br>  O tempo de opera√ß√£o de uma bateria com capacidade de 2600mAh √© de cerca de um m√™s. <br>  No caso de substitui√ß√£o da bateria, as altera√ß√µes di√°rias no peso das colmeias n√£o s√£o lembradas. </li></ol><br><p>  O que vem a seguir? </p><br><ol><li>  Para descobrir como colocar tudo isso em um projeto para o github </li><li>  Inicie 3 fam√≠lias de abelhas nas colm√©ias do sistema Palivoda (ou pessoas com chifres) </li><li>  Adicione "p√£ezinhos" - uma medida de umidade, temperatura e o mais importante - uma an√°lise do zumbido das abelhas. </li></ol><br><p>  Vamos ocupar tudo, sinceramente, o apicultor el√©trico Andrey </p><br><p>  PS Para novas publica√ß√µes sobre esse t√≥pico, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">beefree.xyz</a> <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt444326/">https://habr.com/ru/post/pt444326/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt444316/index.html">Cartas de redes sociais: sua privacidade √© suficiente? Dois problemas e sua solu√ß√£o</a></li>
<li><a href="../pt444318/index.html">Hist√≥ria de sucesso do Nginx, ou "Tudo √© poss√≠vel, tente!"</a></li>
<li><a href="../pt444320/index.html">L√°pis ex√≥tico: detectando um segundo som em grafite comum</a></li>
<li><a href="../pt444322/index.html">Seguindo a trilha das calculadoras: SpeedCrunch</a></li>
<li><a href="../pt444324/index.html">Seguindo os passos das calculadoras: SpeedCrunch</a></li>
<li><a href="../pt444328/index.html">O redesenho da interface do usu√°rio costuma ser uma perda de tempo</a></li>
<li><a href="../pt444330/index.html">O CMS sem servidor √© finalmente um concorrente digno do Wordpress</a></li>
<li><a href="../pt444332/index.html">Seguran√ßa da informa√ß√£o e catering: como os gerentes pensam sobre os produtos de TI</a></li>
<li><a href="../pt444336/index.html">Listas de captura r√°pidas: qual √© a diferen√ßa entre links fracos, fortes e n√£o propriet√°rios?</a></li>
<li><a href="../pt444338/index.html">Encapsulamento em Python 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>