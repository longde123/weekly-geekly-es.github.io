<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🍳 👩‍✈️ 😚 Buat ekstensi Azure DevOps 🖐🏻 🧗🏼 🥃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami memiliki proyek dengan proses CI / CD yang disesuaikan. Ketika pengembang menyelesaikan tugas dan menyuntikkan perubahannya ke dalam pengembangan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Buat ekstensi Azure DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/461389/"> Kami memiliki proyek dengan proses CI / CD yang disesuaikan.  Ketika pengembang menyelesaikan tugas dan menyuntikkan perubahannya ke dalam pengembangan \, qa secara otomatis diluncurkan, yang menempatkan versi baru aplikasi pada lingkungan pengujian.  Dalam dunia yang ideal, tester secara otomatis belajar tentang tugas-tugas yang telah diselesaikan, dan tentang lingkungan apa yang digunakan.  Dalam hal ini, alur kerja menjadi kontinu, tidak terputus dan membutuhkan lebih sedikit komunikasi, mengalihkan perhatian dari pekerjaan terkonsentrasi.  Dalam praktiknya, semuanya tidak begitu cerah. <br><br>  Dan suatu pagi, pemimpin tim bertanya kepada saya: "Bisakah Anda membuat hal seperti itu untuk TFS sehingga tag yang terpasang pada build menggantung tag yang ditentukan setelah melewati build ini?" <br><br>  Saya memutuskan untuk mengimplementasikan tugas build \ release saya untuk tugas tersebut.  Selain itu, sumber semua tugas build ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github</a> , dan semua informasi tersedia. <br><br>  Tugas kami menandai warna tugas, yang selesai, tetapi tidak diuji.  Berkat ini, pengembang akan segera melihat jika dia lupa memasang tag yang diinginkan, dan QA segera melihat apa yang perlu diperiksa.  Ini memvisualisasikan status tugas dan mempercepat pekerjaan di proyek. <br><br>  Pada artikel ini saya akan berbicara tentang implementasi logika yang diperlukan, pengemasan dalam ekstensi.  Jadi, jika Anda tertarik tentang cara membuat plugin semacam itu, selamat datang di cat. <br><br>  Untuk yang paling tidak sabar: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github</a> dan ekstensi siap di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pasar</a> . <br><br><img src="https://habrastorage.org/webt/pk/id/hb/pkidhbjiwp_hxtyri2tmrixkgf4.png"><br><a name="habracut"></a><br>  Azure DevOps memiliki kemampuan untuk membuat filter yang memungkinkan Anda untuk mewarnai topeng di papan dengan warna berbeda. <br><br><img src="https://habrastorage.org/webt/eh/nu/lj/ehnuljwjrqsqh862boczyproajc.png"><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ai/z8/pe/aiz8pewcypvkamnobuhpgiavhpo.png"></div><br><br>  Kami tertarik pada tugas yang: <br><br><ul><li>  selesai </li><li>  dituangkan ke lingkungan uji </li><li>  belum diverifikasi QA </li></ul><br>  Untuk item, tag b dan c paling cocok, tetapi secara manual pengaturannya menjijikkan, dan semua orang lupa melakukannya.  Jadi kami akan menulis ekstensi, yang setelah penempatan akan secara otomatis menambahkannya. <br><br>  Jadi, kita perlu langkah custom build \ release untuk mengurangi faktor manusia (pengembang lupa memasang tag) dan untuk membantu QA (Anda dapat segera melihat apa yang perlu diperiksa). <br><br><h4>  Prasyarat </h4><br>  Untuk mengembangkan ekstensi, kita perlu: <br><br><ol><li>  IDE favorit </li><li>  diinstal TypeScript + node.js + npm (sekarang saya telah menginstal versi 3.5.1 \ 12.4 \ 6.9.0) </li><li>  tfx-cli - pustaka untuk kemasan extension'a (npm i -g tfx-cli). </li></ol><br>  Perhatikan keberadaan flag -g <br><br>  Microsoft memiliki beberapa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi yang</a> baik di mana mereka hanya di bagian atas dan memberi tahu cara membuat semacam ekstensi.  Selain itu, dengan cara yang sama ada dok untuk membuat tugas build \ release. <br><br>  Menurut pendapat saya, ada kekurangan dalam kedua artikel dari sudut pandang merinci atau menjelaskan poin-poin tertentu, jadi saya akan mengandalkan mereka, dengan fokus pada poin-poin yang dalam kenyataannya tampak bagi saya tidak begitu jelas. <br><br>  Secara umum, Anda dapat menulis langkah build \ release dalam sejumlah besar bahasa.  Saya akan memberikan contoh pada TypeScript. <br><br><h4>  Mengapa TypeScript? </h4><br>  Versi pertama build step'a ditulis di PowerShell'e, hanya tim kami dan beberapa orang yang mengetahuinya.  Hampir segera, kami dihadapkan dengan fakta bahwa jika Anda mencoba untuk menambahkan tugas ke build yang berjalan pada agen build docker, maka tidak akan ada PowerShell dan tugas itu tidak akan berfungsi.  Selain itu, dari waktu ke waktu, berbagai jenis kesalahan lepas landas dari orang-orang, yang dikaitkan dengan PowerShell kooky.  Oleh karena itu kesimpulan - solusinya harus lintas platform. <br><br><h4>  Struktur proyek </h4><br><pre><code class="plaintext hljs">|--- README.md |--- images |---extension-icon.png |--- TaskFolder (     build\release step'a) |--- vss-extension.json ( )</code> </pre> <br>  Selanjutnya, kita perlu menginstal pustaka untuk implementasi build step'a <br><br><ol><li>  cd TaskFolder </li><li>  npm init </li><li>  npm instal azure-pipeline-task-lib - save &amp;&amp; npm install @ types / node --save-dev &amp;&amp; npm install @ types / q --save-dev </li><li>  tsc --init </li></ol><br><h4>  Perpanjangan pengembangan </h4><br>  Pertama-tama, di dalam TaskFolder, kita perlu membuat file task.json - ini adalah file manifes untuk langkah build itu sendiri.  Ini berisi informasi layanan (versi, pencipta, deskripsi), lingkungan untuk meluncurkan dan konfigurasi semua input, yang akan kita lihat di masa depan pada formulir. <br><br>  Saya mengusulkan untuk mempelajari strukturnya secara lebih rinci dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> . <br>  Dalam kasus kami, akan ada 2 input'a pada formulir - tag yang akan kami tambahkan ke item pekerjaan, dan pilihan jenis pipa (membangun atau melepaskan). <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"inputs"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"pipelineType"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"pickList"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"Specify type of pipeline"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"helpMarkDown"</span></span>: <span class="hljs-string"><span class="hljs-string">"Specify whether task is used for build or release"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"defaultValue"</span></span>: <span class="hljs-string"><span class="hljs-string">"Build"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"options"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"Build"</span></span>: <span class="hljs-string"><span class="hljs-string">"Build"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Release"</span></span>: <span class="hljs-string"><span class="hljs-string">"Release"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"tagToAdd"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tag to add to work items"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"defaultValue"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"required"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"helpMarkDown"</span></span>: <span class="hljs-string"><span class="hljs-string">"Specify a tag that will be added to work items"</span></span> } ]</code> </pre><br>  Berdasarkan nama, dalam kode di bawah ini kita akan merujuk pada nilai dari masing-masing input. <br>  Buat index.ts di TaskFolder dan tulis potongan kode pertama <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tl <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'azure-pipelines-task-lib/task'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipelineType = tl.getInput(<span class="hljs-string"><span class="hljs-string">'pipelineType'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { tl.setResult(tl.TaskResult.Failed, err.message); } } run();</code> </pre><br>  Perlu dicatat bahwa TFS memiliki dokumentasi yang sangat kaya tentang REST API yang ada, tetapi untuk saat ini, yang perlu kita lakukan adalah mendapatkan item-item pekerjaan yang melekat pada build. <br><br>  Instal pustaka untuk eksekusi query yang mudah <br><br><pre> <code class="plaintext hljs">npm install request --save &amp;&amp; npm install request-promise-native --save</code> </pre><br>  Tambahkan ke index.ts <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> request <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"request-promise-native"</span></span>;</code> </pre><br>  Kami mengimplementasikan fungsi, yang dari build saat ini akan mendapatkan item kerja yang dilampirkan <br><br><h4>  Sedikit tentang otorisasi </h4><br>  Untuk mengakses API REST, kita perlu mendapatkan accessToken <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> accessToken = tl.getEndpointAuthorization(<span class="hljs-string"><span class="hljs-string">'SystemVssConnection'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).parameters.AccessToken;</code> </pre><br>  Selanjutnya, setel otorisasi tajuk ke “Bearer $ {accessToken}” <br><br>  Kami kembali menerima item pekerjaan yang terikat pada bangunan. <br><br>  Server Url Azure DevOps dan nama TeamProject dapat diperoleh dari variabel lingkungan sebagai berikut <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> collectionUrl = process.env[<span class="hljs-string"><span class="hljs-string">"SYSTEM_TEAMFOUNDATIONCOLLECTIONURI"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> teamProject = process.env[<span class="hljs-string"><span class="hljs-string">"SYSTEM_TEAMPROJECT"</span></span>];</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWorkItemsFromBuild</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buildId = process.env[<span class="hljs-string"><span class="hljs-string">"BUILD_BUILDID"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> uri = <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${collectionUrl}</span></span></span><span class="hljs-string">/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${teamProject}</span></span></span><span class="hljs-string">/_apis/build/builds/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${buildId}</span></span></span><span class="hljs-string">/workitems`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> options = createGetRequestOptions(uri); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> request.get(options); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result.value; }</code> </pre><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createGetRequestOptions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uri: string</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">uri</span></span>: uri, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">`Bearer </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${accessToken}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-string"><span class="hljs-string">"content-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">json</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> options; }</code> </pre><br>  Sebagai tanggapan terhadap permintaan GET dengan URL <br><br><pre> <code class="plaintext hljs">${collectionUrl}/${teamProject}/_apis/build/builds/${buildId}/workitems</code> </pre> <br>  kita mendapatkan JSON semacam ini <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"count"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"55402"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"59777"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/59777"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"60199"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/60199"</span></span> } ] }</code> </pre><br>  Untuk setiap url, melalui REST API yang sama, Anda bisa mendapatkan data tentang item pekerjaan. <br><br>  Saat ini, metode run kami adalah sebagai berikut. <br><br>  Metode untuk mendapatkan benda kerja dari rilis hampir identik dengan yang sudah dijelaskan. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipelineType = tl.getInput(<span class="hljs-string"><span class="hljs-string">'pipelineType'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> workItemsData = pipelineType === <span class="hljs-string"><span class="hljs-string">"Build"</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromBuild() : <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromRelease(); <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { tl.setResult(tl.TaskResult.Failed, err.message); }</code> </pre><br>  Langkah selanjutnya adalah mendapatkan set tag saat ini untuk masing-masing item pekerjaan yang diterima dan menambahkan yang kami tentukan. <br><br>  Mari kita tambahkan metode run: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipelineType = tl.getInput(<span class="hljs-string"><span class="hljs-string">'pipelineType'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> workItemsData = pipelineType === <span class="hljs-string"><span class="hljs-string">"Build"</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromBuild() : <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getWorkItemsFromRelease(); workItemsData.forEach(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (workItem: any) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> addTagToWorkItem(workItem); }); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { tl.setResult(tl.TaskResult.Failed, err.message); } }</code> </pre> <br>  Mari pertimbangkan untuk menambahkan tag ke item pekerjaan. <br><br>  Pertama, kita perlu mendapatkan tag yang ditunjukkan pada formulir. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tagFromInput = tl.getInput(<span class="hljs-string"><span class="hljs-string">'tagToAdd'</span></span>);</code> </pre><br>  Karena  2 langkah ke belakang kami menerima url ke API dari setiap item pekerjaan, lalu dengan bantuan mereka kami dapat dengan mudah meminta daftar tag saat ini: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> uri = workItem.url + <span class="hljs-string"><span class="hljs-string">"?fields=System.Tags&amp;api-version=2.0"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getOptions = createGetRequestOptions(uri) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> request.get(getOptions);</code> </pre><br>  Sebagai tanggapan, kami mendapatkan JSON ini: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">55402</span></span>, <span class="hljs-attr"><span class="hljs-attr">"rev"</span></span>: <span class="hljs-number"><span class="hljs-number">85</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fields"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"System.Tags"</span></span>: <span class="hljs-string"><span class="hljs-string">"added-to-prod-package; test-tag"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"_links"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"self"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemUpdates"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402/updates"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemRevisions"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402/revisions"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemHistory"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402/history"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"html"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://..../web/wi.aspx?pcguid=e3c978d9-6ea1-406f-987d-5b03e24973a1&amp;id=55402"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"workItemType"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../602fd27d-4e0d-4aec-82a0-dcf55c8eef73/_apis/wit/workItemTypes"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"fields"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"href"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/fields"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://.../_apis/wit/workItems/55402"</span></span> }</code> </pre><br>  Kami mengambil semua tag lama dan menambahkan yang baru ke sana: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentTags = result.fields[<span class="hljs-string"><span class="hljs-string">'System.Tags'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> newTags = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentTags !== <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { newTags = currentTags + <span class="hljs-string"><span class="hljs-string">";"</span></span> + tagFromInput; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { newTags = tagFromInput; }</code> </pre> <br>  Kami mengirim permintaan tambalan ke item api: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> patchOptions = getPatchRequestOptions(uri, newTags); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> request.patch(patchOptions) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPatchRequestOptions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uri: string, newTags: string</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">uri</span></span>: uri, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">"authorization"</span></span>: <span class="hljs-string"><span class="hljs-string">`Bearer </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${accessToken}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-string"><span class="hljs-string">"content-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"application/json-patch+json"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"op"</span></span>: <span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/fields/System.Tags"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: newTags }], <span class="hljs-attr"><span class="hljs-attr">json</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> options }</code> </pre><br><h4>  Perpanjangan perakitan dan pengemasan </h4><br>  Untuk keindahan segala sesuatu yang terjadi, saya mengusulkan untuk menambahkan tsconfig.json ke compilerOptions <pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"outDir"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist"</span></span></code> </pre>  .  Sekarang, jika kita menjalankan perintah <code>tsc</code> di dalam TaskFolder, kita mendapatkan folder dist, di dalamnya akan menjadi index.js, yang akan pergi ke paket akhir. <br><br>  Karena  index.js kami terletak di folder dist dan kemudian kami akan menyalinnya ke paket final juga, kami perlu memperbaiki task.json sedikit: <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"execution"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Node"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"target"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.js"</span></span> } }</code> </pre> <br>  Di vss-extension.json di bagian file, Anda harus secara eksplisit menyatakan apa yang akan disalin ke paket final. <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"files"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/dist"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/dist"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/node_modules"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/node_modules"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/icon.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/icon.png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/task.json"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"packagePath"</span></span>: <span class="hljs-string"><span class="hljs-string">"TaskFolder/task.json"</span></span> } ]</code> </pre><br>  Langkah terakhir - kita perlu mengemas ekstensi kita. <br><br>  Untuk melakukan ini, jalankan perintah: <br><br><pre> <code class="plaintext hljs"> tfx extension create --manifest-globs ./vss-extension.json</code> </pre> <br>  Setelah eksekusi, kami mendapatkan file * .vsix, yang akan diinstal lebih lanjut di TFS. <br><br>  File PS * .vsix pada dasarnya adalah arsip biasa, Anda dapat dengan mudah membukanya melalui 7-zip, misalnya, dan melihat bahwa semua yang Anda butuhkan ada di dalamnya. <br><br><h4>  Tambahkan sedikit keindahan </h4><br>  Jika Anda ingin memiliki gambar ketika Anda memilih langkah pembangunan Anda sambil menambahkannya ke pipa, file ini harus ditempatkan di sebelah task.json dan bernama icon.png.  Anda tidak perlu melakukan perubahan apa pun pada task.json itu sendiri. <br><br>  Anda dapat menambahkan bagian ke vss-extension.json: <br><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"icons"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"images/logo.png"</span></span> }</code> </pre> <br>  Gambar ini akan ditampilkan di galeri ekstensi lokal. <br><br><h4>  Pasang ekstensi </h4><br><ol><li>  Pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tfs_server_url / _gallery / manage</a> </li><li>  Klik Unggah ekstensi </li><li>  Tentukan path atau drag'n'drop untuk melempar file * .vsix yang diterima sebelumnya </li><li>  Setelah verifikasi berlalu, di menu konteks ekstensi, pilih ekstensi tampilan, pada halaman yang terbuka, pilih koleksi di mana Anda ingin menginstalnya </li><li>  Setelah ekstensi ini, Anda dapat mulai menggunakannya. </li></ol><br><h4>  Menggunakan build step'a </h4><br><ol><li>  Buka pipa yang Anda butuhkan </li><li>  Pergi untuk menambahkan build step'a </li><li>  Kami mencari ekstensi <br><br><img src="https://habrastorage.org/webt/rx/c0/zm/rxc0zmf88g5xv535rdwop4xfkkc.png"><br></li><li>  Kami menunjukkan semua pengaturan yang diperlukan <br><br><img src="https://habrastorage.org/webt/hu/iv/cs/huivcsdfsc357aqcx7eiwrtbjiw.png"></li><li>  Nikmati hidup :) </li></ol><br><h4>  Kesimpulan </h4><br>  Pada artikel ini saya menunjukkan cara membuat plug-in untuk Azure DevOps, yang secara otomatis menempatkan tag yang tepat untuk tugas untuk rilis.  Kolega membangunnya ke dalam pipeline, yang berjalan di kedua agen windows dan linux build. <br><br>  Berkat plugin ini, menjadi lebih mudah bagi kami untuk bekerja dengan tugas dan membangun kerja terus menerus pada proyek.  Pengembang tidak lagi terganggu oleh hal-hal asing, dan QA dengan cepat belajar tentang tugas pengujian baru. <br><br>  Sekali lagi, saya ingat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> unduhan: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> <br><br>  Kami menantikan umpan balik dan saran untuk revisi :) <br><br><h5>  PS </h5><br>  Ada juga ide untuk menambahkan kemampuan untuk menghapus tag yang ditentukan ke dalam plugin.  Jika penguji menemukan bug dan Anda harus menggunakan tugas lagi, Anda bisa menyingkirkan tag "Terverifikasi"). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id461389/">https://habr.com/ru/post/id461389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id461373/index.html">GoLand 2019.2: mendukung panggilan fungsi selama debugging, skema warna yang ditingkatkan, Penyempurnaan Postfix kustom</a></li>
<li><a href="../id461379/index.html">Museum DataArt. Modem Robotika AS</a></li>
<li><a href="../id461381/index.html">Anonimitas adalah ilusi. Menurut data dari kumpulan data anonim, Anda dapat mengidentifikasi orang sungguhan</a></li>
<li><a href="../id461385/index.html">Anggur dan tikus: penggunaan resveratrol untuk mengembalikan otot di bawah gravitasi Mars</a></li>
<li><a href="../id461387/index.html">Dari klasik dan modernisme ke fantasi dan steampunk - apa yang dibaca oleh administrator sistem</a></li>
<li><a href="../id461395/index.html">Elemen Fraktal</a></li>
<li><a href="../id461399/index.html">Perintah tak terduga untuk menginisialisasi kelas bawaan dalam JavaScript</a></li>
<li><a href="../id461401/index.html">Apa yang kamu, Event Loop? Atau cara kerja loop acara di browser Chrome</a></li>
<li><a href="../id461403/index.html">Cara menulis musik menggunakan OOP</a></li>
<li><a href="../id461405/index.html">Bagaimana saya mengambil CFA Level 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>