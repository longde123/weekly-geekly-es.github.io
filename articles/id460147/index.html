<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤦🏼 🕷️ 🏕️ Kerangka kerja microservices PHP - Swoft 2.0.3 diterbitkan 🧘🏼 👩‍⚕️ 👩🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apa itu Swoft? 


 Swoft adalah kerangka kerja coroutine microservices PHP yang didasarkan pada ekstensi Swoole . Seperti halnya Go, Swoft memiliki se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kerangka kerja microservices PHP - Swoft 2.0.3 diterbitkan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460147/"><p><img src="https://miro.medium.com/max/700/1*AnQsZ25Q3_7oXi75PWwPAA.jpeg" alt="gambar"></p><br><h2 id="what-is-swoft">  Apa itu Swoft? </h2><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Swoft</a> adalah kerangka kerja coroutine microservices PHP yang didasarkan pada ekstensi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Swoole</a> .  Seperti halnya Go, Swoft memiliki server web coroutine bawaan dan klien coroutine yang umum dan terdapat dalam memori, tidak tergantung pada PHP-FPM tradisional.  Ada operasi Go bahasa yang serupa, mirip dengan anonimasi kerangka kerja Spring Cloud, wadah injeksi ketergantungan global yang kuat, tata kelola layanan komprehensif, AOP fleksibel dan kuat, penerapan spesifikasi PSR standar, dan sebagainya. </p><br><p>  Melalui tiga tahun akumulasi dan eksplorasi arah, Swoft telah menjadikan Swoft Spring Cloud di dunia PHP, yang merupakan pilihan terbaik untuk kerangka kerja kinerja tinggi PHP dan manajemen layanan mikro. </p><br><h2 id="elegant-service-governance">  Tata kelola layanan yang elegan </h2><br><p>  Swoft secara resmi merekomendasikan bahwa pengembang menggunakan pola-pola mesh layanan, seperti kerangka kerja Istio / Utusan, untuk memisahkan tata kelola bisnis dan layanan, tetapi Swoft juga menyediakan satu set komponen layanan-mikro untuk bisnis kecil dan menengah untuk dengan cepat membangun layanan-mikro. </p><a name="habracut"></a><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pendaftaran dan penemuan layanan</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pemecah layanan</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pembatas layanan</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pusat konfigurasi</a> </li></ul><br><h3 id="service-registration-and-discovery">  Pendaftaran dan penemuan layanan </h3><br><p>  Untuk registrasi dan penemuan layanan, komponen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">konsul</a> swoft yang disediakan oleh Swoft diperlukan, jika pihak ketiga lainnya serupa. </p><br><h4 id="registration-and-cancellation-services">  Layanan pendaftaran dan pembatalan </h4><br><p> Dengarkan acara <code>SwooleEvent::START</code> , daftarkan layanan </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Class RegisterServiceListener * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Listener</span></span></span><span class="hljs-comment">(event=SwooleEvent::START) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterServiceListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventHandlerInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Agent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $agent; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> EventInterface $event */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EventInterface $event)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> HttpServer $httpServer */</span></span> $httpServer = $event-&gt;getTarget(); $service = [ <span class="hljs-comment"><span class="hljs-comment">// .... ]; $scheduler = Swoole\Coroutine\Scheduler(); $scheduler-&gt;add(function () use ($service) { // Register $this-&gt;agent-&gt;registerService($service); CLog::info('Swoft http register service success by consul!'); }); $scheduler-&gt;start(); } }</span></span></code> </pre> <br><p>  Dengarkan acara <code>SwooleEvent::SHUTDOWN</code> , batalkan layanan </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Class DeregisterServiceListener * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Listener</span></span></span><span class="hljs-comment">(SwooleEvent::SHUTDOWN) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeregisterServiceListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventHandlerInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Agent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $agent; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> EventInterface $event */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EventInterface $event)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> HttpServer $httpServer */</span></span> $httpServer = $event-&gt;getTarget(); $scheduler = Swoole\Coroutine\Scheduler(); $scheduler-&gt;add(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($httpServer)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;agent-&gt;deregisterService(<span class="hljs-string"><span class="hljs-string">'swoft'</span></span>); }); $scheduler-&gt;start(); } }</code> </pre> <cut><br><h4 id="service-discovery">  Penemuan layanan </h4><br><p>  Menentukan penyedia layanan </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Class RpcProvider * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RpcProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProviderInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Agent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $agent; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Client $client * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@example</span></span></span><span class="hljs-comment"> * [ * 'host:port' * ] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Client $client)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Get health service from consul $services = $this-&gt;agent-&gt;services(); $services = [ ]; return $services; } }</span></span></code> </pre> <cut><br><p>  Penyedia layanan konfigurasi </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; ServiceClient::class, <span class="hljs-string"><span class="hljs-string">'provider'</span></span> =&gt; bean(RpcProvider::class) <span class="hljs-comment"><span class="hljs-comment">// ... ] ];</span></span></code> </pre> <br><h3 id="service-breaker">  Pemecah layanan </h3><br><p>  Swoft menggunakan anotasi <code>@Breaker</code> untuk mendapatkan pukulan, yang dapat meledak pada metode apa pun. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Class BreakerLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BreakerLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Breaker</span></span></span><span class="hljs-comment">(fallback="funcFallback") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> Exception */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Do something throw new Exception('Breaker exception'); } /** * @return string */ public function funcFallback(): string { return 'funcFallback'; } }</span></span></code> </pre> <cut><br><h3 id="service-limit">  Batas layanan </h3><br><p>  Swoft menggunakan anotasi <code>@RateLimiter</code> untuk mengimplementasikan <code>@RateLimiter</code> layanan, yang dapat <code>@RateLimiter</code> pada metode apa pun, tidak hanya pada pengontrol, dan KEY juga mendukung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bahasa</a> ekspresi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">symfony / ekspresi-</a> bahasa. </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Class LimiterController * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Controller</span></span></span><span class="hljs-comment">(prefix="limiter") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LimiterController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RequestMapping</span></span></span><span class="hljs-comment">() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RateLimiter</span></span></span><span class="hljs-comment">(key="request.getUriPath()", fallback="limiterFallback") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestLimiter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $uri = $request-&gt;getUriPath(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'requestLimiter'</span></span>, $uri]; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limiterFallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $uri = $request-&gt;getUriPath(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'limiterFallback'</span></span>, $uri]; } }</code> </pre> <cut><br><h3 id="configuration-center">  Pusat konfigurasi </h3><br><p>  Pusat konfigurasi perlu menggunakan komponen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Swoft-apollo yang</a> disediakan oleh Swoft secara resmi, jika pihak ketiga lainnya serupa. </p><br><h4 id="declare-agent">  Menyatakan agen </h4><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Class AgentCommand * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Command</span></span></span><span class="hljs-comment">("agent") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AgentCommand</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Config */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@CommandMapping</span></span></span><span class="hljs-comment">(name="index") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $namespaces = [ <span class="hljs-string"><span class="hljs-string">'application'</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config-&gt;listen($namespaces, [<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, <span class="hljs-string"><span class="hljs-string">'updateConfigFile'</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Throwable $e) { CLog::error(<span class="hljs-string"><span class="hljs-string">'Config agent fail(%s %s %d)!'</span></span>, $e-&gt;getMessage(), $e-&gt;getFile(), $e-&gt;getLine()); } } } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $data * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ContainerException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ReflectionException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateConfigFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $data)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($data <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $namespace =&gt; $namespaceData) { $configFile = sprintf(<span class="hljs-string"><span class="hljs-string">'@config/%s.php'</span></span>, $namespace); $configKVs = $namespaceData[<span class="hljs-string"><span class="hljs-string">'configurations'</span></span>] ?? <span class="hljs-string"><span class="hljs-string">''</span></span>; $content = <span class="hljs-string"><span class="hljs-string">'&lt;?php return '</span></span> . var_export($configKVs, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) . <span class="hljs-string"><span class="hljs-string">';'</span></span>; Co::writeFile(alias($configFile), $content, FILE_NO_DEFAULT_CONTEXT); CLog::info(<span class="hljs-string"><span class="hljs-string">'Apollo update success！'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> HttpServer $server */</span></span> $server = bean(<span class="hljs-string"><span class="hljs-string">'httpServer'</span></span>); $server-&gt;restart(); } } }</code> </pre> <cut><br><h4 id="start-agent">  Mulai agen </h4><br><p>  Agen hanya perlu dijalankan sebelum layanan (Http / RPC / Websocket) dimulai. </p><br><pre> <code class="plaintext hljs">php bin/swoft agent:index</code> </pre> <br><h2 id="resource">  Sumberdaya </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Github</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Situs web</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">swoft-cloud / komunitas</a> </li></ul><cut></cut></cut></cut></cut></cut></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id460147/">https://habr.com/ru/post/id460147/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id460135/index.html">Minggu Keamanan 29: Zoom, Keamanan, dan Kerentanan Drama</a></li>
<li><a href="../id460137/index.html">Ulasan Fujitsu LIFEBOOK U939X: Ringan dan Kinerja 2-in-1</a></li>
<li><a href="../id460139/index.html">Programming Championship: tugas parsing untuk pengembang front-end</a></li>
<li><a href="../id460141/index.html">Bukan bahasa pemrograman lain. Bagian 2: Logika Representasi</a></li>
<li><a href="../id460143/index.html">Modul dis Python dan konvolusi konstanta</a></li>
<li><a href="../id460149/index.html">Pengetikan yang benar: aspek kode bersih yang diremehkan</a></li>
<li><a href="../id460151/index.html">Desain berorientasi model. Motor DC Brushless</a></li>
<li><a href="../id460153/index.html">Petualangan tanda tangan elektronik di Rusia</a></li>
<li><a href="../id460155/index.html">Redux ReactiveX</a></li>
<li><a href="../id460157/index.html">Bagaimana jawaban "benar" dari responden dapat mengubah hasil survei tanpa bisa dikenali</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>