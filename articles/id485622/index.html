<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™‹ğŸ» ğŸ§¡ ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ Alat cadangan PostgreSQL. Andrey Salnikov (Data Egret) ğŸ˜¢ ğŸ‘² ğŸ…ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya menyarankan Anda membaca dekripsi laporan oleh Andrey Salnikov dari Data Egret "Alat pembuatan cadangan PostgreSQL" . Pada akhirnya, tabel ringka...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Alat cadangan PostgreSQL. Andrey Salnikov (Data Egret)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485622/"><p>  <strong>Saya menyarankan Anda membaca dekripsi laporan oleh Andrey Salnikov dari Data Egret "Alat pembuatan cadangan PostgreSQL"</strong> <strong>.</strong>  <strong>Pada akhirnya, tabel ringkasan alat yang diperbarui</strong> </p><br><p>  Pembicaraan ini adalah tentang alat cadangan PostgreSQL yang tersedia.  Cadangan logis, cadangan biner, alat cadangan internal, dan alat pihak ketiga.  Apakah cadangan tambahan diperlukan saat mereka benar-benar dapat membantu.  Mari kita lihat kapan dan alat mana yang lebih tepat untuk digunakan.  Apa cara terbaik untuk mengotomatiskan proses pencadangan dan memverifikasi integritas pencadangan?  Lihatlah alat-alat seperti <a href="https://www.postgresql.org/docs/10/app-pgdump.html" rel="nofollow">pg_dump</a> , <a href="https://www.postgresql.org/docs/10/app-pgbasebackup.html" rel="nofollow">pg_basebackup</a> , <a href="https://www.2ndquadrant.com/en/resources/barman/" rel="nofollow">barman</a> , <a href="https://github.com/wal-e/wal-e" rel="nofollow">wal-e</a> , <a href="https://github.com/wal-g/wal-g" rel="nofollow">wal-g</a> , <a href="https://pgbackrest.org/" rel="nofollow">pgbackrest</a> , <a href="https://www.enterprisedb.com/enterprise-postgres/edb-postgres-backup-and-recovery-tool" rel="nofollow">BART,</a> dan <a href="https://postgrespro.ru/products/extensions/pg_probackup" rel="nofollow">pg_probackup</a> . </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Us6cHVNA4vk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><p>  Nama saya Andrey Salnikov, saya adalah karyawan Data Egret dan laporan ini akan dikhususkan untuk alat untuk membuat cadangan di PostgreSQL. </p><br><p><img src="https://habrastorage.org/webt/qr/pa/mu/qrpamu1psbed1aonvt1shrrpedk.png"></p><br><p>  Pertama tentang siapa kita, perusahaan saya.  Aktivitas utama kami: kami bekerja sebagai administrator jarak jauh dan kami memiliki sejumlah besar klien.  Ada basis besar, ada banyak basis kecil, ada semua jenis campuran ketika satu basis besar atau sekelompok kecil.  Kami juga menyediakan layanan konsultasi dan audit - ini adalah kasus jika orang tidak membutuhkan dukungan terus-menerus, tetapi beberapa jenis keahlian diperlukan. <br>  Karena PostgreSQL adalah produk sumber terbuka, kami secara alami akan berpartisipasi dalam semua jenis konferensi dalam hal berbagi pengalaman kami dan membantu PostgreSQL dengan segala cara yang mungkin.  Karena database PostgreSQL sangat bagus.  Dan ternyata kami melihat cukup banyak profil beban: beban DWH, dan beban WEB, serta campuran campuran.  Dan basisnya jatuh dengan cara yang berbeda.  Banyak pengalaman. </p><br><p><img src="https://habrastorage.org/webt/a0/vc/b_/a0vcb_l47qx4vvzh1hxnjcqesz4.png"></p><br><p>  Ini adalah bagian paling menarik dari laporan ini.  Mengapa cadangan diperlukan?  Bahkan, mereka dibutuhkan agar kita bisa beristirahat dengan tenang, sehingga kita bisa tidur dengan tenang, sehingga kita bisa nongkrong di konser dengan tenang.  Sekarang, ini adalah tujuan utama dari sudut pandang pangkalan mengapa cadangan diperlukan.  Sehingga semuanya tenang dalam hidup kita.  Karena jika ada cadangan yang diverifikasi, maka kita bisa melakukan semua ini.  Tapi apa yang terjadi dengan pangkalan itu adalah yang kesepuluh. </p><br><p><img src="https://habrastorage.org/webt/dj/_9/aj/dj_9ajbympb3eslx0bl1phlp6te.png"></p><br><p>  Apa kisaran alat untuk membuat cadangan di dunia PostgreSQL?  Ini adalah alat pemulihan pg_dump, pg_dumpall, atau pg_restore bawaan.  Ini adalah satu-satunya alat yang memungkinkan Anda untuk melakukan pencadangan logis.  Artinya, ia bisa pg_dump Anda, baik dalam SQL to dump, dan dalam format biner kecil untuk membuang data.  Dan itu keluar dari kotak dengan PostgreSQL. <br>  Alat berikutnya (pg_basebackup) untuk membuat cadangan, yang juga keluar dari kotak dan selanjutnya dimulai dengan alat ini, dan selanjutnya mereka semua akan menjadi alat untuk membuat cadangan basis data biner.  Pg_basebackup juga merupakan alat yang keluar dari kotak, yang memungkinkan kita untuk mengunggah repositori postgreSQL dan mengambil salinan biner dari database, menembak database yang persisten dan, jika kita ingin dapat mengarsipkan waktu, kita dapat mengonfigurasi PostgreSQL untuk membuangnya ke beberapa jenis disk.  Ini adalah alat dasar.  Mereka baik, mereka melakukan, mereka melakukan fungsi mereka di 5, tetapi mereka tidak nyaman dalam hal manajemen dan semacam massa.  Ketika Anda memiliki 20 database, Anda harus melakukan ini sendiri skrip. <br>  Dua alat berikutnya adalah spesifik, alat cloud murni - wal-e dan wal-g.  Orang yang sama mengembangkannya, tetapi pengembangan wal-e telah berakhir, dan mereka beralih ke wal-g.  Alat-alat ini diarahkan terutama untuk AWS dan untuk penyimpanan di S3.  Wal-e masih dapat bekerja dengan Google Cloud, dengan Azure dan dengan sistem disk, Anda cukup menentukan beberapa jenis drive jarak jauh.  Wal-g hanya bekerja dengan AWS, hanya dengan S3.  Nah, atau antarmuka serupa lainnya dengan S3.  Kami menggunakannya, hal-hal baik.  Saya selanjutnya akan membongkar setiap alat secara rinci. </p><br><p><img src="https://habrastorage.org/webt/h_/cs/my/h_csmywtln65xfdmoryutenb6-g.png"></p><br><p>  Dan pada bundel alat berikutnya, ini adalah alat yang bergantung pada pg_basebackup atau menggunakannya secara langsung, atau entah bagaimana mengimplementasikan fungsinya.  Mereka semua ditulis oleh pengembang yang berkomitmen pada PostgreSQL utama dan memiliki komersial garpu sendiri, yang mempromosikan dalam lingkaran pengaruh mereka. <br>  Alat pelayan bar paling populer, yang kami gunakan cukup luas di negara ini.  Ini pada dasarnya adalah pembungkus Python di sekitar pg_basebackup.  Itu juga dapat bekerja pada protokol ssh.  Alat pgbackrest yang sangat menarik dan sangat menjanjikan.  PostgreSQL terlibat dalam pengembangan dan secara aktif berkomitmen untuk itu.  Awalnya ditulis dengan Python.  Sekarang versi yang digunakan - ditulis dalam C untuk mempercepat dan kemungkinan penghapusan cadangan secara paralel. <br>  Pg_probackup adalah utilitas dari kolega Rusia kami di PostgreSQL Professional yang memungkinkan Anda untuk membuat cadangan tambahan, yang ukurannya cukup kecil. <br>  Dan utilitas terbaru adalah cadangan dan memulihkan alat (BART) dari EnterpriseDB.  Dia tidak begitu populer dengan kita.  Ini terutama untuk CentOS dan Red Hat.  Untuk Ubuntu, dengan dia, menurut saya, sulit.  Dan karena rendahnya popularitas BART dengan kami, itu (BART) hampir tidak ditemukan di mana pun di instalasi. </p><br><p><img src="https://habrastorage.org/webt/ow/si/t8/owsit8h0n3welzlugm95_glqdds.png"></p><br><p>  Saya akan mencoba memecah alat-alat ini menjadi beberapa hal yang penting. </p><br><ul><li><p>  Pertama, penting bagi kami bagaimana kami akan menyimpannya, di drive mana dan pada layanan apa.  Dan ada daftar karakteristik yang akan kita lalui. </p><br></li><li><p>  Pemisahan data berikut, di sini saya membagi apa yang kami bisa, ketika menghapus cadangan atau memulihkan cadangan, untuk memotong beberapa bagian dari seluruh server basis data (server) dan bekerja dengannya sebagai basis data integral dan tidak terpisahkan. </p><br></li><li><p>  Seberapa banyak mereka mendukung berbagai versi database. </p><br></li><li><p>  Mode operasi apa yang mereka miliki dalam hal paralelisme, dalam hal semacam otomatisasi dan sejenisnya. </p><br></li><li><p>  Dan kemudahan servis adalah seberapa banyak kita dapat memisahkan mereka ke dalam layanan terpisah, yang dengan sendirinya akan melalui database dan menghapus cadangan sesuai dengan beberapa jadwal. </p><br></li><li><p>  Validasi - Saya ingin cadangan diperiksa dalam rangka memastikan bahwa kami dapat memulihkannya dan kami akan memiliki basis yang normal dan tidak terputus. </p><br><p>  Dan sekarang, mari kita melihat enam poin besar ini secara lebih rinci.  Dan saya akan menandai di sana instrumen apa yang akan memberi kita. </p><br></li></ul><br><p><img src="https://habrastorage.org/webt/s5/v0/h0/s5v0h0p62rsqz1r86v2upwibj5c.png"></p><br><p>  Dengan penyimpanan, mereka dapat menyimpan semua yang ada di sistem file, yaitu, kita dapat memasang kembali disk kita ke OS dan menyalin cadangan di sana.  Semua alat memungkinkan Anda melakukan ini.  Drive jaringan yang terpasang pada dasarnya sama, karena diperoleh di sistem file lokal kami. <br>  Dalam AWS (S3), tiga alat dapat bekerja untuk kita - wal-g, wal-e, pgbackrest.  Karena di antara utilitas tersebut: bartender dan sebagainya, itu adalah satu-satunya yang dapat bekerja dengan AWS (S3). <br>  Dengan Azure, hanya wal-e.  Google Cloud hanya wal-e. </p><br><p><img src="https://habrastorage.org/webt/gw/sc/qd/gwscqdmvmqlbe1r1e545ipkemzs.png"></p><br><ul><li>  Hanya pg_dump, pg_dumpall memberi kami salinan data yang logis.  Perbedaan di antara mereka adalah bahwa pg_dumpall memproses seluruh instance database (server), di pg_dump Anda dapat menentukan database tertentu pada instance dan bekerja dengannya. </li><li>  Salinan biner adalah sisanya. </li><li>  Faktor penting selama penyimpanan adalah bahwa jika kita dibatasi dalam beberapa cara oleh sumber daya disk, maka situasi sering muncul ketika kita membagi database menjadi ruang tabel yang berbeda.  Ini juga berlaku untuk server besi, karena Anda tidak ingin menderita RAID.  Ini berlaku untuk cloud, karena karena ada batasan tertentu, terutama ketika Anda membawa mobil dengan disk NVME dan berapa banyak yang terhubung, begitu banyak yang terhubung.  Mesin virtual AWS meluas, tetapi dengan drive EBS.  Dan ketika mengembalikan data, penting bagi kami bahwa kami dapat mendistribusikan kembali ruang tabel ini, menetapkannya di sepanjang jalur baru dan ke disk baru.  Dan sekarang properti bagus ini hadir di wal-e.  Di wal-g mereka masih belum tahu bagaimana cara menggunakannya.  Pg_probackup dapat bekerja dengannya.  Energik, basebackup, pgbackrest.  Hal ini cukup penting, terutama ketika Anda memiliki basis data 8-10 TB.  Di antara klien produksi kami, hampir semua database ini diciutkan menjadi ruang tabel. </li></ul><br><p><img src="https://habrastorage.org/webt/qd/-v/sk/qd-vskcocq-r2tv0duopeyxtvke.png"></p><br><p>  Sekarang tentang ukuran apa yang bisa kita miliki cadangan.  Ini semua akan terjadi dalam konteks cadangan biner.  Jelaslah bahwa cadangan biner adalah seberapa besar bobot database dengan kami, begitu banyak yang kami salin.  Beratnya 8 TB, kami menyalin 8 TB.  1 MB beratnya 1 MB, disalin.  Bagaimana cara menghemat ruang saat kita menginginkan rantai cadangan yang panjang?  Untuk melakukan ini, datang dengan beberapa alat.  Yaitu, database menyimpan data dalam file-nya.  Jika kami memiliki basis data arsip yang panjang, maka biasanya kami mengubah sebagian kecil dari file-file ini.  Dan untuk ini, mereka datang dengan cadangan diferensial. </p><br><p>  Cadangan diferensial apa itu?  Kami melihat file apa yang telah berubah dan hanya menyalin ke penyimpanan, tempat menyimpan cadangan.  Dan kami akan menautkan semua file lain dengan hardlink ke database ini.  Ternyata dengan demikian kami menghemat ruang.  Dan pada saat yang sama, kita dapat dengan aman menghapus backup database lama tanpa mengacaukan yang lebih baru. </p><br><p>  Hal ini bagus, tetapi kami memutuskan untuk terus maju dan membuat cadangan tambahan.  Cadangan tambahan terdiri dari dua jenis. </p><br><p>  Yang pertama adalah di tingkat file.  Ini berbeda dari cadangan diferensial hanya dalam cadangan diferensial berfokus pada cadangan penuh dari database Anda, dan dalam kaitannya dengan cadangan lengkap itu menyalin file dan salinan berbeda.  Cadangan tambahan dapat fokus pada cadangan diferensial, hanya menyalin file yang diubah yang telah berubah dibandingkan dengan cadangan diferensial.  Untuk tambahan, Anda akan membutuhkan seluruh rantai cadangan.  Yaitu, cadangan utama -&gt; cadangan inkremental pertama (akan selalu berbeda) -&gt; lalu semua cadangan inkremental.  Cadangan diferensial selalu berfokus pada basis data cadangan lengkap.  Inkremental dapat fokus pada jenis cadangan lainnya. <br>  Pg_probackup dan BART menggunakan cara membuat cadangan inkremental demi blok.  Karena kita tidak bisa mengubah seluruh file, tetapi blok data.  Dan utilitas ini berjalan melalui file wal dan memilih blok yang benar-benar telah berubah dari Anda.  Blok cadangan ini disalin ke cadangan.  Untuk memulihkan dengan cadangan tambahan seperti itu, Anda juga akan memerlukan salinan lengkap dari database dan ditambah lagi Anda masih perlu menyimpan potongan-potongan tambahan yang diketik dari wal.  Ini membebankan beberapa batasan utilitas, karena mereka harus dijalankan melalui file wal.  PostgreSQL Professional juga memiliki lapisan di atas struktur file database.  Karena itu, mereka cukup cepat mencari blok ini.  Cadangan tambahan seperti itu sangat kecil.  Jika Anda memiliki% perubahan basis data kecil dan karena fakta bahwa cukup banyak informasi teknis ditulis ke file wal, utilitas ini membuat cadangan puluhan kilobyte data selama 1 wal. </p><br><p><img src="https://habrastorage.org/webt/s3/d9/ca/s3d9ca1otjtkwql3_qakv67am7c.png"></p><br><p>  Berbagi data lebih lanjut.  Ini menyiratkan bahwa jika kita perlu membuat cadangan bukan segalanya.  Atau mengembalikan tidak semuanya.  Ini hanya mungkin dengan cadangan logis, dan ini memungkinkan kami untuk melakukan hanya pg_dump.  Utilitas menyediakan fungsionalitas yang cukup luas.  Pg_dump dapat memungkinkan Anda untuk membuang struktur database jika Anda perlu.  Anda dapat secara khusus membuang satu tabel atau Anda dapat mengecualikan satu tabel dari dump atau membuang daftar tabel, mengecualikan daftar.  Fungsionalitasnya cukup luas dalam hal ini.  Yang minus untuk ini adalah ketika memulihkan dari dump seperti itu, jika Anda memiliki database besar, Anda harus menghabiskan banyak waktu untuk memulihkannya, karena semua ini perlu dimainkan pada instance murni PostgreSQL. <br>  Utilitas ini sangat nyaman untuk menggunakan case ketika kita melebih-lebihkan kekuatan kita dan tidak membuat banyak database kecil.  Kita bisa menggabungkannya menjadi satu contoh.  Kita bisa melihatnya dengan cara ini jika kita sekarang mengevaluasi kekuatan kita, basis data kita bengkak atau kita mengubah arsitektur di sana dari satu monolit ke layanan satu dan melihat data.  Pg_dump dalam hal ini adalah satu-satunya hal yang memungkinkan Anda untuk melakukan ini tanpa rasa sakit. </p><br><p>  Anda juga dapat mengembalikan satu basis data dan pgbackrest terdaftar di sini.  Dia memiliki chip seperti itu, sehingga kita dapat mengindikasikan bahwa kita hanya membutuhkan satu database dari cadangan biner.  Apa yang dia lakukan  Ini mengembalikan database default dari cadangan, ini adalah template dan postgres dan database yang kami tentukan.  Semua database lain, itu me-reset file dan membuatnya panjang nol.  Artinya, PostgreSQL memiliki struktur transparan untuk menyimpan basis data dalam file, di sana Anda dapat, pada tingkat ini, seolah-olah, untuk mengurangi database yang dipulihkan.  Misalkan kita perlu menemukan data mendesak apa dari biner, kami tidak ingin menaikkan basis 10 TB, kami memiliki dua basis di sana, dan kami menaikkannya, yang memungkinkan total 5 TB.  Dalam hal ini, tentu saja, konsistensi dilanggar, tetapi untuk beberapa solusi cepat, ketika Anda perlu segera mengangkat data nosebore dari database besar, yang ada beberapa, ini adalah fitur yang sangat bagus.  Tetapi sebagai database cadangan lengkap tidak harus dipertimbangkan selama pemulihan.  Artinya, ini untuk pekerjaan darurat. </p><br><p><img src="https://habrastorage.org/webt/bq/pf/aj/bqpfaj0wvrtn1atsq0yj1j4x7de.png"></p><br><p>  Bagaimana cara kerjanya dengan banyak versi database?  Di sini juga, semuanya cukup menarik.  Pg_dump sangat bagus karena kita tidak terikat dengan versi database yang akan dipulihkan.  Ada mode teks biasa, dan itu hanya SQL murni, yang menggambarkan seluruh struktur basis data, semua data.  Pada prinsipnya, Anda dapat memulihkan dari mana pun Anda inginkan, di MySQL, di MSSQL, di Oracle dengan beberapa suntingan ke dump ini.  Di antara versi utama PostgreSQL, kesedihan ini juga cukup mudah digunakan. <br>  Multi-versi, apa yang saya maksud dengan ini?  Ini adalah sejauh mana utilitas dapat memproses versi database yang berbeda dan bekerja secara bersamaan dengan PostgreSQL 9.6, 10, 11. Semuanya kecuali yang built-in dari pg_dump dan pg_basebackup, karena mereka terikat dengan versi spesifik yang mereka bawa.  Sisanya berfokus pada utilitas ini.  Mereka dapat ditunjukkan di mana pg_basebackup, pg_dump dari berbagai versi berada.  Mereka masing-masing dengan versi PostgreSQL memilih utilitas terbaru untuk menghapus cadangan. <br>  Semua utilitas kecuali pg_dump cocok untuk membuat replika dan server siaga, karena ini adalah cadangan logis.  Menggunakan salah satu dari utilitas ini, Anda dapat memulihkan server dan menyambungkan ke wizard agar berfungsi sebagai replika server ini. </p><br><p><img src="https://habrastorage.org/webt/rk/mr/jp/rkmrjpvyme8ifuybv7jvpkqd0r4.png"></p><br><p>  Bagaimana cadangan dapat dihapus secara umum, mode apa yang ada untuk menghapus cadangan.  Anda cukup menyalin file menggunakan alat OS standar: melalui protokol ssh (rsync, scp) dan mungkin beberapa utilitas lain.  Mengapa ada peluang seperti itu, karena memungkinkan Anda untuk memparalelkan penyalinan.  Pgbackrest hanya berfungsi seperti ini, bartender dapat bekerja seperti itu, dan dapat bekerja menggunakan protokol PostgreSQL. <br>  Protokol PostgreSQL - ketika utilitas cadangan terhubung ke PostgreSQL dan menarik semua file dan arsip log yang muncul selama proses pencadangan menggunakan protokol replikasi.  Semua orang dan bartender dapat melakukannya. <br>  Pada dasarnya, semuanya dapat melakukan backup dari replika, itu tergantung pada versi PostgreSQL.  Dengan PostgreSQL 10 dan 11, kita dapat menghapus cadangan dari replika.  Tetapi saya tidak merekomendasikan ini, secara umum, tidak ada perusahaan kami yang akan merekomendasikannya.  Karena ada situasi ketika mereka melewatkan pemantauan, mereka mengambil cadangan dari replika selama sebulan, yang jatuh dari server master dan tidak relevan.  Artinya, cadangan dalam hal apa pun harus selalu dihapus dari server master.  Hanya dalam hal ini Anda akan yakin bahwa Anda memiliki basis data cadangan yang benar-benar terkini. <br>  Cadangan multithreading - semua orang dapat melakukan ini, karena semuanya karena alasan yang berbeda, seseorang melalui protokol ssh, seseorang diimplementasikan pada tingkat salinan basis data.  Kecuali pg_basebackup dan BART, karena operasi BART hanya pada pg_basebackup ketika cadangan dihapus dan sayangnya, single-threaded dan tidak akan multi-threaded. </p><br><p><img src="https://habrastorage.org/webt/72/4x/j0/724xj0dcehoennfciyo2uzucisq.png"></p><br><p>  Contoh multithreading.  Saya sedang memulihkan database 8 TB.  Ketika Anda fokus pada memilih sistem untuk menghapus cadangan, maka ketahuilah bahwa wal-e ditulis dengan Python, wal-g ditulis dalam Golang.  Saya harus mengembalikan basis 8 TB.  Wal-e berlari ke keterbatasan Python dan menarik saya dengan AWS dengan kecepatan 600 Mbps.  Ketika saya beralih ke wal-g, dia memiliki situasi bahwa dia tidak dapat bekerja dengan wal-e backup, tetapi dia dapat menarik file wal.  Oleh karena itu, gambar tengah ini di sini adalah pemulihan database.  Kemudian digulung wal, yang ada di S3 dan dikembalikan ke titik waktu tertentu.  Wal-e berlari ke dalam batasan Python dan konkurensi dalam Python, itu sangat kondisional.  Wal-g berlari ke antarmuka S3, yaitu, seberapa cepat S3 dapat memberikan setiap saat, sehingga sangat cepat.  Rata-rata, itu 2 Gb / s, yang cukup baik.  Yaitu, dengan wal-e, satu jam perubahan ke basis data diterima dalam 45 menit cadangan bergulir.  Dengan wal-g, ternyata mereka menggulung satu jam di suatu tempat di database selama sekitar 5 menit. </p><br><p><img src="https://habrastorage.org/webt/rj/nk/fa/rjnkfaa9ld-am4dazwrasjqwfbk.png"></p><br><p>  Mode operasi, apa yang menarik di sini di sistem cadangan. </p><br><ul><li>  Pemulihan dalam waktu ke titik tertentu.  Jika kami telah mengarsipkan log dan menyalinnya, kami dapat memulihkannya.  Ini memungkinkan Anda melakukan sistem cadangan, seperti faktor standar.  Yang utama adalah kami menyimpan file wal di suatu tempat.  Dumps, tentu saja, tidak tahu caranya, karena mereka sedikit tentang sesuatu yang lain. </li><li>  Menyesuaikan beban pada jaringan adalah hal yang cukup penting, karena seperti yang saya katakan, diinginkan untuk menghapus dump dari server master, maka Anda menjamin diri Anda bahwa Anda benar-benar mendapatkan cadangan yang sebenarnya.  Yah, kadang-kadang terjadi bahwa server sangat dimuat sehingga cukup sulit untuk masuk ke sana.  Kami memiliki beberapa pelanggan menempel antarmuka jaringan yang terpisah.  Terkadang ada waktu buka minimal yang dilakukan.  Ini juga bagus ketika kita dapat menentukan beban di jaringan saat membuat cadangan.  Ini memungkinkan Anda melakukan pg_basebackup, bartender dan BART, wal-e, wal-g. </li><li>  Kompresi dengan cepat.  Ini adalah pertanyaan tentang seberapa banyak kita akan mengirimkan melalui jaringan.  Jika kita dapat mengompres file sebelum mengirimnya ke repositori, maka ini bagus.  Dan hampir semua orang bisa melakukannya, di sini.  Yang utama adalah menunjukkan level kompresi di sana. </li></ul><br><p><img src="https://habrastorage.org/webt/lv/pe/vd/lvpevdlrpqrg-9hypasdcs9-dse.png"></p><br><p>  Kemudahan Servis, apa yang menarik di sini untuk sistem cadangan? </p><br><ul><li>   CLI â€”    ,               ,     ,        ,      .    ,       CLI,     ,     ,     .       ,       ,      . </li><li>         barman, pgbackrest  BART,        .   ,        20-30  ,    ,    ,          ,           backup-           . ,  ,     . </li><li>    â€“          ,     ,       backup-,   ,    backup-.           ,     -   .         .       . </li><li>   â€“                 backup-,   ,  -   .     ,    ,     .  ,   , ,      ,       wal ,   ,        .   wal-e, wal-g,      ,    backup      - .  7 backup    . </li></ul><br><p><img src="https://habrastorage.org/webt/zj/r0/es/zjr0esauswimuw1itkqosshmyla.png"></p><br><p>   backup.  ,       backup,    backup  ,    ,        .  ,       .     ,   .   .    stage   .   ,       ,    backup .   CLI  ,           backup    . </p><br><p>     ,      ,  .         ,    backup .   ,     .  ,    .  ,    .   .   checksum  PostgreSQL.      ,      checksum  PostgreSQL.       checksum,   . </p><br><p>  pgbackrest  pg_probackup    backup  ,     checksum.          checksum. </p><br><p>  ,    backup,      checksum , ,   checksum   .     . </p><br><p><img src="https://habrastorage.org/webt/mj/_e/di/mj_edibaxks4v2_4-t5kanbxghe.png"></p><br><p>  : </p><br><ul><li> <a href="https://www.postgresql.org/docs/10/static/app-pgdump.html" rel="nofollow">https://www.postgresql.org/docs/10/static/app-pgdump.html</a> </li><li> <a href="https://www.postgresql.org/docs/10/static/app-pgbasebackup.html" rel="nofollow">https://www.postgresql.org/docs/10/static/app-pgbasebackup.html</a> </li><li> <a href="https://www.2ndquadrant.com/en/resources/barman/" rel="nofollow">https://www.2ndquadrant.com/en/resources/barman/</a> </li><li> <a href="https://github.com/wal-e/wal-e" rel="nofollow">https://github.com/wal-e/wal-e</a> </li><li> <a href="https://github.com/wal-g/wal-g" rel="nofollow">https://github.com/wal-g/wal-g</a> </li><li> <a href="https://pgbackrest.org/" rel="nofollow">https://pgbackrest.org/</a> </li><li> <a href="https://www.enterprisedb.com/products/edb-postgres-platform/edb-backup-and-recovery-tool" rel="nofollow">https://www.enterprisedb.com/products/edb-postgres-platform/edb-backup-and-recovery-tool</a> </li><li> <a href="https://postgrespro.ru/products/extensions/pg_probackup" rel="nofollow">https://postgrespro.ru/products/extensions/pg_probackup</a> </li></ul><br><p>      .   ,     .       ,     . </p><br><p><img src="https://habrastorage.org/webt/tt/qn/i7/ttqni7mc49sw-n6bww9bpi1gese.png"></p><br><p> :  ,  backup      ,     ,   ,   .       ,      ,       backup.    ,  ,  -    , ,   ,  ,    ,     ,   .    -    ? </p><br><p> :       ,        ,       .     .   .  -   , , backup   ,   ,       ,      .          ,         .    ,  , , ,  ,   ,     /     .  ,       ,       .      ,     .   ,      .       ,        . </p><br><p> :    , ,    ?       . </p><br><p> :        .         4 .       .     .      backup.       .    ,     . </p><br><p> :         ? </p><br><p> :    .       .   wal-e, wal-g, pgbackrest.    borman, pg_dump,   basebackup.    ,      ,       .   . </p><br><p> :  ,    -     PostgreSQL,   , , postgis  - -? </p><br><p> :    ,      backup   ,      .  checksum  ,  PostgreSQL   checksum,   ,       .   postgis,     -      . Pg_dump      ,    ,   , SQL .        SQL .     . , ,         .    dump,       . </p><br><p> :  ,     .   ,          -  ? </p><br><p> :     .    dump  ,         .    ,    â€“    ,  ,  - ,  ,     .      ,    . ,   -  ,      . </p><br><p> :   ,     ,   ,  bloat   ? </p><br><p> : . </p><br><p> :    â€”  ,     -    . , Symantec, Veritas Backup Exec  .      PostgreSQL? </p><br><p> : ,      ,      . PostgreSQL     ,    pg_start_backup.  ,  .     . </p><br><p> :  ,  -  Symantec, Veritas Backup Exec      . </p><br><p> :   . </p><br><p> : , ,      .   checksum    - ,   , - ? </p><br><p> :    â€”            .        stage ,    .    stage    .       .             .    ,      -,        .     .      . </p><br><p> :   ,      WAL ,   S3.        wal-e, wal-g    - awscli  .      ? </p><br><p>  (  ):   wal-g.     wal-g.      40     wal-g .      .  ,   .   , prefetch,   wal  ,    . ,      â€”  ,       wal.    wal   ,   page cache   ,  ,      wal,       ,        .     ,   . </p><br><p>  :     .   ,     PostgreSQL â€”   -&gt; /dev/null,  ,      .        ,          .       smoke .   <a href="https://postgrespro.ru/docs/postgresql/10/amcheck" rel="nofollow">amcheck</a> ,      .        ,        ,     ,       . </p><br><p> :       10  .       .            .    .       wal  â€”      .      ? </p><br><p> :        .      .      .         ,        . </p><br><p> :          ,       pg_dump,        . ? </p><br><p> : -     . ,   . </p><br><p> :   ,      ,    - ? </p><br><p> : pg_dump   ,    . </p><br><p> :     pg_dump,    ,   ,   ,         ,    . </p><br><p> :         ,       -,    . </p><br><p> :   ,   . </p><br><p> :        ,       -  . </p><br><p> :    .     .      .      . ,     ,    .   . Pg_dump  ,  - ,  exit_code  .   ,       , .   ,      . </p><br><p> PS â„–1        pg_dump, pg_basebackup. </p><br><div class="scrollable-table"><table><thead><tr><th></th><th> barman </th><th> wal-e </th><th> wal-g </th><th> pg_probackup </th><th> pgbackrest </th><th> BART </th></tr></thead><tbody><tr><td> ssh (rsync, scp) </td><td> + </td><td></td><td></td><td></td><td> + </td><td></td></tr><tr><td>     </td><td> + </td><td> + </td><td> + </td><td> + </td><td> + </td><td> + </td></tr><tr><td> S3 </td><td></td><td> + </td><td> + </td><td></td><td> + </td><td></td></tr><tr><td> Azure </td><td></td><td> + </td><td> + </td><td></td><td></td><td></td></tr><tr><td> Google Cloud </td><td></td><td> + </td><td> + </td><td></td><td></td><td></td></tr><tr><td>    </td><td> + </td><td> + </td><td> + </td><td> + </td><td> + </td><td></td></tr><tr><td>   </td><td></td><td></td><td> + </td><td></td><td> + </td><td></td></tr><tr><td>   </td><td></td><td></td><td> + </td><td></td><td> + </td><td></td></tr><tr><td></td><td> barman </td><td> wal-e </td><td> wal-g </td><td> pg_probackup </td><td> pgbackrest </td><td> BART </td></tr><tr><td>    </td><td></td><td></td><td> + </td><td> + </td><td></td><td></td></tr><tr><td>    </td><td></td><td></td><td></td><td></td><td> + </td><td></td></tr><tr><td> - </td><td> + </td><td> + </td><td> + </td><td> + </td><td> + </td><td> + </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dump multithreaded </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font></td><td></td></tr><tr><td> Pemulihan Point-in-Time </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  Penyesuaian beban jaringan </td><td>  + </td><td></td><td>  + </td><td></td><td></td><td>  + </td></tr><tr><td>  Kompresi on-the-fly </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td></td></tr><tr><td>  CLI </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  Server khusus </td><td>  + </td><td></td><td></td><td></td><td>  + </td><td>  + </td></tr><tr><td></td><td>  bartender </td><td>  wal-e </td><td>  wal-g </td><td>  pg_probackup </td><td>  pgbackrest </td><td>  Bart </td></tr><tr><td>  Penyimpanan cadangan terstruktur </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  Kebijakan penyimpanan </td><td>  + </td><td>  cron </td><td>  cron </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  CLI untuk pemantauan </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  Validitas penyelesaian pencadangan </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  Periksa postgresql </td><td></td><td></td><td></td><td>  + </td><td>  + </td><td></td></tr></tbody></table></div><br><p>  PS No. 2 Kesalahan, koreksi di bawah artikel, penambahan ke tabel pivot dapat dilakukan melalui <a href="" rel="nofollow">permintaan Tarik</a> </p><br><p>  PS # 3 Wal-g menyambut sukarelawan untuk membantu dengan dokumentasi. </p><br><p>  PS No. 4 Untuk menginstal wal-g menggunakan rpm Anda dapat menggunakan repositori saya: <a href="https://github.com/patsevanton/wal-g-rpm" rel="nofollow">Github</a> , <a href="https://copr.fedorainfracloud.org/coprs/antonpatsev/wal-g/" rel="nofollow">Fedora COPR</a> . </p><br><p>  PS No. 5 Bagaimana cara membuat cadangan penuh dan cadangan tambahan dalam membuat dan menyimpan di S3, dan menyimpan hanya cadangan penuh untuk direkam?  Jika Anda memiliki ide, beri tahu saya di komentar atau di PM. </p><br><p><img src="https://habrastorage.org/webt/r8/hh/ks/r8hhkssl2kpkvvqvat1xgwe8eie.png"></p><br><p>  Survei: Alat cadangan apa yang Anda gunakan? </p><br><p>  PS No. 6 saluran Telegram PostgreSQL: <a href="https://t.me/pgsql" rel="nofollow">https://t.me/pgsql</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id485622/">https://habr.com/ru/post/id485622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id485610/index.html">Bangun aplikasi Qt di WebAssembly di Windows</a></li>
<li><a href="../id485612/index.html">Apa yang diajarkan kecelakaan ruang angkasa sebagai pengembang</a></li>
<li><a href="../id485614/index.html">Budaya perusahaan merah adalah masalah utama bisnis Rusia (Bagian 3)</a></li>
<li><a href="../id485618/index.html">Otomasi Untuk Yang Terkecil. Catatan. API tenang</a></li>
<li><a href="../id485620/index.html">Yoshkar-Ola, secara umum, sebuah kota IT?</a></li>
<li><a href="../id485624/index.html">Server Minecraft: Windows vs Linux</a></li>
<li><a href="../id485630/index.html">Kosmonautika Afrika: dari sampah ke kenyataan</a></li>
<li><a href="../id485634/index.html">Dasbor Dungeons and Dragons membantu saya belajar bahasa Inggris</a></li>
<li><a href="../id485636/index.html">Virus yang resistan terhadap CRISPR membangun tempat perlindungan untuk melindungi genom dari enzim penembus DNA</a></li>
<li><a href="../id485640/index.html">Metode penyembunyian halaman web</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>