<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐คธ๐ป ๐ง ๐๐ฟ "ูุฐุง ูู ุงูุณุคุงู" ุจุฏูู ููู ุฃู ุจุฏูู ููู ุ "ุฃู" ุงูููู ุงูุตุญู ุฃุณูุฃ ูู ุงููุฌู ุงููุฑูุฑ " ๐ ๐๐ฟ ๐ฉ๐ฝโ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฃูููุชูู ุงูุชุนูููุงุช ุนูู ููุงูุฉ " ููู ุชูุงู ุจุดูู ุตุญูุญ ูุฎุงุทุฆ" ูุชุงุจุฉ ูุฐู ุงูููุงูุฉ. 


 ุณุชุฑูุฒ ูุฐู ุงูููุงูุฉ ุนูู ุชุทููุฑ ุชุทุจููุงุช ูุชุนุฏุฏุฉ ุงูุฎููุท ุ ููุงุจููุฉ ุชุทุจูู ุงูููู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"ูุฐุง ูู ุงูุณุคุงู" ุจุฏูู ููู ุฃู ุจุฏูู ููู ุ "ุฃู" ุงูููู ุงูุตุญู ุฃุณูุฃ ูู ุงููุฌู ุงููุฑูุฑ "</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428087/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุฃูููุชูู ุงูุชุนูููุงุช ุนูู ููุงูุฉ " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููู ุชูุงู ุจุดูู ุตุญูุญ</a> ูุฎุงุทุฆ" ูุชุงุจุฉ ูุฐู ุงูููุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุณุชุฑูุฒ ูุฐู ุงูููุงูุฉ ุนูู ุชุทููุฑ ุชุทุจููุงุช ูุชุนุฏุฏุฉ ุงูุฎููุท ุ ููุงุจููุฉ ุชุทุจูู ุงูููู ุจุฏูู ููู ุนูู ุจุนุถ ุงูุญุงูุงุช ุงูุชู ูุดุฃุช ุฃุซูุงุก ุงูุนูู ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">LAppS</a> ุ ุนูู ูุธููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููู ุงููุงููู</a> ูุงูุนูู ูู ุจุฑูุงูุฌ ุฌุฏููุฉ ุงูููุงู. </p><br><pre style=";text-align:right;direction:rtl"><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">NB</span></span>:      <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>++  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Linux</span></span>,       <span class="hljs-selector-tag"><span class="hljs-selector-tag">POSIX</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1-2008</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> (    ).</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูู ุดูุก ููุถูู ุฌุฏูุง ุ ุขูู ุฃู ูููู ูุทุงุฑ ุงูููุฑ ูู ุงูุนุฑุถ ุงูุชูุฏููู ูุงุถุญูุง.  ุฅุฐุง ููุช ููุชููุง ุ ูุฃูุง ุฃุทูุจ ูุทุฉ. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ุงูุจุฑุงูุฌ ุงูููุฌูุฉ ููุฃุญุฏุงุซ ุชูุชุธุฑ ุฏุงุฆููุง ุดูุฆูุง ูุง.  ุณูุงุก ูุงูุช ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูุฑุณูููุฉ ุฃู ุฎุงุฏู ุงูุดุจูุฉ ุ ูุฅููู ููุชุธุฑูู ุฃู ุฃุญุฏุงุซ: ุฅุฏุฎุงู ููุญุฉ ุงูููุงุชูุญ ุ ุฃุญุฏุงุซ ุงููุงูุณ ุ ุญุฒูุฉ ุงูุจูุงูุงุช ุงูุชู ุชุตู ุนุจุฑ ุงูุดุจูุฉ.  ููู ูู ุงูุจุฑุงูุฌ ุชูุชุธุฑ ุจุดูู ูุฎุชูู.  ูุง ูุฌุจ ุฃู ุชูุชุธุฑ ุงูุฃูุธูุฉ ุงูุฎุงููุฉ ูู ุงูููู ุนูู ุงูุฅุทูุงู.  ุนูู ุงูุฃูู ูุฌุจ ุฃู ูุญุฏุซ ุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุงุช ุจุฏูู ููู ุญูุซ ูุง ุชุญุชุงุฌ ุฅูู ุงูุงูุชุธุงุฑ ุ ูุญุชู ุถุงุฑ.  ููููุง ูุชุญุฏุซ ุนู ุฃูุธูุฉ ุชูุงูุณูุฉ (ูุชุนุฏุฏุฉ ุงูุฎููุท) ุ ููู ุงูุบุฑูุจ ุฃู ุงูุฎูุงุฑุฒููุงุช ุงูุฎุงููุฉ ูู ุงูููู ุชูุชุธุฑ ุฃูุถูุง.  ูุนู ุ ุฅููู ูุง ูููุนูู ุชูููุฐ ุงูุฎููุท ุงููุชูุงุฒูุฉ ุ ููููู ูู ุฃููุณูู ููุชุธุฑูู ุงููุฑุตุฉ ููููุงู ุจุดูุก ูุง ุฏูู ุงูุญุฌุจ. </p><br><p style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู LAppS ูุงุฆูุงุช ุงููุฒุงุฌ ู ุงูุฅุดุงุฑุงุช ุจูุดุงุท ูุจูุฑ.  ูู ุงูููุช ููุณู ุ ูุง ุชูุฌุฏ ุฅุดุงุฑุงุช ูู ูุนูุงุฑ C ++.  ุงูุขููุฉ ูููุฉ ููุบุงูุฉ ููุฑูุญุฉ ุ ูููู ูุฌุจ ุฃู ุชุนูู C ++ ุนูู ุงูุฃูุธูุฉ ุงูุชู ูุง ุชุญุชูู ุนูู ุฏุนู ุฅุดุงุฑุฉ ุ ูุจุงูุชุงูู ูุง ูุชู ุชุถููู ุงูุฅุดุงุฑุงุช ูู ุงููุนูุงุฑ.  ุนูุงูุฉ ุนูู ุฐูู ุ ุฅุฐุง ููุช ุฃุณุชุฎุฏู ุงูุฅุดุงุฑุงุช ูุฃููุง ูุฑูุญุฉ ุ ูุนูุฏุฆุฐู ูุฌุจ ุชุบููุฑ ุงููุฒุงููุฉ ูุฃููู ูุถุทุฑ ุฅูู ุฐูู. </p><br><p style=";text-align:right;direction:rtl">  ูุคุฏู ุณููู ูุงุฆู ุงููุฒุงููุฉ ูู ุญุงูุฉ ุงูููู ุงูุชูุงูุณู () ุ ูุซู sem_wait () ูู Linux ุ ุฅูู ูุถุน ูุคุดุฑ ุงูุชุฑุงุจุท ุงูููุชุธุฑ ูู ููุงูุฉ ูุงุฆูุฉ ุงูุชุธุงุฑ ุฌุฏููุฉ ุงูููุงู ุ ูุนูุฏูุง ูููู ูู ุงูุฃุนูู ุ ูุชูุฑุฑ ุงูุชุญูู ุฏูู ุงูุนูุฏุฉ ุฅูู ููุทูุฉ ุงููุณุชุฎุฏู ุ ูุชู ุฅุนุงุฏุฉ ุณูุณูุฉ ุงูุฑุณุงุฆู ุฅูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุฅุฐุง ุงูุญุฏุซ ุงููุชููุน ูู ูุญุฏุซ ุจุนุฏ.  ูุฐู ููุทุฉ ูููุฉ ุฌุฏุง </p><br><p style=";text-align:right;direction:rtl">  ููุฑุฑุช ุฃู ุฃุชุญูู ููุง ุฅุฐุง ูุงู ูููููู ุฑูุถ ุฅุดุงุฑุงุช std :: mutex ู POSIX ุ ููุถุงูุงุฉ std :: atomic ุ ูููู ุงูุญูู ูู ุงูุบุงูุจ ุฅูู userland.  ูุดู ูู ุงููุงูุน ุ ูููู ุฃูู ุงูุฃุดูุงุก ุฃููุงู. </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ูุฏู ุนุฏุฉ ุฃูุณุงู ูููู ุฃู ุชููู ูููุง ูุฐู ุงูุชุฌุงุฑุจ ูููุฏุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃููุงู ูู LibreSSL (ุงูุญุงูุฉ 1) ุ </li><li style=";text-align:right;direction:rtl">  ุงูุญุฌุจ ุนูุฏ ููู ุงูุญุฒู ุงููุณุชููุฉ ุฅูู ุชุทุจููุงุช Lua (ุงูุญุงูุฉ 2) ุ </li><li style=";text-align:right;direction:rtl">  ูู ุงูุชุธุงุฑ ุฃุญุฏุงุซ ุงูุญูููุฉ ุฌุงูุฒุฉ ูุชุชู ูุนุงูุฌุชูุง ุจูุงุณุทุฉ ุชุทุจููุงุช Lua (ุงูุญุงูุฉ 3). </li></ul><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ูุน ุฃููุงู ุบูุฑ ูุงูุนุฉ ููุญุธุฑ.  ุฏุนูุง ููุชุจ ูุงุฆู ุงููุฒุงููุฉ ูุฏููุง ุจุงุณุชุฎุฏุงู atomics ุ ููุง ูู ููุถุญ ูู ุจุนุถ ุงูุฎุทุจ ุงูุชู ูุชุจูุง H. Sutter (ูุง ููุฌุฏ ุฑูุฒ ุฃุตูู ุ ูุจุงูุชุงูู ุ ูู ุงูุฐุงูุฑุฉ ูุจุงูุชุงูู ูุง ูุชุฒุงูู ุงูุฑูุฒ ูุน 100 ูช ุงูุฃุตูู ุ ููู Satter ูุงู ูุฐุง ุงูุฑูุฒ ูุฑุชุจุทูุง ุจุชูุฏู C ++ 20 ุ ูุฐูู ููุงู ุงุฎุชูุงูุงุช).  ูุนูู ุงูุฑุบู ูู ุจุณุงุทุฉ ูุฐุง ุงูุฑูุฒ ุ ุฅูุง ุฃู ููุงู ุนููุจูุง ููู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs kotlin">#include &lt;atomic&gt; #include &lt;pthread.h&gt; namespace test { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mutex</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: std::atomic&lt;pthread_t&gt; mLock; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: explicit mutex():mLock{<span class="hljs-number"><span class="hljs-number">0</span></span>} { } mutex(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mutex&amp;)=delete; mutex(mutex&amp;)=delete; void lock() { pthread_t locked_by=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  C++20     , .. compare_exchange_strong          while(!mLock.compare_exchange_strong(locked_by,pthread_self())) { locked_by=0; //      } } void unlock() { pthread_t current=pthread_self(); if(!mLock.compare_exchange_strong(current,0)) { throw std::system_error(EACCES, std::system_category(), "An attempt to unlock the mutex owned by other thread"); } } const bool try_lock() { pthread_t unused=0; return mLock.compare_exchange_strong(unused,pthread_self()); } }; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูู ุนูุณ std :: mutex :: unlock () ุ ูุฅู ุณููู test :: mutex: unlock () ุนูุฏ ูุญุงููุฉ ุฅูุบุงุก ุงูููู ูู ูุคุดุฑ ุชุฑุงุจุท ุขุฎุฑ ูู ุฃูุฑ ุญุชูู.  ุณูุชู ุทุฑุญ ุงุณุชุซูุงุก.  ูุฐุง ุฃูุฑ ุฌูุฏ ุ ุนูู ุงูุฑุบู ูู ุฃูู ูุง ูุชูู ูุน ุงูุณููู ุงูููุงุณู.  ููุง ูู ุงูุณูุฆ ูู ูุฐู ุงููุฆุฉุ  ุงูุฎุจุฑ ุงูุณูุฆ ูู ุฃู ุฃุณููุจ test :: mutex: lock () ุณูุณุชููู ุจูุง ุฎุฌู ููุงุฑุฏ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ูู ุงูุญุตุต ุงูุฒูููุฉ ุงููุฎุตุตุฉ ููุคุดุฑ ุงูุชุฑุงุจุท ุ ูู ูุญุงููุงุช ููุณูุทุฑุฉ ุนูู ูุงุฆู ุงููุฒุงููุฉ ุงูุฐู ููุชููู ูุคุดุฑ ุชุฑุงุจุท ุขุฎุฑ ุจุงููุนู.  ุนูู ุณุจูู ุงููุซุงู  ุญููุฉ ูู ุงูุงุฎุชุจุงุฑ :: mutex: lock () ุณุชููู ูุถูุนุฉ ูููุงุฑุฏ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ.  ูุง ูู ุฎูุงุฑุงุชูุง ููุชุบูุจ ุนูู ูุฐุง ุงููุถุนุ </p><br><p style=";text-align:right;direction:rtl">  ูููููุง ุงุณุชุฎุฏุงู Schedule_yield () (ููุง ูู ููุชุฑุญ ูู ุฃุญุฏ ุงูุชุนูููุงุช ุนูู ุงูููุงูุฉ ุฃุนูุงู).  ูู ูู ุจูุฐู ุงูุจุณุงุทุฉุ  ุฃููุงู ุ ูู ุฃุฌู ุงุณุชุฎุฏุงู ุงูุฌุฏููุฉ ุงูุฒูููุฉ () ุ ูู ุงูุถุฑูุฑู ุฃู ุชุณุชุฎุฏู ุณูุงุณู ุงูุชูููุฐ ุณูุงุณุงุช SCHED_RR ุ SCHED_FIFO ูุชุญุฏูุฏ ุฃููููุงุชูุง ูู ุจุฑูุงูุฌ ุฌุฏููุฉ ุงูููุงู.  ูุฅูุง ุ ูุฅู ุงุณุชุฏุนุงุก Schedule_yield () ุณูููู ูุถูุนุฉ ูููุงุฑุฏ ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ.  ุซุงูููุง ุ ุณุชุคุฏู ุงูููุงููุฉ ุงููุชูุฑุฑุฉ ุฌุฏูุง ุฅูู Schedule_yield () ุฅูู ุฒูุงุฏุฉ ุงุณุชููุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ.  ุนูุงูุฉ ุนูู ุฐูู ุ ูุฅู ุงุณุชุฎุฏุงู ุณูุงุณุงุช ุงูููุช ุงููุนูู ูู ุชุทุจููู ุ ูุดุฑูุทุฉ ุนุฏู ูุฌูุฏ ุชุทุจููุงุช ุฃุฎุฑู ูู ุงูููุช ุงููุนูู ูู ุงููุธุงู ุ ุณูุญุฏ ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงููุฌุฏูู ูุน ุงูุณูุงุณุฉ ุงููุญุฏุฏุฉ ูููุถูุนุงุชู ููุท.  ูุจุฏู ุฃู ูุฐุง ุฃูุฑ ุฌูุฏ!  ูุง ุ ููุณ ุฌูุฏูุง.  ุงููุธุงู ุจุฃูููู ุณูุตุจุญ ุฃูู ุงุณุชุฌุงุจุฉ ุ ูุฃูู  ูุดุบูู ุจุงููููุฉ ุฐุงุช ุงูุฃููููุฉ.  ุณูู ูููู CFQ ูู ุงูููู.  ูููู ููุงู ูุคุดุฑุงุช ุชุฑุงุจุท ุฃุฎุฑู ูู ุงูุชุทุจูู ุ ูุบุงูุจูุง ูุง ููุดุฃ ูููู ุนูุฏูุง ูุชู ูุถุน ูุคุดุฑ ุงูุชุฑุงุจุท ุงูุฐู ุงุณุชุญูุฐ ุนูู ูุงุฆู ุงููุฒุงููุฉ ูู ููุงูุฉ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ (ุงูุชูุช ุตูุงุญูุฉ ุงูุญุตุฉ) ุ ูุงูููุถูุน ุงูุฐู ููุชุธุฑ ุชุญุฑูุฑ ูุงุฆู ุงููุฒุงููุฉ ุฃูุงูู ูุจุงุดุฑุฉ.  ูู ุชุฌุฑุจุชู (ุงูุญุงูุฉ 2) ุ ุฃุนุทุช ูุฐู ุงูุทุฑููุฉ ููุณ ุงููุชุงุฆุฌ (3.8ูช ุฃุณูุฃ) ูู std :: mutex ุ ููู ุงููุธุงู ุฃูู ุงุณุชุฌุงุจุฉ ูุฒุงุฏ ุงุณุชููุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุจูุณุจุฉ 5ูช -7ูช. </p><br><p style=";text-align:right;direction:rtl">  ููููู ุชุฌุฑุจุฉ ุชุบููุฑ ุงูุงุฎุชุจุงุฑ :: mutex :: lock () ูุซู ูุฐุง (ุณูุฆ ุฃูุถูุง): </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">pthread_t</span></span> locked_by=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(!mLock.compare_exchange_strong(locked_by,pthread_self())) { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">thread_local</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">timespec</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pause</span></span></span><span class="hljs-class">{</span></span><span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>}; <span class="hljs-comment"><span class="hljs-comment">// -      nanosleep(&amp;pause,nullptr); locked_by=0; } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ููููู ุชุฌุฑุจุฉ ูุฏุฉ ุงูููู ุจุงููุงูู ุซุงููุฉ ุ ููุงู 4 ns ูู ุงูุชุฃุฎูุฑ ูู ุงูุฃูุซู ููุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงูุฎุงุตุฉ ุจู ููุงู ุงูุฎูุงุถ ุงูุฃุฏุงุก ูุณุจุฉ ุฅูู std :: mutex ูู ููุณ ุงูุญุงูุฉ 2 ูุงู 1.2ูช.  ููุณ ุญูููุฉ ุฃู ุงูููู ูุงูู 4ns.  ูู ุงููุงูุน ุ ุฃู ุฃูุซุฑ (ูู ุงูุญุงูุฉ ุงูุนุงูุฉ) ุฃู ุฃูู (ุฅุฐุง ุชูุช ููุงุทุนุชู).  ูุงู ุงูุณููุท (!) ูู ุงุณุชููุงู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ 12ูช -20ูช.  ุนูู ุณุจูู ุงููุซุงู  ูุงู ูุฐุง ุญูู ุตุญู. </p><br><p style=";text-align:right;direction:rtl">  ูุฏู OpenSSL ู LibreSSL ูุธููุชุงู ุชูููุงู ุจุฅุนุฏุงุฏ ุงูุงุณุชุฑุฌุงุนุงุช ูุญุธุฑูุง ุนูุฏ ุงุณุชุฎุฏุงู ูุฐู ุงูููุชุจุงุช ูู ุจูุฆุฉ ูุชุนุฏุฏุฉ ุงูุฎููุท.  ูุจุฏู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">//  callback <span class="hljs-type"><span class="hljs-type">void</span></span> openssl_crypt_locking_function_callback(<span class="hljs-type"><span class="hljs-type">int</span></span> mode, <span class="hljs-type"><span class="hljs-type">int</span></span> n, const <span class="hljs-type"><span class="hljs-type">char</span></span>* file, const <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-type"><span class="hljs-type">line</span></span>) { static std::vector&lt;std::mutex&gt; locks(CRYPTO_num_locks()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(n&gt;=static_cast&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(locks.size())) { <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mode &amp; CRYPTO_LOCK) locks[n].<span class="hljs-keyword"><span class="hljs-keyword">lock</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> locks[n].unlock(); } //  callback-a CRYPTO_set_locking_callback(openssl_crypt_locking_function_callback); //  id CRYPTO_set_id_callback(pthread_self);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงูุขู ุฃุณูุฃ ุดูุก ูู ุฃู ุงุณุชุฎุฏุงู ุงูุงุฎุชุจุงุฑ ุฃุนูุงู: mutex mutex ูู LibreSSL ูููู ูู ุฃุฏุงุก LAppS ูุฑุชูู ุชูุฑูุจูุง.  ุนูุงูุฉ ุนูู ุฐูู ุ ุจุบุถ ุงููุธุฑ ุนู ุงูุฎูุงุฑ (ุญููุฉ ุงูุชุธุงุฑ ูุงุฑุบุฉ ุ Sched_yield () ุ nanosleep ()). </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูุญุฐู ุงูุญุงูุฉ 2 ูุงูุญุงูุฉ 1 ุ ููุจูู ูุน std :: mutex. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ููุชูู ุฅูู ุงูุฅุดุงุฑุงุช.  ููุงู ุงูุนุฏูุฏ ูู ุงูุฃูุซูุฉ ุนูู ููููุฉ ุชูููุฐ ุงูุฅุดุงุฑุงุช ุจุงุณุชุฎุฏุงู std :: condition_variable.  ุฌููุนูู ูุณุชุฎุฏููู std :: mutex ุฃูุถูุง.  ููุญุงูุงุฉ ุงูุฅุดุงุฑุฉ ูุฐู ุฃุจุทุฃ (ููููุง ูุงุฎุชุจุงุฑุงุชู) ูู ุฃุฌูุฒุฉ ุฅุดุงุฑุฉ ูุธุงู POSIX. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุณูููู ุจุนูู ุฅุดุงุฑุฉ ุนูู ุงูุฐุฑุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs java"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">semaphore</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: std::atomic&lt;bool&gt; mayRun; mutable std::atomic&lt;int64_t&gt; counter; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-function">explicit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">semaphore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : mayRun</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>},counter{<span class="hljs-number"><span class="hljs-number">0</span></span>} { } semaphore(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> semaphore&amp;)=delete; semaphore(semaphore&amp;)=delete; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ ++counter; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mayRun.load(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">try_wait</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mayRun.load()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(counter.fetch_sub(<span class="hljs-number"><span class="hljs-number">1</span></span>)&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ++counter; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> std::system_error(ENOENT,std::system_category(),<span class="hljs-string"><span class="hljs-string">"Semaphore is destroyed"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wait</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(!try_wait()) { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> thread_local <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> struct timespec pause{<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>}; nanosleep(&amp;pause,nullptr); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mayRun.store(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> int64_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrimentOn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size_t value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mayRun.load()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> counter.fetch_sub(value); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> std::system_error(ENOENT,std::system_category(),<span class="hljs-string"><span class="hljs-string">"Semaphore is destroyed"</span></span>); } } ~semaphore() { destroy(); } };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃูู ุ ูุฐุง ุฅุดุงุฑุฉ ุฃุณุฑุน ุนุฏุฉ ูุฑุงุช ูู ุฅุดุงุฑุฉ ุงููุธุงู.  ูุชูุฌุฉ ุงุฎุชุจุงุฑ ูููุตู ููุฐู ุงูุฅุดุงุฑุฉ ูุน ูููุฑ ูุงุญุฏ ู 20 ูููุณูุฑูุงุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs bash">OS semaphores <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>. Started 20 threads waiting on a semaphore Thread(OS): wakes: 500321 Thread(OS): wakes: 500473 Thread(OS): wakes: 501504 Thread(OS): wakes: 502337 Thread(OS): wakes: 498324 Thread(OS): wakes: 502755 Thread(OS): wakes: 500212 Thread(OS): wakes: 498579 Thread(OS): wakes: 499504 Thread(OS): wakes: 500228 Thread(OS): wakes: 499696 Thread(OS): wakes: 501978 Thread(OS): wakes: 498617 Thread(OS): wakes: 502238 Thread(OS): wakes: 497797 Thread(OS): wakes: 498089 Thread(OS): wakes: 499292 Thread(OS): wakes: 498011 Thread(OS): wakes: 498749 Thread(OS): wakes: 501296 OS semaphores <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>. 10000000 of posts <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 20 waiting threads have taken 9924 milliseconds OS semaphores <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>. Post latency: 0.9924ns ======================================= AtomicEmu semaphores <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>. Started 20 threads waiting on a semaphore Thread(EmuAtomic) wakes: 492748 Thread(EmuAtomic) wakes: 546860 Thread(EmuAtomic) wakes: 479375 Thread(EmuAtomic) wakes: 534676 Thread(EmuAtomic) wakes: 501014 Thread(EmuAtomic) wakes: 528220 Thread(EmuAtomic) wakes: 496783 Thread(EmuAtomic) wakes: 467563 Thread(EmuAtomic) wakes: 608086 Thread(EmuAtomic) wakes: 489825 Thread(EmuAtomic) wakes: 479799 Thread(EmuAtomic) wakes: 539634 Thread(EmuAtomic) wakes: 479559 Thread(EmuAtomic) wakes: 495377 Thread(EmuAtomic) wakes: 454759 Thread(EmuAtomic) wakes: 482375 Thread(EmuAtomic) wakes: 512442 Thread(EmuAtomic) wakes: 453303 Thread(EmuAtomic) wakes: 480227 Thread(EmuAtomic) wakes: 477375 AtomicEmu semaphores <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>. 10000000 of posts <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 20 waiting threads have taken 341 milliseconds AtomicEmu semaphores <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>. Post latency: 0.0341ns</code> </pre><br><p style=";text-align:right;direction:rtl">  ูุฐู ุงูุฅุดุงุฑุฉ ูุน ูุธููุฉ ูุฌุงููุฉ ุชูุฑูุจูุง () ุ ููู ุฃุณุฑุน 29 ูุฑุฉ ูู ุงููุธุงู ุ ููู ุฃูุถูุง ุณุฑูุนุฉ ุฌุฏูุง ูู ุฅููุงุธ ุงูุฎููุท ุงูุชู ุชูุชุธุฑูุง: 29325 ุชูุจูููุง ููู ูููู ุซุงููุฉ ุ ููุงุจู 1007 ุชูุจูููุง ููู ูููู ุซุงููุฉ ูู ุงููุธุงู.  ูุฏููุง ุณููู ูุทุนู ูุน ุฅุดุงุฑุฉ ุชุฏููุฑ ุฃู ุฅุดุงุฑุฉ ุชุฏููุฑูุฉ.  ูุจุทุจูุนุฉ ุงูุญุงู ุ ุณูุฌูููุช ุนูุฏ ูุญุงููุฉ ุงุณุชุฎุฏุงู ูุงุญุฏ ูุฏูุฑ ุจุงููุนู. </p><br><p style=";text-align:right;direction:rtl">  (ยน) ูู ุงููุงูุน ุ ูุฑุงุช ุนุฏูุฏุฉ ูู ูููู ุซุงููุฉ ูุง ูููู ุชุฃุฌูู ุงูุฏูู ูุฅููุงุธู ูู ูุจู ุงููุฌุฏูู.  ูุฃู  post () ูุง ูููุน ุ ูู ูุฐุง ุงูุงุฎุชุจุงุฑ ุงูุงุตุทูุงุนู ุ ุงูุชุธุฑ () ุบุงูุจูุง ูุง ูุฌุฏ ููุณู ูู ูููู ูุง ุชุญุชุงุฌ ููู ุฅูู ุงูููู.  ูู ุงูููุช ููุณู ุ ุชูุฑุฃ 7 ุฎููุท ุนูู ุงูุฃูู ุจุงูุชูุงุฒู ูููุฉ ุงูุฅุดุงุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ุงุณุชุฎุฏุงูู ูู ุญุงูุฉ 3 ูู LAppS ูุคุฏู ุฅูู ุฎุณุงุฆุฑ ูู ุงูุฃุฏุงุก ุจุบุถ ุงููุธุฑ ุนู ููุช ุงูููู.  ูุณุชููุธ ูู ูุซูุฑ ูู ุงูุฃุญูุงู ููุชุญูู ุ ูุชุตู ุงูุฃุญุฏุงุซ ูู LAppS ุจุดูู ุฃุจุทุฃ ุจูุซูุฑ (ูููู ุงูุดุจูุฉ ุ ุงููููู ูู ุฌุงูุจ ุงูุนููู ุงูุฐู ูููุฏ ุงูุญูู ุ ุฅูุฎ).  ูุงูุชุญูู ุฃูู ูู ุฐูู ูุนูู ุฃูุถูุง ููุฏ ุงูุฃุฏุงุก. </p><br><p style=";text-align:right;direction:rtl">  ุนูุงูุฉ ุนูู ุฐูู ุ ูุฅู ุงุณุชุฎุฏุงู ุงูููู ูู ูุซู ูุฐู ุงูุญุงูุงุช ูุจุทุฑููุฉ ููุงุซูุฉ ุถุงุฑ ุชูุงููุง ุ ูุฃูู  ุนูู ุฌูุงุฒ ุขุฎุฑ ุ ูุฏ ูุชุจูู ุฃู ุงููุชุงุฆุฌ ูุฎุชููุฉ ุชูุงููุง (ููุง ูู ุญุงูุฉ ุชููู ุชุนูููุงุช ุงููุฌููุน ูุคูุชูุง) ุ ูููู ุทุฑุงุฒ CPU ุ ูุฌุจ ุนููู ุฃูุถูุง ุชุญุฏูุฏ ููุช ุงูุชุฃุฎูุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุชููู ููุฒุฉ ูุงุฆูุงุช ุงููุฒุงููุฉ ููุธุงู ุงูุฅุดุงุฑุฉ ูู ุฃู ูุคุดุฑ ุชุฑุงุจุท ุงูุชูููุฐ ูุง ูุณุชููุธ ุญุชู ูุญุฏุซ ุญุฏุซ (ูุชุญ ูุงุฆู ุงููุฒุงููุฉ ุฃู ุฒูุงุฏุฉ ุงูุฅุดุงุฑุฉ).  ูุง ุชุถูุน ุฏูุฑุงุช CPU ุฅุถุงููุฉ - ุงูุฑุจุญ. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูู ุดูุก ูู ูุฐุง ุงูุดุฑูุฑ ุ ุชุนุทูู iptables ุนูู ูุธุงูู ูุนุทู ูู 12 ูช (ูุน TLS) ุฅูู 30 ูช (ุจุฏูู TLS) ููุงุณุจ ุฃุฏุงุก ... </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar428087/">https://habr.com/ru/post/ar428087/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar428077/index.html">React.js: ุฏููู ุงููุจุชุฏุฆูู</a></li>
<li><a href="../ar428079/index.html">ุชุทุจูู ูุจุงุฏุฆ SOLID ูุชูุงุนู ุชุทููุฑ ุงูุชุทุจููุงุช</a></li>
<li><a href="../ar428081/index.html">ุงุณุชุฎุฏุงู RxJS ูู ุชุทููุฑ ุงูุชูุงุนู ูุฅุฏุงุฑุฉ ุญุงูุฉ ุงูุชุทุจูู</a></li>
<li><a href="../ar428083/index.html">ุชุญูููุงุช ุงูููุจ ุชุคุซุฑ ุนูู ุงููุตูููุฉ - ุงููุธุงู ุงูุงุณุชุฑุงุชูุฌู Avinash Koshik</a></li>
<li><a href="../ar428085/index.html">ุถุฑุจุงุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ: ุฃุนูู 10 (ุ) ุชูุงุฑูุฑ HolyJS 2018 Piter</a></li>
<li><a href="../ar428089/index.html">"ุชูููู ุงููุงุญุต" ูุดูุฑ ุฃูุชูุจุฑ. ููุงุญุธุงุช: ููู ูุญุฏุซ ุฐูู</a></li>
<li><a href="../ar428091/index.html">ููู ุฃูุดุฃ ุทุงูุจ ูุชุฏุฑุจ ูุนุจุฉ ุงูููุฏูู ุงูุฃูุซุฑ ุดุนุจูุฉ ูู ุงูุนุงูู ุ ุฃู ุณุฌู ุฃูุนุงุจ Windows</a></li>
<li><a href="../ar428095/index.html">ุฃุจุญุงุซ ุงูุณูู ูุงุณุชูุฏูููุงุช ุงูููุจ ูุงูููุงูุงุช ุงูุฑูููุฉ</a></li>
<li><a href="../ar428097/index.html">ุงูุชูุฌูู ุงูุนูุฏู ูู MikroTik ูู ุฎูุงู ุงูุจูุงุจุงุช ุงููุนููุฉ ูู ูุจู DHCP</a></li>
<li><a href="../ar428099/index.html">ูุง ูู ุงูุดูุก ุงููุดุชุฑู ุจูู ุงููุณุงุชูู ุงูุนุงุฏูุฉ ูุนุตุฑ ุงูุฌูู ุงูุฎุงูุณ ุงููุงุฏูุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>