<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïñ üñïüèª üë©üèø‚ÄçüöÄ Trabaje con protecci√≥n de informaci√≥n criptogr√°fica y portadores de claves de hardware en Linux ‚úçÔ∏è üõÇ üèñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El almacenamiento de claves en tokens y tarjetas inteligentes proporciona protecci√≥n adicional contra intrusos externos e internos, incluidos aquellos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trabaje con protecci√≥n de informaci√≥n criptogr√°fica y portadores de claves de hardware en Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/441212/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/6t/xz/yg/6txzyg12acxsce8jlw0nl-ukdqa.png" width="80%" height="80%"></div><br>  El almacenamiento de claves en tokens y tarjetas inteligentes proporciona protecci√≥n adicional contra intrusos externos e internos, incluidos aquellos que tienen un cierto nivel de acceso al sistema y al equipo de informaci√≥n. <br><br>  Hoy les contar√© c√≥mo protegemos las claves de cifrado y las firmas electr√≥nicas en nuestros sistemas de informaci√≥n, y lo har√© en una gu√≠a detallada y bien ilustrada para configurar SUSE Linux Enterprise Server 12 SP3 para trabajar con el token Aladdin JaCarta PKI y CryptoPro CSP KC2 4.0.9944. <br><br>  Hubo varias razones para publicar esta gu√≠a: <br><a name="habracut"></a><br><h4>  Raz√≥n 1 </h4><br>  La documentaci√≥n oficial sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aladdin-RD JaCarta est√°</a> m√°s adaptada para los sistemas operativos Astra Linux y ALT Linux, certificada por el Ministerio de Defensa, FSTEC y FSB como un medio para proteger la informaci√≥n. <br><br><h4>  Raz√≥n 2 </h4><br>  La mejor instrucci√≥n sobre c√≥mo configurar la interacci√≥n con los medios de hardware en Linux, que se encontr√≥, tambi√©n fue de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki.astralinux.ru - Trabajar con CryptoPro CSP</a> <br><br><h4>  Raz√≥n 3 </h4><br>  <b>UPD 16/04/2019:</b> En el proceso de configuraci√≥n del entorno y el equipo, result√≥ que el operador que estaba disponible por primera vez no era JaCarta PKI Nano, como se esperaba, sino un dispositivo que funcionaba en modo SafeNet Authentication Client eToken PRO. <br><br>  <b>UPD 16/04/2019:</b> Una vez que el Banco necesitaba un dispositivo que pudiera funcionar en la misma infraestructura que eToken PRO (Java).  Como tal dispositivo, la empresa "ZAO Aladdin R.D."  ofreci√≥ un token JaCarta PRO, que fue seleccionado por el banco.  Sin embargo, en la etapa de formaci√≥n del art√≠culo y los documentos de env√≠o, un empleado de la empresa cometi√≥ un error.  En lugar del modelo JaCarta PRO, JaCarta PKI se introdujo accidentalmente en el art√≠culo y en los documentos de env√≠o. <br><br>  <b>UPD 16/04/2019:</b> Agradezco a la compa√±√≠a Aladdin R.D. por ayudarme a descubrir y establecer la verdad. <br><br><blockquote>  No hay significados pol√≠ticos y ocultos en este error, sino solo el error t√©cnico de un empleado al preparar documentos.  Token JaCarta PRO es un producto de la empresa Aladdin R.D.  El applet que realiza la parte funcional fue desarrollado por la empresa "ZAO Aladdin R.D." </blockquote><br><br>  Este eToken PRO fue para una fiesta lanzada antes del 1 de diciembre de 2017. <br>  Despu√©s de esta fecha, la empresa "Aladdin R.D."  Dej√≥ de vender dispositivos eToken PRO (Java). <br><br>  Mirando un poco m√°s adelante, debo decir que el trabajo con √©l se configur√≥ a trav√©s de los controladores apropiados: <b>SafenetAuthenticationClient-10.0.32-0.x86_64</b> , que solo se puede obtener en apoyo de Aladdin R.D.  en una solicitud en l√≠nea separada. <br><br>  En CryptoPro CSP, para trabajar con este token, era necesario instalar el <b>paquete cprocsp-rdr-emv-64 |</b>  <b>M√≥dulo de soporte EMV / Gemalto</b> . <br><br>  Este token se determin√≥ y respondi√≥.  Utilizando la utilidad <b>SACTools del</b> paquete <b>SafenetAuthenticationClient</b> , fue posible inicializarlo.  Pero cuando trabajaba con la protecci√≥n de la informaci√≥n criptogr√°fica, se comport√≥ de manera extremadamente extra√±a e impredecible. <br><br>  Se mostr√≥ de la siguiente manera, en el comando: <br><br><pre><code class="plaintext hljs">csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (205D325E5842) 00 00\alfa_shark' -check</code> </pre> <br>  La respuesta fue que todo estaba bien: <br><br><pre> <code class="plaintext hljs">[ErrorCode: 0x00000000]</code> </pre> <br>  Pero inmediatamente despu√©s de intentar leer las claves mediante programaci√≥n, la misma verificaci√≥n comenz√≥ a producir un error: <br><br><pre> <code class="plaintext hljs">[ErrorCode: 0x8009001a]</code> </pre> <br>  De acuerdo con la lista de c√≥digos de error del modelo de objetos de los componentes de los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digos de error COM</a> de Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">(seguridad y configuraci√≥n)</a> <br><br><pre> <code class="plaintext hljs">NTE_KEYSET_ENTRY_BAD 0x8009001A Keyset as registered is invalid.</code> </pre> <br>  ‚ÄúConjunto de claves inv√°lidas‚Äù: la raz√≥n de tal mensaje puede estar en el antiguo chip, firmware y applet Gemalto, o en sus controladores para el sistema operativo que no admite los nuevos est√°ndares de generaci√≥n ES y las funciones hash GOST R 34.10-2012 y GOST R 34.11- 2012 <br><br>  En este estado, el token fue bloqueado.  El √≠ndice de protecci√≥n de informaci√≥n criptogr√°fica comenz√≥ a mostrar el estado irrelevante del lector y el contenedor de claves.  Reiniciar el servicio de proveedor criptogr√°fico <b>cprocsp</b> , el <b>token pcscd</b> y los <b>servicios de</b> tarjeta inteligente y todo el sistema operativo no ayudaron, solo la reinicializaci√≥n. <br><br>  Para ser justos, debe tenerse en cuenta que SafeNet eToken PRO funcion√≥ correctamente con las teclas GOST R 34.10-2001 en el sistema operativo Windows 7 y 10. <br><br>  Puede intentar instalar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CryptoPro CSP 4.0 FCN (Gemalto)</a> , pero el objetivo es proteger nuestras claves ES y de cifrado con los productos FSB y FSTEC certificados por la familia JaCarta que admiten nuevos est√°ndares. <br><br>  El problema se resolvi√≥ tomando el token JaCarta PKI real en la carcasa regular (XL). <br><br>  Pero se dedic√≥ mucho tiempo a intentar que Safenet eToken PRO funcionara.  Quer√≠a llamar la atenci√≥n sobre esto y, tal vez, proteger a alguien de esto. <br><br><h4>  Raz√≥n 4 </h4><br>  A veces, usted mismo necesita volver a los art√≠culos e instrucciones anteriores.  Esto es conveniente cuando la informaci√≥n se coloca en una fuente externa.  As√≠ que gracias a Habr por la oportunidad. <br><br><h2>  Gu√≠a de configuraci√≥n </h2><br>  Despu√©s de instalar el token JaCarta PKI en el puerto USB del servidor e iniciar el sistema, verificamos que el nuevo dispositivo se detecte y aparezca en la lista: <br><br> <code>lsusb</code> <br> <br><img src="https://habrastorage.org/webt/ge/fs/tu/gefstux3tlhb7j0pag8r_fa-ose.png"><br><br>  En nuestro caso, es el <i>Bus 004 Dispositivo 003: ID 24dc: 0101</i> <br><br>  Para diagnosticar lectores, puede usar la utilidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcsc-tools del proyecto security: chipcard (software.opensuse.org)</a> . <br><br>  Se inicia con el comando: <br><br> <code>pcsc_scan</code> <br> <br><img src="https://habrastorage.org/webt/rm/v3/ki/rmv3kikfuuwmh8c9mijm3it-ieq.png"><br><br>  Hasta que se instalen todos los paquetes necesarios, no se mostrar√° informaci√≥n sobre el token. <br><br><h3>  Instalaci√≥n de controladores y software para trabajar con JaCarta PKI </h3><br>  En la p√°gina de soporte del sitio "Aladdin R.D."  Descargamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Documentaci√≥n y software para trabajar solo con JaCarta PKI</a> <br><br>  De acuerdo con la Gu√≠a de implementaci√≥n de JaCarta para Linux, cl√°usula 4.2., El primer paso es instalar <b>pcsc-lite</b> , <b>ccid</b> y <b>libusb</b> . <br><blockquote>  Para que la utilidad de administraci√≥n JaCarta funcione, se deben instalar los siguientes componentes: <br><br><ul><li>  PC / SC Lite: una capa intermedia para proporcionar acceso a tarjetas inteligentes de acuerdo con el paquete PC / SC est√°ndar, pcsc-lite. </li><li>  Bibliotecas Ccid y libusb para trabajar con llaves USB, tarjetas inteligentes y lectores de tarjetas inteligentes. </li></ul></blockquote>  Verificamos la disponibilidad de estos paquetes e instalamos: <br><br> <code>zypper search pcsc-lite</code> <br> <br><img src="https://habrastorage.org/webt/ez/0m/n_/ez0mn_o8-hmwibwiiltr5jk34xi.jpeg"><br><br> <code>zypper search libusb</code> <br> <br><img src="https://habrastorage.org/webt/ba/jn/zt/bajnztgbtt_fsbfp0tanzfvv7hk.png"><br><br> <code>zypper install pcsc-lite</code> <br> <br><img src="https://habrastorage.org/webt/qe/6i/pl/qe6ipldd5fimbo_m7j4yrmvtibw.jpeg"><br><br><img src="https://habrastorage.org/webt/1m/bo/mc/1mbomc3je9v8e82whld_0tqheje.png"><br><br> <code>zypper search CCID</code> <br> <br><img src="https://habrastorage.org/webt/mq/f4/8x/mqf48xewg61la3nuv_kumzsaxkq.png"><br><br> <code>zypper install pcsc-ccid</code> <br> <br><img src="https://habrastorage.org/webt/lx/yv/ng/lxyvngqgd1d_rdkh7tw2lofepjs.png"><br><br> <code>zypper search CCID</code> <br> <br><img src="https://habrastorage.org/webt/kq/az/ly/kqazlyxzmdusuprtyyfjhkkjick.jpeg"><br><br> <code>zypper install libusb</code> <br> <br><img src="https://habrastorage.org/webt/1f/ul/bk/1fulbklde9aj87m_ur21u8xvms0.png"><br><br>  Como resultado, se actualiz√≥ el paquete pcsc-lite, se instal√≥ CCID, libusb no se requiri√≥ ninguna acci√≥n. <br><br>  Los siguientes dos comandos instalan el paquete con controladores y software directamente para trabajar con JaCarta PKI: <br><br> <code>zypper install idprotectclientlib-637.03-0.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/ux/ep/1u/uxep1uijp_2kvyix-yn6qkg5ing.jpeg"><br><br> <code>zypper install idprotectclient-637.03-0.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/xy/32/hq/xy32hqxgtmgwpn-pocygfs-rn3q.jpeg"><br><br>  Compruebe que los controladores y el software para JaCarta PKI est√©n instalados: <br><br> <code>zypper search idprotectclient</code> <br> <br><img src="https://habrastorage.org/webt/7k/os/nk/7kosnk44-yewdh9i7odevcdzqdc.jpeg"><br><br>  Al intentar que SafeNet eToken PRO funcionara, encontr√© informaci√≥n de que el <b>paquete openct - Library for Smart Card Readers</b> preinstalado en SLES puede entrar en conflicto con <b>pcsc-lite - PCSC Smart Cards Library</b> , cuya instalaci√≥n requiere Aladdin R.D. <br><br> <code>zypper search openct</code> <br> <br><img src="https://habrastorage.org/webt/g8/ja/mr/g8jamrjqjkxybghgrj8rnbfuuaw.png"><br><br>  Por lo tanto, eliminamos el paquete openct: <br><br> <code>rpm -e openct</code> <br> <br>  Ahora est√°n instalados todos los controladores y software necesarios para trabajar con el token. <br><br>  <b>Realizamos</b> diagn√≥sticos utilizando la utilidad <b>pcsc-tools</b> y nos aseguramos de que JaCarta se detecte en el sistema operativo: <br><br> <code>pcsc_scan</code> <br> <br><img src="https://habrastorage.org/webt/t_/5s/ga/t_5sgar9ugi-z-mx2isjhpxfzj8.jpeg"><br><br><h3>  Instalar paquetes CryptoPro CSP </h3><br>  Al instalar CryptoPro CSP de forma predeterminada, faltan los paquetes necesarios para trabajar con tokens y tarjetas inteligentes. <br><br> <code>zypper search cprocsp</code> <br> <br><img src="https://habrastorage.org/webt/kq/g7/sc/kqg7scnpbnxlbxiicva_gjejk8k.png"><br><br>  Instalaci√≥n de los <b>componentes JaCarta para el componente de</b> soporte <b>CryptoPro CSP en el CSP</b> <br><br> <code>zypper install cprocsp-rdr-jacarta-64-3.6.408.683-4.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/9d/uu/3e/9duu3e1vs9wu3qotu6dsllot9km.jpeg"><br><br>  Algunos componentes tienen dependencias.  Entonces, por ejemplo, si intenta instalar el paquete de soporte SafeNet eToken PRO <b>cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm - M√≥dulo de soporte EMV / Gemalto, recibiremos</b> un mensaje sobre la necesidad de instalar primero el componente base del soporte de lector CSP <b>cprocsp -rdr-pcsc-64-4.0.9944-5.x86_64.rpm - Componentes de PC / SC para lectores CryptoPro CSP</b> : <br><br><pre> <code class="plaintext hljs">zypper install cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm Loading repository data... Reading installed packages... Resolving package dependencies... Problem: nothing provides cprocsp-rdr-pcsc-64 &gt;= 4.0 needed by cprocsp-rdr-emv-64-4.0.9944-5.x86_64 Solution 1: do not install cprocsp-rdr-emv-64-4.0.9944-5.x86_64 Solution 2: break cprocsp-rdr-emv-64-4.0.9944-5.x86_64 by ignoring some of its dependencies Choose from above solutions by number or cancel [1/2/c] (c): c</code> </pre><br>  Instale los paquetes de soporte b√°sicos para lectores y medios clave: <br><br> <code>zypper install cprocsp-rdr-pcsc-64-4.0.9944-5.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/ku/al/eh/kualehuiobnjcc6sxcfgzlzedcu.png"><br><br> <code>zypper install lsb-cprocsp-pkcs11-64-4.0.9944-5.x86_64.rpm</code> <br> <br>  Ahora puede instalar m√≥dulos para trabajar con otros tipos de medios y componentes de GUI: <br><br> <code>zypper install cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/b1/ka/hy/b1kahy9lzptzyp6gclxtou5775y.png"><br><br><pre> <code class="plaintext hljs">zypper install cprocsp-rdr-novacard-64-4.0.9944-5.x86_64.rpm zypper install cprocsp-rdr-mskey-64-4.0.9944-5.x86_64.rpm zypper install cprocsp-rdr-gui-gtk-64-4.0.9944-5.x86_64.rpm</code> </pre><br><img src="https://habrastorage.org/webt/gn/rs/s-/gnrss-ht0-vovsebsgfdvdioxhc.png"><br><br>  Verifique la configuraci√≥n final de CryptoPro CSP: <br><br><pre> <code class="plaintext hljs">zypper search cprocsp Loading repository data... Reading installed packages...</code> </pre><br><br> <code>S | Name | Summary | Type <br> ---+-----------------------------+----------------------------------------------------+-------- <br> i+ | cprocsp-curl-64 | CryptoPro Curl shared library and binaris. Build 9944. | package <br> i+ | cprocsp-rdr-emv-64 | EMV/Gemalto support module | package <br> i+ | cprocsp-rdr-gui-gtk-64 | GUI components for CryptoPro CSP readers. Build 9944. | package <br> i+ | cprocsp-rdr-jacarta-64 | JaCarta components for CryptoPro CSP. Build 683. | package <br> i+ | cprocsp-rdr-mskey-64 | Mskey support module | package <br> i+ | cprocsp-rdr-novacard-64 | Novacard support module | package <br> i+ | cprocsp-rdr-pcsc-64 | PC/SC components for CryptoPro CSP readers. Build 9944.| package <br> i+ | lsb-cprocsp-base | CryptoPro CSP directories and scripts. Build 9944. | package <br> i+ | lsb-cprocsp-ca-certs | CA certificates. Build 9944. | package <br> i+ | lsb-cprocsp-capilite-64 | CryptoAPI lite. Build 9944. | package <br> i+ | lsb-cprocsp-kc2-64 | CryptoPro CSP KC2. Build 9944. | package <br> i+ | lsb-cprocsp-pkcs11-64 | CryptoPro PKCS11. Build 9944. | package <br> i+ | lsb-cprocsp-rdr-64 | CryptoPro CSP readers. Build 9944. | package <br></code> <br><br><img src="https://habrastorage.org/webt/f-/rc/ad/f-rcadtwgu68ba6ad5wde2zke-m.jpeg"><br><br>  Para aplicar los cambios, reiniciamos el servicio del proveedor criptogr√°fico y verificamos su estado: <br><br><pre> <code class="plaintext hljs">/etc/init.d/cprocsp restart /etc/init.d/cprocsp status</code> </pre><br><img src="https://habrastorage.org/webt/vd/1a/th/vd1athcps5p7fe9cjp_ipmvvq-a.jpeg"><br><br><h3>  Configuraci√≥n y diagn√≥stico de CryptoPro CSP </h3><br>  Verifique si el proveedor criptogr√°fico ve nuestro token y otros tipos de medios disponibles con los siguientes comandos: <br><br> <code>/opt/cprocsp/bin/amd64/csptest -card -enum -v ‚Äìv</code> <br> <br><img src="https://habrastorage.org/webt/2m/z1/d4/2mz1d4m5oyvg9nknwbnci24wcre.jpeg"><br><br> <code>/opt/cprocsp/bin/amd64/csptest -enum -info -type PP_ENUMREADERS | iconv -f cp1251</code> <br> <br><img src="https://habrastorage.org/webt/i0/xw/ro/i0xwroly12wmu3ejps9udt4tvxs.png"><br><br> <code>/opt/cprocsp/sbin/amd64/cpconfig -hardware reader -view -f cp1251</code> <br> <br><img src="https://habrastorage.org/webt/id/qu/rm/idqurmsxvepldfelr_w9vakfbwu.jpeg"><br><br>  <b>Aladdin RD JaCarta [Interfaz SCR] (000000000000) 00 00</b> es nuestro medio. <br><br>  Siguiendo las instrucciones de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CryptoPro CSP para Linux.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configure</a> , realice su registro en el proveedor criptogr√°fico: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/sbin/amd64/cpconfig -hardware reader -add "Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"</code> </pre> <br><img src="https://habrastorage.org/webt/1v/xj/z_/1vxjz_h0nppdftdaeylhhobwt-a.png"><br><br>  Como resultado de la ejecuci√≥n en el archivo de configuraci√≥n <b>/etc/opt/cprocsp/config64.ini</b> <br>  se agregar√° una entrada a la secci√≥n [KeyDevices \ PCSC]: <br><br> <code>[KeyDevices\PCSC\"Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"\Default] <br></code> <br><br>  Para cumplir con los requisitos del formulario CryptoPro CSP, los t√©rminos de uso y la gu√≠a del administrador de seguridad: <br><blockquote>  No se permite el uso de CryptoPro CSP CIP versi√≥n 4.0 con el modo de control de clave mejorado desactivado.  La inclusi√≥n de este modo se describe en los documentos ZHTYA.00087-01 91 02. Gu√≠a del administrador de seguridad. </blockquote>  Es necesario habilitar un control mejorado del uso de la clave: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/sbin/amd64/cpconfig -ini '\config\parameters' -add long StrengthenedKeyUsageControl 1</code> </pre> <br>  Verifique que el modo est√© habilitado: <br><br> <code>cat /etc/opt/cprocsp/config64.ini | grep StrengthenedKeyUsageControl</code> <br> <br><img src="https://habrastorage.org/webt/lg/hn/mm/lghnmmk1d5g9xhmxgmyqjcsrddo.jpeg"><br><br>  Reiniciamos el servicio de proveedor criptogr√°fico: <br><br><pre> <code class="plaintext hljs">/etc/init.d/cprocsp restart /etc/init.d/cprocsp status</code> </pre><br>  Despu√©s del reinicio, verificamos que no haya errores en el trabajo del proveedor con operadores clave: <br><br> <code>/opt/cprocsp/bin/amd64/csptest -keyset ‚Äìverifycontext</code> <br> <br><img src="https://habrastorage.org/webt/qo/5x/v7/qo5xv7ayjfqa1ssyuds6dl-f-ue.jpeg"><br><br> <code>/opt/cprocsp/bin/amd64/csptest -keyset -verifycontext -enum ‚Äìunique</code> <br> <br><pre> <code class="plaintext hljs">CSP (Type:80) v4.0.9017 KC2 Release Ver:4.0.9944 OS:Linux CPU:AMD64 FastCode:REA AcquireContext: OK. HCRYPTPROV: 16052291 alfa_shark1 |SCARD\JACARTA_4E3900154029304C\CC00\E9F6 OK. Total: SYS: 0.000 sec USR: 0.000 sec UTC: 4.560 sec [ErrorCode: 0x00000000]</code> </pre><br><h3>  Trabajar con JaCarta PKI Token </h3><br>  Ejecutemos el programa Xming (reenv√≠o X11) en nuestra estaci√≥n para que podamos abrir y trabajar con las interfaces gr√°ficas de las utilidades necesarias a trav√©s de SSH. <br><br><img src="https://habrastorage.org/webt/-s/8j/r9/-s8jr9lfz0xkjurnsrgvwx71pfy.png"><br><br>  Despu√©s de instalar <b>IDProtectClient</b> - software para trabajar con JaCarta PKI, aparecieron dos archivos en el servidor en la carpeta <b>/ usr / share / aplicaciones</b> : <br><br>  Athena-IDProtectClient.desktop <br>  Athena-IDProtectManager.desktop <br><br>  Estos son accesos directos donde puede ver las opciones de inicio para las utilidades <i>Exec = / usr / bin / SACTools</i> <br><br>  Ejecute la utilidad <b>IDProtectPINTool</b> . <br><br>  Al usarlo, los c√≥digos de acceso PIN para el token se configuran y cambian. <br><br> <code>/usr/bin/IDProtectPINTool</code> <br> <br><img src="https://habrastorage.org/webt/wx/nf/-j/wxnf-jyonzkwr2hs2cnfy1wzxie.png"><br><br>  Al inicializar el token por primera vez, un enlace que contiene los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digos PIN (contrase√±as) de los proveedores de claves de forma predeterminada</a> ser√° √∫til <br><br>  El programa <b>IDProtect_Manager le</b> permite ver informaci√≥n sobre el token y el contenedor con claves y certificado: <br><br> <code>/usr/bin/IDProtect_Manager</code> <br> <br><img src="https://habrastorage.org/webt/nb/xb/ex/nbxbexx9njsuvpxawxszgs3lr8s.png"><br><br>  Para acceder al contenedor con las claves, debe ingresar la contrase√±a: <br><br><img src="https://habrastorage.org/webt/oh/pp/l_/ohppl_roac1knnwejckvd8afypy.png"><br><br><img src="https://habrastorage.org/webt/to/bh/vb/tobhvb23ey_zq2cdwp166-qrs5m.png"><br><br>  Para trabajar con <b>SafeNet Authentication Client eToken PRO,</b> existen programas similares: <b>SafeNet Authentication Client Monitor</b> y <b>SafeNet Authentication Client Tools</b> , que se ejecutan as√≠: <br><br><pre> <code class="plaintext hljs">/usr/bin/SACMonitor /usr/bin/SACTools</code> </pre><br><img src="https://habrastorage.org/webt/ox/kl/by/oxklbysagi4vqp8crlzbzpmbuv8.jpeg"><br><br>  Es m√°s conveniente realizar operaciones directamente con contenedores de claves en la interfaz del proveedor criptogr√°fico CryptoPro JavaCSP: <br><br> <code>/jdk1.8.0_181/jre/bin/java ru.CryptoPro.JCP.ControlPane.MainControlPane <br></code> <br><br><img src="https://habrastorage.org/webt/yj/fi/je/yjfije_eiqqx49g1s7lvwbcwtlc.jpeg"><br><br>  Para mostrar informaci√≥n sobre el contenido del contenedor con las teclas, puede ejecutar el comando: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/bin/amd64/csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00\alfa_shark1' -info</code> </pre> <br>  Para diagnosticar el contenedor, use el mismo comando con el interruptor ‚Äìcheck <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/bin/amd64/csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00\alfa_shark' ‚Äìcheck</code> </pre> <br>  Deber√° ingresar la contrase√±a para el contenedor: <br><br><img src="https://habrastorage.org/webt/m1/n4/cv/m1n4cvq78kcuqrfn1c7oxm9y3o4.png"><br><br><img src="https://habrastorage.org/webt/jr/vi/ga/jrvigahwffdkjcmfuwnwij4pdds.jpeg"><br><br><h3>  Recuperaci√≥n de clave de software </h3><br>  En general, un ejemplo de recuperaci√≥n de una clave privada y un certificado de clave p√∫blica de un contenedor en un token utilizando CryptoPro Java CSP es el siguiente: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.CryptoPro.JCP.KeyStore.JCPPrivateKeyEntry; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.CryptoPro.JCP.params.JCPProtectionParameter; KeyStore keyStore = KeyStore.getInstance(<span class="hljs-string"><span class="hljs-string">"Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"</span></span>, <span class="hljs-string"><span class="hljs-string">"JCSP"</span></span>); keyStore.load(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); JCPPrivateKeyEntry entry = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; X509Certificate certificate = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; PrivateKey privateKey = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { entry = (JCPPrivateKeyEntry) keyStore.getEntry(keyAlias, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JCPProtectionParameter(pwd)); certificate = (X509Certificate) entry.getCertificate(); privateKey = entry.getPrivateKey(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnrecoverableEntryException | NullPointerException e) { LOGGER.log(Level.WARNING, PRIVATE_KEY_NOT_FOUND + keyAlias + ExceptionUtils.getFullStackTrace(e)); }</code> </pre><br><br>  Si act√∫as as√≠: <br><br><pre> <code class="java hljs">Key key = keyStore.getKey(keyAlias, pwd);</code> </pre><br>  entonces el proveedor criptogr√°fico intentar√° mostrar una solicitud para ingresar la contrase√±a al contenedor a trav√©s de la consola o la ventana de la GUI. <br><br><h3>  Resultados </h3><br>  El token del portador de la clave de token se instala en el puerto USB interno del servidor. <br><br>  El hardware del servidor en s√≠ est√° sellado y colocado en una habitaci√≥n con acceso limitado. <br><br>  Dichas medidas pueden aumentar el nivel de protecci√≥n de nuestros sistemas de informaci√≥n contra el robo y el compromiso de la firma electr√≥nica o las claves de cifrado, tanto de forma remota a trav√©s de la red como f√≠sicamente. <br><br><h3>  Enlaces utiles </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Documentaci√≥n de Aladdin-RD JaCarta</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki.astralinux.ru - Trabaja con CryptoPro CSP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La lista de c√≥digos de error del modelo de objetos de los componentes de los c√≥digos de error COM de Microsoft (seguridad y configuraci√≥n)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CryptoPro CSP 4.0 CSP 4.0 FCN (Gemalto)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Utilidad de diagn√≥stico de lector de pcsc-tools de seguridad: proyecto de tarjeta chip (software.opensuse.org)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CryptoPro CSP para Linux.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Personalizaci√≥n</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PIN de portador de clave predeterminado de Aladdin-RD (contrase√±as)</a> <br></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/441212/">https://habr.com/ru/post/441212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../441202/index.html">¬øLas empresas de servicios sue√±an con sus productos? Conversaci√≥n con Maxilect</a></li>
<li><a href="../441204/index.html">Un enfoque avanzado para detectar l√≠mites utilizando paredes de vasos como ejemplo</a></li>
<li><a href="../441206/index.html">Wolfensteiny 3D - ingenier√≠a inversa 251 bytes de JavaScript</a></li>
<li><a href="../441208/index.html">C√≥mo redujimos la emisi√≥n de pr√©stamos a 2 clics</a></li>
<li><a href="../441210/index.html">Cluster Storage Pacemaker + DRBD (Dual primario) + samba</a></li>
<li><a href="../441214/index.html">Gu√≠a del usuario de Kibana. Visualizaci√≥n. Parte 1</a></li>
<li><a href="../441216/index.html">¬øEspejo negro o anuncio Picooc?</a></li>
<li><a href="../441218/index.html">OpenAI Gym + ROS + Gazebo: entrenando un robot independiente en casa. Parte 1</a></li>
<li><a href="../441220/index.html">An√°lisis de ataques masivos recientes con captura de DNS</a></li>
<li><a href="../441222/index.html">¬øPor qu√© Kubernetes es tan complicado con los repositorios?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>