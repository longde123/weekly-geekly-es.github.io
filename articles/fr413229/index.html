<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüëß‚Äçüëß üí™üèΩ üè§ Build Caffe sur Google Colaboratory: carte graphique gratuite dans le cloud üèúÔ∏è ü§∑ ü§°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Google Colaboratory est un service cloud r√©cemment lanc√© visant √† simplifier la recherche en apprentissage automatique et en apprentissage profond. En...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Build Caffe sur Google Colaboratory: carte graphique gratuite dans le cloud</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413229/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Google Colaboratory</a> est un service cloud r√©cemment lanc√© visant √† simplifier la recherche en apprentissage automatique et en apprentissage profond.  En utilisant le Colaboratory, vous pouvez acc√©der √† distance √† une machine avec une carte vid√©o connect√©e, et c'est enti√®rement gratuit, ce qui simplifie consid√©rablement la vie lorsque vous devez former des r√©seaux de neurones profonds.  Nous pouvons dire qu'il s'agit d'un analogue des documents Google pour le bloc-notes Jupyter. <br><br>  Colaboratory a pr√©install√© Tensorflow et presque toutes les biblioth√®ques Python n√©cessaires pour travailler.  Si un paquet est manquant, il est facilement install√© sur le pouce via <code>pip</code> ou <code>apt-get</code> .  Mais que se passe-t-il si vous devez cr√©er un projet √† partir de la source et vous connecter au GPU?  Il s'av√®re que cela peut ne pas √™tre si simple que je l'ai d√©couvert lors de la construction de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SSD-Caffe</a> .  Dans cette publication, je donnerai une br√®ve description du Colaboratoire, d√©crirai les difficult√©s rencontr√©es et comment les r√©soudre, ainsi que quelques astuces utiles. <br><br>  Tout le code est disponible dans mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://vk.com/away.php%3Futf%3D1%26to%3D">carnet de colaboratoire</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b0/fv/v8/b0fvv8egfxlwczpdifnoyazgfng.png"></div><a name="habracut"></a><br><h2>  En bref sur le colaboratoire </h2><br>  En gros, Colaboratory vous permet d'ex√©cuter Jupyter Notebook sur une machine distante.  Les fichiers de collaboration sont des "ordinateurs portables" .ipynb ordinaires et sont stock√©s sur le disque Google.  Il existe √©galement un ensemble de fonctions qui vous permettent de t√©l√©charger des fichiers depuis une machine distante vers le disque Google et vice versa.  Vous pouvez √©galement partager ces fichiers avec d'autres, vous pouvez y √©crire des commentaires, comme dans les documents Google. <br><br>  Dans le Colaboratory, vous pouvez utiliser le GPU, √† savoir le Tesla K80.  Pour ce faire, connectez-le dans les param√®tres: Runtime <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.845ex" height="2.419ex" viewBox="0 -780.1 5100 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-72" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-69" x="701" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-67" x="1047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-68" x="1527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-74" x="2104" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-61" x="2465" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-72" x="2995" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-72" x="3446" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-6F" x="3898" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-77" x="4383" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> \ rightarrow </script>  Modifier le type d'ex√©cution <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.845ex" height="2.419ex" viewBox="0 -780.1 5100 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-72" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-69" x="701" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-67" x="1047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-68" x="1527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-74" x="2104" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-61" x="2465" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-72" x="2995" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-72" x="3446" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-6F" x="3898" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/413229/&amp;usg=ALkJrhi-9sd1b2M3MljSySraKKF_uIZAsg#MJMATHI-77" x="4383" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>r</mi><mi>o</mi><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> \ rightarrow </script>  Acc√©l√©rateur mat√©riel.  Il convient de noter que les GPU ne sont pas toujours disponibles, puis le Colaboratory proposera de d√©marrer la machine sans elle. <br><br>  Il semble que rien ne puisse d√©marrer sauf le Jupyter Notebook lui-m√™me, mais il y a un acc√®s indirect au terminal: pour cela, vous devez ajouter un point d'exclamation devant la commande du terminal, par exemple <code>!mkdir images</code> .  En g√©n√©ral, nous pouvons supposer que nous avons affaire √† une machine ordinaire parfaite sur laquelle Ubuntu 17.10 est install√© (au moment de la r√©daction), mais connect√© √† distance.  Il s'ensuit que tout ce qui peut √™tre fait via le terminal (pas de mani√®re interactive) peut √™tre fait sur celui-ci, y compris: <br><br><ul><li>  cloner des r√©f√©rentiels √† l'aide de <code>git clone</code> , </li><li>  charger des donn√©es √† l'aide de <code>wget</code> (d'ailleurs, m√™me les gros fichiers sont charg√©s presque instantan√©ment √† partir d'un disque Google), </li><li>  utilisez <code>make</code> (et probablement <code>cmake</code> ) </li><li>  installer des outils et des biblioth√®ques en utilisant <code>apt-get</code> et <code>pip</code> </li></ul><br>  Quelques commentaires suppl√©mentaires sur le Colaboratoire: <br><br><ul><li>  Il semble que l'utilisateur ait un acc√®s illimit√© √† tous les fichiers du syst√®me (toutes les commandes doivent √™tre √©crites sans <code>sudo</code> ); </li><li>  L'√©tat terminal n'est pas transf√©r√© entre les √©quipes, m√™me si elles sont dans la m√™me cellule (par exemple, <code>cd dir</code> si n√©cessaire, vous devrez √©crire au d√©but de chaque commande); </li><li>  Si vous vous d√©connectez du Colaboratory pendant une longue p√©riode, toutes les modifications de la machine virtuelle seront effac√©es, y compris tous les packages install√©s et les fichiers t√©l√©charg√©s.Par cons√©quent, il est recommand√© que l'installation des packages soit incluse dans le bloc-notes Jupyter; </li><li>  Apr√®s 12 heures d'utilisation continue, la machine s'√©teint automatiquement, mais elle peut ensuite √™tre red√©marr√©e (en th√©orie, dans la pratique, le GPU peut ne pas √™tre disponible). </li></ul><br><h2>  Construction SSD-Caffe </h2><br>  Je voulais essayer le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Single Shot Detector (SSD)</a> , √† savoir son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">impl√©mentation Caffe</a> dans Google Colaboratory, mais pour cela, le projet devait √™tre assembl√© √† partir de la source. <br><br>  Soit dit en passant, si une version de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Caffe</a> vous convient, il existe un moyen beaucoup plus simple (cela fonctionne m√™me, bien que je n'aie rien essay√©): <br><br><pre> <code class="bash hljs">!apt install caffe-cuda</code> </pre> <br>  Assembler SSD-Caffe √† partir de la source est une qu√™te assez longue en plusieurs √©tapes, qui ne peut √™tre effectu√©e qu'avec des b√©quilles. <br><br>  <b>√âtape 1: installation des d√©pendances</b> <br><br>  Ici, nous devons t√©l√©charger toutes les d√©pendances pour Caffe en utilisant <code>apt</code> .  Cependant, avant de faire cela, vous devez autoriser <code>apt</code> √† t√©l√©charger le code source des d√©pendances.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le guide d'installation de Caffe</a> indique que cela n√©cessite une ¬´ligne deb-src dans le fichier sources.list¬ª.  Malheureusement, il n'y a aucun d√©tail l√†-bas, donc je viens de d√©commenter toutes les lignes <code>deb-src</code> dans le fichier <code>/etc/apt/sources.list</code> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/etc/apt/sources.list'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: txt = f.read() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/etc/apt/sources.list'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(txt.replace(<span class="hljs-string"><span class="hljs-string">'# deb-src'</span></span>,<span class="hljs-string"><span class="hljs-string">'deb-src'</span></span>))</code> </pre><br>  Et √ßa a march√©.  Il ne reste plus qu'√† t√©l√©charger les d√©pendances: <br><br><pre> <code class="bash hljs">!apt update !apt build-dep caffe-cuda</code> </pre><br>  <b>√âtape 2: besoin d'un autre compilateur</b> <br><br>  Ici, le probl√®me est le suivant: <code>g++-7</code> , qui est la valeur par d√©faut, est pour une raison quelconque incompatible avec le compilateur <code>nvcc</code> CUDA, vous devez donc utiliser autre chose.  J'ai t√©l√©charg√© <code>g++-5</code> et en ai fait le compilateur par d√©faut: <br><br><pre> <code class="bash hljs">!apt install g++-5 !update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 20 !update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-5 20</code> </pre><br>  <b>√âtape 3: avoir √† construire un boost</b> <br><br>  Si vous essayez de construire Caffe √† ce stade, des probl√®mes surviendront lorsque vous essayez de connecter boost, car il a √©t√© construit par un autre compilateur, vous devez donc t√©l√©charger ses sources et √©galement construire en utilisant <code>g++-5</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus sur le site web de boost</a> ): <br><br><pre> <code class="bash hljs">!wget https://dl.bintray.com/boostorg/release/1.67.0/<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>/boost_1_67_0.tar.bz2 !tar --bzip2 -xf boost_1_67_0.tar.bz2 !<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> boost_1_67_0 &amp;&amp; ./bootstrap.sh --<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>-prefix=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> --with-libraries=system,filesystem,regex,thread,python --with-python-version=2.7 --with-python-root=/usr !<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> boost_1_67_0 &amp;&amp; ./b2 install</code> </pre><br>  <b>√âtape 4: Configurer le Makefile</b> <br><br>  Clone Caffe avec GitHub: <br><br><pre> <code class="bash hljs">!git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/weiliu89/caffe.git &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> caffe &amp;&amp; git checkout ssd</code> </pre><br>  Et nous changeons les champs n√©cessaires dans Makefile.config - J'ai chang√© le chemin d'acc√®s √† CUDA, chang√© l'option BLAS, chang√© la version d'OpenCV en une troisi√®me, ajout√© une couche Python et ajout√© √©galement tous les chemins d'acc√®s aux biblioth√®ques qui ont √©t√© install√©es, mais pour une raison quelconque, ils n'ont pas √©t√© trouv√©s (tout cela est pratique) fait en utilisant Python): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'caffe/Makefile.config.example'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: config = f.read() comment = [<span class="hljs-string"><span class="hljs-string">'CUDA_DIR := /usr/local/cuda'</span></span>, <span class="hljs-string"><span class="hljs-string">'BLAS := open'</span></span>] uncomment = [<span class="hljs-string"><span class="hljs-string">'# CUDA_DIR := /usr'</span></span>, <span class="hljs-string"><span class="hljs-string">'# BLAS := atlas'</span></span>, <span class="hljs-string"><span class="hljs-string">'# OPENCV_VERSION := 3'</span></span>, <span class="hljs-string"><span class="hljs-string">'# WITH_PYTHON_LAYER := 1'</span></span>] <span class="hljs-comment"><span class="hljs-comment"># replace = [('INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include', 'INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/local/include /usr/include/hdf5/serial /usr/local/lib/python2.7/dist-packages/numpy/core/include/'), ('LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib', 'LIBRARY_DIRS := $(PYTHON_LIB) /usr/local/lib /usr/lib /usr/lib/x86_64-linux-gnu/hdf5/serial')] for c in uncomment: config = config.replace(c, c[2:]) for c in comment: config = config.replace(c, '# '+c) for c1,c2 in replace: config = config.replace(c1, c2) with open('caffe/Makefile.config', 'w') as f: f.write(config)</span></span></code> </pre><br>  De plus, dans le Makefile lui-m√™me, j'ai d√ª remplacer toutes les balises <code>-isystem</code> par <code>-I</code> : les deux sont responsables de la recherche des en-t√™tes, mais ils sont trait√©s un peu diff√©remment, et sans ce remplacement, des probl√®mes se sont d√©j√† produits lorsque stdlib √©tait connect√© ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus de d√©tails ici</a> ): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'caffe/Makefile'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: mfile = f.read() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'caffe/Makefile'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(mfile.replace(<span class="hljs-string"><span class="hljs-string">'-isystem'</span></span>,<span class="hljs-string"><span class="hljs-string">'-I'</span></span>))</code> </pre><br>  <b>√âtape 5: Construire</b> <br><br>  Il restait une derni√®re b√©quille - pour corriger le <code>c++config.h</code> , sinon il y a des probl√®mes avec les types nan ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus</a> ): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/usr/include/x86_64-linux-gnu/c++/5/bits/c++config.h'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: txt = f.read() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'/usr/include/x86_64-linux-gnu/c++/5/bits/c++config.h'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(txt.replace(<span class="hljs-string"><span class="hljs-string">'/* #undef _GLIBCXX_USE_C99_MATH */'</span></span>, <span class="hljs-string"><span class="hljs-string">'/* #undef _GLIBCXX_USE_C99_MATH */\n#define _GLIBCXX_USE_C99_MATH 1'</span></span>))</code> </pre><br>  Maintenant, en fait, vous pouvez construire Caffe: <br><br><pre> <code class="bash hljs">!<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> caffe &amp;&amp; make -j8 &amp;&amp; make pycaffe &amp;&amp; make <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> -j8 &amp;&amp; make distribute !<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig !<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> /content/caffe/distribute/lib &gt;&gt; /etc/ld.so.conf &amp;&amp; ldconfig</code> </pre><br>  Les deux derni√®res lignes ajoutent les chemins de biblioth√®que, √† savoir boost et Caffe. <br><br>  Maintenant, Caffe peut √™tre utilis√© (il vous suffit de sp√©cifier le chemin d'acc√®s √† celui-ci dans PYTHONPATH): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys caffe_path = !cd caffe/python &amp;&amp; pwd sys.path.insert(<span class="hljs-number"><span class="hljs-number">0</span></span>, caffe_path[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> caffe</code> </pre><br>  Pour le tester, j'ai test√© le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mobilenet-SSD</a> : le code est √©galement dans mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://vk.com/away.php%3Futf%3D1%26to%3D">carnet de colaboratoire</a> . <br><br>  En particulier, j'ai mesur√© le temps de pr√©diction pour une image, et l'acc√©l√©ration sur le GPU √©tait d'environ 3,8. <br><br><h2>  Bonus: quelques astuces utiles </h2><br>  Il existe un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">excellent tutoriel</a> sur Medium sur Google Colaboratory.  Dans le Colaboratory m√™me, il y a des fichiers avec des exemples de presque tout ce qui peut √™tre n√©cessaire. <br><br>  Montez un disque Google dans le syst√®me de fichiers d'une machine virtuelle: <br><br><pre> <code class="bash hljs">!apt-get install -y -qq software-properties-common python-software-properties module-init-tools !add-apt-repository -y ppa:alessandro-strada/ppa 2&gt;&amp;1 &gt; /dev/null !apt-get update -qq 2&gt;&amp;1 &gt; /dev/null !apt-get -y install -qq google-drive-ocamlfuse fuse from google.colab import auth auth.authenticate_user() from oauth2client.client import GoogleCredentials creds = GoogleCredentials.get_application_default() import getpass !google-drive-ocamlfuse -headless -id={creds.client_id} -secret={creds.client_secret} &lt; /dev/null 2&gt;&amp;1 | grep URL vcode = getpass.getpass() !<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> {vcode} | google-drive-ocamlfuse -headless -id={creds.client_id} -secret={creds.client_secret}</code> </pre><br>  Ce code renverra le lien et donnera une fen√™tre d'entr√©e.  Vous devez suivre le lien, copier le code et le saisir dans la fen√™tre.  Pour une raison quelconque, je dois le faire deux fois.  Suivant: <br><br><pre> <code class="bash hljs">!mkdir -p drive !google-drive-ocamlfuse drive</code> </pre><br>  Apr√®s cela, vous pouvez utiliser votre disque Google comme r√©pertoire normal.  De plus, toutes les modifications de ce r√©pertoire sont automatiquement synchronis√©es avec Google Drive. <br><br>  Installation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Keras</a> : <br><br><pre> <code class="python hljs">!pip install -q keras <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> keras</code> </pre><br>  Installez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PyTorch</a> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> path <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wheel.pep425tags <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_abbr_impl, get_impl_ver, get_abi_tag platform = <span class="hljs-string"><span class="hljs-string">'{}{}-{}'</span></span>.format(get_abbr_impl(), get_impl_ver(), get_abi_tag()) accelerator = <span class="hljs-string"><span class="hljs-string">'cu80'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> path.exists(<span class="hljs-string"><span class="hljs-string">'/opt/bin/nvidia-smi'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">'cpu'</span></span> !pip install -q http://download.pytorch.org/whl/{accelerator}/torch<span class="hljs-number"><span class="hljs-number">-0.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.post4-{platform}-linux_x86_64.whl torchvision <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch</code> </pre><br>  Changer le r√©pertoire de travail: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os os.chdir(<span class="hljs-string"><span class="hljs-string">"/path/to/wdir"</span></span>)</code> </pre><br>  Effacez toutes les modifications et red√©marrez la machine: <br><br><pre> <code class="bash hljs">!<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> -9 -1</code> </pre> <br>  T√©l√©chargez le fichier sur la machine locale: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.colab <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> files files.download(<span class="hljs-string"><span class="hljs-string">'file.ext'</span></span>)</code> </pre><br>  Obtenez le dictionnaire des fichiers t√©l√©charg√©s sur le disque Google: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.colab <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> files uploaded = files.upload()</code> </pre><br>  Couper la sortie de la commande du terminal (rediriger vers la variable): <br><br><pre> <code class="python hljs">lines_list = !pwd</code> </pre><br>  En g√©n√©ral, Google Colaboratory offre une bonne occasion de mener une formation sur les r√©seaux de neurones dans le cloud.  Certes, cela peut ne pas √™tre suffisant pour les tr√®s grandes grilles.  Un autre avantage est la possibilit√© d'ex√©cuter du code ind√©pendamment du syst√®me d'exploitation local (ce qui est bon pour la reproductibilit√©), et √©galement de travailler ensemble sur le m√™me projet.  En guise de hic, le GPU peut ne pas √™tre disponible, y compris pendant longtemps. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413229/">https://habr.com/ru/post/fr413229/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413219/index.html">Bienvenue sur le SuperJob QA-Meetup</a></li>
<li><a href="../fr413221/index.html">Les bact√©ries survivent dans une "salle blanche" pendant l'assemblage du vaisseau spatial, en mangeant des produits de nettoyage</a></li>
<li><a href="../fr413223/index.html">Dictionnaire Habra. Partie 1</a></li>
<li><a href="../fr413225/index.html">Semaine de la s√©curit√© 20: cyberattaques non triviales</a></li>
<li><a href="../fr413227/index.html">Qu'est-ce que Dieu sous les v√™tements</a></li>
<li><a href="../fr413231/index.html">Introduction aux contrats intelligents</a></li>
<li><a href="../fr413233/index.html">Le service uLogin envoie les donn√©es des formulaires (courrier, t√©l√©phone) √† un site tiers et ne dit rien √† ce sujet</a></li>
<li><a href="../fr413235/index.html">Parier sur de meilleures pr√©visions: de nouvelles math√©matiques des pr√©visions m√©t√©orologiques</a></li>
<li><a href="../fr413237/index.html">Facebook nie avoir envoy√© aux fabricants d'appareils les m√™mes donn√©es que le d√©veloppeur Alexander Kogan</a></li>
<li><a href="../fr413239/index.html">Comment rendre un smartphone un peu idiot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>