<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐คฉ ๐ ๐ธ Boost.Spirit ุ ุฃู ุฅุถุงูุฉ "ุงูุฑูุญุงููุฉ" ุฅูู ูุงุฆูุฉ ุงููุฑุดุญุงุช ๐จ๐ปโ๐ฌ ๐ง๐ฟ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููู ุฌูุฏ ูุง ุฒููุงุฆู. ูุง ุฒูุช ูุทูุฑูุง ููุธุงู ISPsystem ุ ููุง ูุฒุงู ุงุณูู ุฏููุชุฑู ุณููุฑููู. ูุจุนุถ ุงูููุช (ุฅูู ุญุฏ ูุง) ูู ุฃุณุชุทุน ุงุชุฎุงุฐ ูุฑุงุฑ ุจุดุฃู ููุถูุน ุงูููุดูุฑ ุงูุชุงูู ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Boost.Spirit ุ ุฃู ุฅุถุงูุฉ "ุงูุฑูุญุงููุฉ" ุฅูู ูุงุฆูุฉ ุงููุฑุดุญุงุช</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ispsystem/blog/472004/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/qv/yu/6-/qvyu6-kaqci3ha5ivctj0nvbwco.png" alt="ุตูุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ููู ุฌูุฏ ูุง ุฒููุงุฆู.  ูุง ุฒูุช ูุทูุฑูุง ููุธุงู ISPsystem ุ ููุง ูุฒุงู ุงุณูู ุฏููุชุฑู ุณููุฑููู.  ูุจุนุถ ุงูููุช (ุฅูู ุญุฏ ูุง) ูู ุฃุณุชุทุน ุงุชุฎุงุฐ ูุฑุงุฑ ุจุดุฃู ููุถูุน ุงูููุดูุฑ ุงูุชุงูู ุ ุญูุซ ุชุฑุงููุช ุงููุซูุฑ ูู ุงูููุงุฏ ุฎูุงู ุงูุฃุดูุฑ ุงููุงุถูุฉ ูู ุงูุนูู ูุน Boost.Asio.  ูุญุชู ูู ุชูู ุงููุญุธุฉ ุงูุชู ุจุฏุง ูููุง ุฃูู ูู ุงูุณูู ุฑูู ุนููุฉ ูุนุฏููุฉ ุ ูุฅู ูููุฉ ูุงุญุฏุฉ ุบูุฑุช ูู ุดูุก.  ูุงู ูู ุงูุถุฑูุฑู ุชุทููุฑ ุฃุฏุงุฉ ุชุณูุญ ูููุงุฌูุฉ ุงูุฃูุงููุฉ ุจุชุฑุดูุญ ุงูุจูุงูุงุช ูู ุงูููุงุฆู ุงููุทููุจุฉ.  ุงููุงุฆูุฉ ููุณูุง ูู ุงูุฎูููุฉ ูู json_array ุนุงุฏูุฉ.  ูุฑุญุจูุง ุจู ูู ูุงุช ุ ูููุงู ูู ุงูุตุนูุฏ ูุงููุจูุท ูู ุงูุฃูุงู ุงูุฃุฎูุฑุฉ. </p><a name="habracut"></a><br><h3 id="diskleymer" style=";text-align:right;direction:rtl">  ุชูุตู </h3><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุฃููู ุนูู ุงูููุฑ ุฃู ุขุฎุฑ ูุฑุฉ "ุดุนุฑุช" ุงููุคูู ุจูุง ูุซู ุงูููุงุนุฏ ุงูุฎุงููุฉ ูู ุงูุณูุงู ูุจู ุนุดุฑ ุณููุงุช.  ุจุนุฏ ุฐูู ุจุฏุง ุงูุฃูุฑ ููุฃูู ููุน ูู ุงูุฃุฏูุงุช ุบูุฑ ุงููุฏุจุจุฉ ูุบูุฑ ุงูุถุฑูุฑูุฉ ุ ููููู ุนููุช ุนู ููุชุจุฉ Boost.Spirit ูู ููุณ ููู ุจูุงู ุงููุดููุฉ. </p><br><h3 id="zadacha" style=";text-align:right;direction:rtl">  ูููุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุชุญุชุงุฌ ุฅูู ุชุญููู ุงุณุชุนูุงู ูุซู: </p><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs">(string_field CP value AND int_field NOT LT <span class="hljs-number"><span class="hljs-number">150</span></span>) OR bool_field EQ <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุจุนุถ ุงูููุงูู ุงูุชู ุชุญูู ูุงุฆู json ูุงูุฅุจูุงุบ ุนูุง ุฅุฐุง ูุงู ููู ุจุงููุชุทูุจุงุช ุฃู ูุง. </p><br><h3 id="pervye-shagi" style=";text-align:right;direction:rtl">  ุงูุฎุทูุงุช ุงูุฃููู </h3><br><p style=";text-align:right;direction:rtl">  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ูุงุฌูุฉ ุนุงูู ุงูุชุตููุฉ ูู ุงููุณุชูุจู.  ูู ุงูุถุฑูุฑู ุฅุฒุงูุฉ ุงููุงุฆูุงุช ุบูุฑ ุงูุถุฑูุฑูุฉ ูู ุงูุตููู ุ ูุฐูู ูุฌุจ ุฏูุฌูุง ูุน ุฎูุงุฑุฒููุงุช STL ุ ูุฎุงุตุฉ std :: remove_if. </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ุงููุดุบูู ูุซุงููุงู ุ ูุณูุชู ุจูุงุคู ูุจุงุดุฑุฉู ูู ุงูุทูุจ ุงูููุฏู ูู ุงูุฃูุงู.  ูุธุฑูุง ูุฃู ุงููุดุฑูุน ูุณุชุฎุฏู nlohmann :: json ุ ุณูููู ุงูุชุตููู ุฃููููุง ุชูุงููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">filter = <span class="hljs-string"><span class="hljs-string">"(string_field CP value AND int_field NOT LT 150) OR bool_field EQ true"</span></span>; json.erase(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::remove_if(json.begin(), json.end(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::not_fn(JsonFilter{filter})), json.end());</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงุณุชุฎุฏุงู ุงููุฑูุญ ูููุฑุดุญ ุ ุงุฎุชุฑุช ุชูุณูู ุงูุธุฑูู ุฅูู ุดุฌุฑุฉ ุซูุงุฆูุฉ.  ูุฌุจ ุฃู ุชุญุชูู ุฃุฏูู ุงูููู ุนูู ุนูุงูู ููุงุฑูุฉ ุ ูููู ูุฌุจ ุฃู ุชููู ุงูุจููุฉ ูุดุบูุงุช ููุทููุฉ.  ูุฐู ูู ุงูุทุฑููุฉ ุงูุชู ุณูุจุฏู ูููุง ุงููุฑุดุญ ุฃุนูุงู ูู ุญุงูุฉ ุชูููููุง: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/if/yc/zk/ifyczkjiznmiebrxvof3oxgnur4.jpeg" alt="ุชุตููุฉ ุดุฌุฑุฉ"></p><br><p style=";text-align:right;direction:rtl">  ูุงูุช ุงููุชูุฌุฉ ุดููุงู ูู ุฃุดูุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">AST</a> ุ ุฅุฐุง ููุช ุชุณุชุทูุน ุชุณููุชูุง.  ุงูุขู ุจุนุฏ ุฃู ุฃุฎุฐุช ุตูุฑุฉ ุงูููุทู ุงููุงุฏู ูู ุงูุชุจููุฑ ุ ููุฏ ุญุงู ุงูููุช ููุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูุงูุฑููุจุฉ.  ูุฌุจ ุฃู ูููู ูุฐุง ููุชูุจ ... ุนูู ุงูุฑูุญ ... </p><br><h3 id="znakomstvo" style=";text-align:right;direction:rtl">  ูุนุฑูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุดุฃ ุฃุตุนุจ ุณุคุงู: ูู ุฃูู ูุจุฏุฃุ  ุจุฎูุงู Asio ุ ูุฅู ูุฑุงุกุฉ ุฑุคูุณ Spirit ูู ุชูุฏู ุฃู ุฃุฏูุฉ ูุงุถุญุฉ ุ ุจูุนูู ุขุฎุฑ - ููุงู "ููุน ูู ุงูุณุญุฑ".  ูุฃุนูุจ ุฐูู ุฏุฑุงุณุฉ ููุฃูุซูุฉ ูู ุงููุซุงุฆู ุงูุฑุณููุฉ ููุฏูุนุฉ ูุฌููุน ุฃููุงุน ุงูุฃูุซูุฉ ุนูู ุงูุดุจูุฉ ุ ูุงูุชู ูู ุชุฌูุจ ุจุนุฏ ุซูุงุฑูุง ุจุนุฏ ููุช ูุญุณุจ ุ ุจู ุญููุง ุฃูุฑุจ ูุง ูููู ูุงุญุชูุงุฌุงุชู: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">AST calculator</a> </p><br><p style=";text-align:right;direction:rtl">  ููููู ูุธุฑุฉ ุนูู ุงูููุงุนุฏ ุงูููุฌูุฏุฉ ูู ุงููุซุงู: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุญุงุณุจุฉ ุงูููุงุนุฏ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArithmeticGrammar1</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> qi::grammar&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator, ASTNodePtr(), qi::space_type&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Iterator = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator; ArithmeticGrammar1() : ArithmeticGrammar1::base_type(start) { start = (product &gt;&gt; <span class="hljs-string"><span class="hljs-string">'+'</span></span> &gt;&gt; start) [qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'+'</span></span>&gt;&gt; (qi::_1, qi::_2)] | product[qi::_val = qi::_1]; product = (factor &gt;&gt; <span class="hljs-string"><span class="hljs-string">'*'</span></span> &gt;&gt; product) [qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'*'</span></span>&gt;&gt; (qi::_1, qi::_2)] | factor[qi::_val = qi::_1]; factor = group[qi::_val = qi::_1] | qi::int_[qi::_val = phx::new_&lt;ConstantNode&gt;(qi::_1)]; group %= <span class="hljs-string"><span class="hljs-string">'('</span></span> &gt;&gt; start &gt;&gt; <span class="hljs-string"><span class="hljs-string">')'</span></span>; } qi::rule&lt;Iterator, ASTNodePtr(), qi::space_type&gt; start, group, product, factor; };</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ููุฑูุซุฉ ุงูููุงุนุฏ ูู ุงูุฃุณุงุณ :: ุงูููุงุนุฏ.  <em>ASTNodePtr ()</em> ููุณุช ุทุฑููุฉ ูุงุถุญุฉ ูููููุง ูุฑูุญุฉ ููุบุงูุฉ ูุชูุฑูุฑ ูุงุฆู ุงููุชูุฌุฉ ุงููุชููุนุฉ ุฅูู ูุงุฆู ูุญูู. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">AST ุขูุฉ ุญุงุณุจุฉ ุงูุนูุฏุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ASTNode</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~ASTNode() {} }; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ASTNodePtr = ASTNode*; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> Operator&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OperatorNode</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ASTNode { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: OperatorNode(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ASTNodePtr &amp;left, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ASTNodePtr &amp;right) : left(left) , right(right) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operator == <span class="hljs-string"><span class="hljs-string">'+'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left-&gt;evaluate() + right-&gt;evaluate(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Operator == <span class="hljs-string"><span class="hljs-string">'*'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left-&gt;evaluate() * right-&gt;evaluate(); } ~OperatorNode() { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> left; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> right; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: ASTNodePtr left, right; <span class="hljs-comment"><span class="hljs-comment">//  }; class ConstantNode : public ASTNode { public: ConstantNode(double value) : value(value) {} double evaluate() { return value; } private: double value; };</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ููุชุจุฉ Boost.Phoenix ุ ููููู ุฅูุดุงุก ุนูุฏุฉ AST ุฌุงูุฒุฉ ูู ูุงุญุฏ ุฃู ุนุฏุฉ ุฃุทุฑุงู ุบูุฑ ูุจุงุดุฑุฉ ุฃุซูุงุก ุงูุชุญููู ูุงููุชุงุจุฉ ูุจุงุดุฑุฉ ุฅูู ุงููุชูุฌุฉ.  ุฏุนููุง ูููู ูุธุฑุฉ ูุงุญุตุฉ ุนูู ูุง ุชุชููู ุขูุฉ ุญุงุณุจุฉ ูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">start = (product &gt;&gt; <span class="hljs-string"><span class="hljs-string">'+'</span></span> &gt;&gt; start)[qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'+'</span></span>&gt;&gt; (qi::_1, qi::_2)] | product[qi::_val = qi::_1];</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุจุฏุก - ุงูุจุฏุก ูู ุชุญููู ุงูุฌููุฉ.  ููุทุฉ ุงูุงูุทูุงู.  ูููู ุงูุชุนุจูุฑ ุนููุง ูู ุฎูุงู ูุฌููุน ุงูููุชุฌ ูุงูุจุฏุก ุ ุฃู ูู ุฎูุงู ุงูููุชุฌ ุจุจุณุงุทุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุงุญุธ ุงูุฅุฌุฑุงุก ุจูู ููุณูู ูุนููููู ููู ุชุนุจูุฑ.  ูุฐุง ูู ุงูุฅุฌุฑุงุก ุงูุฐู ูุฌุจ ุชูููุฐู ุฅุฐุง ูุฌุญ ุงูุชุญููู ุ ุฅุฐุง ูุงู ูู ุดูุก ูุทุงุจููุง.  <em>qi :: _ val</em> ูู ูู ุงููุงูุน <em>ุฒูุงุฏุฉ :: spirit :: qi :: _ val</em> ุนูุตุฑ ูุงุฆุจ.  ูุน ูุณุงุนุฏุชูุง ุ ุณูุชู ุชุณุฌูู ุงูุฅุฌุงุจุฉ ูู ุงููุชูุฌุฉ.  ูู ุญุงูุฉ ุงูุจุฏุก ุ ุณูููู ูุฐุง ูู ูุงุฆู OperatorNode ุ ูุณุชููู ุญุฌูุชู ุงูุฃููู ูุชูุฌุฉ ุชุญููู ุงูููุชุฌ ุ ูุงูุซุงูู ูู ูุชูุฌุฉ ุจุฏุก ุงูุชุญููู. </p><br><p style=";text-align:right;direction:rtl">  ูุญู ููุธุฑ ุฃุจุนุฏ ูู ุฐูู.  ูููุชุฑุถ ุฃููุง ุตุงุฏููุง ุงูุฎูุงุฑ ุงูุซุงูู ุ ูุงูุจุฏุก ููุณ ูุจูุบูุง ุ ุจู ููุชุฌ.  ููู ูุชู ุงูุชุนุจูุฑ ุนููุ </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">product = (factor &gt;&gt; <span class="hljs-string"><span class="hljs-string">'*'</span></span> &gt;&gt; product) [qi::_val = phx::new_&lt;OperatorNode&lt;<span class="hljs-string"><span class="hljs-string">'*'</span></span>&gt;&gt; (qi::_1, qi::_2)] | factor[qi::_val = qi::_1];</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชูุฑุงุฑ ุงูุตูุฑุฉ ุงูุณุงุจูุฉ ูุน ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุงุฎุชูุงูุงุช.  ูุฑุฉ ุฃุฎุฑู ููุชูู ููุนูุง ูู ุงูุชุนุจูุฑ ุ ููุฑุฉ โโุฃุฎุฑู ููุชุจ ูุงุฆู OperatorNode ูู ุงููุชูุฌุฉ ุ ุฃู ูุฌุฑุฏ ููุน ูู ุงูุนูุงูู.  ุฏุนููุง ููุธุฑ ูู ุงูุฃูุฑ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">factor = group[qi::_val = qi::_1] | qi::int_[qi::_val = phx::new_&lt;ConstantNode&gt;(qi::_1)];</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุญู ููุถู ุนูู ุทูู ุงูุทุฑูู ุงูุฃูุตุฑ ุ ููุชุฑุถ ุฃููุง ูู ููุชู ุณูู ุบูุฑ int.  ุงูุขู ุ ุฅุฐุง ูุตููุง ุฌููุน ุงูุฎุทูุงุช ุงูุณุงุจูุฉ ูู ุงูุดูุฑุฉ ุงูุฒุงุฆูุฉ ุ ูุณูุญุตู ุจุดูู ููุณุน ุนูู ูุฐุง ุงูุดูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">factor1 = ConstantNode(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   ,    factor2 = ConstantNode(3) product = OperatorNode&lt;'*'&gt;(factor1, factor2) start = product</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุงูุชุนุจูุฑ ุนู ูู ุนูุฏุฉ ุ ุจุฏุกูุง ูู ุงูุฃุนูู (ุจุงุณุชุซูุงุก ุฃูููุง ุ ููู ุฃุนุฏุงุฏ ุตุญูุญุฉ ูู ุงูุฃุณุงุณ ููุง) ุ ูู ุฎูุงู ุงูุนูุฏ ุงููุงุญูุฉ.  ูุงูุงุชุตุงู ุงููุญูุฏ ูุทุฑููุฉ <em>ุงูุชูููู ()</em> ุนูู ุนูุตุฑ ุงูุฌุฐุฑ ูุญู ุงููุดููุฉ ุจุฃููููุง ุ ุฑุงุฆุน! </p><br><p style=";text-align:right;direction:rtl">  ุซู <em>qi :: space_type ุชููุช ุงูุชุจุงูู</em> - ูุฐู ุงููุณูุทุฉ ูู ูุงุฆูุฉ ุจุงูุนูุงุตุฑ ุงูุชู ูุชู ุชุฌุงูููุง ุนูุฏ ุงูุชุญููู.  ูุฐุง ูุง ูุฒุงู ููุนุจ ุฎุฏุนุฉ ุนูู :-). </p><br><p style=";text-align:right;direction:rtl">  ูุง ูููุช ุงูุงูุชุจุงู ููุง ูู ุทุฑููุฉ ุฅุนุทุงุก ุงูุฃููููุฉ ูุนูููุฉ ุงูุถุฑุจ ุนูู ุงูุฅุถุงูุฉ ูู ุฎูุงู ุงูุชุนุจูุฑ ุจุจุณุงุทุฉ ุนู ุงูุจุฏุงูุฉ ุบูุฑ ุงูุทุฑููุฉ (ุชุญุชูู ููุท ุนูู +) ุนุจุฑ ุงูููุชุฌ (*).  ูู ุตูุบุฉ ุงูููุงุนุฏ ุงูุฎุงุตุฉ ุจู ุ ูุธุฑูุง ูุฃูู ุชูุฑุฑ ุฃูู ุณูู ูุณูุฏ ุนูู ุฃู ุ ุฃูุง ุจุจุณุงุทุฉ ุงุณุชุจุฏู ุงูุนูุงูู ุงูููุทููุฉ ุงููุทููุจุฉ ูู ุงูุฃูุงูู ุงูุตุญูุญุฉ.  ุฅุฐุง ูุงู ูู ุงูุตุนุจ ุงุฑุชูุงุจ ุฃุฎุทุงุก ูู ูุชุงุจุฉ ุงูุนูุงูู ุงูุฑูุงุถูุฉ ุ ูุฅู ุงูุนูุงูู ุงูููุทููุฉ ุงููุตูุฉ ูู ูุตุฉ ูุฎุชููุฉ ุชูุงููุง.  ููุงู ุฑุบุจุฉ ูู ุญู ุฌุฒุก ุนูู ุงูุฃูู ูู ุงููุดุงูู ุงููุญุชููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงูุณุฌู.  ููุฐุง ุ ูุญุชูู Spirit ุนูู ููุน ูุฏูุฌ <em>qi :: no_case</em> </p><br><p style=";text-align:right;direction:rtl">  ุนูุงูุฉ ุนูู ุฐูู ุ ุจุฏูุงู ูู ุงูุฃุฑูุงู ุ ุณุฃุญุชุงุฌ ุฅูู ุฃุณูุงุก ุงูุญููู ุ ูุฐูู ูุถูู ุบูุฑ ุงููุทุงุจู ุงูููุงุจู ุจุฏูุงู ูู ุงููููุฉ <em>qi :: int_ ุงููุถููุฉ</em> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">field = qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_"</span></span>) &gt;&gt; *qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_0-9"</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุตู ููุง ุฅูู ูุฐุง ุงูุชุนุจูุฑ ุงูุจุณูุท (ุญุชู ุงูุขู ูุง ุชูุฌุฏ ุนูููุงุช ุงูุฏูุงููุฉ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">start = product &gt;&gt; qi::no_case["OR"] &gt;&gt; start | product; product = factor &gt;&gt; qi::no_case["AND"] &gt;&gt; product | factor; factor = group | field; group %= '(' &gt;&gt; start &gt;&gt; ')';</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ุดูุก ุฌุงูุฒ ูุชุญููู ุฃุจุณุท ุฌููุฉ <em>"field ู field2"</em> .  ูุจุฏุฃ ู ... ูุง ุดูุก ูุนูู. </p><br><p style=";text-align:right;direction:rtl">  ูุงูุช ุงููุดููุฉ ูู ููุงู ุบูุฑ ูุชููุน: <em>qi :: space_type</em> ูุง ูุชุฌุงูู ุงููุณุงูุงุช ููุท ุ ุจู ูุฒูููุง ูู ุงูุฌููุฉ ูุจู ุงูุชุญููู ุ <em>ููุธูุฑ</em> ุชุนุจูุฑ ุงููุฑุดุญ ุงูุฃููู ูู ุงูุชุญููู ุจุงููุนู ูู ุงููููุฐุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-string"><span class="hljs-string">"fieldAndfield2"</span></span> \\        ,    <span class="hljs-string"><span class="hljs-string">"(5 * 5) + 11 "</span></span> \\  <span class="hljs-string"><span class="hljs-string">"(5*5)+11"</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุญูู ูุงุญุฏ ููุท.  ูููุง ูุฐูู ุ ุชุญุชุงุฌ ุฅูู ุจุนุถ ูุงุฆุฏ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">skipper = +qi::lit(<span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    . ,    ,   ,  ,  C++ . start = product &gt;&gt; skipper &gt;&gt; qi::no_case["OR"] &gt;&gt; skipper &gt;&gt; start | product; ...</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชุญููู ุงูุญููู ุ ูู ุงููููู ูุนุฑูุฉ ููููุฉ ุงูุญุตูู ุนูู ุงูููู ูู ุงูุชุนุจูุฑุงุช ูููู ููููุฉ ุงูุชุญูู ูู ุตุญุฉ ุงูุญูู ููุงุจู ุงููููุฉ.  ูููู ุงูุชุนุจูุฑ ุนู ุฌููุน ุฎูุงุฑุงุช ุงูููุงุฑูุฉ ูู ุฎูุงู ุงูุนูููุงุช ุงูุชุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Operator</span></span></span><span class="hljs-class"> {</span></span> EQ, <span class="hljs-comment"><span class="hljs-comment">//  LT, //  GT, //  CP //  (  ) }; unary = qi::no_case["NOT"]; // ,         </span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงูููู ููุณูุง ูุชู ุงูุชุนุจูุฑ ุนููุง ูู ูุซู ูุฐู ุงููุงูุฑูุฒูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">value = qi::double_ | qi::int_ | qi::bool_ | <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> = qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>) &gt;&gt; +qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z0-9_. "</span></span>) &gt;&gt; qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููุดุงูู ุงูุชู ุชุฌูุจูุง ูุซู ูุฐู ุงูุทุฑููุฉ ููุญุตูู ุนูู ุงููููุฉ.  ุณูู ุชููู ุดุฑูุฉ Spirit ุจุฅุฑุฌุงุนูุง ูู ุตูุฑุฉ <em>ุชุนุฒูุฒ :: variant &lt;intุ doubleุ boolุ std :: string&gt;</em> ุ ูุนูุฏูุง ูุญูู ุงูููุช ูููุงุฑูุชูุง ุจุจุนุถ ุงูุจูุงูุงุช ุ ุณุชููู ููุงู ุญุงุฌุฉ ุฅูู ุจุนุถ ุงูุญูู ููุญุตูู ุนูู ูููุฉ ุงูููุน ุงููุทููุจ.  ุฅููู ูุง ุงูุฎูุงุฑ ุงูุฐู ุฃุชูุช ุฅููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ValueType = boost::variant&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValueGetter</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> boost::static_visitor&lt;Json&gt; { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Type&gt; <span class="hljs-function"><span class="hljs-function">Json </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Type &amp;value)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; } };</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงุฐุง ูุนูุฏ getter ูุงุฆู Jsonุ  ูุจุงูุชุงูู ุ ุนูุฏ ููุงุฑูุฉ ุงูููู ุฃุซูุงุก ุงูุชุตููุฉ ุ ุณุฃุชุฌูุจ ุงูุงุถุทุฑุงุฑ ุฅูู ูุนุฑูุฉ ููุน ุงูุจูุงูุงุช ุงูุชู ุชูุฑ ุจูุง ุงูููุงุฑูุฉ ุ ูุชุฑู ูู ุงูุนูู ูููุชุจุฉ json. </p><br><p style=";text-align:right;direction:rtl">  ุฎุท ุงูููุงูุฉ.  ูุตู ุงูุฃู.  ุณูู ูุณุชุฎุฏู ููุณ ุงููุซุงู ูุน ุขูุฉ ุญุงุณุจุฉ.  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุชุฌุฑูุฏ ุ ุณูู ููุฑ ุจู ุฅูู ุงูููุงุนุฏ ุ ูุณูุชูุถู ุงูุฑูุญ ุจุชุนุจุฆุชู ูุนูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMatcher</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: AbstractMatcher() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~AbstractMatcher() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       }; using MatcherPtr = std::shared_ptr&lt;AbstractMatcher&gt;;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุนูุฏ ุงูููุทููุฉ ุงูุฃุฎุฑู ูู ุนูุฏ ุงูุชุตููุฉ ุงูุฑุฆูุณูุฉ: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูุนูุฏุฉ ุงูููุทููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logic</span></span></span><span class="hljs-class"> {</span></span> AND, OR }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;Logic Operator&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LogicNode</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AbstractMatcher { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: LogicNode(MatcherPtr &amp;left, MatcherPtr &amp;right) : m_left(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(left)) , m_right(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(right)) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (Operator) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Logic::AND: m_evaluator = &amp;LogicNode::And; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Logic::OR: m_evaluator = &amp;LogicNode::Or; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> final </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::invoke(m_evaluator, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, object); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: MatcherPtr m_left; MatcherPtr m_right; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> EvaluateType = <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>(LogicNode::*)(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Json &amp;); EvaluateType m_evaluator = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">And</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_left-&gt;evaluate(object) &amp;&amp; m_right-&gt;evaluate(object); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Or</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_left-&gt;evaluate(object) || m_right-&gt;evaluate(object); } };</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูุฃุฎูุฑุง ุ ุงูุนูุฏ ุงูุณููู </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุงุฑูุฉ ุงููููุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectNode</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AbstractMatcher { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ObjectNode(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> field, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ValueType &amp;value, boost::optional&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; &amp;unary, Operator oper) : m_field(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(field)) , m_json_value(boost::apply_visitor(ValueGetter(), value)) , m_reject(unary.has_value()) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (oper) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::EQ: m_evaluator = &amp;ObjectNode::Equal; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::LT: m_evaluator = &amp;ObjectNode::LesserThan; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::GT: m_evaluator = &amp;ObjectNode::GreaterThan; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Operator::CP: m_evaluator = &amp;ObjectNode::Substr; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;object)</span></span></span><span class="hljs-function"> final </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;value = object.at(m_field); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::invoke(m_evaluator, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_reject ? !result : result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> EvaluateType = <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>(ObjectNode::*)(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Json &amp;); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> m_field; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Json m_json_value; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> m_reject; EvaluateType m_evaluator = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json == m_json_value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LesserThan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json &lt; m_json_value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreaterThan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json &gt; m_json_value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Substr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Json &amp;json)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Str(json).find(Str(m_json_value)) != <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::npos; } };</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูุจูู ููุท ุฃู ูุถุนูุง ูุนูุง: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุฑุดุญ ุฌุณูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonFilterGrammar</span></span></span><span class="hljs-class"> :</span></span> qi::grammar&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator, MatcherPtr()&gt; { JsonFilterGrammar() : JsonFilterGrammar::base_type(expression) { skipper = +qi::lit(<span class="hljs-string"><span class="hljs-string">' '</span></span>); unary = qi::no_case[<span class="hljs-string"><span class="hljs-string">"NOT"</span></span>]; compare.add (<span class="hljs-string"><span class="hljs-string">"eq"</span></span>, Operator::EQ) (<span class="hljs-string"><span class="hljs-string">"lt"</span></span>, Operator::LT) (<span class="hljs-string"><span class="hljs-string">"gt"</span></span>, Operator::GT) (<span class="hljs-string"><span class="hljs-string">"cp"</span></span>, Operator::CP); expression = (product &gt;&gt; skipper &gt;&gt; qi::no_case[<span class="hljs-string"><span class="hljs-string">"OR"</span></span>] &gt;&gt; skipper &gt;&gt; expression) [qi::_val = make_shared_&lt;LogicNode&lt;Logic::OR&gt;&gt;()(qi::_1, qi::_2)] | product[qi::_val = qi::_1]; product = (term &gt;&gt; skipper &gt;&gt; qi::no_case[<span class="hljs-string"><span class="hljs-string">"AND"</span></span>] &gt;&gt; skipper &gt;&gt; product) [qi::_val = make_shared_&lt;LogicNode&lt;Logic::AND&gt;&gt;()(qi::_1, qi::_2)]| term[qi::_val = qi::_1]; term = group[qi::_val = qi::_1] | (field &gt;&gt; -(skipper &gt;&gt; unary)&gt;&gt; skipper &gt;&gt; qi::no_case[compare] &gt;&gt; skipper &gt;&gt; value) [qi::_val = make_shared_&lt;ObjectNode&gt;()(qi::_1, qi::_4, qi::_2, qi::_3)]; field = qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_"</span></span>) &gt;&gt; *qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z_0-9"</span></span>); value = qi::double_ | qi::int_ | qi::bool_ | <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> = qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>) &gt;&gt; +qi::char_(<span class="hljs-string"><span class="hljs-string">"a-zA-Z0-9_. \u20BDโฌ$ยฅ-"</span></span>) &gt;&gt; qi::lit(<span class="hljs-string"><span class="hljs-string">"'"</span></span>); group %= <span class="hljs-string"><span class="hljs-string">'('</span></span> &gt;&gt; expression &gt;&gt; <span class="hljs-string"><span class="hljs-string">')'</span></span>; } qi::rule&lt;Iterator&gt; skipper; qi::rule&lt;Iterator, MatcherPtr()&gt; product, term, expression, group; qi::rule&lt;Iterator, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>()&gt; field, unary, <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; qi::rule&lt;Iterator, ValueType()&gt; value; qi::symbols&lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>, Operator&gt; compare; <span class="hljs-comment"><span class="hljs-comment">//      enum };</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก.  ุฃุตุจุญ ุงูุญุตูู ุนูู ุงูููุชุฑ ุงูููุงุฆู ุงูุขู ุนูููุฉ ุจุณูุทุฉ ุฅูู ุญุฏ ูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">MatcherPtr matcher; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> filter = <span class="hljs-string"><span class="hljs-string">"int not LT 15"</span></span>; JsonFilterGrammar grammar; qi::parse(filter.begin(), filter.end(), grammar, matcher); <span class="hljs-comment"><span class="hljs-comment">//     matcher   .</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณุฃุญุฐู ุนูููุฉ ุงูุชูุงู ุงูููุงุนุฏ ุงููุญููุฉ ูู ุฌูุงุฒ ุงูุชูุฌูู (ูุง ุฃุนุชูุฏ ุฃูู ุณูููู ููุชุนูุง ูุฃู ุดุฎุต).  ุณููุธุฑ ูู ุงูุฃุฏุงุฉ ุจุดูู ุฃูุถู ุจุงุณุชุฎุฏุงู ุฃุจุณุท ูุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> filter = <span class="hljs-string"><span class="hljs-string">"int not LT 15"</span></span>; Json json{ {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>}}, {{<span class="hljs-string"><span class="hljs-string">"int"</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>}} }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; json.dump() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; json.erase(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::remove_if(json.begin(), json.end(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::not_fn(JsonFilter{filter})), json.end()); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; json.dump() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ูู ุงูุฅุฎุฑุงุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">[{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:10},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:11},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:20},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:30},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:9}] [{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:20},{<span class="hljs-string"><span class="hljs-string">"int"</span></span>:30}]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุขูู ุ ุฃููุง ุงููุฑุงุก ุงูุฃุนุฒุงุก ุ ุฃููู ููุชููู ุฃูุถูุง ุจุงูุชุนุฑู ุนูู ุฃุณุงุณูุงุช ุงูุฑูุญ ููุฐูู ุฃูุง.  ุซู ุจููุช.  ุงุฑุงู ูุฑูุจุง </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar472004/">https://habr.com/ru/post/ar472004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar471992/index.html">ุชูููุฐ ุงูููุฒุงุช ุงููุชุจููุฉ ูู PEG</a></li>
<li><a href="../ar471994/index.html">ุงูุนูู ุนูู PEG ุนูู Core Developer Sprint</a></li>
<li><a href="../ar471998/index.html">F # 10: ููุงุฆู</a></li>
<li><a href="../ar472000/index.html">"ูู ุงูุฃูููุฉ ุจููุงู ุฃู ูุถุน ุงููุฌุชูุน ูุนุงููุฑ": ูุงุฑุดูู ููุณูุงูุง ุญูู ููุชููู</a></li>
<li><a href="../ar472002/index.html">ุญุฒูุฉ ุฅุนุงุฏุฉ ุงูุชุนุจุฆุฉ ูู ุงูุฏุฑุฌ</a></li>
<li><a href="../ar472006/index.html">ููุงุฐุง ูู ูููุฏ ูุฅุนุงุฏุฉ ุงุฎุชุฑุงุน ุงูุนุฌูุงุช</a></li>
<li><a href="../ar472012/index.html">ูุงูุจุงู ูู ูุตู ุณุงุนุฉ</a></li>
<li><a href="../ar472014/index.html">OTUS. ุฃุฎุทุงุฆูุง ุงูููุถูุฉ</a></li>
<li><a href="../ar472018/index.html">ูุธุงู ุงูุชุญูู ูู ุงูููุชุจุฉ ุนูู Flask-Potion ุ ุงูุฌุฒุก 0: ุฅุนุฏุงุฏ ูู ูุง ุชุญุชุงุฌู</a></li>
<li><a href="../ar472020/index.html">ุฃุนูู 10: ุฃูุถู ุชูุงุฑูุฑ HolyJS 2019 ุจูุชุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>