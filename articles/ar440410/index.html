<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ฝโ๐ซ ๐ โ ุชุญุฏูุฏ ุงูุตูุฑ ูุชุฎุฒูููุง ูุคูุชูุง ูุนุฑุถูุง ุนูู ุงูุฎุฑูุทุฉ โ๏ธ ๐ฉ๐ฟโ๐ค ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ูุฐู ุงูููุงูุฉ ุ ูุฑุฑุช ุฃู ุฃุตู ููููุฉ ุชูููุฐ ูุธููุฉ ุงุฎุชูุงุฑ ูุนุฑุถ ุงูุตูุฑ ูู ููุงู ูุนูู ุนูู ุงูุฎุฑูุทุฉ ูู ุฎุฏูุฉ ุงูุตูุฑ gfranq.com ูุฏููุง. ุฎุฏูุฉ ุงูุตูุฑ ูุง ุชุนูู ุงูุขู. 


...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุญุฏูุฏ ุงูุตูุฑ ูุชุฎุฒูููุง ูุคูุชูุง ูุนุฑุถูุง ุนูู ุงูุฎุฑูุทุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440410/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ูุฑุฑุช ุฃู ุฃุตู ููููุฉ ุชูููุฐ ูุธููุฉ ุงุฎุชูุงุฑ ูุนุฑุถ ุงูุตูุฑ ูู ููุงู ูุนูู ุนูู ุงูุฎุฑูุทุฉ ูู ุฎุฏูุฉ ุงูุตูุฑ <em>gfranq.com</em> ูุฏููุง.  ุฎุฏูุฉ ุงูุตูุฑ ูุง ุชุนูู ุงูุขู. </p><br><p style=";text-align:right;direction:rtl"></p><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/storage2/709/48a/e52/70948ae52bacb687d1b882fa7405bed5.jpg"></div><p></p><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃู ูุฏููุง ุงููุซูุฑ ูู ุงูุตูุฑ ูู ุฎุฏูุชูุง ูุฅุฑุณุงู ุงูุทูุจุงุช ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ูู ูุฑุฉ ูุงูุช ูููุง ุชุบููุฑุงุช viewport ุชุณุชููู ุงููุซูุฑ ูู ุงูููุงุฑุฏ ุ ูุงู ูู ุงูููุทูู ุชูุณูู ุงูุฎุฑูุทุฉ ุฅูู ุนุฏุฉ ููุงุทู ุชุญุชูู ุนูู ูุนูููุงุช ุญูู ุงูุจูุงูุงุช ุงูุชู ุชู ุงุณุชุฑุฏุงุฏูุง.  ูุฃุณุจุงุจ ูุงุถุญุฉ ุ ูููู ููุฐู ุงูููุงุทู ุดูู ูุณุชุทูู (ุนูู ุงูุฑุบู ูู ุฃู ุงูุดุจูุฉ ุณุฏุงุณูุฉ ูุงูุช ุชุนุชุจุฑ ุฃูุถูุง).  ูุธุฑูุง ูุฃู ุงูููุงุทู ุฃุตุจุญุช ุฃูุซุฑ ูุฑููุฉ ุนูู ูุทุงูุงุช ูุจูุฑุฉ ุ ุชู ุฃูุถูุง ุงููุธุฑ ูู ุนูุงุตุฑ ุงูููุฏุณุฉ ุงููุฑููุฉ ูุงูุฃุฏูุงุช ุงููุงุฒูุฉ ูุฐูู. </p><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูููุงูุฉ ุ ุชู ุทุฑุญ ุงููุดููุงุช ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุฎุฒูู ูุงุณุชุฑุฌุงุน ุงูุตูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชุฎุฒูููุง ูุคูุชูุง ุนูู ุงูุฎุงุฏู (SQL ุ C # ุ ASP.NET). </li><li style=";text-align:right;direction:rtl">  ุชูุฒูู ุงูุตูุฑ ุงูุถุฑูุฑูุฉ ุนูู ุฌุงูุจ ุงูุนููู ูุญูุธูุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุนููู (JavaScript). </li><li style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุตูุฑ ุงูุชู ูุฌุจ ุฃู ุชููู ูุฎููุฉ ุฃู ุชุธูุฑ ุนูุฏูุง ูุชุบูุฑ ูููุฐ ุงูุนุฑุถ. </li><li style=";text-align:right;direction:rtl">  ุนูุงุตุฑ ุงูููุฏุณุฉ ุงููุฑููุฉ. </li></ul><a name="habracut"></a><br><h2 id="contents" style=";text-align:right;direction:rtl">  ุงููุญุชููุงุช </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฌุฒุก ุงูุฎุงุฏู</a> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุฏูุฌ ูู geotypes</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงุฎุชูุงุฑ ุทุจูุนู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุงุณุชุฎุฏุงู ุฌุฏูู ุงูุชุฌุฒุฆุฉ ุฅุถุงููุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฎุฒูู ุงูุตูุฑ ูุคูุชูุง ูููุตูู ูุชุนุฏุฏ ุงูุฎููุท</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฌุงูุจ ุงูุนููู</a> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชููุฆุฉ ุงูุฎุฑูุทุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญุฏูุฏ ุงููููุน ุงูุฌุบุฑุงูู ุจุงุณุชุฎุฏุงู HTML5</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญุฏูุฏ ุงููููุน ุงูุฌุบุฑุงูู ุจุงุณุชุฎุฏุงู ูุนูููุงุช ูู ุงูุฎุงุฏู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญุณุงุจ ููุงุทู ูุณุชุทููุฉ ูุฑุฆูุฉ ุฌุฒุฆูุง</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญุณุงุจ ุญุฌู ููุงุทู ุงูุชุฎุฒูู ุงููุคูุช</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงุณุชุฎุฏุงู ุงูุชุฃุฎูุฑ ุนูุฏ ุฅุนุงุฏุฉ ุงูุฑุณู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญุณุงุจ ุงูุฅุญุฏุงุซูุงุช ูุงูุชุฌุฒุฆุฉ ูู ุงูููุงุทู ุงููุฑุฆูุฉ ุฌุฒุฆูุง</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุนุงุฏุฉ ุฑุณู ุงูุตูุฑ ุงููุนุฑูุถุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุณุงูุฉ ุนูู ุงูุฎุฑูุทุฉ</a> </li></ul></li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฎุงุชูุฉ</a> </li></ul><br><h2 id="server-part" style=";text-align:right;direction:rtl">  ุฌุฒุก ุงูุฎุงุฏู </h2><br><p style=";text-align:right;direction:rtl">  ุชู ุชุตููู ุงูุทุฑู ุงูุชุงููุฉ ูุชุญุฏูุฏ ูุชุฎุฒูู ุงููุนูููุงุช ุงูุฌุบุฑุงููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฒูุฏ ุฎุฏูุฉ ุงูุจูุงูุงุช ุงูุฌุบุฑุงููุฉ ุงููุฏูุฌ ูู ููุน ุงูุจูุงูุงุช. </li><li style=";text-align:right;direction:rtl">  ุงุฎุชูุงุฑ ุทุจูุนู ูุน ูููุฏ. </li><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุฌุฏุงูู ุฅุถุงููุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุนูุงูุฉ ุนูู ุฐูู ุ ุณูุชู ูุตู ูุฐู ุงูุฃุณุงููุจ ูู ุงูุชูุงุตูู. </p><br><h3 id="built-in-geotypes" style=";text-align:right;direction:rtl">  ุงููุฏูุฌ ูู geotypes </h3><br><p style=";text-align:right;direction:rtl"> ููุง ูู ูุนุฑูู ุ ูุฏุนู SQL Server 2008 ุฃููุงุน ุจูุงูุงุช ุงูุฌุบุฑุงููุง ูุงูููุฏุณุฉ ุ ูุงูุชู ุชุชูุญ ุชุญุฏูุฏ ุงููุนูููุงุช ุงูุฌุบุฑุงููุฉ (ุนูู ุงููุฌุงู) ูุงููุนูููุงุช ุงูููุฏุณูุฉ (ุนูู ุงููุณุชูู) ุ ูุซู ุงูููุงุท ูุงูุฎุทูุท ูุงููุถูุนุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง ุฅูู ุฐูู.</a>  .  ูุงุณุชุฑุฏุงุฏ ุฌููุน ุงูุตูุฑ ุงููุญุงุทุฉ <code>lngMin</code> <code>latMin</code> ( <code>lngMin</code> <code>latMin</code> ) ู ( <code>latMax</code> <code>lngMax</code> ) ุ ููููู ุงุณุชุฎุฏุงู ุงูุงุณุชุนูุงู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @h geography; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @p geography; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @rect = geography::STGeomFromText(<span class="hljs-string"><span class="hljs-string">'POLYGON((lngMin latMin, lngMax latMin, lngMax latMax, lngMin latMax, lngMin latMin))'</span></span>, <span class="hljs-number"><span class="hljs-number">4326</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP @cound <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, image75Path, geoTag.Lat <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Lat, geoTag.Long <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Lng, popularity, width, height <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Photo <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span>(IX_Photo_geoTag)) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> @rect.STContains(geoTag) = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> popularity <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงุญุธ ุฃู ุงููุถูุน ููุฌู ูุญู ุนูุณ ุงุชุฌุงู ุนูุงุฑุจ ุงูุณุงุนุฉ <code>IX_Photo_geoTag</code> ุงูููุฑุณ ุงูููุงูู <code>IX_Photo_geoTag</code> ุงููุนุฑูู ุจูุงุณุทุฉ ุงูุฅุญุฏุงุซูุงุช (ุฅูู ุฌุงูุจ ุฐูู ุ ูุชู ุฅูุดุงุก ููุงุฑุณ ููุงููุฉ ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃุดุฌุงุฑ B</a> ). </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ุงุชุถุญ ุฃูู ูู Microsoft SQL Server 2008 ุ ูุง ุชุนูู ุงูููุงุฑุณ ุงูููุงููุฉ ุฅุฐุง ูุงู ุงูุนููุฏ ุฐู ุงูุฃููุงุท ุงูุฌุบุฑุงููุฉ ููููู ูุจูู ููู <code>NULL</code> ุ ููุง ูููู ุฃู ูุญุชูู ุงูููุฑุณ ุงููุฑูุจ ุนูู ุนููุฏ ูุญุชูู ุนูู ููุน ุจูุงูุงุช ุงูุฌุบุฑุงููุง ุ ููุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูุช ููุงูุดุฉ</a> ูุฐุง ุงูุณุคุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนูู Stackoverflow</a> .  ููุฐุง ุงูุณุจุจ ูุตุจุญ ุฃุฏุงุก ูุซู ูุฐู ุงูุงุณุชุนูุงูุงุช (ุจุฏูู ููุงุฑุณ) ููุฎูุถูุง ููุบุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ูููููุฌ ุงูุชุงููุฉ ุญู ูุฐู ุงููุดููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃูู ูุง ูููู ุงุณุชุฎุฏุงู ููู <code>NULL</code> ุ ูุฅู ุงูููู ุงูุงูุชุฑุงุถูุฉ ููุฐุง ุงูุนููุฏ ูู ุฅุญุฏุงุซูุงุช (0 ุ 0) ุชุดูุฑ ุฅูู ูููุน ูู ุงููุญูุท ุงูุฃุทูุณู ุจุงููุฑุจ ูู ุฅูุฑูููุง (ููุทุฉ ุงูุจุฏุงูุฉ ูููุงุณ ุฎุทูุท ุงูุทูู ูุงูุนุฑุถ).  ููุน ุฐูู ุ ูู ูุฐุง ุงูููุงู ููุฐูู ูู ููุงู ูุฑูุจ ุ ูููู ุชุญุฏูุฏ ูููุน ุงูููุงุท ุงูุญููููุฉ ุ ููุฌุจ ุชุฌุงูู ุงูุตูุฑ ุบูุฑ ุงููุงุฑุฏุฉ ูู ุงูุฎุฑูุทุฉ.  ุฅุฐุง ููุช ุจุชุบููุฑ ููุทุฉ ุงูุตูุฑ (0 ุ 0) ุฅูู ููุทุฉ ุงูุดูุงู ุงูุฃูุตู (0 ุ 90) ุ ูุณูููู ูู ุดูุก ุฃูุถู ุจูุซูุฑ ุ ูุฃู ุฎุท ุงูุนุฑุถ 90 ูุดูุฑ ุฅูู ุญุงูุฉ ุงูุฎุฑูุทุฉ ุ ููุฌุจ ุฃู ุชุชุฌุงูู ูุฐู ุงููููุฉ ุนูุฏ ุฅูุดุงุก ุงูุดุจูุฉ (ุฃู ุจูุงุก ุญุชู ุฎุท ุงูุนุฑุถ 89). </li><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู SQL Server 2012 ุฃู ุฃุนูู ูุชุบููุฑ ูุณุชูู ุชูุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู 110 ุฃู ุฃุนูู ุนู ุทุฑูู ุชูููุฐ <code>ALTER DATABASE database_name SET COMPATIBILITY_LEVEL = 110</code> .  ูู ูุฐุง ุงูุฅุตุฏุงุฑ ูู SQL Server ุ ุชู ุฅุตูุงุญ ุงูุฎูู ุฐู ุงูููู <code>NULL</code> ููุฃููุงุท ุงูุฌููููุฌูุฉ ูุชู ุฅุถุงูุฉ ุฏุนู ุงููุถูุนุงุช ุฐุงุช ุงูุชูุฌูุงุช ุงููุฎุชููุฉ (ุนูุณ ุงุชุฌุงู ุนูุงุฑุจ ุงูุณุงุนุฉ ูุนูุณ ุนูุงุฑุจ ุงูุณุงุนุฉ). </li></ul><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุงูุงุญุชูุงูุงุช ุงููุงุณุนุฉ ููุฃููุงุท ุงูุฌููููุฌูุฉ (ุชุณูุญ ูู ุจุฅุฌุฑุงุก ุงุฎุชูุงุฑ ุจุณูุท ููุณ ููุท ููุง ูู ููุถุญ ุฃุนูุงู ุ ูููู ุฃูุถูุง ุงุณุชุฎุฏุงู ุงููุณุงูุงุช ููุถูุนุงุช ูุฎุชููุฉ) ุ ูู ูุณุชุฎุฏููุง ูู ูุดุฑูุนูุง. </p><br><h3 id="normal-selection" style=";text-align:right;direction:rtl">  ุงุฎุชูุงุฑ ุทุจูุนู </h3><br><p style=";text-align:right;direction:rtl">  ูุชุญุฏูุฏ ุงูุตูุฑ ูู ุงูููุทูุฉ <code>lngMin</code> <code>latMin</code> ( <code>lngMin</code> <code>latMin</code> ) ู ( <code>latMax</code> <code>lngMax</code> ) ุ ุงุณุชุฎุฏู ุงูุงุณุชุนูุงู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP @<span class="hljs-keyword"><span class="hljs-keyword">Count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>, ... <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Photo <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> latitude &gt; @latMin <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> longitude &gt; @lngMin <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> latitude &lt; @latMax <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> longitude &lt; @lngMax <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> popularity <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงุญุธ ุฃูู ูู ูุฐู ุงูุญุงูุฉ ุ ููููู ุฅูุดุงุก ุฃู ููุงุฑุณ ูุญููู <code>latitude</code> <code>longitude</code> (ุนูู ุนูุณ ุงูุทุฑููุฉ ุงูุฃููู) ุ ูุฃูู ูุชู ุงุณุชุฎุฏุงู ููุน ุจูุงูุงุช ุงูุชุนููู ุงูุนุงุฏู.  ููุน ุฐูู ุ ููุงู 4 ุนูููุงุช ููุงุฑูุฉ ูู ูุฐุง ุงูุงุฎุชูุงุฑ. </p><br><h3 id="using-additional-hash-table" style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุฌุฏูู ุงูุชุฌุฒุฆุฉ ุฅุถุงููุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุฅู ุงูุญู ุงูุฃูุซู ููุดููุฉ ุงุฎุชูุงุฑ ุงูุตูุฑ ูู ููุงุทู ูุนููุฉ ูู ุฅูุดุงุก ุฌุฏูู ุฅุถุงูู <code>Zooms</code> ูููู ุจุชุฎุฒูู ุงูุณูุงุณู ุงูุชู ุชุญุชูู ุนูู ุชุฌุฒุฆุฉ ุงููุณุงุญุงุช ููู ุงูุชูุจูุฑ ุ ููุง ูู ููุถุญ ุฃุฏูุงู. </p><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/storage2/dd2/696/223/dd269622322fa5b688101ba38ef68f10.png"></div><br><p style=";text-align:right;direction:rtl">  ูููู ุงุณุชุฎุฏุงู ุงุณุชุนูุงู SQL ุงูุชุงูู ( <code>zn</code> - ูุณุชูู ุงูุชูุจูุฑ ุงูุญุงูู): </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">hash</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">hash</span></span> = (@latMin + <span class="hljs-number"><span class="hljs-number">90</span></span>) + (@lngMin + <span class="hljs-number"><span class="hljs-number">180</span></span>) * <span class="hljs-number"><span class="hljs-number">180</span></span> + (@latMax + <span class="hljs-number"><span class="hljs-number">90</span></span>) * <span class="hljs-number"><span class="hljs-number">64800</span></span> + (@lngMax + <span class="hljs-number"><span class="hljs-number">180</span></span>) * <span class="hljs-number"><span class="hljs-number">11664000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP @<span class="hljs-keyword"><span class="hljs-keyword">Count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>, ... <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Photo <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Zooms <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> zn = @<span class="hljs-keyword"><span class="hljs-keyword">hash</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนููุจ ูุฐุง ุงูุฃุณููุจ ูู ุฃู ุงูุฌุฏูู ุงูุฅุถุงูู ูุดุบู ูุณุงุญุฉ ุฅุถุงููุฉ ูู ุงูุฐุงูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ูุฒุงูุง ุงูุทุฑููุฉ ุงูุฃุฎูุฑุฉ ุ ุงุณุชุฎุฏููุง ุงูุทุฑููุฉ ุงูุซุงููุฉ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุญุฏูุฏ ุงูุนุงุฏู</a> ) ุนูู ุงูุฎุงุฏู ุ ุญูุซ ุฃุธูุฑุช ุฃุฏุงุกู ุฌูุฏูุง. </p><br><h3 id="caching-photos-for-multi-threaded-access" style=";text-align:right;direction:rtl">  ุชุฎุฒูู ุงูุตูุฑ ูุคูุชูุง ูููุตูู ูุชุนุฏุฏ ุงูุฎููุท </h3><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงุณุชุฎุฑุงุฌ ุงููุนูููุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุ ูุชู ูุถุน ุงูุตูุฑ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุฎุงุฏู ุจุงุณุชุฎุฏุงู ูุงุฆู ูุชุฒุงูู ูุฏุนู ุชุนุฏุฏ ุงูุนูููุงุช ุนูู ุงููุญู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> SyncObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>(); ... List&lt;Photo&gt; photos = (List&lt;Photo&gt;)CachedAreas[hash]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (photos == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// Use lock to avoid extracting from and adding to the cache more than once. lock (SyncObject) { photos = (List&lt;Photo&gt;)CachedAreas[hash]; if (photos == null) { photos = PhotoList.GetAllFromRect(latMin, lngMin, latMax, lngMax, count); // Adding information about photos to the cache with a storage time of 2 minutes with a high storage priority. CachedAreas.Add(hash, photos, null, DateTime.Now.AddSeconds(120), Cache.NoSlidingExpiration, CacheItemPriority.High, null); } } } // Further usage of CachedAreas[hash]</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุตู ูุฐุง ุงููุณู ูุธุงุฆู ุงูุฎุงุฏู ูุงุณุชุฑุฏุงุฏ ุงูุตูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุญูุธูุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช.  ูุตู ุงููุณู ุงูุชุงูู ูุง ูุญุฏุซ ูู ุฌุงูุจ ุงูุนููู ูู ุงููุชุตูุญ. </p><br><h2 id="client-side" style=";text-align:right;direction:rtl">  ุฌุงูุจ ุงูุนููู </h2><br><p style=";text-align:right;direction:rtl">  ูุชุตูุฑ ุงูุฎุฑูุทุฉ ูุงูุตูุฑ ุนูููุง ุ ุชู ุงุณุชุฎุฏุงู ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุฎุฑุงุฆุท Google.  ุฃููุงู ุ ูุฌุจ ููู ุฎุฑูุทุฉ ุงููุณุชุฎุฏู ุฅูู ููุงู ูุนูู ุ ุจูุง ูุชูุงูู ูุน ุงููููุน ุงูุฌุบุฑุงูู ููุตูุฑ. </p><br><h3 id="initializing-the-map" style=";text-align:right;direction:rtl">  ุชููุฆุฉ ุงูุฎุฑูุทุฉ </h3><br><p style=";text-align:right;direction:rtl">  ููุงู ุทุฑููุชุงู ูุชุญุฏูุฏ ุงููููุน ุงูุฌุบุฑุงูู ุนูุฏ ุชููุฆุฉ ุงูุฎุฑูุทุฉ: ูุงุณุชุฎุฏุงู ูุฏุฑุงุช HTML5 ุฃู ุงุณุชุฎุฏุงู ุงูุฅุญุฏุงุซูุงุช ุงููุญุณูุจุฉ ูุณุจููุง ููููุงุทู. </p><br><h4 id="determining-the-geolocation-using-html5" style=";text-align:right;direction:rtl">  ุชุญุฏูุฏ ุงููููุน ุงูุฌุบุฑุงูู ุจุงุณุชุฎุฏุงู HTML5 </h4><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectRegion</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (navigator.geolocation) { navigator.geolocation.getCurrentPosition(success); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { map.setZoom(defaultZoom); map.setCenter(defaultPoint); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">success</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">position</span></span></span><span class="hljs-function">) </span></span>{ ... map.setZoom(defaultZoom); map.setCenter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> google.maps.LatLng(position.coords.latitude, position.coords.longitude)); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูุจ ูุฐุง ุงูููุฌ ูู ุฃูู ููุณุช ูู ุงููุชุตูุญุงุช ุชุฏุนู ูุธููุฉ HTML5 ููุง ูุฌูุฒ ูููุณุชุฎุฏู ุงูุณูุงุญ ุจุงููุตูู ุฅูู ุงููุนูููุงุช ุงูุฌุบุฑุงููุฉ ุนูู ุฌูุงุฒู. </p><br><h4 id="determining-the-geolocation-using-information-from-the-server" style=";text-align:right;direction:rtl">  ุชุญุฏูุฏ ุงููููุน ุงูุฌุบุฑุงูู ุจุงุณุชุฎุฏุงู ูุนูููุงุช ูู ุงูุฎุงุฏู </h4><br><p style=";text-align:right;direction:rtl">  ุชุชู ุชููุฆุฉ ุงูุฎุฑูุทุฉ ูู ูุณู ุงูููุฏ ุงููุตุฏุฑู ุฃุฏูุงู ุ ุญูุซ <code>bounds</code> ูู ุฅุญุฏุงุซูุงุช ุงูููุทูุฉ (ุงูููุทูุฉ ุงููุฃูููุฉ ุจุงูุณูุงู ุฃู ุงูููุทูุฉ ุฃู ุงูุจูุฏ) ุงูุชู ูุชู ุฅุฑุฌุงุนูุง ุจูุงุณุทุฉ ุงูุฎุงุฏู.  ูุชู ุญุณุงุจ ูุณุชูู ุงูุชูุจูุฑ ุงูุชูุฑูุจู ูู ูุธููุฉ <code>getZoomFromBounds</code> (ูุฃุฎูุฐุฉ ูู <code>getZoomFromBounds</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">stackoverflow</a> ). </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> northEast = bounds.getNorthEast(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> southWest = bounds.getSouthWest(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myOptions = { <span class="hljs-attr"><span class="hljs-attr">zoom</span></span>: getZoomFromBounds(northEast, southWest), <span class="hljs-attr"><span class="hljs-attr">center</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> google.maps.LatLng((northEast.lat() + southWest.lat()) / <span class="hljs-number"><span class="hljs-number">2</span></span>, (northEast.lng() + southWest.lng()) / <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-attr"><span class="hljs-attr">mapTypeId</span></span>: google.maps.MapTypeId.ROADMAP, <span class="hljs-attr"><span class="hljs-attr">minZoom</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">maxZoom</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span> } map = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> google.maps.Map(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"map_canvas"</span></span>), myOptions);</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getZoomFromBounds</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ne, sw</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> GLOBE_WIDTH = <span class="hljs-number"><span class="hljs-number">256</span></span>; <span class="hljs-comment"><span class="hljs-comment">// a constant in Google's map projection var west = sw.lng(); var east = ne.lng(); var angle = east - west; if (angle &lt; 0) { angle += 360; } return Math.round(Math.log($('#map_canvas').width() * 360 / angle / GLOBE_WIDTH) / Math.LN2); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฎุงุฏู ุ ูุชู ุญุณุงุจ ุงูููุงุทู ุงุนุชูุงุฏูุง ุนูู ุนููุงู IP ุงูุฎุงุต ุจุงููุณุชุฎุฏู.  ูุชุฌููุน ูู ุฅุญุฏุงุซูุงุช ุงูุญุฏูุฏ ููู ููุทูุฉ ุ ุชู ุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">google coding api</a> ุ ุนูู ุงูุฑุบู ูู ุฃูู ููุณ ูู ุงููุดุฑูุน ุงุณุชุฎุฏุงู ูุฐู ุงููุนูููุงุช ูู ูุถุน ุนุฏู ุงูุงุชุตุงู ุ  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ููุฌุฏ 2500 ุทูุจ ูููููุง.  ููู ูุฏููุฉ ูููุทูุฉ ูุจูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจูุง ุ ุชู ุฅูุดุงุก ุงุณุชุนูุงู ุฃุนุงุฏ ุงูุญุฏูุฏ ุงููุทููุจุฉ ู <code>viewport</code> <code>bounds</code> .  ุฅููุง ุชุฎุชูู ููุท ุนู ุงููุณุงุญุงุช ุงููุจูุฑุฉ ุงูุชู ูุง ูููู ูุถุนูุง ุจุงููุงูู ูู ุฅุทุงุฑ ุงูุนุฑุถ.  ุฅุฐุง ุฃุฑุฌุน ุงูุฎุงุฏู ุฎุทุฃู ุ ุนูุฏุฆุฐู ุชู ุงุณุชุฎุฏุงู ุงุณุชุนูุงูุงุช ุฃุฎุฑู ุชุณุชุฎุฏู ูููุง ุงููุบุฉ ุงูุฃุตููุฉ ูุชูู ุงูููุทูุฉ ุฃู ุงูุฅูุฌููุฒูุฉ ุ ูุชู ุฅุฒุงูุฉ ุงูุฌุฒุก {Populated area} ุ ุฅูุฎ. <code>http://maps.googleapis.com/maps/api/geocode/xml?address={Country},{Region},{Populated area}&amp;sensor=false</code> </p><br><p style=";text-align:right;direction:rtl">  ุนูู ุณุจูู ุงููุซุงู ุ ุจุงููุณุจุฉ ููุงุณุชุนูุงู ุงูุชุงูู: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http://maps.googleapis.com/maps/api/geocode/xmlุaddress=Russia ุ ููุทูุฉ Ivanovoูช 20 ุ Ivanovo &amp; sensor = false</a> </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุณูุชู ุฅุฑุฌุงุน ุงูุฅุญุฏุงุซูุงุช ุงูุชุงููุฉ (ุฌุฒุก)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="html hljs xml">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">location</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lat</span></span></span><span class="hljs-tag">&gt;</span></span>56.9951313<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lat</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lng</span></span></span><span class="hljs-tag">&gt;</span></span>40.9796047<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lng</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">location</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">location_type</span></span></span><span class="hljs-tag">&gt;</span></span>APPROXIMATE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">location_type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">viewport</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">southwest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lat</span></span></span><span class="hljs-tag">&gt;</span></span>56.9420231<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lat</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lng</span></span></span><span class="hljs-tag">&gt;</span></span>40.8765941<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lng</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">southwest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">northeast</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lat</span></span></span><span class="hljs-tag">&gt;</span></span>57.0703221<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lat</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lng</span></span></span><span class="hljs-tag">&gt;</span></span>41.0876169<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lng</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">northeast</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">viewport</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bounds</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">southwest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lat</span></span></span><span class="hljs-tag">&gt;</span></span>56.9420231<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lat</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lng</span></span></span><span class="hljs-tag">&gt;</span></span>40.8765941<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lng</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">southwest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">northeast</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lat</span></span></span><span class="hljs-tag">&gt;</span></span>57.0703221<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lat</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lng</span></span></span><span class="hljs-tag">&gt;</span></span>41.0876169<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lng</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">northeast</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bounds</span></span></span><span class="hljs-tag">&gt;</span></span> ...</code> </pre> </div></div><br><h3 id="calculating-partially-visible-rectangular-areas" style=";text-align:right;direction:rtl">  ุญุณุงุจ ููุงุทู ูุณุชุทููุฉ ูุฑุฆูุฉ ุฌุฒุฆูุง </h3><br><h4 id="calculating-the-size-of-caching-areas" style=";text-align:right;direction:rtl">  ุญุณุงุจ ุญุฌู ููุงุทู ุงูุชุฎุฒูู ุงููุคูุช </h4><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ููุง ุฐูุฑูุง ุณุงุจููุง ุ ูุชู ุชุฎุฒูู ุฌููุน ุงูุตูุฑ ุนูู ูู ูู ุงูุนููู ูุงูุฎุงุฏู ูู ููุงุทู ูุณุชุทููุฉ ุงูุดูู ุ ุญูุซ ุชููู ููุทุฉ ุงูุจุฏุงูุฉ ููุทุฉ ุชุนุณููุฉ (ูู ุญุงูุชูุง ุ ููุทุฉ ุงูุฅุญุฏุงุซูุงุช (0 ุ 0)) ุ ููุชู ุญุณุงุจ ุงูุญุฌู ููููุง ุนูู ูุณุชูู ุงูุชูุจูุฑ ุงูุญุงูู ุนูู ุงููุญู ุงูุชุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// The initial window at which initMapSizeLat and initMapSizeLng were calculated var initDefaultDimX = 1000, var initDefaultDimY = 800; // The current default viewport which depends on the size of the areas. var currentDefaultDimX = 1080, var currentDefaultDimY = 500; var initMapSizeLat = 0.0003019; var initMapSizeLng = 0.00067055; // The coefficient of size reduction (increase). var initRatio = 0.75; // To calculate the size of the smallest caching area, the map was zoomed in to the maximum zoom level // Ie initMapSizeLat and initMapSizeLng were calculated empirically. var initZoomSize = new google.maps.Size( initMapSizeLat / initDefaultDimX * currentDefaultDimX * initRatio, initMapSizeLng / initDefaultDimY * currentDefaultDimY * initRatio); // All subsequent sizes of areas can be calculated based only on the smallest area (by multiplying each size by 2, because with increasing the zoom level by 1, the linear dimensions increase by 2 times, and the quadratic dimensions increase by 4 times). function initZoomSizes() { zoomSizes = []; var coef = 1; for (var i = 21; i &gt;= 0; i--) { zoomSizes[i] = new google.maps.Size(initZoomSize.width * coef, initZoomSize.height * coef); coef *= 2; } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ุนูุฏ ูู ูุณุชูู ุชูุจูุฑ / ุชุตุบูุฑ ุ ูููู ุญุฌู ุงูููุทูุฉ ุงููุณุชุทููุฉ <code>0.75^2=0.5625</code> ูู ุญุฌู ูููุฐ ุงูุนุฑุถ ุงูุญุงูู ุ ุฅุฐุง ูุงู ุนุฑุถู 1080 ุจูุณู ูุงุฑุชูุงุนู 500 ุจูุณู. </p><br><h4 id="using-delay-when-redrawing" style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏุงู ุงูุชุฃุฎูุฑ ุนูุฏ ุฅุนุงุฏุฉ ุงูุฑุณู </h4><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃู ุฅุนุงุฏุฉ ุฑุณู ุฌููุน ุงูุตูุฑ ุนูู ุงูุฎุฑูุทุฉ ููุณุช ุนูููุฉ ุณุฑูุนุฉ (ููุง ุณูุธูุฑ ูุงุญููุง) ุ ููุฏ ูุฑุฑูุง ุงูููุงู ุจุฐูู ูุน ุจุนุถ ุงูุชุฃุฎูุฑ ุจุนุฏ ุฅุฏุฎุงู ุงููุณุชุฎุฏู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">google.maps.event.addListener(map, <span class="hljs-string"><span class="hljs-string">'bounds_changed'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (boundsChangedInverval != <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) clearInterval(boundsChangedInverval); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> zoom = map.getZoom(); boundsChangedInverval = setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ boundsChanged(); }, prevZoom === zoom ? moveUpdateDelay : zoomUpdateDelay); prevZoom = zoom; });</code> </pre> <br><h4 id="calculating-coordinates-and-hashes-of-partially-visible-areas" style=";text-align:right;direction:rtl">  ุญุณุงุจ ุงูุฅุญุฏุงุซูุงุช ูุงูุชุฌุฒุฆุฉ ูู ุงูููุงุทู ุงููุฑุฆูุฉ ุฌุฒุฆูุง </h4><br><p style=";text-align:right;direction:rtl">  ูุชู ุญุณุงุจ ุงูุฅุญุฏุงุซูุงุช ูุงูุชุฌุฒุฆุฉ ููู ุงููุณุชุทููุงุช ุงูุชู ุชุชุฏุงุฎู ูุน ุงููุงูุฐุฉ ุงููุฑุฆูุฉ ูุน ุงูุฅุญุฏุงุซูุงุช ( <code>latMin</code> ุ <code>lngMin</code> ) ูุงูุฃุจุนุงุฏ ุงููุญุณูุจุฉ ุจุงุณุชุฎุฏุงู ุงูุฎูุงุฑุฒููุฉ ุงูููุถุญุฉ ูุณุจููุง ุนูู ุงููุญู ุงูุชุงูู: </p><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/storage2/d8f/63a/bd7/d8f63abd76978f82b66bd0cc5a06311e.png"></div><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = zoomSizes[zoom]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> beginLat = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((latMin - initPoint.x) / s.width) * s.width + initPoint.x; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> beginLng = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((lngMin - initPoint.y) / s.height) * s.height + initPoint.y; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lat = beginLat; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lng = beginLng; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lngMax &lt;= beginLng) beginLng = beginLng - <span class="hljs-number"><span class="hljs-number">360</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (lat &lt;= maxlat) { lng = beginLng; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (lng &lt;= maxLng) { <span class="hljs-comment"><span class="hljs-comment">// lat and normalizeLng(lng) coordinates are the coordinates of the overlapping rectangles. // Longitude normalization is used because the right boundary can be greater than 180 or the left boundary can be less than -180. loadIfNeeded(lat, normalizeLng(lng)); lng += s.height; } lat += s.width; } function normalizeLng(lng) { var rtn = lng % 360; if (rtn &lt;= 0) rtn += 360; if (rtn &gt; 180) rtn -= 360; return rtn; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ูุชู ุงุณุชุฏุนุงุก ุงููุธููุฉ ุงูุชุงููุฉ ููู ููุทูุฉ ุ ูุงูุชู ุชุฑุณู ุงูุทูุจ ุฅูู ุงูุฎุงุฏู ุ ุฅุฐุง ูุฒู ุงูุฃูุฑ.  ุชุฑุฌุน ุตูุบุฉ ุญุณุงุจ ุงูุชุฌุฒุฆุฉ ูููุฉ ูุฑูุฏุฉ ููู ููุทูุฉ ุ ูุฃู ููุทุฉ ุงูุจุฏุงูุฉ ูุงูุฃุจุนุงุฏ ุซุงุจุชุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadIfNeeded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lat, lng</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hash = calculateHash(lat, lng, zoom); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(hash <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items)) { <span class="hljs-comment"><span class="hljs-comment">// Send a query to the database and put this cell in the client cache. } else { // Do nothing. } } function calculateHash(lat, lng, zoom) { // lat: [-90..90] // lng: [-180..180] return (lat + 90) + ((lng + 180) * 180) + (zoom * 64800); }</span></span></code> </pre> <br><h3 id="redrawing-the-displayed-photos" style=";text-align:right;direction:rtl">  ุฅุนุงุฏุฉ ุฑุณู ุงูุตูุฑ ุงููุนุฑูุถุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชูุฒูู ุฌููุน ุงูุตูุฑ ุฃู ุงุณุชุฎุฑุงุฌูุง ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุ ููุฒู ุฅุนุงุฏุฉ ุฑุณู ุจุนุถูุง.  ูุน ูุฌูุฏ ุนุฏุฏ ูุจูุฑ ูู ุงูุตูุฑ ุ ุฃู ุงูุนูุงูุงุช ุ ูู ููุงู ูุงุญุฏ ุ ูุฌุจ ุฅุฎูุงุก ุจุนุถูุง ุ ูููู ุจุนุฏ ุฐูู ูุตุจุญ ูู ุบูุฑ ุงููุงุถุญ ุนุฏุฏ ุงูุตูุฑ ุงูููุฌูุฏุฉ ูู ูุฐุง ุงูููุงู.  ูุญู ูุฐู ุงููุดููุฉ ุ ูุฑุฑูุง ุฏุนู ููุนูู ูู ุงูุนูุงูุงุช: ุงูุนูุงูุงุช ุงูุชู ุชุนุฑุถ ุงูุตูุฑ ูุงูุนูุงูุงุช ุงูุชู ุชูุถุญ ูุฌูุฏ ุตูุฑ ูู ูุฐุง ุงูููุงู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุฅุฐุง ูุงูุช ุฌููุน ุงูุนูุงูุงุช ูุฎููุฉ ุนูุฏ ุชุบููุฑ ุงูุญุฏูุฏ ุ ุซู ุฃุนูุฏ ุนุฑุถูุง ุ ููุฏ ููุงุญุธ ุงููุณุชุฎุฏู ุงูุฎููุงู.  ูุญู ูุฐู ุงููุดููุงุช ุ ุชู ุชุทููุฑ ุงูุฎูุงุฑุฒููุฉ ุงูุชุงููุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุณุชุฎุฑุงุฌ ุฌููุน ุงูุตูุฑ ุงููุฑุฆูุฉ ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุนููู ุฅูู ุตููู <code>visMarks</code> .  ุชู ูุตู ุญุณุงุจ ูุฐู ุงูููุงุทู ูุน ุงูุตูุฑ ุฃุนูุงู. </li><li style=";text-align:right;direction:rtl">  ูุฑุฒ ุงูุนูุงูุงุช ุงููุณุชููุฉ ุญุณุจ ุงูุดุนุจูุฉ. </li><li style=";text-align:right;direction:rtl">  ุงูุจุญุซ ุนู ุนูุงูุงุช ูุชุฏุงุฎูุฉ ุจุงุณุชุฎุฏุงู <code>markerSize</code> ู <code>SmallMarkerSize</code> ู <code>minPhotoDistRatio</code> ู <code>pixelDistance</code> . </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุตููู ูู ุงูุนูุงูุงุช ุงููุจูุฑุฉ ูุน <code>maxBigVisPhotosCount</code> ูุนูุงูุงุช ุตุบูุฑุฉ ูุน <code>maxSmlVisPhotosCount</code> . </li><li style=";text-align:right;direction:rtl">  ุชุญุฏูุฏ ุงูุนูุงูุงุช ุงููุฏููุฉ ุงูุชู ูุฌุจ ุฅุฎูุงุคูุง ูุฅุถุงูุชูุง ุฅูู <code>smlMarksToHide</code> ู <code>bigMarksToHide</code> ุจุงุณุชุฎุฏุงู <code>refreshMarkerArrays</code> . </li><li style=";text-align:right;direction:rtl">  ุชุญุฏูุซ ูุถูุญ ูุคุดุฑ ุงูุชูุจูุฑ ูุงูุชุตุบูุฑ <code>zIndex</code> ููุนูุงูุงุช ุงูุฌุฏูุฏุฉ ุงูุชู ูุฌุจ ุนุฑุถูุง ุจุงุณุชุฎุฏุงู <code>updateMarkersVis</code> . </li><li style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ุงูุตูุฑ ุ ุงูุชู ุฃุตุจุญุช ูุฑุฆูุฉ ูู ุงูููุช ุงูุญุงูู ุ ุฅูู ุงูุฎูุงุตุฉ ุจุงุณุชุฎุฏุงู <code>addPhotoToRibbon</code> . </li></ol><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฎูุงุฑุฒููุฉ ูุฅุนุงุฏุฉ ุญุณุงุจ ุงูุนูุงูุงุช ุงููุฑุฆูุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redraw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ isRedrawing = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> visMarker; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> visMarks = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> visBigMarks2; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> visSmlMarks2; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bigMarksToHide = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> smlMarksToHide = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> photo; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i, j; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bounds = map.getBounds(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> northEast = bounds.getNorthEast(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> southWest = bounds.getSouthWest(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> latMin = southWest.lat(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lngMin = southWest.lng(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> latMax = northEast.lat(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lngMax = northEast.lng(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ratio = (latMax - latMin) / $(<span class="hljs-string"><span class="hljs-string">"#map_canvas"</span></span>).height(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> zoom = map.getZoom(); visMarks = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> k = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = zoomSizes[zoom]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> beginLat = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((latMin - initPoint.x) / s.width) * s.width + initPoint.x; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> beginLng = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((lngMin - initPoint.y) / s.height) * s.height + initPoint.y; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lat = beginLat; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lng = beginLng; i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lngMax &lt;= beginLng) beginLng = beginLng - <span class="hljs-number"><span class="hljs-number">360</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Extracting all visible markers. while (lat &lt;= latMax) { lng = beginLng; while (lng &lt;= lngMax) { var hash = calcHash(lat, normLng(lng), zoom); if (!(hash in curItems)) { } else { var item = curItems[hash]; for (photo in item.photos) { if (bounds.contains(item.photos[photo].latLng)) { visMarks[i] = item.photos[photo]; visMarks[i].overlapCount = 0; i++; } } } k++; lng += s.height; } lat += s.width; } // Sorting markers by popularity. visMarks.sort(function (a, b) { if (b.priority !== a.priority) { return b.priority - a.priority; } else if (b.popularity !== a.popularity) { return b.popularity - a.popularity; } else { return b.id - a.id; } }); // Finding overlapping markers and markers that exceed a certain specified number. var curInd; var contains; var contains2; var dist; visBigMarks2 = []; visSmlMarks2 = []; for (i = 0; i &lt; visMarks.length; i++) { contains = false; contains2 = false; visMarker = visMarks[i]; for (j = 0; j &lt; visBigMarks2.length; j++) { dist = pixelDistance(visMarker.latLng, visBigMarks2[j].latLng, zoom); if (dist &lt;= markerSize * minPhotoDistRatio) { contains = true; if (contains &amp;&amp; contains2) break; } if (dist &lt;= (markerSize + smallMarkerSize) / 2) { contains2 = true; if (contains &amp;&amp; contains2) break; } } if (!contains) { if (visBigMarks2.length &lt; maxBigVisPhotosCount) { smlMarksToHide[smlMarksToHide.length] = visMarker; visBigMarks2[visBigMarks2.length] = visMarker; } } else { bigMarksToHide[bigMarksToHide.length] = visMarker; if (!contains2 &amp;&amp; visSmlMarks2.length &lt; maxSmlVisPhotosCount) { visSmlMarks2[visSmlMarks2.length] = visMarker; } else { visBigMarks2[j].overlapCount++; } } } // Adding markers that should be hidden to smlMarksToHide and bigMarksToHide. refreshMarkerArrays(visibleSmallMarkers, visSmlMarks2, smlMarksToHide); refreshMarkerArrays(visibleBigMarkers, visBigMarks2, bigMarksToHide); // Hiding invisible markers and displaying visible markers when zIndex changes. var curZInd = maxBigVisPhotosCount + 1; curZInd = updateMarkersVis(visBigMarks2, bigMarksToHide, true, curZInd); curZInd = 0; curZInd = updateMarkersVis(visSmlMarks2, smlMarksToHide, false, curZInd); visibleBigMarkers = visBigMarks2; visibleSmallMarkers = visSmlMarks2; // Adding visible photos to the feed. trPhotosOnMap.innerHTML = ''; for (var marker in visBigMarks2) { addPhotoToRibbon(visBigMarks2[marker]); } isRedrawing = false; } function refreshMarkerArrays(oldArr, newArr, toHide) { for (var j = 0; j &lt; oldArr.length; j++) { contains = false; var visMarker = oldArr[j]; for (i = 0; i &lt; newArr.length; i++) { if (newArr[i].id === visMarker.id) { contains = true; break; } } if (!contains) { toHide[toHide.length] = visMarker; } } } function updateMarkersVis(showArr, hideArr, big, curZInd) { var marker; var bounds = map.getBounds(); for (var i = 0; i &lt; showArr.length; i++) { var photo = showArr[i]; if (big) { marker = photo.bigMarker; $('#divOvlpCount' + photo.id).html(photo.overlapCount); } else { marker = photo.smlMarker; } marker.setZIndex(++curZInd); if (marker.getMap() === null) { marker.setMap(map); } } for (i = 0; i &lt; hideArr.length; i++) { marker = big ? hideArr[i].bigMarker : hideArr[i].smlMarker; if (marker.getMap() !== null) { marker.setMap(null); marker.setZIndex(0); if (!bounds.contains(hideArr[i].latLng)) hideArr[i].priority = 0; } } return curZInd; } function addPhotoToRibbon(marker) { var td = createColumn(marker); if (isLatLngValid(marker.latLng)) { trPhotosOnMap.appendChild(td); } else { trPhotosNotOnMap.appendChild(td); if (photoViewMode == 'user') { var img = $("#photo" + marker.id).children()[0]; $('#photo' + marker.id).draggable({ helper: 'clone', appendTo: $('#map_canvas'), stop: function (e) { var mapBoundingRect = document.getElementById("map_canvas").getBoundingClientRect(); var point = new google.maps.Point(e.pageX - mapBoundingRect.left, e.pageY - mapBoundingRect.top); var latLng = overlay.getProjection().fromContainerPixelToLatLng(point); marker.latLng = latLng; marker.priority = ++curPriority; placeMarker(marker); }, containment: 'parent', distance: 5 }); } } }</span></span></code> </pre> </div></div><br><h4 id="distance-on-the-map" style=";text-align:right;direction:rtl">  ุงููุณุงูุฉ ุนูู ุงูุฎุฑูุทุฉ </h4><br><p style=";text-align:right;direction:rtl">  ูุญุณุงุจ ุงููุณุงูุฉ ุจูู ููุทุชูู ุนูู ุงูุฎุฑูุทุฉ <em>ุจุงูุจูุณู</em> ุ ูุชู ุงุณุชุฎุฏุงู ุงููุธููุฉ ุงูุชุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Offset = <span class="hljs-number"><span class="hljs-number">268435456</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Radius = <span class="hljs-number"><span class="hljs-number">85445659.4471</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pixelDistance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">latLng1, latLng2, zoom</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x1 = lonToX(latLng1.lng()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y1 = latToY(latLng1.lat()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x2 = lonToX(latLng2.lng()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y2 = latToY(latLng2.lat()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2)) &gt;&gt; (<span class="hljs-number"><span class="hljs-number">21</span></span> - zoom); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lonToX</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lng</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(Offset + Radius * lng * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI / <span class="hljs-number"><span class="hljs-number">180</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">latToY</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">lat</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.round(Offset - Radius * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.log((<span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin(lat * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI / <span class="hljs-number"><span class="hljs-number">180</span></span>)) / (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.sin(lat * <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI / <span class="hljs-number"><span class="hljs-number">180</span></span>))) / <span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชู ุงูุนุซูุฑ ุนูู ูุฐู ุงููุธููุฉ ุฃูุถูุง ุนูู stackoverflow. </p><br><p style=";text-align:right;direction:rtl">  ูุฌุนู ุงูุนูุงูุงุช ุชุจุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฏูุงุฆุฑ</a> ุจูุง ุตูุฑ (ูุซู vkontakte) ุ ุชู ุงุณุชุฎุฏุงู ุงููููู ุงูุฅุถุงูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">RichMarker</a> ูุน ุฅุถุงูุฉ ููุท ุชุนุณูู ูุนูุตุฑ div. </p><br><h2 id="conclusion" style=";text-align:right;direction:rtl">  ุงูุฎุงุชูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุงุชุถุญ ุฃูู ูู ุฃุฌู ุนุฑุถ ุงูุตูุฑ ุนูู ุงูุฎุฑูุทุฉ ุจุณุฑุนุฉ ูุจุดูู ุตุญูุญ ุ ููุง ุจุญุงุฌุฉ ุฅูู ุญู ูุดููุงุช ูุซูุฑุฉ ููุงูุชูุงู ูุบูุฑ ุชุงููุฉ ููุบุงูุฉ ุชุชุนูู ุจุงูุชุฎุฒูู ุงููุคูุช ูุงูููุฏุณุฉ ุงููุฑููุฉ.  ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃูู ูู ูุชู ุงุณุชุฎุฏุงู ูู ุงูุทุฑู ุงูููุตููุฉ ุจุงููุนู ูู ูุดุฑูุนูุง ุ ุฅูุง ุฃู ุงูููุช ูู ูุถูุน ุ ูุฃู ุงูุชุฌุฑุจุฉ ุงูุชู ูุฏ ูุญุตู ุนูููุง ูุฏ ุชููู ูููุฏุฉ ูู ูุดุงุฑูุน ุฃุฎุฑู ุ ููุฏ ุชููู ูููุฏุฉ ุฃูุถูุง ูุฃููุฆู ุงูุฐูู ูุฑุฃูุง ูุฐุง ุงูููุงู ูููููู. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar440410/">https://habr.com/ru/post/ar440410/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar440394/index.html">ุชุตุงุนุฏ ุงูุชูุงุฒ PostgreSQL - ุชุญููู CVE-2018-10915</a></li>
<li><a href="../ar440398/index.html">ุชุงุฑูุฎ ุงููุดุงุฑูุฉ (ูุงูุงูุชุตุงุฑ) ูู ูุฃุณ ููุธูุฉ ุงูุนูู ุงูุฏูููุฉ ุงูุฑูุณูุฉ 2018 - CodeBall</a></li>
<li><a href="../ar440400/index.html">Apache Kafka + Spring Boot: ูุฑุญุจูุง ุ ุฎุฏูุงุช microservices</a></li>
<li><a href="../ar440402/index.html">ูุทูุฑ SearchFace ุญูู ููุฒุงุช ุงูุฎูุงุฑุฒููุฉ</a></li>
<li><a href="../ar440404/index.html">"ููุฏุณุฉ ุงููุนูููุงุช": mitap ูู OZON</a></li>
<li><a href="../ar440412/index.html">Zimbra Collaboration Suite ู MS Exchange ุนูู ููุณ ุงููุฌุงู</a></li>
<li><a href="../ar440414/index.html">ุญูู linter ุ ุฌูุฏุฉ ุงูููุฏ ุ ุงูุฌูุฏุฉ ุจุดูู ุนุงู ูุฅุฏุงุฑุฉ ุงูุฌูุฏุฉ</a></li>
<li><a href="../ar440416/index.html">ูุณุชุนูุฑุฉ. ุงููุตู 25: ูููุฉ ูู ุงูุฎุงุฑุฌ</a></li>
<li><a href="../ar440420/index.html">ูุฑุญุจูุง ุจู ูู Devleads Meetup ุ 21 ูุจุฑุงูุฑ</a></li>
<li><a href="../ar440422/index.html">ุนูุฏูุง ุชููู ูุณุคููุงู ุนู ุฌูุฏุฉ ุงููุฏูุฉ. ุชุงุฑูุฎ ุชุฌุฑุจุฉ blockchain ูุงุญุฏุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>