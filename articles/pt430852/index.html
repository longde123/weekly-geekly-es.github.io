<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👪 🚧 👨🏿‍🤝‍👨🏼 Garantias de consistência e ACID em sistemas de armazenamento distribuído ⛳️ 🌆 🐃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os sistemas distribuídos são usados ​​quando há necessidade de dimensionamento horizontal para fornecer indicadores de desempenho aprimorados que um s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Garantias de consistência e ACID em sistemas de armazenamento distribuído</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/gridgain/blog/430852/">  Os sistemas distribuídos são usados ​​quando há necessidade de dimensionamento horizontal para fornecer indicadores de desempenho aprimorados que um sistema dimensionado verticalmente não é capaz de fornecer dinheiro adequado. <br><br>  Assim como a transição de um paradigma de thread único para multi-thread, a migração para um sistema distribuído requer um tipo de imersão e compreensão de como ele funciona no interior, no que você precisa prestar atenção. <br><br>  Um dos problemas enfrentados por uma pessoa que deseja migrar um projeto para um sistema distribuído ou iniciar um projeto nele é qual produto escolher. <br><br>  Nós, como uma empresa que “comeu um cachorro” no desenvolvimento de tais sistemas, ajudamos nossos clientes a tomar decisões equilibradas em relação aos sistemas de armazenamento distribuído.  Também estamos lançando uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">série de seminários</a> on- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">line</a> para um público mais amplo, focado em princípios básicos em um idioma simples, e quaisquer preferências alimentares específicas ajudam a mapear recursos significativos para facilitar a escolha. <br><br>  Este artigo é baseado em nossos materiais sobre consistência e garantias ACID em sistemas distribuídos. <br><a name="habracut"></a><br><h1>  O que é e por que é necessário? </h1><br>  " <b>Consistência de</b> <b>dados</b> (às vezes <i>consistência de dados</i> ) é <i>consistência de dados</i> entre si, integridade de dados e consistência interna."  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> ) <br><br>  A consistência implica que, a qualquer momento, os aplicativos possam ter certeza de que estão trabalhando com a versão correta e tecnicamente relevante dos dados, e poderão confiar neles para tomar decisões. <br><br>  Em sistemas distribuídos, garantir a consistência está se tornando mais difícil e mais caro, porque surgem uma série de novos desafios relacionados à troca de rede entre nós diferentes, à possibilidade de falha de nós individuais e - frequentemente - à falta de uma única memória que pode servir para verificação. <br><br>  Por exemplo, se eu tiver um sistema de 4 nós: A, B, C e D, que serve transações bancárias, e os nós C e D estiverem separados de A e B (por exemplo, devido a problemas de rede), é bem possível que agora não esteja Eu tenho acesso a parte da transação.  Como eu ajo nesta situação?  Sistemas diferentes adotam abordagens diferentes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lm/8p/gw/lm8pgwmqnfcsp0uifu1hgiizhqg.png"></div><br>  No nível superior, existem duas direções principais que são expressas no teorema da PAC. <br><br>  “ <b>O teorema da CAP</b> (também conhecido como <b>teorema de Brewer</b> ) é uma afirmação heurística de que em qualquer implementação da computação distribuída é possível fornecer não mais que duas das três propriedades a seguir: <br><br><ul><li>  consistência dos dados (consistência Eng.) - em todos os nós de computação em um determinado momento, os dados não se contradizem; </li><li>  disponibilidade (disponibilidade do Eng.) - qualquer solicitação para um sistema distribuído termina com uma resposta correta, mas sem garantia de que as respostas de todos os nós do sistema correspondam; </li><li>  tolerância de partição - dividir um sistema distribuído em várias seções isoladas não leva a uma resposta incorreta de cada seção. ” </li></ul><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> ) <br><br>  Quando o teorema da CAP fala de consistência, implica uma definição bastante rigorosa, incluindo linearização de registros e leituras, e estipula apenas consistência ao escrever valores individuais.  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Martin Kleppman</a> ) <br><br>  O teorema da CAP diz que, se queremos resistir a problemas de rede, em geral devemos escolher se devemos sacrificar: consistência ou acessibilidade.  Existe também uma versão estendida desse teorema - PACELC ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> ), que também fala sobre o fato de que, mesmo na ausência de problemas de rede, devemos escolher entre velocidade de resposta e consistência. <br><br>  E, embora, à primeira vista, um nativo do mundo dos DBMSs clássicos, parece que a escolha é óbvia e a consistência é a coisa mais importante que temos, isso está longe de ser sempre o caso, que ilustra claramente o crescimento explosivo de vários DBMSs NoSQL que fizeram uma escolha diferente e Apesar disso, eles têm uma enorme base de usuários.  O Apache Cassandra, com sua famosa consistência eventual, é um bom exemplo. <br><br>  Tudo isso se deve ao fato de ser uma <i>escolha</i> que implica sacrificar alguma coisa e nem sempre estamos prontos para sacrificá-la. <br><br>  Freqüentemente, o problema de consistência em sistemas distribuídos é resolvido simplesmente abandonando essa consistência. <br><br>  Mas é necessário e importante entender quando a rejeição dessa consistência é aceitável e quando é um requisito comercial crítico. <br><br>  Por exemplo, se eu projetar um componente responsável por armazenar sessões do usuário, aqui, provavelmente, a consistência não é tão importante para mim e a perda de dados não será crítica se ocorrer apenas em casos problemáticos - muito raramente.  O pior que acontecerá é que o usuário precisará fazer login e, para muitas empresas, isso terá pouco efeito no desempenho financeiro. <br><br>  Se eu fizer análises no fluxo de dados a partir de sensores, em muitos casos, é totalmente não-crítico para mim perder alguns dados e obter uma redução de amostragem por um curto período de tempo, especialmente se finalmente os ver. <br><br>  Mas se eu criar um sistema bancário, a consistência das transações em dinheiro é fundamental para os meus negócios.  Se eu acumulei uma penalidade no empréstimo de um cliente devido ao fato de simplesmente não ver o pagamento pontual, embora ele estivesse no sistema, isso é muito, muito ruim.  Assim como se o cliente pudesse retirar todo o dinheiro do meu cartão de crédito várias vezes, porque eu tinha problemas de rede no momento da transação e as informações de retirada não atingiram parte do meu cluster. <br><br>  Se você fizer uma compra cara em uma loja on-line, não deseja que seu pedido seja esquecido, apesar do relatório de sucesso na página da web. <br><br>  Mas se você optar pela consistência, sacrifica a acessibilidade.  E muitas vezes isso é esperado, provavelmente você já se deparou com isso mais de uma vez. <br><br>  É melhor que a cesta da loja online diga "tente mais tarde, o DBMS distribuído não está disponível" do que se relatar o sucesso e esquecer o pedido.  É melhor obter uma recusa em uma transação devido à indisponibilidade dos serviços do banco do que uma batida no sucesso e depois nos procedimentos com o banco porque se esqueceu de que você pagou o empréstimo. <br><br>  Finalmente, se observarmos o teorema do PACELC estendido, entendemos que, mesmo no caso de operação regular do sistema, escolhendo a consistência, podemos sacrificar latências baixas, obtendo um nível potencialmente mais baixo de desempenho máximo. <br><br>  Portanto, respondendo à pergunta “por que isso é necessário?”: É necessário que seja essencial para sua tarefa ter dados atualizados e consistentes, e a alternativa trará a você perdas significativas maiores que a indisponibilidade temporária do serviço durante o período do incidente ou seu desempenho inferior. <br><br><h1>  Como fornecer isso? </h1><br>  Consequentemente, a primeira decisão que você precisa tomar é onde está no teorema da PAC, deseja consistência ou disponibilidade em caso de incidente. <br><br>  Em seguida, você precisa entender em que nível deseja fazer alterações.  Talvez você tenha registros atômicos suficientes que afetam um único objeto, pois o MongoDB era capaz e capaz (agora o amplia adicionalmente com suporte para transações completas).  Deixe-me lembrá-lo de que o teorema do CAP não diz nada sobre a consistência das operações de gravação envolvendo vários objetos: o sistema pode muito bem ser CP (ou seja, preferir a consistência da acessibilidade) e, ao mesmo tempo, fornecer apenas registros únicos atômicos. <br><br>  Se isso não for suficiente para você, começaremos a abordar o conceito de transações ACID distribuídas de pleno direito. <br><br>  Observo que, mesmo quando entramos no admirável mundo novo de transações ACID distribuídas, muitas vezes precisamos sacrificar algo.  Por exemplo, vários sistemas de armazenamento distribuído têm transações distribuídas, mas apenas dentro de uma única partição.  Ou, por exemplo, o sistema pode não suportar a parte “I” no nível que você precisa, sem isolamento ou com um número insuficiente de níveis de isolamento. <br><br>  Essas restrições costumavam ser feitas por algum motivo: para simplificar a implementação ou, por exemplo, para melhorar o desempenho ou para outra coisa.  Eles são suficientes para um grande número de casos, portanto, você não deve considerá-los como contras por conta própria. <br><br>  Você precisa entender se essas restrições são um problema para o seu cenário específico.  Caso contrário, você tem mais opções e pode dar mais peso, por exemplo, aos indicadores de desempenho ou à capacidade do sistema de fornecer tolerância a desastres, etc.  Finalmente, não devemos esquecer que em vários sistemas esses parâmetros podem ser ajustados até o ponto em que o sistema pode ser CP ou AP, dependendo da configuração. <br><br>  Se nosso produto pretende ser CP, geralmente ele possui uma abordagem de quorum para seleção de dados ou nós dedicados que são os principais proprietários dos registros, todas as alterações de dados passam por eles e, no caso de problemas de rede, se esses nós principais não puderem fornecer dados. resposta, acredita-se que os dados, em princípio, não possam ser obtidos, ou arbitragem, quando um componente externo altamente acessível (por exemplo, o cluster ZooKeeper) pode dizer qual dos segmentos de cluster é o principal, contém a versão atual dos dados e pode atender com eficiência à solicitação  s. <br><br>  Por fim, se estivermos interessados ​​não apenas no CP, mas no suporte a transações ACID distribuídas completas, geralmente uma única fonte de verdade é frequentemente usada, por exemplo, armazenamento em disco centralizado, onde nossos nós, de fato, atuam apenas como caches para ele, que podem ser desativados em tempo de confirmação ou o protocolo de confirmação multifásico é aplicado. <br><br>  A primeira abordagem de disco único também simplifica a implementação, fornece baixas latências nas transações distribuídas, mas troca em troca de escalabilidade muito limitada em cargas com grandes volumes de gravação. <br><br>  A segunda abordagem oferece muito mais liberdade no dimensionamento e, por sua vez, é dividida em protocolos de confirmação de duas fases ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> ) e trifásicas ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> ). <br><br>  Considere uma confirmação em duas fases que use, por exemplo, Apache Ignite. <br><br><img src="https://habrastorage.org/webt/ha/1a/qx/ha1aqxrjarg8g-x81wdn2i3xcoe.png"><br>  ￼ <br>  O procedimento de confirmação é dividido em 2 fases: preparar e confirmar. <br><br>  Na fase de preparação, uma mensagem é preparada sobre a preparação para a confirmação, e cada participante, se necessário, bloqueia, executa todas as operações até e inclusive a confirmação real e envia a preparação para suas réplicas, se isso for assumido pelo produto.  Se pelo menos um dos participantes respondeu com uma recusa por algum motivo ou se mostrou indisponível - os dados realmente não foram alterados, não houve confirmação.  Os participantes revertem as alterações, liberam bloqueios e retornam ao seu estado original. <br><br>  Na fase de consolidação, a execução real da consolidação é enviada aos nós do cluster.  Se por algum motivo alguns dos nós estavam indisponíveis ou responderam com um erro, então os dados foram inseridos em seu redo-log (desde que a preparação foi bem-sucedida) e a confirmação, em qualquer caso, pode ser concluída pelo menos em um estado pendente. <br><br>  Por fim, se o coordenador falhar, no estágio de preparação, o commit será cancelado, no estágio de commit, um novo coordenador poderá ser selecionado e, se todos os nós tiverem concluído o preparo, ele poderá verificar e garantir que o estágio de commit seja concluído. <br><br>  Diferentes produtos têm seus próprios recursos de implementação e otimização.  Assim, por exemplo, alguns produtos conseguem, em alguns casos, reduzir um commit de duas fases para um de 1 fase, ganhando significativamente em desempenho. <br><br><h1>  Conclusões </h1><br>  Conclusão chave: os sistemas de armazenamento distribuído são um mercado bastante desenvolvido e os produtos nele podem fornecer alta consistência dos dados. <br><br>  Além disso, os produtos dessa categoria estão localizados em diferentes pontos da escala de consistência, desde produtos totalmente em AP sem nenhuma transacionalidade até produtos em CP que fornecem adicionalmente transações ACID de pleno direito.  Alguns produtos podem ser configurados de uma maneira ou de outra. <br><br>  Quando você escolhe o que precisa, precisa levar em conta as necessidades do seu caso e entender bem quais sacrifícios e compromissos está disposto a fazer, porque nada acontece de graça e, ao escolher um, você provavelmente recusará outra coisa. <br><br>  Ao avaliar produtos desse lado, vale a pena prestar atenção ao seguinte: <br><br><ul><li>  onde eles estão no teorema da PAC; </li><li>  Eles suportam transações ACID distribuídas? </li><li>  que restrições eles impõem às transações distribuídas (por exemplo, apenas dentro de uma única partição, etc.); </li><li>  Conveniência e eficiência do uso de transações distribuídas, sua integração com outros componentes do produto. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt430852/">https://habr.com/ru/post/pt430852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt430840/index.html">Que evidência pode convencer os matemáticos se não houver evidência rigorosa?</a></li>
<li><a href="../pt430842/index.html">Usamos blockchain para combater a corrupção e o cyberbullying</a></li>
<li><a href="../pt430844/index.html">Como escolher uma bateria para UPS</a></li>
<li><a href="../pt430846/index.html">O que há de novo: detalhes sobre a implementação da nova arquitetura Zen 2 ficaram conhecidos</a></li>
<li><a href="../pt430850/index.html">Apple Metal em MAPS.ME</a></li>
<li><a href="../pt430854/index.html">“JS está ficando mais maduro”: uma entrevista com o comitê do programa HolyJS 2018 em Moscou</a></li>
<li><a href="../pt430856/index.html">Toda a verdade sobre o RTOS. Artigo 21. Caixas de correio: Introdução e serviços básicos</a></li>
<li><a href="../pt430860/index.html">Baixe, salve e visualize PDF no Swift</a></li>
<li><a href="../pt430862/index.html">"Monstros nos jogos - como fazer um jogador te odiar"</a></li>
<li><a href="../pt430864/index.html">Jogos não é um brinquedo?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>