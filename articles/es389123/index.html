<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëí üë®üèæ‚Äç‚öñÔ∏è üßùüèæ M√©todos para depurar el software del microcontrolador en una unidad el√©ctrica üßóüèæ üè∞ üë©üèæ‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øC√≥mo depurar programas de microcontroladores? Se toma el JTAG, el osciloscopio dura un par de d√≠as / semanas y se depura el programa. Esta ser√° una r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√©todos para depurar el software del microcontrolador en una unidad el√©ctrica</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/npf_vektor/blog/389123/"><img src="https://habrastorage.org/files/95f/7de/cb5/95f7decb5aa64618b6ad35270c2e753f.JPG" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øC√≥mo depurar programas de microcontroladores? Se toma el JTAG, el osciloscopio dura un par de d√≠as / semanas y se depura el programa. Esta ser√° una respuesta t√≠pica, y en la mayor√≠a de los casos ser√° correcta ... Pero no siempre. Los microcontroladores resuelven problemas muy diferentes, y en este art√≠culo consideraremos qu√© hacer si necesita desarrollar un engorroso software de bajo nivel para controlar cualquier equipo el√©ctrico de potencia, por ejemplo, convertidores de frecuencia para motores el√©ctricos, convertidores de carga de bater√≠a CC / CC para trenes, correctores de potencia, servos y etc. Equipo, donde fluyen los kiloamperios y kilovoltios PWM, donde se cuenta cada conmutaci√≥n de las teclas del inversor IGBT, donde el tiempo de respuesta del microcontrolador a una situaci√≥n anormal se mide en microsegundos, y el propio equipo en cajas selladas se instala y opera en alg√∫n lugar de las f√°bricas de Yakutia.Si desea saber qu√© caracter√≠sticas impone esto a los m√©todos de depuraci√≥n, bienvenido a cat.</font></font><br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Caracter√≠sticas de los sistemas de control de depuraci√≥n.</font></font></h1><br>
<img src="https://habrastorage.org/files/b75/1ed/df5/b751eddf52ae41f4afbb776f6c31055c.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øCu√°les son las caracter√≠sticas de los microcontroladores de depuraci√≥n (MK) que realizan tales tareas? </font><font style="vertical-align: inherit;">En primer lugar, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuando MK funciona con equipos de potencia, no se puede detener.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MK con la ayuda de PWM controla las teclas de encendido, regula muchos valores en sus corredores: corrientes de las fases del motor, voltaje de enlace de CC, velocidad, posici√≥n del cuerpo de trabajo, etc. Si detiene el MK mientras trabaja en el punto de interrupci√≥n, en el mejor de los casos, el equipo se apagar√° debido a la protecci√≥n del hardware y, en el peor de los casos, todo simplemente explotar√° (si los interruptores de alimentaci√≥n permanecen encendidos en la posici√≥n "uno" o con un ciclo de trabajo). Por lo tanto, la forma cl√°sica de depuraci√≥n es "recorrer los pasos con el depurador" en tales tareas. Por lo tanto, solo puede ejecutar en la tabla "m√≥dulos de software completamente en bruto antes de su primera inclusi√≥n en equipos reales.</font></font><br>
<br>
<img src="https://habrastorage.org/files/0ec/67d/061/0ec67d061c1d4bdc86b3c0fff1a21003.png" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En segundo lugar, esta es la complejidad del software de bajo nivel. El tama√±o de la secci√≥n del c√≥digo del programa .text es de 50-200 Kbytes para el c√≥digo del programa que controla exclusivamente el hardware (sin controladores de comunicaci√≥n de alto nivel, etc.); esta es una situaci√≥n t√≠pica para un microcontrolador de alg√∫n servocontrolador industrial. Por lo tanto, los microcontroladores de la serie motorcontrol se utilizan para tales tareas, que combinan al mismo tiempo perif√©ricos muy desarrollados, alto rendimiento y un tama√±o de memoria relativamente grande (para MK). Como ejemplo de MK importados, se pueden citar MK Instruments de 32 bits de la serie C2000 de Texas Instruments, del chip K1921VK01T nacional de NIIET OJSC. El software para tal MK generalmente contiene decenas o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cientos de miles de l√≠neas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c√≥digo C / C ++ optimizado perfecto, que simplemente no se puede depurar "parpadeando un LED", "printfom en UART" u observando el funcionamiento de las patas de un osciloscopio externo. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e1a/d3e/2e5/e1ad3e2e5e394042886eb06b707c14f7.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En tercer lugar, el controlador del sistema de control de accionamiento el√©ctrico se encuentra con mayor frecuencia dentro del convertidor de potencia, cuya carcasa est√° cerrada y, a veces, incluso sellada. Por lo tanto, el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acceso a trav√©s de JTAG ya es un gran problema,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aunque solo sea para firmware (con apagado). Y un problema a√∫n m√°s grave es la depuraci√≥n de JTAG con el sistema encendido. Aqu√≠, se debe usar el JTAG necesariamente aislado galv√°nicamente y a prueba de ruido (lo usamos para MK TI JTAG SAURIS con aislamiento galv√°nico incorporado - costoso, pero funciona). </font></font><br>
<br>
<img src="https://habrastorage.org/files/e0c/89b/f08/e0c89bf08ca143d1a7f1760ca39b7dc2.png" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuarto, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no hay sistemas operativos!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Podemos prever c√≥mo algunas personas tienen la idea "bueno, ya que tiene una tarea tan dif√≠cil, coloque un microcontrolador normal con Linux y escriba aplicaciones regulares para √©l, actualizando el software desde una unidad flash". Los sistemas de control de equipos de potencia son sistemas en tiempo real muy dif√≠ciles. No es que Linux, ni siquiera todos los sistemas operativos especializados en tiempo real sean adecuados para tales tareas. Por ejemplo, la interrupci√≥n del ADC al leer y promediar datos anal√≥gicos puede ser causada con una frecuencia de hasta 100 kHz. Al mismo tiempo, contendr√° solo una docena o dos l√≠neas de c√≥digo: recopilaci√≥n de datos de canales anal√≥gicos, un par de comprobaciones de protecciones de alta velocidad y salida, todo, nada m√°s que hacer. Si le indica una interrupci√≥n a alg√∫n programador de tareas del sistema operativo, simplemente su propia ejecuci√≥n requerir√° m√°s recursos. Sin mencionar que, en particular,para Linux, en lugar de un chip MK, debe colocar dos m√°s en la placa: memoria RAM externa y memoria flash, asignarles un mont√≥n de patas de cristal preciosas, usar una placa de seis capas para un cableado adecuado, obtener un gran tiempo de arranque MK (a veces cuando hay una falla de energ√≠a o un temporizador de vigilancia ¬°comience a trabajar antes de que el motor se haya detenido!), tenga problemas con la integridad del sistema de archivos y m√°s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, la quinta caracter√≠stica: los sistemas de control de bajo nivel para accionamientos el√©ctricos y otros equipos de potencia (en contraste con las tareas de comunicaci√≥n en diferentes interfaces, PLC, controladores de todo tipo de alarmas, controles remotos, etc.) implementan principalmente algoritmos de sistemas de control autom√°tico. A saber: la mitad del software consta de varios tipos de estructuras cerradas con controladores PID, bloques de saturaci√≥n, zonas muertas, tablas de dependencia de uno sobre el otro, filtros, observadores, ajustadores de intensidad, planificadores de movimiento y otros. Los c√°lculos en dicho software se realizan con una frecuencia determinada; por ejemplo, a una frecuencia de 10 kHz, se dispara una interrupci√≥n y se calculan todos los bloques enumerados, que en conjunto forman la estructura de control del equipo necesaria. En tales algoritmos, la depuraci√≥n paso a paso no ayuda: la mayor√≠a de las veces, en cada paso, cada m√≥dulo genera lo quelo que se espera de √©l: de hecho, todos estos filtros, reguladores, etc. ya se han depurado durante a√±os y hay pocas sorpresas all√≠.</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Surgen problemas durante el funcionamiento de toda la estructura como un todo: cada unidad funciona individualmente y el proceso regulatorio deseado no ocurre como se esperaba</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Y los problemas resultan estar en el ajuste de cientos de par√°metros y coeficientes de estos bloques, as√≠ como en la estructura ensamblada a partir de ellos; puede resultar que necesite agregar un nuevo circuito de estabilizaci√≥n en alg√∫n lugar, agregar un bloque de predicci√≥n, restricciones, etc. Por lo tanto, esta es otra "piedra en el jard√≠n" de la depuraci√≥n paso a paso y mensajes de depuraci√≥n printf: necesita depurar m√°s a menudo que no el c√≥digo del programa en s√≠, sino la estructura de control autom√°tica ensamblada. Si alguien tiene poca idea de qu√© es (estructura), entonces aqu√≠ est√° la estructura m√°s simple de un control vectorial sin sensor de un motor s√≠ncrono:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/bfd/b52/e6d/bfdb52e6d24c4d4ab7fac47a46fc8dd6.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cada cuadro tiene algunas f√≥rmulas y, a veces, un m√≥dulo en una docena o dos p√°ginas de c√≥digo. </font><font style="vertical-align: inherit;">El m√≥dulo tiene entradas / salidas, as√≠ como algunas variables de estado (por ejemplo, la parte integral del controlador PI, etc.). </font><font style="vertical-align: inherit;">Aquellos que lo deseen tambi√©n pueden ver una estructura similar en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la p√°gina de Wikipedia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dado que el sistema de control est√° cerrado, el funcionamiento incorrecto de una unidad (o su configuraci√≥n incorrecta) conduce a la inoperancia de toda la estructura. </font><font style="vertical-align: inherit;">Y encontrar exactamente d√≥nde est√° el problema, esa es otra tarea.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo depurarlo?</font></font></h1><br>
<img src="https://habrastorage.org/files/ff6/921/70e/ff692170e60d460ba420efd360713681.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces, ¬øqu√© hacer, c√≥mo depurarlo? ¬øUn osciloscopio externo? No va a ayudar El osciloscopio, por supuesto, es necesario para depurar algunos problemas puramente de hardware, pero solo pueden ver los valores de entrada y salida del microcontrolador, y cientos de variables dentro de la estructura permanecer√°n detr√°s de escena. Bueno, ver√° que la corriente de fase del motor se dispara extra√±amente, y el voltaje de salida del inversor se dispara extra√±amente. Y por qu√©, qu√© bloque dentro del software MK conduce a esto (o un motor o sensor de posici√≥n u otra cosa conduce a esta curva), sigue sin estar claro. </font></font><br>
<br>
<img src="https://habrastorage.org/files/cb4/56d/195/cb456d1959b148e18c758a60bcbf4b1d.png" align="right"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelo? S√≠, esta es una buena ayuda.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muy a menudo, el desarrollo de estructuras de gesti√≥n complejas comienza con el modelado. En t√©rminos de TAU y en forma de ecuaciones diferenciales, se describe el objeto de control, se construye el sistema de control propuesto (como en la figura anterior, por ejemplo), y luego todo esto se realiza ... bueno, qui√©n ama qu√©, pero el est√°ndar de facto es Simulink Matlab. En √©l, puede "dibujar" una estructura junto con un modelo del objeto de control, utilizando "suelto" en forma de integradores, sumadores, funciones de transici√≥n, etc. Puede usar su paquete para modelar circuitos el√©ctricos, donde hay llaves IGBT listas para usar, motores el√©ctricos, resistencias, condensadores y m√°s, dando a merced de los programadores de matlab la implementaci√≥n del trazado en forma de ecuaciones diferenciales y dibujando la estructura de control en forma de "hoja suelta".Y puede escribir todos los bloques necesarios en matlab en C. Este m√©todo es conveniente porque el c√≥digo del programa depurado en el matlab puede simplemente copiarse al microcontrolador. Por lo general, esta etapa siempre sigue al "dibujo", cuando la estructura del sistema de control despu√©s de un trabajo de investigaci√≥n aproximado sobre modelado est√° m√°s o menos formada. Pero a menudo los par√°metros del objeto son desconocidos a priori, o se conocen de manera muy inexacta; nunca antes el software que funcionaba en el modelo comenz√≥ a funcionar bien en el objeto. Tambi√©n es imposible poner "todo" en el modelo: transistores de conmutaci√≥n transitorios, saturaci√≥n del circuito magn√©tico, corrientes par√°sitas, acoplamiento capacitivo, par√°metros flotantes de temperatura y de instancia a instancia, interferencia aqu√≠ y all√° ... Y a veces el objeto de regulaci√≥n es tan complicado,que es m√°s f√°cil desarrollar una estructura de control directamente en la instalaci√≥n.</font></font><br>
<blockquote><i>,                 ,   ()  -    .        ,        ,     ¬´¬ª  ‚Äì      ,    ,       - ? (   ‚Äì  ,   ¬´  ¬ª,   ).</i></blockquote><br>
<br>
<img src="https://habrastorage.org/files/87d/3fa/b55/87d3fab5514c4539abcba708c6601d24.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n hay una serie de productos que le permiten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"dibujar" programas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directamente para microcontroladores. Incluyendo el mismo Matlab es capaz de generar c√≥digo C para marcas famosas de MK basadas en el modelo de Simulink. Supuestamente, puede dibujar y depurar la estructura dibujada del sistema de control en la computadora en el modelo, y luego subirlo a MK, y listo, ¬°vamos! E incluso dichos entornos le permiten depurar estructuras de control dibujadas dentro del MK, ver variables, etc., y en los sitios de dichos productos hay un mont√≥n de proyectos de demostraci√≥n para los sistemas m√°s complejos que est√°n "programados" de esta manera. Pero dado que todos los proyectos reales todav√≠a se est√°n programando con "manos" por alguna raz√≥n, podemos adivinar que algo est√° mal con "dibujar". Pero aqu√≠ es incluso dif√≠cil describir exactamente qu√©, cuando no es as√≠, eso es todo. El argumento principal contra</font></font><b>‚Äì        </b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Presiona un bot√≥n en un entorno de "hacerlo bien" y espera que el generador de c√≥digo haga el resto por usted. Para algunos sistemas simples, donde el rendimiento de MK est√° "detr√°s de los ojos", el cronograma de desarrollo es muy ajustado, y nadie sabe c√≥mo programar en la empresa que inici√≥ el proyecto ... entonces s√≠, probablemente pueda intentar "dibujar" el programa. Pero si no funciona como deber√≠a, o tendr√° alg√∫n problema t√©cnico muy espec√≠fico, entonces ya no habr√° ninguna posibilidad de depurarlo. Y para una tarea compleja, donde incluso cuando la programaci√≥n con manos con rendimiento MK siempre es un problema, el dibujo no es adecuado simplemente por falta de recursos: cualquier lenguaje de programaci√≥n que sea de nivel superior (mucho m√°s alto que el dibujo) genera un c√≥digo de m√°quina menos √≥ptimo. Y las optimizaciones de bajo nivel que har√≠a un programador en Cdicho sistema no podr√° hacerlo (c√°lculo de bloques de la misma estructura con diferente sincronizaci√≥n, uso de valores en cach√© de seno y coseno, reemplazo de funciones de divisi√≥n por multiplicaci√≥n por un valor previamente preparado, o cosas absolutamente dif√≠ciles como</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tal</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , etc.). </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, debe escribir su software y escribir en C.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Y de una forma u otra, necesita depurar su software, y es necesario en el objeto. Probablemente, todos en este punto del art√≠culo ya entendieron que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la estructura de control solo se puede depurar viendo los oscilogramas de las variables internas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , es decir. al ver los gr√°ficos a tiempo, c√≥mo cambia esta o aquella variable en C, por ejemplo, "la salida de ese bloque, el quinto desde la izquierda, simult√°neamente con las entradas del tercero desde la derecha". Obteniendo fotos como esta:</font></font><br>
 <div style="text-align:center;"><img src="https://habrastorage.org/files/0e0/2cc/c45/0e02ccc455504d699a7f8dfc02617634.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y esto solo se puede hacer por medio del microcontrolador. No puede simplemente tomar y poner la interfaz de comunicaci√≥n r√°pida externa y enviar "arriba" el valor de alguna variable, lo m√°s r√°pido posible, y construir un gr√°fico en el sistema de nivel superior. Debido a que ninguna interfaz de comunicaci√≥n MK tendr√° tiempo para hacer esto con la frecuencia con la que ocurren los transitorios regulados. Y si tiene √©xito, todos los recursos de MK se destinar√°n al mantenimiento de esta interfaz de comunicaci√≥n. Por lo tanto, hacen esto: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">registran la forma de onda en la RAM de MK</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solo en una matriz. Por lo general, no se necesitan muchos puntos: simplemente tome el momento correcto para escribir exactamente los datos: coloque el disparador correcto al comienzo de la grabaci√≥n. Y luego puede ver qu√© estaban dando estos o esos bloques del sistema de control en el momento de la falla, c√≥mo se estaba desarrollando, qu√© estaba tratando de hacer MK. Por supuesto, todas las variables no pueden oscilar inmediatamente de una vez, pero en la pr√°ctica, en nuestra experiencia, hay suficientes, por ejemplo, cuatro conjuntos de 256 puntos cada uno, una especie de osciloscopio de cuatro canales que utiliza herramientas MK. Si el equipo funciona mal m√°s de una vez por semana, entonces la depuraci√≥n no es un problema: en un experimento observamos estas 4 variables, en el siguiente reemplazamos la mitad con las otras, volvemos a mirar ... hasta que se encuentra una unidad que funciona mal, o hasta que eliminamos todo lo que sucede en todos los bloques y no te vayas a mirar el "metraje", rascando el lugar qui√©n piensa qu√© ...</font></font><br>
<br>
<img src="https://habrastorage.org/files/e35/ad1/99c/e35ad199c3054cf88227b00e60ea4e42.png" align="left"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo disparar tales oscilogramas? ¬øQu√© software puede hacer esto? ¬øQu√© interfaz de comunicaci√≥n reenv√≠a esto? En realidad, Texas Instruments es, por lo tanto, el l√≠der en la producci√≥n de microcontroladores de control de motores, ya que hizo todo por esto: Code Composer Studio (su entorno de desarrollo) m√°s MK en tiempo real. El modo en tiempo real es cuando a trav√©s de JTAG el entorno de desarrollo puede solicitar y escribir datos en la memoria RAM del MK sin detenerlo. Incluso no solo sin detenerse, sino sin la menor interrupci√≥n de su trabajo. Este modo est√° disponible en todos los MK de la serie C2000, pero requiere el costoso y r√°pido JTAG para usarlo, lo que lo admite. Pero adem√°s del modo en s√≠, el MK deber√≠a tener algo correspondiente en la parte posterior del cable: el entorno de desarrollo de Code Composer Studio puede construir formas de onda de f√°brica.Adem√°s, tanto en el modo m√°s simple, cuando el usuario establece el nombre de la variable C y ve su cambio en el tiempo en el gr√°fico, y el entorno solicita datos con la frecuencia que puede (generalmente buena, si Hertz 10), y en el modo de mostrar la matriz en la memoria en forma de onda, es decir justo lo que se describe arriba.</font></font><b> ,     ,      ,  Code Composer Studio  JTAG       .</b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al mismo tiempo, el dispositivo puede continuar funcionando como si nada hubiera pasado. Esta herramienta se ha utilizado con √©xito durante m√°s de diez a√±os, y, de hecho, esa ideolog√≠a de depuraci√≥n (parece, pero puedo estar equivocado) fue propuesta por Texas. En todos sus proyectos de demostraci√≥n hay un m√≥dulo de registro de datos (que registra conjuntos de formas de onda) y los manuales describen c√≥mo usarlo. Por cierto, aqu√≠ debes tirar una piedra al jard√≠n ARM. Tambi√©n tienen un modo en tiempo real, y en esta arquitectura hay MK que pueden controlar motores el√©ctricos. Sin embargo, en ning√∫n entorno de desarrollo me he encontrado con una funci√≥n gr√°fica, incluso si se admite el modo en tiempo real. Por ejemplo, en Keil's amado por todos, incluso es imposible cambiar normalmente el valor de una variable en un MK en ejecuci√≥n: se actualiza constantemente,y el nuevo valor ingresado por el usuario en la ventana se borra ... Sin mencionar los gr√°ficos all√≠. ¬øQuiz√°s alguien en los comentarios sugiera una opci√≥n de trabajo? ¬øO es "nadie lo necesita" y, por lo tanto, no funciona?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero hay un problema con este m√©todo de depuraci√≥n, incluso a trav√©s de Code Composer Studio. </font><font style="vertical-align: inherit;">Y este problema es JTAG. </font><font style="vertical-align: inherit;">Como se dijo, su conector no siempre est√° disponible, y con mayor frecuencia en equipos en funcionamiento y no est√° disponible en absoluto. </font><font style="vertical-align: inherit;">Y, francamente, no es </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">muy c√≥modo sentarse a un par de metros del convertidor de megavatios, observar sus oscilogramas de trabajo,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y muy concentrado y concentrado para rodear el bot√≥n de "parada" del microcontrolador con el mouse, ¬øqu√© pasa si un dedo tiembla en el camino? </font><font style="vertical-align: inherit;">¬øSabes c√≥mo el panel t√°ctil tiene errores cuando se usa un PWM potente? </font><font style="vertical-align: inherit;">¬øY si el entorno falla? </font><font style="vertical-align: inherit;">¬øQu√© hay de JTAG? </font><font style="vertical-align: inherit;">¬øTodo, chicas?</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Babakh ordinario</font></font></b><div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/files/de8/e31/f38/de8e31f38400412aaa02056649add98c.jpg"></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, los oscilogramas en el entorno de desarrollo se muestran en los valores "tal cual" en C, sin ninguna escala, en diferentes ventanas de los gr√°ficos, sin unidades de medida personalizadas (recuerde que en este gr√°fico 0.342 son voltios, deben multiplicarse en la mente por 540 para obtener unidades f√≠sicas, y aqu√≠ 1.2 son amperios con una escala de 800A). </font><font style="vertical-align: inherit;">E inc√≥modo y aterrador. </font><font style="vertical-align: inherit;">Y, sin embargo, ¬°no todos los entornos MK y de desarrollo pueden ver oscilogramas! </font><font style="vertical-align: inherit;">¬øDe repente el tuyo no es Texas? </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, decidimos inventar otra forma.</font></font></b><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuestra decision</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad, si no necesitamos una depuraci√≥n paso a paso, ¬øcu√°l es el problema? </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reemplazamos todo lo que hacemos a trav√©s de JTAG con cualquier otra interfaz de comunicaci√≥n</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font><b><font style="vertical-align: inherit;">creamos</font></b><font style="vertical-align: inherit;"> nuestro propio shell de nivel superior, que construye los gr√°ficos de la manera que queremos. </font><font style="vertical-align: inherit;">Beneficio!</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/64f/f8d/f37/64ff8df373724e92af81eb389bc1becc.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces lo hicimos. Interfaz de comunicaci√≥n que elegimos CAN, protocolo - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CANopen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Por qu√© CAN es una interfaz de comunicaci√≥n industrial muy buena, resistente al ruido, tiene arbitraje de hardware, acceso no destructivo al bus, confirmaci√≥n de hardware de los paquetes y, al mismo tiempo, solo dos cables y tierra. Esto es mejor que todos los RS, y menos monstruoso que Ethernet (que es bastante ex√≥tico en el motorcontrol MK). ¬øPor qu√© canopen? En realidad, hay dos protocolos comunes para CAN, estos son J1939 ("automotriz") y CANopen (m√°quinas herramienta, automatizaci√≥n, sensores, etc.). No hay mucha diferencia entre ellos, pero CANopen nos pareci√≥ m√°s flexible, por lo que lo implementamos en nuestra propia pila (controlador). Qui√©n no sabe nada sobre CANopen: su funci√≥n principal, como muchos protocolos para MK, es proporcionar acceso al diccionario de objetos (lista de variables en C MK) en una direcci√≥n espec√≠fica. Esto se puede hacer de dos maneras principales:Mensajes SDO de tipo solicitud-respuesta, as√≠ como mensajes PDO en forma de valores de env√≠o constantes por temporizador o por evento (establece el nivel superior de qu√© enviar y cu√°ndo). Tambi√©n hay varios servicios de servicio, como mensajes de emergencia, mensajes sobre la presencia de dispositivos en la red (latidos), etc. No se requiere un asistente en la red: quien quiera, env√≠a, a quien quiera, acepta.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/5e6/c70/423/5e6c70423a3840419cb3b46741987eb4.png" align="left"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creamos la pila CANopen no solo para MK, sino tambi√©n para la computadora en forma de biblioteca. Y ya sobre su base, Windows escribi√≥ su propio entorno de nivel superior. Primero, simplemente hicieron acceso a las variables del diccionario de objetos para que fuera posible ver y cambiar la configuraci√≥n del sistema de control (¬°y hay cientos de ellas, por cierto!), Luego hicieron gr√°ficos al consultar peri√≥dicamente el par√°metro del diccionario de objetos a trav√©s de la red, y luego agregaron la carga de formas de onda de los arreglos MK (Adem√°s, la elecci√≥n de qu√© oscil√≥grafo tambi√©n se realiza a partir de objetos variables del diccionario). </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conseguimos todo lo mismo que proporciona depuraci√≥n a trav√©s de JTAG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O no? No, porque tambi√©n necesitaba la funci√≥n de actualizar el software a trav√©s de CAN. A pesar de la presencia de un cargador de arranque CAN en Texas MK, decidimos hacer el nuestro, ya que el est√°ndar no era CANopen y pod√≠a interferir con el funcionamiento de otros dispositivos en la red mientras cos√≠amos uno, as√≠ como los dispositivos podr√≠an interferir con el firmware. Adem√°s, hubo problemas con la correcci√≥n de errores y la p√©rdida de mensajes (aunque CAN es muy bueno, a veces se bloquea y el firmware es algo muy importante para no hacer una verificaci√≥n o volver a intentar enviar una pieza rota). Por lo tanto, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementamos nuestro "programador" a trav√©s de la red CAN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero dentro del marco del protocolo CANOpen. Ahora ya est√° todo. Ahora pudimos abandonar completamente JTAG, us√°ndolo solo una vez, para programar un nuevo MK.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al mismo tiempo, este enfoque abri√≥ nuevos horizontes de depuraci√≥n que no hab√≠amos visto antes. Dado que creamos el entorno de nivel superior con un ojo puesto no solo en los programadores, sino tambi√©n en las "personas comunes", creamos todos los par√°metros de los nombres en idioma ruso e hicimos documentaci√≥n para el instalador para cada par√°metro (la documentaci√≥n no es el entorno, sino el dispositivo, por supuesto). Y fue beneficioso: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ahora si hay alg√∫n problema con la unidad, no tiene que "tirar" del desarrollador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- El personal de servicio al cliente en algunos casos puede diagnosticar problemas de forma independiente. Ahora podemos recibir un correo electr√≥nico como ‚ÄúNuestro disco comenz√≥ a emitir sonidos extra√±os a veces, mir√© el oscilograma del sensor de posici√≥n, eso es lo que vi (imagen). ¬°Verifiqu√© la conexi√≥n a tierra de la pantalla, se cay√≥, solde y todo funcion√≥ como deber√≠a! ¬°Y absolutamente no hay necesidad de ir a ning√∫n lado o volar! El segundo "descubrimiento": si hay un problema, le pedimos al cliente que conecte la computadora al equipo y le d√© control remoto de escritorio a trav√©s de Internet: lanzamos nuestro entorno de nivel superior, oscilaremos todo nosotros mismos, corregiremos los par√°metros / firmware / decimos que rompi√≥, ¬°ganancias! Una vez m√°s, no tiene que ir a ninguna parte (lo principal es que Internet debe estar en las instalaciones, al menos a trav√©s de una red celular).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con los a√±os, este programa de nivel superior ha adquirido peque√±as funciones, como los hongos (un proceso natural para el software que utilizan). Esto incluye trabajar con el registro de fallas del dispositivo y guardar / cargar un nugget de todos los par√°metros en un archivo en la computadora, y configurar el panel de control del dispositivo a la "panel de control", y mantener registros de red en un archivo y devolver el tr√°fico de red CAN a trav√©s de TCP / IP, y firmware / parametrizaci√≥n autom√°tica m√∫ltiple de dispositivos similares en la red (si hay docenas de dispositivos, entonces flashear todo con las manos es vago, necesita un script), etc.</font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/9ba/78c/d12/9ba78cd1202b435f810aa132a0f3299e.png" align="left"></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bueno, ahora algo de publicidad. Ahora ya es una herramienta muy poderosa (la llamamos tanto como UniCON), que en algunas tareas parece m√°s funcional que un software similar de marcas famosas para configurar sus unidades y dispositivos. Adem√°s, no est√° vinculado a un dispositivo espec√≠fico: puede configurar al menos una unidad el√©ctrica, al menos una estufa, al menos un cargador, solo cambia el diccionario de objetos. Ahora en nuestra empresa no vemos la oportunidad de completar con √©xito un nuevo proyecto complejo sin </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuestras herramientas de depuraci√≥n CANopen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para trabajar con UniCON, solo necesita incrustar nuestra pila CANopen en MK, despu√©s de lo cual MK se convierte en un laboratorio digital. Estamos seguros de que todas las empresas que crean sistemas de control serios en MK tienen herramientas de depuraci√≥n similares. Pero ofrecemos nuestra soluci√≥n CANopen en forma de un producto de software independiente, ya que se implementa universalmente en t√©rminos de independencia de las funciones del dispositivo. Actualmente, hemos implementado la pila CANopen con las funciones avanzadas descritas para el Texas Instruments C2000 MK, sus microcontroladores ARM (por ejemplo, la familia Concerto) y para el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K1921VK01T del</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NIIET OJSC. Por lo tanto, si necesita desarrollar un sistema de control para un accionamiento el√©ctrico u otro objeto de control complejo, lo invitamos a cooperar.</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PD: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En los comentarios, esperamos con ansias las cr√≠ticas a la forma "As√≠ que hay ***, hace lo mismo y de forma gratuita". Dado que hemos estado buscando herramientas de depuraci√≥n similares para ARM para la funcionalidad durante mucho tiempo, incluso nos topamos con entornos de desarrollo famosos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
UPD: Gracias a los comentarios de   </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indemsys</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,   </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">olekl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y   </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LeonidLenin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encontramos funciones de gr√°ficos en entornos de desarrollo para ARM Keil y STMStudio cuando trabajamos a trav√©s de SWD. </font><font style="vertical-align: inherit;">Sin embargo, no saben c√≥mo mostrar una matriz de datos de la memoria MK en forma de gr√°fico, que es justo lo que se necesita para observar los procesos r√°pidos de los sistemas de control (pero STMStudio puede mostrar gr√°ficos con un tiempo de muestreo de aproximadamente 1 ms usando el almacenamiento en cach√© de datos). </font><font style="vertical-align: inherit;">Tambi√©n es interesante la herramienta NXP FreeMaster: en descripci√≥n y prop√≥sito, es muy similar a nuestro desarrollo UniCON, pero con sus propias caracter√≠sticas. </font><font style="vertical-align: inherit;">Adem√°s, el Segger J-Link tiene su propia herramienta de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">visualizaci√≥n de forma de onda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es389123/">https://habr.com/ru/post/es389123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es389113/index.html">El SSD m√°s espacioso del mundo: 13 TB de Fixstars</a></li>
<li><a href="../es389115/index.html">Se propone que los √≥rganos y tejidos humanos para trasplante se cultiven en animales.</a></li>
<li><a href="../es389117/index.html">La impresora 3D Ripple Maker transfiere la imagen o el texto deseado a la superficie de la espuma de caf√©.</a></li>
<li><a href="../es389119/index.html">Agregar y configurar la base de datos 1C al servidor</a></li>
<li><a href="../es389121/index.html">Firefox 46 admitir√° m√∫ltiples monitores con diferentes densidades de p√≠xeles</a></li>
<li><a href="../es389125/index.html">Galactoseismology: c√≥mo las galaxias enanas que consisten en materia oscura dejan rastros en el gas interestelar</a></li>
<li><a href="../es389127/index.html">Comercializaci√≥n agresiva o c√≥mo la motivaci√≥n de un arco brillante en la mu√±eca ("bolas") difiere de la motivaci√≥n de un brazalete de fitness</a></li>
<li><a href="../es389129/index.html">Nuevo microcontrolador de control de motor dom√©stico K1921VK01T de OJSC NIIET</a></li>
<li><a href="../es389133/index.html">–°–æ–±–∞–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç —ç–º–æ—Ü–∏–∏ —á–µ–ª–æ–≤–µ–∫–∞ —Å –ø–æ–º–æ—â—å—é –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Ä–≥–∞–Ω–æ–≤ —á—É–≤—Å—Ç–≤</a></li>
<li><a href="../es389139/index.html">Drinky es un robot amigo que siempre est√° ah√≠</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>