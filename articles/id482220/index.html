<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥝 ♠️ 🈺 Lokalisasi penanda Aruco 🎾 👵🏿 🧙🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam posting terakhir, kami berbicara tentang bagaimana untuk pergi dari titik A ke titik B tanpa memukul apa pun. Tetapi untuk berkeliling sesuatu, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lokalisasi penanda Aruco</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482220/">  <a href="https://habr.com/ru/post/479636/">Dalam posting terakhir,</a> kami berbicara tentang bagaimana untuk pergi dari titik A ke titik B tanpa memukul apa pun.  Tetapi untuk berkeliling sesuatu, Anda perlu memahami di mana kita berada, dan di mana ada hambatan dinamis (lawan kita dan bukan hanya). <br><br>  Seseorang memiliki mata, telinga, dan perangkat lunak yang diletakkan berdasarkan alam dan pengalaman pribadi sehingga ia dapat dengan mudah bergerak dan bernavigasi di ruang angkasa.  Sistem pelokalan hampir seperti mata dan telinga untuk robot.  Diperlukan agar robot dapat menavigasi di ruang angkasa dan, menyesuaikan dengan lingkungan, bergerak di dalamnya. <br><br>  Hari ini kita akan berbicara tentang bagaimana kita memecahkan masalah menentukan posisi robot di bidang Eurobot, bagaimana melakukan semua ini, meluncurkan dan mengkonfigurasi untuk diri sendiri. <br><br><img src="https://habrastorage.org/webt/wd/ob/7l/wdob7lxsj1x5z0ubs94tyz5hf08.png"><br><a name="habracut"></a><br><h2>  Kondisi target sistem pelokalan </h2><br>  Salah satu prinsip Eurobot Open adalah otonomi.  Otonomi dari segala yang ada di belakang lapangan bermain.  Semua perhitungan, pengambilan keputusan, dan pelokalan harus dilakukan di robot \, atau di situs khusus di lapangan. <br><br>  Ukuran bidang adalah 2x3 meter, dan kesalahan dalam ukuran dan posisi elemen di atasnya dari bidang ke bidang biasanya dalam 3-5 mm. <br><br>  Pada gambar di bawah ini adalah diagram bidang Eurobot 2019 dengan zona bertanda tempat kita dapat meletakkan sesuatu selain robot. <br><br><img src="https://habrastorage.org/webt/ed/sn/nr/edsnnr36r2ksmv9sr7pzjz1khhk.png"><br><br><ul><li>  6 - Zona Eksperimen (salah satu tugas tambahan) </li><li>  10 - Zona Mercusuar </li><li>  11 - Sebuah menara khusus untuk memasang alat pelacak pusat (selanjutnya disebut CCC)  Terletak di atas lapangan pada ketinggian 1 meter </li><li>  Juga pada robot itu sendiri kita dapat memasang beacon. </li></ul><br>  Untuk semua area dan dimensi robot itu sendiri, ada batasan ketat pada berat dan ukuran, karena itu tidak mungkin untuk membuat satu supermodul produktif besar di mana semuanya cocok.  Dan ada juga batas 3 menit persiapan untuk peluncuran.  Selama waktu ini, satu atau dua orang dari tim harus mengeluarkan robot dan segala sesuatu yang berkaitan dengan mereka, mengatur, mengkonfigurasi dan mempersiapkan peluncuran.  Jelas, semakin sedikit sampah yang perlu Anda atur dan atur, semakin kecil kemungkinan Anda melakukan kesalahan atau didenda sebelum dimulainya pertempuran. <br><br><img src="https://habrastorage.org/webt/73/ic/e7/73ice79-lmosmu6rt-gi5gdz744.jpeg"><br>  <i>dan satu lagi kotak penuh seperti itu</i> <br><br><h3>  Kami menganalisis opsi </h3><br>  Dengan kesadaran akan kemampuan kami dan keinginan untuk mendapatkan akurasi posisi setidaknya beberapa milimeter, mari kita lihat apa yang secara umum dapat kita gunakan untuk menyelesaikan masalah ini: <br><br><ul><li>  <b>Odometri roda</b> menggunakan enkoder yang terletak langsung di drive atau roda pengukur tambahan memungkinkan Anda membaca jarak yang ditempuh robot dan menentukan posisinya relatif terhadap titik awal.  Banyak tim Eurobot menggunakannya sebagai metode pelokalan utama mereka.  Ini adalah salah satu sumber informasi gerakan tercepat untuk robot.  Namun, dalam praktiknya, terutama ketika mengemudi di atas roda omni (area kontak yang lebih kecil dari roda klasik, permainan rol dan kesalahan pabrikasi yang lebih besar), odometri rentan terhadap masalah kesalahan kumulatif, yang entah bagaimana perlu diperbaiki.  Anda dapat menyelaraskan dengan permukaan dengan koordinat yang diketahui, atau Anda dapat kompleks dengan sistem tambahan.  Juga, jika Anda menggunakan encoders pada roda penggerak, maka ada masalah selip roda selama manuver tajam dan dalam tabrakan robot.  Roda pengukur bisa menghilangkan masalah ini, tetapi sulit untuk ditempatkan di robot kecil. <br><br><img src="https://habrastorage.org/webt/v0/8u/bd/v08ubdzodh5zpr8kr7ee3fhbo5y.png"><br>  <i>roda omni pengukur buatan sendiri dengan suspensi independen dan dengan magnetic encoder, yang kami gunakan pada tahun 2018</i> <br></li><li>  <b>Lidar</b> memiliki keunggulan signifikan: kami mendapatkan tampilan yang hampir bundar dan jarak ke rintangan.  Dari minus, perlu dicatat harga tinggi, kesulitan dalam mencoba membedakan objek kecil dari sampah, dan algoritma pelokalan yang relatif rumit.  Lidar murah (seperti rplidar) memiliki kecepatan refresh dan resolusi sudut yang cukup rendah, dan juga dapat terkena cahaya dari lidar lain, pengukur jarak, dll. Dalam robot, sulit untuk menemukan lidar di tingkat samping untuk menggunakan algoritma SLAM klasik, tetapi pada yang disediakan aturan ketinggian untuk sistem lokalisasi memiliki beberapa objek statis untuk diikat.  Namun, tim Skoltech telah berhasil skating selama beberapa tahun menggunakan hokuyo ust-10lx dan tahun lalu mengambil tempat kedua di final Eropa kompetisi Eurobot di Prancis. </li><li>  Kami juga mempertimbangkan <b>sistem inersia</b> , tetapi dalam kasus kami mereka tidak cocok.  Accelerometer berisik, giroskop mengambang, Anda bisa melupakan menggunakan kompas di dalam ruangan.  Bahkan penggunaan filter Kalman tidak mencapai akurasi yang diinginkan.  Ternyata IMU hanya dapat digunakan secara efektif untuk koreksi dalam waktu yang sangat singkat.  Maksimal informasi berguna yang dapat kami peroleh dengan pixhawk2 adalah sudut selama belokan tajam (dari tabrakan, misalnya). </li><li>  <b>GPS</b> tidak berfungsi di dalam ruangan, dan akurasi tanpa RTK adalah meter. </li><li>  <b>Lokalisasi ultrasonik</b> .  Salah satu implementasinya dapat ditemukan di sini: <a href="https://m.habr.com/ru/post/451408/">m.habr.com/en/post/451408</a> .  Sayangnya, akurasi untuk tugas kami tidak terlalu tinggi (+ -2cm), crosstalk sangat mempengaruhi, atau, jika Anda menggunakan sensor dengan perlindungan terhadap ini, frekuensi polling rendah diperoleh.  Salah satu tim di Rusia menggunakan solusi ini dengan berbagai keberhasilan, dan tim Turag Jerman cukup berhasil mengendarai teknologi serupa yang dikembangkan di dalam lab. </li><li>  <b>Odometri visual</b> tidak memberikan informasi tentang posisi lawan karena fakta bahwa tidak banyak poin di lapangan yang memungkinkan untuk diandalkan. </li><li>  <b>\ Tof kamera stereo</b> memiliki sudut sempit, yang tidak memungkinkan untuk menutupi bidang ketika terletak di perangkat pelacakan pusat, atau untuk mendapatkan tampilan lingkaran atau setidaknya dapat diterima saat dipasang pada robot. </li><li>  <b>Penanda fidusia</b> yang telah kami pilih dan yang akan kami periksa lebih detail. </li></ul><br><h3>  Spidol fidusia </h3><br>  Navigasi penanda sudah ada sejak lama.  Secara teoritis, penanda yang disebut dapat berupa objek apa saja.  Tetapi ada banyak masalah saat menggunakan: <br><br><ul><li>  pembatasan karena resolusi kamera; </li><li>  deteksi yang tidak dapat diandalkan ketika menggunakan warna sebagai sumber utama informasi; </li><li>  kebutuhan untuk menentukan orientasi penanda; </li><li>  tanda kontras rendah hanya bekerja dengan baik dalam cahaya yang baik; </li><li>  daya pemrosesan yang tinggi dari peralatan diperlukan (pemrosesan waktu nyata dari frame yang masuk). </li></ul><br>  Untuk menghindari masalah di atas, Anda biasanya harus menggunakan sesuatu yang sederhana dan tidak ambigu untuk pengakuan, misalnya, lingkaran berwarna atau kotak (dan saya ingin bebek kuning). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/636/59e/f61/63659ef613cf69454b7b3b9d788d934e.png" alt="gambar"><br>  <i>berbagai jenis penanda</i> <br><br>  Bahkan, selain menentukan posisi penanda, sering kali ada kebutuhan untuk menentukan keunikannya, misalnya, untuk mendeteksi beberapa objek sekaligus.  Untuk melakukan ini, Anda dapat mengubah warna atau bentuk, tetapi kami akan segera menghadapi penurunan dalam keandalan deteksi. <br>  Masalah ini cukup umum dan ada banyak standar penanda.  Yang paling terkenal adalah kode qr, tetapi jarang digunakan untuk masalah lokalisasi karena redundansi dan kebutuhan untuk resolusi tinggi.  Sebagai aturan, semua penanda adalah dua warna (paling sering b / w), dari bentuk sederhana (paling sering persegi) dan entah bagaimana menyandikan pengidentifikasi dalam diri mereka sendiri.  Penanda paling terkenal untuk pelokalan adalah Aruco, April Tag, ARToolKit. <br><br>  Siapa pun yang tertarik untuk mempelajari lebih lanjut tentang mereka adalah <a href="https://www.researchgate.net/publication/303752217_An_evaluation_of_artificial_fiducial_markers_in_underwater_environments">artikel</a> menarik yang juga membandingkan keandalan deteksi mereka. <br><br><div class="spoiler">  <b class="spoiler_title">Penanda fraktal</b> <div class="spoiler_text">  Ada saat-saat ketika kita perlu mendeteksi suatu objek baik dari jauh maupun langsung ke sana.  Menggunakan beberapa spidol dengan ukuran berbeda adalah satu cara, tetapi Anda dapat melakukannya dengan lebih cerdik dan menggunakan spidol "fraktal", bagian yang berbeda bekerja pada skala gambar yang berbeda. <br><br>  <a href="https://docs.google.com/document/u/1/d/1SdsOTjGdu5o8gy2Ot2FDqYDS9ALgyhOBJcJHOZBR7B4/mobilebasic">docs.google.com/document/u/1/d/1SdsOTjGdu5o8gy2Ot2FDqYDS9ALgyhOBJcJHOZBR7B4/mobilebasic</a> <br></div></div><br>  Dalam kasus kami, kami memiliki banyak aspek positif menggunakan spidol: <br><br><ul><li>  dengan kemungkinan memasang kamera statis dengan sudut pandang dan tanda yang baik, ini tidak memerlukan peralatan yang sulit ditemukan dan berpotensi tidak terlalu sulit untuk diterapkan; </li><li>  kamera jarak jauh dapat mengevaluasi posisi semua objek yang dapat kita beri tanda; </li><li>  perhitungan dilakukan bukan pada perangkat robot, tetapi dilakukan pada komputer yang terpisah (tetapi ada masalah dengan keandalan dan keterlambatan dalam transfer data); </li><li>  kemampuan untuk memecahkan masalah lain yang terkait dengan visi. </li></ul><br>  Setelah menganalisis sistem di atas, kami menentukan deteksi marker.  Ini memungkinkan kami tidak hanya membebaskan odroid kami dengan robot, tetapi juga memungkinkan mereka untuk melihat seluruh situasi di lapangan dari pandangan mata burung. <br><br><h3>  Bagaimana cara kerjanya di luar kotak </h3><br>  "Keandalan" deteksi penanda adalah istilah yang relatif.  Tugas yang berbeda memerlukan tingkat akurasi dan stabilitas yang berbeda.  Termasuk parameter ini tergantung pada sensor video, lensa, kondisi pencahayaan, dll. <br><br><img src="https://habrastorage.org/webt/yi/xs/5m/yixs5m5g6pv5xya8axbd-zqov-4.png"><br>  Dalam kasus kami, dengan ukuran bidang 2x3 meter dan kamera hanya satu meter di atasnya, perlu menggunakan optik sudut ultra lebar dengan bidang pandang minimal 120-140 derajat untuk memastikan visibilitas seluruh ruang bermain, yang secara negatif mempengaruhi deteksi (dan keakuratannya) dari penanda kecil di kejauhan. sudut lapangan bermain, dan di bawah kondisi pencahayaan yang sewenang-wenang membuat tugas ini semakin sulit. <br>  Seperti yang telah ditunjukkan oleh praktik, bahkan di bawah kondisi normal, sepenuhnya alami, dengan penerangan, definisi posisi marker yang salah dapat terjadi. <br><br><img src="https://habrastorage.org/webt/km/-n/cl/km-nclpq-m4g3jcgvwxls4eixb0.png"><br><br>  Jadi gambar-gambar berikut menunjukkan dua frame berturut-turut dengan hasil deteksi marker: arah sumbu Z (biru) berubah 180 derajat. <br><br><img src="https://habrastorage.org/webt/sd/a5/ha/sda5haouwemxqiobswwckpb8dhw.png"><br><br><img src="https://habrastorage.org/webt/tu/gj/ii/tugjiiiol9ts2m4laiexh7nwnue.png"><br>  <i><a href="https://www.youtube.com/watch%3Fv%3DxzG2jQfxLlY">www.youtube.com/watch?v=xzG2jQfxLlY</a></i> <br><br><h3>  Membawa ke kondisi kompetitif </h3><br><h4>  Ubah algoritme </h4><br>  Untuk menentukan lokasi robot di lapangan secara akurat, Anda perlu mengetahui posisi sudut kamera, transformasi umum sistem koordinat dan posisi kamera relatif terhadap posisi lapangan.  Untuk melakukan konversi ini, kami mengembangkan algoritme kami sendiri.  Karena seseorang menggantung pusat kendali pusat secara manual, ditambah bidang yang sedikit berbeda satu sama lain, maka tidak mungkin untuk selalu mendapatkan posisi kamera yang sama.  Perpindahan sudut kamera relatif ke lapangan memiliki efek yang sangat negatif pada deteksi posisi robot.  Solusi mendasar adalah menentukan beberapa penanda statis yang dapat kita atur sebelum pencocokan untuk kalibrasi. <br><br>  Pustaka Aruco dalam OpenCV menyediakan kemampuan untuk menentukan posisi marker 6dof relatif terhadap kamera.  Awalnya kami mencoba menggunakannya, tetapi ternyata sangat tidak stabil dan tidak akurat.  Dalam kasus kami, ketika posisi kamera diketahui, itu diperbaiki, dan robot (dan spidol terkait) bergerak di pesawat yang tidak melewati titik lampiran kamera, adalah rasional untuk membatasi diri pada tugas mendeteksi posisi 3d (z-const, x-y, + rotasi sekitar) satu sumbu z) melalui triangulasi titik pada bidang pada sudut yang terlihat. <br><br>  Diharapkan bahwa penurunan dimensi dan peningkatan dasar triangulasi (ukuran marker versus jarak dari bidang marker ke kamera) dari masalah yang diselesaikan mengurangi tingkat ketidakpastian dan kebisingan dari hasil deteksi. <br>  Untuk melakukan ini, alih-alih fungsi standar <br><br><pre><code class="cpp hljs">cv::aruco::estimatePoseSingleMarkers(markerCorners, <span class="hljs-number"><span class="hljs-number">0.05</span></span>, cameraMatrix, distCoeffs, rvecs, tvecs);</code> </pre> <br><br>  yang, berdasarkan sudut yang ditemukan dari marker, menentukan posisi 6d dari marker, kami menulis penduga posisi kami, bekerja sesuai dengan prinsip-prinsip berikut: <br><br><ul><li>  Posisi kamera 3D diketahui sebelumnya; </li><li>  ketinggian marker diketahui sebelumnya; </li><li>  sebagai hasil deteksi, piksel (v, u) dari 4 sudut marker diketahui; </li><li>  sebagai hasil dari kalibrasi kamera, sebuah matriks kamera 4x4 didefinisikan; </li><li>  mengetahui 'matriks kamera', posisi dan orientasi kamera, posisi sudut piksel penanda, Anda bisa mendapatkan proyeksi posisi sudut dalam ruang 3D pada bidang z di mana simpul penanda berada (ketinggian penanda ditentukan oleh jumlahnya); </li><li>  membuat langkah sebelumnya untuk keempat sudut penanda dan rata-rata data yang diperoleh, dimungkinkan untuk mendapatkan koordinat 3D dari simpul penanda dalam sistem koordinat kamera; </li><li>  menerapkan transformasi dari kamera SK ke SK bidang bermain, koordinat penanda di bidang SK diperoleh. </li></ul><br><h4>  Memecahkan masalah pencahayaan dan kinerja </h4><br>  Stabilitas dan kecepatan deteksi marker sangat tergantung pada kondisi pencahayaan lingkungan dan struktur latar belakang, semakin banyak objek dalam bingkai, semakin lama waktu pemrosesan.  Karena aturan pencahayaan dan latar belakang Eurobot tidak diatur dengan cara apa pun, mereka dapat berubah sangat dari waktu ke waktu, mungkin ada bidang lain, orang-orang di latar belakang.  Secara khusus, eksposur tambahan dari robot musuh, lampu kilat kamera atau lampu sorot yang jatuh ke bidang pandang kamera dapat diharapkan. <br><br>  Untuk mengurangi pengaruh penerangan lingkungan pada stabilitas deteksi marker, “desain” khusus dikembangkan di mana marker aruco terbalik digunakan.  Bagian gelap digantikan oleh film retrospektif, dan lampu latar LED aktif dipasang langsung pada kamera.  Pemrosesan gambar dilakukan dalam negatif, sedangkan kontras latar belakang jauh lebih rendah daripada kontras penanda mereka sendiri. <br><br>  Meningkatkan kontras penanda memungkinkan Anda untuk secara efektif memilih wilayah yang diminati pada bingkai dan mencari penanda hanya di dalamnya, dan tidak di seluruh bingkai, yang sangat meningkatkan produktivitas. <br><br><img src="https://habrastorage.org/webt/fz/p0/4n/fzp04n01ugkpz4b8yuqrasmv2qy.png"><br>  <i>Perbandingan perbedaan kontras antara marker standar dan marker dengan permukaan reflektif</i> <br><br><h3>  Kami memilih besi </h3><br>  Karena kondisi pencahayaan tidak ditentukan, dan kecepatan robot bisa sangat besar, sejak awal kami mencari kamera dengan rana global, dan bukan dengan rana Bergulir.  Perbedaannya adalah bahwa global mengumpulkan informasi tentang kecerahan piksel pada saat yang sama, dan menggulirkan garis demi garis, karena itu mungkin ada distorsi dalam bentuk geometris objek bergerak. <br>  Kamera yang paling terjangkau adalah oCam-1mgn, yang kami gunakan selama 2 tahun.  Namun, hitam dan putih dan hanya memiliki resolusi 1Mpx, yang terletak di batas bawah dari resolusi yang dapat diterima (jumlah piksel pada gambar, per 1 "piksel" dari marker). <br>  Awalnya, detektor dianggap pada papan yang sama dengan robot itu sendiri - odroid xu4, dan kecepatan kerja sekitar 20 fps, namun, keinginan untuk menggantung fungsionalitas tambahan pada pusat kontrol pusat dan memahami bahwa kamera yang lebih baik diperlukan menyebabkan penggantian PC dengan Intel yang lebih kuat. Nuc, dan kameranya ... kamera yang masih kami ambil untuk musim baru. <br><br><h3>  Kami memulai proyek </h3><br>  Lebih lanjut diasumsikan bahwa Anda sudah memiliki ROS Kinetic atau Melodic yang dikonfigurasi. <br><br>  Hal pertama yang harus dilakukan adalah mengunduh dan menginstal OpenCV 3, Eigen3 dan proyek <a href="https://bitbucket.org/eurobot1718/ocam_usb_cam">https://bitbucket.org/eurobot1718/ocam_usb_cam</a> (untuk kamera Ocam), atau gunakan proyek lain yang serupa strukturnya dengan publikasi data dalam topik. <br><br>  Kami mengkloning repositori dengan proyek detektor arude: <a href="https://gitlab.com/eurobot2019/aruco_detector">https://gitlab.com/eurobot2019/aruco_detector</a> dan gui untuk itu <a href="https://github.com/alexpostnikov/aruco-gui">https://github.com/alexpostnikov/aruco-gui</a> <br>  Setelah menginstal proyek, Anda perlu mengkalibrasi kamera dan mendapatkan matriks dispersi dan matriks distorsi kamera, dan kemudian membungkus semuanya dalam file yaml "camera_params.yml".  Contoh sederhana adalah penggunaan papan catur.  <a href="https://github.com/sourishg/fisheye-stereo-calibration">Tautan</a> ke implementasi di C ++, di mana Anda hanya perlu mengumpulkan dan menentukan parameter papan dan kamera, serta nama file output. <br><br>  Pengaturan utama ada di file aruco_detector_params.yml: <br><br><ul><li>  <b>len_of_cube_markers</b> dan <b>width_marker</b> panjang dan lebar marker dalam meter; </li><li>  <b>markers_height</b> - perbandingan marker dan tingginya; </li><li>  <b>marker</b> - array yang menggambarkan apakah marker tertentu milik robot tertentu.  Ini menunjukkan penanda dalam arah searah jarum jam.  Dan dalam hal lawan, karena arah mereka tidak penting bagi kami, urutan penanda dalam konfigurasi juga tidak penting.  Anda hanya perlu menentukan kode penanda.  Kami juga memiliki spidol di sampul atas, jumlahnya disorot secara terpisah; </li><li>  <b>static_markers_ids</b> - marker yang dicari selama proses kalibrasi; </li><li>  <b>markers_position</b> - kamus dengan offset dan rotasi masing-masing marker relatif terhadap pusat robot; </li><li>  <b>brightness_threshold</b> tidak dapat disentuh - ini digunakan dalam kalibrasi otomatis awal cahaya; </li><li>  <b>camera_position_yellow</b> dan parameter serupa berfungsi sebagai pengaturan default jika kalibrasi gagal. </li></ul><br>  Matriks transformasi dari sistem koordinat kamera ke sistem koordinat lapangan ada di file transform_from_cam_to_map.xml <br><br>  Setelah semua pengaturan, Anda akhirnya harus menjalankannya.  Jalur ke file dengan parameter, sisi default dan jalur ke perangkat video diatur di aruco_detector_debug.launch, yang akan kami luncurkan.  Tetapi untuk peluncuran penuh, lebih baik menggunakan skrip bash aruco.bash, yang, selain detektor, meluncurkan gui (127.0.0.1►000).  Di sini kita dapat memilih sisi, memulai kalibrasi dan mengendalikan sistem.  Di jendela kedua, zona minat dan penanda yang ditemukan terlihat. <br><br><img src="https://habrastorage.org/webt/qe/ch/qf/qechqfeowcgq9xevhj8fplpmjqc.gif"><br><br>  Sekarang dalam topik: "/ musuh_robot1 / aruco", "/ musuh_robot2 / aruco", "/ big_robot / aruco", "/ small_robot / aruco" posisi robot yang ditemukan akan dipublikasikan. <br><br>  Hore!  Kami bisa mendapatkan koordinat robot.  Itu hanya, seperti yang Anda lihat, mereka salah.  Ini karena sebelum digunakan perlu untuk mengkalibrasi posisi kamera relatif terhadap bidang.  Untuk ini perlu <br><br><ul><li>  mengatur kubus di sudut-sudut lapangan, sementara penting bahwa mereka diputar oleh sisi yang ditentukan dalam konfigurasi </li><li>  sesuaikan kemiringan kamera sehingga semua ruang yang dibutuhkan jatuh ke dalam bingkai </li><li>  sesuaikan kecerahan cahaya latar hingga deteksi penanda yang andal </li><li>  di gui, pilih sisi yang diinginkan dan klik "kalibrasi" </li><li>  maka status dari "search static cubes" harus berubah menjadi "search cubes" </li></ul><br><h2>  Kami membuat spidol dan TsUS </h2><br>  Menurut aturan, kita dapat mewarnai robot kita seperti yang kita inginkan, dan, di samping itu, menggunakan tempat khusus pada robot kita dan orang lain, di mana Anda dapat meletakkan sesuatu hingga ukuran 10x10x8cm.  Tempat khusus terletak di sampul robot, memiliki ketinggian tetap dan visibilitas yang lebih baik untuk pusat kontrol pusat, kecuali ketika robot berada di bawah kamera. <br><br><img src="https://habrastorage.org/webt/mm/_a/zu/mm_azulfvnfcqxm869zluovaq9e.png"><br>  <i>tinggi dan dimensi mercusuar pada robot</i> <br><br>  Karena itu, sebagai penanda utama untuk robot kami, kami menggunakan 10x10x108cm paralelepipeds yang dilem di 4 sisi aruco, serta penanda tambahan di sisi atas robot kami untuk pelokalan di area kompleks di bawah kamera. <br><br>  Karena kami tidak bisa menempelkan apapun pada tutup musuh, kami memutuskan untuk membuat spidol dalam bentuk piramida terpotong untuk memperluas jangkauan visibilitas.  Dan seperti yang Anda lihat - penanda telah menjadi jauh lebih baik. <br><br><img src="https://habrastorage.org/webt/9_/xo/re/9_xoreh7phv_pp5ci_u7utyw5cm.png"><br><br>  Kami mencetak dasar untuk kubus \ piramida pada printer 3d sehingga cukup kuat dan memiliki mount yang nyaman dan dapat diandalkan. <br><br><img src="https://habrastorage.org/webt/r9/-l/ek/r9-lekwcd5xkzs_lys0hkrkjw4m.png"><br><br>  Model untuk mencetak kubus, piramida, dan pasangan kawin terletak di <a href="https://yadi.sk/d/swUJUwxTnTVYFw">sini.</a> <br><br>  Kubus ini dilem dengan reflektor (kami menggunakan AVERY putih <br>  DENNISON V6700B lebar 50mm, meskipun lebih mahal, ini berfungsi berkali-kali lebih baik daripada Cina murah), dan spidol itu sendiri terpaku di atasnya.  Cara termudah untuk melakukan ini adalah dengan memotong spidol pada plotter, meskipun Anda dapat memotongnya dari kertas atau film selama beberapa jam menenangkan (satu set terdiri dari 16 spidol). <br><br>  <a href="https://yadi.sk/d/0E5ajh4pumiahA">Ini adalah</a> kit tahun terakhir kami. <br><br><img src="https://habrastorage.org/webt/2h/1b/9w/2h1b9wwkizem2k9ptbwmwc64spm.png"><br>  <i>berbagai "generasi" dari penanda kita</i> <br><br>  Mereka juga dapat digunakan sebagai penanda statis untuk kalibrasi.  Untuk melakukannya, letakkan di sudut jauh bidang dan klik - kalibrasi. <br><br><h3>  Merakit perangkat pelacakan pusat </h3><br><h4>  Apa yang dibutuhkan: </h4><br>  <b>Komputer Papan Tunggal.</b>  Gambar-gambar ini dibuat untuk lokasi Intel NUC, tetapi Anda mungkin berpikir untuk menempatkannya dalam casing, misalnya, odroid xu4 atau raspberry pi4. <br><br>  <b>oCam</b> .  Sebenarnya kamera, yang semuanya berjalan.  Kami mengubah lensa standar menjadi <a href="https://air-hobby.ru/katalog/product/2262-linza-runcam-rc25g-fpv-lens-25mm-fov140-wide-angle.html">2,5mm</a> untuk sudut pandang lebar <br>  <b>Tampilan (waveshare 7 inch HDMI LCD (B)) .Dengan</b> bantuannya, kalibrasi dan sejumlah operasi lainnya dilakukan. <br><br>  <b>LED strip.</b>  Digunakan untuk menerangi permukaan reflektif marker.  Lebih baik menggunakan yang paling terang yang tersedia. <br><br>  <b>Baterai LiPo 16.8v.</b>  Kami menggunakan 4s5200mAh.  Ini adalah baterai yang sama seperti pada robot, karena nyaman dan tahan lama. <br><br>  <b>Konverter dc-dc step-down.</b>  Untuk menyalakan strip LED.  Nuc dan router diberi daya langsung oleh baterai, karena semua kabel listrik sudah ada pada mereka. <br><br>  Bagian yang dicetak.  Ini, khususnya, pemasangan kamera, layar dan sudut untuk merakit kasing: <a href="https://yadi.sk/d/swUJUwxTnTVYFw">https://yadi.sk/d/swUJUwxTnTVYFw</a> <br><br>  <b>Detail perumahan.</b>  Dalam kasus kami, itu adalah lembaran karbon 2mm.  Tapi ini bukan pilihan terbaik, karena konduktif karbon, sulit untuk diproses dan tidak seringan, misalnya, plexiglass - mungkin pilihan paling sederhana.  Meski jauh lebih sulit.  Temukan tautan di atas. <br><br>  <b>Router (Zyxel ekstra tajam).</b>  Kami harus mengeluarkannya dari kasing agar pas dengan ukuran dan berat.  Tetapi dalam kasus umum, kami sangat tidak merekomendasikan ini. <br>  Banyak hal kecil.  Sekrup M3 * 8 ~ 40 pcs, rak untuk papan sirkuit cetak 3x10 ~ 12 pcs, kabel, obeng, wago, dll. <br><br><h4>  Majelis </h4><br>  Pertama, Anda perlu menyiapkan sudut cetak, menekan kacang ke dalamnya.  Mungkin akan ada sedikit pers yang cocok dan mereka harus sedikit dilem atau menggunakan <a href="http://www.dart.moscow/index.php%3Fproductcode%3D160923">kacang leburan</a> <br>  Selanjutnya, Anda perlu menginstal bagian ini di pangkalan.  Ini memberikan posisi yang jelas dari pusat kontrol pusat di tempatnya. <br><br><img src="https://habrastorage.org/webt/cv/0u/vr/cv0uvrzekp09qx2typzni7gzmm4.png"><br><br>  Sekarang kita pasang dudukan kamera, masukkan oCam di sana, rekatkan lampu latar dari strip LED sedekat mungkin ke lensa dan kencangkan modul ke dasar. <br><br><img src="https://habrastorage.org/webt/x8/c5/sz/x8c5szf7llbkchzglqbbrz22yas.png"><br><br><img src="https://habrastorage.org/webt/k1/oj/w5/k1ojw5cbuwtnireb0axfynlffrk.png"><br><br>  Setelah itu, Anda dapat memasang semua dinding samping, memperbaikinya ke sudut yang dijelaskan sebelumnya.  Lubang untuk mereka lebih baik dilawan terlebih dahulu. <br><br><img src="https://habrastorage.org/webt/ne/mo/v0/nemov0qtrzitlompmpymxhm9npw.png"><br><br>  Kami menempatkan komputer papan tunggal dan router.  Dalam kasus kami, ini adalah NUC dan Zyxel ekstra tajam. <br><br><img src="https://habrastorage.org/webt/7l/vc/85/7lvc85rwy0gzifdg9w7a9-n0k8a.png"><br><br><img src="https://habrastorage.org/webt/er/t9/8t/ert98t1wicsogrkpabregc60o2e.png"><br><br><img src="https://habrastorage.org/webt/7y/hk/rc/7yhkrcmukr6oyrgqqyeoiwwz_io.png"><br>  <i>Dan kami mendapatkan sistem pelacakan rakitan.</i>  <i>Tetap hanya untuk menyesuaikan kemiringan kamera.</i> <br><br><img src="https://habrastorage.org/webt/zm/lp/zr/zmlpzrgcfrd68o_xnoaw69sdgeg.png"><br>  <i>debugging lokalisasi pada tahun 2018</i> <br><br><h3>  Apa hasilnya </h3><br>  Jadi kami memberi tahu semua rahasia yang memungkinkan kami mengulangi sistem kami dengan tangan kami sendiri.  Dengan menggunakannya, Anda dapat dengan cepat dan tanpa perubahan membuat sistem Anda untuk melokalkan robot di bidang Eurobot.  Dan dengan sedikit perubahan, buatlah sistem pelacakan yang cukup universal dan andal untuk sesuatu.  Namun, perlu dipertimbangkan bahwa ketika menggunakan aruco 8x8, ukuran marker 10x8cm dan kamera dalam 1Mpx, tidak mungkin untuk meningkatkan radius deteksi, namun, jika kita memiliki batasan ketat pada ukuran dan kinerja, maka secara umum kita hanya menggunakan peralatan yang lebih menarik. <br><br>  Tahun ini, aturan menyebutkan penggunaan aruco 4x4, serta rentang non-berpotongan untuk setiap sisi lapangan.  Dalam waktu dekat, kami berencana untuk mengintegrasikan ini ke dalam solusi kami sehingga di masa depan kami tidak takut untuk persimpangan angka penanda.  Lain yang harus dimiliki, tetapi yang belum dilakukan adalah kalibrasi manual di lapangan. <br>  Pada artikel selanjutnya, kita akan berbicara tentang tingkat robot yang lebih rendah, bagaimana kinematika robot dipertimbangkan, bagaimana kita mengendalikan server, mesin, dan kerucut ketika bekerja dengan freertos. <br><br>  Saya ingin mengucapkan terima kasih: <br><br>  <a href="https://github.com/alexpostnikov/aruco-gui">Alexey Postnikov</a> (atas nama siapa itu mungkin layak menerbitkan semuanya) - untuk, secara umum, semua kode dalam artikel ini dan bantuan langsung dalam menulis artikel. <br>  <a href="https://habr.com/ru/users/eppy/">Egor Alexandrov</a> - untuk semua gambar dan model, bantuan dalam menulis artikel dan 34 koma. <br>  <a href="https://habr.com/ru/users/toma_sin/">Tamara Sinelnikova</a> - untuk bantuan dalam menulis artikel. <br><br>  Dan anggota tim lainnya! <br><br>  Kurang dari 4 bulan tersisa sebelum dimulainya kompetisi, tetapi Tim Eurobot Sberbank masih terbuka untuk peserta baru.  Telegram kami: <a href="https://t.me/SetUpSber">https://t.me/SetUpSber</a> <br><br>  Artikel sebelumnya: <br><br>  <a href="https://habr.com/ru/post/478836/">Apa yang umum antara revolver, mesin cuci dan robot otonom</a> <br>  <a href="https://habr.com/ru/post/479636/">Tumpukan navigasi sendiri.</a>  <a href="https://habr.com/ru/post/479636/">Lebih baik daripada ROS?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id482220/">https://habr.com/ru/post/id482220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id482206/index.html">Cara membuat produksi suku cadang 3D untuk pesawat lebih ekonomis</a></li>
<li><a href="../id482208/index.html">Hadiah yang membuat Anda melewatkan Tahun Baru</a></li>
<li><a href="../id482212/index.html">Bicara tentang ... keju?</a></li>
<li><a href="../id482216/index.html">23 respons terhadap depresi dari psikiater profesional Maxim Malyavin (dpmmax)</a></li>
<li><a href="../id482218/index.html">Java Digest untuk tanggal 27 Desember</a></li>
<li><a href="../id482222/index.html">Aplikasi web di Kotlin + Spring Boot + Vue.js (add-on)</a></li>
<li><a href="../id482224/index.html">Ketika seorang desainer perlu menjadi programmer kecil</a></li>
<li><a href="../id482228/index.html">Kami menulis "kalkulator" dalam C #. Bagian I. Perhitungan nilai, turunan, penyederhanaan, dan angsa lainnya</a></li>
<li><a href="../id482230/index.html">Pertempuran server WEB. Bagian 2 - skenario HTTPS yang realistis:</a></li>
<li><a href="../id482232/index.html">StackOverflow lebih dari sekadar repositori jawaban untuk pertanyaan bodoh</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>