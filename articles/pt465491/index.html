<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôèÔ∏è üë©üèª‚Äç‚úàÔ∏è üö≠ Zabbix + Voximplant: monitoramento com chamadas ou como parar de se preocupar e configur√°-lo rapidamente üõåüèº üêÉ ‚ô£Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Zabbix - inteligente, flex√≠vel e personaliz√°vel - pode fazer tudo. Ou quase tudo. Seria estranho se ele n√£o pudesse fazer amizade com a telefonia na...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix + Voximplant: monitoramento com chamadas ou como parar de se preocupar e configur√°-lo rapidamente</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/Voximplant/blog/465491/">  O Zabbix - inteligente, flex√≠vel e personaliz√°vel - pode fazer tudo.  Ou quase tudo.  Seria estranho se ele n√£o pudesse fazer amizade com a telefonia na nuvem, especialmente quando esta tiver uma API HTTP conveniente - use sua sa√∫de.  Hoje vamos demonstrar como configurar o Zabbix para chamadas de notifica√ß√£o via Voximplant, o que pode ser muito √∫til em casos de emerg√™ncia ("n√£o h√° tempo para explicar, voc√™ precisa ligar - o servidor de batalha simplesmente caiu"). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tu/k5/_o/tuk5_odcpfkuzsgmqs5wgugzdw0.png"></div>  <font color="grey">Baseado no quadro do filme "The Matrix" (The Matrix (1999), Warner Bros.)</font> <br><blockquote> Nota: o tutorial assume que voc√™ j√° possui um Zabbix funcional e configurou o front-end do Zabbix.  A instala√ß√£o inicial do Zabbix n√£o √© o objetivo deste artigo. Curiosos / com necessidade de um guia desse tipo, consulte a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o oficial</a> e / ou o google. </blockquote><br><a name="habracut"></a><h2>  Com o que trabalharemos </h2><br>  Nosso exemplo usa o VDS com o CentOS 7, no qual o Zabbix 4.2.6 est√° instalado (a √∫ltima vers√£o est√°vel no momento da reda√ß√£o).  Vamos monitorar o mesmo servidor em que o Zabbix trabalha.  O Voximplant precisa de uma conta na plataforma e um script de processamento de chamadas para JS.  E agora um pouco mais. <br><br><h2>  O que faremos </h2><br>  Nenhuma ci√™ncia do foguete, vamos fazer um monitoramento muito simples que responda √† apar√™ncia do <b>arquivo / tmp / habrTriggerFile</b> : quando esse arquivo aparecer, o Zabbix entrar√° em contato com o Voximplant por meio da API HTTP, um script funcionar√° que chamar√° o n√∫mero de telefone especificado, diga "Aten√ß√£o.  Um arquivo foi criado no servidor. ‚Äù  e desligue.  Se voc√™ excluir / renomear o arquivo e depois devolv√™-lo, haver√° uma chamada novamente.  Se voc√™ n√£o fizer nada, haver√° apenas uma chamada. <br><br><h2>  Voximplant </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fa√ßa login na sua conta</a> (ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">registre-se</a> ) e crie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o aplicativo</a> <b>habr</b> .  Dentro do aplicativo, v√° para a guia Cen√°rios e crie um script de <b>notifica√ß√£o</b> com este c√≥digo: <br><br><pre><code class="javascript hljs">VoxEngine.addEventListener(AppEvents.Started, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> call = VoxEngine.callPSTN(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"   "</span></span>) call.addEventListener(CallEvents.PlaybackFinished, () =&gt; { VoxEngine.terminate() }) call.addEventListener(CallEvents.Connected, () =&gt; { setTimeout( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> call.say(<span class="hljs-string"><span class="hljs-string">".     ."</span></span>, Language.RU_RUSSIAN_FEMALE), <span class="hljs-number"><span class="hljs-number">1000</span></span> ) }) })</code> </pre> <br>  Voc√™ pode executar este script com uma solicita√ß√£o HTTP (e sem comprar um n√∫mero de telefone).  N√£o se esque√ßa de substituir os n√∫meros de <b>telefone</b> no <b>callPSTN</b> : o primeiro √© para quem a plataforma ligar√°, o segundo √© o callerid, que ser√° exibido no assinante chamado;  pode ser o seu n√∫mero pessoal que foi verificado na plataforma ou um n√∫mero adquirido anteriormente na Voximplant (observe que os n√∫meros virtuais n√£o podem ser usados).  O script chama o n√∫mero, ap√≥s a conex√£o relata que um arquivo foi criado e desliga. <br><br>  Salve o script e v√° para a guia Roteamento para criar uma regra: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/oq/_t/pm/oq_tpm3ax6p79y5pwfzii3utpae.jpeg" width="650"></div><br>  Salve a regra e - observe - copie seu ID. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vu/kz/yc/vukzyclxf6vzalebrz1dbsvni2e.jpeg"></div><br>  Em seguida, voc√™ precisar√° de chaves de API, leve-as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">na se√ß√£o apropriada do</a> menu principal. <br>  Conhecendo as chaves da API e o ID da regra, voc√™ pode substitu√≠-las no m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://voximplant.com/docs/references/">StartScenarios</a> da nossa API HTTP, ser√° algo parecido com isto: <br><br><pre> <code class="bash hljs">https://api.voximplant.com/platform_api/StartScenarios/?account_id=1&amp;api_key=4ed5695e-4690-448r-95e8-3f8f0001287c&amp;rule_id=28</code> </pre> <br>  Um pouco mais tarde, usamos essa solicita√ß√£o ao configurar o monitoramento, que j√° pode ser iniciado. <br><br><h2>  Zabbix </h2><br>  Digite seu front end do Zabbix como seu usu√°rio (ou administrador) e, na se√ß√£o Configura√ß√£o - Hosts, clique em Criar host.  No nome, escreva <b>localhost</b> , em grupos especifique <b>o grupo de teste</b> e clique em Adicionar abaixo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/as/ep/9o/asep9oqe5p0fjsmfrspqp7mytwk.jpeg"></div><br>  Agora, na lista de hosts, voc√™ ver√° o servidor Zabbix padr√£o e o host local.  A partir daqui, continuaremos a configurar. <br><br>  O monitoramento do Zabbix √© baseado em uma cadeia de 3 entidades: Item - Trigger - Action.  Todos os tr√™s links s√£o obrigat√≥rios, portanto, voc√™ precisa criar cada um deles em sequ√™ncia. <br><br><h3>  Item </h3><br>  Item √© um acumulador de dados e, sem dados, o monitoramento n√£o reagir√° a nada.  Para criar um item, na lista de hosts, clique em Itens √† direita do nome do host local.  Voc√™ tamb√©m pode clicar no nome do host e, na tela exibida, v√° para a guia Itens - a ess√™ncia √© a mesma.  Uma vez na guia Itens, clique em Criar item no canto superior direito.  Digite o nome - <b>item habr</b> e clique em Adicionar ao lado do campo Chave - role para baixo, precisamos da chave padr√£o <b>vfs.file.exists</b> , selecione-a e ela ser√° substitu√≠da no campo Chave.  Substitua arquivo pelo caminho atual; no nosso caso, a chave ser√° assim: <b>vfs.file.exists [/ tmp / habrTriggerFile]</b> .  No campo Intervalo de atualiza√ß√£o, defina 5s para que o monitoramento responda mais rapidamente quando criamos o arquivo no host.  Na parte inferior da p√°gina, clique em Adicionar e veja imediatamente o novo item. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4e/fy/n0/4efyn0yodwpvunisxnx7siatcg4.jpeg"></div><br><br><h3>  Gatilho </h3><br>  Os gatilhos avaliam os dados coletados e, quando atingem o limite especificado, eles reagem - eles iniciam a a√ß√£o.  Na tela com o item criado, v√° para a guia Triggers: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ko/ay/xx/koayxxidq2cdwo_ht1n5kkfoygk.jpeg"></div><br>  Clique em Criar gatilho, nomeie-o como <b>habr trigger</b> .  O valor para o campo Express√£o √© convenientemente coletado usando o construtor - o bot√£o Adicionar.  Defina as configura√ß√µes como na captura de tela e clique em Inserir: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zj/th/lo/zjthlop_e4pffeowtleynperswy.jpeg"></div><br>  Clique em Adicionar na parte inferior da p√°gina - pronto, o gatilho √© criado. <br><br><h3>  Ac√ß√£o </h3><br>  A√ß√£o √© uma a√ß√£o que dispara um gatilho acionado.  Abra a guia Configura√ß√£o - A√ß√µes, clique em Criar a√ß√£o.  O nome √© subitamente - <b>habr action</b> .  Abaixo, no bloco Nova condi√ß√£o, deixe tudo como padr√£o e adicione <b>habr</b> . Como resultado, o <b>nome</b> do <b>acionador cont√©m a</b> condi√ß√£o de <b>habr</b> .  Clique em Adicionar para adicionar uma condi√ß√£o - ela aparecer√° imediatamente no bloco Condi√ß√µes, veja a captura de tela: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/js/45/fn/js45fnk8aj1ymauczt99xtixx9a.jpeg"></div><br>  Aqui, v√° para a guia Opera√ß√µes e, no bloco Opera√ß√µes, clique em Novo para adicionar uma a√ß√£o.  No tipo Opera√ß√£o, selecione Comando remoto, o bloco da lista Destino e o campo de entrada Comandos ser√£o exibidos.  No bloco da lista Destino, clique em Novo, voc√™ receber√° o destino padr√£o - host atual, √© necess√°rio - clique em Adicionar e o destino aparecer√° na lista.  No campo de entrada, insira curl + uma solicita√ß√£o gerada anteriormente ao Voximplant: <br><br><pre> <code class="bash hljs">curl <span class="hljs-string"><span class="hljs-string">"https://api.voximplant.com/platform_api/StartScenarios/?account_id=1&amp;api_key=4ed5695e-4690-448r-95e8-3f8f0001287c&amp;rule_id=28"</span></span></code> </pre> <br>  Em seguida, adicione esta a√ß√£o (Adicionar como um link) e somente clique no bot√£o Adicionar para concluir a cria√ß√£o da a√ß√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ne/sr/nf/nesrnfgyv2rikp40vnthmm0kmmk.jpeg"></div><br>  Um ponto importante: escolhemos o tipo de a√ß√£o do comando Remoto, que √© desativada por padr√£o na configura√ß√£o do agente Zabbix.  Para corrigir isso, no host, abra a configura√ß√£o e coloque o valor 1 para EnableRemoteCommands: <br><br><pre> <code class="bash hljs">vi /etc/zabbix/zabbix_agentd.conf // EnableRemoteCommands = 1</code> </pre><br>  Depois disso, reinicie o servi√ßo do agente: <br><br><pre> <code class="bash hljs">service zabbix-agent restart</code> </pre> <br><br><h2>  Iniciamos a cadeia de a√ß√µes </h2><br>  No painel Zabbix, v√° para a se√ß√£o Monitoramento - Problemas.  Em breve, veremos um aviso aqui de que o gatilho funcionou. <br><br>  No host, crie um arquivo: <br><br><pre> <code class="bash hljs">touch /tmp/habrTriggerFile</code> </pre> <br>  Ap√≥s 5 segundos no painel Problemas, veremos uma nova mensagem;  PROBLEMA piscar√° na coluna Status e, se voc√™ clicar no √≠cone na coluna A√ß√µes, ver√° os detalhes da a√ß√£o (a captura de tela √© clic√°vel): <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/vl/kw/az/vlkwazib1r2snoujsrm3g617s1c.jpeg"></a> </div> <a href=""><br></a> <br>  Ao longo do caminho, ser√° feita uma chamada para o n√∫mero de telefone que especificamos no script Voximplant. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qk/jm/vu/qkjmvu7ki9qixm1fix1wq5lgsn4.png"></div>  <font color="grey">Baseado no quadro do filme "The Matrix" (The Matrix (1999), Warner Bros.)</font> <br><br>  Se voc√™ renomear o arquivo, <br><br><pre> <code class="bash hljs">mv /tmp/habrTriggerFile /tmp/habrTriggerFile_</code> </pre> <br>  depois de 5 segundos, o status do problema ser√° RESOLVIDO. <br><br>  Feito!  Voc√™ √© √≥timo porque configura a cadeia de intera√ß√£o host - Zabbix - Voximplant e, pelo mesmo princ√≠pio, pode configurar l√≥gica arbitrariamente complexa para chamadas de notifica√ß√£o. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt465491/">https://habr.com/ru/post/pt465491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt465479/index.html">Lo-fi de pixel no Unity</a></li>
<li><a href="../pt465483/index.html">Antiguidades: Windows 3.1 e vida sem um bot√£o Iniciar</a></li>
<li><a href="../pt465485/index.html">Imprimir tape√ßaria Game of Thrones em uma impressora fiscal usando Python</a></li>
<li><a href="../pt465487/index.html">Crie uma plataforma kubernetes no Pinterest</a></li>
<li><a href="../pt465489/index.html">Lista de verifica√ß√£o de prontid√£o para produ√ß√£o</a></li>
<li><a href="../pt465493/index.html">Linguagem de programa√ß√£o r√°pida no Raspberry Pi</a></li>
<li><a href="../pt465495/index.html">Como n√£o perder tr√°fego ao mudar para um novo dom√≠nio: caso "Vse10"</a></li>
<li><a href="../pt465497/index.html">Mensagens secretas atrav√©s dos logs do servidor</a></li>
<li><a href="../pt465499/index.html">Uma nova lei para descrever a velocidade do desenvolvimento de computadores qu√¢nticos?</a></li>
<li><a href="../pt465501/index.html">Li√ß√µes aprendidas 40 anos ap√≥s a decolagem e o r√°pido decl√≠nio da primeira "aplica√ß√£o matadora"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>