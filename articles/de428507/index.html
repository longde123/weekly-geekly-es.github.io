<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🎓 👨🏼‍🍳 🍮 Wir schreiben einen Bot-Chat für VKontakte auf Python mit Longpoll 🎟️ 👱🏿 🧒🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jetzt sind Bots alltäglich geworden und befinden sich in jedem Schritt. Wenn Sie Ihren Bot jedoch im sozialen Netzwerk von VKontakte benötigen, ist di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir schreiben einen Bot-Chat für VKontakte auf Python mit Longpoll</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428507/">  Jetzt sind Bots alltäglich geworden und befinden sich in jedem Schritt. Wenn Sie Ihren Bot jedoch im sozialen Netzwerk von VKontakte benötigen, ist dies einfach zu implementieren. <br><br>  Wir werden brauchen: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Python</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VK Api</a> </li><li>  Wunsch </li></ol><a name="habracut"></a><br><h3>  Genau das Richtige für Anfänger </h3><br><div class="spoiler">  <b class="spoiler_title">Wie installiere ich Python?</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Laden Sie</a> das Installationsprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">herunter</a> und führen Sie es aus. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Wo soll ich diesen Code schreiben?</b> <div class="spoiler_text">  Zu einem Textdokument mit der Erweiterung .py <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Und was soll ich schreiben?</b> <div class="spoiler_text">  Ja, auch mit einem Notebook.  Persönlich empfehle ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Notepad ++</a> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Und wie läuft man?</b> <div class="spoiler_text"> Über die Kommandozeile. <br> <code>python     \.py</code> <br> </div></div><br><h3>  Wie funktioniert es </h3><br>  Alles ist sehr einfach, in vk api gibt es so etwas wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">longpool, es</a> funktioniert so: <blockquote>  Long Polling ist eine Technologie, mit der Sie mithilfe von "langen Abfragen" Daten zu neuen Ereignissen empfangen können.  Der Server empfängt die Anforderung, sendet jedoch keine sofortige Antwort darauf, sondern nur, wenn ein Ereignis eintritt (z. B. wenn eine neue Nachricht eintrifft) oder das angegebene Zeitlimit abläuft. </blockquote>  Auf Russisch senden wir eine Anfrage an den Server, und er stößt wiederum VKontakte an, wenn dort etwas passiert. Beispielsweise erhalten wir eine Nachricht, er rennt und erzählt uns davon.  Daraus werden wir tanzen. <br><br><h4>  Technische Umsetzung </h4><br>  Erstens müssen wir im Kontakt beweisen, dass wir wir sind und nicht jemand anderes.  Dies geschieht sehr einfach. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests session = requests.Session() login, password = <span class="hljs-string"><span class="hljs-string">' , email  '</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span> vk_session = vk_api.VkApi(login, password) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: vk_session.auth(token_only=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> vk_api.AuthError <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> error_msg: print(error_msg) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span></code> </pre> <br>  Beachten Sie, dass die Jungs von VK empfehlen, eine Telefonnummer als Login zu verwenden.  Andernfalls können Sie auf eine Anti-Bot-Prüfung stoßen, bei der Sie aufgefordert werden, die fehlenden Nummern aus der Telefonnummer einzugeben. <br><br>  Wenn der Bot in einer Gruppe sitzt, sieht die Autorisierung anders aus. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api vk_session = vk_api.VkApi(token=<span class="hljs-string"><span class="hljs-string">'      '</span></span>)</code> </pre> <br><br>  - Was ist ein Token? <br>  - So etwas von Tsiferok und Buchstaben, die Sie in den Gruppeneinstellungen benötigen.  Öffnen Sie dazu einfach den Abschnitt "Community-Verwaltung" ("Seite verwalten", wenn Sie eine öffentliche Seite haben), wählen Sie die Registerkarte "Mit API arbeiten" und klicken Sie auf "Zugriffsschlüssel erstellen". <br><br>  Rufen Sie jetzt Longpool an. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vk_api.longpoll <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VkLongPoll, VkEventType longpoll = VkLongPoll(vk_session) vk = vk_session.get_api() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> longpoll.listen(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> event.type == VkEventType.MESSAGE_NEW <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> event.to_me <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> event.text: <span class="hljs-comment"><span class="hljs-comment"># longpoll,    : if event.text == '  ' or event.text == '  ': #    if event.from_user: #    vk.messages.send( #  user_id=event.user_id, message=' ' ) elif event.from_chat: #    vk.messages.send( #  chat_id=event.chat_id, message=' ' )</span></span></code> </pre><br>  Nachrichten enthalten möglicherweise nicht nur den von Ihnen angegebenen Text.  Zum Beispiel: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime vk.messages.send( user_id=event.user_id, message=<span class="hljs-string"><span class="hljs-string">' : '</span></span> + str(now.strftime(<span class="hljs-string"><span class="hljs-string">"%H:%M"</span></span>)) )</code> </pre> <br>  Sie können auch Bilder anhängen. <br><br><pre> <code class="python hljs">attachments = [] <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VkUpload upload = VkUpload(vk_session) image_url = <span class="hljs-string"><span class="hljs-string">'  '</span></span> image = session.get(image_url, stream=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) photo = upload.photo_messages(photos=image.raw)[<span class="hljs-number"><span class="hljs-number">0</span></span>] attachments.append( <span class="hljs-string"><span class="hljs-string">'photo{}_{}'</span></span>.format(photo[<span class="hljs-string"><span class="hljs-string">'owner_id'</span></span>], photo[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]) ) vk.messages.send( user_id=event.user_id, attachment=<span class="hljs-string"><span class="hljs-string">','</span></span>.join(attachments), message=<span class="hljs-string"><span class="hljs-string">' '</span></span> )</code> </pre> <br>  Sie können sich viele interessante Dinge einfallen lassen, aber denken Sie selbst darüber nach, und ich sage nur Folgendes: Links können in Teile unterteilt werden.  Zum Beispiel: <br><br><pre> <code class="python hljs">image_url = <span class="hljs-string"><span class="hljs-string">'http://.com/uploads/'</span></span> + event.text + <span class="hljs-string"><span class="hljs-string">'.png'</span></span></code> </pre> <br>  und niemand hat uns verboten, eine Antwort von einem Benutzer am Beispiel von Wikipedia zu erhalten: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> wikipedia <span class="hljs-comment"><span class="hljs-comment">#  wikipedia.set_lang("RU") if event.text == '' or event.text == '' or event.text == '' or event.text == '' or event.text == 'Wikipedia' or event.text == 'wikipedia' or event.text == 'Wiki' or event.text == 'wiki': #          ...  wiki if event.from_user: #   KC vk.messages.send( user_id=event.user_id, message=' ' # " " ) elif event.from_chat: #    vk.messages.send( chat_id=event.chat_id, message=' ' # " " ) for event in longpoll.listen(): if event.type == VkEventType.MESSAGE_NEW and event.to_me and event.text: # longpoll if event.from_user: vk.messages.send( #    user_id=event.user_id, message='   : \n' + str(wikipedia.summary(event.text)) # "   "      api Wikipedia     ) break #   elif event.from_chat: #    vk.messages.send( chat_id=event.chat_id, message='   : \n' + str(wikipedia.summary(event.text)) # "   "      api Wikipedia     ) break #   continue</span></span></code> </pre> <br><h3>  Links zu Beispielen und Dokumentation </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beispiel Bot arbeitet an DuckDuckGo API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VK API Anwendungsfälle (allgemein)</a> <br>  VK API-Dokumentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eins</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zwei</a> <br><br>  Darauf werde ich mich von dir verabschieden.  Gute Codierung. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de428507/">https://habr.com/ru/post/de428507/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de428497/index.html">Noolite SUF-1-300 Custom Wireless Dimmer</a></li>
<li><a href="../de428499/index.html">Gruselige blaue Riesen können die Geheimnisse der Sternentwicklung enthüllen</a></li>
<li><a href="../de428501/index.html">DartUP: Die erste russischsprachige Konferenz über Dart und Flutter am 1. Dezember in St. Petersburg</a></li>
<li><a href="../de428503/index.html">Übersicht über die Referenzvektor-Methode (SVM) des Algorithmus für maschinelles Lernen</a></li>
<li><a href="../de428505/index.html">Erhalten von Links zu Audio ohne VKApi</a></li>
<li><a href="../de428509/index.html">Wie H & M versucht, sich mit KI und Big Data zu retten</a></li>
<li><a href="../de428511/index.html">Wasserstoffenergie: Der Beginn eines langen Weges</a></li>
<li><a href="../de428513/index.html">500 Laserpointer an einem Ort</a></li>
<li><a href="../de428515/index.html">Top 3D Shop: Wie wir uns im Laufe des Jahres verändert haben - Ergebnisse für 2018</a></li>
<li><a href="../de428517/index.html">GraphQL - API auf neue Weise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>