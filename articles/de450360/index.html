<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂ üëáüèº üöñ Exchange SPA-Anwendungsarchitektur im Jahr 2019 üë©‚Äçüëß‚Äçüë¶ ü§µ üåó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gr√º√üe, Chabrowiten! 


 Ich habe diese Ressource seit ihrer Gr√ºndung gelesen, aber die Zeit f√ºr das Schreiben eines Artikels ist erst jetzt gekommen, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Exchange SPA-Anwendungsarchitektur im Jahr 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450360/"><p>  Gr√º√üe, Chabrowiten! </p><br><p>  Ich habe diese Ressource seit ihrer Gr√ºndung gelesen, aber die Zeit f√ºr das Schreiben eines Artikels ist erst jetzt gekommen, was bedeutet, dass es Zeit ist, unsere Erfahrungen mit der Community zu teilen.  F√ºr Anf√§nger hoffe ich, dass dieser Artikel dazu beitr√§gt, die Qualit√§t des Designs zu verbessern, und f√ºr erfahrene Entwickler als Checkliste dient, um wichtige Elemente in der Architekturphase nicht zu vergessen.  F√ºr die Ungeduldigen das endg√ºltige <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> und die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Demo</a> . </p><br><a name="habracut"></a><br><p>  Angenommen, Sie befinden sich in einem ‚ÄûTraumunternehmen‚Äú - einem der B√∂rsen mit einer freien Auswahl an Technologie und Ressourcen, um alles ‚Äûso zu machen, wie es sollte‚Äú.  Im Moment ist alles, was das Unternehmen hat, </p><br><h3>  Gesch√§ftsauftrag </h3><br><p>  Entwickeln Sie eine SPA-Anwendung f√ºr die Handelsschnittstelle, in der Sie: </p><br><ul><li>  eine Liste der nach W√§hrung gruppierten Handelspaare anzeigen; </li><li>  Wenn Sie auf ein Handelspaar klicken, um Informationen zum aktuellen Preis anzuzeigen, eine √Ñnderung innerhalb von 24 Stunden, ein "Glas Bestellungen". </li><li>  Bewerbungssprache in Englisch / Russisch √§ndern; </li><li>  √Ñndern Sie das Thema in dunkel / hell. </li></ul><br><p>  Die Aufgabe ist recht kurz, sodass Sie sich auf die Architektur konzentrieren k√∂nnen, anstatt gro√üe Mengen an Gesch√§ftsfunktionen zu schreiben.  Das Ergebnis der ersten Bem√ºhungen sollte ein logischer und durchdachter Code sein, mit dem Sie direkt mit der Implementierung der Gesch√§ftslogik fortfahren k√∂nnen. </p><br><p>  Da die Leistungsbeschreibung des Kunden keine technischen Anforderungen enth√§lt, sollten diese f√ºr die Entwicklung angenehm sein: </p><br><ul><li>  <b>Cross-Browser-Kompatibilit√§t</b> : 2 neueste Versionen g√§ngiger Browser (ohne IE); </li><li>  <b>Bildschirmbreite</b> :&gt; = 1240px; </li><li>  <b>Design</b> : in Analogie zu anderen B√∂rsen, as  Der Designer wurde noch nicht eingestellt. </li></ul><br><p>  Jetzt ist es an der Zeit, die verwendeten Tools und Bibliotheken zu identifizieren.  Ich werde mich von den Prinzipien der "schl√ºsselfertigen" Entwicklung und von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">KISS</a> leiten lassen, dh ich werde nur die OpenSource-Bibliotheken verwenden, deren unabh√§ngige Implementierung nicht gen√ºgend Zeit erfordert, einschlie√ülich der Zeit, um zuk√ºnftige Entwicklerkollegen zu schulen. </p><br><ul><li>  <b>Versionskontrollsystem</b> : Git + Github; </li><li>  <b>Backend</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">API</a> CoinGecko; </li><li>  <b>Montage / Transport</b> : Webpack + Babel; </li><li>  <b>Paketinstallationsprogramm</b> : Yarn (npm 6 hat die Abh√§ngigkeiten falsch aktualisiert); </li><li>  <b>Code-Qualit√§tskontrolle</b> : ESLint + Prettier + Stylelint; </li><li>  <b>Ansicht</b> : Reagieren (mal sehen, wie bequem Hooks sind); </li><li>  <b>Gesch√§ft</b> : MobX; </li><li>  <b>Autotests</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cypress.io</a> (eine vollst√§ndige Javascript-L√∂sung anstelle einer modularen Baugruppe wie Mokka / Karma + Chai + Sinon + Selen + Webdriver / Winkelmesser); </li><li>  <b>Stile</b> : SCSS √ºber PostCSS (Konfigurationsflexibilit√§t, Freunde mit Stylelint); </li><li>  <b>Diagramme</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HighStock</a> (Setup ist viel einfacher als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TradingView</a> , aber f√ºr eine echte Anwendung w√ºrde ich letzteres nehmen); </li><li>  <b>Fehlerberichterstattung</b> : Sentry; </li><li>  <b>Dienstprogramme</b> : Lodash (zeitsparend); </li><li>  <b>Routing</b> : schl√ºsselfertig; </li><li>  <b>Lokalisierung</b> : schl√ºsselfertig; </li><li>  <b>Arbeit mit Anfragen</b> : schl√ºsselfertig; </li><li>  <b>Leistungsmetriken</b> : schl√ºsselfertig; </li><li>  <b>Typisierung</b> : nicht in meiner Schicht. </li></ul><br><p>  Aus den Bibliotheken in der endg√ºltigen Anwendungsdatei werden daher nur React, MobX, HighStock, Lodash und Sentry angezeigt.  Ich halte dies f√ºr gerechtfertigt, da sie √ºber eine hervorragende Dokumentation und Leistung verf√ºgen und vielen Entwicklern bekannt sind. </p><br><h3>  Code-Qualit√§tskontrolle </h3><br><p>  Ich ziehe es vor, die Abh√§ngigkeiten in <i>package.json</i> in semantische Teile zu <i>zerlegen.</i> Der erste Schritt nach dem Initiieren des Git-Repositorys besteht darin, alles, was den <i>Codestil</i> betrifft, im Ordner <i>./eslint-custom zu</i> <i>gruppieren</i> und in <i>package.json</i> anzugeben: </p><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"upd"</span></span>: <span class="hljs-string"><span class="hljs-string">"yarn install --no-lockfile"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"eslint-custom"</span></span>: <span class="hljs-string"><span class="hljs-string">"file:./eslint-custom"</span></span> } }</code> </pre> <br><p>  Bei der normalen <i>Garninstallation</i> wird nicht √ºberpr√ºft, ob sich die Abh√§ngigkeiten in <i>eslint-custom</i> ge√§ndert haben. <i>Daher verwende</i> ich die <code>yarn upd</code> .  Im Allgemeinen sieht diese Vorgehensweise universeller aus, da Entwickler das Bereitstellungsrezept nicht √§ndern m√ºssen, wenn Entwickler die Methode zur Installation von Paketen √§ndern m√ºssen. </p><br><p>  Es macht keinen Sinn, die <i>Datei</i> yarn.lock zu <i>verwenden</i> , da alle Abh√§ngigkeiten ohne semver "cover" sind (in Form von <code>"react": "16.8.6"</code> ).  Die Erfahrung hat gezeigt, dass es besser ist, Versionen manuell zu aktualisieren und im Rahmen einzelner Aufgaben sorgf√§ltig zu testen, als sich auf eine Sperrdatei zu verlassen, damit Paketautoren die M√∂glichkeit haben, die Anwendung jederzeit mit einem geringf√ºgigen Update zu unterbrechen (gl√ºckliche, denen dies nicht begegnet ist). </p><br><p>  Im <i>eslint-custom-</i> Paket <i>lauten</i> die Abh√§ngigkeiten wie folgt: </p><br><div class="spoiler">  <b class="spoiler_title">eslint-custom / package.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"eslint-custom"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Custom linter rules for this project"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"MIT"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"babel-eslint"</span></span>: <span class="hljs-string"><span class="hljs-string">"10.0.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eslint"</span></span>: <span class="hljs-string"><span class="hljs-string">"5.16.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eslint-config-prettier"</span></span>: <span class="hljs-string"><span class="hljs-string">"4.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eslint-plugin-import"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.17.2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eslint-plugin-prettier"</span></span>: <span class="hljs-string"><span class="hljs-string">"3.0.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eslint-plugin-react"</span></span>: <span class="hljs-string"><span class="hljs-string">"7.12.4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"eslint-plugin-react-hooks"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.6.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"prettier"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.17.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"prettier-eslint"</span></span>: <span class="hljs-string"><span class="hljs-string">"8.8.2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"stylelint"</span></span>: <span class="hljs-string"><span class="hljs-string">"10.0.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"stylelint-config-prettier"</span></span>: <span class="hljs-string"><span class="hljs-string">"5.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"stylelint-prettier"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.6"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"stylelint-scss"</span></span>: <span class="hljs-string"><span class="hljs-string">"3.6.0"</span></span> } }</code> </pre></div></div><br><p>  Um die drei Tools zu verbinden, waren 5 Hilfspakete <i>erforderlich</i> ( <i>eslint-plugin-prettier, eslint-config-prettier, stylelint-prettier, stylelint-config-prettier, prettier-eslint</i> ) - Sie m√ºssen heute einen solchen Preis zahlen.  F√ºr maximalen Komfort reicht nicht nur das automatische <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sortieren von Importen</a> aus, aber leider verliert dieses Plugin beim Neuformatieren einer Datei Zeilen. </p><br><p>  Die Konfigurationsdateien f√ºr alle Tools haben das Format <i>* .js</i> ( <i>eslint.config.js</i> , <i>stylelint.config.js</i> ), sodass die Code-Formatierung auf ihnen funktioniert.  Regeln k√∂nnen im <i>* .yaml-</i> Format <i>vorliegen</i> und nach semantischen Modulen unterteilt sein.  Vollversionen von Konfigurationen und Regeln befinden sich im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> . </p><br><p>  Es bleibt, die Befehle im <i>Hauptpaket hinzuzuf√ºgen.json</i> ... </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"upd"</span></span>: <span class="hljs-string"><span class="hljs-string">"yarn install --no-lockfile"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format:js"</span></span>: <span class="hljs-string"><span class="hljs-string">"eslint --ignore-path .gitignore --ext .js -c ./eslint-custom/eslint.config.js --fix"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"format:style"</span></span>: <span class="hljs-string"><span class="hljs-string">"stylelint --ignore-path .gitignore --config ./eslint-custom/stylelint.config.js --fix"</span></span> } }</code> </pre><br><p>  ... und konfigurieren Sie Ihre IDE so, dass beim Speichern der aktuellen Datei die Formatierung angewendet wird.  Um dies zu gew√§hrleisten, m√ºssen Sie beim Erstellen eines Commits einen Git-Hook verwenden, der alle Projektdateien √ºberpr√ºft und formatiert.  Warum nicht nur diejenigen, die im Commit vorhanden sind?  F√ºr das Prinzip der kollektiven Verantwortung f√ºr die gesamte Codebasis, so dass niemand versucht war, die Validierung zu umgehen.  Zu diesem <code>--max-warnings=0</code> beim Erstellen eines Commits alle Linter-Warnungen mit <code>--max-warnings=0</code> als Fehler <code>--max-warnings=0</code> . </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"husky"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"hooks"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"pre-commit"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run format:js -- --max-warnings=0 ./ &amp;&amp; npm run format:style ./**/*.scss"</span></span> } } }</code> </pre><br><h3>  Montage / Transport </h3><br><p>  Ich werde wieder den modularen Ansatz verwenden und alle Einstellungen von Webpack und Babel im Ordner ./webpack-custom herausnehmen.  Die Konfiguration basiert auf der folgenden Dateistruktur: </p><br><pre> <code class="pgsql hljs">. |<span class="hljs-comment"><span class="hljs-comment">-- webpack-custom | |-- config | |-- loaders | |-- plugins | |-- rules | |-- utils | `-- package.json | `-- webpack.config.js</span></span></code> </pre><br><p>  Ein ordnungsgem√§√ü konfigurierter Builder bietet: </p><br><ul><li>  die F√§higkeit, Code unter Verwendung der Syntax und der F√§higkeiten der neuesten EcmaScript-Spezifikation zu schreiben, einschlie√ülich praktischer Vorschl√§ge (Klassendekoratoren und ihre Eigenschaften f√ºr MobX sind hier definitiv n√ºtzlich); </li><li>  lokaler Server mit Hot Reloading; </li><li>  Leistungsmetriken f√ºr Baugruppen; </li><li>  √úberpr√ºfung auf zyklische Abh√§ngigkeiten; </li><li>  Analyse der Struktur und Gr√∂√üe der resultierenden Datei; </li><li>  Optimierung und Minimierung f√ºr die Serienmontage; </li><li>  Interpretation modularer <i>* .scss-</i> Dateien und die M√∂glichkeit <i>,</i> fertige <i>* .css-</i> Dateien aus einem Bundle zu <i>entfernen</i> ; </li><li>  Inline-Insert <i>* .svg-</i> Dateien; </li><li>  Polyfill / Style-Pr√§fixe f√ºr Zielbrowser; </li><li>  L√∂sen des Problems des Zwischenspeicherns von Dateien in der Produktion. </li></ul><br><p>  Es wird auch bequem konfiguriert.  Ich werde dieses Problem mit Hilfe von zwei <i>* .env-Beispieldateien</i> l√∂sen: </p><br><div class="spoiler">  <b class="spoiler_title">.frontend.env.example</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">AGGREGATION_TIMEOUT=0 BUNDLE_ANALYZER=false BUNDLE_ANALYZER_PORT=8889 CIRCULAR_CHECK=true CSS_EXTRACT=false DEV_SERVER_PORT=8080 HOT_RELOAD=true NODE_ENV=development SENTRY_URL=false SPEED_ANALYZER=false PUBLIC_URL=false # https://webpack.js.org/configuration/devtool DEV_TOOL=cheap-module-source-map</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">.frontend.env.prod.example</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">AGGREGATION_TIMEOUT=0 BUNDLE_ANALYZER=false BUNDLE_ANALYZER_PORT=8889 CIRCULAR_CHECK=false CSS_EXTRACT=true DEV_SERVER_PORT=8080 HOT_RELOAD=false NODE_ENV=production SENTRY_URL=false SPEED_ANALYZER=false PUBLIC_URL=/exchange_habr/dist # https://webpack.js.org/configuration/devtool DEV_TOOL=false</code> </pre></div></div><br><p>  <i>Um</i> die Assembly zu starten, m√ºssen Sie daher eine Datei mit dem Namen <i>.frontend.env</i> und dem obligatorischen Vorhandensein aller Parameter erstellen.  Dieser Ansatz l√∂st mehrere Probleme gleichzeitig: Es m√ºssen keine separaten Konfigurationsdateien f√ºr Webpack erstellt und deren Konsistenz beibehalten werden.  lokal k√∂nnen Sie konfigurieren, wie viel ein bestimmter Entwickler ben√∂tigt;  Deployment-Entwickler kopieren nur die Datei f√ºr die Produktionsassembly ( <code>cp .frontend.env.prod.example .frontend.env</code> ), <code>cp .frontend.env.prod.example .frontend.env</code> die Werte aus dem Repository <code>cp .frontend.env.prod.example .frontend.env</code> Frontend-Entwickler das Rezept √ºber Variablen verwalten, ohne Administratoren zu verwenden.  Zus√§tzlich ist es m√∂glich, eine Beispielkonfiguration f√ºr St√§nde vorzunehmen (z. B. mit Quellkarten). </p><br><p>  Um Stile in Dateien mit aktiviertem <i>CSS_EXTRACT</i> zu trennen, verwende <i>ich</i> das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mini-CSS-Extrakt-Plugin</a> - es erm√∂glicht Ihnen, Hot Reloading zu verwenden.  Das hei√üt, wenn Sie <i>HOT_RELOAD</i> und <i>CSS_EXTRACT</i> f√ºr die lokale Entwicklung <i>aktivieren</i> , dann mit <br>  Beim √Ñndern von Stildateien werden nur Stile neu geladen - aber leider alles, nicht nur die ge√§nderte Datei.  <i>Wenn CSS_EXTRACT deaktiviert</i> ist, wird nur das ge√§nderte <i>Stilmodul</i> aktualisiert. </p><br><p>  HMR f√ºr die Arbeit mit React Hooks ist standardm√§√üig enthalten: </p><br><ul><li>  <code>webpack.HotModuleReplacementPlugin</code> in Plugins; </li><li>  <code>hot: true</code> in den Parametern <i>webpack-dev-server</i> ; </li><li>  <code>react-hot-loader/babel</code> in <i>Babel-Loader-</i> Plugins; </li><li>  <code>options.hmr: true</code> im <i>Mini-CSS-Extract-Plugin</i> ; </li><li>  <code>export default hot(App)</code> in die Hauptkomponente der Anwendung. </li><li>  <i>@ hot-loader / react-dom</i> anstelle des √ºblichen <code>resolve.alias: { 'react-dom': '@hot-loader/react-dom' }</code> <i>-dom</i> (bequem √ºber <code>resolve.alias: { 'react-dom': '@hot-loader/react-dom' }</code> ); </li></ul><br><p>  Die aktuelle Version von React <i>-Hot-Loader</i> unterst√ºtzt das Speichern von Komponenten mit <code>React.memo</code> nicht. Wenn <code>React.memo</code> also Dekoratoren f√ºr MobX schreiben, m√ºssen Sie dies ber√ºcksichtigen, um die lokale Entwicklung zu vereinfachen.  Eine weitere Unannehmlichkeit, die dadurch verursacht wird, besteht darin, dass bei aktivierter Aktivierung von <i>Highlight-Updates</i> in den React Developer Tools alle Komponenten w√§hrend einer Interaktion mit der Anwendung aktualisiert werden.  Wenn Sie lokal an der Leistungsoptimierung <i>arbeiten</i> , sollte daher die Einstellung <i>HOT_RELOAD</i> deaktiviert sein. </p><br><p>  Die Build-Optimierung in Webpack 4 wird automatisch ausgef√ºhrt, wenn der <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mode</a> : 'development' | 'production'</code>  <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mode</a> : 'development' | 'production'</code> .  In diesem Fall verlasse ich mich auf die Standardoptimierung (+ Aufnahme des Parameters <code>keep_fnames: true</code> in das <i>Terser-Webpack-Plugin</i> , um den Namen der Komponenten zu speichern), da dieser bereits gut abgestimmt ist. </p><br><p>  Die Trennung von Chunks und die Kontrolle des Client-Caching verdienen besondere Aufmerksamkeit.  F√ºr den korrekten Betrieb ben√∂tigen Sie: </p><br><ul><li>  Geben Sie in output.filename f√ºr js- und css-Dateien <code>isProduction ? '[name].[contenthash].js' : '[name].js'</code>  <code>isProduction ? '[name].[contenthash].js' : '[name].js'</code> (mit der Erweiterung .css), sodass der Name der Datei auf ihrem Inhalt basiert; </li><li>  √Ñndern Sie bei der Optimierung die Parameter in <code>chunkIds: 'named', moduleIds: 'hashed'</code> damit sich der interne Modulz√§hler im Webpack nicht √§ndert. </li><li>  Legen Sie die Laufzeit in einem separaten Block ab. </li><li>  Verschieben Sie Cache-Gruppen in splitChunks (vier Punkte reichen f√ºr diese Anwendung aus - lodash, Sentry, Highcharts und Vendor f√ºr andere Abh√§ngigkeiten von <i>node_modules</i> ).  Da die ersten drei nur selten aktualisiert werden, verbleiben sie so lange wie m√∂glich im Browser-Cache des Clients. </li></ul><br><div class="spoiler">  <b class="spoiler_title">webpack-custom / config / configOptimization.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @docs: https://webpack.js.org/configuration/optimization * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TerserPlugin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'terser-webpack-plugin'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">runtimeChunk</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'runtime'</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">chunkIds</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">moduleIds</span></span>: <span class="hljs-string"><span class="hljs-string">'hashed'</span></span>, <span class="hljs-attr"><span class="hljs-attr">mergeDuplicateChunks</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">splitChunks</span></span>: { <span class="hljs-attr"><span class="hljs-attr">cacheGroups</span></span>: { <span class="hljs-attr"><span class="hljs-attr">lodash</span></span>: { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">module</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.context.indexOf(<span class="hljs-string"><span class="hljs-string">'node_modules\\lodash'</span></span>) !== <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>, <span class="hljs-attr"><span class="hljs-attr">chunks</span></span>: <span class="hljs-string"><span class="hljs-string">'all'</span></span>, <span class="hljs-attr"><span class="hljs-attr">enforce</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">sentry</span></span>: { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">module</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.context.indexOf(<span class="hljs-string"><span class="hljs-string">'node_modules\\@sentry'</span></span>) !== <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'sentry'</span></span>, <span class="hljs-attr"><span class="hljs-attr">chunks</span></span>: <span class="hljs-string"><span class="hljs-string">'all'</span></span>, <span class="hljs-attr"><span class="hljs-attr">enforce</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">highcharts</span></span>: { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">module</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.context.indexOf(<span class="hljs-string"><span class="hljs-string">'node_modules\\highcharts'</span></span>) !== <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'highcharts'</span></span>, <span class="hljs-attr"><span class="hljs-attr">chunks</span></span>: <span class="hljs-string"><span class="hljs-string">'all'</span></span>, <span class="hljs-attr"><span class="hljs-attr">enforce</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">vendor</span></span>: { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">module</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.context.indexOf(<span class="hljs-string"><span class="hljs-string">'node_modules'</span></span>) !== <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-attr"><span class="hljs-attr">priority</span></span>: <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'vendor'</span></span>, <span class="hljs-attr"><span class="hljs-attr">chunks</span></span>: <span class="hljs-string"><span class="hljs-string">'all'</span></span>, <span class="hljs-attr"><span class="hljs-attr">enforce</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, }, }, <span class="hljs-attr"><span class="hljs-attr">minimizer</span></span>: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TerserPlugin({ <span class="hljs-attr"><span class="hljs-attr">terserOptions</span></span>: { <span class="hljs-attr"><span class="hljs-attr">keep_fnames</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }, }), ], };</code> </pre></div></div><br><p>  Um die Baugruppe in diesem Projekt zu beschleunigen, verwende ich den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Thread-Loader.</a> Bei Parallelisierung zu 4 Prozessen wurde die Baugruppe um 90% beschleunigt, was besser ist als bei HappyPack mit denselben Einstellungen. </p><br><p>  Einstellungen f√ºr Lader, einschlie√ülich f√ºr babel, in separaten Dateien (wie <i>.babelrc</i> ) zum <i>L√∂schen sind meines Erachtens nicht erforderlich</i> .  Die browser√ºbergreifende Konfiguration ist jedoch bequemer im <i>Browserlistenparameter</i> des <i>Hauptpakets.json zu speichern</i> , da sie auch f√ºr Autoprefixer-Stile verwendet wird. </p><br><p>  Um die Arbeit mit Prettier zu <i>vereinfachen</i> , habe ich den Parameter <i>AGGREGATION_TIMEOUT erstellt</i> , mit dem Sie die Verz√∂gerung zwischen dem Erkennen von √Ñnderungen in Dateien und dem erneuten <i>Erstellen</i> der Anwendung im Dev-Server-Modus festlegen k√∂nnen.  Da ich die Neuformatierung der Dateien beim Speichern in der IDE konfiguriert habe, werden zwei Neuerstellungen durchgef√ºhrt - die erste zum Speichern der Originaldatei und die zweite zum Abschlie√üen der Formatierung.  2000 Millisekunden reichen normalerweise aus, damit das Webpack auf die endg√ºltige Version der Datei wartet. </p><br><p>  Der Rest der Konfiguration verdient keine besondere Aufmerksamkeit, da er in Hunderten von Schulungsmaterialien f√ºr Anf√§nger beschrieben wird, sodass Sie mit dem Entwurf der Anwendungsarchitektur fortfahren k√∂nnen. </p><br><h3>  Stil-Themen </h3><br><p>  Zuvor mussten Sie zum Erstellen von Themen mehrere Versionen von <i>* .css-</i> Dateien erstellen und die Seite beim √Ñndern von Themen neu laden und die gew√ºnschten Stile laden.  Jetzt ist alles einfach mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">benutzerdefinierten CSS-Eigenschaften zu</a> l√∂sen.  Diese Technologie wird von allen Zielbrowsern der aktuellen Anwendung unterst√ºtzt, es gibt jedoch auch Polyfills f√ºr den IE. </p><br><p>  Nehmen wir an, es gibt zwei Themen - hell und dunkel, deren Farbsets verwendet werden </p><br><div class="spoiler">  <b class="spoiler_title">styles / theme.scss</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">.light { --n0: rgb(255, 255, 255); --n100: rgb(186, 186, 186); --n10: rgb(249, 249, 249); --n10a3: rgba(249, 249, 249, 0.3); --n20: rgb(245, 245, 245); --n30: rgb(221, 221, 221); --n500: rgb(136, 136, 136); --n600: rgb(102, 102, 102); --n900: rgb(0, 0, 0); --b100: rgb(219, 237, 251); --b300: rgb(179, 214, 252); --b500: rgb(14, 123, 249); --b500a3: rgba(14, 123, 249, 0.3); --b900: rgb(32, 39, 57); --g400: rgb(71, 215, 141); --g500: rgb(61, 189, 125); --g500a1: rgba(61, 189, 125, 0.1); --g500a2: rgba(61, 189, 125, 0.2); --r400: rgb(255, 100, 100); --r500: rgb(255, 0, 0); --r500a1: rgba(255, 0, 0, 0.1); --r500a2: rgba(255, 0, 0, 0.2); } .dark { --n0: rgb(25, 32, 48); --n100: rgb(114, 126, 151); --n10: rgb(39, 46, 62); --n10a3: rgba(39, 46, 62, 0.3); --n20: rgb(25, 44, 74); --n30: rgb(67, 75, 111); --n500: rgb(117, 128, 154); --n600: rgb(255, 255, 255); --n900: rgb(255, 255, 255); --b100: rgb(219, 237, 251); --b300: rgb(39, 46, 62); --b500: rgb(14, 123, 249); --b500a3: rgba(14, 123, 249, 0.3); --b900: rgb(32, 39, 57); --g400: rgb(0, 220, 103); --g500: rgb(0, 197, 96); --g500a1: rgba(0, 197, 96, 0.1); --g500a2: rgba(0, 197, 96, 0.2); --r400: rgb(248, 23, 1); --r500: rgb(221, 23, 1); --r500a1: rgba(221, 23, 1, 0.1); --r500a2: rgba(221, 23, 1, 0.2); }</code> </pre></div></div><br><p>  Damit diese Variablen global angewendet werden k√∂nnen, m√ºssen sie in <code>document.documentElement</code> geschrieben werden. Zum Konvertieren dieser Datei in ein Javascript-Objekt ist jeweils ein kleiner Parser erforderlich.  Sp√§ter werde ich Ihnen sagen, warum es bequemer ist, es sofort in Javascript zu speichern. </p><br><div class="spoiler">  <b class="spoiler_title">webpack-custom / utils / sassVariablesLoader.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertSourceToJsObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> themesObject = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fullThemesArray = source.match(<span class="hljs-regexp"><span class="hljs-regexp">/\.([^}]|\s)*}/g</span></span>) || []; fullThemesArray.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fullThemeStr</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> theme = fullThemeStr .match(<span class="hljs-regexp"><span class="hljs-regexp">/\.\w+\s{/g</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] .replace(<span class="hljs-regexp"><span class="hljs-regexp">/\W/g</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); themesObject[theme] = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> variablesMatches = fullThemeStr.match(<span class="hljs-regexp"><span class="hljs-regexp">/--(.*:[^;]*)/g</span></span>) || []; variablesMatches.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">varMatch</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [key, value] = varMatch.split(<span class="hljs-string"><span class="hljs-string">': '</span></span>); themesObject[theme][key] = value; }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> themesObject; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkThemesEquality</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">themes</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> themesArray = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(themes); themesArray.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">themeStr</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> themeObject = themes[themeStr]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> otherThemesArray = themesArray.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t</span></span></span><span class="hljs-function"> =&gt;</span></span> t !== themeStr); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(themeObject).forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">variableName</span></span></span><span class="hljs-function"> =&gt;</span></span> { otherThemesArray.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">otherThemeStr</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> otherThemeObject = themes[otherThemeStr]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!otherThemeObject[variableName]) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>( <span class="hljs-string"><span class="hljs-string">`checkThemesEquality: theme </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${otherThemeStr}</span></span></span><span class="hljs-string"> has no variable </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${variableName}</span></span></span><span class="hljs-string">`</span></span> ); } }); }); }); } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sassVariablesLoader</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> themes = convertSourceToJsObject(source); checkThemesEquality(themes); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`module.exports = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-built_in"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-built_in">JSON</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.stringify(themes)}</span></span></span><span class="hljs-string">`</span></span>; };</code> </pre></div></div><br><p>  Hier wird die Konsistenz dadurch √ºberpr√ºft - das hei√üt, die vollst√§ndige Entsprechung des Satzes von Variablen, mit deren Differenz die Baugruppe f√§llt. </p><br><p>  Wenn Sie diesen Loader verwenden, erhalten Sie ein sehr sch√∂nes Objekt mit Parametern, und ein paar Zeilen f√ºr das Dienstprogramm zum √Ñndern von Themen reichen aus: </p><br><div class="spoiler">  <b class="spoiler_title">src / utils / setTheme.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> themes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'styles/themes.scss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> root = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.documentElement; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTheme</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">theme</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.entries(themes[theme]).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[key, value]</span></span></span><span class="hljs-function">) =&gt;</span></span> { root.style.setProperty(key, value); }); }</code> </pre></div></div><br><p>  Ich bevorzuge es, diese CSS-Variablen in Standardvariablen f√ºr <i>* .scss zu √ºbersetzen</i> : </p><br><div class="spoiler">  <b class="spoiler_title">src / styles / constants.scss</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/py/b5/jf/pyb5jfs2g07r-ypnnkoudkdxe7s.png"><br></div></div><br><p>  Die WebStorm-IDE (siehe Screenshot) zeigt die Farben im linken Bereich an. Durch Klicken auf die Farbe wird eine Palette ge√∂ffnet, in der Sie sie √§ndern k√∂nnen.  Die neue Farbe wird automatisch in <i>theme.scss ersetzt</i> , Hot Reload funktioniert und die Anwendung wird sofort transformiert.  Dies ist genau das Ma√ü an Entwicklungskomfort, das 2019 erwartet wird. </p><br><h3>  Grunds√§tze der Code-Organisation </h3><br><p>  In diesem Projekt bleibe ich bei doppelten Ordnernamen f√ºr Komponenten, Dateien und Stile, zum Beispiel: </p><p></p><pre> <code class="pgsql hljs">. |<span class="hljs-comment"><span class="hljs-comment">-- components | |-- Chart | | `-- Chart.js | | `-- Chart.scss | | `-- package.json</span></span></code> </pre><br><p>  Dementsprechend hat <i>package.json</i> den Inhalt <code>{ "main": "Chart.js" }</code> .  Bei Komponenten mit mehreren benannten Exporten (z. B. Dienstprogrammen) beginnt der Name der Hauptdatei mit einem Unterstrich: </p><br><pre> <code class="pgsql hljs">. |<span class="hljs-comment"><span class="hljs-comment">-- utils | `-- _utils.js | `-- someUtil.js | `-- anotherUtil.js | `-- package.json</span></span></code> </pre><br><p>  Der Rest der Dateien wird exportiert als: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./someUtil'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./anotherUtil'</span></span>;</code> </pre><br><p>  Auf diese Weise k√∂nnen Sie doppelte Dateinamen <i>entfernen</i> , um nicht in den Top Ten der offenen <i>index.js</i> / <i>style.scss verloren zu gehen</i> .  Sie k√∂nnen dies mit IDE-Plugins l√∂sen, aber warum nicht auf universelle Weise. </p><br><p>  Ich werde die Komponenten Seite f√ºr Seite gruppieren, mit Ausnahme allgemeiner Komponenten wie Nachricht / Link, und wenn m√∂glich auch benannte Exporte (ohne <code>export default</code> ) verwenden, um die Einheitlichkeit der Namen, die einfache Umgestaltung und die Projektsuche aufrechtzuerhalten. </p><br><h3>  Konfigurieren Sie MobX-Rendering und -Speicher </h3><br><p>  Die Datei, die als Einstiegspunkt f√ºr Webpack dient, sieht folgenderma√üen aus: </p><br><div class="spoiler">  <b class="spoiler_title">src / app.js.</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./polyfill'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./styles/reset.scss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./styles/global.scss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { initSentry, renderToDOM } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { initAutorun } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./autorun'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { store } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'stores'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/App'</span></span>; initSentry(); initAutorun(store); renderToDOM(App);</code> </pre></div></div><br><p>  Da bei der Arbeit mit Observablen die Konsole in Polyfills so etwas wie <code>Proxy {0: "btc", 1: "eth", 2: "usd", 3: "test", Symbol(mobx administration): ObservableArrayAdministration}</code> anzeigt Ich werde ein Dienstprogramm zur Standardisierung erstellen: </p><br><div class="spoiler">  <b class="spoiler_title">src / polyfill.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { toJS } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.js = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consoleJsCustom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(...args.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arg</span></span></span><span class="hljs-function"> =&gt;</span></span> toJS(arg))); };</code> </pre></div></div><br><p>  Au√üerdem sind globale Stile und Stilnormalisierung f√ºr verschiedene Browser in der Hauptdatei verbunden. Wenn in .env.frontend ein Schl√ºssel f√ºr Sentry vorhanden ist, werden Fehler protokolliert, MobX-Speicher erstellt, die Verfolgung von Parameter√§nderungen mit Autorun <i>initiiert und die</i> in den <i>React-Hot-Loader eingeschlossene</i> Komponente bereitgestellt im DOM. </p><br><p>  Das Repository selbst ist eine nicht beobachtbare Klasse, deren Parameter nicht beobachtbare Klassen mit beobachtbaren Parametern sind.  Es versteht sich daher, dass der Parametersatz nicht dynamisch ist - daher ist die Anwendung vorhersehbarer.  Dies ist einer der wenigen Orte, an denen JSDoc n√ºtzlich ist, um die automatische Vervollst√§ndigung in der IDE zu erm√∂glichen. </p><br><div class="spoiler">  <b class="spoiler_title">src / store / RootStore.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { I18nStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./I18nStore'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { RatesStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./RatesStore'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { GlobalStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./GlobalStore'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { RouterStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./RouterStore'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { CurrentTPStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./CurrentTPStore'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { MarketsListStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./MarketsListStore'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * @name RootStore */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RootStore</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.i18n = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> I18nStore(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rates = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RatesStore(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.global = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GlobalStore(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.router = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RouterStore(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentTP = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CurrentTPStore(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.marketsList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MarketsListStore(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre></div></div><br><p>  Ein Beispiel f√ºr einen MobX-Speicher kann am Beispiel eines GlobalStore analysiert werden, der derzeit nur den Zweck hat, das aktuelle Stilthema zu speichern und festzulegen. </p><br><div class="spoiler">  <b class="spoiler_title">src / store / GlobalStore.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { makeObservable, setTheme } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> themes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'styles/themes.scss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> themesList = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(themes); @makeObservable <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GlobalStore</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * @param rootStore {RootStore} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(rootStore) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rootStore = rootStore; setTheme(themesList[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } themesList = themesList; currentTheme = <span class="hljs-string"><span class="hljs-string">''</span></span>; setTheme(theme) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentTheme = theme; setTheme(theme); } }</code> </pre></div></div><br><p>  Manchmal legen die Parameter und Methoden der Klasse den Typ manuell mithilfe von Dekoratoren fest, zum Beispiel: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GlobalStore</span></span></span><span class="hljs-class"> </span></span>{ @observable currentTheme = <span class="hljs-string"><span class="hljs-string">''</span></span>; @action.bound setTheme(theme) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentTheme = theme; setTheme(theme); } }</code> </pre><br><p>  Aber ich sehe keinen Grund darin, da die alten Dekorateure der Proposal-Klasse ihre automatische Transformation unterst√ºtzen, sodass das folgende Dienstprogramm ausreicht: </p><br><div class="spoiler">  <b class="spoiler_title">src / utils / makeObservable.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { action, computed, decorate, observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeObservable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *   -   this +    *     * *   -   computed * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> classPrototype = target.prototype; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> methodsAndGetters = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyNames(classPrototype).filter( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">methodName</span></span></span><span class="hljs-function"> =&gt;</span></span> methodName !== <span class="hljs-string"><span class="hljs-string">'constructor'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> methodName <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> methodsAndGetters) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> descriptor = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyDescriptor( classPrototype, methodName ); descriptor.value = decorate(classPrototype, { [methodName]: <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> descriptor.value === <span class="hljs-string"><span class="hljs-string">'function'</span></span> ? action.bound : computed, }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...constructorArguments</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">/** * ,   rootStore,   * observable * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> target(...constructorArguments); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> staticProperties = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(store); staticProperties.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">propName</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (propName === <span class="hljs-string"><span class="hljs-string">'rootStore'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> descriptor = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyDescriptor(store, propName); <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty( store, propName, observable(store, propName, descriptor) ); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store; }; }</code> </pre></div></div><br><p>  Um es zu verwenden, m√ºssen Sie die Plugins in <i>loaderBabel.js anpassen</i> : <code>['@babel/plugin-proposal-decorators', { legacy: true }], ['@babel/plugin-proposal-class-properties', { loose: true }]</code> , und setzen Sie in den ESLint-Einstellungen <code>parserOptions.ecmaFeatures.legacyDecorators: true</code> entsprechend.  Ohne diese Einstellungen wird nur der Klassendeskriptor ohne Prototyp an den Zieldekorateur √ºbergeben, und trotz sorgf√§ltiger Recherche der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aktuellen Version von Proposal habe</a> ich keine M√∂glichkeit gefunden, Methoden und statische Eigenschaften zu verpacken. </p><br><p>  Im Allgemeinen ist das Speicher-Setup abgeschlossen, aber es w√§re sch√∂n, das Potenzial von MobX-Autorun freizuschalten.  Zu diesem Zweck sind Aufgaben wie "Warten auf eine Antwort vom Autorisierungsserver" oder "Herunterladen von √úbersetzungen vom Server", dann Schreiben der Antworten auf den Server und direktes Rendern der Anwendung im DOM am besten geeignet.  Daher werde ich ein wenig in die Zukunft laufen und ein Gesch√§ft mit Lokalisierung erstellen: </p><br><div class="spoiler">  <b class="spoiler_title">src / store / I18nStore.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { makeObservable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'localization/ru.json'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> en <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'localization/en.json'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> languages = { ru, en, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> languagesList = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(languages); @makeObservable <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">I18nStore</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * @param rootStore {RootStore} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(rootStore) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rootStore = rootStore; setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setLocalization(<span class="hljs-string"><span class="hljs-string">'ru'</span></span>); }, <span class="hljs-number"><span class="hljs-number">500</span></span>); } i18n = {}; languagesList = languagesList; currentLanguage = <span class="hljs-string"><span class="hljs-string">''</span></span>; setLocalization(language) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentLanguage = language; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.i18n = languages[language]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rootStore.global.shouldAppRender = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre></div></div><br><p>  Wie Sie sehen k√∂nnen, gibt es einige <i>* .json-</i> Dateien mit √úbersetzungen, und das asynchrone Laden mit setTimeout wird im Klassenkonstruktor emuliert.  Bei der Ausf√ºhrung wird der k√ºrzlich erstellte GlobalStore mit <code>this.rootStore.global.shouldAppRender = true</code> markiert. </p><br><p>  Daher m√ºssen Sie von <i>app.js</i> aus die Rendering-Funktion in die Datei <i>autorun.js √ºbertragen</i> : </p><br><div class="spoiler">  <b class="spoiler_title">src / autorun.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* eslint-disable no-unused-vars */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { autorun } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderToDOM } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> loggingEnabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logReason</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">autorunName, reaction</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!loggingEnabled || reaction.observing.length === <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> logString = reaction.observing.reduce( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str, { name, value }</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${str}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string"> changed to </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${value}</span></span></span><span class="hljs-string">; `</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> ); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`autorun-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${autorunName}</span></span></span><span class="hljs-string">`</span></span>, logString); } <span class="hljs-comment"><span class="hljs-comment">/** * @param store {RootStore} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initAutorun</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function">) </span></span>{ autorun(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reaction</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (store.global.shouldAppRender) { renderToDOM(App); } logReason(<span class="hljs-string"><span class="hljs-string">'shouldAppRender'</span></span>, reaction); }); }</code> </pre></div></div><br><p>  Die <i>initAutorun-</i> Funktion kann eine beliebige Anzahl von <i>Autorun-</i> Konstruktionen mit R√ºckrufen enthalten, die nur funktionieren, wenn sie sich selbst initiieren und eine Variable innerhalb eines bestimmten R√ºckrufs √§ndern.  In diesem Fall wurde <code>autorun-shouldAppRender GlobalStore@3.shouldAppRender changed to true;</code>  und verursachte das Rendern der Anwendung im DOM.  Ein leistungsstarkes Tool, mit dem Sie alle √Ñnderungen im Gesch√§ft protokollieren und entsprechend reagieren k√∂nnen. </p><br><h3>  Lokalisierung und React Hooks </h3><br><p>  Die √úbersetzung in andere Sprachen ist eine der umfangreichsten Aufgaben, in kleinen Unternehmen wird sie oft dutzende Male untersch√§tzt und in gro√üen Unternehmen ist sie unn√∂tig √ºberkompliziert.  Abh√§ngig von der Implementierung, wie viele Nerven und Zeit nicht in mehreren Abteilungen des Unternehmens gleichzeitig verschwendet werden.  Ich werde in dem Artikel nur den Client-Teil mit einem R√ºckstand f√ºr die zuk√ºnftige Integration mit anderen Systemen erw√§hnen. </p><br><p>  F√ºr die Bequemlichkeit der Frontend-Entwicklung m√ºssen Sie in der Lage sein: </p><br><ul><li>  setze semantische Namen f√ºr Konstanten; </li><li>  F√ºgen Sie dynamische Variablen ein </li><li>  Singular / Plural angeben; </li><li>      ‚Äî   -; </li><li>         ; </li><li>       /  ; </li><li>  ; </li><li> ()   ; </li><li> ()         ,         . </li></ul><br><p>    ,  ,  :         <i>messages.js</i>      (      )      .         .             (     / ),    .    ( , , )  .   . </p><br><p>       ,    <i>currentLanguage</i>   <i>i18n</i>    ,   ,     . </p><br><div class="spoiler"> <b class="spoiler_title">src/components/TestLocalization.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useLocalization } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'hooks'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messages = { <span class="hljs-attr"><span class="hljs-attr">hello</span></span>: <span class="hljs-string"><span class="hljs-string">'  {count} {count: ,,}'</span></span>, }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestLocalization</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getLn = useLocalization(__filename, messages); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{getLn(messages.hello, { count: 1 })}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TestLocalizationConnected = observer(TestLocalization);</code> </pre></div></div><br><p>        ,       MobX-     ,  , Connected. ,       ESLint,       . </p><br><p>  observer     <code>mobx-react-lite/useObserver</code> ,    <i>HOT_RELOAD</i>      <i>React.memo</i> (  <i>PureMixin</i> / <i>PureComponent</i> ),       <i>useObserver</i>   : </p><br><div class="spoiler"> <b class="spoiler_title">src/utils/observer.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useObserver } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'mobx-react-lite'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copyStaticProperties</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">base, target</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hoistBlackList = { <span class="hljs-attr"><span class="hljs-attr">$$typeof</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">compare</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(base).forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (base.hasOwnProperty(key) &amp;&amp; !hoistBlackList[key]) { <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty( target, key, <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.getOwnPropertyDescriptor(base, key) ); } }); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">observer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">baseComponent, options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> baseComponentName = baseComponent.displayName || baseComponent.name; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrappedComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props, ref</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> useObserver(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyObserver</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> baseComponent(props, ref); }, baseComponentName); } wrappedComponent.displayName = baseComponentName; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> memoComponent = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HOT_RELOAD === <span class="hljs-string"><span class="hljs-string">'true'</span></span>) { memoComponent = wrappedComponent; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (options.forwardRef) { memoComponent = React.memo(React.forwardRef(wrappedComponent)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { memoComponent = React.memo(wrappedComponent); } copyStaticProperties(baseComponent, memoComponent); memoComponent.displayName = baseComponentName; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> memoComponent; }</code> </pre></div></div><br><p>     <code>displayName</code>   ,   React-     ( stack trace   ). </p><br><p>      RootStore: </p><br><div class="spoiler"> <b class="spoiler_title">src/hooks/useStore.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { store } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'stores'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> storeContext = React.createContext(store); <span class="hljs-comment"><span class="hljs-comment">/** * @returns {RootStore} * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useStore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.useContext(storeContext); }</code> </pre></div></div><br><p>       ,   observer: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'hooks'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = useStore(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{store.i18n.currentLanguage}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TestComponentConnected = observer(TestComponent);</code> </pre><br><p>      TestLocalization ‚Äî     useLocalization: </p><br><div class="spoiler"> <b class="spoiler_title">src/hooks/useLocalization.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { declOfNum } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./useStore'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> showNoTextMessage = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replaceDynamicParams</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">values, formattedMessage</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_.isPlainObject(values)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> formattedMessage; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> messageWithValues = formattedMessage; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.entries(values).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[paramName, value]</span></span></span><span class="hljs-function">) =&gt;</span></span> { messageWithValues = formattedMessage.replace(<span class="hljs-string"><span class="hljs-string">`{</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${paramName}</span></span></span><span class="hljs-string">}`</span></span>, value); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> messageWithValues; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replacePlurals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">values, formattedMessage</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_.isPlainObject(values)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> formattedMessage; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> messageWithPlurals = formattedMessage; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.entries(values).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[paramName, value]</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pluralPattern = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(<span class="hljs-string"><span class="hljs-string">`{</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${paramName}</span></span></span><span class="hljs-string">:\\s([^}]*)}`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pluralMatch = formattedMessage.match(pluralPattern); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pluralMatch &amp;&amp; pluralMatch[<span class="hljs-number"><span class="hljs-number">1</span></span>]) { messageWithPlurals = formattedMessage.replace( pluralPattern, declOfNum(value, pluralMatch[<span class="hljs-number"><span class="hljs-number">1</span></span>].split(<span class="hljs-string"><span class="hljs-string">','</span></span>)) ); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> messageWithPlurals; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useLocalization</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filename, messages</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">i18n</span></span>: { i18n, currentLanguage }, } = useStore(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text, values</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> key = _.findKey(messages, message =&gt; message === text); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> localizedText = _.get(i18n, [filename, key]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!localizedText &amp;&amp; showNoTextMessage) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error( <span class="hljs-string"><span class="hljs-string">`useLocalization: no localization for lang '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${currentLanguage}</span></span></span><span class="hljs-string">' in </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${filename}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${key}</span></span></span><span class="hljs-string">`</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> formattedMessage = localizedText || text; formattedMessage = replaceDynamicParams(values, formattedMessage); formattedMessage = replacePlurals(values, formattedMessage); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> formattedMessage; }; }</code> </pre></div></div><br><p>  <i>replaceDynamicParams</i>  <i>replacePlurals</i>     ‚Äî            , ,    , ,  ,      .. </p><br><p>         Webpack ‚Äî <i>__filename</i> ‚Äî    ,   ,       .         ,       ‚Äî        ,       ,     .     ,     : </p><br><pre> <code class="javascript hljs">useLocalization: no localization <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> lang <span class="hljs-string"><span class="hljs-string">'ru'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> src\components\TestLocalization\TestLocalization.js hello</code> </pre><br><p>         <i>ru.json</i> : </p><br><div class="spoiler"> <b class="spoiler_title">src/localization/ru.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"src\\components\\TestLocalization\\TestLocalization.js"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"hello"</span></span>: <span class="hljs-string"><span class="hljs-string">"  {count} {count: ,,}"</span></span> } }</code> </pre></div></div><br><p>   ,   .      <i>src/localization/en.json</i>       ¬´ ¬ª    <i>setLocalization</i>  I18nStore. </p><br><p>    ¬´¬ª   React  Message: </p><br><div class="spoiler"> <b class="spoiler_title">src/components/Message/Message.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useLocalization } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'hooks'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Message</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { filename, messages, text, values } = props; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getLn = useLocalization(filename, messages); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getLn(text, values); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ConnectedMessage = observer(Message); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filename, messages</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MessageHoc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fullProps = { filename, messages, ...props }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ConnectedMessage</span></span></span></span><span class="xml"><span class="hljs-tag"> {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...fullProps</span></span></span></span><span class="xml"><span class="hljs-tag">} /&gt;</span></span></span><span class="xml">; }; }</span></span></code> </pre></div></div><br><p>        __filename (    id     ),       ,   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Message = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'components/Message'</span></span>).init( __filename, messages ); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{messages.hello}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">values</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">count:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag"> }} /&gt;</span></span></span></span></code> </pre><br><p>   ‚Äî      <i>useLocalization</i>       (      <i>currentLanguage</i> ,     Message ‚Äî   .    ,          ,      . </p><br><p>     ,           (    ,       ,      ,  /              production).       id      ,          <i>messages.js</i>   <i>*.json</i>     ,    .               (      / ),      production.       ,    ,   . </p><br><p>     MobX + Hooks    .     ,   backend,    ,    ,   . </p><br><h3>   API </h3><br><p>         ( backend,      ) ‚Äî   ,   ,     .        ,      .     : </p><br><div class="spoiler"> <b class="spoiler_title">src/stores/CurrentTPStore.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { makeObservable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { apiRoutes, request } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'api'</span></span>; @makeObservable <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CurrentTPStore</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * @param rootStore {RootStore} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(rootStore) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rootStore = rootStore; } id = <span class="hljs-string"><span class="hljs-string">''</span></span>; symbol = <span class="hljs-string"><span class="hljs-string">''</span></span>; fullName = <span class="hljs-string"><span class="hljs-string">''</span></span>; currency = <span class="hljs-string"><span class="hljs-string">''</span></span>; tradedCurrency = <span class="hljs-string"><span class="hljs-string">''</span></span>; low24h = <span class="hljs-number"><span class="hljs-number">0</span></span>; high24h = <span class="hljs-number"><span class="hljs-number">0</span></span>; lastPrice = <span class="hljs-number"><span class="hljs-number">0</span></span>; marketCap = <span class="hljs-number"><span class="hljs-number">0</span></span>; change24h = <span class="hljs-number"><span class="hljs-number">0</span></span>; change24hPercentage = <span class="hljs-number"><span class="hljs-number">0</span></span>; fetchSymbol(params) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { tradedCurrency, id } = params; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { marketsList } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rootStore; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> requestParams = { id, <span class="hljs-attr"><span class="hljs-attr">localization</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">community_data</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">developer_data</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">tickers</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request(apiRoutes.symbolInfo, requestParams) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetchSymbolSuccess(data, tradedCurrency)) .catch(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetchSymbolError); } fetchSymbolSuccess(data, tradedCurrency) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { id, symbol, name, <span class="hljs-attr"><span class="hljs-attr">market_data</span></span>: { high_24h, low_24h, price_change_24h_in_currency, price_change_percentage_24h_in_currency, market_cap, current_price, }, } = data; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.symbol = symbol; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fullName = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currency = symbol; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tradedCurrency = tradedCurrency; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lastPrice = current_price[tradedCurrency]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.high24h = high_24h[tradedCurrency]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.low24h = low_24h[tradedCurrency]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.change24h = price_change_24h_in_currency[tradedCurrency]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.change24hPercentage = price_change_percentage_24h_in_currency[tradedCurrency]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.marketCap = market_cap[tradedCurrency]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve(); } fetchSymbolError(error) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(error); } }</code> </pre></div></div><br><p>  ,  ,      .      <i>fetchSymbol</i> ,    id    ,    .     ,   ‚Äî        (       <code>@action.bound</code> ),       Sentry     : </p><br><div class="spoiler"> <b class="spoiler_title">src/utils/initSentry.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Sentry <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@sentry/browser'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initSentry</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SENTRY_URL !== <span class="hljs-string"><span class="hljs-string">'false'</span></span>) { Sentry.init({ <span class="hljs-attr"><span class="hljs-attr">dsn</span></span>: SENTRY_URL, }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> originalErrorLogger = <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consoleErrorCustom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...args</span></span></span><span class="hljs-function">) </span></span>{ Sentry.captureException(...args); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> originalErrorLogger(...args); }; } }</code> </pre></div></div><br><p>    ,        : </p><br><div class="spoiler"> <b class="spoiler_title">src/api/_api.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { omitParam, validateRequestParams, makeRequestUrl, makeRequest, validateResponse, } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'api/utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">request</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">route, params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve() .then(validateRequestParams(route, params)) .then(makeRequestUrl(route, params)) .then(makeRequest) .then(validateResponse(route, params)); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> apiRoutes = { <span class="hljs-attr"><span class="hljs-attr">symbolInfo</span></span>: { <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">params</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">`https://api.coingecko.com/api/v3/coins/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${params.id}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: omitParam, <span class="hljs-attr"><span class="hljs-attr">localization</span></span>: _.isBoolean, <span class="hljs-attr"><span class="hljs-attr">community_data</span></span>: _.isBoolean, <span class="hljs-attr"><span class="hljs-attr">developer_data</span></span>: _.isBoolean, <span class="hljs-attr"><span class="hljs-attr">tickers</span></span>: _.isBoolean, }, <span class="hljs-attr"><span class="hljs-attr">responseObject</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: _.isString, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: _.isString, <span class="hljs-attr"><span class="hljs-attr">symbol</span></span>: _.isString, <span class="hljs-attr"><span class="hljs-attr">genesis_date</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v</span></span></span><span class="hljs-function"> =&gt;</span></span> _.isString(v) || _.isNil(v), <span class="hljs-attr"><span class="hljs-attr">last_updated</span></span>: _.isString, <span class="hljs-attr"><span class="hljs-attr">country_origin</span></span>: _.isString, <span class="hljs-attr"><span class="hljs-attr">coingecko_rank</span></span>: _.isNumber, <span class="hljs-attr"><span class="hljs-attr">coingecko_score</span></span>: _.isNumber, <span class="hljs-attr"><span class="hljs-attr">community_score</span></span>: _.isNumber, <span class="hljs-attr"><span class="hljs-attr">developer_score</span></span>: _.isNumber, <span class="hljs-attr"><span class="hljs-attr">liquidity_score</span></span>: _.isNumber, <span class="hljs-attr"><span class="hljs-attr">market_cap_rank</span></span>: _.isNumber, <span class="hljs-attr"><span class="hljs-attr">block_time_in_minutes</span></span>: _.isNumber, <span class="hljs-attr"><span class="hljs-attr">public_interest_score</span></span>: _.isNumber, <span class="hljs-attr"><span class="hljs-attr">image</span></span>: _.isPlainObject, <span class="hljs-attr"><span class="hljs-attr">links</span></span>: _.isPlainObject, <span class="hljs-attr"><span class="hljs-attr">description</span></span>: _.isPlainObject, <span class="hljs-attr"><span class="hljs-attr">market_data</span></span>: _.isPlainObject, localization(value, requestParams) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (requestParams.localization === <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isPlainObject(value); }, community_data(value, requestParams) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (requestParams.community_data === <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isPlainObject(value); }, developer_data(value, requestParams) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (requestParams.developer_data === <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isPlainObject(value); }, <span class="hljs-attr"><span class="hljs-attr">public_interest_stats</span></span>: _.isPlainObject, tickers(value, requestParams) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (requestParams.tickers === <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isArray(value); }, <span class="hljs-attr"><span class="hljs-attr">categories</span></span>: _.isArray, <span class="hljs-attr"><span class="hljs-attr">status_updates</span></span>: _.isArray, }, }, };</code> </pre></div></div><br><p>    request : </p><br><ol><li>    apiRoutes    ; </li><li>     ,   route.params,     ,    <i>omitParam</i> ; </li><li>   URL    <code>route.url</code> ‚Äî   ,      ,   ‚Äî    get-  URL; </li><li>     fetch,     JSON; </li><li>     ,   <code>route.responseObject</code>  <code>route.responseArray</code> (     ).       ,   ‚Äî   ,     ; </li><li>      /  /   /       ,      (   <i>fetchSymbolError</i> )  . </li></ol><br><p>               . ,     Sentry,         response: </p><br><p><img src="https://habrastorage.org/webt/mk/7y/8s/mk7y8sh2cushkehhykrrufsvkre.png"></p><br><p>        ‚Äî            (       ),    . </p><br><h3>    </h3><br><p>    ,       ,        . ,    : </p><br><ul><li>          ; </li><li>    pathname  search; </li><li>      / ; </li><li>   location     ; </li><li>      beforeEnter,      isLoading,   ; </li><li>      :   ,    ,   ,   beforeEnter,     ; </li><li>     /   ; </li><li>   /        ; </li><li>     . </li></ul><br><p>     ¬´¬ª,            -,     ‚Äî     .       : </p><br><div class="spoiler"> <b class="spoiler_title">src/routes.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = { <span class="hljs-attr"><span class="hljs-attr">marketDetailed</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'marketDetailed'</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/market/:market/:pair'</span></span>, <span class="hljs-attr"><span class="hljs-attr">masks</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/^[a-zA-Z]{3,5}-[a-zA-Z]{3}$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">market</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/^[a-zA-Z]{3,4}$/</span></span>, }, beforeEnter(route, store) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { pair, market }, } = route; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [symbol, tradedCurrency] = pair.split(<span class="hljs-string"><span class="hljs-string">'-'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prevMarket = store.marketsList.currentMarket; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optimisticallyUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ store.marketsList.currentMarket = market; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve() .then(optimisticallyUpdate) .then(store.marketsList.fetchSymbolsList) .then(store.rates.fetchRates) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> store.marketsList.fetchMarketList(market, prevMarket)) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> store.currentTP.fetchSymbol({ symbol, tradedCurrency, }) ) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(error); }); }, }, <span class="hljs-attr"><span class="hljs-attr">error404</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'error404'</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/error404'</span></span>, }, };</code> </pre></div></div><br><div class="spoiler"> <b class="spoiler_title">src/routeComponents.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { MarketDetailed } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'pages/MarketDetailed'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Error404 } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'pages/Error404'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routeComponents = { <span class="hljs-attr"><span class="hljs-attr">marketDetailed</span></span>: MarketDetailed, <span class="hljs-attr"><span class="hljs-attr">error404</span></span>: Error404, };</code> </pre></div></div><br><p> ,  ,          ‚Äî         <code>&lt;Link route={routes.marketDetailed}&gt;</code> ,    . Webpack       ,      . </p><br><p>   ,    location      . </p><br><div class="spoiler"> <b class="spoiler_title">src/stores/RouterStore.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { makeObservable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { routes } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'routes'</span></span>; @makeObservable <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RouterStore</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * @param rootStore {RootStore} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(rootStore) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rootStore = rootStore; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentRoute = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._fillRouteSchemaFromUrl(); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'popstate'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentRoute = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._fillRouteSchemaFromUrl(); }); } currentRoute = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; _fillRouteSchemaFromUrl() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pathnameArray = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.pathname.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routeName = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._getRouteNameMatchingUrl(pathnameArray); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!routeName) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentRoute = routes.error404; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.history.pushState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, currentRoute.path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> currentRoute; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> route = routes[routeName]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routePathnameArray = route.path.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> params = {}; routePathnameArray.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pathParam, i</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> urlParam = pathnameArray[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pathParam.indexOf(<span class="hljs-string"><span class="hljs-string">':'</span></span>) === <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> paramName = pathParam.replace(<span class="hljs-string"><span class="hljs-string">':'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); params[paramName] = urlParam; } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, route, { params, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); } _getRouteNameMatchingUrl(pathnameArray) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.findKey(routes, route =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routePathnameArray = route.path.split(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (routePathnameArray.length !== pathnameArray.length) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; routePathnameArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pathParam = routePathnameArray[i]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> urlParam = pathnameArray[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pathParam.indexOf(<span class="hljs-string"><span class="hljs-string">':'</span></span>) !== <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pathParam !== urlParam) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> paramName = pathParam.replace(<span class="hljs-string"><span class="hljs-string">':'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> paramMask = _.get(route.masks, paramName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paramMask &amp;&amp; !paramMask.test(urlParam)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }); } replaceDynamicParams(route, params) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.entries(params).reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pathname, [paramName, value]</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pathname.replace(<span class="hljs-string"><span class="hljs-string">`:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${paramName}</span></span></span><span class="hljs-string">`</span></span>, value); }, route.path); } goTo(route, params) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (route.name === <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentRoute.name) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_.isEqual(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentRoute.params, params)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentRoute.isLoading = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentRoute.params = params; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newPathname = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.replaceDynamicParams(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentRoute, params); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.history.pushState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, newPathname); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newPathname = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.replaceDynamicParams(route, params); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.history.pushState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, newPathname); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentRoute = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._fillRouteSchemaFromUrl(); } }</code> </pre></div></div><br><p>     ‚Äî         <i>routes.js</i>       .          ‚Äî       404. ,       ¬´          ¬ª,     ,      ,   ‚Äî ,        'test-test'. </p><br><p>   <i>currentRoute</i>   ,   <i>params</i> (   URL)  <code>isLoading: true</code> .      React- Router: </p><br><div class="spoiler"> <b class="spoiler_title">src/components/Router.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'hooks'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { routeComponents } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'routeComponents'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRouteComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">route, isLoading</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Component = routeComponents[route.name]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Component) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error( <span class="hljs-string"><span class="hljs-string">`getRouteComponent: component for </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${ route.name }</span></span></span><span class="hljs-string"> is not defined in routeComponents`</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Component</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">isLoading</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{isLoading}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; } function useBeforeEnter() { const store = useStore(); const { currentRoute } = store.router; React.useEffect(() =&gt; { if (currentRoute.isLoading) { const beforeEnter = _.get(currentRoute, 'beforeEnter'); if (_.isFunction(beforeEnter)) { Promise.resolve() .then(() =&gt; beforeEnter(currentRoute, store)) .then(() =&gt; { currentRoute.isLoading = false; }) .catch(error =&gt; console.error(error)); } else { currentRoute.isLoading = false; } } }); return currentRoute.isLoading; } function Router() { const { router: { currentRoute }, } = useStore(); const isLoading = useBeforeEnter(); return getRouteComponent(currentRoute, isLoading); } export const RouterConnected = observer(Router);</span></span></code> </pre></div></div><br><p>    ,        ,     <code>currentRoute == null</code> .    ‚Äî      <code>isLoading === true</code> ,           false   ,    <code>route.beforeEnter</code> ( ).            <code>console.error</code> ,    ,     . </p><br><p>  ,    ‚Äî     ,   .  React-  2 : </p><br><ol><li>    componentWillMount / componentDidMount / useEffect  ,     ,   .        ‚Äî     ,          ¬´¬ª.   ‚Äî       ‚Äî        ; </li><li>    ( )        ,   .  ‚Äî      ‚Äî  ,          .   ‚Äî      /  ‚Äî   real-time   ,     /    . </li></ol><br><p>       ,         ‚Äî      (  ,  ,            ..),         . </p><br><p>        <i>beforeEnter</i> ,  : ¬´ ¬ª,     ( , ,      ),    ‚Äî    (         ‚Äî    500 ;          ;   ,       ;        ..).   ¬´¬ª     ,        MVP   . </p><br><p>        : </p><br><div class="spoiler"> <b class="spoiler_title">src/components/Link.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'hooks'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkRouteParamsWithMasks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">route, params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (route.masks) { <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.entries(route.masks).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[paramName, paramMask]</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> value = _.get(params, paramName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paramMask &amp;&amp; !paramMask.test(value)) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error( <span class="hljs-string"><span class="hljs-string">`checkRouteParamsWithMasks: wrong param for </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${paramName}</span></span></span><span class="hljs-string"> in Link to </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${ route.name }</span></span></span><span class="hljs-string">: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${value}</span></span></span><span class="hljs-string">`</span></span> ); } }); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Link</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = useStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { currentRoute } = store.router; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { route, params, children, onClick, ...otherProps } = props; checkRouteParamsWithMasks(route, params); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filledPath = store.router.replaceDynamicParams(route, params); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{filledPath}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> { e.preventDefault(); if (currentRoute.isLoading) { return false; } store.router.goTo(route, params); if (onClick) { onClick(); } }} {...otherProps} &gt; {children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> LinkConnected = observer(Link);</code> </pre></div></div><br><p>     <i>route</i> ,    <i>params</i> ( )     (        )   <i>href</i>  .  ,           <i>beforeEnter</i> ,    .      ¬´,  ¬ª,       ,           ‚Äî    . </p><br><h3>  Metriken </h3><br><p>  - (  ,   ,   ,   ,    )     .     .                 . </p><br><p>     ‚Äî         ,   ‚Äî  ,       .        : </p><br><div class="spoiler"> <b class="spoiler_title">src/api/utils/metrics.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> metricsArray = []; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sendMetricsCallback = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMetrics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">route, apiRoutes</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">promiseCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ clearTimeout(sendMetricsCallback); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> apiRouteName = _.findKey(apiRoutes, route); metricsArray.push({ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: apiRouteName, <span class="hljs-attr"><span class="hljs-attr">time</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime(), }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data; }; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopMetrics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">route, apiRoutes</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">promiseCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> apiRouteName = _.findKey(apiRoutes, route); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> metricsData = _.find(metricsArray, [<span class="hljs-string"><span class="hljs-string">'id'</span></span>, apiRouteName]); metricsData.time = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getTime() - metricsData.time; clearTimeout(sendMetricsCallback); sendMetricsCallback = setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Metrics sent:'</span></span>, metricsArray); metricsArray = []; }, <span class="hljs-number"><span class="hljs-number">2000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data; }; }</code> </pre></div></div><br><p>     middleware   <i>request</i> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">request</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">route, params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve() .then(startMetrics(route, apiRoutes)) .then(validateRequestParams(route, params)) .then(makeRequestUrl(route, params)) .then(makeRequest) .then(validateResponse(route, params)) .then(stopMetrics(route, apiRoutes)) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { stopMetrics(route, apiRoutes)(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error; }); }</code> </pre><br><p>  ,   ,       2 ,       (    )  .        ‚Äî      ,       ‚Äî          ,     ( )     ,    . </p><br><p>      -   ‚Äî   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>     . </p><br><h3>   </h3><br><p>     end-to-end   ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>    Cypress.       :  ;    ,     ;    Continious Integration. </p><br><p>             javascript    Chai / Sinon ,       .       ,      ,    ‚Äî ./tests,  <i>package.json</i>     ‚Äî <code>"dependencies": { "cypress": "3.2.0" }</code> </p><br><p>            .          Webpack    : </p><br><div class="spoiler"> <b class="spoiler_title">tests/cypress/plugins/index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../../node_modules/@cypress/webpack-preprocessor'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpackConfig = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../../webpack-custom/webpack.config'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">on</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> options = webpack.defaultOptions; options.webpackOptions.module = webpackConfig.module; options.webpackOptions.resolve = webpackConfig.resolve; on(<span class="hljs-string"><span class="hljs-string">'file:preprocessor'</span></span>, webpack(options)); };</code> </pre></div></div><br><p>           .    <i>module</i> (   )  <i>resolve</i> (          ).   ESLint      ( <i>describe</i> , <i>cy</i> )    <i>eslint-plugin-cypress</i> .    ,       : </p><br><div class="spoiler"> <b class="spoiler_title">tests/cypress/integration/mixed.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'Market Listing good scenarios'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'Lots of mixed tests'</span></span>, () =&gt; { cy.visit(<span class="hljs-string"><span class="hljs-string">'/market/usd/bch-usd'</span></span>); cy.location(<span class="hljs-string"><span class="hljs-string">'pathname'</span></span>).should(<span class="hljs-string"><span class="hljs-string">'equal'</span></span>, <span class="hljs-string"><span class="hljs-string">'/market/usd/bch-usd'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    ,       cy.wait('@symbolsList') .its('response.body') .should(data =&gt; { expect(data).to.be.an('array'); }); //    cy.wait('@rates'); cy.wait('@marketsList'); cy.wait('@symbolInfo'); cy.wait('@chartData'); //       cy.get('#marketTab-eth').click(); cy.location('pathname').should('equal', '/market/eth/bch-usd'); cy.wait('@rates'); cy.wait('@marketsList'); //    cy.contains(''); cy.get('#langSwitcher-en').click(); cy.contains('Markets list'); //    cy.get('body').should('have.class', 'light'); cy.get('#themeSwitcher-dark').click(); cy.get('body').should('have.class', 'dark'); }); });</span></span></code> </pre></div></div><br><p>      Cypress    fetch,   ,      : </p><br><div class="spoiler"> <b class="spoiler_title">tests/cypress/support/index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { apiRoutes } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'api'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> polyfill = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; before(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> polyfillUrl = <span class="hljs-string"><span class="hljs-string">'https://unpkg.com/unfetch/dist/unfetch.umd.js'</span></span>; cy.request(polyfillUrl).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { polyfill = response.body; }); }); Cypress.on(<span class="hljs-string"><span class="hljs-string">'window:before:load'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span> =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.fetch; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.eval(polyfill); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.fetch = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.unfetch; }); before(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { cy.server(); cy.route(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${apiRoutes.symbolsList.url}</span></span></span><span class="hljs-string">**`</span></span>).as(<span class="hljs-string"><span class="hljs-string">'symbolsList'</span></span>); cy.route(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${apiRoutes.rates.url}</span></span></span><span class="hljs-string">**`</span></span>).as(<span class="hljs-string"><span class="hljs-string">'rates'</span></span>); cy.route(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${apiRoutes.marketsList.url}</span></span></span><span class="hljs-string">**`</span></span>).as(<span class="hljs-string"><span class="hljs-string">'marketsList'</span></span>); cy.route(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${apiRoutes.symbolInfo.url({ id: </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">'bitcoin-cash'</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> }</span></span></span><span class="hljs-string">)}**`</span></span>).as( <span class="hljs-string"><span class="hljs-string">'symbolInfo'</span></span> ); cy.route(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${apiRoutes.chartData.url}</span></span></span><span class="hljs-string">**`</span></span>).as(<span class="hljs-string"><span class="hljs-string">'chartData'</span></span>); });</code> </pre></div></div><br><p>  ,       . </p><br><h3>  ,  ? </h3><br><p> ,      - .         ,      ,   -    / - / . </p><br><p>    ,    ,          , - ,   -   ,       (real-time ,  serviceWorker,   CI,   ,       ,  -,  ,     ..). </p><br><p>    ( Gzip)  : </p><br><p><img src="https://habrastorage.org/webt/p6/im/fk/p6imfkqh0-lf8zlr2apy_8zjqcm.png"></p><br><p>     React Developer Tools   : </p><br><p><img src="https://habrastorage.org/webt/im/jn/_l/imjn_lzweyq7yijk7ohnlafcpgo.png"></p><br><p>      React Hooks + MobX   ,   Redux. ,          .           ,  ,      ,          .       .   ! </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> </p><br><br><h3> Update 13.07.2019 </h3><br><p>       ,          ,   : </p><br><p> 1.  <i>yarn.lock</i>      ,    <code>yarn install --force</code> ,      <code>"upd": "yarn install &amp;&amp; yarn add file:./eslint-custom &amp;&amp; yarn add file:./webpack-custom"</code> .             ESLint  Webpack. </p><br><p> 2.     webpack-custom/config/configOptimization.js,   ,   </p><br><pre> <code class="javascript hljs">lodash: { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">module</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.context.indexOf(<span class="hljs-string"><span class="hljs-string">'node_modules\\lodash'</span></span>) !== <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>, <span class="hljs-attr"><span class="hljs-attr">chunks</span></span>: <span class="hljs-string"><span class="hljs-string">'all'</span></span>, <span class="hljs-attr"><span class="hljs-attr">enforce</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }</code> </pre><br><p>   </p><br><pre> <code class="javascript hljs">lodash: { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/node_modules[\\/]lodash/</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>, <span class="hljs-attr"><span class="hljs-attr">chunks</span></span>: <span class="hljs-string"><span class="hljs-string">'all'</span></span>, <span class="hljs-attr"><span class="hljs-attr">enforce</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, }</code> </pre><br><p> 3.          <code>useLocalization(__filename, messages)</code> ,  ‚Äî      </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messages = { <span class="hljs-attr"><span class="hljs-attr">hello</span></span>: { <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'  {count} {count: ,,}'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"src/components/TestLocalization/TestLocalization.hello"</span></span>, } };</code> </pre><br><p> ,    </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messagesDefault = { <span class="hljs-attr"><span class="hljs-attr">hello</span></span>: <span class="hljs-string"><span class="hljs-string">'  {count} {count: ,,}'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messages = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(messagesDefault).reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">acc, key</span></span></span><span class="hljs-function">) =&gt;</span></span> { acc[key] = { <span class="hljs-attr"><span class="hljs-attr">value</span></span>: messagesDefault[key], <span class="hljs-attr"><span class="hljs-attr">name</span></span>: __dirname.toLowerCase().replace(<span class="hljs-regexp"><span class="hljs-regexp">/\\\\/g</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>) + <span class="hljs-string"><span class="hljs-string">'.'</span></span> + key, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> acc; }, {});</code> </pre><br><p>     IDE      ,       Webpack: </p><br><div class="spoiler"> <b class="spoiler_title">webpack-custom/utils/messagesLoader.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">messagesLoader</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (source.indexOf(<span class="hljs-string"><span class="hljs-string">'export const messages = messagesDefault;'</span></span>) !== <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source.replace( <span class="hljs-string"><span class="hljs-string">'export const messages = messagesDefault;'</span></span>, <span class="hljs-string"><span class="hljs-string">` export const messages = Object.keys(messagesDefault).reduce((acc, key) =&gt; { acc[key] = { value: messagesDefault[key], name: __dirname.toLowerCase().replace(/\\\\/g, '/') + '.' + key, }; return acc; }, {}); `</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source; };</code> </pre></div></div><br><p> ,  <i>messages.js</i>   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messagesDefault = { <span class="hljs-attr"><span class="hljs-attr">someText</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messages = messagesDefault;</code> </pre><br><p>          ,   <i>app.js</i> ,      <i>messages.js</i>  ,      <i>*.json</i>  : </p><br><div class="spoiler"> <b class="spoiler_title">src/utils/checkLocalization.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'localization/ru.json'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> showNoTextMessage = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkLocalization</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> context = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.context(<span class="hljs-string"><span class="hljs-string">'../'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, /messages\.js/); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messagesFiles = context.keys(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> notLocalizedObject = {}; messagesFiles.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fileExports = context(path); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { messages } = fileExports; _.values(messages).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ name, value }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ru[name] == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { notLocalizedObject[name] = value; } }); }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (showNoTextMessage &amp;&amp; _.size(notLocalizedObject) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( <span class="hljs-string"><span class="hljs-string">'No localization for lang ru:'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(notLocalizedObject, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) ); } }</code> </pre></div></div><br><p>  ,      </p><br><pre> <code class="plaintext hljs">No localization for lang ru: { "src/components/TestLocalization/TestLocalization.hello": "  {count} {count: ,,}" }</code> </pre><br><p>       <i>*.json</i>  ‚Äî ,           ,     . </p><br><p> 3.       Lodash  <code>someResponseParam: _.isString</code>   ,             .       : </p><br><div class="spoiler"> <b class="spoiler_title">src/utils/validateObjects.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createError } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./createError'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { errorsNames } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'const'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> validators = { isArray(v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isArray(v); }, isString(v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isString(v); }, isNumber(v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isNumber(v); }, isBoolean(v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isBoolean(v); }, isPlainObject(v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isPlainObject(v); }, isArrayNotRequired(v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isArray(v) || _.isNil(v); }, isStringNotRequired(v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isString(v) || _.isNil(v); }, isNumberNotRequired(v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isNumber(v) || _.isNil(v); }, isBooleanNotRequired(v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isBoolean(v) || _.isNil(v); }, isPlainObjectNotRequired(v) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _.isPlainObject(v) || _.isNil(v); }, omitParam() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }, }; validators.isArray.notRequired = validators.isArrayNotRequired; validators.isString.notRequired = validators.isStringNotRequired; validators.isNumber.notRequired = validators.isNumberNotRequired; validators.isBoolean.notRequired = validators.isBooleanNotRequired; validators.isPlainObject.notRequired = validators.isPlainObjectNotRequired; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateObjects</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> { validatorsObject, targetObject, prefix }, otherArg </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_.isPlainObject(validatorsObject)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">`validateObjects: validatorsObject is not an object`</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_.isPlainObject(targetObject)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">`validateObjects: targetObject is not an object`</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.entries(validatorsObject).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[paramName, validator]</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> paramValue = targetObject[paramName]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!validator(paramValue, otherArg)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> validatorName = _.findKey(validators, v =&gt; v === validator); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> createError( errorsNames.VALIDATION, <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix || </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">''</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${paramName}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${ _.isString(validatorName) ? </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">` [</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${validatorName}</span></span></span></span></span><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">]`</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> : </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">''</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> }</span></span></span><span class="hljs-string">`</span></span> ); } }); }</code> </pre></div></div><br><p>           ‚Äî , <code>     someResponseParam [isString]</code> ,   ,    .    <code>someResponseParam: validators.isString.notRequired</code> ,    .          ,         ,      <code>someResponseArray: arrayShape({ someParam: isString })</code> ,       . </p><br><p> 5. ,   ,   .   ‚Äî      (  <code>body</code>  <code>isEntering</code> , <code>isLeaving</code>   )          beforeLeave ( Prompt  <i>react-router</i> ),           false-  ,  </p><br><pre> <code class="javascript hljs">somePage: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/some-page'</span></span>, beforeLeave(store) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.modals.raiseConfirm(<span class="hljs-string"><span class="hljs-string">'    ?'</span></span>); }, }</code> </pre><br><p>     ,               - . ,       : </p><br><p> ‚Äî    <code>/some/long/auth/path</code>  beforeEnter    <code>/auth</code> <br> ‚Äî beforeEnter  <code>/auth</code>  ,     ‚Äî    <code>/profile</code> <br> ‚Äî beforeEnter  <code>/profile</code>    ,   ,      ,   <code>/profile/edit</code> </p><br><p>      ,          ‚Äî    <code>window.history.pushState</code>  <code>location.replace</code> .      ,           .    ¬´    ¬ª     ¬´    componentDidMount ¬ª,         ,          . </p><br><p> 6.           (,   )    : </p><br><div class="spoiler"> <b class="spoiler_title">src/utils/withState.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">target, fnName, fnDescriptor</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> original = fnDescriptor.value; fnDescriptor.value = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnWithState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...args</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.executions[fnName]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve() .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.executions[fnName] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> original.apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, args)) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.executions[fnName] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data; }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.executions[fnName] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error; }); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fnDescriptor; }</code> </pre></div></div><br><div class="spoiler"> <b class="spoiler_title">src/stores/CurrentTPStore.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { makeObservable, withState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { apiRoutes, request } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'api'</span></span>; @makeObservable <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CurrentTPStore</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * @param rootStore {RootStore} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(rootStore) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rootStore = rootStore; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.executions = {}; } @withState fetchSymbol() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request(apiRoutes.symbolInfo) .then(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetchSymbolSuccess) .catch(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetchSymbolError); } fetchSymbolSuccess(data) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve(); } fetchSymbolError(error) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(error); } }</code> </pre></div></div><br><div class="spoiler"> <b class="spoiler_title">src/components/TestComponent.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useStore } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'hooks'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestComponent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = useStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">currentTP</span></span>: { executions } } = store; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{executions.fetchSymbol ? '...' : ''}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TestComponentConnected = observer(TestComponent);</code> </pre></div></div><br><p>         ,   . </p><br><p>        ,    ,        .        ‚Äî      ,     ,  , ,    - . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450360/">https://habr.com/ru/post/de450360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450344/index.html">Ein Beitrag mit wei√üer Flagge oder Wie ich Ihren Videokurs vor dem Erscheinen auf dem Tracker gespeichert habe</a></li>
<li><a href="../de450346/index.html">Newtons Cottage Cradle</a></li>
<li><a href="../de450350/index.html">Die d√ºnne rote Linie meines Projekts</a></li>
<li><a href="../de450354/index.html">Angek√ºndigte Windows Vision-F√§higkeiten (Vorschau)</a></li>
<li><a href="../de450358/index.html">Verbesserungen des Visual Studio App Center-Verteilungsdienstes</a></li>
<li><a href="../de450362/index.html">Z√§hlen Sie die Agenten "Pr√ºfer"</a></li>
<li><a href="../de450368/index.html">Erhalten Sie absolute Kurse aus gepaarten Wechselkursen</a></li>
<li><a href="../de450372/index.html">Wie Amazon-Algorithmen bestimmen, wer es ist, zu verwerfen</a></li>
<li><a href="../de450374/index.html">RAM-Erweiterungskarte f√ºr Apple IIgs</a></li>
<li><a href="../de450376/index.html">Wie Yandex.Taxi nach Autos sucht, wenn sie es nicht sind</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>