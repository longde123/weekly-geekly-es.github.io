<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйтАНЁЯОд ЁЯСйЁЯП╛тАНЁЯТ╝ ЁЯЧГя╕П рдореБрдЭреЗ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░реЗрдВред рдпрджрд┐ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ ... тмЬя╕П ЁЯТкЁЯП╝ ЁЯНн</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдореИрдВ рдЕрдХреНрд╕рд░ рд╕рд╡рд╛рд▓ рд╕реБрдирддрд╛ рд╣реВрдВ рдХрд┐ "рдПрдВрдбреНрд░реЙрдЗрдб рдРрдк рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВ?", "рдЬрд╣рд╛рдВ рдПрдХ рдкрд┐рди рд╕реНрдЯреЛрд░ рдХрд░рдирд╛ рд╣реИ?", "рдЕрд░реЗ рдпрд╛рд░, рдХреНрдпрд╛ рдореИрдВ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рд╣реВрдВрдЧрд╛ рдЕрдЧрд░ рдореИрдВ рдЗрд╕ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдореБрдЭреЗ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░реЗрдВред рдпрджрд┐ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ ...</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redmadrobot/blog/475112/"><p><img src="https://habrastorage.org/webt/p9/kd/qs/p9kdqsyke71dvzl72vxr24da0yc.jpeg"></p><br><p>  рдореИрдВ рдЕрдХреНрд╕рд░ рд╕рд╡рд╛рд▓ рд╕реБрдирддрд╛ рд╣реВрдВ рдХрд┐ "рдПрдВрдбреНрд░реЙрдЗрдб рдРрдк рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд░реЗрдВ?", "рдЬрд╣рд╛рдВ рдПрдХ рдкрд┐рди рд╕реНрдЯреЛрд░ рдХрд░рдирд╛ рд╣реИ?", "рдЕрд░реЗ рдпрд╛рд░, рдХреНрдпрд╛ рдореИрдВ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рд╣реВрдВрдЧрд╛ рдЕрдЧрд░ рдореИрдВ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реБрд╡рд┐рдзрд╛ рд▓рд╛рдЧреВ рдХрд░реВрдВ?"  рдФрд░ рдмрд╣реБрдд рддрд░рд╣ рдХрд╛ред  рдореИрдВ рдЗрди рд╕рд╡рд╛рд▓реЛрдВ рдХрд╛ рдЬрд╡рд╛рдм рджреЗрддреЗ рд╣реБрдП рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдердХ рдЧрдпрд╛ рдерд╛ рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рд╕рднреА рдкреНрд░рд╢реНрдирдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рд╕рднреА рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЛ рдПрдХ рдмрд╛рд░ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ред </p><a name="habracut"></a><br><h1 id="table-of-contents">  рд╕рд╛рдордЧреНрд░реА рдХреА рддрд╛рд▓рд┐рдХрд╛ </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рдорд╛рдгреАрдХрд░рдг: рдореБрдЭреЗ рдпрд╣ рдХреНрдпреЛрдВ рдХрд░рдирд╛ рд╣реИ?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд░рд▓ рддрд░реАрдХрд╛ рд╣реИ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЪрд▓реЛ рдЗрд╕реЗ рдмреЗрд╣рддрд░ рдмрдирд╛рддреЗ рд╣реИрдВ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд╣реА рддрд░реАрдХрд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓реЗрдХрд┐рди рд░реБрдХреЛ, рдмрд╛рдпреЛрдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреНрдпрд╛ рдореИрдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реВрдВ?</a> </li></ul><br><a name="why-do-I-have-to-do-it"></a><br><h1 id="authentication-why-do-i-have-to-do-it">  рдкреНрд░рдорд╛рдгреАрдХрд░рдг: рдореБрдЭреЗ рдпрд╣ рдХреНрдпреЛрдВ рдХрд░рдирд╛ рд╣реИ? </h1><br><p>  рдЪрд▓рд┐рдП рдкрд░рд┐рднрд╛рд╖рд╛ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  <strong>рдкреНрд░рдорд╛рдгреАрдХрд░рдг</strong> (рдЧреНрд░реАрдХ рд╕реЗ: ╬▒с╜Р╬╕╬╡╬╜ication╬╣ik рдкреНрд░рдорд╛рдгрд┐рдХреЛрд╕, "рд╡рд╛рд╕реНрддрд╡рд┐рдХ, рд╡рд╛рд╕реНрддрд╡рд┐рдХ", ╬▒es╬╜ "рдкреНрд░рд╛рдорд╛рдгрд┐рдХрддрд╛ рд╕реЗ," рд▓реЗрдЦрдХ ") рдПрдХ рдЬреЛрд░ рд╕рд╛рдмрд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд░рд┐рдпрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рдХрдВрдкреНрдпреВрдЯрд░ рд╕рд┐рд╕реНрдЯрдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣рдЪрд╛рдиред </p><br><p>  рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЗ рдЖрд╡реЗрджрди рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╣реИ (рдХрд┐рд╕реА рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрд╡реЗрджрдирд╢реАрд▓ IMHO рд╣реИ) рддреЛ рдЖрдкрдХреЛ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдЕрдирдзрд┐рдХреГрдд рдЙрдкрдпреЛрдЧ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдРрдк рдореЗрдВ рдПрдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкрд░рд┐рджреГрд╢реНрдп рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред </p><br><p>  рд╕рдмрд╕реЗ рд▓реЛрдХрдкреНрд░рд┐рдп рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкрд░рд┐рджреГрд╢реНрдп рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИрдВ: </p><br><ul><li>  рд▓реЙрдЧрд┐рди + рдкрд╛рд╕рд╡рд░реНрдб </li><li>  рдорд╛рд╕реНрдЯрд░ рдкрд╛рд╕рд╡рд░реНрдб </li><li>  рдкрд┐рди (4 рдпрд╛ рдЕрдзрд┐рдХ рдЕрдВрдХ) </li><li>  рдмреЙрдпреЛрдореЗрдЯреНрд░рд┐рдХреНрд╕ </li></ul><br><p>  рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ, <strong>рд▓реЙрдЧрд┐рди рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб</strong> рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдПрдХ рдмреИрдХ-рдПрдВрдб рд╕реЗ рдЖрдкрдХреЗ рдЖрд╡реЗрджрди рдкрд░ рдЖрддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рддрдВрддреНрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рд╣рдо рдмреИрдХ-рдПрдВрдб рд╕реБрд░рдХреНрд╖рд╛ рдЖрд╢реНрд╡рд╛рд╕рди рдЯреАрдо рдХреЛ рдЫреЛрдбрд╝ рджреЗрдВрдЧреЗ;) рдмрд╕ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдкрд┐рдирд┐рдВрдЧ</a> рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордд рднреВрд▓рдирд╛ред </p><br><p>  <strong>рдорд╛рд╕реНрдЯрд░ рдкрд╛рд╕рд╡рд░реНрдб</strong> рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рд╢рд╛рдпрдж рд╣реА рдХрднреА рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдХреЗрд╡рд▓ рдЙрди рдРрдкреНрд╕ рдореЗрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЙрдЪреНрдЪ рд╕реНрддрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ (рдЬреИрд╕реЗ рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдмрдВрдзрдХ)ред </p><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреЗрд╡рд▓ рджреЛ рд╕рдмрд╕реЗ рд▓реЛрдХрдкреНрд░рд┐рдп рдкрд░рд┐рджреГрд╢реНрдп рд╣реИрдВ: рдПрдХ <strong>рдкрд┐рди</strong> рдФрд░ <strong>рдмрд╛рдпреЛрдореЗрдЯреНрд░рд┐рдХреНрд╕</strong> ред  рд╡реЗ рдХрд╛рдлреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдЕрдиреБрдХреВрд▓ рд╣реИрдВ рдФрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдЖрд╕рд╛рди рд╣реИрдВ (рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╡реЗ рдирд╣реАрдВ рд╣реИрдВ ...)ред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд╣рдо рдЗрди рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рд╕рд╣реА рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рдореБрдЦреНрдп рдкрд╣рд▓реБрдУрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВрдЧреЗред </p><br><a name="simple-way"></a><br><h1 id="simple-way">  рд╕рд░рд▓ рддрд░реАрдХрд╛ рд╣реИ </h1><br><p>  рдЬрд░рд╛ рд╕реЛрдЪрд┐рдП, рдЖрдк рдПрдХ Android рдбреЗрд╡рд▓рдкрд░ рд╣реИрдВ рдФрд░ рдЖрдкрдХрд╛ рдХреЛрдб рдЖрдкрдХреЗ рдкреИрд╕реЗ рдЫрд╛рдкрддрд╛ рд╣реИред  рдЖрдк рдХрд┐рд╕реА рднреА рдЪреАрдЬ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдЖрдкрдХреЛ рдЧрдВрднреАрд░ рдореЛрдмрд╛рдЗрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛ рдореЗрдВ рдмрд╣реБрдд рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рд▓реЗрдХрд┐рди рдПрдХ рджрд┐рди, рдПрдХ рдкреНрд░рдмрдВрдзрдХ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЖрддрд╛ рд╣реИ рдФрд░ "рд╣рдорд╛рд░реЗ рдЖрд╡реЗрджрди рдореЗрдВ рдПрдХ рдкрд┐рди рдФрд░ рдПрдХ рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ" рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╛рд░реНрдп рджреЗрддрд╛ рд╣реИред  рдХрд╣рд╛рдиреА рдпрд╣рд╛рдБ рд╕реЗ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИ ... </p><br><p>  рдкрд┐рди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдХреБрдЫ рд╕реНрдХреНрд░реАрди рдЗрд╕ рддрд░рд╣ рдмрдирд╛рдПрдВрдЧреЗ: <br><img src="https://habrastorage.org/webt/7i/fe/0u/7ife0uw4kwm-yybqkot0pkvwue8.png"><img src="https://habrastorage.org/webt/mp/bl/ou/mpblouhttk5kpu9u5haezm6659i.png"></p><br><p>  рдФрд░ рдЕрдкрдирд╛ рдкрд┐рди рдмрдирд╛рдиреЗ рдФрд░ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдРрд╕рд╛ рдХреЛрдб рд▓рд┐рдЦреЗрдВ </p><br><pre><code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">savePin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { preferences.edit().putString(StorageKey.PIN, pin).apply() }</code> </pre> <br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authenticate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { authenticationState.value = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pinIsValid(pin)) { AuthenticationState.AUTHENTICATED } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AuthenticationState.INVALID_AUTHENTICATION } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinIsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> preferences.getString(StorageKey.PIN, <span class="hljs-literal"><span class="hljs-literal">null</span></span>) == pin }</code> </pre> <br><p>  рдмрд╕ рдЗрддрдирд╛ рд╣реА!  рдЕрдм, рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рдкрд┐рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд╢рд╛рдВрдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдкреНрд░рдгрд╛рд▓реА рд╣реИред  рдмрдзрд╛рдИ рд╣реЛред  рдпрд╣ рдмрд╣реБрдд рдЖрд╕рд╛рди рдерд╛, рд╣реИ рдирд╛? </p><br><p>  рдмреЗрд╢рдХ, рдЖрдкрдиреЗ рдкрд╣рд▓реЗ рд╣реА рдореЗрд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ рд╡рд┐рдбрдВрдмрдирд╛ рдХреЛ рдкрдХрдбрд╝ рд▓рд┐рдпрд╛ рд╣реИред  рдпрд╣ рддрд░реАрдХрд╛ рдмрд╣реБрдд рдмреБрд░рд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдПрдХ рдкрд┐рди рдХреЛ рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЕрдЧрд░ рдорд╛рд▓рд╡реЗрдпрд░ рдХрд┐рд╕реА рддрд░рд╣ рд╕реЗ рдЗрдВрдЯрд░рдирд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реНрдЯреЛрд░реЗрдЬ рддрдХ рдкрд╣реБрдВрдЪ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдпреВрдЬрд░ рдкрд┐рди рдорд┐рд▓реЗрдЧрд╛ред  рдЖрдк рдореБрдЭрд╕реЗ рдкреВрдЫ рд╕рдХрддреЗ рд╣реИрдВ "рдпрд╣ рдЗрддрдирд╛ рдмреБрд░рд╛ рдХреНрдпреЛрдВ рд╣реИ? рдпрд╣ рд╕реНрдерд╛рдиреАрдп рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕реЗ рд╕рд┐рд░реНрдл рдПрдХ рдкрд┐рди рд╣реИ ..."ред  рд╣рд╛рдБ, рд▓реЗрдХрд┐рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣рд░ рдЬрдЧрд╣ рдПрдХ рд╣реА рдкрд┐рди рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд┐рди рдХрд╛ рдЬреНрдЮрд╛рди рдПрдХ рдШреБрд╕рдкреИрдард┐рдпрд╛ рдХреЛ рд╣рдорд▓реЗ рдХреА рд╕рддрд╣ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред </p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдРрд╕реА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдпреЛрдЬрдирд╛ рдЖрдкрдХреЛ рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рддрд░реАрдХреЗ рд╕реЗ рдкрд┐рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддреА рд╣реИ (рд╣рдо рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдж рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗ)ред </p><br><a name="lets-make-it-better"></a><br><h1 id="lets-make-it-better">  рдЪрд▓реЛ рдЗрд╕реЗ рдмреЗрд╣рддрд░ рдмрдирд╛рддреЗ рд╣реИрдВ </h1><br><p>  рд╣рдо рдЕрдкрдиреЗ рдкрд┐рдЫрд▓реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ рдХреИрд╕реЗ рд╕реБрдзрд╛рд░ рд╕рдХрддреЗ рд╣реИрдВ?  рдкрд╣рд▓рд╛ рдФрд░ рд╕реНрдкрд╖реНрдЯ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЖрдкрдХреЗ рдкрд┐рди рд╕реЗ рдПрдХ рд╣реИрд╢ рд▓реЗ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЗрд╕ рд╣реИрд╢ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░ рд░рд╣рд╛ рд╣реИред </p><br><blockquote>  <strong>рд╣реИрд╢ рдлрд╝рдВрдХреНрд╢рди</strong> рдХреЛрдИ рднреА рдлрд╝рдВрдХреНрд╢рди рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд┐рд╢реНрдЪрд┐рдд рдЖрдХрд╛рд░ рдХреЗ рдорд╛рдиреЛрдВ рдХреЗ рдордирдорд╛рдиреЗ рдЖрдХрд╛рд░ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдореИрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд╣реИрд╢ рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рд▓реМрдЯрд╛рдП рдЧрдП рдорд╛рдиреЛрдВ рдХреЛ рд╣реИрд╢ рдорд╛рди, рд╣реИрд╢ рдХреЛрдб, рдбрд╛рдЗрдЬреЗрд╕реНрдЯ рдпрд╛ рдмрд╕ рд╣реИрд╢ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реИрд╢ рддрд╛рд▓рд┐рдХрд╛ рдирд╛рдордХ рдирд┐рд╢реНрдЪрд┐рдд рдЖрдХрд╛рд░ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдЕрдиреБрдХреНрд░рдорд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╣реИрд╢ рдЯреЗрдмрд▓ рдХреЛ рдЗрдВрдбреЗрдХреНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрд╢ рдлрдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реИрд╢рд┐рдВрдЧ рдпрд╛ рд╕реНрдХреИрдЯрд░ рд╕реНрдЯреЛрд░реЗрдЬ рдПрдбреНрд░реЗрд╕рд┐рдВрдЧ рдХрд╣рд▓рд╛рддрд╛ рд╣реИред </blockquote><p>  рдПрдВрдбреНрд░реЙрдЗрдб рдлреНрд░реЗрдорд╡рд░реНрдХ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬрд╛рд╡рд╛ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдореЗрдВ</a> , рд╕рдЯреАрдХ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП) рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдЙрдкрд▓рдмреНрдз рд╣реИрд╢ рдлрд╝рдВрдХреНрд╢рди рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдЬ рдЙрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рдореИрдВ рдЯрдХрд░рд╛рд╡ рдХреЗ рдХрд╛рд░рдг <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">MD5</a> рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">SHA-1</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рдирд╣реАрдВ рджреЗрддрд╛ред  SHA-256 рдЕрдзрд┐рдХрд╛рдВрд╢ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдЪреНрдЫрд╛ рд╡рд┐рдХрд▓реНрдк рд╣реИред </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sha256</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byteArray: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ByteArray</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ByteArray { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> digest = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { MessageDigest.getInstance(<span class="hljs-string"><span class="hljs-string">"SHA-256"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: NoSuchAlgorithmException) { MessageDigest.getInstance(<span class="hljs-string"><span class="hljs-string">"SHA"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> with(digest) { update(byteArray) digest() } }</code> </pre> <br><p>  рд╣реИрд╢ рдкрд┐рди рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реА <code>savePin(...)</code> рд╡рд┐рдзрд┐ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">savePin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hashedPin = sha256(pin.toByteArray()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encodedHash = Base64.encodeToString(hashedPin, Base64.DEFAULT) preferences.edit().putString(StorageKey.PIN, encodedHash).apply() }</code> </pre> <br><p>  рд╣реИрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдПрдХ рдЕрдЪреНрдЫреА рд╢реБрд░реБрдЖрдд рд╣реИ, рд▓реЗрдХрд┐рди рдирдВрдЧреЗ рд╣реИрд╢ рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИред  рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬреАрд╡рди рдореЗрдВ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рднреА 4-рдЕрдВрдХреАрдп рдкрд┐рди рд╣реИрд╢ рдХреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧрдгрдирд╛</a> рдХрд░ рдЪреБрдХрд╛ рд╣реИред  рд╡рд╣ рдЙрди рд╕рднреА рдЪреЛрд░реА рдХрд┐рдП рдЧрдП рд╣реИрд╢рдб рдкрд┐рди рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд╕рдХреЗрдЧрд╛ред  рдЗрд╕рд╕реЗ рдирд┐рдкрдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИ - рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирдордХ</a> ред </p><br><blockquote>  рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдореЗрдВ, рдПрдХ <strong>рдирдордХ</strong> рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдбреЗрдЯрд╛ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдПрдХ рддрд░рд╣ рдХреЗ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ "рд╣реИрд╢" рдбреЗрдЯрд╛, рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рдпрд╛ рдкрд╛рд╕рдлрд╝реНрд░реЗрдЬрд╝ред  рднрдВрдбрд╛рд░рдг рдореЗрдВ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд▓рд╛рдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рд░реВрдк рд╕реЗ рдПрдХ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рд╕рдордп рдХреЗ рд╕рд╛рде рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕рд╡рд░реНрдб рдХреЛ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдкрдврд╝реЗ рдЬрд╛рдиреЗ рд╕реЗ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ред  рдПрдХ рдирдордХ рдЙрди рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред </blockquote><p>  рдЕрдкрдиреЗ рд╕реБрд░рдХреНрд╖рд╛ рддрдВрддреНрд░ рдореЗрдВ рдирдордХ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдКрдкрд░ рджрд┐рдЦрд╛рдП рдЧрдП рдХреЛрдб рдХреЛ рдЗрд╕ рддрд░рд╣ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lengthByte: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">32</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ByteArray { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> random = SecureRandom() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> salt = ByteArray(lengthByte) random.nextBytes(salt) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> salt }</code> </pre> <br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">savePin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> salt = Salt.generate() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> saltedPin = pin.toByteArray() + salt <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hashedPin = Sha256.hash(saltedPin) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encodedHash = Base64.encodeToString(hashedPin, Base64.DEFAULT) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encodedSalt = Base64.encodeToString(salt, Base64.DEFAULT) preferences.edit() .putString(StorageKey.PIN, encodedHash) .putString(StorageKey.SALT, encodedSalt) .apply() }</code> </pre> <br><p>  рдзреНрдпрд╛рди рджреЗрдВ, рдЖрдкрдХреЛ рдирдордХ рдХреЛ рдПрдХ рд╕рд╛рде рдкрд┐рди рдХреЗ рд╕рд╛рде рд╕реНрдЯреЛрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рд╕реЗ рдкрд┐рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рддреЗ рд╕рдордп рд╣рд░ рдмрд╛рд░ рдкрд░рд┐рдгрд╛рдо рд╣реИрд╢ (рдирдордХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinIsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encodedSalt = preferences.getString(StorageKey.SALT, <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encodedHashedPin = preferences.getString(StorageKey.PIN, <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> salt = Base64.decode(encodedSalt, Base64.DEFAULT) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> storedHashedPin = Base64.decode(encodedHashedPin, Base64.DEFAULT) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enteredHashedPin = Sha256.hash(pin.toByteArray() + salt) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> storedHashedPin contentEquals enteredHashedPin }</code> </pre> <br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдХреЛрдб рдЕрднреА рднреА рд╕рдордЭрдиреЗ рдореЗрдВ рдЗрддрдирд╛ рдХрдард┐рди рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рд╕рдорд╛рдзрд╛рди рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдмрд╣реБрдд рдордЬрдмреВрдд рд╣реЛ рдЧрдИ рд╣реИред  рдореИрдВ рдФрд░ рднреА рдЕрдзрд┐рдХ рдХрд╣реВрдВрдЧрд╛, рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЕрдзрд┐рдХрд╛рдВрд╢ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рдЙрддреНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЙрдЪреНрдЪ рд╕реНрддрд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред </p><br><p>  "рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рдореБрдЭреЗ рдФрд░ рдЕрдзрд┐рдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдорд╛рдзрд╛рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ?", рдЖрдк рдкреВрдЫрддреЗ рд╣реИрдВред  рдареАрдХ рд╣реИ, рдореЗрд░реЗ рдкреАрдЫреЗ рдЖрдУред </p><br><a name="the-right-way"></a><br><h1 id="the-right-way">  рд╕рд╣реА рддрд░реАрдХрд╛ </h1><br><p>  рдЖрдЗрдП рд╣рдорд╛рд░реЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд▓рд┐рдП рдХрдИ рд╕реБрдзрд╛рд░ рдмрд┐рдВрджреБрдУрдВ рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВред </p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, "рд╕рд╛рдзрд╛рд░рдг рд╣реИрд╢" (рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ "рдирдордХреАрди рд╕рд╛рдзрд╛рд░рдг рд╣реИрд╢") рдХрд╛ рдореБрдЦреНрдп рджреЛрд╖ рдПрдХ рдХреНрд░реВрд░ рдмрд▓ рд╣рдорд▓реЗ (рд▓рдЧрднрдЧ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рддрд┐ рдорд┐рдирдЯ рдЕрд░рдмреЛрдВ рд╣реИрд╢</a> ) рдХреА рдЕрдкреЗрдХреНрд╖рд╛рдХреГрдд рдЙрдЪреНрдЪ рдЧрддрд┐ рд╣реИред  рдЗрд╕ рджреЛрд╖ рдХреЛ рд╕рдорд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">PBKDF2</a> рдЬреИрд╕реЗ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдХреЗрдбреАрдПрдл-рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд┐рд▓рд╛ рд╣реИ рдЬреЛ рдореВрд▓ рд░реВрдк рд╕реЗ рдПрдВрдбреНрд░реЙрдЗрдб рдлреНрд░реЗрдорд╡рд░реНрдХ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рд╣реИред  рдмреЗрд╢рдХ, рдХреЗрдбреАрдПрдл рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдмреАрдЪ рдХреБрдЫ рдЕрдВрддрд░ рд╣реИ рдФрд░ рдЖрдк рд╢рд╛рдпрдж рджреВрд╕рд░реЗ рдХреЛ рдЪреБрдирдирд╛ рдЪрд╛рд╣реЗрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдпрд╣ рдЗрд╕ рд▓реЗрдЦ рдХреЗ рджрд╛рдпрд░реЗ рд╕реЗ рдмрд╛рд╣рд░ рд╣реИред  рдореИрдВ рдЖрдкрдХреЛ рд▓реЗрдЦ рдХреЗ рдЕрдВрдд рдореЗрдВ рдЗрд╕ рд╡рд┐рд╖рдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХрдИ рдЙрдкрдпреЛрдЧреА рд▓рд┐рдВрдХ рджреВрдВрдЧрд╛ред </p><br><p>  рджреВрд╕рд░реЗ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░ рдХреЛрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдирд╣реАрдВ рд╣реИред  рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЗ рд╣реИрдВ рдФрд░ рдореИрдВ рд╕рдмрд╕реЗ рд╕рд░рд▓ рдФрд░ рд╕рдмрд╕реЗ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдПрдХ рджрд┐рдЦрд╛рдКрдВрдЧрд╛ред  рдпрд╣ рджреЛ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдФрд░ рдЙрдирдХреЗ рдЖрд╕рдкрд╛рд╕ рдХреБрдЫ рдХреЛрдб рдХрд╛ рдПрдХ рд╕реЗрдЯ рд╣реЛрдЧрд╛ред </p><br><p>  рдЪрд▓реЛ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ PBKDF2 рдХреБрдВрдЬреА рдмрдирд╛рдиреЗ рдХрд╛ рдХрд╛рд░рдЦрд╛рдирд╛ рд▓рд┐рдЦрддреЗ рд╣реИрдВред </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Pbkdf2Factory { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DEFAULT_ITERATIONS = <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DEFAULT_KEY_LENGTH = <span class="hljs-number"><span class="hljs-number">256</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> secretKeyFactory <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.O) { SecretKeyFactory.getInstance(<span class="hljs-string"><span class="hljs-string">"PBKDF2withHmacSHA1"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SecretKeyFactory.getInstance(<span class="hljs-string"><span class="hljs-string">"PBKDF2withHmacSHA256"</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( passphraseOrPin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CharArray</span></span></span></span><span class="hljs-function"><span class="hljs-params">, salt: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ByteArray</span></span></span></span><span class="hljs-function"><span class="hljs-params">, iterations: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = DEFAULT_ITERATIONS, outputKeyLength: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = DEFAULT_KEY_LENGTH )</span></span></span></span>: SecretKey { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> keySpec = PBEKeySpec(passphraseOrPin, salt, iterations, outputKeyLength) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> secretKeyFactory.generateSecret(keySpec) } }</code> </pre> <br><p>  рдЕрдм рдЗрд╕ рдлреИрдХреНрдЯреНрд░реА рд╕реЗ рд▓реИрд╕ рд╣реЛрдХрд░ рд╣рдордиреЗ рдЕрдкрдиреЗ <code>savePin()</code> рдФрд░ <code>pinIsValid()</code> рддрд░реАрдХреЛрдВ рдХреЛ <code>pinIsValid()</code> </p><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">savePin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> salt = Salt.generate() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> secretKey = Pbkdf2Factory.createKey(pin.toCharArray(), salt) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encodedKey = Base64.encodeToString(secretKey.encoded, Base64.DEFAULT) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encodedSalt = Base64.encodeToString(salt, Base64.DEFAULT) preferences.edit() .putString(StorageKey.KEY, encodedKey) .putString(StorageKey.SALT, encodedSalt) .apply() pinIsCreated.value = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinIsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encodedSalt = preferences.getString(StorageKey.SALT, <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encodedKey = preferences.getString(StorageKey.KEY, <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> salt = Base64.decode(encodedSalt, Base64.DEFAULT) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> storedKey = Base64.decode(encodedKey, Base64.DEFAULT) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enteredKey = Pbkdf2Factory.createKey(pin.toCharArray(), salt) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> storedKey contentEquals enteredKey.encoded }</code> </pre> <br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдордиреЗ рдЕрдкрдиреЗ рдкрд┐рдЫрд▓реЗ рд╕рдорд╛рдзрд╛рди рдХреЗ рдореБрдЦреНрдп рджреЛрд╖ рдХреЛ рдХрдо рдХрд░ рджрд┐рдпрд╛ рд╣реИред  рдпрд╣ рдЕрдЪреНрдЫрд╛ рд╣реИ, рдФрд░ рдЕрдм рд╣рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдЗрди рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рд▓реЗрдВрдЧреЗ: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯрд┐рдВрдХ</a> - рдПрдХ рдмрд╣реБ-рднрд╛рд╖рд╛, рдХреНрд░реЙрд╕-рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЬреЛ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд╝рд┐рдХ рдПрдкреАрдЖрдИ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИ рдЬреЛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реБрд░рдХреНрд╖рд┐рдд, рдЖрд╕рд╛рди рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рд╣рд╛рд░реНрдб (рдПрд░) рд╣реИред </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Jetpack Security</a> - рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкреНрд░рдерд╛рдУрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдлрд╝рд╛рдЗрд▓реЛрдВ рдФрд░ рд╕рд╛рдЭрд╛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдХреЛ рдкрдврд╝реЗрдВ рдФрд░ рд▓рд┐рдЦреЗрдВред </li></ul><br><p>  рдПрдХ рдЕрдЪреНрдЫрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╕реНрдЯреЛрд░реЗрдЬ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдРрд╕рд╛ рдХреЛрдб рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛: </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Application</span></span></span></span>() { ... <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encryptedStorage <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { EncryptedSharedPreferences.create( <span class="hljs-string"><span class="hljs-string">"main_storage"</span></span>, <span class="hljs-string"><span class="hljs-string">"main_storage_key"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV, EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM ) } ... }</code> </pre> <br><p>  рдмрд╕ рдЗрддрдирд╛ рд╣реАред  рдмрд╛рдж рдореЗрдВ, рд╣рдо рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ <code>SharedPreferences</code> рдереЗ, рд▓реЗрдХрд┐рди рд╕рднреА рдбреЗрдЯрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред  рдЕрдм рд╣рдо рдкрд┐рдЫрд▓реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreatePinViewModel</span></span></span></span>(application: Application) : AndroidViewModel(application) { ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> preferences <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { getApplication&lt;App&gt;().encryptedStorage } ... }</code> </pre> <br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputPinViewModel</span></span></span></span>(application: Application) : AndroidViewModel(application) { ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> preferences <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { getApplication&lt;App&gt;().encryptedStorage } ... }</code> </pre> <br><p>  рдЖрдЗрдП рд╕рдВрдХреНрд╖реЗрдк рдХреЛ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░реЗрдВред  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдкрд┐рди рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд рдХреБрдВрдЬреА рд╣реИ, рдФрд░ рдЗрд╕реЗ рд╕реНрдЯреЛрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╛рдлреА рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИред  рдпрд╣ рдЕрдЪреНрдЫрд╛ рд▓рдЧ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИред  рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдЕрдЧрд░ рд╣рдо рдпрд╣ рдорд╛рди рд▓реЗрдВ рдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рдиреЗ рд╣рдорд╛рд░реЗ рдбрд┐рд╡рд╛рдЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реА рд╣реИ рдФрд░ рдЙрд╕рд╕реЗ рдкреВрд░рд╛ рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд▓ рд▓рд┐рдпрд╛ рд╣реИред  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЗрд╕ рд╕рдордп рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕рдХреЗ рдкрд╛рд╕ рд╕рднреА рдШрдЯрдХ рд╣реИрдВред  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рджреЛ рдЪреАрдЬреЗрдВ рд╣рд╛рд╕рд┐рд▓ рдХрд░рдиреА рд╣реИрдВ: </p><br><ul><li>  рдПрдХ рдкрд┐рди рдмрд┐рд▓реНрдХреБрд▓ рднреА рд╕рдВрдЧреНрд░рд╣реАрдд рдирд╣реАрдВ рд╣реИ </li><li>  рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдСрдкрд░реЗрд╢рди рдкрд┐рди рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИрдВ </li></ul><br><p>  рдкреВрд░реЗ рдХреЛрдб рдХреЛ рджреЛрдмрд╛рд░рд╛ рд▓рд┐рдЦреЗ рдмрд┐рдирд╛ рд╣рдо рдЗрди рд▓рдХреНрд╖реНрдпреЛрдВ рдХреЛ рдХреИрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ?  рдпрд╣ рдЖрд╕рд╛рди рд╣реИ!  Insofar рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо Tink рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рд╣рдо рдЗрд╕рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдлреАрдЪрд░ рдХреЛ рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><blockquote>  рд╕рдВрдмрджреНрдз рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рд╕рдВрдмрджреНрдз рдбреЗрдЯрд╛ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкреИрд░рд╛рдореАрдЯрд░ рд╢реВрдиреНрдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╢реВрдиреНрдп рдорд╛рди рдПрдХ рдЦрд╛рд▓реА (рд╢реВрдиреНрдп-рд▓рдВрдмрд╛рдИ) рдмрд╛рдЗрдЯ рд╕рд░рдгреА рдХреЗ рдмрд░рд╛рдмрд░ рд╣реИред  рд╕рдлрд▓ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╕рдВрдмрджреНрдзрддрд╛ рд╕рд┐рдлрд░рдЯреЗрдХреНрд╕реНрдЯ рдХреЗ рд╕рд╛рде рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред </blockquote><p>  рдпрд╣ рдмрд╛рдд рд╣реИ!  рд╣рдо рдЕрдкрдиреЗ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд▓рдХреНрд╖реНрдпреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдмрдВрдзрд┐рдд рдбреЗрдЯрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдкрд┐рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдпрд╛ рдЕрд╕рдВрднрд╡рддрд╛ рдкрд┐рди рд╢реБрджреНрдзрддрд╛ рдХреЗ рд╕рдВрдХреЗрддрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░реЗрдЧрд╛ред  рдпрд╣ рдпреЛрдЬрдирд╛ рдЖрдорддреМрд░ рдкрд░ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдХрд╛рдо рдХрд░рддреА рд╣реИ: </p><br><img src="https://habrastorage.org/webt/gt/b8/lp/gtb8lp4qsvavlqyyopgju6pmyxy.png" width="50%" height="50%"><br><p>  рдпрджрд┐ рдХреЛрдИ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЧрд▓рдд рдкрд┐рди рджрд░реНрдЬ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдПрдХреНрд╕реЗрд╕ рдЯреЛрдХрди рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╕рдордп <strong>GeneralSecurityException</strong> рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧреАред  рддреЛ, рдЕрдВрддрд┐рдо рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрд╛рдИ рджреЗ рд╕рдХрддрд╛ рд╣реИ: </p><br><div class="spoiler">  <b class="spoiler_title">рдХреЛрдб рджрд┐рдЦрд╛рдУ</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreatePinViewModel</span></span></span></span>(application: Application): AndroidViewModel(application) { ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fakeAccessToken = <span class="hljs-string"><span class="hljs-string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZWNyZXQiOiJXZSdyZSBoaXJpbmcgOykifQ.WZrEWG-l3VsJzJrbnjn2BIYO68gHIGyat6jrw7Iu-Rw"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> preferences <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { getApplication&lt;App&gt;().encryptedStorage } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> aead <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { getApplication&lt;App&gt;().pinSecuredAead } ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">savePin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> salt = Salt.generate() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> secretKey = Pbkdf2Factory.createKey(pin.toCharArray(), salt) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encryptedToken = aead.encrypt( fakeAccessToken.toByteArray(), secretKey.encoded ) preferences.edit { putString(StorageKey.TOKEN, Base64.encodeToString( encryptedToken, Base64.DEFAULT )) putString(StorageKey.SALT, Base64.encodeToString(salt, Base64.DEFAULT)) putBoolean(StorageKey.PIN_IS_ENABLED, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) } ... } }</code> </pre> <br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputPinViewModel</span></span></span></span>(application: Application) : AndroidViewModel(application) { ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> preferences <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { getApplication&lt;App&gt;().encryptedStorage } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> aead <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { getApplication&lt;App&gt;().pinSecuredAead } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authenticate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { authenticationState.value = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pinIsValid(pin)) { AuthenticationState.AUTHENTICATED } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AuthenticationState.INVALID_AUTHENTICATION } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pinIsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> salt = Base64.decode( preferences.getString(StorageKey.SALT, <span class="hljs-literal"><span class="hljs-literal">null</span></span>), Base64.DEFAULT ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> secretKey = Pbkdf2Factory.createKey(pin.toCharArray(), salt) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> token = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encryptedToken = Base64.decode( preferences.getString(StorageKey.TOKEN, <span class="hljs-literal"><span class="hljs-literal">null</span></span>), Base64.DEFAULT ) aead.decrypt(encryptedToken, secretKey.encoded) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: GeneralSecurityException) { <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> token?.isNotEmpty() ?: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } }</code> </pre> </div></div><br><p>  рдЕрдЪреНрдЫрд╛ рдкрд░рд┐рдгрд╛рдо!  рдЕрдм рд╣рдо рдкрд┐рди рдХреЛ рд╕реНрдЯреЛрд░ рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдФрд░ рд╕рднреА рдбреЗрдЯрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдмреЗрд╢рдХ, рдЗрд╕ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЗ рд╣реИрдВред  рдореИрдВрдиреЗ рд╕рд┐рд░реНрдл рдореВрд▓ рд╕рд┐рджреНрдзрд╛рдВрдд рджрд┐рдЦрд╛рдпрд╛ рд╣реИред </p><br><a name="what-about-biometrics"></a><br><h1 id="but-wait-what-about-biometrics">  рд▓реЗрдХрд┐рди рд░реБрдХреЛ, рдмрд╛рдпреЛрдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛? </h1><br><p>  рдореБрдЭреЗ рдирд╣реАрдВ рд▓рдЧрддрд╛ рдХрд┐ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ "рдмреЙрдпреЛрдореАрдЯреНрд░рд┐рдХреНрд╕" рд╣реИред  рдореИрдВ рдЗрд╕рдХрд╛ рдирд╛рдо "рдПрдХ рдмрд╣реБрдд рд╣реА рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реБрд╡рд┐рдзрд╛" рд░рдЦреВрдВрдЧрд╛ред  рдФрд░ рдпрд╣ рд╕реБрд╡рд┐рдзрд╛ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рдмреАрдЪ рдПрдХ рдмрд╣реБрдд рдкреБрд░рд╛рдирд╛ рдкрд╡рд┐рддреНрд░ рдпреБрджреНрдз рд╣реИред  рд▓реЗрдХрд┐рди рдЕрдзрд┐рдХрд╛рдВрд╢ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрд╕ рддрд░рд╣ рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ рдкрд╕рдВрдж рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╣рдореЗрдВ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕реЗ рдпрдерд╛рд╕рдВрднрд╡ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рд╣реИред </p><br><p>  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдмрд╛рдпреЛрдореЗрдЯреНрд░рд┐рдХ рдХреЛрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд╛рдлреА рдореБрд╢реНрдХрд┐рд▓ рд╣реИред  рдЗрд╕рд▓рд┐рдП рдореИрдВ рдЖрдкрдХреЛ рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╕рд┐рджреНрдзрд╛рдВрдд рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░реВрдВрдЧрд╛ рдФрд░ рдХреБрдЫ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рджреВрдВрдЧрд╛ред  рдЗрд╕рдХреЗ рдмрд╛рдж рд╣рдо рдХреЛрдб рдореЗрдВ рдЧрд╣рд░рд╛ рдЧреЛрддрд╛ рд▓рдЧрд╛рдПрдБрдЧреЗред </p><br><img src="https://habrastorage.org/webt/v-/dn/et/v-dnetfch9xp5ixpzghi-f1t1co.png" width="70%" height="70%"><br><p>  рдЗрд╕ рдпреЛрдЬрдирд╛ рдореЗрдВ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд╛рд░реАрдХрд┐рдпрд╛рдБ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: <strong>рдЧреБрдкреНрдд рдХреБрдВрдЬреА рдбрд┐рд╕реНрдХ рдкрд░ рд╕рд╣реЗрдЬреА рдЬрд╛рддреА рд╣реИ</strong> ред  рдмреЗрд╢рдХ рдПрдХ рд╕рд╛рджреЗ рдкрд╛рда рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреАред </p><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рд╣рдордиреЗ рдХреАрд╕реНрдЯреЛрд░ рдореЗрдВ рдПрдХ рдирдИ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдмрдирд╛рдИ рд╣реИ рдФрд░ рд╣рдо рдЗрд╕ рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдорд╛рд░реА рдЧреБрдкреНрдд рдХреБрдВрдЬреА рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдХрд┐ рдкрд┐рди рд╕реЗ рд▓реА рдЧрдИ рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХреА рд╕реНрдХреАрдо рд╣рдореЗрдВ рдСрдереЗрдВрдЯрд┐рдХреЗрд╢рди рдореЗрдердб рдХреЛ рдмрджрд▓рддреЗ рд╕рдордп рд╕рднреА рдбреЗрдЯрд╛ рдХреЛ рджреЛрдмрд╛рд░рд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдирд╣реАрдВ рдХрд░рдиреЗ рджреЗрддреА рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рднреА рдПрдХ рдкрд┐рди рджрд░реНрдЬ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИ рдпрджрд┐ рдмрд╛рдпреЛрдореЗрдЯреНрд░рд┐рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд┐рд╕реА рднреА рдХрд╛рд░рдг рд╕реЗ рд╡рд┐рдлрд▓ рд╣реЛ рдЧрдпрд╛ рдерд╛ред  рдареАрдХ рд╣реИ, рдмрд╣реБрдд рдХреЛрдб рд▓рд┐рдЦрддреЗ рд╣реИрдВред </p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдореИрдВ рдкрд┐рди рдирд┐рд░реНрдорд╛рдг рдкреНрд░рд╡рд╛рд╣ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рджрд┐рдЦрд╛рдКрдВрдЧрд╛: </p><br><div class="spoiler">  <b class="spoiler_title">рдХреЛрдб рджрд┐рдЦрд╛рдУ</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreatePinViewModel</span></span></span></span>(application: Application): AndroidViewModel(application) { <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ANDROID_KEY_STORE = <span class="hljs-string"><span class="hljs-string">"AndroidKeyStore"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> KEY_NAME = <span class="hljs-string"><span class="hljs-string">"biometric_key"</span></span> } ... <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> biometricEnableDialog = MutableLiveData&lt;SingleLiveEvent&lt;<span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>&gt;&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> biometricParams = MutableLiveData&lt;BiometricParams&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authenticationCallback = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : BiometricPrompt.AuthenticationCallback() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAuthenticationError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(errorCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, errString: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CharSequence</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAuthenticationError(errorCode, errString) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAuthenticationSucceeded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(result: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AuthenticationResult</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAuthenticationSucceeded(result) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encryptedSecretKey = result.cryptoObject?.cipher?.doFinal( secretKey.encoded ) preferences.edit { putString(StorageKey.KEY, Base64.encodeToString( encryptedSecretKey, Base64.DEFAULT )) } pinIsCreated.postValue(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAuthenticationFailed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAuthenticationFailed() } } ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> biometricManager <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { getApplication&lt;App&gt;().biometricManager } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> keyStore = KeyStore.getInstance(ANDROID_KEY_STORE) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> secretKey: SecretKey ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enableBiometric</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(isEnabled: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { generateKey() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cipher = createCipher().also { preferences.edit { putString(StorageKey.KEY_IV, Base64.encodeToString(it.iv, Base64.DEFAULT)) } } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> promptInfo = createPromptInfo() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cryptoObject = BiometricPrompt.CryptoObject(cipher) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isEnabled) { biometricParams.value = BiometricParams(isEnabled, promptInfo, cryptoObject) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { pinIsCreated.value = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createPromptInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: BiometricPrompt.PromptInfo { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BiometricPrompt.PromptInfo.Builder() .setTitle(<span class="hljs-string"><span class="hljs-string">"Create biometric authorization"</span></span>) .setSubtitle(<span class="hljs-string"><span class="hljs-string">"Touch your biometric sensor"</span></span>) .setNegativeButtonText(<span class="hljs-string"><span class="hljs-string">"Cancel"</span></span>) .build() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { keyStore.load(<span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> keyProperties = PURPOSE_ENCRYPT or PURPOSE_DECRYPT <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> builder = KeyGenParameterSpec.Builder(KEY_NAME, keyProperties) .setBlockModes(BLOCK_MODE_CBC) .setUserAuthenticationRequired(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .setEncryptionPaddings(ENCRYPTION_PADDING_NONE) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> keyGenerator = KeyGenerator.getInstance( KEY_ALGORITHM_AES, ANDROID_KEY_STORE ) keyGenerator.run { <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(builder.build()) generateKey() } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: Exception) { authenticationCallback.onAuthenticationError( BiometricConstants.ERROR_NO_DEVICE_CREDENTIAL, e.localizedMessage ) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCipher</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Cipher { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key = with(keyStore) { load(<span class="hljs-literal"><span class="hljs-literal">null</span></span>) getKey(KEY_NAME, <span class="hljs-literal"><span class="hljs-literal">null</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Cipher.getInstance( <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$KEY_ALGORITHM_AES</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BLOCK_MODE_CBC</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ENCRYPTION_PADDING_NONE</span></span></span><span class="hljs-string">"</span></span> ).apply { <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(Cipher.ENCRYPT_MODE, key) } } }</code> </pre> </div></div><br><p>  рдореБрдЭреЗ рдЦреБрд╢реА рд╣реЛрдЧреА рдЕрдЧрд░ Google рдиреЗ Tink in Biometrics рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛, рд▓реЗрдХрд┐рди ... рд╣рдореЗрдВ рдЗрд╕ рдмрд╛рдпрд▓рд░рдкреНрд▓реЗрдЯ рдХреЛрдб рдХреЛ рд╕рд┐рдлрд░ рдФрд░ рдХреАрд╕реНрдЯреЛрд░ рдХреЗ рд╕рд╛рде рд▓рд┐рдЦрдирд╛ рд╣реЛрдЧрд╛ред  рдпрд╣ рдХреЛрдб рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рдкрд░рд┐рдЪрд┐рдд рд╣реИ, рдЬреЛ рдПрдВрдбреНрд░реЙрдЗрдб рдореЗрдВ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдореИрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдкреИрдбрд┐рдВрдЧ рдкрд░ рдЖрдкрдХрд╛ рдзреНрдпрд╛рди рджреЗрдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВред  рд╣рд╛рдВ, рдкреЗрдбрд┐рдВрдЧ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдУрд░реЗрдХрд▓ рд╣рдорд▓реЗ</a> рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рдкреИрдбрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдмрд┐рд▓реНрдХреБрд▓ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдбрд┐рд╕реНрдХ рдкрд░ рдЧреБрдкреНрдд рдХреБрдВрдЬреА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╕рдордп рд╣рдо рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рдмреЙрдпреЛрдореАрдЯреНрд░рд┐рдХ рдЬрд╛рдБрдЪ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдмрд╣реБрдд рд╕рдорд╛рди рд╣реИ: </p><br><div class="spoiler">  <b class="spoiler_title">рдХреЛрдб рджрд┐рдЦрд╛рдУ</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputPinViewModel</span></span></span></span>(application: Application) : AndroidViewModel(application) { <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ANDROID_KEY_STORE = <span class="hljs-string"><span class="hljs-string">"AndroidKeyStore"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> KEY_NAME = <span class="hljs-string"><span class="hljs-string">"biometric_key"</span></span> } ... <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> biometricErrorMessage = MutableLiveData&lt;SingleLiveEvent&lt;String&gt;&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> biometricParams = MutableLiveData&lt;BiometricParams&gt;() ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> biometricManager <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> lazy { getApplication&lt;App&gt;().biometricManager } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> keyStore = KeyStore.getInstance(ANDROID_KEY_STORE) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authenticationCallback = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> : BiometricPrompt.AuthenticationCallback() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAuthenticationError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(errorCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, errString: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CharSequence</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAuthenticationError(errorCode, errString) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAuthenticationSucceeded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(result: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AuthenticationResult</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAuthenticationSucceeded(result) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encryptedSecretKey = Base64.decode( preferences.getString(StorageKey.KEY, <span class="hljs-string"><span class="hljs-string">""</span></span>), Base64.DEFAULT ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> secretKey = result.cryptoObject?.cipher?.doFinal(encryptedSecretKey) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> token = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encryptedToken = Base64.decode( preferences.getString(StorageKey.TOKEN, <span class="hljs-literal"><span class="hljs-literal">null</span></span>), Base64.DEFAULT ) aead.decrypt(encryptedToken, secretKey) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: GeneralSecurityException) { <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> state = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (token?.isNotEmpty() == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { AuthenticationState.AUTHENTICATED } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AuthenticationState.INVALID_AUTHENTICATION } authenticationState.postValue(state) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAuthenticationFailed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAuthenticationFailed() } } ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">biometricAuthenticate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preferences.contains(StorageKey.KEY)) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (biometricManager.canAuthenticate()) { BiometricManager.BIOMETRIC_SUCCESS -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> promptInfo = createPromptInfo() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cryptoObject = BiometricPrompt.CryptoObject(createCipher()) biometricParams.value = BiometricParams(promptInfo, cryptoObject) } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { biometricErrorMessage.value = SingleLiveEvent( <span class="hljs-string"><span class="hljs-string">"Biometric authentication isn't configured"</span></span> ) } } ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createPromptInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: BiometricPrompt.PromptInfo { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BiometricPrompt.PromptInfo.Builder() .setTitle(<span class="hljs-string"><span class="hljs-string">"Biometric login for my app"</span></span>) .setSubtitle(<span class="hljs-string"><span class="hljs-string">"Log in using your biometric credential"</span></span>) .setNegativeButtonText(<span class="hljs-string"><span class="hljs-string">"Cancel"</span></span>) .build() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCipher</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Cipher { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key = with(keyStore) { load(<span class="hljs-literal"><span class="hljs-literal">null</span></span>) getKey(KEY_NAME, <span class="hljs-literal"><span class="hljs-literal">null</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Cipher.getInstance( <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$KEY_ALGORITHM_AES</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BLOCK_MODE_CBC</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ENCRYPTION_PADDING_NONE</span></span></span><span class="hljs-string">"</span></span> ).apply { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> iv = Base64.decode( preferences.getString(StorageKey.KEY_IV, <span class="hljs-literal"><span class="hljs-literal">null</span></span>), Base64.DEFAULT ) <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(Cipher.DECRYPT_MODE, key, IvParameterSpec(iv)) } } }</code> </pre> </div></div><br><p>  <code>authenticationCallback.onAuthenticationSucceeded</code> рдзреНрдпрд╛рди <code>authenticationCallback.onAuthenticationSucceeded</code> , рдЗрд╕рдореЗрдВ рдкреЛрд╕реНрдЯ-рдмрд╛рдпреЛрдореЗрдЯреНрд░рд┐рдХ рдСрдереЗрдВрдЯрд┐рдХреЗрд╢рди рдХрд╛ рдореБрдЦреНрдп рддрд░реНрдХ рд╣реЛрддрд╛ рд╣реИред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ <code>pinIsValid()</code> рд╡рд┐рдзрд┐ рдХрд╛ рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИред  рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рджреЛ рдкрд┐рдЫрд▓реЗ рдХреЛрдб рдмреНрд▓реЙрдХ рдореЗрдВ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдЗрд╕рдХреА рдХреЛрдИ рдордЬрдмреВрдд рд╕рдордЭ рдирд╣реАрдВ рд╣реИ, рддреЛ рдХреГрдкрдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмрд╛рдпреЛрдореЗрдЯреНрд░рд┐рдХ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬ рджреЗрдЦреЗрдВ</a> ред </p><br><a name="am-i-completely-protected"></a><br><h1 id="am-i-completely-protected">  рдХреНрдпрд╛ рдореИрдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реВрдВ? </h1><br><p>  рд╣рдордиреЗ рдПрдХ рдкрд┐рди рдФрд░ рдмрд╛рдпреЛрдореЗрдЯреНрд░рд┐рдХреНрд╕ рдХреЗ рд╕рд╛рде рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХрд╛ рдПрд╣рд╕рд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕рд╛рд░реА рд╢рд╛рдирджрд╛рд░ рдЪреАрдЬреЗрдВ рдХреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рдпрд╣ рдЗрддрдирд╛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ?  рдмреЗрд╢рдХ, рд╣рдордиреЗ рдЕрдкрдирд╛ рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдкреНрд░рджрд░реНрд╢рди рдХрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдмрд┐рдВрджреБ рд╣реИрдВред </p><br><p>  рдПрдХ рдХреНрд▓рд╛рд╕рд┐рдХ рдкрд┐рди рдореЗрдВ рдХреЗрд╡рд▓ рдЪрд╛рд░ рдЕрдВрдХ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рднреА рдмрд╣реБрдд рдХрдо рд╣реЛрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣ рдХрд╛ рдХреЛрдб рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реИред  рд╣рдордиреЗ рдЬреЛ рдХреБрдЫ рднреА рдХрд┐рдпрд╛ рд╣реИ рдЙрд╕рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдПрдХ рдореМрдХрд╛ рд╣реИ рдХрд┐ рдПрдХ рдШреБрд╕рдкреИрдард┐рдпрд╛ рдЗрд╕ рдХреЛрдб рдХреЛ рдХреНрд░реИрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рд╣рд╛рдБ, рдЙрд╕реЗ рдЖрдкрдХреЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рд░рд┐рд╡рд░реНрд╕ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдХреЛ рдкреВрд░рд╛ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рд╕рдордЭрдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдХреИрд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рднреАред  рдпрджрд┐ рдХреЛрдИ рд╣рдорд▓рд╛рд╡рд░ рдкрд░реНрдпрд╛рдкреНрдд рд░реВрдк рд╕реЗ рдкреНрд░реЗрд░рд┐рдд рд╣реЛрддрд╛ рд╣реИ рддреЛ рд╡рд╣ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╣рд┐рдЪрдХрд┐рдЪрд╛рд╣рдЯ рдХреЗ рдРрд╕рд╛ рдХрд░реЗрдЧрд╛ред </p><br><p>  рджреВрд╕рд░рд╛ рдмрд┐рдВрджреБ рд░реВрдЯ рдХрд┐рдП рдЧрдП рд╕реНрдорд╛рд░реНрдЯрдлрд╝реЛрди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИред  рдЬрдм рдпрд╣ рдирд┐рд╣рд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдХреА рдмрд╛рдд рдЖрддреА рд╣реИ, рддреЛ рдЖрдк рдЕрдкрдиреЗ рд╕рднреА рд╕реБрд░рдХреНрд╖рд╛ рдЖрд╢реНрд╡рд╛рд╕рди рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЛ рджреВрд░ рдлреЗрдВрдХ рд╕рдХрддреЗ рд╣реИрдВред  рд░реВрдЯ рдПрдХреНрд╕реЗрд╕ рдХреЗ рд╕рд╛рде рдХреЛрдИ рднреА рдореИрд▓рд╡реЗрдпрд░ рд╕рднреА рд╕реБрд░рдХреНрд╖рд╛ рддрдВрддреНрд░ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛рдПрдВ рдФрд░ рдЪреЗрдХ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред  рдореИрдВ рдЖрдкрдХреЛ рдЗрди рджреЛрд╖реЛрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рд╕рдмрд╕реЗ рд╕рд░рд▓ рдЪреАрдЬреЗрдВ рд╕реБрдЭрд╛рддрд╛ рд╣реВрдВ: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реЗрдлреНрдЯреАрдиреЗрдЯ</a> - рдпрд╣ рд╕реЗрд╡рд╛рдУрдВ рдФрд░ рдПрдкреАрдЖрдИ рдХрд╛ рдПрдХ рд╕реЗрдЯ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЗ рдРрдк рдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рдЦрддрд░реЛрдВ рд╕реЗ рдмрдЪрд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдбрд┐рд╡рд╛рдЗрд╕ рд╕реЗ рдЫреЗрдбрд╝рдЫрд╛рдбрд╝, рдЦрд░рд╛рдм рдпреВрдЖрд░рдПрд▓, рд╕рдВрднрд╛рд╡рд┐рдд рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдРрдк рдФрд░ рдирдХрд▓реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Obfuscation</a> - <strong>рдХреГрдкрдпрд╛ рдпрд╛рдж рд░рдЦреЗрдВ</strong> рдХрд┐ ProGuard рдПрдХ рдЖрдХреНрд╖реЗрдк рдЙрдкрдХрд░рдг рдирд╣реАрдВ рд╣реИ!  ProGuard рдЫреЛрдЯрд╛ рдФрд░ рд╕рдВрд╕рд╛рдзрди рд╕рд┐рдХреБрдбрд╝рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИ, рди рдХрд┐ рдЖрдкрддреНрддрд┐ рдпрд╛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдПред  рдбреЗрдХреНрд╕рдЧрд╛рд░реНрдб, рдбреЗрдХреНрд╕рдкреНрд░реЛрдЯреЗрдХреНрдЯрд░, рдЖрджрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред </li></ul><br><p>  рдЗрд╕ рд▓реЗрдЦ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдгреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╕реЗрдлреНрдЯреАрдиреЗрдЯ рдФрд░ рдСрдмрдлрд┐рдХреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдЕрдЪреНрдЫрд╛ рдЕрдЧрд▓рд╛ рдХрджрдо рд╣реИред  рдпрджрд┐ рдЖрдк рдЧрд▓рддрд┐рдпрд╛рдБ, рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдпрд╛ рдЕрдиреНрдп рдмрдХрд╡рд╛рд╕ рдиреЛрдЯ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХреГрдкрдпрд╛ рдореБрдЭреЗ рдмрддрд╛рдПрдБред  рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GitHub</a> рдкрд░ рд▓реЗрдЦ рдХреЗ рд╕рднреА рдХреЛрдб рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдФрд░ рдЕрдЧрд▓реА рдмрд╛рд░ рдореИрдВ рдЖрдкрдХреЛ рджрд┐рдЦрд╛рдКрдВрдЧрд╛ рдХрд┐ рдмреИрдХ-рдПрдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд┐рди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреИрд╕реЗ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рдПред  рджреЗрдЦрддреЗ рд░рд╣реЛред </p><br><h3 id="useful-links">  рдЙрдкрдпреЛрдЧреА рд▓рд┐рдВрдХ </h3><br><ul><li>  KDF рдлрд╝рдВрдХреНрд╢рди: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрд░реНрдЧрди 2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реНрдХреНрд░реАрдкреНрдЯ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рд╛рдЭрд╛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдУрдВ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рддрд░реАрдХрд╛ (рдЖрд░рдпреВ)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реВрдЪрдирд╛ рдПрдиреНрдЯреНрд░рд╛рдкреА</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрдзрд┐рдХ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВ</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi475112/">https://habr.com/ru/post/hi475112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi475098/index.html">рдСрдирд▓рд╛рдЗрди рд╕рд┐рдиреЗрдорд╛ рдХреЗ рдкреЛрд╕реНрдЯрд░ рдХреА рдЦрд░реАрдж рдХрд╛ рд╕реНрд╡рдЪрд╛рд▓рди</a></li>
<li><a href="../hi475100/index.html">рдирд┐рд╡реЗрд╢рдХреЛрдВ рдХреЗ рд▓рд┐рдП рдЬреЛрдЦрд┐рдо рдХреЗ рдмрд┐рдирд╛ рдПрдХ "рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдЕрдЪреНрдЫрд╛" рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреНрд░рд┐рдкреНрдЯреЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ</a></li>
<li><a href="../hi475104/index.html">рд╣рдо рдореЙрдбреНрдпреВрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдбрд╝рд╛рди рднрд░рддреЗ рд╣реИрдВ: рдЬреЗрдЯрдкреИрдХ рдХреЗ рд╕рд╛рде рдПрдХ рдорд▓реНрдЯреА-рдореЙрдбреНрдпреВрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдиреЗрд╡рд┐рдЧреЗрд╢рди</a></li>
<li><a href="../hi475106/index.html">Microsoft рдкреНрд░рдЬреНрд╡рд▓рд┐рдд 2019 рд╕рдореНрдореЗрд▓рди рдХреА рдореБрдЦреНрдп рдШреЛрд╖рдгрд╛рдПрдБ</a></li>
<li><a href="../hi475110/index.html">Jupyter рдиреЛрдЯрдмреБрдХ рдХреЗ рд╕рд╛рде .NET рдХреЛрд░ - рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди 1</a></li>
<li><a href="../hi475114/index.html">рдкреЗрд╢ рд╣реИ .NET рдХреЛрд░ 3.1 рдкреВрд░реНрд╡рд╛рд╡рд▓реЛрдХрди 2</a></li>
<li><a href="../hi475116/index.html">рд╡рд┐рдВрдбреЛрдЬрд╝ рдбреЗрд╕реНрдХрдЯреЙрдк рдХреЗ рд▓рд┐рдП .NET рдХреЛрд░ 3</a></li>
<li><a href="../hi475124/index.html">рдХреЗрд╕: рдЗрдВрд╕реНрдЯрд╛рдЧреНрд░рд╛рдо рдСрдЯреЛрдореЗрд╢рдиред рдХреНрдпрд╛ рдЖрдк рд╕реЛрд╢рд▓ рдореАрдбрд┐рдпрд╛ рдкреЛрд╕реНрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмреЗрдЪ рд░рд╣реЗ рд╣реИрдВ?</a></li>
<li><a href="../hi475126/index.html">рдорд╛рд╕реНрдХреЛ Node.js рдореАрдЯрдЕрдк 10: Node.js рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХрд╛ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░, Node.js рдореЗрдВ рд╣реЙрдЯ рд░реАрд▓реЛрдб рдФрд░ рдПрдХ рдЧреБрдкреНрдд рд░рд┐рдкреЛрд░реНрдЯ</a></li>
<li><a href="../hi475134/index.html">рд╣рд╛рдИрдЯреЗрдХ рдзреЛрдЦрд╛рдзрдбрд╝реА рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>