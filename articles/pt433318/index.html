<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∏ üíÑ üêà garbage.collect () ü§∂üèª üë©üèº‚Äçüé§ ü•á</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Para executar o JavaScript, o navegador precisa de um pouco de mem√≥ria, mas em algum lugar √© necess√°rio armazenar objetos, primitivas, fun√ß√µes criadas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>garbage.collect ()</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/433318/"> Para executar o JavaScript, o navegador precisa de um pouco de mem√≥ria, mas em algum lugar √© necess√°rio armazenar objetos, primitivas, fun√ß√µes criadas para todas as a√ß√µes do usu√°rio.  Portanto, o navegador primeiro aloca a quantidade necess√°ria de RAM e, quando os objetos n√£o s√£o usados, ele a limpa independentemente. <br><br>  Em teoria, parece bom.  Na pr√°tica, o usu√°rio abre 20 abas do YouTube, redes sociais, l√™ alguma coisa, funciona, o navegador consome mem√≥ria, como o Hummer H2 - gasolina.  O coletor de lixo, como esse monstro com uma esfregona, percorre toda a mem√≥ria e acrescenta confus√£o, tudo fica mais lento e trava. <br><br><img src="https://habrastorage.org/webt/uc/vx/ke/ucvxke3xzwiqngna7opkqwllmq4.jpeg"><br><br>  Para impedir que tais situa√ß√µes aconte√ßam e o desempenho de nossos sites e aplicativos n√£o sofra, o desenvolvedor front-end deve saber como o lixo afeta os aplicativos, como o navegador o coleta e otimiza o tratamento da mem√≥ria e como tudo difere da realidade dura.  Este √© apenas o relat√≥rio de <strong>Andrei Roenko ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">flapenguin</a> )</strong> no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Frontend Conf 2018</a> . <br><br>  Usamos o coletor de lixo (n√£o em casa - no desenvolvimento de front-end) todos os dias, mas realmente n√£o pensamos sobre o que √©, o que nos custa e as oportunidades e limita√ß√µes que ele tem. <br><br><blockquote>  Se a coleta de lixo realmente funcionasse em JavaScript, a maioria dos m√≥dulos npm se excluiria imediatamente ap√≥s a instala√ß√£o. <br></blockquote><br>  Mas enquanto isso n√£o for verdade, falaremos sobre o que √© - sobre a montagem de objetos desnecess√°rios. <br><br><a name="habracut"></a><iframe width="560" height="315" src="https://www.youtube.com/embed/tDbRVZqwxn4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <strong>Sobre o palestrante</strong> : <strong>Andrei Roenko</strong> desenvolve <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a API Yandex.Map</a> , est√° na interface h√° seis anos, ele gosta de criar suas pr√≥prias abstra√ß√µes altas e desce ao ch√£o de estranhos. <br><br><h2>  Por que voc√™ precisa de coleta de lixo? <br></h2><br>  Considere o exemplo de Yandex.Maps.  O Yandex.Maps √© um servi√ßo enorme e complexo que usa muitas JS e quase todas as APIs de navegador existentes, exceto as multim√≠dia, e o tempo m√©dio da sess√£o √© de 5 a 10 minutos.  A abund√¢ncia de JavaScript cria muitos objetos.  Arrastar e soltar um mapa, adicionar organiza√ß√µes, resultados de pesquisa e muitos outros eventos que ocorrem a cada segundo cria uma avalanche de objetos.  Adicione a isso React e os objetos se tornam ainda mais. <br><br>  No entanto, os objetos JS ocupam apenas 30 a 40 Mb no mapa.  Para longas sess√µes Yandex.Maps e a aloca√ß√£o constante de novos objetos, isso n√£o √© suficiente. <br><br><blockquote>  O motivo do pequeno volume de objetos √© que eles s√£o coletados com sucesso pelo coletor de lixo e a mem√≥ria √© reutilizada. <br></blockquote><br>  Hoje falaremos sobre a coleta de lixo de quatro lados: <br><br><ul><li>  <strong>Teoria</strong>  Vamos come√ßar com ela para falar a mesma l√≠ngua e entender um ao outro. </li><li>  <strong>Realidade dura.</strong>  Por fim, o computador executa o c√≥digo da m√°quina em que nem todas as abstra√ß√µes nos s√£o familiares.  Vamos tentar descobrir como a coleta de lixo funciona em um n√≠vel baixo. </li><li>  <strong>Realidade do navegador.</strong>  Vamos ver como a coleta de lixo √© implementada em mecanismos e navegadores modernos e que conclus√µes podemos tirar disso. </li><li>  <strong>Vida cotidiana</strong> - vamos falar sobre a aplica√ß√£o pr√°tica do conhecimento adquirido na vida cotidiana. </li></ul><br>  Todas as instru√ß√µes s√£o copiadas com exemplos de como e como n√£o faz√™-lo. <br><br><h2>  Por que saber tudo isso? </h2><br>  A coleta de lixo √© algo invis√≠vel para n√≥s, no entanto, sabendo como √© organizado, voc√™ ir√°: <br><br><ul><li>  Tenha uma id√©ia da ferramenta que voc√™ est√° usando, que √© √∫til no seu trabalho. </li><li>  Entenda onde otimizar os aplicativos j√° lan√ßados e como projetar os futuros para que eles funcionem melhor e mais rapidamente. </li><li>  Saiba como n√£o cometer erros comuns e parar de desperdi√ßar recursos em "otimiza√ß√µes" in√∫teis e prejudiciais. </li></ul><br><h2>  Teoria <br></h2><br>  Joel Spolsky disse uma vez: <br><br><blockquote>  Todas as abstra√ß√µes n√£o triviais s√£o vazadas. <br></blockquote><br>  O coletor de lixo √© uma grande abstra√ß√£o n√£o trivial que √© corrigida por todos os lados.  Felizmente, ele flui muito raramente. <br><br>  Vamos come√ßar com uma teoria, mas sem defini√ß√µes chatas.  Vamos analisar o trabalho do coletor usando um c√≥digo simples como exemplo: <br><br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Foo = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = { <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-string"><span class="hljs-string">'y'</span></span> }; } work(name) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> z = <span class="hljs-string"><span class="hljs-string">'z'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(name, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.xy, z); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } };</code> </pre> <br><ul><li>  H√° uma <strong>classe</strong> no c√≥digo. </li><li>  A classe tem um <strong>construtor</strong> . </li><li>  <strong>O m√©todo de trabalho</strong> retorna uma fun√ß√£o relacionada. </li><li>  Dentro da fun√ß√£o, <strong>essa</strong> e algumas vari√°veis ‚Äã‚Äãdo fechamento s√£o usadas. </li></ul><br>  Vamos ver como esse c√≥digo se comportar√° se for executado dessa maneira: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> foo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Foo(); <span class="hljs-comment"><span class="hljs-comment">//C   window.worker = foo.work('Brendan Eich'); //     bind,   window.foo = null; //   window.Foo = null; //  ,   -  window.worker(); window.worker = null; //   ,  </span></span></code> </pre><br>  Vamos analisar o c√≥digo e seus componentes com mais detalhes e come√ßar com a classe. <br><br><h3>  Declara√ß√£o de classe <br></h3><br><img src="https://habrastorage.org/webt/nd/yq/ie/ndyqietonv9ggcg45mvfmwnsyae.png"><br><br>  Podemos assumir que as classes no ECMAScript 2015 s√£o apenas a√ß√∫car sint√°tico para fun√ß√µes.  Todas as fun√ß√µes t√™m: <br><br><ul><li>  <strong>Fun√ß√£o. [[Prototype]]</strong> √© o prot√≥tipo real da fun√ß√£o. </li><li>  <strong>Foo.prototype</strong> √© um prot√≥tipo para objetos criados recentemente. </li><li>  Foo.prototype possui um link para o construtor atrav√©s do campo construtor.  Este √© um objeto, portanto herda de <strong>Object.prototype</strong> . </li><li>  <strong>O m√©todo de trabalho √© uma</strong> fun√ß√£o separada √† qual existe um link, semelhante ao construtor, porque ambos s√£o apenas fun√ß√µes.  Ele tamb√©m pode definir um prot√≥tipo e cham√°-lo de novo, mas raramente algu√©m usa esse comportamento. </li></ul><br>  Os prot√≥tipos ocupam muito espa√ßo no circuito, ent√£o vamos lembrar que s√£o, mas os removemos por simplicidade. <br><br><h3>  Criando um objeto de classe <br></h3><br><img src="https://habrastorage.org/webt/f_/ea/5u/f_ea5uuq01wygmqkdfbrj4a8oja.png"><br><br><ul><li>  Colocamos nossa classe na janela, porque as classes n√£o chegam l√° por padr√£o. </li><li>  Crie um objeto de classe. </li><li>  Criar um objeto exp√µe automaticamente o prot√≥tipo do objeto de classe no Foo.prototype.  Portanto, quando voc√™ tenta chamar o m√©todo de trabalho em um objeto, ele saber√° que tipo de trabalho √©. </li><li>  Nosso construtor cria o campo <em>x</em> no objeto a partir do objeto com a string. </li></ul><br>  Aqui est√° o que aconteceu: <br><br><img src="https://habrastorage.org/webt/nb/xx/d1/nbxxd11pg7bmutfnn4bqh3_ooxs.png"><br><br>  O m√©todo retorna uma fun√ß√£o vinculada - este √© um objeto ‚Äúm√°gico‚Äù t√£o especial em JS, que consiste em uma liga√ß√£o vinculada a isso e uma fun√ß√£o que deve ser chamada.  A fun√ß√£o relacionada tamb√©m possui um prot√≥tipo e outro prot√≥tipo, mas estamos interessados ‚Äã‚Äãno fechamento.  Por especifica√ß√£o, o fechamento √© armazenado no ambiente.  Provavelmente voc√™ est√° mais familiarizado com a palavra Escopo, mas <strong>nas especifica√ß√µes o campo √© chamado de Ambiente</strong> . <br><br><img src="https://habrastorage.org/webt/dv/zu/rn/dvzurne2uerkhr0vqxeahna5cum.png"><br><br>  O Environment armazena uma refer√™ncia ao LexicalEnvironment.  Esse √© um objeto complexo, mais complicado do que em um slide, que armazena links para tudo o que pode ser acessado a partir de uma fun√ß√£o.  Por exemplo, janela, Foo, nome ez.  Ele tamb√©m armazena links para o que voc√™ n√£o est√° usando explicitamente.  Por exemplo, voc√™ pode usar eval e acidentalmente objetos n√£o utilizados, mas o JS n√£o deve ser interrompido. <br><br>  Ent√£o, n√≥s constru√≠mos todos os objetos e agora vamos destruir tudo. <br><br><h3>  Exclua o link para o objeto <br></h3><br>  Vamos come√ßar removendo o link para o objeto, esse link no diagrama √© destacado em vermelho. <br><br><img src="https://habrastorage.org/webt/zp/g_/mf/zpg_mfnx7pgoc1q46ruedg5oeve.png"><br><br>  Exclu√≠mos e nada acontece, porque da <strong>janela</strong> para o objeto existe um caminho atrav√©s da <strong>fun√ß√£o de</strong> fun√ß√£o <strong>vinculada</strong> . <br><br><img src="https://habrastorage.org/webt/_w/lv/v6/_wlvv6dpon2qnjgaukobadopmas.png"><br><br>  Isso nos leva a um erro t√≠pico. <br><br><h3>  Erro comum - assinatura esquecida <br></h3><br><pre> <code class="javascript hljs">externalElement.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shouldDoSomethingOnClick) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.doSomething(); } })</code> </pre><br>  Ocorre quando voc√™ assina: usando <strong>isso,</strong> explicitamente atrav√©s das fun√ß√µes bind ou arrow;  use algo no fechamento.  Ent√£o voc√™ esquece de cancelar a inscri√ß√£o e a vida √∫til do seu objeto ou o que est√° no circuito se torna o mesmo que a vida √∫til de uma assinatura.  Por exemplo, se este √© um elemento DOM em que voc√™ n√£o toca, provavelmente √© o tempo at√© o final da vida da p√°gina. <br><br>  Para resolver esses problemas: <br><br><ul><li>  Cancelar inscri√ß√£o. </li><li>  Pense durante a vida √∫til da assinatura e quem √© o propriet√°rio. </li><li>  Se, por algum motivo, voc√™ n√£o puder cancelar a inscri√ß√£o, anule os links (qualquer que seja = nulo) ou limpe todos os campos do objeto.  Se o seu objeto vazar, ele ser√° pequeno e n√£o ser√° uma pena. </li><li>  Use o WeakMap, talvez isso ajude em algumas situa√ß√µes. </li></ul><br><h3>  Exclua a refer√™ncia da classe <br></h3><br>  V√° em frente e tente remover o link vermelho destacado da classe. <br><br><img src="https://habrastorage.org/webt/px/sm/yf/pxsmyfvo0utc5d1wh3rfrqcpmlc.png"><br><br>  Exclu√≠mos o link e nada muda para n√≥s.  O motivo √© que a classe √© acess√≠vel atrav√©s do BoundThis, no qual existe um link para o prot√≥tipo, e no prot√≥tipo existe um link para o construtor. <br><br><h3>  <s>Erro</s> t√≠pico trabalho in√∫til <br></h3><br>  Por que todas essas demonstra√ß√µes s√£o necess√°rias?  Porque existe um outro lado do problema quando as pessoas seguem o conselho para anular links muito literalmente e anular tudo em geral. <br><br><pre> <code class="javascript hljs">destroy() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._x = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._y = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  10 this._foobar = null }</span></span></code> </pre><br>  Este √© um trabalho in√∫til.  Se o objeto consistir apenas em refer√™ncias a outros objetos e n√£o houver recursos, n√£o ser√° necess√°rio destruir ().  Basta perder a refer√™ncia ao objeto, e ele morre por conta pr√≥pria. <br><br>  N√£o h√° conselho universal.  Quando for necess√°rio, anule e, quando n√£o, n√£o anule.  Zerar n√£o √© um erro, mas simplesmente um trabalho in√∫til. <br><br>  V√° em frente.  Chame o m√©todo da fun√ß√£o bound e ele remover√° o link de [object Foo] para [object Object].  Isso levar√° ao fato de que objetos que est√£o separados em um ret√¢ngulo azul aparecem no diagrama. <br><br><img src="https://habrastorage.org/webt/zl/ep/xc/zlepxcvklqpricdvth4gxnjp2ny.png"><br><br>  Esses objetos s√£o lixo JS.  Ele est√° indo muito bem.  No entanto, h√° lixo que n√£o pode ser coletado. <br><br><h3>  Lixo que n√£o vai <br></h3><br>  Em muitas APIs do navegador, voc√™ pode criar e destruir um objeto.  Se o objeto n√£o for destru√≠do, nenhum coletor poder√° mont√°-lo. <br><br>  Objetos com fun√ß√µes de criar / excluir pares: <br><br><ul><li>  createObjectURL (), revokeObjectURL (); </li><li>  WebGL: criar / excluir Programa / Shader / Buffer / Textura / etc; </li><li>  ImageBitmap.close (); </li><li>  indexDb.close (). </li></ul><br>  Por exemplo, se voc√™ esquecer de excluir o ObjectURL de um v√≠deo de 200 MB, esses 200 MB permanecer√£o na mem√≥ria at√© o final da vida √∫til da p√°gina e ainda mais, porque h√° troca de dados entre as guias.  Da mesma forma, no WebGL, indexDb e outras APIs do navegador com recursos semelhantes. <br><br>  Felizmente, em nosso exemplo, o ret√¢ngulo azul cont√©m apenas objetos JavaScript, portanto, isso √© apenas lixo que pode ser removido. <br><br>  O pr√≥ximo passo √© limpar o √∫ltimo link da esquerda para a direita.  Esta √© uma refer√™ncia ao m√©todo que recebemos, uma fun√ß√£o relacionada. <br><br><img src="https://habrastorage.org/webt/5g/k5/h9/5gk5h96gg6zpw4bi64mq1guopom.png"><br><br>  Ap√≥s a sua remo√ß√£o, n√£o teremos links esquerdo e direito?  De fato, ainda existem links do fechamento. <br><br><img src="https://habrastorage.org/webt/hy/s0/vy/hys0vysevtslyjbht0gjngdaqaq.png"><br><br>  √â importante que n√£o haja links da esquerda para a direita; portanto, tudo, exceto a janela, √© lixo e ele morre. <br><br>  <strong>Nota importante</strong> : h√° refer√™ncias circulares no lixo, ou seja, objetos que se referem um ao outro.  A presen√ßa desses links n√£o afeta nada, porque o coletor de lixo n√£o coleta objetos individuais, mas todo o lixo. <br><br><img src="https://habrastorage.org/webt/hl/qq/4f/hlqq4fn3nlubl4aefqycqyi4v8u.png"><br><br>  Vimos os exemplos e agora, em um n√≠vel intuitivo, entendemos o que √© lixo, mas vamos dar uma defini√ß√£o completa do conceito. <br><br><blockquote>  Lixo √© tudo que n√£o √© um objeto vivo. <br></blockquote><br>  Tudo ficou muito claro.  Mas o que √© um objeto vivo? <br><br>  <strong>Um objeto vivo √© um objeto que pode ser acessado por links do objeto raiz.</strong> <br><br>  Dois novos conceitos aparecem: "siga links" e "objeto raiz".  Um objeto raiz que j√° conhecemos √© window, ent√£o vamos come√ßar com os links. <br><br><h3>  O que significa seguir os links? <br></h3><br>  Existem muitos objetos relacionados entre si e que se referem um ao outro.  Vamos acenar ao longo deles, come√ßando com o objeto raiz. <br><br>  Inicializamos o primeiro passo e, em seguida, procedemos de acordo com o seguinte algoritmo: digamos que tudo na crista da onda seja objetos vivos e vejamos a que eles se referem. <br><br><img src="https://habrastorage.org/webt/qd/vc/gv/qdvcgvf0tjyk-i85yx9_yzivgs8.png"><br><br>  Inicializamos o primeiro passo.  Em seguida, agiremos de acordo com o seguinte algoritmo: digamos que tudo que est√° amarelo na crista da onda seja um objeto vivo e vejamos a que eles se referem. <br><br>  A que eles se referem, faremos uma nova crista da onda: <br><br><img src="https://habrastorage.org/webt/k-/5p/bz/k-5pbzevhodbxxsj1ktayvgio34.png"><br><br>  Conclu√≠do e come√ßar de novo: <br><br><ul><li>  Estamos revivendo. </li><li>  N√≥s olhamos para o que eles se referem. </li><li>  Crie uma nova crista de onda, anime objetos. </li><li>  N√≥s olhamos para o que eles se referem. </li></ul><br><img src="https://habrastorage.org/webt/nd/bb/8d/ndbb8dwnwadhclwfucgkozu42ea.png"><br><br>  Percebendo que uma flecha aponta para um objeto j√° vivo, simplesmente n√£o fazemos nada.  Ainda de acordo com o algoritmo, at√© que os objetos a percorrer sejam esgotados.  Ent√£o dizemos que encontramos todos os objetos vivos e todo o resto √© lixo. <br><br><img src="https://habrastorage.org/webt/pw/ms/6z/pwms6zisv2hasovzir04jtjna0k.png"><br><br>  Esse processo √© chamado de <strong>marca√ß√£o</strong> . <br><br><h3>  O que o objeto raiz significa? <br></h3><br><br><ul><li>  Janela </li><li>  Quase todas as APIs do navegador. </li><li>  Toda promessa. </li><li>  Tudo o que √© colocado em Microtask e Macrotask. </li><li>  Observadores de muta√ß√£o, RAF, retornos de chamada ociosa.  Tudo o que pode ser alcan√ßado a partir do que est√° no RAF n√£o pode ser exclu√≠do, porque se voc√™ excluir o objeto usado no RAF, provavelmente haver√° algo errado. </li></ul><br>  A montagem pode ocorrer a qualquer momento.  Toda vez que chaves ou fun√ß√µes aparecem, um novo objeto √© criado.  Pode n√£o haver mem√≥ria suficiente, e o coletor ir√° procurar de gra√ßa: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b, c</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y, z</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = {}; <span class="hljs-comment"><span class="hljs-comment">// nomem, run gc D: // ‚Ä¶ } while (whatever()) bar(); }</span></span></code> </pre><br>  Nesse caso, os objetos raiz ser√£o tudo na pilha de chamadas.  Se voc√™, por exemplo, parar na linha com X e excluir o que Y se refere, seu aplicativo falhar√°.  JS n√£o nos permite tais frivolidades, portanto voc√™ n√£o pode excluir um objeto de Y. <br><br>  Se a parte anterior parecia complicada, ser√° ainda mais dif√≠cil. <br><br><h2>  Realidade dura <br></h2><br>  Vamos falar sobre o mundo das m√°quinas em que lidamos com ferro, com m√≠dia f√≠sica. <br><br>  A mem√≥ria √© uma grande matriz na qual apenas n√∫meros est√£o, por exemplo: new Uint32Array (16 * 2 ** 30). <br><br>  Vamos criar objetos na mem√≥ria e adicion√°-los da esquerda para a direita.  Criamos um, segundo, terceiro - todos s√£o de tamanhos diferentes.  Colocamos links ao longo do caminho. <br><img src="https://habrastorage.org/webt/rg/ly/oy/rglyoyk5kjjz0re9ktp1m7r0dtg.png"><br><br>  No s√©timo objeto, o local terminou, porque temos 2 quadrados livres, mas precisamos de 5. <br><br>  O que pode ser feito aqui?  A primeira op√ß√£o √© travar.  No quintal de 2018, todos t√™m os √∫ltimos MacBooks e 16 GB de RAM.  N√£o h√° situa√ß√µes em que n√£o h√° mem√≥ria! <br><br>  No entanto, deixar as coisas seguirem seu curso √© uma p√©ssima id√©ia, porque na web isso leva a uma tela semelhante: <br><br><img src="https://habrastorage.org/webt/un/lw/gn/unlwgnwcw1-7p5xunjhvo2hfwzg.png"><br><br>  Este n√£o √© o comportamento que queremos do programa, mas em geral √© v√°lido.  H√° uma categoria de colecionadores chamada <strong>No-op</strong> . <br><br><h3>  Coletor n√£o operacional <br></h3><br>  Pr√≥s: <br><br><ul><li>  O colecionador √© muito simples. </li><li>  Simplesmente n√£o h√° coleta de lixo. </li><li>  N√£o h√° necessidade de escrever ou pensar em mem√≥ria. </li></ul><br>  Contras: <br><br><ul><li>  Tudo cai para que nunca mais suba. </li></ul><br>  Para o front-end, o coletor n√£o operacional √© irrelevante, mas √© usado no back-end.  Por exemplo, tendo v√°rios servidores atr√°s dos balanceadores, o aplicativo recebe 32 GB de RAM e, em seguida, √© completamente eliminado.  √â mais simples e o desempenho √© aprimorado apenas reiniciando quando a mem√≥ria fica baixa. <br><br>  Na web, √© imposs√≠vel e voc√™ precisa limp√°-lo. <br><br><h3>  Pesquisar e excluir lixo <br></h3><br>  Come√ßamos a limpar com lixo.  N√≥s j√° sabemos como faz√™-lo.  Lixo - objetos C e F no esquema anterior, porque voc√™ n√£o pode alcan√ß√°-los ao longo das setas do objeto raiz. <br><br>  Pegamos esse lixo, alimentamos com o amante do lixo e pronto. <br><br><img src="https://habrastorage.org/webt/g8/1l/s1/g81ls1ji6sco7buvbftj6xgr714.png"><br><br>  Ap√≥s a limpeza, o problema n√£o √© resolvido, pois os furos permanecem na mem√≥ria.  Observe que existem 7 quadrados livres, mas 5 deles ainda n√£o podemos alocar.  Ocorreu fragmenta√ß√£o e a montagem terminou.  Esse algoritmo com furos √© chamado de <strong>Mark and Sweep</strong> . <br><br><h3>  Marcar e varrer <br></h3><br>  Pr√≥s: <br><br><ul><li>  Um algoritmo muito simples.  Uma das primeiras que voc√™ aprender√° se come√ßar a aprender sobre o coletor de lixo. </li><li>  Funciona proporcionalmente √† quantidade de lixo, mas s√≥ lida quando h√° pouco lixo. </li><li>  Se voc√™ tem apenas objetos vivos, ele n√£o perde tempo e simplesmente n√£o faz nada. </li></ul><br>  Contras: <br><br><ul><li>  Requer l√≥gica complexa para procurar espa√ßo livre, porque quando h√° muitos buracos na mem√≥ria, √© necess√°rio tentar um objeto em cada um para entender se ele se encaixa ou n√£o. </li><li>  Fragmenta a mem√≥ria.  Pode ocorrer uma situa√ß√£o em que, com 200 MB livres, a mem√≥ria √© dividida em pequenos peda√ßos e, como no exemplo acima, n√£o h√° um peda√ßo s√≥lido de mem√≥ria para o objeto. </li></ul><br>  Estamos √† procura de outras ideias.  Se voc√™ olhar para a figura e pensar, o primeiro pensamento √© mudar tudo para a esquerda.  √Ä direita, haver√° uma pe√ßa grande e livre, na qual nosso objeto se ajustar√° calmamente. <br><br>  Existe um algoritmo desse tipo e √© chamado de <strong>Mark e Compact</strong> . <br><br><h3>  Marca e compacta <br></h3><br>  Pr√≥s: <br><br><ul><li>  Desfragmente a mem√≥ria. </li><li>  Funciona proporcionalmente ao n√∫mero de objetos vivos, o que significa que pode ser usado quando praticamente n√£o h√° detritos. </li></ul><br>  Contras: <br><br><ul><li>  Dif√≠cil no trabalho e na implementa√ß√£o. </li><li>  Move objetos.  N√≥s movemos o objeto, copi√°mo-lo, agora ele est√° em um local diferente e toda a opera√ß√£o √© bastante cara. </li><li>  Requer 2-3 passagens na mem√≥ria, dependendo da implementa√ß√£o - o algoritmo √© lento. </li></ul><br>  Aqui chegamos a outra ideia. <br><br><h3>  A coleta de lixo n√£o √© gratuita <br></h3><br>  Nas APIs de alto desempenho, como WebGL, WebAudio e WebGPU, que ainda est√£o em desenvolvimento, os objetos s√£o criados e exclu√≠dos em fases separadas.  Essas especifica√ß√µes foram escritas para que a coleta de lixo n√£o esteja em andamento.  Al√©m disso, n√£o h√° nem promessa l√°, mas pull () - voc√™ apenas pergunta a cada quadro: ‚ÄúAlgo aconteceu ou n√£o?‚Äù. <br><br><h3>  Semispace aka Lisp 2 <br></h3><br>  H√° outro colecionador sobre o qual quero falar.  E se voc√™ n√£o liberar mem√≥ria, mas copiar todos os objetos vivos de algum lugar para outro lugar. <br><br>  Vamos tentar copiar o objeto raiz "como est√°", que se refere a algum lugar. <br><br><img src="https://habrastorage.org/webt/oe/ck/uc/oeckucvn6dpbz9hgbg3ykkzmylm.png"><br><br>  E ent√£o todo mundo. <br><br><img src="https://habrastorage.org/webt/rf/ds/9x/rfds9xc3v1tp6pvlpokawj8pkn0.png"><br><br>  N√£o h√° detritos ou furos na mem√≥ria acima.  Tudo parece estar bem, mas surgem dois problemas: <br><br><ul><li>  Objetos duplicados - temos dois objetos verdes e dois azuis.  Qual usar? </li><li>  Links de novos objetos levam a objetos antigos, e n√£o um ao outro. </li></ul><br>  Com os links, tudo √© resolvido com a ajuda de uma ‚Äúm√°gica‚Äù algor√≠tmica especial, e podemos lidar com a duplica√ß√£o de objetos excluindo tudo abaixo. <br><img src="https://habrastorage.org/webt/cq/sr/ur/cqsrurkhqp_b01qsxjhzndggryg.png"><br><br>  Como resultado, temos espa√ßo livre e apenas objetos vivos na ordem normal acima.  Esse algoritmo √© chamado <strong>Semispace</strong> , <strong>Lisp 2,</strong> ou simplesmente o "coletor de c√≥pias". <br><br>  Pr√≥s: <br><br><ul><li>  Desfragmente a mem√≥ria. </li><li>  Simples. </li><li>  Pode ser combinado com uma fase de deriva√ß√£o. </li><li>  Funciona proporcionalmente ao n√∫mero de objetos vivos ao longo do tempo. </li><li>  Funciona bem quando h√° muito lixo.  Se voc√™ tiver 2 GB de mem√≥ria e 3 objetos, ignorar√° apenas 3 objetos e os 2 GB restantes parecem ter acabado. </li></ul><br>  Contras: <br><br><ul><li>  Consumo de mem√≥ria dupla.  Voc√™ usa a mem√≥ria 2 vezes mais que o necess√°rio. </li><li>  Mover objetos tamb√©m n√£o √© uma opera√ß√£o muito barata. </li></ul><br><blockquote>  Nota: coletores de lixo podem mover objetos. <br></blockquote><br>  Na web, isso √© irrelevante, mas no Node.js √© bastante.  Se voc√™ escrever a extens√£o em C ++, o idioma n√£o saber√° tudo sobre isso; portanto, haver√° links duplos l√° chamados handle e se parecer√£o com isso: v8 :: Local &lt;v8 :: String&gt;. <br><br>  Portanto, se voc√™ estiver escrevendo plugins para o Node.js, as informa√ß√µes ser√£o √∫teis. <br><br>  Resumimos os diferentes algoritmos com seus pr√≥s e contras na tabela.  Ele tamb√©m tem um algoritmo Eden, mas mais tarde. <br><br><img src="https://habrastorage.org/webt/s9/zm/ec/s9zmecoite95yruxuvtafbzaimy.png"><br><br>  Eu realmente quero um algoritmo sem contras, mas isso n√£o √©.  Portanto, tomamos o melhor de todos os mundos: usamos v√°rios algoritmos ao mesmo tempo.  Em um peda√ßo de mem√≥ria, coletamos lixo com um algoritmo e em outro com outro algoritmo. <br><br>  Como entender a efic√°cia do algoritmo em tal situa√ß√£o? <br><br>  Podemos usar o conhecimento de maridos inteligentes dos anos 60 que analisaram todos os programas e perceberam: <br><br><blockquote>  Hip√≥tese geracional fraca: a maioria dos objetos morre jovem. <br></blockquote><br>  Eles queriam dizer que todos os programas apenas produzem lixo.  Na tentativa de usar o conhecimento, chegaremos ao que √© chamado de ‚Äúassembl√©ia por gera√ß√µes‚Äù. <br><br><h3>  Montagem geracional <br></h3><br>  Criamos dois peda√ßos de mem√≥ria que n√£o est√£o conectados de forma alguma: √† esquerda √© Eden e √† direita est√° lento Mark and Sweep.  No √âden, criamos objetos.  Muitos objetos. <br><br><img src="https://habrastorage.org/webt/_y/rt/tc/_yrttco6brh1zyz4sqkiuk4wrjo.png"><br><br>  Quando o Eden diz que est√° cheio, iniciamos a coleta de lixo.  Encontramos objetos ativos e os copiamos para outro colecionador. <br><br><img src="https://habrastorage.org/webt/38/si/a5/38sia5sg1nhfx6elimcuitdpqok.png"><br><br>  O pr√≥prio Eden √© completamente limpo, e podemos adicionar objetos a ele. <br><br><img src="https://habrastorage.org/webt/pp/qc/3_/ppqc3_uk1okblort71qjndj7ije.png"><br><br>  Baseando-se na hip√≥tese de gera√ß√µes, decidimos que os objetos c, g, i provavelmente viver√£o por muito tempo e voc√™ poder√° verific√°-los com menos frequ√™ncia.  Conhecendo essa hip√≥tese, voc√™ pode escrever programas que enganam o coletor.  Isso pode ser feito, mas n√£o o aconselho, porque quase sempre leva a efeitos indesej√°veis.  Se voc√™ criar lixo de longa dura√ß√£o, o coletor come√ßar√° a acreditar que ele n√£o precisa ser coletado. <br><br>  Um exemplo cl√°ssico de trapa√ßa √© o cache LRU.  Um objeto fica no cache por um longo tempo, o coletor o observa e acredita que ainda n√£o o coletar√°, porque o objeto permanecer√° por muito tempo.  Em seguida, um novo objeto entra no cache e um grande e antigo √© empurrado para fora dele e n√£o √© mais poss√≠vel montar imediatamente esse objeto grande. <br><br>  Como coletar agora sabemos.  Fale sobre quando coletar. <br><br><h3>  Quando recolher? <br></h3><br>  A op√ß√£o mais f√°cil √© quando <strong>simplesmente paramos tudo</strong> , iniciamos a constru√ß√£o e, em seguida, iniciamos o trabalho JS novamente. <br><br><img src="https://habrastorage.org/webt/e-/1n/od/e-1nodx10w_v6q7x5w7xi9xdfvk.png"><br><br>  Nos computadores modernos, mais de um segmento de execu√ß√£o.  Na Web, isso √© familiar dos Trabalhadores da Web.  Por que n√£o tomar e <strong>paralelizar o processo de montagem</strong> .  Executar v√°rias opera√ß√µes pequenas ao mesmo tempo ser√° mais r√°pida que uma opera√ß√£o grande. <br><br><img src="https://habrastorage.org/webt/y6/yw/jh/y6ywjhxlis6qhu7kk5cumaruayu.png"><br><br>  Outra id√©ia √© fazer uma captura instant√¢nea do estado atual com cuidado e <strong>construir em paralelo com JS</strong> . <br><br><img src="https://habrastorage.org/webt/lm/fd/3w/lmfd3w2kiyhtxlwvp1wtlges6ia.png"><br><br><blockquote>  Se isso lhe interessa, recomendo que voc√™ leia: <br><br><ul><li>  O √∫nico e principal livro de montagem, Garbage Collection Handbook. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> como um recurso universal. </li><li>  Site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">memorymanagement.org.</a> </li><li>  Relat√≥rios e artigos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Alexander Shepelev</a> .  Ele fala sobre Java, mas em termos de lixo, Java e V8 funcionam aproximadamente da mesma forma. </li></ul></blockquote><br><h2>  Realidade do navegador <br></h2><br>  Vamos seguir como os navegadores usam tudo o que falamos. <br><br><h3>  Motores IoT <br></h3><br>  Vamos come√ßar n√£o com navegadores, mas com os mecanismos da Internet das Coisas: JerryScript e Duktape.  Eles usam os algoritmos Mark'n'sweep e Stop the world. <br><br>  Os mecanismos de IoT funcionam em microcontroladores, o que significa: o idioma √© lento;  segundo trava;  fragmenta√ß√£o  e tudo isso para um bule com ilumina√ß√£o :) <br><br>  Se voc√™ escreve Internet of Things em JavaScript, conte-nos nos coment√°rios?  existe algum ponto <br><br>  Vamos deixar os mecanismos de IoT em paz, estamos interessados ‚Äã‚Äãem: <br><br><ul><li>  V8. </li><li>  SpiderMonkey  Na verdade, ele n√£o tem um logotipo.  Logotipo caseiro :) </li><li>  JavaScriptCore usado pelo WebKit. </li><li>  ChakraCore usado no Edge. </li></ul><br><img src="https://habrastorage.org/webt/vw/0q/nj/vw0qnjkmktvnd2z0_dhrvkw4y_u.png"><br><br>  Todos os motores s√£o aproximadamente os mesmos, ent√£o falaremos sobre o V8, como o mais famoso. <br><br><h3>  V8 <br></h3><br><ul><li>  Quase todo o JavaScript do lado do servidor, porque √© Node.js. </li><li>  Quase 80% do JavaScript do cliente. </li><li>  Os desenvolvedores mais soci√°veis, existem muitas informa√ß√µes e bons c√≥digos-fonte mais f√°ceis de ler. </li></ul><br>  O V8 usa montagem geracional. <br><img src="https://habrastorage.org/webt/u-/-7/r4/u--7r4ggek0kxgpscwhtzn8grfe.png"><br><br>  A √∫nica diferen√ßa √© que t√≠nhamos dois colecionadores e agora tr√™s: <br><br><ul><li>  Um objeto √© criado no √âden. </li><li>  Em algum momento no √âden, h√° muito lixo e o objeto √© transferido para o Semispace. </li><li>  O objeto √© jovem e, quando o colecionador percebe que √© muito velho e chato, o joga no Mark and Sweep, no qual a coleta de lixo √© extremamente rara. </li></ul><br>  Voc√™ pode ver claramente como fica no <strong>rastreamento de mem√≥ria</strong> . <br><br><img src="https://habrastorage.org/webt/c7/s1/av/c7s1avnfboc9c57khyjw5xqjybm.png"><br><br>  V√°rias ondas grandes com ondas pequenas s√£o vis√≠veis.  As pequenas s√£o assembleias menores e as grandes s√£o as principais. <br><br>  O significado de nossa exist√™ncia, de acordo com a hip√≥tese geracional, √© gerar lixo, ent√£o o pr√≥ximo erro √© o medo de criar lixo. <br><br><blockquote>  O lixo pode ser criado quando realmente √© lixo.   ,         ,     ,    . <br></blockquote><br><h4>  mark <br></h4><br>    V8     . <br><img src="https://habrastorage.org/webt/40/dg/j5/40dgj5iiquv7dsag0mndget4s30.png"><br><br>     Stop the world,        ,       JS,        . <br><br><h4>     ? <br></h4><br>  1  3%,    . <br><br>  3% = 1/33     GameDev.  GameDev 3%  1 ,    .   GameDev     . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pool = [<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bullet(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bullet(), <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFromPool</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bullet = pool.find(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> !x.inUse); bullet.isUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bullet; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returnToPool</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bullet</span></span></span><span class="hljs-function">) </span></span>{ bullet.inUse = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// Frame const bullet = getFromPool(); // ... returnToPool(bullet);</span></span></code> </pre><br>     , , 10 000        . <br><br>    ‚Äî    .          ,         .      ,     . <br><br><h3>   : Chromium <br></h3><br>      , ,  ,   Chromium. <br><br><pre> <code class="javascript hljs">&gt; performance.memory MemoryInfo { <span class="hljs-attr"><span class="hljs-attr">totalJSHeapSize</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span>, <span class="hljs-attr"><span class="hljs-attr">usedJSHeapSize</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span>, <span class="hljs-attr"><span class="hljs-attr">jsHeapSizeLimit</span></span>: <span class="hljs-number"><span class="hljs-number">2330000000</span></span> }</code> </pre><br>  Chromium  <strong>performance.memory</strong>   ,       ,      Chromium  . <br><br> <strong>:</strong> Chromium   2    JavaScript. <br><br>  ,           . <br><br><h3>   : Node <br></h3><br>  Node.js    <strong>process.memoryUsage</strong> ,      . <br><br><pre> <code class="javascript hljs">&gt; process.memoryUsage() { <span class="hljs-attr"><span class="hljs-attr">rss</span></span>: <span class="hljs-number"><span class="hljs-number">22839296</span></span>, <span class="hljs-attr"><span class="hljs-attr">heapTotal</span></span>: <span class="hljs-number"><span class="hljs-number">10207232</span></span>, <span class="hljs-attr"><span class="hljs-attr">heapUsed</span></span>: <span class="hljs-number"><span class="hljs-number">5967968</span></span>, <span class="hljs-attr"><span class="hljs-attr">external</span></span>: <span class="hljs-number"><span class="hljs-number">12829</span></span> }</code> </pre><br> ,  -         ,    .          .     . <br><br><h3>  <br></h3><br> <strong> </strong> ‚Äî    ,         .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">proposal</a> ,      . <br><br>    Node.js,    c <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">node-weak</a>   , ,  . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cached = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakRef(myJson); <span class="hljs-comment"><span class="hljs-comment">// 2   let json = cached.deref(); if (!json) { json = await fetchAgain(); }</span></span></code> </pre><br>     , ,    -  JS.         ,      ,      ,    . <br><br>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  WebAssembly</a> ,    .   ,              ,     ,      . <br><br><blockquote>     :  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v8.dev</a>    JS. <br></blockquote><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/v8/v8/tree/7.0.237/src/heap</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/servo/mozjs/blob/master/mozjs/js/src/gc/</a> </li><li> <a href="">github.com/WebKit/webkit/.../JavaScriptCore/heap/MarkedSpace.cpp</a> </li><li> <a href="">github.com/Microsoft/ChakraCore/.../HeapAllocator.cpp</a> </li><li> <a href="">github.com/svaarala/duktape/.../duk_heap_markandsweep.c</a> </li><li> <a href="">github.com/jerryscript-project/jerryscript/.../ecma-gc.c</a> </li></ul><br>        ? <br><br><h2>  <br></h2><br>    DevTools    : <strong>Performance</strong>  <strong>Memory</strong> .     Chromium,     ,   Firefox  Safari  . <br><br><h3>  Performance <br></h3><br>   Trace,   ¬´Memory¬ª    Performance,    JS     . <br><br><img src="https://habrastorage.org/webt/vm/8b/hn/vm8bhnnurkvza6cquinxa61ema8.png"><br><br>     JS      V8     ,   .     .  ,  GC    30   1200  JS,   1/40. <br><br><h3>  Memory <br></h3><br>          . <br><br><img src="https://habrastorage.org/webt/1i/cl/br/1iclbrk21tcz3lmj472ukb5jwqc.png"><br><br>    . <br><br><img src="https://habrastorage.org/webt/fy/6i/0v/fy6i0v3tu6yq2onfzuz7ma7moks.png"><br><br>     ,           .    , ,  ,  V8   ,      .     ,     . <br><br> , ,  Q (   compiled code) ‚Äî  React    .   ,   ? <br><br>    ,     ,             ,    . <br><br>     ,    . <br><br><img src="https://habrastorage.org/webt/-3/z_/si/-3z_si-wvtfdlbz87myro38qz1s.png"><br><br>     ,     ,   ,         .   ,    ‚Äî  4     .  ,  . <br><br><img src="https://habrastorage.org/webt/pr/un/bt/prunbtssbfjjsklugfzwp2mv778.png"><br><br>      React,       - :         . ,   JSX. <br><br>  Performance  Memory   ,   : <br><br><ul><li>  Chromium: about:tracing. </li><li>  Firefox: about:memory  about:performance,    . </li><li>   Node ‚Äî trace-gc, ‚Äîexpose-gc, require('trace_events').  trace_events    . </li></ul><br><h2>  Sum√°rio <br></h2><br><ul><li>   ,    ,    ,   . </li><li>                . </li><li>    .   ,      ? </li><li>   ,       -        . </li><li>     SPA,     ,    1       ,   . </li><li>   ,       -   . </li></ul><br>    : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">flapenguin.me</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Twitter</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> . <br><br><blockquote>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  -</a>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">++</a> .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong></strong></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>YouTube-</strong> <br></a> . <br><br>     ,     2018 ,     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Frontend Conf</a> 2018. <br><br>     ,   :) <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433318/">https://habr.com/ru/post/pt433318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433302/index.html">Primeiros Passos para Ferrugem</a></li>
<li><a href="../pt433304/index.html">Teste de carga com gafanhoto. Parte 3</a></li>
<li><a href="../pt433306/index.html">Visual studio 2019</a></li>
<li><a href="../pt433308/index.html">Transferindo a configura√ß√£o do PBX para o servi√ßo 3CX PBX Express</a></li>
<li><a href="../pt433316/index.html">Resumo do projeto: integra√ß√£o, feedback, busca de id√©ias e tomada de decis√£o</a></li>
<li><a href="../pt433320/index.html">Layout da grade como base dos layouts modernos</a></li>
<li><a href="../pt433322/index.html">API JSON - trabalhamos de acordo com a especifica√ß√£o</a></li>
<li><a href="../pt433324/index.html">Coletando o pacote de sonhos com o Webpack</a></li>
<li><a href="../pt433326/index.html">Qualidade do c√≥digo</a></li>
<li><a href="../pt433328/index.html">Melhor perder um dia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>