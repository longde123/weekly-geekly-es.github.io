<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìä üÜó üë®üèø‚Äçü§ù‚Äçüë®üèº Wie wir die Great Chinese Firewall durchbohrt haben (Teil 1) üêº ü§òüèº üëßüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 


 In Kontakt Nikita ist ein Systemingenieur von SEMrush . Heute werde ich Ihnen erz√§hlen, wie wir uns der Aufgabe gestellt haben, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir die Great Chinese Firewall durchbohrt haben (Teil 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/458602/"><p>  Hallo allerseits! </p><br><p>  In Kontakt Nikita ist ein <strong>Systemingenieur</strong> von <strong>SEMrush</strong> .  Heute werde ich Ihnen erz√§hlen, wie wir uns der Aufgabe gestellt haben, die Stabilit√§t unseres semrush.com-Dienstes in China sicherzustellen, und auf welche Probleme wir bei seiner Implementierung gesto√üen sind (angesichts des Standorts unseres Rechenzentrums an der Ostk√ºste der USA). </p><br><p>  Dies wird eine gro√üartige Geschichte sein, die in mehrere Artikel unterteilt ist.  Ich werde Ihnen erz√§hlen, wie alles mit uns passiert ist: von einem v√∂llig arbeitsfreien Dienst aus China bis zur Leistung des Dienstes auf dem Niveau seiner amerikanischen Version f√ºr Amerikaner.  Ich verspreche, dass es interessant und n√ºtzlich sein wird.  Also lass uns gehen. </p><br><img src="https://habrastorage.org/webt/cv/6s/sv/cv6ssvuv-od31op6cjnadtw6xsy.png"><br><h2 id="problemy-kitayskogo-interneta">  Chinesische Internetprobleme </h2><br><p>  Selbst die von den Besonderheiten der Netzwerkadministration am weitesten entfernte Person hat mindestens einmal von der <strong>Great Chinese Firewall geh√∂rt</strong> .  √Ñhh, das klingt cool, oder?  Aber was es ist, wie es tats√§chlich funktioniert, ist eine ziemlich komplizierte Frage.  Im Internet finden Sie viele Artikel dazu, aber aus technischer Sicht wird das Ger√§t dieser Firewall nirgendwo beschrieben.  Was jedoch nicht √ºberraschend ist.  Ich gestehe sofort, dass ich aufgrund der Ergebnisse des Arbeitsjahres nicht genau sagen kann, wie es funktioniert, aber ich kann √ºber meine Kommentare und praktischen Schlussfolgerungen berichten.  Und wir werden mit Ger√ºchten √ºber diese Firewall beginnen. </p><a name="habracut"></a><br><p>  Es gibt viele Ger√ºchte √ºber diese Firewall.  Lassen Sie uns die wichtigsten und interessantesten von ihnen in einer Liste zusammenfassen: </p><br><ul><li>  Google, Facebook, Twitter und andere √§hnliche Dienste sind blockiert und funktionieren in China nicht. </li><li>  Jeder Verkehr, der √ºber China hinaus und nach China f√ºhrt, wird durch maschinelles Lernen (bei verd√§chtigem Verkehr) analysiert und begrenzt, wodurch der Verkehr √ºber die Grenze erheblich verlangsamt wird. </li><li>  Chinesische Geheimdienste knacken jeden verschl√ºsselten Verkehr, der durch ihre Firewall geht. </li><li>  VPN-Tunnel, IPSEC-Tunnel sind instabil, fallen und werden st√§ndig blockiert. </li><li>  Je einfacher die Verschl√ºsselung, desto einfacher die f√ºr die Authentifizierung / Verkehrsverschl√ºsselung verwendete Passphrase, desto schneller passiert sie die chinesische Firewall. </li></ul><br><p>  Folgendes haben wir √ºber diese Ger√ºchte herausgefunden: </p><br><ul><li>  Google, Facebook, Twitter und andere √§hnliche Dienste sind wirklich blockiert (Ihr KO), aber viele technische Google-Domains sind beispielsweise nicht gesperrt und funktionieren nicht (dasselbe gstatic.com).  Dies f√ºhrt zu der Schlussfolgerung: Schneiden Sie nicht r√ºcksichtslos alle Google- und anderen Ressourcen aus, die blockiert zu sein scheinen, scheinbar blockiert. </li><li>  Jeder Verkehr, der die Grenze passiert, verl√§ngert die Zeit erheblich.  Schauen Sie sich die beiden Ergebnisse an.  Eine Seite, eine Seite, einfach <em>Curl</em> bekommen.  Die erste Messung aus China selbst (der sch√∂nen Stadt Shenzhen).  Die zweite fror au√üerhalb von Hongkong ein (sie hat Souver√§nit√§t und es gibt keine Firewall zwischen ihr und der Welt).  Die Entfernung zwischen St√§dten in einer geraden Linie betr√§gt etwa 30-40 km. </li></ul><br><pre><code class="bash hljs">nikita@china-shenzhen:~<span class="hljs-comment"><span class="hljs-comment"># curl -o /dev/null -w@curl_time "https://www.semrush.com/info/ebay.com" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 381k 0 381k 0 0 71824 0 --:--:-- 0:00:05 --:--:-- 82832 time_namelookup: 0.004500 time_connect: 0.169342 time_appconnect: 0.723189 time_pretransfer: 0.723499 time_redirect: 0.000000 time_starttransfer: 1.532912 ---------- time_total: 5.443407 ---------- size_download: 390968 Bytes speed_download: 71824.000B/s nikita@china-hongkong:~# curl -o /dev/null -w@curl_time "https://www.semrush.com/info/ebay.com" % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 319k 0 319k 0 0 2555k 0 --:--:-- --:--:-- --:--:-- 2573k time_namelookup: 0.029366 time_connect: 0.030742 time_appconnect: 0.047310 time_pretransfer: 0.047388 time_redirect: 0.000000 time_starttransfer: 0.120793 ---------- time_total: 0.124871 ---------- size_download: 326755 Bytes speed_download: 2616740.000B/s</span></span></code> </pre> <br><p>  <strong>Achten Sie</strong> auf <strong>time_connect</strong> .  Und im Allgemeinen sehen Sie das Ergebnis: Die Firewall f√ºgt 4 zus√§tzliche Sekunden hinzu, was ungeheuer lang ist. </p><br><ul><li>  VPNs und IPSEC-Tunnel fallen h√§ufig aus.  Ich werde etwas sp√§ter und ausf√ºhrlicher dar√ºber sprechen.  VPN-Server, die von Benutzern verwendet werden, werden im Laufe der Zeit blockiert (normalerweise innerhalb eines Tages nach Beginn der Verwendung). </li><li>  In China lebende Menschen sind der Meinung, dass der Verkehr umso schneller √ºber die Grenze gelangt, je einfacher die Verschl√ºsselung ist, da leicht zu verstehen ist, dass darin nichts Illegales enthalten ist.  Und genau wie "sauberer" Verkehr mehr Bandbreite und Geschwindigkeit erh√§lt und "schmutziger" Verkehr, der nichts ausmacht, im Gegenteil langsamer wird.  Als Beispiel werde ich curl mithilfe der Protokolle HTTPS und HTTP zu <em>ifconfig.co</em> bringen. </li></ul><br><pre> <code class="bash hljs">curl -o /dev/null -w@curl_time <span class="hljs-string"><span class="hljs-string">"https://ifconfig.co/"</span></span> % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 13 100 13 0 0 2 0 0:00:06 0:00:05 0:00:01 3 time_namelookup: 0.004305 time_connect: 0.397465 time_appconnect: 5.149305 time_pretransfer: 5.149393 time_redirect: 0.000000 time_starttransfer: 5.568847 ---------- time_total: 5.568893 ---------- size_download: 13 Bytes speed_download: 2.000B/s curl -o /dev/null -w@curl_time <span class="hljs-string"><span class="hljs-string">"http://ifconfig.co/"</span></span> % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 13 100 13 0 0 28 0 --:--:-- --:--:-- --:--:-- 28 time_namelookup: 0.004282 time_connect: 0.212457 time_appconnect: 0.000000 time_pretransfer: 0.212484 time_redirect: 0.000000 time_starttransfer: 0.450565 ---------- time_total: 0.450620 ---------- size_download: 13 Bytes speed_download: 28.000B/s</code> </pre> <br><p>  Die Differenz betr√§gt 5 Sekunden bei einer Gesamtladezeit von 13 Byte.  Wenn Sie diesen Test mehrmals durchf√ºhren, k√∂nnen Sie feststellen, dass GET unter HTTP im Allgemeinen jedes Mal zur gleichen Zeit abgeschlossen wird. Bei Verwendung von HTTPS antwortet die Site manchmal in 3, 5, 10 und sogar 17 Sekunden.  Manchmal treten SSL-Fehler auf: </p><br><p> <code>Unknown SSL protocol error in connection to ifconfig.co:443.</code> </p> <br><p>  Also was wir haben: </p><br><ul><li>  Die Probleme, die durch die oben beschriebene chinesische Firewall verursacht wurden. </li><li>  Pings an externe Ressourcen und interne Tunnel verschwinden regelm√§√üig. </li><li>  Die Latenz zwischen zwei Punkten √§ndert sich st√§ndig und ist oft einfach unvorhersehbar.  Wenn Sie verschiedene St√§dte / Regionen verbinden, erwarten Sie, dass die Verz√∂gerung basierend auf der geografischen Lage der Regionen geringer ist und Sie genau die entgegengesetzte Situation erhalten. </li><li>  Das Internet und die Kommunikationskan√§le sind entweder schnell oder langsam.  Es gibt eine leichte Abh√§ngigkeit von der Tageszeit und dem Wochentag, aber nicht immer. </li><li>  DNS-Abfragen von China an die Au√üenwelt √ºberschreiten manchmal das zul√§ssige Zeitlimit. </li></ul><br><p>  Das Bild ist einfach ‚Äûexzellent‚Äú. </p><br><p>  Das Rechenzentrum befindet sich, wie gesagt, im Osten der USA, und der gesamte SEMrush besteht aus Dutzenden miteinander verbundener Produkte, Backends, Frontends, Datenbanken und all dies im Rechenzentrum und in den Clouds.  Als Team von Systemadministratoren wurden wir mit geringem Aufwand beauftragt, schnell in China zu arbeiten. </p><br><p>  Wir mussten eine wichtige Frage beantworten: K√∂nnen wir mit ein wenig Blut auskommen und alle Probleme l√∂sen, die mit dem chinesischen Internet und der Firewall auf Netzwerk- / Cloud- / Serverebene verbunden sind? </p><br><p>  Wir haben zun√§chst eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>ICP-</strong> Lizenz erhalten</a> . </p><br><h2 id="icp-licenziya">  ICP-Lizenz </h2><br><p>  Um Ihren Service in China (Festlandchina) platzieren und Tests durchf√ºhren zu k√∂nnen, m√ºssen Sie zun√§chst eine ICP-Domain-Lizenz erwerben. </p><br><p>  Wenn der Benutzerverkehr Ihrer Website innerhalb von Festlandchina beendet wird und Ihre Domain keine ICP-Lizenz besitzt, wird Ihr Datenverkehr auf der Anbieter- / Hosting-Seite blockiert.  Interessanterweise passt ein bestimmter Anbieter in die ICP-Lizenz, sei es Cloudflare oder Alibaba Cloud.  Wenn Sie eine ICP-Lizenz f√ºr Cloudflare erhalten und Ihre Site mit diesen gehostet haben, k√∂nnen Sie daher nicht ‚Äûnahtlos‚Äú zu Alibaba Cloud wechseln.  Es ist erforderlich, dieser Lizenz ein weiteres Hosting hinzuzuf√ºgen. </p><br><p>  Nachdem wir eine ICP-Domain-Lizenz erhalten hatten, konnten wir spezifische technische Ideen und L√∂sungen entwickeln und umsetzen. </p><br><h2 id="testirovanie-resheniy">  Testl√∂sungen </h2><br><p>  Bevor Sie jedoch direkt die Optionen f√ºr die Bereitstellung erstellen, die Kn√∂pfe drehen, die Site und ihre Geschwindigkeit optimieren, m√ºssen Sie ein Tool zum Testen ausw√§hlen, um festzustellen, welche Aktionen die Site verbessern oder verschlechtern. </p><br><p>  Unser Testwerkzeug musste zwei Hauptanforderungen erf√ºllen: </p><br><ul><li>  er sollte in der Lage sein, Tests aus China durchzuf√ºhren, </li><li>  Es muss Browsertests haben. </li></ul><br><p>  Also haben wir den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fangpunkt gefunden</a> !  Sie haben eine hervorragende Abdeckung mit Testpunkten auf der ganzen Welt.  In China k√∂nnen Sie mit diesem Tool auch Tests aus 100.500 Provinzen durchf√ºhren.  In jedem <strong>Fall</strong> mehrere verschiedene Anbieter + die M√∂glichkeit, <strong>Backbone-</strong> Tests (so etwas wie eine <strong>virtuelle</strong> Maschine in einem Rechenzentrum) und <strong>Lastmile-</strong> Tests (so nah wie m√∂glich an den Benutzerbedingungen, auch bekannt als Workstation) durchzuf√ºhren.  Die letztere Art von Test ist teurer. </p><br><p>  Nachdem wir einen Einjahresvertrag abgeschlossen haben (Sie k√∂nnen nicht weniger tun), haben wir begonnen, das Tool zu studieren.  Ehrlich gesagt waren wir angenehm √ºberrascht von seiner Funktionalit√§t.  Sie k√∂nnen ausf√ºhren: </p><br><ul><li>  DNS-Tests </li><li>  Webtests (Browser, einfaches GET / POST, Emulation eines mobilen Clients usw.), </li><li>  Transaktionspr√ºfungen (z. B. Login), </li><li>  API-Tests </li><li>  Ping, Traceroute, NTP usw. </li></ul><br><p>  Sie k√∂nnen nicht alles auflisten.  Und am wichtigsten ist, dass jeder Test durch Hinzuf√ºgen einer Reihe von Headern und anderen Parametern ziemlich gut angepasst werden kann.  Die Ausgabe ist eine riesige Menge an Informationen, die Ihren Test vollst√§ndig beschreiben.  Wenn wir √ºber das f√ºr uns interessanteste sprechen (Browsertests), dann beinhaltet das Ergebnis: </p><br><ul><li>  Verbinden, Warten, Laden, SSL, DNS-Zeit, </li><li>  TTFB, TTLB, Dokument vollst√§ndig, Renderzeit, DOM-Laden, </li><li>  Antwort (etwas in der N√§he von Time To First Byte), Webseitenantwort (etwas in der N√§he von Time To Last Byte), </li><li>  Beliebiges Perzentil, Durchschnitt, Medianzeit </li><li>  Usw. </li></ul><br><p>  Dementsprechend helfen Ihnen all diese Metriken, die √Ñnderungen zu erkennen und zu verstehen, ob sie besser geworden sind.  Wir haben uns haupts√§chlich <strong>Response, Webpage Response, Median, 75 und 95 Perzentile angesehen</strong> . </p><br><p>  Eine wichtige Frage, die von Anfang an in der Luft lag: <strong>Kann man Catchpoint glauben</strong> ?  Entspricht dieses Tool der tats√§chlichen Ladegeschwindigkeit der Website in China aus verschiedenen St√§dten oder handelt es sich nur um eine Art Test in einem Vakuum, der nichts mit der tats√§chlichen Benutzererfahrung zu tun hat? <br>  Dies ist ein gro√ües Problem, da es fast unm√∂glich ist, in Russland zuverl√§ssig herauszufinden, wie die Website aus China funktioniert.  Wenn Sie Socken-Proxy √ºber eine virtuelle Maschine ausf√ºhren, wird am Ende in wenigen Minuten eine Website geladen, was f√ºr Tests einfach nicht akzeptabel ist. Die einzige Option f√ºr manuelle Tests sind Curl und einfache GETs von der Konsole mit Zeitmessung.  Dies ist hilfreich, da dieser Test die Geschwindigkeit der Netzwerkl√∂sung widerspiegelt und bei Browsertests sehr gut ist. </p><br><p>  Sp√§ter gingen wir selbst nach China und stellten sicher, dass <strong>Catchpoint vertrauensw√ºrdig ist. Es spiegelt die tats√§chlichen Geschwindigkeitsindikatoren ziemlich genau wider.</strong> </p><br><h2 id="cloudflare-china-network">  Cloudflare China Netzwerk </h2><br><p>  Da wir Cloudflare erfolgreich f√ºr die Hauptdom√§ne semrush.com verwenden, haben wir uns entschlossen, die Funktion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">China Network</a> sofort auszuprobieren.  Diese Option ist nur f√ºr Enterprise-Sites auf Anfrage und gegen eine Geb√ºhr aktiviert.  Es ist auch nur f√ºr Websites verf√ºgbar, die √ºber die entsprechende ICP-Lizenz verf√ºgen, in der Cloudflare als Anbieter angegeben ist.  Nach seiner Aufnahme wird das ‚Äûchinesische CDN‚Äú von Cloudflare f√ºr die Site verf√ºgbar - der Verkehr aus chinesischen Regionen landet im n√§chsten PoP (Points of Presence) CF und wird dann √ºber seine Netzwerke oder Netzwerke von Anbietern / Partnern an den Ursprung geliefert. </p><br><p>  Das Schema dieses Pr√ºfstands ist unten dargestellt. </p><br><img src="https://habrastorage.org/webt/zk/hw/um/zkhwumkneyyxkij6gdffhzcl6qw.png"><br><p>  Dies ist eine gro√üartige Option f√ºr uns.  Es stellt sich heraus, dass die zweite Dom√§ne auch f√ºr CF bestimmt ist, wodurch die Anzahl der im Unternehmen verwendeten L√∂sungen nicht erh√∂ht wird und die Infrastruktur praktisch nicht kompliziert wird. </p><br><p>  Wir haben die Browsertests ausgef√ºhrt, und Folgendes ist passiert: </p><br><img src="https://habrastorage.org/webt/cs/wo/hp/cswohpvoexjj3nanyzxloxk2poo.png"><br><p>  Rote Diamanten sind Testdateien.  Die folgenden Dateien sind DNS-Fehler (Timeout beheben).  Die oben genannten Fehler sind Zeit√ºberschreitungen. </p><br><p>  <em>Betriebszeit: 86,6</em> <em><br></em>  <em>Median: 18 Jahre</em> <em><br></em>  <em>75 Perzentil: 29,3 s</em> <em><br></em>  <em>95 Perzentil: 60er Jahre</em> </p><br><p>  Der Median <em>verringerte sich</em> nach dem <em>Entfernen des reCaptcha-</em> Downloads (ein in China blockierter <em>Google-</em> Dienst) von 28 auf 18 Sekunden.  Trotzdem sind dies schreckliche Indikatoren, da der gleiche Test f√ºr semrush.com (aus den USA) f√ºr 95% der Benutzer (aus den USA) weniger als 10 Sekunden auf derselben Seite (Statik + Dynamik) ergab. </p><br><p>  In jedem Test k√∂nnen Sie sich den <em>Wasserfall</em> und andere detailliertere Parameter ansehen.  Wir haben begonnen, die Fehlerursachen zu untersuchen, und wenn f√ºr Zeit√ºberschreitungen alles weniger oder weniger klar ist: Das Internet in China ‚Äûbewegt sich nach unten und bewegt sich dann weg‚Äú. Aus diesem Grund ist die Geschwindigkeit beim Verbinden und Laden von Ressourcen aus dem Ausland instabil und ungleichm√§√üig. Dann haben uns DNS-Fehler sehr √ºberrascht .  Wir haben festgestellt, dass sich die PoPs von Cloudflare tats√§chlich in China befinden. Die Site-Adresse wird in eine einzelne Anycast-IP aufgel√∂st. Die DNS-Server werden jedoch von den USA verwendet, weshalb DNS-Abfragen gezwungen sind, die Grenze zu √ºberschreiten, sodass sie manchmal fehlschlagen. </p><br><p>  Nach der Kl√§rung dieser Frage mit CF stellte sich heraus, dass <strong>sie in China keine eigenen DNS-Server</strong> haben und es noch nicht bekannt ist, wann dies der Fall sein wird. </p><br><p>  Aus diesem Grund haben wir beschlossen, nur Cloudflare-DNS zu testen, und den Cloudflare-Mechanismus f√ºr unsere Site in den Modus " <strong>Nur DNS</strong> " ge√§ndert.  Dies ist ein solcher Modus, wenn Cloudflare keinen Proxy-Verkehr √ºber sich selbst √ºbertr√§gt. Dies bedeutet, dass es keinen DDoS-Schutz, CDN und andere Funktionen bietet und im Modus eines normalen DNS-Servers arbeitet. </p><br><p>  Dieser St√§nder ist in der folgenden Abbildung schematisch dargestellt.  Die Abbildung ber√ºcksichtigt das aufkommende Wissen, dass sich der Cloudflare-DNS-Server hinter der Firewall befindet. </p><br><img src="https://habrastorage.org/webt/ac/w0/r7/acw0r7fgqahq9w2kckq6-myxjky.png"><br><p>  Bei Catchpoint haben wir einfache GET-Tests (ohne Browser) durchgef√ºhrt, bei denen viele Fehler aufgetreten sind.  Der Grund f√ºr sie waren alle die gleichen DNS-Fehler. </p><br><img src="https://habrastorage.org/webt/_w/3c/wu/_w3cwuxv8j9tdeuvp20jblktqoi.png"><br><p>  Wir haben mit dem Debuggen dieser Fehler mit <em>dig begonnen</em> und festgestellt, dass die Adresse bei der ersten Anforderung korrekt ermittelt wurde. Bei wiederholter Anforderung erhalten wir <em>SERVFAIL</em> und werden <em>nicht</em> jedes Mal gefunden.  Was ist das pl√∂tzlich? </p><br><pre> <code class="bash hljs">root@iZwz97n2wgbp61qucbfrjsZ:~<span class="hljs-comment"><span class="hljs-comment"># host semrushchina.cn semrushchina.cn has address 220.170.186.192 Host semrushchina.cn not found: 2(SERVFAIL) root@iZwz97n2wgbp61qucbfrjsZ:~# host semrushchina.cn semrushchina.cn has address 220.170.186.192 Host semrushchina.cn not found: 2(SERVFAIL) root@iZwz97n2wgbp61qucbfrjsZ:~# host semrushchina.cn semrushchina.cn has address 220.170.186.192 Host semrushchina.cn not found: 2(SERVFAIL) root@iZwz97n2wgbp61qucbfrjsZ:~# host semrushchina.cn semrushchina.cn has address 220.170.186.192 Host semrushchina.cn not found: 2(SERVFAIL)</span></span></code> </pre> <br><p>  Wenn Cloudflare NS-Server direkt angefordert werden, treten keine derartigen Fehler auf: </p><br><pre> <code class="bash hljs">root@iZwz97n2wgbp61qucbfrjsZ:~<span class="hljs-comment"><span class="hljs-comment"># for i in `seq 1 2`; do host semrushchina.cn ray.ns.cloudflare.com.; done Using domain server: Name: ray.ns.cloudflare.com. Address: 173.245.59.138#53 Aliases: semrushchina.cn has address 220.170.186.192 semrushchina.cn has address 220.170.186.192 Using domain server: Name: ray.ns.cloudflare.com. Address: 173.245.59.138#53 Aliases: semrushchina.cn has address 220.170.186.192 semrushchina.cn has address 220.170.186.192</span></span></code> </pre> <br><p>  Dies bedeutet, dass das Problem auf der Seite des ‚Äûlokalen‚Äú DNS-Servers oder Anbieterservers liegt. <br>  Weitere Untersuchungen ergaben, dass wir <em>SERVFAIL</em> zur Aufl√∂sung des <em>AAAA-</em> Datensatzes erhalten. </p><br><p>  Es stellte sich heraus, dass Cloudflare, als Cloudflare einen <em>AAAA-</em> Datensatz anforderte, der sich nicht in der Dom√§ne befand, mit einem <em>A-</em> Datensatz antwortete, was ein RFC-Fehler und eine Nicht√ºbereinstimmung ist.  Aus diesem Grund mochte der lokale Resolver ( <em>xxxx</em> ) dies nicht und antwortete auf <em>SERVFAIL</em> .  Im folgenden Protokoll ist dieses Verhalten deutlich sichtbar: </p><br><pre> <code class="bash hljs">root@iZwz97n2wgbp61qucbfrjsZ:~<span class="hljs-comment"><span class="hljs-comment"># dig -t AAAA semrushchina.cn @xxxx ; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; -t AAAA semrushchina.cn @xxxx ;; global options: +cmd ;; Got answer: ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 55467 ;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 4096 ;; QUESTION SECTION: ;semrushchina.cn. IN AAAA ;; Query time: 334 msec ;; SERVER: xxxx#53(xxxx) ;; WHEN: Tue Aug 14 23:38:50 CST 2018 ;; MSG SIZE rcvd: 44 root@iZwz97n2wgbp61qucbfrjsZ:~# dig -t AAAA semrushchina.cn @dana.ns.cloudflare.com. ; &lt;&lt;&gt;&gt; DiG 9.10.3-P4-Ubuntu &lt;&lt;&gt;&gt; -t AAAA semrushchina.cn @dana.ns.cloudflare.com. ;; global options: +cmd ;; Got answer: ;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 63944 ;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; WARNING: recursion requested but not available ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;semrushchina.cn. IN AAAA ;; ANSWER SECTION: semrushchina.cn. 300 IN A 220.170.186.192 ;; Query time: 185 msec ;; SERVER: 173.245.58.105#53(173.245.58.105) ;; WHEN: Tue Aug 14 23:43:03 CST 2018 ;; MSG SIZE rcvd: 60</span></span></code> </pre><br><p>  Wir haben einen Cloudflare-Fehlerbericht gesendet, der nach einer Weile behoben wurde.  Es stellte sich als interessant heraus: Derzeit gibt es in China noch keine IPv6-Unterst√ºtzung, sodass Cloudflare seine IPv6-Adresse nicht als Antwort auf die Anforderung eines <em>AAAA-</em> Datensatzes <em>angeben konnte</em> .  Am Ende wurde alles so entschieden, dass Cloudflare f√ºr China begann, <em>NODATA</em> auf solche Anfragen zu reagieren. </p><br><p>  Daher nahmen die DNS-Fehler in Catchpoint-Tests stark ab, jedoch nicht bis zum Ende.  Timeouts sind auch nicht verschwunden: </p><br><img src="https://habrastorage.org/webt/u5/i7/fj/u5i7fjgo6pb9fl4mddq27uhk9lo.png"><br><p>  Und wir suchten nach einer anderen L√∂sung. </p><br><p>  Im n√§chsten Teil werde ich erz√§hlen, wie wir die chinesische <strong>Alibaba Cloud</strong> getestet haben, wie wir mit Hilfe eines kleinen "magischen" Nginx schnell PoC-L√∂sungen (Proof of Concept) erstellen konnten, wie wir Multi-Cloud-L√∂sungen erstellt haben, von denen eine letztendlich sehr hilfreich war Beschleunigen Sie den Service aus China. </p><br><p>  <strong>Bleib dran!</strong> </p><br><h3 id="vse-chasti">  Alle Teile </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 2</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 3</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458602/">https://habr.com/ru/post/de458602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458584/index.html">11. Juli, Group-IB-Webinar ‚ÄûMalware-Analyse f√ºr Anf√§nger: Grundlegende Ans√§tze‚Äú</a></li>
<li><a href="../de458592/index.html">Von der hohen Ceph-Latenz zum Kernel-Patch mit eBPF / BCC</a></li>
<li><a href="../de458594/index.html">Vergessen Sie nicht, die Wahrscheinlichkeit einer Antwort an den Client durch eine wiederholte Anforderung beim L7-Ausgleich zu erh√∂hen</a></li>
<li><a href="../de458596/index.html">Kleine Freude # 6: OpenAI Gym - Spiele spielen und Roboter steuern</a></li>
<li><a href="../de458600/index.html">Was sind Elektrofahrr√§der (Gruppenbewertung in zwei Teilen von f√ºnf Modellen zweier Hersteller), Teil 1</a></li>
<li><a href="../de458604/index.html">Warum sich die beiden gr√∂√üten Elektronikhersteller zu einem neuen GPU-Projekt zusammengeschlossen haben</a></li>
<li><a href="../de458606/index.html">F√ºhren Sie OpenVPN in Docker in 2 Sekunden aus</a></li>
<li><a href="../de458608/index.html">Node.js Entwicklertools Jobwarteschlange</a></li>
<li><a href="../de458612/index.html">Kosmos. 7 Jahre</a></li>
<li><a href="../de458614/index.html">Erstellen eines Reactive UsePosition () - Hooks zum Abrufen und Verfolgen von Browserkoordinaten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>