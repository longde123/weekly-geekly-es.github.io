<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëäüèæ ü§∏üèø üà∑Ô∏è Des nuages ‚Äã‚Äã√† la terre: comment cr√©er des Kubernetes de production dans n'importe quel environnement üçÆ üå± ü•á</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bon √† tous! Eh bien, le moment est venu pour notre prochain cours Devops . C'est probablement l'un des cours les plus stables et de r√©f√©rence, mais en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Des nuages ‚Äã‚Äã√† la terre: comment cr√©er des Kubernetes de production dans n'importe quel environnement</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/422179/">  Bon √† tous!  Eh bien, le moment est venu pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre</a> prochain <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cours Devops</a> .  C'est probablement l'un des cours les plus stables et de r√©f√©rence, mais en m√™me temps le plus diversifi√© en termes d'√©tudiants, car aucun groupe n'a jamais ressembl√© √† l'autre: dans l'un, les d√©veloppeurs sont presque compl√®tement, puis dans les ing√©nieurs suivants, puis les administrateurs, etc.  Et cela signifie √©galement que le moment est venu de disposer de documents int√©ressants et utiles, ainsi que de r√©unions en ligne. <br><br><img src="https://habrastorage.org/webt/v-/xe/oi/v-xeoia0xxkvb6vuzmclcvknrys.png" alt="image"><a name="habracut"></a><br><br>  Cet article contient des recommandations sur le lancement d'un cluster Kubernetes de production dans un centre de donn√©es sur site ou un emplacement p√©riph√©rique (emplacement p√©riph√©rique). <br>  Que signifie qualit√© de production? <br><br><ul><li>  Installation s√ªre </li><li>  La gestion du d√©ploiement est effectu√©e √† l'aide d'un processus r√©p√©titif et enregistr√©; </li><li>  Le travail est pr√©visible et coh√©rent; </li><li>  Il est s√ªr d'effectuer des mises √† jour et des r√©glages; </li><li>  Pour d√©tecter et diagnostiquer les erreurs et le manque de ressources, il existe une journalisation et une surveillance; </li><li>  Le service a une ¬´haute disponibilit√©¬ª suffisante compte tenu des ressources disponibles, y compris les restrictions d'argent, d'espace physique, d'alimentation, etc. </li><li>  Le processus de r√©cup√©ration est disponible, document√© et test√© pour une utilisation en cas de panne. </li></ul><br>  Bref, la production signifie anticiper les erreurs et pr√©parer la reprise avec un minimum de probl√®mes et de retards. <br><br><img src="https://habrastorage.org/webt/ji/b8/je/jib8jeiekbsaflpgjsteescumgg.png"><br><br>  Cet article concerne le d√©ploiement sur site de Kubernetes sur un hyperviseur ou une plate-forme bare-metal, compte tenu de la quantit√© limit√©e de ressources de support par rapport √† l'augmentation des principaux clouds publics.  N√©anmoins, certaines de ces recommandations peuvent √™tre utiles pour le cloud public si le budget limite les ressources s√©lectionn√©es. <br><br>  Le d√©ploiement d'un Minikube m√©tal nu simple m√©tal nu peut √™tre un processus simple et bon march√©, mais il n'est pas de qualit√© production.  √Ä l'inverse, vous ne pourrez pas atteindre le niveau de Google avec Borg dans un magasin hors ligne, une succursale ou un emplacement p√©riph√©rique, bien qu'il soit peu probable que vous en ayez besoin. <br><br>  Cet article d√©crit des conseils pour r√©aliser un d√©ploiement Kubernetes au niveau de la production, m√™me dans des situations de ressources limit√©es. <br><br>  <b>Composants importants du cluster Kubernetes</b> <br><br>  Avant de plonger dans les d√©tails, il est important de comprendre l'architecture globale de Kubernetes. <br>  Le cluster Kubernetes est un syst√®me hautement distribu√© bas√© sur le plan de contr√¥le et l'architecture des n≈ìuds de travail en cluster, comme indiqu√© ci-dessous: <br><br><img src="https://habrastorage.org/webt/_9/zu/xd/_9zuxdnulbsg6axshrcnxah2x_o.png"><br><br>  En r√®gle g√©n√©rale, les composants du serveur API, du gestionnaire de contr√¥leur et du planificateur sont situ√©s dans plusieurs instances de n≈ìuds de niveau de contr√¥le (appel√©s ma√Ætres).  Les n≈ìuds ma√Ætres incluent √©galement etcd, mais il existe des scripts volumineux et hautement accessibles qui n√©cessitent d'ex√©cuter etcd sur des h√¥tes ind√©pendants.  Les composants peuvent √™tre ex√©cut√©s comme des conteneurs et, √©ventuellement, sous la supervision de Kubernetes, c'est-√†-dire fonctionner comme des foyers statiques. <br><br>  Des instances redondantes de ces composants sont utilis√©es pour la haute disponibilit√©.  L'importance et le niveau de redondance requis peuvent varier. <br><table><tbody><tr><th>  <nobr>Composant</nobr> </th><th>  R√¥les </th><th>  Cons√©quences de la perte </th><th>  Instances recommand√©es </th></tr><tr><td>  etcd </td><td>  Maintient l'√©tat de tous les objets Kubernetes </td><td>  Perte catastrophique de stockage.  Perte de la plupart = Kubernetes perd le niveau de contr√¥le, le serveur API d√©pend de etcd, les appels d'API en lecture seule qui n'ont pas besoin de quorum, comme les charges de travail d√©j√† cr√©√©es, peuvent continuer √† fonctionner. </td><td>  nombre impair, 3+ </td></tr><tr><td>  Serveur API </td><td>  Fournit une API pour une utilisation externe et interne </td><td>  Impossible d'arr√™ter, de d√©marrer et de mettre √† jour de nouveaux pods.  Scheduler et Controller Manager d√©pendent du serveur API.  Les chargements se poursuivent s'ils ne d√©pendent pas des appels d'API (op√©rateurs, contr√¥leurs personnalis√©s, CRD, etc.) </td><td>  2+ </td></tr><tr><td>  kube-scheduler </td><td>  Place les pods sur les n≈ìuds </td><td>  Les pods ne peuvent pas √™tre plac√©s, prioris√©s ou d√©plac√©s entre eux. </td><td>  2+ </td></tr><tr><td>  kube-controller-manager </td><td>  Contr√¥le de nombreux contr√¥leurs </td><td>  Les principales boucles de contr√¥le responsables de l'√©tat cessent de fonctionner.  L'int√©gration dans l'arborescence du fournisseur de cloud est interrompue. </td><td>  2+ </td></tr><tr><td>  cloud-controller-manager (CCM) </td><td>  Int√©gration de fournisseurs de cloud hors arborescence </td><td>  Pauses d'int√©gration des fournisseurs de cloud </td><td>  1 </td></tr><tr><td>  Ajouts (par exemple DNS) </td><td>  Diff√©rent </td><td>  Diff√©rent </td><td>  D√©pend de l'add-on (par exemple 2+ pour DNS) </td></tr></tbody></table><br>  Les risques de ces composants incluent les pannes mat√©rielles, les bogues logiciels, les mauvaises mises √† jour, les erreurs humaines, les interruptions du r√©seau et la surcharge du syst√®me entra√Ænant l'√©puisement des ressources.  La redondance peut r√©duire l'impact de ces dangers.  De plus, gr√¢ce aux fonctionnalit√©s de la plate-forme hyperviseur (planification des ressources, haute disponibilit√©), vous pouvez multiplier les r√©sultats en utilisant le syst√®me d'exploitation Linux, Kubernetes et le runtime du conteneur. <br><br>  Le serveur API utilise plusieurs instances d'√©quilibreur de charge pour atteindre l'√©volutivit√© et la disponibilit√©.  Un √©quilibreur de charge est un composant essentiel pour une haute disponibilit√©.  Plusieurs enregistrements A du serveur API DNS peuvent servir d'alternative en l'absence d'un √©quilibreur. <br><br>  kube-scheduler et kube-controller-manager sont impliqu√©s dans le processus de s√©lection d'un leader au lieu d'utiliser un √©quilibreur de charge.  √âtant donn√© que le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cloud-controller-manager est</a> utilis√© pour certains types d'infrastructure d'h√©bergement, dont la mise en ≈ìuvre peut varier, nous n'en discuterons pas - nous indiquons seulement qu'ils font partie du niveau de gestion. <br><br>  Les pods ex√©cut√©s sur Kubernetes sont g√©r√©s par l'agent kubelet.  Chaque instance du travailleur ex√©cute un agent kubelet et un environnement de lancement de conteneur compatible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CRI</a> .  Kubernetes lui-m√™me est con√ßu pour surveiller et r√©cup√©rer des d√©faillances des n≈ìuds de travail.  Mais pour les fonctions de charge critiques, la gestion des ressources de l'hyperviseur et l'isolation de la charge, il peut √™tre utilis√© pour am√©liorer l'accessibilit√© et augmenter la pr√©visibilit√© de leur travail. <br><br>  <b>etcd</b> <br><br>  etcd est un stockage persistant pour tous les objets Kubernetes.  La disponibilit√© et la r√©cup√©rabilit√© du cluster etcd devraient √™tre une priorit√© absolue lors du d√©ploiement de Kubernetes de niveau production. <br><br>  Le cluster etcd compos√© de cinq n≈ìuds est la meilleure option si vous pouvez l'autoriser.  Pourquoi?  Parce que vous pouvez en entretenir un et en m√™me temps r√©sister √† une panne.  Un cluster de trois n≈ìuds est le minimum que nous pouvons recommander pour un service de qualit√© production, m√™me si un seul hyperviseur h√¥te est disponible.  Plus de sept n≈ìuds sont √©galement d√©conseill√©s, √† l'exception des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tr√®s grandes installations</a> couvrant plusieurs zones d'acc√®s. <br><br>  Les recommandations minimales pour l'h√©bergement d'un n≈ìud de cluster etcd sont 2 Go de RAM et un disque dur SSD de 8 Go.  En r√®gle g√©n√©rale, 8 Go de RAM et 20 Go d'espace disque dur sont suffisants.  Les performances du disque affectent le temps de r√©cup√©ration d'un n≈ìud apr√®s une panne.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Consultez</a> pour plus de d√©tails. <br><br>  <i>Dans des cas particuliers, pensez √† plusieurs clusters etcd</i> <br><br>  Pour les tr√®s grands clusters Kubernetes, envisagez d'utiliser un cluster etcd distinct pour les √©v√©nements Kubernetes afin que trop d'√©v√©nements n'affectent pas le service principal de l'API Kubernetes.  Lorsque vous utilisez le r√©seau Flannel, la configuration est enregistr√©e dans etcd, et les exigences de version peuvent diff√©rer de Kubernetes.  Cela peut compliquer la sauvegarde de etcd, nous vous recommandons donc d'utiliser un cluster etcd distinct sp√©cifiquement pour la flanelle. <br><br>  <b>D√©ploiement sur un seul h√¥te</b> <br><br>  La liste des risques d'accessibilit√© comprend le mat√©riel, les logiciels et le facteur humain.  Si vous √™tes limit√© √† un seul h√¥te, l'utilisation d'un stockage redondant, d'une m√©moire de correction d'erreurs et d'une double alimentation peut am√©liorer la protection contre les pannes mat√©rielles.  L'ex√©cution d'un hyperviseur sur un h√¥te physique vous permet d'utiliser des composants logiciels redondants et ajoute des avantages op√©rationnels associ√©s au d√©ploiement, √† la mise √† jour et √† la surveillance de l'utilisation des ressources.  M√™me dans des situations stressantes, le comportement reste reproductible et pr√©visible.  Par exemple, m√™me si vous ne pouvez autoriser le lancement que de singletones √† partir de services principaux, ils doivent √™tre prot√©g√©s contre la surcharge et l'√©puisement des ressources, en concurrence avec la charge de travail de votre application.  Un hyperviseur peut √™tre plus efficace et plus facile √† utiliser que la priorisation dans le planificateur Linux, les cgroups, les drapeaux Kubernetes, etc. <br><br>  Vous pouvez d√©ployer trois machines virtuelles etcd si les ressources de l'h√¥te le permettent.  Chaque machine virtuelle doit √™tre prise en charge par un p√©riph√©rique de stockage physique distinct ou utiliser des parties distinctes du stockage √† l'aide de la redondance (mise en miroir, RAID, etc.). <br>  Les doubles instances redondantes de l'API du serveur, du planificateur et du gestionnaire de contr√¥leur sont la prochaine mise √† niveau si votre seul h√¥te dispose de suffisamment de ressources pour cela. <br><br>  <i>Options de d√©ploiement sur un seul h√¥te, du moins adapt√© √† la production √† la plupart</i> <br><table><tbody><tr><th>  Tapez </th><th>  CARACT√âRISTIQUES </th><th>  R√©sultat </th></tr><tr><td>  <nobr>√âquipement minimum</nobr> </td><td>  Singleton etcd et composants principaux. </td><td>  Laboratoire √† domicile, pas du tout de production.  Multiple Single Point of Failure (SPOF).  La r√©cup√©ration est lente et lorsque le stockage est perdu, il est compl√®tement absent. </td></tr><tr><td>  Am√©lioration de la redondance du stockage </td><td>  etcd singleton et composants ma√Ætres, le stockage etcd est redondant. </td><td>  Au minimum, vous pouvez r√©cup√©rer d'une panne de p√©riph√©rique de stockage. </td></tr><tr><td>  Redondance de niveau g√©r√©e </td><td>  Il n'y a pas d'hyperviseur, plusieurs instances de composants de niveau g√©r√© dans des modules statiques. </td><td>  La protection contre les bogues logiciels est apparue, mais le syst√®me d'exploitation et l'environnement de lancement du conteneur sont toujours le m√™me point d'√©chec avec des mises √† jour d√©vastatrices. </td></tr><tr><td>  Ajout d'un hyperviseur </td><td>  Ex√©cution de trois instances redondantes de niveau g√©r√© dans la machine virtuelle. </td><td>  Il y a une protection contre les bogues logiciels et les erreurs humaines et un avantage op√©rationnel dans l'installation, la gestion des ressources, la surveillance et la s√©curit√©.  Les mises √† jour du syst√®me d'exploitation et les environnements de lancement de conteneurs sont moins perturbateurs.  L'hyperviseur est le seul point de d√©faillance unique. </td></tr></tbody></table><br>  <b>D√©ploiement sur deux h√¥tes</b> <br><br>  Avec deux h√¥tes, les probl√®mes de stockage etcd sont similaires √† l'option d'h√¥te unique - vous avez besoin de redondance.  Il est pr√©f√©rable d'ex√©cuter trois instances d'encd.  Cela peut sembler peu intuitif, mais il est pr√©f√©rable de concentrer tous les n≈ìuds etcd sur un seul h√¥te.  Vous n'augmenterez pas la fiabilit√© en les divisant par 2 + 1 entre deux h√¥tes - la perte d'un n≈ìud avec la plupart des instances d'encd entra√Ænera un √©chec, qu'il s'agisse d'une majorit√© de 2 ou de 3. Si les h√¥tes ne sont pas les m√™mes, placez l'ensemble du cluster etcd sur le plus fiable. <br><br>  Il est recommand√© d'ex√©cuter des serveurs d'API redondants, des planificateurs de kube et des gestionnaires de contr√¥leur de kube.  Ils doivent √™tre partag√©s entre les h√¥tes pour minimiser les risques d'√©checs dans l'environnement de lancement de conteneur, le syst√®me d'exploitation et le mat√©riel. <br><br>  Le lancement d'une couche d'hyperviseur sur des h√¥tes physiques vous permettra de travailler avec des composants de programme redondants, offrant une gestion des ressources.  Il pr√©sente √©galement l'avantage op√©rationnel d'une maintenance planifi√©e. <br><br>  <i>Options de d√©ploiement pour deux h√¥tes, du moins adapt√© √† la production au plus</i> <br><table><tbody><tr><th>  Tapez </th><th>  CARACT√âRISTIQUES </th><th>  R√©sultat </th></tr><tr><td>  <nobr>√âquipement minimum</nobr> </td><td>  Deux h√¥tes, sans stockage redondant.  Singleton etcd et composants principaux sur le m√™me h√¥te. </td><td>  etcd - un seul point de d√©faillance, cela n'a aucun sens d'en ex√©cuter deux sur d'autres services ma√Ætres.  Le partage entre deux h√¥tes augmente le risque de d√©faillance de la couche g√©r√©e.  L'avantage potentiel d'isoler les ressources en ex√©cutant une couche g√©r√©e sur un h√¥te et des charges de travail d'application sur un autre.  Si le stockage est perdu, il n'y a pas de r√©cup√©ration. </td></tr><tr><td>  Am√©lioration de la redondance du stockage </td><td>  Singleton etcd et composants ma√Ætres sur le m√™me h√¥te, stockage etcd redondant. </td><td>  Au minimum, vous pouvez r√©cup√©rer d'une panne de p√©riph√©rique de stockage. </td></tr><tr><td>  Redondance de niveau g√©r√©e </td><td>  Il n'y a pas d'hyperviseur, plusieurs instances de composants de niveau g√©r√© dans des modules statiques.  cluster etcd sur un h√¥te, les autres composants de niveau g√©r√© sont s√©par√©s. </td><td>  Une panne mat√©rielle, la mise √† jour du micrologiciel, du syst√®me d'exploitation et de l'environnement de lancement de conteneur sur un h√¥te sans etcd sont moins dommageables. </td></tr><tr><td>  Ajout d'un hyperviseur aux deux h√¥tes </td><td>  Trois composants redondants de niveau g√©r√© s'ex√©cutent sur des machines virtuelles, etcd cluster sur un h√¥te, et les composants de niveau g√©r√© sont s√©par√©s.  Les charges de travail d'application peuvent r√©sider sur les deux n≈ìuds de machine virtuelle. </td><td>  Am√©lioration de l'isolation de la charge des applications.  Les mises √† jour du syst√®me d'exploitation et de l'environnement de lancement de conteneur sont moins perturbatrices.  La maintenance planifi√©e du mat√©riel / micrologiciel devient non destructive si l'hyperviseur prend en charge la migration des machines virtuelles. </td></tr></tbody></table><br>  <b>D√©ploiement sur trois h√¥tes (ou plus)</b> <br><br>  Transition vers un service de qualit√© sans compromis.  Nous vous recommandons de diviser etcd entre les trois h√¥tes.  Une d√©faillance mat√©rielle r√©duira la quantit√© de charges de travail d'application possibles, mais n'entra√Ænera pas une interruption compl√®te du service. <br><br>  Les tr√®s grands clusters n√©cessiteront plus d'instances. <br><br>  Le lancement d'une couche d'hyperviseur offre des avantages op√©rationnels et une meilleure isolation des charges de travail des applications.  Cela d√©passe le cadre de l'article, mais au niveau de trois h√¥tes ou plus, des fonctions am√©lior√©es peuvent √™tre disponibles (stockage partag√© redondant en cluster, gestion des ressources avec un √©quilibreur de charge dynamique, surveillance d'√©tat automatis√©e avec migration en direct et basculement). <br><br>  <i>Options de d√©ploiement pour trois h√¥tes (ou plus), du moins adapt√© √† la production au plus</i> <br><table><tbody><tr><th>  Tapez </th><th>  CARACT√âRISTIQUES </th><th>  R√©sultat </th></tr><tr><td>  <nobr>Minimum</nobr> </td><td>  Trois h√¥tes.  Instance etcd sur chaque n≈ìud.  Composants principaux sur chaque n≈ìud. </td><td>  La perte d'un n≈ìud r√©duit les performances, mais n'entra√Æne pas de chute de Kubernetes.  La possibilit√© de r√©cup√©ration demeure. </td></tr><tr><td>  Ajout d'un hyperviseur aux h√¥tes </td><td>  Dans les machines virtuelles sur trois h√¥tes, etcd, un serveur API, des planificateurs et un gestionnaire de contr√¥leurs sont en cours d'ex√©cution.  Les charges de travail s'ex√©cutent dans la machine virtuelle sur chaque h√¥te. </td><td>  Protection suppl√©mentaire contre les bogues du syst√®me d'exploitation / l'environnement de lancement du conteneur / logiciel et les erreurs humaines.  Avantages op√©rationnels de l'installation, de la mise √† niveau, de la gestion des ressources, de la surveillance et de la s√©curit√©. </td></tr></tbody></table><br>  <b>Configurer Kubernetes</b> <br><br>  Les n≈ìuds ma√Ætre et travailleur doivent √™tre prot√©g√©s contre la surcharge et l'√©puisement des ressources.  Les fonctions d'hyperviseur peuvent √™tre utilis√©es pour isoler les composants critiques et r√©server les ressources.  Il existe √©galement des param√®tres de configuration de Kubernetes qui peuvent ralentir des choses comme la vitesse des appels d'API.  Certains kits d'installation et distributions commerciales s'en chargent, mais si vous d√©ployez Kubernetes vous-m√™me, les param√®tres par d√©faut peuvent ne pas convenir, en particulier pour les petites ressources ou pour un cluster trop volumineux. <br><br>  La consommation des ressources au niveau g√©r√© est en corr√©lation avec le nombre de foyers et le taux de sortie des foyers.  Les clusters tr√®s grands et tr√®s petits b√©n√©ficieront de la modification de la requ√™te kube-apiserver et des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">param√®tres de</a> ralentissement de la m√©moire. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les n≈ìuds</a> allouables doivent √™tre configur√©s sur les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">n≈ìuds de travail en</a> fonction de la densit√© de charge prise en charge raisonnable pour chaque n≈ìud.  Des espaces de noms peuvent √™tre cr√©√©s pour diviser un cluster de n≈ìuds de travail en plusieurs clusters virtuels avec des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">quotas</a> de CPU et de m√©moire. <br><br>  <b>La s√©curit√©</b> <br><br>  Chaque cluster Kubernetes poss√®de une autorit√© de certification (CA) racine.  Les certificats Controller Manager, API Server, Scheduler, kubelet client, kube-proxy et administrateur doivent √™tre g√©n√©r√©s et install√©s.  Si vous utilisez un outil d'installation ou une distribution, vous n'aurez peut-√™tre pas √† vous en occuper vous-m√™me.  Le processus manuel est d√©crit <a href="">ici</a> .  Vous devez √™tre pr√™t √† r√©installer les certificats si vous d√©veloppez ou remplacez les n≈ìuds. <br><br>  √âtant donn√© que Kubernetes est enti√®rement g√©r√© par l'API, il est imp√©ratif de contr√¥ler et de limiter la liste de ceux qui ont acc√®s au cluster.  Les options de chiffrement et d'authentification sont d√©crites dans cette documentation. <br><br>  Les charges de travail des applications Kubernetes sont bas√©es sur des images de conteneur.  Vous avez besoin de la source et du contenu de ces images pour √™tre fiables.  Presque toujours, cela signifie que vous h√©bergerez l'image du conteneur dans le r√©f√©rentiel local.  L'utilisation d'images provenant d'Internet public peut entra√Æner des probl√®mes de fiabilit√© et de s√©curit√©.  Vous devez s√©lectionner un r√©f√©rentiel prenant en charge la signature de l'image, la s√©curit√© de la num√©risation, le contr√¥le de l'acc√®s pour envoyer et t√©l√©charger des images et l'activit√© de consignation. <br><br>  Les processus doivent √™tre configur√©s pour prendre en charge l'utilisation de l'h√¥te, de l'hyperviseur, d'OS6, de Kubernetes et d'autres mises √† jour du micrologiciel de d√©pendance.  La surveillance des versions est n√©cessaire pour prendre en charge l'audit. <br><br>  Recommandations: <br><br><ul><li>  Renforcez les param√®tres de s√©curit√© par d√©faut pour les composants de niveau g√©r√© (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">blocage des n≈ìuds de travail</a> ); </li><li>  Utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la politique de s√©curit√© du foyer</a> ; </li><li>  Pensez √† l'int√©gration <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NetworkPolicy</a> disponible pour votre solution r√©seau, y compris le suivi, la surveillance et le d√©pannage; </li><li>  Utilisez RBAC pour prendre des d√©cisions d'autorisation; </li><li>  Pensez √† la s√©curit√© physique, en particulier lors du d√©ploiement sur des emplacements p√©riph√©riques ou distants qui pourraient √™tre n√©glig√©s.  Ajoutez un chiffrement de stockage pour limiter les cons√©quences du vol d'appareils et une protection contre la connexion d'appareils malveillants, tels que des cl√©s USB; </li><li>  Prot√©gez les informations d'identification textuelles du fournisseur de cloud (cl√©s d'acc√®s, jetons, mots de passe, etc.). </li></ul><br>  Les objets <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">secrets</a> Kubernetes conviennent pour stocker de petites quantit√©s de donn√©es sensibles.  Ils sont stock√©s dans etcd.  Ils peuvent √™tre utilis√©s en toute s√©curit√© pour stocker les informations d'identification de l'API Kubernetes, mais il arrive parfois qu'une charge de travail ou l'expansion du cluster lui-m√™me n√©cessite une solution plus compl√®te.  Le projet HashiCorp Vault est une solution populaire si vous avez besoin de plus que ce que les objets secrets int√©gr√©s peuvent fournir. <br><br>  <b>R√©cup√©ration apr√®s sinistre et sauvegarde</b> <br><br><img src="https://habrastorage.org/webt/gv/xp/kd/gvxpkd1qgpap0wosdhv-r4uu-9s.png"><br><br>  La mise en ≈ìuvre de la redondance via l'utilisation de plusieurs h√¥tes et machines virtuelles permet de r√©duire le nombre de certains types de pannes.  Mais des sc√©narios tels qu'une catastrophe naturelle, une mauvaise mise √† jour, une attaque de pirate, des bogues logiciels ou une erreur humaine peuvent toujours entra√Æner des plantages. <br><br>  Un √©l√©ment critique d'un d√©ploiement en production est l'attente d'une future r√©cup√©ration. <br><br>  Il convient √©galement de noter qu'une partie de votre investissement dans la conception, la documentation et l'automatisation du processus de r√©cup√©ration peut √™tre r√©utilis√©e si vous avez besoin de d√©ploiements r√©pliqu√©s √† grande √©chelle sur plusieurs sites. <br><br>  Parmi les √©l√©ments de la reprise apr√®s sinistre, les sauvegardes (et √©ventuellement les r√©pliques), les remplacements, le processus planifi√©, les personnes qui ex√©cuteront ce processus et la formation r√©guli√®re m√©ritent d'√™tre not√©s.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les</a> exercices et principes de test fr√©quents de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chaos Engineering</a> peuvent √™tre utilis√©s pour tester votre √©tat de pr√©paration. <br><br>  En raison des exigences de disponibilit√©, vous devrez peut-√™tre stocker des copies locales du syst√®me d'exploitation, des composants Kubernetes et des images de conteneur pour permettre la r√©cup√©ration m√™me si Internet se bloque.  La possibilit√© de d√©ployer des h√¥tes et des n≈ìuds de remplacement dans une situation d '¬´isolation physique¬ª am√©liore la s√©curit√© et augmente la vitesse de d√©ploiement. <br><br>  Tous les objets Kubernetes sont stock√©s dans etcd.  La sauvegarde p√©riodique des donn√©es de cluster etcd est un √©l√©ment important dans la restauration des clusters Kubernetes pendant les sc√©narios d'urgence, par exemple, lorsque tous les n≈ìuds ma√Ætres sont perdus. <br><br>   etcd       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  etcd           .      Kubernetes    .   ,     Kubernetes. <br><br>   ,    Kubernetes      etcd ,      -  .     ,         . <br><br>       etcd. ,  ,    ,   ,     /.       ,        .           : <br><br><ul><li>    : CA, API Server, Apiserver-kubelet-client,  ServiceAccount, ‚ÄúFront proxy‚Äù,  Front proxy; </li><li>   DNS; </li><li>    IP/; </li><li>   ; </li><li>  kubeconfig; </li><li> LDAP    ; </li><li>      . </li></ul><br> <b>   </b> <br><br> Anti-affinity           .      ,    .  ,  Kubernetes         ,          .     ,              ,    -   . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    </a>          ,  . <br><br>   stateful-,    ‚Äî   Kubernetes    (,   SQL  ). ,   ,  Kubernetes,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">roadmap feature request</a> , ,  ,    Container Storage Interface (CSI).  ,       - ,    ,      . ,      Kubernetes      ,          ,    ,    Kubernetes . <br><br>  stateful- (, Cassandra)        ,    ,    .      - Kubernetes (    -)      . <br><br> <b> </b> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> (    )    ,      ,        .     ,      , . <br><br>        ,    (, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ansible</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BOSH</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chef</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Juju</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">kubeadm</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Puppet</a>  .).        ,          . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> , ,          , ,          ,  ,        .       ,  Git,      . <br><br> <b></b> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> ,     ,       ‚Äî   .     2   ,  ‚Äî   .          ‚Äî         ,    . <br><br> <b> </b> <br><br><img src="https://habrastorage.org/webt/a5/m-/gx/a5m-gxsrhmwpyxxwmcfsnfc8umm.png"><br><br>       ‚Äî    .          - ,    Airbus A320 ‚Äî  .   ,      .    ,   . <br><br>   ,       .   , ,    ,   . Kubernetes     ,    - ,     ,       (, FedEx, Amazon). <br><br>   production-grade  Kubernetes       .               .   , ,     ,    ,     .  ,    (,   Kubernetes   <a href="">self-hosting</a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, pas de foyers statiques). </font><font style="vertical-align: inherit;">Peut-√™tre devraient-elles √™tre discut√©es dans les articles suivants, si l'int√©r√™t est suffisant. </font><font style="vertical-align: inherit;">De plus, en raison de la vitesse √©lev√©e de l'am√©lioration de Kubernetes, si votre moteur de recherche a trouv√© cet article apr√®s 2019, certains de ses documents pourraient d√©j√† √™tre tr√®s obsol√®tes.</font></font><br><br>  LA FIN <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme toujours, nous attendons vos questions et commentaires ici, et vous pouvez vous rendre </font><font style="vertical-align: inherit;">√† la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">journ√©e portes ouvertes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander Titov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422179/">https://habr.com/ru/post/fr422179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422169/index.html">Qu'est-ce que le programme Ada Lovelace a r√©ellement fait?</a></li>
<li><a href="../fr422171/index.html">Comme je l'ai fait avec un onduleur interactif en ligne. 3e partie</a></li>
<li><a href="../fr422173/index.html">L'apprentissage automatique est de plus en plus utilis√© en physique des particules.</a></li>
<li><a href="../fr422175/index.html">La pollution de l'environnement r√©duit les capacit√©s cognitives humaines</a></li>
<li><a href="../fr422177/index.html">Pourquoi Arduino est-il si lent et que peut-on faire pour y rem√©dier</a></li>
<li><a href="../fr422181/index.html">Comment collecter des services d'entreprise sur une seule plateforme en ligne: l'histoire de MegaFon.</a></li>
<li><a href="../fr422183/index.html">Et quoi, pourrait-il √™tre moins cher?</a></li>
<li><a href="../fr422185/index.html">Dans quelle mesure les donn√©es pour la formation sur mod√®le sont-elles (non) similaires √† un √©chantillon de test?</a></li>
<li><a href="../fr422187/index.html">Sberseasons: comment j'ai pass√© cet √©t√©</a></li>
<li><a href="../fr422189/index.html">La v√©rit√© sur la mise en ≈ìuvre du portail intranet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>