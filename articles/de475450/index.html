<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò∑ üëåüèø üêº Telegrammbot f√ºr eine personalisierte Artikelauswahl von Habr üë©üèº üññüèº üõ†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bei Fragen im Stil von "Warum?" Es gibt einen √§lteren Artikel - Natural Geektimes - der den Weltraum sauberer macht . 


 Viele Artikel m√∂gen aus subj...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Telegrammbot f√ºr eine personalisierte Artikelauswahl von Habr</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475450/"><p>  Bei Fragen im Stil von "Warum?"  Es gibt einen √§lteren Artikel - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Natural Geektimes - der den Weltraum sauberer macht</a> . </p><br><p>  Viele Artikel m√∂gen aus subjektiven Gr√ºnden einige nicht, andere im Gegenteil, es ist schade, dies zu verpassen.  Ich m√∂chte diesen Prozess optimieren und Zeit sparen. </p><br><p>  In dem obigen Artikel wurde ein Ansatz mit Skripten im Browser vorgeschlagen, der mir jedoch aus folgenden Gr√ºnden nicht wirklich gefallen hat (obwohl ich ihn zuvor verwendet habe): </p><br><ul><li>  F√ºr verschiedene Browser auf Ihrem Computer / Telefon m√ºssen Sie es erneut konfigurieren, falls dies √ºberhaupt m√∂glich ist. </li><li>  Harte Filterung nach Autoren ist nicht immer bequem. </li><li>  Das Problem mit Autoren, deren Artikel nicht fehlen wollen, auch wenn sie einmal im Jahr ver√∂ffentlicht werden, ist nicht gel√∂st. </li></ul><br><p>  Das Filtern nach in die Site eingebauten Artikelbewertungen ist nicht immer bequem, da hochspezialisierte Artikel f√ºr ihren gesamten Wert eine eher bescheidene Bewertung erhalten k√∂nnen. </p><br><p>  Am Anfang wollte ich RSS-Feeds (oder sogar einige) generieren, wobei ich nur das Interessante dort belassen wollte.  Aber am Ende stellte sich heraus, dass das Lesen von RSS nicht sehr praktisch erschien: Um einen Artikel zu kommentieren, abzustimmen oder zu Favoriten hinzuzuf√ºgen, m√ºssen Sie den Browser durchgehen.  Deshalb habe ich einen Bot f√ºr ein Telegramm geschrieben, das mir interessante Artikel in PM wirft.  Telegramm selbst macht sie sch√∂ne Vorschauen, die in Kombination mit Informationen √ºber den Autor / Bewertung / Ansichten ziemlich informativ aussehen. </p><br><p><img src="https://habrastorage.org/webt/uk/e7/hr/uke7hrnmcthxqqzubouampuvlrw.png"></p><br><p>  Unter dem Schnitt finden sich Details wie Arbeitsmerkmale, Schreibprozess und technische L√∂sungen. </p><a name="habracut"></a><br><h2 id="kratko-o-bote">  Kurz √ºber den Bot </h2><br><p>  Repository: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/Kright/habrahabr_reader</a> </p><br><p>  Telegramm-Bot: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://t.me/HabraFilterBot</a> </p><br><p>  Der Benutzer legt eine zus√§tzliche Bewertung f√ºr Tags und Autoren fest.  Danach wird ein Filter auf die Artikel angewendet - die Artikelbewertung auf Habr√©, die Benutzerbewertung des Autors und der Durchschnitt der Benutzerbewertungen nach Tags werden hinzugef√ºgt.  Ist die Menge gr√∂√üer als der benutzerdefinierte Schwellenwert, besteht der Artikel den Filter. </p><br><p>  Ein Nebenziel beim Schreiben eines Bots war es, Spa√ü zu haben und Erfahrungen zu sammeln.  Au√üerdem erinnerte ich mich regelm√§√üig daran, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ich nicht Google</a> war und daher viele Dinge so einfach und sogar primitiv wie m√∂glich gemacht wurden.  Dies hinderte den Prozess des Schreibens des Bots jedoch nicht daran, sich drei Monate lang zu dehnen. </p><br><h2 id="za-oknom-bylo-leto">  Vor dem Fenster war Sommer </h2><br><p>  Der Juli endete und ich beschloss, einen Bot zu schreiben.  Und zwar nicht alleine, sondern mit einem Freund, der die Scala gemeistert hat und etwas darauf schreiben wollte.  Der Anfang sah vielversprechend aus - der Code wird "Team" sein, die Aufgabe schien einfach und ich dachte, dass der Bot in ein paar Wochen oder einem Monat fertig sein wird. </p><br><p>  Trotz der Tatsache, dass ich selbst in den letzten Jahren Code auf dem Felsen geschrieben habe, sieht oder sieht sich normalerweise niemand diesen Code an: Lieblingsprojekte, √úberpr√ºfung einiger Ideen, Datenvorverarbeitung, Beherrschung einiger Konzepte aus dem FP.  Ich war wirklich daran interessiert, wie der Code im Team aussieht, weil der Code auf dem Felsen auf sehr unterschiedliche Arten geschrieben werden kann. </p><br><p>  Was k√∂nnte so gelaufen <strong>sein</strong> ?  Wir werden uns jedoch nicht beeilen. <br>  Alles, was passiert, kann anhand der Commit-Historie verfolgt werden. </p><br><p>  Ein Freund hat das Repository am 27. Juli erstellt, aber nichts anderes getan, also habe ich angefangen, Code zu schreiben. </p><br><h3 id="30-iyulya">  30. Juli </h3><br><p>  Kurz: Ich habe Parsing-RSS-Feeds von Habr geschrieben. </p><br><ul><li> <code>com.github.pureconfig</code> zum <code>com.github.pureconfig</code> Lesen von typsicheren Konfigurationsdateien in case-Klassen (es hat sich als sehr praktisch herausgestellt) </li><li>  <code>scala-xml</code> zum lesen von xml: da ich urspr√ºnglich meine implementierung f√ºr rss tape und rss tape im xml-format schreiben wollte, habe ich diese bibliothek zum analysieren verwendet.  Tats√§chlich tauchte auch Parsing-RSS auf. </li><li>  <code>scalatest</code> f√ºr tests.  Selbst bei kleinen Projekten spart das Schreiben von Tests Zeit. Wenn Sie beispielsweise das Parsen von XML-Dateien debuggen, k√∂nnen Sie sie viel einfacher in eine Datei herunterladen, Tests schreiben und Fehler beheben.  Als sp√§ter ein Fehler beim Parsen eines seltsamen HTML-Codes mit ung√ºltigen utf-8-Zeichen auftrat, stellte sich heraus, dass es wieder praktischer war, ihn in eine Datei zu schreiben und einen Test hinzuzuf√ºgen. </li><li>  Schauspieler aus Akka.  Objektiv wurden sie √ºberhaupt nicht ben√∂tigt, aber das Projekt war zum Spa√ü geschrieben, ich wollte sie ausprobieren.  Infolgedessen bin ich bereit zu sagen, dass es mir gefallen hat.  Man kann die Idee von OOP von der anderen Seite betrachten - es gibt Akteure, die Nachrichten austauschen.  Was interessanter ist - es ist m√∂glich (und notwendig), Code so zu schreiben, dass die Nachricht m√∂glicherweise nicht erreicht wird oder nicht verarbeitet werden kann (im Allgemeinen sollten Nachrichten nicht verloren gehen, wenn ein Konto auf einem einzelnen Computer ausgef√ºhrt wird).  Zuerst habe ich mir den Kopf zerbrochen und es gab einen M√ºll im Code, in dem Schauspieler sich gegenseitig abonnierten, aber am Ende habe ich es geschafft, eine ziemlich einfache und elegante Architektur zu erhalten.  Der Code in jedem Akteur kann als Singlethread-Code betrachtet werden. Wenn der Akteur abst√ºrzt, startet der Akka ihn neu - es wird ein eher fehlertolerantes System erhalten. </li></ul><br><h3 id="9-avgusta">  9. August </h3><br><p>  Ich habe das <code>scala-scrapper</code> Projekt zum Parsen von HTML-Seiten aus dem Habr hinzugef√ºgt (um Informationen wie Artikelbewertung, Anzahl der Lesezeichen usw. abzurufen). </p><br><p>  Und Katzen.  Diejenigen, die im Fels sind. </p><br><p><img src="https://habrastorage.org/webt/52/t8/4v/52t84v4u6vw7z6prsq8iqpmn0d8.png"></p><br><p>  Ich habe dann ein Buch √ºber verteilte Datenbanken gelesen und fand die Idee von CRDT (Conflict-free replicated data type, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr</a> ) gut. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Deshalb</a> habe ich die Typklasse der kommutativen Halbgruppe f√ºr gefilmt Informationen zum Artikel √ºber Habr√©. </p><br><p>  Tats√§chlich ist die Idee sehr einfach - wir haben Z√§hler, die sich monoton √§ndern.  Die Anzahl der Promotoren w√§chst stetig, die Anzahl der Pluspunkte (aber auch die Anzahl der Minuspunkte).  Wenn ich zwei Versionen von Informationen zu einem Artikel habe, k√∂nnen Sie diese "zu einer zusammenf√ºhren". Ber√ºcksichtigen Sie dabei den Status des Z√§hlers, der relevanter ist. </p><br><p>  Eine Halbgruppe bedeutet, dass zwei Objekte mit Informationen zu einem Artikel zu einem zusammengef√ºhrt werden k√∂nnen.  Kommutativ bedeutet, dass Sie sowohl A + B als auch B + A zusammenf√ºhren k√∂nnen. Das Ergebnis h√§ngt nicht von der Reihenfolge ab. Daher bleibt die neueste Version erhalten.  Assoziativit√§t ist √ºbrigens auch hier. </p><br><p>  Zum Beispiel lieferte RSS nach dem Parsen von Entwurf aus leicht ged√§mpfte Informationen √ºber den Artikel - ohne Metriken wie die Anzahl der Aufrufe.  Ein spezieller Darsteller nahm dann Informationen zu den Artikeln und rannte zu den HTML-Seiten, um sie zu aktualisieren und mit der alten Version zusammenzuf√ºhren. </p><br><p>  Im Allgemeinen bestand wie bei akka keine Notwendigkeit daf√ºr, es war lediglich m√∂glich, updateDate f√ºr den Artikel zu speichern und einen neueren Artikel ohne Fusionen zu erstellen, aber der Weg des Abenteuers f√ºhrte mich. </p><br><h2 id="12-avgusta">  12. August </h2><br><p>  Ich begann mich freier zu f√ºhlen und machte aus Gr√ºnden des Interesses jeden Chat zu einem eigenen Schauspieler.  Theoretisch wiegt ein Akteur allein ungef√§hr 300 Bytes und kann mindestens von Millionen erstellt werden. Dies ist also ein ganz normaler Ansatz.  Es stellte sich f√ºr mich eine recht interessante L√∂sung heraus: </p><br><p>  Ein Akteur war die Br√ºcke zwischen dem Telegrammserver und dem Nachrichtensystem in Akka.  Er empfing einfach Nachrichten und schickte sie an den gew√ºnschten Chat-Darsteller.  Der Darsteller-Chat als Antwort konnte etwas zur√ºcksenden - und es wurde zur√ºck an Telegramme gesendet.  Was sehr praktisch war - dieser Schauspieler erwies sich als so einfach wie m√∂glich und enthielt nur die Logik der Antwort auf Nachrichten.  √úbrigens kamen zu jedem Chat Informationen √ºber neue Artikel, aber auch hier sehe ich keine Probleme. </p><br><p>  Im Allgemeinen hat der Bot bereits gearbeitet, auf Nachrichten geantwortet und eine Liste der an den Benutzer gesendeten Artikel gef√ºhrt, und ich dachte bereits, dass der Bot fast fertig war.  Ich beendete langsam kleine Chips wie das Normalisieren der Namen von Autoren und Tags (Ersetzen von "sd f" durch "s_d_f"). </p><br><p>  Es gab nur einen <em>kleinen, aber</em> - der Staat hat nirgendwo bestanden. </p><br><h2 id="vsyo-poshlo-ne-tak">  Alles ist schief gelaufen </h2><br><p>  Sie haben vielleicht bemerkt, dass ich den Bot meistens alleine geschrieben habe.  Der zweite Teilnehmer beteiligte sich an der Entwicklung, und die folgenden √Ñnderungen wurden im Code angezeigt: </p><br><ul><li>  Um den Zustand zu speichern, erschien mongoDB.  Zur gleichen Zeit brachen die Protokolle im Projekt, weil die Monga aus irgendeinem Grund anfing, sie zu spammen und einige Leute sie einfach global abschalteten. </li><li>  Die Akteurbr√ºcke im Telegramm wurde bis zur Unkenntlichkeit transformiert und begann, Nachrichten selbst zu analysieren. </li><li>  Schauspieler f√ºr Chats waren gnadenlos betrunken, stattdessen erschien ein Schauspieler, der alle Informationen √ºber alle Chats auf einmal in sich versteckte.  F√ºr jedes Niesen stieg dieser Schauspieler in Mongu.  Ja, es ist schwierig, es an alle Chat-Akteure zu senden, wenn Informationen zu einem Artikel aktualisiert werden (wir sind wie Google, Millionen von Nutzern warten auf eine Million Artikel in einem Chat f√ºr alle), aber es ist normal, jedes Mal in eine Monga zu geraten, wenn Sie einen Chat aktualisieren.  Wie ich sehr viel sp√§ter verstand, wurde auch die Funktionslogik der Chats komplett herausgeschnitten und es trat etwas auf, das nicht funktionierte. </li><li>  Von den Klassen ist keine Spur mehr vorhanden. </li><li>  Eine ungesunde Logik trat bei den Schauspielern auf, die sich gegenseitig abonnierten, was zu einer Rassenbedingung f√ºhrte. </li><li>  Datenstrukturen mit Feldern vom Typ <code>Option[Int]</code> wurden mit magischen Standardwerten vom Typ -1 zu Int.  Sp√§ter wurde mir klar, dass mongoDB json speichert und es nichts Falsches daran gibt, <code>Option</code> dort zu speichern oder zumindest -1 wie None zu analysieren, aber zu diesem Zeitpunkt wusste ich das nicht und glaubte dem Wort "es ist notwendig".  Dieser Code wurde nicht von mir geschrieben, und ich habe mich vorerst nicht darum gek√ºmmert, ihn zu √§ndern. </li><li>  Ich fand heraus, dass meine √∂ffentliche IP-Adresse die Eigenschaft hat, sich zu √§ndern, und jedes Mal, wenn ich sie der Whitelist hinzuf√ºgen musste.  Ich habe den Bot lokal gestartet, die Monga war irgendwo auf den Monga-Servern als Firma. </li><li>  Pl√∂tzlich verschwand die Normalisierung von Tags und die Formatierung von Nachrichten f√ºr ein Telegramm.  (Hmm, warum sollte es?) </li><li>  Ich fand es gut, dass der Status des Bots in einer externen Datenbank gespeichert ist und beim Neustart so weiterarbeitet, als w√§re nichts passiert.  Dies war jedoch das einzige Plus. </li></ul><br><p>  Die zweite Person hatte es nicht eilig und all diese Ver√§nderungen erschienen bereits Anfang September auf einem gro√üen Haufen.  Ich habe das Ausma√ü des Schadens nicht sofort erkannt und begann, die Arbeit der Datenbank zu verstehen, weil  hatte sich noch nie zuvor mit ihnen befasst.  Erst dann wurde mir klar, wie viel Arbeitscode gek√ºrzt wurde und wie viele Fehler im Gegenzug hinzugef√ºgt wurden. </p><br><h2 id="sentyabr">  September </h2><br><p>  Zuerst dachte ich, es w√§re n√ºtzlich, Mongu zu beherrschen und alles gut zu machen.  Dann begann ich langsam zu verstehen, dass das Organisieren der Kommunikation mit der Datenbank auch eine Kunst ist, in der man Rennen fahren und nur Fehler machen kann.  Wenn z. B. zwei Nachrichten vom Typ <code>/subscribe</code> vom Benutzer eingehen und als Antwort auf jede Nachricht ein Eintrag im Kennzeichen erstellt wird, ist der Benutzer zum Zeitpunkt der Verarbeitung dieser Nachrichten nicht signiert.  Ich hatte den Verdacht, dass die Kommunikation mit der Monga in der vorhandenen Form nicht optimal geschrieben war.  Beispielsweise wurden Benutzereinstellungen zum Zeitpunkt der Anmeldung erstellt.  Wenn er vor dem Abonnement versucht hat, sie zu √§ndern ... hat der Bot nicht geantwortet, weil der Code im Darsteller in die Datenbank f√ºr die Einstellungen geklettert ist, nicht gefunden wurde und abgest√ºrzt ist.  Bei der Frage, warum die Einstellungen nicht nach Bedarf erstellt werden sollen, stellte ich fest, dass sie nicht ge√§ndert werden k√∂nnen, wenn der Benutzer sie nicht abonniert hat da ist ein Fehler. </p><br><p>  Es wurde keine Liste von Artikeln zum Chatten gesendet, stattdessen wurde vorgeschlagen, dass ich sie selbst schreibe.  Das √ºberraschte mich - im Allgemeinen war ich nicht dagegen, alle m√∂glichen Teile in das Projekt zu ziehen, aber es w√§re logisch, diese Dinge hineinzuziehen und anzuschrauben.  Aber nein, der zweite Teilnehmer scheint alles vergessen zu haben, hat aber gesagt, dass die Liste im Chat angeblich eine schlechte Entscheidung ist, und Sie m√ºssen einen Teller mit Ereignissen wie "Artikel x wurde an Benutzer x gesendet" anfertigen.  Wenn der Benutzer dann das Senden neuer Artikel anforderte, musste eine Anforderung an die Datenbank gesendet werden, welche der Ereignisse Ereignisse in Bezug auf den Benutzer ausw√§hlen, weiterhin eine Liste neuer Artikel abrufen, sie filtern, an den Benutzer senden und Ereignisse dar√ºber zur√ºck in die Datenbank werfen. </p><br><p>  Der zweite Teilnehmer litt irgendwo in Richtung Abstraktionen, als der Bot nicht nur Artikel von Habr empfangen und nicht nur an Telegramme senden wird. </p><br><p>  Irgendwie habe ich die Ereignisse in Form eines separaten Tablets bis zur zweiten Septemberh√§lfte implementiert.  Nicht optimal, aber der Bot funktionierte immerhin und begann mir wieder Artikel zu schicken, und ich fand langsam heraus, was im Code vorging. </p><br><p>  Jetzt k√∂nnen Sie zun√§chst zur√ºckgehen und sich daran erinnern, dass das Repository urspr√ºnglich nicht von mir erstellt wurde.  Was k√∂nnte so gelaufen sein?  Meine Poolanfrage wurde abgelehnt.  Es stellte sich heraus, dass ich einen Shortcode hatte, nicht wusste, wie man in einem Team arbeitet, und dass ich Fehler in der aktuellen Implementierungskurve bearbeiten und nicht in einen verwendbaren Zustand √§ndern musste. </p><br><p>  Ich war ver√§rgert und schaute auf die Geschichte der Commits und die Menge des geschriebenen Codes.  Ich habe mir die Momente angeschaut, die urspr√ºnglich gut geschrieben und dann wieder abgebrochen wurden ... </p><br><h2 id="frk-it">  F * rk es </h2><br><p>  Ich erinnerte mich an den Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie sind nicht Google</a> . </p><br><p>  Ich dachte, dass niemand ohne Umsetzung wirklich eine Idee braucht.  Ich dachte, dass ich einen funktionierenden Bot haben m√∂chte, der in einer einzelnen Kopie auf einem einzelnen Computer als einfaches Java-Programm funktioniert.  Ich wei√ü, dass mein Bot monatelang ohne Neustart funktioniert, da ich in der Vergangenheit solche Bots geschrieben habe.  Wenn er pl√∂tzlich f√§llt und den n√§chsten Artikel nicht an den Benutzer sendet, f√§llt der Himmel nicht auf die Erde und es passiert nichts Katastrophales. </p><br><p>  Warum brauche ich einen Docker, MongoDB und andere Frachtsoftware mit "ernstem" Inhalt, wenn der Code nicht dumm oder schief funktioniert? </p><br><p>  Ich gabelte das Projekt und tat alles, was ich wollte. </p><br><p><img src="https://habrastorage.org/webt/ns/gh/ze/nsghzekle4yfth_aqyivbx17wxy.jpeg"></p><br><p>  Etwa zur gleichen Zeit wechselte ich meinen Job und es fehlte mir schmerzlich an Freizeit.  Morgens wachte ich genau im Zug auf, kam sp√§t abends zur√ºck und wollte nichts mehr tun.  Ich habe eine Weile nichts getan, dann habe ich den Wunsch, den Bot zu beenden, √ºberwunden und begann, den Code langsam umzuschreiben, w√§hrend ich morgens zur Arbeit fuhr.  Ich kann nicht sagen, dass es produktiv war: In einem r√ºttelnden Zug mit einem Laptop auf dem Scho√ü zu sitzen und einen Blick auf den Stapel√ºberlauf von Ihrem Telefon zu werfen, ist nicht sehr praktisch.  Die Zeit hinter dem Schreiben des Codes verging jedoch v√∂llig unbemerkt und das Projekt begann sich langsam in einen funktionierenden Zustand zu versetzen. </p><br><p>  Irgendwo tief im Innern gab es einen Zweifel, den mongoDB nutzen wollte, aber ich dachte, dass es neben den Vorteilen des ‚Äûzuverl√§ssigen‚Äú Zustandsspeichers sp√ºrbare Nachteile gibt: </p><br><ul><li>  Die Datenbank wird zu einer weiteren Fehlerquelle. </li><li>  Der Code wird immer schwieriger und ich werde ihn l√§nger schreiben. </li><li>  Der Code wird langsam und ineffizient. Anstatt das Objekt im Speicher zu √§ndern, werden die √Ñnderungen an die Datenbank gesendet und bei Bedarf zur√ºckgezogen. </li><li>  Es gibt Einschr√§nkungen hinsichtlich der Art der Speicherung von Ereignissen in einer separaten Platte, die den Funktionen der Datenbank zugeordnet sind. </li><li>  In der Testversion von Monga gibt es einige Einschr√§nkungen, und wenn Sie darauf sto√üen, m√ºssen Sie das Mongu f√ºr etwas starten und konfigurieren. </li></ul><br><p>  Ich habe Mongu getrunken, jetzt wird der Zustand des Bots einfach im Programmspeicher abgelegt und von Zeit zu Zeit in einer Datei in Form von JSON gespeichert.  Vielleicht schreiben sie in den Kommentaren, dass ich falsch liege, weil du es hier verwenden solltest, usw.  Aber das ist mein Projekt, der Ansatz mit der Datei ist so einfach wie m√∂glich und es funktioniert auf transparente Weise. </p><br><p>  Ich habe magische Werte wie -1 ausgegeben und die normale <code>Option</code> . Die Speicherung einer Hash-Platte mit den gesendeten Artikeln wurde zum Objekt mit den Chat-Informationen hinzugef√ºgt.  L√∂schung von Informationen √ºber Artikel, die √§lter als f√ºnf Tage sind, hinzugef√ºgt, um nicht alles hintereinander zu speichern.  Er brachte die Protokollierung in einen funktionsf√§higen Zustand - Protokolle in angemessener Menge werden sowohl in die Datei als auch in die Konsole geschrieben.  Mehrere Admin-Befehle wie das Speichern des Status oder das Abrufen von Statistiken wie die Anzahl der Benutzer und Artikel wurden hinzugef√ºgt. </p><br><p>  Ich habe ein paar Kleinigkeiten behoben: In den Artikeln wird beispielsweise die Anzahl der Aufrufe, Vorlieben, Abneigungen und Kommentare zum Zeitpunkt des Bestehens des Benutzerfilters angegeben.  Im Allgemeinen ist es erstaunlich, wie viele kleine Dinge repariert werden mussten.  Ich habe eine Liste gef√ºhrt, alle ‚ÄûUnebenheiten‚Äú dort notiert und soweit wie m√∂glich korrigiert. </p><br><p>  Zum Beispiel habe ich die M√∂glichkeit hinzugef√ºgt, alle Einstellungen direkt in einer Nachricht festzulegen: </p><br><pre> <code class="plaintext hljs">/subscribe /rating +20 /author a -30 /author s -20 /author p +9000 /tag scala 20 /tag akka 50</code> </pre> <br><p>  Und der Befehl <code>/settings</code> zeigt sie in dieser Form an. Sie k√∂nnen Text daraus entnehmen und alle Einstellungen an einen Freund senden. <br>  Es scheint eine Kleinigkeit zu sein, aber es gibt Dutzende √§hnlicher Nuancen. </p><br><p>  Filterung von Artikeln in Form eines einfachen linearen Modells implementiert - der Benutzer kann eine zus√§tzliche Bewertung f√ºr Autoren und Tags sowie einen Schwellenwert festlegen.  Wenn die Summe aus der Bewertung des Autors, der durchschnittlichen Bewertung f√ºr Tags und der tats√§chlichen Bewertung des Artikels gr√∂√üer als der Schwellenwert ist, wird der Artikel dem Benutzer angezeigt.  Sie k√∂nnen den Bot entweder mit dem Befehl / new nach Artikeln fragen oder ihn abonnieren, und er wirft zu jeder Tageszeit Artikel in PM. </p><br><p>  Im Allgemeinen hatte ich die Idee, f√ºr jeden Artikel mehr Zeichen (Hubs, Anzahl der Kommentare, Lesezeichen, Dynamik der Bewertungs√§nderungen, Textmenge, Bilder und Code im Artikel, Stichw√∂rter) zu zeichnen und dem Benutzer zu zeigen, ob die Stimmen in Ordnung oder nicht in Ordnung sind Artikel und f√ºr jeden Benutzer das Modell zu trainieren, aber ich wurde zu faul. </p><br><p>  Dar√ºber hinaus wird die Logik der Arbeit nicht so offensichtlich sein.  Jetzt kann ich f√ºr patientZero manuell eine Bewertung von +9000 eingeben und mit einer Schwellenbewertung von +20 werde ich garantiert alle seine Artikel erhalten (es sei denn, ich habe -100500 f√ºr Tags eingegeben). </p><br><p>  Die resultierende Architektur war recht einfach: </p><br><ol><li>  Ein Schauspieler, der den Status aller Chats und Artikel speichert.  Es l√§dt seinen Status von einer Datei auf der Festplatte und speichert ihn von Zeit zu Zeit zur√ºck, jedes Mal in eine neue Datei. </li><li>  Ein Schauspieler, der gelegentlich auf den RSS-Feed st√∂√üt, erf√§hrt von neuen Artikeln, schaut sich die Links an, analysiert diese und sendet sie an den ersten Schauspieler.  Au√üerdem fragt er manchmal den ersten Schauspieler nach einer Liste von Artikeln, w√§hlt diejenigen aus, die nicht √§lter als drei Tage sind, aber schon lange nicht mehr aktualisiert wurden, und aktualisiert sie. </li><li>  Ein Schauspieler, der mit einem Telegramm kommuniziert.  Das Parsen von Nachrichten habe ich hier noch ganz √ºbernommen.  Auf eine gute Weise m√∂chte ich es in zwei Teile aufteilen - so dass einer eingehende Nachrichten analysiert und der zweite sich mit Transportproblemen wie dem Weiterleiten nicht gesendeter Nachrichten befasst.  Jetzt erfolgt kein erneutes Senden, und die Nachricht, die aufgrund eines Fehlers nicht eingegangen ist, geht einfach verloren (au√üer dass sie in den Protokollen markiert wird), was jedoch bisher keine Probleme verursacht.  M√∂glicherweise treten Probleme auf, wenn eine Gruppe von Personen den Bot abonniert und ich das Limit f√ºr das Senden von Nachrichten erreicht habe. </li></ol><br><p>  Was mir gefallen hat - dank Akka hat der Sturz der Schauspieler 2 und 3 im Allgemeinen keinen Einfluss auf die Leistung des Bots.  M√∂glicherweise werden einige Artikel nicht rechtzeitig aktualisiert oder einige Nachrichten erreichen das Telegramm nicht, aber Akka startet den Schauspieler neu und alles funktioniert weiter.  Ich speichere die Information, dass der Artikel dem Benutzer nur angezeigt wird, wenn der Telegrammschauspieler antwortet, dass er die Nachricht erfolgreich zugestellt hat.  Das Schlimmste, was mir droht, ist, eine Nachricht mehrmals zu senden (wenn sie zugestellt wird, die Best√§tigung jedoch auf unbekannte Weise verloren geht).  Wenn der erste Schauspieler den Staat nicht in sich behalten, sondern mit einer Art Datenbank kommunizieren w√ºrde, k√∂nnte er im Prinzip auch ruhig fallen und zum Leben zur√ºckkehren.  Ich k√∂nnte auch versuchen, durch Hartn√§ckigkeit den Zustand der Schauspieler wiederherzustellen, aber die derzeitige Umsetzung gef√§llt mir durch ihre Einfachheit.  Nicht, dass mein Code oft abst√ºrzt - im Gegenteil, ich habe viel M√ºhe darauf verwendet, dies unm√∂glich zu machen.  Aber Schei√üe passiert, und die F√§higkeit, das Programm in einzelne St√ºcke aufzuteilen, schien mir wirklich praktisch und praktisch. </p><br><p>  Circle-ci hinzugef√ºgt, um sofort zu erfahren, wenn der Code kaputt geht.  Zumindest hat der Code aufgeh√∂rt zu kompilieren.  Am Anfang wollte ich Travis hinzuf√ºgen, aber es wurden nur meine Projekte ohne gegabelte Projekte angezeigt.  Im Allgemeinen k√∂nnen diese beiden Dinge in offenen Repositorys frei verwendet werden. </p><br><h2 id="itogi">  Zusammenfassung </h2><br><p>  Es ist schon November.  Der Bot ist geschrieben, ich habe ihn die letzten zwei Wochen benutzt und er hat mir gefallen.  Wenn Sie Verbesserungsvorschl√§ge haben - schreiben Sie.  Ich sehe keinen Grund, es zu monetarisieren - lass es einfach funktionieren und sende interessante Artikel. </p><br><p>  Link zum Bot: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://t.me/HabraFilterBot</a> <br>  Github: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/Kright/habrahabr_reader</a> </p><br><p>  Kleine Schlussfolgerungen: </p><br><ul><li>  Selbst ein kleines Projekt kann lange dauern. </li><li>  Sie sind kein Google.  Es macht keinen Sinn, einen Spatz aus einer Kanone zu schie√üen.  Eine einfache L√∂sung kann genauso gut funktionieren. </li><li>  Haustierprojekte eignen sich sehr gut zum Experimentieren mit neuen Technologien. </li><li>  Telegramm-Bots werden ganz einfach geschrieben.  Ohne "Teamwork" und Experimente mit Technologien w√§re der Bot in ein oder zwei Wochen geschrieben worden. </li><li>  Das Darstellermodell ist eine interessante Sache, die gut zu Multithreading und Code-Resilienz passt. </li><li>  Ich scheine selbst zu sp√ºren, warum die Open-Source-Community Gabeln liebt. </li><li>  Datenbanken sind insofern gut, als der Status der Anwendung nicht mehr von den Abst√ºrzen / Neustarts der Anwendung abh√§ngt, sondern die Arbeit mit der Datenbank den Code verkompliziert und die Datenstruktur einschr√§nkt. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de475450/">https://habr.com/ru/post/de475450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de475438/index.html">Jekaterinburg, 19. November - Atlassian User Group MeetUp</a></li>
<li><a href="../de475440/index.html">Schnittstellen zur √úberwachung der Leistung beliebter Datenbanken in Foglight f√ºr Datenbanken</a></li>
<li><a href="../de475442/index.html">Besuch der Google-Zentrale - Allgemeine Gesch√§ftsbedingungen</a></li>
<li><a href="../de475444/index.html">Industrielle Uran-Graphit-Reaktoren zur Herstellung von Plutonium</a></li>
<li><a href="../de475448/index.html">In einem modernen Auto gibt es mehr Codezeilen als ...</a></li>
<li><a href="../de475452/index.html">Auswahl: 5 Marketingb√ºcher zum Lesen f√ºr einen Startup-Gr√ºnder</a></li>
<li><a href="../de475458/index.html">Fernbedienung mit externem Ausl√∂ser f√ºr SONY HDR-Kameras am ESP8266</a></li>
<li><a href="../de475462/index.html">So lokalisieren Sie ein Handyspiel f√ºr den asiatischen Markt</a></li>
<li><a href="../de475464/index.html">Der Weg des Architekten: Zertifizierung und Eintauchen in Produkte</a></li>
<li><a href="../de475466/index.html">Intel Xeon E-2200. Serverkerne, Budget</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>