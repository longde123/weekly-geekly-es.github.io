<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍🎨 ‼️ 👩🏾‍🚒 Aufbau einer fehlertoleranten IT-Infrastruktur. Teil 2. Installieren und Konfigurieren des oVirt 4.3-Clusters 🚴🏼 📘 👩🏿‍🤝‍👨🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel ist eine Fortsetzung des vorherigen Artikels - „ Erstellen einer fehlertoleranten IT-Infrastruktur. Teil 1 - Vorbereitung für die Berei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aufbau einer fehlertoleranten IT-Infrastruktur. Teil 2. Installieren und Konfigurieren des oVirt 4.3-Clusters</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lenvendo/blog/485208/"><p>  Dieser Artikel ist eine Fortsetzung des vorherigen Artikels - „ <a href="https://habr.com/ru/company/lenvendo/blog/483980/">Erstellen einer fehlertoleranten IT-Infrastruktur.</a>  <a href="https://habr.com/ru/company/lenvendo/blog/483980/">Teil 1 - Vorbereitung für die Bereitstellung des oVirt 4.3-Clusters</a> . “ </p><br><p>  Es wird die grundlegende Installation und Konfiguration des oVirt 4.3-Clusters zum Hosten von hoch zugänglichen virtuellen Maschinen unter Berücksichtigung der Tatsache betrachtet, dass alle vorbereitenden Schritte für die Vorbereitung der Infrastruktur bereits abgeschlossen wurden. </p><a name="habracut"></a><br><h2 id="vvodnaya-chast">  Einleitung </h2><br><p>  Das Hauptziel des Artikels ist es nicht, schrittweise Anweisungen in der Form " <strong>Weiter</strong> -&gt; <strong>Ja</strong> -&gt; <strong>Fertig stellen</strong> " zu veröffentlichen, sondern einige Funktionen bei der Installation und Konfiguration aufzuzeigen.  Aufgrund der Besonderheiten der Infrastruktur und der Umgebung stimmt der Bereitstellungsprozess Ihres Clusters möglicherweise nicht immer mit dem darin beschriebenen überein, die allgemeinen Prinzipien sind jedoch gleich. </p><br><p>  Aus subjektiver Sicht ähnelt <a href="https://www.ovirt.org/">oVirt 4.3</a> in der Funktionalität VMware vSphere Version 5.x, verfügt jedoch natürlich über eigene Konfigurations- und Betriebsfunktionen. </p><br><p>  Für diejenigen, die daran interessiert sind, können alle Unterschiede zwischen RHEV (aka oVirt) und VMware vSphere zum Beispiel <a href="https://www.redhat.com/cms/managed-files/vi-virtualization-vmware-competitive-review-f10106jm-201803_0_0.pdf">hier</a> im Internet gefunden <a href="https://www.redhat.com/cms/managed-files/vi-virtualization-vmware-competitive-review-f10106jm-201803_0_0.pdf">werden</a> , aber ich werde dennoch gelegentlich einige ihrer Unterschiede oder Ähnlichkeiten bemerken, wie der Artikel geht. </p><br><p>  Separat möchte ich ein wenig Arbeit mit Netzwerken für virtuelle Maschinen vergleichen.  OVirt implementiert ein ähnliches Prinzip der Netzwerkverwaltung für virtuelle Maschinen (im Folgenden als VM bezeichnet) wie in VMware vSphere: </p><br><ul><li>  Verwenden der Standard-Linux-Bridge (in VMware - <em>Standard vSwitch</em> ), die auf Virtualisierungshosts ausgeführt wird; </li><li>  Verwenden von Open vSwitch (OVS) (in VMware <em>Distributed vSwitch</em> ) ist ein verteilter virtueller Switch, der aus zwei Hauptkomponenten besteht: einem zentralen OVN-Server und OVN-Controllern auf verwalteten Hosts. </li></ul><br><p> Aufgrund der einfachen Implementierung wird in diesem Artikel die Netzwerkkonfiguration in oVirt für VMs unter Verwendung der Standard-Linux-Bridge beschrieben, die bei Verwendung des KVM-Hypervisors die Standardauswahl darstellt. </p><br><p>  In dieser Hinsicht gibt es mehrere Grundregeln für die Arbeit mit einem Netzwerk in einem Cluster, die besser nicht zu verletzen sind: </p><br><ul><li>  Alle Netzwerkeinstellungen auf den Hosts müssen identisch sein, bevor Sie sie zu oVirt hinzufügen, mit Ausnahme der IP-Adressen. </li><li>  Nachdem der Host unter der Kontrolle von oVirt steht, wird dringend davon abgeraten, Änderungen an den Netzwerkeinstellungen mit Ihren Händen vorzunehmen, ohne volles Vertrauen in Ihre Aktionen zu haben, da der oVirt-Agent sie nach dem Neustart des Hosts oder Agenten einfach auf die vorherigen zurücksetzt. </li><li>  Das Hinzufügen und Bearbeiten eines neuen Netzwerks für die VM sollte nur über die Ovirt-Verwaltungskonsole erfolgen. </li></ul><br><p>  Ein weiterer <u>wichtiger Punkt</u> : In einer sehr kritischen Umgebung (die sehr anfällig für Geldverluste ist) wird weiterhin empfohlen, kostenpflichtigen Support und <a href="https://access.redhat.com/products/red-hat-virtualization">Red Hat Virtualization 4.3 zu verwenden</a> .  Während des Betriebs des oVirt-Clusters kann es einige Punkte geben, bei denen es ratsam ist, so bald wie möglich qualifizierte Hilfe in Anspruch zu nehmen, anstatt sich selbst darum zu kümmern. </p><br><p>  Schließlich <u>wird empfohlen, sich</u> vor der Bereitstellung des oVirt-Clusters mit der <a href="https://www.ovirt.org/documentation/">offiziellen Dokumentation</a> vertraut zu machen, um zumindest grundlegende Konzepte und Definitionen zu kennen. Andernfalls ist es etwas schwierig, den Artikel weiter zu lesen. </p><br><p>  Die folgenden Dokumente sind grundlegend für das Verständnis des Artikels und der Funktionsweise des oVirt-Clusters: </p><br><ul><li>  <a href="https://www.ovirt.org/documentation/install-guide/Installation_Guide/">oVirt Installationsanleitung</a> </li><li>  <a href="https://www.ovirt.org/documentation/self-hosted/Self-Hosted_Engine_Guide/">oVirt Self-Hosted Engine-Handbuch</a> </li><li>  <a href="https://www.ovirt.org/documentation/admin-guide/administration-guide/">oVirt Administrationshandbuch</a> <a href="https://www.ovirt.org/documentation/admin-guide/administration-guide/"><br></a> </li></ul><br><p>  Das Volumen dort ist nicht sehr groß, in ein oder zwei Stunden sind die Grundprinzipien gut zu beherrschen, und für Fans von Details wird empfohlen, die <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/">Produktdokumentation für Red Hat Virtualization 4.3</a> zu lesen - RHEV und oVirt sind im Wesentlichen dasselbe. </p><br><p>  Wenn alle grundlegenden Einstellungen für Hosts, Switches und Speicher abgeschlossen sind, fahren wir direkt mit der Bereitstellung von oVirt fort. </p><br><h2 id="chast-2-ustanovka-i-nastroyka-klastera-ovirt-43">  Teil 2. Installieren und Konfigurieren des oVirt 4.3-Clusters </h2><br><p>  Zur leichteren Orientierung liste ich die Hauptabschnitte in diesem Artikel auf, die der Reihe nach ausgeführt werden sollten: </p><br><ol><li>  Installieren des Ovirt Management Servers </li><li>  Schaffung eines neuen Rechenzentrums </li><li>  Erstellen Sie einen neuen Cluster </li><li>  Installieren zusätzlicher Hosts in einer selbst gehosteten Umgebung </li><li>  Erstellen Sie einen Speicherbereich oder Speicherdomänen </li><li>  Erstellen und Konfigurieren von Netzwerken für virtuelle Maschinen </li><li>  Erstellen eines Installationsimages zum Bereitstellen einer virtuellen Maschine </li><li>  Erstellen einer virtuellen Maschine </li></ol><br><h3 id="ustanovka-upravlyayuschego-servera-ovirt">  Installieren des Ovirt Management Servers </h3><br><p>  <strong>Der Ovirt-Management-Server</strong> ist das wichtigste Element in der Ovirt-Infrastruktur, und zwar in Form einer virtuellen Maschine, eines Hosts oder eines virtuellen Geräts, das die gesamte Ovirt-Infrastruktur verwaltet. </p><br><p>  Seine engen Analoga aus der Welt der Virtualisierung: </p><br><ul><li>  VMware vSphere - vCenter Server </li><li>  Microsoft Hyper-V - VMM (System Center Virtual Machine Manager). </li></ul><br><p>  Um den oVirt Management Server zu installieren, haben wir zwei Möglichkeiten: </p><br><p>  <u>Variante 1</u> <br>  Bereitstellen eines Servers als spezialisierte VM oder Host. </p><br><p>  Diese Option funktioniert gut, vorausgesetzt, dass eine solche VM unabhängig vom Cluster funktioniert, d. H.  Wird auf keinem Host im Cluster als reguläre virtuelle Maschine ausgeführt, auf der KVM ausgeführt wird. </p><br><p>  Warum können Sie eine solche VM nicht auf den Clusterhosts bereitstellen? </p><br><p>  Zu Beginn der Bereitstellung des oVirt-Verwaltungsservers besteht ein Dilemma: Sie müssen die verwaltende VM installieren, aber der Cluster selbst ist noch nicht vorhanden. Worauf können Sie also sofort kommen?  Es ist richtig, KVM auf dem zukünftigen Clusterknoten zu installieren und anschließend eine virtuelle Maschine darauf zu erstellen, z. B. mit CentOS OS, und die oVirt-Engine darin bereitzustellen.  Dies kann normalerweise aus Gründen der vollständigen Kontrolle über eine solche VM erfolgen, dies ist jedoch eine falsche Absicht, da in diesem Fall in Zukunft 100% ige Probleme mit einer solchen steuernden VM auftreten werden: </p><br><ul><li>  Es kann nicht in der oVirt-Konsole zwischen den Hosts (Knoten) des Clusters migriert werden. </li><li>  Bei der Migration mit KVM-Tools über <em>virsh migrate</em> ist diese VM für die Verwaltung über die Ovirt-Konsole nicht zugänglich. </li><li>  <em>Clusterhosts</em> können nicht in den <strong>Wartungsmodus versetzt werden,</strong> wenn Sie diese VM mit <em>virsh migrate</em> von Host zu Host <em>migrieren</em> . </li></ul><br><p>  Tun Sie also alles gemäß den Regeln - verwenden Sie entweder einen separaten Host oder eine unabhängige VM, die darauf für den oVirt-Steuerungsserver ausgeführt wird, oder tun Sie dies, wie in der zweiten Version beschrieben. </p><br><p>  <u>Option 2</u> <br>  Installieren der oVirt Engine Appliance auf dem von ihr verwalteten Cluster-Host. </p><br><p>  Diese Option wird im Folgenden als korrekter und in unserem Fall geeigneter erachtet. <br>  Die Anforderungen für eine solche VM werden im Folgenden beschrieben. Ich möchte nur hinzufügen, dass empfohlen wird, mindestens zwei Hosts in der Infrastruktur zu haben, auf denen die verwaltende VM ausgeführt werden kann, um sie fehlertolerant zu machen.  Hier möchte ich hinzufügen, dass ich, wie ich bereits in den Kommentaren im vorherigen Artikel geschrieben habe, nicht in der Lage war, <em>Splitbrain</em> für den oVirt-Cluster von zwei Hosts zu erhalten, auf denen die VM mit gehosteter Engine ausgeführt werden konnte. </p><br><h4 id="ustanovka-ovirt-engine-appliance-na-pervyy-host-klastera">  Installieren Sie die oVirt Engine Appliance auf dem ersten Cluster-Host </h4><br><p>  Link zur offiziellen Dokumentation - <a href="https://www.ovirt.org/documentation/self-hosted/Self-Hosted_Engine_Guide/">oVirt Self-Hosted Engine-Handbuch</a> , Kapitel „ <a href="https://www.ovirt.org/documentation/self-hosted/chap-Deploying_Self-Hosted_Engine.html">Bereitstellen der Self-Hosted Engine über die Befehlszeile</a> “ </p><br><p>  Das Dokument gibt die Voraussetzungen an, die erfüllt sein müssen, bevor die VM mit gehosteter Engine bereitgestellt wird, und der Installationsprozess wird ausführlich beschrieben. Daher ist es nicht sinnvoll, diesen Vorgang wörtlich zu wiederholen, weshalb wir uns auf einige wichtige Details konzentrieren. </p><br><ul><li>  Stellen Sie vor dem Starten aller Schritte sicher, dass die Virtualisierungsunterstützung in den BIOS-Einstellungen auf dem Host aktiviert ist. </li><li>  Installieren Sie das Hosted Engine-Installationspaket auf dem Host: </li></ul><br><pre><code class="plaintext hljs">yum -y install http://resources.ovirt.org/pub/yum-repo/ovirt-release43.rpm yum -y install epel-release yum install screen ovirt-hosted-engine-setup</code> </pre> <br><ul><li>  Wir starten das Verfahren zum Bereitstellen von oVirt Hosted Engine auf dem Bildschirm des Hosts (Sie können es mit Strg-A + D beenden und mit Strg-D schließen): </li></ul><br><pre> <code class="plaintext hljs">screen hosted-engine --deploy</code> </pre> <br><p>  Bei Bedarf können Sie die Installation mit einer vorbereiteten Antwortdatei starten: </p><br><pre> <code class="plaintext hljs">hosted-engine --deploy --config-append=/var/lib/ovirt-hosted-engine-setup/answers/answers-ohe.conf</code> </pre> <br><ul><li>  Geben Sie während der Bereitstellung der gehosteten Engine alle erforderlichen Parameter an: </li></ul><br><pre> <code class="plaintext hljs">-   -  vCPU  vRAM ( 4 vCPU  16 ) -  -    hosted engine  –    FC -  LUN   hosted engine -       hosted engine –     Local (  PostgreSQL    )  . .</code> </pre> <br><ul><li>  Um eine hoch zugängliche VM mit einer gehosteten Engine zu installieren, haben wir eine spezielle LUN mit einer Größe von 4 und 150 GB auf dem Speichersystem erstellt, die dann den Cluster-Hosts präsentiert wurde - siehe den <a href="https://habr.com/ru/company/lenvendo/blog/483980/">vorherigen Artikel</a> . </li></ul><br><p>  Zuvor haben wir auch die Sichtbarkeit auf Hosts überprüft: </p><br><pre> <code class="plaintext hljs">multipath -ll … 3600a098000e4b4b3000003c95d171065 dm-3 DELL , MD38xxf size=150G features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw |-+- policy='service-time 0' prio=14 status=active | `- 15:0:0:4 sdc 8:32 active ready running `-+- policy='service-time 0' prio=9 status=enabled `- 18:0:0:4 sdj 8:144 active ready running</code> </pre> <br><ul><li>  Der Hosted-Engine-Bereitstellungsprozess selbst ist nicht kompliziert. Am Ende sollten wir ungefähr Folgendes erhalten: </li></ul><br><pre> <code class="plaintext hljs">[ INFO ] Generating answer file '/var/lib/ovirt-hosted-engine-setup/answers/answers-20191129131846.conf' [ INFO ] Generating answer file '/etc/ovirt-hosted-engine/answers.conf' [ INFO ] Stage: Pre-termination [ INFO ] Stage: Termination [ INFO ] Hosted Engine successfully deployed</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Überprüfen der Verfügbarkeit von oVirt-Diensten auf dem Host:</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/qv/kd/c8/qvkdc8tkfhqkxar1v13jxt4ozxs.png"></p></div></div><br><p>  Wenn alles richtig gemacht wurde, <em><a href="https://ovirt_hostname/ovirt-engine">rufen Sie</a></em> nach Abschluss der Installation <em><a href="https://ovirt_hostname/ovirt-engine">https://ovirt_hostname/ovirt-engine</a></em> auf dem Computer des Administrators mit einem Webbrowser auf und klicken Sie auf [ <strong>Administrationsportal</strong> ]. </p><br><div class="spoiler">  <b class="spoiler_title">Screenshot „Verwaltungsportal“</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/m7/sq/xp/m7sqxpd7qkl3dugl4oj7_5bga5g.png"></p></div></div><br><p>  Nachdem Sie den Benutzernamen und das Kennwort (die während der Installation festgelegt wurden) im Fenster wie im Screenshot eingegeben haben, gelangen Sie zur Systemsteuerung von Open Virtualization Manager, in der Sie alle Aktionen mit der virtuellen Infrastruktur ausführen können: </p><br><ol><li>  Rechenzentrum hinzufügen </li><li>  Cluster hinzufügen und konfigurieren </li><li>  Hosts hinzufügen und verwalten </li><li>  Fügen Sie Speicherbereiche oder Speicherdomänen für Festplatten virtueller Maschinen hinzu </li><li>  Hinzufügen und Konfigurieren von Netzwerken für virtuelle Maschinen </li><li>  Fügen Sie virtuelle Maschinen, Installationsimages und VM-Vorlagen hinzu und verwalten Sie diese </li></ol><br><p><img src="https://habrastorage.org/webt/4r/t_/qg/4rt_qg6irvl-mf6bsorclnmr36e.png"></p><br><p>  Alle diese Aktionen werden später betrachtet, etwas in einer großen Zelle, etwas detaillierter und mit Nuancen. <br>  Aber zuerst würde ich empfehlen, dieses Add-On zu lesen, was wahrscheinlich vielen nützlich sein kann. </p><br><p>  <strong>Zusatz</strong> </p><br><p>  <strong>1)</strong> Im Prinzip hindert Sie nichts daran, den KVM-Hypervisor auf den Clusterknoten mit den <strong><em>Paketen</em></strong> <strong><em>libvirt</em></strong> und <strong><em>qemu-kvm</em></strong> (oder <strong><em>qemu-kvm-ev</em></strong> ) der gewünschten Version vorzuinstallieren, obwohl dies bei der Bereitstellung des oVirt-Clusterknotens möglich ist mach es selbst </p><br><p>  Wenn <strong><em>libvirt</em></strong> und <strong><em>qemu-kvm</em></strong> jedoch nicht mit der neuesten Version installiert wurden, kann während der Bereitstellung der gehosteten Engine ein solcher Fehler auftreten: </p><br><pre> <code class="plaintext hljs">error: unsupported configuration: unknown CPU feature: md-clear</code> </pre> <br><p>  Das heißt  Sie benötigen <a href="https://centos.pkgs.org/7/centos-updates-x86_64/libvirt-4.5.0-10.el7_6.12.x86_64.rpm.html">eine aktualisierte Version von</a> <strong><em>libvirt</em></strong> mit <a href="https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/MDS">MDS-</a> Schutz, die diese Richtlinie unterstützt: </p><br><pre> <code class="plaintext hljs">&lt;feature policy='require' name='md-clear'/&gt;</code> </pre> <br><p>  Installieren Sie libvirt v.4.5.0-10.el7_6.12 mit md-clear-Unterstützung: </p><br><pre> <code class="plaintext hljs">yum-config-manager --disable mirror.centos.org_centos-7_7_virt_x86_64_libvirt-latest_ yum install centos-release-qemu-ev yum update yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer libguestfs libguestfs-tools dejavu-lgc-sans-fonts virt-top libvirt libvirt-python libvirt-client systemctl enable libvirtd systemctl restart libvirtd &amp;&amp; systemctl status libvirtd</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Überprüfen Sie, ob md-clear unterstützt wird:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">virsh domcapabilities kvm | grep require &lt;feature policy='require' name='ss'/&gt; &lt;feature policy='require' name='hypervisor'/&gt; &lt;feature policy='require' name='tsc_adjust'/&gt; &lt;feature policy='require' name='clflushopt'/&gt; &lt;feature policy='require' name='pku'/&gt; &lt;feature policy='require' name='md-clear'/&gt; &lt;feature policy='require' name='stibp'/&gt; &lt;feature policy='require' name='ssbd'/&gt; &lt;feature policy='require' name='invtsc'/&gt;</code> </pre> </div></div><br><p>  Danach können Sie mit der Installation der gehosteten Engine fortfahren. </p><br><p>  <strong>2)</strong> In oVirt 4.3 ist das Vorhandensein und die Verwendung der Firewall <strong>Firewall</strong> eine Voraussetzung. </p><br><div class="spoiler">  <b class="spoiler_title">Wenn während der Bereitstellung der VM für die gehostete Engine die folgende Fehlermeldung angezeigt wird:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">[ ERROR ] fatal: [localhost]: FAILED! =&gt; {"changed": false, "msg": "firewalld is required to be enabled and active in order to correctly deploy hosted-engine. Please check, fix accordingly and re-deploy.\n"} [ ERROR ] Failed to execute stage 'Closing up': Failed executing ansible-playbook [https://bugzilla.redhat.com/show_bug.cgi?id=1608467</code> </pre> </div></div><br><p>  Dann müssen Sie eine andere Firewall ausschalten (falls verwendet) und <strong>firewalld</strong> installieren und ausführen: </p><br><pre> <code class="plaintext hljs">yum install firewalld systemctl enable firewalld systemctl start firewalld firewall-cmd --state firewall-cmd --get-default-zone firewall-cmd --get-active-zones firewall-cmd --get-zones</code> </pre> <br><p>  Wenn Sie den ovirt-Agenten später auf einem neuen Host für den Cluster installieren, werden die erforderlichen Ports in <strong>firewalld</strong> automatisch konfiguriert. </p><br><p>  <strong>3)</strong> Starten Sie einen Host neu, auf dem eine VM mit einer gehosteten Engine ausgeführt wird. </p><br><p>  Wie üblich <a href="https://www.ovirt.org/documentation/self-hosted/chap-Maintenance_and_Upgrading_Resources.html">verweisen 1</a> und <a href="https://www.ovirt.org/documentation/self-hosted/chap-Troubleshooting.html">2</a> auf Leitfäden. </p><br><p>  Die gesamte Verwaltung der gehosteten Engine der VM erfolgt NUR mit dem Befehl <strong>hosted-engine</strong> auf dem Host, auf dem sie ausgeführt wird. Sie müssen <strong>Virsh</strong> sowie die Tatsache vergessen, dass Sie über SSH eine Verbindung zu dieser VM herstellen und den <strong>Befehl</strong> „ <strong>shutdown</strong> “ ausführen können. </p><br><div class="spoiler">  <b class="spoiler_title">So versetzen Sie die VM in den Servicemodus:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">hosted-engine --set-maintenance --mode=global hosted-engine --vm-status !! Cluster is in GLOBAL MAINTENANCE mode !! --== Host host1.test.local (id: 1) status ==-- conf_on_shared_storage : True Status up-to-date : True Hostname : host1.test.local Host ID : 1 Engine status : {"health": "good", "vm": "up", "detail": "Up"} Score : 3400 stopped : False Local maintenance : False crc32 : dee1a774 local_conf_timestamp : 1821 Host timestamp : 1821 Extra metadata (valid at timestamp): metadata_parse_version=1 metadata_feature_version=1 timestamp=1821 (Sat Nov 29 14:25:19 2019) host-id=1 score=3400 vm_conf_refresh_time=1821 (Sat Nov 29 14:25:19 2019) conf_on_shared_storage=True maintenance=False state=GlobalMaintenance stopped=False hosted-engine --vm-shutdown</code> </pre> </div></div><br><p>  Wir starten den Host mit dem gehosteten Engine-Agenten neu und tun, was wir brauchen. </p><br><p>  Überprüfen Sie nach dem Neustart den Status der VM mit der gehosteten Engine: </p><br><pre> <code class="plaintext hljs">hosted-engine --vm-status</code> </pre> <br><p>  Wenn unsere VM mit Hosted-Engine nicht startet und ähnliche Fehler im Serviceprotokoll angezeigt werden: </p><br><div class="spoiler">  <b class="spoiler_title">Fehler im Serviceprotokoll:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">journalctl -u ovirt-ha-agent ... Jun 29 14:34:44 host1 journal: ovirt-ha-agent ovirt_hosted_engine_ha.agent.hosted_engine.HostedEngine ERROR Failed to start necessary monitors Jun 29 14:34:44 host1 journal: ovirt-ha-agent ovirt_hosted_engine_ha.agent.agent.Agent ERROR Traceback (most recent call last):#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/agent.py", line 131, in _run_agent#012 return action(he)#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/agent.py", line 55, in action_proper#012 return he.start_monitoring()#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/hosted_engine.py", line 413, in start_monitoring#012 self._initialize_broker()#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/hosted_engine.py", line 537, in _initialize_broker#012 m.get('options', {}))#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/lib/brokerlink.py", line 86, in start_monitor#012 ).format(t=type, o=options, e=e)#012RequestError: brokerlink - failed to start monitor via ovirt-ha-broker: [Errno 2] No such file or directory, [monitor: 'ping', options: {'addr': '172.20.32.32'}] Jun 29 14:34:44 host1 journal: ovirt-ha-agent ovirt_hosted_engine_ha.agent.agent.Agent ERROR Trying to restart agent</code> </pre> </div></div><br><p>  Dann verbinden wir den Speicher und starten den Agenten neu: </p><br><pre> <code class="plaintext hljs">hosted-engine --connect-storage systemctl restart ovirt-ha-agent systemctl status ovirt-ha-agent hosted-engine --vm-start hosted-engine --vm-status</code> </pre> <br><p>  Nach dem Start der VM mit Hosted-Engine wird diese aus dem Wartungsmodus entfernt: </p><br><div class="spoiler">  <b class="spoiler_title">Vorgehensweise zum Entfernen einer VM aus dem Wartungsmodus:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">hosted-engine --check-liveliness hosted-engine --set-maintenance --mode=none hosted-engine --vm-status --== Host host1.test.local (id: 1) status ==-- conf_on_shared_storage : True Status up-to-date : True Hostname : host1.test.local Host ID : 1 Engine status : {"health": "good", "vm": "up", "detail": "Up"} Score : 3400 stopped : False Local maintenance : False crc32 : 6d1eb25f local_conf_timestamp : 6222296 Host timestamp : 6222296 Extra metadata (valid at timestamp): metadata_parse_version=1 metadata_feature_version=1 timestamp=6222296 (Fri Jan 17 11:40:43 2020) host-id=1 score=3400 vm_conf_refresh_time=6222296 (Fri Jan 17 11:40:43 2020) conf_on_shared_storage=True maintenance=False state=EngineUp stopped=False</code> </pre> </div></div><br><p>  <strong>4)</strong> Entfernen der gehosteten Engine und aller damit zusammenhängenden Komponenten. </p><br><p>  Manchmal kann es erforderlich sein, eine zuvor installierte gehostete Engine korrekt zu entfernen - ein <a href="https://www.ovirt.org/documentation/self-hosted/chap-Troubleshooting.html">Link</a> zu einem Leitfaden. </p><br><p>  Führen Sie einfach den Befehl auf dem Host aus: </p><br><pre> <code class="plaintext hljs">/usr/sbin/ovirt-hosted-engine-cleanup</code> </pre> <br><p>  Löschen Sie als Nächstes nicht benötigte Pakete und sichern Sie zuvor einige Konfigurationen, falls erforderlich: </p><br><pre> <code class="plaintext hljs">yum autoremove ovirt* qemu* virt* libvirt* libguestfs</code> </pre> <br><h4 id="sozdanie-novogo-datacentra">  Schaffung eines neuen Rechenzentrums </h4><br><p>  Referenzdokumentation - oVirt Administrationshandbuch.  <a href="https://www.ovirt.org/documentation/admin-guide/chap-Data_Centers.html">Kapitel 4: Rechenzentren</a> </p><br><p>  Zuerst definieren wir, was ein <strong>Rechenzentrum ist</strong> (zitiere ich aus der Hilfe) - dies ist eine logische Einheit, die eine Reihe von Ressourcen definiert, die in einer bestimmten Umgebung verwendet werden. </p><br><p>  Ein Rechenzentrum ist eine Art Container, bestehend aus: </p><br><ul><li>  logische Ressourcen in Form von Clustern und Hosts </li><li>  Cluster-Netzwerkressourcen in Form von logischen Netzwerken und physischen Adaptern auf Hosts, </li><li>  Speicherressourcen (für VM-Festplatten, Vorlagen, Images) in Form von Speicherbereichen (Storage Domains). </li></ul><br><p>  Ein Rechenzentrum kann aus mehreren Clustern bestehen, auf denen mehrere Hosts mit virtuellen Maschinen ausgeführt werden. Es können auch mehrere Speicherbereiche zugeordnet sein. <br>  Es kann mehrere Rechenzentren geben, die unabhängig voneinander arbeiten.  Ovirt hat eine Aufteilung der Zuständigkeiten nach Rollen, und Sie können die Berechtigungen sowohl auf Rechenzentrumsebene als auch für die einzelnen logischen Elemente persönlich konfigurieren. </p><br><p>  Das Rechenzentrum oder die mehreren Rechenzentren werden von einer einzelnen Administrationskonsole oder einem Portal aus verwaltet. </p><br><p>  Um ein Rechenzentrum zu erstellen, öffnen Sie das Verwaltungsportal und erstellen Sie ein neues Rechenzentrum: <br>  <strong>Rechnen</strong> &gt;&gt; <strong>Rechenzentren</strong> &gt;&gt; <strong>Neu</strong> </p><br><p>  Da wir Shared Storage auf dem Speichersystem verwenden, muss der Speichertyp Shared sein: </p><br><div class="spoiler">  <b class="spoiler_title">Screenshot mit dem Rechenzentrumsassistenten</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/bf/eg/id/bfegid-tcvqsfjjxa1oqzop_9iw.png"></p></div></div><br><p>  Bei der Installation einer virtuellen Maschine mit Hosted Engine wird standardmäßig ein Datencenter erstellt - <strong>Datencenter1</strong> . Bei Bedarf können Sie den Speichertyp in einen anderen ändern. </p><br><p>  Das Erstellen eines Rechenzentrums ist eine einfache Aufgabe ohne komplizierte Details. Alle damit verbundenen zusätzlichen Aktionen werden in der Dokumentation beschrieben.  Ich werde nur bemerken, dass einzelne Hosts, die nur über lokalen Speicher (Festplatte) für die VM verfügen, nicht mit dem Speichertyp "Freigegeben" (Sie können sie dort nicht hinzufügen) in das Rechenzentrum gelangen können. Für sie müssen Sie ein separates Rechenzentrum erstellen, d. H.  Jeder einzelne Host mit lokalem Speicher benötigt ein eigenes Rechenzentrum. </p><br><h4 id="sozdanie-novogo-klastera">  Erstellen Sie einen neuen Cluster </h4><br><p>  Dokumentationslink - oVirt Administrationshandbuch.  <a href="https://www.ovirt.org/documentation/admin-guide/chap-Clusters.html">Kapitel 5: Cluster</a> </p><br><p>  Ohne unnötige Details ist ein <strong>Cluster</strong> eine logische Gruppierung von Hosts mit einem gemeinsamen Speicherbereich (in Form von gemeinsam genutzten Laufwerken auf einem Speichersystem, wie in unserem Fall).  Es ist auch wünschenswert, dass die Hosts im Cluster in der Hardware identisch sind und denselben Prozessortyp haben (Intel oder AMD).  Es ist natürlich am besten, dass die Server im Cluster völlig gleich sind. </p><br><p>  Der Cluster ist Teil des Rechenzentrums (mit einem bestimmten Speichertyp - <em>lokal</em> oder <em>gemeinsam genutzt</em> ), und alle Hosts müssen unbedingt zu einem Cluster gehören, je nachdem, ob sie über einen gemeinsamen Speicher verfügen oder nicht. </p><br><p>  Bei der Installation einer virtuellen Maschine mit Hosted-Engine auf dem Host wird standardmäßig ein Rechenzentrum erstellt - <strong>Rechenzentrum1</strong> zusammen mit einem Cluster - <strong>Cluster1</strong> . In Zukunft können Sie dessen Parameter konfigurieren, zusätzliche Optionen aktivieren, Hosts hinzufügen usw. </p><br><p>  Wie üblich wird empfohlen, für Einzelheiten zu allen Clustereinstellungen die offizielle Dokumentation zu Rate zu ziehen.  Von einigen Funktionen der Cluster-Konfiguration füge ich nur hinzu, dass es beim Erstellen ausreicht, nur die grundlegenden Parameter auf der Registerkarte " <strong><em>Allgemein"</em></strong> zu konfigurieren. </p><br><p>  Ich werde die wichtigsten Parameter notieren: </p><br><ul><li>  <em>Prozessortyp</em> - Die Auswahl basiert darauf, welche Prozessoren auf den Clusterhosts installiert sind, von welchem ​​Hersteller sie stammen und welcher Prozessor auf den Hosts der älteste ist, sodass abhängig davon alle verfügbaren Prozessoranweisungen im Cluster verwendet werden. </li><li>  <em>Switch-Typ</em> - In unserem Cluster verwenden wir nur die Linux-Bridge, also wählen wir sie aus. </li><li>  <em>Firewall-Typ</em> - hier ist alles klar, dies ist die Firewall, die auf den Hosts aktiviert und konfiguriert werden muss. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Screenshot mit Cluster-Parametern</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/os/vn/qy/osvnqyj3srg8vjpflkdy9l4e84e.png"></p></div></div><br><h4 id="ustanovka-dopolnitelnyh-hostov-v-self-hosted-okruzhenii">  Installieren zusätzlicher Hosts in einer selbst gehosteten Umgebung </h4><br><p>  <a href="https://www.ovirt.org/documentation/self-hosted/chap-Installing_Additional_Hosts_to_a_Self-Hosted_Environment.html">Link</a> zur Dokumentation. </p><br><p>  Zusätzliche Hosts für die selbst gehostete Umgebung werden auf die gleiche Weise wie ein regulärer Host hinzugefügt, mit dem zusätzlichen Punkt zum Bereitstellen einer VM mit einer gehosteten Engine - <strong><em>Wählen Sie die</em></strong> <strong><em>Bereitstellungsaktion</em></strong> für die <strong><em>gehostete Engine</em></strong> &gt;&gt; <strong><em>Bereitstellen</em></strong> .  Da die LUN für die VM mit der gehosteten Engine auch dem zusätzlichen Host vorgelegt werden muss, kann dieser Host bei Bedarf zum Hosten der VM mit der gehosteten Engine verwendet werden. <br>  Aus Gründen der Fehlertoleranz wird dringend empfohlen, dass mindestens zwei Hosts vorhanden sind, auf denen eine gehostete Engine-VM gehostet werden kann. </p><br><p>  Deaktivieren Sie auf dem zusätzlichen Host iptables (falls aktiviert) und aktivieren Sie firewalld </p><br><pre> <code class="plaintext hljs">systemctl stop iptables systemctl disable iptables systemctl enable firewalld systemctl start firewalld</code> </pre> <br><p>  Installieren Sie die erforderliche KVM-Version (falls erforderlich): </p><br><pre> <code class="plaintext hljs">yum-config-manager --disable mirror.centos.org_centos-7_7_virt_x86_64_libvirt-latest_ yum install centos-release-qemu-ev yum update yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer libguestfs libguestfs-tools dejavu-lgc-sans-fonts virt-top libvirt libvirt-python libvirt-client systemctl enable libvirtd systemctl restart libvirtd &amp;&amp; systemctl status libvirtd virsh domcapabilities kvm | grep md-clear</code> </pre> <br><p>  Installieren Sie die erforderlichen Repositorys und das Installationsprogramm für die gehostete Engine: </p><br><pre> <code class="plaintext hljs">yum -y install http://resources.ovirt.org/pub/yum-repo/ovirt-release43.rpm yum -y install epel-release yum update yum install screen ovirt-hosted-engine-setup</code> </pre> <br><p>  Wechseln Sie als Nächstes zur <strong><em>Open Virtualization Manager-Konsole</em></strong> , fügen Sie einen neuen Host hinzu, und führen Sie die in der <a href="https://www.ovirt.org/documentation/self-hosted/chap-Installing_Additional_Hosts_to_a_Self-Hosted_Environment.html">Dokumentation beschriebenen</a> Schritte aus. </p><br><p>  Daher sollte nach dem Hinzufügen eines zusätzlichen Hosts in der Administrationskonsole ungefähr ein Bild angezeigt werden, wie im Screenshot. </p><br><div class="spoiler">  <b class="spoiler_title">Screenshot des Verwaltungsportals - Hosts</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wh/hr/nc/whhrnchajorr5ogqxinvecjdxi0.png"></p></div></div><br><p>  Der Host, auf dem die VM mit gehosteter Engine zurzeit aktiv ist, hat eine goldene Krone und die Aufschrift „ <em>Ausführen der VM mit gehosteter Engine</em> “. Der Host, auf dem diese VM bei Bedarf ausgeführt werden kann, ist die Aufschrift „ <em>Kann die VM mit gehosteter Engine ausführen</em> “. </p><br><p>  Bei einem Hostfehler, auf dem " <em>Hosted Engine VM ausführen</em> " ausgeführt wird, wird der Host automatisch auf dem zweiten Host neu gestartet.  Außerdem kann diese VM zu Wartungszwecken vom aktiven Host auf den Sicherungshost migriert werden. </p><br><p>  <u>Konfigurieren Sie Power Management / Fencing auf oVirt-Hosts</u> </p><br><p>  Dokumentationslinks: </p><br><ul><li>  Red Hat Virtualization 4.3 -&gt; Technische Referenz -&gt; <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html/technical_reference/chap-power_management">Kapitel 4. Energieverwaltung</a> </li><li>  oVirt Administrationshandbuch -&gt; <a href="https://www.ovirt.org/documentation/admin-guide/chap-Hosts.html">Kapitel 7: Hosts</a> </li></ul><br><p>  Obwohl das Hinzufügen und Konfigurieren des Hosts anscheinend abgeschlossen ist, trifft dies nicht ganz zu. <br>  Für den normalen Betrieb der Hosts und zum Erkennen / Beseitigen von Fehlern ist die Einstellung Energieverwaltung / Fencing erforderlich. </p><br><p>  <strong>Beim Fencing</strong> oder Enclosure wird ein ausgefallener oder ausgefallener Host vorübergehend aus einem Cluster ausgeschlossen. Dabei werden entweder die auf dem Host befindlichen oder die auf dem Host befindlichen Dienste neu gestartet. </p><br><p>  Alle Details zu den Definitionen und Parametern von Power Management / Fencing werden wie in der Dokumentation üblich angegeben. Ich werde nur ein Beispiel für die Konfiguration dieses wichtigen Parameters geben, wenn er auf Dell R640-Server mit iDRAC 9 angewendet wird. </p><br><ol><li>  Wir öffnen das Verwaltungsportal, klicken auf <strong>Compute</strong> &gt;&gt; <strong>Hosts und</strong> wählen den Host aus. </li><li>  Klicken Sie auf <strong>Bearbeiten</strong> . </li><li>  Klicken Sie auf die Registerkarte Energieverwaltung. </li><li>  Aktivieren Sie das Kontrollkästchen neben der Option <strong>Energieverwaltung aktivieren</strong> . </li><li>  Wir <em>aktivieren das</em> Kontrollkästchen neben der <em>Kdump-Integrationsoption,</em> damit der Host beim Schreiben eines Kernel-Crash-Dumps nicht in den Fencing-Modus wechselt. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Hinweis</b> <div class="spoiler_text"><p>  Nachdem Sie die Kdump-Integration auf einem bereits laufenden Host aktiviert haben, muss sie gemäß den Anweisungen im oVirt-Administrationshandbuch -&gt; <a href="https://www.ovirt.org/documentation/admin-guide/chap-Hosts.html">Kapitel 7: Hosts</a> -&gt; Neuinstallieren von Hosts erneut installiert werden. </p></div></div><br><ol><li>  Optional können Sie das Kontrollkästchen <em>Richtliniensteuerung der Energieverwaltung deaktivieren aktivieren,</em> wenn die Host-Energieverwaltung nicht von der Planungsrichtlinie des Clusters gesteuert werden soll. </li><li>  Klicken Sie auf die Schaltfläche ( <em>+</em> ), um ein neues Energieverwaltungsgerät hinzuzufügen. Das Fenster zum Bearbeiten der Eigenschaften des Agenten wird geöffnet. <br>  Füllen Sie für iDRAC9 die Felder aus: <br><ul><li>  <em>Adresse</em> - iDRAC9-Adresse </li><li>  <em>Benutzername / Passwort</em> - bzw. Login und Passwort zur Eingabe von iDRAC9 </li><li>  <em>Typ</em> - drac5 </li><li>  markieren Sie <em>Sichern</em> </li><li>  <em>Fügen</em> Sie die folgenden Optionen hinzu: <em>cmd_prompt =&gt;, login_timeout = 30</em> </li></ul></li></ol><br><div class="spoiler">  <b class="spoiler_title">Screenshot mit “Power Management” -Parametern in den Host-Eigenschaften</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/kz/be/ky/kzbekyoxr6cromqq0epltd2cjbo.png"></p></div></div><br><h4 id="sozdanie-oblasti-hraneniya-ili-storage-domains">  Erstellen Sie einen Speicherbereich oder Speicherdomänen </h4><br><p>  Documentation Link - oVirt Administration Guide, <a href="https://www.ovirt.org/documentation/admin-guide/chap-Storage.html">Kapitel 8: Storage</a> . </p><br><p>  <strong>Eine Speicherdomäne</strong> oder ein Speicherbereich ist ein zentraler Speicherort für Festplatten, Installationsimages, Vorlagen und Snapshots von virtuellen Maschinen. </p><br><p>  Speicherbereiche können über verschiedene Protokolle, Cluster- und Netzwerkdateisysteme mit einem Rechenzentrum verbunden werden. </p><br><p>  OVirt verfügt über drei Arten von Speicherbereichen: </p><br><ul><li>  <strong>Datendomäne</strong> - zum Speichern aller mit virtuellen Maschinen verbundenen Daten (Festplatten, Vorlagen).  Data Domain kann nicht von verschiedenen Rechenzentren gemeinsam genutzt werden. </li><li>  <strong>ISO-Domäne</strong> (veralteter Speicherbereichstyp) - zum Speichern von BS-Installationsimages.  Die ISO-Domäne kann von verschiedenen Rechenzentren gemeinsam genutzt werden. </li><li>  <strong>Export Domain</strong> (veralteter Speicherbereichstyp) - zum temporären Speichern von Bildern, die zwischen Rechenzentren verschoben wurden. </li></ul><br><p>  In unserem speziellen Fall verwendet eine Speicherdomäne vom Typ Datendomäne FCP (Fibre Channel Protocol), um eine Verbindung zu LUNs auf dem Speichersystem herzustellen. </p><br><p>  Aus Sicht von oVirt ist bei Verwendung von Speichersystemen (FC oder iSCSI) jede virtuelle Festplatte, jeder Snapshot oder jede Vorlage eine logische Festplatte. <br>  Blockgeräte werden mithilfe der Datenträgergruppe zu einer einzigen Einheit (auf den Clusterhosts) zusammengefasst und dann mithilfe von LVM in logische Datenträger unterteilt, die als virtuelle Festplatten für VMs verwendet werden. </p><br><p>  Alle diese Gruppen und viele LVM-Volumes können mit den Befehlen <strong>vgs</strong> und <strong>lvs</strong> auf dem <strong>Clusterhost angezeigt</strong> werden.  Alle Aktionen mit solchen Datenträgern sollten natürlich nur von der Ovirt-Konsole aus durchgeführt werden, außer in besonderen Fällen. </p><br><p>  Es gibt zwei Arten von virtuellen Laufwerken für VMs: QCOW2 oder RAW.  Scheiben können <em>dünn</em> oder <em>dick sein</em> .  Schnappschüsse werden immer so <em>dünn erstellt</em> . </p><br><p>  Die Verwaltung von Speicherdomänen oder Speicherbereichen, auf die über FC zugegriffen wird, ist logisch: Für jede virtuelle Festplatte einer VM gibt es ein separates logisches Volume, das nur auf einen Host geschrieben werden kann.  Bei Verbindungen über FC verwendet oVirt so etwas wie Clustered LVM. </p><br><p>  Virtuelle Maschinen, die sich auf demselben Speicherbereich befinden, können zwischen Hosts migriert werden, die demselben Cluster angehören. </p><br><p>  Wie Sie der Beschreibung entnehmen können, bedeutet der Cluster in oVirt wie der Cluster in VMware vSphere oder in Hyper-V im Wesentlichen dasselbe - dies ist eine logische Gruppierung von Hosts, die vorzugsweise in der Hardware identisch sind und über einen gemeinsamen Speicher für Festplatten virtueller Maschinen verfügen. </p><br><p>  Wir fahren direkt mit der Erstellung eines Speicherbereichs für Daten (VM-Festplatten) fort, da das Rechenzentrum ohne diesen Speicherbereich nicht initialisiert wird. <br>  Lassen Sie mich daran erinnern, dass alle LUNs, die den Hosts des Clusters im Speicher <strong>angezeigt</strong> werden, mit dem Befehl " <strong>multipath -ll</strong> " für sie sichtbar sein sollten. </p><br><p>  Gehen Sie gemäß der <a href="https://www.ovirt.org/documentation/admin-guide/chap-Storage.html">Dokumentation</a> zum Portal, gehen Sie zu <strong><em>Speicher</em></strong> &gt;&gt; <strong><em>Domänen</em></strong> -&gt; <strong><em>Neue Domäne</em></strong> und folgen Sie den Anweisungen im Abschnitt "Hinzufügen von FCP-Speicher". </p><br><p>  Füllen Sie nach dem Start des Assistenten die erforderlichen Felder aus: </p><br><ul><li>  <em>Name</em> - Geben Sie den Namen des Clusters ein </li><li>  <em>Domänenfunktion</em> - Daten </li><li>  <em>Speichertyp</em> - Fibre Channel </li><li>  <em>Zu verwendender Host</em> - Wählen Sie den Host aus, auf dem die erforderliche LUN verfügbar ist. </li></ul><br><p>  Wählen Sie in der Liste der LUNs die gewünschte aus, klicken Sie auf <em>Hinzufügen</em> und dann auf <em>OK</em> .  Bei Bedarf können Sie zusätzliche Parameter des Speicherbereichs anpassen, indem Sie auf <em>Erweiterte Parameter</em> klicken. </p><br><div class="spoiler">  <b class="spoiler_title">Screenshot des Assistenten zum Hinzufügen von Speicherdomänen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/tk/tz/gq/tktzgqwyqioqf45ere-qi2ll6bc.png"></p></div></div><br><p>  Entsprechend den Ergebnissen des Assistenten sollten wir einen neuen Speicherbereich erhalten und unser Rechenzentrum sollte in den Status <strong>UP versetzt</strong> oder initialisiert werden: </p><br><div class="spoiler">  <b class="spoiler_title">Screenshots des Rechenzentrums und der Speicherbereiche darin:</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/dj/4j/zm/dj4jzmtuzoyu4ustvkcaqxgywoo.png"></p><br><p><img src="https://habrastorage.org/webt/5l/tn/gd/5ltngdb3ipqfrfkkvktqriegwzq.png"></p></div></div><br><h4 id="sozdanie-i-nastroyka-setey-dlya-virtualnyh-mashin">  Erstellen und Konfigurieren von Netzwerken für virtuelle Maschinen </h4><br><p>  Documentation Link - oVirt Administrationshandbuch, <a href="https://www.ovirt.org/documentation/admin-guide/chap-Logical_Networks.html">Kapitel 6: Logische Netzwerke</a> </p><br><p>  Netzwerke werden verwendet, um logische Netzwerke zu gruppieren, die in der virtuellen oVirt-Infrastruktur verwendet werden. </p><br><p>  Logikschnittstellen wie Linux Bridge werden verwendet, um mit einem Netzwerkadapter in einer virtuellen Maschine und mit einem physischen Adapter auf dem Host zu interagieren. </p><br><p>  Um Datenverkehr zwischen Netzwerken zu gruppieren und aufzuteilen, werden VLANs auf den Switches konfiguriert. </p><br><p>         oVirt,     ,   VLAN  ,        ,        . </p><br><p>                <a href="https://habr.com/ru/company/lenvendo/blog/483980/"> </a> –    <strong>bond1</strong> ,           oVirt. </p><br><p>     hosted-engine,      ,           – <strong>ovritmgmt</strong> ,      . </p><br><p>        <strong>ovritmgmt</strong>   ,    ,      oVirt. </p><br><div class="spoiler"> <b class="spoiler_title">   ovritmgmt</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/li/ym/4o/liym4ottpmognydqgsc7mi3lvfi.png"></p></div></div><br><p>        ,      <strong><em>Network</em></strong> &gt;&gt; <strong><em>Networks</em></strong> &gt;&gt; <strong><em>New</em></strong> ,    <strong><em>General</em></strong>      VLAN,      « <em>VM Network</em> »,          . </p><br><div class="spoiler"> <b class="spoiler_title">    VLAN32</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/gx/3x/nd/gx3xndfoeo-cniaf-cjlnjcefq4.png"></p></div></div><br><p>   <strong><em>Cluster</em></strong> ,       <strong>Cluster1</strong> . </p><br><p>     <strong><em>Compute</em></strong> &gt;&gt; <strong><em>Hosts</em></strong> ,      ,   <strong><em>Network interfaces</em></strong> ,    <em>Setup host networks</em> ,       . </p><br><div class="spoiler"> <b class="spoiler_title">  «Setup host networks»</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/l8/87/me/l887meiynekpssdplkxid4_11yo.png"></p></div></div><br><p>  oVirt         –  VLAN  BRIDGE. </p><br><div class="spoiler"> <b class="spoiler_title">       :</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">cat ifcfg-bond1 # Generated by VDSM version 4.30.17.1 DEVICE=bond1 BONDING_OPTS='mode=1 miimon=100' MACADDR=00:50:56:82:57:52 ONBOOT=yes MTU=1500 DEFROUTE=no NM_CONTROLLED=no IPV6INIT=no cat ifcfg-bond1.432 # Generated by VDSM version 4.30.17.1 DEVICE=bond1.432 VLAN=yes BRIDGE=ovirtvm-vlan432 ONBOOT=yes MTU=1500 DEFROUTE=no NM_CONTROLLED=no IPV6INIT=no cat ifcfg-ovirtvm-vlan432 # Generated by VDSM version 4.30.17.1 DEVICE=ovirtvm-vlan432 TYPE=Bridge DELAY=0 STP=off ONBOOT=yes MTU=1500 DEFROUTE=no NM_CONTROLLED=no IPV6INIT=no</code> </pre> </div></div><br><p>   ,     <u> </u>      <strong>ifcfg-bond1.432</strong>  <strong>ifcfg-ovirtvm-vlan432</strong> . </p><br><p>            c hosted engine,      . </p><br><h4 id="sozdanie-ustanovochnogo-obraza-dlya-razvyortyvaniya-virtualnoy-mashiny">        </h4><br><p>    — oVirt Administration Guide, <a href="https://www.ovirt.org/documentation/admin-guide/chap-Storage.html">Chapter 8: Storage</a> ,  Uploading Images to a Data Storage Domain. </p><br><p>    ,     ,       ,    , , <a href="https://cobbler.github.io/">Cobbler</a>    . </p><br><p>      ,        oVirt. ,     ISO Domain,     oVirt    ,         Storage domain   . </p><br><p>      <strong>Storage</strong> &gt;&gt; <strong>Disks</strong> &gt;&gt; <strong>Upload</strong> &gt;&gt; <strong>Start</strong> <br>       ISO ,     ,    " <em>Test connection</em> ". </p><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/mf/f6/mq/mff6mqownqd8xt9zhyesnobmt2y.png"></p></div></div><br><div class="spoiler"> <b class="spoiler_title">    :</b> <div class="spoiler_text"><p> <code>Unable to upload image to disk d6d8fd10-c1e0-4f2d-af15-90f8e636dadc due to a network error. Ensure that ovirt-imageio-proxy service is installed and configured and that ovirt-engine's CA certificate is registered as a trusted CA in the browser. The certificate can be fetched from https://ovirt.test.local/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA`</code> </p> </div></div><br><p>     oVirt  « <strong>  </strong> » (Trusted Root CA)    ,    . </p><br><p>     Trusted Root CA,   " <em>Test connection</em> ",  : </p><br><pre> <code class="plaintext hljs">Connection to ovirt-imageio-proxy was successful.</code> </pre> <br><p>     ,      ISO  Storage Domain. </p><br><p>  ,    Storage Domain   Data,         ,      Storage Domain  hosted engine,      . </p><br><div class="spoiler"> <b class="spoiler_title">   ISO  Storage Domain  hosted engine</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/1c/eg/vl/1cegvlrj_jio2lyrw8bzwwxqik0.png"></p></div></div><br><h4 id="sozdanie-virtualnoy-mashiny">    </h4><br><p>   : <br> oVirt Virtual Machine Management Guide –&gt; <a href="https://www.ovirt.org/documentation/vmm-guide/chap-Installing_Linux_Virtual_Machines.html">Chapter 2: Installing Linux Virtual Machines <br> Console Clients Resources</a> </p><br><p>    oVirt    ,       .    ,       ,       –        .       –      -   ,   . </p><br><p>      CentOS 7,       . </p><br><p>    ,   <strong>Compute</strong> &gt;&gt; <strong>Virtual Machines</strong> ,     .     ,   <em></em> .   ,   . </p><br><p>   ,       ,   ,   ,      : </p><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/b-/ax/5r/b-ax5rq6w4tfzjp26f0x_oassb8.png"></p><br><p><img src="https://habrastorage.org/webt/zf/og/yc/zfogycv0ghsys-pjj6xl4f6uj64.png"></p><br><p><img src="https://habrastorage.org/webt/da/k9/9s/dak99sg1l7ktd-_kujmswznaveq.png"></p><br><p><img src="https://habrastorage.org/webt/ej/ra/rr/ejrarrisp1wubzm2-cdsawkq0kq.png"></p><br><p><img src="https://habrastorage.org/webt/ka/gi/mv/kagimvvhxi2bei9i-n6gp-ozbse.png"></p></div></div><br><p>     ,  ,        . <br>          : </p><br><div class="spoiler"> <b class="spoiler_title">        </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ph/lz/vv/phlzvvb-isibuzvomxhg-ligxtm.png"></p></div></div><br><p>     ,        . </p><br><div class="spoiler"> <b class="spoiler_title">  ,  «Console»</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ay/w8/7h/ayw87h-2eubjlamhixkkap2j2ag.png"></p></div></div><br><p>       , , <a href="https://virt-manager.org/">Virtual Machine Viewer</a> . </p><br><p>         ,       : </p><br><p><img src="https://habrastorage.org/webt/wu/yj/nm/wuyjnmj_wk_qm_hmzffxkrji0dw.png"></p><br><p>     ,   oVirt guest agent: </p><br><pre> <code class="plaintext hljs">yum -y install epel-release yum install -y ovirt-guest-agent-common systemctl enable ovirt-guest-agent.service &amp;&amp; systemctl restart ovirt-guest-agent.service systemctl status ovirt-guest-agent.service</code> </pre> <br><p>  ,    ,    , ..     ,    , oVirt      .           ,   . </p><br><h4 id="zaklyuchenie">  Fazit </h4><br><p> ,     ,  oVirt –       ,       —      ,    ,    . </p><br><p> -          ,           ,   - ,  ..          ,     , -         .   –   ,     ,             . </p><br><p>     ,           : ,  ,  ,     . </p><br><p>           ,       —     VyOS      (  ,           oVirt). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485208/">https://habr.com/ru/post/de485208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485198/index.html">Eine andere Möglichkeit, die Leistung von .NET-Anwendungsmethoden zu messen</a></li>
<li><a href="../de485200/index.html">Mess am Start: Post-Mortem zur Startgeschwindigkeit einer iOS-Anwendung</a></li>
<li><a href="../de485202/index.html">Unterdrückungssystem</a></li>
<li><a href="../de485204/index.html">Zurück zum Anfang: Warum Amazon bald wieder mehr als 1 Billion US-Dollar kapitalisiert</a></li>
<li><a href="../de485206/index.html">Wie hat mich Typescript enttäuscht und ist es das wert?</a></li>
<li><a href="../de485210/index.html">Einfacher Zombie-Shooter auf Unity</a></li>
<li><a href="../de485214/index.html">CLRium Nr. 7: Praktisch. Seminar, Hausaufgaben mit Verifikation, Mentoring</a></li>
<li><a href="../de485218/index.html">Reserviere Konstanten und Git Hooks in C #</a></li>
<li><a href="../de485220/index.html">Die Entwicklung der Web Application Firewall: von Firewalls zu maschinell erlernbaren cloudbasierten Sicherheitssystemen</a></li>
<li><a href="../de485222/index.html">Wie kann man mit Meinungsbildnern in China zusammenarbeiten? Fünf praktische Tipps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>