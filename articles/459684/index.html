<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèΩ ü§µüèæ üòå Mapa del metro de Mosc√∫ y el mundo entero para Android ü§Ωüèæ üòì üî†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CAP√çTULO 1. Ambici√≥n 
 Finales de febrero de 2018 



 Nosotros, como partidarios de la ideolog√≠a del software libre y el mercado libre, creemos que e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mapa del metro de Mosc√∫ y el mundo entero para Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/involta/blog/459684/"><h3>  CAP√çTULO 1. Ambici√≥n </h3><br>  <i>Finales de febrero de 2018</i> <br><br><img src="https://habrastorage.org/webt/lt/tg/uh/lttguhdjo8ap9vv_i4egmb-7-ma.png"><br><br>  Nosotros, como partidarios de la ideolog√≠a del software libre y el mercado libre, creemos que el monopolio es malo. <br><br>  Un gran n√∫mero de personas necesita una navegaci√≥n conveniente y r√°pida en el metro.  Es extra√±o que no haya un solo competidor digno para la aplicaci√≥n Yandex.Metro.  Decidimos crearlo nosotros mismos, haci√©ndolo en nuestro tiempo libre como hobby. <br><br>  Equipo: en diferentes momentos de 2 a 4 personas. <br><br>  La historia cubre solo la aplicaci√≥n de Android, debido al hecho de que se lanz√≥ primero y todos los mecanismos b√°sicos se ejecutaron en ella.  Por supuesto, la versi√≥n de iOS est√° actualmente disponible. <br><br><h3>  CAP√çTULO 2. La ruta en la oscuridad. </h3><br>  <i>Marzo - junio de 2018.</i> <br><br>  Necesito un mapa  Tomamos SVG, lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">empujamos</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SVGView</a> , todo est√° bien.  Miente terriblemente, pero estamos alegres.  ¬øC√≥mo dibujar rutas separadas?  Nadie lo sabe <br><br>  En el formato SVG, no hay informaci√≥n sobre las capas, si un elemento pertenece a alguna l√≠nea u otra informaci√≥n que sea cr√≠ticamente necesaria para construir una ruta.  Entonces, utilizamos una base de datos para almacenar todos los elementos para renderizar. <br><br>  Adem√°s, necesit√°bamos que la aplicaci√≥n se ejecutara lo m√°s r√°pido posible.  El uso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">WebView</a> desaparece inmediatamente, necesita una superficie GL.  Decidimos probarlo con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SurfaceView</a> (una superficie opengl que se puede usar como lienzo), no es eso.  Puede realizar cambios dentro de s√≠ mismo, parpadeando en negro, ya que simplemente est√° mal implementado y no puede soportar la carga m√°s que renderizar un cubo de 20x20.  Puede aumentar, desapareciendo una vez.  Necesit√°bamos una soluci√≥n diferente, pero que no estuviera tan lejos de SurfaceView, ya que era completamente adecuada para nosotros en la interfaz. <br><br><img src="https://habrastorage.org/webt/ln/gp/cm/lngpcmo0m8odexmxrwgo9e6wqqk.png" alt="imagen"><br>  <i>Brevemente sobre los errores del controlador de Android</i> <br><a name="habracut"></a><br>  Intentamos una implementaci√≥n en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TextureView</a> .  Y, oh Dios, la mayor√≠a de los problemas se han ido.  A pesar de que TextureView es un SurfaceView con esteroides, normalmente se implementa sin errores m√°gicos y ataques epil√©pticos del adaptador de video. <br><br>  Todav√≠a tenemos errores al sincronizar secuencias y ajustar vistas en forma de errores de segmentaci√≥n ilegibles, pero esto fue mejor que un punto negro parpadeante.  En consecuencia, cualquier uso de View no como deber√≠a ser, obliga a redefinir casi todos los m√©todos de View en s√≠.  Esto fue especialmente problem√°tico con TextureView porque este componente consta de 2 partes: Vista y Superficie.  No pueden vivir el uno sin el otro, pero al mismo tiempo simplemente no pueden enviar el evento de muerte de Surface dentro de la Vista, por lo que debes hacer verificaciones manuales despu√©s de casi cada acci√≥n. <br><br>  Los problemas comenzaron cuando tuvimos que aumentar la vista.  Canvas dibuja todo p√≠xel por p√≠xel, por lo que si especificamos un tama√±o de 400x400, los elementos de 0 a 400 ser√°n visibles, pero no externos.  400 es muy peque√±o, en realidad necesitamos un mapa de aproximadamente 5000x5600 p√≠xeles en buenos dispositivos.  Pero, ¬øc√≥mo encajar 5000x5600 en una pantalla de 1920x1080 (16: 9)? <br><br>  Creamos un mapa de lienzo con un tama√±o y una escala que aumentar√° con la resoluci√≥n de la pantalla y disminuir√° con una disminuci√≥n en la resoluci√≥n de la pantalla.  Por lo tanto, resolvimos el problema de mapas muy grandes y dibujados torcidamente en dispositivos con una pantalla grande y mapas demasiado peque√±os en pantallas peque√±as. <br><br>  Cuando comenzamos a probar la tarjeta, result√≥ que en tel√©fonos con la misma resoluci√≥n, la tarjeta se muestra de manera diferente.  Bueno, de manera diferente: en uno se muestra, en el segundo un punto blanco / negro.  Los registros conducen a un rastreador de errores Qualcomm a un error con chips Adreno 330/300 con el estado 'wontfix'.  Genial <br><br>  La √∫nica forma de vencer este error es subestimar el tama√±o de la tarjeta en los tel√©fonos con un determinado chip de video para que no haya un cuadrado blanco en lugar de la tarjeta.  Pero, ¬øc√≥mo sabemos el modelo del chip de video?  Necesitamos crear un GLSurfaceView con un tama√±o de 1x1 p√≠xel al iniciar la aplicaci√≥n, obtener informaci√≥n sobre el chip de video y solo luego dibujar un mapa. <br><br>  "- Pero es una muleta".  S√≠, esto es una muleta.  Esta es una muleta de escala gal√°ctica, pero es mejor que cortar una gran cantidad de dispositivos y esperar que Qualcomm repare el error de sus controladores y env√≠e la actualizaci√≥n a todos los OEM para que podamos usar la tarjeta en tel√©fonos con estos controladores corruptos.  Gracias a nuestros usuarios, pudimos encontrar una soluci√≥n que funciona en todos los dispositivos. <br><br><img src="https://habrastorage.org/webt/q7/id/bi/q7idbi3gu4yrpgt6wnwulawnjua.png" alt="imagen"><br>  <i>¬°Construimos, construimos y finalmente construimos!</i> <br><br>  Tambi√©n una tarea muy interesante fue la superposici√≥n de elementos.  Debido al hecho de que la rama roja se debe dibujar sobre el verde, el verde sobre el azul, el amarillo sobre el rojo, etc., ingresamos los n√∫meros de capa, y nuestra aplicaci√≥n (a simple vista simple) se volvi√≥ similar a Adobe Photoshop :) <br><br>  Decid√≠ c√≥mo dibujar rutas.  Ahora era necesario decidir c√≥mo encontrar el mejor entre ellos.  Para encontrar todas las rutas entre los v√©rtices usamos el algoritmo Floyd-Warshall, para encontrar la ruta m√°s corta usamos el algoritmo Dijkstra, para rutas alternativas el algoritmo Yen.  Cualquier persona interesada en los detalles, haga preguntas en los comentarios. <br><br><h3>  CAP√çTULO 3. La ruta al sol </h3><br>  <i>Junio ‚Äã‚Äã- diciembre 2018</i> <br><br>  En esta etapa, ya sab√≠amos qu√© hacer.  Mejora el producto.  Dibujamos nuevos mapas, agregamos nuevos idiomas, corregimos errores, aceleramos el trabajo, fijamos caracter√≠sticas, reunimos los comentarios de los usuarios y no gastamos un centavo en promocionar la aplicaci√≥n. <br><br>  El 15 de junio, implementamos nuestra aplicaci√≥n para el lanzamiento, complet√°ndola con un mapa del metro de San Petersburgo.  En este mapa decidimos designar embalses y puentes.  Un poco m√°s tarde, Yandex mostr√≥ un redise√±o con un dise√±o similar de tarjetas.  No est√° mal, pensamos. <br><br><img src="https://habrastorage.org/webt/lt/cc/ru/ltccruhk789nwccr8yp4xorpos0.jpeg" alt="imagen"><br><br>  En total, agregamos 10 ciudades: San Petersburgo, Barcelona, ‚Äã‚ÄãPraga, Bak√∫, Kaz√°n, Kiev, Minsk, Nizhny Novgorod, Samara, Novosibirsk.  En el desarrollo de un mapa del metro de Par√≠s y Nueva York, los planes: todo el mundo. <br><br>  En julio, se implement√≥ un back-end para actualizar la informaci√≥n de la estaci√≥n y actualizar r√°pidamente los mapas. <br><br>  En septiembre, ya ten√≠amos un producto fuerte que pod√≠a llevarse a las masas.  Al mismo tiempo, nos reunimos con el desarrollador de la aplicaci√≥n "Metro y MCC - diagramas de estaci√≥n" Nikolai.  En su aplicaci√≥n, reuni√≥ diagramas de estaciones que le permiten navegar r√°pidamente y encontrar la salida deseada.  Muy bueno, pero esta aplicaci√≥n no permit√≠a construir una ruta y ten√≠a un dise√±o desactualizado.  Y por lo tanto, para una audiencia amplia, result√≥ ser m√°s d√©bil que Yandex.Metro. <br>  Acordamos implementar dise√±os de estaciones en nuestra aplicaci√≥n, y la gerencia de la compa√±√≠a apoy√≥ y financi√≥ la idea.  Se ha convertido en una caracter√≠stica asesina.  Nuestros usuarios estaban encantados. <br><br>  <i>Enero - marzo 2019</i> <br><br>  Despu√©s de realizar unos 10 experimentos con la p√°gina de la aplicaci√≥n en Google Play y gastar 18 (!) Mil rublos para marketing, colocamos las aplicaciones en los 3 mejores juegos de Google a pedido del "metro" y "metro de Mosc√∫". <br><br>  En marzo, se public√≥ la versi√≥n iOS de la aplicaci√≥n, que tambi√©n se clasific√≥ con √©xito entre las 5 mejores tiendas de aplicaciones a pedido del Metro de Mosc√∫. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Descargar Android: Metro de Mosc√∫ - diagramas de estaci√≥n, rutas, salidas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Descargar iOS: diagramas de la estaci√≥n de Metro + de Mosc√∫</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459684/">https://habr.com/ru/post/459684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459670/index.html">Ir a amsterdam</a></li>
<li><a href="../459672/index.html">Subrayar en Python</a></li>
<li><a href="../459674/index.html">Inteligencia de amenazas Epic Saga</a></li>
<li><a href="../459680/index.html">Despu√©s de Highload ++ Siberia 2019 - 8 tareas de Oracle</a></li>
<li><a href="../459682/index.html">Calidad de datos en almacenamiento</a></li>
<li><a href="../459688/index.html">Urbanismo en China: menos inconformistas, m√°s ciencia e inform√°tica</a></li>
<li><a href="../459692/index.html">C√≥mo descubrimos modificaciones materiales que contradicen los principios qu√≠micos establecidos</a></li>
<li><a href="../459694/index.html">Datos del museo Art. Desembale y lance Radio 86RK</a></li>
<li><a href="../459696/index.html">Restauraci√≥n de fotos basada en IA</a></li>
<li><a href="../459698/index.html">¬øC√≥mo obligar a Oracle BI 12c a crear tantas variables de sesi√≥n como necesite un programador?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>