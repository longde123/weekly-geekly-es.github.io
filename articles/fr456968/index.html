<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèø üö≥ üë§ Histoire simple derri√®re les jetons d'actualisation et d'acc√®s üóûÔ∏è üèîÔ∏è üèµÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nos jours, le sch√©ma de s√©curit√© repose sur deux jetons assez courants. Il y a beaucoup d'informations sur le th√®me sur Internet. Il n'y a souvent ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Histoire simple derri√®re les jetons d'actualisation et d'acc√®s</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456968/"><p>  De nos jours, le sch√©ma de s√©curit√© repose sur deux jetons assez courants.  Il y a beaucoup d'informations sur le th√®me sur Internet.  Il n'y a souvent qu'une description de ce que sont les jetons d'actualisation et d'acc√®s et comment les utiliser. </p><br><p>  Pour comprendre le concept derri√®re les jetons, je voudrais faire une simple exp√©rience de pens√©e. </p><a name="habracut"></a><br><p>  Imaginons que vous soyez un √©tudiant qui aime l'argent mais qui a souvent environ z√©ro sur le solde de son compte. </p><br><p>  Sur le chemin de votre universit√©, vous ouvrez votre application mobile bancaire pour v√©rifier le solde de votre compte. </p><br><p>  Pour vous montrer qu'une application de solde doit ex√©cuter une demande aupr√®s du serveur bancaire: </p><br><p><code>GET http://api.mybank.com/balance HTTP 1.1</code> <br>  et re√ßoit une r√©ponse </p><br><p> <code>{ balance: '$0.0' }</code> </p> <br><p><img src="https://habrastorage.org/getpro/habr/post_images/34e/6c1/118/34e6c1118c8eab96d9cf2f1fb5e08381.jpg" alt="image"></p><br><p>  Ce serait bien si personne sauf vous ne pouvait v√©rifier votre compte bancaire.  Pour ce faire, ajoutons un en-t√™te sp√©cial avec le nom d'utilisateur et votre mot de passe unique: </p><br><p>  `Autorisation: nom d'utilisateur mot de passe </p><br><p>  Autorisation: JohnDwayson QWERTY1 ¬ª </p><br><p>  Le serveur peut d√©sormais vous authentifier par votre nom d'utilisateur et votre mot de passe personnels.  Cela signifie que la paire JohnDwayson QWERTY1 doit √™tre conserv√©e dans un endroit secret sur votre t√©l√©phone mobile pour √™tre prot√©g√©e de quelqu'un qui n'est pas autoris√© √† d√©penser votre argent.  Ce serait encore mieux si nous pouvions √©viter de stocker le mot de passe mais personne ne veut le saisir trop souvent. </p><br><p>  Lorsque nous utilisons notre application mobile pendant 30 minutes dans un bus, elle enverra votre mot de passe sur le r√©seau plusieurs fois en 30 minutes. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6ce/bf9/719/6cebf9719d878e3dafb4886da36f602e.jpg" alt="image"></p><br><p>  Chaque requset contient un mot de passe <br>  Continuons notre exp√©rience de pens√©e.  Vous √™tes toujours dans un bus et votre application envoie une demande au serveur. </p><br><p>  Que se passe-t-il si une fraude vous attend dans un bus et qu'il peut intercepter un ou quelques paquets http de votre t√©l√©phone portable vers le serveur bancaire? </p><br><p>  Si l'application met √† jour les informations chaque minute, la fraude aura 30 possibilit√©s de croiser les demandes et d'obtenir votre mot de passe. </p><br><p>  Supposons qu'il ait vol√© 5-6 messages.  Votre mot de passe est d√©sormais compromis et la fraude peut l'utiliser pour acc√©der aux informations de votre compte. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7b9/a22/be2/7b9a22be2ee33521e8dfe0f47f0efcab.jpg" alt="image"></p><br><p>  Un homme au milieu peut entendre le mot de passe <br>  Que peut-il faire de ces informations?  Bonne nouvelle qu'il ne peut pas d√©penser votre argent car vous ne l'avez pas ... pour l'instant :) Il ne peut pas non plus changer votre mot de passe car dans ce cas, vous le remarquerez et pouvez utiliser les SMS d'une banque pour r√©cup√©rer le mot de passe.  L'ancien mot de passe vol√© dans ce cas ne sera plus valide et l'√©tudiant √©conomisera son argent </p><br><p>  Mais ce qu'il peut faire, c'est de continuer √† v√©rifier votre √©quilibre en parall√®le avec vous.  Il peut facilement √©crire un script Python qui v√©rifiera votre compte toutes les 10 secondes et d√®s que vous recevrez de l'argent, il pourra d√©penser chaque centime pour acheter des bitcoins.  Probablement pire encore si son script d√©pensera 5 √† 10 buks chaque jour, et il ne sera probablement pas remarqu√© pendant des mois ou des ann√©es. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b87/89e/74e/b8789e74e3f8ae941983355ea3dedb97.jpg" alt="image"></p><br><p>  Le pirate attend votre argent <br>  Pour √©viter cela, nous pouvons demander √† l'utilisateur de changer son mot de passe apr√®s un certain temps.  Disons que le mot de passe sera valide pendant 3 mois.  Heureusement, apr√®s 3 mois, il perdra l'acc√®s √† votre compte.  La mauvaise chose est qu'il ne perdra l'acc√®s √† votre compte qu'apr√®s 3 mois.  √âvidemment, pour √©viter cela, nous pouvons vous demander de changer votre mot de passe tous les mois ou semaines.  Mais cela peut √™tre g√™nant pour les utilisateurs finaux. </p><br><p>  Ce serait bien si nous n'utilisions pas trop souvent notre mot de passe dans nos demandes.  Pour ce faire, nous pouvons introduire un point de terminaison sp√©cial: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://api.mybank.com/login</a> .  Nous allons envoyer nos informations d'identification uniquement √† ce point de terminaison et en retour, le serveur g√©n√©rera pour nous un jeton sp√©cial.  Que ce soit juste une cha√Æne unique, GUID, que le serveur stocke dans sa base de donn√©es.  Appelons cette cha√Æne unique est un jeton d'acc√®s.  Nous l'utiliserons √† la place de notre nom d'utilisateur et de notre mot de passe dans l'en-t√™te de chaque conversation de demande avec le serveur.  Similaire au mot de passe, d√©finissons le d√©lai d'expiration du jeton d'acc√®s. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/392/944/d8f/392944d8f66fb4563d637793b335c552.jpg" alt="image"></p><br><p>  Pour mettre √† jour le solde, nous n'avons pas besoin d'un mot de passe <br>  Reproduisons notre exp√©rience de pens√©e. </p><br><p>  Nous sommes dans le bus et quelqu'un a vol√© notre demande http pour v√©rifier le solde.  Mais maintenant, la fraude n'a qu'un jeton d'acc√®s. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fcf/0e8/1d2/fcf0e81d2b2bc322b7921606dab4a6a4.jpg" alt="image"></p><br><p>  Il ne suffit pas de voler uniquement le jeton d'acc√®s <br>  Quel pirate informatique peut faire maintenant avec ces informations?  Tout d'abord, il ne peut toujours pas d√©penser votre argent.  Deuxi√®mement, il ne peut pas changer de mot de passe car il ne le sait tout simplement pas.  De plus, l'heure d'expiration du mot de passe et du jeton d'acc√®s est d√©sormais deux param√®tres distincts.  Nous pouvons laisser le d√©lai d'expiration du mot de passe √† 3 mois et nous devons choisir l'expiration du jeton d'acc√®s.  Nous aimerions d√©finir cette dur√©e aussi courte que possible, car pour obtenir un nouveau jeton d'acc√®s, nous ne pouvons pas utiliser le jeton lui-m√™me.  Si quelqu'un vole ce jeton, il pourra le renouveler aussi longtemps qu'il le voudra. </p><br><p>  Lorsque le jeton d'acc√®s a expir√©, pour en obtenir un nouveau, nous devons envoyer √† nouveau les informations d'identification de l'utilisateur.  Si vous √™tes dans un bus pendant 30 minutes et que votre d√©lai d'expiration pour le jeton d'acc√®s est de 15 minutes, vous devez envoyer votre mot de passe au moins 2 fois.  Habituellement, nous voulons mettre √† jour le jeton d'acc√®s plus t√¥t, disons toutes les 10 minutes, sinon l'utilisateur peut remarquer des retards pour obtenir un nouveau jeton.  En outre, cela r√©sout le probl√®me lorsque peu de demandes en m√™me temps √©chouent en raison du jeton expir√© et nous devons les r√©essayer dans le bon ordre apr√®s avoir obtenu un nouveau jeton. </p><br><p>  Maintenant, les r√©sultats sont meilleurs.  La fraude n'a acc√®s √† nos donn√©es que pendant 10 minutes au lieu de 3 mois.  Mais il a encore de la bonne monnaie pour voler notre mot de passe et nous ne le remarquerons peut-√™tre pas tant qu'il n'aura pas vol√© notre argent. </p><br><p>  Le probl√®me est maintenant d'obtenir un jeton d'acc√®s, nous avons toujours besoin du mot de passe.  Et si nous g√©n√©rions une cha√Æne unique de plus.  Un jeton sp√©cial utilis√© uniquement pour obtenir un jeton d'acc√®s. </p><br><p>  Pour y parvenir, notre point de terminaison de connexion doit accepter le nom d'utilisateur et le mot de passe et renvoie un nouveau jeton appel√© Actualiser le jeton.  Que nous stockerons dans notre application mobile.  Le jeton d'actualisation peut avoir une dur√©e d'expiration plus longue, par exemple un mois. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/51f/780/30c/51f78030c23d685c5a8d5d5267f671ab.jpg" alt="image"></p><br><p>  Renouveler le flux pour les jetons d'actualisation et d'acc√®s <br>  Chaque fois que nous devons renouveler le jeton d'acc√®s, nous devons simplement envoyer un jeton d'actualisation.  Ainsi, notre mot de passe ne sera envoy√© au serveur qu'une fois par mois ou plus rarement.  Fondamentalement, nous n'avons besoin que d'un mot de passe pour r√©cup√©rer le premier jeton d'actualisation. </p><br><p>  Nous avons toujours besoin d'un jeton d'acc√®s pour ex√©cuter les demandes afin d'obtenir des donn√©es du serveur.  Donc: </p><br><p> <code>POST /login with username and password returns us refresh token</code> <br> <code>POST /renew with refresh token returns us access token</code> <br> <code>POST /balance with access token returns us actual balance</code> </p> <br><p>  Reprenons notre exp√©rience. </p><br><p>  Nous sommes dans un bus.  Notre √©l√®ve v√©rifie son solde. </p><br><p>  Mais maintenant, notre application utilise un jeton d'actualisation qui est stock√© quelque part dans un fichier sur un t√©l√©phone mobile. </p><br><p>  L'application envoie des demandes comme: </p><br><p> <code>POST /renew</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> <br> <code>POST /renew</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> <br> <code>GET /balance</code> </p> <br><p>  Comme pr√©c√©demment, le pirate informatique recoupe quelques requ√™tes avec un jeton d'acc√®s dans un bus. </p><br><p>  Le d√©lai d'expiration du jeton d'acc√®s √©tant de 15 minutes, nous mettons √† jour les jetons toutes les 10 minutes. </p><br><p>  Le pirate ne peut utiliser les informations vol√©es que pendant 10 minutes ou moins. </p><br><p>  Que se passe-t-il s'il intersecte l'une des demandes / renouvellement et dispose d'un jeton d'actualisation et d'acc√®s?  Th√©oriquement, il peut utiliser un jeton d'actualisation pendant un mois pour obtenir de nouveaux jetons d'acc√®s et toujours pouvoir voler de l'argent. </p><br><p>  Mais si nous r√©g√©n√©rons les deux jetons √† chaque demande / renouvellement et que le serveur ne stocke qu'un seul jeton d'actualisation √† la fois.  La copie de fraude du jeton d'actualisation est √©galement devenue invalide dans 10 minutes et il ne peut pas l'utiliser sans nous faire savoir que le jeton est compromis.  S'il essaie de renouveler le jeton, cela invalidera notre jeton et nous serons oblig√©s de nous reconnecter. </p><br><p>  Un autre avantage du jeton d'actualisation est que nous n'avons pas besoin de stocker le mot de passe dans une application ou un navigateur et de stocker uniquement le dernier jeton d'actualisation √† la place. </p><br><p>  Une chose int√©ressante est que le jeton d'acc√®s peut √™tre non seulement une cha√Æne al√©atoire, mais peut contenir des informations utiles.  Par exemple, il peut s'agir du d√©lai d'expiration, de l'ID utilisateur et du r√¥le utilisateur.  Dans ce cas, il est appel√© jeton autonome et le serveur n'a pas besoin d'un acc√®s √† la base de donn√©es pour valider le jeton et les autorisations utilisateur.  Il peut √™tre tr√®s utile dans les microservices car il peut augmenter les performances et diminuer le couplage entre les microservices. </p><br><p>  C'est un peu le th√®me de l'article, mais il convient de mentionner la <code>scope</code> . <br>  Et si nous demandons / renouvelons le point de terminaison uniquement pour un jeton d'acc√®s qui peut √™tre utilis√© exclusivement pour v√©rifier l'√©quilibre? <br>  Si l'utilisateur veut d√©penser de l'argent, il devrait recevoir un deuxi√®me jeton diff√©rent pour cela?  Nous pouvons appeler ce param√®tre ¬´port√©e¬ª. <br>  Nous pouvons donc demander / renouveler? Scope = [balance, news].  Si notre pirate conserve ce jeton, il ne peut pas l'utiliser pour d√©penser notre argent! </p><br><p>  Une id√©e bas√©e sur deux jetons offre une meilleure s√©curit√© d'utilisation qu'un simple mot de passe ou un jeton par conception.  Au lieu de choisir un mot de passe plus long ou des algorithmes de s√©curit√© plus forts. </p><br><p>  C'√©tait mon explication du concept de base derri√®re les jetons et comment ils fonctionnent. </p><br><p>  Sur une pratique, il existe plusieurs impl√©mentations diff√©rentes de ce concept qui peuvent √™tre facilement googl√©. </p><br><p>  Petite note sur la flexibilit√© dans le choix d'une heure d'expiration pour le mot de passe et les jetons. </p><br><p>  Le d√©lai d'expiration typique peut √™tre: </p><br><p>  Pour le mot de passe, c'est 3-6 mois.  Il est bon d'avoir cette limitation.  Comme les bases de donn√©es peuvent √™tre vol√©es et que l'utilisateur peut r√©utiliser le m√™me mot de passe entre les services. </p><br><p>  Pour le jeton d'actualisation, le d√©lai d'expiration peut √™tre d'environ une semaine ou un mois.  Pour les personnes qui travaillent dans un bureau avec un site Web, il est utile d'avoir ce temps au moins plus d'un week-end.  Sinon, ils doivent entrer un mot de passe tous les lundis. </p><br><p>  Le d√©lai d'expiration du jeton d'acc√®s peut √™tre compris entre 10 et 60 minutes.  Un temps plus court n√©cessite plus de demandes de renouvellement, mais un temps plus long peut donner plus de chances de fraude. </p><br><p>  <b>Conclusion</b> : </p><br><p>  Nous devons utiliser un mot de passe pour obtenir un jeton d'actualisation de longue dur√©e.  Envoyez ensuite un jeton d'actualisation pour obtenir un jeton d'acc√®s de courte dur√©e.  Utilisez ensuite un jeton d'acc√®s pour ex√©cuter des requ√™tes utiles. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456968/">https://habr.com/ru/post/fr456968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456954/index.html">Angulaire vs KnockoutJS: les diff√©rences et similitudes fondamentales que vous devez conna√Ætre</a></li>
<li><a href="../fr456956/index.html">WWDC19: un regard int√©rieur</a></li>
<li><a href="../fr456958/index.html">Livres √©lectroniques et leurs formats: parler d'EPUB - son histoire, ses avantages et ses inconv√©nients</a></li>
<li><a href="../fr456962/index.html">Museum DataArt. Bobines avec OS 6.1 pour les ordinateurs EC</a></li>
<li><a href="../fr456966/index.html">NAS arrogant</a></li>
<li><a href="../fr456972/index.html">5 bonnes fa√ßons d'animer les applications React en 2019</a></li>
<li><a href="../fr456974/index.html">Prototypage en VR: 5 fa√ßons de tester une hypoth√®se</a></li>
<li><a href="../fr456976/index.html">Gett support. Comment faisons-nous pour que tout fonctionne?</a></li>
<li><a href="../fr456980/index.html">Stand-up, Scrum, r√©unions quotidiennes - qu'est-ce que c'est et pourquoi</a></li>
<li><a href="../fr456982/index.html">Les syst√®mes de radionavigation utilis√©s par les a√©ronefs pour un atterrissage en toute s√©curit√© ne sont pas s√ªrs et peuvent √™tre fissur√©s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>