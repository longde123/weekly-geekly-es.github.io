<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ» ğŸ‘• ğŸš° ShIoTiny: ventilasi kamar basah (contoh proyek) ğŸŒï¸ ğŸ¨ ğŸ˜”</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Poin-poin penting atau tentang artikel ini 
 Kami melanjutkan serangkaian artikel tentang ShIoTiny - pengontrol yang dapat diprogram secara visual ber...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ShIoTiny: ventilasi kamar basah (contoh proyek)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464485/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/so/ox/uesoox7zwrguyei6o5m_ndp2ufw.jpeg"></div><br><h4>  Poin-poin penting atau tentang artikel ini </h4><br>  Kami melanjutkan serangkaian artikel tentang <b>ShIoTiny</b> - pengontrol yang dapat diprogram secara visual berdasarkan chip <b>ESP8266</b> . <br><br>  Artikel ini menjelaskan contoh proyek kontrol ventilasi di kamar mandi atau ruang lembab lainnya tentang cara membuat program untuk <b>ShIoTiny</b> . <br><br><h4>  Artikel sebelumnya dalam seri. </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ShIoTiny: otomatisasi kecil, Internet, atau "enam bulan sebelum liburan"</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ShIoTiny: node, tautan, dan acara atau fitur program menggambar</a> <br><br><h4>  Referensi </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><b>Situs</b> Proyek <b>ShIoTiny</b></a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Firmware biner, sirkuit pengontrol, dan dokumentasi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Instruksi dan deskripsi node</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menyiapkan broker MQTT cloudmqtt.com</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Panel kontrol dasbor MQTT untuk Android</a> <br><a name="habracut"></a><br><h4>  Pendahuluan </h4><br>  Tidak ada pemahaman di luar pengalaman.  Ini adalah kebenaran yang diuji oleh waktu dan generasi.  Oleh karena itu, tidak ada yang lebih baik untuk mempelajari keterampilan praktis daripada mencoba melakukan sesuatu sendiri.  Dan contoh-contoh yang menunjukkan apa yang bisa dilakukan dan apa yang tidak patut dicoba, akan berguna.  Kesalahan orang lain, tentu saja, tidak dapat mencegah terjadinya kesalahan mereka sendiri, tetapi dapat membantu mengurangi jumlah kesalahan yang terakhir. <br><br>  Pertanyaan dan surat dari para pembaca artikel sebelumnya mengilhami saya untuk membuat proyek kecil, contoh kontrol ventilasi, untuk menunjukkan bagaimana simpul ShIoTiny bekerja. <br><br>  Gagasan awal, atas dasar di mana kontroler <b>ShIoTiny muncul</b> - stasiun <b>pompa</b> dan irigasi - jauh dari cocok untuk semua orang dan akan menarik.  Karena itu, saya mengambil contoh bagi semua orang sistem kontrol ventilasi yang dapat dipahami dan bermanfaat. <br><br>  Saya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">akan</a> mengatakan bahwa ide proyek itu bukan milik saya, tetapi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">saya mendapatkannya dari sini</a> dan kemudian mengadaptasinya ke <b>ShIoTiny</b> . <br><br><h4>  Pertama mengerti apa yang Anda inginkan </h4><br>  Proses budidaya tidak ada habisnya.  Dan properti inilah yang menghancurkan banyak ide dan proyek bagus.  Pengembang, bukannya merilis, jika bukan yang ideal, tetapi hal yang bekerja, terus memperbaikinya.  Dan dia menyempurnakannya sampai para pesaingnya mengelak, melepaskan, jika bukan yang ideal (dan seringkali terus terang celaka), tetapi solusi yang berhasil. <br><br>  Oleh karena itu, sangat penting untuk mengetahui di mana harus mengakhiri proyek.  Atau, dengan kata lain, perlu untuk menentukan apa yang ingin kita dapatkan di akhir proyek dari apa yang kita miliki di awal.  Di Rusia, untuk dokumen yang disusun hanya untuk menggambarkan cara membuat sesuatu, ada kata "rencana" yang pendek dan luas, yang para penerjemah dan manajer yang cacat mental baru-baru ini mulai memanggil "peta jalan" karena suatu alasan.  Ya Tuhan memberkati mereka. <br><br>  Rencana kami akan seperti itu.  Misalkan ada ruangan di mana kelembaban kadang-kadang dapat meningkat secara dramatis.  Misalnya, seperti kamar mandi atau dapur.  Kelembaban adalah hal yang tidak menyenangkan dan cara mengatasinya sama tuanya dengan dunia: ventilasi ruangan.  Ada beberapa metode penayangan.  Tapi kami, mungkin, akan menolak cara-cara eksotis dan kuno seperti orang kulit hitam dengan jaring dan berhenti di kipas biasa.  Penggemar lebih murah, dan menemukannya di daerah kami lebih mudah. <br><br>  Singkatnya, kami ingin mengontrol kipas: nyalakan dan matikan masing-masing.  Lebih tepatnya, kami ingin dihidupkan dan dimatikan saat diperlukan. <br><br>  Tetap menentukan: dalam kondisi apa kipas dihidupkan dan dalam kondisi apa - matikan. <br><br>  Semuanya terlihat jelas di sini: jika kelembaban di atas batas yang telah ditentukan, kipas menyala dan menarik udara;  kelembaban telah kembali normal - kipas mati. <br><br>  Pembaca yang penuh perhatian akan segera menangkap kata "diberikan".  Siapa yang diberikan?  Bagaimana preset? <br><br>  Ada beberapa cara untuk mengatur kelembaban ambang.  Kami akan mempertimbangkan dua di antaranya: yang pertama - dengan bantuan resistensi variabel dan yang kedua - melalui jaringan melalui protokol MQTT.  Masing-masing metode ini memiliki kelebihan dan kekurangan, yang akan dibahas nanti. <br><br>  Bagi mereka yang tidak mengerti, saya akan menjelaskan bahwa "ambang batas kelembaban" adalah tingkat kelembapan, melebihi yang membutuhkan masuknya kipas. <br><br>  Pertanyaan selanjutnya adalah apakah memberi pengguna hak untuk menyalakan kipas secara langsung?  Artinya, terlepas dari tingkat kelembaban, dengan satu sentuhan tombol?  Kami akan menyediakan kesempatan seperti itu.  Bagaimanapun, kipas mungkin diperlukan tidak hanya dengan kelembaban tinggi, tetapi juga untuk mengeluarkan dari ruangan, misalnya, bau yang tidak menyenangkan, yang populer disebut "bau". <br><br>  Jadi, kami mengerti apa yang kami inginkan dan bahkan sedikit cara kerjanya.  Kami mendaftar secara singkat semua fungsi sistem kontrol ventilasi kami: <br><br><ul><li>  mengatur tingkat kelembaban ambang (dua opsi); </li><li>  pengukuran kelembaban; </li><li>  pemasukan otomatis kipas; </li><li>  shutdown otomatis dari kipas; </li><li>  pemasukan kipas secara manual (dengan satu sentuhan tombol). </li></ul><br>  Jadi, rencananya jelas.  Penting untuk mengimplementasikan semua fungsi di atas dalam program kami.  Atas dasar "rencana" ini kami akan bertindak.  Untuk memulai, gambarkan diagram blok perangkat. <br><br><h4>  Diagram blok perangkat </h4><br>  Secara umum, kita akan memiliki dua skema seperti itu.  Yang pertama adalah untuk opsi di mana tingkat kelembaban ambang batas diatur oleh variabel resistensi.  Skema kedua adalah untuk opsi di mana tingkat kelembaban ambang batas diatur melalui jaringan melalui protokol MQTT. <br><br>  Tetapi karena sirkuit ini akan berbeda hanya dengan satu elemen - resistor variabel "mengatur tingkat kelembaban ambang", maka kita hanya akan menggambar satu diagram struktural.  Tentu saja, skema struktural menurut GOST terlihat berbeda.  Tapi kami fokus bukan pada insinyur bison, tetapi pada generasi muda.  Karena itu, visibilitas lebih penting. <br><br><img src="https://habrastorage.org/webt/ut/qh/db/utqhdblfgdlmsv0rkcgqxaztvo8.jpeg"><br><br>  Jadi apa yang kita lihat dalam gambar?  Kipas terhubung ke relai <b>Relay1 pada</b> pengontrol <b>ShIoTiny</b> .  Saya menarik perhatian Anda pada fakta bahwa kipas adalah alat yang hidup di bawah tegangan tinggi.  Karena itu, jika ada yang akan melakukan ini sendiri - berhati-hatilah.  Itu, setidaknya, sebelum menjulurkan jari Anda atau alat ukur ke sirkuit - lepaskan setidaknya kipas.  Dan poin kedua.  Jika kipas Anda lebih kuat dari <b>250W</b> , maka Anda tidak <b>harus</b> menghubungkannya langsung ke <b>ShIoTiny</b> - hanya melalui starter. <br><br>  Kami menemukan kipas.  Sekarang tombol "manual menyala" dari kipas.  Terhubung ke input <b>Input1</b> .  Tidak ada lagi yang bisa dijelaskan. <br><br>  Sensor suhu dan kelembaban <b>DHT-11</b> (atau <b>DHT-22</b> atau analognya).  Untuk menghubungkannya, input khusus disediakan pada pengontrol <b>ShIoTiny</b> .  Seperti yang Anda lihat pada gambar, menghubungkan sensor seperti itu juga tidak menimbulkan masalah. <br><br>  Dan akhirnya, resistensi variabel yang menetapkan tingkat kelembaban ambang batas.  Lebih tepatnya, pembagi yang terdiri dari resistensi variabel dan konstan.  Tidak ada masalah dengan koneksinya, tetapi saya akan menjelaskan bahwa ADC <b>bawaan</b> pada <b>ESP8266</b> dirancang untuk maksimum 1 volt.  Oleh karena itu, pembagi tegangan diperlukan sekitar 5 kali. <br><br>  Dan sekali lagi saya mengingatkan Anda bahwa pembagi ini tidak diperlukan jika tingkat kelembaban ambang diatur melalui jaringan menggunakan protokol MQTT. <br><br>  Kami akan mulai menyusun algoritma perangkat di editor ElDraw ShIoTiny.  Cara menuju ke sana, di editor ini, Anda dapat membaca di artikel sebelumnya atau di instruksi, tautan yang ada di awal artikel. <br><br><h4>  Opsi satu, yang paling sederhana </h4><br>  Mari kita mulai dengan yang sederhana: nyalakan relai <b>Relay1 ketika</b> tingkat kelembaban ambang terlampaui untuk waktu tertentu. <br><br><img src="https://habrastorage.org/webt/un/8e/kd/un8ekdrb8cy8zvbc6e_ae2ygwyw.png"><br><br>  Seperti yang Anda lihat, tidak ada yang rumit: hanya empat node, tidak termasuk node komentar.  <b>DHT11</b> sebenarnya adalah sensor suhu dan kelembaban (dapat diubah menjadi <b>DHT22</b> ). <br><br>  <b>Konstanta CONST</b> adalah tingkat kelembaban ambang batas, dalam persen. <br><br>  Comparator - node yang membandingkan dua angka dan mengatur output 1 jika kondisi yang ditentukan terpenuhi dan 0 jika kondisi tidak terpenuhi. <br><br>  Dalam kasus kami, kondisi ini adalah <b>A&gt; B</b> , di mana <b>A</b> adalah tingkat kelembaban yang diukur oleh sensor, dan <b>B</b> adalah tingkat ambang dari kelembaban yang sama. <br><br>  Segera setelah tingkat kelembaban yang diukur ( <b>A</b> ) melebihi ambang batas tingkat kelembaban ( <b>B</b> ), 1 akan segera muncul pada output komparator <b>A&gt; B</b> dan relai akan menyala.  Sebaliknya, segera setelah tingkat kelembaban kembali ke normal (yaitu, <b>A &lt;= B</b> ), segera pada output komparator <b>A&gt; B,</b> 0 akan muncul dan relai akan mati. <br><br>  Apakah semuanya jelas?  Untuk siapa tidak begitu - baca lagi atau lihat deskripsi operasi dari node dalam instruksi. <br><br>  Saya perhatikan bahwa data dari sensor <b>DHT11</b> diperbarui sekitar sekali setiap 10 detik.  Oleh karena itu, relai tidak dapat dihidupkan dan dimatikan lebih sering dari sekali setiap 10 detik. <br><br>  Semuanya akan baik-baik saja, tetapi kami ingin mengatur tingkat kelembaban ambang menggunakan resistor variabel.  Tidak ada yang lebih mudah! <br><br><img src="https://habrastorage.org/webt/ez/qe/oi/ezqeoioucwwf0nm90o2sibwizj0.png"><br><br>  Cukup ganti node konstan dengan node ADC.  Bagaimanapun, itu ke ADC bahwa kita menghubungkan pembagi tegangan dengan resistor variabel. <br><br>  Tegangan pada input ADC bervariasi dari 0 hingga 1 Volt.  Tetapi kelembaban pada output sensor - bervariasi dari 0 hingga 100%.  Bagaimana kita membandingkannya?  Semuanya sederhana.  Node ADC di <b>ShIoTiny</b> tidak hanya mengukur tegangan input, tetapi juga tahu bagaimana mengatur <i><b>skala dan menggesernya</b></i> . <br><br>  Yaitu, pada output dari simpul ADC1 (ADC) akan ada nilai <b>X yang</b> dihitung oleh rumus <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.014ex" height="2.419ex" viewBox="0 -780.1 7755.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-58" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMAIN-3D" x="1130" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-6B" x="2186" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-63" x="2958" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-64" x="3391" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-6F" x="3915" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-74" x="4400" y="0"></use><g transform="translate(4762,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-6E" x="345" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMAIN-2B" x="6325" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-62" x="7326" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>X</mi><mo>=</mo><mi>k</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>b</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> X = k \ cdot u_ {in} + b </script></p>  dimana <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> u_ {in} </script>  - tegangan pada input ADC (dari 0 ke 1V);  <b>k</b> - range (range ADC) dan <b>b-</b> offset (offset ADC).  Dengan demikian, jika Anda mengatur <b>k = 100</b> dan <b>b = 0</b> , maka ketika berubah <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>n</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.116ex" height="1.817ex" viewBox="0 -520.7 1341.4 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/post/464485/&amp;usg=ALkJrhjoT6j9d-qbG_P-WjBj0ju_S3mOmA#MJMATHI-6E" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> u_ {in} </script>  dalam kisaran dari 0 hingga 1, nilai <b>X</b> pada output unit ADC akan bervariasi dalam kisaran dari 0 hingga 100. Artinya, secara numerik sama dengan kisaran perubahan kelembaban dari 0 hingga 100%. <br><br>  Atau, sederhananya, dengan memutar mesin resistensi variabel, Anda dapat mengatur tingkat kelembaban ambang dari 0 hingga 100. Satu-satunya ketidaknyamanan adalah bahwa tidak ada perangkat layar.  Tetapi dalam prakteknya, jika mesin variabel perlawanan membuat 6 divisi 0%, 20%, 40%, 60%, 80%, 100%), maka ini cukup untuk mengatur tingkat kelembaban ambang batas. <br><br>  Bagaimana kita mengatur koefisien <b>k</b> - range (rentang ADC) dan <b>b-</b> offset (offset ADC)?  Ya, ini lebih mudah daripada lobak kukus!  Klik dengan pointer mouse di simpul <b>ADC1</b> dan segera Anda akan melihat jendela pengaturan.  Di dalamnya Anda dapat mengatur semua yang Anda butuhkan.  Untuk kasus kami, itu akan menjadi jendela seperti itu, seperti pada gambar. <br><br><img src="https://habrastorage.org/webt/cn/so/ub/cnsoubc9q_rhu-2p6hlffcd_1ig.png"><br><br>  Jadi, kami memiliki solusi kerja yang paling sederhana.  Mari kita mulai memperbaikinya. <br>  Omong-omong, solusi paling sederhana memiliki satu keunggulan - tidak memerlukan Internet.  Ini sepenuhnya otonom. <br><br><h4>  Opsi dua, hubungkan tombol </h4><br>  Semuanya berfungsi dan semua orang senang.  Tapi nasib buruk, kita tidak bisa menyalakan ventilasi dengan paksa.  Kami telah sepakat bahwa sebuah tombol akan terhubung ke input <b>Input1</b> , yang akan menghidupkan dan mematikan kipas secara paksa, tidak memperhatikan sensor kelembaban. <br>  Saatnya memproses tombol ini di program rangkaian kami. <br><br><img src="https://habrastorage.org/webt/rn/9h/p8/rn9hp8-41uqwkms65uqiwynd_-k.png"><br><br>  Unit pemrosesan klik tombol disorot dalam garis oranye.  Ini adalah penghitung klik tombol yang diatur ulang ke nol ketika nilai pada outputnya melebihi satu (garis hijau, keluaran <b>CT</b> node). <br><br>  Semuanya berfungsi di sini <b>sejelas</b> sebelumnya: penghitung <b>CT</b> menghitung klik tombol yang terhubung ke <b>Input1</b> .  Artinya, nilai pada output penghitung ini meningkat sebesar 1 dengan setiap klik tombol. <br><br>  Begitu nilai ini menjadi sama dengan dua (yaitu, lebih dari 1), segera pada output komparator <b>A&gt; B</b> muncul 1. Dan 1 ini akan mereset counter <b>CT</b> ke nol.  Ini berarti pembanding, yang lebih rendah sesuai dengan skema! <br><br>  Dengan demikian, tombol kita memiliki dua status - 0 dan 1. Jika kita membutuhkan lebih banyak status (3 atau 4 atau bahkan lebih) - itu akan cukup bagi kita untuk mengubah konstanta <b>CONST</b> dari satu ke nilai lainnya. <br><br>  Jadi, kami memiliki dua kondisi untuk menyalakan kipas: melebihi tingkat kelembaban yang ditetapkan dan menekan tombol satu kali.  Jika salah satu kondisi terpenuhi, kipas akan menyala.  Dan itu akan bekerja sampai tombol ditekan lagi <b>DAN</b> tingkat kelembaban kembali normal. <br><br>  Anda dapat, tentu saja, semakin mempersulit algoritme, tetapi kami tidak akan melakukan ini - kami akan memberikan ruang kreativitas bagi mereka yang menginginkannya. <br><br><h4>  Opsi Tiga, sambungkan ke Internet </h4><br>  Semua yang kami jelaskan cukup fungsional.  Tapi bagaimana dengan pamer?  Lagipula, semua hiper-hacker-cracker jerawat akan menertawakan seseorang yang memutar pena dan menekan tombol, dan tidak mengontrolnya dari smartphone!  Memutar pegangannya adalah "tidak modis".  Tetapi untuk merangkak jari Anda di smartphone, menghapus jari ini ke dalam darah - ini dia, puncak keinginan dari hipster-hacker-cracker (saya tidak pernah bisa membedakan semuanya - jadi jika saya membuat kesalahan, saya minta maaf). <br><br>  Tetapi kita akan merendahkan orang-orang ini.  Tata kelola internet memiliki keunggulan nyata.  Pertama-tama, ini visual.  Ada banyak aplikasi untuk semua platform yang memungkinkan beberapa colekan untuk membuat panel kontrol yang dapat digunakan sepenuhnya untuk pengontrol Carlson kami.  Kedua, ini adalah kesempatan untuk memantau dari jarak jauh kondisi kelembaban di dalam ruangan.  Dan ketiga, Anda tidak hanya dapat melihat apa yang dilakukan kipas - berputar atau tidak, tetapi juga tingkat ambang batas kelembaban yang ditetapkan.  Dan kemudian - kipas dihidupkan secara otomatis atau manual.  Secara umum, apa pun yang Anda inginkan. <br><br>  Tentu saja, untuk beberapa penggemar ada banyak kehormatan - begitu banyak perhatian.  Tapi ini hanya sebuah contoh. <br><br>  Jadi, untuk menghubungkan ke Internet kita akan menggunakan teknologi <b>MQTT</b> dan protokol dengan nama yang sama. <br>  Untuk menggunakan teknologi ini, kami membutuhkan <b>broker MQTT</b> .  Ini adalah server khusus yang melayani <b>klien MQTT</b> , misalnya, <b>ShIoTIny</b> dan ponsel cerdas Anda. <br><br>  Inti dari teknologi <b>MQTT</b> adalah bahwa setiap klien menerbitkan data sewenang-wenang dengan nama tertentu (disebut <b>topik</b> dalam terminologi <b>MQTT</b> ) pada broker MQTT (server).  Pelanggan lain dapat berlangganan data sewenang-wenang dengan nama ( <b>topik</b> ) mereka dan menerima data yang baru diterbitkan.  Yaitu, seluruh pertukaran data berdasarkan prinsip klien-pialang-klien. <br><br>  Saya <i><b>tidak akan</b></i> fokus pada detail.  Ada banyak artikel dan tutorial di Internet tentang cara kerja <b>MQTT</b> dan program apa saja yang tersedia untuk membuat panel kontrol.  Saya hanya akan menunjukkan kepada Anda bagaimana menerima dan mempublikasikan data menggunakan <b>ShIoTiny</b> . <br><br>  Sebagai broker, saya menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.cloudmqtt.com</a> , tetapi prinsipnya sama di mana-mana. <br><br>  Jadi, kami akan menganggap bahwa Anda telah terdaftar di <b>broker MQTT</b> .  Secara umum, broker akan memberi Anda (atau perlu menemukan) nama pengguna dan kata sandi (untuk otorisasi), serta port untuk koneksi.  <b>Ada</b> dua cara untuk menghubungkan <b>ShIoTiny</b> ke <b>broker MQTT</b> - koneksi reguler dan <b>TLS</b> ( <b>SSL</b> ). <br><br>  Semua parameter ini di <b>ShIoTiny</b> dimasukkan pada tab <b>Networking</b> , bagian <b>MQTT Connection ke server</b> . <br><br><img src="https://habrastorage.org/webt/97/6j/kb/976jkbemm294uso3-pjdcb4wx_4.png"><br><br>  Jika <b>broker MQTT</b> Anda tidak memerlukan otorisasi, jangan masukkan login dan kata sandi Anda (biarkan bidang ini kosong). <br><br>  Parameter <b>awalan topik MQTT</b> memerlukan penjelasan terpisah. <br><br>  Awalan parameter MQTT adalah baris yang ditambahkan ke judul topik saat menerbitkan dan berlangganan broker MQTT.  Untuk mengatur <b>awalan MQTT</b> untuk pengontrol Anda, Anda hanya perlu memasukkannya di bidang input " <b>awalan topik MQTT</b> " (" <b>awalan topik MQTT</b> ").  Awalan selalu dimulai dengan garis miring ( <b>"/"</b> )!  Jika Anda tidak memasukkan garis miring di bidang input, itu akan ditambahkan secara otomatis.  Karakter <b>"#"</b> dan <b>"+"</b> tidak dapat digunakan di awalan.  Tidak ada batasan lain. <br><br>  Misalnya, jika Anda menerbitkan parameter " <b>status</b> " (atau berlangganannya), dan awalan Anda diatur ke " <b>/ shiotiny /</b> ", maka pada broker parameter ini akan dipublikasikan dengan nama " <b>/ shiotiny / status</b> ".  Jika Anda memiliki set awalan kosong, maka semua parameter pada broker akan dimulai dengan garis miring ( <b>â€œ/â€</b> ): â€œ <b>status</b> â€ akan dipublikasikan sebagai â€œ <b>/ status</b> â€. <br><br>  Jadi, kami yakin Anda telah terdaftar di <b>broker MQTT</b> dan menerima login, kata sandi, dan port Anda.  Kemudian Anda mengatur parameter ini pada tab <b>Networking</b> , bagian <b>MQTT Connection ke server</b> <b>dari</b> pengontrol <b>ShIoTiny</b> . <br><br>  Kami percaya bahwa awalan diatur ke " <b>/ room /</b> ". <br><br>  Untuk memulainya, kami akan menerbitkan status semua parameter utama: Relay <b>realay1</b> , manual pada keadaan, otomatis pada keadaan dan, akhirnya, ambang batas dan tingkat kelembaban saat ini.  Nah dan bonus - suhu di dalam ruangan.  Cara melakukan ini, lihat gambar. <br><br><img src="https://habrastorage.org/webt/tq/xj/la/tqxjla44g3klhb_apkinf7yudka.png"><br><br>  Seperti yang Anda lihat, perbedaan dari versi sebelumnya hanya node <b>MQTT Publish</b> .  Diberikan awalan, parameter berikut dipublikasikan: <br><img src="https://habrastorage.org/webt/hr/9c/wd/hr9cwdccjlb3tnpkgm2g7grdyhe.jpeg"><br><br>  Seperti yang Anda lihat, seluruh kondisi sistem dalam tampilan penuh! <br><br>  Tapi kami ingin tidak hanya melihat, tetapi juga mengontrol.  Bagaimana menjadi  Sangat sederhana.  Kami akan menolak untuk mengatur tingkat kelembaban ambang menggunakan <b>ADC</b> dan variabel resistor dan kami akan mengatur tingkat kelembaban ambang ini dengan <b>MQTT</b> langsung dari smartphone! <br><br><img src="https://habrastorage.org/webt/dr/e3/yw/dre3ywd0uyw_cjtw8tnzr-doicq.png"><br><br>  Kami menghapus simpul ADC dari rangkaian dan memasukkan tiga simpul baru di sana: <b>toko</b> <b>FLASH</b> , <b>pengembalian FLASH</b> , dan <b>uraikan MQTT</b> . <br><br>  Fungsi <b>MQTT menggambarkan</b> simpul sudah jelas: ia menerima <b>parameter / room / trigHset</b> (tingkat kelembaban batas) dari <b>broker MQTT</b> .  Tapi apa yang dia lakukan dengan data selanjutnya?  Ini hanya memberi mereka ke simpul <b>toko FLASH</b> , yang, pada gilirannya, menyimpan data ini dalam memori non-volatile dengan nama <b>trigH</b> .  Setelah itu, simpul <b>pemulihan FLASH</b> membaca data dengan nama <b>trigH</b> dari memori non-volatile dan kita sudah tahu apa yang terjadi selanjutnya. <br><br>  Mengapa kesulitan seperti itu?  Mengapa saya tidak bisa langsung mengirim data yang diterima ke input pembanding? <br><br>  Seperti yang dikatakan Kamerad S. Holmes, <i>ini dasar</i> !  Tidak ada yang menjamin bahwa setelah menghidupkan perangkat Anda, itu akan bergabung dengan <b>broker MQTT</b> .  Dan kelembaban harus diukur.  Dan kipas angin harus dihidupkan.  Tetapi tanpa informasi tentang tingkat kelembaban ambang, ini tidak mungkin!  Oleh karena itu, ketika dinyalakan, perangkat kami mengekstraksi tingkat kelembaban ambang yang tersimpan sebelumnya dari memori non-volatil dan menggunakannya untuk pengambilan keputusan.  Dan ketika koneksi dengan <b>broker MQTT dibuat</b> dan seseorang menerbitkan nilai <b>/ ruang / trigHset baru</b> , maka nilai baru ini akan digunakan. <br><br>  Maka Anda dapat menciptakan apa pun yang Anda inginkan.  Misalnya, selain kelembaban, masukkan juga catatan suhu.  Atau tambahkan kontrol pencahayaan "pintar" (kami masih meninggalkan dua relay dan dua input yang tidak digunakan).  Semuanya ada di tangan Anda! <br><br><h4>  Kesimpulan </h4><br>  Jadi kami melihat beberapa contoh implementasi pengontrol esensi paling sederhana berdasarkan ShIoTiny.  Mungkin itu akan bermanfaat bagi seseorang. <br><br>  Seperti biasa, saran, keinginan, pertanyaan, kesalahan ketik, dll., <b>Melalui</b> email: <b>shiotiny@yandex.ru</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id464485/">https://habr.com/ru/post/id464485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id464465/index.html">Bagaimana dan mengapa kami bermigrasi Preply ke Kubernetes</a></li>
<li><a href="../id464467/index.html">Pelajari analisis web dari awal. Banyak pilihan</a></li>
<li><a href="../id464471/index.html">pemantauan printer snmp di The Dude</a></li>
<li><a href="../id464479/index.html">"Manifesto programmer pemula dari spesialisasi terkait" atau bagaimana saya sampai pada kehidupan seperti itu</a></li>
<li><a href="../id464481/index.html">Bagaimana kami membangun sistem pelatihan dan motivasi di studio</a></li>
<li><a href="../id464487/index.html">Kami sedang membangun antarmuka untuk memasukkan dokumen melalui seleksi</a></li>
<li><a href="../id464489/index.html">Buildbot dalam contoh</a></li>
<li><a href="../id464491/index.html">Vivaldi 2.7 - Kehidupan Intens dalam Keheningan</a></li>
<li><a href="../id464495/index.html">Pengembangan tim dan refleksi sebagai komunikasi manajerial pemimpin tim</a></li>
<li><a href="../id464497/index.html">JIRA sebagai obat untuk insomnia dan gangguan saraf</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>