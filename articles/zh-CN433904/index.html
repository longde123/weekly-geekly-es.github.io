<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📂 ⛺️ 😔 Jira DataCenter-这是什么？ 如何运作？ 如何部署？ 🔽 🎫 👩🏾‍🤝‍👩🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="引言 
 随着敏捷哲学的传播，俄罗斯的IT专家每年都在针对开发团队的产品定制和管理领域获得越来越多的专业知识和能力，其中最受欢迎的仍然是Jira。 但是，使用最古老，生产力最高且最易访问的版本-Jira数据中心-仍然引起很多问题。 在本文中，我将讨论我们在实践中应用的Jira DataCenter的...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jira DataCenter-这是什么？ 如何运作？ 如何部署？</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433904/"><h2> 引言 </h2><br> 随着敏捷哲学的传播，俄罗斯的IT专家每年都在针对开发团队的产品定制和管理领域获得越来越多的专业知识和能力，其中最受欢迎的仍然是Jira。 但是，使用最古老，生产力最高且最易访问的版本-Jira数据中心-仍然引起很多问题。 在本文中，我将讨论我们在实践中应用的Jira DataCenter的一些原理和机制。 我将从关于Jira集群的结构的故事开始。 <br><a name="habracut"></a><br><h2> 什么是Jira数据中心？ </h2><br>  Jira DataCenter本质上是服务器版本，但具有使用公共数据库和共享索引的能力。 <br><br> 重要的是要了解，Jira DataCenter本身（作为产品和应用程序） <b>不</b>提供容错能力和负载平衡。 模块和系统对此负责，而Atlassian产品与之无关。 <br><br> 换句话说，Atlassian提供了在集群中工作的支持，但是集群本身是通过外部手段来实现的，选择的方式非常丰富。 <br><br> 详细的产品说明可<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在Atlassian网站上找到</a> 。 <br><br> 有几种构造选项： <br><br>  1.在自己的基础架构上 <br>  2.在Amazon Cloud（AWS）上 <br>  3.在MS（Azure）的云中 <br><br> 本文将介绍您自己的基础结构的解决方案。 <br><br><h2>  Jira DataCenter解决了哪些问题？ </h2><br>  Jira数据中心可帮助您实现以下目标： <br><br><ol><li> 实行容错。 </li><li> 确保在高负载下稳定运行。 根据《 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Jira Sizing Guide》</a> ，高负载是指大型/企业级实例。 </li><li> 在需要维护时确保连续运行。 在这一点上，我将分别居住。 该应用程序经常需要更新，并且并非所有公司都有能力对用户快速而无形地执行此操作。 通过聚类并使用所谓的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">零停机时间</a>更新方案可以解决此问题。 </li></ol><br> 这些问题通过群集和可伸缩体系结构解决。 <br><br><h2>  Jira数据中心的组成部分是什么？ </h2><br> 如下图所示，Jira DataCenter集群是几台专用计算机的集合。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/df9/c80/76a/df9c8076a3d9bceb3c18a7392588dc5a.png" alt="图片"><br>  <i>图1. Jira数据中心架构</i> <br><br><ol><li> 应用程序节点（应用程序节点或群集节点）。 他们接受并处理所有工作量和请求。 节点的角色由具有相同内容和已安装应用程序以及已安装的共享文件系统的普通服务器扮演。 </li><li> 具有标准功能的文件系统（共享文件系统），用于导入/导出文件，插件，缓存等。 文件服务器还是在其上创建共享文件夹或资源的单独服务器，该服务器被安装到节点上并用于共享文件。 </li><li> 共享数据库 在这种情况下，数据库服务器也是一个单独的服务器，可以在MS SQL，PostgreSQL，MySQL，Oracle上构建。 </li><li> 负载均衡器 它分发用户请求并将其传送到节点，如果其中一个失败，则平衡器几乎立即将其请求重定向到其他节点。 由于其工作，用户甚至没有注意到一个节点的故障。 下面我们将分别讨论平衡器的工作。 </li></ol><br><h2>  Jira数据中心集群拓扑 </h2><br> 我将给出在JDC中构建集群的基本原理： <br><br><ul><li>  Jira实例共享一个公共数据库； </li><li>  Lucene索引可以实时复制并按实例本地存储； </li><li> 附件存储在公共存储库中； </li><li>  Jira实例监视缓存一致性； </li><li> 在任何时候都可以同时激活多个实例； </li><li> 群集锁可用； </li><li> 平衡器配置为仅将请求重定向到活动节点，而不应将请求转发到非活动节点，也不能将所有会话都寻址到一个节点。 </li></ul><br> 所有节点分为主动和被动。 活动节点的不同之处在于： <br><br><ul><li> 处理要求 </li><li> 执行后台流程和任务 </li><li> 可以在一个或多个任务上配置计划任务。 </li><li> 在所有实际情况下，情况看起来都像使用标准的Jira Server。 因此，被动节点不处理请求且不执行任务，而是用于承担短期工作负载（例如，在系统启动，加载插件和/或索引时）。 </li></ul><br> 下图显示了Jira集群的操作 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a5c/fe5/ab3/a5cfe5ab39c39fd277e832ce29364fd9.png" alt="图片"><br>  <i>图2.架构简化图</i> <br><br><h2> 关于负载均衡器 </h2><br> 平衡器可以是安装了反向代理的任何服务器或物理设备。 我将举一些最著名的平衡器例子。 <br><br>  1.硬件平衡器： <br><br>  •思科 <br>  •杜松 <br>  •F5 <br><br>  2.软件平衡器： <br><br>  •mod_proxy（Apache）-Apache HTTP Server的代理服务器，支持最流行的协议和几种不同的负载平衡算法。 <br><br>  •Varnish是反向HTTP代理服务器和加速器，专为高流量站点设计。 与其他服务器不同，它只是HTTP流量的代理服务器和负载平衡器。 特别是，Varnish使用Wikipedia，NY Times，The Guardian和许多其他大型项目。 <br><br>  •Nginx-在负载均衡器和高流量站点的代理解决方案中，排名第一的Web服务器。 它正在积极开发中，制造商提供了免费的公司版本。 在世界上许多访问量最大的网站上使用，例如WordPress.com，Zynga，Airbnb，Hulu和MaxCDN。 <br><br>  •Nginx Plus-实际上是上述的Nginx付费企业版。 <br><br>  •HAProxy是一个免费的开源工具，可为TCP / HTTP协议提供负载平衡和代理功能。 它速度快，消耗的系统资源很少，与Linux，Solaris，FreeBSD和Windows兼容。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此链接上</a>可以找到代理服务器的良好比较。 <br><br><h2> 正反代理 </h2><br> 负载平衡器既可以充当直接代理，也可以充当反向代理。 关于stackoverflow的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此</a>评论的作者很好地描述了这种差异： <br><br>  1.“转发代理”（Forward proxy）。 在这种情况下，代理事件是“直接代理”代表原始请求者从另一个网站检索数据。 作为示例，我将列出连接到Internet的三台计算机。 <br><br>  X = Internet上的计算机或客户端计算机 <br>  Y =代理网站，proxy.example.org <br>  Z =您要访问的网站是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.example.net</a> <br> 通常，您可以直接从X-&gt; Z连接。但是，在某些情况下，最好代表X代表Y-&gt; Z，这在链中看起来像这样：X-&gt; Y-&gt;Z。 <br><br>  2.“反向代理”（Reverse proxy）。 想象同样的情况，只有站点Y配置了反向代理。 通常，您可以直接从X-&gt; Z连接。但是，在某些情况下，Z的管理员最好限制或禁止直接访问，并强制访问者首先通过Y，因此，像以前一样，我们代表Y-&gt; Z接收数据。 X，如下所示：X-&gt; Y-&gt;Z。 <br> 这种情况与“直接代理”不同，因为用户X不知道他正在访问Z，因为用户X看到他正在与Y交换数据。服务器Z对客户端不可见，并且只有外部代理服务器Y在外部可见。 反向代理不需要客户端配置。 客户X认为他仅与Y交互（X-&gt; Y），但实际情况是Y重定向了整个连接（再次X-&gt; Y-&gt; Z）。 <br><br> 接下来，我们将考虑使用软件平衡器。 <br><br><h2> 选择哪个软件平衡器？ </h2><br> 根据我们的经验，Nginx是软件平衡器中的最佳选择，因为它支持Sticky会话模式，并且也是最常用的Web服务器之一，这意味着良好的文档编制和在IT专家之间的广泛欢迎。 <br><br> 粘性会话是一种负载平衡方法，其中客户端请求被发送到同一组服务器。  Nginx的粘性方法使用Cookie进行平衡，但仅限于商业版本。 但是有一种免费的方法-使用外部模块。 <br><br> 该模块创建一个cookie，从而使每个浏览器都是唯一的。 接下来，使用cookie将请求重定向到同一服务器。 如果没有cookie（例如，在第一个请求上），则服务器是随机选择的。 <br> 您可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=http://nginx.org/ru/docs/http/ngx_">此链接</a>以及<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此Habrapost中</a>阅读有关粘性方法的更多信息。 <br><br> 现在，让我们继续实践部分... <br><br><h2> 创建Jira DataCenter集群的说明 </h2><br> 对于集群，可以使用已安装Jira的现有实例，也可以使用新实例。 在我们的示例中，将描述在不同操作系统上安装新实例的过程（以演示系统的多功能性）。 <br><br>  1.让我们从数据库服务器开始。 您可以使用现有的，也可以创建一个新的。 同样，为说明起见，选择了Windows Server 2016 + PostgreSQL 9.4。 安装操作系统，安装PG服务器，安装PG Admin，添加用户和数据库。 <br><br>  2.在Ubuntu 16.04 LTS OS上创建第一个节点。 安装必要的软件包，存储库更新。 <br><br>  3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载</a>并安装Jira DataCenter，启动并配置数据库（以防万一，Atlassian有详细的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">指南</a> ）。 <br><br>  4.关闭Jira，关闭节点。 <br>  <i>服务吉拉站</i> <br><br>  5.为了进行进一步的操作，最好暂时禁用Jira自动运行： <br>  <i>update-rc.d -f jira删除</i> <br><br>  6.我们克隆关闭的节点。 <br><br>  7.启动第一个节点，关闭Jira（默认情况下，安装后的Jira设置为自动运行）。 <br><br>  8.运行第二个节点，关闭Jira。 <br><br>  9.为平衡器创建一个单独的实例。 我选择Ubuntu 16.04是因为 它非常快速，简单，并且不需要许可证形式的额外费用。 <br><br>  10.安装nginx（示例使用的版本1.13.4）。 <br><br>  11.下载并解压缩nginx-sticky-module-ng： <br>  git克隆<a href="">bitbucket.org/nginx-goodies/nginx-sticky-module-ng.git</a> <br><br>  12.准备要<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">重新编译</a>和添加模块的nginx。 <br><br>  13.使用nginx-sticky-module-ng模块编译nginx。 就我而言，编译行结果如下： <br>  <i>./configure --prefix = / etc / nginx --sbin-path = / usr / sbin / nginx --modules-path = / usr / lib / nginx / modules--conf-path = / etc / nginx / nginx。 conf --error-log-path = /var/log/nginx/error.log --http-log-path = / var / log / nginx / access.log --pid-path = / var / run / nginx。 pid --lock-path = /var/run/nginx.lock --http-client-body-temp-path = / var / cache / nginx / client_temp --http-proxy-temp-path = / var / cache / nginx / proxy_temp --http-fastcgi-temp-path = / var /缓存/ nginx / fastcgi_temp --http-uwsgi-temp-path = / var /缓存/ nginx / uwsgi_temp --http-scgi-temp-path = / var / cache / nginx / scgi_temp --user = nginx --group = nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module- -with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_sl_module_with_module -with-http_sub_module --with-ht</i>  <i>tp_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt ='-g -O2 -fstack-protector-参数= ssp缓冲区大小= 4 -Wformat -Werror =格式安全-Wp，-D_FORTIFY_SOURCE = 2 -fPIC'--with-ld-opt ='-Wl，-Bsymbolic函数-Wl，-z，relro -Wl，-z，现在-Wl，-根据需要-pie'--add-module = / usr / local / src / nginx-sticky-module-ng</i> <br><br>  14.找到文件/etc/nginx/nginx.conf，将其复制到.bak， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">将</a> nginx <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">配置</a>为反向代理模式。 <br><br>  15.接下来，我们需要一个文件服务器（最好也是容错的）。 例如，我选择了Windows服务器，在其中<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">创建了</a> NFS球。 <br><br>  16.在每个节点上，我们为NFS支持安装软件包： <br>  <i>apt-get install nfs-common</i> <br><br>  17.创建/ media / jira文件夹并执行： <br>  <i>chmod -R 0777 /媒体/吉拉</i> <br><br>  18.将NFS球挂载为共享球（不是将其挂载在根文件夹中，而是例如在/ media / jira中）-EVERY NODE <br><br>  19.1。 此外，可以执行任何一种手动安装（单个）： <br>  <i>须藤安装-t nfs -O uid = 1000，iocharset = utf-8 xx.xx.xx.xx：/ jira / media / jira</i> <br> 其中xx.xx.xx.xx是带有NFS球的服务器的IP地址 <br><br>  19.2。 或立即自动安装（在操作系统启动时）： <br>  <i>mcedit /等/ fstab</i> <br> 最后，您需要添加以下行： <br>  <i>192.168.7.239:/jira / media / jira nfs用户，rw 0 0</i> <br> 然后保存并退出。 <br><br>  20.分配ID：第一个node1节点，第二个node2节点，依此类推。 <br>  <i>＃此ID在整个集群中必须唯一</i> <i><br></i>  <i>jira.node.id = node1</i> <i><br></i>  <i>＃所有Jira节点的共享主目录的位置</i> <i><br></i>  <i>jira.shared.home = /媒体/吉拉</i> <br><br>  21.在第一个节点上运行jira <br>  <i>服务吉拉开始</i> <br> 检查： <br> 转到系统-&gt;系统信息-&gt;查找集群ON和节点号。 <br><br>  22.设置nginx平衡 <br><br>  23.自 以前我们在节点上禁用了Jira自动启动，然后可以使用以下命令启用它： <br>  <i>update-rc.d -f jira启用</i> <br><br>  24.我们检查集群的运行并根据需要添加节点。 <br><br><h4> 集群启动顺序 </h4><br>  1.启用共享文件系统服务器 <br>  2.启用负载均衡器 <br>  3.启用节点1 <br>  4.启用node2 <br>  5. ... <br><br><h4> 集群停止顺序 </h4><br>  1.使用service Jira stop命令在两个节点上停止Jira <br>  2.关闭节点2 <br>  3.关闭节点1 <br>  4.关闭负载均衡器 <br>  5.关闭文件系统服务器 <br><br><h2> 就这些... </h2><br> 当然，所描述的方法不是唯一的真实方法。 这只是一种实现方式。 <br><br> 我感谢我的同事们在准备材料方面的帮助。 <br> 发表评论，提出问题，并感谢您的关注。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN433904/">https://habr.com/ru/post/zh-CN433904/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN433894/index.html">[视频]为什么火箭爆炸，不久将在Kotlin中出现以及如何保存代码审查</a></li>
<li><a href="../zh-CN433896/index.html">使用机器学习并不困难。 够了一个星期...</a></li>
<li><a href="../zh-CN433898/index.html">摘要MBLT DEV ::第200期</a></li>
<li><a href="../zh-CN433900/index.html">ICQ已死。 ICQ万岁？</a></li>
<li><a href="../zh-CN433902/index.html">对程序员的重复：为什么解决类似问题很重要</a></li>
<li><a href="../zh-CN433906/index.html">使用带有未公开参数的NtQuerySystemInformation函数时遇到的问题</a></li>
<li><a href="../zh-CN433908/index.html">C＃中的俄罗斯方块在100行中</a></li>
<li><a href="../zh-CN433910/index.html">关于Rust 2019的思考</a></li>
<li><a href="../zh-CN433912/index.html">想吸引最好的工程师吗？ 公开码</a></li>
<li><a href="../zh-CN433916/index.html">在喀山参加社区活动和我们的会议</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>