<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéé üêó üõãÔ∏è 9 a√±os en un monolito en Node.JS ü¶Ñ ü§∑üèº üï¥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace una semana, habl√© en una reuni√≥n de Node.JS, y promet√≠ a muchos publicar una grabaci√≥n de la actuaci√≥n. M√°s tarde me di cuenta de que no pod√≠a ac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>9 a√±os en un monolito en Node.JS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459206/"><p><img src="https://habrastorage.org/webt/p-/5g/we/p-5gweh68uzyj3_baevjuocr8xi.png" alt="monolito de https://reneaigner.deviantart.com"></p><br><p>  Hace una semana, habl√© en una reuni√≥n de Node.JS, y promet√≠ a muchos publicar una grabaci√≥n de la actuaci√≥n.  M√°s tarde me di cuenta de que no pod√≠a acomodar algunos hechos interesantes en una media hora regulada.  S√≠, y yo prefiero leer, en lugar de mirar y escuchar, as√≠ que decid√≠ publicar mi presentaci√≥n en el formato de un art√≠culo.  Sin embargo, el video tambi√©n estar√° al final de la publicaci√≥n en la secci√≥n de enlaces. </p><br><p> Decid√≠ hablarte sobre un punto doloroso: la vida en un monolito.  Ya hay cientos de art√≠culos sobre esto en el centro, miles de copias est√°n rotas en los comentarios, la verdad hace mucho que muri√≥ en controversia, pero ... El hecho es que tenemos una experiencia muy espec√≠fica en OneTwoTrip, a diferencia de muchas personas que escriben sobre ciertos patrones arquitect√≥nicos en vac√≠o: </p><br><ul><li>  En primer lugar, nuestro monolito ya tiene 9 a√±os. </li><li>  En segundo lugar, pas√≥ toda su vida bajo alta carga (ahora son 23 millones de solicitudes por hora). </li><li>  Y en NaN, escribimos nuestro monolito en Node.JS, que ha cambiado m√°s all√° del reconocimiento en los √∫ltimos 9 a√±os.  S√≠, comenzamos a escribir en el nodo en 2010, ¬°cantamos una canci√≥n para el frenes√≠ de los valientes! </li></ul><br><p>  As√≠ que tenemos mucha especificidad y experiencia real.  Interesante?  Vamos! </p><a name="habracut"></a><br><p>  <strong>Tiempos de exenci√≥n de responsabilidad</strong> </p><br><blockquote>  Esta presentaci√≥n refleja solo la opini√≥n privada de su autor.  Puede coincidir con la posici√≥n de OneTwoTrip, o puede no coincidir.  As√≠ de afortunado.  Trabajo como experto t√©cnico de uno de los equipos de la compa√±√≠a y no pretendo ser objetivo ni expresar la opini√≥n de alguien m√°s que la m√≠a. </blockquote><p>  <strong>Descargo de responsabilidad dos</strong> </p><br><blockquote>  Este art√≠culo describe eventos hist√≥ricos y, por el momento, todo est√° completamente mal, as√≠ que no se alarme. </blockquote><br><h2 id="0-kak-zhe-tak-vyshlo">  0. ¬øC√≥mo sucedi√≥? </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La tendencia de consulta de la</a> palabra "microservicio" en google: <br><img src="https://habrastorage.org/webt/i5/ss/lm/i5sslmpta1fldeztaxgmmnd50ag.png"><br>  Todo es muy simple: hace nueve a√±os, nadie sab√≠a sobre microservicios.  Entonces comenzamos a escribir, como todos los dem√°s, en un monolito. </p><br><h2 id="1-bol-v-monolite">  1. Dolor en el monolito. </h2><br><p>  Aqu√≠ describir√© las situaciones problem√°ticas que hemos tenido durante estos 9 a√±os.  Algunos de ellos fueron resueltos, otros fueron burlados por hacks, algunos simplemente perdieron relevancia.  Pero el recuerdo de ellos, como las cicatrices de batalla, nunca me dejar√°. </p><br><h3 id="11-obnovlenie-svyaznyh-komponentov">  1.1 Actualizaci√≥n de componentes conectados </h3><br><p><img src="https://habrastorage.org/webt/0a/h-/8f/0ah-8f7ijb259t-blaohq1_dceg.png"><br>  Este es el caso cuando la sinergia es malvada.  Debido a que cualquier componente se reutiliz√≥ varios cientos de veces, y si era posible usarlo torcidamente, entonces no se perdi√≥.  Cualquier acci√≥n puede causar efectos completamente impredecibles, y no todos ellos son rastreados por unidades y pruebas de integraci√≥n.  ¬øRecuerdas la historia de trapeadores, un fan y un globo?  Si no, b√∫scalo en google.  Ella es la mejor ilustraci√≥n del c√≥digo en el monolito. </p><br><h3 id="12-migraciya-na-novye-tehnologii">  1.2 Migraci√≥n a nuevas tecnolog√≠as. </h3><br><p>  Quieres Express?  Linter?  ¬øOtro marco para pruebas o simulacros?  ¬øValidador de actualizaciones o al menos lodash?  ¬øActualizar Node.js?  Lo siento  Para hacer esto, debe editar miles de l√≠neas de c√≥digo. </p><br><p>  Muchos hablan de la ventaja del monolito, que es que <strong>cualquier revisi√≥n es un compromiso at√≥mico</strong> .  Estas personas guardan silencio sobre una <strong>cosa</strong> : <strong>esta revisi√≥n nunca se har√°</strong> . </p><br><p>  ¬øConoces el viejo chiste sobre las versiones sem√°nticas? </p><br><blockquote>  La sem√°ntica real de las versiones sem√°nticas: <br><br>  mayor = un cambio radical <br>  menor = un cambio de ruptura menor <br>  parche = un peque√±o cambio de ruptura </blockquote><p>  Ahora imagine que cualquier cambio de ruptura peque√±o aparecer√° en su c√≥digo.  No, es posible vivir con eso, y peri√≥dicamente reunimos fuerzas y migramos, pero fue realmente muy dif√≠cil.  Muy </p><br><h3 id="13-relizy">  1.3 Lanzamientos </h3><br><p>  Aqu√≠ debo decir sobre algunos detalles de nuestro producto.  Tenemos una gran cantidad de integraciones externas y varias ramas de la l√≥gica empresarial que surgen por separado con bastante poca frecuencia.  Realmente envidio los productos que realmente ejecutan todas las ramas de su c√≥digo en 10 minutos en producci√≥n, pero este no es el caso aqu√≠.  Mediante prueba y error, encontramos un ciclo de lanzamiento √≥ptimo que minimiza la cantidad de errores que llegan a los usuarios finales: </p><br><ol><li>  el lanzamiento est√° en marcha y las pruebas de integraci√≥n pasan en medio d√≠a </li><li>  entonces est√° bajo una cuidadosa supervisi√≥n en el escenario durante un d√≠a (para el 10% de los usuarios) </li><li>  luego descansa otro d√≠a en producci√≥n bajo una supervisi√≥n a√∫n m√°s cuidadosa. </li><li>  Y solo despu√©s de eso le damos luz verde en el maestro. </li></ol><br><p>  Dado que amamos a nuestros colegas y no lanzamos los viernes, al final esto significa que el lanzamiento va al maestro aproximadamente 1.5-2 veces por semana.  Lo que lleva al hecho de que el lanzamiento puede tener 60 tareas o m√°s.  tal cantidad causa conflictos de fusi√≥n, efectos sin√©rgicos repentinos, carga de trabajo completa de control de calidad en el an√°lisis de registros y otras penas.  En general, fue muy dif√≠cil para nosotros liberar un monolito. </p><br><h3 id="14-prosto-ochen-mnogo-koda">  1.4 Solo mucho c√≥digo </h3><br><p>  Parece que la cantidad de c√≥digo no deber√≠a ser de importancia fundamental.  Pero ... no realmente.  En el mundo real es: </p><br><ul><li>  Umbral de entrada m√°s alto </li><li>  Enormes artefactos de construcci√≥n para cada tarea </li><li>  Procesos de CI largos, que incluyen pruebas de integraci√≥n, pruebas unitarias e incluso c√≥digo linting </li><li>  Trabajo lento de IDE (en los albores del desarrollo de Jetbrains los sorprendimos con nuestros registros m√°s de una vez) </li><li>  B√∫squeda contextual sofisticada (no lo olvide, no tenemos escritura est√°tica) </li><li>  Dificultad para encontrar y eliminar c√≥digo no utilizado </li></ul><br><h3 id="15-otsutstvuyut-vladelcy-koda">  1.5 Propietarios de c√≥digos faltantes </h3><br><p>  Muy a menudo, las tareas surgen con una esfera de responsabilidad incomprensible, por ejemplo, en bibliotecas relacionadas.  Y el desarrollador original ya podr√≠a mudarse a otro equipo, o incluso abandonar la empresa.  La √∫nica forma de encontrar responsables en este caso es la arbitrariedad administrativa: tomar y nombrar a una persona.  Lo que no siempre es agradable tanto para el desarrollador como para el que lo hace. </p><br><h3 id="16-slozhnost-otladki">  1.6 Dificultad de depuraci√≥n </h3><br><p>  ¬øEst√° fluyendo la memoria?  ¬øMayor consumo de CPU?  ¬øQuer√≠a construir gr√°ficos de llamas?  Lo siento  En un monolito, suceden tantas cosas al mismo tiempo que se vuelve incre√≠blemente dif√≠cil localizar un problema.  Por ejemplo, para comprender cu√°l de las 60 tareas cuando se implementa en producci√≥n produce un mayor consumo de recursos (aunque esto no se reproduce localmente en entornos de prueba y preparaci√≥n) es casi irreal. </p><br><h3 id="17-odin-stek">  1.7 Una pila </h3><br><p>  Por un lado, es bueno cuando todos los desarrolladores "hablan" el mismo idioma.  En el caso de JS, resulta que incluso los desarrolladores de Backend with Frontend se entienden entre s√≠.  Pero ... </p><br><ul><li>  No hay una bala de plata, y para algunas tareas a veces quieres usar otra cosa.  Pero tenemos un monolito y no tenemos d√≥nde adherir a otros desarrolladores. </li><li>  No podemos simplemente tomar un buen equipo con la recomendaci√≥n, que nos lleg√≥ por consejo de amigos, no tenemos d√≥nde ponerla. </li><li>  Con el tiempo, descansamos en el hecho de que el mercado simplemente no tiene suficientes desarrolladores en la pila correcta. </li></ul><br><h3 id="18-mnogo-komand-s-raznym-predstavleniem-o-schaste">  1.8 Muchos equipos con diferentes ideas sobre la felicidad. </h3><br><p><img src="https://habrastorage.org/webt/1k/bc/k1/1kbck116yjf9-ozmoee08oeacxi.png"></p><br><p>  Si tiene dos desarrolladores, entonces ya tiene dos ideas diferentes sobre cu√°l es el mejor marco, qu√© est√°ndares deben respetarse, usar bibliotecas, etc. <br>  Si tiene diez equipos, cada uno de los cuales tiene varios desarrolladores, entonces esto es solo un desastre. <br>  Y solo hay dos maneras de resolverlo: ‚Äúdemocr√°tico‚Äù (cada uno hace lo que quiere) o totalitario (los est√°ndares se imponen desde arriba).  En el primer caso, la calidad y la estandarizaci√≥n sufren, en el segundo, personas a las que no se les permite realizar su idea de felicidad. </p><br><h2 id="2-plyusy-monolita">  2. Las ventajas del monolito. </h2><br><p>  Por supuesto, hay algunas ventajas en el monolito que pueden ser diferentes para diferentes pilas, productos y equipos.  Por supuesto, hay mucho m√°s que tres, pero no ser√© responsable de todo lo posible, solo de aquellos que fueron relevantes para nosotros. </p><br><h3 id="21-prostota-razvyortyvaniya">  2.1 F√°cil de implementar </h3><br><p>  Cuando tiene un servicio, aumentarlo y probarlo es mucho m√°s f√°cil que una docena de servicios.  Es cierto que esta ventaja solo es relevante en la etapa inicial; por ejemplo, puede elevar el entorno de prueba y utilizar todos los servicios, excepto los desarrollados a partir de √©l.  O de contenedores.  O lo que sea. </p><br><h3 id="22-net-overheda-na-peredachu-dannyh">  2.2 Sin sobrecarga de transferencia de datos </h3><br><p>  Toda una ventaja dudosa, si no tienes mucha carga.  Pero tenemos un caso as√≠, por lo tanto, el costo de transporte entre microservicios es notable para nosotros.  No importa c√≥mo intente hacer esto r√°pidamente, almacene y transfiera todo en RAM m√°s r√°pido que cualquier otra cosa; esto es obvio. </p><br><h3 id="22-odna-sborka">  2.2 Una asamblea </h3><br><p>  Si necesita retroceder en alg√∫n momento de la historia, hacerlo con un monolito es realmente simple: t√≥melo y retroceda.  En el caso de los microservicios, es necesario seleccionar versiones compatibles de servicios que se utilizaron entre s√≠ en un momento determinado, lo que no siempre puede ser simple.  Es cierto que esto tambi√©n se resuelve con la ayuda de la infraestructura. </p><br><h2 id="3-mnimye-plyusy-monolita">  3. Ventajas imaginarias de un monolito </h2><br><p>  Aqu√≠ tom√© todas esas cosas que generalmente se consideran ventajas, pero desde mi punto de vista no lo son. </p><br><h3 id="31-kod---eto-i-est-dokumentaciya">  3.1 C√≥digo: esta es la documentaci√≥n </h3><br><p>  A menudo escuch√≥ esta opini√≥n.  Pero generalmente es seguido por desarrolladores novatos que no han visto archivos en decenas de miles de l√≠neas de c√≥digo escritas por personas que se fueron hace a√±os.  Bueno, por alguna raz√≥n, la mayor√≠a de las veces este elemento se agrega a favor de los partidarios del monolito: dicen que no necesitamos documentaci√≥n, no tenemos ning√∫n transporte o API, todo est√° en el c√≥digo, es f√°cil y claro.  No discutir√© con esta declaraci√≥n, solo dir√© que no creo en ella. </p><br><h3 id="32-net-raznyh-versiy-bibliotek-servisov-i-api-net-raznyh-repozitoriev">  3.2 No existen versiones diferentes de bibliotecas, servicios y API.  No hay repositorios diferentes. </h3><br><p>  Si  Pero no  Porque a segunda vista entiendes que el servicio no existe en el vac√≠o.  Y entre una gran cantidad de otros c√≥digos y productos con los que se integra, comenzando desde bibliotecas de terceros, continuando con versiones de software de servidor y no terminando con integraciones externas, versiones IDE, herramientas de CI, etc.  Y tan pronto como comprenda cu√°ntas cosas versionadas diferentes incluye su servicio indirectamente, inmediatamente queda claro que esta ventaja es solo demagogia. </p><br><h3 id="33-prosche-monitoring">  3.3 monitoreo m√°s f√°cil </h3><br><p>  M√°s f√°cil  Porque tienes, aproximadamente, un tablero de instrumentos, en lugar de unas pocas docenas.  Pero es m√°s complicado, y a veces incluso imposible, porque no puede descomponer sus gr√°ficos en diferentes partes del c√≥digo, y solo tiene la temperatura promedio en el hospital.  En general, ya dije todo en el p√°rrafo sobre la complejidad de la depuraci√≥n, solo aclarar√© que la misma complejidad se aplica al monitoreo. </p><br><h3 id="34-prosche-soblyudat-edinye-standarty">  3.4 Es m√°s f√°cil cumplir con est√°ndares comunes </h3><br><p>  Si  Pero, como ya escrib√≠ en el p√°rrafo sobre muchos equipos con la idea de la felicidad, los est√°ndares se imponen de forma totalitaria o se debilitan casi en ausencia de ellos. </p><br><h3 id="35-menshe-veroyatnost-dublirovaniya-koda">  3.5 Menos posibilidades de duplicaci√≥n de c√≥digo </h3><br><p>  La extra√±a opini√≥n es que el c√≥digo no est√° duplicado en el monolito.  Pero lo conoc√≠ con bastante frecuencia.  En mi pr√°ctica, resulta que la duplicaci√≥n de c√≥digo depende √∫nicamente de la cultura de desarrollo en la empresa.  Si es as√≠, el c√≥digo general se asigna a todo tipo de bibliotecas, m√≥dulos y microservicios.  Si no est√° all√≠, habr√° una copia y pegar veinte veces en el monolito. </p><br><h2 id="4-plyusy-mikroservisov">  4. Pros de microservicios </h2><br><p>  Ahora escribir√© sobre lo que obtuvimos despu√©s de la migraci√≥n.  Nuevamente, estas son conclusiones reales de una situaci√≥n real. </p><br><h3 id="41-mozhno-delat-geterogennuyu-infrastrukturu">  4.1 Puedes hacer una infraestructura heterog√©nea </h3><br><p>  Ahora podemos escribir c√≥digo en una pila que sea √≥ptima para resolver un problema espec√≠fico.  Y es racional utilizar los buenos desarrolladores que vinieron a nosotros.  Por ejemplo, aqu√≠ hay una lista de muestra de tecnolog√≠as que tenemos actualmente: <br><img src="https://habrastorage.org/webt/mt/oc/nr/mtocnrvjvhfhxxtsjfnjx3z8knc.png"></p><br><h3 id="42-mozhno-delat-mnogo-chastyh-relizov">  4.2 Puedes hacer muchos lanzamientos frecuentes </h3><br><p>  Ahora podemos hacer muchos lanzamientos independientes peque√±os, y son m√°s simples, m√°s r√°pidos y no son dolorosos.  Una vez ten√≠amos un solo equipo, pero ahora ya hay 18. Hubiera habido un descanso si todos permanecieran en el monolito.  O las personas responsables de ello ... </p><br><h3 id="43-prosche-delat-nezavisimye-testy">  4.3 M√°s f√°cil de hacer pruebas independientes </h3><br><p>  Hemos reducido el tiempo para las pruebas de integraci√≥n, que ahora solo prueban lo que realmente ha cambiado, y al mismo tiempo no tenemos miedo de los efectos de la sinergia repentina.  Por supuesto, tuve que comenzar a caminar alrededor del rastrillo, por ejemplo, aprender a hacer API compatibles con versiones anteriores, pero con el tiempo, todo se calm√≥. </p><br><h3 id="44-legche-vnedryat-i-testirovat-novye-fichi">  4.4 M√°s f√°cil de implementar y probar nuevas caracter√≠sticas </h3><br><p>  Ahora estamos abiertos a la experimentaci√≥n.  Cualquier marco, pila, biblioteca: puede probarlo todo y, si tiene √©xito, seguir adelante. </p><br><h3 id="45-mozhno-obnovlyat-chto-ugodno">  4.5 Puedes actualizar cualquier cosa </h3><br><p>  Puede actualizar la versi√≥n del motor, las bibliotecas, ¬°pero cualquier cosa!  Como parte de un peque√±o servicio, encontrar y corregir todos los cambios importantes es cuesti√≥n de minutos.  Y no semanas, como era antes. </p><br><h3 id="46--a-mozhno-ne-obnovlyat">  4.6 Y no puedes actualizar </h3><br><p>  Por extra√±o que parezca, esta es una de las mejores caracter√≠sticas de los microservicios.  Si tiene un c√≥digo de trabajo estable, puede congelarlo y olvidarse de √©l.  Y nunca tendr√° que actualizarlo, por ejemplo, para ejecutar el c√≥digo del producto en un nuevo motor.  El producto en s√≠ funciona en un nuevo motor, y el microservicio contin√∫a viviendo como viv√≠a.  Las moscas con chuletas finalmente se pueden comer por separado. </p><br><h2 id="5-minusy-mikroservisov">  5 Contras de microservicios </h2><br><p>  Por supuesto, una mosca en la pomada no estaba completa, y una soluci√≥n perfecta para simplemente sentarse y recibir el pago no funcion√≥.  ¬øQu√© encontramos? </p><br><h3 id="51-nuzhna-shina-dlya-obmena-dannymi-i-vnyatnoe-logirovanie">  5.1 Necesita un bus para el intercambio de datos y el registro claro. </h3><br><p>  La interacci√≥n de los servicios a trav√©s de HTTP es un modelo cl√°sico y, en general, incluso uno funcional, siempre que haya capas de registro y equilibrio entre ellos.  Pero es mejor tener un neum√°tico m√°s distintivo.  Adem√°s, debe pensar en c√≥mo recolectar y combinar registros entre ellos; de lo contrario, solo tendr√° gachas en sus manos. </p><br><h3 id="52-nuzhno-sledit-za-tem-chto-delayut-razrabotchiki">  5.2 Mantenga un registro de lo que est√°n haciendo los desarrolladores. </h3><br><p>  En general, esto siempre debe hacerse, pero en los microservicios, los desarrolladores obviamente tienen m√°s libertad, lo que a veces puede dar lugar a cosas de las que Stephen King se pone nervioso.  Aunque exteriormente parezca que el servicio est√° funcionando, no olvide que debe haber una persona que controle lo que hay dentro de √©l. </p><br><h3 id="53-nuzhna-horoshaya-komanda-devops-chtoby-vsem-etim-upravlyat">  5.3 Necesita un buen equipo de DevOps para gestionarlo todo. </h3><br><p>  Casi cualquier desarrollador puede implementar un monolito de una forma u otra y cargar sus versiones (por ejemplo, a trav√©s de FTP o SSH, lo vi).  Pero con los microservicios, hay todo tipo de servicios centralizados para recopilar registros, m√©tricas, paneles, cocineros para administrar configuraciones, voltios, jenkins y otras cosas buenas, sin las cuales generalmente puede vivir, pero es malo e incomprensible por qu√©.  Entonces, para administrar microservicios, necesita tener un buen equipo de DevOps. </p><br><h3 id="54-mozhno-popytatsya-slovit-hayp-i-vystrelit-sebe-v-nogu">  5.4 Puedes tratar de atrapar una exageraci√≥n y dispararte en el pie. </h3><br><p>  Quiz√°s este sea el principal inconveniente de la arquitectura y su peligro.  Muy a menudo, las personas siguen ciegamente las tendencias y comienzan a introducir arquitectura y tecnolog√≠a sin entenderlo.  Despu√©s de lo cual todo cae, se confunden en el desorden resultante y escriben un art√≠culo sobre el Habr "c√≥mo pasamos de microservicios a un monolito", por ejemplo.  En general, mu√©vase solo si sabe por qu√© est√° haciendo esto y qu√© problemas resolver√°.  Y cu√°les obtienes. </p><br><h2 id="6-haki-v-monolite">  6 caqui en monolito </h2><br><p>  Algunos de los hacks que nos permitieron vivir en un monolito son un poco mejores y un poco m√°s largos. </p><br><h3 id="61-linting">  6.1 Linting </h3><br><p>  La introducci√≥n de un linter en un monolito no es una tarea tan simple como parece a primera vista.  Por supuesto, puede establecer reglas estrictas, agregar una configuraci√≥n y ... Nada cambiar√°, todos simplemente apagan el linter, porque la mitad del c√≥digo se vuelve rojo. </p><br><p>  Para introducir gradualmente el linting, escribimos un complemento simple para eslint, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">slowlint</a> , que le permite hacer una cosa simple: contener una lista de archivos ignorados temporalmente.  Como resultado: </p><br><ul><li>  Todo el c√≥digo incorrecto se resalta en el IDE </li><li>  Los nuevos archivos se crean de acuerdo con las reglas de linting, de lo contrario, CI no los perder√° </li><li>  Los viejos gradualmente gobiernan y se alejan de las excepciones. </li></ul><br><p>  A lo largo del a√±o, fue posible incorporar aproximadamente la mitad del c√≥digo monol√≠tico en un solo estilo, es decir, casi todo el c√≥digo agregado activamente. </p><br><h3 id="62-dorabotki-yunit-testov">  6.2 Mejoras de prueba de unidad </h3><br><p>  Una vez que se realizaron pruebas unitarias con nosotros durante tres minutos.  Los desarrolladores no quer√≠an esperar tanto tiempo, por lo que todo se verific√≥ solo en CI en el servidor.  Despu√©s de un tiempo, el desarrollador descubri√≥ que las pruebas cayeron, maldijo, abri√≥ una rama, volvi√≥ al c√≥digo ... En general, sufri√≥.  ¬øQu√© hemos hecho con esto? </p><br><ol><li>  Para empezar, comenzamos a ejecutar pruebas multiproceso.  Yandex tiene una variante de moca multihilo, pero con nosotros no despeg√≥, por lo que ellos mismos escribieron un contenedor simple.  Las pruebas comenzaron a realizarse una vez y media m√°s r√°pido. </li><li>  Luego pasamos de 0.12 nodos al octavo (s√≠, el proceso mismo se basa en un informe separado).  Por extra√±o que parezca, no dio una ganancia fundamental en productividad en la producci√≥n, pero las pruebas comenzaron a realizarse un 20% m√°s r√°pido. </li><li>  Y luego nos sentamos para depurar las pruebas y optimizarlas individualmente.  Lo que dio el mayor aumento de velocidad. </li></ol><br><p>  En general, en este momento, las pruebas unitarias se ejecutan en el gancho de preparaci√≥n y funcionan en 10 segundos, lo cual es bastante c√≥modo y le permite ejecutarlas sin interrupci√≥n de la producci√≥n. </p><br><h3 id="63--oblegchenie-vesa-artefakta">  6.3 Aligerando el peso del artefacto </h3><br><p>  El artefacto monol√≠tico finalmente tom√≥ 400 megabytes.  Teniendo en cuenta el hecho de que se crea para cada confirmaci√≥n, los vol√∫menes totales resultaron ser bastante grandes.  El m√≥dulo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">diarrea</a> , un tenedor del m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">modclean</a> , nos ayud√≥ con esto.  Eliminamos las pruebas unitarias del artefacto y lo limpiamos de varios tipos de basura, como archivos l√©ame, pruebas dentro de paquetes, etc.  ¬°La ganancia fue de aproximadamente el 30% del peso! </p><br><h3 id="64--keshirovanie-zavisimostey">  6.4 Almacenamiento en cach√© de dependencias </h3><br><p>  Anteriormente, instalar dependencias usando npm tomaba tanto tiempo que no solo se pod√≠a tomar caf√©, sino tambi√©n, por ejemplo, hornear pizza.  Por lo tanto, al principio usamos el m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">npm-cache</a> , que estaba bifurcado y un poco terminado.  Le permit√≠a almacenar dependencias en una unidad de red compartida, de la cual todas las otras compilaciones lo tomar√≠an. </p><br><p>  Luego pensamos en la reproducibilidad de los ensamblajes.  Cuando tienes un monolito, entonces el cambio de dependencias transitivas es el azote de Dios.  Dado el hecho de que est√°bamos muy por detr√°s de la versi√≥n del motor en ese momento, cambiar alguna dependencia de quinto nivel f√°cilmente rompi√≥ todo nuestro ensamblaje.  Entonces comenzamos a usar npm-shrinkwrap.  Ya era m√°s f√°cil con √©l, aunque fusionar sus cambios era un placer para los fuertes de esp√≠ritu. </p><br><p> Y luego finalmente apareci√≥ package-lock y el excelente comando <code>npm ci</code> , que se ejecut√≥ a una velocidad ligeramente menor que la instalaci√≥n de dependencias desde la cach√© de archivos.  Por lo tanto, comenzamos a usarlo solo y dejamos de almacenar ensambles de dependencia.  En este d√≠a traje a trabajar varias cajas de donas. </p><br><h3 id="65--raspredelenie-ocheryodnosti-relizov">  6.5 Distribuci√≥n del orden de los lanzamientos. </h3><br><p>  Y esto es m√°s un truco administrativo, no t√©cnico.  Inicialmente, estaba en contra de √©l, pero el tiempo demostr√≥ que el segundo experto t√©cnico ten√≠a raz√≥n y, en general, estaba bien hecho.  Cuando los lanzamientos se distribuyeron por turnos entre varios equipos, qued√≥ claro d√≥nde aparec√≠an exactamente los errores y, lo que es m√°s importante, cada equipo sinti√≥ su responsabilidad por la velocidad e intent√≥ resolver los problemas y desplegarse lo m√°s r√°pido posible. </p><br><h3 id="66-udalenie-myortvogo-koda">  6.6 Eliminar c√≥digo muerto </h3><br><p>  En un monolito, es muy aterrador eliminar el c√≥digo; nunca se sabe d√≥nde podr√≠a quedar atrapado en √©l.  Por lo tanto, la mayor√≠a de las veces solo queda acostarse de lado.  Con los a√±os  E incluso el c√≥digo muerto debe ser compatible, sin mencionar la confusi√≥n que presenta.  Por lo tanto, con el tiempo, comenzamos a usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">require-analyse</a> para una b√∫squeda superficial de c√≥digo muerto, y pruebas de integraci√≥n m√°s el lanzamiento en el modo de verificaci√≥n de cobertura para una b√∫squeda m√°s profunda. </p><br><h2 id="7-raspil-monolita">  7 corte monol√≠tico </h2><br><p>  Por alguna raz√≥n, muchas personas piensan que para cambiar a microservicios, debe abandonar su monolito, escribir un mont√≥n de microservicios desde cero, comenzar todo de una vez, y habr√° felicidad.  Pero este modelo ... Hmm ... est√° cargado con el hecho de que no har√°s nada, y solo gastar√°s mucho tiempo y dinero en escribir el c√≥digo que tienes que tirar. </p><br><p>  Propongo otra opci√≥n, que me parece m√°s funcional, y que se implement√≥ con nosotros: </p><br><ol><li>  Comenzamos a escribir nuevos servicios en microservicios.  Ejecutamos la tecnolog√≠a, nos subimos al rastrillo, entendemos si queremos hacerlo. </li><li>  Extraemos el c√≥digo en m√≥dulos, bibliotecas o lo que se use all√≠. </li><li>  Distinguimos los servicios de un monolito. </li><li>  Distinguimos los microservicios de los servicios.  Sin prisas y uno a la vez. </li></ol><br><h2 id="8-i-naposledok">  8 y finalmente </h2><br><p><img src="https://habrastorage.org/webt/z8/tl/cv/z8tlcv6aibivr83m9q-fxzhusay.png" alt="foto tomada de https://fvl1-01.livejournal.com/"></p><br><p>  Al final, decid√≠ dejar lo m√°s importante. </p><br><p>  Recuerda: </p><br><ul><li>  No eres google </li><li>  No eres microsoft </li><li>  No eres facebook </li><li>  No eres Yandex </li><li>  No eres netflix </li><li>  No eres OneTwoTrip </li></ul><br><p>  Si algo funciona en otras compa√±√≠as, no es un hecho que lo beneficie.  Si intenta copiar ciegamente la experiencia de otras compa√±√≠as con las palabras "funciona para ellos", entonces esto probablemente terminar√° mal.  Cada empresa, cada producto y cada equipo es √∫nico.  Lo que funciona para algunos no funcionar√° para otros.  No me gusta decir cosas obvias, pero muchas personas comienzan a construir un culto de carga alrededor de otras compa√±√≠as, copiando ciegamente enfoques y enterr√°ndose bajo falsas decoraciones de √°rboles de Navidad.  No lo hagas.  Experimente, intente, desarrolle aquellas soluciones que sean √≥ptimas para usted.  Y solo entonces todo saldr√° bien. </p><br><h2 id="poleznye-ssylki">  Enlaces utiles: </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mi informe</a> en formato de video </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Lista de reproducci√≥n completa</a> de mitap por Node.JS </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459206/">https://habr.com/ru/post/459206/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459188/index.html">Debian 10 Buster y Linux 5.2 lanzados</a></li>
<li><a href="../459194/index.html">C√≥mo nos hicimos amigos de SCSS con las variables CSS utilizando el tema del kit de interfaz de usuario</a></li>
<li><a href="../459196/index.html">De monolitos a equipos modulares.</a></li>
<li><a href="../459198/index.html">An√°lisis de rendimiento de consultas en ClickHouse. Informe Yandex</a></li>
<li><a href="../459204/index.html">10 ++ formas de trabajar con registros de hardware en C ++ (por ejemplo, IAR y Cortex M)</a></li>
<li><a href="../459208/index.html">Correr con pr√≥tesis: simulaci√≥n de Nekstgen del movimiento humano usando m√∫sculos, huesos y una red neuronal</a></li>
<li><a href="../459212/index.html">Implementaci√≥n de propiedad en C ++</a></li>
<li><a href="../459214/index.html">Tolerancia a fallos en el almacenamiento de Qsan</a></li>
<li><a href="../459216/index.html">Estructura de datos del √°rbol B</a></li>
<li><a href="../459220/index.html">Pruebas de integraci√≥n para verificar p√©rdidas de memoria</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>