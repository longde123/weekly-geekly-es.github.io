<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üóΩ üë§ üìü Nous avons mis en place un projet npm pratique pour nous-m√™mes et pour l'√©quipe ou un peu sur les outils frontaux modernes üóΩ ‚Ü©Ô∏è ‚úãüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous. R√©cemment, je suis tomb√© sur la t√¢che de configurer des packages npm priv√©s. Tout semblait tr√®s int√©ressant et prometteur jusqu'√† ce q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous avons mis en place un projet npm pratique pour nous-m√™mes et pour l'√©quipe ou un peu sur les outils frontaux modernes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417429/"><p><img src="https://habrastorage.org/webt/de/cu/3u/decu3uxv998uiwmqbioi99ojnfi.png"></p><br><p>  Bonjour √† tous.  R√©cemment, je suis tomb√© sur la t√¢che de configurer des packages npm priv√©s.  Tout semblait tr√®s int√©ressant et prometteur jusqu'√† ce qu'il s'av√®re qu'il n'y avait pas grand-chose √† faire l√†-bas.  Tout se serait termin√© ici, mais la deuxi√®me t√¢che a surgi - √©crire un r√©f√©rentiel de d√©monstration pour le paquet npm, qui pourrait √™tre pris, clon√© et bas√© sur lui pour cr√©er rapidement quelque chose d'utile et dans le m√™me style. </p><br><p> Le r√©sultat a √©t√© un projet avec un formatage personnalis√©, un style de code, des tests pour chaque pool, des limites de couverture de code, un rapport de couverture de code et une documentation automatique.  De plus, une publication pratique dans npm.  D√©tails sur le r√©glage - sous la coupe. </p><a name="habracut"></a><br><h2 id="trebovaniya">  Pr√©requis </h2><br><p>  Tout d'abord, j'ai compris ce que nous avons d√©j√†: </p><br><ul><li>  Les nouveaux projets sont √©crits en TypeScript </li><li>  En plus de nouveaux projets, il y a un tas de projets en pur JavaScript </li><li>  Il y a des exigences pour √©crire des tests et les r√©sultats doivent √™tre envoy√©s pour analyse </li></ul><br><p>  Puis il a estim√© sa liste de souhaits - car il y a du temps et du d√©sir, pourquoi ne pas y aller doucement.  Ce que je veux de plus: </p><br><ul><li>  Je veux un style de formatage uniforme </li><li>  Je veux un style TypeScript unifi√© </li><li>  Je veux de la documentation, mais je ne veux pas l'√©crire </li><li>  En g√©n√©ral, je veux tout automatiser au maximum.  Que serait fyr-fyr-fyr et en production </li></ul><br><p>  En cons√©quence, les exigences ont pris forme comme suit: </p><br><ul><li>  Le module doit √™tre TypeScript et test√© √† l'aide de TsLint </li><li>  Le module doit √™tre utilis√© sous TypeScript et sous JavaScript </li><li>  Les tests doivent √™tre configur√©s sur git hook, la couverture minimale du code doit √©galement √™tre configur√©e, les statistiques doivent √™tre </li><li>  Le formatage doit √™tre configur√© </li><li>  La documentation doit √™tre cr√©√©e √† partir du code. </li><li>  La publication doit √™tre pratique et coh√©rente. </li><li>  Tout ce qui peut √™tre automatis√© </li></ul><br><p>  √áa a l'air sympa, il faut essayer. </p><br><h2 id="predvaritelnye-telodvizheniya">  Gestes pr√©liminaires </h2><br><p>  Nous cr√©ons (clonons) le r√©f√©rentiel, initialisons package.json, d√©finissons TypeScript localement.  En g√©n√©ral, nous d√©finissons toutes les d√©pendances localement, car  tout ira au serveur.  N'oubliez pas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">corriger les d√©pendances de version</a> . </p><br><pre><code class="hljs swift">git <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> npm <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> npm i -<span class="hljs-type"><span class="hljs-type">D</span></span> typescript ./node_modules/.bin/tsc --<span class="hljs-keyword"><span class="hljs-keyword">init</span></span></code> </pre> <br><p>  Imm√©diatement sur place, vous devez modifier tsconfig.json pour vous-m√™me - d√©finir la cible, les biblioth√®ques, inclure / exclure, outDir et d'autres options. </p><br><h2 id="stil-formatirovaniya">  Style de formatage </h2><br><p>  Pour maintenir une mise en forme uniforme, j'ai pris deux outils.  Le premier est le fichier .editorconfig.  Il est compris par tous les principaux IDE (WebStorm, VSCode, Visual Studio, etc.), ne n√©cessite aucune installation superflue et fonctionne avec un grand nombre de types de fichiers - js, ts, md, etc. </p><br><pre> <code class="hljs vbscript">#root = <span class="hljs-literal"><span class="hljs-literal">true</span></span> [*] indent_style = <span class="hljs-built_in"><span class="hljs-built_in">space</span></span> end_of_line = lf charset = utf<span class="hljs-number"><span class="hljs-number">-8</span></span> trim_trailing_whitespace = <span class="hljs-literal"><span class="hljs-literal">true</span></span> insert_final_newline = <span class="hljs-literal"><span class="hljs-literal">true</span></span> max_line_length = <span class="hljs-number"><span class="hljs-number">100</span></span> indent_size = <span class="hljs-number"><span class="hljs-number">4</span></span> [*.md] trim_trailing_whitespace = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><p>  Maintenant, la mise en forme automatique se comportera plus ou moins de la m√™me mani√®re avec mes coll√®gues. </p><br><p>  Le deuxi√®me outil est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus joli</a> .  Il s'agit d'un package npm qui v√©rifie et, si possible, corrige automatiquement la mise en forme de votre texte.  Installez-le localement et ajoutez la premi√®re commande √† package.json </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D prettier</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs css">"<span class="hljs-selector-tag"><span class="hljs-selector-tag">prettier</span></span>": "<span class="hljs-selector-tag"><span class="hljs-selector-tag">prettier</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--config</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.prettierrc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--write</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">src</span></span><span class="hljs-comment"><span class="hljs-comment">/**/</span></span>*<span class="hljs-selector-class"><span class="hljs-selector-class">.ts</span></span>"</code> </pre> <br><p>  Prettier n'a pas de commande init, vous devez donc la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">configurer</a> manuellement.  Cr√©ez .prettierrc.json √† la racine du projet avec quelque chose comme ce contenu controvers√© (si quoi que ce soit, le post n'est pas du tout sur les meilleures citations, mais vous pouvez essayer) </p><br><p>  .prettierrc.json </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"tabWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"useTabs"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"singleQuote"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"trailingComma"</span></span>: <span class="hljs-string"><span class="hljs-string">"es5"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arrowParens"</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span> }</code> </pre> <br><p>  Maintenant, cr√©ez le dossier src, cr√©ez index.ts avec du contenu conditionnel et essayez d'ex√©cuter plus joli.  S'il n'aime pas votre mise en forme, il le corrigera automatiquement.  Tr√®s confortable.  Si vous ne souhaitez pas vous en souvenir uniquement lors d'un commit / push, vous pouvez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">configurer pour ex√©cuter automatiquement</a> ou installer une extension pour le studio. </p><br><h2 id="stil-koda">  Style de code </h2><br><p>  Avec le style de code, tout n'est pas compliqu√© non plus.  Pour JavaScript, il y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">eslint</a> ; pour TypeScript, il y a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tslint</a> .  Nous mettons tslint et cr√©ons tsconfig.js pour stocker les param√®tres </p><br><pre> <code class="hljs coffeescript"><span class="hljs-built_in"><span class="hljs-built_in">npm</span></span> i -D tslint .<span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>.bin/tslint --init</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"lint"</span></span>: <span class="hljs-string"><span class="hljs-string">"tslint -c tslint.json 'src/**/*.ts' 'tests/**/*.spec.ts'"</span></span></code> </pre> <br><p>  Vous pouvez √©crire vos propres r√®gles ou utiliser des r√®gles existantes √† l'aide du param√®tre extend.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voici</a> , par exemple, une configuration d'Airbnb. </p><br><div class="spoiler">  <b class="spoiler_title">Les d√©veloppeurs de Tslint plaisantent</b> <div class="spoiler_text"><pre> <code class="hljs powershell">module.exports = { extends: <span class="hljs-string"><span class="hljs-string">"./tslint-base.json"</span></span>, rules: { <span class="hljs-string"><span class="hljs-string">"no-excessive-commenting"</span></span>: [<span class="hljs-type"><span class="hljs-type">true</span></span>, {<span class="hljs-type"><span class="hljs-type">maxComments</span></span>: <span class="hljs-type"><span class="hljs-type">Math.random</span></span>() * <span class="hljs-number"><span class="hljs-number">10</span></span>}] } };</code> </pre> <br><p>  Eh bien, n'est-ce pas joli? </p></div></div><br><p>  Il y a un point important - tslint et plus joli se croisent dans la fonctionnalit√© (par exemple, dans la longueur d'une cha√Æne ou des virgules ¬´suspendues¬ª).  Donc, si vous utilisez les deux, vous devrez surveiller la conformit√© ou abandonner quelque chose. </p><br><p>  Et pourtant, pour ceux qui veulent v√©rifier pas tous les fichiers, mais seulement les √©tapes - il y a un paquet √©tag√© </p><br><h2 id="testy">  Les tests </h2><br><p>  De quoi avons-nous besoin avant tout des tests?  Premi√®rement, pour qu'ils d√©marrent automatiquement, deuxi√®mement, le contr√¥le de la couverture, troisi√®mement certains rapports, de pr√©f√©rence au format lcov (le cas √©ch√©ant, lcov est bien compris par diff√©rents analyseurs - de SonarQube √† CodeCov).  Nous traiterons de l'automatisation un peu plus tard, lors de la configuration des tests eux-m√™mes. </p><br><p>  Nous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mettons du karma</a> , du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jasmin</a> et tout le kit corporel correspondant </p><br><pre> <code class="hljs powershell">npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> karma karma<span class="hljs-literal"><span class="hljs-literal">-jasmine</span></span> jasmine karma<span class="hljs-literal"><span class="hljs-literal">-typescript</span></span> karma<span class="hljs-literal"><span class="hljs-literal">-chrome</span></span><span class="hljs-literal"><span class="hljs-literal">-launcher</span></span> @types/jasmine ./node_modules/.bin/karma init</code> </pre> <br><p>  Nous modifions un peu karma.conf.js et configurons imm√©diatement le travail avec la couverture </p><br><div class="spoiler">  <b class="spoiler_title">karma.conf.js</b> <div class="spoiler_text"><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">karmaTypescriptConfig</span></span> : { <span class="hljs-attribute"><span class="hljs-attribute">include</span></span>: [<span class="hljs-string"><span class="hljs-string">"./src/**/*.ts"</span></span>, <span class="hljs-string"><span class="hljs-string">"./tests/**/*.spec.ts"</span></span>], tsconfig: <span class="hljs-string"><span class="hljs-string">"./tsconfig.json"</span></span>, reports: { <span class="hljs-string"><span class="hljs-string">"html"</span></span>: <span class="hljs-string"><span class="hljs-string">"coverage"</span></span>, <span class="hljs-string"><span class="hljs-string">"lcovonly"</span></span>: { directory: <span class="hljs-string"><span class="hljs-string">'./coverage'</span></span>, filename: <span class="hljs-string"><span class="hljs-string">'../lcov.dat'</span></span> } }, <span class="hljs-selector-tag"><span class="hljs-selector-tag">coverageOptions</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">threshold</span></span>: { global: { statements: <span class="hljs-number"><span class="hljs-number">60</span></span>, branches: <span class="hljs-number"><span class="hljs-number">60</span></span>, functions: <span class="hljs-number"><span class="hljs-number">60</span></span>, lines: <span class="hljs-number"><span class="hljs-number">60</span></span>, excludes: [] }, <span class="hljs-selector-tag"><span class="hljs-selector-tag">file</span></span>: { <span class="hljs-attribute"><span class="hljs-attribute">statements</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, branches: <span class="hljs-number"><span class="hljs-number">60</span></span>, functions: <span class="hljs-number"><span class="hljs-number">60</span></span>, lines: <span class="hljs-number"><span class="hljs-number">60</span></span>, excludes: [], overrides: {} } } }, }</code> </pre> </div></div><br><p>  Et, bien s√ªr, n'oubliez pas d'ajouter une nouvelle commande √† package.json </p><br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"karma start"</span></span></code> </pre> <br><p>  Si vous utilisez ou pr√©voyez d'utiliser CI, il est pr√©f√©rable de mettre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HeadlessChrome</a> : </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D puppeteer</code> </pre> <br><p>  Et pr√©configurez Karma (correction de Chrome sur ChromeHeadless) et autre chose.  Les modifications peuvent √™tre consult√©es dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel de d√©monstration</a> . </p><br><p>  Ex√©cutez les tests, v√©rifiez que tout fonctionne.  Dans le m√™me temps, v√©rifiez le rapport de couverture (il se trouve dans le dossier de couverture) et supprimez-le du contr√¥le de version, il n'est pas n√©cessaire dans le r√©f√©rentiel. </p><br><p>  Rapport: </p><br><p><img src="https://habrastorage.org/webt/9h/0l/pi/9h0lpiplvfhu8pxbrawnnwysdw4.png"></p><br><h2 id="stil-kommitov">  Style de validation </h2><br><p>  Les commits peuvent √©galement √™tre unifi√©s (et en m√™me temps amener quelqu'un √† chauffer √† blanc, si vous en faites trop, c'est mieux sans fanatisme).  Pour cela, je me suis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">engag√©</a> .  Il fonctionne sous la forme d'un dialogue, prend en charge le format de journal des modifications conventionnel (vous pouvez cr√©er un journal des modifications √† partir de ses validations) et il existe un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugin</a> VsCode pour cela. </p><br><pre> <code class="hljs powershell">npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> commitizen npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> cz<span class="hljs-literal"><span class="hljs-literal">-conventional</span></span><span class="hljs-literal"><span class="hljs-literal">-changelog</span></span></code> </pre> <br><p>  cz-conventionnel-changelog est un adaptateur qui est responsable des questions, et par cons√©quent, du format de vos commits </p><br><p>  Ajouter une nouvelle commande √† la section des scripts </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"commit"</span></span>:<span class="hljs-string"><span class="hljs-string">"git-cz"</span></span></code> </pre> <br><p>  Et une nouvelle section package.json - config pour commitizen </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"config"</span></span>: { <span class="hljs-string"><span class="hljs-string">"commitizen"</span></span>: { <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"./node_modules/cz-conventional-changelog"</span></span> } }</code> </pre> <br><p>  La bo√Æte de dialogue avec commitizen ressemble √† ceci: </p><br><p><img src="https://habrastorage.org/webt/tn/xk/_l/tnxk_ll7a-chazpw8p0a2fnl3wk.png"></p><br><h2 id="dokumentaciya">  La documentation </h2><br><p>  Passons maintenant √† la documentation.  Nous aurons deux types de documentation - √† partir du code et des commits.  Pour la documentation du code, j'ai pris <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">typedoc</a> (analogue √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">esdoc</a> mais pour TypeScript).  C'est tr√®s simple √† installer et √† travailler.  L'essentiel est de ne pas oublier de supprimer les r√©sultats de son travail du contr√¥le de version. </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> typedoc -D</code> </pre> <br><p>  et mettre √† jour package.json </p><br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"doc"</span></span>: <span class="hljs-string"><span class="hljs-string">"typedoc --out docs/src/ --readme ./README.md"</span></span></code> </pre> <br><p>  L'indicateur --readme forcera le readme √† √™tre inclus dans la page de documentation principale, ce qui est pratique. </p><br><p>  Le deuxi√®me type de documentation est le journal des modifications, et le package <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conventionnel-changelog-cli</a> nous aidera avec cela. </p><br><pre> <code class="hljs powershell">npm i <span class="hljs-literal"><span class="hljs-literal">-D</span></span> conventional<span class="hljs-literal"><span class="hljs-literal">-changelog</span></span><span class="hljs-literal"><span class="hljs-literal">-cli</span></span></code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"changelog"</span></span>: <span class="hljs-string"><span class="hljs-string">"conventional-changelog -p angular -i CHANGELOG.md -s"</span></span></code> </pre> <br><p>  De angulaire, il n'y a que le formatage et rien de plus.  Maintenant, pour mettre √† jour le journal des modifications, lancez simplement npm run changelog.  L'essentiel est d'√©crire soigneusement les commits.  Eh bien, nous √©crivons toujours des commits parfaits, donc cela ne devrait pas √™tre un probl√®me. </p><br><h2 id="bild">  Construire </h2><br><p>  √âtant donn√© que notre package devrait √©galement fonctionner pour JavaScript, nous devons transformer TypeScript en JavaScript.  De plus, ce serait bien de faire un bundle minifi√©, juste au cas o√π.  Pour cela, nous avons besoin de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">uglifyjs</a> et d'un petit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">package tweak.json</a> </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D uglifyjs</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"clean"</span></span>:<span class="hljs-string"><span class="hljs-string">"rmdir dist /S /Q"</span></span>, <span class="hljs-string"><span class="hljs-string">"build"</span></span>: <span class="hljs-string"><span class="hljs-string">"tsc --p ./ --sourceMap false"</span></span>, <span class="hljs-string"><span class="hljs-string">"bundle"</span></span>: <span class="hljs-string"><span class="hljs-string">"uglifyjs ./dist/*.js --compress --mangle --output ./dist/index.min.js"</span></span></code> </pre> <br><p>  Soit dit en passant, si vous souhaitez contr√¥ler la taille de votre projet, il existe deux autres packages int√©ressants </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bundlesize</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sizelimit</a> - m√™me chose mais sur webpack </li></ul><br><p>  Ils peuvent √©galement √™tre int√©gr√©s dans le processus de validation / push / publication pour conserver la taille de bundle acceptable.  Tr√®s, tr√®s utile. </p><br><h2 id="avtomatizaciya">  Automatisation </h2><br><p>  Eh bien, nous avons d√©j√† pris les mesures de base, maintenant tout doit √™tre automatis√©, sinon ce sera franchement g√™nant de fonctionner. </p><br><p>  Pour cela, nous avons besoin d'un autre paquet - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">husky</a> .  Il r√©√©crit les hooks git et appelle les commandes associ√©es √† partir de package.json.  Par exemple, lorsque vous vous engagez, precommit fonctionnera, push - prepush, etc.  Si le script renvoie une erreur, la validation √©chouera. </p><br><pre> <code class="hljs matlab">npm <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> -D husky</code> </pre> <br><p>  package.json </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"precommit"</span></span>:<span class="hljs-string"><span class="hljs-string">"npm run prettier"</span></span>, <span class="hljs-string"><span class="hljs-string">"prepush"</span></span>: <span class="hljs-string"><span class="hljs-string">"call npm run lint &amp;&amp; call npm run test"</span></span></code> </pre> <br><p>  Il y a une nuance importante ici, l'utilisation de la syntaxe d'appel n'est pas multiplateforme et ne d√©collera pas sur les syst√®mes Unix.  Donc, si vous voulez tout faire honn√™tement, vous devez √©galement installer le package <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npm-run-all</a> , il fait de m√™me mais sur plusieurs plates-formes. </p><br><h2 id="publikaciya">  Publication </h2><br><p>  Eh bien, nous arrivons √† la publication de notre package (bien que vide).  Pensons ce que nous voulons de la publication? </p><br><ul><li>  Testez tout √† nouveau </li><li>  R√©cup√©rer des artefacts de construction </li><li>  Recueillir la documentation </li><li>  Augmenter la version </li><li>  Balises de d√©clenchement </li><li>  Soumettre √† npm </li></ul><br><p>  Les mains font tout - triste.  Ou vous oubliez quelque chose, ou vous devez r√©diger une liste de contr√¥le.  Il est √©galement n√©cessaire d'automatiser.  Vous pouvez mettre un autre paquet - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lib√©rer</a> .  Et vous pouvez utiliser les hooks natifs de npm lui-m√™me - pr√©version, version, postversion, par exemple comme ceci: </p><br><pre> <code class="hljs sql">"preversion": "npm run test", "version": "<span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run clean &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run <span class="hljs-keyword"><span class="hljs-keyword">build</span></span> &amp;&amp; npm run bundle &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run doc &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> npm run changelog &amp;&amp; git <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> . &amp;&amp; git <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> -m <span class="hljs-string"><span class="hljs-string">'changelogupdate'</span></span> <span class="hljs-comment"><span class="hljs-comment">--no-verify", "postversion": "git add . &amp;&amp; git push &amp;&amp; git push --tags",</span></span></code> </pre> <br><p>  Il reste √† sp√©cifier pour package.json ce qu'il faut inclure dans le package, le point d'entr√©e et le chemin vers nos types (n'oubliez pas de sp√©cifier l'indicateur --declaration dans tsconfig.json pour obtenir les fichiers d.ts) </p><br><p>  package.json </p><br><pre> <code class="hljs powershell"><span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"./dist/index.min.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"types"</span></span>: <span class="hljs-string"><span class="hljs-string">"./dist/index.d.ts"</span></span>, <span class="hljs-string"><span class="hljs-string">"files"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"dist/"</span></span>, <span class="hljs-string"><span class="hljs-string">"src/"</span></span>, <span class="hljs-string"><span class="hljs-string">"tests/"</span></span> ]</code> </pre> <br><p>  Eh bien, cela semble √™tre tout.  Maintenant fais juste </p><br><pre> <code class="hljs coffeescript"><span class="hljs-built_in"><span class="hljs-built_in">npm</span></span> version ... <span class="hljs-built_in"><span class="hljs-built_in">npm</span></span> publish</code> </pre> <br><p>  Et tout le reste se fera automatiquement. </p><br><h2 id="bonus">  Bonus </h2><br><p>  En prime, il existe un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel de d√©monstration</a> qui prend en charge tout cela + CI en utilisant travis-ci.  Permettez-moi de vous rappeler que HeadlessChrome est configur√© l√†-bas, donc si cela est important pour vous, je vous conseille d'y regarder. </p><br><h2 id="blagodarnosti">  Remerciements </h2><br><p>  Un grand merci √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Alexei Volkov</a> pour son rapport sur JsFest, qui est devenu la base de cet article. </p><br><p>  Merci √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">max7z</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">indestructible</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">justboris</a> pour avoir clarifi√© que les chemins vers les d√©pendances locales peuvent √™tre omis. </p><br><h2 id="i-nemnogo-statistiki">  Et quelques statistiques </h2><br><ul><li>  Taille des Node_modules: 444 Mo (NTFS) </li><li>  Nombre de d√©pendances du premier niveau: 17 </li><li>  Total des paquets utilis√©s: 643 </li></ul><br><h2 id="poleznye-ssylki">  Liens utiles </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">.editorconfig</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus joli</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tslint</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">eslint</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">typedoc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">esdoc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commis</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugin commitizen pour vscode</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">journal des modifications conventionnel</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">uglifyjs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bundlesize</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">taille limite</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">husky</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npm-run-all</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©cha√Æner</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel de d√©monstration</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417429/">https://habr.com/ru/post/fr417429/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417415/index.html">Cours d'impression 3D. Impression de pi√®ces avec diff√©rentes √©paisseurs de couche √† partir de 3Dtool</a></li>
<li><a href="../fr417419/index.html">[Iekaterinbourg, annonce] Alice en visite √† Kontur - hackathon pour cr√©er des comp√©tences pour les assistants vocaux</a></li>
<li><a href="../fr417421/index.html">Devenir daltonien: une exp√©rience d'empathie</a></li>
<li><a href="../fr417423/index.html">33 conseils pour le marketing ICO</a></li>
<li><a href="../fr417427/index.html">Vid√©o de UralJS # 8 mitap - travailler avec des donn√©es brutes dans un navigateur et √©crire des comp√©tences pour Alice</a></li>
<li><a href="../fr417431/index.html">Anti-entretien</a></li>
<li><a href="../fr417435/index.html">Une faute de frappe a √©t√© trouv√©e dans la configuration Aliens: Colonial Marines, √† cause de laquelle le jeu AI √©tait bugg√© pendant quatre ans</a></li>
<li><a href="../fr417437/index.html">Projecteur vs √©cran plat. Nous essayons une robe d'ophtalmologiste et d√©couvrons pourquoi la taille est importante</a></li>
<li><a href="../fr417439/index.html">Intel Core i7-8086K (partie 1)</a></li>
<li><a href="../fr417441/index.html">Comment nous avons √©limin√© les joueurs ordinaires et pour les DDoS ou nos serveurs: un guide pratique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>