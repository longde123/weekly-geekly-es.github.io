<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¼â€ğŸš’ â˜¹ï¸ ğŸ‘©ğŸ¼â€ğŸ¨ ç§»åŠ¨PvPå°„å‡»æ¸¸æˆçš„ç‰©ç†åŸç†ï¼Œæˆ–æˆ‘ä»¬å¦‚ä½•å°†äºŒç»´æ¸¸æˆé‡æ–°åˆ¶ä½œä¸ºä¸‰ç»´æ¸¸æˆ ğŸ¤´ğŸ¼ ğŸˆ³ ğŸ•´ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘çš„åŒäº‹è°ˆåˆ°äº†æˆ‘ä»¬å¦‚ä½•åœ¨ç§»åŠ¨å¤šäººå°„å‡»æ¸¸æˆä¸­ä½¿ç”¨äºŒç»´ç‰©ç†å¼•æ“ã€‚ ç°åœ¨ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘ä»¬å¦‚ä½•æŠ›å¼ƒä»¥å‰æ‰€åšçš„ä¸€åˆ‡å¹¶ä»å¤´å¼€å§‹-æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¦‚ä½•å°†æ¸¸æˆä»2Dä¸–ç•Œè½¬ç§»åˆ°3Dã€‚ 

 ä¸€åˆ‡å§‹äºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³åˆ¶ä½œäººå’Œé¢†å…ˆçš„æ¸¸æˆè®¾è®¡å¸ˆä¸€æ—¦æ¥åˆ°æˆ‘ä»¬çš„ç¨‹åºå‘˜éƒ¨é—¨ï¼Œå¹¶ç»™æˆ‘ä»¬å¸¦æ¥äº†æŒ‘æˆ˜ï¼šå¿…é¡»åœ¨ç‹­çª„ç©ºé—´å†…è¿›...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç§»åŠ¨PvPå°„å‡»æ¸¸æˆçš„ç‰©ç†åŸç†ï¼Œæˆ–æˆ‘ä»¬å¦‚ä½•å°†äºŒç»´æ¸¸æˆé‡æ–°åˆ¶ä½œä¸ºä¸‰ç»´æ¸¸æˆ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/485150/"><img src="https://habrastorage.org/webt/fo/if/az/foifazxdmxh_smqsswnkxhn0ww4.png"><br><br> åœ¨<a href="https://habr.com/ru/company/pixonic/blog/481880/">ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ</a>æˆ‘çš„åŒäº‹è°ˆåˆ°äº†æˆ‘ä»¬å¦‚ä½•åœ¨ç§»åŠ¨å¤šäººå°„å‡»æ¸¸æˆä¸­ä½¿ç”¨äºŒç»´ç‰©ç†å¼•æ“ã€‚ ç°åœ¨ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘ä»¬å¦‚ä½•æŠ›å¼ƒä»¥å‰æ‰€åšçš„ä¸€åˆ‡å¹¶ä»å¤´å¼€å§‹-æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¦‚ä½•å°†æ¸¸æˆä»2Dä¸–ç•Œè½¬ç§»åˆ°3Dã€‚ <br><a name="habracut"></a><br> ä¸€åˆ‡å§‹äºè¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³åˆ¶ä½œäººå’Œé¢†å…ˆçš„æ¸¸æˆè®¾è®¡å¸ˆä¸€æ—¦æ¥åˆ°æˆ‘ä»¬çš„ç¨‹åºå‘˜éƒ¨é—¨ï¼Œå¹¶ç»™æˆ‘ä»¬å¸¦æ¥äº†æŒ‘æˆ˜ï¼šå¿…é¡»åœ¨ç‹­çª„ç©ºé—´å†…è¿›è¡Œå°„å‡»çš„ç§»åŠ¨å¼PvPè‡ªä¸Šè€Œä¸‹å°„å‡»æ¸¸æˆå¿…é¡»è½¬æ¢ä¸ºåœ¨å¼€æ”¾åŒºåŸŸå°„å‡»çš„ç¬¬ä¸‰äººç§°å°„å‡»æ¸¸æˆã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¸Œæœ›å¡çœ‹èµ·æ¥ä¸æ˜¯è¿™æ ·ï¼š <br><br><img src="https://habrastorage.org/webt/he/j3/2p/hej32pvogui5sukjz842wjpyqry.png"><br><br> ä¾æ­¤ç±»æ¨ï¼š <br><br><img src="https://habrastorage.org/webt/n8/25/xw/n825xwkx_jsgqgoemkcor-r4ti0.jpeg"><br><br> æŠ€æœ¯è¦æ±‚å¦‚ä¸‹ï¼š <br><br><ul><li> åœ°å›¾å°ºå¯¸-100Ã—100ç±³ï¼› </li><li> é«˜å·®-40ç±³ï¼› </li><li> æ”¯æŒéš§é“ï¼Œæ¡¥æ¢ï¼› </li><li> å‘ä¸åŒé«˜åº¦çš„ç›®æ ‡å°„å‡»ï¼› </li><li> ä¸é™æ€å‡ ä½•ä½“å‘ç”Ÿç¢°æ’ï¼ˆæˆ‘ä»¬ä¸æ¸¸æˆä¸­çš„å…¶ä»–è§’è‰²æ²¡æœ‰ç¢°æ’ï¼‰ï¼› </li><li> è‡ªç”±è½ä½“ç‰©ç†å­¦ï¼› </li><li> æ‰‹æ¦´å¼¹æŠ•æ·ç‰©ç†ã€‚ </li></ul><br> å±•æœ›æœªæ¥ï¼Œæˆ‘å¯ä»¥è¯´æˆ‘ä»¬çš„æ¸¸æˆçœ‹èµ·æ¥ä¸åƒä¸Šä¸€ä¸ªå±å¹•æˆªå›¾ï¼šäº‹å®è¯æ˜ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªé€‰é¡¹å’Œç¬¬äºŒä¸ªé€‰é¡¹ä¹‹é—´çš„äº¤å‰ã€‚ <br><br><h2> é€‰é¡¹ä¸€ï¼šåˆ†å±‚ç»“æ„ </h2><br> æå‡ºç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯ä¸æ›´æ”¹ç‰©ç†å¼•æ“ï¼Œè€Œåªæ˜¯æ·»åŠ å‡ å±‚â€œå±‚æ•°â€çº§åˆ«ã€‚ åŸæ¥è¿™æ˜¯å»ºç­‘ç‰©çš„å¹³é¢å›¾ï¼š <br><br><img src="https://habrastorage.org/webt/lz/dy/oq/lzdyoquthw76ajisyvgqcn7zc_i.jpeg"><br><br> ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä»æ ¹æœ¬ä¸Šé‡åšå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”é€šå¸¸çœ‹æ¥ï¼Œä»¥è¿™ç§æ–¹å¼å¯ä»¥å¾ˆç®€å•åœ°è§£å†³ä»»åŠ¡ã€‚ ä½†æ˜¯ï¼Œåœ¨å°è¯•å®ç°å®ƒæ—¶ï¼Œæˆ‘ä»¬é‡åˆ°äº†å‡ ä¸ªå…³é”®é—®é¢˜ï¼š <br><br><ol><li> åœ¨ä¸å…³å¡è®¾è®¡å¸ˆæ¾„æ¸…äº†ç»†èŠ‚ä¹‹åï¼Œæˆ‘ä»¬å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼Œè¿™ç§æ–¹æ¡ˆä¸­çš„â€œæ¥¼å±‚â€æ•°é‡å¯ä»¥ä»¤äººå°è±¡æ·±åˆ»ï¼šæœ‰äº›åœ°å›¾ä½äºå¹³ç¼“å¡åº¦å’Œä¸˜é™µçš„å¼€æ”¾åŒºåŸŸã€‚ </li><li> ä»ä¸€å±‚å°„å‡»åˆ°å¦ä¸€å±‚æ—¶ï¼Œå‘½ä¸­ç‡çš„è®¡ç®—æˆä¸ºä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ é—®é¢˜æƒ…å†µçš„ç¤ºä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šåœ¨è¿™é‡Œï¼Œç©å®¶1å¯ä»¥è¿›å…¥ç©å®¶3ï¼Œä½†ä¸èƒ½è¿›å…¥ç©å®¶2ï¼Œå› ä¸ºå°„å‡»è·¯å¾„ä¼šé˜»å¡ç¬¬2å±‚ï¼Œå°½ç®¡ç©å®¶2å’Œç©å®¶3éƒ½åœ¨åŒä¸€å±‚ã€‚ </li></ol><br><img src="https://habrastorage.org/webt/be/rg/be/bergbenv9gtcjzpkci26w_jmsik.png"><br><br> ç®€è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬å¾ˆå¿«æ”¾å¼ƒäº†å°†ç©ºé—´åˆ’åˆ†ä¸º2Då±‚çš„æƒ³æ³•-å†³å®šæˆ‘ä»¬å°†å®Œå…¨æ›¿æ¢ç‰©ç†å¼•æ“æ¥é‡‡å–è¡ŒåŠ¨ã€‚ <br><br> è¿™å¯¼è‡´æˆ‘ä»¬éœ€è¦é€‰æ‹©è¿™ç§å¼•æ“å¹¶å°†å…¶æ„å»ºåˆ°ç°æœ‰çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åº”ç”¨ç¨‹åºä¸­ã€‚ <br><br><h2> é€‰é¡¹äºŒï¼šé€‰æ‹©ä¸€ä¸ªå°±ç»ªåº“ </h2><br> ç”±äºæ¸¸æˆå®¢æˆ·ç«¯æ˜¯ç”¨Unityç¼–å†™çš„ï¼Œå› æ­¤æˆ‘ä»¬å†³å®šè€ƒè™‘ä½¿ç”¨é»˜è®¤å†…ç½®äºUnityä¸­çš„ç‰©ç†å¼•æ“PhysXçš„å¯èƒ½æ€§ã€‚ æ€»çš„æ¥è¯´ï¼Œä»–å®Œå…¨æ»¡è¶³äº†æˆ‘ä»¬æ¸¸æˆè®¾è®¡å¸ˆçš„è¦æ±‚ï¼Œä»¥æ”¯æŒæ¸¸æˆä¸­çš„3Dç‰©ç†ï¼Œä½†æ˜¯ä»ç„¶å­˜åœ¨ä¸€ä¸ªé‡å¤§é—®é¢˜ã€‚ äº‹å®æ˜¯æˆ‘ä»¬çš„æœåŠ¡å™¨åº”ç”¨ç¨‹åºæ˜¯ä½¿ç”¨Cï¼ƒç¼–å†™çš„ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨Unityã€‚ <br><br> å¯ä»¥é€‰æ‹©åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨C ++åº“ï¼ˆä¾‹å¦‚ï¼Œç›¸åŒçš„PhysXï¼‰ï¼Œä½†æˆ‘ä»¬å¹¶æœªè®¤çœŸè€ƒè™‘ï¼šç”±äºä½¿ç”¨æœ¬æœºä»£ç ï¼Œå› æ­¤è¿™ç§æ–¹æ³•å¾ˆå¯èƒ½å¯¼è‡´æœåŠ¡å™¨å´©æºƒã€‚ å¦å¤–ï¼ŒInteropæ“ä½œçš„ç”Ÿäº§ç‡ä½ä¸‹ä»¥åŠPhysXç»„ä»¶ï¼ˆä»…åœ¨Unityä¸‹ï¼‰çš„ç‹¬ç‰¹æ€§ï¼ˆåœ¨å…¶ä»–ç¯å¢ƒä¸­ä½¿ç”¨é™¤å¤–ï¼‰ä¹Ÿæ„Ÿåˆ°å°´å°¬ã€‚ <br><br> å¦å¤–ï¼Œåœ¨å°è¯•å®ç°æ­¤æƒ³æ³•æ—¶ï¼Œå‘ç°äº†å…¶ä»–é—®é¢˜ï¼š <br><br><ul><li> ç¼ºä¹åœ¨Linuxä¸Šä½¿ç”¨IL2CPPæ„å»ºUnityçš„æ”¯æŒï¼Œè¿™éå¸¸å…³é”®ï¼Œå› ä¸ºåœ¨æœ€æ–°ç‰ˆæœ¬ä¹‹ä¸€ä¸­ï¼Œæˆ‘ä»¬å°†æ¸¸æˆæœåŠ¡å™¨åˆ‡æ¢åˆ°äº†.Net Core 2.1å¹¶å°†å…¶éƒ¨ç½²åœ¨Linuxæœºå™¨ä¸Šï¼› </li><li> ç¼ºä¹åœ¨Unityä¸Šå¯¹æœåŠ¡å™¨è¿›è¡Œæ€§èƒ½åˆ†æçš„ä¾¿æ·å·¥å…·ï¼› </li><li>  Unityåº”ç”¨ç¨‹åºçš„æ€§èƒ½ä½ä¸‹ï¼šæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªç‰©ç†å¼•æ“ï¼Œè€Œä¸éœ€è¦Unityä¸­æ‰€æœ‰å¯ç”¨çš„åŠŸèƒ½ã€‚ </li></ul><br> æ­¤å¤–ï¼Œä¸æˆ‘ä»¬çš„é¡¹ç›®åŒæ—¶ï¼Œè¯¥å…¬å¸è¿˜åœ¨å¼€å‘å¦ä¸€æ¬¾å¤šäººPvPæ¸¸æˆåŸå‹ã€‚ å®ƒçš„å¼€å‘äººå‘˜ä½¿ç”¨UnityæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å¯¹å»ºè®®çš„æ–¹æ³•æœ‰å¾ˆå¤šè´Ÿé¢åé¦ˆã€‚ å°¤å…¶å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒUnityæœåŠ¡å™¨è¿è¡Œéå¸¸â€œæµâ€ï¼Œå¿…é¡»æ¯éš”å‡ ä¸ªå°æ—¶é‡æ–°å¯åŠ¨ä¸€æ¬¡ã€‚ <br><br> è¿™äº›é—®é¢˜çš„ç»“åˆä½¿æˆ‘ä»¬ä¹Ÿæ”¾å¼ƒäº†è¿™ä¸ªæƒ³æ³•ã€‚ ç„¶åï¼Œæˆ‘ä»¬å†³å®šå°†æ¸¸æˆæœåŠ¡å™¨ä¿ç•™åœ¨.Net Core 2.1ä¸Šï¼Œå¹¶é€‰æ‹©ä½¿ç”¨Cï¼ƒç¼–å†™çš„å¦ä¸€ä¸ªå¼€æ”¾å¼ç‰©ç†å¼•æ“ä»£æ›¿ä¹‹å‰ä½¿ç”¨çš„VolatilePhysicsã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªCï¼ƒå¼•æ“ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ä½¿ç”¨C ++ç¼–å†™çš„å¼•æ“æ—¶ä¼šæ‹…å¿ƒæ„å¤–å´©æºƒã€‚ <br><br> ç»“æœï¼Œé€‰æ‹©äº†ä»¥ä¸‹å¼•æ“è¿›è¡Œæµ‹è¯•ï¼š <br><br><ul><li>  <a href="https://github.com/bepu/bepuphysics1">Bepu Physic v1</a> ï¼› </li><li>  <a href="https://github.com/bepu/bepuphysics2">Bepu Physic v2ï¼›</a> </li><li>  <a href="https://github.com/mattleibow/jitterphysics">æŠ–åŠ¨ç‰©ç†ï¼›</a> </li><li>  <a href="https://github.com/ValtoLibraries/BulletSharp">å­å¼¹å¤´</a> </li></ul><br> å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œä¸»è¦æ ‡å‡†æ˜¯å¼•æ“çš„æ€§èƒ½ï¼Œå°†å…¶é›†æˆåˆ°Unityä¸­åŠå…¶æ”¯æŒçš„å¯èƒ½æ€§ï¼šå¦‚æœæˆ‘ä»¬å‘ç°å…¶ä¸­çš„ä»»ä½•é”™è¯¯ï¼Œéƒ½ä¸åº”æ”¾å¼ƒå®ƒã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬æµ‹è¯•äº†Bepu Physics v1ï¼ŒBepu Physics v2å’ŒJitter Physicså¼•æ“çš„æ€§èƒ½ï¼Œå…¶ä¸­Bepu Physics v2è¢«è¯æ˜æ˜¯æ•ˆç‡æœ€é«˜çš„ã€‚ æ­¤å¤–ï¼Œä»–æ˜¯è¿™ä¸‰ä½ä¸­å”¯ä¸€ç»§ç»­ç§¯æå‘å±•çš„äººã€‚ <br><br> ä½†æ˜¯ï¼ŒBepu Physics v2ä¸æ»¡è¶³Unityçš„æœ€åä¸€ä¸ªé›†æˆæ ‡å‡†ï¼šè¯¥åº“ä½¿ç”¨SIMDæ“ä½œå’ŒSystem.Numericsï¼Œå¹¶ä¸”ç”±äºä½¿ç”¨IL2CPPçš„ç§»åŠ¨è®¾å¤‡ä¸Šçš„ç¨‹åºé›†ä¸­ä¸å­˜åœ¨SIMDæ”¯æŒï¼Œå› æ­¤Bepuä¼˜åŒ–çš„æ‰€æœ‰å¥½å¤„éƒ½ä¸§å¤±äº†ã€‚  iPhone 5Sä¸Šçš„iOSç‰ˆæœ¬ä¸­çš„æ¼”ç¤ºåœºæ™¯éå¸¸æ…¢ã€‚ æˆ‘ä»¬æ— æ³•åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨æ­¤è§£å†³æ–¹æ¡ˆã€‚ <br><br> åœ¨è¿™é‡Œåº”è¯¥è§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬é€šå¸¸å¯¹ä½¿ç”¨ç‰©ç†å¼•æ“æ„Ÿå…´è¶£ã€‚ åœ¨æˆ‘ä»¥å‰çš„<a href="https://habr.com/ru/company/pixonic/blog/415959/">ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ</a>æˆ‘è°ˆåˆ°äº†æˆ‘ä»¬å¦‚ä½•å®ç°æ¸¸æˆçš„ç½‘ç»œéƒ¨åˆ†ä»¥åŠæœ¬åœ°é¢„æµ‹ç©å®¶è¡Œä¸ºçš„æ–¹å¼ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼ˆECSç³»ç»Ÿï¼‰ä¸Šæ‰§è¡Œç›¸åŒçš„ä»£ç ã€‚ å®¢æˆ·æ— éœ€ç­‰å¾…æœåŠ¡å™¨çš„å“åº”å³å¯ç«‹å³å“åº”ç©å®¶çš„è¡Œä¸º-å‘ç”Ÿäº†æ‰€è°“çš„é¢„æµ‹ã€‚ å½“æœåŠ¡å™¨å‘å‡ºå“åº”æ—¶ï¼Œå®¢æˆ·ç«¯å°†ä½¿ç”¨æ¥æ”¶åˆ°çš„å“åº”æ£€æŸ¥ä¸–ç•Œçš„é¢„æµ‹çŠ¶æ€ï¼Œå¦‚æœä¸åŒ¹é…ï¼ˆé”™è¯¯é¢„æµ‹ï¼‰ï¼Œåˆ™åŸºäºæœåŠ¡å™¨çš„å“åº”ï¼Œå¯¹ç©å®¶çœ‹åˆ°çš„å†…å®¹è¿›è¡Œåè°ƒã€‚ <br><br> ä¸»è¦æ€æƒ³æ˜¯æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šéƒ½æ‰§è¡Œç›¸åŒçš„ä»£ç ï¼Œå¹¶ä¸”é”™è¯¯é¢„æµ‹çš„æƒ…å†µéå¸¸å°‘è§ã€‚ ä½†æ˜¯ï¼Œåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå·¥ä½œæ—¶ï¼Œæˆ‘ä»¬å‘ç°æ²¡æœ‰ç‰©ç†Cï¼ƒå¼•æ“èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼šä¾‹å¦‚ï¼Œå®ƒæ— æ³•åœ¨iPhone 5Sä¸Šæä¾›ç¨³å®šçš„30 fpsã€‚ <br><br><h2> é€‰é¡¹ä¸‰ï¼Œæœ€ç»ˆï¼šä¸¤ä¸ªä¸åŒçš„å¼•æ“ </h2><br> ç„¶åï¼Œæˆ‘ä»¬å†³å®šè¿›è¡Œå®éªŒï¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„ç‰©ç†å¼•æ“ã€‚ æˆ‘ä»¬è®¤ä¸ºåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹è¿™å¯èƒ½è¡Œå¾—é€šï¼šæˆ‘ä»¬çš„æ¸¸æˆä¸­æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„ç¢°æ’ç‰©ç†ï¼Œæ­¤å¤–ï¼Œå®ƒæ˜¯ç”±æˆ‘ä»¬ä½œä¸ºå•ç‹¬çš„ECSç³»ç»Ÿå®æ–½çš„ï¼Œè€Œä¸æ˜¯ç‰©ç†å¼•æ“çš„ä¸€éƒ¨åˆ†ã€‚ ç‰©ç†å¼•æ“æ‰€éœ€çš„ä¸€åˆ‡å°±æ˜¯åœ¨3Dç©ºé—´ä¸­åˆ¶ä½œreykastå’Œæ‰«æ’­çš„èƒ½åŠ›ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å†³å®šåœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨å†…ç½®çš„ç‰©ç†Unity-PhysX-åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨Bepu Physics v2ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬é‡ç‚¹ä»‹ç»äº†ä½¿ç”¨ç‰©ç†å¼•æ“çš„ç•Œé¢ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">æŸ¥çœ‹ä»£ç </b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Numerics; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Prototype.Common.Physics</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPhysicsWorld</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasBody</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetCurrentSimulationTick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tick</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">RayCastHit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RayCast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Vector3 direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> distance, CollisionLayer layer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ticksBehind = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; ignoreIds = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">RayCastHit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SphereCast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Vector3 direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> distance, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, CollisionLayer layer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ticksBehind = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; ignoreIds = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">RayCastHit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CapsuleCast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Vector3 direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> distance, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, CollisionLayer layer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ticksBehind = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; ignoreIds = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CapsuleOverlap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, BodyMobilityField bodyMobilityField, CollisionLayer layer, List&lt;Overlap&gt; overlaps, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ticksBehind = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveOrphanedDynamicBodies</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WorldState.TableSet currentWorld</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateBody</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, Vector3 position, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> angle</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateStaticCapsule</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Quaternion rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, CollisionLayer layer</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateDynamicCapsule</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Quaternion rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, CollisionLayer layer</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateStaticBox</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Quaternion rotation, Vector3 size, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, CollisionLayer layer</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateDynamicBox</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Quaternion rotation, Vector3 size, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, CollisionLayer layer</span></span></span><span class="hljs-function">)</span></span>; } }</code> </pre> <br></div></div><br> å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯¹è¯¥æ¥å£æœ‰ä¸åŒçš„å®ç°ï¼šå¦‚å‰æ‰€è¿°ï¼Œåœ¨æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬å°†å®ç°ä¸Bepuä¸€èµ·ä½¿ç”¨ï¼Œåœ¨å®¢æˆ·ç«¯-Unityã€‚ <br><br> åœ¨è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯åœ¨æœåŠ¡å™¨ä¸Šå¤„ç†ç‰©ç†é—®é¢˜çš„ç»†å¾®å·®åˆ«ã€‚ <br><br> ç”±äºå®¢æˆ·ç«¯å»¶è¿Ÿï¼ˆæ»åï¼‰ä»æœåŠ¡å™¨æ¥æ”¶ä¸–ç•Œæ›´æ–°çš„äº‹å®ï¼Œç©å®¶çœ‹åˆ°çš„ä¸–ç•Œä¸ä»–åœ¨æœåŠ¡å™¨ä¸Šçœ‹åˆ°çš„ä¸–ç•Œæœ‰äº›ä¸åŒï¼šä»–ç°åœ¨å’Œè¿‡å»éƒ½çœ‹åˆ°äº†è‡ªå·±ã€‚ å› æ­¤ï¼Œäº‹å®è¯æ˜æ’­æ”¾å™¨åœ¨æœ¬åœ°å°„å‡»ä½äºå…¶ä»–æœåŠ¡å™¨ä¸Šçš„ç›®æ ‡ã€‚ å› æ­¤ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨æœ¬åœ°ç©å®¶åŠ¨ä½œé¢„æµ‹ç³»ç»Ÿï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¡¥å¿åœ¨æœåŠ¡å™¨ä¸Šå°„å‡»æ—¶çš„å»¶è¿Ÿã€‚ <br><br><img src="https://habrastorage.org/webt/h5/gy/k3/h5gyk3svohmmd61k-xll9wq8zps.png"><br><br> ä¸ºäº†è¡¥å¿å®ƒä»¬ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå­˜å‚¨æœ€è¿‘Næ¯«ç§’çš„ä¸–ç•Œå†å²ï¼Œè¿˜éœ€è¦å¤„ç†å†å²ä¸­çš„ç‰©ä½“ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„ç‰©ç†æ€§è´¨ã€‚ å°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿâ€œè¿‡å»â€è®¡ç®—ç¢°æ’ï¼Œrakcastå’Œæ‰«æ ã€‚ é€šå¸¸ï¼Œç‰©ç†å¼•æ“ä¸çŸ¥é“å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼Œä½¿ç”¨PhysXçš„Bepuä¹Ÿä¸ä¾‹å¤–ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªå·±å®ç°æ­¤ç±»åŠŸèƒ½ã€‚ <br><br> ç”±äºæˆ‘ä»¬ä»¥æ¯ç§’30ä¸ªæ»´ç­”å£°çš„å›ºå®šé¢‘ç‡æ¨¡æ‹Ÿæ¸¸æˆï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªæ»´ç­”å£°ä¿å­˜ç‰©ç†ä¸–ç•Œçš„æ•°æ®ã€‚ è¿™ä¸ªæƒ³æ³•ä¸æ˜¯åœ¨ç‰©ç†å¼•æ“ä¸­åˆ›å»ºæ¨¡æ‹Ÿçš„ä¸€ä¸ªå®ä¾‹ï¼Œè€Œæ˜¯åˆ›å»ºN-å¯¹äºå­˜å‚¨åœ¨å†å²è®°å½•ä¸­çš„æ¯ä¸ªåˆ»åº¦-å¹¶ä½¿ç”¨è¿™äº›æ¨¡æ‹Ÿçš„å¾ªç¯ç¼“å†²åŒºå°†å®ƒä»¬å­˜å‚¨åœ¨å†å²è®°å½•ä¸­ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> SimulationSlice[] _simulationHistory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimulationSlice[PhysicsConfigs.HistoryLength]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BepupPhysicsWorld</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _currentSimulationTick = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; PhysicsConfigs.HistoryLength; i++) { _simulationHistory[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimulationSlice(_bufferPool); } }</code> </pre> <br> åœ¨æˆ‘ä»¬çš„ECSä¸­ï¼Œæœ‰è®¸å¤šé€‚ç”¨äºç‰©ç†çš„è¯»å†™ç³»ç»Ÿï¼š <br><br><ul><li>  InitPhysicsWorldSystemï¼› </li><li>  SpawnPhysicsDynamicsBodiesSystem; </li><li>  DestroyPhysicsDynamicsBodiesSystem; </li><li>  UpdatePhysicsTransformsSystem; </li><li>  MovePhysicsSystemï¼Œ </li></ul><br> ä»¥åŠè®¸å¤šåªè¯»ç³»ç»Ÿï¼Œä¾‹å¦‚ç”¨äºè®¡ç®—å°„å‡»å‘½ä¸­ï¼Œæ‰‹æ¦´å¼¹çˆ†ç‚¸ç­‰çš„ç³»ç»Ÿã€‚ <br><br> åœ¨ä¸–ç•Œæ¨¡æ‹Ÿçš„æ¯ä¸ªæ»´ç­”ä¸­ï¼Œé¦–å…ˆæ‰§è¡ŒInitPhysicsWorldSystemï¼Œå®ƒå°†å½“å‰æ»´ç­”å·ï¼ˆSimulationSliceï¼‰è®¾ç½®åˆ°ç‰©ç†å¼•æ“ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetCurrentSimulationTick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tick</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldTick = tick - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newSlice = _simulationHistory[tick % PhysicsConfigs.HistoryLength]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldSlice = _simulationHistory[oldTick % PhysicsConfigs.HistoryLength]; newSlice.RestoreBodiesFromPreviousTick(oldSlice); _currentSimulationTick = tick; }</code> </pre> <br>  RestoreBodiesFromPreviousTickæ–¹æ³•ä»å­˜å‚¨åœ¨å†å²è®°å½•ä¸­çš„æ•°æ®ä¸­ï¼Œåœ¨ä¸Šæ¬¡æ»´ç­”æ—¶è¿˜åŸç‰©ç†å¼•æ“ä¸­å¯¹è±¡çš„ä½ç½®ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">æŸ¥çœ‹ä»£ç </b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RestoreBodiesFromPreviousTick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SimulationSlice previous</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldStaticCount = previous._staticIds.Count; <span class="hljs-comment"><span class="hljs-comment">// add created static objects for (int i = 0; i &lt; oldStaticCount; i++) { var oldId = previous._staticIds[i]; if (!_staticIds.Contains(oldId)) { var oldHandler = previous._staticIdToHandler[oldId]; var oldBody = previous._staticHandlerToBody[oldHandler]; if (oldBody.IsCapsule) { var handler = CreateStatic(oldBody.Capsule, oldBody.Description.Pose, true, oldId, oldBody.CollisionLayer); var body = _staticHandlerToBody[handler]; body.Capsule = oldBody.Capsule; _staticHandlerToBody[handler] = body; } else { var handler = CreateStatic(oldBody.Box, oldBody.Description.Pose, false, oldId, oldBody.CollisionLayer); var body = _staticHandlerToBody[handler]; body.Box = oldBody.Box; _staticHandlerToBody[handler] = body; } } } // delete not existing dynamic objects var newDynamicCount = _dynamicIds.Count; var idsToDel = stackalloc uint[_dynamicIds.Count]; int delIndex = 0; for (int i = 0; i &lt; newDynamicCount; i++) { var newId = _dynamicIds[i]; if (!previous._dynamicIds.Contains(newId)) { idsToDel[delIndex] = newId; delIndex++; } } for (int i = 0; i &lt; delIndex; i++) { var id = idsToDel[i]; var handler = _dynamicIdToHandler[id]; _simulation.Bodies.Remove(handler); _dynamicHandlerToBody.Remove(handler); _dynamicIds.Remove(id); _dynamicIdToHandler.Remove(id); } // add created dynamic objects var oldDynamicCount = previous._dynamicIds.Count; for (int i = 0; i &lt; oldDynamicCount; i++) { var oldId = previous._dynamicIds[i]; if (!_dynamicIds.Contains(oldId)) { var oldHandler = previous._dynamicIdToHandler[oldId]; var oldBody = previous._dynamicHandlerToBody[oldHandler]; if (oldBody.IsCapsule) { var handler = CreateDynamic(oldBody.Capsule, oldBody.BodyReference.Pose, true, oldId, oldBody.CollisionLayer); var body = _dynamicHandlerToBody[handler]; body.Capsule = oldBody.Capsule; _dynamicHandlerToBody[handler] = body; } else { var handler = CreateDynamic(oldBody.Box, oldBody.BodyReference.Pose, false, oldId, oldBody.CollisionLayer); var body = _dynamicHandlerToBody[handler]; body.Box = oldBody.Box; _dynamicHandlerToBody[handler] = body; } } } }</span></span></code> </pre> <br></div></div><br> ä¹‹åï¼ŒSpawnPhysicsDynamicsBodiesSystemå’ŒDestroyPhysicsDynamicsBodiesSystemç³»ç»Ÿæ ¹æ®ä¸Šä¸€æ¬¡ECSæ»´ç­”ä¸­çš„æ›´æ”¹æ–¹å¼åœ¨ç‰©ç†å¼•æ“ä¸­åˆ›å»ºæˆ–åˆ é™¤å¯¹è±¡ã€‚ ç„¶åï¼ŒUpdatePhysicsTransformsSystemæ ¹æ®ECSä¸­çš„æ•°æ®æ›´æ–°æ‰€æœ‰åŠ¨æ€å®ä½“çš„ä½ç½®ã€‚ <br><br> ä¸€æ—¦ECSå’Œç‰©ç†å¼•æ“ä¸­çš„æ•°æ®åŒæ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¡ç®—å¯¹è±¡çš„è¿åŠ¨ã€‚ å®Œæˆæ‰€æœ‰è¯»å†™æ“ä½œåï¼Œç”¨äºè®¡ç®—æ¸¸æˆé€»è¾‘ï¼ˆå°„å‡»ï¼Œçˆ†ç‚¸ï¼Œæˆ˜äº‰è¿·é›¾...ï¼‰çš„åªè¯»ç³»ç»Ÿå¼€å§‹èµ·ä½œç”¨ã€‚ <br><br> é€‚ç”¨äºBepu Physicsçš„å®Œæ•´SimulationSliceå®ç°ä»£ç ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">æŸ¥çœ‹ä»£ç </b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Numerics; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> BepuPhysics; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> BepuPhysics.Collidables; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> BepuUtilities.Memory; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Quaternion = BepuUtilities.Quaternion; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Prototype.Physics</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BepupPhysicsWorld</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimulationSlice</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, StaticBody&gt; _staticHandlerToBody = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, StaticBody&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, DynamicBody&gt; _dynamicHandlerToBody = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, DynamicBody&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; _staticIdToHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; _dynamicIdToHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>&gt; _staticIds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>&gt; _dynamicIds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> BufferPool _bufferPool; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Simulation _simulation; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SimulationSlice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BufferPool bufferPool</span></span></span><span class="hljs-function">)</span></span> { _bufferPool = bufferPool; _simulation = Simulation.Create(_bufferPool, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NarrowPhaseCallbacks(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PoseIntegratorCallbacks(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-9.81f</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>))); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RayCastHit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RayCast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Vector3 direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> distance, CollisionLayer layer, List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; ignoreIds=</span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { direction = direction.Normalized(); BepupRayCastHitHandler handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BepupRayCastHitHandler(_staticHandlerToBody, _dynamicHandlerToBody, layer, ignoreIds); _simulation.RayCast(origin, direction, distance, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> handler); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = handler.RayCastHit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.IsValid) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> collidableReference = handler.CollidableReference; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handler.CollidableReference.Mobility == CollidableMobility.Static) { _simulation.Statics.GetDescription(collidableReference.Handle, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description); result.HitEntityId = _staticHandlerToBody[collidableReference.Handle].Id; result.CollidableCenter = description.Pose.Position; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _simulation.Bodies.GetDescription(collidableReference.Handle, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description); result.HitEntityId = _dynamicHandlerToBody[collidableReference.Handle].Id; result.CollidableCenter = description.Pose.Position; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RayCastHit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SphereCast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Vector3 direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> distance, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, CollisionLayer layer, List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; ignoreIds = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { direction = direction.Normalized(); SweepCastHitHandler handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SweepCastHitHandler(_staticHandlerToBody, _dynamicHandlerToBody, layer, ignoreIds); _simulation.Sweep(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sphere(radius), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RigidPose(origin, Quaternion.Identity), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BodyVelocity(direction.Normalized()), distance, _bufferPool, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> handler); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = handler.RayCastHit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.IsValid) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> collidableReference = handler.CollidableReference; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handler.CollidableReference.Mobility == CollidableMobility.Static) { _simulation.Statics.GetDescription(collidableReference.Handle, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description); result.HitEntityId = _staticHandlerToBody[collidableReference.Handle].Id; result.CollidableCenter = description.Pose.Position; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> reference = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BodyReference(collidableReference.Handle, _simulation.Bodies); result.HitEntityId = _dynamicHandlerToBody[collidableReference.Handle].Id; result.CollidableCenter = reference.Pose.Position; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RayCastHit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CapsuleCast</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Vector3 direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> distance, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, CollisionLayer layer, List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; ignoreIds = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { direction = direction.Normalized(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> length = height - <span class="hljs-number"><span class="hljs-number">2</span></span> * radius; SweepCastHitHandler handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SweepCastHitHandler(_staticHandlerToBody, _dynamicHandlerToBody, layer, ignoreIds); _simulation.Sweep(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Capsule(radius, length), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RigidPose(origin, Quaternion.Identity), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BodyVelocity(direction.Normalized()), distance, _bufferPool, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> handler); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = handler.RayCastHit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.IsValid) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> collidableReference = handler.CollidableReference; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handler.CollidableReference.Mobility == CollidableMobility.Static) { _simulation.Statics.GetDescription(collidableReference.Handle, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description); result.HitEntityId = _staticHandlerToBody[collidableReference.Handle].Id; result.CollidableCenter = description.Pose.Position; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> reference = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BodyReference(collidableReference.Handle, _simulation.Bodies); result.HitEntityId = _dynamicHandlerToBody[collidableReference.Handle].Id; result.CollidableCenter = reference.Pose.Position; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CapsuleOverlap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, BodyMobilityField bodyMobilityField, CollisionLayer layer, List&lt;Overlap&gt; overlaps</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> length = height - <span class="hljs-number"><span class="hljs-number">2</span></span> * radius; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BepupOverlapHitHandler( bodyMobilityField, layer, _staticHandlerToBody, _dynamicHandlerToBody, overlaps); _simulation.Sweep( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Capsule(radius, length), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RigidPose(origin, Quaternion.Identity), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BodyVelocity(Vector3.Zero), <span class="hljs-number"><span class="hljs-number">0</span></span>, _bufferPool, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> handler); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateDynamicBox</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Quaternion rotation, Vector3 size, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, CollisionLayer layer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Box(size.X, size.Y, size.Z); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pose = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RigidPose() { Position = origin, Orientation = rotation }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = CreateDynamic(shape, pose, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, id, layer); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _dynamicHandlerToBody[handler]; body.Box = shape; _dynamicHandlerToBody[handler] = body; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateStaticBox</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Quaternion rotation, Vector3 size, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, CollisionLayer layer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Box(size.X, size.Y, size.Z); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pose = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RigidPose() { Position = origin, Orientation = rotation }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler =CreateStatic(shape, pose, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, id, layer); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _staticHandlerToBody[handler]; body.Box = shape; _staticHandlerToBody[handler] = body; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateStaticCapsule</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Quaternion rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, CollisionLayer layer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> length = height - <span class="hljs-number"><span class="hljs-number">2</span></span> * radius; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Capsule(radius, length); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pose = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RigidPose() { Position = origin, Orientation = rotation }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler =CreateStatic(shape, pose, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, id, layer); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _staticHandlerToBody[handler]; body.Capsule = shape; _staticHandlerToBody[handler] = body; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateDynamicCapsule</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 origin, Quaternion rotation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, CollisionLayer layer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> length = height - <span class="hljs-number"><span class="hljs-number">2</span></span> * radius; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Capsule(radius, length); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pose = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RigidPose() { Position = origin, Orientation = rotation }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = CreateDynamic(shape, pose, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, id, layer); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> body = _dynamicHandlerToBody[handler]; body.Capsule = shape; _dynamicHandlerToBody[handler] = body; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CreateDynamic&lt;TShape&gt;(TShape shape, RigidPose pose, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isCapsule, <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> id, CollisionLayer collisionLayer) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TShape : <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>, IShape { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> activity = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BodyActivityDescription() { SleepThreshold = <span class="hljs-number"><span class="hljs-number">-1</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> collidable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CollidableDescription() { Shape = _simulation.Shapes.Add(shape), SpeculativeMargin = <span class="hljs-number"><span class="hljs-number">0.1f</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> capsuleDescription = BodyDescription.CreateKinematic(pose, collidable, activity); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = _simulation.Bodies.Add(capsuleDescription); _dynamicIds.Add(id); _dynamicIdToHandler.Add(id, handler); _dynamicHandlerToBody.Add(handler, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DynamicBody { BodyReference = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BodyReference(handler, _simulation.Bodies), Id = id, IsCapsule = isCapsule, CollisionLayer = collisionLayer }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handler; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CreateStatic&lt;TShape&gt;(TShape shape, RigidPose pose, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isCapsule, <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> id, CollisionLayer collisionLayer) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TShape : <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>, IShape { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> capsuleDescription = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StaticDescription() { Pose = pose, Collidable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CollidableDescription() { Shape = _simulation.Shapes.Add(shape), SpeculativeMargin = <span class="hljs-number"><span class="hljs-number">0.1f</span></span>, } }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = _simulation.Statics.Add(capsuleDescription); _staticIds.Add(id); _staticIdToHandler.Add(id, handler); _staticHandlerToBody.Add(handler, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StaticBody { Description = capsuleDescription, Id = id, IsCapsule = isCapsule, CollisionLayer = collisionLayer }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handler; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveOrphanedDynamicBodies</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TableSet currentWorld</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> toDel = <span class="hljs-keyword"><span class="hljs-keyword">stackalloc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>[_dynamicIds.Count]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> toDelIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _dynamicIdToHandler) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentWorld.DynamicPhysicsBody.HasCmp(i.Key)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } toDel[toDelIndex] = i.Key; toDelIndex++; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; toDelIndex; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = toDel[i]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = _dynamicIdToHandler[id]; _simulation.Bodies.Remove(handler); _dynamicHandlerToBody.Remove(handler); _dynamicIds.Remove(id); _dynamicIdToHandler.Remove(id); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasBody</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _staticIdToHandler.ContainsKey(id) || _dynamicIdToHandler.ContainsKey(id); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RestoreBodiesFromPreviousTick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SimulationSlice previous</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldStaticCount = previous._staticIds.Count; <span class="hljs-comment"><span class="hljs-comment">// add created static objects for (int i = 0; i &lt; oldStaticCount; i++) { var oldId = previous._staticIds[i]; if (!_staticIds.Contains(oldId)) { var oldHandler = previous._staticIdToHandler[oldId]; var oldBody = previous._staticHandlerToBody[oldHandler]; if (oldBody.IsCapsule) { var handler = CreateStatic(oldBody.Capsule, oldBody.Description.Pose, true, oldId, oldBody.CollisionLayer); var body = _staticHandlerToBody[handler]; body.Capsule = oldBody.Capsule; _staticHandlerToBody[handler] = body; } else { var handler = CreateStatic(oldBody.Box, oldBody.Description.Pose, false, oldId, oldBody.CollisionLayer); var body = _staticHandlerToBody[handler]; body.Box = oldBody.Box; _staticHandlerToBody[handler] = body; } } } // delete not existing dynamic objects var newDynamicCount = _dynamicIds.Count; var idsToDel = stackalloc uint[_dynamicIds.Count]; int delIndex = 0; for (int i = 0; i &lt; newDynamicCount; i++) { var newId = _dynamicIds[i]; if (!previous._dynamicIds.Contains(newId)) { idsToDel[delIndex] = newId; delIndex++; } } for (int i = 0; i &lt; delIndex; i++) { var id = idsToDel[i]; var handler = _dynamicIdToHandler[id]; _simulation.Bodies.Remove(handler); _dynamicHandlerToBody.Remove(handler); _dynamicIds.Remove(id); _dynamicIdToHandler.Remove(id); } // add created dynamic objects var oldDynamicCount = previous._dynamicIds.Count; for (int i = 0; i &lt; oldDynamicCount; i++) { var oldId = previous._dynamicIds[i]; if (!_dynamicIds.Contains(oldId)) { var oldHandler = previous._dynamicIdToHandler[oldId]; var oldBody = previous._dynamicHandlerToBody[oldHandler]; if (oldBody.IsCapsule) { var handler = CreateDynamic(oldBody.Capsule, oldBody.BodyReference.Pose, true, oldId, oldBody.CollisionLayer); var body = _dynamicHandlerToBody[handler]; body.Capsule = oldBody.Capsule; _dynamicHandlerToBody[handler] = body; } else { var handler = CreateDynamic(oldBody.Box, oldBody.BodyReference.Pose, false, oldId, oldBody.CollisionLayer); var body = _dynamicHandlerToBody[handler]; body.Box = oldBody.Box; _dynamicHandlerToBody[handler] = body; } } } } public void Update() { _simulation.Timestep(GameState.TickDurationSec); } public void UpdateBody(uint id, Vector3 position, float angle) { if (_staticIdToHandler.TryGetValue(id, out var handler)) { _simulation.Statics.GetDescription(handler, out var staticDescription); staticDescription.Pose.Position = position; staticDescription.Pose.Orientation = Quaternion.CreateFromAxisAngle(new Vector3(0, 1, 0), angle); _simulation.Statics.ApplyDescription(handler, staticDescription); } else if(_dynamicIdToHandler.TryGetValue(id, out handler)) { BodyReference reference = new BodyReference(handler, _simulation.Bodies); reference.Pose.Position = position; reference.Pose.Orientation = Quaternion.CreateFromAxisAngle(new Vector3(0, 1, 0), angle); } } public void Dispose() { _simulation.Clear(); } } public void Dispose() { _bufferPool.Clear(); } } }</span></span></code> </pre> <br></div></div><br> å¦å¤–ï¼Œé™¤äº†åœ¨æœåŠ¡å™¨ä¸Šå®ç°å†å²è®°å½•ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨å®¢æˆ·ç«¯ä¸Šå®ç°ç‰©ç†å†å²è®°å½•ã€‚ æˆ‘ä»¬çš„Unityå®¢æˆ·ç«¯å…·æœ‰æœåŠ¡å™¨ä»¿çœŸæ¨¡å¼ï¼ˆæˆ‘ä»¬ç§°ä¸ºæœ¬åœ°ä»¿çœŸï¼‰ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼ŒæœåŠ¡å™¨ä»£ç ä¸å®¢æˆ·ç«¯ä¸€èµ·è¿è¡Œã€‚ æˆ‘ä»¬ä½¿ç”¨æ­¤æ¨¡å¼æ¥å¿«é€Ÿåˆ¶ä½œæ¸¸æˆåŠŸèƒ½åŸå‹ã€‚ <br><br> ä¸Bepuä¸€æ ·ï¼ŒPhysXä¹Ÿæ²¡æœ‰å†å²è®°å½•æ”¯æŒã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹æœåŠ¡å™¨ä¸Šçš„æ¯ä¸ªå†å²è®°å½•ä½¿ç”¨äº†å‡ æ¬¡ç‰©ç†æ¨¡æ‹Ÿï¼Œä½¿ç”¨äº†ç›¸åŒçš„æƒ³æ³•ã€‚ ä½†æ˜¯ï¼ŒUnityåœ¨ä½¿ç”¨ç‰©ç†å¼•æ“æ—¶å¼ºåŠ äº†è‡ªå·±çš„ç»†èŠ‚ã€‚ ä½†æ˜¯ï¼Œåº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬çš„é¡¹ç›®æ˜¯åœ¨Unity 2018.4ï¼ˆLTSï¼‰ä¸Šå¼€å‘çš„ï¼ŒæŸäº›APIå¯èƒ½ä¼šåœ¨è¾ƒæ–°çš„ç‰ˆæœ¬ä¸­æ›´æ”¹ï¼Œå› æ­¤ä¸ä¼šå‡ºç°åƒæˆ‘ä»¬è¿™æ ·çš„é—®é¢˜ã€‚ <br><br> é—®é¢˜åœ¨äºï¼ŒUnityä¸å…è®¸åˆ›å»ºå•ç‹¬çš„ç‰©ç†æ¨¡æ‹Ÿï¼ˆæˆ–ç”¨PhysXæœ¯è¯­è¡¨ç¤ºä¸ºåœºæ™¯ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬åœ¨Unityä¸Šçš„ç‰©ç†å†å²ä¸­å°†æ¯ä¸ªæ»´ç­”å®ç°ä¸ºå•ç‹¬çš„åœºæ™¯ã€‚ <br><br> åœ¨æ­¤ç±»æƒ…å†µä¸‹ç¼–å†™äº†åŒ…è£…å™¨ç±»-UnityPhysicsHistorySliceï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnityPhysicsHistorySlice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SphereCastDelegate sphereCastDelegate, OverlapSphereNonAlloc overlapSphere, CapsuleCastDelegate capsuleCast, OverlapCapsuleNonAlloc overlapCapsule, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { _scene = SceneManager.CreateScene(name, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CreateSceneParameters() { localPhysicsMode = LocalPhysicsMode.Physics3D }); _physicsScene = _scene.GetPhysicsScene(); _sphereCast = sphereCastDelegate; _capsuleCast = capsuleCast; _overlapSphere = overlapSphere; _overlapCapsule = overlapCapsule; _boxPool = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PhysicsSceneObjectsPool&lt;BoxCollider&gt;(_scene, <span class="hljs-string"><span class="hljs-string">"box"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); _capsulePool = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PhysicsSceneObjectsPool&lt;UnityEngine.CapsuleCollider&gt;(_scene, <span class="hljs-string"><span class="hljs-string">"sphere"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> <br>  Unityçš„ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œæ‰€æœ‰ä¸ç‰©ç†å­¦æœ‰å…³çš„å·¥ä½œéƒ½æ˜¯é€šè¿‡Physicsé™æ€ç±»å®Œæˆçš„ï¼Œè¯¥ç±»çš„APIä¸å…è®¸æ‚¨åœ¨ç‰¹å®šåœºæ™¯ä¸­æ‰§è¡Œrakecastå’Œscancastã€‚ è¯¥APIä»…é€‚ç”¨äºä¸€ä¸ªæ´»åŠ¨åœºæ™¯ã€‚ ä½†æ˜¯ï¼ŒPhysXå¼•æ“æœ¬èº«å…è®¸æ‚¨åŒæ—¶å¤„ç†å¤šä¸ªåœºæ™¯ï¼Œåªéœ€è¦è°ƒç”¨æ­£ç¡®çš„æ–¹æ³•å³å¯ã€‚ å¹¸è¿çš„æ˜¯ï¼ŒUnityå°†æ­¤ç±»æ–¹æ³•éšè—åœ¨Physics.csç±»æ¥å£çš„åé¢ï¼Œå‰©ä¸‹çš„å°±æ˜¯è®¿é—®å®ƒä»¬ã€‚ æˆ‘ä»¬è¿™æ ·åšæ˜¯è¿™æ ·çš„ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">æŸ¥çœ‹ä»£ç </b> <div class="spoiler_text"><pre> <code class="cs hljs">MethodInfo raycastMethod = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Physics).GetMethod(<span class="hljs-string"><span class="hljs-string">"Internal_SphereCast"</span></span>, BindingFlags.NonPublic | BindingFlags.Static); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sphereCast = (SphereCastDelegate) Delegate.CreateDelegate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(SphereCastDelegate), raycastMethod); MethodInfo overlapSphereMethod = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Physics).GetMethod(<span class="hljs-string"><span class="hljs-string">"OverlapSphereNonAlloc_Internal"</span></span>, BindingFlags.NonPublic | BindingFlags.Static); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> overlapSphere = (OverlapSphereNonAlloc) Delegate.CreateDelegate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(OverlapSphereNonAlloc), overlapSphereMethod); MethodInfo capsuleCastMethod = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Physics).GetMethod(<span class="hljs-string"><span class="hljs-string">"Internal_CapsuleCast"</span></span>, BindingFlags.NonPublic | BindingFlags.Static); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> capsuleCast = (CapsuleCastDelegate) Delegate.CreateDelegate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(CapsuleCastDelegate), capsuleCastMethod); MethodInfo overlapCapsuleMethod = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Physics).GetMethod(<span class="hljs-string"><span class="hljs-string">"OverlapCapsuleNonAlloc_Internal"</span></span>, BindingFlags.NonPublic | BindingFlags.Static); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> overlapCapsule = (OverlapCapsuleNonAlloc) Delegate.CreateDelegate(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(OverlapCapsuleNonAlloc), overlapCapsuleMethod);</code> </pre> <br></div></div><br> å¦åˆ™ï¼Œç”¨äºå®ç°UnityPhysicsHistorySliceçš„ä»£ç ä¸BepuSimulationSliceä¸­çš„ä»£ç æ²¡æœ‰å¤ªå¤§ä¸åŒã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬è·å¾—äº†ä¸¤ç§æ¸¸æˆç‰©ç†å®ç°ï¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šã€‚ <br><br> ä¸‹ä¸€æ­¥æ˜¯æµ‹è¯•ã€‚ <br><br> å®¢æˆ·çš„â€œå¥åº·çŠ¶å†µâ€æœ€é‡è¦çš„æŒ‡æ ‡ä¹‹ä¸€æ˜¯æœåŠ¡å™¨è¯¯åˆ¤æ¬¡æ•°çš„å‚æ•°ã€‚ åœ¨åˆ‡æ¢åˆ°ä¸åŒçš„ç‰©ç†å¼•æ“ä¹‹å‰ï¼Œè¯¥æŒ‡æ ‡åœ¨1-2ï¼…èŒƒå›´å†…å˜åŒ–-ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŒç»­9000æ»´ç­”å£°ï¼ˆæˆ–5åˆ†é’Ÿï¼‰çš„æˆ˜æ–—ä¸­ï¼Œæˆ‘ä»¬è¢«è¯¯è®¤ä¸ºæ˜¯90-180æ»´ç­”å£°ã€‚ æˆ‘ä»¬åœ¨è½¯ä¼‘æ¯å®¤ä¸­é€šè¿‡æ¸¸æˆçš„å¤šä¸ªå‘è¡Œç‰ˆè·å¾—äº†è¿™äº›ç»“æœã€‚ åˆ‡æ¢åˆ°ä¸åŒçš„å¼•æ“åï¼Œæˆ‘ä»¬é¢„è®¡è¯¥æŒ‡æ ‡ä¼šå¼ºåŠ²å¢é•¿-ç”šè‡³å¯èƒ½æ˜¯å‡ åå€-æ¯•ç«Ÿï¼Œç°åœ¨æˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šæ‰§è¡Œäº†ä¸åŒçš„ä»£ç ï¼Œè€Œä¸”ä¸åŒç®—æ³•çš„è®¡ç®—é”™è¯¯ä¼šè¿…é€Ÿç´¯ç§¯ï¼Œè¿™ä¼¼ä¹æ˜¯åˆä¹é€»è¾‘çš„ã€‚ å®é™…ä¸Šï¼Œäº‹å®è¯æ˜ï¼Œå·®å¼‚å‚æ•°ä»…å¢é•¿0.2-0.5ï¼…ï¼Œå¹³å‡æ¯åœºæˆ˜æ–—2-2.5ï¼…ï¼Œè¿™å®Œå…¨é€‚åˆæˆ‘ä»¬ã€‚ <br><br> æˆ‘ä»¬ç ”ç©¶çš„å¤§å¤šæ•°å¼•æ“å’ŒæŠ€æœ¯åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šéƒ½ä½¿ç”¨ç›¸åŒçš„ä»£ç ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å…³äºä½¿ç”¨ä¸åŒç‰©ç†å¼•æ“çš„å¯èƒ½æ€§çš„å‡è®¾å¾—åˆ°äº†è¯å®ã€‚ å·®å¼‚ç‡å¦‚æ­¤ä¹‹å°å¢é•¿çš„ä¸»è¦åŸå› æ˜¯æˆ‘ä»¬ä½¿ç”¨ECSç³»ç»Ÿä¹‹ä¸€æ¥è®¡ç®—ç‰©ä½“åœ¨ç©ºé—´ä¸­çš„è¿åŠ¨å’Œç¢°æ’ã€‚ å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šçš„ä»£ç å‡ç›¸åŒã€‚ ä»ç‰©ç†å¼•æ“ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å¿«é€Ÿè®¡ç®—ç‘å…‹å¹¿æ’­å’Œæ‰«è§†å¹¿æ’­ï¼Œå¹¶ä¸”åœ¨å®è·µä¸­ï¼Œå¯¹äºæˆ‘ä»¬çš„ä¸¤ä¸ªå¼•æ“è€Œè¨€ï¼Œè¿™äº›æ“ä½œçš„ç»“æœç›¸å·®æ— å‡ ã€‚ <br><br><h2> è¯»ä»€ä¹ˆ </h2><br> æ€»ä¹‹ï¼Œä¸å¾€å¸¸ä¸€æ ·ï¼Œè¿™é‡Œæœ‰ä¸€äº›ç›¸å…³é“¾æ¥ï¼š <br><br><ul><li>  <a href="https://habr.com/ru/company/pixonic/blog/481880/">ç§»åŠ¨PvPå°„å‡»æ¸¸æˆçš„ç‰©ç†åŸç†ï¼Œç¬¬1éƒ¨åˆ†</a> ï¼› </li><li>  <a href="https://habr.com/ru/company/pixonic/blog/415959/">ç§»åŠ¨PvPå°„å‡»æ¸¸æˆçš„ç½‘ç»œä»£ç </a> ; </li><li>  <a href="https://gafferongames.com/">Glen Fiedlerçš„åšå®¢ï¼Œä»‹ç»å¦‚ä½•åœ¨æ¸¸æˆä¸­ç¼–å†™ç½‘ç»œä»£ç </a> ï¼› </li><li>  <a href="https://www.gdcvault.com/play/1026322/Back-to-the-Future-Working">For Honorä¸­çš„ç¡®å®šæ€§ä»¿çœŸå’Œç½‘ç»œä»£ç </a> ã€‚ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN485150/">https://habr.com/ru/post/zh-CN485150/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN485136/index.html">Istioè·Ÿè¸ªå’Œç›‘è§†ï¼šå¾®æœåŠ¡å’Œä¸ç¡®å®šæ€§åŸåˆ™</a></li>
<li><a href="../zh-CN485138/index.html">åº”ç”¨ç¨‹åºæœ¬åœ°åŒ–ï¼šæˆ‘ä»¬å¦‚ä½•äº¤å‹ç¿»è¯‘å’Œå¼€å‘</a></li>
<li><a href="../zh-CN485144/index.html">æˆ‘å¦‚ä½•ä¿®å¤æŸåçš„åŸºåº§ä»¥åŠå®ƒçš„ä½œç”¨</a></li>
<li><a href="../zh-CN485146/index.html">æ ¹æ®Habr Careerè®¡ç®—å™¨ï¼Œ2019å¹´ä¸‹åŠå¹´çš„ITè–ªé…¬</a></li>
<li><a href="../zh-CN485148/index.html">è¿™ä¸ªå¯çˆ±çš„Unicode</a></li>
<li><a href="../zh-CN485152/index.html">åœ¨Redmadrobotçš„ç§»åŠ¨å¼€å‘äººå‘˜æ˜¥å­£å®ä¹ </a></li>
<li><a href="../zh-CN485154/index.html">å¦‚ä½•é€šè¿‡å¼€å‘äººå‘˜æ‰“é€ å“ç‰Œæ€ªèƒï¼šç¨‹åºå‘˜æ¿€åŠ±ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN485156/index.html">å¦‚ä½•æˆä¸ºå›½å†…ä¼—ç­¹ï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰</a></li>
<li><a href="../zh-CN485158/index.html">å°¼å¤æ‹‰Â·ç“¦ç»´æ´›å¤«ï¼ˆNikolay Vavilovï¼‰ã€‚ æƒ³è¦å…»æ´»æ•´ä¸ªä¸–ç•Œå¹¶åœ¨ç›‘ç‹±ç‰¢æˆ¿ä¸­é¥¿æ­»çš„äºº</a></li>
<li><a href="../zh-CN485160/index.html">æˆ‘å¯¹ACIDçš„çœ‹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>