<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöü üçû üë©‚Äç‚ù§Ô∏è‚Äçüë© Une introduction aux annotations de type Python. Continuation üìØ üõ∞Ô∏è üë®üèø‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Illustration de Magdalena Tomczyk 


 Dans la premi√®re partie de l'article, j'ai d√©crit les bases de l'utilisation des annotations de type. Cependant,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une introduction aux annotations de type Python. Continuation</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/435988/"><p><img src="https://habrastorage.org/webt/y7/ga/db/y7gadbfhjtos8fwsz0adszur0is.png"><br>  <em>Illustration de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Magdalena Tomczyk</a></em> </p><br><p>  Dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premi√®re partie de l'article,</a> j'ai d√©crit les bases de l'utilisation des annotations de type.  Cependant, plusieurs points importants n'ont pas √©t√© pris en compte.  Premi√®rement, les g√©n√©riques sont un m√©canisme important, et deuxi√®mement, il peut parfois √™tre utile de trouver des informations sur les types attendus lors de l'ex√©cution.  Mais je voulais commencer avec des choses plus simples </p><a name="habracut"></a><br><h3 id="predvaritelnoe-obyavlenie">  Annonce pr√©alable </h3><br><p>  En r√®gle g√©n√©rale, vous ne pouvez pas utiliser un type avant sa cr√©ation.  Par exemple, le code suivant ne d√©marre m√™me pas: </p><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinkedList</span></span></span><span class="hljs-class">:</span></span> data: Any next: LinkedList <span class="hljs-comment"><span class="hljs-comment"># NameError: name 'LinkedList' is not defined</span></span></code> </pre> <br><p>  Pour r√©soudre ce probl√®me, il est permis d'utiliser un litt√©ral de cha√Æne.  Dans ce cas, les annotations seront calcul√©es diff√©r√©es. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinkedList</span></span></span><span class="hljs-class">:</span></span> data: Any next: <span class="hljs-string"><span class="hljs-string">'LinkedList'</span></span></code> </pre> <br><p>  Vous pouvez √©galement acc√©der aux classes √† partir d'autres modules (bien s√ªr, si le module est import√©): <code>some_variable: 'somemodule.SomeClass'</code> </p><br><div class="spoiler">  <b class="spoiler_title">Remarque</b> <div class="spoiler_text"><p>  De mani√®re g√©n√©rale, toute expression calculable peut √™tre utilis√©e comme annotation.  Cependant, il est recommand√© de les garder aussi simples que possible afin que les utilitaires d'analyse statique puissent les utiliser.  En particulier, ils ne comprendront probablement pas les types calculables dynamiquement.  Pour en savoir plus sur les restrictions, cliquez ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PEP 484 - Astuces de type # Astuces de type acceptables</a> </p><br><p>  Par exemple, le code suivant fonctionnera et m√™me des annotations seront disponibles lors de l'ex√©cution, mais mypy g√©n√©rera une erreur dessus </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_next_type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(arg=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> arg: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> LinkedList <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Any <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinkedList</span></span></span><span class="hljs-class">:</span></span> data: Any next: <span class="hljs-string"><span class="hljs-string">'get_next_type()'</span></span> <span class="hljs-comment"><span class="hljs-comment"># error: invalid type comment or annotation</span></span></code> </pre> </div></div><br><p>  <strong>UPD</strong> : En Python 4.0, il est pr√©vu d'inclure le calcul d'annotation de type diff√©r√© ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PEP 563</a> ), qui supprimera cette technique avec les litt√©raux de cha√Æne.  avec Python 3.7, vous pouvez activer un nouveau comportement √† l'aide de la construction d' <code>from __future__ import annotations</code> </p><br><h3 id="funkcii-i-vyzyvaemye-obekty">  Fonctions et objets appel√©s </h3><br><p>  Pour les situations o√π vous devez transf√©rer une fonction ou un autre objet (par exemple, en tant que rappel), vous devez utiliser l'annotation Callable [[ArgType1, ArgType2, ...], ReturnType] <br>  Par exemple </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">help</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"This is help string"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render_hundreds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num: int)</span></span></span><span class="hljs-function"> -&gt; str:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str(num // <span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">app</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(helper: Callable[[], None], renderer: Callable[[int], str])</span></span></span><span class="hljs-function">:</span></span> helper() num = <span class="hljs-number"><span class="hljs-number">12345</span></span> print(renderer(num)) app(help, render_hundreds) app(help, help) <span class="hljs-comment"><span class="hljs-comment"># error: Argument 2 to "app" has incompatible type "Callable[[], None]"; expected "Callable[[int], str]"</span></span></code> </pre> <br><p>  Il est permis de sp√©cifier uniquement le type de retour de la fonction sans sp√©cifier ses param√®tres.  Dans ce cas, les points de suspension sont utilis√©s: <code>Callable[..., ReturnType]</code> .  Notez qu'il n'y a pas de crochets autour des points de suspension. </p><br><p>  Pour le moment, il est impossible de d√©crire une signature de fonction avec un nombre variable de param√®tres d'un certain type ou de sp√©cifier des arguments nomm√©s. </p><br><h3 id="generic-tipy">  Types g√©n√©riques </h3><br><p>  Parfois, il est n√©cessaire de sauvegarder des informations sur un type, sans le fixer de mani√®re rigide.  Par exemple, si vous √©crivez un conteneur qui stocke les m√™mes donn√©es.  Ou une fonction qui renvoie des donn√©es du m√™me type que l'un des arguments. </p><br><p>  Des types tels que List ou Callable, que nous avons vu pr√©c√©demment, utilisent simplement le m√©canisme g√©n√©rique.  Mais en plus des types standard, vous pouvez cr√©er vos propres types g√©n√©riques.  Pour ce faire, premi√®rement, obtenez une variable TypeVar, qui sera un attribut du g√©n√©rique, et deuxi√®mement, d√©clarez directement un type g√©n√©rique: </p><br><pre> <code class="python hljs">T = TypeVar(<span class="hljs-string"><span class="hljs-string">"T"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinkedList</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Generic[T])</span></span></span><span class="hljs-class">:</span></span> data: T next: <span class="hljs-string"><span class="hljs-string">"LinkedList[T]"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, data: T)</span></span></span><span class="hljs-function">:</span></span> self.data = data head_int: LinkedList[int] = LinkedList(<span class="hljs-number"><span class="hljs-number">1</span></span>) head_int.next = LinkedList(<span class="hljs-number"><span class="hljs-number">2</span></span>) head_int.next = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment"># error: Incompatible types in assignment (expression has type "int", variable has type "LinkedList[int]") head_int.data += 1 head_int.data.replace("0", "1") # error: "int" has no attribute "replace" head_str: LinkedList[str] = LinkedList("1") head_str.data.replace("0", "1") head_str = LinkedList[str](1) # error: Argument 1 to "LinkedList" has incompatible type "int"; expected "str"</span></span></code> </pre> <br><p>  Comme vous pouvez le voir, pour les types g√©n√©riques, l'inf√©rence automatique du type de param√®tre fonctionne. </p><br><p>  Si n√©cessaire, un g√©n√©rique peut avoir un nombre quelconque de param√®tres: <code>Generic[T1, T2, T3]</code> . </p><br><p>  De plus, lors de la d√©finition de TypeVar, vous pouvez restreindre les types valides: </p><br><pre> <code class="python hljs">T2 = TypeVar(<span class="hljs-string"><span class="hljs-string">"T2"</span></span>, int, float) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomethingNumeric</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Generic[T2])</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> x = SomethingNumeric[str]() <span class="hljs-comment"><span class="hljs-comment"># error: Value of type variable "T2" of "SomethingNumeric" cannot be "str"</span></span></code> </pre> <br><h3 id="cast">  Cast </h3><br><p>  Parfois, l'analyseur statique de l'analyseur ne peut pas d√©terminer correctement le type de variable, dans ce cas, vous pouvez utiliser la fonction cast.  Sa seule t√¢che est de montrer √† l'analyseur que l'expression est d'un type particulier.  Par exemple: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> typing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> List, cast <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_first_str</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: List[object])</span></span></span><span class="hljs-function"> -&gt; str:</span></span> index = next(i <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(a) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(x, str)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cast(str, a[index])</code> </pre> <br><p>  Il peut √©galement √™tre utile pour les d√©corateurs: </p><br><pre> <code class="python hljs">MyCallable = TypeVar(<span class="hljs-string"><span class="hljs-string">"MyCallable"</span></span>, bound=Callable) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(func: MyCallable)</span></span></span><span class="hljs-function"> -&gt; MyCallable:</span></span> @wraps(func) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> print(func.__name__, args, kwargs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> func(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cast(MyCallable, wrapper) @logged <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mysum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: int, b: int)</span></span></span><span class="hljs-function"> -&gt; int:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b mysum(a=<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment"># error: Missing positional argument "b" in call to "mysum"</span></span></code> </pre> <br><h3 id="rabota-s-annotaciyami-vo-vremya-vypolneniya">  Travailler avec des annotations d'ex√©cution </h3><br><p>  Bien que l'interpr√©teur n'utilise pas seul les annotations, elles sont disponibles pour votre code pendant l'ex√©cution du programme.  Pour cela, un <code>__annotations__</code> objet <code>__annotations__</code> est <code>__annotations__</code> qui contient un dictionnaire avec les annotations indiqu√©es.  Pour les fonctions, il s'agit des annotations de param√®tres et du type de retour, pour un objet, des annotations de champ, de la port√©e globale, des variables et de leurs annotations. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render_int</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num: int)</span></span></span><span class="hljs-function"> -&gt; str:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str(num) print(render_int.annotations) <span class="hljs-comment"><span class="hljs-comment"># {'num': &lt;class 'int'&gt;, 'return': &lt;class 'str'&gt;}</span></span></code> </pre> <br><p>  <code>get_type_hints</code> est √©galement disponible - il renvoie des annotations pour l'objet qui lui est transmis, dans de nombreuses situations, il correspond au contenu de <code>__annotations__</code> , mais il existe des diff√©rences: il ajoute √©galement des annotations des objets parents (dans l'ordre inverse de <code>__mro__</code> ), et permet √©galement des d√©clarations pr√©liminaires de types sp√©cifi√©s en tant que cha√Ænes. </p><br><pre> <code class="python hljs">T = TypeVar(<span class="hljs-string"><span class="hljs-string">"T"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LinkedList</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Generic[T])</span></span></span><span class="hljs-class">:</span></span> data: T next: <span class="hljs-string"><span class="hljs-string">"LinkedList[T]"</span></span> print(LinkedList.__annotations__) <span class="hljs-comment"><span class="hljs-comment"># {'data': ~T, 'next': 'LinkedList[T]'} print(get_type_hints(LinkedList)) # {'data': ~T, 'next': __main__.LinkedList[~T]}</span></span></code> </pre> <br><p>  Pour les types g√©n√©riques, des informations sur le type lui-m√™me et ses param√®tres sont disponibles via les <code>__origin__</code> et <code>__args__</code> , mais cela ne fait pas partie de la norme et le comportement a d√©j√† chang√© entre les versions 3.6 et 3.7 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435988/">https://habr.com/ru/post/fr435988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435974/index.html">Three.js - faire des contr√¥les pour l'espace ou le plan√©tarium</a></li>
<li><a href="../fr435976/index.html">WebAssembly en production et le ¬´champ de mines¬ª de la Smart TV: un entretien avec Andrei Nagikh</a></li>
<li><a href="../fr435978/index.html">Solutions de contournement de la protection biom√©trique</a></li>
<li><a href="../fr435984/index.html">R√©seaux de neurones et philosophie du langage</a></li>
<li><a href="../fr435986/index.html">Windows r√©servera 7 Go pour les mises √† jour du syst√®me afin d'√©viter de manquer d'espace sur le disque dur</a></li>
<li><a href="../fr435990/index.html">Comment faire un changement?</a></li>
<li><a href="../fr435992/index.html">Les joueurs Fallout 76, qui seront captur√©s dans un endroit secret des d√©veloppeurs, seront interdits</a></li>
<li><a href="../fr435994/index.html">Est-ce Karma, b√©b√©, ou pourquoi l'attaque sur les r√©seaux sans fil qui devait sombrer dans l'oubli est toujours vivante</a></li>
<li><a href="../fr435996/index.html">Technologies AR et VR dans l'√©ducation</a></li>
<li><a href="../fr435998/index.html">Comment casser un terminal libre-service et pourquoi 80% d'entre eux sont menac√©s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>