<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤¾ğŸ¿ ğŸ‘ª ğŸ›£ï¸ Nota de teste de integraÃ§Ã£o usando Jenkins no Kubernetes ğŸ–Šï¸ â™‘ï¸ ğŸŒ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Boa tarde 


 Quase imediatamente apÃ³s a instalaÃ§Ã£o e configuraÃ§Ã£o do CI / CD, de acordo com as instruÃ§Ãµes da postagem anterior , a equipe teve uma pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nota de teste de integraÃ§Ã£o usando Jenkins no Kubernetes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451588/"><p>  Boa tarde </p><br><p>  Quase imediatamente apÃ³s a instalaÃ§Ã£o e configuraÃ§Ã£o do CI / CD, de acordo com as instruÃ§Ãµes da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">postagem anterior</a> , a equipe teve uma pergunta de como executar corretamente os testes de integraÃ§Ã£o.  JÃ¡ tÃ­nhamos experiÃªncia em executar dependÃªncias de teste em contÃªineres do docker, mas isso se tornou problemÃ¡tico desde que o prÃ³prio assembly foi lanÃ§ado no contÃªiner.  Neste artigo, gostaria de descrever dois mÃ©todos possÃ­veis de teste de integraÃ§Ã£o dentro do contÃªiner que se adequassem Ã  minha equipe. </p><a name="habracut"></a><br><h2 id="trebovaniya-k-integracionnomu-testirovaniyu">  Requisitos de teste de integraÃ§Ã£o </h2><br><p>  Por definiÃ§Ã£o, o teste de integraÃ§Ã£o Ã© um teste que testa a operaÃ§Ã£o de um aplicativo com seus componentes dependentes.  Exemplos incluem bancos de dados, filas e outros serviÃ§os. </p><br><p>  Como parte do teste, querÃ­amos: </p><br><ul><li>  executar testes igualmente localmente e em jenkins </li><li>  Evite prÃ©-instalaÃ§Ã£o e configuraÃ§Ã£o de aplicativos dependentes </li><li>  declarar e executar dependÃªncias usando arquivos no repositÃ³rio do projeto </li><li>  ser capaz de executar vÃ¡rias montagens em paralelo </li><li>  Ã© aconselhÃ¡vel poder adicionar novas dependÃªncias no futuro </li><li>  Ã© aconselhÃ¡vel poder testar com versÃµes diferentes da mesma dependÃªncia </li></ul><br><p>  Com base nesses requisitos, descartamos imediatamente a idÃ©ia de ter instalaÃ§Ãµes comuns permanentes de bancos de dados e filas de teste devido a problemas no compartilhamento de recursos entre assemblies e Ã  dificuldade de manter e alterar essa infraestrutura. </p><br><h2 id="variant-1-vstroennye-resheniya">  OpÃ§Ã£o 1: SoluÃ§Ãµes incorporadas </h2><br><p>  Existem algumas bibliotecas no ecossistema java que executam uma dependÃªncia para um teste: </p><br><ul><li>  kafka: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/chbatey/kafka-unit</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/spring-projects/spring-kafka</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/manub/scalatest-embedded-kafka</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cassandra</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">postgres</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">api resto</a> </li></ul><br><p>  Essa abordagem Ã© o mais simples possÃ­vel e satisfaz a maioria dos requisitos descritos anteriormente, mas nÃ£o Ã© universal em termos de adiÃ§Ã£o de novas dependÃªncias de teste (mysql?) Ou uso de versÃµes especÃ­ficas ou de vÃ¡rias dependÃªncias. </p><br><p>  Adequado para serviÃ§os simples com 1-2 dependÃªncias. </p><br><h2 id="variant-2-testcontainers">  OpÃ§Ã£o 2: contÃªineres de teste </h2><br><p>  O Docker Ã© uma maneira lÃ³gica de resolver as deficiÃªncias da abordagem anterior: vocÃª pode encontrar (ou criar uma imagem do Docker) para qualquer dependÃªncia de qualquer versÃ£o.  Provavelmente, algumas das dependÃªncias na produÃ§Ã£o estÃ£o sendo executadas usando as mesmas imagens. </p><br><p> Se iniciar a imagem localmente (ou vÃ¡rias usando a docker-compose) nÃ£o for um problema, haverÃ¡ dificuldades no IC, pois a montagem em si ocorre no contÃªiner.  Embora seja possÃ­vel executar a janela de encaixe na janela de encaixe, isso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nÃ£o</a> Ã© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recomendado pelo criador do dind</a> .  A maneira preferida de contornar esse problema Ã© reutilizar o processo de docker que jÃ¡ estÃ¡ em execuÃ§Ã£o, geralmente chamado de docker de irmÃ£os.  Para fazer isso, vocÃª precisa do processo da janela de encaixe filho para usar <code>/var/run/docker.sock</code> do pai.  Em uma postagem anterior, isso jÃ¡ era usado para publicar imagens do docker com um aplicativo compilado. </p><br><p>  Decidiu-se usar a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">testcontainers</a> , uma vez que: </p><br><ul><li>  fornece uma boa API de gerenciamento de dependÃªncia </li><li>  possui integraÃ§Ãµes com os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bancos de dados</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">filas</a> mais populares </li><li>  usa a abordagem do docker de irmÃ£os ao executar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no contÃªiner</a> </li><li>  funciona da mesma maneira localmente e em ci </li><li>  interrompe contÃªineres apÃ³s a montagem </li></ul><br><p>  Adequado para serviÃ§os mais complexos ou para serviÃ§os com requisitos especiais de dependÃªncia. </p><br><h2 id="upravlenie-resursami">  Gerenciamento de recursos </h2><br><p>  Em seguida, preste atenÃ§Ã£o ao consumo de recursos pelo conjunto do projeto (que pode aumentar significativamente apÃ³s a adiÃ§Ã£o de testes de integraÃ§Ã£o). </p><br><p>  No momento, o assembly nÃ£o indica a quantidade necessÃ¡ria de compartilhamentos de memÃ³ria e CPU, que podem ser dois problemas em potencial: </p><br><ul><li>  O primeiro sÃ£o muitos conjuntos paralelos na mesma mÃ¡quina, o que resultarÃ¡ em um alto fator de carga.  As assemblÃ©ias provavelmente serÃ£o aprovadas, mas elas passarÃ£o muito mais tempo nisso. </li><li>  O segundo Ã© matar OOM.  O Kubernetis pode decidir que vocÃª estÃ¡ consumindo muita memÃ³ria e simplesmente mata os assemblies antes que eles sejam concluÃ­dos. </li></ul><br><p>  VocÃª pode limitar os recursos do contÃªiner na lareira usando a construÃ§Ã£o: </p><br><pre> <code class="plaintext hljs"> resources: requests: cpu: 1 memory: 512Mi limits: cpu: 1 memory: 512Mi</code> </pre> <br><p>  O Jdk9 e superior jÃ¡ tÃªm suporte para trabalhar em um contÃªiner (-XX: + UseContainerSupport (ativado por padrÃ£o), funciona em combinaÃ§Ã£o com -XX: InitialRAMPercentage / -XX: MaxRAMPercentage) </p><br><p>  Um exemplo completo pode ser encontrado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  Para que o Jdk8 funcione corretamente, Ã© necessÃ¡ria a atualizaÃ§Ã£o 131 ou superior com os <code>-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap</code> para ler a memÃ³ria disponÃ­vel do cgroup e nÃ£o da mÃ¡quina host ou sempre que especificar o tamanho de heap disponÃ­vel manualmente usando <code>Xmx</code> . <br>  Um exemplo estÃ¡ disponÃ­vel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  Vale ressaltar que o kubernetes nÃ£o sabe nada sobre os recursos gastos em contÃªineres em execuÃ§Ã£o usando contÃªineres de teste ou docker de irmÃ£os.  Para funcionar corretamente nessa situaÃ§Ã£o, vocÃª pode reservar recursos no contÃªiner de maven, levando em consideraÃ§Ã£o todas as dependÃªncias de teste. </p><br><h2 id="zaklyuchenie">  ConclusÃ£o </h2><br><p>  O teste de integraÃ§Ã£o ao iniciar uma construÃ§Ã£o em um contÃªiner Ã© possÃ­vel e nÃ£o Ã© uma tarefa difÃ­cil. </p><br><p>  Um aplicativo de exemplo com testes de integraÃ§Ã£o usando contÃªineres de teste, vocÃª pode encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> e a configuraÃ§Ã£o para executar o Jenkins no kubernetes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt451588/">https://habr.com/ru/post/pt451588/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt451574/index.html">Desenvolva um utilitÃ¡rio no GraalVM</a></li>
<li><a href="../pt451576/index.html">O livro "Nosso cÃ³digo. Artesanato, profissÃ£o, arte "</a></li>
<li><a href="../pt451580/index.html">MODX Digest # 5 (22 de abril a 13 de maio de 2019)</a></li>
<li><a href="../pt451582/index.html">Marketing de conteÃºdo em inglÃªs: 5 nÃºmeros importantes para ajudar as startups</a></li>
<li><a href="../pt451586/index.html">Bem-vindo Ã  transmissÃ£o BD & DWH Raiffeisen MeetUp UPD</a></li>
<li><a href="../pt451590/index.html">100 coisas anunciadas na I / O No. 19</a></li>
<li><a href="../pt451592/index.html">Registros de relatÃ³rios do segundo QA-mitap Redmadrobot</a></li>
<li><a href="../pt451594/index.html">Guia de RelatÃ³rio do PHP Russia 2019</a></li>
<li><a href="../pt451596/index.html">Cardeal Cinzento .NET - John Galloway</a></li>
<li><a href="../pt451598/index.html">Unidade Fada Fada MÃ¡gica: DSL em C #</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>