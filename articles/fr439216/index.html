<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤱🏼 🍛 🤲🏻 pudge 500 ligne de base de données intégrable sur Golang 🧚🏻 👨‍🌾 👽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="pudge est une base de données clé / valeur intégrable écrite dans la bibliothèque standard Go. 


 Je m'attarderai sur les différences fondamentales p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>pudge 500 ligne de base de données intégrable sur Golang</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439216/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pudge</a> est une base de données clé / valeur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">intégrable</a> écrite dans la bibliothèque standard Go. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c05/28e/3ec/c0528e3ecf0c93f13d51987f18bbec31.jpg" alt="image"></div><br>  Je m'attarderai sur les différences fondamentales par rapport aux solutions existantes. <br><br>  <b>Apatride</b> <br><br><pre><code class="go hljs">pudge.Set(<span class="hljs-string"><span class="hljs-string">"../test/test"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello"</span></span>, <span class="hljs-string"><span class="hljs-string">"World"</span></span>)</code> </pre> <br>  Puj créera automatiquement la base de données de test, y compris les sous-répertoires, ou l'ouvrira.  Il n'est pas nécessaire de stocker l'état de la table et vous pouvez stocker en toute sécurité des valeurs dans des applications multithreads.  Pooj est thread-safe. <br><a name="habracut"></a><br>  <b>Typefree</b> <br><br>  Dans puj, vous pouvez écrire des octets, des chaînes, des nombres ou des structures.  Sans vous soucier de convertir les données en leur représentation binaire. <br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Point <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { X <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Y <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">100</span></span>; i &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; i-- { p := &amp;Point{X: i, Y: i} db.Set(i, p) } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> point Point db.Get(<span class="hljs-number"><span class="hljs-number">8</span></span>, &amp;point) log.Println(point)</code> </pre><br>  <b>Système de requête</b> <br><br>  Puj offre la possibilité d'extraire des clés dans un ordre spécifique, y compris la sélection avec une limite, l'indentation, le tri et la sélection par préfixe. <br><br><pre> <code class="go hljs"> keys, _ := db.Keys(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre><br>  Le code ci-dessus est similaire à la requête SQL: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">keys</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> db <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>&gt;<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">keys</span></span> <span class="hljs-keyword"><span class="hljs-keyword">asc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Veuillez noter que le tri des clés est «paresseux».  En revanche, les clés sont stockées en mémoire et cela fonctionne assez rapidement. <br><br>  <b>Parallélisme</b> <br><br>  Pooj, comme la plupart des bases de données modernes, utilise un modèle de lecture non bloquant, mais l'écriture dans un fichier bloque toutes les opérations.  Mais vous pouvez créer / ouvrir des fichiers à la volée, en minimisant le nombre de verrous.  Il n'y a pas d'erreur "base de données déjà ouverte" dans puja.  Exemple d'utilisation dans le routeur http: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c *gin.Context)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> err error group := c.Param(<span class="hljs-string"><span class="hljs-string">"group"</span></span>) counter := c.Param(<span class="hljs-string"><span class="hljs-string">"counter"</span></span>) db, err := pudge.Open(group, cfg) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { renderError(c, err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } _, err = db.Counter(counter, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { renderError(c, err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } c.String(http.StatusOK, <span class="hljs-string"><span class="hljs-string">"%s"</span></span>, <span class="hljs-string"><span class="hljs-string">"ok"</span></span>) }</code> </pre><br>  <b>Les moteurs</b> <br><br>  Malgré sa petite taille, le puj prend en charge deux modes de stockage de données.  En mémoire et sur disque.  Par défaut, puj stocke uniquement les données (valeurs) sur le disque.  Mais si vous le souhaitez, vous pouvez activer le mode de stockage des données en mémoire.  Dans ce cas, ils seront vidés sur le disque à la demande ou à la fermeture de la base de données. <br><br>  <b>Statut</b> <br><br>  Pooj est utilisé à la fois dans les projets domestiques et en production, sur le graphique ci-dessous - le nombre de demandes au serveur http basé sur puj, et le nombre de demandes est supérieur à 20 ms <br><br><img src="https://habrastorage.org/webt/ix/hw/n3/ixhwn3soybfgz39srund7huutwg.png"><br><br>  Dans ce cas, le puja est activé en mode de synchronisation complète et, au moment de la synchronisation, des retards importants (plus de 20 ms) se produisent.  Mais heureusement, il n'y en a pas tant en pourcentage. <br><br>  Sur la page du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projet,</a> vous pouvez trouver plus de liens avec des exemples d'intégration de puja dans divers projets. <br><br>  <b>La vitesse</b> <br><br>  Dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">référentiel</a> avec benchmark'y, vous pouvez comparer puj avec d'autres bases de données: <br><br><h3>  Test 1 </h3><br><pre> <code class="plaintext hljs">Number of keys: 1000000 Minimum key size: 16, maximum key size: 64 Minimum value size: 128, maximum value size: 512 Concurrency: 2</code> </pre><table><tbody><tr><td></td><td>  <sup>pogreb</sup> <sup><br></sup> </td><td>  <sup>goleveldb</sup> <sup><br></sup> </td><td>  <sup>boulon</sup> <sup><br></sup> </td><td>  <sup>badgerdb</sup> <sup><br></sup> </td><td>  <sup>pudge</sup> <sup><br></sup> </td><td>  <sup>slowpoke</sup> <sup><br></sup> </td><td>  <sup>pudge (mem)</sup> <sup><br></sup> </td></tr><tr><td>  <sup>1M (Put + Get), secondes</sup> <sup><br></sup> </td><td>  <sup>187</sup> <sup><br></sup> </td><td>  <sup>38</sup> <sup><br></sup> </td><td>  <sup>126</sup> <sup><br></sup> </td><td>  <sup>34</sup> <sup><br></sup> </td><td>  <sup>23</sup> <sup><br></sup> </td><td>  <sup>23</sup> <sup><br></sup> </td><td>  <sup>2</sup> <sup><br></sup> </td></tr><tr><td>  <sup>1M Put, ops / sec</sup> <sup><br></sup> </td><td>  <sup>5336</sup> <sup><br></sup> </td><td>  <sup>34743</sup> <sup><br></sup> </td><td>  <sup>8054</sup> <sup><br></sup> </td><td>  <sup>33539</sup> <sup><br></sup> </td><td>  <sup>47298</sup> <sup><br></sup> </td><td>  <sup>46789</sup> <sup><br></sup> </td><td>  <sup>439581</sup> <sup><br></sup> </td></tr><tr><td>  <sup>1M Get, ops / sec</sup> <sup><br></sup> </td><td>  <sup>1782423</sup> <sup><br></sup> </td><td>  <sup>98406</sup> <sup><br></sup> </td><td>  <sup>499871</sup> <sup><br></sup> </td><td>  <sup>220597</sup> <sup><br></sup> </td><td>  <sup>499172</sup> <sup><br></sup> </td><td>  <sup>445783</sup> <sup><br></sup> </td><td>  <sup>1652069</sup> <sup><br></sup> </td></tr><tr><td>  <sup>FileSize Mb</sup> <sup><br></sup> </td><td>  <sup>568</sup> <sup><br></sup> </td><td>  <sup>357</sup> <sup><br></sup> </td><td>  <sup>552</sup> <sup><br></sup> </td><td>  <sup>487</sup> <sup><br></sup> </td><td>  <sup>358</sup> <sup><br></sup> </td><td>  <sup>358</sup> <sup><br></sup> </td><td>  <sup>358</sup> <sup><br></sup> </td></tr></tbody></table><br>  Pooja est très bien équilibré dans le rapport entre la vitesse d'écriture et la vitesse de lecture.  Qu'il ne s'agit pas d'une base de données hautement spécialisée optimisée pour la lecture ou l'écriture.  À vitesse de lecture élevée - une vitesse d'écriture assez élevée est maintenue.  Ce qui, cependant, peut être encore augmenté en parallélisant les enregistrements à différents fichiers (comme cela se fait dans les moteurs LSM Tree). <br><br>  Liens vers les bases de données utilisées dans le test: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pogreb Stockage de</a> valeurs-clés intégré pour les charges de travail lourdes en lecture écrites en Go </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">goleveldb</a> Base de données de clés / valeurs LevelDB dans Go. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bolt</a> Une base de données clé / valeur intégrée pour Go. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">badgerdb</a> DB clé-valeur rapide dans Go </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">slowpoke Stockage de</a> clé / valeur de bas niveau en pure Go (basé sur le pudge) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pudge Stockage de</a> clés / valeurs simple et rapide écrit à l'aide de la bibliothèque standard de Go </li></ul><br>  Ils m'ont demandé de comparer avec memcache et redis, mais comme la majeure partie du temps est consacrée aux interfaces réseau lors de l'interaction avec les données de base de données, ce n'est pas tout à fait juste.  Bien que, d'un autre côté, le puja gagne en raison du multithreading, même s'il écrit des données sur le disque. <br><br>  <b>Développement ultérieur</b> <br><br><ul><li>  Les transactions  Il serait pratique de combiner les demandes d'écriture dans le pool, avec une restauration automatique en cas d'erreur. </li><li>  Possibilité de limiter la durée de vie des clés (comme TTL dans memcache / cassandra, etc.) </li><li>  L'absence d'un serveur.  Il est pratique d'intégrer le puja dans les microservices existants, mais un serveur distinct apparaîtra probablement.  Dans le cadre d'un projet distinct. </li><li>  Version mobile.  Pour une utilisation sur Android, iOS et en tant que plugin pour Flutter. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439216/">https://habr.com/ru/post/fr439216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439202/index.html">Détection d'attaque Web à l'aide de l'encodeur automatique Seq2Seq</a></li>
<li><a href="../fr439204/index.html">Amélioration de l'efficacité de la photosynthèse par modification génétique des plantes</a></li>
<li><a href="../fr439206/index.html">Comment avons-nous résolu le problème de la poursuite des listes de lecture au RecSys Challenge et avons pris la 3e place</a></li>
<li><a href="../fr439208/index.html">Oh, mon code: comment fonctionne MAPS.ME</a></li>
<li><a href="../fr439210/index.html">Java après une éruption volcanique</a></li>
<li><a href="../fr439218/index.html">VK bot sur son genou, ou comment faire plaisir aux gens le 14 février</a></li>
<li><a href="../fr439220/index.html">Grande ville pour les appareils mobiles sur Unity. Expérience en développement et optimisation</a></li>
<li><a href="../fr439222/index.html">Qu'est-ce que la gestion des API?</a></li>
<li><a href="../fr439224/index.html">Encore une fois sur les diagrammes de Voronoi</a></li>
<li><a href="../fr439226/index.html">Scala + MXNet = Microservice avec neurone en prod</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>