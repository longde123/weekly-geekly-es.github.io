<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§öüèø ‚ûó üò∞ Wie ich Karten der Kontinente f√ºr mein Spiel erstellt habe üö∂üèø üèçÔ∏è üö®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Teil 1. SVG- und Koordinatensysteme 
 Bis vor kurzem waren die Kartengr√∂√üen in meinem Spiel " Dragons Abound" fest und etwas nicht deterministisch. Ic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie ich Karten der Kontinente f√ºr mein Spiel erstellt habe</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429620/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png" alt="Bild"></div><br><h2>  Teil 1. SVG- und Koordinatensysteme </h2><br>  Bis vor kurzem waren die Kartengr√∂√üen in meinem Spiel " <i>Dragons Abound"</i> fest und etwas nicht deterministisch.  Ich betrachtete sie als ‚Äûregional‚Äú - nicht als Karten der ganzen Welt, sondern ihrer bedeutenden Teile, wie zum Beispiel der Westk√ºste der USA oder eines Teils Europas.  Ich war ziemlich zufrieden mit dieser Skala, aber ich wollte ein bisschen mit dem Spiel experimentieren, um zu sehen, ob ich Karten der ganzen Welt (oder zumindest einer gr√∂√üeren) erstellen kann.  Aber bevor ich anfange, lassen Sie uns ein wenig √ºber Fantasy-Weltkarten sprechen. <br><br>  Die Welt ist ein gro√üer Raum.  Die meisten Fantasy-Weltkarten √§hneln nicht einmal der tats√§chlichen Gr√∂√üe.  Nehmen wir zum Beispiel Mittelerde, in der die Aktion Herr der Ringe stattfindet: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90f/bc8/9f3/90fbc89f36ab284a974be18c66909558.jpg"></div><br>  Obwohl es den Anschein hat, dass eine riesige Welt darauf gefangen ist, wurde Mittelerde tats√§chlich auf der Grundlage Europas geschaffen. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a0/e6d/d95/7a0e6dd9576841e7ecf87babf2a66b93.webp"></div><br>  Das hei√üt, die reale Karte der ‚ÄûWelt‚Äú f√ºr die Tolkien-Welt wird ungef√§hr 50-mal gr√∂√üer sein als die Karte von Mittelerde (!).  Tats√§chlich spiegeln die meisten Fantasy-Weltkarten, die ich gesehen habe, ein Gebiet von der Gr√∂√üe eines Kontinents wider: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c95/17a/90e/c9517a90ef51440cda257b2300ba591e.png"></div><br>  Dies scheint der gr√∂√üte Bereich zu sein, der im Fantasy-Kartenstil gut visualisiert ist. <br><br>  Das hei√üt, die Aufgabe, echte ‚ÄûWeltkarten‚Äú zu erstellen, ist wahrscheinlich zu ehrgeizig.  Es ist besser, eine Karte des Kontinents (oder eines Teils des Kontinents) zu erstellen.  (Es ist jedoch noch bequemer, die Karte als die Gr√∂√üe der "Welt" zu betrachten.) Welche Gr√∂√üe sollte die Karte haben?  Wenn die aktuellen <i>Dragons Abound-Karten</i> eine ‚Äûsubkontinentale‚Äú Gr√∂√üe haben, k√∂nnen wir davon ausgehen, dass Sie 8-10-mal gr√∂√üere Karten generieren m√ºssen. <br><br>  Bevor ich mit der Erstellung gro√üer Karten fortfahre, muss ich die verschiedenen Koordinatensysteme, die in meinem Spiel verwendet werden, besser verstehen.  Ich habe viele Koordinatensysteme aus dem Quellcode von Martin O'Leary ausgeliehen, und ihre Interaktionen k√∂nnen verwirrend sein, selbst wenn Sie zwei Jahre lang mit ihnen arbeiten.  Normalerweise konnte ich ohne Experimente auskommen, aber es ist offensichtlich, dass ich dies tun muss, um gro√üe Karten zu erstellen. <br><br>  Zun√§chst wird die ‚ÄûWelt‚Äú der Regionalkarte derzeit auf einem Einheitsquadrat generiert.  Jede Regionalkarte hat Koordinaten von (-0,5, -0,5) bis (0,5, 0,5), und der Ursprung (0,0) liegt in der Mitte der Region. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/201/c65/c30/201c65c30244efe1e6cd4bd47e07b901.png"></div><br>  Eine der Kuriosit√§ten hier ist, dass die Y-Achse im Vergleich zu dem, was wir in der Schulgeometrie studiert haben, invertiert ist.  -0,5 befindet sich oben auf der Karte und 0,5 befindet sich unten.  In der Computergrafik wird die Y-Achse h√§ufig umgedreht.  Ich habe geh√∂rt, dass dies durch die Art und Weise erkl√§rt wird, wie die ersten Monitore (Fernseher) einen Scan von oben nach unten durchgef√ºhrt haben, dh die erste Scanlinie war oben, die n√§chste unmittelbar darunter, und so weiter, dh der Index Y der Scanlinien hat sich von Null oben zu einer positiven Zahl ge√§ndert unten.  Wie dem auch sei, im SVG-Format (Scalable Vector Graphics) wird dasselbe Koordinatensystem verwendet, weshalb es auch <i>viele Drachen gibt</i> . <br><br>  Dieses Koordinatensystem ist unabh√§ngig davon, wie die Karte angezeigt wird.  Dies ist nur ein dimensionsloses System zur Schaffung der Welt - die Stadt befindet sich bei (0,12875, -0,223), die Grenze verl√§uft von (0,337, 0,010) nach (0,333, 0,017) und so weiter.  Und obwohl meine aktuellen regionalen Karten auf einen Bereich von 0,5 bis -0,5 beschr√§nkt sind, ist dies nicht die Grenze des Koordinatensystems.  Ich kann eine Welt jenseits dieser Grenzen erschaffen. <br><br>  Das n√§chste Koordinatensystem nennt SVG Viewbox.  Es legt die wahren Koordinaten fest, die zum Zeichnen der Grafiken verwendet werden.  Zum Beispiel setzt <i>Dragons Abound</i> am Anfang das Ansichtsfeld auf die Koordinaten (-500, -500) und hat eine Breite von 1000 und eine H√∂he von 1000: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/509/4f4/e4f/5094f4e4f04889dcc9f389fba59d2b24.png"></div><br>  (Das Bild enth√§lt einen Tippfehler. Der obere Rand der Y-Achse sollte leider -500 sein.) <br><br>  M√∂glicherweise stellen Sie fest, dass in diesem Fall die Transformation zwischen dem ersten und dem zweiten Koordinatensystem nur darin besteht, alle mit 1000 zu multiplizieren.  Um etwas zu zeichnen, findet das Spiel die Koordinaten dieses Objekts, multipliziert sie mit 1000 und zeichnet SVG in diesen Koordinaten. <br><br>  Das hei√üt, ich kann die Koordinaten des Ansichtsfelds verwenden, um eine Linie von (0, 0) bis (250, 250) zu zeichnen.  Tats√§chlich m√∂chte ich jedoch keine Linie von (0, 0) bis (250, 250) auf dem Computerbildschirm ziehen.  Dies w√ºrde bedeuten, dass ich die Koordinaten aller Kartenobjekte √§ndern und neu zeichnen muss, wenn ich die Karte an einer anderen Stelle auf dem Bildschirm anzeigen m√∂chte.  Das w√§re ein gro√üer Job. <br><br>  Um die Koordinaten f√ºr die Anzeige von Grafiken auf dem Bildschirm zu steuern, verf√ºgt SVG √ºber ein drittes Koordinatensystem namens Ansichtsfenster.  Das Ansichtsfenster ist der Teil der Seite, auf dem Grafiken gezeichnet werden sollen (auf der Webseite ist dies das &lt;svg&gt; -Element).  Es hat eine Breite, H√∂he und Lage.  Die Position sind die Koordinaten der oberen linken Ecke des Ansichtsfensters.  Das hei√üt, wenn ich die Karte im Ansichtsfenster mit Koordinaten (30, 100) anzeigen w√ºrde, die eine H√∂he und Breite von 800 haben, w√ºrde das Koordinatensystem des Ansichtsfensters folgenderma√üen aussehen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/746/73e/f51/74673ef51f001d21b7871382c5dc0638.png"></div><br>  In SVG sind das Ansichtsfeld und das Ansichtsfenster des Koordinatensystems miteinander verbunden, und SVG selbst befasst sich mit dem √úbergang zwischen ihnen.  Wir zeichnen einfach in das Viewbox-Koordinatensystem und alles, was gerendert wird, wird an der entsprechenden Position des Ansichtsfensters angezeigt.  (Beim Erstellen eines Ansichtsfelds und eines Ansichtsfensters mit unterschiedlichen Seitenverh√§ltnissen treten einige Probleme auf. Anschlie√üend werden die Objekte je nach Wert des AttributserveAspectRatio entweder abgeschnitten oder gestreckt. Ich empfehle, dies √ºberhaupt nicht zu tun.) <br><br>  Zusammenfassend: Eine Stadt in Weltkoordinaten (0,10, 0,33) wird in Koordinaten (100, 330) gezeichnet und in (110, 764) auf dem Bildschirm angezeigt. <br><br>  Jetzt k√∂nnen Sie verstehen, warum dies verwirrend sein kann! <br><br>  Was passiert, wenn ich jedes dieser Koordinatensysteme √§ndere?  Angenommen, ich werde im ersten Koordinatensystem auf jeder Achse eine Welt zwischen -0,25 und 0,25 erzeugen.  Dann ist die resultierende Welt viermal kleiner als die √ºbliche Welt und f√ºllt nur den mittleren Teil des Ansichtsfensters: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/894/11c/6c2/89411c6c2b1975f8512548a487191648.png"></div><br>  (Sie k√∂nnen auch Artefakte an den R√§ndern bemerken, die normalerweise ausgeblendet sind.) Wenn ich die Gr√∂√üe des ersten Koordinatensystems (SK) verdopple, wird der gr√∂√üte Teil der Karte nicht angezeigt, da sie sich au√üerhalb der R√§nder des Ansichtsfensters befindet. <br><br>  Was passiert, wenn ich die Gr√∂√üe der Viewbox verdopple?  Wenn ich auch das Verh√§ltnis zwischen dem ersten SC und der Viewbox verdopple (von 1000 auf 2000), √§ndert sich nicht viel.  Wenn das Verh√§ltnis gleich 1000 bleibt, wird die Karte erneut halbiert. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/859/f79/dfe/859f79dfe453741087cedce2d6918e16.png"></div><br>  Diesmal hat die Karte jedoch eine Anfangsfl√§che von 1x1.  Wir k√∂nnen wieder Artefakte an den R√§ndern bemerken, die normalerweise verborgen sind (zum Beispiel konvexe Teile von W√§ldern).  Sie k√∂nnen auch sehen, dass das Ozeanmuster falsch ist - ich muss einige Annahmen √ºber die Gr√∂√üe der Ansichtsbox fest verdrahtet haben.  Au√üerdem scheint sich der Kompass nicht an der Ecke der Karte zu befinden, sondern an der Ecke der Ansichtsbox. <br><br>  Und umgekehrt, wenn ich die Gr√∂√üe des Ansichtsfelds um die H√§lfte reduziere, wird ein Kartenzoom-Effekt erzeugt: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26e/f0e/f8e/26ef0ef8e0a2db5298de4720d12193fe.png"></div><br>  Hier sehen wir nur das mittlere Viertel der Karte.  Dies ist keine sehr bequeme Methode zum Zoomen, da nur die H√§lfte der Karte einige Probleme aufweist - beispielsweise ging die Stadtmarkierung ‚ÄûSouth Owenson‚Äú √ºber den Bildschirm hinaus.  Au√üerdem verdoppelt es die Gr√∂√üe der Schriftarten und anderer Dinge, die ich nicht ben√∂tige. <br><br>  Ein n√ºtzlicherer Aspekt des Ansichtsfelds ist das √Ñndern des Ursprungs.  Bisher wurde das Ansichtsfeld auf der Karte zentriert, dies ist jedoch nicht erforderlich.  Zum Beispiel kann ich die Karte nach rechts verschieben, indem ich das Ansichtsfeld auf einen Punkt auf der linken Seite der Karte zentriere: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/970/bbf/662/970bbf662eb73852a4140af450c48fb8.png"></div><br>  Wir k√∂nnen wieder die Auswirkungen auf die Grenzen und einige andere Probleme bemerken, aber im Wesentlichen hat sich die Karte nach rechts verschoben.  Die N√ºtzlichkeit davon mag nicht offensichtlich sein, aber stellen Sie sich vor, ich werde eine Karte erzeugen, deren Breite doppelt so breit ist wie die einer regul√§ren Karte.  Standardm√§√üig sieht es so aus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/fee/3ad/327fee3add9790b0a73a32d7e1ee04cf.png"></div><br>  Es sieht aus wie jede andere Karte, ist aber in Wirklichkeit nur der zentrale Teil einer gr√∂√üeren Karte.  Das hei√üt, jetzt kann ich das Ansichtsfeld √§ndern, um andere Teile der Karte in das √úbersichtsfenster zu √ºbertragen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png"></div><br>  Hier habe ich den Blickwinkel nach links verschoben, sodass wir einen Teil der Welt √∂stlich der urspr√ºnglichen Ansicht sehen.  Einige Namen auf der Karte haben sich ge√§ndert, da <i>Dragons Abound</i> bestimmte Funktionen ausf√ºhrt (z. B. Objekte benennt), je nachdem, ob sie sichtbar sind.  Ich muss dies √§ndern, damit die Karte beim Verschieben der Ansichtsbox konstant bleibt.  Sp√§ter kann ich jedoch das Ansichtsfeld auf einer gro√üen Karte verschieben und regionale Karten f√ºr jedes gew√ºnschte Gebiet erstellen.  Das hei√üt, ich kann gro√üe Karten von der Gr√∂√üe eines Kontinents erstellen und anzeigen, aber ich kann auch regionale Karten von Gebieten innerhalb einer gro√üen Karte erstellen. <br><br>  Zusammenfassend: Das Spiel verwendet drei Koordinatensysteme.  Der erste ist ein abstrakter SC f√ºr Weltobjekte.  Das zweite ist das Ansichtsfeld, es definiert den sichtbaren Bereich der Welt.  Das dritte ist das Ansichtsfenster, das steuert, wo die Karte auf dem Bildschirm gezeichnet wird.  Um eine gr√∂√üere Welt zu zeichnen, muss ich den ersten SC erweitern.  Um mehr auf dem Bildschirm anzuzeigen, m√ºssen Sie das Ansichtsfeld erweitern.  Ich kann auch die Ansichtsbox verschieben, um verschiedene Teile der gro√üen Welt anzuzeigen. <br><br><h2>  Teil 2. Karten dauerhaft machen </h2><br>  Im vorherigen Teil habe ich Koordinatensysteme untersucht und gelernt, wie das SVG des Ansichtsfensters so verschoben wird, dass nur einzelne Teile der gro√üen Welt angezeigt werden.  Dieser Ansatz hat jedoch einige Probleme, da ich fr√ºher angenommen habe, dass alles, was f√ºr uns unsichtbar ist, keine Rolle spielt.  In diesem Teil werde ich diese Annahmen beseitigen, damit es m√∂glich ist, verschiedene Teile unver√§nderlicher gro√üer Karten zu generieren und anzuzeigen. <br><br>  Das Problem mit der Platzierung von Namen, das ich im vorherigen Teil beschrieben habe, ist offensichtlich bei diesen beiden Arten einer Karte erkennbar: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/fee/3ad/327fee3add9790b0a73a32d7e1ee04cf.png"></div><br>  Hier ist die gleiche Welt, nur der Blick ist nach links verschoben: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/327/2a8/d08/3272a8d0885e3e2f041a6f2bdb7400c9.png"></div><br>  M√∂glicherweise stellen Sie fest, dass die Geografie identisch ist, aber viele Namen haben sich ge√§ndert.  Da in zwei Typen unterschiedliche Objekte sichtbar sind und der Prozess des Erstellens von Namen durch Zufallszahlen gesteuert wird, werden unterschiedliche Namen erhalten. <br><br>  Beim Betrachten des Codes stellte ich fest, dass fast alle Objekte abh√§ngig von ihrer Sichtbarkeit Namen erhalten.  Es gibt jedoch nur eine Ausnahme, die es schwierig macht, allen nachfolgenden Objekten Namen zu geben.  In unserem Fall ist die Ausnahme, dass <i>Dragons Abound</i> nur sichtbare K√ºsten erzeugt.  Die Gr√ºnde daf√ºr sind sehr verwirrend.  Tats√§chlich gibt es eine ‚ÄûK√ºste‚Äú entlang des gesamten Randes der Welt, aber die Schaffung dieser Linie zerst√∂rt einen Teil der Programmlogik, weil sie die ganze Welt umfasst.  Um dies zu vermeiden, habe ich nur die sichtbare K√ºste generiert.  Da die Karte jetzt weit √ºber das Ansichtsfenster hinaus erweitert werden kann, sieht diese L√∂sung nicht mehr gut aus.  Stattdessen muss ich aufh√∂ren, K√ºstenlinien zu generieren, wenn ich mich dem tats√§chlichen Rand der Karte n√§here.  (Was ich immer noch au√üerhalb des Bildschirms lasse, um Probleme an den R√§ndern zu verbergen.) <br><br>  Nachdem dieses Problem behoben wurde, bleiben die Namen auf den beiden Karten konstant: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39b/908/a83/39b908a83146f3161397cda6fbcba045.png"></div><br>  und: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6af/322/ad4/6af322ad4cb57591a51748243a8ac02e.png"></div><br>  Ein weiterer Hinweis f√ºr die Zukunft: Wenn ich die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Interaktivit√§tsfunktion verwende</a> , um die Namen von Kartenobjekten zu √§ndern, wird diese √Ñnderung nicht in ihrer aktuellen Form neu erstellt und ist wahrscheinlich nicht einmal reproduzierbar.  Es lohnt sich, dar√ºber nachzudenken. <br><br>  Wenn Sie sich die vorherige Karte genau ansehen, k√∂nnen Sie sehen, dass das Meeresgebiet in der N√§he des unteren mittleren Teils der Karte mit einem h√§ngenden Etikett ‚ÄûMeb Island‚Äú versehen ist.  Es geschah, weil <i>Dragons Abound</i> tats√§chlich glaubt, dass die Region des Ozeans eine Insel ist.  Ich werde nicht auf technische Details eingehen, aber es ist √ºberraschend schwierig, Inseln von Seen zu unterscheiden, wenn sie √ºber die Karte hinausgehen.  Der Algorithmus ist verwirrend f√ºr die √Ñnderung, die ich an der Erzeugung unsichtbarer K√ºsten vorgenommen habe, und um solche Probleme zu vermeiden, muss dies behoben werden. <br><br>  Vervierfachen wir nun die Gr√∂√üe der Karte und zeigen nur ein Viertel davon im Kartenfenster an: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f40/81f/8d4/f4081f8d4d2ac9dd3d7d35077ba23450.png"></div><br>  Im Allgemeinen sieht alles gut aus (es gibt ein interessantes Flusssystem auf der Karte, einen gro√üen See, aber Sie k√∂nnen sehen, dass St√§dte sehr selten sind. Dies geschah, weil <i>Dragons Abound</i> 10 bis 20 St√§dte erzeugt. Dieses Intervall ist gut geeignet f√ºr eine normal gro√üe Welt, aber schlecht. Wenn die Gr√∂√üe viermal gr√∂√üer ist, muss das Intervall entsprechend der relativen Gr√∂√üe der Welt ge√§ndert werden. Wahrscheinlich muss es an mehreren Stellen durchgef√ºhrt werden. <br><br>  Hier ist dieselbe Karte, nachdem das Problem behoben wurde: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/821/113/b40/821113b400ab683c8fdfad87bccf3213.png"></div><br>  Jetzt gibt es auf der Karte eine logischere Anzahl von St√§dten, aber dies zeigt uns ein anderes Problem.  Sie k√∂nnen viele zus√§tzliche Namen an den R√§ndern der Karte sehen, zum Beispiel Nanmrummombrook, Marwynnley und Noyewood in der unteren linken Ecke.  Dies geschieht, weil die Platzierungscodemethode versucht, sie dort zu platzieren, wo sie sichtbar sind.  Bisher musste sich dieses Verfahren nie um Beschriftungen au√üerhalb des Bildschirms k√ºmmern, da in Karten mit regionaler Gr√∂√üe normalerweise die ganze Welt sichtbar ist.  Aber jetzt befinden sich m√∂glicherweise St√§dte und andere Objekte au√üerhalb des Bildschirms.  Daher muss ich der Beschriftungsplatzierungsprozedur Logik hinzuf√ºgen, die nicht versucht, Beschriftungen f√ºr unsichtbare Kartenobjekte zu erstellen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b9d/022/b5a/b9d022b5a3c22d9f7e1f4c5e7c24771e.png"></div><br>  Jetzt ist das Bild logischer.  Auf der rechten Seite ist Cumden auf der Karte kaum sichtbar, aber das Etikett befindet sich immer noch dort, wo es sichtbar ist. <br><br>  Es gibt einen Aspekt, der auf gro√üen Karten nicht sofort erkennbar ist: Die Anzahl der Standorte auf der Welt hat sich nicht ge√§ndert.  Obwohl die Karte (gewisserma√üen) viermal gr√∂√üer geworden ist, ist ihre Gesamtfl√§che immer noch durch die gleiche Anzahl von Orten begrenzt.  Die erste Phase der Kartenerstellung bestand darin, die Welt mit einem Voronoi-Diagramm mit einer konstanten Anzahl von Standorten abzudecken.  Das hei√üt, wenn die Karte gr√∂√üer wird, werden auch Voronois Zellen gr√∂√üer. <br><br>  Es w√§re logisch, die Anzahl der Orte entsprechend der Gr√∂√üe der Karte zu skalieren, aber leider ist die Abh√§ngigkeit der Ausf√ºhrungsgeschwindigkeit von <i>Dragons Abound</i> von der Anzahl der Orte viel schlimmer als linear, <i>dh</i> das <i>Erstellen</i> einer Karte mit einer gro√üen Anzahl von Orten kann viel Zeit in Anspruch nehmen.  Hier ist ein Beispiel f√ºr eine Karte mit vierfacher Aufl√∂sung (Anzahl der Standorte): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4bc/faa/7a6/4bcfaa7a64abf56cb1cf4aab84651215.png"></div><br>  Hinzugef√ºgte Standorte √§ndern den Generierungsprozess, sodass sich das Gel√§nde von den oben gezeigten Karten unterscheidet. Darauf sehen Sie jedoch die hinzugef√ºgten Details an den K√ºsten. <br><br>  Gl√ºcklicherweise habe ich bei der Profilerstellung der Leistung beim Generieren gro√üer Karten festgestellt, dass der gr√∂√üte Teil der Prozessorzeit von offensichtlichen Problemen beansprucht wird.  Nach dem Debuggen habe ich die st√∂rendsten beseitigt, wodurch ich noch mehr Karten erstellen konnte.  Hier ist die ganze 4x Karte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/149/6f4/600/1496f4600dc18c1ffa955580e07d7161.png"></div><br>  25% Zoom durchgef√ºhrt.  Es sieht ungef√§hr nach der maximalen Kartengr√∂√üe aus, die Chrome anzeigen kann.  Das World Generation-Verfahren kann gr√∂√üere Karten verarbeiten, aber beim Versuch, sie anzuzeigen, st√ºrzt der Browser ab.  In diesem Sinne scheint Firefox funktionaler zu sein.  Es k√∂nnen Karten angezeigt werden, die 9-mal gr√∂√üer als die Originalgr√∂√üe sind.  Hier ist ein Teil einer solchen Karte - ich habe sie in voller Gr√∂√üe belassen, sodass Sie sie in einem separaten Fenster √∂ffnen k√∂nnen, um die Gr√∂√üe und die Details besser zu verstehen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/1a2/c98/15f1a2c98b85e749101f0a379e7b9937.png"></div><br>  Firefox kann Karten dieser Gr√∂√üe generieren, aber ich kann nur Screenshots mit der maximalen Gr√∂√üe des Browserfensters machen.  Ich habe eine Funktion zum Speichern der Karte als PNG-Datei, aber sie kann nur den angezeigten Teil der Karte speichern.  Ich denke, Sie k√∂nnen die Karte scrollen, einzelne Bildschirme erfassen und miteinander verbinden, aber es wird zeitaufw√§ndig sein. <br><br>  Die beste L√∂sung besteht darin, das SVG selbst zu speichern, damit es in einem Programm wie Inkscape ge√∂ffnet werden kann. <br><br>  Fr√ºher konnte ich SVG-Karten ausschneiden und in Inkscape einf√ºgen, aber SVGs f√ºr Weltkarten sind so gro√ü, dass der Browser beim Ausschneiden abst√ºrzt!  Gl√ºcklicherweise habe ich <a href="">FileSaver.js</a> gefunden und Sie k√∂nnen es verwenden, um das SVG direkt in einer Datei zu speichern und es dann in Inkscape zu √∂ffnen, wodurch ein sehr gro√ües Bild erstellt wird. <br><br>  Zumindest theoretisch.  Wenn ich versuche, diese Karten in Inkscape zu √∂ffnen, treten einige Probleme auf. <br><br>  Das erste Problem besteht darin, dass sich die Inkscape-Annahmen beim √ñffnen von SVG von den Annahmen von Chrome und Firefox unterscheiden.  Insbesondere wenn die F√ºllfarbe im Pfad nicht angegeben ist, gehen die Browser davon aus, dass keine F√ºllung vorhanden ist.  Inkscape geht davon aus, dass der Umriss mit Schwarz gef√ºllt ist.  Wenn ich das gespeicherte SVG in Inkscape √∂ffne, ist es daher fast vollst√§ndig schwarz, da die oberste Ebene der Karte keine F√ºllfarbe enth√§lt.  Dies kann behoben werden, indem an den erforderlichen Stellen "fill: none" angegeben wird, sodass die Umrisse sowohl im Browser als auch in Inkscape gleicherma√üen angezeigt werden. <br><br>  Das zweite Problem ist, dass Inkscape Fehler bei der Verarbeitung von Masken aufweist.  Inkscape scheint Masken mit nur einem Element zu erstellen und behandelt Masken mit mehreren Elementen schlecht.  <i>Dragons Abound</i> erstellt viele Masken mit mehreren Elementen.  Sie k√∂nnen dieses Problem umgehen, indem Sie alle Elemente jeder Spielmaske in einem (optionalen) Gruppenelement gruppieren. <br><br>  Das dritte Problem betrifft Bilder und andere herunterladbare Ressourcen.  In der urspr√ºnglichen SVG werden Verweise auf sie in relativer Form angegeben, z. B. "images / background0.png".  Meine Quellen sind so angeordnet, dass der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">separate Webserver, den ich verwende</a> , diese Ressourcen an den angegebenen Stellen finden kann.  Wenn ich dieselbe SVG-Datei in Inkscape √∂ffne, werden diese relativen Pfade als URL ‚Äûfile:‚Äú behandelt, und Inkscape sucht nach Ressourcen in Bezug auf den Ordner, in dem die SVG gespeichert wurde.  Dieses Problem kann leicht umgangen werden, indem die SVG-Datei in einem Ordner gespeichert wird, in dem sich bereits Ressourcen an den richtigen Stellen befinden.  Dies kann derselbe Stammordner sein, der vom Webserver verwendet wird, oder ein anderer Ort, an dem sich Kopien von Ressourcen auf denselben (relativen) Pfaden befinden. <br><br>  Das vierte Problem sind Schriftarten.  <i>Dragons Abound</i> verwendet sowohl Web-Schriftarten als auch lokal gespeicherte Schriftarten.  beide im WOFF2-Format.  Im Browser werden sie im Stil der CSS-Schriftfamilie auf den Text angewendet. Vor dem Generieren der Karte werden alle m√∂glichen Schriftarten auf die Webseite hochgeladen, um sie zur Verwendung bereit zu halten.  Wenn dieselbe Datei im Spiel ge√∂ffnet wird, sucht sie im System-Schriftartenverzeichnis nach Schriftarten, und es sieht so aus, als ob in keiner Weise ein anderes Schriftartenverzeichnis angegeben werden kann.  Eine einfache L√∂sung (zumindest auf dem Computer, auf dem ich entwickle) besteht darin, die vom Spiel verwendeten Schriftarten im Systemschriftartenverzeichnis zu installieren.  Es ist jedoch nicht so einfach, wie es scheint, da die Schriftnamen √ºbereinstimmen m√ºssen und es unter Windows keine einfachen M√∂glichkeiten gibt, den Schriftnamen zu √§ndern.  Ein solches Schema funktioniert jedoch nat√ºrlich nicht auf Computern, auf denen nicht alle erforderlichen Schriftarten installiert sind.  Eine tragbarere L√∂sung besteht darin, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SVG-Schriftarten in Karten einzubetten</a> .  Dies wird auf meiner TODO-Liste stehen. <br><br>  Am Ende kam ich zu dieser Kartengenerierungsoberfl√§che: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/e69/c3b/88ee69c3b069b7c369cbf3921b6a3eba.png"></div><br>  Umfangs-Eingabefelder geben die Gesamtgr√∂√üe der Welt an, wobei 1x1 die Gr√∂√üe der Quellkarten ist.  Die Gr√∂√üe von vbx (Ansichtsfeld) bestimmt die Gr√∂√üe eines auf der Karte angezeigten Weltfragments.  Im Screenshot hat es auch einen Wert von 1x1, dh die Karte zeigt die ganze Welt an.  Die Felder f√ºr das vbx-Zentrum geben den Standort des Kartenzentrums in der Welt an.  0, 0 ist das Zentrum der Welt.  Schlie√ülich geben SVG-Parameter die Anzahl der Bildschirmpixel pro 1 Viewbox-Gr√∂√üeneinheit an.  Bei einem Wert von 775 wird eine 1x1-Karte mit einer Gr√∂√üe von 775x775 Pixel auf dem Bildschirm angezeigt.  Dies ist praktisch, wenn ich eine sehr gro√üe Karte erstelle.  Durch Einstellen des Parameters auf einen niedrigen Wert (z. B. 150 Pixel) kann ich eine gro√üe Karte auf dem gesamten Bildschirm anpassen. <br><br>  Durch √Ñndern dieser sechs Parameter kann ich die Gr√∂√üe der Welt und den Bruchteil der Welt steuern, der auf der Karte angezeigt wird.  Die Schaltfl√§che "Generieren" funktioniert genau so, wie Sie es sich vorstellen k√∂nnen.  Die Schaltfl√§che Anzeigen zeigt einfach einen Teil der Welt an, dh ich kann eine Welt generieren und dann ihre einzelnen Teile anzeigen, wobei die Viewbox-Parameter ge√§ndert werden, ohne dass die Welt neu generiert werden muss.  (Ein Programmierer implementiert dies besser als Skalieren und Scrollen.) Mit der Schaltfl√§che PNG speichern wird die sichtbare Karte als PNG-Datei gespeichert.  Die Schaltfl√§che SVG speichern speichert die SVG-Datei der gesamten Karte.  Mit der Schaltfl√§che Test It wird Testcode ausgef√ºhrt, der sich w√§hrend der Entwicklung verschiedener Funktionen √§ndert. <br><br>  Jetzt, da ich alle Teile der gro√üen Welt erzeugen und reflektieren kann, kann ich die Form des Landes an gr√∂√üere Karten anpassen. <br><br><h2>  Teil 3. Sushi-Formen </h2><br>  Nachdem ich im vorherigen Teil verschiedene √Ñnderungen vorgenommen habe, kann ich jetzt Welten generieren, die viel gr√∂√üer sind als die vorherigen (bis zu 8-mal mehr) und sie als gro√üe grafische Bilder speichern: <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/963/31e/c94/96331ec940b59a6f349603f0024f5cc7.png"></a> </div><br>  (√ñffnen Sie das Bild in einem separaten Fenster, um die Karte in voller Aufl√∂sung 4800 x 2400 in Flickr anzuzeigen.) <br><br>  Ich generiere diese Karten mit derselben prozeduralen Generation, mit der die regionalen Karten erstellt wurden.  Die oben gezeigte Karte hat eine ziemlich regelm√§√üige kontinentale Form und einige interessante √§u√üere Inseln.  Es kommt jedoch haupts√§chlich auf das Gl√ºck an.  Hier ist eine andere Karte: <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/b03/406/fd1/b03406fd17f93c9e33cd8dd488b404c3.png"></a> </div><br>  Diese Karte ist nur Chaos von den Inseln und Schweizer Sushi-K√§se. <br><br>  Hier ist ein weiteres Beispiel, etwas zwischen den beiden vorherigen Karten.  Es ist nicht ganz realistisch, aber es kann f√ºr Fantasy-Umgebungen interessant sein: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/7c3/c79/e98/7c3c79e98246dde23f7104428e9cf9b2.jpg"></a> </div><br>  Dies ist eine riesige kontinentale Landmasse, aber es gibt ziemlich viele seltsame Landformen, und im Allgemeinen sieht die Welt nicht ganz ‚Äûreal‚Äú aus.  (Obwohl f√ºr jemanden eine solche Welt f√ºr die Fantasie durchaus geeignet erscheint.) Welche Formen sollte die Karte der ‚ÄûWelt‚Äú haben? <br><br>  Die meisten der Fantasy-Weltkarten, die ich gesehen habe, repr√§sentieren beispielsweise einen gro√üen Inselkontinent (mit kleinen Inseln), wie diese Karte von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Andelen</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/926/3f4/fb8/9263f4fb80cf2899f48693c31aa2566a.png"></div><br>  Oder die Halbinsel des Kontinents, wie auf dieser Karte von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Angorun</a> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75c/ef4/bc1/75cef4bc1d0e698c2a76ee77bfc74bd0.png"></div><br>  Von Zeit zu Zeit besteht eine Karte ausschlie√ülich aus Land oder mehreren Inselkontinenten, es ist jedoch wahrscheinlicher, dass sie Ausnahmen von der Regel darstellen. <br><br>  Lassen Sie uns zun√§chst die Generation der Inselkontinente herausfinden.  Wie sich in meinem Spiel herausstellt, gab es bereits eine Funktion, die unter Ber√ºcksichtigung der Gr√∂√üe der Karte eine gro√üe zentrale Insel auf der Karte generiert. Daher sollte sie f√ºr die Generierung der Hauptform des Kontinents geeignet sein.  L√§rm und zus√§tzliche Inseln k√ºmmern sich um den Rest. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0a7/86e/0b5/0a786e0b59241b451f3c225c23328a47.png"></div><br>  Ich habe auf dieser Karte kein gro√ües zentrales Meer erwartet, aber es ist eine angenehme √úberraschung.  Hier ist ein weiteres Beispiel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f58/a14/788/f58a14788a7dbcd6fbaa25c9fb45457e.png"></div><br>  Das Problem mit der Funktion der Zentralinsel ist, dass sie mit einem Kreis beginnt, der f√ºr die von mir gezeigten quadratischen Karten geeignet ist, f√ºr rechteckige jedoch nicht sehr gut.  (Nachfolgend finden Sie Beispiele mit geringer Verzerrung, damit die Grundformen besser sichtbar sind.) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/30b/b43/073/30bb430737122e671fb2f2067fafea08.png"></div><br>  Dies kann leicht korrigiert werden, indem Sushi anstelle eines Kreises mit einer Ellipse (verzerrt) maskiert wird, die entsprechend der Gr√∂√üe der Karte erstellt wird: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/393/7a9/2ea/3937a92ea08cd752739550bf59a89971.png"></div><br>  Diese zentralen Inseln sind skaliert, um die Karte zu f√ºllen, aber in vielen F√§llen m√ºssen wir f√ºr Kontinentalkarten eine ‚ÄûGrenze‚Äú um den Kontinent herum lassen.  Zwei Parameter steuern die Gr√∂√üe der Karte, die die Insel entlang der X- und Y-Achse f√ºllt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad4/b00/94e/ad4b0094e542930350a964377888a640.png"></div><br>  Hier ist das gleiche Grenzmanagementsystem mit logischeren Verzerrungen: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/357/9e1/121/3579e11217c879a587f11b30380e94b9.png"></a> </div><br>  Es ist zu sehen, dass der √∂stliche und der westliche Teil der Karte der Ozean bleiben.  (Sie k√∂nnen die Karte in einem separaten Fenster √∂ffnen, um sie genauer zu studieren.) Dies bedeutet, dass die Karte die gesamte Welt (und ihre rechten und linken R√§nder k√∂nnen verbunden werden) oder einen Teil der Welt anzeigt, der mit einer anderen Karte verbunden werden kann, die auch einen Ozean vom entsprechenden Rand hat. <br><br>  Ein aufmerksamer Leser, der die vorherige Karte studiert hat, hat m√∂glicherweise bemerkt, dass die Muster des Ozeans und des Landes in der Mitte der Karte anhalten.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuvor hatte ich Karten mit einer Gr√∂√üe von nur 1x1, daher wurden die Gr√∂√üen der Muster des Ozeans und des Landes an diese Karten angepasst. Bei gr√∂√üeren Karten muss ich Muster auf der Karte manuell kacheln, daher habe ich diese Funktion hinzugef√ºgt. (In SVG gibt es eine M√∂glichkeit, Musterkacheln durchzuf√ºhren. In Chrome enth√§lt es jedoch einen Fehler, sodass ich ihn nicht verwenden kann.) Dies ist eine gute Funktion, da ich jetzt kleinere Land- und Ozeanmuster verwenden kann, die automatisch gekachelt werden. Ich wei√ü nicht, warum ich es vorher nicht bemerkt habe! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt funktionieren die Inselkontinente einwandfrei, und wir werden mit der Implementierung der ‚ÄûHalbinsel‚Äú -Kontinente fortfahren - Karten, auf denen der Kontinent von seinem Rand auf der Karte erscheint.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9e/d75/914/d9ed75914bd6b4deaae08fb687b828e2.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Fall kann der Kontinent nicht an drei Kanten zusammenbrechen. </font><font style="vertical-align: inherit;">Das Hauptmerkmal solcher Karten ist jedoch, dass sie eine signifikante Landverbindung zwischen dem auf der Karte angezeigten Kontinent und dem Land au√üerhalb der Karte aufweisen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der einfachste Weg, eine solche Verbindung au√üerhalb der Karte herzustellen, besteht darin, w√§hrend der Erzeugung einen niedrigen Meeresspiegel einzustellen. </font><font style="vertical-align: inherit;">Wir werden also die auf der Karte angezeigte Landfl√§che vergr√∂√üern, was die Wahrscheinlichkeit gro√üer Landmassen und das Auftreten von Land (anstelle des Meeres) entlang der Kartenr√§nder erh√∂ht.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/24d/adb/522/24dadb52258988326f096336470d97c3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dies garantiert nat√ºrlich nicht, dass die Landmasse sehr interessant sein wird, und tats√§chlich wird sie vereinheitlicht: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0b/c22/335/c0bc223356225dea02bfbd773495f36e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die √Ñhnlichkeit eines einzelnen Kontinents kann mit derselben Generation des Inselkontinents erzeugt werden, w√§hrend gleichzeitig die Insel an den Rand der Karte verschoben wird. </font><font style="vertical-align: inherit;">Sie bekommen so etwas:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/209/981/20e/20998120e01c4c48f53419855cf6f703.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist zu sehen, dass der Kontinent (haupts√§chlich) die zentrale Insel ist, die nach oben und rechts verschoben ist. </font><font style="vertical-align: inherit;">Da dies ein Kontinent ist und keine strenge Inselform beibehalten werden muss, k√∂nnen Sie der Form mehr Verzerrungen hinzuf√ºgen.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e5f/000/523/e5f00052339289e504ffcd82b7481545.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nat√ºrlich gibt es viele andere Ans√§tze zur Erzeugung von Erleichterungen, aber diese beiden geben mir zumindest die M√∂glichkeit, die h√§ufigsten Landformen auf kontinentaler Ebene zu erzeugen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein aufmerksamer Leser konnte die seltsamen Formen von W√§ldern in Form von Streifen auf vielen Karten der Kontinente bemerken. </font><font style="vertical-align: inherit;">Das n√§chste Mal werde ich mich mit den Problemen von Windmodellen und Biomen befassen, die diese Kuriosit√§ten verursachen.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Teil 4. Windmodell </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie gesagt, die Gr√∂√üe der Kontinente auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Karten </font><font style="vertical-align: inherit;">zeigte unrealistische Wetter- und Biomuster. Dieses Beispiel zeigt, dass der Wald entlang der vorherrschenden Windrichtung ausgerichtet ist:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/209/981/20e/20998120e01c4c48f53419855cf6f703.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Grund liegt nicht im fehlerhaften Code. Vielmehr sind die Wetter- und Biomodelle zu einfach, und im gro√üen Ma√üstab wird dies deutlich. Um diese Probleme zu l√∂sen, habe ich zun√§chst das Windmodell √ºberarbeitet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich m√∂chte, dass mein Windmodell die Dynamik des Erdwinds besser widerspiegelt: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hadley-Zellen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passatwinde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und dergleichen. Eine solche Dynamik kann dazu beitragen, seltsame Wettermuster auf Kontinentalkarten zu beseitigen. Als sie jedoch hinzugef√ºgt wurden, zeigte sich erneut eine schmerzhafte Unzufriedenheit mit dem </font><font style="vertical-align: inherit;">langsamen und zu komplizierten </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windmodell Dragons Abound</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . (Lesen Sie hier √ºber die erste Implementierung des Windmodells </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.) Nachdem ich einige Tage dar√ºber nachgedacht hatte, entschied ich, dass die meisten Probleme darauf zur√ºckzuf√ºhren sind, dass die Spielkarte als </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voronoi-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Diagramm dargestellt wird </font><font style="vertical-align: inherit;">. (Oder besser gesagt, die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Delaunay-Triangulation des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voronoi-Diagramms.) Es hat viele Vorteile bei der Erzeugung von Gel√§nde - in Kombination mit L√§rm kann es nat√ºrlich aussehende Landmassen erzeugen. Deshalb wird es so oft verwendet, um Erleichterung zu erzeugen. Da einzelne Dreiecke jedoch unterschiedliche Gr√∂√üen und Ausrichtungen haben, werden alle Berechnungen, einschlie√ülich Windmodelle, die benachbarte Nachbarzellen verwenden, ziemlich kompliziert. Es wird viel einfacher sein, den Wind durch ein Gitter gleichm√§√üig verteilter identischer Bereiche zu modellieren. Au√üerdem muss das Windmodell h√∂chstwahrscheinlich nicht so detailliert sein wie Land.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber ich m√∂chte das Voronoi-Diagramm, das dem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zugrunde liegt, nicht ganz aufgeben </font><font style="vertical-align: inherit;">. (Zumindest muss daf√ºr fast das gesamte Programm neu geschrieben werden!) Stattdessen m√∂chte ich mit dem Binden der Karte an ein einheitliches Raster experimentieren, das Windmodell darin ausf√ºhren und dann die umgekehrte Bindung durchf√ºhren. Wenn der Verlust beim Hin- und Herkopieren nicht zu gro√ü ist, kann dies das Windmodell schneller und einfacher machen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Welches Gitter soll ich verwenden? Idealerweise sollte das Gitter aus gleichen Fl√§chen bestehen, die gleich weit von seinen Nachbarn entfernt sind. Und diese Beschreibung ist wie ein Sechseckgitter.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/720/948/12a/72094812ad2adea8d6d71fa795146c44.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tats√§chlich ist ein Sechseckgitter der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beste Weg</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , eine flache Oberfl√§che in gleiche Bereiche zu unterteilen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der n√§chste Schritt besteht darin, zu bestimmen, wie das Sechseckgitter in meinem Programm dargestellt werden soll. Ich suchte ein wenig im Netzwerk nach Hilfe und jeder Link brachte mich auf die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seite √ºber die Gitter der Sechsecke von</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Amit Patel zur√ºck ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úbersetzung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Habr√©). Wahrscheinlich ist es notwendig, damit zu beginnen; Es ist auch gut, zuerst die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Red Blob Games-Website</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu erkunden, </font><font style="vertical-align: inherit;">wenn Sie Informationen zur Implementierung der Spielmechanik suchen. Amit erkl√§rt es besser als ich. Wenn also etwas nicht klar ist, dann lies seine Seite.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die erste Wahl ist die Art und Weise, wie das Sechseckgitter gespeichert wird. </font><font style="vertical-align: inherit;">Der einfachste Weg ist, es als zweidimensionales Array zu speichern, dann brauche ich die F√§higkeit, Gitterzellen an das Array zu binden. </font><font style="vertical-align: inherit;">Hier gibt es viele Optionen (lesen Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amits Seite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), aber ich werde das verwenden, was er ungerade-r nennt:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e9c/a08/6bb/e9ca086bb2e5957db58d021c302c27f4.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Zahlen in jeder Zelle sind die Indizes der Zelle im zweidimensionalen Array. </font><font style="vertical-align: inherit;">(Das Bild wurde von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amits Seite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gestohlen </font><font style="vertical-align: inherit;">. Auf seiner Seite sind sie interaktiv, daher rate ich Ihnen, mit ihnen zu experimentieren.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem ich eine Auswahl getroffen habe, muss ich nun lernen, wie man Indizes an ein Sechseckraster anf√ºgt. </font><font style="vertical-align: inherit;">Wenn ich zum Beispiel nach einer sechseckigen Zelle (3, 3) suche, welche Nachbarn werden sie dann sein? </font><font style="vertical-align: inherit;">Wenn jede Zelle eine Breite von 5 Pixeln hat, wie lauten dann die Koordinaten der Mitte der Zelle (3, 3)?</font></font> Usw.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Umgang damit kann schwierig sein, deshalb bin ich froh, dass Amit es f√ºr mich getan hat. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Angenommen, wir k√∂nnen Amit alles stehlen, was wir brauchen, muss ich zuerst herausfinden, wie die Sechsecke auf der Karte angeordnet werden. Zu diesem Zeitpunkt brauche ich noch kein Array, ich kann so tun, als w√§re es und sehen, wo die Sechsecke sein werden. Wenn ich die Position der Sechsecke kenne, dividiere ich einfach die Breite der Karte durch den horizontalen Abstand zwischen ihnen, um die Anzahl der Spalten zu erhalten, und mache dasselbe vertikal, um die Anzahl der Zeilen zu erhalten. Danach zeichne ich an jeder Stelle ein Sechseck:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ba/0e2/d39/7ba0e2d39d51e3ea0584734fbb584f19.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Sechsecke sind viel gr√∂√üer als die, die ich f√ºr das Windmodell verwenden werde, aber sie zeigen mir, dass alles richtig platziert ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier habe ich die R√§nder der Karte ge√∂ffnet und nur das zentrale Sechseck und an den R√§ndern gezeichnet, um zu √ºberpr√ºfen, ob ich die gesamte Karte wirklich schlie√üe:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f99/733/2a0/f997332a08696203af9e4cf044cf07cd.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oben und unten befinden sich au√üerhalb der Karte, aber das Vorhandensein mehrerer Zellen im Ausland ist nicht wichtig, wenn ich keinen Teil der Karte verpasse. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der n√§chste Schritt besteht darin, ein Array f√ºr das Sechseckgitter zu erstellen und alle Delaunay-Dreiecke an den entsprechenden Sechsecken auszurichten. Da Javascript keine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">negativen Indizes von Arrays unterst√ºtzt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , muss ich die Zelle (0, 0) von der Mitte der Karte in die obere rechte Ecke verschieben. Nachdem ich dies getan habe, gehe ich um alle Delaunay-Dreiecke herum und f√ºge sie den entsprechenden Zellen des Sechseckgitters hinzu. Ich kann dies √ºberpr√ºfen, indem ich die Sechsecke f√§rbe, die Land enthalten:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/848/f2e/1b7/848f2e1b78edb9dbfb91abdbff1bcf56.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um festzustellen, ob eine Zelle Land ist, mittle ich die H√∂he aller Orte, die in diese Zelle fallen. </font><font style="vertical-align: inherit;">M√∂glicherweise stellen Sie fest, dass bei einigen K√ºstensechsecken der Durchschnitt selbst bei Land unter Null liegt. </font><font style="vertical-align: inherit;">Sie k√∂nnen auch die maximale H√∂he aller Positionen im Sechseck verwenden:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66b/041/254/66b0412544abda9d618ab32784bd9ec8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Fall erfolgt die Suche in die entgegengesetzte Richtung - das Sechseck wird als Land markiert, wenn sich Land darin befindet. </font><font style="vertical-align: inherit;">Was besser ist, h√§ngt davon ab, was Sie brauchen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In jedem Fall kann ich die Genauigkeit erh√∂hen, indem ich die Gr√∂√üe der Sechsecke reduziere:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c3b/0e7/1ec/c3b0e71ecf56429e04ea02a771b3a044.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt ist die K√ºste viel besser geworden, aber es ist ein neues Problem aufgetreten - viele innere Sechsecke, die nicht als Land gelten. Dies geschieht, weil, wenn die Sechsecke klein genug werden, in einigen von ihnen √ºberhaupt keine Delaunay-Dreiecke vorhanden sind. Daher haben sie keine "H√∂he". (Dies zeigt auch die Ungleichm√§√üigkeit der Delaunay-Dreiecke.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie k√∂nnen diese L√∂sung verwenden - nehmen Sie die H√∂he der fehlenden Dreiecke als Durchschnitt ihrer Nachbarn oder als Maximum ihrer Nachbarn.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d51/ad8/30f/d51ad830fd84fa509f8f47c40b730f07.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Bindung zwischen Sechsecken und Positionen nicht eins zu eins ist, sind im Allgemeinen Korrekturen erforderlich, um die fehlenden Informationen auszuf√ºllen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nachdem ich das Sechseckgitter auf die Karte gelegt habe, k√∂nnen wir mit der Implementierung des Windmodells beginnen. Die Hauptidee des Windmodells besteht darin, einige Winde (Passatwinde) zu simulieren und auf der Karte zu verteilen, bis sie einen Zustand der Unbeweglichkeit erreichen. Auf der Ebene der Sechsecke (oder der Ebene der Orte, wenn ich es auf Delaunay-Dreiecken mache) umfasst dies zwei Stufen: (1) Wir fassen alle Winde zusammen, die in das aktuelle Sechseck eintreten, und (2) wir bestimmen, wie der summierte Wind das Sechseck verl√§sst.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die erste Stufe ist recht einfach. </font><font style="vertical-align: inherit;">Jedes Sechseck hat sechs Nachbarn, und jedes dieser Sechsecke tr√§gt dazu bei. </font><font style="vertical-align: inherit;">Wenn wir jeden der Winde, die in das Sechseck eintreten, als einen Vektor betrachten, ist der Gesamtwind in der Zelle die Summe dieser Vektoren, d.h. </font><font style="vertical-align: inherit;">zwei genau entgegengesetzte Winde gleicher St√§rke heben sich gegenseitig auf. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die zweite Stufe (Bestimmen, wie der Gesamtwind das Sechseck verl√§sst) erfordert √úberlegungen. </font><font style="vertical-align: inherit;">Der einfachste Fall ist der Wind, der direkt durch das Sechseck weht:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e8a/982/d5a/e8a982d5af635e1fbee1e82f20c1990d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Fall erwarten wir, dass sich der Wind unver√§ndert zur n√§chsten Zelle bewegt. </font><font style="vertical-align: inherit;">(Hier ist der rote Vektor der urspr√ºngliche Wind und der blaue der Vektor des sich ausbreitenden Windes.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber was ist, wenn der Wind nicht direkt in die benachbarte Zelle bl√§st?</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cd/396/196/3cd3961960c15fa86e60cd421336e23d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Fall scheint es logisch, dass ein Teil des Windes in ein Sechseck direkt dar√ºber weht, der andere Teil in eine Zelle, die sich gegen den Uhrzeigersinn von dieser befindet, und die Proportionen sollten von der Richtung abh√§ngen, in die der Pfeil zeigt. </font><font style="vertical-align: inherit;">In unserem Fall bewegt sich der Hauptteil des Windes zur oberen Zelle und weniger zur benachbarten Zelle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist auch notwendig, die Richtung des sich ausbreitenden Windes zu bestimmen. </font><font style="vertical-align: inherit;">Eine M√∂glichkeit besteht darin, die Richtung des urspr√ºnglichen Windes beizubehalten:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e31/e3f/6ef/e31e3f6ef05e18991e2e48462e47a05b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es scheint, dass dies die realistischste Option ist, aber es gibt noch eine andere - die Richtung des Windes entsprechend der Kante des Sechsecks zu √§ndern, das es schneidet: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/96b/caa/11d/96bcaa11d738b2468eccd1ea758b9e8d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieser Ansatz ist weniger genau, hat aber den Vorteil, dass eingehende Winde immer in eine von sechs Richtungen weisen, was die Berechnungen vereinfachen kann. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine weitere Schwierigkeit ergibt sich bei der Betrachtung des Gel√§ndes. </font><font style="vertical-align: inherit;">Was soll passieren, wenn sich ein Berg im Wind erhebt?</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a95/c03/492/a95c0349265fe5581df74ebb33bbd4f5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In diesem Fall geht ein Teil des Windes √ºber den Berg (wodurch m√∂glicherweise Niederschlag entsteht), aber ein Teil des Windes dreht sich zu den Seiten. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5f4/e8b/fe3/5f4e8bfe34c0e0a8fd7a9bb784487ad9.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher h√§ngt die Art und Weise, wie der Wind aus dem Sechseck kommt, von seiner Richtung sowie von der Topographie in benachbarten Zellen ab. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie uns nun dar√ºber sprechen, wie Vektoren dargestellt werden. </font><font style="vertical-align: inherit;">Es gibt zwei Hauptoptionen. </font><font style="vertical-align: inherit;">Erstens kann ein Vektor beispielsweise wie folgt als X- und Y-Werte dargestellt werden:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/253/4da/c67/2534dac673d43b8bf4d93f70254e540a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn wir einen Vektor zeichnen, der bei (0, 0) beginnt, dann sind (X, Y) die Koordinaten der Endpunkte. </font><font style="vertical-align: inherit;">Eine solche Aufzeichnung macht es sehr einfach, Vektoren zu summieren. </font><font style="vertical-align: inherit;">Wir addieren einfach alle Werte (X, Y) und erhalten einen neuen Vektor:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9fd/b4c/427/9fdb4c427518523698ec72c34b854059.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eine andere M√∂glichkeit besteht darin, den Winkel und die L√§nge des Vektors zu verwenden: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/421/9c9/c434219c9ba69e9a29b5d73b665d5e96.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In dieser Form ist es einfach, Operationen wie das Drehen von Vektoren oder das √Ñndern ihrer L√§nge auszuf√ºhren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr die Mehrzahl der im Windmodell erforderlichen Operationen ist die erste Option besser, in einigen F√§llen ist die zweite besser, sodass es zweckm√§√üig w√§re, bei Bedarf zwischen ihnen zu wechseln. </font><font style="vertical-align: inherit;">Um das Rad nicht neu zu erfinden, habe ich nach einer Vektorbibliothek f√ºr Javascript </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gesucht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Victor.js ist</font></a><font style="vertical-align: inherit;"> vollst√§ndig </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">aufgetaucht</font></a><font style="vertical-align: inherit;"> , also habe ich sie ausgenutzt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich f√ºge zun√§chst jedem Sechseck einen Windvektor hinzu und pr√ºfe, ob ich ihn visualisieren kann:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9e/1a2/b49/d9e1a2b49e115bbc4436a8e518164adb.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es sieht soweit gut aus. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der n√§chste Schritt besteht darin, zu √ºberpr√ºfen, ob ich den Windvektor richtig teilen und an die n√§chste Zelle verteilen kann. Zun√§chst m√ºssen Sie die Winkel berechnen, die zu anderen Zellen f√ºhren. Ich fand die Antwort wieder auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Amits Seite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f2/f9d/4a9/9f2f9d4a9c349dbb47ff2dc32ede0ff8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, ein Vektor bei 0 Grad zeigt auf ein Sechseck rechts, bei 60 Grad - auf ein Sechseck unten rechts und so weiter. Ein Vektor, der zwischen diesen beiden Richtungen zeigt, wird proportional zwischen zwei Zellen aufgeteilt - das hei√üt, ein Vektor in einem Winkel von 30 Grad wird gleichm√§√üig zwischen der Zelle rechts und der Zelle von unten nach rechts aufgeteilt. Jeder Vektor liegt irgendwo zwischen den Ecken der Fl√§chen zweier benachbarter Zellen. Sehen Sie sich also den Winkel des Windvektors an, stellen Sie fest, dass er zwischen die zentralen Ecken zweier Sechsecke f√§llt, und teilen Sie ihn dann proportional zwischen diesen beiden Sechsecken auf. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Windvektor beispielsweise einen Winkel von 22 Grad hat:</font></font><br><br><div style="text-align:center;"><img height="320" src="https://habrastorage.org/getpro/habr/post_images/147/fc8/add/147fc8add812755fa9abab8c5eb928aa.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dann breiten sich 38/60 des Wertes zur Zelle rechts und 22/60 des Vektorwerts zur Zelle unten rechts aus. Wenn die Vektoren als Paar von X- und Y-Werten dargestellt werden, k√∂nnen Sie sie verteilen, indem Sie jeden Wert des urspr√ºnglichen Vektors mit einem Bruch multiplizieren (z. B. mit 22/60) und ihn dann dem Windvektor im neuen Sechseck hinzuf√ºgen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um dies zu testen, kann ich die Winde in verschiedene Richtungen anordnen und sie oben und seitlich auf der Karte platzieren und pr√ºfen, ob sie sich korrekt auf der Karte ausbreiten k√∂nnen. Wenn Winde kollidieren, sollten sie kombiniert werden und die durchschnittliche Richtung mit erh√∂hter Geschwindigkeit w√§hlen:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/039/482/4ac/0394824ac970c0887bb100c515ea300e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier sehen wir, dass sich Winde entlang der Diagonale treffen und zusammen in Richtung der unteren Ecke wehen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der n√§chste Schritt besteht darin, den Einfluss von Land auf den Wind zu ber√ºcksichtigen. </font><font style="vertical-align: inherit;">Nat√ºrlich sind echte Windmodelle sehr komplex, aber ich interessiere mich haupts√§chlich daf√ºr, wie sich die Landgeographie auf Oberfl√§chenwinde auswirkt. </font><font style="vertical-align: inherit;">Auf der einfachsten Ebene ist dies der Einfluss von Landh√∂hen und Tiefland auf die Richtung und Geschwindigkeit des Windes. </font><font style="vertical-align: inherit;">Ich habe mit vielen verschiedenen Ans√§tzen experimentiert, mich aber auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zwei einfache Regeln festgelegt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Wind wendet sich von Hindernissen ab. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Wind verlangsamt sich, wenn er steigt, beschleunigt und f√§llt ab. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Hindernis tritt auf, wenn der Wind in eine Zelle mit einer h√∂heren H√∂he bl√§st, beispielsweise in eine Zelle mit einem Berg. </font><font style="vertical-align: inherit;">Wenn dies passiert, schaue ich auf die beiden Zellen, in die der Wind weht, und √§ndere den Winkel des Windes so, dass er mehr auf das untere der beiden Sechsecke zeigt. </font><font style="vertical-align: inherit;">Die Gr√∂√üe der Winkel√§nderungen h√§ngt vom H√∂henunterschied zweier Zellen ab. Wenn der Wind also in zwei benachbarte Zellen mit Bergen bl√§st, √§ndert sich seine Richtung kaum. Wenn er jedoch in eine Zelle mit einem Berg und eine Zelle mit einer Ebene bl√§st, dreht er sich mehr in Richtung der leeren Zelle:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6f/4cd/b90/e6f4cdb90eb194445cf21b3c5679e3ca.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die St√§rke des Windes kann eingestellt werden. </font><font style="vertical-align: inherit;">Auf der Karte oben ist er zu stark, was zur Entstehung vieler unrealistischer Biome f√ºhren wird. </font><font style="vertical-align: inherit;">Hier ist eine logischere Bedeutung:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e70/676/6f8/e706766f8d1abfc1ad18b928b72d9c7e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein gro√üer Teil der durch die Reliefs verursachten Windbewegung bleibt bestehen, aber die gro√üen L√ºcken und T√§ler des starken Windes sind kleiner geworden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein weiteres Merkmal, das den Realismus verbessert, ist die Streuung des Windes. Zum Beispiel zeigt die Karte oben, dass der Wind direkt √ºber der Stadt Breeches nach Westen weht. Obwohl es √ºber gro√üe Entfernungen weht, l√∂st es sich nie so auf, wie wir es erwarten w√ºrden. Wenn ein wehender Wind auf eine andere Luft trifft, zieht er normalerweise den Wind mit. Um dies zu simulieren, kann ich einen kleinen Teil des Windes, der in jedem Sechseck weht, auf alle benachbarten Zellen verteilen. So sieht die Karte oben mit einer kleinen Streuung aus:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98d/53c/6d1/98d53c6d1659c068a8d36c58d692bd02.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie sehen k√∂nnen, hat der Wind √ºber den Reithosen begonnen, sich ein wenig nach unten zu zerstreuen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Operation bestimmt den Gro√üteil der Windrichtungen. Der zweite Teil ist die Verz√∂gerung des Windes beim Aufsteigen und die Beschleunigung beim Absenken. Ich kann dies erkennen, indem ich die relative H√∂he der Zelle, aus der der Wind kommt, und die H√∂he der Zelle, in die der Wind weht, betrachte und gegebenenfalls beschleunige / verlangsame. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So sieht alles aus:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/633/2c0/d8b/6332c0d8b042591426238cceafaea5a8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt sehen wir, dass ein Teil des Windes, der durch die hohen Berge im zentralen Teil der Insel weht, abgeschnitten wurde. Und umgekehrt - im westlichen Teil der Insel traten mehrere neue Winde auf, bei denen sich die Luft von relativ hohem Land zum Meer bewegt. (Dies ist eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K√ºstenbrise</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! Obwohl nicht wirklich: Der Mechanismus ist dort anders.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jetzt kann ich einen neuen Wind in den vorhandenen Niederschlagsalgorithmus einsetzen. Hier ist ein Vergleich (alte Winde links, neue Winde rechts):</font></font><br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/1e2/c41/3b4/1e2c413b436456e0964c50b794a402db.png"></a> </div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Klicken Sie auf das Bild, um eine gr√∂√üere Version anzuzeigen.) Offensichtlich gibt es Unterschiede zwischen den Windmodellen. Auf beiden Karten weht der Wind von Osten. Berge in der N√§he der Kartenmitte drehen den Wind nach S√ºden, verursachen starke Regenf√§lle und bilden s√ºdlich der Berge einen Sumpf und W√§lder. Im unteren Teil weht der Wind st√∂rungsfrei und entlang der √∂stlichen Inselh√§lfte bilden sich W√§lder. Im urspr√ºnglichen Windmodell wehte genug Wind √ºber die zentralen Berge und S√ºmpfe, um im westlichen Teil der Insel einen Wald zu schaffen. Beim neuen Modell wird der gr√∂√üte Teil des Windes abgeschnitten und auf der anderen Seite der Berge bilden sich grasbewachsene Biome.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das alte Modell hat die Variabilit√§t zuf√§lliger Parameter (innerhalb eines bestimmten Intervalls), und es ist wahrscheinlich, dass eine Kombination dieser Parameter ein Bild ergibt, das eher einer neuen Karte √§hnelt. Tats√§chlich m√ºssen wir jedoch nicht das genaue Verhalten des alten Modells reproduzieren, sondern nur ein Modell, das √ºberzeugend aussehende Ergebnisse liefert.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ziel all dessen ist es, die Erzeugung von Wind zu beschleunigen und zu vereinfachen, damit den Kontinentalkarten neues Windverhalten hinzugef√ºgt werden kann. </font><font style="vertical-align: inherit;">Habe ich es getan </font><font style="vertical-align: inherit;">Ich habe das urspr√ºngliche Windmodell und das neue sechseckige Modell profiliert. </font><font style="vertical-align: inherit;">Es stellte sich heraus, dass das neue Modell 15-20 mal schneller ist als das Original (!). </font><font style="vertical-align: inherit;">Dies ist eine sehr signifikante Beschleunigung, die wenig Einfluss auf die Karten hat. </font><font style="vertical-align: inherit;">Die Experimente machen deutlich, dass das Modell nicht besonders empfindlich auf die Gr√∂√üe der Sechsecke reagiert. Wenn n√∂tig, kann ich den Algorithmus noch weiter beschleunigen, indem ich die Gr√∂√üe der Zellen erh√∂he. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das n√§chste Mal werden wir daran arbeiten, ein neues Windmodell zu verwenden, um Windmuster im kontinentalen Ma√üstab zu implementieren und sie dann mit dem Niederschlagsmodell und den Biomen zu verbinden.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de429620/">https://habr.com/ru/post/de429620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de429606/index.html">Das verdammte Dutzend f√ºr PM: eine Liste von B√ºchern f√ºr Projektmanager</a></li>
<li><a href="../de429610/index.html">Die Geschichte, wie man den Android-Emulator ausf√ºhrt oder auf dem Intel-Prozessor speichert</a></li>
<li><a href="../de429612/index.html">Fulsteks sind ewige MIDLs. Folgen Sie diesem Weg nicht, wenn Sie nicht leiden wollen</a></li>
<li><a href="../de429616/index.html">Digitaler Arbeitsbereich Teil 1: Citrix</a></li>
<li><a href="../de429618/index.html">Elektronisches Spiel XO</a></li>
<li><a href="../de429622/index.html">Roboter ersetzten Amazon durch 20.000 Arbeiter</a></li>
<li><a href="../de429624/index.html">Wie die NASA Roboter einsetzen wird, um Raketentreibstoff aus Marsboden herzustellen</a></li>
<li><a href="../de429626/index.html">Genomcracker haben gezeigt, dass keine DNA mehr anonym ist</a></li>
<li><a href="../de429628/index.html">So erstellen Sie einen Chat-Bot f√ºr VKontakte mit Python, Django und Webhook</a></li>
<li><a href="../de429630/index.html">"Monster in Spielen oder Angst vielf√§ltig machen"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>