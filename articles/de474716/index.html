<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚ÄçüöÄ üì∑ üì´ Bugs C ++ 20. Ergebnisse des Treffens in Belfast üì® üë®‚Äçüë¶ ü•ß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neulich fand in Belfast eine Sitzung des Komitees f√ºr Standardisierung der Programmiersprache C ++ statt. Rund 400 Kommentare zu C ++ 20 kamen von den...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bugs C ++ 20. Ergebnisse des Treffens in Belfast</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/474716/">  Neulich fand in Belfast eine Sitzung des Komitees f√ºr Standardisierung der Programmiersprache C ++ statt.  Rund 400 Kommentare zu C ++ 20 kamen von den L√§ndervertretern in das Komitee, und die H√§lfte von ihnen schaffte es, sich damit auseinanderzusetzen. <br><br>  Unter dem Schnitt warten Sie auf die Ergebnisse der Diskussionen √ºber russische Kommentare (ja, IHRE Kommentare zu C ++ 20), einige Kommentare aus anderen L√§ndern und nat√ºrlich auf das geeignete neue C ++ 23 (Executors!). <br><a name="habracut"></a><br>  Alle Probleme mit C ++, die auf der Website <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">stdcpp.ru</a> , im Chat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@ProCxx</a> , bei der Arbeit in Yandex.Taxi oder pers√∂nlich auf Konferenzen erw√§hnt wurden, haben wir in Form von Kommentaren zu C ++ 20 formalisiert.  Und was kam daraus ... <br><br><h3>  std :: atomic &lt;int&gt; a {};  und std :: atomic &lt;int&gt; b; </h3><br>  Es mag seltsam erscheinen, aber die Variablen <b>a</b> und <b>b werden</b> nicht auf 0 initialisiert. Um eine atomare Variable auf Null zu initialisieren, musste std :: atomic &lt;int&gt; mit {0} geschrieben werden. <br><br>  Dieses Verhalten ist v√∂llig offensichtlich und viele Entwickler haben sich selbst verbrannt.  Das Komitee akzeptierte unsere Bemerkung zum Standard, und in C ++ 20 initialisieren die Standardkonstruktoren f√ºr std :: atomic_flag und std :: atomic die Variablen in <i>clear state</i> bzw. T (). <br><br><h3>  std :: launder </h3><br>  Ab C ++ 17 hat der Standard eine be√§ngstigende Funktion std :: launder.  Die Mitglieder des Komitees waren der Meinung, dass Standardbibliotheksentwickler und normale Benutzer herausfinden w√ºrden, wie sie damit umgehen sollen. <br><br>  In der Praxis hat sich herausgestellt, dass diese Funktion in einigen F√§llen nicht verwendet werden kann.  Es ist √§u√üerst un√ºbersehbar, dass dies grunds√§tzlich erforderlich ist: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c; }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;C&gt; v = {C{<span class="hljs-number"><span class="hljs-number">1</span></span>}}; v.pop_back(); v.push_back(C{<span class="hljs-number"><span class="hljs-number">2</span></span>}); assert(v.back().c == <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ]:-&gt;</span></span></code> </pre> <br>  Wenn Sie den Buchstaben des Standards genau befolgen, k√∂nnen die Eigenschaften des Compilers und der Mondphase je nach Implementierung der Standardbibliothek bestehen oder scheitern. <br><br>  Bei der Er√∂rterung des Problems stellte sich heraus, dass die Optimierung, zu deren Zweck der Standard ein derart seltsames Verhalten beschrieb, nur in einem der Compiler implementiert war und keine sp√ºrbare Leistungssteigerung brachte. <br><br>  Ab C ++ 20 k√∂nnen Sie also Strukturen mit Links und konstanten Feldern sicher in std :: optional, std :: variante, std :: vector, std :: deque usw. speichern. Jetzt wendet die Platzierung new automatisch einen Teil der std-Logik an: : waschen. <br><br><h3>  * dies in Konstruktoren </h3><br>  Dies ist einer der Kommentare, bei denen ein Fehler auf uns wartete: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> {</span></span> C(C&amp;&amp; other) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> : initial_(other.initial_) , secondary_(other.initial_) <span class="hljs-comment"><span class="hljs-comment">// O_O {} int initial_; int secondary_; };</span></span></code> </pre><br>  Gem√§√ü den aktuellen Regeln hat <b>der</b> Compiler in der Zeile mit <b>O_O</b> das Recht anzunehmen, dass &amp; other == this und dementsprechend eine Zeile dar√ºber den Wert von other.initial_ neu geschrieben und neu gelesen werden muss. <br><br>  Mit anderen Worten, der Compiler hat das Recht anzunehmen, dass eine noch nicht erstellte Klasse mit dem Parameter versehen ist, aus dem das Objekt erstellt wird, und aus diesem Grund nicht optimalen Code generieren kann. <br><br>  Einige Compiler (z. B. GCC) glauben, dass Benutzer keine solche Schande schreiben, und glauben, dass Aliasing nicht m√∂glich ist. <br><br>  Das Komitee lehnte unsere Bemerkung "Nehmen wir an, dass Aliasing nicht m√∂glich ist" ab.  Wie sich herausstellte, haben einige Codebasen be√§ngstigende Hacks, bei denen &amp; andere == und die Leute sind noch nicht bereit, sich von ihnen zu verabschieden. <br><br><h3>  Operator &lt;=&gt; und eingebettete Programmierung </h3><br>  Damit der Raumschiffoperator funktioniert, ben√∂tigen Sie die Header-Datei &lt;compare&gt;.  Es befand sich jedoch nicht in der Liste der Header-Dateien, die auf einer Plattform verf√ºgbar sind (auf den sogenannten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">freistehenden Implementierungen der</a> Standardbibliothek, die auf einem beliebigen B√ºgeleisen verwendet werden k√∂nnen). <br><br>  Jetzt steht es auf der Liste :) <br><br><h3>  Der rest </h3><br>  Nach unseren anderen Kommentaren wurde das Urteil ‚ÄûNot in C ++ 20‚Äú erlassen: <br>  * Wir wollten, dass __func__ in constexpr verwendet wird. <br>  * Wir wollten, dass das Konzept nicht den unvollst√§ndigen Typ verwendet, da sonst mehrere ODR-Verst√∂√üe auftreten.  Die Bemerkung hatte jedoch einen unerwartet positiven Effekt: Compiler geben jetzt eine Warnung aus, wenn Sie die unvollst√§ndige Eingabe von erforderlich verwenden. <br>  * Wir wollten den Zuweisungsoperator f√ºr std :: string korrigieren, damit ein solches Durcheinander nicht auftritt: <br><br><pre> <code class="cpp hljs">basic_string::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(charT c): <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d = <span class="hljs-number"><span class="hljs-number">3.14</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> s; s = d; <span class="hljs-comment"><span class="hljs-comment">// Compiles</span></span></code> </pre><br>  Das Komitee schlug vor, ein separates Papier zu schreiben und dieses nach C ++ 20 zu korrigieren. <br>  * Wir wollten die Zuweisung tempor√§rer Zeilen in std :: string_view beenden: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::string_view sv; sv = foo(); <span class="hljs-comment"><span class="hljs-comment">// Compiles... dangling reference</span></span></code> </pre><br>  Das Ergebnis ist das gleiche wie in der vorherigen Bemerkung: Das Komitee schlug vor, ein separates Papier zu schreiben und dieses nach C ++ 20 zu korrigieren. <br>  * Wir haben darum gebeten, dass der folgende Code kompiliert wird: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;type_traits&gt; template &lt;typename... Xs&gt; auto f (Xs...) -&gt; std::invoke_result_t&lt;Xs...&gt;;</span></span></span></span></code> </pre><br>  Uns wurde gesagt, dass alles kompliziert ist, es gibt praktisch keine Chance, C ++ 20 zu reparieren. <br><br><h2>  Kommentare aus anderen L√§ndern </h2><br>  Wichtige √Ñnderungen: Hinzuf√ºgen von Konstruktoren f√ºr std :: span aus Typen, die das Konzept von range :: contiguous_range erf√ºllen.  So kann Span jetzt implizit aus std :: vector und std :: string erstellt werden.  Wir haben auch den Konstruktor std :: string_view aus zwei Iteratoren hinzugef√ºgt, die das Konzept von range :: contiguous_iterator erf√ºllen. <br><br>  Unterhaltsame √Ñnderungen erwarteten &lt;Vergleichen&gt;.  In den letzten drei Jahren hat sich der Betreiber &lt;=&gt; stark ver√§ndert.  Er ist nicht mehr an Vergleichen f√ºr Gleichheit beteiligt, und dementsprechend wird ein Drittel des Inhalts von &lt;Vergleichen&gt; nicht mehr ben√∂tigt.  Mehrere L√§nder haben dies bemerkt - sie haben den Standard reduziert. <br><br>  Eine gro√üe Ver√§nderung hat sich in nicht typisierte Template-Parameter eingeschlichen.  In C ++ 20 k√∂nnen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fast alle Klassen (siehe S1907)</a> mit einem Constexpr-Destruktor und √∂ffentlichen Elementen als Vorlagenparameter √ºbergeben werden, auch wenn die Klasse Gleitkommatypen oder Links enth√§lt. <br><br>  Wir haben auch die fehlende Konstante zu verschiedenen Teilen des Standards hinzugef√ºgt und die Namen und die Reihenfolge der Argumente einiger neuer Funktionen in C ++ 20 ge√§ndert.  Es gibt auch zahlreiche √Ñnderungen f√ºr Konzepte und Bereiche, Abk√ºrzungen des Standardtexts und andere Kleinigkeiten. <br><br><h2>  Zahlen TS </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ZaMaZaN4iK</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ich</a> konnten das Komitee mit dem C ++ Numerics Work In Progress-Dokument aufr√ºhren.  Jetzt gibt es napoleonische Pl√§ne f√ºr C ++ 23, um Benutzern eine Reihe neuer Arten von Zahlen (wide_integer, integer, rational) sowie zus√§tzliche Low-Level-Methoden f√ºr die Arbeit mit √úberl√§ufen und praktischen Aliasen bereitzustellen. <br><br>  Mir wurde gesagt, ich solle eine Pr√§sentation f√ºr das n√§chste Treffen mit einer Einf√ºhrung in die Ideen f√ºr das gesamte Komitee vorbereiten. <br><br><h2>  Vollstrecker </h2><br>  Executors ist eine der Priorit√§ten von C ++ 23.  Sie sind f√ºr die reaktive Programmierung, f√ºr die asynchrone Programmierung (Netzwerk, Datentr√§ger, Prozesse ...) erforderlich, bilden die Grundlage f√ºr die Coroutine-Planung und sollten eine einzige Schnittstelle f√ºr Bibliotheken von Drittanbietern bieten. <br><br>  Gleichzeitig sollten Executoren die Algorithmen f√ºr ihre interne Implementierung optimieren.  Zum Beispiel f√ºr Code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::input_range Range&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MySort</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Range&amp; data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> stdr = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::ranges; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::sort(GetGlobalExecutor(), stdr::begin(data), stdr::end(data), <span class="hljs-number"><span class="hljs-number">42</span></span>); }</code> </pre><br>  Die GetGlobalExecutor () -Funktion kann Folgendes zur√ºckgeben: <br>  * Single-Threaded-Executor - Er sollte die √ºbliche std :: sort in seinem Thread ausf√ºhren. <br>  * Multithread-Executor - sollte eine parallele Sortierung durchf√ºhren; <br>  * GPU-Executor - Er muss die Daten in den Speicher der Grafikkarte verschieben, dort sortieren und die Daten zur√ºckgeben. <br>  * NUMA-Testamentsvollstrecker - ... <br>  * ... <br><br>  Um solche Funktionen zu implementieren, m√ºssen Sie bisher be√§ngstigende Anpassungspunktobjekte (CPO) erstellen und jeden Algorithmus in diese umwandeln.  Dem Ausschuss hat es nicht gefallen ... <br><br>  Zumindest haben sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das P0443</a> - die Basisschnittstelle - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorab genehmigt</a> .  Alle nachfolgenden S√§tze f√ºr Testamentsvollstrecker m√ºssen in Form von Patches f√ºr P0443 geschrieben werden. <br><br><h2>  Anstelle von Summen </h2><br>  Jetzt sind wir durch nur eine Ausschusssitzung von C ++ 20 getrennt.  Nur noch ein bisschen √ºbrig ... <br><br>  Nun, jeder, der live mit Vertretern des Komitees plaudern m√∂chte - schauen Sie sich die Mitaps und C ++ Konferenzen an <i>(*)</i> : <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Corehard in Minsk</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">C ++ Sibirien 2020</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">C ++ Russland 2020</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">St.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Petersburg C ++ Benutzergruppe</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">C ++ Meetup 2019 in Moskau</a> <br><br>  <i>(*) Life Hack: Sie m√ºssen kein Konferenzticket bezahlen, wenn Sie Redner sind.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de474716/">https://habr.com/ru/post/de474716/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de474706/index.html">TextRadar Fuzzy Search Algorithmus - Grundlegende Ans√§tze</a></li>
<li><a href="../de474708/index.html">Das Internet ist fragmentierter als je zuvor: Woher kommen t√§glich mehr als eine Million neue Benutzer? Teil 1</a></li>
<li><a href="../de474710/index.html">c.tech: Frontend Meetup # 2</a></li>
<li><a href="../de474712/index.html">Udalenka in der IT: pers√∂nliche Erfahrung</a></li>
<li><a href="../de474714/index.html">Merkmale des nationalen Einzelhandels oder Wie ich die St√§rke der franz√∂sischen Technologie getestet habe</a></li>
<li><a href="../de474718/index.html">Sicherheit in der Autoelektronik - Hallo Welt auf dem Armaturenbrett-Controller</a></li>
<li><a href="../de474720/index.html">Radiolabor Nischni Nowgorod und Losevs ‚ÄûCristadins‚Äú</a></li>
<li><a href="../de474722/index.html">‚ÄûNiemand sagt anderen, was sie tun m√ºssen‚Äú: Nicol√≤ Ribaudo √ºber die Entwicklung von Babel und mehr</a></li>
<li><a href="../de474724/index.html">Was wird mit PHP in 5 Jahren passieren? Wir haben die Sprecher der n√§chsten Moskauer Mitap gefragt</a></li>
<li><a href="../de474726/index.html">Sogar Kinder werden verstehen: eine einfache Erkl√§rung von Async / Warten und Versprechen in JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>