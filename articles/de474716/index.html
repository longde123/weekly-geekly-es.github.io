<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🚀 📷 📫 Bugs C ++ 20. Ergebnisse des Treffens in Belfast 📨 👨‍👦 🥧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neulich fand in Belfast eine Sitzung des Komitees für Standardisierung der Programmiersprache C ++ statt. Rund 400 Kommentare zu C ++ 20 kamen von den...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bugs C ++ 20. Ergebnisse des Treffens in Belfast</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/474716/">  Neulich fand in Belfast eine Sitzung des Komitees für Standardisierung der Programmiersprache C ++ statt.  Rund 400 Kommentare zu C ++ 20 kamen von den Ländervertretern in das Komitee, und die Hälfte von ihnen schaffte es, sich damit auseinanderzusetzen. <br><br>  Unter dem Schnitt warten Sie auf die Ergebnisse der Diskussionen über russische Kommentare (ja, IHRE Kommentare zu C ++ 20), einige Kommentare aus anderen Ländern und natürlich auf das geeignete neue C ++ 23 (Executors!). <br><a name="habracut"></a><br>  Alle Probleme mit C ++, die auf der Website <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">stdcpp.ru</a> , im Chat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@ProCxx</a> , bei der Arbeit in Yandex.Taxi oder persönlich auf Konferenzen erwähnt wurden, haben wir in Form von Kommentaren zu C ++ 20 formalisiert.  Und was kam daraus ... <br><br><h3>  std :: atomic &lt;int&gt; a {};  und std :: atomic &lt;int&gt; b; </h3><br>  Es mag seltsam erscheinen, aber die Variablen <b>a</b> und <b>b werden</b> nicht auf 0 initialisiert. Um eine atomare Variable auf Null zu initialisieren, musste std :: atomic &lt;int&gt; mit {0} geschrieben werden. <br><br>  Dieses Verhalten ist völlig offensichtlich und viele Entwickler haben sich selbst verbrannt.  Das Komitee akzeptierte unsere Bemerkung zum Standard, und in C ++ 20 initialisieren die Standardkonstruktoren für std :: atomic_flag und std :: atomic die Variablen in <i>clear state</i> bzw. T (). <br><br><h3>  std :: launder </h3><br>  Ab C ++ 17 hat der Standard eine beängstigende Funktion std :: launder.  Die Mitglieder des Komitees waren der Meinung, dass Standardbibliotheksentwickler und normale Benutzer herausfinden würden, wie sie damit umgehen sollen. <br><br>  In der Praxis hat sich herausgestellt, dass diese Funktion in einigen Fällen nicht verwendet werden kann.  Es ist äußerst unübersehbar, dass dies grundsätzlich erforderlich ist: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c; }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;C&gt; v = {C{<span class="hljs-number"><span class="hljs-number">1</span></span>}}; v.pop_back(); v.push_back(C{<span class="hljs-number"><span class="hljs-number">2</span></span>}); assert(v.back().c == <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ]:-&gt;</span></span></code> </pre> <br>  Wenn Sie den Buchstaben des Standards genau befolgen, können die Eigenschaften des Compilers und der Mondphase je nach Implementierung der Standardbibliothek bestehen oder scheitern. <br><br>  Bei der Erörterung des Problems stellte sich heraus, dass die Optimierung, zu deren Zweck der Standard ein derart seltsames Verhalten beschrieb, nur in einem der Compiler implementiert war und keine spürbare Leistungssteigerung brachte. <br><br>  Ab C ++ 20 können Sie also Strukturen mit Links und konstanten Feldern sicher in std :: optional, std :: variante, std :: vector, std :: deque usw. speichern. Jetzt wendet die Platzierung new automatisch einen Teil der std-Logik an: : waschen. <br><br><h3>  * dies in Konstruktoren </h3><br>  Dies ist einer der Kommentare, bei denen ein Fehler auf uns wartete: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> {</span></span> C(C&amp;&amp; other) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> : initial_(other.initial_) , secondary_(other.initial_) <span class="hljs-comment"><span class="hljs-comment">// O_O {} int initial_; int secondary_; };</span></span></code> </pre><br>  Gemäß den aktuellen Regeln hat <b>der</b> Compiler in der Zeile mit <b>O_O</b> das Recht anzunehmen, dass &amp; other == this und dementsprechend eine Zeile darüber den Wert von other.initial_ neu geschrieben und neu gelesen werden muss. <br><br>  Mit anderen Worten, der Compiler hat das Recht anzunehmen, dass eine noch nicht erstellte Klasse mit dem Parameter versehen ist, aus dem das Objekt erstellt wird, und aus diesem Grund nicht optimalen Code generieren kann. <br><br>  Einige Compiler (z. B. GCC) glauben, dass Benutzer keine solche Schande schreiben, und glauben, dass Aliasing nicht möglich ist. <br><br>  Das Komitee lehnte unsere Bemerkung "Nehmen wir an, dass Aliasing nicht möglich ist" ab.  Wie sich herausstellte, haben einige Codebasen beängstigende Hacks, bei denen &amp; andere == und die Leute sind noch nicht bereit, sich von ihnen zu verabschieden. <br><br><h3>  Operator &lt;=&gt; und eingebettete Programmierung </h3><br>  Damit der Raumschiffoperator funktioniert, benötigen Sie die Header-Datei &lt;compare&gt;.  Es befand sich jedoch nicht in der Liste der Header-Dateien, die auf einer Plattform verfügbar sind (auf den sogenannten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">freistehenden Implementierungen der</a> Standardbibliothek, die auf einem beliebigen Bügeleisen verwendet werden können). <br><br>  Jetzt steht es auf der Liste :) <br><br><h3>  Der rest </h3><br>  Nach unseren anderen Kommentaren wurde das Urteil „Not in C ++ 20“ erlassen: <br>  * Wir wollten, dass __func__ in constexpr verwendet wird. <br>  * Wir wollten, dass das Konzept nicht den unvollständigen Typ verwendet, da sonst mehrere ODR-Verstöße auftreten.  Die Bemerkung hatte jedoch einen unerwartet positiven Effekt: Compiler geben jetzt eine Warnung aus, wenn Sie die unvollständige Eingabe von erforderlich verwenden. <br>  * Wir wollten den Zuweisungsoperator für std :: string korrigieren, damit ein solches Durcheinander nicht auftritt: <br><br><pre> <code class="cpp hljs">basic_string::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(charT c): <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d = <span class="hljs-number"><span class="hljs-number">3.14</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> s; s = d; <span class="hljs-comment"><span class="hljs-comment">// Compiles</span></span></code> </pre><br>  Das Komitee schlug vor, ein separates Papier zu schreiben und dieses nach C ++ 20 zu korrigieren. <br>  * Wir wollten die Zuweisung temporärer Zeilen in std :: string_view beenden: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::string_view sv; sv = foo(); <span class="hljs-comment"><span class="hljs-comment">// Compiles... dangling reference</span></span></code> </pre><br>  Das Ergebnis ist das gleiche wie in der vorherigen Bemerkung: Das Komitee schlug vor, ein separates Papier zu schreiben und dieses nach C ++ 20 zu korrigieren. <br>  * Wir haben darum gebeten, dass der folgende Code kompiliert wird: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;type_traits&gt; template &lt;typename... Xs&gt; auto f (Xs...) -&gt; std::invoke_result_t&lt;Xs...&gt;;</span></span></span></span></code> </pre><br>  Uns wurde gesagt, dass alles kompliziert ist, es gibt praktisch keine Chance, C ++ 20 zu reparieren. <br><br><h2>  Kommentare aus anderen Ländern </h2><br>  Wichtige Änderungen: Hinzufügen von Konstruktoren für std :: span aus Typen, die das Konzept von range :: contiguous_range erfüllen.  So kann Span jetzt implizit aus std :: vector und std :: string erstellt werden.  Wir haben auch den Konstruktor std :: string_view aus zwei Iteratoren hinzugefügt, die das Konzept von range :: contiguous_iterator erfüllen. <br><br>  Unterhaltsame Änderungen erwarteten &lt;Vergleichen&gt;.  In den letzten drei Jahren hat sich der Betreiber &lt;=&gt; stark verändert.  Er ist nicht mehr an Vergleichen für Gleichheit beteiligt, und dementsprechend wird ein Drittel des Inhalts von &lt;Vergleichen&gt; nicht mehr benötigt.  Mehrere Länder haben dies bemerkt - sie haben den Standard reduziert. <br><br>  Eine große Veränderung hat sich in nicht typisierte Template-Parameter eingeschlichen.  In C ++ 20 können <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fast alle Klassen (siehe S1907)</a> mit einem Constexpr-Destruktor und öffentlichen Elementen als Vorlagenparameter übergeben werden, auch wenn die Klasse Gleitkommatypen oder Links enthält. <br><br>  Wir haben auch die fehlende Konstante zu verschiedenen Teilen des Standards hinzugefügt und die Namen und die Reihenfolge der Argumente einiger neuer Funktionen in C ++ 20 geändert.  Es gibt auch zahlreiche Änderungen für Konzepte und Bereiche, Abkürzungen des Standardtexts und andere Kleinigkeiten. <br><br><h2>  Zahlen TS </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ZaMaZaN4iK</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">ich</a> konnten das Komitee mit dem C ++ Numerics Work In Progress-Dokument aufrühren.  Jetzt gibt es napoleonische Pläne für C ++ 23, um Benutzern eine Reihe neuer Arten von Zahlen (wide_integer, integer, rational) sowie zusätzliche Low-Level-Methoden für die Arbeit mit Überläufen und praktischen Aliasen bereitzustellen. <br><br>  Mir wurde gesagt, ich solle eine Präsentation für das nächste Treffen mit einer Einführung in die Ideen für das gesamte Komitee vorbereiten. <br><br><h2>  Vollstrecker </h2><br>  Executors ist eine der Prioritäten von C ++ 23.  Sie sind für die reaktive Programmierung, für die asynchrone Programmierung (Netzwerk, Datenträger, Prozesse ...) erforderlich, bilden die Grundlage für die Coroutine-Planung und sollten eine einzige Schnittstelle für Bibliotheken von Drittanbietern bieten. <br><br>  Gleichzeitig sollten Executoren die Algorithmen für ihre interne Implementierung optimieren.  Zum Beispiel für Code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::input_range Range&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MySort</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Range&amp; data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> stdr = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::ranges; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::sort(GetGlobalExecutor(), stdr::begin(data), stdr::end(data), <span class="hljs-number"><span class="hljs-number">42</span></span>); }</code> </pre><br>  Die GetGlobalExecutor () -Funktion kann Folgendes zurückgeben: <br>  * Single-Threaded-Executor - Er sollte die übliche std :: sort in seinem Thread ausführen. <br>  * Multithread-Executor - sollte eine parallele Sortierung durchführen; <br>  * GPU-Executor - Er muss die Daten in den Speicher der Grafikkarte verschieben, dort sortieren und die Daten zurückgeben. <br>  * NUMA-Testamentsvollstrecker - ... <br>  * ... <br><br>  Um solche Funktionen zu implementieren, müssen Sie bisher beängstigende Anpassungspunktobjekte (CPO) erstellen und jeden Algorithmus in diese umwandeln.  Dem Ausschuss hat es nicht gefallen ... <br><br>  Zumindest haben sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">das P0443</a> - die Basisschnittstelle - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorab genehmigt</a> .  Alle nachfolgenden Sätze für Testamentsvollstrecker müssen in Form von Patches für P0443 geschrieben werden. <br><br><h2>  Anstelle von Summen </h2><br>  Jetzt sind wir durch nur eine Ausschusssitzung von C ++ 20 getrennt.  Nur noch ein bisschen übrig ... <br><br>  Nun, jeder, der live mit Vertretern des Komitees plaudern möchte - schauen Sie sich die Mitaps und C ++ Konferenzen an <i>(*)</i> : <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Corehard in Minsk</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">C ++ Sibirien 2020</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">C ++ Russland 2020</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">St.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Petersburg C ++ Benutzergruppe</a> <br>  * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">C ++ Meetup 2019 in Moskau</a> <br><br>  <i>(*) Life Hack: Sie müssen kein Konferenzticket bezahlen, wenn Sie Redner sind.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de474716/">https://habr.com/ru/post/de474716/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de474706/index.html">TextRadar Fuzzy Search Algorithmus - Grundlegende Ansätze</a></li>
<li><a href="../de474708/index.html">Das Internet ist fragmentierter als je zuvor: Woher kommen täglich mehr als eine Million neue Benutzer? Teil 1</a></li>
<li><a href="../de474710/index.html">c.tech: Frontend Meetup # 2</a></li>
<li><a href="../de474712/index.html">Udalenka in der IT: persönliche Erfahrung</a></li>
<li><a href="../de474714/index.html">Merkmale des nationalen Einzelhandels oder Wie ich die Stärke der französischen Technologie getestet habe</a></li>
<li><a href="../de474718/index.html">Sicherheit in der Autoelektronik - Hallo Welt auf dem Armaturenbrett-Controller</a></li>
<li><a href="../de474720/index.html">Radiolabor Nischni Nowgorod und Losevs „Cristadins“</a></li>
<li><a href="../de474722/index.html">„Niemand sagt anderen, was sie tun müssen“: Nicolò Ribaudo über die Entwicklung von Babel und mehr</a></li>
<li><a href="../de474724/index.html">Was wird mit PHP in 5 Jahren passieren? Wir haben die Sprecher der nächsten Moskauer Mitap gefragt</a></li>
<li><a href="../de474726/index.html">Sogar Kinder werden verstehen: eine einfache Erklärung von Async / Warten und Versprechen in JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>