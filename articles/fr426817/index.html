<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëö ü§πüèΩ ‚ôìÔ∏è Cl√©s priv√©es et API Web CommuniGate Pro üí≥ üßôüèº üî°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En raison de divers processus, presque tout le monde a maintenant entendu parler d'une chose telle que la substitution des importations. En particulie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cl√©s priv√©es et API Web CommuniGate Pro</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426817/"> En raison de divers processus, presque tout le monde a maintenant entendu parler d'une chose telle que la substitution des importations.  En particulier, le produit MS Exchange import√© est d√©sormais activement remplac√© par le russe natif sans un seul clou * Communigate Pro.  Si mes coll√®gues trouvent le temps, je pense qu'ils peuvent en dire beaucoup sur les clusters, les charges de travail et la migration, mais je veux vous raconter un sang-froid, mais une histoire beaucoup moins compl√®te sur les caract√©ristiques nationales du renouvellement des certificats dans ce merveilleux produit. <br><a name="habracut"></a><br>  En fait, un bref historique.  J'ai un petit ordinateur portable dans un placard sur lequel, jusqu'√† r√©cemment, le serveur de messagerie bourdonnait dans un tas de Windows + hMailServer.  Naturellement, en raison de la substitution des importations, j'ai voulu mieux conna√Ætre Communigate Pro, heureusement, il est tr√®s modeste en termes d'exigences et est gratuit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√† certaines √©chelles</a> : <br><blockquote>  Nous fournissons la version compl√®te de CommuniGate Pro gratuitement pour cinq utilisateurs √† des fins de test et pour une utilisation dans de petits projets (entreprises). </blockquote>  La connaissance peut √™tre d√©marr√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans la section √Ä propos de nous</a> .  Il est tr√®s clair l√†-bas qu'en 1997, le jalon ¬´First reliase¬ª a √©t√© atteint, les sp√©cialistes du marketing Stalker, Inc n'ont appris √† √©crire le mot ¬´Release¬ª qu'en 2004, et ils n'ont toujours pas √©t√© en mesure de produire du mat√©riel de marketing en russe pour le site russe. <br><br><img src="https://habrastorage.org/webt/np/es/m2/npesm2lxdxre5j-xl5kmnbudrku.png"><br><br>  L'installation du produit (je l'ai install√© sur CentOS 7) n'a pas pos√© de probl√®me, saisissant cette opportunit√©, j'y ai mis CertBot, viss√© des certificats de Let's Encrypt et, en g√©n√©ral, tout a d√©marr√©. <br>  Apr√®s 3 mois, les certificats ont expir√© comme pr√©vu et il √©tait temps de les changer. <br><br>  Ensuite, j'ai d√©couvert que Windows apportait un remplacement tr√®s inattendu pour le client Telnet: <br><br><img src="https://habrastorage.org/webt/_d/2m/qv/_d2mqvtmomfo4uiwtgzqugcsare.png"><br><br>  La r√©g√©n√©ration des cl√©s √† l'aide des outils CertBot √©tait ennuyeuse, j'√©tais peut-√™tre satisfait du serveur dns1.yandex.ru, qui, pendant une heure, a donn√© soit le tac-record _acme-challenge obsol√®te ou mis √† jour, √† cause duquel je n'ai pu g√©n√©rer des certificats qu'√† la troisi√®me tentative . <br>  Et puis la magie a commenc√©. <br><br>  Le serveur Communigate n'a pas la possibilit√© de remplacer la paire de cl√©s par une nouvelle via l'interface, vous devez d'abord supprimer l'ancienne paire de cl√©s: <br><br><img src="https://habrastorage.org/webt/qe/fd/6y/qefd6yugaikvsejgwrxuxtxxpr8.png"><br><br>  En tant qu'administrateur h√¥te localhost conscient, j'ai activ√© l'authentification uniquement par SSL et l'ai oubli√© en toute s√©curit√©, donc apr√®s avoir supprim√© la paire de cl√©s, le serveur a refus√© de communiquer avec moi: <br><br><img src="https://habrastorage.org/webt/xc/xl/ip/xcxlip__veye4m7djvoslyq4oxa.png"><br><br>  J'ai d√©sactiv√© le serveur parano√Øaque en ajoutant cette ligne au fichier /var/CommuniGate/Accounts/postmaster.macnt/account.settings: <br> <code>RequireAPOP = NO;</code> <br>  mais, bien s√ªr, les s√©diments sont rest√©s.  Naturellement, je voulais cr√©er un <s>bouton pour</s> moi-m√™me le script pour remplacer la paire de cl√©s par une seule ex√©cution de ce script lui-m√™me, et ne pas tourner en rond selon les param√®tres de l'utilisateur. <br><br>  Les outils d'automatisation de Communigate sont pr√©sents dans jusqu'√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">quatre interfaces</a> : communication de texte via une connexion TCP (PWD), module perle CLI.pm (CG / PL), requ√™tes Web simples et XIMSS. <br><br>  Pour diverses raisons (principalement la paresse, bien s√ªr), j'ai choisi des requ√™tes web. <br><br>  D√®s le d√©but, quelque chose s'est mal pass√©: <br><br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">root</span></span>@<span class="hljs-type"><span class="hljs-type">mx</span></span> ~]<span class="hljs-comment"><span class="hljs-comment"># curl -u postmaster:password -k 'https://127.0.0.1:9100/cli/getdomainsettings' [root@mx ~]#</span></span></code> </pre> <br>  En fin de compte, j'ai lu la documentation avec attention, je devais le faire comme ceci: <br><br><pre> <code class="hljs 1c">[root@mx <span class="hljs-symbol"><span class="hljs-symbol">~]# curl -u postmaster</span></span>:password -k 'https://127.0.0.1:<span class="hljs-number"><span class="hljs-number">9100</span></span>/cli/?command=getdomainsettings' {CAChain=[---];CertificateType=YES;ClientCertCA=<span class="hljs-string"><span class="hljs-string">"Let's Encrypt Authority X3"</span></span>;ClientIPs=<span class="hljs-string"><span class="hljs-string">""</span></span>;DKIMenabled=YES;DKIMkey=[---DKIM];DKIMselector=dkim;DomainComment=<span class="hljs-string"><span class="hljs-string">""</span></span>;IPMode=<span class="hljs-string"><span class="hljs-string">"All Available"</span></span>;PrivateSecureKey=[---];SecureCertificate=[--];TrustedCertificates=();}</code> </pre> <br>  Puis quelque chose s'est mal pass√©: <br><br><pre> <code class="hljs 1c">[root@mx <span class="hljs-symbol"><span class="hljs-symbol">~]# curl -u postmaster</span></span>:password -k 'https://127.0.0.1:<span class="hljs-number"><span class="hljs-number">9100</span></span>/cli/?command=getdomainsettings&amp;domainName=test' {CAChain=[---];CertificateType=YES;ClientCertCA=<span class="hljs-string"><span class="hljs-string">"Let's Encrypt Authority X3"</span></span>;ClientIPs=<span class="hljs-string"><span class="hljs-string">""</span></span>;DKIMenabled=YES;DKIMkey=[---DKIM];DKIMselector=dkim;DomainComment=<span class="hljs-string"><span class="hljs-string">""</span></span>;IPMode=<span class="hljs-string"><span class="hljs-string">"All Available"</span></span>;PrivateSecureKey=[---];SecureCertificate=[--];TrustedCertificates=();}</code> </pre> <br>  J'ai √©t√© perplexe face √† cette tournure des √©v√©nements et je me suis tourn√© vers <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le fournisseur</a> . <br><blockquote>  Comme une publicit√©. <br><br>  Oui, ils ont une salle de chat.  Et les experts y r√©pondent m√™me.  M√™me sans abonnement d'entreprise. </blockquote>  En fait, la requ√™te http ne comprend pas les param√®tres nomm√©s.  Seulement positionnel, seulement hardcore: <br><br><pre> <code class="hljs powershell">[<span class="hljs-type"><span class="hljs-type">root</span></span>@<span class="hljs-type"><span class="hljs-type">mx</span></span> ~]<span class="hljs-comment"><span class="hljs-comment"># curl -u postmaster:password -k 'https://127.0.0.1:9100/cli/?command=getdomainsettings%20test' {} [root@mx ~]#</span></span></code> </pre> <br>  Le domaine de test, conform√©ment √† son nom, est un domaine de test, il n'y a donc aucun param√®tre. <br>  Ensuite, j'ai pr√©sent√© comment j'int√©grerai un certificat dans l'URL et j'ai d√©cid√© que je devais faire quelque chose.  Par exemple, utilisez la demande POST d'une personne en bonne sant√© au lieu de la demande GET du fumeur pour le transfert de donn√©es: <br><br><pre> <code class="hljs kotlin">[<span class="hljs-symbol"><span class="hljs-symbol">root@</span></span>mx ~]# curl -u postmaster:password -k <span class="hljs-string"><span class="hljs-string">'https://127.0.0.1:9100/cli/'</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>-urlencode <span class="hljs-string"><span class="hljs-string">'command=getdomainsettings test'</span></span> {} [<span class="hljs-symbol"><span class="hljs-symbol">root@</span></span>mx ~]#</code> </pre> <br>  Eh bien, jusqu'√† pr√©sent, tout se d√©roule comme pr√©vu. <br><br>  Let's Encrypt conserve ses tr√©sors dans le r√©pertoire /etc/letsencrypt/live/domain.my/ √† partir de l√† et nous les obtiendrons. <br><br>  Un peu plus haut dans la demande getdomainsettings, j'ai vu que la cl√© priv√©e se trouve dans le champ PrivateSecureKey, et qui plus est, elle se trouve avec un en-t√™te et un pied de page mordus, et tout le reste est fusionn√© en une seule ligne.  Essayons de l'importer. <br><br><pre> <code class="hljs xml">[root@mx ~]# curl -u postmaster:password -k 'https://127.0.0.1:9100/cli/' --data-urlencode "command=updatedomainsettings test {PrivateSecureKey=[`grep -v '\-\-' /etc/letsencrypt/live/domain.my/privkey.pem | tr -d '\n'`];}" <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/1999/xhtml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xml:lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ltr"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> domain.my<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/SkinFiles/domain.my/Pronto/style.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"x-dns-prefetch-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"off"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"referrer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"no-referrer"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/SkinFiles/domain.my/Pronto/bodybgcolor.gif"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enctype</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"multipart/form-data"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FormCharset"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">border</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cellspacing</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cellpadding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">valign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"middle"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">align</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bgcolor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#ffcccc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"externalError"</span></span></span><span class="hljs-tag">&gt;</span></span>private key data is corrupted<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> [root@mx ~]#</code> </pre> <br>  Euh ... Eh bien ... je ne m'attendais pas √† √ßa. <br><br>  Je pensais que c'√©tait un certbot, au lieu d'une cl√© priv√©e, j'ai gliss√© quelque chose d'√©trange, j'ai retir√© le contenu du fichier: <br><br><pre> <code class="hljs delphi">[root@mx ~]# cat /etc/letsencrypt/live/domain.my/privkey.pem -----<span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span> KEY-----     -----<span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span> KEY----- [root@mx ~]#</code> </pre> <br>  et ins√©r√© via l'interface web: <br><br><img src="https://habrastorage.org/webt/ie/km/rh/iekmrhlgfgslqh-ahhyi3_c6xoc.png"><br><br>  Du coup, tout s'est bien pass√©: <br><br><img src="https://habrastorage.org/webt/tl/v1/by/tlv1byenkger-3wjctjwcc_i06c.png"><br><br>  J'ai supprim√© la cl√© et j'ai essay√© de l'importer √† nouveau avec une requ√™te HTTP.  Aucun miracle ne s'est produit, <b>les donn√©es de cl√© priv√©e</b> se sont <b>av√©r√©es</b> encore <b>corrompues</b> . <br><br>  Perplexe, je suis de nouveau all√© rendre visite au <s>lapin d'</s> assistance technique.  Le support technique a d√©clar√© que vous devez mordre l'en-t√™te et le pied de page du fichier de cl√© priv√©e et combiner le r√©sultat sur une seule ligne.  Quand j'ai demand√© si j'avais tout fait correctement avec cette commande: <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -v <span class="hljs-string"><span class="hljs-string">'\-\-'</span></span> /etc/letsencrypt/live/domain.my/privkey.pem | <span class="hljs-keyword"><span class="hljs-keyword">tr</span></span> -d <span class="hljs-string"><span class="hljs-string">'\n'</span></span></code> </pre> <br>  L'officier de soutien a r√©pondu qu'il n'√©tait pas un expert en grep et ne savait pas. <br><br>  Au cours du dialogue, j'ai constat√© que si je retirais l'ancienne cl√© avec la demande getdomainsettings, la demande HTTP l'importait normalement, j'ai d√©cid√© que mon grep |  tr mord quelque chose de superflu et dit au revoir √† la salle de chat de Stalker. <br><br>  Mais ce n'√©tait pas si simple.  Apr√®s avoir nettoy√© la cl√© priv√©e manuellement, j'ai constat√© qu'elle n'√©tait pas import√©e de toute fa√ßon. <br><br>  Ici, j'ai err√© dans une impasse finale. <br><br>  Ayant souffert de ce ph√©nom√®ne, j'ai d√©cid√© de cracher et de tout faire manuellement, d'importer la cl√© priv√©e via l'interface web ... Et enfin, j'ai fait une requ√™te getdomainsettings.  Du coup, il s'est av√©r√© que Communigate ne me rendait pas ce que je lui avais donn√© √† manger.  De plus, la cl√© priv√©e Let's Encrypt apr√®s le nettoyage comptait 1624 caract√®res et ce que Communigate m'a montr√© n'√©tait que de 1592. <br><br>  Je n'√©tais pas pr√™t pour un tel virage et suis mont√© dans openssl.  Le premier coup a touch√© la cible: <br><br><pre> <code class="hljs delphi">[root@mx ~]# openssl rsa -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /etc/letsencrypt/live/domain.my/privkey.pem writing RSA key -----<span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> RSA <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span> KEY-----   ,  ,     -----<span class="hljs-keyword"><span class="hljs-keyword">END</span></span> RSA <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span> KEY----- [root@mx ~]#</code> </pre> <br>  Hourra, mission accomplie. <br><br>  Nous n'avions pas besoin de danses avec certificats, ils mordaient juste une t√™te avec un pied de page et les restes √©taient combin√©s sur une seule ligne. <br><br>  Au total, le r√©sultat final ressemble √† ceci pour moi: <br><br><pre> <code class="hljs powershell">curl -<span class="hljs-literal"><span class="hljs-literal">-user</span></span> postmaster:password <span class="hljs-literal"><span class="hljs-literal">-k</span></span> <span class="hljs-string"><span class="hljs-string">'https://127.0.0.1:9100/cli/'</span></span> -<span class="hljs-literal"><span class="hljs-literal">-data</span></span><span class="hljs-literal"><span class="hljs-literal">-urlencode</span></span> <span class="hljs-string"><span class="hljs-string">"command=updatedomainsettings domain.my {SecureCertificate=[`grep -v '\-\-' /etc/letsencrypt/live/domain.my/cert.pem | tr -d '\n'`];PrivateSecureKey=[`openssl rsa -in /etc/letsencrypt/live/domain.my/privkey.pem 2&gt; /dev/null | grep -v '\-\-' | tr -d '\n'`];CAChain=[`grep -v '\-\-' /etc/letsencrypt/live/domain.my/chain.pem | tr -d '\n'`];}"</span></span></code> </pre> <br>  Comme unix-shell n'est pas mon environnement natif, j'appr√©cierai grandement les optimisations. <br><br>  Eh bien, et on ne sait jamais, tout √† coup quelqu'un aura besoin de moi, je ne pourrais pas google √ßa. <br><br>  * les clous dans Communigate Pro sont vraiment introuvables </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426817/">https://habr.com/ru/post/fr426817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426807/index.html">√âcriture du syst√®me d'exploitation: multit√¢che</a></li>
<li><a href="../fr426809/index.html">Zeev Surasky: L'avenir du moteur et du framework Zend</a></li>
<li><a href="../fr426811/index.html">Parkour, danse et travaux de construction de Boston Dynamics</a></li>
<li><a href="../fr426813/index.html">? Skype est devenu un semblant ennuyeux ... et un produit qui vous permet d'avoir un acc√®s complet √† votre syst√®me? Y a-t-il un espoir?</a></li>
<li><a href="../fr426815/index.html">Comment obtenir une bourse de d√©veloppement de projet si vous √™tes un √©tudiant pauvre? Et √ßa vaut le coup</a></li>
<li><a href="../fr426819/index.html">Application r√©active sans Redux / NgRx</a></li>
<li><a href="../fr426821/index.html">Comment organiser CI / CD sur un projet: de la d√©finition des t√¢ches √† la configuration du pipeline de d√©ploiement</a></li>
<li><a href="../fr426825/index.html">Quelques conseils pour les pigistes</a></li>
<li><a href="../fr426831/index.html">Conversation d√©sagr√©able, herp√©tologue et surprise totale</a></li>
<li><a href="../fr426835/index.html">Analyse comparative et d√©taill√©e des plugins de mise en cache pour WordPress</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>