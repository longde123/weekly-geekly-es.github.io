<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ ๐พ ๐ต๐ผ Ceph - ูู "ุนูู ุงูุฑูุจุฉ" ุฅูู "ุฅูุชุงุฌ" ุงูุฌุฒุก 2 ๐ฅ๏ธ ๐คฒ๐ผ ๐๐ผ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(ุงูุฌุฒุก ุงูุฃูู ููุง: https://habr.com/en/post/456446/ ) 
 CEPH 
 ููุฏูุฉ 


 ูุธุฑูุง ูุฃู ุงูุดุจูุฉ ูู ุฃุญุฏ ุงูุนูุงุตุฑ ุงูุฑุฆูุณูุฉ ูู Ceph ุ ููู ูุญุฏุฏุฉ ููููุงู ูู ุดุฑูุชูุง ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ceph - ูู "ุนูู ุงูุฑูุจุฉ" ุฅูู "ุฅูุชุงุฌ" ุงูุฌุฒุก 2</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458390/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  (ุงูุฌุฒุก ุงูุฃูู ููุง: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://habr.com/en/post/456446/</a> ) </p><br><h1 id="ceph" style=";text-align:right;direction:rtl">  CEPH </h1><br><h3 id="vvedenie" style=";text-align:right;direction:rtl">  ููุฏูุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃู ุงูุดุจูุฉ ูู ุฃุญุฏ ุงูุนูุงุตุฑ ุงูุฑุฆูุณูุฉ ูู Ceph ุ ููู ูุญุฏุฏุฉ ููููุงู ูู ุดุฑูุชูุง ุ ูุณูู ูุฎุจุฑู ุฃููุงู ููููุงู ุนููุง. <br>  ุณูููู ููุงู ุนุฏุฏ ุฃูู ุจูุซูุฑ ูู ุฃูุตุงู Ceph ููุณูุง ุ ูุจุตูุฑุฉ ุฃุณุงุณูุฉ ุงูุจููุฉ ุงูุชุญุชูุฉ ููุดุจูุฉ.  ุณูุชู ูุตู ุฎูุงุฏู Ceph ููุท ูุจุนุถ ููุฒุงุช ุฎูุงุฏู Proxmox ุงูุงูุชุฑุงุถูุฉ. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ูุฐูู: ุทูุจูููุฌูุง ุงูุดุจูุฉ ููุณูุง ูุจููุฉ ุนูู ุดูู <strong>ุฃูุฑุงู ุงูุดุฌุฑ.</strong>  ุงูุจููุฉ ุงูููุงุณูููุฉ ุซูุงุซูุฉ ุงูุทุจูุงุช ูู ุดุจูุฉ ุญูุซ ููุฌุฏ <strong>Core</strong> (ุฃุฌูุฒุฉ ุชูุฌูู ุฃุณุงุณูุฉ) ุ <strong>Aggregation</strong> (ุฃุฌูุฒุฉ ุชูุฌูู ุงูุชุฌููุน) ููุชุตูุฉ ูุจุงุดุฑุฉ ูุน ุนููุงุก <strong>Access</strong> (ุฃุฌูุฒุฉ ุชูุฌูู ุงููุตูู): </p><br><p style=";text-align:right;direction:rtl">  <strong>ูุฎุทุท ุซูุงุซุฉ ูุณุชููุงุช</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/yf/e8/cm/yfe8cmp5qspkply3yniplpk53oo.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ูุชููู ุทุจูููุฌูุง ุงูุฃูุฑุงู-ุงูุนููุฏ ุงูููุฑู ูู ูุณุชูููู: <strong>ุงูุนููุฏ ุงูููุฑู</strong> (ุจุงููุนูู ุงูุฑุฆูุณู ูููููุฉ ุงูุฑุฆูุณูุฉ) <strong>ูุงููุฑู</strong> (ุงููุฑูุน). </p><br><p style=";text-align:right;direction:rtl">  <strong>ูุฎุทุท ูุณุชูููู</strong> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/dw/ka/qo/dwkaqo4_ru7urikqyvmv3mqe8ik.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ูู ุงูุชูุฌูู ุงูุฏุงุฎูู ูุงูุฎุงุฑุฌู ูุจูู ุนูู BGP.  ุงููุธุงู ุงูุฑุฆูุณู ุงูุฐู ูุชุนุงูู ูุน ุงูุชุญูู ูู ุงููุตูู ูุงูุฅุนูุงูุงุช ูุงููุฒูุฏ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><strong>XCloud.</strong></a> <br>  ูุชู ุชูุตูู ุฎูุงุฏู ุญุฌุฒ ุงูููุงุฉ (ููุฐูู ูุชูุณูุนูุง) ุจูุญูููู L3 (ูุนุธู ุงูุฎูุงุฏู ูุชุตูุฉ ุจููุงุชูุญ ุงูุชุจุฏูู Leaf ุ ูููู ุจุนุถ ุงูุฎูุงุฏู ุงูุชู ูุฏููุง ุฒูุงุฏุฉ ูู ุญูู ุงูุดุจูุฉ ูุชุตูุฉ ูุจุงุดุฑุฉ ุจู Spine ูููุญูู) ุ ููู ุฎูุงู BGP ุชุนูู ุนู ุนููุงููุง ุฃุญุงุฏู ุงูุฅุฑุณุงู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุนููุงู anycast ููุฎุฏูุฉ ุฅุฐุง ูุงูุช ููุงู ุนุฏุฉ ุฎูุงุฏู ุชุฎุฏู ุญุฑูุฉ ูุฑูุฑ ุงูุฎุฏูุฉ ูููุงุฒูุฉ ECMP ูุงููุฉ ููู.  ููุงู ููุฒุฉ ูููุตูุฉ ููุฐุง ุงููุฎุทุท ุ ูุงูุชู ุณูุญุช ููุง ุจุงูุญูุธ ุนูู ุงูุนูุงููู ุ ูููููุง ุชุชุทูุจ ุฃูุถูุง ูู ุงููููุฏุณูู ุงูุชุนุฑู ุนูู ุนุงูู IPv6 ุ ููู ุงุณุชุฎุฏุงู BGP ุบูุฑ ุงููุนูุงุฑู ุงููุนุชูุฏ ุนูู RFC 5549. ูุจุนุถ ุงูููุช ุ ุชู ุงุณุชุฎุฏุงู Quagga ููุฎูุงุฏู ูู BGP ููุฐุง ุงููุฎุทุท ููุฎูุงุฏู ูุจุดูู ุฏูุฑู ูุงูุช ููุงู ูุดุงูู ูุน ููุฏุงู ุงูุฃุนูุงุฏ ูุงูุงุชุตุงู.  ูููู ุจุนุฏ ุงูุชุจุฏูู ุฅูู FRRouting (ุงูุชู ูุนุฏ ุงููุณุงูููู ุงููุดุทูู ูููุง ููุฑุฏู ูุนุฏุงุช ุงูุดุจูุงุช ูุฏููุง: Cumulus ู XCloudNetworks) ุ ูู ููุงุญุธ ูุซู ูุฐู ุงููุดููุงุช ุจุนุฏ ุงูุขู. </p><br><p style=";text-align:right;direction:rtl">  ููุฑุงุญุฉ ุ ูุญู ูุณูู ูุฐุง ุงููุฎุทุท ุงูุนุงู ุจุฃูููู "ูุตูุน". </p><br><h2 id="poisk-puti" style=";text-align:right;direction:rtl">  ุงูุจุญุซ ุนู ูุณููุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุฎูุงุฑุงุช ุชูููู ุดุจูุฉ ุงููุชูุฉ: </p><br><p style=";text-align:right;direction:rtl">  1) ุงูุดุจูุฉ ุงูุซุงููุฉ ุนูู BGP </p><br><p style=";text-align:right;direction:rtl">  2) ุงูุดุจูุฉ ุงูุซุงููุฉ ุนูู ุงุซููู ูู ููุงุชูุญ ูููุตูุฉ ููุฏุณุฉ ูุน LACP </p><br><p style=";text-align:right;direction:rtl">  3) ุงูุดุจูุฉ ุงูุซุงููุฉ ุนูู ุงุซููู ูู ููุงุชูุญ ูููุตูุฉ ูุนุฒููุฉ ูุน OSPF </p><br><h3 id="testy" style=";text-align:right;direction:rtl">  ุงุฎุชุจุงุฑุงุช </h3><br><p style=";text-align:right;direction:rtl">  ุฃุฌุฑูุช ุงูุงุฎุชุจุงุฑุงุช ูู ููุนูู: </p><br><p style=";text-align:right;direction:rtl">  ุฃ) ุดุจูุฉ ุชุณุชุฎุฏู ุฃุฏูุงุช iperf ู qperf ู nuttcp </p><br><p style=";text-align:right;direction:rtl">  ุจ) ุงูุงุฎุชุจุงุฑุงุช ุงูุฏุงุฎููุฉ Ceph cob-gobench ุ rados bench ุ ุฅูุดุงุก rbd ูุงุฎุชุจุงุฑูุง ุจุงุณุชุฎุฏุงู dd ูู ูุงุญุฏ ุฃู ุนุฏุฉ ูุคุดุฑุงุช ุชุฑุงุจุท ุ ุจุงุณุชุฎุฏุงู fio </p><br><p style=";text-align:right;direction:rtl">  ุชู ุฅุฌุฑุงุก ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุนูู ุฃุฌูุฒุฉ ุงูุงุฎุชุจุงุฑ ุจุงุณุชุฎุฏุงู ุฃูุฑุงุต SAS.  ูู ูุชู ุงููุธุฑ ุฅูู ุงูุฃุฑูุงู ูู ุฃุฏุงุก rbd ูุซูุฑูุง ุ ููุฏ ุชู ุงุณุชุฎุฏุงููุง ููุท ููููุงุฑูุฉ.  ููุชู ุจุงูุชุบููุฑุงุช ุงุนุชูุงุฏูุง ุนูู ููุน ุงูุงุชุตุงู. </p><br><h3 id="pervyy-variant" style=";text-align:right;direction:rtl">  ุงูุฎูุงุฑ ุงูุฃูู </h3><br><p style=";text-align:right;direction:rtl">  <strong>ูุชู ุชูุตูู ุจุทุงูุงุช ุงูุดุจูุฉ ุฅูู ุงููุตูุน ุ ุชูููู BGP.</strong> </p><br><p style=";text-align:right;direction:rtl">  ูุง ูุนุชุจุฑ ุงุณุชุฎุฏุงู ูุฐุง ุงููุฎุทุท ููุดุจูุฉ ุงูุฏุงุฎููุฉ ูู ุงูุฎูุงุฑ ุงูุฃูุถู: </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุงูุนุฏุฏ ุงูุฒุงุฆุฏ ูู ุงูุนูุงุตุฑ ุงููุณูุทุฉ ูู ุดูู ููุงุชูุญ ุชุนุทู ุฒูู ุงูุชูุงู ุฅุถุงูู (ูุงู ูุฐุง ูู ุงูุณุจุจ ุงูุฑุฆูุณู). <br>  ุซุงููุงู ุ ูู ุงูุจุฏุงูุฉ ุ ูุฅุธูุงุฑ ุงูุฅุญุตุงุฆูุงุช ูู ุฎูุงู s3 ุ ุงุณุชุฎุฏููุง ุนููุงู ุฃู ุจุซ ุชู ุฑูุนู ุนูู ุงูุนุฏูุฏ ูู ุงูุฃุฌูุฒุฉ ุจุงุณุชุฎุฏุงู radosgateway.  ููุฏ ุฃุฏู ุฐูู ุฅูู ุญูููุฉ ุฃู ุญุฑูุฉ ุงููุฑูุฑ ูู ุงูุขูุงุช ุงูุฃูุงููุฉ ุฅูู RGW ูู ูุชู ุชูุฒูุนูุง ุจุงูุชุณุงูู ุ ูููู ูุฑุช ุนูู ุฃูุตุฑ ุงูุทุฑู - ููุฐุง ูุนูู ุฃู ูุงุฌูุฉ Nginx ุงูุฃูุงููุฉ ุชุชุญูู ุฏุงุฆููุง ุฅูู ููุณ ุงูุนูุฏุฉ ูุน RGW ุงูุชู ูุงูุช ูุฑุชุจุทุฉ ุจูุฑูุฉ ูุดุชุฑูุฉ ูุนูุง (ูุฐุง ุ ุจุงูุทุจุน ุ ูุงู ููุณ ุงูุญุฌุฉ ุงูุฑุฆูุณูุฉ - ููุฏ ุฑูุถูุง ูู ููุช ูุงุญู ูู ุนูุงููู anycast ููุนูุฏุฉ ุซุงุจุชุฉ).  ููู ูู ุฃุฌู ููุงุก ุงูุชุฌุฑุจุฉ ุ ูุฑุฑูุง ุฅุฌุฑุงุก ุงุฎุชุจุงุฑุงุช ุนูู ูุซู ูุฐุง ุงููุฎุทุท ูู ุฃุฌู ุงูุญุตูู ุนูู ุจูุงูุงุช ููููุงุฑูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุง ุฎุงุฆููู ูู ุฅุฌุฑุงุก ุงุฎุชุจุงุฑุงุช ูููุทุงู ุงูุชุฑุฏุฏู ุจุฃูููู ุ ูุธุฑูุง ูุฃู ุงููุตูุน ูุณุชุฎุฏู ุจูุงุณุทุฉ ุฎูุงุฏู prod ุ ูุฅุฐุง ูููุง ุจุญุธุฑ ุงูุฑูุงุจุท ุจูู ุงูุฃูุฑุงู ูุงูุนููุฏ ุงูููุฑู ุ ูุฅู ูุฐุง ุณูุถุฑ ุจุจุนุถ ุงููุจูุนุงุช. <br>  ูู ุงููุงูุน ุ ูุงู ูุฐุง ุณุจุจูุง ุขุฎุฑ ูุฑูุถ ูุซู ูุฐุง ุงููุฎุทุท. <br>  ุชู ุงุณุชุฎุฏุงู ุงุฎุชุจุงุฑุงุช Iperf ุจุญุฏ ุฃูุตู ูุฏุฑู 3bbps ูู BW ูู 1 ู 10 ู 100 ุชุฏููุงุช ููููุงุฑูุฉ ูุน ูุฎุทุทุงุช ุฃุฎุฑู. <br>  ุฃุธูุฑุช ุงูุงุฎุชุจุงุฑุงุช ุงููุชุงุฆุฌ ุงูุชุงููุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/0a5/257/66b/0a525766bf7e61ffc4ba1129db0d17fd.png"></p><br><p style=";text-align:right;direction:rtl">  ูู <strong>1</strong> ุฏูู ุชูุฑูุจูุง <strong>9.30 - 9.43 ุบูุบุงุจุช / ุซุงููุฉ</strong> (ูู ูุฐู ุงูุญุงูุฉ ุ ูุฒุฏุงุฏ ุนุฏุฏ ุนูููุงุช ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู ุจููุฉ ุ ุฅูู <strong>39148</strong> ).  ุงูุฑูู ุงูุฐู ุชุจูู ุฃูู ูุฑูุจ ูู ุงูุญุฏ ุงูุฃูุตู ูููุงุฌูุฉ ุงููุงุญุฏุฉ ููุญู ุจุงุณุชุฎุฏุงู ูุงุญุฏ ูู ุงูุงุซููู.  ุนุฏุฏ ูุฑุงุช ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู ุญูุงูู <strong>500-600.</strong> <br>  <strong>10</strong> ุชุฏููุงุช ุชุจูุบ <strong>9.63 ุฌูุฌุงุจุช / ุซุงููุฉ</strong> ููู ูุงุฌูุฉ ุ ุจูููุง ุงุฑุชูุน ุนุฏุฏ ุนูููุงุช ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู ุฅูู ูุชูุณุท <strong>17045.</strong> <br>  ูู <strong>100 ููุถูุน</strong> ุ ูุงูุช ุงููุชูุฌุฉ ุฃุณูุฃ ูู <strong>10</strong> ุ ุจูููุง ูุงู ุนุฏุฏ ุนูููุงุช ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู ุฃูู: ูุชูุณุท โโุงููููุฉ ูู <strong>3354</strong> </p><br><h3 id="vtoroy-variant" style=";text-align:right;direction:rtl">  ุงูุฎูุงุฑ ุงูุซุงูู </h3><br><p style=";text-align:right;direction:rtl">  <strong>LACP</strong> </p><br><p style=";text-align:right;direction:rtl">  ูุงู ููุงู ุงุซููู ูู ููุงุชูุญ ุฌูููุจุฑ EX4500.  ูุงููุง ุจุฌูุนูุง ุนูู ุงูููุฏุณ ุ ูุฑุจุทูุง ุงูุฎุงุฏู ุจุงููุตูุงุช ุงูุฃููู ูููุชุงุญ ูุงุญุฏ ุ ูุงูุซุงูู ุฅูู ุงูุซุงูู. <br>  ูุงู ุฅุนุฏุงุฏ ุงูุฑุจุท ุงูุฃููู ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">root@ceph01-test:~# cat /etc/network/interfaces auto ens3f0 iface ens3f0 inet manual bond-master bond0 post-up /sbin/ethtool -G ens3f0 rx 8192 post-up /sbin/ethtool -G ens3f0 tx 8192 post-up /sbin/ethtool -L ens3f0 combined 32 post-up /sbin/ip link set ens3f0 txqueuelen 10000 mtu 9000 auto ens3f1 iface ens3f1 inet manual bond-master bond0 post-up /sbin/ethtool -G ens3f1 rx 8192 post-up /sbin/ethtool -G ens3f1 tx 8192 post-up /sbin/ethtool -L ens3f1 combined 32 post-up /sbin/ip link set ens3f1 txqueuelen 10000 mtu 9000 auto bond0 iface bond0 inet static address 10.10.10.1 netmask 255.255.255.0 slaves none bond_mode 802.3ad bond_miimon 100 bond_downdelay 200 bond_xmit_hash_policy 3 #(layer3+4 ) mtu 9000</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุธูุฑุช ุงุฎุชุจุงุฑุงุช iperf ู qperf ุฃู ูุฒู ุงูุฌุณู ูุตู ุฅูู <strong>16 ุฌูุฌุงุจุช / ุซุงููุฉ.</strong>  ูุฑุฑูุง ููุงุฑูุฉ ุฃููุงุน ูุฎุชููุฉ ูู ูุฒุงุฑุฉ ุงูุฏูุงุน: <br>  <strong>ุต ุต ุ ุงูุชูุงุฒู xor ู 802.3ad.</strong>  ููุฏ ูุงุฑูุง ุฃูุถูุง ุฃููุงุนูุง ูุฎุชููุฉ ูู ุงูุชุฌุฒุฆุฉ <strong>2 + 3 ู layer3 + 4</strong> (ุนูู ุฃูู ุงูุญุตูู ุนูู ููุฒุฉ ูู ุญูุณุจุฉ ุงูุชุฌุฒุฆุฉ). <br>  ููุฏ ูุงุฑูุง ุฃูุถูุง ุงููุชุงุฆุฌ ุงูุฎุงุตุฉ ุจููู sysctl ุงููุฎุชููุฉ ูููุชุบูุฑ <strong>net.ipv4.fib_multipath_hash_policy ุ</strong> (ุฌูุฏูุง ุ ููุฏ ูุนุจูุง ููููุงู ูุน <strong>net.ipv4.tcp_congestion_control</strong> ุ ุนูู ุงูุฑุบู ูู ุฃูู ูุง ุนูุงูุฉ ูู <strong>ุจุงูุชุฑุงุจุท</strong> . ููุฌุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงู ุฌูุฏ ุญูู ValdikSS</a> ููุฐุง ุงููุชุบูุฑ)). </p><br><p style=";text-align:right;direction:rtl">  ููู ูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุ ูู ููุฌุญ ุฐูู ูู ุชุฌุงูุฒ ุนุชุจุฉ <strong>18 ุฌูุฌุงุจุช / ุซุงููุฉ</strong> (ุชู ุชุญููู ูุฐุง ุงูุฑูู ุจุงุณุชุฎุฏุงู <strong>ุงูููุฒุงู xor ู 802.3ad</strong> ุ ููู ููู ููุงู ูุฑู ูุจูุฑ ุจูู ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ) ููุฏ ุชู ุชุญููู ูุฐู ุงููููุฉ "ูู ุงูููุฒ" ุจูุงุณุทุฉ ุฑุดูุงุช ูุงุฑูุฉ. </p><br><h3 id="tretiy-variant" style=";text-align:right;direction:rtl">  ุงูุฎูุงุฑ ุงูุซุงูุซ </h3><br><p style=";text-align:right;direction:rtl">  <strong>OSPF</strong> </p><br><p style=";text-align:right;direction:rtl">  ูุชูููู ูุฐุง ุงูุฎูุงุฑ ุ ุชูุช ุฅุฒุงูุฉ LACP ูู ุงููุญููุงุช (ุชู ุชุฑู ุงูุชุฑุงุต ุ ูููู ุชู ุงุณุชุฎุฏุงูู ููุท ููุฅุฏุงุฑุฉ).  ุนูู ูู ุฑูุฒ ุชุจุฏูู ุ ูุงููุง ุจุฌูุน ุดุจูุฉ ูุญููุฉ ุธุงูุฑูุฉ ูููุตูุฉ ููุฌููุนุฉ ูู ุงูููุงูุฐ (ูุน ูุฑุงุนุงุฉ ุงููุณุชูุจู ุงูุฐู ุณูุชู ููู ุชุนููู ุฎูุงุฏู QA ู PROD ูู ููุณ ุงููุญููุงุช). </p><br><p style=";text-align:right;direction:rtl">  ุชูููู ุดุจูุชูู ุฎุงุตุฉ ูุณุทุญุฉ ููู ุดุจูุฉ ูุญููุฉ ุธุงูุฑูุฉ (ูุงุฌูุฉ ูุงุญุฏุฉ ููู ุฑูุฒ ุงูุชุจุฏูู).  ูู ุฃุนูู ูุฐู ุงูุนูุงููู ุ ูุชู ุงูุฅุนูุงู ุนู ุนููุงู ุขุฎุฑ ูู ุงูุดุจูุฉ ุงูุฎุงุตุฉ ุงูุซุงูุซุฉ ุ ููู ุดุจูุฉ ุงููุฌููุนุฉ ูู CEPH. </p><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃู <em>ุงูุดุจูุฉ ุงูุนุงูุฉ</em> (ุงูุชู ูุณุชุฎุฏู ูู ุฎูุงููุง SSH) ุชุนูู ุนูู BGP ุ ููุฏ ุงุณุชุฎุฏููุง frr ูุชูููู OSPF ุ ุงูููุฌูุฏ ุจุงููุนู ุนูู ุงููุธุงู. </p><br><p style=";text-align:right;direction:rtl">  <strong>10.10.10.0/24 ู 20.20.20.0/24</strong> - <strong>ุดุจูุชุงู ุซุงุจุชุชุงู</strong> ุนูู ุงูููุงุชูุญ </p><br><p style=";text-align:right;direction:rtl">  <strong>172.16.1.0/24</strong> - ุดุจูุฉ ููุฅุนูุงู </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/t5/c5/fp/t5c5fpxxwqv7u82ywsvkuumcsag.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ ุงูุฌูุงุฒ: <br>  ูุงุฌูุงุช <strong>ens1f0 ens1f1</strong> ููุธุฑ ุฅูู ุดุจูุฉ ุฎุงุตุฉ <br>  ูุงุฌูุงุช <strong>ens4f0 ens4f1</strong> ููุธุฑ ุฅูู ุงูุดุจูุฉ ุงูุนุงูุฉ </p><br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุชูููู ุงูุดุจูุฉ ุนูู ุงูุฌูุงุฒ ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">oot@ceph01-test:~# cat /etc/network/interfaces # This file describes the network interfaces available on your system # and how to activate them. For more information, see interfaces(5). source /etc/network/interfaces.d/* # The loopback network interface auto lo iface lo inet loopback auto ens1f0 iface ens1f0 inet static post-up /sbin/ethtool -G ens1f0 rx 8192 post-up /sbin/ethtool -G ens1f0 tx 8192 post-up /sbin/ethtool -L ens1f0 combined 32 post-up /sbin/ip link set ens1f0 txqueuelen 10000 mtu 9000 address 10.10.10.1/24 auto ens1f1 iface ens1f1 inet static post-up /sbin/ethtool -G ens1f1 rx 8192 post-up /sbin/ethtool -G ens1f1 tx 8192 post-up /sbin/ethtool -L ens1f1 combined 32 post-up /sbin/ip link set ens1f1 txqueuelen 10000 mtu 9000 address 20.20.20.1/24 auto ens4f0 iface ens4f0 inet manual post-up /sbin/ethtool -G ens4f0 rx 8192 post-up /sbin/ethtool -G ens4f0 tx 8192 post-up /sbin/ethtool -L ens4f0 combined 32 post-up /sbin/ip link set ens4f0 txqueuelen 10000 mtu 9000 auto ens4f1 iface ens4f1 inet manual post-up /sbin/ethtool -G ens4f1 rx 8192 post-up /sbin/ethtool -G ens4f1 tx 8192 post-up /sbin/ethtool -L ens4f1 combined 32 post-up /sbin/ip link set ens4f1 txqueuelen 10000 mtu 9000 #     loopback-: auto lo:0 iface lo:0 inet static address 55.66.77.88/32 dns-nameservers 55.66.77.88 auto lo:1 iface lo:1 inet static address 172.16.1.1/32</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชููููุงุช frr ุชุจุฏู ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">root@ceph01-test:~# cat /etc/frr/frr.conf frr version 6.0 frr defaults traditional hostname ceph01-prod log file /var/log/frr/bgpd.log log timestamp precision 6 no ipv6 forwarding service integrated-vtysh-config username cumulus nopassword ! interface ens4f0 ipv6 nd ra-interval 10 ! interface ens4f1 ipv6 nd ra-interval 10 ! router bgp 65500 bgp router-id 55.66.77.88 # ,       timers bgp 10 30 neighbor ens4f0 interface remote-as 65001 neighbor ens4f0 bfd neighbor ens4f1 interface remote-as 65001 neighbor ens4f1 bfd ! address-family ipv4 unicast redistribute connected route-map redis-default exit-address-family ! router ospf ospf router-id 172.16.0.1 redistribute connected route-map ceph-loopbacks network 10.10.10.0/24 area 0.0.0.0 network 20.20.20.0/24 area 0.0.0.0 ! ip prefix-list ceph-loopbacks seq 10 permit 172.16.1.0/24 ge 32 ip prefix-list default-out seq 5 permit 0.0.0.0/0 ge 32 ! route-map ceph-loopbacks permit 10 match ip address prefix-list ceph-loopbacks ! route-map redis-default permit 10 match ip address prefix-list default-out ! line vty !</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูุฅุนุฏุงุฏุงุช ุ ุชุฎุชุจุฑ ุงูุดุจูุฉ iperf ุ qperf ุ ุฅูุฎ.  ุฃุธูุฑ ุฃูุตู ุงุณุชุฎุฏุงู ููููุงุชูู ุนูุฏ <strong>19.8 ุฌูุฌุงุจุช / ุซุงููุฉ ุ ูู</strong> ุญูู ุงูุฎูุถ ุงููููู ุฅูู <strong>20us</strong> </p><br><p style=";text-align:right;direction:rtl">  <em>ุญูู <strong>ูุนุฑู ุฌูุงุฒ ุงูุชูุฌูู Bgp:</strong> ูุณุชุฎุฏู ูุชุญุฏูุฏ ุงูุนูุฏุฉ ุนูุฏ ูุนุงูุฌุฉ ูุนูููุงุช ุงูุชูุฌูู ูุจูุงุก ุงูุทุฑู.</em>  <em>ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ุฐูู ูู ุงูุชูููู ุ ูุชู ุชุญุฏูุฏ ุฃุญุฏ ุนูุงููู IP ูููุถูู.</em>  <em>ูุฏ ูููู ูุฏู ูุฎุชูู ุงูุดุฑูุงุช ุงููุตูุนุฉ ููุฃุฌูุฒุฉ ูุงูุจุฑุงูุฌ ุฎูุงุฑุฒููุงุช ูุฎุชููุฉ ุ ููู ุญุงูุชูุง ุงุณุชุฎุฏู FRR ุฃูุจุฑ ุนููุงู IP ูุงุณุชุฑุฌุงุน ุงูุจูุงูุงุช.</em>  <em>ูุฐุง ุฃุฏู ุฅูู ูุดููุชูู:</em> <em><br></em>  <em>1) ุฅุฐุง ุญุงูููุง ุชุนููู ุนููุงู ุขุฎุฑ (ุนูู ุณุจูู ุงููุซุงู ุ ุฎุงุต ูู ุงูุดุจูุฉ 172.16.0.0) ุฃูุซุฑ ูู ุงูุนููุงู ุงูุญุงูู ุ ููุฏ ุฃุฏู ุฐูู ุฅูู ุชุบููุฑ <strong>ูุนุฑู ุฌูุงุฒ ุงูุชูุฌูู</strong> ุ ูุจุงูุชุงูู ุฅูู ุฅุนุงุฏุฉ ุชุซุจูุช ุงูุฏูุฑุงุช ุงูุญุงููุฉ.</em>  <em>ูุฐุง ูุนูู ุงุณุชุฑุงุญุฉ ูุตูุฑุฉ ูููุฏุงู ุงุชุตุงู ุงูุดุจูุฉ.</em> <em><br></em>  <em>2) ุฅุฐุง ุญุงูููุง ุชุนููู ุฃู ุนููุงู ููุจุซ ูุดุชุฑู ุจูู ุนุฏุฉ ุฃุฌูุฒุฉ ูุชู ุงุฎุชูุงุฑู ููุนุฑูู ูุฌูุงุฒ <strong>ุงูุชูุฌูู</strong> ุ ูุณุชุธูุฑ ุนูุฏุชุงู ุจููุณ <strong>ูุนุฑู ุฌูุงุฒ ุงูุชูุฌูู</strong> ุนูู ุงูุดุจูุฉ <strong>.</strong></em> </p><br><h2 id="chast-2" style=";text-align:right;direction:rtl">  ุงูุฌุฒุก 2 </h2><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงุฎุชุจุงุฑ QA ุ ุจุฏุฃูุง ูู ุชุฑููุฉ Ceph ุงููุชุงููุฉ. </p><br><h3 id="network" style=";text-align:right;direction:rtl">  NETWORK </h3><br><h3 id="pereezd-s-odnoy-seti-na-dve" style=";text-align:right;direction:rtl">  ุงูุงูุชูุงู ูู ุดุจูุฉ ูุงุญุฏุฉ ุฅูู ุงุซููู </h3><br><p style=";text-align:right;direction:rtl">  ูุนููุฉ ุดุจูุฉ ุงููุชูุฉ ูู ูุงุญุฏุฉ ูู ุชูู ุงูุชู ูุง ูููู ุชุบููุฑูุง <strong>ุจุณุฑุนุฉ</strong> ุฃุซูุงุก ุชุญุฏูุฏ OSD ุนุจุฑ <strong>ceph tell osd. * Injectargs.</strong>  ูุนุฏ ุชุบููุฑู ูู ุงูุชูููู ูุฅุนุงุฏุฉ ุชุดุบูู ุงููุฌููุนุฉ ุจุฃููููุง ุญูุงู ููุจูููุง ุ ููููู ุญููุง ูู ุฃูู ุฃุฑุบุจ ูู ุงูุญุตูู ุนูู ูุชุฑุฉ ุชููู ุตุบูุฑุฉ.  ูู ุงููุณุชุญูู ุฃูุถูุง ุฅุนุงุฏุฉ ุชุดุบูู OSD ูุงุญุฏ ุจุงุณุชุฎุฏุงู ูุนููุฉ ุดุจูุฉ ุฌุฏูุฏุฉ - ูู ููุช ูุง ูุงู ูู ุงููููู ุฃู ูููู ูุฏููุง ูุฌููุนุชุงู ูุตููุชุงู - OSDs ูุฏููุฉ ุนูู ุงูุดุจูุฉ ุงููุฏููุฉ ุ ูุฃุฎุฑู ุฌุฏูุฏุฉ ุนูู ูุงุญุฏุฉ ุฌุฏูุฏุฉ.  ูุญุณู ุงูุญุธ ุ ูุฅู ุงููุนููุฉ ุดุจูุฉ ุงููุชูุฉ (ููุฐูู public_network ุ ุจุงูููุงุณุจุฉ) ูู ูุงุฆูุฉ ุ ููุฐุง ูู ุ ููููู ุชุญุฏูุฏ ุงูุนุฏูุฏ ูู ุงูููู.  ูุฑุฑูุง ุงูุงูุชูุงู ุชุฏุฑูุฌูุงู - ุฃููุงู ุฃุถู ุดุจูุฉ ุฌุฏูุฏุฉ ุฅูู ุงูุชููููุงุช ุ ุซู ุฃุฒู ุงูุดุจูุฉ ุงููุฏููุฉ.  ููุฑ Ceph ุนุจุฑ ูุงุฆูุฉ ุงูุดุจูุงุช ุจุงูุชุชุงุจุน - ูุจุฏุฃ OSD ุงูุนูู ุฃููุงู ูุน ุงูุดุจูุฉ ุงููุณุฑุฏุฉ ุฃููุงู. </p><br><p style=";text-align:right;direction:rtl">  ูุงูุช ุงูุตุนูุจุฉ ูู ุฃู ุงูุดุจูุฉ ุงูุฃููู ุนููุช ูู ุฎูุงู bgp ููุงูุช ูุชุตูุงู ุจููุชุงุญ ูุงุญุฏ ุ ูุงูุซุงููุฉ - ุฅูู ospf ููุชุตูุฉ ุจุฃุฎุฑู ูู ุชูู ูุชุตูุฉ ูุนูููุง ุจุงูุฃูู.  ูู ููุช ุงูุงูุชูุงู ุ ูุงู ูู ุงูุถุฑูุฑู ุฃู ูููู ูุฏูู ูุตูู ูุคูุช ููุดุจูุฉ ุจูู ุงูุดุจูุชูู.  ูุงูุช ุฎุตูุตูุฉ ุฅุนุฏุงุฏ ุงููุตูุน ูู ุฃูู ูุง ูููู ุชูููู ููุงุฆู ACL ุนูู ุงูุดุจูุฉ ุฅุฐุง ูู ุชูู ูุฏุฑุฌุฉ ูู ูุงุฆูุฉ ุงูุฅุนูุงูุงุช ุงููุนูู ุนููุง (ูู ูุฐู ุงูุญุงูุฉ ุ ุชููู "ุฎุงุฑุฌูุฉ" ููุง ูููู ุฅูุดุงุก ููุงุฆู ACL ููุง ุฎุงุฑุฌููุง. ุชู ุฅูุดุงุคูุง ุนูู spains ุ ูููููุง ูู ุชุตู ุนูู ุงูุฃูุฑุงู). </p><br><p style=";text-align:right;direction:rtl">  ูุงู ุงูุญู ุนูุงุฒูุง ููุนูุฏูุง ุ ูููู ูุฌุญ: ุงูุฅุนูุงู ุนู ุงูุดุจูุฉ ุงูุฏุงุฎููุฉ ุนุจุฑ bgp ุ ุจุงูุชุฒุงูู ูุน ospf. </p><br><p style=";text-align:right;direction:rtl">  ุชุณูุณู ุงูุงูุชูุงู ููุง ููู: </p><br><p style=";text-align:right;direction:rtl">  1) ุชูููู ุดุจูุฉ ุงููุชูุฉ ูู ceph ุนูู ุดุจูุชูู: ูู ุฎูุงู bgp ููู ุฎูุงู ospf <br>  ูู ุงูุชููููุงุช frr ุ ูู ููู ูู ุงูุถุฑูุฑู ุชุบููุฑ ุฃู ุดูุก ุ ุฎุท </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ip prefix-list default-out seq 5 permit 0.0.0.0/0 ge 32</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ูุญุฏูุง ูู ุงูุนูุงููู ุงููุนููุฉ ุ ูุชู ุฑูุน ุนููุงู ุงูุดุจูุฉ ุงูุฏุงุฎููุฉ ููุณูุง ุนูู ูุงุฌูุฉ ุงูุงุณุชุฑุฌุงุน ุ ูุงู ูููู ูุชูููู ุงุณุชูุจุงู ุฅุนูุงู ูุฐุง ุงูุนููุงู ุนูู ุฃุฌูุฒุฉ ุงูุชูุฌูู. </p><br><p style=";text-align:right;direction:rtl">  2) ุฅุถุงูุฉ ุดุจูุฉ ุฌุฏูุฏุฉ ุฅูู ุงูุชูููู <strong>ceph.conf</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">cluster network = 172.16.1.0/24, 55.66.77.88/27</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงุจุฏุฃ ูู ุฅุนุงุฏุฉ ุชุดุบูู OSD ูุงุญุฏูุง ูู ูู ูุฑุฉ ุญุชู <strong>ููุชูู</strong> ุงูุฌููุน <strong>ุฅูู</strong> ุดุจูุฉ <strong>172.16.1.0/24.</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">root@ceph01-prod:~#ceph osd set noout # -          OSD #     .  ,     #  , OSD      30 . root@ceph01-prod:~#for i in $(ps ax | grep osd | grep -v grep| awk '{ print $10}'); \ root@ceph01-prod:~# do systemctl restart ceph-osd@$i; sleep 30; done</code> </pre> <br><p style=";text-align:right;direction:rtl">  3) ุซู ูุฒูู ุงูุดุจูุฉ ุงูุฒุงุฆุฏุฉ ูู ุงูุชูููู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">cluster network = 172.16.1.0/24</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฑุฑ ุงูุฅุฌุฑุงุก. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก ุ ุงูุชูููุง ุจุณูุงุณุฉ ุฅูู ุดุจูุฉ ุฌุฏูุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงููุฑุงุฌุน: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://shalaginov.com/2016/03/26/--leaf-spine/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://www.xcloudnetworks.com/case-studies/innova-case-study/</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/rumanzo/ceph-gobench</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar458390/">https://habr.com/ru/post/ar458390/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar458376/index.html">ููุณุช ูุบุฉ ุจุฑูุฌุฉ ุฃุฎุฑู. ุงูุฌุฒุก 1: ููุทู ุงููุฌุงู</a></li>
<li><a href="../ar458378/index.html">ุจุงุณุชุฎุฏุงู Avocode ูุชุฎุทูุท ุงููููุน. ูุฑุงุฌุนุฉ ูููุจุชุฏุฆูู. ููุงูุฃุฉ - ุชุณุฌูู ูุชุฑุฉ ุชุฌุฑูุจูุฉ ููุฏุฉ 30 ูููุง</a></li>
<li><a href="../ar458382/index.html">ููุงุฐุง ูุนูู ูุฐุงุ</a></li>
<li><a href="../ar458384/index.html">HP 3D ููุธู ุถูุก ุงููุงุณุญ ุงูุถูุฆู S3 ูุฑุงุฌุนุฉ ูุงุฎุชุจุงุฑ</a></li>
<li><a href="../ar458388/index.html">ุนููู (ุงูุชุนูู + ุนุดูุงุฆูุฉ) ุงูุบุงุจุงุช ูููุงู ุชุญููู</a></li>
<li><a href="../ar458396/index.html">ููู ุฌุนูุช ุงูุชุทููุฑ ุนูู Vue.js ููุงุณุจูุง ูุน ุงูุชูุฏูู ูู ุฌุงูุจ ุงูุฎุงุฏู</a></li>
<li><a href="../ar458398/index.html">ูุธุงูุฉ ุงูุนูู ุนู ุจุนุฏ ุฃู ููุงุฆุฏ ุงูุชุฎุงุทุฑ</a></li>
<li><a href="../ar458400/index.html">ุจููุฉ ูุชูููุฐ ุฎุฏูุงุช Microservices ุฎุทูุฉ ุจุฎุทูุฉ ุงูุฌุฒุก 1</a></li>
<li><a href="../ar458404/index.html">ุงูุงูุชูุงู ูู ูุชุฑุงุตุฉ ุฅูู ุงูุฎุฏูุงุช ุงูุตุบูุฑุฉ: ุงูุชุงุฑูุฎ ูุงูููุงุฑุณุฉ</a></li>
<li><a href="../ar458408/index.html">ุงูุฃูู ุงูุฃุณุจูุน 27: ููุงุท ุงูุถุนู ูุถุฎุฉ ุงูุฃูุณูููู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>