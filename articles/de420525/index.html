<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ì üë©üèæ‚Äçü§ù‚Äçüë®üèø ü§ôüèΩ Netzwerke f√ºr die erfahrensten. Teil f√ºnfzehn. QoS üí∞ üë©üèø‚Äçü§ù‚Äçüë®üèº üèóÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SDSM-15. √úber QoS. Jetzt mit der M√∂glichkeit Pull-Anfragen . 

 Und so kamen wir zum Thema QoS. 

 Wissen Sie, warum erst jetzt und warum es der Absch...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Netzwerke f√ºr die erfahrensten. Teil f√ºnfzehn. QoS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420525/">  SDSM-15.  √úber QoS.  Jetzt mit der M√∂glichkeit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pull-Anfragen</a> . <br><br>  Und so kamen wir zum Thema QoS. <br><br>  Wissen Sie, warum erst jetzt und warum es der Abschlussartikel des gesamten SDSM-Kurses sein wird?  Weil QoS ungew√∂hnlich komplex ist.  Das Schwierigste, was es zuvor im Zyklus gab. <br><br>  Dies ist keine Art magischer Archivierer, der den Datenverkehr im laufenden Betrieb geschickt komprimiert und Ihren Gigabit in einen 100-Megabit-Uplink verwandelt.  Bei QoS geht es darum, etwas Unn√∂tiges zu opfern und das Ungenie√übare in den Rahmen des Zul√§ssigen zu dr√§ngen. <br><br>  QoS ist so in die Aura des Schamanismus und der Unzug√§nglichkeit verstrickt, dass alle jungen (und nicht nur) Ingenieure versuchen, seine Existenz sorgf√§ltig zu ignorieren, weil sie glauben, dass es ausreicht, Probleme mit Geld zu werfen und die Verbindungen endlos zu erweitern.  Es stimmt, bis sie erkennen, dass bei diesem Ansatz ein Misserfolg sie unweigerlich erwarten wird.  Entweder wird das Unternehmen unangenehme Fragen stellen, oder es wird viele Probleme geben, die fast nicht mit der Kanalbreite zusammenh√§ngen, sondern direkt von der Effizienz seiner Verwendung abh√§ngen.  Ja, VoIP schwenkt aktiv einen Stift hinter den Kulissen und Multicast-Verkehr streichelt Sie b√∂swillig auf den R√ºcken. <br><br>  Lassen Sie uns daher einfach erkennen, dass QoS obligatorisch ist. Sie m√ºssen es auf die eine oder andere Weise kennen und aus irgendeinem Grund nicht jetzt in einer entspannten Atmosph√§re beginnen. <br><br><img src="https://habrastorage.org/webt/sc/of/k6/scofk6lx2y49bzisp0pwsnrsywg.jpeg"><a name="habracut"></a><br><hr><br><h1>  Inhalt </h1><br>  1. <b>Was bestimmt die QoS?</b> <br><br><ul><li>  Verlust </li><li>  Verz√∂gerungen </li><li>  Jitter </li></ul><br>  2. <b>Drei QoS-Modelle</b> <br><br><ul><li>  Beste Effekte </li><li>  Integrierte Dienste </li><li>  Differenzierte Dienstleistungen </li></ul><br>  3. <b>DiffServ-Mechanismen</b> <br><br>  4. <b>Klassifizierung und Kennzeichnung</b> <br><br><ul><li>  Verhaltensaggregation </li><li>  Multi-Feld </li><li>  Schnittstellenbasiert </li></ul><br>  5. <b>Warteschlangen</b> <br><br>  6. <b>Vermeidung von √úberlastungen</b> <br><br><ul><li>  Tail Drop und Head Drop </li><li>  Rot </li><li>  Wred </li></ul><br>  7. <b>√úberlastungsmanagement</b> <br><br><ul><li>  Zuerst rein, zuerst raus </li><li>  Priority Queuing </li><li>  Faires Anstehen </li><li>  Round Robin </li></ul><br>  8. <b>Geschwindigkeitsbegrenzung</b> <br><br><ul><li>  Formen </li><li>  Polizeiarbeit </li><li>  Undichter Eimer und Token-Eimer </li></ul><br>  9. <b>Hardware-Implementierung von QoS</b> <br><hr><br><blockquote>  Bevor der Leser in dieses Loch eintaucht, werde ich drei Einstellungen vornehmen: <br><br><ul><li>  Nicht alle Probleme k√∂nnen durch Erweiterung des Bandes gel√∂st werden. </li><li>  QoS erweitert das Band nicht. </li><li>  QoS zur Verwaltung begrenzter Ressourcen. </li></ul></blockquote><br><h1>  1. Was bestimmt die QoS? </h1><br>  Das Unternehmen erwartet, dass der Netzwerkstapel seine einfache Funktion einwandfrei ausf√ºhrt - um einen Bitstrom von einem Host zum anderen zu liefern: verlustfrei und in einer vorhersehbaren Zeit. <br><br>  Aus diesem kurzen Satz k√∂nnen alle Netzwerkqualit√§tsmetriken abgeleitet werden: <br><br><ul><li>  Verlust </li><li>  Verz√∂gerungen </li><li>  Jitter </li></ul><br>  Diese drei Merkmale bestimmen die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Qualit√§t des Netzwerks</a> unabh√§ngig von seiner Art: Paket, Kanal, IP, MPLS, Funk, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tauben</a> . <br><br><h2>  Verlust </h2><br>  Diese Metrik gibt an, wie viele der von der Quelle gesendeten Pakete das Ziel erreicht haben. <br>  Die Ursache f√ºr den Verlust kann ein Problem in der Schnittstelle / im Kabel, eine Netzwerk√ºberlastung oder Bitfehler sein, die die ACL-Regeln blockieren. <br><br>  Was im Falle eines Verlustes zu tun ist, entscheidet der Antrag.  Es kann sie ignorieren, wie im Fall eines Telefongespr√§chs, bei dem ein sp√§tes Paket nicht mehr ben√∂tigt wird, oder es erneut senden - dies ist das, was TCP tut, um eine genaue √úbermittlung der Quelldaten sicherzustellen. <br><br><img src="https://habrastorage.org/webt/s9/vc/jj/s9vcjjwjb494cyrx19oby8ykvms.png" width="600"><br><br>  Wie Sie Verluste verwalten, wenn sie unvermeidlich sind, finden Sie im Kapitel √úberlastungsmanagement. <br><br>  Wie Sie Verluste ausnutzen k√∂nnen, lesen Sie im Kapitel Verhinderung von Staus. <br><br><h2>  Verz√∂gerungen </h2><br>  Dies ist die Zeit, die Daten ben√∂tigen, um von der Quelle zum Ziel zu gelangen. <br><br><img src="https://habrastorage.org/webt/m6/xo/qa/m6xoqapl9y6v422k8c4d--xtmvm.png" width="600"><br><br>  Die kumulative Verz√∂gerung besteht aus den folgenden Komponenten. <br><br><ul><li>  <b>Serialisierungsverz√∂gerung</b> - Die Zeit, <b>die</b> ein Knoten ben√∂tigt, um ein Paket in Bits zu zerlegen und eine Verbindung zum n√§chsten Knoten herzustellen.  Sie wird durch die Geschwindigkeit der Schnittstelle bestimmt.  So dauert beispielsweise die √úbertragung eines Pakets mit einer Gr√∂√üe von 1500 Byte √ºber eine Schnittstelle mit 100 Mbit / s 0,0001 s und f√ºr 56 Kb / s - 0,2 s. </li><li>  <b>Die Ausbreitungsverz√∂gerung</b> ist das Ergebnis der ber√ºchtigten Begrenzung der Ausbreitungsgeschwindigkeit elektromagnetischer Wellen.  Die Physik erlaubt es Ihnen nicht, schneller als in 30 ms (tats√§chlich etwa 70 ms) von New York nach Tomsk auf der Oberfl√§che des Planeten zu gelangen. </li><li>  <b>Die durch QoS eingef√ºhrten Verz√∂gerungen</b> sind das Schmachten von Paketen in Warteschlangen ( <b>Warteschlangenverz√∂gerung</b> ) und die Folgen der Formgebung ( <b>Formverz√∂gerung</b> ).  Wir werden heute im Kapitel Geschwindigkeitsregelung viel dar√ºber sprechen. </li><li>  <b>Verz√∂gerung bei der Verarbeitung von Paketen</b> ( <b>Processing Delay</b> ) - die Zeit, um zu entscheiden, was mit dem Paket geschehen soll: Lookup, ACL, NAT, DPI - und es von der Eingabeschnittstelle an die Ausgabe zu senden.  An dem Tag, an dem Juniper Control und Data Plane in seinem M40 trennte, konnten Verarbeitungsverz√∂gerungen vernachl√§ssigt werden. </li></ul><br>  Verz√∂gerungen sind nicht so schlimm f√ºr Anwendungen, bei denen keine Eile erforderlich ist: Dateifreigabe, Surfen, VoD, Internetradiosender usw.  Umgekehrt sind sie f√ºr interaktive wichtig: 200 ms sind bereits w√§hrend eines Telefongespr√§chs f√ºr das Ohr unangenehm. <br><br>  Ein verz√∂gerungsbezogener Begriff, der nicht gleichbedeutend mit <b>RTT</b> ( <b>Round Trip Time</b> ) ist, ist der Round Trip.  Beim Ping und Tracing sehen Sie genau RTT und keine Einwegverz√∂gerung, obwohl die Werte eine Korrelation aufweisen. <br><br><h2>  Jitter </h2><br>  Der Unterschied in den Verz√∂gerungen zwischen der Zustellung aufeinanderfolgender Pakete wird als Jitter bezeichnet. <br><br><img src="https://habrastorage.org/webt/hv/-j/9z/hv-j9zu-h0eyuzkf9eaupcputhe.png" width="600"><br><br>  Wie bei der Latenz spielt Jitter f√ºr viele Anwendungen keine Rolle.  Und selbst, wie es scheint, was ist der Unterschied - das Paket wurde geliefert, also was mehr? <br><br>  F√ºr interaktive Dienste ist dies jedoch wichtig. <br><br>  Nehmen Sie die gleiche Telefonie als Beispiel.  Tats√§chlich handelt es sich um eine Digitalisierung von analogen Signalen mit einer Aufteilung in separate Datenbl√∂cke.  Die Ausgabe ist ein ziemlich gleichm√§√üiger Paketstrom.  Auf der Empfangsseite befindet sich ein kleiner Puffer fester Gr√∂√üe, in den nacheinander ankommende Pakete passen.  Um das analoge Signal wiederherzustellen, ist eine bestimmte Anzahl von ihnen erforderlich.  Unter Bedingungen schwebender Verz√∂gerungen kommt der n√§chste Datenblock m√∂glicherweise nicht rechtzeitig an, was einem Verlust entspricht, und das Signal kann nicht wiederhergestellt werden. <br><br>  Der gr√∂√üte Beitrag zur Verz√∂gerungsvariabilit√§t wird nur durch QoS geleistet.  Dies ist auch sehr und langwierig in den gleichen Kapiteln Geschwindigkeitsbegrenzung. <br><br><hr><br>  Dies sind die drei Hauptmerkmale der Netzwerkqualit√§t, aber es gibt zwei andere, die ebenfalls eine wichtige Rolle spielen. <br><br><h2>  Zuf√§llige Lieferung </h2><br>  Eine Reihe von Anwendungen, wie Telefonie, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NAS</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CES,</a> reagieren √§u√üerst empfindlich auf die zuf√§llige Zustellung von Paketen, wenn sie in der falschen Reihenfolge beim Empf√§nger ankommen, in der sie gesendet wurden.  Dies kann zu Verbindungsverlust, Fehlern und Sch√§den am Dateisystem f√ºhren. <br><br>  Obwohl die zuf√§llige Zustellung keine formale QoS-Funktion ist, bezieht sie sich definitiv auf die Netzwerkqualit√§t. <br><br>  Selbst wenn TCP diese Art von Problem toleriert, treten doppelte ACKs und Neu√ºbertragungen auf. <br><br><img src="https://habrastorage.org/webt/yu/51/63/yu5163hdbesjbypr34w4w5puhbo.png" width="600"><br><br><h2>  Bandbreite </h2><br>  Es wird nicht als Ma√ü f√ºr die Netzwerkqualit√§t unterschieden, da sein Nachteil tats√§chlich zu den drei oben genannten f√ºhrt.  In unserer Realit√§t sollte MPLS TE es jedoch zumindest als schwache Metrik erw√§hnen, wenn es f√ºr einige Anwendungen garantiert oder im Gegenteil vertraglich begrenzt werden sollte, z. B. wenn MPLS TE es im gesamten LSP reserviert. <br>  Geschwindigkeitsregelungsmechanismen werden in den Kapiteln Geschwindigkeitsbegrenzung erl√§utert. <br><br><hr><br>  Warum k√∂nnen Spezifikationen schlecht werden? <br><br>  Wir beginnen also mit einer sehr primitiven Idee, dass ein Netzwerkger√§t (sei es ein Switch, ein Router, eine Firewall oder was auch immer) nur ein weiteres Rohrst√ºck ist, das als Kommunikationskanal bezeichnet wird, genau wie ein Kupferdraht oder ein optisches Kabel. <br><br><img src="https://habrastorage.org/webt/r2/yh/hr/r2yhhr2urldnn3t6mqhhk6erz-u.png" width="600"><br><br>  Dann fliegen alle Pakete in der Reihenfolge durch, in der sie angekommen sind, und es treten keine zus√§tzlichen Verz√∂gerungen auf - es gibt keinen Ort zum Verweilen. <br><br>  Tats√§chlich stellt jeder Router Bits und Pakete aus dem Signal wieder her, macht etwas mit ihnen (wir denken noch nicht dar√ºber nach) und wandelt die Pakete dann wieder in ein Signal um. <br><br>  Eine Serialisierungsverz√∂gerung wird angezeigt.  Aber im Allgemeinen ist dies nicht be√§ngstigend, weil es konstant ist.  Nicht be√§ngstigend, solange die Breite der Ausgabeschnittstelle gr√∂√üer als die Eingabe ist. <br><br>  Am Eingang des Ger√§ts befindet sich beispielsweise ein Gigabit-Port und am Ausgang eine 620-Mbit / s-Funkrelaisleitung, die an denselben Gigabit-Port angeschlossen ist. <br><br>  Niemand wird eine Kugel durch den formal Gigabit-Link-Gigabit-Verkehr verbieten. <br>  Es ist nichts zu tun - 380 Mbit / s werden auf den Boden versch√ºttet. <br><br>  Hier sind sie - Verluste. <br><br>  Gleichzeitig w√ºrde ich mir sehr w√ºnschen, dass der schlimmste Teil abgeworfen wird - ein Video von Youtube, und das Telefongespr√§ch des Gesch√§ftsf√ºhrers mit dem Betriebsleiter hat weder unterbrochen noch gequ√§lt. <br><br>  Ich m√∂chte, dass die Stimme eine Standleitung hat. <br><br>  Oder es gibt f√ºnf Eingabeschnittstellen, aber eine Ausgabe, und gleichzeitig haben f√ºnf Knoten versucht, einem Empf√§nger Datenverkehr zuzuf√ºhren. <br><br>  F√ºgen Sie eine Prise VoIP-Theorie hinzu (ein Artikel, √ºber den niemand geschrieben hat) - sie reagiert sehr empfindlich auf Verz√∂gerungen und deren Variationen. <br><br>  Wenn f√ºr einen TCP-Videostream von YouTube (zum Zeitpunkt des Schreibens des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">QUIC-</a> Artikels - es ist immer noch ein Experiment) Verz√∂gerungen in Sekunden aufgrund von Pufferung v√∂llig wertlos sind, wird der Direktor nach dem ersten solchen Gespr√§ch mit Kamtschatka den Leiter der technischen Abteilung anrufen. <br>  In fr√ºheren Zeiten, als der Autor des Zyklus abends noch seine Hausaufgaben machte, war das Problem besonders akut.  Modemverbindungen hatten eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Geschwindigkeit von 56k</a> . <br><br>  Und als ein 1,5-KB-Paket in eine solche Verbindung kam, belegte es 200 ms lang die gesamte Leitung.  Niemand sonst konnte in diesem Moment passieren.  Eine Stimme?  Nein, ich habe nicht geh√∂rt. <br><br>  Daher ist die MTU-Frage so wichtig - das Paket sollte die Schnittstelle nicht zu lange belegen.  Je weniger Geschwindigkeit es ist, desto weniger MTU wird ben√∂tigt. <br><br>  Hier sind sie - Verz√∂gerungen. <br><br>  Jetzt ist der Kanal frei und die Verz√∂gerung ist gering. Nach einer Sekunde hat jemand begonnen, eine gro√üe Datei herunterzuladen, und die Verz√∂gerungen haben zugenommen.  Hier ist er - Jitter. <br><br>  Daher ist es notwendig, dass Sprachpakete mit minimalen Verz√∂gerungen durch die Pipe fliegen und YouTube wartet. <br><br>  Die verf√ºgbaren 620 Mbit / s sollten f√ºr Sprache und Video sowie f√ºr B2B-Kunden verwendet werden, die VPNs kaufen.  Ich m√∂chte, dass ein Verkehr den anderen nicht unterdr√ºckt, also brauchen wir eine Bandgarantie. <br><br><hr><br>  Alle oben genannten Merkmale sind in Bezug auf die Art des Netzwerks universell.  Es gibt jedoch drei verschiedene Ans√§tze f√ºr ihre Bereitstellung. <br><br><h1>  2. Drei QoS-Modelle </h1><br><ul><li>  Bester Aufwand - keine Qualit√§tsgarantie.  Alle sind gleich. </li><li>  IntServ ist eine Qualit√§tsgarantie f√ºr jeden Stream.  Reservieren von Ressourcen von der Quelle zum Ziel. </li><li>  DiffServ - Es gibt keine Reservierung.  Jeder Knoten selbst bestimmt, wie die richtige Qualit√§t sichergestellt wird. </li></ul><br><h2>  Bester Aufwand (BE) </h2><br>  <i>Keine Gew√§hrleistungen.</i> <br><br>  Der einfachste Ansatz zur Implementierung von QoS, von dem aus IP-Netzwerke begonnen haben und bis heute praktiziert werden - manchmal, weil es ausreicht, aber h√§ufiger, weil niemand an QoS gedacht hat. <br><br>  Wenn Sie Datenverkehr ins Internet senden, wird dieser dort √ºbrigens als BestEffort verarbeitet.  Daher ist √ºber ein √ºber das Internet gerolltes VPN (im Gegensatz zu einem vom Anbieter bereitgestellten VPN) wichtiger Datenverkehr, z. B. ein Telefongespr√§ch, m√∂glicherweise nicht sehr sicher. <br><br>  Im Fall von BE sind alle Verkehrskategorien gleich, keine wird bevorzugt.  Dementsprechend gibt es keine Garantie f√ºr Verz√∂gerung / Jitter oder Band. <br><br>  Dieser Ansatz hat einen etwas eing√§ngigen Namen - Best Effort, den der Neuling mit dem Wort "best" irref√ºhrt. <br><br>  Der Ausdruck ‚ÄûIch werde mein Bestes geben‚Äú bedeutet jedoch, dass der Sprecher versuchen wird, alles zu tun, was m√∂glich ist, aber nichts garantiert. <br><br>  F√ºr die Implementierung von BE ist nichts erforderlich - dies ist das Standardverhalten.  Es ist billig in der Herstellung, die Mitarbeiter ben√∂tigen kein tiefes spezifisches Wissen, die QoS kann in diesem Fall nicht angepasst werden. <br><br>  Diese Einfachheit und Statik f√ºhren jedoch nicht dazu, dass der Best Effort-Ansatz nirgendwo verwendet wird.  Es findet Anwendung in Netzwerken mit hoher Bandbreite und ohne √úberlastung und Bursts. <br><br>  Zum Beispiel auf transkontinentalen Leitungen oder in Netzwerken einiger Rechenzentren, in denen keine √úberzeichnung besteht. <br>  Mit anderen Worten, in Netzwerken ohne √úberlastung und in denen es nicht erforderlich ist, sich auf besondere Weise auf Verkehr (z. B. Telefonie) zu beziehen, ist BE durchaus angemessen. <br><br><h2>  Interv </h2><br>  <i>Vorl√§ufige Reservierung von Ressourcen f√ºr den gesamten Fluss von der Quelle zum Ziel.</i> <br><br>  Die V√§ter der MIT-, Xerox- und ISI-Netzwerke haben beschlossen, dem wachsenden zuf√§lligen Internet das Element der Vorhersehbarkeit hinzuzuf√ºgen und gleichzeitig seine Funktionsf√§higkeit und Flexibilit√§t beizubehalten. <br><br>  So entstand 1994 die Idee von IntServ als Reaktion auf das schnelle Wachstum des Echtzeitverkehrs und die Entwicklung von Multicast.  Es wurde dann auf IS reduziert. <br><br>  Der Name spiegelt den Wunsch im selben Netzwerk wider, gleichzeitig Dienste f√ºr Echtzeit- und Nicht-Echtzeit-Verkehrstypen bereitzustellen, und bietet das Recht erster Priorit√§t, Ressourcen durch Reservierung des Bandes zu nutzen.  Die M√∂glichkeit, die Band wiederzuverwenden, mit der jeder Geld verdient und dank der der IP-Schuss erhalten blieb. <br><br>  Die Sicherungsmission wurde dem RSVP-Protokoll zugewiesen, das f√ºr <b>jeden</b> Stream ein Band auf <b>jedem</b> Netzwerkger√§t reserviert. <br><br>  Grob gesagt senden die Endhosts vor dem Einrichten einer Single Rate Three Color MarkerP-Sitzung oder dem Starten des Datenaustauschs den RSVP-Pfad mit der erforderlichen Bandbreite.  Und wenn beide RSVP Resv zur√ºckgegeben haben, k√∂nnen sie anfangen zu kommunizieren.  Wenn gleichzeitig keine Ressourcen verf√ºgbar sind, gibt RSVP einen Fehler zur√ºck und die Hosts k√∂nnen nicht kommunizieren oder BE mitmachen. <br><br>  Lassen Sie sich nun die tapfersten Leser vorstellen, dass ein Kanal f√ºr <b>jeden</b> Stream im Internet heute im Voraus signalisiert wird.  Wir ber√ºcksichtigen, dass dies CPU- und Speicherkosten ungleich Null an <b>jedem</b> Transitknoten erfordert, die eigentliche Interaktion f√ºr einige Zeit verschiebt und klar wird, warum sich IntServ als praktisch totgeborene Idee herausstellte - Skalierbarkeit Null. <br><br>  In gewisser Weise ist die moderne Inkarnation von IntServ MPLS TE mit einer angepassten Kennzeichnungsversion von RSVP - RSVP TE.  Obwohl hier nat√ºrlich nicht End-to-End und nicht Per-Flow. <br><br>  IntServ ist in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 1633 beschrieben</a> . <br>  Das Dokument ist im Prinzip neugierig zu bewerten, wie naiv Sie in Prognosen sein k√∂nnen. <br><br><h2>  Diffserv </h2><br>  <i>DiffServ ist kompliziert.</i> <br><br>  Als Ende der 90er Jahre klar wurde, dass der End-to-End-IntServ-IP-Ansatz fehlschlug, berief die IETF 1997 die Arbeitsgruppe Differentiated Services ein, die die folgenden Anforderungen f√ºr das neue QoS-Modell entwickelte: <br><br><ul><li>  Keine Signalisierung (Adjos, RSVP!). </li><li>  Basierend auf der aggregierten Verkehrsklassifizierung, anstatt sich auf Flows, Kunden usw. zu konzentrieren. </li><li>  Es verf√ºgt √ºber eine begrenzte und deterministische Reihe von Aktionen zur Verarbeitung des Datenverkehrs von Klassen. </li></ul><br>  Infolgedessen wurden 1998 der Meilenstein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 2474</a> ( <i>Definition des Feldes f√ºr differenzierte Dienste (DS-Feld) in den IPv4- und IPv6-Headern</i> ) und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 2475</a> ( <i>Eine Architektur f√ºr differenzierte Dienste</i> ) geboren. <br><br>  Und weiter werden wir nur √ºber DiffServ sprechen. <br><br><blockquote>  Es ist erw√§hnenswert, dass der Name DiffServ nicht das Gegenteil von IntServ ist.  Dies zeigt, dass wir die von verschiedenen Anwendungen bereitgestellten Dienste bzw. deren Datenverkehr unterscheiden, dh diese Arten von Datenverkehr gemeinsam nutzen / differenzieren. <br>  IntServ macht dasselbe - es unterscheidet zwischen den Verkehrstypen BE und Real-Time, die im selben Netzwerk √ºbertragen werden.  Sowohl: als auch IntServ und DiffServ - beziehen sich auf M√∂glichkeiten zur Unterscheidung von Diensten. </blockquote><br><hr><br><h1>  3. DiffServ-Mechanismen </h1><br>  Was ist DiffServ und warum schl√§gt es IntServ? <br><br>  Wenn es sehr einfach ist, wird der Verkehr in Klassen unterteilt.  Ein Paket am Eingang zu jedem Knoten wird klassifiziert und mit einer Reihe von Werkzeugen versehen, die Pakete verschiedener Klassen auf unterschiedliche Weise verarbeiten und ihnen so ein unterschiedliches Serviceniveau bieten. <br><br>  Aber es wird einfach <a href="">nicht sein</a> . <br><br>  Das Herzst√ºck von DiffServ ist das ideal erfahrene IP IP <b>PHB-</b> Konzept <b>- Per-Hop-Verhalten</b> .  Jeder Knoten auf dem Verkehrspfad entscheidet unabh√§ngig von seinen Headern, wie er sich relativ zum eingehenden Paket verh√§lt. <br><br>  Die Aktionen des Paketrouters werden als Verhaltensmodell bezeichnet.  Die Anzahl solcher Modelle ist deterministisch und begrenzt.  Auf verschiedenen Ger√§ten k√∂nnen sich die Verhaltensmodelle in Bezug auf denselben Datenverkehr unterscheiden, daher sind sie pro Hop. <br><br>  <i>Die Konzepte von <b>Verhalten</b> und <b>PHB werde</b> ich im Artikel als Synonyme verwenden.</i> <br><blockquote>  Es gibt eine leichte Verwirrung.  PHB ist einerseits das allgemeine Konzept des unabh√§ngigen Verhaltens jedes Knotens und andererseits ein spezifisches Modell auf einem bestimmten Knoten.  Damit werden wir es herausfinden. <br></blockquote><img src="https://habrastorage.org/webt/8w/jq/kq/8wjqkqc9e4jwrm1lokdaahlnod8.png" width="600"><br><br>  Das Verhaltensmodell wird durch eine Reihe von Tools und deren Parameter bestimmt: √úberwachung, L√∂schen, Warteschlangen, Planen, Formen. <br><br>  Mithilfe der verf√ºgbaren Verhaltensmodelle kann das Netzwerk verschiedene Dienstklassen ( <b>Serviceklasse</b> ) bereitstellen. <br><br>  Das hei√üt, verschiedene Verkehrskategorien k√∂nnen unterschiedliche Dienstebenen im Netzwerk empfangen, indem unterschiedliche PHBs auf sie angewendet werden. <br><br>  Dementsprechend m√ºssen Sie zun√§chst bestimmen, auf welche Klasse von Service-Verkehr sich bezieht - <b>Klassifizierung</b> . <br><br>  Jeder Knoten klassifiziert eingehende Pakete unabh√§ngig voneinander. <br><br><img src="https://habrastorage.org/webt/_o/lp/jm/_olpjmv8pc3bclzzg9qtvh1_vke.png" width="700"><br><br>  Nach der Klassifizierung erfolgt eine Messung (Messung) - wie viele Bits / Bytes des Verkehrs dieser Klasse am Router angekommen sind. <br><br>  Basierend auf den Ergebnissen k√∂nnen Pakete gestrichen werden ( <b>F√§rbung</b> ): gr√ºn (innerhalb der festgelegten Grenze), gelb (au√üerhalb der Grenze), rot (die K√ºste vollst√§ndig verf√ºhrt). <br><br><img src="https://habrastorage.org/webt/3h/6g/xi/3h6gxiq2g_7lejnvonvxtft9pys.png" width="700"><br><br>  Wenn n√∂tig, findet die <b>√úberwachung</b> statt (Entschuldigung f√ºr ein solches Transparentpapier, es gibt eine bessere Option - schreiben, ich werde es √§ndern).  Ein Polierer, der auf der Farbe eines Pakets basiert, weist dem Paket eine Aktion zu - Senden, Verwerfen oder erneutes Markieren. <br><br><img src="https://habrastorage.org/webt/ft/gk/2k/ftgk2klys-yvgdicuzs1i8zg3lo.png" width="700"><br><br>  Danach sollte das Paket in eine der Warteschlangen fallen ( <b>Queuing</b> ).  F√ºr jede Serviceklasse wird eine separate Warteschlange zugewiesen, mit der sie anhand verschiedener PHBs unterschieden werden k√∂nnen. <br><br>  Aber noch bevor das Paket in die Warteschlange gelangt, kann es <b>verworfen</b> werden ( <b>Dropper</b> ), wenn die Warteschlange voll ist. <br><br>  Wenn es gr√ºn ist, wird es passieren, wenn es gelb ist, wird es h√∂chstwahrscheinlich verworfen, wenn die Linie voll ist und wenn Rot ein sicherer Selbstmordattent√§ter ist.  Bedingt h√§ngt die Wahrscheinlichkeit des Ablegens von der Farbe des Pakets und der F√ºlle der Warteschlange ab, in die es gelangen soll. <br><br><img src="https://habrastorage.org/webt/er/q2/ks/erq2ksivfaq7yj2gch6ihcbezts.png" width="700"><br><br>  Am Ausgang der Warteschlange arbeitet ein <b>Shaper</b> , dessen Aufgabe der Aufgabe des Polysers sehr √§hnlich ist - den Verkehr auf einen bestimmten Wert zu begrenzen. <br><br>  Sie k√∂nnen beliebige Shaper f√ºr einzelne Warteschlangen oder sogar innerhalb von Warteschlangen konfigurieren. <br>  √úber den Unterschied zwischen einem Former und einem Polyser im Kapitel Geschwindigkeitsbegrenzung. <br><br>  Alle Warteschlangen sollten schlie√ülich zu einer einzigen Ausgabeschnittstelle zusammengef√ºhrt werden. <br><br>  Denken Sie an die Situation, in der auf der Stra√üe 8 Fahrspuren in 3 √ºbergehen. Ohne Verkehrskontrolleur f√ºhrt dies zu Chaos.  Eine abwechselnde Trennung w√§re nicht sinnvoll, wenn wir dieselbe Ausgabe wie die Eingabe h√§tten. <br><br>  Daher gibt es einen speziellen Dispatcher ( <b>Scheduler</b> ), der zyklisch Pakete aus verschiedenen Warteschlangen herausnimmt und an die Schnittstelle sendet ( <b>Scheduling</b> ). <br><br>  Tats√§chlich ist eine Kombination aus einer Reihe von Warteschlangen und einem Dispatcher der wichtigste QoS-Mechanismus, mit dem Sie verschiedene Regeln auf verschiedene Verkehrsklassen anwenden k√∂nnen, von denen eine eine gro√üe Bandbreite bietet, die andere eine geringe Latenz und der dritte Mangel an Drops. <br><br>  Dann gehen die Pakete bereits zur Schnittstelle, wo die Pakete in einen Bitstrom umgewandelt werden - Serialisierung ( <b>Serialisierung</b> ) und dann das Umgebungssignal. <br><br><img src="https://habrastorage.org/webt/dy/i2/pk/dyi2pkpat1havyiz3ps3dmret-y.png" width="700"><br><br>  In DiffServ ist das Verhalten jedes Knotens unabh√§ngig von den anderen. Es gibt keine Signalisierungsprotokolle, die angeben, welche QoS-Richtlinie sich im Netzwerk befindet.  Gleichzeitig m√∂chte ich, dass der Datenverkehr innerhalb des Netzwerks gleichm√§√üig verarbeitet wird.  Wenn sich nur ein Knoten anders verh√§lt, ist die gesamte QoS-Richtlinie nicht mehr verf√ºgbar. <br><br>  Dazu werden zum einen auf allen Routern die gleichen Klassen und PHB konfiguriert, und zum anderen wird die <b>Kennzeichnung des</b> Pakets verwendet - seine Zugeh√∂rigkeit zu einer bestimmten Klasse wird im Header (IP, MPLS, 802.1q) aufgezeichnet. <br><br>  Das Sch√∂ne an DiffServ ist, dass sich der n√§chste Knoten bei der Klassifizierung auf dieses Label verlassen kann. <br><br>  Eine solche Vertrauenszone, in der dieselben Verkehrsklassifizierungsregeln und dasselbe Verhalten gelten, wird als DiffServ-Dom√§ne ( <b>DiffServ-Dom√§ne</b> ) bezeichnet. <br><br><img src="https://habrastorage.org/webt/8o/7d/ex/8o7dexwfq0xawzyhsuix7-viewi.png" width="700"><br><br>  So k√∂nnen wir am Eingang zur DiffServ-Dom√§ne ein Paket basierend auf 5-Tupel oder einer Schnittstelle klassifizieren, es gem√§√ü den Regeln der Dom√§ne markieren ( <b>Bemerkung / Umschreiben</b> ), und weitere Knoten werden dieser Markierung vertrauen und keine komplexe Klassifizierung vornehmen. <br>  Das hei√üt, es gibt keine explizite Signalisierung in DiffServ, aber der Knoten kann allen folgenden mitteilen, welche Klasse dieses Paket bereitgestellt werden muss, und darauf warten, dass es vertrauensw√ºrdig ist. <br><br>  An den Verbindungsstellen zwischen DiffServ-Dom√§nen m√ºssen Sie QoS-Richtlinien aushandeln (oder nicht). <br><br>  Das ganze Bild sieht ungef√§hr so ‚Äã‚Äãaus: <br><br><img src="https://habrastorage.org/webt/_-/7v/nt/_-7vntuvn9r1ugem7yenmxoj9fw.png" width="1000"><br><blockquote>  Um es klar zu machen, werde ich ein Analogon aus dem wirklichen Leben geben. <br>  Flug mit dem Flugzeug (nicht Victory). <br>  Es gibt drei Serviceklassen (CoS): Economy, Business, First. <br>  Beim Kauf eines Tickets findet die Klassifizierung statt - der Passagier erh√§lt eine bestimmte Serviceklasse basierend auf dem Preis. <br>  Am Flughafen gibt es eine Markierung (Bemerkung) - ein Ticket wird ausgestellt, das die Klasse angibt. <br>  Es gibt zwei Verhaltensweisen (PHBs): Best Effort und Premium. <br>  Es gibt Mechanismen, die Verhaltensweisen implementieren: einen gemeinsamen Warteraum oder eine VIP-Lounge, einen Kleinbus oder einen gemeinsamen Bus, bequeme gro√üe Sitze oder enge Reihen, die Anzahl der Passagiere pro Flugbegleiter, die M√∂glichkeit, Alkohol zu bestellen. <br>  Je nach Klasse werden Verhaltensmodelle zugeordnet - der Best Effort Economy, dem Business - Premium Basic und dem First - Premium SUPER-POWER-NINJA-TURBO-NEO-ULTRA-HYPER-MEGA-MULTI-ALPHA-META-EXTRA-UBER-PREFIX! <br>  Gleichzeitig unterscheiden sich zwei Pr√§mien darin, dass sie in einem ein Glas halbs√º√ü geben und in dem anderen unbegrenzt Bacardi haben. <br><br>  Bei der Ankunft am Flughafen kommen alle durch eine T√ºr.  Diejenigen, die versucht haben, Waffen mitzubringen oder kein Ticket haben, sind nicht erlaubt (Drop).  Wirtschaft und Wirtschaft geraten in unterschiedliche Warter√§ume und unterschiedliche Transportmittel (Queuing).  Zuerst lassen sie First Class an Bord, dann Business, dann Economy (Scheduling), aber dann fliegen sie alle mit einem Flugzeug (Schnittstelle) an ihr Ziel. <br><br>  Im selben Beispiel ist ein Flug in einem Flugzeug eine Ausbreitungsverz√∂gerung, die Landung eine Serialisierungsverz√∂gerung, das Warten auf ein Flugzeug in den Hallen ist Warteschlange und die Passkontrolle ist Verarbeitung.  Beachten Sie, dass hier die Verarbeitungsverz√∂gerung in Bezug auf die Gesamtzeit normalerweise vernachl√§ssigbar ist. <br><br>  Der n√§chste Flughafen kann ganz anders mit Passagieren umgehen - sein PHB ist anders.  Wenn sich der Passagier jedoch nicht die Fluggesellschaft √§ndert, √§ndert sich h√∂chstwahrscheinlich auch die Einstellung zu ihm nicht, da ein Unternehmen eine DiffServ-Domain ist. <br></blockquote>  Wie Sie vielleicht bemerkt haben, ist DiffServ extrem (oder unendlich) komplex.  Wir werden aber alles analysieren, was oben beschrieben wurde.  Gleichzeitig werde ich in dem Artikel nicht auf die Nuancen der physischen Implementierung eingehen (sie k√∂nnen sich sogar auf zwei Karten desselben Routers unterscheiden), sondern nicht auf HQoS und MPLS DS-TE. <br><br>  Die Schwelle f√ºr den Eintritt in den Kreis der Ingenieure, die die Technologie f√ºr QoS verstehen, ist viel h√∂her als f√ºr Routing-Protokolle, MPLS oder, verzeihen Sie, Radya, STP. <br><br>  Trotzdem hat sich DiffServ Anerkennung und Implementierung in Netzwerken auf der ganzen Welt verdient, da es, wie sie sagen, hoch skalierbar ist. <br><br>  Im weiteren Verlauf dieses Artikels werde ich nur DiffServ analysieren. <br><br>  Im Folgenden werden alle in der Abbildung angegebenen Tools und Prozesse analysiert. <br><br><img src="https://habrastorage.org/webt/qb/21/kg/qb21kgaqnsm6-pi2qwe0rdniqq4.png" width="600"><br><br><hr><br>  Im Zuge der Erweiterung des Themas werde ich einige Dinge in der Praxis zeigen. <br>  Wir werden mit einem solchen Netzwerk arbeiten: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  Trisolarans ist ein Linkmeup-Provider-Client mit zwei Verbindungspunkten. <br><br>  Der gelbe Bereich ist die DiffServ-Dom√§ne des Linkmeup-Netzwerks, in der eine einzelne QoS-Richtlinie wirksam ist. <br>  Linkmeup_R1 ist ein CPE-Ger√§t, das vom Anbieter verwaltet wird und sich daher in einer vertrauensw√ºrdigen Zone befindet.  OSPF wird damit ausgel√∂st und die Interaktion erfolgt √ºber eine saubere IP. <br><br>  Im Kern des Netzwerks befinden sich MPLS + LDP + MP-BGP mit L3VPN, das von Linkmeup_R2 bis Linkmeup_R4 reicht. <br>  Ich werde alle anderen Kommentare nach Bedarf geben. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die anf√§ngliche Konfigurationsdatei</a> . <br><br><hr><br><h1>  4. Klassifizierung und Kennzeichnung </h1><br>  Innerhalb seines Netzwerks definiert der Administrator die Serviceklassen, die er f√ºr den Datenverkehr bereitstellen kann. <br><br>  Daher ist das erste, was jeder Knoten tut, wenn er ein Paket empf√§ngt, es zu klassifizieren. <br><br>  Es gibt drei M√∂glichkeiten: <br><br><ol><li>  <b>Verhaltensaggregat</b> ( <b>BA</b> ) <br>  Vertrauen Sie einfach dem vorhandenen Paketetikett in der Kopfzeile.  Zum Beispiel das IP DSCP-Feld. <br>  Dies wird so genannt, weil unter derselben Bezeichnung im DSCP-Feld verschiedene Verkehrskategorien zusammengefasst werden, die dasselbe Verhalten in Bezug auf sich selbst erwarten.  Beispielsweise werden alle SIP-Sitzungen zu einer Klasse zusammengefasst. <br><br>  Die Anzahl m√∂glicher Serviceklassen und damit Verhaltensmuster ist begrenzt.  Dementsprechend ist es unm√∂glich, f√ºr jede Kategorie (oder noch mehr f√ºr den Stream) eine separate Klasse zuzuweisen - es ist eine Aggregation erforderlich. </li><li>  <b>Schnittstellenbasiert</b> <br>  Alles, was zu einer bestimmten Schnittstelle kommt, sollte in eine Verkehrsklasse eingeordnet werden.  Zum Beispiel wissen wir sicher, dass der Datenbankserver mit diesem Port verbunden ist und nicht mehr.  Und an einem anderen Mitarbeiterarbeitsplatz. </li><li>  <b>MultiField</b> ( <b>MF</b> ) <br>  Analysieren Sie die Paket-Header-Felder - IP-Adressen, Ports, MAC-Adressen.  Generell beliebige Felder. <br><br>  Beispielsweise muss der gesamte Datenverkehr, der in das Subnetz 10.127.721.0/24 auf Port 5000 geleitet wird, als Datenverkehr markiert werden, sofern die 5. Dienstklasse erforderlich ist. </li></ol><br>  Der Administrator bestimmt die Serviceklassen, die das Netzwerk bereitstellen kann, und ordnet ihnen einen digitalen Wert zu. <br><br>  Am Eingang zur DS-Domain vertrauen wir niemandem, daher erfolgt die Klassifizierung auf die zweite oder dritte Weise: Basierend auf den Adressen, Protokollen oder Schnittstellen werden die Serviceklasse und der entsprechende digitale Wert bestimmt. <br><br>  Beim Verlassen des ersten Knotens wird diese Ziffer im DSCP-Feld des IP-Headers (oder einem anderen Feld der Verkehrsklasse: MPLS-Verkehrsklasse, IPv6-Verkehrsklasse, Ethernet 802.1p) codiert - eine Bemerkung tritt auf. <br><br>  Es ist √ºblich, dieser Kennzeichnung innerhalb der DS-Dom√§ne zu vertrauen, daher verwenden Transitknoten die erste Klassifizierungsmethode (BA) - die einfachste.  Keine komplizierte Kursanalyse, sehen Sie sich nur die aufgezeichnete Nummer an. <br><br>  An der Kreuzung zweier Dom√§nen k√∂nnen Sie anhand einer Schnittstelle oder eines MF klassifizieren, wie oben beschrieben, oder Sie k√∂nnen der BA-Kennzeichnung mit Vorbehalten vertrauen. <br><br>  Vertrauen Sie beispielsweise allen Werten au√üer 6 und 7 und weisen Sie 6 und 7 bis 5 neu zu. <br><br>  Diese Situation ist m√∂glich, wenn der Anbieter eine juristische Person mit einer eigenen Kennzeichnungsrichtlinie verbindet.  Der Anbieter hat nichts dagegen, es zu speichern, m√∂chte jedoch nicht, dass der Datenverkehr in die Klasse f√§llt, in der er Netzwerkprotokollpakete empf√§ngt. <br><br><img src="https://habrastorage.org/webt/8o/7d/ex/8o7dexwfq0xawzyhsuix7-viewi.png" width="900"><br><br><h2>  Verhaltensaggregation </h2><br>  BA verwendet eine sehr einfache Klassifizierung - ich sehe eine Zahl - ich verstehe die Klasse. <br>  Was ist die Figur?  Und in welchem ‚Äã‚ÄãBereich wird es aufgezeichnet? <br><br><ul><li>  IPv6-Verkehrsklasse </li><li>  MPLS-Verkehrsklasse </li><li>  Ethernet 802.1p </li></ul><br>  Die Klassifizierung basiert haupts√§chlich auf dem Kommutierungsheader. <br><br>  <i>Ich rufe einen Pendler-Header auf, anhand dessen das Ger√§t festlegt, wohin das Paket gesendet werden soll, damit es n√§her am Empf√§nger ist.</i> <br>  Das hei√üt, wenn ein IP-Paket am Router ankommt, werden der IP-Header und das DSCP-Feld analysiert.  Wenn MPLS eintrifft, wird es analysiert - MPLS-Verkehrsklasse. <br><br>  Wenn ein Ethernet + VLAN + MPLS + IP-Paket zu einem regul√§ren L2-Switch gelangt ist, wird 802.1p analysiert (obwohl dies ge√§ndert werden kann). <br><br><h3>  IPv4-Nutzungsbedingungen </h3><br>  Das QoS-Feld begleitet uns genauso wie die IP.  Das 8-Bit-TOS-Feld - Type Of Service - sollte die Priorit√§t des Pakets tragen. <br><br>  Noch vor dem Aufkommen von DiffServ hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 791</a> ( <i>INTERNET PROTOCOL</i> ) das Feld folgenderma√üen beschrieben: <br><br>  IP-Priorit√§t (IPP) + DTR + 00. <br><br><img src="https://habrastorage.org/webt/fw/fe/of/fwfeofy_xr9dbft1vbap2djoszm.png" width="700"><br><br>  Das hei√üt, die Priorit√§t des Pakets geht, dann die Genauigkeit, Verz√∂gerung, Durchsatz, Zuverl√§ssigkeit (0 - ohne Anforderungen, 1 - mit Anforderungen). <br><br>  Die letzten beiden Bits m√ºssen Null sein. <br><br><div class="spoiler">  <b class="spoiler_title">Priorit√§t bestimmt die folgenden Werte ...</b> <div class="spoiler_text">  111 - Netzwerksteuerung <br>  110 - Internetwork-Kontrolle <br>  101 - KRITISCH / ECP <br>  100 - Flash Override <br>  011 - Blitz <br>  010 - Sofort <br>  001 - Priorit√§t <br>  000 - Routine <br></div></div><br>  Sp√§ter in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 1349</a> ( <i>Art des Dienstes in der Internet Protocol Suite</i> ) wurde das TOS-Feld leicht neu definiert: <br><br><img src="https://habrastorage.org/webt/95/dz/pm/95dzpm400ckireeowdta1q_7lvg.png" width="700"><br><br>  Die linken drei Bits blieben IP-Vorrang, die n√§chsten vier wurden nach dem Hinzuf√ºgen des Kostenbits zu TOS. <br><br>  So lesen Sie die Einheiten in diesen TOS-Bits: <br><br><ul><li>  D - "Minimierung der Verz√∂gerung", </li><li>  T - "Maximierung des Durchsatzes", </li><li>  R - "Maximierung der Zuverl√§ssigkeit", </li><li>  C - ‚ÄûKosten minimieren‚Äú. </li></ul><br>  Tr√ºbe Beschreibungen trugen nicht zur Popularit√§t dieses Ansatzes bei. <br><br>  Es gab keinen systematischen Ansatz f√ºr die QoS auf dem gesamten Pfad, es gab keine klaren Empfehlungen zur Verwendung des Priorit√§tsfelds, die Beschreibung der Verz√∂gerungs-, Durchsatz- und Zuverl√§ssigkeitsbits war √§u√üerst vage. <br><br>  Daher wurde im Zusammenhang mit DiffServ das TOS-Feld in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 2474</a> ( <i>Definition des Feldes f√ºr differenzierte Dienste (DS-Feld) in den IPv4- und IPv6-Headern</i> ) erneut neu definiert: <br><br><img src="https://habrastorage.org/webt/n_/ie/zm/n_iezmmdhv2tg7qlbxqad7c_4_m.png" width="700"><br><br>  Anstelle der IPP- und DTRC-Bits wurde das Sechs-Bit-Feld DSCP - <b>Differentiated Services Code Point</b> eingef√ºhrt, die beiden rechten Bits wurden nicht verwendet. <br><br>  Von diesem Moment an war es das DSCP-Feld, das zur Hauptmarkierung von DiffServ h√§tte werden sollen: Es wird ein bestimmter Wert (Code) geschrieben, der innerhalb der DS-Dom√§ne die spezifische Serviceklasse kennzeichnet, die f√ºr das Paket erforderlich ist, und seine L√∂schpriorit√§t.  Dies ist die gleiche Zahl. <br><br>  Der Administrator kann alle 6 DSCP-Bits nach eigenem Ermessen verwenden und maximal 64 Serviceklassen gemeinsam nutzen. <br><br>  Aus Gr√ºnden der Kompatibilit√§t mit IP Precedence behielten sie jedoch die Rolle der Klassenauswahl f√ºr die ersten drei Bits bei. <br><br>  Das hei√üt, wie in IPP k√∂nnen Sie mit 3 Bit Class Selector 8 Klassen definieren. <br><br><img src="https://habrastorage.org/webt/fw/vl/p0/fwvlp0wanilpj7_lrp8bxj7blqe.png" width="700"><br><br>  Dies ist jedoch immer noch nichts anderes als eine Vereinbarung, die der Administrator innerhalb der Grenzen seiner DS-Dom√§ne nach eigenem Ermessen leicht ignorieren und alle 6 Bits verwenden kann. <br><br>  Au√üerdem stelle ich fest, dass gem√§√ü den IETF-Empfehlungen dieser Verkehr zum Dienst umso anspruchsvoller ist, je h√∂her der in der CS aufgezeichnete Wert ist. <br><br>  Dies sollte jedoch nicht als unbestreitbare Wahrheit angesehen werden. <br><br>  Wenn die ersten drei Bits die Verkehrsklasse definieren, werden die n√§chsten drei verwendet, um die Paketabwurfpriorit√§t ( <b>Drop Precedence</b> oder <b>Packet Loss Priority - PLP</b> ) anzugeben. <br><blockquote>  Acht Klassen - ist es viel oder wenig?  Auf den ersten Blick reicht es nicht aus - schlie√ülich geht so viel unterschiedlicher Datenverkehr in das Netzwerk, dass man jedes Protokoll nach Klassen unterscheiden m√∂chte.  Es stellt sich jedoch heraus, dass acht f√ºr alle m√∂glichen Szenarien ausreicht. <br>  F√ºr jede Klasse m√ºssen Sie einen PHB definieren, der irgendwie anders damit umgeht als andere Klassen. <br>  Und mit einer Erh√∂hung des Divisors steigt die Dividende (Ressource) nicht an. <br>  Ich spreche absichtlich nicht √ºber die genauen Werte der Verkehrsklasse, die sie beschreiben, da es keine Standards gibt und Sie diese nach eigenem Ermessen formell verwenden k√∂nnen.  Im Folgenden werde ich Ihnen sagen, welche Klassen und ihre entsprechenden Werte empfohlen werden. <br></blockquote><div class="spoiler">  <b class="spoiler_title">ECN-Bits ...</b> <div class="spoiler_text">  Das Zwei-Bit-ECN-Feld wurde nur in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 3168</a> ( <i>Explicit Congestion Notification</i> ) <i>angezeigt</i> .  Das Feld wurde mit dem guten Zweck definiert, die End-Hosts explizit dar√ºber zu informieren, dass auf dem Weg eine √úberlastung aufgetreten ist. <br>  Wenn beispielsweise Pakete in den Warteschlangen des Routers l√§ngere Zeit verz√∂gert werden und diese beispielsweise um 85% f√ºllen, √§ndert sich der ECN-Wert und teilt dem endg√ºltigen Host mit, was langsamer sein muss - etwa Pause Frames on Ethernet. <br><br>  In diesem Fall muss der Absender die √úbertragungsrate und die Belastung des leidenden Knotens verringern. <br><br>  Gleichzeitig ist theoretisch keine Unterst√ºtzung dieses Feldes durch alle Transitknoten erforderlich.  Das hei√üt, die Verwendung von ECN unterbricht nicht das Netzwerk, das es nicht unterst√ºtzt. <br><br>  Das Ziel ist gut, aber vor der Anwendung im Leben wird ECN nicht besonders gefunden.  Heutzutage betrachten Mega- und Hyperscales diese beiden Teile mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">neuem Interesse</a> . <br><br>  ECN ist einer der nachstehend beschriebenen Mechanismen zur Vermeidung von √úberlastungen. <br></div></div><br><hr><br><h4>  DSCP-Klassifizierungspraxis </h4><br>  Es tut nicht weh, ein bisschen zu √ºben. <br><br>  Das Schema ist das gleiche. <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  Senden Sie zun√§chst eine ICMP-Anfrage: <br><br><pre><code class="hljs pgsql">Linkmeup_R1#ping ip <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> source <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">escape</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>. Sending <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>-byte ICMP Echos <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>, timeout <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> seconds: Packet sent <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> a source address <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> !!!!! Success rate <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> percent (<span class="hljs-number"><span class="hljs-number">5</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span>), round-trip min/avg/max = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> ms</code> </pre> <br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><br><img src="https://habrastorage.org/webt/6g/zl/lp/6gzllpyfrbtsvqjd3sqn-rljc8g.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcapng</a></i> <br><br>  Und jetzt mit dem eingestellten DSCP-Wert. <br><br><pre> <code class="hljs pgsql"> Linkmeup_R1#ping ip <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> source <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> tos <span class="hljs-number"><span class="hljs-number">184</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">escape</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>. Sending <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>-byte ICMP Echos <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>, timeout <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> seconds: Packet sent <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> a source address <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">172.16</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> !!!!! Success rate <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> percent (<span class="hljs-number"><span class="hljs-number">5</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span>), round-trip min/avg/max = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> ms</code> </pre> <br>  Der Wert 184 ist die Dezimaldarstellung der Bin√§rdatei 10111000. Von diesen sind die ersten 6 Bits 101110, dh die Dezimalzahl 46, und dies ist die Klasse EF. <br><br><div class="spoiler">  <b class="spoiler_title">Tabelle der Standard-TOS-Werte f√ºr bequemes Popingushki ...</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/z5/fx/ij/z5fxijhtpv24gndpefezlypbdju.png" width="500"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Weitere Details</a></i> <br>  Unten im Text im Kapitel der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">IETF-Empfehlung</a> werde ich Ihnen sagen, woher diese Nummern und Namen stammen. <br></div></div><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0</i> <br><br><img src="https://habrastorage.org/webt/y_/fn/gn/y_fngnyvicccbvsesftdw5lawrc.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcapng</a></i> <br><br>  Ein merkw√ºrdiger Hinweis: Das Ziel von Pingushka in der ICMP-Echoantwort setzt denselben Klassenwert wie in der Echoanforderung.  Dies ist logisch - wenn der Absender ein Paket mit einer bestimmten Wichtigkeit gesendet hat, m√∂chte er es offensichtlich garantiert zur√ºckerhalten. <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0</i> <br><br><img src="https://habrastorage.org/webt/wk/uu/ea/wkuueaujq2oqgrgd6cu960kqezu.png" width="600"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Konfigurationsdatei f√ºr die DSCP-Klassifizierung.</a> <br><br><h3>  IPv6-Verkehrsklasse </h3><br>  IPv6 unterscheidet sich in Bezug auf die QoS nicht wesentlich von IPv4.  Das als Verkehrsklasse bezeichnete Acht-Bit-Feld ist ebenfalls in zwei Teile unterteilt.  Die ersten 6 Bits - DSCP - spielen genau die gleiche Rolle. <br><br><img src="https://habrastorage.org/webt/cu/xd/nf/cuxdnfexzlj8ls4zjd3qxwh8oa8.png" width="700"><br><br>  Ja, Flow Label wurde angezeigt.  Sie sagen, dass es f√ºr eine zus√§tzliche Differenzierung von Klassen verwendet werden k√∂nnte.  Aber diese Idee wurde im Leben noch nicht angewendet. <br><br><h3>  MPLS-Verkehrsklasse </h3><br>  Das Konzept von DiffServ konzentrierte sich auf IP-Netzwerke mit IP-Header-Routing.  Das ist einfach Pech - nach 3 Jahren ver√∂ffentlichten sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 3031</a> ( <i>Multiprotocol Label Switching Architecture</i> ).  Und MPLS begann, Netzwerkanbieter zu √ºbernehmen. <br><br>  DiffServ konnte nicht auf ihn ausgedehnt werden. <br><br>  Durch einen gl√ºcklichen Zufall wurde f√ºr jeden experimentellen Fall ein Drei-Bit-EXP-Feld in MPLS eingef√ºgt.  Und trotz der Tatsache, dass <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 5462</a> ( <i>Feld ‚ÄûEXP‚Äú, das in Feld ‚ÄûVerkehrsklasse‚Äú umbenannt wurde) vor</i> langer Zeit offiziell zum Feld Verkehrsklasse wurde, wird es aufgrund der Tr√§gheit IExPi genannt. <br><br>  Es gibt ein Problem damit - seine L√§nge betr√§gt drei Bits, wodurch die Anzahl der m√∂glichen Werte auf 9 begrenzt wird. Es ist nicht nur klein, es sind 3 bin√§re Ordnungen weniger als bei DSCP. <br><br><img src="https://habrastorage.org/webt/is/r0/tc/isr0tc7unhhkxs-bjevcbipjq6k.png" width="700"><br><br>  Da die MPLS-Verkehrsklasse h√§ufig vom DSCP-IP-Paket geerbt wird, ist die Archivierung mit Verlust verbunden.  Oder ... Nein, das willst du nicht wissen ... <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">L-LSP</a> .  Verwendet eine Kombination aus Verkehrsklasse + Beschriftungswert. <br><blockquote>  Im Allgemeinen ist die Situation seltsam - MPLS wurde als IP-Hilfe f√ºr schnelle Entscheidungen entwickelt - das MPLS-Label wird in CAM sofort durch Full Match anstelle des herk√∂mmlichen Longest Prefix Match erkannt.  Das hei√üt, sie wussten √ºber IP Bescheid und nahmen am Wechsel teil, sahen jedoch kein normales Priorit√§tsfeld vor. <br></blockquote>  Tats√§chlich haben wir oben bereits gesehen, dass nur die ersten drei Bits von DSCP verwendet werden, um die Verkehrsklasse zu bestimmen, und die anderen drei Bits sind Drop Precedence (oder PLP - Packet Loss Priority). <br><br>  In Bezug auf Serviceklassen haben wir daher immer noch eine 1: 1-Korrespondenz, bei der nur Informationen zur Drop-Priorit√§t verloren gehen. <br><br>  Im Fall von MPLS kann die Klassifizierung wie in IP auf der Schnittstelle, MF, IP DSCP oder MPLS der Verkehrsklasse basieren. <br><br>  Beschriftung bedeutet, einen Wert in das Feld Verkehrsklasse des MPLS-Headers zu schreiben. <br><br>  Ein Paket kann mehrere MPLS-Header enthalten.  F√ºr DiffServ-Zwecke wird nur die Oberseite verwendet. <br><br>  Es gibt drei verschiedene Szenarien zum erneuten Markieren, wenn ein Paket √ºber die MPLS-Dom√§ne von einem reinen IP-Segment in ein anderes verschoben wird: (Dies ist nur ein Auszug aus dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> ). <br><br><ol><li>  Einheitlicher Modus </li><li>  Rohrmodus </li><li>  Kurzrohrmodus </li></ol><br><div class="spoiler">  <b class="spoiler_title">Betriebsarten ...</b> <div class="spoiler_text"><br><h3>  Einheitlicher Modus </h3><br>  Dies ist ein flaches End-to-End-Modell. <br><br><img src="https://habrastorage.org/web/e50/932/53b/e5093253bcf94dc091f88500be2b6f9d.png" width="1000"><br><br>  Bei Ingress PE vertrauen wir IP DSCP und kopieren ( <i>genau genommen, Anzeige, aber der Einfachheit halber sagen wir "Kopieren"</i> ) seinen Wert in MPLS EXP (sowohl Tunnel- als auch VPN-Header).  Am Ausgang von Ingress PE wird das Paket bereits gem√§√ü dem Wert des EXP-Feldes des oberen MPLS-Headers verarbeitet. <br><br>  Jeder Transit P verarbeitet auch Pakete basierend auf der obersten EXP.  Gleichzeitig kann er es √§ndern, wenn der Bediener es w√ºnscht. <br><br>  Der vorletzte Knoten entfernt das Transportetikett (PHP) und kopiert den EXP-Wert in den VPN-Header.  Es spielt keine Rolle, was dort stand - im einheitlichen Modus erfolgt das Kopieren. <br><br>  Egress PE, das das VPN-Label entfernt, kopiert auch den EXP-Wert nach IP DSCP, selbst wenn dort etwas anderes geschrieben ist. <br><br>  Das hei√üt, wenn sich irgendwo in der Mitte der Wert des EXP-Labels im Tunnel-Header ge√§ndert hat, wird diese √Ñnderung vom IP-Paket √ºbernommen. <br><br><h3>  Rohrmodus </h3><br><img src="https://habrastorage.org/web/5a1/f9a/a46/5a1f9aa46bb94ed88d62185535f5b41e.png" width="1000"><br><br>  Wenn wir in Ingress PE entschieden haben, dem DSCP-Wert nicht zu vertrauen, wird der vom Operator gew√ºnschte EXP-Wert in die MPLS-Header eingef√ºgt. <br><br>  Es ist jedoch akzeptabel, diejenigen zu kopieren, die in DSCP enthalten waren.  Sie k√∂nnen beispielsweise Werte neu definieren - kopieren Sie alles auf EF und ordnen Sie CS6 und CS7 EF zu. <br><br>  Jeder Transit P betrachtet nur die EXP des oberen MPLS-Headers. <br><br>  Der vorletzte Knoten entfernt das Transportetikett (PHP) und <b>kopiert</b> den EXP-Wert in den VPN-Header. <br><br>  Egress PE verarbeitet das Paket zuerst basierend auf dem EXP-Feld im MPLS-Header und entfernt es erst dann, <b>ohne den</b> Wert nach DSCP <b>zu kopieren</b> . <br><br>  Das hei√üt, unabh√§ngig davon, was mit dem EXP-Feld in den MPLS-Headern passiert ist, bleibt der IP-DSCP unver√§ndert. <br><br>  Ein solches Szenario kann verwendet werden, wenn der Betreiber √ºber eine eigene Diff-Serv-Dom√§ne verf√ºgt und nicht m√∂chte, dass der Client-Verkehr diese irgendwie beeinflusst. <br><br><h3>  Kurzrohrmodus </h3><br><img src="https://habrastorage.org/web/f80/1c8/e2d/f801c8e2dac84ff1b376a5f68824d93e.png" width="1000"><br><br>  Sie k√∂nnen diesen Modus als eine Variation des Rohrmodus betrachten.  Der einzige Unterschied besteht darin, dass beim Verlassen des MPLS-Netzwerks das Paket gem√§√ü seinem IP-DSCP-Feld und nicht gem√§√ü MPLS EXP verarbeitet wird. <br><br>  Dies bedeutet, dass die Priorit√§t des Pakets am Ausgang vom Client und nicht vom Operator bestimmt wird. <br>  Ingress PE vertraut eingehenden IP DSCP-Paketen nicht <br>  Transit Ps sehen Sie im EXP-Feld des oberen Headers. <br>  Das vorletzte P entfernt das Transportetikett und kopiert den Wert auf das VPN-Etikett. <br>  Egress PE entfernt zuerst das MPLS-Label und verarbeitet dann das Paket in den Warteschlangen. <br><br>  Erkl√§rung von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Cisco</a> . <br></div></div><br><hr><br><h4>  Klassifizierungspraxis MPLS Traffic Class </h4><br>  Das Schema ist das gleiche: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Konfigurationsdatei ist dieselbe.</a> <br><br>  Im Linkmeup-Netzwerkdiagramm gibt es einen √úbergang von IP zu MPLS zu Linkmeup_R2. <br>  Mal sehen, was mit dem Markieren passiert, wenn <b>Ping IP 172.16.2.2 Quelle 172.16.1.1 tos 184 ping</b> . <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/lj/at/14/ljat14wahqfc91ojgigmlrwayzo.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcapng</a></i> <br><br>  Wir sehen also, dass das urspr√ºngliche EF-Label in IP DSCP in den Wert 5 des EXP MPLS-Felds (es ist auch die Verkehrsklasse, denken Sie daran) sowohl des VPN-Headers als auch des Transport-Headers umgewandelt wurde. <br>  Hier sind wir Zeugen der einheitlichen Arbeitsweise. <br><br><hr><br><h3>  Ethernet 802.1p </h3><br>  Das Fehlen eines Priorit√§tsfeldes in 802.3 (Ethernet) erkl√§rt sich aus der Tatsache, dass Ethernet urspr√ºnglich ausschlie√ülich als L√∂sung f√ºr das LAN-Segment geplant war.  F√ºr bescheidenes Geld k√∂nnen Sie √ºberm√§√üige Bandbreite erhalten, und der Uplink wird immer ein Engpass sein - Sie m√ºssen sich keine Gedanken √ºber die Priorisierung machen. <br><br>  Es wurde jedoch schnell klar, dass die finanzielle Attraktivit√§t von Ethernet + IP dieses Bundle auf die Backbone- und WAN-Ebene bringt.  Und das Zusammenleben in einem LAN-Segment von Torrents und Telefonie muss gel√∂st werden. <br><br>  Gl√ºcklicherweise kam 802.1q (VLAN) rechtzeitig daf√ºr an, in dem ein (erneut) 3-Bit-Feld f√ºr Priorit√§ten zugewiesen wurde. <br><br>  In diesem Feld k√∂nnen Sie im DiffServ-Plan dieselben 8 Verkehrsklassen definieren. <br><br><img src="https://habrastorage.org/webt/oh/_i/1l/oh_i1l1omqt1rk8agowdenx6x7o.png" width="600"><br><br><hr><br>  Beim Empfang eines Pakets ber√ºcksichtigt das Netzwerkger√§t der DS-Dom√§ne in den meisten F√§llen den Header, den es zum Umschalten verwendet: <br><br><ul><li>  Ethernet-Switch - 802.1p </li><li>  MPLS-Knoten - MPLS-Verkehrsklasse </li><li>  IP Router - IP DSCP </li></ul><br>  Dieses Verhalten kann zwar ge√§ndert werden: Schnittstellenbasierte Klassifizierung und Klassifizierung mehrerer Felder.  Und manchmal k√∂nnen Sie im CoS-Feld sogar explizit angeben, welcher Header angezeigt werden soll. <br><br><hr><br><h2>  Schnittstellenbasiert </h2><br>  Dies ist der einfachste Weg, um Pakete auf der Stirn zu klassifizieren.  Alles, was in die angegebene Schnittstelle gegossen wird, ist mit einer bestimmten Klasse gekennzeichnet. <br><br>  In einigen F√§llen reicht diese Granularit√§t aus, sodass Interface-basiert im Leben verwendet wird. <br><br><h4>  Schnittstellenbasierte Klassifizierungspraxis </h4><br>  Das Schema ist das gleiche: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  Das Einrichten von QoS-Richtlinien in den Ger√§ten der meisten Anbieter ist in Phasen unterteilt. <br><br><ol><li>  Zun√§chst wird ein Klassifikator definiert: <br> <code>class-map match-all TRISOLARANS_INTERFACE_CM <br> match input-interface Ethernet0/2</code> <br>  Alles, was zur Ethernet0 / 2-Schnittstelle geh√∂rt. <br></li><li>  Als N√§chstes wird eine Richtlinie erstellt, in der der Klassifizierer und die erforderliche Aktion verkn√ºpft sind. <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-map TRISOLARANS_REMARK <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_INTERFACE_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp cs7</code> </pre> <br>  Wenn das Paket den Klassifizierer TRISOLARANS_INTERFACE_CM erf√ºllt, schreiben Sie CS7 in das Feld DSCP. <br><blockquote>  Hier komme ich mit obskurem CS7 und dann EF, AF voran.  Unten k√∂nnen Sie √ºber diese Abk√ºrzungen und akzeptierten Vereinbarungen lesen.  In der Zwischenzeit reicht es zu wissen, dass es sich um verschiedene Klassen mit unterschiedlichen Servicelevels handelt. <br></blockquote></li><li>  Der letzte Schritt besteht darin, die Richtlinie auf die Schnittstelle anzuwenden: <br><br><pre> <code class="hljs pgsql"> interface Ethernet0/<span class="hljs-number"><span class="hljs-number">2</span></span> service-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> TRISOLARANS_REMARK</code> </pre> <br><blockquote>  Hier ist der Klassifizierer etwas redundant, wodurch √ºberpr√ºft wird, ob das Paket an die e0 / 2-Schnittstelle gelangt ist, wo wir dann die Richtlinie anwenden.  Man k√∂nnte jede √úbereinstimmung schreiben: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_INTERFACE_CM match <span class="hljs-keyword"><span class="hljs-keyword">any</span></span></code> </pre> <br>  Die Richtlinie kann jedoch tats√§chlich auf vlanif oder auf die Ausgabeschnittstelle angewendet werden, sodass dies m√∂glich ist. <br></blockquote><br></li></ol><br>  F√ºhren Sie den √ºblichen Ping auf 172.16.2.2 (Trisolaran2) mit Trisolaran1 aus: <br><br><img src="https://habrastorage.org/webt/sm/gh/5j/smgh5j3nxjmen6yspkxl8tu9so8.png" width="400"><br><br>  Und im Dump zwischen Linkmeup_R1 und Linkmeup_R2 sehen wir Folgendes: <br><br><img src="https://habrastorage.org/webt/rh/qe/6z/rhqe6z4z98dxmkcrygfpb7zboee.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcapng</a></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schnittstellenbasierte Klassifizierung der Konfigurationsdatei.</a> <br><br><h2>  Multi-Feld </h2><br>  Die h√§ufigste Art der Klassifizierung am Eingang zur DS-Dom√§ne.  Wir vertrauen der vorhandenen Kennzeichnung nicht und weisen anhand der Paket-Header eine Klasse zu. <br><br>  Oft ist dies eine M√∂glichkeit, QoS √ºberhaupt zu "aktivieren", wenn Absender nicht markieren. <br><br>  Ein ziemlich flexibles Werkzeug, aber gleichzeitig umst√§ndlich - Sie m√ºssen f√ºr jede Klasse schwierige Regeln erstellen.  Daher ist BA innerhalb der DS-Dom√§ne relevanter. <br><br><h4>  MF-Klassifizierungspraxis </h4><br>  Das Schema ist das gleiche: <br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br>  Aus den obigen praktischen Beispielen ist ersichtlich, dass Netzwerkger√§te standardm√§√üig der Kennzeichnung eingehender Pakete vertrauen. <br><br>  Dies ist innerhalb der DS-Dom√§ne in Ordnung, am Einstiegspunkt jedoch nicht akzeptabel. <br><br>  Und jetzt lasst uns nicht blind vertrauen?  In <b>Linkmeup_R2 wird</b> ICMP als EF (nur zum Beispiel), TCP als AF12 und alles andere als CS0 bezeichnet. <br>  Dies ist die MF-Klassifizierung (Multi-Field). <br><br><ol><li>  Das Verfahren ist das gleiche, aber jetzt werden wir nach ACLs suchen, die die erforderlichen Verkehrskategorien aush√§ngen, also erstellen wir sie zuerst. <br><br>  Auf Linkmeup_R2: <br><br><pre> <code class="hljs pgsql"> ip <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-list extended TRISOLARANS_ICMP_ACL permit icmp <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> ip <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-list extended TRISOLARANS_TCP_ACL permit tcp <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> ip <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-list extended TRISOLARANS_OTHER_ACL permit ip <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span></code> </pre> <br></li><li>  Als n√§chstes definieren wir die Klassifikatoren: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_TCP_CM match <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> TRISOLARANS_TCP_ACL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_OTHER_CM match <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> TRISOLARANS_OTHER_ACL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_ICMP_CM match <span class="hljs-keyword"><span class="hljs-keyword">access</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> TRISOLARANS_ICMP_ACL</code> </pre> <br></li><li>  Und jetzt definieren wir die Regeln f√ºr Bemerkungen in der Politik: <br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-map TRISOLARANS_ADMISSION_CONTROL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_ICMP_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp ef <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_TCP_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp af11 <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_OTHER_CM <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip dscp <span class="hljs-keyword"><span class="hljs-keyword">default</span></span></code> </pre> <br></li><li>  Und wir h√§ngen Richtlinien an die Schnittstelle.  Bei der Eingabe jeweils, da die Entscheidung am Eingang zum Netzwerk getroffen werden muss. <br><br><pre> <code class="hljs pgsql"> interface Ethernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> service-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> TRISOLARANS_ADMISSION_CONTROL</code> </pre> <br></li></ol><br>  ICMP-Test vom endg√ºltigen Wirt Trisolaran1.  Wir geben die Klasse nicht wissentlich an - der Standardwert ist 0. <br><br>  <b>Ich habe die Richtlinie bereits mit Linkmeup_R1 entfernt, sodass der Datenverkehr mit der Markierung CS0 und nicht mit CS7 versehen ist.</b> <br><br><img src="https://habrastorage.org/webt/_f/si/90/_fsi9012_fo5a8z1x14fdtxqz0m.png" width="400"><br><br>  Hier sind zwei Dumps in der N√§he, mit Linkmeup_R1 und Linkmeup_R2: <br><br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/cp/t5/ge/cpt5gersxbcrhjsba4lz8t-5z-i.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcapng</a></i> <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/9x/0w/j7/9x0wj7gkztleiock6vnax33m-7c.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcapng</a></i> <br><br>  Es ist ersichtlich, dass nach Klassifizierern und erneuter Kennzeichnung von Linkmeup_R2 in ICMP-Paketen nicht nur DSCP in EF ge√§ndert wurde, sondern die MPLS-Verkehrsklasse gleich 5 wurde. <br><br>  Ein √§hnlicher Test mit Telnet 172.16.2.2.  80 - also TCP √ºberpr√ºfen: <br><br><img src="https://habrastorage.org/webt/rd/f1/xo/rdf1xovczuma9nuziqbawyyuqji.png" width="400"><br><br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/-i/nr/gj/-inrgjtler0zsvt2y3hq3cxvd8m.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcapng</a></i> <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/mk/z_/qz/mkz_qz44dywl9kr5uw3ohauu9qa.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcapng</a></i> <br><br>  LESEN - Was und zu erwarten.  TCP wird als AF11 √ºbertragen. <br><br>  Der n√§chste Test testet UDP, das gem√§√ü unseren Klassifikatoren zu CS0 gehen sollte.  Wir werden daf√ºr iperf verwenden (√ºber Apps auf Linux Tiny Core bringen).  Auf der Remote-Seite <b>iperf3 -s</b> - Starten Sie den Server, auf dem lokalen <b>iperf3 -c -u -t1</b> - Client ( <b>-c</b> ), UDP-Protokoll ( <b>-u</b> ), testen Sie 1 Sekunde lang ( <b>-t1</b> ). <br><br><img src="https://habrastorage.org/webt/zw/gu/sb/zwgusb4bqnq7prgq_yw5ue44pqo.png" width="400"><br><br>  <i>Linkmeup_R1.</i>  <i>E0 / 0.</i> <br><img src="https://habrastorage.org/webt/rm/sx/pq/rmsxpqgca2wmuhhcu5mcnvcth7y.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcapng</a></i> <br><br>  <i>Linkmeup_R2.</i>  <i>E0 / 0</i> <br><img src="https://habrastorage.org/webt/yt/9q/gv/yt9qgv2qcqun9rpr8me4nuyghym.png" width="600"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pcapng</a></i> <br><br>  Von nun an wird alles, was zu dieser Schnittstelle kommt, gem√§√ü den konfigurierten Regeln klassifiziert. <br><br><hr><br><h2>  Markierung im Ger√§t </h2><br>  Nochmals: Am Eingang zur DS-Domain kann die Klassifizierung MF, Interface-based oder BA erfolgen. <br>  Zwischen den Knoten der DS-Dom√§ne tr√§gt das Paket im Header ein Vorzeichen √ºber die erforderliche Dienstklasse und wird von BA klassifiziert. <br><br>  Unabh√§ngig von der Klassifizierungsmethode wird dem Paket danach eine innere Klasse innerhalb des Ger√§ts zugewiesen, nach der es verarbeitet wird.  Der Header wird entfernt und das nackte (kein) Paket wandert zum Ausgang. <br>  Und am Ausgang wird die innere Klasse in das CoS-Feld des neuen Headers konvertiert. <br><br>  Das hei√üt, Position 1 ‚áí Klassifizierung ‚áí Interne Serviceklasse ‚áí Position 2. <br><br>  In einigen F√§llen m√ºssen Sie das Headerfeld eines Protokolls im Headerfeld eines anderen Protokolls anzeigen, z. B. DSCP in der Verkehrsklasse. <br><br>  Dies geschieht nur durch die interne Zwischenmarkierung. <br><br>  Zum Beispiel DSCP-Header ‚áí Klassifizierung ‚áí Interne Serviceklasse ‚áí Verkehrsklassen-Header. <br><br>  Formal k√∂nnen innere Klassen nach Belieben aufgerufen oder einfach nummeriert werden, und ihnen ist nur eine bestimmte Warteschlange zugewiesen. <br><br>  In der Tiefe, in die wir in diesem Artikel eintauchen, spielt es keine Rolle, wie sie genannt werden. Es ist wichtig, dass ein bestimmtes Verhaltensmodell bestimmten Werten von QoS-Feldern zugeordnet wird. <br><br>  Wenn es sich um bestimmte QoS-Implementierungen handelt, ist die Anzahl der Serviceklassen, die das Ger√§t bereitstellen kann, nicht h√∂her als die Anzahl der verf√ºgbaren Warteschlangen.  Oft gibt es acht von ihnen (entweder unter dem Einfluss von IPP oder manchmal durch ungeschriebene Vereinbarung).  Je nach Hersteller, Ger√§t und Karte k√∂nnen sie jedoch mehr oder weniger sein. <br><br>  Das hei√üt, wenn es 4 Warteschlangen gibt, machen die Serviceklassen einfach keinen Sinn, mehr als vier zu tun. <br><br>  Lassen Sie uns im Kapitel Hardware n√§her darauf eingehen. <br><br><div class="spoiler">  <b class="spoiler_title">Wenn Sie noch wirklich ein wenig Spezifit√§t wollen ...</b> <div class="spoiler_text"><blockquote>  Die folgenden Tabellen m√∂gen auf den ersten Blick f√ºr die Beziehung zwischen QoS-Feldern und inneren Klassen zweckm√§√üig erscheinen, sind jedoch beim Aufrufen von Klassen-PHB-Namen etwas irref√ºhrend.  PHB ist jedoch, welche Art von Verhaltensmodell dem Verkehr einer bestimmten Klasse zugewiesen wird, dessen Name grob gesagt willk√ºrlich ist. <br><br>  Beziehen Sie sich daher mit einiger Skepsis (daher unter dem Spoiler) auf die folgenden Tabellen. </blockquote><br>  <i>Am Beispiel von Huawei</i> .  Hier ist die Service-Klasse die innerste Klasse des Pakets. <br><br>  Das hei√üt, wenn BA am Eingang klassifiziert ist, werden die DSCP-Werte in die entsprechenden Werte f√ºr Serviceklasse und Farbe √ºbersetzt. <br><br><img src="https://habrastorage.org/webt/h-/xh/sp/h-xhspe0wg3zymljrw4fdcd8v-u.png" width="500"><br><br>  Es ist zu beachten, dass viele DSCP-Werte nicht verwendet werden und Pakete mit solchen Markierungen tats√§chlich als BE verarbeitet werden. <br><br>  Hier ist eine r√ºckw√§rts √ºbereinstimmende Tabelle, die zeigt, welche DSCP-Werte f√ºr den Datenverkehr festgelegt werden, wenn die Ausgabe erneut markiert wird. <br><br><img src="https://habrastorage.org/webt/as/t4/49/ast449vrq3tmkbo_xhxoqmvayjm.png" width="500"><br><br>  Beachten Sie, dass nur AF eine Farbabstufung aufweist.  BE, EF, CS6, CS7 - alles nur gr√ºn. <br><br>  Dies ist eine Tabelle zum Konvertieren von IPP-, MPLS-Verkehrsklassen- und 802.1p-Ethernet-Feldern in interne Dienstklassen. <br><br><img src="https://habrastorage.org/webt/d7/nz/up/d7nzupuudz6mpvapmunecfol43a.png" width="500"><br><br>  Und zur√ºck. <br><br><img src="https://habrastorage.org/webt/nc/qz/zr/ncqzzr58m-3acsu1gid9xkowfxy.png" width="500"><br><br>  Beachten Sie, dass hier im Allgemeinen alle Informationen zur Drop-Priorit√§t verloren gehen. <br><br>  Es sollte wiederholt werden - dies ist nur ein spezielles Beispiel f√ºr Standard√ºbereinstimmungen von <i>zuf√§llig</i> ausgew√§hlten Anbietern.  F√ºr andere kann dies anders sein.  Administratoren k√∂nnen in ihrem Netzwerk v√∂llig unterschiedliche Klassen von Diensten und PHBs konfigurieren. <br><br></div></div><br>  In Bezug auf PHB gibt es absolut keinen Unterschied, was f√ºr die Klassifizierung verwendet wird - DSCP, Verkehrsklasse, 802.1p. <br><br>  Innerhalb des Ger√§ts werden sie zu Verkehrsklassen, die vom Netzwerkadministrator definiert werden. <br>  Das hei√üt, all diese Markierungen sind eine M√∂glichkeit, den Nachbarn mitzuteilen, welche Serviceklasse sie diesem Paket zuweisen sollen.  Es geht um die BGP-Community, die f√ºr sich genommen nichts bedeutet, bis die Richtlinie f√ºr ihre Interpretation im Netzwerk definiert ist. <br><br><hr><br><h2>  IETF-Empfehlungen (Verkehrskategorien, Serviceklassen und Verhalten) </h2><br>  Standards standardisieren √ºberhaupt nicht, welche bestimmten Serviceklassen existieren sollten, wie sie zu klassifizieren und zu kennzeichnen sind und welche PHB auf sie anzuwenden sind. <br><br>  Dies ist den Anbietern und Netzwerkadministratoren ausgeliefert. <br><br>  Wir haben nur 3 Bits - wir verwenden, wie wir wollen. <br><br>  Das ist gut: <br><br><ul><li>  Jedes St√ºck Eisen (Anbieter) w√§hlt unabh√§ngig voneinander aus, welche Mechanismen f√ºr PHB verwendet werden sollen - keine Signalisierung, keine Kompatibilit√§tsprobleme. </li><li>  Der Administrator jedes Netzwerks kann den Datenverkehr flexibel auf verschiedene Klassen verteilen, die Klassen selbst und den entsprechenden PHB ausw√§hlen. </li></ul><br>  Das ist schlecht: <br><br><ul><li>  An den Grenzen von DS-Dom√§nen treten Konvertierungsprobleme auf. </li><li>  Unter Bedingungen v√∂lliger Handlungsfreiheit - einige sind im Wald, andere sind D√§monen. </li></ul><br>  Aus diesem Grund hat die IETF 2006 ein Schulungshandbuch zur Vorgehensweise bei der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dienstdifferenzierung herausgegeben</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 4594</a> ( <i>Konfigurationsrichtlinien f√ºr DiffServ-</i> Dienstklassen). <br><br>  Das Folgende ist eine kurze Zusammenfassung dieses RFC. <br><br><h3>  Verhaltensmodelle (PHB) </h3><br>  <b>DF - Standardweiterleitung</b> <br>  <i>Standardversand.</i> <br>  Wenn einem Verkehrsmodell kein spezielles Verhaltensmodell zugewiesen ist, wird es mithilfe der Standardweiterleitung verarbeitet. <br><br>  Dies ist Best Effort - das Ger√§t wird alles tun, aber nichts garantieren.  Tropfen, St√∂rungen, unvorhersehbare Verz√∂gerungen und schwebender Jitter sind m√∂glich, aber dies ist nicht genau. <br><br>  Dieses Modell eignet sich f√ºr anspruchslose Anwendungen wie Mail- oder Dateidownloads. <br>  √úbrigens gibt es PHB und noch weniger eindeutig - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">A Lower Effort</a> . <br><br>  <b>AF - Gesicherte Weiterleitung</b> <br>  <i>Garantierter Versand.</i> <br>  Dies ist eine verbesserte BE.  Einige Garantien erscheinen hier, zum Beispiel B√§nder.  Drops und Floating Delays sind weiterhin m√∂glich, jedoch in viel geringerem Ma√üe. <br><br>  Das Modell eignet sich f√ºr Multimedia: Streaming, Videokonferenzen, Online-Spiele. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 2597</a> ( <i>Assured Forwarding PHB Group</i> ). <br><br>  <b>EF - Beschleunigte Weiterleitung</b> <br>  <i>Notversand.</i> <br>  Alle Ressourcen und Priorit√§ten rasen hier.  Dies ist ein Modell f√ºr Anwendungen, die keine Verluste, kurze Verz√∂gerungen und stabilen Jitter ben√∂tigen, aber nicht gierig auf die Band sind.  Wie zum Beispiel Telefonie oder ein Drahtemulationsdienst (CES - Circuit Emulation Service). <br><br>  Verluste, St√∂rungen und Verz√∂gerungen bei der EF sind √§u√üerst unwahrscheinlich. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 3246</a> ( <i>Ein Expedited Forwarding PHB</i> ). <br><br>  <b>CS - Klassenauswahl</b> <br>  Hierbei handelt es sich um Verhaltensweisen, mit denen die Abw√§rtskompatibilit√§t mit IP-Vorrang in DS-f√§higen Netzwerken aufrechterhalten werden soll. <br><br>  Die folgenden Klassen sind in IPP vorhanden: CS0, CS1, CS2, CS3, CS4, CS5, CS6, CS7. <br>  Nicht immer gibt es f√ºr alle einen separaten PHB, normalerweise gibt es zwei oder drei, und der Rest wird einfach in die n√§chste DSCP-Klasse √ºbersetzt und erh√§lt den entsprechenden PHB. <br>  So kann beispielsweise ein Paket mit der Bezeichnung CS 011000 als 011010 klassifiziert werden. <br><br>  Von den CS sind sicherlich nur CS6, CS7, die f√ºr das NCP - Network Control Protocol empfohlen werden und einen separaten PHB erfordern, im Ger√§t erhalten. <br><br>  Wie EF wurde PHB CS6.7 f√ºr Klassen entwickelt, die sehr hohe Latenz- und Verlustanforderungen haben, jedoch eine gewisse Toleranz gegen√ºber Bandunterscheidung aufweisen. <br>  Die Aufgabe von PHB f√ºr CS6.7 besteht darin, ein Serviceniveau bereitzustellen, das Unterbrechungen und Verz√∂gerungen auch bei extremer √úberlastung der Schnittstelle, des Chips und der Warteschlangen verhindert. <br><hr><br><br>  Es ist wichtig zu verstehen, dass PHB ein abstraktes Konzept ist - und tats√§chlich werden sie durch Mechanismen implementiert, die auf realen Ger√§ten verf√ºgbar sind. <br><br>  Daher kann sich der in der DS-Dom√§ne definierte PHB bei Juniper und Huawei unterscheiden. <br><br>  Dar√ºber hinaus ist ein einzelner PHB kein statischer Satz von Aktionen. Beispielsweise kann ein PHB-AF aus mehreren Optionen bestehen, die sich in der H√∂he der Garantien unterscheiden (Band, akzeptable Verz√∂gerungen). <br><br><hr><br><h3>  Serviceklassen </h3><br>  Die IETF k√ºmmerte sich um die Administratoren und identifizierte die Hauptkategorien von Anwendungen und deren Serviceklassen. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich werde hier nicht ausf√ºhrlich sein, f√ºgen Sie einfach ein paar Platten aus dieser Richtlinie RFC ein. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anwendungskategorien: </font></font><br><br><img src="https://habrastorage.org/webt/an/hr/np/anhrnppkfmebfm7vaoarb1xv7s0.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anforderungen an Netzwerkeigenschaften: </font></font><br><br><img src="https://habrastorage.org/webt/ih/5r/z2/ih5rz2jw4ifygst1mjgte9a_vc0.png" width="560"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und schlie√ülich empfohlene Klassennamen und entsprechende DSCP-Werte: </font></font><br><br><img src="https://habrastorage.org/webt/jg/rp/4k/jgrp4kzhhhvz1-zygrsiexieeyy.png" width="560"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durch Kombinieren der oben genannten Klassen auf unterschiedliche Weise (passend zu den 8 verf√ºgbaren) k√∂nnen Sie QoS-L√∂sungen f√ºr verschiedene Netzwerke erhalten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am h√§ufigsten ist dies vielleicht: </font></font><br><br><img src="https://habrastorage.org/webt/su/ft/ed/suftedkuzswznewqbj3uslcncru.png" width="560"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klasse DF (oder BE) kennzeichnet absolut anspruchslosen Verkehr - er erh√§lt Restaufmerksamkeit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHB AF dient den Klassen AF1, AF2, AF3, AF4. Sie alle m√ºssen eine Fahrspur zum Nachteil von Verz√∂gerungen und Verlusten bereitstellen. Verluste werden durch die Drop Precedence-Bits gesteuert, weshalb sie als AFxy bezeichnet werden, wobei x die Serviceklasse und y Drop Precedence ist.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EF ben√∂tigt eine Art Mindestbandgarantie, aber was noch wichtiger ist - eine Garantie f√ºr Verz√∂gerungen, Jitter und keinen Verlust. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CS6, CS7 ben√∂tigen noch weniger Bandbreite, da dies eine Vielzahl von Servicepaketen ist, bei denen Bursts noch m√∂glich sind (z. B. BGP-Update), Verluste und Verz√∂gerungen jedoch nicht akzeptabel sind - was ist die Verwendung von BFD mit einem Timer von 10 ms, wenn Hello abst√ºrzt 100 ms Warteschlangen? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, 4 von 8 verf√ºgbaren Klassen wurden unter AF angegeben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und trotz der Tatsache, dass sie normalerweise genau das tun, wiederhole ich, dass dies nur Empfehlungen sind und nichts drei Klassen in Ihrer DS-Dom√§ne daran hindert, EF und nur zwei AF zuzuweisen.</font></font><br><br><hr><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Klassifizierungszusammenfassung </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am Eingang eines Knotens wird ein Paket anhand einer Schnittstelle, eines MF oder seiner Kennzeichnung (BA) klassifiziert. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beschriftung ist der Wert der DSCP-Felder in IPv4, der Verkehrsklasse in IPv6 und in MPLS oder 802.1p in 802.1q. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt 8 Dienstklassen, die verschiedene Verkehrskategorien zusammenfassen. Jeder Klasse wird ein eigener PHB zugewiesen, der die Anforderungen der Klasse erf√ºllt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gem√§√ü den IETF-Empfehlungen werden die folgenden Serviceklassen unterschieden: CS1, CS0, AF11, AF12, AF13, AF21, CS2, AF22, AF23, CS3, AF31, AF32, AF33, CS4, AF41, AF42, AF43, CS5, EF, CS6, CS7 in zunehmender Bedeutung des Verkehrs. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aus ihnen k√∂nnen Sie eine Kombination von 8 ausw√§hlen, die tats√§chlich in CoS-Felder codiert werden kann. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die h√§ufigste Kombination: CS0, AF1, AF2, AF3, AF4, EF, CS6, CS7 mit 3 Farbabstufungen f√ºr AF.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeder Klasse ist ein PHB zugeordnet, von denen es 3 gibt - Standardweiterleitung, versicherte Weiterleitung, beschleunigte Weiterleitung in aufsteigender Reihenfolge des Schweregrads. </font><font style="vertical-align: inherit;">Ein bisschen beiseite ist der PHB Class Selector. </font><font style="vertical-align: inherit;">Jeder PHB kann je nach Werkzeugparameter variieren, aber dazu sp√§ter mehr.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In einem entladenen Netzwerk sei QoS nicht erforderlich. </font><font style="vertical-align: inherit;">Alle QoS-Probleme werden durch Erweitern der Links behoben. </font><font style="vertical-align: inherit;">Mit Ethernet und DWDM sei es nie zu einer √úberlastung der Leitungen gekommen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie sind diejenigen, die nicht verstehen, was QoS ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber die Realit√§t trifft VPN auf ILV.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicht √ºberall gibt es Optik. </font><font style="vertical-align: inherit;">RRL ist unsere Realit√§t. </font><font style="vertical-align: inherit;">Manchmal m√∂chte zum Zeitpunkt des Unfalls (und nicht nur) in der engen Funkverbindung der gesamte Netzwerkverkehr gecrawlt werden.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verkehrsst√∂√üe sind unsere Realit√§t. </font><font style="vertical-align: inherit;">Kurzfristige Verkehrsst√∂√üe stellen sich leicht in Warteschlangen und zwingen dazu, die sehr notwendigen Pakete zu verwerfen.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telefonie, Videokonferenzen und Online-Spiele sind unsere Realit√§t. </font><font style="vertical-align: inherit;">Wenn die Warteschlange zumindest etwas besetzt ist, beginnen Verz√∂gerungen zu tanzen.</font></font></li></ol><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In meiner Praxis gab es Beispiele, bei denen aus Telefonie in einem Netzwerk, das zu nicht mehr als 40% ausgelastet war, Morsecode wurde. </font><font style="vertical-align: inherit;">Durch erneutes Markieren in EF wurde das Problem vor√ºbergehend behoben.</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es ist Zeit, sich mit Tools zu befassen, mit denen Sie verschiedene Dienste f√ºr verschiedene Klassen bereitstellen k√∂nnen. </font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PHB Tools </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es gibt tats√§chlich nur drei Gruppen von QoS-Tools, die Pakete aktiv manipulieren: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vermeidung von √úberlastungen - was tun, um nicht schlecht zu sein? </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √úberlastungsmanagement - was tun, wenn es schon schlecht ist? </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ratenbegrenzung - wie Sie nicht mehr in das Netzwerk stellen, als es sein sollte, und nicht so viel ver√∂ffentlichen, wie sie nicht akzeptieren k√∂nnen. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aber im Gro√üen und Ganzen w√§ren sie alle nutzlos, wenn es nicht die Warteschlange g√§be. </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5. Warteschlangen </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Vergn√ºgungspark k√∂nnen Sie niemandem Priorit√§t einr√§umen, wenn Sie keine separate Warteschlange f√ºr diejenigen organisieren, die mehr bezahlt haben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die gleiche Situation in den Netzwerken. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn sich der gesamte Datenverkehr in einer Warteschlange befindet, k√∂nnen Sie wichtige Pakete nicht aus der Mitte herausziehen, um ihnen Priorit√§t einzur√§umen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aus diesem Grund werden nach der Klassifizierung Pakete in die dieser Klasse entsprechende Warteschlange gestellt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und dann bewegt sich eine Warteschlange (mit Sprachdaten) schnell, aber mit einem begrenzten Band, eine andere langsamer (Streaming), aber mit einem breiten Band, und einige Ressourcen werden nach dem Restprinzip betrieben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Innerhalb der Grenzen jeder einzelnen Warteschlange gilt jedoch dieselbe Regel - Sie k√∂nnen ein Paket nicht aus der Mitte ziehen - nur aus dem Kopf.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jede Warteschlange hat eine bestimmte begrenzte L√§nge. Dies wird einerseits durch Hardwareeinschr√§nkungen bestimmt, andererseits macht es keinen Sinn, Pakete zu lange in der Warteschlange zu halten. Ein VoIP-Paket wird nicht ben√∂tigt, wenn es um 200 ms verz√∂gert wird. TCP fordert die Weiterleitung unter bestimmten Bedingungen an, nachdem die RTT abgelaufen ist (konfiguriert in sysctl). Daher ist das Fallenlassen nicht immer schlecht. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entwickler und Designer von Netzwerkger√§ten m√ºssen einen Kompromiss zwischen den Versuchen finden, das Paket so lange wie m√∂glich zu speichern, und im Gegenteil, um Bandbreitenverschwendung zu vermeiden und das Paket zu liefern, das nicht mehr ben√∂tigt wird. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In einer normalen Situation, wenn die Schnittstelle / der Chip nicht √ºberlastet ist, ist die Pufferauslastung nahe Null. Sie absorbieren kurzfristige Ausbr√ºche, dies f√ºhrt jedoch nicht zu einer l√§ngeren F√ºllung.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn mehr Verkehr vorhanden ist, als der Vermittlungs-Chip oder die Ausgabeschnittstelle verarbeiten k√∂nnen, f√ºllen sich die Warteschlangen. </font><font style="vertical-align: inherit;">Und eine chronische Auslastung von √ºber 20-30% ist bereits eine Situation, die angegangen werden muss.</font></font><br><br><hr><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Vermeidung von √úberlastungen </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Leben eines Routers kommt eine Zeit, in der die Warteschlange voll ist. </font><font style="vertical-align: inherit;">Wo das Paket abgelegt werden soll, wenn es definitiv keinen Ort gibt, an dem es abgelegt werden kann - das ist alles, der Puffer ist vorbei und es wird nicht da sein, selbst wenn es gut aussieht, selbst wenn Sie extra bezahlen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt zwei M√∂glichkeiten: entweder dieses Paket zu verwerfen oder diejenigen, die bereits den Zug erzielt haben. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn sich diese bereits in der Warteschlange befinden, pr√ºfen Sie, was fehlt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und wenn dieser, dann denken Sie daran, dass er nicht gekommen ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese beiden Ans√§tze werden als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tail Drop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Head Drop bezeichnet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tail Drop und Head Drop </font></font></h2><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tail Drop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - der einfachste Mechanismus zur Warteschlangenverwaltung - verwirft alle neu angekommenen Pakete, die nicht in den Puffer passen. </font></font><br><br><img src="https://habrastorage.org/webt/gu/qu/lv/guqulvedyuzoyytzzbybxrzua9g.png" width="500"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Head Drop</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verwirft Pakete, die sich schon sehr lange in der Warteschlange befinden. Es ist besser, sie wegzuwerfen als zu retten, da sie h√∂chstwahrscheinlich nutzlos sind. Die relevanteren Pakete, die am Ende der Warteschlange eingetroffen sind, haben jedoch mehr Chancen, p√ºnktlich anzukommen. Au√üerdem k√∂nnen Sie mit Head Drop das Netzwerk nicht mit unn√∂tigen Paketen laden. Nat√ºrlich sind die √§ltesten Pakete diejenigen, die sich im Kopf der Warteschlange befinden, daher der Name des Ansatzes.</font></font><br><br><img src="https://habrastorage.org/webt/6h/0d/rq/6h0drqorglxgq9mjocqjm_bpwby.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Head Drop hat einen weiteren nicht offensichtlichen Vorteil: Wenn Sie das Paket am Anfang der Warteschlange ablegen, wird der Empf√§nger schnell √ºber die √úberlastung im Netzwerk informiert und den Absender informieren. Im Fall von Tail Drop erreichen Informationen √ºber das verworfene Paket m√∂glicherweise Hunderte von Millisekunden sp√§ter - bis sie vom Ende der Leitung zu ihrem Kopf gelangen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beide Mechanismen arbeiten wiederum mit Differenzierung. Das hei√üt, es ist tats√§chlich nicht erforderlich, dass der gesamte Puffer voll ist. Wenn die zweite Warteschlange leer ist und die Null f√ºr die Aug√§pfel, werden nur Pakete von der Null verworfen. </font></font><br><br><img src="https://habrastorage.org/webt/as/nl/l7/asnll7xgflrxk_mvdxgmglgf2fm.png" width="400"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tail Drop und Head Drop k√∂nnen gleichzeitig arbeiten.</font></font><br><br><img src="https://habrastorage.org/webt/bn/n1/wv/bnn1wvl9qene8f4xysetig6hemg.png" width="500"><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schwanz und Kopf fallen sind Stauvermeidung "Stirn". Man kann sogar sagen - das ist seine Abwesenheit. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir tun nichts, bis die Warteschlange zu 100% voll ist. Und danach beginnen wir, alle neu angekommenen (oder lange verz√∂gerten) Pakete zu verwerfen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie nichts tun m√ºssen, um das Ziel zu erreichen, gibt es irgendwo eine Nuance. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und diese Nuance ist TCP. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erinnern Sie sich ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tiefer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extrem tief</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) daran, wie TCP funktioniert - wir sprechen √ºber moderne Implementierungen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schiebefenster (Schiebefenster</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder </font><b><font style="vertical-align: inherit;">rwnd - Werbefenster</font></b><font style="vertical-align: inherit;"> des Empf√§ngers), das der Empf√§nger steuert und dem Absender mitteilt, wie viel gesendet werden kann. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und es gibt ein √úberlastungsfenster ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CWND - Congestion Window)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), das auf Netzwerkprobleme reagiert und vom Absender gesteuert wird. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Daten√ºbertragungsprozess beginnt mit einem langsamen Start ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slow Start</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) mit einem exponentiellen Anstieg der CWND. Mit jedem best√§tigten Segment wird dem CWND 1 MSS-Gr√∂√üe hinzugef√ºgt, dh es verdoppelt sich tats√§chlich in einer Zeit, die RTT entspricht (Daten dort, ACK zur√ºck) (Rede √ºber Reno / NewReno).</font></font><br><br>  Zum Beispiel <br><br><img src="https://habrastorage.org/webt/5n/5a/nd/5n5andpbm8lvmyeaio0i565c_ek.png" width="200"><br><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das exponentielle</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wachstum setzt sich bis zu einem Wert fort, der als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssthreshold</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Slow Start Threshold) bezeichnet wird und in der TCP-Konfiguration auf dem Host angegeben ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als </font><font style="vertical-align: inherit;">n√§chstes beginnt f√ºr jedes best√§tigte Segment </font><font style="vertical-align: inherit;">ein </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lineares</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wachstum von 1 / CWND, bis es entweder gegen RWND anliegt oder Verluste beginnen (Verlust wird durch erneute Best√§tigung (Duplicated ACK) oder √ºberhaupt keine Best√§tigung best√§tigt). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobald ein Segmentverlust erkannt wird, tritt ein </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP-Backoff</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf </font><font style="vertical-align: inherit;">- TCP reduziert das Fenster drastisch, wodurch die Sendegeschwindigkeit tats√§chlich verringert wird - und der Mechanismus f√ºr die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">schnelle Wiederherstellung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird gestartet </font><font style="vertical-align: inherit;">:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verlorene Segmente senden (Fast Retransmission), </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> das Fenster ist verdoppelt, </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Schwellenwert wird auch gleich der H√§lfte des erreichten Fensters. </font></font></li><li><font style="vertical-align: inherit;"></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das lineare</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wachstum </font><font style="vertical-align: inherit;">beginnt wieder </font><font style="vertical-align: inherit;">bis zum ersten Verlust.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wiederholen. </font></font></li></ol><br><img src="https://habrastorage.org/webt/of/0p/ar/of0park6tnishwa25_v_dgzwaya.png" width="700"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verlust kann entweder den vollst√§ndigen Zusammenbruch eines Netzwerksegments bedeuten und dann als verloren betrachtet werden oder eine √úberlastung der Leitung (Lesepuffer√ºberlauf und Verwerfen eines Segments dieser Sitzung). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist die Methode von TCP zur Maximierung der Nutzung der verf√ºgbaren Bandbreite und zur Bew√§ltigung von √úberlastungen. </font><font style="vertical-align: inherit;">Und es ist sehr effektiv. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was f√ºhrt Tail Drop jedoch dazu?</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Angenommen, √ºber einen Router liegt der Pfad von Tausenden von TCP-Sitzungen. </font><font style="vertical-align: inherit;">Irgendwann erreichte der Sitzungsverkehr 1,1 Gbit / s, die Geschwindigkeit der Ausgabeschnittstelle 1 Gbit / s.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Verkehr kommt schneller als er geht, Puffer f√ºllen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sich</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tail Drop wird aktiviert, bis der Dispatcher einige Pakete aus der Warteschlange entfernt. </font></font></li><li>           Fast Recovery (    Slow Start). </li><li>    ,  , Tail Drop . </li><li>   TCP-  ,          . </li><li>  . </li><li> Fast Recovery/Slow Start. </li><li> . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weitere Informationen zu √Ñnderungen an TCP-Mechanismen finden Sie in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 2001</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algorithmen f√ºr langsamen Start von TCP, Vermeidung von √úberlastungen, schnelle erneute √úbertragung und schnelle Wiederherstellung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist ein typisches Beispiel f√ºr eine Situation namens </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Global TCP Synchronization</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/wr/co/oq/wrcooqd2fjrix9jbimh-8si97h4.png" width="500"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Global,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da viele √ºber diesen Knoten eingerichtete Sitzungen darunter leiden. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synchronisation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , weil sie gleichzeitig leiden. Und die Situation wird wiederholt, bis eine √úberlastung vorliegt. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - weil UDP, das keine √úberlastungskontrollmechanismen hat, davon nicht betroffen ist.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In dieser Situation w√§re nichts Schlimmes passiert, wenn nicht die nicht optimale Nutzung des Streifens - die L√ºcken zwischen den S√§gez√§hnen - das verschwendete Geld verursacht worden w√§re. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das zweite Problem ist </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP Starvation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - TCP Depletion. W√§hrend TCP langsamer wird, um die Last zu reduzieren (seien wir nicht schlau - vor allem, um unsere Daten sicher zu √ºbertragen), sendet UDP, all dieses moralische Leid im Allgemeinen durch das Datagramm, so viel wie m√∂glich. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dadurch wird der TCP-Datenverkehr reduziert und UDP w√§chst (m√∂glicherweise). Der n√§chste Zyklus von Loss - Fast Recovery erfolgt bei einem niedrigeren Schwellenwert. UDP nimmt Platz ein. Die Gesamtmenge des TCP-Verkehrs sinkt.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie man das Problem l√∂st, ist es besser, es zu vermeiden. </font><font style="vertical-align: inherit;">Versuchen wir, die Last zu reduzieren, bevor sie die Warteschlange mit der schnellen Wiederherstellung / dem langsamen Start f√ºllt, die gerade gegen uns war.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ROT - Zuf√§llige Fr√ºherkennung </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber was ist, wenn wir Tropfen auf einen Teil des Puffers nehmen und verschmieren? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnen Sie relativ gesehen damit, zuf√§llige Pakete zu verwerfen, wenn die Warteschlange zu 80% voll ist, und zwingen Sie einige TCP-Sitzungen, das Fenster und dementsprechend die Geschwindigkeit zu verringern. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und wenn die Warteschlange zu 90% voll ist, werden zuf√§llig 50% der Pakete verworfen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">90% - Die Wahrscheinlichkeit steigt auf Tail Drop (100% der neuen Pakete werden verworfen). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Mechanismen, die eine solche Warteschlangenverwaltung implementieren, werden als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AQM - Adaptive (oder Active) Queue Management bezeichnet.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> So funktioniert </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RED</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fr√ºherkennung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - m√∂gliche √úberlastung beheben; </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuf√§llig</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Pakete werden zuf√§llig verworfen.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manchmal dekodieren sie ROT (meiner Meinung nach semantisch korrekter), wie Random Early Discard. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grafisch sieht es so aus: </font></font><br><br><img src="https://habrastorage.org/webt/1n/zs/5v/1nzs5vsexsokkaepdxe_mo-klsg.png" width="600"><br><br><img src="https://habrastorage.org/webt/lp/rl/m7/lprlm7iiurfwklhdnun20iqdoci.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bis der Puffer zu 80% voll ist, werden Pakete √ºberhaupt nicht verworfen - die Wahrscheinlichkeit betr√§gt 0%. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80 bis 100 Pakete werden verworfen, und je mehr, desto h√∂her die Warteschlangenf√ºllung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Prozentsatz steigt also von 0 auf 30. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Nebeneffekt von RED ist, dass aggressive TCP-Sitzungen eher langsamer werden, einfach weil es viele Pakete gibt und sie eher verworfen werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Ineffizienz bei der Verwendung des ROTEN Streifens wird behoben, indem ein viel kleinerer Teil der Sitzungen abgestumpft wird, ohne dass ein so schwerwiegender Druck zwischen den Z√§hnen auftritt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Genau aus dem gleichen Grund kann UDP nicht alles besetzen.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WRED - Gewichtete zuf√§llige Fr√ºherkennung </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber bei der Anh√∂rung von allen wahrscheinlich noch </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WRED</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Der kluge Leser von Linkmeup hat bereits vorgeschlagen, dass dies das gleiche ROT ist, aber abwechselnd gewichtet. Und er hatte nicht ganz recht. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RED arbeitet in derselben Warteschlange. Es macht keinen Sinn, auf EF zur√ºckzublicken, wenn das BE voll ist. Dementsprechend bringt das Abwiegen nichts. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier funktioniert Drop Precedence einfach. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und innerhalb derselben Warteschlange haben Pakete mit unterschiedlicher Drop-Priorit√§t unterschiedliche Kurven. Je niedriger die Priorit√§t, desto wahrscheinlicher ist es, dass sie zugeschlagen wird. </font></font><br><br><img src="https://habrastorage.org/webt/ef/rg/_v/efrg_vx4xacb4uwjrkvcdutemho.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier gibt es drei Kurven: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rot - Verkehr mit geringerer Priorit√§t (in Bezug auf das Fallenlassen), Gelb - mehr, Gr√ºn - Maximum.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Roter Verkehr wird verworfen, wenn der Puffer zu 20% voll ist. Von 20 auf 40 sinkt er auf 20% und dann auf Tail Drop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gelb beginnt sp√§ter - von 30 bis 50 wird es bis zu 10% verworfen, dann - Tail Drop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√ºn ist am wenigsten anf√§llig: von 50 bis 100 w√§chst es sanft auf 5%. Als n√§chstes kommt Tail Drop. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Fall von DSCP kann dies AF11, AF12 und AF13 sein, jeweils gr√ºn, gelb und rot. </font></font><br><br><img src="https://habrastorage.org/webt/jv/jm/9q/jvjm9qul8wyhrhncvx8iylnbl5s.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier ist es sehr wichtig, dass es mit TCP funktioniert und absolut nicht auf UDP anwendbar ist. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oder eine Anwendung, die UDP verwendet, ignoriert Verluste, wie im Fall von Telefonie oder Video-Streaming, und dies wirkt sich negativ auf das aus, was der Benutzer sieht.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oder die Anwendung selbst steuert die Zustellung und fordert Sie auf, dasselbe Paket erneut zu senden. Die Quelle muss jedoch nicht aufgefordert werden, die √úbertragungsrate zu senken. Und anstatt die Last zu reduzieren, ist eine Erh√∂hung auf erneute √úbertragungen zur√ºckzuf√ºhren. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deshalb wird f√ºr EF nur Tail Drop verwendet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr CS6, CS7 wird auch Tail Drop verwendet, da keine hohen Geschwindigkeiten angenommen werden und WRED nichts l√∂st. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr AF wird WRED angewendet. AFxy, wobei x die Klasse des Dienstes ist, dh die Warteschlange, in die er f√§llt, und y die Ablagepriorit√§t ist - dieselbe Farbe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr BE wird die Entscheidung basierend auf dem vorherrschenden Verkehr in dieser Warteschlange getroffen.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Innerhalb eines einzelnen Routers wird eine spezielle interne Paketkennzeichnung verwendet, die sich von der unterscheidet, die die Header enth√§lt. </font><font style="vertical-align: inherit;">Daher k√∂nnen MPLS und 802.1q, bei denen die Drop-Priorit√§t nicht codiert werden kann, in Warteschlangen mit unterschiedlichen Drop-Priorit√§ten verarbeitet werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispielsweise kam ein MPLS-Paket zu einem Knoten, tr√§gt keine Drop-Precedence-Kennzeichnung, stellte sich jedoch nach den Ergebnissen des Polierens als gelb heraus und kann verworfen werden, bevor es in die Warteschlange gestellt wird (was durch das Feld Verkehrsklasse bestimmt werden kann). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es sei daran erinnert, dass dieser ganze Regenbogen nur innerhalb des Knotens existiert. </font><font style="vertical-align: inherit;">Es gibt kein Konzept von Farbe in der Linie zwischen Nachbarn. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obwohl es nat√ºrlich m√∂glich ist, Farben im Drop Precedence-Teil von DSCP zu codieren.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Drops k√∂nnen auch in einem entladenen Netzwerk auftreten, in dem anscheinend kein Warteschlangen√ºberlauf auftreten sollte. </font></font> Wie? <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Grund daf√ºr k√∂nnen kurze Verkehrsst√∂√üe sein. </font><font style="vertical-align: inherit;">Das einfachste Beispiel - 5 Anwendungen gleichzeitig haben beschlossen, Datenverkehr auf einen Endhost zu √ºbertragen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Beispiel ist komplizierter: Der Sender ist √ºber die 10-Gbit / s-Schnittstelle verbunden und der Empf√§nger ist 1 Gbit / s. </font><font style="vertical-align: inherit;">In der Umgebung selbst k√∂nnen Sie Pakete schneller auf dem Absender erstellen. </font><font style="vertical-align: inherit;">Die Ethernet-Flusskontrolle des Empf√§ngers fordert den n√§chsten Host auf, langsamer zu werden, und Pakete sammeln sich in den Puffern an.</font></font><br></blockquote><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Was tun, wenn alles schlimmer wird? </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. √úberlastungsmanagement </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn alles schlecht ist, sollte wichtigerem Verkehr die Verarbeitungspriorit√§t einger√§umt werden. Die Wichtigkeit jedes Pakets wird in der Klassifizierungsphase bestimmt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber was ist schlecht? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicht alle Puffer m√ºssen verstopft sein, damit bei Anwendungen Probleme auftreten. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das einfachste Beispiel sind Sprachpakete, die sich um gro√üe Pakete gro√üer Pakete einer Anwendung dr√§ngen, die eine Datei herunterl√§dt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies erh√∂ht die Verz√∂gerung, ruiniert den Jitter und verursacht m√∂glicherweise Tropfen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, wir haben Probleme mit der Bereitstellung hochwertiger Dienstleistungen, wenn keine tats√§chliche √úberlastung vorliegt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieses Problem soll den Mechanismus der √úberlastungsverwaltung l√∂sen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Datenverkehr verschiedener Anwendungen ist, wie oben gesehen, in Warteschlangen unterteilt.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber nur deshalb sollte alles wieder zu einer Schnittstelle verschmelzen. </font><font style="vertical-align: inherit;">Die Serialisierung erfolgt weiterhin nacheinander. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie schaffen es verschiedene Warteschlangen, unterschiedliche Dienstebenen bereitzustellen? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entfernen Sie Pakete unterschiedlich aus verschiedenen Warteschlangen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Dispatcher ist damit besch√§ftigt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir werden heute die Mehrheit der Disponenten betrachten, beginnend mit den einfachsten:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FIFO - nur eine Zeile, alles in BE, C - Ungerechtigkeit. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PQ - der Weg zu den Oligarchen, Lakaien geben nach. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FQ - alle sind gleich. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DWRR - alle sind gleich, aber einige sind gleichm√§√üiger. </font></font></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FIFO - First In, First Out </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der einfachste Fall, in der Tat das Fehlen von QoS, ist, dass der gesamte Datenverkehr auf dieselbe Weise behandelt wird - in einer Warteschlange. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pakete verlassen die Warteschlange genau in der Reihenfolge, in der sie dort angekommen sind, daher der Name: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zuerst eingegeben - zuerst und links</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIFO ist weder ein Dispatcher im wahrsten Sinne des Wortes noch ein DiffServ-Mechanismus im Allgemeinen, da es keine Klassen trennt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn sich die Warteschlange f√ºllt, Verz√∂gerungen und Jitter zunehmen, k√∂nnen Sie sie nicht verwalten, da Sie kein wichtiges Paket aus der Mitte der Warteschlange ziehen k√∂nnen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aggressive TCP-Sitzungen mit einer Paketgr√∂√üe von 1.500 Byte k√∂nnen die gesamte Warteschlange belegen, wodurch kleine Sprachpakete leiden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im FIFO werden alle Klassen in CS0 zusammengef√ºhrt.</font></font><br><br><img src="https://habrastorage.org/webt/am/-w/0k/am-w0kosnvx3ucg3qpdbnou1blk.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trotz all dieser M√§ngel funktioniert das Internet jetzt so. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die meisten FIFO-Anbieter sind jetzt der Standard-Dispatcher mit einer Warteschlange f√ºr den gesamten Transitverkehr und einer weiteren f√ºr lokal generierte Servicepakete. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist einfach und extrem billig. Wenn die Kan√§le breit sind und wenig Verkehr herrscht, ist alles in Ordnung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Quintessenz der Idee, dass QoS - f√ºr die Armen - das Band erweitert und die Kunden zufrieden sind und Ihr Gehalt um ein Vielfaches steigt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nur so funktionierten Netzwerkger√§te einmal. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber sehr bald wurde die Welt mit der Tatsache konfrontiert, dass es einfach nicht funktionieren w√ºrde.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit dem Trend zu konvergierten Netzwerken wurde deutlich, dass verschiedene Arten von Verkehr (Dienst, Sprache, Multimedia, Surfen im Internet, Dateifreigabe) grundlegend unterschiedliche Netzwerkanforderungen haben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIFO war nicht genug, daher erstellten sie mehrere Warteschlangen und begannen, Verkehrsplanungsschemata zu erstellen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIFO verl√§sst jedoch nie unser Leben: In jeder Warteschlange werden Pakete immer nach dem FIFO-Prinzip verarbeitet.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PQ - Priority Queuing </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der zweitkomplizierteste Mechanismus und Versuch, den Dienst in Klassen zu unterteilen, ist eine </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Priorit√§tswarteschlange</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Datenverkehr wird jetzt in mehreren Warteschlangen entsprechend seiner Klassenpriorit√§t angeordnet (z. B., obwohl nicht unbedingt, dasselbe BE, AF1-4, EF, CS6-7). Der Dispatcher durchl√§uft eine Warteschlange nach der anderen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuerst werden alle Pakete aus der Warteschlange mit der h√∂chsten Priorit√§t √ºbersprungen, dann von weniger und dann von weniger.</font></font> Und so im Kreis. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Dispatcher beginnt erst mit dem Abrufen von Paketen mit niedriger Priorit√§t, wenn die Warteschlange mit hoher Priorit√§t leer ist. </font></font><br><br><img src="https://habrastorage.org/webt/4g/l0/sl/4gl0slzp0q6kybjw14xpvvs5xt0.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn zum Zeitpunkt der Verarbeitung von Paketen mit niedriger Priorit√§t ein Paket in einer Warteschlange mit h√∂herer Priorit√§t ankommt, wechselt der Dispatcher zu dieser und kehrt erst nach dem Entleeren zu den anderen zur√ºck. </font></font><br><br><img src="https://habrastorage.org/webt/xm/qk/v1/xmqkv1cbt_uidd4yj1nntt2jehq.gif"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PQ funktioniert fast so gut wie FIFO. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es eignet sich hervorragend f√ºr Verkehrstypen wie Protokollpakete und Sprache, bei denen Verz√∂gerungen kritisch sind und das Gesamtvolumen nicht sehr gro√ü ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun, Sie m√ºssen zugeben, Sie sollten BFD Hello nicht behalten, da mehrere gro√üe Video-Chunks von YouTube gekommen sind. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber hier liegt das Fehlen von PQ - wenn die Priorit√§tswarteschlange mit Verkehr geladen ist, wird der Dispatcher niemals zu anderen wechseln.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und wenn ein Doktor Evil auf der Suche nach Methoden zur Eroberung der Welt beschlie√üt, seinen gesamten b√∂sartigen Verkehr mit der h√∂chsten schwarzen Markierung zu markieren, werden alle anderen pflichtbewusst warten und dann verworfen werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist auch nicht erforderlich, f√ºr jede Linie √ºber eine garantierte Fahrspur zu sprechen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warteschlangen mit hoher Priorit√§t k√∂nnen durch die Geschwindigkeit des in ihnen verarbeiteten Datenverkehrs gek√ºrzt werden. </font><font style="vertical-align: inherit;">Dann werden andere nicht verhungern. </font><font style="vertical-align: inherit;">Dies zu kontrollieren ist jedoch nicht einfach.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die folgenden Mechanismen durchlaufen nacheinander alle Warteschlangen und entnehmen ihnen eine bestimmte Datenmenge, um ehrlichere Bedingungen zu schaffen. </font><font style="vertical-align: inherit;">Aber sie machen es anders.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FQ-Fair Queuing </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der n√§chste Anw√§rter auf die Rolle eines idealen Dispatchers sind </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">faire Warteschlangenmechanismen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> FQ - Fair Queuing </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seine Geschichte begann 1985, als John Nagle vorschlug, f√ºr jeden Datenstrom eine Warteschlange zu erstellen. Im Geiste liegt dies nahe am IntServ-Ansatz und l√§sst sich leicht dadurch erkl√§ren, dass die Idee von Serviceklassen wie DiffServ damals nicht existierte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FQ extrahierte die gleiche Datenmenge nacheinander aus jeder Warteschlange. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ehrlichkeit liegt in der Tatsache, dass der Dispatcher </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit der Anzahl der </font><b><font style="vertical-align: inherit;">Pakete arbeitet, sondern mit der Anzahl der Bits</font></b><font style="vertical-align: inherit;"> , die von jeder Warteschlange √ºbertragen werden k√∂nnen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein aggressiver TCP-Stream kann die Schnittstelle also nicht √ºberfluten, und alle erhalten gleiche Chancen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der Theorie. FQ wurde in der Praxis nie als Mechanismus zum Versenden von Warteschlangen in Netzwerkger√§ten implementiert. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt drei Nachteile:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das erste - offensichtlich - es ist sehr teuer - eine Warteschlange f√ºr jeden Stream zu starten, das Gewicht jedes Pakets zu z√§hlen und sich immer um die zu √ºberspringenden Bits und die Gr√∂√üe des Pakets zu k√ºmmern. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das zweite - weniger offensichtliche - alle Threads erhalten gleiche Chancen in Bezug auf die Bandbreite. Und wenn ich ungleich will? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die dritte - nicht offensichtliche - FQ-Ehrlichkeit ist absolut: Jeder hat gleiche Verz√∂gerungen, aber es gibt Themen, die wichtiger sind als die Verz√∂gerung als die Band. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unter 256 Streams gibt es beispielsweise Sprach-Streams, was bedeutet, dass jeder von ihnen nur 256 Threads erreicht. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und was mit ihnen zu tun ist, ist unklar. </font></font><br><br><img src="https://habrastorage.org/webt/o_/cg/au/o_cgau4ggmorq1cj28jn3hf26iq.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier k√∂nnen Sie sehen, dass wir aufgrund der Gr√∂√üe des Pakets in der 3. Stufe in den ersten beiden Zyklen ein Paket aus den ersten beiden verarbeitet haben.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Beschreibung der bitweisen Mechanismen von Round Robin und GPS geht bereits √ºber den Rahmen dieses Artikels hinaus, und ich verweise den Leser auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eine unabh√§ngige Studie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WFQ - Weighted Fair Queuing </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der zweite und teilweise dritte Fehler des FQ versuchte, den 1989 ver√∂ffentlichten WFQ zu schlie√üen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jede Warteschlange war mit Gewicht und dementsprechend mit dem Recht ausgestattet, Verkehr in Vielfachen des Gewichts pro Zyklus zu geben. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Gewicht wurde auf der Grundlage von zwei Parametern berechnet: noch relevant dann IP-Vorrang und die Paketl√§nge. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Zusammenhang mit WFQ gilt: Je mehr Gewicht, desto schlechter. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je h√∂her die IP-Priorit√§t ist, desto geringer ist daher das Paketgewicht. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je kleiner die Packungsgr√∂√üe ist, desto geringer ist das Gewicht. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somit erhalten kleine Pakete mit hoher Priorit√§t die meisten Ressourcen, w√§hrend Riesen mit niedriger Priorit√§t warten.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der folgenden Abbildung haben Pakete solche Gewichte empfangen, dass zuerst ein Paket aus der ersten Warteschlange √ºbersprungen wird, dann zwei aus der zweiten, erneut aus der ersten und erst dann das dritte. So k√∂nnte es beispielsweise passieren, wenn die Gr√∂√üe der Pakete in der zweiten Stufe relativ klein ist. </font></font><br><br><img src="https://habrastorage.org/webt/dd/z9/v7/ddz9v7nahrtmewfrul4mbflc5b0.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úber die harte Technik von WFQ mit seiner Paketendzeit, virtuellen Zeit und dem Per√ºckensatz k√∂nnen Sie in einem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">merkw√ºrdigen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Farbdokument lesen </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies l√∂ste jedoch nicht das erste und dritte Problem. Der Flow-basierte Ansatz war ebenso unpraktisch, und die Flows, die kurze Verz√∂gerungen und stabilen Jitter ben√∂tigten, erhielten sie nicht.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies hinderte WFQ jedoch nicht daran, in einigen (meist alten) Cisco-Ger√§ten verwendet zu werden. </font><font style="vertical-align: inherit;">Es gab bis zu 256 Warteschlangen, in denen Threads basierend auf dem Hash ihrer Header platziert wurden. </font><font style="vertical-align: inherit;">Ein Kompromiss zwischen dem Flow-basierten Paradigma und begrenzten Ressourcen.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CBWFQ - Klassenbasiertes WFQ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBWFQ hat mit dem Aufkommen von DiffServ den Ansatz f√ºr das Komplexit√§tsproblem gemacht. Behavior Aggregate klassifizierte alle Verkehrskategorien in 8 Klassen und dementsprechend in Warteschlangen. Dies gab ihm einen Namen und vereinfachte das Anstehen erheblich. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Gewicht in CBWFQ hat eine andere Bedeutung erhalten. Das Gewicht wurde </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klassen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (nicht Threads) in der Konfiguration auf Anfrage des Administrators manuell </font><font style="vertical-align: inherit;">zugewiesen </font><font style="vertical-align: inherit;">, da das DSCP-Feld bereits f√ºr die Klassifizierung verwendet wurde. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, DSCP hat festgelegt, welche Warteschlange eingef√ºgt werden soll, und das konfigurierte Gewicht - wie viele Spuren f√ºr diese Warteschlange verf√ºgbar sind.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor allem hat dies indirekt das Leben und die Abl√§ufe mit geringer Latenz etwas erleichtert, die nun zu einer (zwei, drei, ...) Warteschlange zusammengefasst wurden und ihren H√∂hepunkt viel h√§ufiger erhielten. </font><font style="vertical-align: inherit;">Das Leben ist besser geworden, aber immer noch nicht gut - es gibt √ºberhaupt keine Garantien - im Allgemeinen ist im WFQ alles in Bezug auf Verz√∂gerungen immer noch gleich. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und die Notwendigkeit einer st√§ndigen √úberwachung der Gr√∂√üe von Paketen, ihrer Fragmentierung und Defragmentierung ist nicht verschwunden.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CBWFQ + LLQ - Warteschlange mit geringer Latenz </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der letzte Ansatz, der H√∂hepunkt eines schrittweisen Ansatzes, ist die Vereinigung von CBWFQ mit PQ. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine der Warteschlangen wird zur sogenannten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LLQ</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Warteschlange mit geringer Latenz), und w√§hrend alle anderen Warteschlangen vom CBWFQ-Manager verarbeitet werden, wird der PQ-Manager zwischen den LLQs und den anderen ausgef√ºhrt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, w√§hrend sich Pakete in LLQ befinden, warten die verbleibenden Warteschlangen und ihre Verz√∂gerungen nehmen zu. </font><font style="vertical-align: inherit;">Sobald die Pakete in LLQ ausgegangen waren, gingen wir, um den Rest zu verarbeiten. </font><font style="vertical-align: inherit;">Pakete erschienen in LLQ - sie verga√üen den Rest und kehrten dorthin zur√ºck. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FIFO funktioniert auch in LLQ, daher sollten Sie nicht alles verschieben, ohne dorthin zu gelangen, und gleichzeitig die Pufferauslastung und die Verz√∂gerung erh√∂hen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Damit Warteschlangen ohne Priorit√§t nicht verhungern, lohnt es sich jedoch, eine Bandbreitenbeschr√§nkung in LLQ festzulegen. </font></font><br><br><img src="https://habrastorage.org/webt/c6/4m/vt/c64mvts-kr2ij0o_zf2kfxy2cbu.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Schafe sind also voll und die W√∂lfe in Sicherheit.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RR - Round-Robin </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hand in Hand mit FQ ging und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einer war ehrlich, aber nicht einfach. </font><font style="vertical-align: inherit;">Der andere ist genau das Gegenteil. </font></font><br><br><img src="https://habrastorage.org/webt/8p/nh/de/8pnhdeko9l5nkiss6mbtxbg9jvk.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RR ging die Warteschlangen durch und extrahierte eine gleiche Anzahl von Paketen aus ihnen. </font><font style="vertical-align: inherit;">Der Ansatz ist primitiver als FQ und daher in Bezug auf verschiedene Fl√ºsse unehrlich. </font><font style="vertical-align: inherit;">Aggressive Quellen k√∂nnen den Streifen leicht mit Paketen von 1500 Byte Gr√∂√üe √ºberfluten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Implementierung war jedoch sehr einfach: Sie m√ºssen die Gr√∂√üe des Pakets in der Warteschlange nicht kennen, es fragmentieren und dann wieder sammeln. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seine Ungerechtigkeit bei der Zuteilung des Streifens versperrte ihm jedoch den Weg in die Welt - in der Welt der Netzwerke wurde reines Round-Robin nicht umgesetzt.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WRR - Weighted Round Robin </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das gleiche Schicksal ist mit WRR, das den Warteschlangen basierend auf der IP-Priorit√§t mehr Gewicht verlieh. </font><font style="vertical-align: inherit;">In WRR wurde nicht die gleiche Anzahl von Paketen herausgenommen, sondern ein Vielfaches des Warteschlangengewichts. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es w√§re m√∂glich, Warteschlangen mit kleineren Paketen mehr Gewicht zu verleihen, aber dies dynamisch zu tun, war nicht m√∂glich.</font></font><br><br><img src="https://habrastorage.org/webt/lx/4b/an/lx4bancel1tl9stwbeay0s6n1ma.png" width="800"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DWRR - Defizitgewichteter Round Robin </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und pl√∂tzlich wurde 1995 von M. Shreedhar und G. Varghese ein √§u√üerst merkw√ºrdiger Ansatz vorgeschlagen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jede Zeile hat eine separate </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kreditlinie</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Bits. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beim Verlassen der Warteschlange werden so viele Pakete ausgegeben, wie gen√ºgend Guthaben vorhanden ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Gr√∂√üe des Pakets im Kopf der Warteschlange wird vom Darlehensbetrag abgezogen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Differenz gr√∂√üer als Null ist, wird dieses Paket entfernt und das n√§chste √ºberpr√ºft. Also bis die Differenz kleiner als Null ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn selbst das erste Paket nicht genug Guthaben hat, bleibt der Schlamm in der Warteschlange. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vor dem n√§chsten Durchgang wird das Guthaben jeder Zeile um einen bestimmten Betrag erh√∂ht, der als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quantum bezeichnet wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr verschiedene Warteschlangen ist das Quantum unterschiedlich - je gr√∂√üer das Band ist, das Sie geben m√ºssen, desto gr√∂√üer ist das Quantum. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somit erhalten alle Warteschlangen eine garantierte Bandbreite, unabh√§ngig von der Gr√∂√üe der darin enthaltenen Pakete. </font></font><br><br><img src="https://habrastorage.org/webt/vr/hv/vk/vrhvvk-1opimw_vofynmrkosbv8.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aus der obigen Erkl√§rung w√§re mir nicht klar, wie das funktioniert.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie uns die Schritte zeichnen ...</font></font></b> <div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lassen Sie uns den sph√§rischen Fall analysieren: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DRR (ohne W), </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4 Zeilen </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der 0. sind alle Pakete jeweils 500 Bytes, </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In der 1. - 1000 jeweils </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In der 2. bis 1500, </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und im 3. liegt eine Wurst f√ºr 4000, </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Quantum - 1600 Bytes. </font></font></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/64d/911/64e/64d91164edc5867e9009f54de10a50da.png"><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zyklus 1 </font></font></h5><br> <b> 1.  0</b> <br>   ,     1600  () <br>    0- .  : <br>      ‚Äî  (1600 ‚Äî 500 = 1100). <br>  ‚Äî  ‚Äî  (1100 ‚Äî 500 = 600). <br>  ‚Äî  ‚Äî  (600 ‚Äî 500 = 100). <br>  ‚Äî    (100 ‚Äî 500 = -400).    . <br>   ‚Äî 100 . <br><br><img src="https://habrastorage.org/webt/9y/4x/al/9y4xalhqrwwayufvjfcxlfevl20.png"><br><br> <b> 1.  1</b> <br>    ‚Äî  (1600 ‚Äî 1000 = 600). <br>    (600 ‚Äî 1000 = -400).    . <br>   ‚Äî 600 . <br><br><img src="https://habrastorage.org/webt/yw/mr/qh/ywmrqhm_deusdb04dez-3gjermc.png"><br><br> <b> 1.  2</b> <br>    ‚Äî  (1600 ‚Äî 1500 = 100). <br>    (100 ‚Äî 1000 = -900).    . <br>   ‚Äî 100 . <br><br><img src="https://habrastorage.org/webt/aj/el/k6/ajelk6xd9tpkl70r5hgt6q9q2u0.png"><br><br> <b> 1.  3</b> <br>     . (1600 ‚Äî 4000 = -2400). <br>    . <br>   ‚Äî   1600 . <br><br><img src="https://habrastorage.org/webt/jw/fo/3e/jwfo3eobllx5--quzb9qqt3zt0c.png"><br><br> ,       : <br><br><ul><li>  0 ‚Äî 1500 </li><li>  1 ‚Äî 1000 </li><li>  2 ‚Äî 1500 </li><li>  3 ‚Äî 0 </li></ul><br>  : <br><br><ul><li>  0 ‚Äî 100 </li><li>  1 ‚Äî 600 </li><li>  2 ‚Äî 100 </li><li>  3 ‚Äî 1600 </li></ul><br><h5>  2 </h5><br>          ‚Äî   1600 . <br><br> <b> 2.  0</b> <br>    1700 (100 + 1600). <br>       ‚Äî   (1700 ‚Äî 3*500 = 200). <br>     . <br>   ‚Äî 200 . <br><br><img src="https://habrastorage.org/webt/4z/di/2s/4zdi2se_gcciq1rbfkqqzzrumsa.png"><br><br> <b> 2.  1</b> <br>    2200 (600 + 1600). <br>       ‚Äî   (2200 ‚Äî 2*1000 = 200). <br>    . <br>   ‚Äî 200 . <br><img src="https://habrastorage.org/webt/9e/1z/sl/9e1zsl63ko7jxqjjuv4snupl6kw.png"><br><br> <b> 2.  2</b> <br>    1700 (100 + 1600). <br>      ‚Äî   (2200 ‚Äî 1500 = 200). <br>   ‚Äî  . <br>   ‚Äî 200 . <br><br><img src="https://habrastorage.org/webt/xf/v5/ni/xfv5nifo1wqvxfrhjqlfoygdk1w.png"><br><br> <b> 2.  3</b> <br>    3200 (1600 + 1600). <br>       (3200 ‚Äî 4000 = -800) <br>   ‚Äî 3200 . <br><img src="https://habrastorage.org/webt/wn/wj/pe/wnwjpenhub6ir2d8vi69oxan8-s.png"><br><br> ,       : <br><br><ul><li>  0 ‚Äî 3000 </li><li>  1 ‚Äî 3000 </li><li>  2 ‚Äî 3000 </li><li>  3 ‚Äî 0 </li></ul><br>  : <br><br><ul><li>  0 ‚Äî 200 </li><li>  1 ‚Äî 200 </li><li>  2 ‚Äî 200 </li><li>  3 ‚Äî 3200 </li></ul><br><h5>  3 </h5><br>          ‚Äî 1600 . <br><br> <b> 3.  0</b> <br>    1800 (200 + 1600). <br>        ‚Äî   (1800 ‚Äî 3*500 = 300). <br>     . <br>   ‚Äî 300 . <br><br><img src="https://habrastorage.org/webt/lk/sk/tq/lksktqj1g_7q6m2p8jwq0olnfuw.png"><br><br> <b> 3.  1</b> <br>    1800 (200 + 1600). <br>    ‚Äî  (1800 ‚Äî 1000 = 800). <br>   ‚Äî 800 . <br><br><img src="https://habrastorage.org/webt/fg/bd/jd/fgbdjdmydatamvpzxome7reb5pc.png"><br><br> <b> 3.  2</b> <br>    1800 (200 + 1600). <br>    ‚Äî  (1800 ‚Äî 1500 = 300). <br>   ‚Äî 300 . <br><br><img src="https://habrastorage.org/webt/s1/a7/iv/s1a7iv6mpfy1kesgzuazx9hsgkk.png"><br><br> <b> 3.  3</b> <br>    3-  ! <br>    4800 (3200 + 1600). <br>    ‚Äî  (4800 ‚Äî 4000 = 800). <br>   ‚Äî 800 . <br><br><img src="https://habrastorage.org/webt/fm/fh/tn/fmfhtnvh1utrr0yovddsambv_fe.png"><br><br> ,       : <br><br><ul><li>  0 ‚Äî 4500 </li><li>  1 ‚Äî 4000 </li><li>  2 ‚Äî 4500 </li><li>  3 ‚Äî 4000 </li></ul><br>  : <br><br><ul><li>  0 ‚Äî 300 </li><li>  1 ‚Äî 800 </li><li>  2 ‚Äî 300 </li><li>  3 ‚Äî 800 </li></ul><br><img src="https://habrastorage.org/webt/q5/q9/pj/q5q9pjzqa1be-uluk_eucxwga9w.png"><br><br>     DRR.          . <br><br>    ,  . <br><br><img src="https://habrastorage.org/webt/5l/6o/nd/5l6onduvx4djvafmxj7bhsoxwwm.gif"><br><br>  DWRR  DRR   ,        ,   ,     . <br><br><hr><br>     DRR,        ‚Äî    ,   . <br><br>     :  ,     .           . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei DWRR bleibt die Frage bei der Garantie von Verz√∂gerungen und Jitter - das Gewicht l√∂st sie in keiner Weise. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Theoretisch k√∂nnen Sie dasselbe wie mit CB-WFQ tun, indem Sie LLQ hinzuf√ºgen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist jedoch nur eines der m√∂glichen Szenarien der heutigen wachsenden Popularit√§t.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PB-DWRR - Priorit√§tsbasiertes DWRR </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tats√§chlich wird der heutige Mainstream zu PB-DWRR - Priority Based Deficit Weighted Round Robin. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist das gleiche alte b√∂se DWRR, in dem eine weitere Warteschlange hinzugef√ºgt wird - Priorit√§t, in der Pakete mit einer h√∂heren Priorit√§t verarbeitet werden. </font><font style="vertical-align: inherit;">Dies bedeutet nicht, dass sie einen gr√∂√üeren Streifen erh√§lt, sondern dass Pakete h√§ufiger von dort genommen werden. </font></font><br><br><img src="https://habrastorage.org/webt/wg/6g/ui/wg6guiijtoscyckwdwr49gkp0fq.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt verschiedene Ans√§tze zur Implementierung von PB-DWRR. </font><font style="vertical-align: inherit;">In einigen von ihnen, wie in PQ, wird jedes Paket, das in der Priorit√§tswarteschlange ankommt, sofort entfernt. </font><font style="vertical-align: inherit;">In anderen F√§llen wird jedes Mal darauf zugegriffen, wenn der Dispatcher zwischen Warteschlangen wechselt. </font><font style="vertical-align: inherit;">Drittens werden ein Kredit und ein Quantum daf√ºr eingef√ºhrt, so dass die Priorit√§tswarteschlange nicht den gesamten Streifen quetschen kann. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nat√ºrlich werden wir sie nicht analysieren.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eine kurze Zusammenfassung der Versandmechanismen </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seit Jahrzehnten versucht die Menschheit, das schwierigste Problem zu l√∂sen, das richtige Serviceniveau und eine faire Verteilung der Band sicherzustellen. Warteschlangen waren das Hauptwerkzeug. Die einzige Frage war, wie Pakete aus den Warteschlangen abgerufen und in eine Schnittstelle verschoben werden k√∂nnen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnend mit FIFO erfand es PQ - die Stimme konnte mit dem Surfen koexistieren, aber es gab keine Frage, die Band zu garantieren. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es erschienen mehrere monstr√∂se FQ, WFQ, die funktionierten, wenn nicht pro Flow, dann fast so. CB-WFQ kam in die Klassengesellschaft, aber es wurde nicht einfacher. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als Alternative entwickelte er RR. Es wurde ein WRR und dann ein DWRR. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und in den Tiefen jedes Dispatchers lebt FIFO.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie Sie sehen, gibt es jedoch keinen universellen Dispatcher, der alle erforderlichen Klassen verarbeitet. </font><font style="vertical-align: inherit;">Es handelt sich immer um eine Kombination von Dispatchern, von denen einer das Problem der Sicherstellung von Verz√∂gerungen, Jitter und fehlenden Verlusten l√∂st und der andere die Bandzuweisung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBWFQ + LLQ oder PB-WDRR oder WDRR + PQ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf realen Ger√§ten k√∂nnen Sie angeben, welche Warteschlangen mit welchem ‚Äã‚ÄãDispatcher verarbeitet werden sollen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBWFQ, WDRR und ihre Derivate sind heute die Favoriten. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PQ, FQ, WFQ, RR, WRR - wir trauern nicht und erinnern uns nicht (es sei denn, wir bereiten uns nat√ºrlich auf CCIE Clipper vor).</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Disponenten k√∂nnen also Geschwindigkeit garantieren, aber wie kann man sie von oben begrenzen? </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8. Geschwindigkeitsbegrenzung </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Notwendigkeit, die Verkehrsgeschwindigkeit auf den ersten Blick zu begrenzen, liegt auf der Hand - lassen Sie den Kunden nicht gem√§√ü der Vereinbarung aus seiner Band. </font></font><br><br>  Ja  Aber nicht nur das.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Angenommen, es gibt eine RRL-Spanne mit einer Breite von 620 Mbit / s, die √ºber einen 1-Gbit / s-Port verbunden ist. Wenn Sie den gesamten Gigabit hineinschie√üen, beginnen irgendwo auf der RRL, die h√∂chstwahrscheinlich keine Ahnung von Warteschlangen und QoS hat, monstr√∂se Tropfen zuf√§lliger Art, die nicht an die tats√§chlichen Priorit√§ten des Verkehrs gebunden sind. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie jedoch die Formgebung von bis zu 600 Mbit / s auf dem Router aktivieren, werden EF, CS6, CS7 √ºberhaupt nicht verworfen, und in BE, AFx werden das Band und die Tropfen entsprechend ihrer Gewichtung verteilt. RRL wird 600 Mb / s erreichen und wir werden ein vorhersehbares Bild erhalten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein weiteres Beispiel ist die Zugangskontrolle. Beispielsweise haben sich zwei Betreiber darauf geeinigt, den Markierungen des anderen zu vertrauen, mit Ausnahme von CS7 - falls etwas in CS7 enthalten ist - verwerfen. Geben Sie f√ºr CS6 und EF eine separate Warteschlange mit Garantie f√ºr Verz√∂gerung und ohne Verlust an.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber was w√§re, wenn der listige Partner anfangen w√ºrde, Str√∂me in diese Zeilen zu gie√üen? </font><font style="vertical-align: inherit;">Auf Wiedersehen Telefonie. </font><font style="vertical-align: inherit;">Und die Protokolle werden h√∂chstwahrscheinlich auseinanderfallen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Fall ist es logisch, sich mit einem Partner √ºber den Streifen zu einigen. </font><font style="vertical-align: inherit;">Alles, was in den Vertrag passt, wird √ºbersprungen. </font><font style="vertical-align: inherit;">Was nicht passt - verwerfen oder in eine andere Warteschlange √ºbertragen - BE zum Beispiel. </font><font style="vertical-align: inherit;">So sch√ºtzen wir unser Netzwerk und unsere Dienstleistungen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt zwei grundlegend unterschiedliche Ans√§tze zur Geschwindigkeitsbegrenzung: Polieren und Formen. </font><font style="vertical-align: inherit;">Sie l√∂sen ein Problem, aber auf unterschiedliche Weise. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Betrachten Sie den Unterschied anhand eines Beispiels f√ºr ein solches Verkehrsprofil:</font></font><br><br><img src="https://habrastorage.org/webt/5b/sj/st/5bsjstoglxkg7dspcxjrphdjsye.png" width="500"><br><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verkehrspolizei </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die √úberwachung begrenzt die Geschwindigkeit, indem √ºbersch√ºssiger Verkehr abf√§llt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alles, was den eingestellten Wert √ºberschreitet, schneidet und wirft der Polyser weg. </font></font><br><br><img src="https://habrastorage.org/webt/a3/dl/xa/a3dlxapkcptfnfejftde0qxycjc.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was geschnitten wird, wird vergessen. Das Bild zeigt, dass das rote Paket nach dem Polyser nicht im Verkehr ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und so sieht das ausgew√§hlte Profil nach dem Polyser aus: </font></font><br><br><img src="https://habrastorage.org/webt/jb/rw/52/jbrw52md7mynstgrt9-o1a1mo1s.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufgrund der Schwere der ergriffenen Ma√ünahmen wird dies als </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hard Policing bezeichnet</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt jedoch andere m√∂gliche Aktionen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Polizist arbeitet normalerweise in Verbindung mit einer Verkehrsanzeige. Das Messger√§t f√§rbt die Taschen, wie Sie sich erinnern, in Gr√ºn, Gelb oder Rot. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und aufgrund dieser Farbe darf der Polyser das Paket nicht verwerfen, sondern in eine andere Klasse einordnen. Dies sind weiche Ma√ünahmen - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soft Policing</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es kann sowohl auf eingehenden als auch auf ausgehenden Verkehr angewendet werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Besonderheit des Polysers ist die F√§higkeit, Verkehrsst√∂√üe zu absorbieren und dank des Token-Bucket-Mechanismus die maximal zul√§ssige Geschwindigkeit zu bestimmen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, alles, was nicht √ºber dem eingestellten Wert liegt, wird nicht abgeschnitten - es darf ein wenig dar√ºber hinausgehen - kurze Bursts oder kleine √úbersch√ºsse des zugewiesenen Bandes werden √ºbersprungen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Name ‚ÄûPolizeiarbeit‚Äú wird durch das ziemlich strenge Verh√§ltnis des Tools zu √ºberm√§√üigem Datenverkehr bestimmt - Verwerfen oder Herabstufen zu einer niedrigeren Klasse.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verkehrsgestaltung </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Formen begrenzt die Geschwindigkeit, indem √ºbersch√ºssiger Verkehr gepuffert wird. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der gesamte eingehende Verkehr wird durch den Puffer geleitet. Ein Shaper entfernt Pakete mit konstanter Geschwindigkeit aus diesem Puffer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Paketankunftsrate zum Puffer niedriger als die Ausgabe ist, werden sie im Puffer nicht verz√∂gert - sie fliegen direkt durch. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und wenn die Ankunftsrate h√∂her als die Ausgabe ist, beginnen sie sich anzusammeln. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Ausgangsgeschwindigkeit ist immer gleich. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somit werden Verkehrsst√∂√üe zum Puffer hinzugef√ºgt und gesendet, wenn sie die Warteschlange erreichen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher ist die Formgebung neben der Planung in Warteschlangen das zweite Werkzeug, das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zur Gesamtverz√∂gerung beitr√§gt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/in/gc/vh/ingcvhgya0fzfiw2sxbeiix7hfw.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Abbildung zeigt deutlich, wie das zum Zeitpunkt t2 ankommende Paket zum Zeitpunkt t3 am Ausgang ankommt. </font><font style="vertical-align: inherit;">t3-t2 ist die vom Former eingef√ºhrte Verz√∂gerung. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shaper wird normalerweise auf ausgehenden Verkehr angewendet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So sieht das Profil nach dem Former aus. </font></font><br><br><img src="https://habrastorage.org/webt/iv/b7/sl/ivb7slyamvreja97npdjyr3ctwk.png" width="500"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Name ‚ÄûShaping‚Äú gibt an, dass das Tool dem Verkehrsprofil eine Form gibt und es gl√§ttet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Hauptvorteil dieses Ansatzes ist die optimale Nutzung des vorhandenen Bandes - anstatt √ºberm√§√üigen Datenverkehr abzubauen, verschieben wir ihn. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Hauptnachteil ist eine unvorhersehbare Verz√∂gerung - wenn der Puffer voll ist, werden Pakete f√ºr eine lange Zeit darin schmachten. </font><font style="vertical-align: inherit;">Daher ist die Formgebung nicht f√ºr alle Arten von Verkehr geeignet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beim Formen wird der Leaky Bucket-Mechanismus verwendet.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Formen versus Polieren </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Arbeit des Polysers √§hnelt einem Messer, das sich entlang der Oberfl√§che des √ñls bewegt und die scharfe Seite des Tuberkels abschneidet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Arbeit eines Formers √§hnelt einer Walze, die die Tuberkel gl√§ttet und gleichm√§√üig auf der Oberfl√§che verteilt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shaper versucht, Pakete nicht zu verwerfen, w√§hrend sie auf Kosten einer erh√∂hten Verz√∂gerung gepuffert werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Polierer f√ºhrt keine Verz√∂gerungen ein, verwirft jedoch Pakete leichter. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anwendungen, die unempfindlich gegen√ºber Verz√∂gerungen sind, f√ºr die jedoch ein Verlust unerw√ºnscht ist, sollten auf einen Former beschr√§nkt werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr diejenigen, f√ºr die ein sp√§tes Paket genauso ist wie ein verlorenes, ist es besser, es sofort fallen zu lassen - als zu polieren.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Shaper hat keinen Einfluss auf die Paket-Header und deren Schicksal au√üerhalb des Knotens, w√§hrend das Ger√§t nach dem Polieren die Klasse im Header neu klassifizieren kann. </font><font style="vertical-align: inherit;">Zum Beispiel hatte das Paket am Eingang die Klasse AF11, die Messung hat es im Ger√§t gelb gestrichen, am Ausgang hat es seine Klasse auf AF12 neu markiert - auf dem n√§chsten Knoten hat es eine h√∂here Wahrscheinlichkeit, verworfen zu werden.</font></font><br><br><img src="https://habrastorage.org/webt/za/y6/kh/zay6khb7cgviroz-zbumfppdtz8.png" width="600"><br><br><hr><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √úben Sie das Polieren und Formen </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Schema ist das gleiche: </font></font><br><br><img src="https://habrastorage.org/webt/zc/0o/zn/zc0ozndb8nmrqajljkf98pp79tk.png" width="900"><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurationsdatei. </font></font></a> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beobachten dieses Bild ohne Einschr√§nkungen: </font></font><br><br><img src="https://habrastorage.org/webt/mg/nz/mv/mgnzmvc_36gtmgf5t3vi0wob1uk.png" width="900"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir werden wie folgt vorgehen:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf der Eingabeschnittstelle Linkmeup_R2 (e0 / 1) konfigurieren wir das Polieren - dies ist die Eingabesteuerung. </font><font style="vertical-align: inherit;">Im Rahmen der Vereinbarung geben wir 10 Mb / s.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Konfigurieren Sie auf der Ausgangsschnittstelle Linkmeup_R4 (e0 / 2) die Formgebung mit 20 Mbit / s. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnen wir mit dem Shaper auf </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linkmeup_R4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alles zusammenpassen:</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>-map match-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> TRISOLARANS_ALL_CM match <span class="hljs-keyword"><span class="hljs-keyword">any</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Form bis zu 20Mb / s: </font></font><br><br><pre> <code class="hljs swift"> policy-<span class="hljs-built_in"><span class="hljs-built_in">map</span></span> <span class="hljs-type"><span class="hljs-type">TRISOLARANS_SHAPING</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TRISOLARANS_ALL_CM</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shape</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">average</span></span></span><span class="hljs-class"> 20000000</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Auf die Ausgabeschnittstelle anwenden: </font></font><br><br><pre> <code class="hljs kotlin"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ethernet0</span></span></span><span class="hljs-class">/2 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">service</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">policy</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">output</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TRISOLARANS_SHAPING</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alles, was die Ethernet0 / 2-Schnittstelle verlassen (ausgeben) soll, formt bis zu 20 Mb / s. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shaper-Konfigurationsdatei. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und hier ist das Ergebnis: </font></font><br><br><img src="https://habrastorage.org/webt/tz/1i/sr/tz1isrb6mnjnirkxe46wbzed2yu.png" width="900"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es </font><font style="vertical-align: inherit;">ergibt </font><font style="vertical-align: inherit;">sich eine ziemlich flache Linie des Gesamtdurchsatzes und der zerrissenen Grafiken f√ºr jeden einzelnen Stream. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatsache ist, dass wir den Shaper auf das allgemeine Band beschr√§nken. </font><font style="vertical-align: inherit;">Je nach Plattform k√∂nnen einzelne Streams jedoch auch individuell gestaltet werden, wodurch Chancengleichheit entsteht.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurieren Sie nun das Polieren auf Linkmeup_R2. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir werden der bestehenden Richtlinie einen Polyser hinzuf√ºgen.</font></font><br><br><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-map TRISOLARANS_ADMISSION_CONTROL <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TRISOLARANS_TCP_CM police cir <span class="hljs-number"><span class="hljs-number">10000000</span></span> bc <span class="hljs-number"><span class="hljs-number">1875000</span></span> conform-action transmit exceed-action <span class="hljs-keyword"><span class="hljs-keyword">drop</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Richtlinie wurde bereits auf die Schnittstelle angewendet: </font></font><br><br><pre> <code class="hljs pgsql"> interface Ethernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> service-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> TRISOLARANS_ADMISSION_CONTROL</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier geben wir die durchschnittlich zul√§ssige Geschwindigkeit CIR (10 MBit / s) und den zul√§ssigen Burst Bc (1.875.000 Byte, ca. 14,6 MB) an. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sp√§ter erkl√§re ich Ihnen, wie der Polyser funktioniert, und erkl√§re Ihnen, was CIR und Bc sind und wie Sie diese Werte bestimmen k√∂nnen. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polyser-Konfigurationsdatei. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieses Bild wird beim Polieren beobachtet. </font><font style="vertical-align: inherit;">Pl√∂tzliche √Ñnderungen des Geschwindigkeitsniveaus sind sofort erkennbar:</font></font><br><br><img src="https://habrastorage.org/webt/wg/vb/iv/wgvbiv6biiv27f99npxfupqjdla.png" width="900"><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein solch interessantes Bild wird jedoch erhalten, wenn wir die zul√§ssige Burst-Gr√∂√üe zu klein machen, beispielsweise 10.000 Bytes. </font></font><br><br><pre> <code class="hljs powershell"> police cir <span class="hljs-number"><span class="hljs-number">10000000</span></span> bc <span class="hljs-number"><span class="hljs-number">10000</span></span> conform<span class="hljs-literal"><span class="hljs-literal">-action</span></span> transmit exceed<span class="hljs-literal"><span class="hljs-literal">-action</span></span> drop</code> </pre> <br><img src="https://habrastorage.org/webt/3a/cn/l0/3acnl01957rqgxcsonokebamdim.png" width="900"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Gesamtgeschwindigkeit fiel sofort auf etwa 2 Mbit / s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seien Sie vorsichtig mit der Einstellung von Bursts :) </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Testtabelle.</font></font></a> <br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Undichter Eimer und Token-Eimer </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es klingt einfach und klar. </font><font style="vertical-align: inherit;">Aber wie funktioniert es in der Praxis und ist in Hardware implementiert?</font></font><br><br>  Ein Beispiel. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ist die Grenze von 400 Mbit / s viel (oder wenig)? </font><font style="vertical-align: inherit;">Im Durchschnitt verwendet ein Client nur 320. Manchmal steigt er jedoch f√ºr 5 Minuten auf 410. </font><font style="vertical-align: inherit;">Und manchmal bis zu 460 pro Minute. </font><font style="vertical-align: inherit;">Und manchmal bis zu 500 f√ºr eine halbe Sekunde. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie der Vertragsanbieter linkmeup sagen kann - 400 und das wars! </font><font style="vertical-align: inherit;">Wenn Sie mehr wollen, verbinden Sie sich mit dem Tarif von 1 Gbit / s + 27 Anime-Kan√§len. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und wir k√∂nnen die Kundenbindung erh√∂hen, wenn dies andere nicht beeintr√§chtigt, indem wir solche Spannungsspitzen zulassen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie kann man 460 Mb / s nur f√ºr eine Minute und nicht f√ºr 30 oder f√ºr immer zulassen? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie kann man 500 Mbit / s zulassen, wenn das Band frei ist, und auf 400 dr√ºcken, wenn andere Verbraucher aufgetreten sind? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Machen Sie jetzt eine Pause, gie√üen Sie einen Eimer stark. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beginnen wir mit dem einfacheren Mechanismus, den der Former verwendet - einem undichten Eimer.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Leaky-Bucket-Algorithmus </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaky Bucket ist ein undichter Eimer. </font></font><br><br><img src="https://habrastorage.org/webt/te/qj/jv/teqjjvam2gz-gwlvfcfr1osqj5q.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben einen Eimer mit einem Loch einer bestimmten Gr√∂√üe am Boden. Taschen werden von oben in diesen Eimer gegossen. Und von unten flie√üen sie mit konstanter Bitrate. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Bucket voll ist, werden neue Pakete verworfen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Gr√∂√üe des Lochs wird durch die angegebene Geschwindigkeitsbegrenzung bestimmt, die f√ºr Leaky Bucket in Bit pro Sekunde gemessen wird. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Volumen des Eimers, seine F√ºlle und seine Ausgangsgeschwindigkeit bestimmen die vom Former eingebrachte Verz√∂gerung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Einfachheit halber wird das Schaufelvolumen normalerweise in ms oder Œºs gemessen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Bezug auf die Implementierung ist Leaky Bucket ein regul√§rer Puffer, der auf SD-RAM basiert.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selbst wenn die Formgebung nicht explizit konfiguriert ist, werden Pakete bei Bursts, die nicht in die Schnittstelle gelangen, vor√ºbergehend gepuffert und √ºbertragen, wenn die Schnittstelle freigegeben wird. </font><font style="vertical-align: inherit;">Das pr√§gt auch. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaky Bucket wird nur zum Formen verwendet und ist nicht zum Polieren geeignet.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Token-Bucket-Algorithmus </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Viele Leute denken, dass Token Bucket und Leaking Bucket dasselbe sind. </font><font style="vertical-align: inherit;">Nur Einstein t√§uschte sich viel mehr und f√ºgte eine kosmologische Konstante hinzu. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schaltchips verstehen nicht wirklich, wie sp√§t es ist, sie werden noch schlimmer, wie viele Bits sie pro Zeiteinheit √ºbertragen haben. </font><font style="vertical-align: inherit;">Ihre Aufgabe ist es zu dreschen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√§hert sich dieses Bit weiteren 400.000.000 Bits pro Sekunde oder bereits 400.000 001? </font></font><br><br><img src="https://habrastorage.org/webt/kh/pu/i6/khpui6xw0sle9wconrc6ouoeedg.png" width="400"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASIC-Entwickler hatten eine nicht triviale technische Herausforderung. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es wurde in zwei Unteraufgaben unterteilt:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Begrenzung der Geschwindigkeit durch Verwerfen unn√∂tiger Pakete basierend auf einer sehr einfachen Bedingung. </font><font style="vertical-align: inherit;">Wird beim Schalten von Chips durchgef√ºhrt.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erstellen dieser einfachen Bedingung, die sich mit einem komplexeren (spezialisierteren) Chip befasst und die Zeit verfolgt. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Algorithmus, der das zweite Problem l√∂st, wird als Token Bucket bezeichnet. </font><font style="vertical-align: inherit;">Seine Idee ist elegant und einfach (nein). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Aufgabe von Token Bucket besteht darin, Verkehr weiterzuleiten, wenn er unter die Beschr√§nkung f√§llt, und wenn nicht, rot zu verwerfen / zu malen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist wichtig, Verkehrsst√∂√üe zuzulassen, da dies normal ist. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und wenn in Leaky Bucket Bursts gepuffert wurden, puffert der Token Bucket nichts.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Single Rate - Zweifarbige Markierung </font></font></h4><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Achten Sie vorerst </font><font style="vertical-align: inherit;">nicht auf den Namen =) </font><font style="vertical-align: inherit;">Wir haben einen Eimer, in den M√ºnzen mit konstanter Geschwindigkeit fallen - zum Beispiel 400 Megamonet pro Sekunde. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Volumen des Eimers betr√§gt 600 Millionen M√ºnzen. Das hei√üt, es ist in anderthalb Sekunden gef√ºllt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der N√§he befinden sich zwei F√∂rderb√§nder: eines liefert Pakete, das zweite nimmt weg. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um zum F√∂rderer zu gelangen, muss das Paket bezahlt werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daf√ºr nimmt er entsprechend seiner Gr√∂√üe M√ºnzen aus einem Eimer. Grob gesagt - wie viele Bits - so viele M√ºnzen. </font></font><br><br><img src="https://habrastorage.org/webt/2m/lh/kz/2mlhkzj9j1vezkils69vlszdgc0.png" width="800"><br><br><img src="https://habrastorage.org/webt/hj/o5/nn/hjo5nn2u7omtuighgtohqpx1y1k.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Eimer leer ist und sich nicht gen√ºgend M√ºnzen im Beutel befinden, wird er in einer roten Signalfarbe gestrichen und weggeworfen. Ach, Selyava. In diesem Fall werden keine M√ºnzen aus dem Eimer entfernt.</font></font><br><br><img src="https://habrastorage.org/webt/d-/bf/q9/d-bfq9l2tnj90-58kvi38zl3ufy.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das n√§chste M√ºnzpaket reicht m√∂glicherweise bereits aus - erstens ist das Paket m√∂glicherweise kleiner, und zweitens greift es in dieser Zeit mehr M√ºnzen an. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Eimer bereits voll ist, werden alle neuen M√ºnzen weggeworfen. </font></font><br><br><img src="https://habrastorage.org/webt/cs/yn/yq/csynyq7ig1pfozdswqkxt59dt2e.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es h√§ngt alles von der Paketankunftsrate und ihrer Gr√∂√üe ab. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn es stabil niedriger oder gleich 400 MB pro Sekunde ist, gibt es immer genug M√ºnzen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn h√∂her, gehen einige der Pakete verloren.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ein spezifischeres Beispiel mit Gifs, wie wir alle lieben. </font></font><br><br><img src="https://habrastorage.org/webt/o1/ds/ek/o1dsekpsi9nhg-plchkoivxrwm4.gif"><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt einen Bucket mit einer Kapazit√§t von 2500 Bytes. </font><font style="vertical-align: inherit;">Zum ersten Mal enth√§lt es 550 Token. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Pipeline enth√§lt drei Pakete mit 1000 Byte, die an die Schnittstelle gesendet werden sollen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zu jedem Zeitschlitz fallen 500 Bytes in den Bucket (500 * 8 = 4.000 Bit / Zeitschlitz - Polyser-Limit).</font></font></li><li>         500 .       .   1000 ,    1050  ‚Äî <b></b> .       . 1000    . <br>    50 . </li><li>          500  ‚Äî  550.     ‚Äî 1000 ‚Äî <b> </b> . <br>     ,   . </li><li>         500  ‚Äî  1050.    ‚Äî 1000 ‚Äî <b></b> . <br>      ,    . </li></ul><br>    2500   ,             2500  ‚Äî      .        MTU    ,      ,  ,  1,5-2 . <br><br>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> : <br><br> CBS = CIR (  )*1,5 ()/8 (  ) <br><br>       ,     (Bc),   ,     (1 875 000 )    .    (10 000 ),   ,     MTU,           . <br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum Eimervolumen? Der Bitstrom ist nicht immer gleichm√§√üig, dies ist offensichtlich. Ein Limit von 400 Mb / s ist keine Asymptote - der Verkehr kann es √ºberschreiten. Das Volumen der gespeicherten M√ºnzen erm√∂glicht das √úberfliegen kleiner Bursts, ohne dass sie weggeworfen werden. Die Durchschnittsgeschwindigkeit liegt jedoch bei 400 MBit / s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zum Beispiel kann der Eimer mit einem stabilen Strom von 399 Mbit / s in 600 Sekunden bis zum Rand gef√ºllt werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dar√ºber hinaus kann der Verkehr auf 1000 Mbit / s ansteigen und 1 Sekunde lang auf diesem Niveau bleiben - 600 Mm (Megamonet) Lagerbestand und 400 Mm / s garantiertes Band. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oder der Datenverkehr kann bis zu 410 Mbit / s betragen und 60 Sekunden lang so bleiben. </font></font><br><br><img src="https://habrastorage.org/webt/hq/yl/ib/hqylibyhmxkhepdt9mcf04m7rnk.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, der Vorrat an M√ºnzen erm√∂glicht es Ihnen, die Beschr√§nkung f√ºr eine lange Zeit leicht zu √ºberschreiten oder einen kurzen, aber hohen Anstieg zu verursachen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun zur Terminologie.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Empfangsrate der M√ºnzen im Eimer - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIR - Committed Information Rate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Garantierte Durchschnittsgeschwindigkeit). Gemessen in Bits pro Sekunde. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Anzahl der M√ºnzen, die im Eimer gespeichert werden k√∂nnen - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBS - Committed Burst Size</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Zul√§ssige maximale Burst-Gr√∂√üe. Gemessen in Bytes. Wie Sie vielleicht bemerkt haben, wird es manchmal </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bc genannt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Die Anzahl der M√ºnzen (Token) im </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eimer </font><font style="vertical-align: inherit;">(CBS) im Moment.</font></font><br><br><img src="https://habrastorage.org/webt/nm/rr/iv/nmrrivc2sdktqp4cfyhwfayjuze.png" width="600"><br><blockquote>      " <b>Tc</b> ",  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 2697</a> ( <i>A Single Rate Three Color Marker</i> ). <br>     Tc,    ,       . <br>    . <br>    ,    ,     Token Bucket,    <b>TDM</b> (Time-Division Multiplexing) ‚Äî         . <br>          ‚Äî  , , . <br>          CIR .    . <br>   ,    ‚Äî   ,  ‚Äî   ,  ‚Äî   . <br>         ,      . <br>      (    Cisco) <b>Tc</b> ,     ‚Äî <b>Bc</b> .   <b>Bc = CIR*Tc</b> . <br>       Tc    Bc . <br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist das einfachste Szenario. </font><font style="vertical-align: inherit;">Es hei√üt </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Single Rate - Two Color</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Single Rate</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bedeutet, dass es nur eine durchschnittliche zul√§ssige Geschwindigkeit gibt und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Two Color</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - dass Sie den Verkehr in einer von zwei Farben einf√§rben k√∂nnen: gr√ºn oder rot.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn die Anzahl der verf√ºgbaren M√ºnzen (Bits) in Eimer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gr√∂√üer ist als die Anzahl der Bits, die momentan √ºbersprungen werden m√ºssen, wird das Paket gr√ºn gef√§rbt - eine geringe Wahrscheinlichkeit, in Zukunft fallen zu lassen. </font><font style="vertical-align: inherit;">M√ºnzen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">werden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> aus dem Eimer entfernt.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andernfalls ist die Verpackung rot gestrichen - eine hohe Wahrscheinlichkeit eines Tropfens (oder h√§ufiger eines vor√ºbergehenden Tropfens). </font><font style="vertical-align: inherit;">M√ºnzen so Eimer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C zur√ºckgenommen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wird zum Polieren in PHB CS und EF verwendet, wo keine Beschleunigung erwartet wird. Wenn dies jedoch auftritt, ist es besser, es sofort zu verwerfen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weiter werden wir schwieriger betrachten: Single Rate - Three Color.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einzelpreis - Dreifarbige Markierung </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Nachteil des vorherigen Schemas besteht darin, dass es nur zwei Farben gibt. Was ist, wenn wir nicht alles √ºber die durchschnittlich zul√§ssige Geschwindigkeit senken wollen, sondern noch loyaler sein wollen? </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die TCM-sr</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einzel Rate - die drei die Farbe der Markierung</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) in den zweiten Eimer in - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Zu diesem Zeitpunkt werden die M√ºnzen nicht in einem Eimer gegeben , der </font><font style="vertical-align: inherit;">mit gef√ºllten </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , go√ü in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">EBS wird</font></b></font><br><br><img src="https://habrastorage.org/webt/xq/wq/fb/xqwqfblgko9sadvpv_zg2khhoma.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu CIR und CBS hinzugef√ºgt </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- √úberm√§√üige Burst-Gr√∂√üe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Zul√§ssige Burst-Gr√∂√üe w√§hrend Spitzenwerten. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Te</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - die Anzahl der M√ºnzen in einem Eimer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/un/tb/1v/untb1vhnskpben6jqecdqinvx4q.png" width="600"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nehmen wir an, ein Paket der Gr√∂√üe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kam entlang der Pipeline.</font></font> Dann <br><br><ol><li>     <b>C</b> ,      .   <b>C</b>  <b>B</b>  (: Tc ‚Äî B). </li><li>     <b>C</b>  ,   <b>E</b> .     ,     (  ),   <b>E</b>  <b>B</b> . <br><br><img src="https://habrastorage.org/webt/oi/my/if/oimyif_nplc0auqsknrlbtatqe0.png" width="800"><br></li><li>     <b>E</b>   ,     ,    . <br><br><img src="https://habrastorage.org/webt/tn/44/ct/tn44ctwmh8zxmekxrr9y6sv4avm.png" width="800"><br></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beachten Sie, dass Tc und Te f√ºr ein bestimmtes Paket </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht kumulativ sind</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, die Paketgr√∂√üe von 8000 Bytes wird nicht funktionieren, wenn auch in einem Eimer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.000 M√ºnzen sind, und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 7000. Die </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist nicht genug, in der </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist nicht genug - wir einen roten Stempel aufgedr√ºckt - shuruy hier. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist ein sehr elegantes Design. Der gesamte Datenverkehr, der unter die durchschnittliche CIR + CBS-Beschr√§nkung f√§llt (der Autor wei√ü, dass es unm√∂glich ist, Bits / s und Bytes so direkt hinzuzuf√ºgen), wird gr√ºn. In Spitzenzeiten, wenn dem Kunden die M√ºnzen in Eimer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ausgehen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , hat er w√§hrend der Ausfallzeit immer noch Te-Vorr√§te in Eimer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> angesammelt </font><font style="vertical-align: inherit;">.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, Sie k√∂nnen etwas mehr √ºberspringen, aber im Falle einer √úberlastung werden sie eher verworfen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sr-TCM ist in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 2697 beschrieben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wird zum Polieren in PHB AF verwendet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nun, das letzte System ist das flexibelste und daher komplexeste - Two Rate - Three Color.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zwei Rate - Dreifarbige Markierung </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tr-TCM-</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Modell </font><font style="vertical-align: inherit;">entstand aus der Idee heraus, dass es nicht zu Lasten anderer Benutzer und Verkehrstypen geht. Warum nicht dem Kunden ein wenig angenehmere M√∂glichkeiten bieten oder besser verkaufen? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sagen wir ihm, dass ihm 400 Mbit / s garantiert sind, und wenn es freie Ressourcen gibt, dann 500. Sind Sie bereit, 30 Rubel mehr zu zahlen? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein weiterer Eimer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P wird</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hinzugef√ºgt </font><font style="vertical-align: inherit;">.</font></font><br><br>  Auf diese Weise: <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CIR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - garantierte Durchschnittsgeschwindigkeit. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CBS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hat die gleiche zul√§ssige Spritzgr√∂√üe (Bucket-Volumen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PIR</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Peak Information Rate - maximale Durchschnittsgeschwindigkeit. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EBS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - erlaubte Burst-Gr√∂√üe w√§hrend Peaks (Bucket Volume </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Gegensatz zu sr-TCM werden M√ºnzen in tr-TCM jetzt unabh√§ngig voneinander an beide Eimer geliefert. </font><font style="vertical-align: inherit;">In </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - mit der Geschwindigkeit von CIR, in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - PIR. </font></font><br><br><img src="https://habrastorage.org/webt/xd/gk/_d/xdgk_dfz6sd-mw6lsw_adkipcve.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was sind die Regeln? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein Paket mit </font><font style="vertical-align: inherit;">Bytes </font><font style="vertical-align: inherit;">der Gr√∂√üe </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kommt an </font><font style="vertical-align: inherit;">.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befinden sich </font><font style="vertical-align: inherit;">nicht gen√ºgend </font><font style="vertical-align: inherit;">M√ºnzen im Eimer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , wird das Paket rot markiert. </font><font style="vertical-align: inherit;">M√ºnzen werden </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nicht herausgezogen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font> Ansonsten: </li><li>     <b>C</b>   ‚Äî   ,    <b>P  B</b> .  Ansonsten: </li><li>      <b>   B</b> . </li></ol><br><img src="https://habrastorage.org/webt/xz/ac/xl/xzacxlryw2kkvf1ms-nkgufteba.png" width="800"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das hei√üt, die Regeln in tr-TCM sind unterschiedlich. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solange der Verkehr innerhalb der garantierten Geschwindigkeit liegt, werden M√ºnzen aus beiden Eimern entfernt. </font><font style="vertical-align: inherit;">Aus diesem Grunde, wenn die Eimer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M√ºnzen ausgehen, in dem bleiben </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aber gerade genug , </font><font style="vertical-align: inherit;">um nicht den PIR zu √ºberschreiten (wenn auch </font><font style="vertical-align: inherit;">nur aus herausgenommen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dann </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gef√ºllt , </font><font style="vertical-align: inherit;">um mehr und gab eine viel h√∂here Geschwindigkeit). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dementsprechend werden die M√ºnzen nur aus </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> entfernt, wenn sie √ºber dem garantierten, aber unter dem Peak liegen </font><font style="vertical-align: inherit;">, da in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bereits nichts vorhanden ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tr-TCM √ºberwacht nicht nur Bursts, sondern auch eine konstante Spitzengeschwindigkeit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tr-TCM ist in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 2698 beschrieben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wird auch zum Polieren in PHB AF verwendet. </font></font><br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zusammenfassung der Geschwindigkeitsbegrenzung </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√§hrend das Formen den Verkehr verz√∂gert, wenn er √ºberschritten wird, wird er durch Polieren verworfen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Formgebung ist nicht f√ºr latenz- und jitterempfindliche Anwendungen geeignet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um das Polieren in Hardware zu implementieren, wird der Token Bucket-Algorithmus zum Formen von Leaky Bucket verwendet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Token Bucket kann sein:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit einem Eimer - Single Rate - Zweifarbige Markierung. </font><font style="vertical-align: inherit;">Erm√∂glicht g√ºltige Bursts.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit zwei Eimern - Single Rate - Dreifarbige Markierung (sr-TCM). </font><font style="vertical-align: inherit;">√úbersch√ºsse aus Eimer C (CBS) werden in Eimer E gegossen. Erm√∂glicht zul√§ssige und redundante √úberspannungen.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit zwei Eimern - Two Rate - Three Color Marking (tr-TCM). </font><font style="vertical-align: inherit;">Die Eimer C und P (PBS) f√ºllen sich unabh√§ngig voneinander mit unterschiedlichen Geschwindigkeiten auf. </font><font style="vertical-align: inherit;">Erm√∂glicht Spitzengeschwindigkeit und zul√§ssige und √ºberm√§√üige Bursts.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sr-TCM konzentriert sich auf das Verkehrsaufkommen √ºber dem Limit. tr-TCM - mit der Geschwindigkeit, mit der es ankommt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Polieren kann am Ein- und Ausgang des Ger√§ts verwendet werden. Die Formgebung erfolgt √ºberwiegend am Ausgang. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr PHB CS und EF wird Single Rate Two Color Marking verwendet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr AF, sr-TCM oder tr-TCM. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zum besseren Verst√§ndnis empfehle ich, auf den Original-RFC zu verweisen oder </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier zu</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lesen </font><font style="vertical-align: inherit;">.</font></font><br><blockquote>  Token Bucket     . ,       ,   ,       ,       . <br>     ,         ‚Äî ,  .   ,    ,       ,    ‚Äî  . <br>      ,     .          ‚Äî   .         . <br></blockquote><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oben habe ich alle grundlegenden Mechanismen der QoS beschrieben, wenn nicht sogar die hierarchische QoS. </font><font style="vertical-align: inherit;">Ein ausgekl√ºgeltes System mit vielen beweglichen Teilen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alles war in Ordnung (richtig?) Hat bisher geklungen, aber was passiert unter der Vanille-Au√üenverkleidung des Routers? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Laufe der Jahre haben Anbieter immer mehr Konturen hinzugef√ºgt, ausgefeilte Chips entwickelt und Puffer erweitert, um einerseits mit dem wachsenden Verkehrsaufkommen und seinen neuen Kategorien Schritt zu halten und andererseits die durch den ersten Absatz verursachten wachsenden Probleme zu l√∂sen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das laufende Rennen. </font><font style="vertical-align: inherit;">Pakete d√ºrfen nicht verloren gehen, wenn der Wettbewerber sie nicht verliert. </font><font style="vertical-align: inherit;">Sie k√∂nnen die Funktionalit√§t nicht ablehnen, wenn ein Gegner mit ihm unter den T√ºren des Kunden steht. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ida in die H√∂hle des Eigentums!</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. Hardware-Implementierung von QoS </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Kapitel √ºbernehme ich die undankbare Aufgabe. Wenn Sie es so einfach wie m√∂glich beschreiben, wird es immer diejenigen geben, die sagen, dass in der Realit√§t nicht alles so ist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Sie es so beschreiben, wie es ist, l√§sst der Leser den Artikel fallen, da er sich in eine U-Boot-Zeichnung verwandelt, genauer gesagt in Zeichnungen von drei Booten mit Bleistiften unterschiedlicher Farbe auf einem Blatt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Allgemeinen werde ich einen Haftungsausschluss machen, dass in Wirklichkeit nicht alles das gleiche ist wie in der Realit√§t, und ich werde nach der Version einer einfachen Pr√§sentation vorgehen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vergib mir, mein Perfektionist. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was steuert das Verhalten des Knotens und l√∂st die entsprechenden Mechanismen in Bezug auf das Paket aus? Welche Priorit√§t hat es in einer der √úberschriften?</font></font> Ja und nein. <br><br><img src="https://habrastorage.org/webt/th/ie/l1/thiel1p000d6rgwchs-xo1hl4ys.png" width="250"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wie oben erw√§hnt, existiert in einem Netzwerkger√§t der Standard-Switching-Header normalerweise nicht mehr. </font></font><br><br><img src="https://habrastorage.org/webt/nj/h5/aq/njh5aquhoyypydjzrdttbespgr4.png" width="1000"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobald ein Paket am Vermittlungs-Chip ankommt, werden Header von diesem entfernt und zur Analyse gesendet, und die Nutzlast schwindet in einer Art tempor√§rem Puffer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Basierend auf den Headern findet eine Klassifizierung (BA oder MF) statt und eine Entscheidung √ºber die Weiterleitung wird getroffen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach einem Moment wird ein interner Header mit Metadaten zum Paket an das Paket geh√§ngt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Metadaten enthalten viele wichtige Informationen - die Adresse des Absenders und Empf√§ngers, der Ausgangschip, die Seriennummer der Zelle, wenn eine Paketfragmentierung aufgetreten ist, sowie die Klassenmarkierung (CoS) und die Drop-Priorit√§t sind obligatorisch. Nur Markierung im internen Format - es kann mit dem DSCP √ºbereinstimmen oder nicht.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Prinzip k√∂nnen Sie innerhalb der Box eine beliebige Markierungsl√§nge festlegen, ohne an Standards gebunden zu sein, und mit dem Paket sehr flexible Aktionen definieren. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei Cisco hei√üt die interne Kennzeichnung QoS Group, bei Juniper - Forwarding Class hat Huawei nicht entschieden: irgendwo werden interne Priorit√§ten genannt, irgendwo lokale Priorit√§ten, irgendwo Service-Class und irgendwo nur CoS. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie Namen f√ºr andere Anbieter in den Kommentaren hinzu - ich werde hinzuf√ºgen.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Diese interne Markierung wird basierend auf der vom Knoten durchgef√ºhrten Klassifizierung zugewiesen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist wichtig, dass die interne Kennzeichnung, sofern nicht anders angegeben, nur innerhalb des Knotens funktioniert, dann aber nicht auf dem Etikett in den Headern des Pakets erscheint, das vom Knoten gesendet wird - sie bleibt gleich.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am Eingang zur DS-Dom√§ne nach der Klassifizierung erfolgt jedoch normalerweise eine Neukennzeichnung in einer bestimmten in diesem Netzwerk akzeptierten Dienstklasse. Anschlie√üend wird die interne Kennzeichnung in den f√ºr diese Klasse im Netzwerk akzeptierten Wert konvertiert und im Header des gesendeten Pakets aufgezeichnet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die interne Kennzeichnung von CoS und Drop Precedence definiert das Verhalten nur innerhalb eines bestimmten Knotens und wird nicht explizit an die Nachbarn weitergegeben, au√üer f√ºr die erneute Kennzeichnung von Headern. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CoS und Drop Precedence definieren den PHB, seine Mechanismen und Parameter: Stauverh√ºtung, √úberlastungsmanagement, Planung und Neukennzeichnung.</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Welche Kreise passieren Pakete zwischen den Eingabe- und Ausgabeschnittstellen? Ich habe dies in einem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vorherigen Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ºberpr√ºft </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tats√§chlich stellte sich heraus, dass dies nicht geplant war, da sich irgendwann herausstellte, dass es verfr√ºht war, √ºber QoS zu sprechen, ohne die Architektur zu verstehen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie uns jedoch wiederholen.</font></font><br><br><img src="https://habrastorage.org/webt/3k/s1/3e/3ks13e4uzagzrbopm5juuyun4j8.png" width="1000"><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Signal trifft auf die physikalische Eingangsschnittstelle und ihren Chip (PIC). </font><font style="vertical-align: inherit;">Daraus flie√üt ein Bitstrom und dann ein Paket mit allen Headern.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neben dem Eingangsvermittlungschip (FE), wo die Header vom Paketk√∂rper getrennt sind. </font><font style="vertical-align: inherit;">Die Klassifizierung erfolgt und es wird bestimmt, wohin das Paket weiter gesendet werden muss.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neben der Eingabewarteschlange (TM / VOQ). </font><font style="vertical-align: inherit;">Bereits hier sind die Pakete je nach Klasse in verschiedenen Warteschlangen angeordnet.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Weiter zur Schaltfabrik (falls vorhanden). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Neben der Ausgabewarteschlange (TM). </font></font></li><li>      (FE),    . </li><li>     (,    ) (PIC). </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In diesem Fall muss der Router eine komplexe Gleichung l√∂sen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erweitern Sie alles in Klassen, stellen Sie jemandem ein breites Band zur Verf√ºgung, jemandem mit geringer Latenz, jemandem, der keine Verluste sicherstellt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und gleichzeitig Zeit haben, wenn m√∂glich den gesamten Verkehr zu √ºberspringen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dar√ºber hinaus m√ºssen Sie formen, m√∂glicherweise polieren. </font><font style="vertical-align: inherit;">Wenn pl√∂tzlich eine √úberlastung auftritt, gehen Sie damit um. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dabei werden die Suchvorg√§nge, die ACL-Verarbeitung und die Statistik nicht ber√ºcksichtigt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nicht beneidenswerter Anteil. </font><font style="vertical-align: inherit;">Aber Roboter spritzen, kein Mann. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tats√§chlich gibt es nur zwei Stellen, an denen QoS-Mechanismen funktionieren - einen Switching-Chip und einen Traffic Management-Chip / eine Warteschlange. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gleichzeitig treten auf dem Vermittlungs-Chip Operationen auf, die eine Analyse oder Aktionen mit Headern erfordern.</font></font><br><br><ul><li>  Klassifizierung </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Polieren </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Umbenennen </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TM k√ºmmert sich um den Rest. </font><font style="vertical-align: inherit;">Grunds√§tzlich handelt es sich hierbei um Routineoperationen mit einem vordefinierten Algorithmus und benutzerdefinierten Parametern:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Staupr√§vention </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √úberlastungsmanagement </font></font></li><li>  Formen </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TM ist ein intelligenter Puffer, der normalerweise auf SD-RAM basiert. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Er ist schlau, weil er a) programmierbar ist, b) mit Warteschlangen alle m√∂glichen kniffligen Dinge tun kann. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es wird h√§ufig verteilt - SD-RAM-Chips befinden sich auf jeder Schnittstellenkarte und werden zusammen zu VOQ (Virtual Output Queue) kombiniert, wodurch das Problem des Head of Line Blocking gel√∂st wird. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tatsache ist, dass wenn der Schaltchip oder die Ausgangsschnittstelle verstopft sind, sie den Eingangschip auffordern, langsamer zu werden und f√ºr einige Zeit keinen Verkehr zu senden. Wenn es nur eine Warteschlange in alle Richtungen gibt, ist es sehr entt√§uschend, dass alle anderen unter einer Ausgabeschnittstelle leiden. Dies ist der Head of Line Blocking. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VOQ erstellt auf der Eingabeschnittstellenkarte mehrere virtuelle Ausgabewarteschlangen f√ºr jede vorhandene Ausgabeschnittstelle.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dar√ºber hinaus ber√ºcksichtigen diese Linien in modernen Ger√§ten die Kennzeichnung der Verpackung. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úber VOQ ausreichend in einer Reihe von Notizen detailliert </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úbrigens werden sie wirklich in die Warteschlange gestellt, sie werden bef√∂rdert, es sind nicht die Pakete selbst, die von ihnen beschlagnahmt werden usw., sondern nur die Aufzeichnungen √ºber sie. Es macht keinen Sinn, so viele Gesten mit gro√üen Bit-Arrays auszuf√ºhren. W√§hrend QoS √ºber die Datens√§tze verspottet wird, befinden sich die Pakete perfekt in ihrem Speicher und werden von dort unter der Adresse abgerufen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VOQ ist eine Software-Warteschlange (der englische Begriff Software-Warteschlange ist genauer). Unmittelbar vor der Schnittstelle befindet sich eine Hardware-Warteschlange, die immer streng nach FIFO arbeitet. Es ist fast unm√∂glich, einen seiner Parameter zu steuern (mit Cisco k√∂nnen Sie beispielsweise nur die Tiefe mit dem Befehl tx-ring-limit konfigurieren).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nur zwischen den Software- und Hardware-Warteschlangen k√∂nnen Sie beliebige Dispatcher ausf√ºhren. In der Programmwarteschlange arbeiten Head / Tail-Drop und AQM, Polieren und Formen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Gr√∂√üe der Hardware-Warteschlange ist sehr klein (Einheiten von Paketen), da der Dispatcher die gesamte Arbeit zum Stapeln der Leitungsrate erledigt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leider k√∂nnen Sie hier viele Reservierungen vornehmen und in der Tat alles mit einem roten Stift streichen und sagen "Anbieter X ist nicht so".</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich m√∂chte noch eine Bemerkung zu Servicepaketen machen. Sie werden anders behandelt als Transitbenutzerpakete. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie werden lokal generiert und nicht auf Einhaltung der ACL-Regeln und Geschwindigkeitsbegrenzungen √ºberpr√ºft. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pakete von au√üen, die f√ºr die CPU vom Ausgangsvermittlungschip bestimmt sind, fallen je nach Protokolltyp in andere Warteschlangen - an die CPU. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zum Beispiel hat BFD die h√∂chste Priorit√§t, OSPF kann l√§nger warten und ICMP ist im Allgemeinen nicht unheimlich zu fallen. Das hei√üt, je wichtiger das Paket f√ºr das Netzwerk ist, desto h√∂her ist seine Serviceklasse beim Senden an die CPU. Aus diesem Grund ist es normal, dass beim Ping oder Tracing unterschiedliche Verz√∂gerungen beim Transit-Hop auftreten. ICMP ist kein vorrangiger Datenverkehr f√ºr die CPU. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zus√§tzlich werden Protokollpakete angewendet</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CoPP - Control Plane Protection</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (oder Policing) - Geschwindigkeitsbegrenzung zur Vermeidung einer hohen CPU-Auslastung - wieder besser vorhersehbare Einbr√ºche in Warteschlangen mit niedriger Priorit√§t, bevor Probleme auftreten. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CoPP hilft sowohl bei gezielten DoS als auch bei abnormalem Netzwerkverhalten (z. B. Schleifen), wenn viel Broadcast-Verkehr auf das Ger√§t gelangt.</font></font><br><br><hr><br><h1>  N√ºtzliche Links </h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das beste Buch √ºber Theorie und Philosophie von QoS: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">QOS-f√§hige Netzwerke: Tools und Grundlagen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einige Ausz√ºge davon k√∂nnen hier gelesen </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">werden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , aber ich w√ºrde empfehlen, es von und nach </font><font style="vertical-align: inherit;">zu lesen </font><font style="vertical-align: inherit;">und nicht auszutauschen.</font></font></li><li>         QoS  Huawei: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Special Edition QoS(v6.0)</a> .        PHB   . </li><li>    sr-TCM  tr-TCM  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Understanding Single-Rate and Dual-Rate Traffic Policing</a> . </li><li>  VOQ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">What is VOQ and why you should care?</a> </li><li>  QoS  MPLS: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MPLS and Quality of Service</a> . </li><li>     QoS   Juniper: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Juniper CoS notes</a> . </li><li>   QoS       TCP  UDP.       : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">The TCP/IP Guide</a> </li><li>    ,          ,       : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">         TCP</a> . </li><li>    ,        FQ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Queuing and Scheduling</a> . <br>      ,     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">An Introduction to Computer Networks</a> ,  ,     Introduction,      .    . <br></li><li>  WFQ  ,    , , ,   ,    : Weighted Fair Queueing: a packetized approximation for FFS/GP. <br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt auch den LFI-Mechanismus, auf den ich nicht eingegangen bin, da er in unserer Realit√§t auch mit 100-Gigabyte-Schnittstellen schwierig ist, aber es k√∂nnte interessant sein, sich mit folgenden </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Themen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vertraut zu machen: </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Link Fragmentation and Interleaving</font></a><font style="vertical-align: inherit;"> .</font></font></li></ul><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und nat√ºrlich die RFC-Suite ...</font></font></b> <div class="spoiler_text"><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc791</a> ( <i>INTERNET PROTOCOL</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc1349</a> ( <i>Type of Service in the Internet Protocol Suite</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc1633</a> ( <i>Integrated Services in the Internet Architecture: an Overview</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc2474</a> ( <i>Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc2475</a> ( <i>An Architecture for Differentiated Services</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc2597</a> ( <i>Assured Forwarding PHB Group</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc2697</a> ( <i>A Single Rate Three Color Marker</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc2698</a> ( <i>A Two Rate Three Color Marker</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc3031</a> ( <i>Multiprotocol Label Switching Architecture</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc3168</a> ( <i>The Addition of Explicit Congestion Notification (ECN) to IP</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc3246</a> ( <i>An Expedited Forwarding PHB (Per-Hop Behavior)</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc3260</a> ( <i>New Terminology and Clarifications for Diffserv</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc3662</a> ( <i>A Lower Effort Per-Domain Behavior (PDB) for Differentiated Services</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc4594</a> ( <i>Configuration Guidelines for DiffServ Service Classes</i> ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tools.ietf.org/html/rfc5462</a> ( <i>Multiprotocol Label Switching (MPLS) Label Stack Entry: ¬´EXP¬ª Field Renamed to ¬´Traffic Class¬ª Field</i> ) </li></ul><br></div></div><br><h1>  Fazit </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Diese Version hatte viele Rezensenten. </font></font><br>  Vielen Dank. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fatin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;">LoxmatiyMamont</font></a><font style="vertical-align: inherit;"> ) f√ºr ein einleitendes Wort und wertvolle Ratschl√§ge zur Ausdruckskraft und Klarheit des Textes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander Clipper (@ metallicat20) f√ºr sein Peer Review. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alexander Klimenko (@ v00lk) f√ºr scharfe Kritik und die massivsten Ver√§nderungen der letzten Tage. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Andrey Glazkov (@glazgoo) f√ºr Kommentare zu Struktur, Terminologie und Kommas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artyom Chernobay f√ºr KDPV. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anton Klochkov (@NAT_GTX) f√ºr Kontakte mit Miran. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Miran (miran.ru) f√ºr die Organisation eines Servers mit Eva und Broadcast. </font><font style="vertical-align: inherit;">Traditionell meine Familie, die diesmal jedoch am wenigsten unter ihrer Abwesenheit in den schwierigsten Momenten litt.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de420525/">https://habr.com/ru/post/de420525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de420515/index.html">Diarisierung basierend auf dem GMM-UBM-Modell und dem MAP-Anpassungsalgorithmus</a></li>
<li><a href="../de420517/index.html">FPGA Integer FFT-Implementierung</a></li>
<li><a href="../de420519/index.html">Popularisierung der Wissenschaft</a></li>
<li><a href="../de420521/index.html">Jetzt offiziell: TLS 1.3 als Standard anerkannt</a></li>
<li><a href="../de420523/index.html">Analyse von bin√§ren Optionsdiagrammen oder wie ich mir erneut bewiesen habe, dass es keine Werbegeschenke gibt</a></li>
<li><a href="../de420527/index.html">Ein L√§cheln kann klingen und es ist ansteckend</a></li>
<li><a href="../de420529/index.html">Fortgeschrittene Nutzung von Geeta oder wie man sechs Monate fr√ºher in den Ruhestand geht?</a></li>
<li><a href="../de420533/index.html">Emulieren von Eigenschaftsliteralen mit der Java 8-Methodenreferenz</a></li>
<li><a href="../de420537/index.html">Eine andere Geschichte dar√ºber, wie Geld relativ ehrlich mit einem Megaphon aufgenommen wird</a></li>
<li><a href="../de420539/index.html">Benutzerdefinierter Ansatz zum Normalisieren und Zur√ºcksetzen von Stilen (custom-reset.css)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>