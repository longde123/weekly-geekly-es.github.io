<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👟 👩🏾‍🎨 👨🏿‍🍳 Spectrum-48 contre un paquet de cigarettes, du porridge d'une hache ou ce que la vidéo STM32F103C8T6 + peut faire (mise à jour) 🤰🏼 ♦️ 🏂🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tout a commencé par une nouvelle tentative d'arrêter de fumer. Ayant réveillé mon «crapaud» interne à la recherche de soutien, je lui dis: «Écoutez, u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spectrum-48 contre un paquet de cigarettes, du porridge d'une hache ou ce que la vidéo STM32F103C8T6 + peut faire (mise à jour)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412325/">  Tout a commencé par une nouvelle tentative d'arrêter de fumer.  Ayant réveillé mon «crapaud» interne à la recherche de soutien, je lui dis: «Écoutez, un paquet de <s>mes</s> cigarettes coûte aujourd'hui comme un ordinateur de poche rétro avec un écran, soit environ 10 $, et il était une fois, pour le clone Sinclair-48K, nous avons dépensé la totalité du salaire mensuel et a passé plus d'un mois sur l'assemblage et le débogage. "  Elle: "Vous êtes des boucs et des menteurs, prouvez-le!"  Je devais travailler. <br><br>  Ainsi, les matériaux sources: <br><br><ol><li>  Pilule bleue: STM32F103C8T6 - Flash 20K ram 64K $ 2.06 </li><li>  Affichage Arduino: ILI9341 2,8 "320x240 avec écran tactile et fente pour carte de 7,72 $ </li><li>  Tweeter 0,18 $ </li><li>  Quelques boutons (7 pièces) 0,2 $ </li><li>  Certains fils 0,1 $ </li><li>  Carte flash pour 64 méga (d'un ancien appareil photo), non incluse dans le calcul </li><li>  Le programmateur ST-LINK n'est pas consommé et n'est pas inclus dans le calcul, cependant, il coûte également quelques dollars </li><li>  Un paquet de cigarettes - consommé trop rapidement et tous les jours - 8,37 $ </li></ol><br><img src="https://habrastorage.org/webt/ik/ll/r9/ikllr9oryxwdk8v04ktordurogk.jpeg"><br><a name="habracut"></a><br>  La merveilleuse «pilule bleue» fabriquée en Chine est bonne pour tout le monde, à l'exception de la quantité de RAM, seulement 20K (bien qu'il y ait aussi peu de constante, seulement 64K).  Spectrum-48K a besoin de 48K (coïncidence? Je ne pense pas) de RAM et 16K de constante.  Nous prendrons la RAM de l'écran, car la résolution du spessi est de 256x192 + bordure, tandis que ILI9341 a 320x240 avec 18 bits par point.  Autrement dit, vous pouvez utiliser le milieu de l'écran pour le rendu et tout le reste pour la «zone d'échange» réelle (zone d'échange?).  De plus, le plus souvent (algorithme LRU) utilisé par l'émulateur de processeur, la mémoire Z80 est mise en cache dans la RAM STM32, le reste est stocké dans la mémoire d'écran ILI9341, avec un accès lent (SPI). <br><br>  Il y a environ 25 ans, j'ai écrit l'émulateur Z80 sur la plate-forme 80286, ce ne sont pas des parents très éloignés du Z80, tous deux issus de 8080, ce qui m'a permis d'obtenir un code très rapide en utilisant les merveilleux Borland TACM et C ++, mais il n'y avait alors pas besoin d'une émulation aussi détaillée ( le code a été écrit pour les deux côtés: un cahier avec un dictionnaire et son émulateur sous windows 3.1 pour le débogage). <br><cut></cut><br>  C'était trop paresseux pour écrire à partir de zéro pour le bras, alors j'ai demandé à Google: "Dis-moi Google, comment ça se passe avec une émulation Z80 soignée aujourd'hui?"  Google m'a donné <s>quelques</s> deux <s>mille</s> deux projets appropriés: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Basé sur STM32F4, auteur de Gorien</a> et l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">émulateur Fuse</a> le plus avancé et débogué.  Lors du premier montage du code de Gorien, il s'est avéré environ 100K de code exécutable, ce qui est clairement plus disponible sur le sujet.  J'ai dû bricoler un peu <s>en poussant un éléphant dans le réfrigérateur</s> .  Par exemple, les appels aux variables locales sont compilés dans un code plus compact que les appels globaux, toutes les commandes étendues des registres IX et IY sont les mêmes, précises pour remplacer les variables, la table du générateur de caractères peut être remplacée par un lien vers le générateur de caractères Spectrum, etc.  Il a également fallu overclocker le processeur à 112 MHz ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">merci à xedas pour l'idée</a> ). <br><br>  Résultat: un émulateur ZX Spectrum-48 fonctionnant (j'ai essayé une douzaine de jeux pendant que tout le monde travaille) avec un écran de la taille d'un paquet de cigarettes (il entre déjà dans votre poche, mais les fils sortent), la lecture de vidages (icône + image mémoire + registres ~ 50K) de jeux avec format de carte flash FAT32 (quelques kilo-octets de code en plus) et avec une consommation totale de ~ 50mA (soit environ 50 heures à partir d'une batterie 18650 typique pour 2500mAh!), le temps de mise sous tension est inférieur à une seconde et le coût total d'environ moins de 10 $. <br><br>  Inconvénients: <br><br><ol><li>  Encore un peu plus lent que l'original. </li><li>  L'écran affiche le code du programme téléchargé, en couleur. </li><li>  Vous avez besoin d'un joystick ou de boutons plus doux.  Et les frais.  Et une boîte.  Et les bras droits.  Et ... </li></ol><br><cut></cut><br>  Dans les plans approximatifs: réduire la consommation (arracher les LED de la carte), ajouter une modulation de la luminosité de l'écran, le mode horloge avec l'écran éteint, souder un clavier normal avec un joystick, régler le retard pour un son correct et la lecture à partir d'un magnétophone (et quoi?), Convertisseur de format de fichier PC dumps, pressez un peu plus de code pour héberger l'interface utilisateur.  Essayez de réduire le coût de la plateforme en utilisant un écran de 2,4 pouces.  C'est vrai, enfin, très petit, mais pour 5 ... Il est clair qu'ici, l'intérêt est purement sportif, bien que si vous prenez en compte la vitesse de démontage de toute l'électronique en pièces inutilisables par les petits-enfants, le prix compte toujours. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Code de travail actuel sur Github</a> <br><br>  Et plus de photos pour les fans, le jeu de type R, la zone d'échange autour des bords de l'écran principal: <br><br><img src="https://habrastorage.org/webt/ee/_i/wt/ee_iwtuc-shar4iwezqs32vssz0.jpeg"><br><br>  L'autre côté: <br><br><img src="https://habrastorage.org/webt/s4/bd/7_/s4bd7_7gn3xaunstac6hbje2b6s.jpeg"><br><br>  Jeu Atic-Atac: <br><br><img src="https://habrastorage.org/webt/lm/gs/x3/lmgsx3jmparexgfw7kkom3jypco.jpeg"><br><br>  PS: Je n’ai pas payé le prix d’un paquet de cigarettes, donc mon "crapaud" devra endurer mes mauvaises habitudes, mais j’ai déjà 55 ans, donc j’en ai déjà dépensé la majeure partie ... Pour continuer. <br>  Vidéo, pas de son, désolé: <br><iframe width="560" height="315" src="https://www.youtube.com/embed/n4u6VNxCTdA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr412325/">https://habr.com/ru/post/fr412325/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr412311/index.html">Une IA formée à la navigation a développé un système similaire à une «boussole» d'un cerveau de mammifère</a></li>
<li><a href="../fr412313/index.html">TooWheels - fauteuil roulant avec documentation ouverte</a></li>
<li><a href="../fr412315/index.html">Le service Google Duplex fait peur avec son discours beau et correct, il n'y a pas de satisfaction</a></li>
<li><a href="../fr412319/index.html">Sévère fait à la main par un ingénieur en électronique: démontez le PocketBook 631 Plus et équipez-le d'une batterie solaire</a></li>
<li><a href="../fr412323/index.html">Mon algorithme a-t-il des problèmes mentaux?</a></li>
<li><a href="../fr412327/index.html">Le point de vue du piéton-mathématicien: pourquoi nos routes sont guano</a></li>
<li><a href="../fr412329/index.html">Imprimante 3D Anet A8 avec cadre en acier</a></li>
<li><a href="../fr412331/index.html">Les assistants numériques obéissent à des commandes inaudibles pour l'homme</a></li>
<li><a href="../fr412335/index.html">Comment Computex Taipei a survécu au manque d'espace au sol et à la crise du marché des PC</a></li>
<li><a href="../fr412337/index.html">Le rostourisme «résoudra» l'interdiction de Booking.com en Russie dans le cadre des contre-sanctions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>