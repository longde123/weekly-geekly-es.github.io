<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏈 🖕🏻 🙇🏽 Pengembangan untuk Docker. Lingkungan lokal. Bagian 2 - Nginx + PHP + MySql + phpMyAdmin 💥 🐠 🏏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk pemahaman yang lebih baik tentang materi berikut, Anda disarankan untuk terlebih dahulu membaca Posting Sebelumnya 

 Pertimbangkan contoh penge...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengembangan untuk Docker. Lingkungan lokal. Bagian 2 - Nginx + PHP + MySql + phpMyAdmin</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460173/"> Untuk pemahaman yang lebih baik tentang materi berikut, Anda disarankan untuk terlebih dahulu membaca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Posting Sebelumnya</a> <br><br>  Pertimbangkan contoh pengembangan lingkungan lokal yang terdiri dari sekelompok Nginx + PHP + MySql + phpMyAdmin.  Bundel ini sangat populer dan dapat memenuhi sejumlah kebutuhan standar pengembang biasa. <br><br>  Seperti pada posting sebelumnya, penekanan akan dialihkan ke utilitas docker-compose daripada buruh pelabuhan dalam bentuk yang paling murni. <br><br>  Jadi ayo pergi! <br><a name="habracut"></a><br>  Mari kita mulai dengan docker-compose.yml, yang ada di folder proxy terpisah: <br><br><div class="spoiler">  <b class="spoiler_title">docker-compose.yml untuk nginx-proxy</b> <div class="spoiler_text"><pre><code class="plaintext hljs">version: '3.0' services: proxy: image: jwilder/nginx-proxy ports: - 80:80 volumes: - /var/run/docker.sock:/tmp/docker.sock:ro networks: - proxy networks: proxy: driver: bridge</code> </pre> <br></div></div><br>  File yang disajikan menjelaskan konfigurasi untuk membuat satu wadah dengan nama <b>proxy</b> berdasarkan <b>gambar: jwilder / nginx-proxy image</b> dan membuat jaringan dengan nama yang sama.  Arahan <b>jaringan</b> menunjukkan ke jaringan mana kontainer terhubung, dalam contoh ini, ini adalah jaringan proxy kami. <br><br>  Saat membuat jaringan, arahan driver: bridge dapat dihilangkan.  Driver jembatan adalah driver default.  Wadah ini akan berkomunikasi melalui jaringan dengan wadah lain. <br><br>  Gambar jwilder / nginx-proxy adalah dasar dan diambil, dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Docker Hub</a> juga menyediakan deskripsi penggunaannya yang cukup luas dan terperinci.  Prinsip operasi nginx-proxy cukup sederhana: ia mengakses informasi tentang menjalankan kontainer melalui soket buruh pelabuhan yang diteruskan, menganalisis keberadaan variabel lingkungan dengan nama VIRTUAL_HOST dan mengalihkan permintaan dari host yang ditentukan ke wadah yang ditetapkan untuk variabel lingkungan yang ditetapkan. <br><br>  Kami memulai proxy dengan perintah docker-compose up -d yang sudah dikenal, kami amati output berikut: <br><br><pre> <code class="plaintext hljs">Creating network "proxy_proxy" with driver "bridge" Creating proxy_proxy_1 ... done</code> </pre><br>  Kesimpulan ini memberi tahu kami bahwa pada awalnya jaringan proxy_proxy dibuat, dan kemudian wadah proxy_proxy_1 dibuat.  Nama jaringan diperoleh dari nama folder tempat file docker-compose.yml berada, saya memiliki proxy dan nama jaringan dengan nama yang sama. <br><br>  Jika Anda memasukkan <b>perintah ls jaringan docker</b> , kita akan melihat daftar jaringan buruh pelabuhan di sistem kami dan salah satunya adalah proxy_proxy. <br><br>  Nama kontainer dibuat dengan prinsip yang sama dengan nama folder plus nama layanan dan nomor, yang memungkinkan kontainer dengan nama yang mirip tidak dapat diduplikasi.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menggunakan</a> direktif <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">container_name</a> , Anda dapat menentukan nama wadah secara eksplisit, tetapi saya menemukan ini fungsi yang agak tidak berguna.  Ini akan dibahas lebih rinci dalam posting berikut. <br><br>  Buat docker-compose.yml kedua dengan konten berikut: <br><br><div class="spoiler">  <b class="spoiler_title">docker-compose.yml untuk layanan lain</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">version: '3.0' services: nginx: image: nginx environment: - VIRTUAL_HOST=site.local depends_on: - php volumes: - ./docker/nginx/conf.d/default.nginx:/etc/nginx/conf.d/default.conf - ./html/:/var/www/html/ networks: - frontend - backend php: build: context: ./docker/php volumes: - ./docker/php/php.ini:/usr/local/etc/php/php.ini - ./html/:/var/www/html/ networks: - backend mysql: image: mysql:5.7 volumes: - ./docker/mysql/data:/var/lib/mysql environment: MYSQL_ROOT_PASSWORD: root networks: - backend phpmyadmin: image: phpmyadmin/phpmyadmin:latest environment: - VIRTUAL_HOST=phpmyadmin.local - PMA_HOST=mysql - PMA_USER=root - PMA_PASSWORD=root networks: - frontend - backend networks: frontend: external: name: proxy_proxy backend:</code> </pre><br></div></div><br>  Apa yang diumumkan di sini? <br><br>  Empat layanan terdaftar: nginx, php, mysql dan phpmyadmin.  Dan dua jaringan.  Satu jaringan proxy, yang disebut frontend, diiklankan sebagai jaringan eksternal dan jaringan backend internal baru.  Driver untuk itu tidak ditentukan, seperti yang saya tulis sebelumnya, driver default dari tipe jembatan akan digunakan. <br><br><h4>  nginx </h4><br>  Semuanya harus jelas di sini.  Kami menggunakan gambar dasar dengan hub buruh pelabuhan.  Variabel lingkungan diperlukan agar proksi berfungsi dan memberitahukannya pada alamat apa wadah harus dapat diakses.  Opsi depend_on menunjukkan ketergantungan wadah ini pada wadah php.  Ini berarti bahwa wadah php akan diluncurkan terlebih dahulu, dan setelah itu wadah nginx yang bergantung padanya akan diluncurkan.  Selanjutnya, kami meneruskan konfigurasi untuk nginx kami.  Ini akan menjadi sedikit lebih rendah dan me-mount folder dengan html.  Kami juga memperhatikan bahwa wadah memiliki akses ke dua jaringan sekaligus.  Ini harus mengkomunikasikan kedua proxy dari jaringan frontend dan php dari jaringan backend.  Pada prinsipnya, akan mungkin untuk mendorong semua kontainer ke jaringan frontend yang sama, tapi saya yakin pemisahan seperti itu lebih tepat. <br><br><div class="spoiler">  <b class="spoiler_title">default.nginx</b> <div class="spoiler_text"><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name_in_redirect</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> /var/log/nginx/host.access.log main; <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /var/www/html/; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">try_files</span></span> <span class="hljs-variable"><span class="hljs-variable">$uri</span></span> /index.php<span class="hljs-variable"><span class="hljs-variable">$is_args</span></span><span class="hljs-variable"><span class="hljs-variable">$args</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~ \.php$</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">try_files</span></span> <span class="hljs-variable"><span class="hljs-variable">$uri</span></span> =<span class="hljs-number"><span class="hljs-number">404</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_split_path_info</span></span><span class="hljs-regexp"><span class="hljs-regexp"> ^(.+\.php)(/.+)$</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_pass</span></span> php:<span class="hljs-number"><span class="hljs-number">9000</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_index</span></span> index.php; <span class="hljs-attribute"><span class="hljs-attribute">include</span></span> fastcgi_params; <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_param</span></span> SCRIPT_FILENAME <span class="hljs-variable"><span class="hljs-variable">$document_root</span></span><span class="hljs-variable"><span class="hljs-variable">$fastcgi_script_name</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_param</span></span> PATH_INFO <span class="hljs-variable"><span class="hljs-variable">$fastcgi_path_info</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~ /\.ht</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">deny</span></span> all; } }</code> </pre><br></div></div><br>  default.nginx adalah konfigurasi untuk nginx yang diteruskan ke wadah.  Poin kunci di sini adalah arahan <b>php fastcgi_pass: 9000</b> .  Ini menetapkan alamat server FastCGI.  Alamat tersebut dapat ditentukan sebagai nama domain atau alamat IP, dan port. <br><br>  <b>php: 9000</b> - nama layanan adalah alamat server FastCGI.  Nginx yang mengakses php akan menerima alamat IP dari wadah tempat php dijalankan.  Port 9000 adalah port standar, dinyatakan saat membuat wadah dasar.  Port ini tersedia untuk nginx melalui jaringan, tetapi tidak tersedia di mesin host, karena tidak diteruskan. <br><br><h4>  php </h4><br>  Tidak biasanya gambar tidak diindikasikan.  Alih-alih, ia membangun gambar sendiri langsung dari file penulisan.  Arahan konteks menunjuk ke folder tempat Dockerfile berada. <br><br><div class="spoiler">  <b class="spoiler_title">Dockerfile</b> <div class="spoiler_text"><pre> <code class="php hljs">FROM php:<span class="hljs-number"><span class="hljs-number">7.3</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>-fpm RUN apt-get update &amp;&amp; apt-get install -y \ libzip-dev \ zip \ &amp;&amp; docker-php-ext-configure zip --with-libzip \ &amp;&amp; docker-php-ext-install zip \ &amp;&amp; docker-php-ext-install mysqli COPY --from=composer:latest /usr/bin/composer /usr/bin/composer WORKDIR /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/www/html</code> </pre><br></div></div><br>  Dockerfile menyatakan bahwa build menggunakan gambar php dasar: 7.3.2-fpm, kemudian perintah untuk menginstal ekstensi php dijalankan.  Selanjutnya, komposer disalin dari gambar dasar lain dan direktori kerja untuk proyek diatur.  Saya akan mempertimbangkan masalah perakitan secara lebih rinci di pos lain. <br><br>  Juga, file php.ini dan folder html dengan proyek kami dilemparkan ke dalam wadah. <br><br>  Perhatikan bahwa php terletak di jaringan backend dan, misalnya, proxy tidak lagi dapat mengaksesnya. <br><br><h4>  mysql </h4><br>  Gambar mysql dasar diambil dengan tag 5.7, yang bertanggung jawab untuk versi mysql.  Folder ./docker/mysql/data digunakan untuk menyimpan file basis data (Anda bahkan tidak perlu membuatnya, itu dibuat saat startup).  Dan melalui variabel lingkungan, kata sandi diatur untuk pengguna root, juga root. <br><br>  Basis data terletak di jaringan backend, yang memungkinkannya untuk tetap berhubungan dengan php.  Gambar dasar menggunakan port standar 3306. Gambar ini tersedia di jaringan buruh pelabuhan untuk php, tetapi tidak tersedia di mesin host.  Jika Anda meneruskan untuk port ini, Anda dapat menghubungkannya, misalnya, dari PHPSTORM yang sama.  Tetapi jika antarmuka phpmyadmin sudah cukup untuk Anda, maka Anda tidak bisa melakukan ini. <br><br><h4>  phpmyadmin </h4><br>  Gambar resmi dari phpmyadmin.  Variabel lingkungan menggunakan VIRTUAL_HOST untuk berinteraksi dengan proxy, mirip dengan nginx.  PMA_USER dan PMA_PASSWORD akses ke database.  Dan PMA_HOST database host itu sendiri.  Tapi ini bukan localhost, seperti biasanya, tetapi mysql.  Yaitu  komunikasi dengan basis data tersedia dengan nama layanannya, yaitu  mysql.  Wadah phpmyadmin dapat berkomunikasi dengan database, karena memiliki koneksi ke jaringan frontend. <br><br>  Kami memulai layanan dengan perintah biasa: docker-compose -d. <br><br>  Kami melihat output berikut: <br><br><div class="spoiler">  <b class="spoiler_title">Peluncuran layanan</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Creating network "lesson2_backend" with the default driver Building php Step 1/4 : FROM php:7.3.2-fpm ---&gt; 9343626a0f09 Step 2/4 : RUN apt-get update &amp;&amp; apt-get install -y libzip-dev zip &amp;&amp; docker-php-ext-configure zip --with-libzip &amp;&amp; docker-php-ext-install zip &amp;&amp; docker-php-ext-install mysqli ---&gt; Using cache ---&gt; 5e4687b5381f Step 3/4 : COPY --from=composer:latest /usr/bin/composer /usr/bin/composer ---&gt; Using cache ---&gt; 81b9c665be08 Step 4/4 : WORKDIR /var/www/html ---&gt; Using cache ---&gt; 3fe8397e92e6 Successfully built 3fe8397e92e6 Successfully tagged lesson2_php:latest Pulling mysql (mysql:5.7)... 5.7: Pulling from library/mysql fc7181108d40: Already exists 787a24c80112: Already exists a08cb039d3cd: Already exists 4f7d35eb5394: Already exists 5aa21f895d95: Already exists a742e211b7a2: Already exists 0163805ad937: Already exists 62d0ebcbfc71: Pull complete 559856d01c93: Pull complete c849d5f46e83: Pull complete f114c210789a: Pull complete Digest: sha256:c3594c6528b31c6222ba426d836600abd45f554d078ef661d3c882604c70ad0a Status: Downloaded newer image for mysql:5.7 Creating lesson2_php_1 ... done Creating lesson2_mysql_1 ... done Creating lesson2_phpmyadmin_1 ... done Creating lesson2_nginx_1 ... done</code> </pre><br></div></div><br>  Kita melihat bahwa pada awalnya jaringan lesson2_backend dibuat, kemudian gambar php dirakit, maka gambar yang belum ada dalam sistem (tarikan) dapat diunduh dan layanan yang dijelaskan benar-benar diluncurkan. <br><br>  Sentuhan terakhir, agar semuanya berfungsi, ini tambahan untuk host atau domain sites.local dan phpmyadmin.local. <br><br>  Isi index.php mungkin sebagai berikut: <br><br><div class="spoiler">  <b class="spoiler_title">index.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//phpinfo(); $link = mysqli_connect('mysql', 'root', 'root'); if (!$link) { die(' : ' . mysqli_error()); } echo ' '; mysqli_close($link);</span></span></code> </pre><br></div></div><br>  Di sini kita memeriksa bahwa koneksi dari ekstensi php - mysqli, yang ditambahkan selama perakitan Dockerfile, sudah benar. <br><br>  Dan perhatikan bahwa untuk koneksi dengan wadah, nama layanan digunakan - mysql. <br><br>  Struktur seluruh proyek adalah sebagai berikut: <br><br><div class="spoiler">  <b class="spoiler_title">Struktur proyek</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">habr/lesson2$ tree . ├── docker │ ├── mysql │ │ └── data │ ├── nginx │ │ └── conf.d │ │ └── default.nginx │ └── php │ ├── Dockerfile │ └── php.ini ├── docker-compose.yml ├── html │ └── index.php └── proxy └── docker-compose.yml</code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id460173/">https://habr.com/ru/post/id460173/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id460159/index.html">Metode untuk memantau kondisi jalan Rusia saat ini oleh ponsel cerdas pengguna</a></li>
<li><a href="../id460161/index.html">FusionPBX dan ACL</a></li>
<li><a href="../id460163/index.html">Seperti yang terlihat</a></li>
<li><a href="../id460165/index.html">Latar belakang: kriptografi jari kuantum</a></li>
<li><a href="../id460169/index.html">Manual R baru-baru ini telah menjadi publikasi non-akademik yang paling banyak dikutip dalam makalah akademik.</a></li>
<li><a href="../id460175/index.html">Semiotika dalam pemasaran: apa artinya ini bagi merek Anda</a></li>
<li><a href="../id460177/index.html">Sensor kebocoran air nirkabel pada nRF52832, proyek DIY</a></li>
<li><a href="../id460179/index.html">LEAN + AGILE = AGILEAN atau kami mengumpulkan seluruh bagian</a></li>
<li><a href="../id460181/index.html">Tingkatkan pengetahuan JavaScript Anda dengan mem-parsing kode sumber</a></li>
<li><a href="../id460185/index.html">Layanan online "Analisis Kecepatan dalam Kecelakaan oleh Video"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>