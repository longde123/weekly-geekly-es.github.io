<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüíª üêî üë®‚Äçüé® B√∫squeda de errores en el c√≥digo fuente del SDK de Amazon Web Services para .NET üßóüèº üôÖüèº üí¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bienvenido a todos los fan√°ticos de destrozar el c√≥digo de otra persona. :) Hoy en nuestro laboratorio, tenemos un nuevo material para una investigaci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>B√∫squeda de errores en el c√≥digo fuente del SDK de Amazon Web Services para .NET</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/437514/"><p><img src="https://habrastorage.org/getpro/habr/post_images/188/292/f27/188292f271dd0648b09f848dbe66efa6.png" alt="Imagen 1"></p><br>  Bienvenido a todos los fan√°ticos de destrozar el c√≥digo de otra persona.  :) Hoy en nuestro laboratorio, tenemos un nuevo material para una investigaci√≥n: el c√≥digo fuente del AWS SDK para el proyecto .NET.  En ese momento, escribimos un art√≠culo sobre la comprobaci√≥n de AWS SDK para C ++.  Entonces no hab√≠a nada particularmente interesante.  Veamos qu√© vale .NET de la versi√≥n AWS SDK.  Una vez m√°s, es una gran oportunidad para demostrar las habilidades del analizador PVS-Studio y hacer que el mundo sea un poco mejor. <br><a name="habracut"></a><br>  El SDK de Amazon Web Services (AWS) para .NET es un conjunto de herramientas de desarrollador destinadas a crear aplicaciones basadas en .NET en la infraestructura de AWS.  Este conjunto permite simplificar significativamente el proceso de escritura de c√≥digo.  El SDK incluye conjuntos API .NET para varios servicios de AWS, como Amazon S3, Amazon EC2, DynamoDB y otros.  El c√≥digo fuente del SDK est√° disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> . <br><br>  Como mencion√©, en ese momento ya hemos escrito el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> sobre la comprobaci√≥n de AWS SDK para C ++.  El art√≠culo result√≥ ser peque√±o: solo se encontraron un par de errores por cada 512 mil l√≠neas de c√≥digo.  Esta vez estamos tratando con un tama√±o mucho m√°s grande del c√≥digo, que incluye aproximadamente 34 mil archivos cs, y el n√∫mero total de l√≠neas de c√≥digo (excluyendo las en blanco) es impresionante de 5 millones.  Una peque√±a parte del c√≥digo (200 mil l√≠neas en archivos 664-cs) se acumula en las pruebas, no las he considerado. <br><br>  Si la calidad del c√≥digo .NET de la versi√≥n del SDK es aproximadamente la misma que la de C ++ (dos errores por 512 KLOC), entonces deber√≠amos obtener un n√∫mero de errores aproximadamente 10 veces mayor.  Por supuesto, esta es una metodolog√≠a de c√°lculo muy inexacta, que no tiene en cuenta las peculiaridades ling√º√≠sticas y muchos otros factores, pero no creo que el lector ahora quiera entrar en un razonamiento aburrido.  En cambio, sugiero pasar a los resultados. <br><br>  La verificaci√≥n se realiz√≥ con PVS-Studio 6.27.  Es simplemente incre√≠ble, pero el hecho es que en el SDK de AWS para .NET el analizador logr√≥ detectar 40 errores, de los que valdr√≠a la pena hablar.  Demuestra no solo una alta calidad del c√≥digo SDK (aproximadamente 4 errores por 512 KLOC), sino tambi√©n una calidad comparable del analizador C # PVS-Studio en comparaci√≥n con C ++.  ¬°Un gran resultado! <br><br>  Autores de AWS SDK para .NET, ¬°son verdaderos campeones!  Con cada proyecto, demuestra una calidad tremenda del c√≥digo.  Puede ser un gran ejemplo para otros equipos.  Sin embargo, por supuesto, no ser√≠a un desarrollador de un analizador est√°tico si no diera mis 2 centavos.  :) Ya estamos trabajando con un equipo de Lumberyard de Amazon en el uso de PVS-Studio.  Dado que es una empresa muy grande con un mont√≥n de unidades en todo el mundo, es muy probable que el equipo de AWS SDK para .NET nunca haya o√≠do hablar de PVS-Studio.  De todos modos, no he encontrado ning√∫n signo de uso de nuestro analizador en el c√≥digo SDK, aunque no dice nada.  Sin embargo, al menos, el equipo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">usa</a> el analizador integrado en Visual Studio.  Es genial, pero las revisiones de c√≥digo siempre se pueden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mejorar</a> :). <br><br>  Como resultado, logr√© encontrar algunos errores en el c√≥digo SDK y, finalmente, es hora de compartirlos. <br><br>  <b>Error en la logica</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3008</a> [CWE-563] La variable 'this.linker.s3.region' tiene valores asignados dos veces sucesivamente.  Quiz√°s esto sea un error.  L√≠neas de verificaci√≥n: 116, 114. AWSSDK.DynamoDBv2.Net45 S3Link.cs 116 <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Region { get { .... } <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (String.IsNullOrEmpty(value)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.linker.s3.region = <span class="hljs-string"><span class="hljs-string">"us-east-1"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.linker.s3.region = value; } }</code> </pre> <br>  El analizador advierte sobre la asignaci√≥n de valores repetidos a la misma variable.  Del c√≥digo queda claro que esto se debe al error que viola la l√≥gica del trabajo del programa: el valor de la variable <i>this.linker.s3.region</i> siempre ser√° igual al valor del valor de la variable, independientemente de la condici√≥n <i>if (String.IsNullOrEmpty (valor))</i> .  se perdi√≥ la declaraci√≥n de <i>retorno</i> en el cuerpo del bloque <i>if</i> .  El c√≥digo debe repararse de la siguiente manera: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Region { get { .... } <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (String.IsNullOrEmpty(value)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.linker.s3.region = <span class="hljs-string"><span class="hljs-string">"us-east-1"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.linker.s3.region = value; } }</code> </pre> <br>  <b>Recursi√≥n infinita</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3110</a> [CWE-674] Posible recursi√≥n infinita dentro de la propiedad 'OnFailure'.  AWSSDK.ElasticMapReduce.Net45 ResizeJobFlowStep.cs 171 <br><br><pre> <code class="cpp hljs">OnFailure? onFailure = null; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OnFailure? OnFailure { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.OnFailure; } <span class="hljs-comment"><span class="hljs-comment">// &lt;= set { this.onFailure = value; } }</span></span></code> </pre> <br>  Un ejemplo cl√°sico de un error tipogr√°fico, que conduce a una recursi√≥n infinita en el <i>get</i> <i>getor de la</i> propiedad <i>OnFailure</i> .  En lugar de devolver el valor de un campo privado en <i>Failure, se realiza</i> el acceso a la propiedad <i>OnFailure</i> .  Variante correcta: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OnFailure? OnFailure { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onFailure; } <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onFailure = value; } }</code> </pre> <br>  Puede preguntar: "¬øC√≥mo funcion√≥?"  Hasta ahora, no c√≥mo.  La propiedad no se usa en ning√∫n otro lugar, pero esto es temporal.  En un momento, alguien comenzar√° a usarlo y ciertamente recibir√° un resultado inesperado.  Para evitar estos errores tipogr√°ficos, se recomienda no utilizar identificadores que difieran solo en el caso de la primera letra. <br><br>  Otro comentario a esta construcci√≥n es el uso del identificador, que coincide completamente con el nombre del tipo <i>OnFailure</i> .  Desde el punto de vista del compilador, es bastante aceptable, pero esto complica la percepci√≥n del c√≥digo para una persona. <br><br>  Otro error similar: <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3110</a> [CWE-674] Posible recursi√≥n infinita dentro de la propiedad 'SSES3'.  AWSSDK.S3.Net45 InventoryEncryption.cs 37 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SSES3 sSES3; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SSES3 SSES3 { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SSES3; } <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SSES3 = value; } }</code> </pre> <br>  La situaci√≥n es id√©ntica a la descrita anteriormente.  Sin embargo, aqu√≠ ocurrir√° una recursi√≥n infinita al acceder a la propiedad <i>SSES3</i> tanto para leer como para asignar.  Variante correcta: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SSES3 SSES3 { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sSES3; } <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sSES3 = value; } }</code> </pre> <br>  <b>Prueba en consideraci√≥n</b> <br><br>  Ahora me gustar√≠a citar una tarea de un desarrollador, tomada con el m√©todo Copy-Paste.  Eche un vistazo a la apariencia del c√≥digo en el editor de Visual Studio e intente encontrar un error. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/bfa/71b/1ab/bfa71b1ab4af941c43e5349df51b1614.png" alt="Cuadro 3"></p><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3029</a> Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  L√≠neas de verificaci√≥n: 91, 95. AWSSDK.AppSync.Net45 CreateApiKeyResponseUnmarshaller.cs 91 <br><br>  <i>Reduje</i> el cuerpo del m√©todo <i>UnmarshallException</i> , habiendo eliminado todo lo que no es necesario.  Ahora puede ver que verificaciones id√©nticas se suceden: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override AmazonServiceException </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UnmarshallException</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (errorResponse.Code != null &amp;&amp; errorResponse.Code.Equals(<span class="hljs-string"><span class="hljs-string">"LimitExceededException"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LimitExceededException(errorResponse.Message, innerException, errorResponse.Type, errorResponse.Code, errorResponse.RequestId, statusCode); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (errorResponse.Code != null &amp;&amp; errorResponse.Code.Equals(<span class="hljs-string"><span class="hljs-string">"LimitExceededException"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LimitExceededException(errorResponse.Message, innerException, errorResponse.Type, errorResponse.Code, errorResponse.RequestId, statusCode); } .... }</code> </pre> <br>  Puede parecer que el error no es √°spero, solo una comprobaci√≥n adicional.  Sin embargo, a menudo dicho patr√≥n puede indicar problemas m√°s serios en el c√≥digo, cuando no se realizar√° una verificaci√≥n necesaria. <br><br>  En el c√≥digo, hay varios errores similares. <br><br>  <b>Advertencias de PVS-Studio:</b> <br><br><ul><li>  V3029 Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  Verificaci√≥n de l√≠neas: 75, 79. AWSSDK.CloudDirectory.Net45 CreateSchemaResponseUnmarshaller.cs 75 </li><li>  V3029 Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  L√≠neas de verificaci√≥n: 105, 109. AWSSDK.CloudDirectory.Net45 GetSchemaAsJsonResponseUnmarshaller.cs 105 </li><li>  V3029 Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  L√≠neas de verificaci√≥n: 201, 205. AWSSDK.CodeCommit.Net45 PostCommentForPullRequestResponseUnmarshaller.cs 201 </li><li>  V3029 Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  Verificaci√≥n de l√≠neas: 101, 105. AWSSDK.CognitoIdentityProvider.Net45 VerifySoftwareTokenResponseUnmarshaller.cs 101 </li><li>  V3029 Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  L√≠neas de verificaci√≥n: 72, 76. AWSSDK.Glue.Net45 UpdateConnectionResponseUnmarshaller.cs 72 </li><li>  V3029 Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  L√≠neas de verificaci√≥n: 123, 127. AWSSDK.Neptune.Net45 RestoreDBClusterFromSnapshotResponseUnmarshaller.cs 123 </li><li>  V3029 Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  L√≠neas de verificaci√≥n: 167, 171. AWSSDK.Neptune.Net45 RestoreDBClusterFromSnapshotResponseUnmarshaller.cs 167 </li><li>  V3029 Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  L√≠neas de verificaci√≥n: 127, 131. AWSSDK.RDS.Net45 RestoreDBClusterFromSnapshotResponseUnmarshaller.cs 127 </li><li>  V3029 Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  L√≠neas de verificaci√≥n: 171, 175. AWSSDK.RDS.Net45 RestoreDBClusterFromSnapshotResponseUnmarshaller.cs 171 </li><li>  V3029 Las expresiones condicionales de las declaraciones 'if' ubicadas una junto a la otra son id√©nticas.  Verifique las l√≠neas: 99, 103. AWSSDK.Rekognition.Net45 RecognizeCelebritiesResponseUnmarshaller.cs 99 </li></ul><br>  <b>Que es</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3062</a> Se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">utiliza</a> un objeto 'attributeName' como argumento para su propio m√©todo.  Considere verificar el primer argumento real del m√©todo 'Contiene'.  AWSSDK.MobileAnalytics.Net45 CustomEvent.cs 261 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Dictionary that stores attribute for this event only. /// &lt;/summary&gt; private Dictionary&lt;string,string&gt; _attributes = new Dictionary&lt;string,string&gt;(); /// &lt;summary&gt; /// Gets the attribute. /// &lt;/summary&gt; /// &lt;param name="attributeName"&gt;Attribute name.&lt;/param&gt; /// &lt;returns&gt;The attribute. Return null of attribute doesn't /// exist.&lt;/returns&gt; public string GetAttribute(string attributeName) { if(string.IsNullOrEmpty(attributeName)) { throw new ArgumentNullException("attributeName"); } string ret = null; lock(_lock) { if(attributeName.Contains(attributeName)) // &lt;= ret = _attributes[attributeName]; } return ret; }</span></span></code> </pre> <br>  El analizador ha detectado un error en el m√©todo <i>GetAttribute</i> : se verifica si una cadena se contiene a s√≠ misma.  De la descripci√≥n del m√©todo se deduce que si se encuentra el nombre del atributo (clave del nombre del <i>atributo</i> ) (en el diccionario <i>_atributos</i> ), el valor del atributo debe ser devuelto, de lo contrario - <i>nulo</i> .  De hecho, como la condici√≥n <i>attributeName.Contains (attributeName)</i> siempre es verdadera, se intenta devolver el valor mediante una clave que podr√≠a no encontrarse en un diccionario.  Luego, en lugar de devolver <i>nulo, se</i> <i>generar√°</i> una excepci√≥n <i>KeyNotFoundException</i> . <br><br>  Intentemos arreglar este c√≥digo.  Para entender mejor c√≥mo hacer esto, debe buscar otro m√©todo: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/// &lt;summary&gt; /// Determines whether this instance has attribute the specified /// attributeName. /// &lt;/summary&gt; /// &lt;param name="attributeName"&gt;Attribute name.&lt;/param&gt; /// &lt;returns&gt;Return true if the event has the attribute, else /// false.&lt;/returns&gt; public bool HasAttribute(string attributeName) { if(string.IsNullOrEmpty(attributeName)) { throw new ArgumentNullException("attributeName"); } bool ret = false; lock(_lock) { ret = _attributes.ContainsKey(attributeName); } return ret; }</span></span></code> </pre> <br>  Este m√©todo verifica si el nombre del atributo (key <i>attribute</i> key) existe en el diccionario <i>_attributes</i> .  Volvamos al m√©todo <i>GetAttribute</i> nuevamente y <i>arreglemos</i> el error: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAttribute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> attributeName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.IsNullOrEmpty(attributeName)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"attributeName"</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> ret = null; lock(_lock) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_attributes.ContainsKey(attributeName)) ret = _attributes[attributeName]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre> <br>  Ahora el m√©todo hace exactamente lo que se indica en la descripci√≥n. <br><br>  Un peque√±o comentario m√°s a este fragmento de c√≥digo.  Not√© que los autores usan el <i>bloqueo</i> cuando trabajan con el diccionario <i>_attributes</i> .  Est√° claro que esto es necesario cuando se tiene un acceso multiproceso, pero la construcci√≥n de la <i>cerradura</i> es bastante lenta y engorrosa.  En lugar de un <i>diccionario</i> , en este caso, tal vez, ser√≠a m√°s conveniente utilizar la versi√≥n segura del subproceso del diccionario: <i>ConcurrentDictionary</i> .  De esta manera, no habr√° necesidad de <i>bloqueo.</i>  Aunque, tal vez no s√© sobre los detalles del proyecto. <br><br>  <b>Comportamiento sospechoso</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3063</a> [CWE-571] Una parte de la expresi√≥n condicional siempre es verdadera si se eval√∫a: string.IsNullOrEmpty (inferredIndexName).  AWSSDK.DynamoDBv2.PCL ContextInternal.cs 802 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetQueryIndexName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> inferredIndexName = null; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.IsNullOrEmpty(specifiedIndexName) &amp;&amp; indexNames.Count == <span class="hljs-number"><span class="hljs-number">1</span></span>) { inferredIndexName = indexNames[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (indexNames.Contains(specifiedIndexName, StringComparer.Ordinal)) { inferredIndexName = specifiedIndexName; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.IsNullOrEmpty(inferredIndexName) &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= indexNames.Count &gt; 0) throw new InvalidOperationException("Local Secondary Index range key conditions are used but no index could be inferred from model. Specified index name = " + specifiedIndexName); .... }</span></span></code> </pre> <br>  El analizador estaba preocupado por la <i>cadena de</i> verificaci√≥n. <i>IsNullOrEmpty (inferredIndexName)</i> .  De hecho, la cadena <i>inferredIndexName</i> se asigna como <i>nula</i> , luego el valor de esta variable no se cambia en ning√∫n lado, luego, por alguna raz√≥n, se verifica para una cadena <i>nula</i> o vac√≠a.  Parece sospechoso  Echemos un vistazo de cerca al fragmento de c√≥digo anterior.  Deliberadamente no lo reduje para entender mejor la situaci√≥n.  Entonces, en la primera instrucci√≥n <i>if</i> (y tambi√©n en la siguiente), la variable <i>especificada</i> IndexIndexName se verifica de alguna manera.  Dependiendo de los resultados de las comprobaciones, la variable <i>inferredIndexName</i> est√° obteniendo un nuevo valor.  Ahora veamos la tercera declaraci√≥n <i>if</i> .  El cuerpo de esta declaraci√≥n (lanzamiento de la excepci√≥n) se realizar√° en caso de que <i>indexNames.Count&gt; 0,</i> como la primera parte de la condici√≥n completa, que es <i>string.IsNullOrEmpty (inferredIndexName)</i> siempre es verdadero.  Quiz√°s, las variables <i>especificadas</i> como <i>IndexIndex</i> y <i>inferredIndexName</i> se mezclan o la tercera verificaci√≥n tiene que ser sin <i>otra cosa</i> , lo que representa una declaraci√≥n <i>if</i> independiente: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.IsNullOrEmpty(specifiedIndexName) &amp;&amp; indexNames.Count == <span class="hljs-number"><span class="hljs-number">1</span></span>) { inferredIndexName = indexNames[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (indexNames.Contains(specifiedIndexName, StringComparer.Ordinal)) { inferredIndexName = specifiedIndexName; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.IsNullOrEmpty(inferredIndexName) &amp;&amp; indexNames.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(....);</code> </pre> <br>  En este caso, es dif√≠cil dar una respuesta definitiva sobre las opciones para corregir este c√≥digo.  De todos modos, el autor necesita verificarlo. <br><br>  <b>NullReferenceException</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3095</a> [CWE-476] El objeto 'conditionValues' se us√≥ antes de que se verificara como nulo.  L√≠neas de verificaci√≥n: 228, 238. AWSSDK.Core.Net45 JsonPolicyWriter.cs 228 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeConditions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... foreach (....) { IList&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; conditionValues = keyEntry.Value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (conditionValues.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= continue; .... if (conditionValues != null &amp;&amp; conditionValues.Count != 0) { .... } .... } }</span></span></code> </pre> <br>  Es un clasico.  La variable <i>conditionValues</i> se usa sin una comprobaci√≥n preliminar de <i>nulo</i> .  Mientras m√°s tarde en el c√≥digo se realiza esta verificaci√≥n.  El c√≥digo debe corregirse de la siguiente manera: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeConditions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... foreach (....) { IList&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; conditionValues = keyEntry.Value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (conditionValues != null &amp;&amp; conditionValues.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (conditionValues != null &amp;&amp; conditionValues.Count != <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } .... } }</code> </pre> <br>  Encontr√© varios errores similares en el c√≥digo. <br><br>  <b>Advertencias de PVS-Studio:</b> <br><br><ul><li>  V3095 [CWE-476] El objeto 'ts.Listeners' se us√≥ antes de que se verificara como nulo.  L√≠neas de verificaci√≥n: 140, 143. AWSSDK.Core.Net45 Logger.Diagnostic.cs 140 </li><li>  V3095 [CWE-476] El objeto 'obj' se us√≥ antes de que se verificara como nulo.  L√≠neas de verificaci√≥n: 743, 745. AWSSDK.Core.Net45 JsonMapper.cs 743 </li><li>  V3095 [CWE-476] El objeto 'multipartUploadMultipartUploadpartsList' se us√≥ antes de que se verificara contra nulo.  Verifique las l√≠neas: 65, 67. AWSSDK.S3.Net45 CompleteMultipartUploadRequestMarshaller.cs 65 </li></ul><br>  La siguiente advertencia es muy similar en significado, pero el caso es opuesto al discutido anteriormente. <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3125</a> [CWE-476] El objeto 'estado' se us√≥ despu√©s de que se verific√≥ contra nulo.  L√≠neas de verificaci√≥n: 139, 127. AWSSDK.Core.Net45 RefreshingAWSCredentials.cs 139 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateToGeneratedCredentials</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( CredentialsRefreshState state)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> errorMessage; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ShouldUpdate) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == null) errorMessage = <span class="hljs-string"><span class="hljs-string">"Unable to generate temporary credentials"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AmazonClientException(errorMessage); } state.Expiration -= PreemptExpiryTime; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  Uno de los fragmentos de c√≥digo incluye verificar el valor de la variable de <i>estado</i> para <i>nulo</i> .  En el siguiente c√≥digo, la variable se utiliza para cancelar la suscripci√≥n del evento <i>PreemptExpiryTime</i> , sin embargo, ya no se realiza una comprobaci√≥n de <i>nulo y</i> es posible lanzar la excepci√≥n <i>NullReferenceException</i> .  Una versi√≥n m√°s segura del c√≥digo: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateToGeneratedCredentials</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( CredentialsRefreshState state)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> errorMessage; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ShouldUpdate) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state == null) errorMessage = <span class="hljs-string"><span class="hljs-string">"Unable to generate temporary credentials"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AmazonClientException(errorMessage); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state != null) state.Expiration -= PreemptExpiryTime; .... }</code> </pre> <br>  En el c√≥digo, hay otros errores similares: <br><br>  <b>Advertencias de PVS-Studio:</b> <br><br><ul><li>  V3125 [CWE-476] El objeto 'wrapRequest.Content' se us√≥ despu√©s de que se verific√≥ contra nulo.  L√≠neas de verificaci√≥n: 395, 383. AWSSDK.Core.Net45 HttpHandler.cs 395 </li><li>  V3125 [CWE-476] El objeto 'datasetUpdates' se us√≥ despu√©s de que se verific√≥ contra nulo.  L√≠neas de verificaci√≥n: 477, 437. AWSSDK.CognitoSync.Net45 Dataset.cs 477 </li><li>  V3125 [CWE-476] El objeto 'cORSConfigurationCORSConfigurationcORSRulesListValue' se us√≥ despu√©s de que se verific√≥ contra nulo.  L√≠neas de verificaci√≥n: 125, 111. AWSSDK.S3.Net45 PutCORSConfigurationRequestMarshaller.cs 125 </li><li>  V3125 [CWE-476] El objeto 'lifecycleConfigurationLifecycleConfigurationrulesListValue' se us√≥ despu√©s de que se verific√≥ contra nulo.  L√≠neas de verificaci√≥n: 157, 68. AWSSDK.S3.Net45 PutLifecycleConfigurationRequestMarshaller.cs 157 </li><li>  V3125 [CWE-476] El objeto 'this.Key' se us√≥ despu√©s de que se verific√≥ contra nulo.  L√≠neas de verificaci√≥n: 199, 183. AWSSDK.S3.Net45 S3PostUploadRequest.cs 199 </li></ul><br>  <b>Realidad no alternativa</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3009</a> [CWE-393] Es extra√±o que este m√©todo siempre devuelva el mismo valor de 'verdadero'.  AWSSDK.Core.Net45 Lexer.cs 651 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State19</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (....) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (....) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'"'</span></span>: .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'\\'</span></span>: .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: .... <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  El m√©todo siempre devuelve <i>verdadero</i> .  Veamos cu√°n cr√≠tico es para el c√≥digo de llamada.  <i>Revis√©</i> los casos de usar el m√©todo <i>State19</i> .  Est√° involucrado en llenar la matriz de manejadores <i>fsm_handler_table por</i> igual con otros m√©todos similares (hay 28 de ellos con los nombres, respectivamente, comenzando por <i>State1</i> a <i>State28</i> ).  Aqu√≠ es importante tener en cuenta que, adem√°s de <i>State19</i> , para algunos otros manejadores tambi√©n se emitieron las advertencias <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3009</a> [CWE-393].  Estos son controladores: <i>Estado23, Estado26, Estado27, Estado28</i> .  Las advertencias, emitidas por el analizador para ellos: <br><br><ul><li>  V3009 [CWE-393] Es extra√±o que este m√©todo siempre devuelva el mismo valor de 'verdadero'.  AWSSDK.Core.Net45 Lexer.cs 752 </li><li>  V3009 [CWE-393] Es extra√±o que este m√©todo siempre devuelva el mismo valor de 'verdadero'.  AWSSDK.Core.Net45 Lexer.cs 810 </li><li>  V3009 [CWE-393] Es extra√±o que este m√©todo siempre devuelva el mismo valor de 'verdadero'.  AWSSDK.Core.Net45 Lexer.cs 822 </li><li>  V3009 [CWE-393] Es extra√±o que este m√©todo siempre devuelva el mismo valor de 'verdadero'.  AWSSDK.Core.Net45 Lexer.cs 834 </li></ul><br>  As√≠ es como se ve la declaraci√≥n y la inicializaci√≥n de los controladores: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> StateHandler[] fsm_handler_table; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PopulateFsmTables</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ fsm_handler_table = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StateHandler[<span class="hljs-number"><span class="hljs-number">28</span></span>] { State1, State2, .... State19, .... State23, .... State26, State27, State28 };</code> </pre> <br>  Para completar la imagen, veamos el c√≥digo de uno de los controladores a los que el analizador no ha tenido ning√∫n reclamo, por ejemplo, <i>State2</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State2</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (....) { .... <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre> <br>  As√≠ es como ocurre la llamada de los manejadores: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NextToken</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { handler = fsm_handler_table[state - <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (! handler (fsm_context)) <span class="hljs-comment"><span class="hljs-comment">// &lt;= throw new JsonException (input_char); .... } .... }</span></span></code> </pre> <br>  Como podemos ver, se lanzar√° una excepci√≥n en caso de devolver <i>falso</i> .  En nuestro caso, para los manejadores <i>State19, State23, State26 State27</i> y <i>State28</i> esto nunca suceder√°.  Parece sospechoso  Por otro lado, cinco controladores tienen un comportamiento similar (siempre devolver√° <i>verdadero</i> ), por lo que tal vez fue tan artificial y no es el resultado de un error tipogr√°fico. <br><br>  ¬øPor qu√© estoy yendo tan profundo en todo esto?  Esta situaci√≥n es muy significativa en el sentido de que el analizador est√°tico a menudo solo puede indicar una construcci√≥n sospechosa.  E incluso una persona (no una m√°quina), que no tiene suficiente conocimiento sobre el proyecto, a√∫n no puede dar una respuesta completa sobre la presencia del error, incluso despu√©s de haber pasado tiempo aprendiendo c√≥digo.  Un desarrollador debe revisar este c√≥digo. <br><br>  <b>Verificaciones sin sentido</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3022</a> [CWE-571] La expresi√≥n 'doLog' siempre es verdadera.  AWSSDK.Core.Net45 StoredProfileAWSCredentials.cs 235 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValidCredentialsExistInSharedFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... var doLog = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { doLog = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InvalidDataException) { doLog = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (doLog) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { .... } .... }</span></span></code> </pre> <br>  Presta atenci√≥n a la variable <i>doLog</i> .  Despu√©s de la inicializaci√≥n con el valor <i>falso</i> , esta variable obtendr√° el valor <i>verdadero</i> en todos los casos a lo largo del c√≥digo.  Por lo tanto, la comprobaci√≥n <i>if (doLog)</i> siempre es verdadera.  Quiz√°s, anteriormente en el m√©todo hab√≠a una rama, en la cual a la variable <i>doLog</i> no se le asign√≥ ning√∫n valor.  En el momento de la comprobaci√≥n, podr√≠a contener el valor <i>falso</i> , recibido al inicializar.  Pero ahora no existe tal rama. <br><br>  Otro error similar: <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3022 La</a> expresi√≥n '! Resultado' siempre es falsa.  AWSSDK.CognitoSync.PCL SQLiteLocalStorage.cs 353 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PutValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = PutValueHelper(....); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!result) &lt;= { _logger.DebugFormat(<span class="hljs-string"><span class="hljs-string">"{0}"</span></span>, @<span class="hljs-string"><span class="hljs-string">"Cognito Sync - SQLiteStorage - Put Value Failed"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { UpdateLastModifiedTimestamp(....); } .... }</code> </pre> <br>  El analizador afirma que el valor de la variable de <i>resultado</i> siempre es verdadero.  Solo es posible en caso de que el m√©todo <i>PutValueHelper</i> siempre devuelva <i>verdadero</i> .  Echa un vistazo a este m√©todo: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PutValueHelper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (record == null) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> <br>  De hecho, el m√©todo volver√° <i>verdadero</i> en todas las condiciones.  Adem√°s, el analizador ha emitido una advertencia para este m√©todo.  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3009</a> [CWE-393] Es extra√±o que este m√©todo siempre devuelva el mismo valor de 'verdadero'.  SQLiteLocalStorage.cs 1016 <br><br>  Deliberadamente, no cit√© esta advertencia antes cuando estaba investigando otros errores <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3009</a> y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">guard√©</a> para este caso.  Por lo tanto, la herramienta ten√≠a raz√≥n al se√±alar el error <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3022</a> en el c√≥digo de llamada. <br><br>  <b>Copiar y pegar.</b>  <b>De nuevo</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3001</a> Hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">subexpresiones</a> id√©nticas 'this.token == JsonToken.String' a la izquierda y a la derecha de '||'  operador  AWSSDK.Core.Net45 JsonReader.cs 343 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.token == JsonToken.ObjectEnd || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.token == JsonToken.ArrayEnd || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.token == JsonToken.String || <span class="hljs-comment"><span class="hljs-comment">// &lt;= this.token == JsonToken.Boolean || this.token == JsonToken.Double || this.token == JsonToken.Int || this.token == JsonToken.UInt || this.token == JsonToken.Long || this.token == JsonToken.ULong || this.token == JsonToken.Null || this.token == JsonToken.String // &lt;= )) { .... } .... }</span></span></code> </pre> <br>  El campo <i>this.token</i> se compara dos veces con el valor <i>JsonToken.String</i> de la enumeraci√≥n <i>JsonToken</i> .  Probablemente, una de las comparaciones debe contener otro valor de enumeraci√≥n.  Si es as√≠, se ha cometido un grave error aqu√≠. <br><br>  <b>¬øRefactorizaci√≥n + falta de atenci√≥n?</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3025</a> [CWE-685] Formato incorrecto.  Se espera un n√∫mero diferente de elementos de formato al llamar a la funci√≥n 'Formatear'.  Argumentos no utilizados: AWSConfigs.AWSRegionKey.  AWSSDK.Core.Net45 AWSRegion.cs 116 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InstanceProfileAWSRegion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (region == null) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException( <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Format(CultureInfo.InvariantCulture, <span class="hljs-string"><span class="hljs-string">"EC2 instance metadata was not available or did not contain region information."</span></span>, AWSConfigs.AWSRegionKey)); } .... }</code> </pre> <br>  Quiz√°s, la cadena de formato para el m√©todo <i>string.Format</i> conten√≠a previamente el elemento de formato <i>{0},</i> para el cual se estableci√≥ el argumento <i>AWSConfigs.AWSRegionKey</i> .  Luego se cambi√≥ la cadena, el elemento de formato desapareci√≥, pero un desarrollador olvid√≥ eliminar el argumento.  El ejemplo de c√≥digo dado funciona sin errores (la excepci√≥n se produjo en el caso contrario, el elemento de formato sin el argumento), pero no se ve bien.  El c√≥digo debe corregirse de la siguiente manera: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (region == null) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException( <span class="hljs-string"><span class="hljs-string">"EC2 instance metadata was not available or did not contain region information."</span></span>); }</code> </pre> <br>  <b>Inseguro</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3083</a> [CWE-367] Invocaci√≥n insegura del evento 'mOnSyncSuccess', es posible NullReferenceException.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.CognitoSync.PCL Dataset.cs 827 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FireSyncSuccessEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Record&gt; records)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mOnSyncSuccess != null) { mOnSyncSuccess(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SyncSuccessEventArgs(records)); } }</code> </pre> <br>  Una situaci√≥n com√∫n de una llamada insegura del controlador de eventos.  Un usuario puede darse de baja entre la comprobaci√≥n de la variable <i>mOnSyncSuccess</i> para <i>nulo</i> y la llamada de un controlador, por lo que su valor se convertir√° en <i>nulo</i> .  La probabilidad de tal escenario es peque√±a, pero a√∫n es mejor hacer que el c√≥digo sea m√°s seguro: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FireSyncSuccessEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;Record&gt; records)</span></span></span><span class="hljs-function"> </span></span>{ mOnSyncSuccess?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SyncSuccessEventArgs(records)); }</code> </pre> <br>  En el c√≥digo, hay otros errores similares: <br><br>  <b>Advertencias de PVS-Studio:</b> <br><br><ul><li>  V3083 [CWE-367] Invocaci√≥n insegura del evento 'mOnSyncFailure', NullReferenceException es posible.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.CognitoSync.PCL Dataset.cs 839 </li><li>  V3083 [CWE-367] Invocaci√≥n de evento insegura, NullReferenceException es posible.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.Core.PCL AmazonServiceClient.cs 332 </li><li>  V3083 [CWE-367] Invocaci√≥n de evento insegura, NullReferenceException es posible.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.Core.PCL AmazonServiceClient.cs 344 </li><li>  V3083 [CWE-367] Invocaci√≥n de evento insegura, NullReferenceException es posible.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.Core.PCL AmazonServiceClient.cs 357 </li><li>  V3083 [CWE-367] Invocaci√≥n insegura del evento 'mExceptionEvent', NullReferenceException es posible.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.Core.PCL AmazonServiceClient.cs 366 </li><li>  V3083 [CWE-367] Invocaci√≥n de evento insegura, NullReferenceException es posible.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.Core.PCL AmazonWebServiceRequest.cs 78 </li><li>  V3083 [CWE-367] La ‚Äã‚Äãinvocaci√≥n insegura del evento 'OnRead', NullReferenceException es posible.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.Core.PCL EventStream.cs 97 </li><li>  V3083 [CWE-367] Invocaci√≥n de evento insegura, NullReferenceException es posible.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.Core.Android NetworkReachability.cs 57 </li><li>  V3083 [CWE-367] Invocaci√≥n de evento insegura, NullReferenceException es posible.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.Core.Android NetworkReachability.cs 94 </li><li>  V3083 [CWE-367] Invocaci√≥n de evento insegura, NullReferenceException es posible.  Considere asignar un evento a una variable local antes de invocarlo.  AWSSDK.Core.iOS NetworkReachability.cs 54 </li></ul><br>  <b>Clase cruda</b> <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V3126</a> Tipo 'JsonData' que implementa la interfaz IEquatable &lt;T&gt; no anula el m√©todo 'GetHashCode'.  AWSSDK.Core.Net45 JsonData.cs 26 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonData</span></span></span><span class="hljs-class"> :</span></span> IJsonWrapper, IEquatable&lt;JsonData&gt; { .... }</code> </pre> <br>  La clase <i>JsonData</i> contiene bastante c√≥digo, as√≠ que no lo di en su totalidad, citando solo su declaraci√≥n.  Esta clase realmente no contiene el m√©todo anulado <i>GetHashCode,</i> que no es seguro, ya que puede conducir a un comportamiento err√≥neo al usar el tipo <i>JsonData</i> para trabajar, por ejemplo, con colecciones.  Probablemente, no hay ning√∫n problema en este momento, pero en el futuro este tipo de estrategia podr√≠a cambiar.  Este error se describe en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> con m√°s detalle. <br><br>  <b>Conclusi√≥n</b> <br><br>  Todos estos son errores interesantes que pude detectar en el c√≥digo de AWS SDK para .NET usando el analizador est√°tico PVS-Studio.  Me gustar√≠a destacar una vez m√°s la calidad del proyecto.  Encontr√© un n√∫mero muy peque√±o de errores para 5 millones de l√≠neas de c√≥digo.  Aunque probablemente un an√°lisis m√°s exhaustivo de las advertencias emitidas me permitir√≠a agregar algunos errores m√°s a esta lista.  Sin embargo, tambi√©n es bastante probable que agregue algunas de las advertencias a los errores por nada.  Las conclusiones inequ√≠vocas en este caso siempre son hechas solo por un desarrollador que est√© en el contexto del c√≥digo verificado. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/437514/">https://habr.com/ru/post/437514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../437502/index.html">Dejar√© de tirar lo bueno a la basura</a></li>
<li><a href="../437504/index.html">Peque√±os componentes: ¬øqu√© podr√≠a salir mal? Utilizamos el principio de responsabilidad exclusiva.</a></li>
<li><a href="../437508/index.html">CVE-2019-6111 y otras vulnerabilidades scp</a></li>
<li><a href="../437510/index.html">¬øQu√© sucede cuando env√≠as SMS?</a></li>
<li><a href="../437512/index.html">¬øQu√© son las funciones puras en JavaScript?</a></li>
<li><a href="../437516/index.html">Buscando errores en el SDK de Amazon Web Services para el c√≥digo fuente de .NET</a></li>
<li><a href="../437518/index.html">Ataque de escarabajos</a></li>
<li><a href="../437520/index.html">‚Äú¬°Mi luz es un espejo! - dime, mu√©strame mi doble ... ": dise√±a un buen marco y obt√©n el segundo como regalo</a></li>
<li><a href="../437522/index.html">Colonia Cap√≠tulo 22: Decisi√≥n final</a></li>
<li><a href="../437524/index.html">Crea una IA de ajedrez simple: 5 sencillos pasos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>