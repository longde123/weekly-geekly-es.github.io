<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∫üèΩ üéÖüèΩ üéÉ Entwicklung intelligenter Ger√§te am Beispiel eines Fu√übodenreglers auf ESP8266 üë∂üèΩ üï¥üèº üßñüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich m√∂chte meine Erfahrungen bei der Entwicklung eines intelligenten Ger√§ts teilen. In dieser Ver√∂ffentlichung werde ich Hardware (kurz) und Software ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entwicklung intelligenter Ger√§te am Beispiel eines Fu√übodenreglers auf ESP8266</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412889/">  Ich m√∂chte meine Erfahrungen bei der Entwicklung eines intelligenten Ger√§ts teilen.  In dieser Ver√∂ffentlichung werde ich Hardware (kurz) und Software (detaillierter) beschreiben. <br><br>  Die Steuerung dient zur Analyse der Messwerte der Sensoren (verkabelt und drahtlos) und zur Aufrechterhaltung der eingestellten Temperatur (einschlie√ülich des Zeitplans einschlie√ülich der Wochentage) in jeder einzelnen Zone, indem der Kessel ein- und ausgeschaltet und die Heizungskreise des Wasserbodens mithilfe der W√§rmek√∂pfe am Kollektor gesteuert werden. <br><a name="habracut"></a><br><h2>  Hardware </h2><br>  Als Controller wurde ESP8266 (WeMos D1 mini) ausgew√§hlt, als  hat WiFi an Bord.  Anstelle von ESP8266 kann jeder andere Controller oder Mikrocomputer verwendet werden - die allgemeinen Ideen bleiben unver√§ndert. Hauptsache, ein WEB-Server mit Unterst√ºtzung f√ºr WEB-Sockets kann auf dem ausgew√§hlten System bereitgestellt werden.  Folgendes wurde auch im Projekt verwendet: <br><br><ul><li>  RTC: DS3231 - Der Wochentag und die aktuelle Uhrzeit m√ºssen ermittelt werden.  Das Projekt wurde als eigenst√§ndiges Ger√§t konzipiert, das ohne Internet arbeiten kann, sodass NTP nicht geeignet ist. </li><li>  Drahtlose Temperatursensoren: NoName, 433 MHz, von der chinesischen Wetterstation - eine schl√ºsselfertige L√∂sung, die mit Batterien arbeitet.  Was brauchst du noch?  Es ist jedoch erforderlich, dass die Daten√ºbertragungsdauer nicht festgelegt ist.  Das Problem ist, dass die √úbertragungszeit 35 Sekunden betr√§gt und nicht viel schwimmt.  Und es gibt Situationen, in denen sich die Signale zweier Sensoren √ºberlappen.  In diesem Fall fallen ein oder zwei Sensoren f√ºr eine Weile aus dem System aus.  Das Problem kann mit √§hnlichen Sensoren gel√∂st werden, bei denen durch Kanalumschaltung auch die Daten√ºbertragungsdauer ge√§ndert wird. </li><li>  433-MHz-Empf√§nger: Rxb6 - Internet-Bewertungen und pers√∂nliche Erfahrungen sind kein schlechter Empf√§nger. </li><li>  Kabelgebundene Temperatursensoren: DS18B20 - sehr praktisch, da Sie die Anzahl der Sensoren nicht im Voraus kennen m√ºssen. </li><li>  1Wire-Bus-Master: DS2482-100 - Das 1Wire-Protokoll reagiert sehr empfindlich auf Timings. Daher verwenden alle Implementierungen des Programmbus-Masters eine Verz√∂gerung, die f√ºr Multitasking nicht sehr gut ist.  Mit diesem Chip k√∂nnen Sie den 1Wire-Bus nutzen und seine M√§ngel beseitigen, indem Sie 1Wire &lt;-&gt; i2c senden.  Das i2c-Protokoll verf√ºgt √ºber eine Synchronisationsleitung, aufgrund derer es f√ºr das Timing nicht kritisch ist und h√§ufig in Hardware in Controllern implementiert wird. </li><li>  Watchdog-Timer: TPL5000DGST - Die kontinuierliche Verf√ºgbarkeit ist f√ºr dieses Projekt nicht so wichtig, die Zug√§nglichkeit ist jedoch sehr wichtig.  Der ESP8266 verf√ºgt √ºber einen integrierten Watchdog-Timer.  Aber wie die Praxis gezeigt hat, gibt es manchmal immer noch Situationen, in denen es nicht zurechtkommt und das System einfriert.  Ein externer Hardware-Watchdog-Timer wurde f√ºr Notfallsituationen entwickelt.  Konfiguriert f√ºr eine Verz√∂gerung von 64 Sekunden.  An den Bein-TX angeschlossen - W√§hrend des Betriebs schreibt das System st√§ndig Debugging-Informationen an Serial, und die mangelnde Aktivit√§t von mehr als einer Minute weist auf einen Stillstand des Systems hin. </li><li>  Port-Expander: 74HC595 - F√ºr die Verwendung dieses Expanders sind 4 Beine des Controllers erforderlich - drei, um den Status zu √ºbertragen, und einer, damit die Relais beim Einschalten nicht klicken.  Das n√§chste Mal werde ich PCF8574 verwenden - der i2c-Bus wird immer noch verwendet, d. H.  Es sind keine zus√§tzlichen MCU-Beine erforderlich und die Ausg√§nge 1 werden eingestellt, wenn Strom angelegt wird. </li><li>  Relaismodul: NoName, 8-Kanal, 5 V - es gibt nichts zu sagen, au√üer dass das Relais an den Moduleing√§ngen auf einem niedrigen Pegel eingeschaltet ist.  Halbleiterrelais sind in diesem Projekt nicht zul√§ssig  Die Kesselkontakte m√ºssen durch einen Trockenkontakt geschaltet werden - im Allgemeinen kenne ich die Spannung und den Gleich- oder Wechselstrom an den Kontakten nicht. </li></ul><br><h2>  Operationssystem </h2><br>  Das Betriebssystem ist die gesamte Software, die die Funktionsf√§higkeit des Anwendungsprogramms sicherstellt.  Das Betriebssystem ist auch eine Schicht zwischen der Hardware und dem Anwendungsprogramm und bietet eine √ºbergeordnete Schnittstelle f√ºr den Zugriff auf Hardwareressourcen.  Im Fall von ESP k√∂nnen die Komponenten des Betriebssystems ber√ºcksichtigt werden: <br><br><h3>  Dateisystem </h3><br>  Das Projekt verwendet SPIFFS, hier scheint alles klar zu sein, dies ist der einfachste Weg.  F√ºr den einfachen Zugriff auf Dateien auf dem Ger√§t von au√üen verwende ich die Bibliothek pipebuster / esp8266FTPServer. <br><br><h3>  CPU-Zeitzuweisungssystem </h3><br>  Dies ist eine der Hauptfunktionen des Betriebssystems, und ESP ist keine Ausnahme.  F√ºr die parallele Ausf√ºhrung verschiedener Abl√§ufe des Algorithmus sind die Global Object (Singleton) Timer verantwortlich.  Die Klasse ist recht einfach und bietet die folgenden Funktionen: <br><br><ul><li>  Periodische Ausf√ºhrung der Funktion mit einem festgelegten Intervall.  Beispiel f√ºr eine Timer-Initialisierung: <br><br><pre><code class="cpp hljs">Timers.add(doLoop, <span class="hljs-number"><span class="hljs-number">6000</span></span>, F(<span class="hljs-string"><span class="hljs-string">"OneWireSensorsClass::doLoop"</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//   ‚Äì  </span></span></code> </pre> </li><li>  Eine einzelne Ausf√ºhrung einer Funktion nach einem bestimmten Zeitraum.  Beispielsweise wird ein verz√∂gerter Scan von WiFi-Netzwerken folgenderma√üen durchgef√ºhrt: <br><br><pre> <code class="cpp hljs">Timers.once([]() { WiFi.scanNetworks(<span class="hljs-literal"><span class="hljs-literal">true</span></span>);}, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> </li></ul><br>  Die Schleifenfunktion sieht also folgenderma√üen aus: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ ESP.wdtFeed(); Timers.doLoop(); CPULoadInfo.doLoop(); }</code> </pre><br>  In der Praxis enth√§lt die Schleifenfunktion einige weitere Zeilen, die nachfolgend beschrieben werden. <br>  Eine Liste der Timer-Klasse ist beigef√ºgt. <br><br><h3>  CPU-Zeitabrechnung </h3><br>  Servicefunktion, die keine praktische Anwendung hat.  Trotzdem ist sie.  Implementiert vom Singleton CPULoadInfo.  Wenn das Objekt initialisiert wird, wird die Anzahl der Iterationen der leeren Schleife f√ºr einen kurzen Zeitraum gemessen: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CPULoadInfoClass::init() { <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> currTime = millis(); <span class="hljs-comment"><span class="hljs-comment">//      1 while ((millis() - currTime) &lt; 10) { delay(0); MaxLoopsInSecond++; } MaxLoopsInSecond *= 100; }</span></span></code> </pre> <br>  Dann z√§hlen wir die Anzahl der Schleifenprozeduraufrufe pro Sekunde, berechnen die Prozessorlast in Prozent und speichern die Daten im Puffer: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CPULoadInfoClass::doLoop() { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> prevTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> currTime = millis(); LoopsInSecond++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((currTime - prevTime) &gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>) { memmove(CPULoadPercentHistory, &amp;CPULoadPercentHistory[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(CPULoadPercentHistory) - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int8_t</span></span> load = ((MaxLoopsInSecond - LoopsInSecond) * <span class="hljs-number"><span class="hljs-number">100</span></span>) / MaxLoopsInSecond; CPULoadPercentHistory[<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(CPULoadPercentHistory) - <span class="hljs-number"><span class="hljs-number">1</span></span>] = load; prevTime = currTime; LoopsInSecond = <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br>  Wenn Sie diesen Ansatz verwenden, k√∂nnen Sie f√ºr jeden einzelnen Thread die gleiche Prozessorauslastung erzielen (wenn Sie dieses Subsystem mit der Timers-Klasse verbinden), aber wie gesagt - ich sehe keine praktische Anwendung daf√ºr. <br><br><h3>  Eingabe-Ausgabe-System </h3><br>  F√ºr die Kommunikation mit dem Benutzer werden die UART-USB- und die WEB-Schnittstelle verwendet.  Ich denke an UART, ich muss nicht im Detail sprechen.  Das einzige, worauf Sie achten sollten, ist die Bequemlichkeit und Kompatibilit√§t mit Nicht-ESP. Die Funktion serialEvent () ist implementiert: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶ if (Serial.available()) serialEvent(); // ‚Ä¶ }</span></span></code> </pre><br>  Mit der WEB-Oberfl√§che ist alles viel interessanter.  Wir widmen ihm einen eigenen Abschnitt. <br><br><h3>  WEB-Schnittstelle </h3><br>  Bei intelligenten Ger√§ten ist die WEB-Oberfl√§che meiner Meinung nach die benutzerfreundlichste L√∂sung. <br><br>  Ich halte die Verwendung eines an das Ger√§t angeschlossenen Bildschirms f√ºr eine veraltete Praxis - es ist unm√∂glich, eine einfache, bequeme und sch√∂ne Benutzeroberfl√§che zu erstellen, wenn ein kleiner Bildschirm und eine begrenzte Anzahl von Tasten verwendet werden. <br><br>  Die Verwendung spezifischer Programme zur Steuerung des Ger√§ts f√ºhrt zu Einschr√§nkungen f√ºr den Benutzer, erh√∂ht die Notwendigkeit, diese Programme zu entwickeln und zu unterst√ºtzen, und der Entwickler muss sich auch um die Bereitstellung dieser Programme f√ºr die Endger√§te des Benutzers k√ºmmern.  In guter Weise sollte die Anwendung in den Anwendungsspeichern von Google, Apple und Windows ver√∂ffentlicht und auch in Linux-Repositorys in Form von Deb- und RPM-Paketen verf√ºgbar sein. Andernfalls kann der Zugriff auf die Benutzeroberfl√§che des Ger√§ts f√ºr einen Teil der Zielgruppe schwierig sein. <br><br>  Der Zugriff auf die WEB-Oberfl√§che des Ger√§ts ist von jedem Betriebssystem aus m√∂glich - Linux, Windows, Android, MacOS, auf dem Desktop, Laptop, Tablet, Smartphone -, nur um einen Browser zu haben.  Nat√ºrlich muss der Entwickler der WEB-Schnittstelle die Funktionen verschiedener Ger√§te ber√ºcksichtigen, dies betrifft jedoch haupts√§chlich die Gr√∂√üe und Aufl√∂sung.  Der Zugriff auf die WEB-Schnittstelle eines Smart-Ger√§ts in einem Haus / Apartment / Cottage erfolgt problemlos von au√üen √ºber das Internet. Jetzt ist es schwer vorstellbar, dass es in einem Haus / einer Wohnung Smart-Ger√§te und keinen Router und kein Internet gibt. Im Router wird dieser Zugriff mit wenigen Klicks konfiguriert (f√ºr diejenigen, die dies tun) Die Schl√ºsselw√∂rter, die v√∂llig vom Thema abweichen, helfen ("Portweiterleitung" und "dynamisches DNS").  Im Falle einer Sommerresidenz kann der Zugang √ºber einen 3G-Router erfolgen. <br><br>  Zur Implementierung der WEB-Schnittstelle ist ein WEB-Server erforderlich.  Ich verwende die Bibliothek me-no-dev / ESPAsyncWebServer.  Diese Bibliothek bietet die folgenden Funktionen: <br><br><ul><li>  R√ºckgabe von statischem Inhalt, einschlie√ülich  mit gzip Komprimierungsunterst√ºtzung.  Es werden virtuelle Verzeichnisse unterst√ºtzt, mit der M√∂glichkeit, f√ºr jedes Verzeichnis eine Hauptdatei (normalerweise index.htm) anzugeben. </li><li>  Zuweisen von R√ºckruffunktionen zu verschiedenen URLs basierend auf der Art der Anforderung (GET, POST, ...) </li><li>  Unterst√ºtzung f√ºr WEB-Sockets am selben Port (wichtig bei der Portweiterleitung). </li><li>  BASIC-Autorisierung.  Dar√ºber hinaus wird die Autorisierung f√ºr jede URL individuell festgelegt.  Das ist wichtig, weil  Beispielsweise fordert Google Chrome beim Erstellen einer Seitenverkn√ºpfung auf dem Hauptbildschirm ein Symbol und eine Manifestdatei an und √ºbertr√§gt keine Autorisierungsdaten.  Daher werden einige Dateien in einem virtuellen Verzeichnis abgelegt und die Autorisierung f√ºr dieses Verzeichnis ist deaktiviert. </li></ul><br><h3>  Betriebssystem f√ºr HTTP-Dienste </h3><br>  Im aktuellen Projekt werden alle Betriebssystemeinstellungen √ºber HTTP-Dienste durchgef√ºhrt.  Der HTTP-Dienst ist eine kleine unabh√§ngige Funktion zum Abrufen / √Ñndern von Daten, die √ºber HTTP verf√ºgbar ist.  Betrachten Sie als N√§chstes eine Liste dieser Dienste. <br><br><h4>  Hilfe </h4><br>  Die Implementierung einer beliebigen Befehlsliste halte ich f√ºr richtig, um mit der Implementierung des HELP-Teams zu beginnen.  Unten ist der WEB-Server-Initialisierungsblock: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> HTTPserverClass::init() { <span class="hljs-comment"><span class="hljs-comment">//SERVER INIT help_info.concat(F("/'doc_hame.ext': load file from server. Allow methods: HTTP_GET\n")); AsyncStaticWebHandler&amp; handler = server.serveStatic("na/", SPIFFS, "na/"); serveStaticHandlerNA = &amp;handler; //       server.serveStatic("/", SPIFFS, "/"); //    //info //       help_info.concat(F("/info: get system info. Allow methods: HTTP_GET\n")); server.on("/info", HTTP_GET, handleInfo); ‚Ä¶ server.on("/help", HTTP_GET, [](AsyncWebServerRequest *request) { request-&gt;send(200, ContentTypesStrings[ContentTypes::text_plain], help_info.c_str()); }); //    setAuthentication(ConfigStore.getAdminName(), ConfigStore.getAdminPassword()); DefaultHeaders::Instance().addHeader("Access-Control-Allow-Origin", "*"); //  -  //   server.begin(); //       DEBUG_PRINT(F("HTTP server started")); }</span></span></code> </pre><br>  Warum brauche ich ein Hilfesystem? Ich denke, es lohnt sich nicht, es zu erz√§hlen.  Einige Entwickler verschieben die Implementierung des Hilfesystems auf sp√§ter, aber dieses "sp√§tere" tritt normalerweise nicht auf.  Es ist viel einfacher, es zu Beginn des Projekts umzusetzen und w√§hrend der Entwicklung des Projekts zu erg√§nzen. <br>  In meinem Projekt wird auch eine Liste m√∂glicher Dienste mit einem 404-Fehler angezeigt - die Seite wurde nicht gefunden.  Derzeit implementiert die folgenden Dienste: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://tc-demo.vehs.ru/help</a> <br><br><pre> <code class="hljs sql">/'doc_hame.ext': <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> server. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET /info: <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">system</span></span> info. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET /<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> (eg: <span class="hljs-number"><span class="hljs-number">20140527</span></span>T123456). <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET /uptime: <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> uptime <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> (eg: <span class="hljs-number"><span class="hljs-number">123</span></span>D123456). <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET /rtc: <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> RTC time. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET, HTTP_POST /<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> ? [dir=...] &amp; [<span class="hljs-keyword"><span class="hljs-keyword">format</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">json</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> json. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET /edit: edit files. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET, HTTP_PUT, HTTP_DELETE, HTTP_POST /wifi: edit wifi settings. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET, HTTP_POST /wifi-<span class="hljs-keyword"><span class="hljs-keyword">scan</span></span> ? [<span class="hljs-keyword"><span class="hljs-keyword">format</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">json</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> wifi <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> json. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET /wifi-info ? [<span class="hljs-keyword"><span class="hljs-keyword">format</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">json</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> wifi info <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> json. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET /ap: edit soft ap settings. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET, HTTP_POST /<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>: edit <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> settings. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET, HTTP_POST /<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-info ? [<span class="hljs-keyword"><span class="hljs-keyword">format</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">json</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> info <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> json. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET /<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> flash. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET, HTTP_POST /restart: restart system. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET, HTTP_POST /ws: web socket url. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET /<span class="hljs-keyword"><span class="hljs-keyword">help</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> <span class="hljs-keyword"><span class="hljs-keyword">allow</span></span> URLs. <span class="hljs-keyword"><span class="hljs-keyword">Allow</span></span> methods: HTTP_GET</code> </pre><br>  Wie Sie sehen k√∂nnen, gibt es in der Liste der Dienste keine Anwendungsdienste.  Alle HTTP-Dienste beziehen sich auf das Betriebssystem.  Jeder Dienst f√ºhrt eine kleine Aufgabe aus.  Wenn der Dienst die Eingabe von Daten erfordert, gibt GET auf Anfrage ein minimalistisches Eingabeformular zur√ºck: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> USE_RTC_CLOCK help_info.concat(F(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/rtc: set RTC time. Allow methods: HTTP_GET, HTTP_POST\n"</span></span></span><span class="hljs-meta">)); const char* urlNTP = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/rtc"</span></span></span><span class="hljs-meta">; server.on(urlNTP, HTTP_GET, [](AsyncWebServerRequest *request) { DEBUG_PRINT(F(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/rtc"</span></span></span><span class="hljs-meta">)); request-&gt;send(200, ContentTypesStrings[ContentTypes::text_html], String(F(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&lt;head&gt;&lt;title&gt;RTC time&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;form method=\"post\" action=\"rtc\"&gt;&lt;input name=\"newtime\" length=\"15\" placeholder=\"yyyyMMddThhmmss\"&gt;&lt;button type=\"submit\"&gt;set&lt;/button&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;"</span></span></span><span class="hljs-meta">))); }); server.on(urlNTP, HTTP_POST, handleSetRTC_time); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// USE_RTC_CLOCK</span></span></span></span></code> </pre><br><img src="https://habrastorage.org/webt/cr/-6/na/cr-6napgtebfgiquecvuezhxqia.png"><br><br>  Sp√§ter wird dieser Dienst in einer sch√∂neren Oberfl√§che verwendet: <br><br><img src="https://habrastorage.org/webt/tt/mn/-o/ttmn-oyhy9v3lygwrk0jk2wzp2o.png"><br><br><h2>  Anwendungssoftware </h2><br>  Schlie√ülich kamen wir zu dem Punkt, f√ºr den das System erstellt wurde.  N√§mlich - zur Umsetzung der angewandten Aufgabe. <br><br>  Jede Anwendung muss die Quelldaten empfangen, verarbeiten und das Ergebnis erstellen.  Es ist auch m√∂glich, dass das System den aktuellen Status meldet. <br><br>  Die Quelldaten f√ºr den Fu√übodenheizungsregler sind: <br><br><ul><li>  Sensordaten - Das System ist nicht an bestimmte Sensoren gebunden.  F√ºr jeden Sensor wird eine eindeutige Kennung generiert.  Bei Funksensoren wird ihre Kennung mit Nullen bis 16 Bit aufgef√ºllt, bei 1Wire-Sensoren wird CRC16 basierend auf ihrer internen Kennung berechnet und als Sensorkennung verwendet.  Somit haben alle Sensoren Kennungen mit einer L√§nge von 2 Bytes. </li><li>  Daten zu Heizzonen - Die Anzahl der Zonen ist nicht festgelegt, die maximale Anzahl wird durch das verwendete Relaismodul begrenzt.  Angesichts dieser Einschr√§nkung wurde auch die WEB-Schnittstelle entwickelt. </li><li>  Zieltemperatur und Zeitplan - Ich habe versucht, die flexibelsten Einstellungen vorzunehmen. Sie k√∂nnen mehrere Heizschemata erstellen und jeder Zone sogar ein eigenes Einstellungsschema zuweisen. </li></ul><br>  Daher gibt es eine Reihe von Einstellungen, die irgendwie vorgenommen werden m√ºssen, und es gibt eine Reihe von Parametern, die das System als aktuellen Status meldet. <br>  F√ºr die Kommunikation zwischen der Steuerung und der Au√üenwelt habe ich einen Befehlsinterpreter implementiert, mit dem ich sowohl die Steuerung der Steuerung als auch den Empfang von Statusdaten implementieren konnte.  Befehle werden in lesbarer Form an die Steuerung √ºbertragen und k√∂nnen √ºber einen UART- oder WEB-Socket √ºbertragen werden (wenn Sie m√∂chten, k√∂nnen Sie die Unterst√ºtzung f√ºr andere Protokolle implementieren, z. B. Telnet). <br>  Die Befehlszeile beginnt mit dem Zeichen '#' und endet mit einem Nullzeichen oder einem Zeilenumbruchzeichen.  Alle Befehle bestehen aus einem Befehlsnamen und einem Operanden, die durch einen Doppelpunkt getrennt sind.  Bei einigen Befehlen ist der Operand optional. In diesem Fall werden Doppelpunkt und Operand nicht angegeben.  Befehle in einer Zeile werden durch ein Komma getrennt.  Zum Beispiel: <br><br><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#ZonesInfo</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">SensorsInfo</span></span></code> </pre> <br>  Und nat√ºrlich beginnt die Liste der Befehle mit dem Befehl Hilfe, der eine Liste aller g√ºltigen Befehle anzeigt (der Einfachheit halber beginnen die √ºbertragenen Befehle mit einem '&gt;' anstelle von '#'): <br><br><pre> <code class="hljs dos">&gt;<span class="hljs-built_in"><span class="hljs-built_in">help</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Help</span></span> SetZonesCount Zone SetName SetSensor ... LoadCfg SaveCfg #<span class="hljs-built_in"><span class="hljs-built_in">Cmd</span></span>:<span class="hljs-built_in"><span class="hljs-built_in">Help</span></span>,CmdRes:Ok</code> </pre> <br>  Ein Merkmal der Implementierung des Befehlsinterpreters besteht darin, dass Informationen √ºber das Ergebnis der Befehlsausf√ºhrung auch in Form eines Befehls oder einer Reihe von Befehlen ausgegeben werden: <br><br><pre> <code class="hljs css">&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">help</span></span> ‚Ä¶ <span class="hljs-selector-id"><span class="hljs-selector-id">#Cmd</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Help</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">CmdRes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ok</span></span> &gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">zone</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:123</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#Cmd</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Zone</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">Value</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:123</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">CmdRes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Error</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">Error</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Zone</span></span> 123 <span class="hljs-selector-tag"><span class="hljs-selector-tag">not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">range</span></span> 1<span class="hljs-selector-tag"><span class="hljs-selector-tag">-5</span></span> &gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">SchemasInfo</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#SchemasCount</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#Schema</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">Name</span></span>:,<span class="hljs-selector-tag"><span class="hljs-selector-tag">DOWs</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0b0000000</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#Schema</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">Name</span></span>:,<span class="hljs-selector-tag"><span class="hljs-selector-tag">DOWs</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0b0000000</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#Cmd</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SchemasInfo</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">CmdRes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ok</span></span></code> </pre><br>  Auf der WEB-Client-Seite ist auch eine Shell implementiert, die diese Befehle akzeptiert und in eine grafische Ansicht konvertiert.  Zum Beispiel: <br><br><pre> <code class="hljs css">&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">zonesInfo</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#Zone</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">Name</span></span>:,<span class="hljs-selector-tag"><span class="hljs-selector-tag">Sensor</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0x5680</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">Schema</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">DeltaT</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:-20</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#Cmd</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:ZonesInfo</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">CmdRes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ok</span></span></code> </pre> <br>  Die WEB-Schnittstelle schickte eine Anfrage an die Steuerung bez√ºglich der Zonennummer 3 und erhielt als Antwort den Namen der Zone, die Kennung des der Zone zugeordneten Sensors, die Kennung des der Zone zugewiesenen Stromkreises und die Temperaturkorrektur f√ºr die Zone.  Die Schale versteht keine Bruchzahlen, so dass die Temperatur in Zehntelgraden √ºbertragen wird, d.h.  12,3 Grad sind 123 Zehntel. <br><br>  Das Hauptmerkmal ist, dass der Controller unabh√§ngig von der Methode zur Eingabe des Befehls auf alle Clients gleichzeitig auf einen Befehl reagiert.  Auf diese Weise k√∂nnen Sie die Status√§nderung sofort in allen Sitzungen der WEB-Schnittstelle anzeigen.  Weil  Der Hauptaustauschtransport zwischen der Steuerung und der WEB-Schnittstelle sind WEB-Sockets. Die Steuerung kann dann Daten ohne Anforderung √ºbertragen, z. B. wenn neue Daten von Sensoren stammen: <br><br><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#sensor</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0x5A20</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">type</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:w433th</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">battery</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">button_tx</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">channel</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">temperature</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:228</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">humidity</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:34</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">uptime_label</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:130308243</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">time_label</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20180521T235126</span></span></code> </pre> <br>  Oder zum Beispiel, dass diese Zonen aktualisiert werden m√ºssen: <br><br><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#Zone</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">TargetTemp</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:220</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">CurrentTemp</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:228</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">Error</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ok</span></span></code> </pre><br>  Die WEB-Schnittstelle des Controllers basiert auf der Verwendung von Textbefehlen.  Auf einer der Registerkarten der Benutzeroberfl√§che befindet sich ein Terminal, mit dem Sie Befehle in Textform eingeben k√∂nnen.  Auf dieser Registerkarte k√∂nnen Sie zu Debugging-Zwecken herausfinden, welche Befehle die WEB-Schnittstelle mit verschiedenen Benutzeraktionen sendet und empf√§ngt. <br><br>  Der Befehlsinterpreter erleichtert das √Ñndern und Erweitern der Funktionalit√§t des Ger√§ts, indem vorhandene Befehle ge√§ndert und neue hinzugef√ºgt werden.  Gleichzeitig ist das Debuggen eines solchen Systems viel einfacher.  Die Kommunikation mit dem Controller erfolgt ausschlie√ülich in einer f√ºr Menschen lesbaren Sprache. <br><br><h2>  Fazit </h2><br>  Mit einem √§hnlichen Ansatz, n√§mlich: <br><br><ul><li>  Trennung von Software in Betriebssystem und Anwendungsprogramm </li><li>  Implementieren von Betriebssystemeinstellungen in Form minimalistischer HTTP-Dienste </li><li>  Systemlogik von Datenpr√§sentation trennen </li><li>  Verwenden von lesbaren Kommunikationsprotokollen </li></ul><br>  erm√∂glicht es Ihnen, L√∂sungen zu erstellen, die sowohl f√ºr Benutzer als auch f√ºr Entwickler verst√§ndlich sind.  Solche L√∂sungen sind leicht zu modifizieren.  Basierend auf solchen L√∂sungen ist es einfach, neue Ger√§te mit einer v√∂llig anderen Logik zu bauen, die jedoch nach denselben Prinzipien arbeiten.  Sie k√∂nnen eine Reihe von Ger√§ten mit demselben Schnittstellentyp erstellen: <br><br><img src="https://habrastorage.org/webt/5b/mg/mh/5bmgmh1jpuzsrdjpreb6jw_yopy.png"><br><br>  Wie Sie sehen k√∂nnen, beziehen sich in diesem Projekt nur die ersten drei Seiten der Benutzeroberfl√§che direkt auf die Anwendung, und der Rest ist nahezu universell. <br><br>  In dieser Ver√∂ffentlichung beschreibe ich nur meine Meinung zum Aufbau intelligenter Ger√§te und behaupte auf keinen Fall, die ultimative Wahrheit zu sein. <br><br>  F√ºr wen dieses Thema interessant ist - schreiben Sie, vielleicht irre ich mich in etwas, aber vielleicht sind einige Details sinnvoll, um sie genauer zu beschreiben. <br><br>  Was am Ende passiert ist: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fiasko.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Geschichte eines hausgemachten IoT</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de412889/">https://habr.com/ru/post/de412889/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de412877/index.html">Ruthenium (Ru) - das vierte Element mit ferromagnetischen Eigenschaften bei Raumtemperatur</a></li>
<li><a href="../de412879/index.html">Problem Nr. 24: IT-Schulung - aktuelle Probleme und Herausforderungen f√ºhrender Unternehmen</a></li>
<li><a href="../de412881/index.html">Bj√∂rn Straustrup: Problem mit der Programmierung</a></li>
<li><a href="../de412885/index.html">Pathologische Wissenschaft</a></li>
<li><a href="../de412887/index.html">Juni IT Events Digest</a></li>
<li><a href="../de412891/index.html">Citrix XenServer 7.0 E / A nicht optimiert Management Agent nicht installiert</a></li>
<li><a href="../de412893/index.html">In vier Jahren einen erfahrenen Programmierer erreichen: die "School 21" -Methode</a></li>
<li><a href="../de412895/index.html">Vesta Matveeva: Der Kampf gegen Cyberkriminalit√§t ist eine moralische Entscheidung</a></li>
<li><a href="../de412897/index.html">√úberwachung von Atlassian-Produkten mit Prometheus</a></li>
<li><a href="../de412899/index.html">Wochenendlesung: 30 Materialien zu Ton, der Geschichte der Audiomarken und der Filmindustrie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>