<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•â üçØ üìå Modification du module barri√®re GSM Doorhan pour le contr√¥le Internet üë©üèæ‚Äçü§ù‚Äçüë®üèº ü§úüèª üîû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, il a √©t√© d√©cid√© d'installer une barri√®re avec contr√¥le via GSM dans un immeuble d'habitation. Les raisons et la n√©cessit√© de cette solution...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Modification du module barri√®re GSM Doorhan pour le contr√¥le Internet</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415805/"><img src="https://habrastorage.org/webt/zr/za/t9/zrzat9esz7qihwci7atehv_qxeu.png"><br><br>  R√©cemment, il a √©t√© d√©cid√© d'installer une barri√®re avec contr√¥le via GSM dans un immeuble d'habitation.  Les raisons et la n√©cessit√© de cette solution d√©passent le cadre de l'article, mais je veux √©crire comment, "√† genoux", j'ai cr√©√© une interface pour contr√¥ler le module via Internet.  Et m√™me un peu avec le blackjack, la gestion de la base des voitures √† partir d'un t√©l√©phone mobile et des photos des moments d'entr√©e depuis une cam√©ra de rue.  Peut-√™tre que quelqu'un veut le pr√©senter √† la maison. <br><br>  Je vous pr√©viens que l'article ne d√©crit pas une solution pr√™te √† l'emploi, mais plut√¥t une preuve de concept. <br><a name="habracut"></a><br><h3>  Partie 1. Pourquoi un tel contr√¥leur </h3><br>  Avant d'installer le module GSM, une √©tude de march√© de ces syst√®mes a √©t√© r√©alis√©e.  Je voulais obtenir une solution peu co√ªteuse, fiable et √©prouv√©e.  Eh bien, pour que les ¬´installateurs¬ª aient les installateurs, ils avaient une certaine exp√©rience de travail avec, etc. <br><br>  Les installateurs au choix ont propos√© soit ESIM 110/120 pour ~ 12000r avec acc√®s Internet, soit Doorhan GSM pour ~ 6000r avec contr√¥le SMS ou configuration via un c√¢ble USB. <br><br>  L'option de "fabriquer votre appareil √† partir du module arduino + gsm pour 3 $" n'a pas √©t√© envisag√©e, la solution doit donc √™tre exactement fiable et test√©e.  Imaginez que quelqu'un ne puisse pas appeler √† la maison?  Ensuite, vous aurez tous les probl√®mes. <br><br>  Je ne voulais pas non plus de loterie avec l'achat d'un appareil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en Chine sur Ali</a> , l√† encore pour √©viter les probl√®mes de fiabilit√©.  Bien que les prix commencent √† 1500r. <br><br>  L'inconv√©nient d'ESIM120, en plus du co√ªt de x2, √©tait que l'Internet GPRS √©tait utilis√© pour acc√©der √† Internet.  Pour certains, cela peut √™tre un plus, mais dans notre cas, cela entra√Æne le co√ªt des communications mobiles - vous devrez prendre un tarif avec Internet.  Maintenant, un tarif sans frais mensuels est connect√© √† la carte SIM, et pour √©viter que le num√©ro ne soit bloqu√©, je pr√©vois de connecter une sorte d'abonnement payant depuis l'espace personnel de l'op√©rateur tous les 2-3 mois pour 2-3 roubles par jour, pendant une journ√©e.  Par exemple, "m√©t√©o", "blagues" ou quoi d'autre est-il utile pour la barri√®re) <br><br>  Concernant Doorhan GSM, je savais qu'en plus de g√©rer via SMS (pas tr√®s int√©ressant), il se connecte via USB √† un ordinateur et gr√¢ce √† son propre logiciel vous permet de g√©rer la base des nombres. <br><br><h3>  Partie 2. Contr√¥le de retransmission </h3><br>  Comme il √©tait pr√©vu d'installer l'unit√© de contr√¥le des barri√®res √† 20 m√®tres de la pi√®ce o√π se trouvent l'enregistreur vid√©o IP domestique et le centre de communication du fournisseur Internet local, il a √©t√© d√©cid√© de prendre Doorhan et de ¬´construire¬ª USB via un routeur tel que TP-Link MR3020 d'une valeur de 1200 roubles, OpenWRT et des programmes du projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">USBIP</a> <br><br>  Il s'est av√©r√© √™tre encore plus simple avec le routeur - j'ai trouv√© l'ancien ASUS WL500gP dans les bacs, ce qui n'est pas tr√®s adapt√© √† Internet selon les normes d'aujourd'hui, mais il dispose de 2 ports USB.  Il l'a utilis√©. <br><br>  Pour l'usbip, j'ai d√ª installer l'ancienne version d'OpenWRT, le 12 septembre, car ce module du noyau ne fonctionne pas sur les nouveaux.  Je ne d√©crirai pas la connexion du routeur au r√©seau.  Si quelqu'un ne l'a pas sur le r√©seau local, il existe des options avec la redirection de port, UPNP ou la configuration d'un VPN √† votre go√ªt. <br><br>  Installez kmod-usbip-server et v√©rifiez que vous pouvez exporter depuis nous <br><br><pre><code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># opkg install kmod-usbip-server root@OpenWrt:~# usbip list -l Local USB devices ================= - busid 1-1 (0424:2502) 1-1:1.0 -&gt; hub - busid 1-1.1 (1a86:7523) 1-1.1:1.0 -&gt; ch341</span></span></code> </pre> <br>  Nous avons besoin d'un appareil occup√©, 1-1.1 sur lequel se trouve notre contr√¥leur GSM connect√©.  Pour l'avenir, il s'est av√©r√© qu'il s'agit d'un banal convertisseur COM-&gt; USB sur une puce CH341 <br><br>  Nous r√©alisons: <br><br><pre> <code class="hljs ruby">root@OpenWrt<span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment">#usbipd -D root</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@OpenWrt</span></span></span><span class="hljs-comment">:~#usbip bind -b 1-1.1 bind device on busid 1-1.1: complete</span></span></code> </pre><br>  et en dmesg <br><br><pre> <code class="bash hljs"> usbip-host 1-1.1:1.0: usbip-host: register new device (bus 1 dev 57 ifn 0)</code> </pre><br>  Sur un ordinateur avec Windows, installez les pilotes USBIP et ex√©cutez <br><br><pre> <code class="dos hljs">usbip -a <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">16</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  o√π 10.16.19.19 Adresse IP de notre routeur avec OpenWRT.  Bien s√ªr, vous devez d'abord ouvrir l'acc√®s depuis votre IP au routeur dans le pare-feu, ou vous connecter depuis le r√©seau local, ou l'une des 1000 autres options du VPN au P2P. <br><br>  Si tout s'est bien pass√©, Windows d√©clare avec joie qu'un nouveau p√©riph√©rique USB-to-Serial Converter CH340 a √©t√© d√©tect√©, nous lui donnons un pilote et un port COM appara√Æt dans le syst√®me. <br><br>  Maintenant, nous pouvons ex√©cuter le programme √† partir du kit avec le contr√¥leur et g√©rer les num√©ros dans la base de donn√©es tout en √©tant assis √† la maison sur le canap√© <br><br><img src="https://habrastorage.org/webt/4r/ag/oc/4ragoc7u7b1rgfyvjwuxod9fgdu.png"><br><br><h3>  Partie 3. Contr√¥le d'entr√©e </h3><br>  Apr√®s avoir configur√© le travail avec le contr√¥leur sur mon ordinateur personnel et enregistr√© les num√©ros d'utilisateurs, j'ai d√©cid√© de creuser un peu plus avec ce qui est disponible sur le port COM. <br><br>  Il s'av√®re que le module GSM du contr√¥leur envoie p√©riodiquement des commandes AT avec le niveau du signal √† la console, et √©crit √©galement le num√©ro de t√©l√©phone √† partir duquel l'appel est re√ßu lors de l'appel.  Il n'a pas fonctionn√© pour g√©rer le module AT, apparemment ils ne sont pas diffus√©s du module contr√¥leur au module modem. <br><br><img src="https://habrastorage.org/webt/sk/e0/zx/ske0zxaobnmlpfryp5t1k8ldfgs.png"><br><br>  C'est assez int√©ressant de toute fa√ßon.  En √©laborant l'id√©e avec le contr√¥leur GSM, j'esp√©rais que ces appels seraient enregistr√©s dans les d√©tails de l'op√©rateur.  Mais comme aucune connexion ne se produit, il n'y a aucun enregistrement dans l'analyse descendante.  Maintenant, vous pouvez directement √† partir du contr√¥leur pour collecter les journaux de celui qui a ouvert la barri√®re.  Ou qui a essay√© de faire √ßa. <br><br>  Pour ce faire, installez kmod-usb-serial-ch341 sur OpenWRT, d√©sactivez la traduction USBIP avec la commande usbip unbind -b 1-1.1 et ex√©cutez insmod ch341. <br><br>  Apr√®s cela, directement sur le routeur, vous pouvez vous connecter √† / dev / ttyUSB0 et regarder ce qui se passe avec les appels dans le contr√¥leur. <br><br>  Pour traiter les donn√©es, pour commencer, j'ai √©crit un script simple qui utilisait curl pour envoyer des donn√©es sur un appel entrant √† un serveur externe avec PHP pour le traitement et l'enregistrement dans la base de donn√©es.  Vous pouvez √©crire dans le fichier local avec le m√™me succ√®s, bien que la m√©moire du routeur ne soit pas √©paisse. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/ttyUSB0 | while read DATA; do if echo $DATA | grep -q CLIP ; then curl --silent --output /dev/null --data "data=$DATA" http://1.2.3.4:8081/border.php fi done</span></span></code> </pre><br>  Sur le serveur, j'ai cr√©√© une base de donn√©es dans mysql et quelques plaques: avec les num√©ros de t√©l√©phone de nos r√©sidents, et avec le journal des appels.  Il est devenu possible de comparer qui a ouvert la barri√®re √† quelle heure et s'ils essaient de l'utiliser √† partir de chiffres inconnus. <br><br>  La deuxi√®me id√©e qui m'est venue √† l'esprit √©tait de faire le lien entre l'√©v√©nement d'ouverture de la barri√®re et une photo de cet √©v√©nement.  La chose est, comme je l'ai mentionn√© ci-dessus, autour de la maison sont des cam√©ras AHD qui √©crivent sur l'enregistreur avec acc√®s au flux sur IP.  De plus, l'une des cam√©ras a √©t√© sp√©cialement tourn√©e vers la barri√®re, en pr√©vision de sa rupture. <br><br>  Je n'ai pas pu trouver comment supprimer jpeg de notre bureau d'enregistrement chinois, bien que dans de nombreuses cam√©ras il y ait une URL de pr√©visualisation.  Par cons√©quent, je suis all√© de l'avant - au moment de l'appel, je re√ßois RTSP et en fais JPG. <br><br><pre> <code class="bash hljs">ffmpeg -i <span class="hljs-string"><span class="hljs-string">"rtsp://2.3.4.5:554/user=user&amp;password=password&amp;channel=1&amp;stream=0.sdp?"</span></span> -y -f image2 -t 0.001 -ss 00:00:3 -s 1280*720 /tmp/screenshot.jpg</code> </pre> <br>  Avec le m√™me succ√®s, il a √©t√© possible d'√©crire de petits clips en mp4, mais j'ai trouv√© cela superflu. <br>  Photos a d√©cid√© de stocker des objets blob dans MySQL.  La solution de performance est moyenne, mais "faire glisser" le projet sera plus facile, vous n'avez pas besoin de copier la base de donn√©es et les fichiers, tout est dans la base de donn√©es.  Et la charge sur lui est essentiellement nulle. <br><br>  Par cons√©quent, le journal d'entr√©e ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/xg/53/g5/xg53g5nxegvogrwkccgei-5khwm.jpeg"><br><br><h3>  Partie 4. Chargement des num√©ros de la base de donn√©es SQL sur le site vers le contr√¥leur </h3><br>  Si vous lisez attentivement, vous avez probablement remarqu√© que pour enregistrer les entr√©es, le port USB du routeur fonctionnait en mode convertisseur s√©rie-USB et pour travailler avec la base de donn√©es de num√©ros √† l'int√©rieur du contr√¥leur, je devais le ¬´pousser¬ª via USBIP vers mon ordinateur personnel et l'ajouter via le programme Windows changements.  Ce n'est pas tr√®s pratique, vous avez d√ª faire une dissociation / liaison et m√™me ex√©cuter la console usbip sur votre ordinateur personnel.  Eh bien, vous ne pouvez le faire qu'√† la maison (enfin, encore une fois, RDP / VPN, etc.), et surtout pas √† partir d'un t√©l√©phone mobile.  Il a √©t√© doublement chauff√© que la base de donn√©es des nombres devait √™tre maintenue √† la fois au format mdb (le programme du contr√¥leur peut t√©l√©charger des donn√©es dans Access) et dans la version Web. <br><br>  Une recherche fluide du protocole GSM Doorhan n'a pas fonctionn√©.  Cependant, je n'exclus pas qu'il s'agisse d'une sorte d'appareil chinois sous la marque Doorhan.  Par cons√©quent, il s'est arm√© d'un moniteur (renifleur) pour le port COM et a effectu√© plusieurs vidages lors du travail √† partir de l'application d'origine. <br><br><img src="https://habrastorage.org/webt/ni/3u/u-/ni3uu-5expfpjazyacjotzm7r1q.png"><br><br>  Vous avez quelque chose comme: <br>  Commande d' <code>aa 02 09 00 00 03 e8 01 00 00 00 00 ee</code> m√©moire <code>aa 02 09 00 00 03 e8 01 00 00 00 00 ee</code> <br>  La r√©ponse est que tout s'est bien pass√© <code>aa 20 00 ee</code> <br>  √âquipe pour enregistrer un num√©ro +79999999999 <br> <code>aa 03 10 00 01 2b 37 39 39 39 39 39 39 39 39 39 39 00 00 ee</code> <br> <br>  D'o√π il a tir√© les conclusions suivantes: <br>  d√©but d'envoi AA, fin d'envoi EE <br>  La r√©ponse est que l'√©quipe est accept√©e 20 00 <br>  La commande pour commencer √† enregistrer le num√©ro 03. Vient ensuite le nombre de num√©ros dans le package.  Cela peut aller de 1 √† 5, c'est-√†-dire que pour un colis, vous pouvez envoyer plusieurs num√©ros √† la fois, en terminant le colis avec la commande EE, et obtenir une confirmation par bloc. <br><br>  Apr√®s la commande de d√©marrage de l'enregistrement, il y a 2 octets (le second est exact, le premier sera probablement utilis√© lorsque le nombre de nombres est sup√©rieur √† 256 mais n'a pas √©t√© v√©rifi√©), indiquant le num√©ro de s√©rie de l'enregistrement dans la cellule.  Autrement dit, si vous √©crivez dans une m√©moire vide, il s'agit d'abord de 1, puis de 2, etc.  Vient ensuite 14 octets du num√©ro de t√©l√©phone.  Puisque nos nombres sont ¬´inclus¬ª dans 12 octets (+79999999999), les 2 derniers octets sont occup√©s par des z√©ros.  Probablement pour toutes sortes de formats internationaux comme +10.  Ce n'est pas exact, je n'ai pas approfondi, car ces donn√©es √©taient suffisantes. <br><br>  L'envoi par octet EE se termine. <br><br>  Avec le num√©ro de s√©rie de la cellule, la situation n'est pas enti√®rement claire.  Disons que 10 nombres sont √©crits sur le contr√¥leur, la m√©moire n'a pas √©t√© effac√©e.  Si vous envoyez la commande "√©crivez le nombre dans la cellule 5", le nombre dans cette cellule apr√®s la soustraction de contr√¥le ne changera pas, mais le contr√¥leur enregistrera 11 nombres et le 11 sera vide.  Et si vous donnez la commande "√©crivez le nombre dans la cellule 11", alors il y sera √©crit.  Cela est probablement d√ª aux commandes ADD et REPLACE (ajouter et modifier), qui peuvent √™tre envoy√©es par SMS.  Mais puisque la demande originale ne fait que l'effacement complet et la r√©√©criture ult√©rieure de la liste, l'hypoth√®se ne peut pas √™tre v√©rifi√©e.  Par cons√©quent, il a √©galement fait sa version en envoyant une commande d'effacement et d'√©criture s√©quentielle √† un num√©ro (pour plus de simplicit√©). <br><br>  Nous sommes donc venus pour √©crire des commandes pour g√©rer la liste des abonn√©s au contr√¥leur via le port s√©rie.  Mais le port est dans le routeur et la base de donn√©es avec les utilisateurs sur un serveur externe.  Bien s√ªr, vous pouvez le transf√©rer sur un routeur (vous obtenez une solution compl√®te "pr√™te √† l'emploi"), mais j'√©tais trop paresseux.  Je suis all√© dans l'autre sens - j'ai jet√© / dev / ttyUSB0 sur tcp en utilisant le paquet ser2net, qui est dans le paquet openwrt. <br><br>  La configuration /etc/ser2net.conf est simple pour ind√©cent <br><br><pre> <code class="hljs ruby"><span class="hljs-number"><span class="hljs-number">3333</span></span><span class="hljs-symbol"><span class="hljs-symbol">:raw</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/dev/ttyUSB0</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">9600</span></span>,remctl</code> </pre> <br>  Apr√®s avoir d√©marr√© ser2net, vous pouvez vous connecter au routeur telnet sur le port 3333 et v√©rifier le r√©sultat. <br><br>  Je veux faire une r√©servation: apr√®s le red√©marrage du routeur, cat / dev / ttyUSB0 n'a pas fonctionn√© soudainement.  C'est, bien s√ªr, cela a fonctionn√©, mais j'ai √©crit des ordures sur la console.  Je me suis souvenu que lors des exp√©riences sur le routeur, j'ai ex√©cut√© minicom, qui a probablement fait l'initialisation du port.  Le simple fait de r√©gler le mode 9600 8n1 n'a pas fonctionn√©, j'ai donc regard√© avec stty les param√®tres de port qui √©taient √† l'√©tat "de travail" et entr√© l'initialisation dans rc.local <br><br><pre> <code class="hljs powershell">stty <span class="hljs-operator"><span class="hljs-operator">-F</span></span> /dev/ttyUSB0 <span class="hljs-number"><span class="hljs-number">9600</span></span> ignbrk <span class="hljs-literal"><span class="hljs-literal">-brkint</span></span> <span class="hljs-literal"><span class="hljs-literal">-icrnl</span></span> <span class="hljs-literal"><span class="hljs-literal">-imaxbel</span></span> <span class="hljs-literal"><span class="hljs-literal">-opost</span></span> <span class="hljs-literal"><span class="hljs-literal">-onlcr</span></span> <span class="hljs-literal"><span class="hljs-literal">-isig</span></span> <span class="hljs-literal"><span class="hljs-literal">-icanon</span></span> <span class="hljs-literal"><span class="hljs-literal">-iexten</span></span> <span class="hljs-literal"><span class="hljs-literal">-echo</span></span> <span class="hljs-literal"><span class="hljs-literal">-echoe</span></span> <span class="hljs-literal"><span class="hljs-literal">-echok</span></span> <span class="hljs-literal"><span class="hljs-literal">-echoctl</span></span> <span class="hljs-literal"><span class="hljs-literal">-echoke</span></span></code> </pre> <br>  S√ªrement quelque chose de superflu, les lecteurs le corrigeront peut-√™tre.  Eh bien, si vous sp√©cifiez les param√®tres de port dans ser2net.conf, vous ne pouvez pas mettre le paquet stty sur le routeur. <br><br>  √Ä la suite de ces manipulations sur le serveur avec l'interface WEB, la console du contr√¥leur est devenue disponible pour nous.  Par cons√©quent, nous r√©√©crirons l√©g√®rement le code de traitement des appels.  J'ai √©crit en PHP.  C'est dommage de montrer tout le code (je ne suis pas programmeur au final, j'ai utilis√© les insertions du tutoriel), donc le point est: <br><br><pre> <code class="php hljs"> $re = <span class="hljs-string"><span class="hljs-string">'/CLIP: ".(7\d{10})"/m'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    while (1) { $f=@fsockopen('tcp://10.16.19.19',3333, $errno, $errstr); //   while ($f &amp;&amp; $str=fread($f, 100)) { $test=preg_match($re, $str, $matches); if ($test) process_call($matches[1]); // ,       //           ,  ,   $f sync_phones($f); } if ($f) fclose($f); //-    sleep(5); // 5     }</span></span></code> </pre><br>  Je pense que tout le monde met en ≈ìuvre le processus_call comme il le souhaite, de l'√©criture d'informations dans un fichier journal, √† la cr√©ation d'une entr√©e photo / vid√©o et √† son envoi via un robot Telegram vers le t√©l√©phone de son conjoint, ainsi qu'une √©quipe vers une cafeti√®re ou pour r√©chauffer un bortsch. <br><br>  Je m'attarderai plus en d√©tail sur sync_phones, car il impl√©mente l'algorithme tr√®s ¬´non public¬ª du contr√¥leur GSM Doorhan.  Et oui, petit visage, j'ai utilis√© mysql au lieu de pdo ou mysqli. <br><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sync_phones</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($f)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*   config   update.   -  val=1,        .     ,       mysql,     */</span></span> $result=mysql_query(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM config WHERE name='update' AND val=1"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mysql_num_rows($result)==<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; $init = pack(<span class="hljs-string"><span class="hljs-string">'H*'</span></span>,<span class="hljs-string"><span class="hljs-string">'aa1100ee'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//-        $clear = pack('H*','aa0209000003e80100000000ee'); //    (   -) $logfile=fopen("/tmp/border.log","a"); fwrite($logfile,"Update started at ".date('Ymd H:i:s')."\n"); fwrite($f,$init); sleep(1); $ans=fread($f, 40); fwrite($logfile,"Send init. Answer ".bin2hex ( $ans )."\n"); fwrite($f,$clear); sleep(1); $ans=fread($f, 40); fwrite($logfile,"Send clear. Answer ".bin2hex ( $ans )."\n"); $result=mysql_query("SELECT * FROM phones ORDER BY pid"); //  , select     ,      $n=1; while($row=mysql_fetch_array($result)) { $start = 'aa0310'; $pos = sprintf("%04x",$n); $phone = bin2hex('+'.$row['phone']).'0000'; $end = 'ee'; // "" $send=$start.$pos.$phone.$end; $bin=pack('H*',$send); fwrite($f,$bin); $ans=fread($f, 40); fwrite($logfile,"Write {$n} phone {$row['phone']}. Answer ".bin2hex ( $ans )."\n"); $n++; } fwrite($logfile,"End update\n"); fclose($logfile); //   "" ,   ,  .   ,     mysql_query("UPDATE config SET val=0,result='".bin2hex ( $ans )."',updated=NOW() WHERE name='update'"); } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><h3>  Partie 5. Conclusion </h3><br>  En cons√©quence, j'ai re√ßu (√©crit) une interface WEB pour la barri√®re, o√π je peux passer par un navigateur mobile, ajouter / supprimer / modifier les num√©ros des r√©sidents de notre maison, prendre des notes, en r√©f√©rence √† l'appartement, nom, num√©ro de t√©l√©phone, num√©ro de voiture.  Il y a des photos d'une voiture, un journal des entr√©es √† travers la barri√®re avec une photo.  √Ä l'avenir, selon les journaux, je verrai qui cr√©e la plus grande charge sur la barri√®re - il paiera la r√©paration :) <br><br>  Eh bien, le bonus √©tait un point WIFI dans le parking pr√®s de la maison. <br><br>  Le prix d'√©mission est de 0 roubles et le jour de cong√© √† l'ordinateur. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr415805/">https://habr.com/ru/post/fr415805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr415791/index.html">Optimisation des contrats intelligents. Comment les types de solidit√© affectent les co√ªts de transaction</a></li>
<li><a href="../fr415793/index.html">Guide complet de r√©approvisionnement de domaine</a></li>
<li><a href="../fr415795/index.html">√âcrire une interface utilisateur Snapchat sur Swift</a></li>
<li><a href="../fr415797/index.html">Expressions r√©guli√®res + programmation logique. Quel est le r√©sultat?</a></li>
<li><a href="../fr415801/index.html">Google: notre IA "t√©l√©phone" n'est pas assez bonne pour √™tre dangereuse</a></li>
<li><a href="../fr415809/index.html">Comment utiliser le soja, requirejs, backbone js dans les plugins pour Atlassian Jira</a></li>
<li><a href="../fr415811/index.html">AI, cours pratique. Vue d'ensemble des r√©seaux de neurones pour la classification d'images</a></li>
<li><a href="../fr415813/index.html">Quelques notes sur l'√©tat actuel du Cloud Gaming</a></li>
<li><a href="../fr415815/index.html">√Ä la pointe de la science: une analyse des articles arxiv.org</a></li>
<li><a href="../fr415817/index.html">Nous overclockons la sauvegarde. Conf√©rence Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>