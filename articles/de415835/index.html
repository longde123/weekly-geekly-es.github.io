<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÇ üâë üë° Wir schreiben GUI an 1C RAC oder wieder √ºber Tcl / Tk ü¶ä üò† ü§æüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Als ich mich mit dem Thema der Arbeit mit 1C-Produkten unter Linux befasste, entdeckte ich einen Nachteil - das Fehlen eines praktischen grafischen Mu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir schreiben GUI an 1C RAC oder wieder √ºber Tcl / Tk</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415835/">  Als ich mich mit dem Thema der Arbeit mit 1C-Produkten unter Linux befasste, entdeckte ich einen Nachteil - das Fehlen eines praktischen grafischen Multi-Plattform-Tools zum Verwalten eines Clusters von 1C-Servern.  Und es wurde beschlossen, dieses Manko zu beheben, indem eine GUI f√ºr das Konsolendienstprogramm rac geschrieben wurde.  Die Entwicklungssprache wurde meiner Meinung nach als die f√ºr diese Aufgabe am besten geeignete gew√§hlt.  Und jetzt m√∂chte ich einige interessante Aspekte der L√∂sung in diesem Material vorstellen. <br><a name="habracut"></a><br>  F√ºr die Arbeit ben√∂tigen Sie tcl / tk- und 1C-Verteilungen.  Und da ich mich entschlossen habe, die Funktionen der grundlegenden tcl / tk-Bereitstellung optimal zu nutzen, ohne Pakete von Drittanbietern zu verwenden, ben√∂tige ich Version 8.6.7, die ttk enth√§lt - ein Paket mit zus√§tzlichen grafischen Elementen, von denen wir haupts√§chlich ttk :: TreeView ben√∂tigen Daten sowohl in Form einer Baumstruktur als auch in Form einer Tabelle (Liste) anzeigen.  Au√üerdem wurde in der neuen Version die Arbeit mit Ausnahmen wiederholt (der Befehl try, der im Projekt verwendet wird, wenn externe Befehle ausgef√ºhrt werden). <br><br>  Ein Projekt besteht aus mehreren Dateien (obwohl nichts verhindert, dass alles von einer erledigt wird): <br><br>  rac_gui.cfg - Standardkonfiguration <br>  rac_gui.tcl - Hauptstart-Skript <br>  Das lib-Verzeichnis enth√§lt Dateien, die beim Start automatisch geladen werden: <br>  function.tcl - Datei mit Prozeduren <br>  gui.tcl - Haupt-GUI <br>  images.tcl - Bildbibliothek in base64 <br><br>  Die Datei rac_gui.tcl startet tats√§chlich den Interpreter, initialisiert die Variablen, l√§dt die Module, Konfigurationen usw.  Der Inhalt der Datei mit Kommentaren: <br><br><div class="spoiler">  <b class="spoiler_title">rac_gui.tcl</b> <div class="spoiler_text"><pre><code class="hljs mel">#!/bin/sh <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span> wish <span class="hljs-string"><span class="hljs-string">"$0"</span></span> -- <span class="hljs-string"><span class="hljs-string">"$@"</span></span> #    set dir(root) [<span class="hljs-keyword"><span class="hljs-keyword">pwd</span></span>] #   ,      set dir(work) [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $env(HOME) .rac_gui] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> $dir(work)] == <span class="hljs-number"><span class="hljs-number">0</span></span> } { <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> mkdir $dir(work) } #    set dir(lib) <span class="hljs-string"><span class="hljs-string">"[file join $dir(root) lib]"</span></span> #   ,   ,    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) rac_gui.cfg]] ==<span class="hljs-number"><span class="hljs-number">0</span></span>} { <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> copy [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join [<span class="hljs-keyword"><span class="hljs-keyword">pwd</span></span>] rac_gui.cfg] [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) rac_gui.cfg] } <span class="hljs-keyword"><span class="hljs-keyword">source</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) rac_gui.cfg] #    rac       #             #         <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> $rac_cmd] == <span class="hljs-number"><span class="hljs-number">0</span></span>} { set rac_cmd [tk_getOpenFile -initialdir $env(HOME) -<span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> . -title <span class="hljs-string"><span class="hljs-string">"   rac"</span></span> -initialfile rac] <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> copy [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) rac_gui.cfg] [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) rac_gui.cfg.bak] set orig_file [open [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) rac_gui.cfg.bak] <span class="hljs-string"><span class="hljs-string">"r"</span></span>] set <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> [open [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) rac_gui.cfg] <span class="hljs-string"><span class="hljs-string">"w"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> {[gets $orig_file line] &gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> } { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-string"><span class="hljs-string">"set rac_cmd*"</span></span> $line]} { puts $file <span class="hljs-string"><span class="hljs-string">"set rac_cmd $rac_cmd"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { puts $file $line } } close $file close $orig_file #<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"$host:$port"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) <span class="hljs-number"><span class="hljs-number">1</span></span>c_srv.cfg.bak] } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { puts <span class="hljs-string"><span class="hljs-string">"Found $rac_cmd"</span></span> } set cluster_user <span class="hljs-string"><span class="hljs-string">""</span></span> set cluster_pwd <span class="hljs-string"><span class="hljs-string">""</span></span> set agent_user <span class="hljs-string"><span class="hljs-string">""</span></span> set agent_pwd <span class="hljs-string"><span class="hljs-string">""</span></span> ## LOAD FILE ## #    gui.tcl       foreach modFile [lsort [glob -nocomplain [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(lib) *.tcl]]] { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> tail $modFile] ne <span class="hljs-string"><span class="hljs-string">"gui.tcl"</span></span>} { <span class="hljs-keyword"><span class="hljs-keyword">source</span></span> $modFile puts <span class="hljs-string"><span class="hljs-string">"Loaded module $modFile"</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">source</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(lib) gui.tcl] <span class="hljs-keyword"><span class="hljs-keyword">source</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) rac_gui.cfg] #      <span class="hljs-number"><span class="hljs-number">1</span></span> #     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) <span class="hljs-number"><span class="hljs-number">1</span></span>c_srv.cfg]] { set f [open [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $dir(work) <span class="hljs-number"><span class="hljs-number">1</span></span>c_srv.cfg] <span class="hljs-string"><span class="hljs-string">"RDONLY"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> {[gets $f line] &gt;=<span class="hljs-number"><span class="hljs-number">0</span></span>} { .frm_tree.tree insert {} end -id <span class="hljs-string"><span class="hljs-string">"server::$line"</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">"$line"</span></span> -values <span class="hljs-string"><span class="hljs-string">"$line"</span></span> } }</code> </pre> <br></div></div><br>  Nachdem Sie alles Notwendige heruntergeladen und die Verf√ºgbarkeit des Dienstprogramms rac √ºberpr√ºft haben, wird ein grafisches Fenster ge√∂ffnet.  Die Programmoberfl√§che besteht aus drei Elementen: <br><br>  Symbolleiste, Baum und Liste <br><br>  Ich habe den Inhalt des "Baums" so √§hnlich wie m√∂glich zu einem Standard-Windows-Snap von 1C gemacht. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/6f4/b8c/d33/6f4b8cd334ab0d6d74650a41a073d599.png" alt="Bild"></a> <br><br>  Der Hauptcode, der dieses Fenster bildet, ist in der Datei enthalten <br><div class="spoiler">  <b class="spoiler_title">lib / gui.tcl</b> <div class="spoiler_text"><pre> <code class="hljs mel">#       #     topLevelGeometry    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[info <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> topLevelGeometry]} { wm geometry . $topLevelGeometry } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { wm geometry . <span class="hljs-number"><span class="hljs-number">1024</span></span>x768 } #   wm title . <span class="hljs-string"><span class="hljs-string">"1C Rac GUI"</span></span> wm iconname . <span class="hljs-string"><span class="hljs-string">"1C Rac Gui"</span></span> #   (   lib/imges.tcl) wm iconphoto . tcl wm protocol . WM_DELETE_WINDOW Quit wm overrideredirect . <span class="hljs-number"><span class="hljs-number">0</span></span> wm positionfrom . user ttk::style theme use clam #   set frm_tool [frame .frm_tool] pack $frm_tool -side left -fill y ttk::panedwindow .<span class="hljs-keyword"><span class="hljs-keyword">panel</span></span> -orient horizontal -style TPanedwindow pack .<span class="hljs-keyword"><span class="hljs-keyword">panel</span></span> -expand true -fill both pack propagate .<span class="hljs-keyword"><span class="hljs-keyword">panel</span></span> false ttk::<span class="hljs-keyword"><span class="hljs-keyword">button</span></span> $frm_tool.btn_add -command Add -<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> add_grey_32 ttk::<span class="hljs-keyword"><span class="hljs-keyword">button</span></span> $frm_tool.btn_del -command Del -<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> del_grey_32 ttk::<span class="hljs-keyword"><span class="hljs-keyword">button</span></span> $frm_tool.btn_edit -command Edit -<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> edit_grey_32 ttk::<span class="hljs-keyword"><span class="hljs-keyword">button</span></span> $frm_tool.btn_quit -command Quit -<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> quit_grey_32 pack $frm_tool.btn_add $frm_tool.btn_del $frm_tool.btn_edit -side top -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> pack $frm_tool.btn_quit -side bottom -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> #     set frm_tree [frame .frm_tree] ttk::scrollbar $frm_tree.hsb1 -orient horizontal -command [list $frm_tree.tree xview] ttk::scrollbar $frm_tree.vsb1 -orient vertical -command [list $frm_tree.tree yview] set tree [ttk::treeview $frm_tree.tree -show tree \ -xscrollcommand [list $frm_tree.hsb1 set] -yscrollcommand [list $frm_tree.vsb1 set]] <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $tree -row <span class="hljs-number"><span class="hljs-number">0</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nsew <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm_tree.vsb1 -row <span class="hljs-number"><span class="hljs-number">0</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm_tree.hsb1 -row <span class="hljs-number"><span class="hljs-number">1</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nsew <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> columnconfigure $frm_tree <span class="hljs-number"><span class="hljs-number">0</span></span> -weight <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> rowconfigure $frm_tree <span class="hljs-number"><span class="hljs-number">0</span></span> -weight <span class="hljs-number"><span class="hljs-number">1</span></span> #      bind $frm_tree.tree &lt;ButtonRelease&gt; <span class="hljs-string"><span class="hljs-string">"TreePress $frm_tree.tree"</span></span> #    () set frm_work [frame .frm_work] ttk::scrollbar $frm_work.hsb -orient horizontal -command [list $frm_work.tree_work xview] ttk::scrollbar $frm_work.vsb -orient vertical -command [list $frm_work.tree_work yview] set tree_work [ ttk::treeview $frm_work.tree_work \ -show headings -columns <span class="hljs-string"><span class="hljs-string">"par val"</span></span> -displaycolumns <span class="hljs-string"><span class="hljs-string">"par val"</span></span>\ -xscrollcommand [list $frm_work.hsb set] \ -yscrollcommand [list $frm_work.vsb set] ] #       $tree_work tag configure dark -background $color(dark_table_bg) $tree_work tag configure light -background $color(light_table_bg) #     <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $tree_work -row <span class="hljs-number"><span class="hljs-number">0</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nsew <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm_work.vsb -row <span class="hljs-number"><span class="hljs-number">0</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm_work.hsb -row <span class="hljs-number"><span class="hljs-number">1</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nsew <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> columnconfigure $frm_work <span class="hljs-number"><span class="hljs-number">0</span></span> -weight <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> rowconfigure $frm_work <span class="hljs-number"><span class="hljs-number">0</span></span> -weight <span class="hljs-number"><span class="hljs-number">1</span></span> pack $frm_tree $frm_work -side left -expand true -fill both #.<span class="hljs-keyword"><span class="hljs-keyword">panel</span></span> add $frm_tool -weight <span class="hljs-number"><span class="hljs-number">1</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">panel</span></span> add $frm_tree -weight <span class="hljs-number"><span class="hljs-number">1</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">panel</span></span> add $frm_work -weight <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br></div></div><br>  Der Algorithmus f√ºr die Arbeit mit dem Programm lautet wie folgt: <br><br>  1. Zu Beginn m√ºssen Sie den Hauptclusterserver hinzuf√ºgen (dh den Clusterverwaltungsserver (unter Linux wird der Befehl mit dem Befehl "/opt/1C/v8.3/x86_64/ras cluster --daemon" gestartet). <br><br>  Klicken Sie dazu auf die Schaltfl√§che "+" und geben Sie im folgenden Fenster die Serveradresse und den Port ein: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/797/a05/385/797a05385f32c2155465159783107292.png" alt="Bild"><br><br>  Danach wird unser Server in der Baumstruktur angezeigt, indem Sie darauf klicken. Eine Liste der Cluster wird ge√∂ffnet oder ein Verbindungsfehler wird angezeigt. <br><br>  2. Durch Klicken auf den Clusternamen wird eine Liste der daf√ºr verf√ºgbaren Funktionen ge√∂ffnet. <br><br>  3. ... <br><br>  Gut und so weiter, d.h.  Um einen neuen Cluster hinzuzuf√ºgen, w√§hlen Sie einen in der Liste verf√ºgbaren aus und klicken Sie auf die Schaltfl√§che + in der Symbolleiste. Der Dialog zum Hinzuf√ºgen eines neuen Clusters wird angezeigt: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/beb/9b9/1a6/beb9b91a676ff556da29256fb37b78b3.png" alt="Bild"></a> <br><br>  Die Schaltfl√§chen in der Symbolleiste f√ºhren Funktionen abh√§ngig vom Kontext aus, d. H.  Aus welchem ‚Äã‚ÄãElement des Baums oder der Liste ausgew√§hlt wird, wird dieses oder jenes Verfahren ausgef√ºhrt. <br><br>  Betrachten Sie die Schaltfl√§che zum Hinzuf√ºgen ("+") als Beispiel: <br><br>  Code zur Generierung von Schaltfl√§chen: <br><br><pre> <code class="hljs mel">ttk::<span class="hljs-keyword"><span class="hljs-keyword">button</span></span> $frm_tool.btn_add -command Add -<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> add_grey_32</code> </pre> <br>  Hier sehen wir, dass beim Dr√ºcken der Schaltfl√§che die Add-Prozedur ausgef√ºhrt wird, deren Code: <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> Add {} { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> active_cluster host #     set id [.frm_tree.tree selection] #     set values [.frm_tree.tree item [.frm_tree.tree selection] -values] set key [lindex [split $id <span class="hljs-string"><span class="hljs-string">"::"</span></span>] <span class="hljs-number"><span class="hljs-number">0</span></span>] #           <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$key eq <span class="hljs-string"><span class="hljs-string">""</span></span> || $key eq <span class="hljs-string"><span class="hljs-string">"server"</span></span>} { set host [ Add::server ] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } Add::$key .frm_tree.tree $host $values }</code> </pre> <br>  Einer der Vorteile des Tickles ist also sichtbar: Sie k√∂nnen den Wert einer Variablen als Namen der Prozedur √ºbergeben: <br><br><pre> <code class="hljs ruby">Add::$key .frm_tree.tree $host $values</code> </pre> <br>  Das hei√üt, wenn wir zum Beispiel auf dem Hauptserver st√∂bern und "+" dr√ºcken, wird die Add :: Server-Prozedur gestartet, wenn der Cluster Add :: Cluster ist und so weiter (ich werde ein wenig dar√ºber schreiben, woher die erforderlichen "Schl√ºssel" kommen unten) zeichnen die aufgelisteten Prozeduren grafische Elemente, die dem Kontext entsprechen. <br><br>  Wie Sie vielleicht bemerkt haben, sind die Formulare im Stil √§hnlich - dies ist nicht √ºberraschend, da sie in einer Prozedur angezeigt werden, genauer gesagt im Hauptrahmen des Formulars (Fenster, Schaltfl√§chen, Bild, Beschriftung), dem Namen der Prozedur <div class="spoiler">  <b class="spoiler_title">AddTopLevel</b> <div class="spoiler_text"><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> AddToplevel {lbl img {win_name .add}} { set cmd <span class="hljs-string"><span class="hljs-string">"destroy $win_name"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [winfo <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> $win_name] {destroy $win_name} toplevel $win_name wm title $win_name $lbl wm iconphoto $win_name tcl #    ttk::label $win_name.lbl -<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> $img #     set frm [ttk::labelframe $win_name.frm -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> $lbl -labelanchor nw] <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> columnconfigure $frm <span class="hljs-number"><span class="hljs-number">0</span></span> -weight <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> rowconfigure $frm <span class="hljs-number"><span class="hljs-number">0</span></span> -weight <span class="hljs-number"><span class="hljs-number">1</span></span> #    set frm_btn [frame $win_name.frm_btn -border <span class="hljs-number"><span class="hljs-number">0</span></span>] ttk::<span class="hljs-keyword"><span class="hljs-keyword">button</span></span> $frm_btn.btn_ok -<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> ok_grey_24 -command { } ttk::<span class="hljs-keyword"><span class="hljs-keyword">button</span></span> $frm_btn.btn_cancel -command $cmd -<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> quit_grey_24 <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $win_name.lbl -row <span class="hljs-number"><span class="hljs-number">0</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm -row <span class="hljs-number"><span class="hljs-number">0</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm_btn -row <span class="hljs-number"><span class="hljs-number">1</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky se -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> pack $frm_btn.btn_cancel -side right pack $frm_btn.btn_ok -side right -padx <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $frm }</code> </pre><br></div></div><br>  Aufrufparameter: Titel, Bildname f√ºr das Symbol aus der Bibliothek (lib / images.tcl) und der optionale Fensternamenparameter (Standard .add).  Wenn wir also die obigen Beispiele verwenden, um den Hauptserver und den Cluster hinzuzuf√ºgen, lautet der Aufruf entsprechend: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">AddToplevel</span></span> <span class="hljs-string"><span class="hljs-string">"  "</span></span> server_grey_64</code> </pre> <br>  oder <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">AddToplevel</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> cluster_grey_64</code> </pre> <br>  Wenn Sie mit diesen Beispielen fortfahren, werde ich die Prozeduren zeigen, mit denen die Hinzuf√ºgen-Dialoge f√ºr den Server oder Cluster angezeigt werden. <br><br><div class="spoiler">  <b class="spoiler_title">Add :: server</b> <div class="spoiler_text"><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> Add::server {} { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> #    set frm [AddToplevel <span class="hljs-string"><span class="hljs-string">"  "</span></span> server_grey_64] #         label $frm.lbl_host -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> entry $frm.ent_host label $frm.lbl_port -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> entry $frm.ent_port $frm.ent_port insert end $default(port) <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_host -row <span class="hljs-number"><span class="hljs-number">0</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_host -row <span class="hljs-number"><span class="hljs-number">0</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_port -row <span class="hljs-number"><span class="hljs-number">1</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_port -row <span class="hljs-number"><span class="hljs-number">1</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> columnconfigure $frm <span class="hljs-number"><span class="hljs-number">0</span></span> -weight <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> rowconfigure $frm <span class="hljs-number"><span class="hljs-number">0</span></span> -weight <span class="hljs-number"><span class="hljs-number">1</span></span> #set frm_btn [frame .add.frm_btn -border <span class="hljs-number"><span class="hljs-number">0</span></span>] #     .add.frm_btn.btn_ok configure -command { set host [SaveMainServer [.add.frm.ent_host get] [.add.frm.ent_port get]] .frm_tree.tree insert {} end -id <span class="hljs-string"><span class="hljs-string">"server::$host"</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">"$host"</span></span> -values <span class="hljs-string"><span class="hljs-string">"$host"</span></span> destroy .add <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $host } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $frm }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Add :: cluster</b> <div class="spoiler_text"><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> Add::<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span> {tree host values} { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> lifetime_limit expiration_timeout session_fault_tolerance_level <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> max_memory_size max_memory_time_limit errors_count_threshold security_level <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> load_balancing_mode kill_problem_processes \ agent_user agent_pwd cluster_user cluster_pwd auth_agent <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$agent_user ne <span class="hljs-string"><span class="hljs-string">""</span></span> &amp;&amp; $agent_pwd ne <span class="hljs-string"><span class="hljs-string">""</span></span>} { set auth_agent <span class="hljs-string"><span class="hljs-string">"--agent-user=$agent_user --agent-pwd=$agent_pwd"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { set auth_agent <span class="hljs-string"><span class="hljs-string">""</span></span> } #    () set lifetime_limit $default(lifetime_limit) set expiration_timeout $default(expiration_timeout) set session_fault_tolerance_level $default(session_fault_tolerance_level) set max_memory_size $default(max_memory_size) set max_memory_time_limit $default(max_memory_time_limit) set errors_count_threshold $default(errors_count_threshold) set security_level [lindex $default(security_level) <span class="hljs-number"><span class="hljs-number">0</span></span>] set load_balancing_mode [lindex $default(load_balancing_mode) <span class="hljs-number"><span class="hljs-number">0</span></span>] set frm [AddToplevel <span class="hljs-string"><span class="hljs-string">" "</span></span> cluster_grey_64] label $frm.lbl_host -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">"  "</span></span> entry $frm.ent_host label $frm.lbl_port -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> entry $frm.ent_port $frm.ent_port insert end $default(port) label $frm.lbl_name -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> entry $frm.ent_name label $frm.lbl_secure_connect -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> ttk::combobox $frm.cb_security_level -textvariable security_level -values $default(security_level) label $frm.lbl_expiration_timeout -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">"   :"</span></span> entry $frm.ent_expiration_timeout -textvariable expiration_timeout label $frm.lbl_session_fault_tolerance_level -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> entry $frm.ent_session_fault_tolerance_level -textvariable session_fault_tolerance_level label $frm.lbl_load_balancing_mode -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">"  "</span></span> ttk::combobox $frm.cb_load_balancing_mode -textvariable load_balancing_mode \ -values $default(load_balancing_mode) label $frm.lbl_errors_count_threshold -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">"    , %"</span></span> entry $frm.ent_errors_count_threshold -textvariable errors_count_threshold label $frm.lbl_processes -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">" :"</span></span> label $frm.lbl_lifetime_limit -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">" , ."</span></span> entry $frm.ent_lifetime_limit -textvariable lifetime_limit label $frm.lbl_max_memory_size -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">"  , "</span></span> entry $frm.ent_max_memory_size -textvariable max_memory_size label $frm.lbl_max_memory_time_limit -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">"    , ."</span></span> entry $frm.ent_max_memory_time_limit -textvariable max_memory_time_limit label $frm.lbl_kill_problem_processes -justify left -anchor nw -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">"   "</span></span> checkbutton $frm.check_kill_problem_processes -variable kill_problem_processes -onvalue yes -offvalue no <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_host -row <span class="hljs-number"><span class="hljs-number">0</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_host -row <span class="hljs-number"><span class="hljs-number">0</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_port -row <span class="hljs-number"><span class="hljs-number">1</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_port -row <span class="hljs-number"><span class="hljs-number">1</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_name -row <span class="hljs-number"><span class="hljs-number">2</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_name -row <span class="hljs-number"><span class="hljs-number">2</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_secure_connect -row <span class="hljs-number"><span class="hljs-number">3</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.cb_security_level -row <span class="hljs-number"><span class="hljs-number">3</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_expiration_timeout -row <span class="hljs-number"><span class="hljs-number">4</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_expiration_timeout -row <span class="hljs-number"><span class="hljs-number">4</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_session_fault_tolerance_level -row <span class="hljs-number"><span class="hljs-number">5</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_session_fault_tolerance_level -row <span class="hljs-number"><span class="hljs-number">5</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_load_balancing_mode -row <span class="hljs-number"><span class="hljs-number">6</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.cb_load_balancing_mode -row <span class="hljs-number"><span class="hljs-number">6</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_errors_count_threshold -row <span class="hljs-number"><span class="hljs-number">7</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_errors_count_threshold -row <span class="hljs-number"><span class="hljs-number">7</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_processes -row <span class="hljs-number"><span class="hljs-number">8</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_lifetime_limit -row <span class="hljs-number"><span class="hljs-number">9</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_lifetime_limit -row <span class="hljs-number"><span class="hljs-number">9</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_max_memory_size -row <span class="hljs-number"><span class="hljs-number">10</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_max_memory_size -row <span class="hljs-number"><span class="hljs-number">10</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_max_memory_time_limit -row <span class="hljs-number"><span class="hljs-number">11</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.ent_max_memory_time_limit -row <span class="hljs-number"><span class="hljs-number">11</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nsew -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.lbl_kill_problem_processes -row <span class="hljs-number"><span class="hljs-number">12</span></span> -column <span class="hljs-number"><span class="hljs-number">0</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">grid</span></span> $frm.check_kill_problem_processes -row <span class="hljs-number"><span class="hljs-number">12</span></span> -column <span class="hljs-number"><span class="hljs-number">1</span></span> -sticky nw -padx <span class="hljs-number"><span class="hljs-number">5</span></span> -pady <span class="hljs-number"><span class="hljs-number">5</span></span> #   .add.frm_btn.btn_ok configure -command { RunCommand <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">"cluster insert \ --host=[.add.frm.ent_host get] \ --port=[.add.frm.ent_port get] \ --name=[.add.frm.ent_name get] \ --expiration-timeout=$expiration_timeout \ --lifetime-limit=$lifetime_limit \ --max-memory-size=$max_memory_size \ --max-memory-time-limit=$max_memory_time_limit \ --security-level=$security_level \ --session-fault-tolerance-level=$session_fault_tolerance_level \ --load-balancing-mode=$load_balancing_mode \ --errors-count-threshold=$errors_count_threshold \ --kill-problem-processes=$kill_problem_processes \ $auth_agent $host"</span></span> Run::server $tree $host <span class="hljs-string"><span class="hljs-string">""</span></span> destroy .add } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $frm }</code> </pre> <br></div></div><br>  Beim Vergleich des Codes dieser Prozeduren ist der Unterschied mit blo√üem Auge sichtbar. Ich werde mich auf den Handler der OK-Schaltfl√§che konzentrieren.  In Tk k√∂nnen die Eigenschaften von Grafikelementen zur Laufzeit mithilfe der Option <i>configure</i> neu definiert werden.  Beispiel: Der Befehl zur Ausgabe der ersten Schaltfl√§che: <br><br><pre> <code class="hljs mel">ttk::<span class="hljs-keyword"><span class="hljs-keyword">button</span></span> $frm_btn.btn_ok -<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> ok_grey_24 -command { }</code> </pre> <br>  In unseren Formularen h√§ngt der Befehl jedoch von der erforderlichen Funktionalit√§t ab: <br><br><pre> <code class="hljs bash"> .add.frm_btn.btn_ok configure -<span class="hljs-built_in"><span class="hljs-built_in">command</span></span> { RunCommand <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">"cluster insert \ --host=[.add.frm.ent_host get] \ --port=[.add.frm.ent_port get] \ --name=[.add.frm.ent_name get] \ --expiration-timeout=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$expiration_timeout</span></span></span><span class="hljs-string"> \ --lifetime-limit=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$lifetime_limit</span></span></span><span class="hljs-string"> \ --max-memory-size=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$max_memory_size</span></span></span><span class="hljs-string"> \ --max-memory-time-limit=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$max_memory_time_limit</span></span></span><span class="hljs-string"> \ --security-level=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$security_level</span></span></span><span class="hljs-string"> \ --session-fault-tolerance-level=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$session_fault_tolerance_level</span></span></span><span class="hljs-string"> \ --load-balancing-mode=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$load_balancing_mode</span></span></span><span class="hljs-string"> \ --errors-count-threshold=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$errors_count_threshold</span></span></span><span class="hljs-string"> \ --kill-problem-processes=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$kill_problem_processes</span></span></span><span class="hljs-string"> \ </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$auth_agent</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$host</span></span></span><span class="hljs-string">"</span></span> Run::server <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> <span class="hljs-variable"><span class="hljs-variable">$host</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> destroy .add }</code> </pre><br>  Im obigen Beispiel startet die Schaltfl√§che "Verstopft" die Prozedur zum Hinzuf√ºgen eines Clusters. <br><br>  Hier lohnt es sich, einen Exkurs zur Arbeit mit grafischen Elementen in Tk zu machen - f√ºr verschiedene Dateneingabeelemente (Eingabe, Combobox, Checkbutton usw.) wurde ein Parameter wie eine Textvariable (Textvariable) eingef√ºhrt: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">entry</span></span> <span class="hljs-variable"><span class="hljs-variable">$frm</span></span>.ent_lifetime_limit -textvariable lifetime_limit</code> </pre> <br>  Diese Variable ist im globalen Namespace definiert und enth√§lt den aktuell eingegebenen Wert.  Das hei√üt,  Um den eingegebenen Text aus dem Feld zu erhalten, m√ºssen Sie nur den Wert lesen, der der Variablen entspricht (vorausgesetzt, er wird beim Erstellen des Elements definiert). <br><br>  Die zweite Methode zum Abrufen des eingegebenen Textes (f√ºr Elemente vom Typ Typ) ist die Verwendung des Befehls get: <br><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.add</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.frm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ent_name</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">get</span></span></code> </pre> <br>  Beide Methoden sind im obigen Code zu sehen. <br><br>  Wenn Sie in diesem Fall auf diese Schaltfl√§che klicken, wird die RunCommand-Prozedur mit der generierten Befehlszeile zum Hinzuf√ºgen eines Clusters in Bezug auf rac gestartet: <br><br><pre> <code class="bash hljs">/opt/1C/v8.3/x86_64/rac cluster insert --host=localhost --port=1540 --name=dsdsds --expiration-timeout=0 --lifetime-limit=0 --max-memory-size=0 --max-memory-time-limit=0 --security-level=0 --session-fault-tolerance-level=0 --load-balancing-mode=performance --errors-count-threshold=0 --<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span>-problem-processes=no localhost:1545</code> </pre> <br>  Also kamen wir zum Hauptbefehl, der den Start von rac mit den ben√∂tigten Parametern steuert, die Ausgabe der Befehle in Listen analysiert und bei Bedarf zur√ºckgibt: <br><br><div class="spoiler">  <b class="spoiler_title">Runcommand</b> <div class="spoiler_text"><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> RunCommand {root par} { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> dir rac_cmd <span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span> work_list_row_count agent_user agent_pwd cluster_user cluster_pwd puts <span class="hljs-string"><span class="hljs-string">"$rac_cmd $par"</span></span> set work_list_row_count <span class="hljs-number"><span class="hljs-number">0</span></span> #      # $rac -     # $par -      set pipe [open <span class="hljs-string"><span class="hljs-string">"|$rac_cmd $par"</span></span> <span class="hljs-string"><span class="hljs-string">"r"</span></span>] try { set lst <span class="hljs-string"><span class="hljs-string">""</span></span> set l <span class="hljs-string"><span class="hljs-string">""</span></span> #       <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> {[gets $pipe line]&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span>} { #puts $line <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$line eq <span class="hljs-string"><span class="hljs-string">""</span></span>} { lappend l $lst set lst <span class="hljs-string"><span class="hljs-string">""</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { lappend lst [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span> $line] } } close $pipe <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $l } on <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> {result options} { #    ErrorParcing $result $options <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> } }</code> </pre> <br></div></div><br>  Nach Eingabe der Daten des Hauptservers werden diese dem Baum hinzugef√ºgt. In der obigen Prozedur Hinzuf√ºgen: Server ist der folgende Code daf√ºr verantwortlich: <br><br><pre> <code class="hljs powershell">.frm_tree.tree insert {} <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"server::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$host</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$host</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$host</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  Wenn Sie nun auf den Servernamen in der Baumstruktur klicken, wird eine Liste der von diesem Server verwalteten Cluster angezeigt. Wenn Sie auf einen Cluster klicken, wird eine Liste der Clusterelemente (Server, Infobasen usw.) angezeigt.  Dies ist in der TreePress-Prozedur (Datei lib / function.tcl) implementiert: <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> TreePress {tree} { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> host server active_cluster infobase #    set id [$tree selection] #     SetGlobalVarFromTreeItems $tree $id #    , ..     set values [$tree item $id -values] set key [lindex [split $id <span class="hljs-string"><span class="hljs-string">"::"</span></span>] <span class="hljs-number"><span class="hljs-number">0</span></span>] #            #    Run Run::$key $tree $host $values }</code> </pre> <br>  Dementsprechend wird Run :: server f√ºr den Hauptserver gestartet (Run :: cluster f√ºr den Cluster, Run :: work_server usw. f√ºr den Produktionsserver).  Das hei√üt,  Der Wert der Variablen $ key ist Teil des <i>Baumelementnamens, der</i> durch die Option <i>-id</i> angegeben wird. <br><br>  Achten Sie auf das Verfahren <br><br><div class="spoiler">  <b class="spoiler_title">F√ºhren Sie :: server aus</b> <div class="spoiler_text"><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> Run::server {tree host values} { #      set lst [RunCommand server::$host <span class="hljs-string"><span class="hljs-string">"cluster list $host"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$lst eq <span class="hljs-string"><span class="hljs-string">""</span></span>} {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>} set l [lindex $lst <span class="hljs-number"><span class="hljs-number">0</span></span>] #puts $lst #     .frm_work.tree_work <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> [ .frm_work.tree_work children {}] #   foreach cluster_list $lst { #     InsertItemsWorkList $cluster_list #   ()      foreach i $cluster_list { #puts $i set cluster_list [split $i <span class="hljs-string"><span class="hljs-string">":"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span> [lindex $cluster_list <span class="hljs-number"><span class="hljs-number">0</span></span>]] eq <span class="hljs-string"><span class="hljs-string">"cluster"</span></span>} { set cluster_id [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span> [lindex $cluster_list <span class="hljs-number"><span class="hljs-number">1</span></span>]] lappend <span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>($cluster_id) $cluster_id } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span> [lindex $cluster_list <span class="hljs-number"><span class="hljs-number">0</span></span>]] eq <span class="hljs-string"><span class="hljs-string">"name"</span></span>} { lappend <span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>($cluster_id) [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span> [lindex $cluster_list <span class="hljs-number"><span class="hljs-number">1</span></span>]] } } } #     foreach x [array names <span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>] { set id [lindex $cluster($x) <span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> { [$tree <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> <span class="hljs-string"><span class="hljs-string">"cluster::$id"</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span> } { $tree insert <span class="hljs-string"><span class="hljs-string">"server::$host"</span></span> end -id <span class="hljs-string"><span class="hljs-string">"cluster::$id"</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">"[lindex $cluster($x) 1]"</span></span> -values <span class="hljs-string"><span class="hljs-string">"$id"</span></span> #     InsertClusterItems $tree $id } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> { [$tree <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> <span class="hljs-string"><span class="hljs-string">"agent_admins::$id"</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span> } { $tree insert <span class="hljs-string"><span class="hljs-string">"server::$host"</span></span> end -id <span class="hljs-string"><span class="hljs-string">"agent_admins::$id"</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> -values <span class="hljs-string"><span class="hljs-string">"$id"</span></span> #InsertClusterItems $tree $id } }</code> </pre> <br></div></div><br>  Diese Prozedur verarbeitet, was vom Server √ºber den Befehl RunCommand empfangen wurde, und f√ºgt dem Baum alle m√∂glichen Dinge hinzu - Cluster, verschiedene Stammelemente (Datenbanken, Produktionsserver, Sitzungen usw.).  Wenn Sie genau hinschauen, k√∂nnen Sie im Inneren den Aufruf der InsertItemsWorkList-Prozedur bemerken.  Es wird verwendet, um der Grafikliste Elemente hinzuzuf√ºgen und die Ausgabe des Konsolendienstprogramms rac zu verarbeiten, das zuvor als Liste an die Variable $ lst zur√ºckgegeben wurde.  Dies ist eine Liste von Listen, die Elementpaare enthalten, die durch einen Doppelpunkt getrennt sind. <br><br>  Zum Beispiel eine Liste von Clusterverbindungen: <br><br><pre> <code class="hljs powershell">svk@svk ~]<span class="hljs-variable"><span class="hljs-variable">$</span></span> /opt/<span class="hljs-number"><span class="hljs-number">1</span></span>C/v8.<span class="hljs-number"><span class="hljs-number">3</span></span>/x86_64/rac connection list -<span class="hljs-literal"><span class="hljs-literal">-cluster</span></span>=<span class="hljs-number"><span class="hljs-number">783</span></span>d2170<span class="hljs-literal"><span class="hljs-literal">-56c3</span></span><span class="hljs-literal"><span class="hljs-literal">-11e8</span></span><span class="hljs-literal"><span class="hljs-literal">-c586</span></span><span class="hljs-literal"><span class="hljs-literal">-fc75165efbb2</span></span> localhost:<span class="hljs-number"><span class="hljs-number">1545</span></span> connection : dcf5991c<span class="hljs-literal"><span class="hljs-literal">-7d24</span></span><span class="hljs-literal"><span class="hljs-literal">-11e8</span></span><span class="hljs-literal"><span class="hljs-literal">-1690</span></span><span class="hljs-literal"><span class="hljs-literal">-fc75165efbb2</span></span> conn<span class="hljs-literal"><span class="hljs-literal">-id</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> host : svk.home <span class="hljs-keyword"><span class="hljs-keyword">process</span></span> : <span class="hljs-number"><span class="hljs-number">79</span></span>de2e16<span class="hljs-literal"><span class="hljs-literal">-56c3</span></span><span class="hljs-literal"><span class="hljs-literal">-11e8</span></span><span class="hljs-literal"><span class="hljs-literal">-c586</span></span><span class="hljs-literal"><span class="hljs-literal">-fc75165efbb2</span></span> infobase : <span class="hljs-number"><span class="hljs-number">00000000</span></span><span class="hljs-literal"><span class="hljs-literal">-0000</span></span><span class="hljs-literal"><span class="hljs-literal">-0000</span></span><span class="hljs-literal"><span class="hljs-literal">-0000</span></span><span class="hljs-literal"><span class="hljs-literal">-000000000000</span></span> application : <span class="hljs-string"><span class="hljs-string">"JobScheduler"</span></span> connected<span class="hljs-literal"><span class="hljs-literal">-at</span></span> : <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-literal"><span class="hljs-literal">-07</span></span><span class="hljs-literal"><span class="hljs-literal">-01T14</span></span>:<span class="hljs-number"><span class="hljs-number">49</span></span>:<span class="hljs-number"><span class="hljs-number">51</span></span> session<span class="hljs-literal"><span class="hljs-literal">-number</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> blocked<span class="hljs-literal"><span class="hljs-literal">-by</span></span><span class="hljs-literal"><span class="hljs-literal">-ls</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> connection : b993293a<span class="hljs-literal"><span class="hljs-literal">-7d24</span></span><span class="hljs-literal"><span class="hljs-literal">-11e8</span></span><span class="hljs-literal"><span class="hljs-literal">-1690</span></span><span class="hljs-literal"><span class="hljs-literal">-fc75165efbb2</span></span> conn<span class="hljs-literal"><span class="hljs-literal">-id</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> host : svk.home <span class="hljs-keyword"><span class="hljs-keyword">process</span></span> : <span class="hljs-number"><span class="hljs-number">79</span></span>de2e16<span class="hljs-literal"><span class="hljs-literal">-56c3</span></span><span class="hljs-literal"><span class="hljs-literal">-11e8</span></span><span class="hljs-literal"><span class="hljs-literal">-c586</span></span><span class="hljs-literal"><span class="hljs-literal">-fc75165efbb2</span></span> infobase : <span class="hljs-number"><span class="hljs-number">00000000</span></span><span class="hljs-literal"><span class="hljs-literal">-0000</span></span><span class="hljs-literal"><span class="hljs-literal">-0000</span></span><span class="hljs-literal"><span class="hljs-literal">-0000</span></span><span class="hljs-literal"><span class="hljs-literal">-000000000000</span></span> application : <span class="hljs-string"><span class="hljs-string">"JobScheduler"</span></span> connected<span class="hljs-literal"><span class="hljs-literal">-at</span></span> : <span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-literal"><span class="hljs-literal">-07</span></span><span class="hljs-literal"><span class="hljs-literal">-01T14</span></span>:<span class="hljs-number"><span class="hljs-number">48</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span> session<span class="hljs-literal"><span class="hljs-literal">-number</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> blocked<span class="hljs-literal"><span class="hljs-literal">-by</span></span><span class="hljs-literal"><span class="hljs-literal">-ls</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  In grafischer Form sieht es ungef√§hr so ‚Äã‚Äãaus: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/664/71d/737/66471d73799b3fa2801e751afe1bf6c2.png" alt="Bild"></a> <br><br>  Das obige Verfahren identifiziert die Namen der Elemente f√ºr den Header und die Daten, die die Tabelle f√ºllen sollen: <br><br><div class="spoiler">  <b class="spoiler_title">InsertItemsWorkList</b> <div class="spoiler_text"><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> InsertItemsWorkList {lst} { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> work_list_row_count #      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [expr $work_list_row_count % <span class="hljs-number"><span class="hljs-number">2</span></span>] { set tag dark } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { set tag light } #      -  foreach i $lst { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [regexp -nocase -all -- {(\D+)(\s*?|)(:)(\s*?|)(.*)} $i <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> param v2 v3 v4 value] { lappend column_list [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span> $param] lappend value_list [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span> $value] } } #   .frm_work.tree_work configure -columns $column_list -displaycolumns $column_list .frm_work.tree_work insert {} end -values $value_list -tags $tag .frm_work.tree_work column #<span class="hljs-number"><span class="hljs-number">0</span></span> -stretch #   foreach j $column_list { .frm_work.tree_work heading $j -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> $j } incr work_list_row_count }</code> </pre> <br></div></div><br>  Hier wird anstelle des einfachen Befehls [split $ str ":"], der die Zeichenfolge in durch ":" getrennte Elemente aufteilt und eine Liste zur√ºckgibt, ein regul√§rer Ausdruck angewendet, da einige Elemente auch einen Doppelpunkt enthalten. <br><br>  Die InsertClusterItems-Prozedur (eine von mehreren √§hnlichen) f√ºgt dem erforderlichen Clusterelement in der Baumstruktur einfach eine Liste untergeordneter Elemente mit den entsprechenden Bezeichnern hinzu <br><div class="spoiler">  <b class="spoiler_title">InsertClusterItems</b> <div class="spoiler_text"><pre> <code class="hljs powershell">proc InsertClusterItems {tree id} { set parent <span class="hljs-string"><span class="hljs-string">"cluster::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"infobases::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"servers::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"admins::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"managers::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-variable"><span class="hljs-variable">$id</span></span> <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"processes::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"workprocess-all"</span></span> <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"sessions::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"sessions-all"</span></span> <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"locks::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"blocks-all"</span></span> <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"connections::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"connections-all"</span></span> <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"profiles::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-variable"><span class="hljs-variable">$id</span></span> }</code> </pre><br></div></div><br>  Sie k√∂nnen zwei weitere Optionen f√ºr die Implementierung eines solchen Verfahrens in Betracht ziehen, bei denen deutlich sichtbar wird, wie Sie doppelte Befehle optimieren und entfernen k√∂nnen: <br><br>  Bei diesem Verfahren werden das Hinzuf√ºgen und √úberpr√ºfen auf der Stirn gel√∂st: <br><br><div class="spoiler">  <b class="spoiler_title">InsertBaseItems</b> <div class="spoiler_text"><pre> <code class="hljs powershell">proc InsertBaseItems {tree id} { set parent <span class="hljs-string"><span class="hljs-string">"infobase::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> { [<span class="hljs-variable"><span class="hljs-variable">$tree</span></span> <span class="hljs-type"><span class="hljs-type">exists</span></span> <span class="hljs-string"><span class="hljs-string">"sessions::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span> } { <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"sessions::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> { [<span class="hljs-variable"><span class="hljs-variable">$tree</span></span> <span class="hljs-type"><span class="hljs-type">exists</span></span> <span class="hljs-string"><span class="hljs-string">"locks::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span> } { <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"locks::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> { [<span class="hljs-variable"><span class="hljs-variable">$tree</span></span> <span class="hljs-type"><span class="hljs-type">exists</span></span> <span class="hljs-string"><span class="hljs-string">"connections::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span> } { <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-string"><span class="hljs-string">"connections::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> } }</code> </pre><br></div></div><br>  Und hier ist der Ansatz korrekter: <br><br><div class="spoiler">  <b class="spoiler_title">InsertProfileItems</b> <div class="spoiler_text"><pre> <code class="hljs powershell">proc InsertProfileItems {tree id} { set parent <span class="hljs-string"><span class="hljs-string">"profile::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> set lst { {dir <span class="hljs-string"><span class="hljs-string">" "</span></span>} {com <span class="hljs-string"><span class="hljs-string">" COM-"</span></span>} {addin <span class="hljs-string"><span class="hljs-string">" "</span></span>} {module <span class="hljs-string"><span class="hljs-string">"   "</span></span>} {app <span class="hljs-string"><span class="hljs-string">" "</span></span>} {inet <span class="hljs-string"><span class="hljs-string">" "</span></span>} } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> i <span class="hljs-variable"><span class="hljs-variable">$lst</span></span> { append item [<span class="hljs-type"><span class="hljs-type">lindex</span></span> <span class="hljs-variable"><span class="hljs-variable">$i</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-string"><span class="hljs-string">"::</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> { [<span class="hljs-variable"><span class="hljs-variable">$tree</span></span> <span class="hljs-type"><span class="hljs-type">exists</span></span> <span class="hljs-variable"><span class="hljs-variable">$item</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span> } { <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> insert <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">-id</span></span> <span class="hljs-variable"><span class="hljs-variable">$item</span></span> <span class="hljs-literal"><span class="hljs-literal">-text</span></span> [<span class="hljs-type"><span class="hljs-type">lindex</span></span> <span class="hljs-variable"><span class="hljs-variable">$i</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-literal"><span class="hljs-literal">-values</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$id</span></span></span><span class="hljs-string">"</span></span> } unset item } }</code> </pre> <br></div></div><br>  Der Unterschied zwischen ihnen besteht in der Verwendung des Zyklus, in dem die wiederholten Befehle ausgef√ºhrt werden.  Welcher Ansatz zu verwenden ist, liegt im Ermessen des Entwicklers. <br><br>  Wir haben dar√ºber nachgedacht, Elemente hinzuzuf√ºgen und Daten zu empfangen. Es ist Zeit, mit der Bearbeitung aufzuh√∂ren.  Da zum Bearbeiten und Hinzuf√ºgen grunds√§tzlich dieselben Parameter verwendet werden (Ausnahme ist die Infobase), sind die Dialogformulare identisch.  Die Prozeduraufrufprozedur zum Hinzuf√ºgen sieht folgenderma√üen aus: <br><br>  <i>Add :: $ key-&gt; AddToplevel</i> <br><br>  Und f√ºr die Bearbeitung wie folgt: <br><br>  <i>Edit :: $ key-&gt; Add :: $ key-&gt; AddTopLevel</i> <br><br>  Nehmen Sie zum Beispiel die Bearbeitung eines Clusters, d. H.  Durch Klicken auf den Clusternamen in der Baumstruktur dr√ºcken Sie die Schaltfl√§che Bearbeiten in der Symbolleiste (Bleistift). Das entsprechende Formular wird angezeigt: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2bc/7c7/42b/2bc7c742bc0d7edfb9286002c6740d38.png" alt="Bild"><br><div class="spoiler">  <b class="spoiler_title">Edit :: cluster</b> <div class="spoiler_text"><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> Edit::<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span> {tree host values} { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> lifetime_limit expiration_timeout session_fault_tolerance_level <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> max_memory_size max_memory_time_limit errors_count_threshold security_level <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> load_balancing_mode kill_problem_processes active_cluster \ agent_user agent_pwd cluster_user cluster_pwd auth <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$cluster_user ne <span class="hljs-string"><span class="hljs-string">""</span></span> &amp;&amp; $cluster_pwd ne <span class="hljs-string"><span class="hljs-string">""</span></span>} { set auth <span class="hljs-string"><span class="hljs-string">"--cluster-user=$cluster_user --cluster-pwd=$cluster_pwd"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { set auth <span class="hljs-string"><span class="hljs-string">""</span></span> } #     set frm [Add::<span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span> $tree $host $values] #     $frm configure -<span class="hljs-keyword"><span class="hljs-keyword">text</span></span> <span class="hljs-string"><span class="hljs-string">" "</span></span> set active_cluster $values #      set lst [RunCommand <span class="hljs-keyword"><span class="hljs-keyword">cluster</span></span>::$values <span class="hljs-string"><span class="hljs-string">"cluster info --cluster=$active_cluster $host"</span></span>] #   FormFieldsDataInsert $frm $lst #  ,    $frm.ent_host configure -state <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span> $frm.ent_port configure -state <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span> #   .add.frm_btn.btn_ok configure -command { RunCommand <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">"cluster update \ --cluster=$active_cluster $auth \ --name=[.add.frm.ent_name get] \ --expiration-timeout=$expiration_timeout \ --lifetime-limit=$lifetime_limit \ --max-memory-size=$max_memory_size \ --max-memory-time-limit=$max_memory_time_limit \ --security-level=$security_level \ --session-fault-tolerance-level=$session_fault_tolerance_level \ --load-balancing-mode=$load_balancing_mode \ --errors-count-threshold=$errors_count_threshold \ --kill-problem-processes=$kill_problem_processes \ $auth $host"</span></span> $tree <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-string"><span class="hljs-string">"cluster::$active_cluster"</span></span> Run::server $tree $host <span class="hljs-string"><span class="hljs-string">""</span></span> destroy .add } }</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gem√§√ü den Kommentaren im Code ist im Prinzip alles klar, au√üer dass der Code des Schaltfl√§chenhandlers neu definiert wird und die Prozedur FormFieldsDataInsert vorhanden ist, die die Felder mit Daten f√ºllt und die Variablen initialisiert: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FormFieldsDataInsert</font></font></b> <div class="spoiler_text"><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> FormFieldsDataInsert {frm lst} { foreach i [lindex $lst <span class="hljs-number"><span class="hljs-number">0</span></span>] { #      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [regexp -nocase -all -- {(\D+)(\s*?|)(:)(\s*?|)(.*)} $i <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> param v2 v3 v4 value] { #   regsub -all -- <span class="hljs-string"><span class="hljs-string">"-"</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span> $param] <span class="hljs-string"><span class="hljs-string">"_"</span></span> entry_name #   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [winfo <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> $frm.ent_$entry_name] { $frm.ent_$entry_name <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> end $frm.ent_$entry_name insert end [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span> $value <span class="hljs-string"><span class="hljs-string">"\""</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [winfo <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> $frm.cb_$entry_name] { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $entry_name set $entry_name [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span> $value <span class="hljs-string"><span class="hljs-string">"\""</span></span>] } #     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [winfo <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> $frm.check_$entry_name] { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $entry_name <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$value eq <span class="hljs-string"><span class="hljs-string">"0"</span></span>} { set $entry_name no } elseif {$value eq <span class="hljs-string"><span class="hljs-string">"1"</span></span>} { set $entry_name yes } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { set $entry_name $value } } } } }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In dieser Prozedur tauchte ein weiteres Plus tcl auf - die Werte anderer Variablen werden als Variablennamen ersetzt. </font></font> Das hei√üt,<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um das Ausf√ºllen von Formularen und das Initialisieren von Variablen zu automatisieren, entsprechen die Namen von Feldern und Variablen mit einigen Ausnahmen den Befehlszeilenschaltern des Dienstprogramms rac und den Namen der Ausgabeparameter von Befehlen. Der Bindestrich wird durch einen Unterstrich ersetzt. Beispielsweise entspricht </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scheduled-Jobs- </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deny</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dem Feld </font><i><font style="vertical-align: inherit;">ent_scheduled_jobs_deny</font></i><font style="vertical-align: inherit;"> und der Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scheduled_jobs_deny</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formen des Hinzuf√ºgens und Bearbeitens k√∂nnen sich in der Zusammensetzung der Felder unterscheiden, z. B. beim Arbeiten mit der Informationsbasis: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hinzuf√ºgen von IB </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/473/f5c/beb/473f5cbeb4815916e0e8988bc97b873f.png" alt="Bild"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bearbeiten von IB </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e9d/3d9/ff5/e9d3d9ff549d90d5bd783bbbe8f25f57.png" alt="Bild"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Bearbeitungsverfahren Edit :: infobase werden die erforderlichen Felder zum Formular hinzugef√ºgt, daher gebe ich hier keinen gro√üen Code an.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analog werden die Verfahren zum Hinzuf√ºgen, Bearbeiten und L√∂schen f√ºr andere Elemente implementiert. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da das Dienstprogramm eine unbegrenzte Anzahl von Servern, Clustern, Infobasen usw. umfasst, um zu bestimmen, zu welchem ‚Äã‚ÄãCluster der Server oder die Informationssicherheit geh√∂rt, wurden mehrere globale Variablen eingef√ºhrt, deren Werte bei jedem Klicken auf die Baumelemente festgelegt werden.</font></font> Das hei√üt,<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Prozedur durchl√§uft rekursiv alle √ºbergeordneten Elemente und legt die Variablen fest: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SetGlobalVarFromTreeItems</font></font></b> <div class="spoiler_text"><pre> <code class="hljs powershell">proc SetGlobalVarFromTreeItems {tree id} { global host server active_cluster infobase set parent [<span class="hljs-variable"><span class="hljs-variable">$tree</span></span> <span class="hljs-type"><span class="hljs-type">parent</span></span> <span class="hljs-variable"><span class="hljs-variable">$id</span></span>] set values [<span class="hljs-variable"><span class="hljs-variable">$tree</span></span> <span class="hljs-type"><span class="hljs-type">item</span></span> <span class="hljs-variable"><span class="hljs-variable">$id</span></span> -<span class="hljs-type"><span class="hljs-type">values</span></span>] set key [<span class="hljs-type"><span class="hljs-type">lindex</span></span> [<span class="hljs-type"><span class="hljs-type">split</span></span> <span class="hljs-variable"><span class="hljs-variable">$id</span></span> <span class="hljs-string"><span class="hljs-string">"::"</span></span>] <span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> -- <span class="hljs-variable"><span class="hljs-variable">$key</span></span> { server {set host <span class="hljs-variable"><span class="hljs-variable">$values</span></span>} work_server {set server <span class="hljs-variable"><span class="hljs-variable">$values</span></span>} cluster {set active_cluster <span class="hljs-variable"><span class="hljs-variable">$values</span></span>} infobase {set infobase <span class="hljs-variable"><span class="hljs-variable">$values</span></span>} } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {<span class="hljs-variable"><span class="hljs-variable">$parent</span></span> eq <span class="hljs-string"><span class="hljs-string">""</span></span>} { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SetGlobalVarFromTreeItems <span class="hljs-variable"><span class="hljs-variable">$tree</span></span> <span class="hljs-variable"><span class="hljs-variable">$parent</span></span> } }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit dem 1C-Cluster k√∂nnen Sie mit oder ohne Berechtigung arbeiten. </font><font style="vertical-align: inherit;">Es gibt zwei Arten von Administratoren: den Cluster-Agentenadministrator und den Cluster-Administrator. </font><font style="vertical-align: inherit;">Dementsprechend wurden f√ºr den korrekten Vorgang 4 weitere globale Variablen eingef√ºhrt, die die Administratoranmeldung und das Kennwort enthalten.</font></font> Das hei√üt,<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn im Cluster ein Administratorkonto vorhanden ist, wird ein Dialogfeld zur Eingabe der Anmeldung und des Kennworts angezeigt. Die Daten werden im Speicher gespeichert und in jeden Befehl f√ºr den entsprechenden Cluster eingef√ºgt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daf√ºr ist das Fehlerbehandlungsverfahren verantwortlich.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ErrorParcing</font></font></b> <div class="spoiler_text"><pre> <code class="hljs vbscript">proc ErrorParcing {<span class="hljs-built_in"><span class="hljs-built_in">err</span></span> opt} { global cluster_user cluster_pwd agent_user agent_pwd switch -<span class="hljs-built_in"><span class="hljs-built_in">regexp</span></span> -- $<span class="hljs-built_in"><span class="hljs-built_in">err</span></span> { <span class="hljs-string"><span class="hljs-string">"Cluster administrator is not authenticated"</span></span> { AuthorisationDialog <span class="hljs-string"><span class="hljs-string">" "</span></span> .auth_win.frm_btn.btn_ok configure -command { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> cluster_user [.auth_win.frm.ent_name <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> cluster_pwd [.auth_win.frm.ent_pwd <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>] destroy .auth_win } #RunCommand $root $par } <span class="hljs-string"><span class="hljs-string">"Central server administrator is not authenticated"</span></span> { AuthorisationDialog <span class="hljs-string"><span class="hljs-string">"  "</span></span> .auth_win.frm_btn.btn_ok configure -command { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> agent_user [.auth_win.frm.ent_name <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> agent_pwd [.auth_win.frm.ent_pwd <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>] destroy .auth_win } } <span class="hljs-string"><span class="hljs-string">"   "</span></span> { AuthorisationDialog <span class="hljs-string"><span class="hljs-string">" "</span></span> .auth_win.frm_btn.btn_ok configure -command { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> cluster_user [.auth_win.frm.ent_name <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> cluster_pwd [.auth_win.frm.ent_pwd <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>] destroy .auth_win } #RunCommand $root $par } <span class="hljs-string"><span class="hljs-string">"    "</span></span> { AuthorisationDialog <span class="hljs-string"><span class="hljs-string">"  "</span></span> .auth_win.frm_btn.btn_ok configure -command { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> agent_user [.auth_win.frm.ent_name <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> agent_pwd [.auth_win.frm.ent_pwd <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>] destroy .auth_win } } (.+) { tk_messageBox -type ok -icon <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> -message <span class="hljs-string"><span class="hljs-string">"$err"</span></span> } } }</code> </pre> <br></div></div><br>  Das hei√üt,<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abh√§ngig davon, was der Befehl zur√ºckgibt, wird entsprechend reagiert. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Derzeit ist die Funktionalit√§t zu 95 Prozent implementiert, die Arbeit mit Sicherheitsprofilen und test =) muss noch implementiert werden. </font><font style="vertical-align: inherit;">Das ist alles </font><font style="vertical-align: inherit;">Ich entschuldige mich f√ºr die zerknitterte Erz√§hlung. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Code ist traditionell </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> verf√ºgbar </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Update: Arbeit mit Sicherheitsprofilen abgeschlossen. </font><font style="vertical-align: inherit;">Jetzt ist die Funktionalit√§t zu 100% implementiert. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Update 2: Lokalisierung in Englisch und Russisch wurde hinzugef√ºgt, Arbeit in Win7 wird √ºberpr√ºft</font></font><br><img src="https://habrastorage.org/getpro/habr/post_images/282/7b1/bdb/2827b1bdb698d0cc7341985b139981a6.png" alt="Bild"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de415835/">https://habr.com/ru/post/de415835/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de415821/index.html">Der Weg, um ein "intelligentes" Haus mit einer m√∂glichst breiten elektrischen Steuerung zu organisieren</a></li>
<li><a href="../de415823/index.html">FindFace schlie√üt f√ºr blo√üe Sterbliche</a></li>
<li><a href="../de415829/index.html">Einf√ºhrung in Datenklassen</a></li>
<li><a href="../de415831/index.html">Die neuen zehn Gebote des Roskosmos</a></li>
<li><a href="../de415833/index.html">Vor- und Nachteile von Xamarin</a></li>
<li><a href="../de415837/index.html">Ein kleiner √úberblick √ºber Solarlaternen</a></li>
<li><a href="../de415839/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 259 (25. Juni - 1. Juli)</a></li>
<li><a href="../de415841/index.html">Wie wir gelernt haben, chinesische Kameras f√ºr 1000r mit der Cloud zu verbinden. Keine Logger und SMS (und Millionen von Dollar gespart)</a></li>
<li><a href="../de415843/index.html">315 Jahre wissenschaftliches Experiment</a></li>
<li><a href="../de415845/index.html">Fragen Sie Ethan: Woher kennen wir das Alter des Sonnensystems?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>