<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌮 👨‍👩‍👦 🔷 DataPower教程 🈸 🌗 👰🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="资料由wedmeed合着 


 2017年，当我们的项目在越南启动时，我们为我们遇到了新的野兽IBM DataPower。 IBM DataPower是客户端和后端之间的网关产品，旨在对通过它的消息（以下称为请求）进行过滤，路由，扩充或其他转换。 必须快速学习，没有时间进行积累，因此我们被要求熟悉...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DataPower教程</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neoflex/blog/442686/"><p> 资料由<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">wedmeed</a>合着 </p><br><p> 2017年，当我们的项目在越南启动时，我们为我们遇到了新的野兽IBM DataPower。  IBM DataPower是客户端和后端之间的网关产品，旨在对通过它的消息（以下称为请求）进行过滤，路由，扩充或其他转换。 必须快速学习，没有时间进行积累，因此我们被要求熟悉它，之后与来自莫斯科的同事进行了许多小时的Skype会议，他将我们在此产品上的知识和经验告诉了我们。 <br></p><br><p> 自学的基础是研究文档并观看来自Internet的培训视频-在这里，我正在等待收获。 我几乎找不到俄语的信息。 顺便说一句，那时我对英语的了解还不是很高，这是我的第一个项目，而且可能这些因素使我的生活变得复杂。 这使我用俄语以最简单的方式写了一篇培训文章，供初学者使用该产品并试图快速了解其基础知识。 本文不会使您从阅读文档中解放出来，但是它将使您在了解“工作原理”的早期阶段变得更加轻松。 <br></p><br><p> 还值得注意的是，实践中给出的结构将接近实际项目，这将使您可以将其用作基础，扩展和补充需求。 总之，将在“理论”部分给出一些有关已经实施的项目的文字，以及一些值得关注的功能。 </p><br><img src="https://habrastorage.org/webt/rm/at/lk/rmatlkcfuvcjxvgireijushp7yc.jpeg"><br><a name="habracut"></a><br><h2> 第1部分。使用Docker工具箱安装DataPower </h2><br><p> 安装并运行Docker Toolbox应用程序。 启动之后，您将立即看到计算机的IP地址，以后可以通过该IP地址使用DataPower： <br></p><br><img src="https://habrastorage.org/webt/zs/qa/wn/zsqawn2jksqp8j8gfl5gwslnks4.png"><br><br><p> 要启动映像，您需要更改虚拟机的某些设置（与版本IDG.2018.4.1.0相关）并重新启动它： <br></p><br><ol><li> 使用以下命令停止docker计算机： <br><br><pre><code class="plaintext hljs">docker-machine stop</code> </pre> </li><li> 系统-&gt;主板-&gt;主内存：最低4096Mb； <br></li><li> 系统-&gt;处理器：至少2； <br></li><li> 显示-&gt;屏幕-&gt;视频内存：至少128Mb； <br></li><li> 我们使用以下命令启动docker计算机： <br><br><pre> <code class="plaintext hljs">docker-machine start</code> </pre> <br>  <i>注意事项</i>  <i>如果提示重启docker-machine env，请运行：</i> <br><br><pre> <code class="plaintext hljs">docker-machine env</code> </pre> </li><li> 接下来，您需要缩小IBM DataPower映像： <br><br><pre> <code class="plaintext hljs">docker pull ibmcom/datapower</code> </pre> </li><li> 然后使用以下命令启动docker容器： <br><br><pre> <code class="plaintext hljs">docker run -it \ -v $PWD/config:/drouter/config \ -v $PWD/local:/drouter/local \ -e DATAPOWER_ACCEPT_LICENSE=true \ -e DATAPOWER_INTERACTIVE=true \ -p 9090:9090 \ -p 3630:3630 \ -p 9022:22 \ -p 7170:7170 \ --name idg \ ibmcom/datapower</code> </pre></li><li> 完成命令后，按Enter键，然后输入<b>admin / admin</b>作为用户名和密码。 <br></li><li> 要启动Web管理界面，请使用以下命令： <br><br><pre> <code class="plaintext hljs">co</code> </pre> <br> 和 <br><br><pre> <code class="plaintext hljs">web-mgmt 0 9090</code> </pre> </li><li> 完成所有这些步骤后，在浏览器中执行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://192.168.99.100:9090/</a> <br></li></ol><br><h2> 第2部分。 </h2><br><h3>  2.1。 理论 </h3><br><p>  DataPower中的域使您可以分离管理和开发工具，并提供安全性。 <br></p><br><p> 安装后，只有一个默认域可以从中创建应用程序域。 每个域都有其自己的参数配置。 <br></p><br><p> 某些公共资源和参数只能在默认域中定义，包括网络接口，用户和访问控制，应用程序域等。 <br></p><br><p> 应用程序域是请求处理服务的开发部分。 其中定义的服务不能与其他应用程序域共享。 可以分别和独立地重新启动应用程序域，而无需完全重新启动DataPower。 <br></p><br><p> 您可以创建，重新启动，重置，暂停，续订或删除域。 您可以在官方文档中找到有关所有管理功能的更多详细信息。 <br></p><br><p> 关于已完成项目的一些信息。 我们使用了3个域： <br></p><br><ul><li>  default-包含共享资源和参数的默认域； </li><li> 主干-主域，包含处理请求所需的一切； </li><li> 设置-设置和安全域，本地文件包含有关服务路由规则和安全设置的信息。 </li></ul><br><p> 为了寻找更简单的部署路径，需要将所有设置转移到单独的域。 与许多项目一样，开发，测试和生产环境是分开的，转移到单独的设置域使我们可以通过导出/导入在其他环境中安装开发环境中的所有主要域，而不会丢失环境设置。 <br></p><br><h3>  2.2。 练习 </h3><br><ul><li> 在搜索字段中，输入“域”，选择“应用程序域”，然后单击“添加” <br><img src="https://habrastorage.org/webt/uo/k_/gs/uok_gsaxjifcklt56rs9wmiujhm.png"></li><li> 在这里，您需要指定域名，注释（如果需要）并激活审核和日志记录。 填写字段并应用更改 <br><img src="https://habrastorage.org/webt/3b/6w/ts/3b6wtsfrlvxcxgb7jgpkmm6u1rq.png"></li><li> 同样，添加另一个域“ trunk” </li><li> 转到查看更改 <br><img src="https://habrastorage.org/webt/p-/nh/cp/p-nhcpeur45dhrzahmpffom9pq8.png"></li><li> 并保存域配置 <br><img src="https://habrastorage.org/webt/1u/8n/si/1u8nsi-zblkkqdsrpa7lnqcgw8g.png"></li><li> 您可以通过转到状态-&gt;主菜单-&gt;对象状态中导航树中的默认域来检查已创建对象的状态。 <br><img src="https://habrastorage.org/webt/uz/qo/q4/uzqoq4kek4qdgkfkhovrjmiridm.png"></li><li> 选择<b><i>查看方式：类型</i></b> <br><img src="https://habrastorage.org/webt/fj/5_/6z/fj5_6zg-kidxhkt5as0omzfvsiw.png"></li><li> 在列表中找到“应用程序域”并检查对象的状态：每个对象都必须保存，打开并处于启动状态。 如果是这样，请继续下一章。 </li></ul><br><img src="https://habrastorage.org/webt/xa/ii/kj/xaiikjxfdhsy19lez-rxo2xmeug.png"><br><br><h2> 第3部分。队列管理器 </h2><br><p> 队列管理器不是IBM DataPower的必需组件，但是通过MQ的示例，您可以显示该产品的全部功能。 我们将使用IBM的MQ。 在第6章中描述的测试期间，我们将需要向本地队列管理器发送一条消息。 在本文中，我将使用rfhutil实用程序来执行此操作，但是您可以使用任何可用的方法。 为了进行测试，您将需要使用MQ队列管理器创建从DP到本地队列管理器的连接。 </p><br><cut></cut><br><h3>  3.1。 理论 </h3><br><p> 队列管理器在网关和远程队列管理器之间提供数据交换。 </p><br><p> 您还可以配置MQ队列管理器组，这将增加系统的容错能力。 例如，如果要将客户端连接到任何工作队列管理器集，并且在某些情况下（可在官方文档中找到），这将很有用。 </p><br><p> 从项目的经验来看，仅值得注意一个功能：一次我们想尝试使用DataPower来实现负载平衡，尤其是使用队列管理器组，但是在实践中我们没有发现这种可能性。 另一种解决方案是创建队列管理器集群。 </p><br><br><h3>  3.2。 练习 </h3><br><h4>  3.2.1。 准备工作 </h4><br><ol><li> 安装WebSphere MQ； </li><li> 创建一个本地LOCAL_DP_QM队列管理器，可在端口3630上访问； </li><li> 配置DP.SVRCONN通道； <br><br><p> 创建频道时，以下命令可能对您有用： </p><br><pre> <code class="plaintext hljs">strmqm LOCAL_DP_QM /*  mq*/ runmqsc LOCAL_DP_QM /*   mq*/ DEFINE CHANNEL (DP.SVRCONN) CHLTYPE(SVRCONN) MCAUSER('evlasenko') /* */ SET CHLAUTH('DP.SVRCONN') TYPE(USERMAP) CLNTUSER('evlasenko') USERSRC(channel) ADDRESS('*') ACTION(ADD) /*      */ SET CHLAUTH(DP.SVRCONN) TYPE(BLOCKUSER) USERLIST('nobody') /*   */ ALTER LISTENER (SYSTEM.DEFAULT.LISTENER.TCP) TRPTYPE(TCP) PORT(3630) control(QMGR) /*    3630*/ ALTER AUTHINFO (SYSTEM.DEFAULT.AUTHINFO.IDPWOS) AUTHTYPE(IDPWOS) CHCKCLNT(OPTIONAL) /* */ REFRESH SECURITY TYPE(CONNAUTH) /*  */ endmqm LOCAL_DP_QM /*  mq*/ strmqm LOCAL_DP_QM /*  mq*/ END</code> </pre><br></li><li> 创建队列DP.IIB.REQIN和DP.IIB.RESIN </li><li> 在创建通道的用户名下运行rfhutil。 在“队列管理器名称（要连接）”行中，输入： <br><br><pre> <code class="plaintext hljs">DP.SVRCONN/TCT/127.0.0.1(3630)</code> </pre> <br></li><li> 尝试加载队列名称列表；消息窗口中应该没有任何错误。 与通道的连接已验证。 <br></li></ol><br><h4>  3.2.2。 创建IBM MQ队列管理器 </h4><br><ol><li> 转到主干域。 </li><li> 在搜索中，键入MQ，选择IBM MQ Queue Manager，然后单击添加。 </li><li> 您需要指定名称（TEST_QM），队列管理器主机名，队列管理器名称和通道名称以及超时。 配置并保存更改。 <br><img src="https://habrastorage.org/webt/di/sg/x1/disgx1dt8szkq9uoicnlepcn9lg.png"><br></li></ol><br><p> 以与检查域的状态相同的方式检查队列管理器对象的状态。 为此，请选择“对象状态”，然后从干线域中选择“查看方式：类型”过滤器。 在“ IBM MQ队列管理器”部分中，找到适当的对象并检查其状态。 </p><br><h2> 第4部分。多协议网关 </h2><br><h3>  4.1。 理论 </h3><br><p> 多协议网关（MPG）是一种多协议网关，它使您可以使用各种协议从客户端接收请求，然后使用各种协议将它们传输到不同的服务器。 客户端使用的协议可能与远程访问服务器使用的协议不匹配。 </p><br> 在主要的MPG设置中，您可以定义以下组件： <br><br><ul><li>  XML Manager-控制样式表（xsl，xslt）的编译和缓存，文档的缓存。 </li><li> 策略-由规则组成，每个规则都定义了一组应用于通过网关传递的消息的操作。 </li><li> 正面和背面设置（设置url，传入和传出消息的类型，超时等）。 </li></ul><br><p> 关于项目的几句话： </p><br><p> 该项目使用4个多协议网关（路由，2个用于不同终端系统的转换网关，以及另外一个旨在从设置域接收文件的网关）。 下图显示了一般的交互方案： </p><br><img src="https://habrastorage.org/webt/p9/ea/yb/p9eayb25jpeoiazqjd0sitssuf4.png"><br><p>  MPG的数量可能会根据整个解决方案的体系结构而有所不同。 在我们的案例中，DataPower面临着集成总线（IIB）和微服务，它们在接口（json / http与xml / mq）之间具有显着差异，因此决定为每个特定的后端制作转换MPG并相应地命名。 对于所有客户端，我们使用json / http，因此路由MPG是其中之一。 主要的MPG包含3条处理消息的规则-请求，响应和错误。 每个规则都包含必要的操作，例如转换，日志记录，路由和其他操作。 </p><br><p> 从功能-如果在策略中使用操作ConvertQueryParamToXML，则请注意InputConversion。 如果将“默认编码”设置为JSON并尝试发送GET请求，您会惊讶地发现该消息没有经过您指定的任何转换，也找不到任何痕迹。 此功能将有助于克服为GET请求创建单独的规则的问题。 </p><br><h3>  4.2。 练习 </h3><br><h4>  4.2.1。 准备工作 </h4><br><p> 您可以在链接<a href="">https://github.com/EvgenyaVlasenko/IBM_DataPower.git上</a>找到工作所需的所有文件。 <br></p><h4>  4.2.1.1。 域中继 </h4><br><ol><li> 转到主干域。 </li><li> 在控制面板中，选择“文件管理”。 </li><li> 在本地目录中，创建以下目录结构并将相应的文件放入其中（每个文件均包含对其执行功能的简要说明，以及本文稍后对此内容的详细讨论）。 <br><img src="https://habrastorage.org/webt/oj/am/i9/ojami90qdgg81ojuyr88pmeuzd0.png"><br></li></ol><br><h4>  4.2.1.2。 域设置 </h4><br><ol><li> 转到设置域。 </li><li> 在控制面板中，选择“文件管理”。 </li><li> 在本地目录中，创建以下目录结构并将相应的文件放入其中（这些文件还包含对它们的简短描述）。 <br><img src="https://habrastorage.org/webt/mf/9r/ne/mf9rnemyu8mcb01ad_wi6__ozj0.png"><br></li></ol><br><h3>  4.2.2。 创建GetFileMPG </h3><br><p> 首先，创建一个简单的帮助器MPG，它将从设置域返回文件。 </p><br><ol><li> 转到设置域。 </li><li> 在控制面板中，选择“多协议网关”，然后单击“创建”。 </li><li> 指定名称（GetFileMPG），描述（可选）和后端类型（动态）。 实际上，由于将没有对后端的调用，并且仅文件将从本地系统返回，因此在此示例中，您可以指定任何类型的后端。 <br><img src="https://habrastorage.org/webt/ds/g7/5g/dsg75gxvgo-7caldbmytubddg6i.png"><br></li><li> 指定请求和响应类型。 明确指定类型将减少内联检查的数量。 指定“通过”类型允许您不创建规则（在这种情况下，将转换响应）。 如果我们指定“请求类型也通过”，那么我们将无法以任何方式处理消息。 此选项不适合我们，因此我们使用Non-XML限制请求的类型。 <br><br><img src="https://habrastorage.org/webt/qx/nx/l_/qxnxl_j3ki9e8hcc215zropuix8.png"><br></li><li> 单击+，然后选择HTTP处理程序以创建新的前端协议。 <br><br><img src="https://habrastorage.org/webt/dc/gq/pq/dcgqpqgpx284pxkoqdqhivwjbku.png"><br></li><li> 在这里，您应该指定名称，ip地址，端口和允许的方法列表。 注意IP地址。 如果指定0.0.0.0，则每个人都可以访问此网关。 如果为127.0.0.1-仅在同一DataPower内部的其他网关。 由于设置中包含安全参数，因此我们使用第二个选项。 填写字段并单击“应用”，该协议将自动添加到网关。 <br><br><img src="https://habrastorage.org/webt/xn/y5/-r/xny5-rfrolidwemexqwg25-tkec.png"><br></li><li> 单击+添加新策略。 <br><br><img src="https://habrastorage.org/webt/ju/y0/q6/juy0q6_osmjfnwd2v5xev97wvta.png"><br></li><li> 填写策略名称“ GetFilePolicy”。 <br></li><li> 创建一个新规则，填写规则的名称和方向。 由于实际上没有后端，并且仅返回所需的文件，因此将只有一个规则（客户端到服务器）。 <br><br><img src="https://habrastorage.org/webt/cv/4c/z_/cv4cz_dfzc5sjxu4i7as6iluzne.png"><br></li><li> 双击“匹配”操作对其进行配置，选择一个现有规则并应用更改。 在意识形态上对仅接收Get请求的能力进行限制是正确的，但是在培训任务的框架内，您可以选择现有的请求。 <br></li><li> 添加另一个动作-GatewayScript，方法是将其拖动到规则上并进行配置。 作为转换，我们将使用准备好的文件，该文件在本地：///文件系统将从传入请求的URI中按名称查找文件，并将其放置在消息正文中。 操作结果将直接传输到规则的输出缓冲区。 保存更改。 <br><br><img src="https://habrastorage.org/webt/ai/pr/va/aiprvaljftoye2gr5tf1xjf4s_u.png"><br></li><li> 最终的策略结果应如下所示： <br><br><img src="https://habrastorage.org/webt/rm/q0/on/rmq0onkkkvygnyevy574vsgz3ns.png"><br></li><li>  MPG创建完成，保存更改。 <br></li><li> 您可以使用“对象状态”来验证其创建是否成功，类似于检查域和队列管理器的状态。 为此，请从设置域中选择“对象状态”和“查看方式：”服务过滤器。 在“多协议网关”部分中，搜索相应的对象并检查其状态。 <br></li><li> 您无法从外部调用此MPG，因为已使用ip保护了它。 临时将ip从127.0.0.1更改为0.0.0.0，并将端口从7171更改为7170，然后运行以下查询： <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/trunk/route/routeRules.xml"</code> </pre><br></li><li> 您应该得到以下答案： <br><br><img src="https://habrastorage.org/webt/e5/m8/3n/e5m83ngxz17e8lahsicaxs6lj5s.png"><br></li><li> 再次，将ip和端口更改为原始的127.0.0.1:7171。 <br></li></ol><br><h4>  4.2.3。 创建RoutingMPG </h4><br><p> 现在创建RoutingMPG。 根据输入的请求和路由规则，他将确定应将请求发送到何处以及使用什么参数。 </p><br><ol><li> 转到主干域。 </li><li> 根据第4.2.2节第2-10条，使用以下值创建一个新的多协议网关： <br><ul><li>  3-名称：RoutingMPG，后端类型：动态（用于在必要时将请求路由到其他MPG的功能）。 </li><li>  4-Rq：非xml，Rs：非xml。 </li><li>  6-名称：RoutingHTTP_FSH，IP：0.0.0.0，端口：7170，+ Get方法。 </li><li>  8-名称：RoutingPolicy。 </li><li>  9-名称：RoutingPolicy_rule_req，方向：客户端到服务器。 </li></ul><br></li><li> 再添加一个动作以路由请求，将“路由”动作拖到规则上，双击它进行配置，填写字段并应用更改。  route.xsl文件通过先前创建的GetFileMPG从设置域接收路由设置文件。 之后，基于URI，已经从文件中选择了该操作所需的设置。 其中一些用于路由，另一些则添加到标头以用于其他MPG。 输入和输出参数确定仅使用消息正文的方式，而决不影响标题和变量。 因此：输入null，因为消息正文中的信息不用于路由。 输出为空-因为转换的结果只是服务信息的变化。 <br><br><img src="https://habrastorage.org/webt/bb/q0/nh/bbq0nh2dtogav5pyfoeneb3t66m.png"><br></li><li> 同样，再创建2条规则并保存所有更改： <br><ul><li> 方向：服务器-客户端，名称：RoutingPolicy_rule_resp； <br> 转换：输入INPUT，输出NULL，本地转换文件：///RoutingMPG/transform/resp.xslt。  resp.xslt文件接收转换MPG响应的http状态，并将其显式设置为RoutingMPG响应。 如果不这样做，那么即使转换MPG中发生错误，默认代码也将设置为200。 <br></li><li> 方向：错误，名称：RoutingPolicy_rule_error; <br> 转换：输入INPUT，输出PIPE（根据文档，在两个相邻动作节点之间使用PIPE作为INPUT和OUTPUT可以消除额外的处理并减少使用的内存量），转换文件位于本地：///RoutingMPG/transform/errors.xsl。  errors.xsl文件从转换MPG的响应中接收错误代码和文本，并以客户端期望的格式生成JSON错误消息。 <br></li></ul><br></li><li> 最终的策略结果应如下所示： <br><br><img src="https://habrastorage.org/webt/um/kx/x-/umkxx-3kwx3hi1dzmc1e80ko-wa.png"><br></li><li>  MPG创建完成，保存更改。 <br></li><li> 使用例如curl工具，运行以下查询： <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/dp/test/transformMessage"</code> </pre> <br></li><li> 如果出现以下错误，则说明一切正确。 此错误表示已成功接收和处理了该消息，但是调用后端（在本例中为IIBMPG）的尝试失败。 转到下一步。 <br><br><img src="https://habrastorage.org/webt/8g/iq/tl/8giqtlzspsyix66vnl7mkcxnelk.png"><br></li></ol><br><h4>  4.2.4。 创建IIBMPG </h4><br><p> 下一步是创建一个转型的MPG。 假设外部系统采用JSON请求格式，内部系统采用XML。 我们需要转换输入消息，以便内部系统可以理解它。 值得注意的是，这并不总是整个消息的简单转换。 通常需要传达截断或增强的消息，有时会采用完全重新设计的结构。 </p><br><ol><li> 转到主干域。 </li><li> 根据第4.2.2节第2-10条，使用以下值创建一个新的多协议网关： <br><ul><li>  3-名称：IIBMPG，后端类型：动态 </li><li>  4-Rq：JSON，Rs：XML </li><li>  6-名称：IIBHTTP_FSH，ip：127.0.0.1（仅来自同一DataPower的请求），端口：7172，+ Get方法 </li><li>  8-名称：IIBPolicy </li><li>  9-名称：IIBPolicy_rule_req，方向：客户端到服务器 </li></ul><br></li><li> 添加说明。 基于请求标头中的X-DP-Transform-Name，IIBRuleRoute.xsl文件从本地///IIB/route/IIBRouteRules.xml文件接收此服务的请求转换，响应和错误文件的名称，并将它们的值设置为相应的上下文变量var：// context / IIB / reqTransform，var：// context / IIB / ansTransform，var：// context / IIB / errTransform。 标头中的其他值（url，uri，expire，timeout）也放置在上下文变量中。 <br><br><img src="https://habrastorage.org/webt/xo/6b/ek/xo6bekae8dsumpvosfe5xnbhneg.png"><br></li><li> 通过将“高级”拖动到您的规则并从列表中选择“将查询参数转换为XML”进行配置，以添加其他操作。 您需要添加一个新的输入转换图，为其指定名称（cmnJSONParseCNVM）和所需的类型（JSON）。 <br><br><img src="https://habrastorage.org/webt/ir/az/gb/irazgbszkybdgjkor1otjvrllqc.png"><br><br><img src="https://habrastorage.org/webt/yd/tk/2x/ydtk2xhbveh4j6z1gsweidcyhak.png"><br></li><li> 在标准转换后添加转换并进行配置。 在这种情况下，在上一个转换中设置的变量用于指示转换文件。 这样做是为了使转换具有通用性，并且根据输入消息将文件本身“即时”替换。 邮件正文已准备就绪。 下一步是路由消息，消息主体不会改变，因此我们创建dpvar_1变量并将结果保存在其中。 我们正是将此变量指向“结果”操作的输入。 保存更改。 <br><br><img src="https://habrastorage.org/webt/yz/cf/do/yzcfdogrjturkuvvmqx7bio_ex4.png"><br></li><li> 添加路由操作并设置以下参数。  IIBURLRoute.xsl文件接收上下文变量的值，其中一些被设置为服务请求变量，其余的则形成用于目的地系统请求的URI，该URI也存储在服务变量中。 <br><br><img src="https://habrastorage.org/webt/kl/vk/cf/klvkcfgcro60wznqwo0ibxdncys.png"><br></li><li> 同样，再创建2条规则并保存所有更改： <br><ul><li> 方向：服务器-客户端，名称：IIBPolicy_rule_resp； <br> 转换：输入INPUT，输出PIPE，转换文件var：// context / IIB / ansTransform（用于替换“即时”响应转换的上下文变量）。 </li><li> 方向：错误，名称：IIBPolicy_rule_error; <br> 转换：输入NULL，输出PIPE，转换文件var：// context / IIB / errTransform（使用上下文变量替代动态错误转换）。 </li></ul><br></li><li> 最终的策略结果应如下所示： <br><img src="https://habrastorage.org/webt/qi/d9/7u/qid97ursvmwifemzxbfdtudjkjc.png"><br></li><li>  MPG创建完成，保存更改。 <br></li></ol><br><h2> 第5部分。测试 </h2><br><h3>  5.1。 准备工作 </h3><br><ol><li> 下载，例如，用于在队列中读取和写入消息的rfhutil实用程序； </li><li> 测试文件位于与项目文件相同目录的tests文件夹中。 </li></ol><br><h3>  5.2。 健康检查 </h3><br><ol><li> 使用curl工具发送请求（对于下面的请求，当前目录应与example.json相同）。 <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/dp/test/transformMessage" -H "Content-Type: application/json" --data-binary @example.json</code> </pre> <br></li><li> 打开2个rfhutil实用程序实例，并从第一个实例的DP.IIB.REQIN队列中减去消息； <br></li><li> 转到MQMD选项卡并复制MessageID； <br></li><li> 在第二个实例中，打开rs.xml文件，在MQMD选项卡中，将消息标识符插入CorrelID中，并将消息放入DP.IIB.RESIN队列中。 <br></li><li> 您应该得到类似的答案： <br><br><img src="https://habrastorage.org/webt/mn/kj/xj/mnkjxj0lyafkvo7hjgpyytuytee.png"><br></li><li> 重复步骤1-3； <br></li><li>      rs_error.xml       correllId; <br></li><li>     <br><br><img src="https://habrastorage.org/webt/_y/i5/hb/_yi5hbw1lnrfwsuryyln9z3rdic.png"><br></li></ol><br><h2>  6.  </h2><br><h3>  6.1。 理论 </h3><br><p> Log Targets   ,         . <br></p><br><p>     Log Targets    .     ,      4     1000Kb,      .              2-4    .       ,        .  , DataPower,  , ,   ,        ,      ,      -  MPG,     . <br></p><br><h3> 6.2.  </h3><br><ol><li>    trunk; </li><li>    Log Target   ; </li><li>      : <br><ul><li> (IIB_LOG); </li><li> (File); </li><li>  (Text); </li><li>  timestamp(zulu); </li><li>   (logtemp:///IIB.log —  IIBMPG); </li><li>  (1000). <br><img src="https://habrastorage.org/webt/ev/sm/mj/evsmmjxy8m6suwkbaeojvgcudf8.png"><br></li></ul><br></li><li>   .        MPG   IIBMPG. <br><br><img src="https://habrastorage.org/webt/lq/vl/5l/lqvl5lvc_w8powdnufq6emgjgwc.png"><br></li><li>    ,     ,    (  ,        ). <br><br><img src="https://habrastorage.org/webt/ia/tu/98/iatu98v3l0fioelwktk8uwu-6fw.png"><br></li><li>         ; <br></li><li>    ; <br></li><li>          . <br></li><li>      Log Targets    MPG. <br></li><li>   : <br><ul><li>             , ,         . <br><br><img src="https://habrastorage.org/webt/z2/ix/vt/z2ixvtjk8eidxsfbbe6mmfcecnc.png"><br></li><li>        . <br><br><img src="https://habrastorage.org/webt/go/ik/wl/goikwl1pdvlzhiyd_d7gqpffzo8.png"><br></li></ul><br></li></ol><br><h2>  7.  -    </h2><br><ol><li>       –  ,   .    –  ,   ,     -    . <br></li><li>      .       View Logs.      ,  «  », «   »     . <br></li><li>       .           .       MPG       Show Probe -&gt; Enable Probe.         .   ,        . <br><br><img src="https://habrastorage.org/webt/re/6s/mh/re6smhejkm-i8cdmmeky6ch6cmy.png"><br></li><li>   ,      . <br></li></ol><br><p>     –    . <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN442686/">https://habr.com/ru/post/zh-CN442686/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN442676/index.html">梦想在哪里：地下</a></li>
<li><a href="../zh-CN442678/index.html">立体光刻中最大的项目：在3D打印机上打印的庞然大物骨架</a></li>
<li><a href="../zh-CN442680/index.html">感官替代技术将使您借助声音看到世界：人脑的神经可塑性如何运作</a></li>
<li><a href="../zh-CN442682/index.html">输入什么以及如何组装C ++项目</a></li>
<li><a href="../zh-CN442684/index.html">平衡网站性能。 第3部分：内容</a></li>
<li><a href="../zh-CN442688/index.html">Scala数据分析-迫切需要还是令人愉快的机会？</a></li>
<li><a href="../zh-CN442690/index.html">月球任务“ Bereshit”-地球背景下的自拍照</a></li>
<li><a href="../zh-CN442692/index.html">没有中介的区块链：我们如何将证券发送到分布式注册表</a></li>
<li><a href="../zh-CN442694/index.html">其中一家流媒体巨头在印度推出，一周吸引了100万用户</a></li>
<li><a href="../zh-CN442696/index.html">S for Security：InoThings ++ 2019的物联网安全和报告</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>