<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📈 🧙🏼 🚪 Menggunakan UIViewPropertyAnimator untuk Membuat Animasi Kustom 🚶🏻 💂 🔊</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Membuat animasi itu luar biasa. Mereka adalah bagian penting dari Pedoman Antarmuka Manusia iOS . Animasi membantu menarik perhatian pengguna pada hal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menggunakan UIViewPropertyAnimator untuk Membuat Animasi Kustom</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458970/"> Membuat animasi itu luar biasa.  Mereka adalah bagian penting dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pedoman Antarmuka Manusia iOS</a> .  Animasi membantu menarik perhatian pengguna pada hal-hal penting atau hanya membuat aplikasi kurang membosankan. <br><br>  Ada beberapa cara untuk menerapkan animasi di iOS.  Mungkin cara yang paling populer adalah dengan menggunakan <i>UIView.animate (withDuration: animations :)</i> .  Anda dapat menghidupkan lapisan gambar menggunakan <b>CABasicAnimation</b> .  Selain itu, UIKit memungkinkan Anda untuk mengonfigurasi animasi khusus untuk menampilkan pengontrol menggunakan <b>UIViewControllerTransitioningDelegate</b> . <br><br>  Pada artikel ini saya ingin membahas cara lain yang menarik untuk menghidupkan tampilan - <b>UIViewPropertyAnimator</b> .  Kelas ini menyediakan lebih banyak fungsi manajemen daripada pendahulunya, <i>UIView.animat</i> e.  Gunakan untuk membuat animasi sementara, interaktif, dan terganggu.  Selain itu, dimungkinkan untuk dengan cepat mengubah animator. <br><a name="habracut"></a><br><h3>  Memperkenalkan UIViewPropertyAnimator </h3><br>  <b>UIViewPropertyAnimator</b> diperkenalkan di <b>iOS 10</b> .  Ini memungkinkan Anda untuk membuat animasi dengan cara berorientasi objek.  Mari kita lihat contoh animasi yang dibuat menggunakan <b>UIViewPropertyAnimator</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/284/201/7c2/2842017c24a19653c9be8f14b4f13bfc.gif" alt="gambar"><br><br>  Ini adalah bagaimana ketika menggunakan UIView. <br><br><pre><code class="swift hljs"><span class="hljs-type"><span class="hljs-type">UIView</span></span>.animate(withDuration: <span class="hljs-number"><span class="hljs-number">0.3</span></span>) { view.frame = view.frame.offsetBy(dx: <span class="hljs-number"><span class="hljs-number">100</span></span>, dy: <span class="hljs-number"><span class="hljs-number">0</span></span>) }</code> </pre> <br>  Dan inilah cara melakukannya dengan <b>UIViewPropertyAnimator</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> animator = <span class="hljs-type"><span class="hljs-type">UIViewPropertyAnimator</span></span>(duration:<span class="hljs-number"><span class="hljs-number">0.3</span></span>, curve: .linear) { view.frame = view.frame.offsetBy(dx:<span class="hljs-number"><span class="hljs-number">100</span></span>, dy:<span class="hljs-number"><span class="hljs-number">0</span></span>) } animator.startAnimation()</code> </pre><br>  Jika Anda perlu memeriksa animasi, cukup buat Playground dan jalankan kode seperti yang ditunjukkan di bawah ini.  Kedua fragmen kode akan menghasilkan hasil yang sama. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1a/1fb/515/f1a1fb51597dadf93c4155dc59d8164d.png" alt="gambar"><br><br>  Anda mungkin berpikir bahwa dalam contoh ini tidak ada banyak perbedaan.  Jadi, apa gunanya menambahkan cara baru untuk membuat animasi?  <b>UIViewPropertyAnimator</b> menjadi lebih berguna ketika Anda perlu membuat animasi interaktif. <br><br><h3>  Animasi interaktif dan terputus </h3><br>  Apakah Anda ingat gerakan klasik "Finger Swipe to Unlock Device"?  Atau gerakan "Gerakkan jari Anda di layar dari bawah ke atas" untuk membuka Pusat Kontrol?  Ini adalah contoh bagus dari animasi interaktif.  Anda dapat mulai memindahkan gambar dengan jari Anda, lalu lepaskan dan gambar akan kembali ke posisi semula.  Selain itu, Anda dapat menangkap gambar selama animasi dan terus memindahkannya dengan jari Anda. <br><br>  Animasi UIView tidak menyediakan cara mudah untuk mengontrol persentase penyelesaian animasi.  Anda tidak dapat menjeda animasi di tengah-tengah loop dan melanjutkan eksekusi setelah terputus. <br><br>  Dalam hal ini, kita akan berbicara tentang <b>UIViewPropertyAnimator</b> .  Selanjutnya, kita akan melihat bagaimana Anda dapat dengan mudah membuat animasi yang sepenuhnya interaktif, terputus, dan membalikkan animasi dalam beberapa langkah. <br><br><h3>  Persiapan proyek peluncuran </h3><br>  Pertama, Anda perlu <a href="">mengunduh proyek pemula</a> .  <b>Setelah</b> Anda membuka arsip, Anda akan menemukan aplikasi <b>CityGuide</b> yang membantu pengguna merencanakan liburan mereka.  Pengguna dapat menggulir daftar kota, dan kemudian membuka deskripsi rinci dengan informasi rinci tentang kota yang ia sukai. <br><br>  Pertimbangkan kode sumber proyek sebelum kita mulai membuat animasi yang indah.  Inilah yang dapat Anda temukan di sebuah proyek dengan membukanya di <b>Xcode</b> : <br><br><ol><li>  <b>ViewController.swift</b> : Pengontrol aplikasi utama dengan <b>UICollectionView</b> yang menampilkan berbagai objek <b>Kota</b> . </li><li>  <b>CityCollectionViewCell.swift:</b> Cell untuk menampilkan <b>City</b> .  Bahkan, dalam artikel ini sebagian besar perubahan akan berlaku untuk kelas ini.  Anda mungkin memperhatikan bahwa <b>descriptionLabel</b> dan <b>closeButton</b> sudah didefinisikan di kelas.  Namun, setelah memulai aplikasi, objek-objek ini akan disembunyikan.  Jangan khawatir, mereka akan terlihat sedikit kemudian.  Kelas ini juga memiliki properti <i>collectionView</i> dan <i>index</i> .  Nanti mereka akan digunakan untuk animasi. </li><li>  <b>CityCollectionViewFlowLayout.swift:</b> Kelas ini bertanggung jawab untuk pengguliran horizontal.  Kami belum akan mengubahnya. </li><li>  <b>City.swift</b> : Model aplikasi utama memiliki metode yang digunakan di ViewController. </li><li>  <b>Main.storyboard:</b> Di sana Anda dapat menemukan antarmuka pengguna untuk <b>ViewController</b> dan <b>CityCollectionViewCell</b> . </li></ol><br>  Mari kita coba membangun dan menjalankan aplikasi sampel.  Sebagai hasil dari ini, kami memperoleh yang berikut ini. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/313/0ed/3e6/3130ed3e68179c72b4b99e160cc2cb9b.png" alt="cityguideapp-iphone8" width="350" height="614"></div><br><h3>  Implementasi penyebaran dan runtuhnya animasi </h3><br>  Setelah memulai aplikasi, daftar kota ditampilkan.  Tetapi pengguna tidak dapat berinteraksi dengan objek dalam bentuk sel.  Sekarang Anda perlu menampilkan informasi untuk setiap kota ketika pengguna mengklik salah satu sel.  Lihatlah versi final aplikasi.  Inilah yang sebenarnya perlu dikembangkan: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d1/124/719/2d1124719b8918381a74d1dae192acb5.gif" alt="gambar" width="350" height="614"></div><br>  Animasi terlihat bagus, bukan?  Tapi tidak ada yang istimewa di sini, itu hanya logika dasar dari <b>UIViewPropertyAnimator</b> .  Mari kita lihat bagaimana menerapkan jenis animasi ini.  Buat metode <i>collectionView (_: didSelectItemAt)</i> , tambahkan fragmen kode berikut ke akhir file <b>ViewController</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collectionView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> selectedCell = collectionView.cellForItem(at: indexPath)! <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">CityCollectionViewCell</span></span> selectedCell.toggle() }</code> </pre><br>  Sekarang kita perlu mengimplementasikan metode <b>toggle</b> .  Mari kita beralih ke <b>CityCollectionViewCell.swift</b> dan mengimplementasikan metode ini. <br><br>  Pertama, tambahkan enumerasi <b>Negara</b> ke bagian atas file, tepat sebelum deklarasi kelas <b>CityCollectionViewCell</b> .  Daftar ini memungkinkan Anda untuk melacak keadaan sel: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> expanded <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> collapsed <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> change: <span class="hljs-type"><span class="hljs-type">State</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .expanded: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .collapsed <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .collapsed: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .expanded } } }</code> </pre><br>  Tambahkan beberapa properti untuk mengontrol animasi di kelas <b>CityCollectionViewCell</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initialFrame: <span class="hljs-type"><span class="hljs-type">CGRect?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state: <span class="hljs-type"><span class="hljs-type">State</span></span> = .collapsed <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> animator: <span class="hljs-type"><span class="hljs-type">UIViewPropertyAnimator</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UIViewPropertyAnimator</span></span>(duration: <span class="hljs-number"><span class="hljs-number">0.3</span></span>, curve: .easeInOut) }()</code> </pre><br>  Variabel <i>initialFrame</i> digunakan untuk menyimpan bingkai sel sampai animasi <i>berjalan</i> .  <b>negara</b> digunakan untuk melacak jika sel diperluas atau runtuh.  Dan variabel <b>animator</b> digunakan untuk mengontrol animasi. <br><br>  Sekarang tambahkan metode <i>sakelar</i> dan panggil dari metode <i>tutup</i> , misalnya: <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@IBAction</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { toggle() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> state { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .expanded: collapse() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .collapsed: expand() } }</code> </pre><br>  Lalu kami menambahkan dua metode lagi: <i>expand ()</i> dan <i>collapse ()</i> .  Kami akan melanjutkan implementasi mereka.  Pertama, kita mulai dengan metode <i>expansiond ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> collectionView = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.collectionView, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> index = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.index <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } animator.addAnimations { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.initialFrame = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.frame <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.descriptionLabel.alpha = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.closeButton.alpha = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.layer.cornerRadius = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.frame = <span class="hljs-type"><span class="hljs-type">CGRect</span></span>(x: collectionView.contentOffset.x, y:<span class="hljs-number"><span class="hljs-number">0</span></span>, width: collectionView.frame.width, height: collectionView.frame.height) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> leftCell = collectionView.cellForItem(at: <span class="hljs-type"><span class="hljs-type">IndexPath</span></span>(row: index - <span class="hljs-number"><span class="hljs-number">1</span></span>, section: <span class="hljs-number"><span class="hljs-number">0</span></span>)) { leftCell.center.x -= <span class="hljs-number"><span class="hljs-number">50</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rightCell = collectionView.cellForItem(at: <span class="hljs-type"><span class="hljs-type">IndexPath</span></span>(row: index + <span class="hljs-number"><span class="hljs-number">1</span></span>, section: <span class="hljs-number"><span class="hljs-number">0</span></span>)) { rightCell.center.x += <span class="hljs-number"><span class="hljs-number">50</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.layoutIfNeeded() } animator.addCompletion { position <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> position { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .end: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.state = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.state.change collectionView.isScrollEnabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span> collectionView.allowsSelection = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: () } } animator.startAnimation() }</code> </pre><br>  Berapa kodenya.  Biarkan saya menjelaskan apa yang terjadi langkah demi langkah: <br><br><ol><li>  Pertama, periksa apakah <i>collectionView</i> dan <i>index</i> tidak sama dengan nol.  Jika tidak, kami tidak akan dapat memulai animasi. </li><li>  Selanjutnya, mulai membuat animasi dengan memanggil <i>animator.addAnimations</i> . </li><li>  Selanjutnya, simpan frame saat ini, yang digunakan untuk mengembalikannya dalam animasi konvolusi. </li><li>  Kemudian kita mengatur nilai alpha untuk <i>descriptionLabel</i> dan <i>closeButton</i> untuk membuatnya terlihat. </li><li>  Selanjutnya, hapus sudut bulat dan atur bingkai baru untuk sel.  Sel akan ditampilkan di layar penuh. </li><li>  Selanjutnya kita pindahkan sel tetangga. </li><li>  Sekarang panggil metode <i>animator.addComplete ()</i> untuk menonaktifkan interaksi gambar koleksi.  Ini mencegah pengguna untuk menggulirnya selama ekspansi sel.  Juga ubah status sel saat ini.  Penting untuk mengubah keadaan sel, dan hanya setelah itu animasi berakhir. </li></ol><br>  Sekarang tambahkan animasi konvolusi.  Singkatnya, hanya saja kita mengembalikan sel ke keadaan sebelumnya: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collapse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> collectionView = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.collectionView, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> index = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.index <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } animator.addAnimations { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.descriptionLabel.alpha = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.closeButton.alpha = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.layer.cornerRadius = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.cornerRadius <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.frame = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.initialFrame! <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> leftCell = collectionView.cellForItem(at: <span class="hljs-type"><span class="hljs-type">IndexPath</span></span>(row: index - <span class="hljs-number"><span class="hljs-number">1</span></span>, section: <span class="hljs-number"><span class="hljs-number">0</span></span>)) { leftCell.center.x += <span class="hljs-number"><span class="hljs-number">50</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rightCell = collectionView.cellForItem(at: <span class="hljs-type"><span class="hljs-type">IndexPath</span></span>(row: index + <span class="hljs-number"><span class="hljs-number">1</span></span>, section: <span class="hljs-number"><span class="hljs-number">0</span></span>)) { rightCell.center.x -= <span class="hljs-number"><span class="hljs-number">50</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.layoutIfNeeded() } animator.addCompletion { position <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> position { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .end: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.state = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.state.change collectionView.isScrollEnabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> collectionView.allowsSelection = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: () } } animator.startAnimation() }</code> </pre><br>  Sekarang saatnya mengkompilasi dan menjalankan aplikasi.  Coba klik pada sel dan Anda akan melihat animasinya.  Untuk menutup gambar, klik ikon silang di sudut kanan atas. <br><br><h3>  Menambahkan pemrosesan gerakan </h3><br>  Anda dapat mengklaim mencapai hasil yang sama menggunakan <i>UIView.animate</i> .  Apa gunanya menggunakan <b>UIViewPropertyAnimator</b> ? <br><br>  Nah, ini saatnya membuat animasi menjadi interaktif.  Tambahkan <b>UIPanGestureRecognizer</b> dan properti baru bernama <i>popupOffset</i> untuk melacak seberapa banyak sel dapat dipindahkan.  Mari kita deklarasikan variabel-variabel ini di kelas <b>CityCollectionViewCell</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> popupOffset: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> = (<span class="hljs-type"><span class="hljs-type">UIScreen</span></span>.main.bounds.height - cellSize.height)/<span class="hljs-number"><span class="hljs-number">2.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> panRecognizer: <span class="hljs-type"><span class="hljs-type">UIPanGestureRecognizer</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> recognizer = <span class="hljs-type"><span class="hljs-type">UIPanGestureRecognizer</span></span>() recognizer.addTarget(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, action: #selector(popupViewPanned(recognizer:))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> recognizer }()</code> </pre><br>  Kemudian tambahkan metode berikut untuk mendaftarkan definisi gesek: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">awakeFromNib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.addGestureRecognizer(panRecognizer) }</code> </pre><br>  Sekarang Anda perlu menambahkan metode <i>popupViewPanned</i> untuk melacak gerakan gesek.  Rekatkan kode berikut ke <b>CityCollectionViewCell</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@objc</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">popupViewPanned</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(recognizer: UIPanGestureRecognizer)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> recognizer.state { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .began: toggle() animator.pauseAnimation() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .changed: <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> translation = recognizer.translation(<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: collectionView) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fraction = -translation.y / popupOffset <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> state == .expanded { fraction *= -<span class="hljs-number"><span class="hljs-number">1</span></span> } animator.fractionComplete = fraction <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .ended: animator.continueAnimation(withTimingParameters: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, durationFactor: <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: () } }</code> </pre><br>  Ada tiga negara.  Di awal gerakan, kami menginisialisasi animator menggunakan metode <i>sakelar</i> dan segera menghentikannya.  Sementara pengguna menyeret sel, kami memperbarui animasi dengan mengatur properti pengali <i>fractionComplete</i> .  Ini adalah keajaiban utama animator yang memungkinkan mereka untuk mengontrol.  Akhirnya, ketika pengguna melepaskan jarinya, metode animator <i>continueAnimation</i> dipanggil untuk melanjutkan animasi.  Kemudian sel akan bergerak ke posisi target. <br><br>  Setelah memulai aplikasi, Anda dapat menarik sel ke atas untuk mengembangkannya.  Lalu seret sel yang diperluas ke bawah untuk menutupnya. <br><br>  Animasi sekarang terlihat cukup bagus, tetapi mengganggu animasi di tengah tidak mungkin.  Karena itu, untuk membuat animasi sepenuhnya interaktif, Anda perlu menambahkan fungsi lain - interupsi.  Pengguna dapat memulai memperluas / runtuh animasi seperti biasa, tetapi animasi harus dihentikan segera setelah pengguna mengklik sel selama siklus animasi. <br><br>  Untuk melakukan ini, simpan kemajuan animasi dan kemudian ambil nilai ini untuk menghitung persentase penyelesaian animasi. <br><br>  Pertama, nyatakan properti baru di <b>CityCollectionViewCell</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> animationProgress: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Kemudian perbarui blok <i>.began</i> metode <i>popupViewPanned</i> dengan baris kode berikut untuk mengingat progresnya: <br><br><pre> <code class="swift hljs">animationProgress = animator.fractionComplete</code> </pre><br>  Di blok <b>.changed</b> , <b>Anda</b> perlu memperbarui baris kode berikut untuk menghitung persentase penyelesaian dengan benar: <br><br><pre> <code class="swift hljs">animator.fractionComplete = fraction + animationProgress</code> </pre><br>  Sekarang aplikasi siap untuk diuji.  Jalankan proyek dan lihat apa yang terjadi.  Jika semua tindakan dilakukan dengan benar mengikuti instruksi saya, animasi akan terlihat seperti ini: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8a5/eae/b13/8a5eaeb1341638dc9b45cbad05f8a66d.gif" alt="gambar" width="350" height="614"></div><br><h3>  Animasi terbalik </h3><br>  Anda dapat menemukan cacat untuk implementasi saat ini.  Jika Anda menarik sel sedikit dan mengembalikannya ke posisi semula, sel akan terus membesar saat Anda melepaskan jari Anda.  Mari kita selesaikan masalah ini untuk membuat animasi interaktif lebih baik. <br>  Mari perbarui blok <b>.end</b> dari metode <b>popupViewPanned</b> , seperti yang dijelaskan di bawah ini: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> velocity = recognizer.velocity(<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> shouldComplete = velocity.y &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> velocity.y == <span class="hljs-number"><span class="hljs-number">0</span></span> { animator.continueAnimation(withTimingParameters: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, durationFactor: <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> state { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .expanded: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !shouldComplete &amp;&amp; !animator.isReversed { animator.isReversed = !animator.isReversed } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> shouldComplete &amp;&amp; animator.isReversed { animator.isReversed = !animator.isReversed } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .collapsed: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> shouldComplete &amp;&amp; !animator.isReversed { animator.isReversed = !animator.isReversed } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !shouldComplete &amp;&amp; animator.isReversed { animator.isReversed = !animator.isReversed } } animator.continueAnimation(withTimingParameters: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, durationFactor: <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br>  Sekarang kita memperhitungkan kecepatan gerakan untuk menentukan apakah animasi harus dibalik. <br><br>  Dan akhirnya, masukkan baris kode lain ke dalam blok yang <b>diubah</b> .  Letakkan kode ini di sebelah kanan perhitungan <i>animator.fractionComplete</i> . <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> animator.isReversed { fraction *= -<span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre><br>  Ayo jalankan aplikasi lagi.  Sekarang semuanya harus bekerja tanpa gagal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a0/734/dc7/2a0734dc7012220eef4281c64db0e24b.gif" alt="gambar" width="350" height="614"></div><br><h3>  Perbaiki gerakan pan </h3><br>  Jadi, kami telah menyelesaikan implementasi animasi menggunakan <b>UIViewPropertyAnimator</b> .  Namun, ada satu kesalahan yang tidak menyenangkan.  Anda mungkin telah bertemu dengannya saat menguji aplikasi.  Masalahnya adalah bahwa menggulir sel secara horizontal tidak mungkin.  Mari kita coba geser ke kiri / kanan melalui sel, dan kita dihadapkan dengan masalah. <br><br>  Alasan utama terkait dengan <b>UIPanGestureRecognizer yang</b> kami <b>buat</b> .  Itu juga menangkap gerakan swipe, dan bertentangan dengan <b>UICollectionViewView</b> gesture built-in. <br><br>  Meskipun pengguna masih dapat menggulir melalui bagian atas / bawah sel atau ruang antar sel untuk menggulir kota, saya masih tidak menyukai antarmuka pengguna yang buruk.  Mari kita perbaiki. <br><br>  Untuk menyelesaikan konflik, kita perlu mengimplementasikan metode delegasi yang disebut <i>gestRecognizerShouldBegin (_ :)</i> .  Metode ini mengontrol apakah pengenal isyarat harus terus menginterpretasikan sentuhan.  Jika Anda mengembalikan <b>false</b> dalam metode ini, pengenal isyarat akan mengabaikan sentuhan.  Jadi yang akan kita lakukan adalah memberikan alat pengenalan panorama kita sendiri kemampuan untuk mengabaikan gerakan horisontal. <br><br>  Untuk melakukan ini, mari atur <i>delegasi</i> pengenal pan kami.  Masukkan baris kode berikut ke inisialisasi <b>panRecognizer</b> (Anda dapat meletakkan kode tepat sebelum <i>pengenal balik</i> : <br><br><pre> <code class="swift hljs">recognizer.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span></code> </pre><br>  Kemudian, kami menerapkan metode <i>gestRecognizerShouldBegin (_ :)</i> sebagai berikut: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gestureRecognizerShouldBegin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gestureRecognizer: UIGestureRecognizer)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>((panRecognizer.velocity(<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: panRecognizer.view)).y) &gt; <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>((panRecognizer.velocity(<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: panRecognizer.view)).x) }</code> </pre><br>  Kami akan membuka / menutup jika kecepatan vertikal lebih besar dari kecepatan horizontal. <br><br>  Wow!  Mari kita coba aplikasi ini lagi.  Sekarang Anda dapat bergerak di sekitar daftar kota dengan menggesekkan kiri / kanan melintasi sel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dd6/bcb/909/dd6bcb90976b4eaae326027309fda1c6.gif" alt="gambar" width="350" height="614"></div><br><h3>  Bonus: Fitur Sinkronisasi Kustom </h3><br>  Sebelum kita menyelesaikan tutorial ini, mari kita bicara tentang fungsi pengaturan waktu.  Apakah Anda masih ingat kasus ketika pengembang meminta Anda untuk menerapkan fungsi sinkronisasi khusus untuk animasi yang Anda buat? <br><br>  Biasanya, Anda harus mengubah <i>UIView.animation</i> menjadi <b>CABasicAnimation</b> atau membungkusnya dengan <b>CATransaction</b> .  <b>Dengan UIViewPropertyAnimator,</b> Anda dapat dengan mudah mengimplementasikan fungsi pengaturan waktu kustom. <br><br>  <b>Fungsi</b> pengaturan waktu (atau fungsi pelonggaran) dipahami sebagai fungsi kecepatan animasi yang memengaruhi laju perubahan satu atau properti animasi lainnya.  Empat jenis saat ini didukung: easyInOut, easyIn, easyOut, linear. <br><br>  Ganti inisialisasi animator dengan fungsi pengaturan waktu ini (coba gambar kurva kubik Bezier Anda sendiri) sebagai berikut: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> animator: <span class="hljs-type"><span class="hljs-type">UIViewPropertyAnimator</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cubicTiming = <span class="hljs-type"><span class="hljs-type">UICubicTimingParameters</span></span>(controlPoint1: <span class="hljs-type"><span class="hljs-type">CGPoint</span></span>(x: <span class="hljs-number"><span class="hljs-number">0.17</span></span>, y: <span class="hljs-number"><span class="hljs-number">0.67</span></span>), controlPoint2: <span class="hljs-type"><span class="hljs-type">CGPoint</span></span>(x: <span class="hljs-number"><span class="hljs-number">0.76</span></span>, y: <span class="hljs-number"><span class="hljs-number">1.0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UIViewPropertyAnimator</span></span>(duration: <span class="hljs-number"><span class="hljs-number">0.3</span></span>, timingParameters: cubicTiming) }()</code> </pre><br>  Atau, alih-alih menggunakan parameter sinkronisasi kubik, Anda juga dapat menggunakan sinkronisasi pegas, misalnya: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> springTiming = <span class="hljs-type"><span class="hljs-type">UISpringTimingParameters</span></span>(mass: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, stiffness: <span class="hljs-number"><span class="hljs-number">2.0</span></span>, damping: <span class="hljs-number"><span class="hljs-number">0.2</span></span>, initialVelocity: .zero)</code> </pre><br>  Cobalah untuk memulai proyek lagi dan lihat apa yang terjadi. <br><br><h3>  Kesimpulan </h3><br>  Melalui UIViewPropertyAnimator, Anda dapat meningkatkan layar statis dan interaksi pengguna melalui animasi interaktif. <br><br>  Saya tahu bahwa Anda tidak sabar untuk menyadari apa yang telah Anda pelajari dalam proyek Anda sendiri.  Jika Anda menerapkan pendekatan ini dalam proyek Anda, itu akan sangat keren, beri tahu saya tentang ini dengan meninggalkan komentar di bawah. <br><br>  Sebagai referensi, di sini Anda dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengunduh draft terakhir</a> . <br><br><h3>  Tautan selanjutnya </h3><br>  <b>Animasi profesional menggunakan UIKit</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://developer.apple.com/videos/play/wwdc2017/230/</a> <br><br>  <b>Dokumentasi UIViewPropertyAnimator untuk Pengembang Apple</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://developer.apple.com/documentation/uikit/uiviewpropertyanimator</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458970/">https://habr.com/ru/post/id458970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id458956/index.html">Pembelajaran Mesin vs. pendekatan analitis</a></li>
<li><a href="../id458960/index.html">Pencarian perusahaan</a></li>
<li><a href="../id458962/index.html">Konversi gambar menjadi suara - apa yang bisa Anda dengar?</a></li>
<li><a href="../id458964/index.html">TestMace. Mulai cepat</a></li>
<li><a href="../id458966/index.html">Para ilmuwan dan kepala perusahaan teknologi menganggap peluncuran perusahaan industri ke ruang angkasa adalah kenyataan</a></li>
<li><a href="../id458972/index.html">Berita minggu ini: Yandex dan agen intelijen Barat, FAS bertarung dengan kasino online, Kementerian Transportasi mengatur BlaBlaCar</a></li>
<li><a href="../id458974/index.html">Kehidupan penuh di Svelte</a></li>
<li><a href="../id458982/index.html">Resep Nginx: Konversi dari HTML dan URL ke PDF dan PS</a></li>
<li><a href="../id458984/index.html">Cara membuat aplikasi pertama untuk berdagang di bursa: 3 langkah awal</a></li>
<li><a href="../id458986/index.html">Resep PostgreSQL: Konversi dari HTML dan URL ke PDF dan PS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>