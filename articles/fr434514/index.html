<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôå üõåüèæ üöÜ "Secrets" DPAPI ou DPAPI pour Pentesters ü•ö üéÉ üò∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le deuxi√®me article bas√© sur les r√©sultats de la performance de notre √©quipe √† OFFZONE-2018. Cette fois, envisagez une discussion avec MainTrack ¬´Wind...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Secrets" DPAPI ou DPAPI pour Pentesters</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434514/">  Le deuxi√®me article bas√© sur les r√©sultats de la performance de notre √©quipe √† OFFZONE-2018.  Cette fois, envisagez une discussion avec MainTrack ¬´Windows DPAPI¬´ Sekretiki ¬ªou DPAPI pour pentesters¬ª. <br><br>  Attention!  Beaucoup de h√™tres! <br><br>  Lorsque je m√®ne des campagnes RedTeam, je veux donner moins de raisons √† la r√©action de BlueTeam, mais il peut y en avoir plusieurs.  Par exemple, ex√©cuter mimikatz pour obtenir des mots de passe ou des certificats utilisateur.  M√™me si nous avons pu lui ¬´otmazyvat¬ª de Kaspersky, BlueTeam a la possibilit√© de suivre en utilisant des outils sp√©cialis√©s tels que Sysmon, Microsoft ATA, etc.  Dans le m√™me temps, je voudrais obtenir le maximum d'informations d'une machine utilisateur compromise.  Au cours de campagnes men√©es √† plusieurs reprises par RedTeam pour contrer de v√©ritables √©quipes BlueTeam, nous sommes parvenus √† la conclusion qu'il fallait √©viter les actions pouvant servir d'indicateurs de compromis du syst√®me.  Pour atteindre cet objectif est possible gr√¢ce √† l'utilisation des m√©canismes juridiques et des actions fournies par le syst√®me d'exploitation pour l'utilisateur. <br><br>  L'un de ces outils juridiques est le m√©canisme DPAPI (Windows Data Protection API), qui est utilis√© par le syst√®me d'exploitation et diverses applications pour crypter les donn√©es utilisateur sensibles (principalement les mots de passe, les cl√©s cryptographiques, etc.) Pour l'utilisateur final et ses applications, DPAPI semble extr√™mement simple : Il n'y a que 2 fonctions - "crypter les donn√©es" et "d√©crypter les donn√©es".  Dans cet article, je voudrais examiner l'utilit√© d'un tel m√©canisme pour les pentesters lors des campagnes RedTeam. <br><a name="habracut"></a><br><h3>  Qu'est-ce que DPAPI?  Seulement bri√®vement et en russe </h3><br>  Depuis 2000, tous les syst√®mes d'exploitation Windows ont commenc√© √† utiliser le moteur DPAPI pour prot√©ger les donn√©es des utilisateurs. <br><br>  Si nous ignorons toute la cryptographie que nous avons examin√©e dans le rapport, pour d√©crypter les donn√©es crypt√©es via DPAPI, nous avons besoin: d'une cl√© principale, du SID de l'utilisateur, du hachage du mot de passe de l'utilisateur et du blob DPAPI lui-m√™me (donn√©es DPAPI crypt√©es). <br><br>  En g√©n√©ral, le processus ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/n1/ex/ah/n1exahepzml5ykake_tcy_qaj6i.jpeg"><br><br>  √Ä l'int√©rieur de notre "chapeau cryptographique", il existe de nombreux m√©canismes de cryptographie diff√©rents que nous ne consid√©rerons pas dans cet article, afin de ne pas surcharger le lecteur.  Nous notons seulement que la partie principale de DPAPI est le soi-disant Masterkey (cl√© principale).  En termes simples, la cl√© principale est de 64 octets de donn√©es al√©atoires chiffr√©es √† l'aide de la pr√©face, qui est g√©n√©r√©e √† partir du mot de passe de l'utilisateur et de son SID. <br><img src="https://habrastorage.org/webt/dr/gu/b2/drgub2ccge4pjhkz1czilfleveg.jpeg"><br><br>  Des param√®tres suppl√©mentaires participent √©galement √† la g√©n√©ration des pr√©-proies: le nombre d'it√©rations (IterN), le sel et le HMAC, qui peuvent varier d'un cas √† l'autre.  Les valeurs de ces param√®tres sont stock√©es avec la cl√© principale dans un fichier. <br><br>  Ainsi, en connaissant le mot de passe de l'utilisateur, son SID et en lisant les param√®tres de g√©n√©ration √† partir du fichier de cl√© principale (HMAC, Salt, InterN), nous pouvons g√©n√©rer un pr√©puce et d√©crypter la cl√© principale, c'est-√†-dire  obtenez les 64 octets tr√®s al√©atoires que nous utiliserons pour d√©chiffrer les blobs DPAPI. <br><br><h3>  Et si je change mon mot de passe? </h3><br>  Habituellement, les mots de passe des utilisateurs changent √† intervalles r√©guliers.  Que se passe-t-il si l'utilisateur modifie le mot de passe?  O√π est pass√© le pr√©c√©dent?  En effet, pour d√©crypter la cl√© principale, vous devez conna√Ætre le mot de passe de l'utilisateur, et rechiffrer toutes les cl√©s principales de l'utilisateur √† chaque fois est un plaisir trop cher.  Dans ce cas, tout est pens√© dans Windows. <br><br>  Il existe un fichier sp√©cial (CREDHIST), dont la t√¢che est de stocker tous les mots de passe des utilisateurs pr√©c√©dents.  Il est √©galement chiffr√© avec le mot de passe actuel de l'utilisateur et stock√© sur la pile.  Si le syst√®me √©choue soudainement √† d√©chiffrer la cl√© principale, il proc√®de comme suit: en utilisant le mot de passe actuel, il d√©chiffre le premier enregistrement dans CREDHIST.  Le mot de passe tente √† nouveau de d√©chiffrer la cl√© principale, et ainsi de suite jusqu'√† ce que les mots de passe de la cha√Æne soient √©puis√©s ou que la cl√© principale soit d√©chiffr√©e. <br><br><h3>  Un peu sur les cl√©s priv√©es d'un contr√¥leur de domaine </h3><br>  Comme vous l'avez peut-√™tre devin√©, DPAPI est appliqu√© √† tous les utilisateurs, y compris les utilisateurs de domaine.  Afin de pouvoir r√©initialiser le mot de passe √† un utilisateur qui l'a oubli√© avec succ√®s apr√®s une soir√©e du vendredi soir, vous avez besoin d'une cl√© de rechange qui sera stock√©e dans un endroit s√ªr.  Selon Microsoft, un endroit aussi fiable est un contr√¥leur de domaine. <br><br>  L'essence du m√©canisme de d√©chiffrement de la cl√© principale apr√®s la r√©initialisation du mot de passe utilisateur est la suivante: une paire de cl√©s RSA - priv√©es et publiques - est cr√©√©e sur le contr√¥leur de domaine.  La cl√© priv√©e est stock√©e sur le contr√¥leur de domaine dans la base de donn√©es NTDS et s'appelle BCKUPKEY_xxxx (voir la figure ci-dessous), et la cl√© publique est distribu√©e √† tous les syst√®mes de domaine et est utilis√©e pour g√©n√©rer un doublon de la cl√© principale lors de sa g√©n√©ration. <br><br>  Apr√®s avoir cr√©√© une cl√© principale sur une machine de domaine, son doublon est √©galement cr√©√© (ou plut√¥t, le mat√©riau de la cl√© principale est ses 64 octets), qui est stock√© avec la cl√© principale principale dans un fichier et est appel√© cl√© de domaine.  Si vous perdez la cl√© principale principale, c'est-√†-dire  lors de la r√©initialisation du mot de passe de l'utilisateur, le syst√®me en envoie un duplicata au contr√¥leur de domaine et demande √† le d√©chiffrer.  Le contr√¥leur, apr√®s avoir autoris√© l'utilisateur, d√©chiffre le duplicata et le renvoie au syst√®me, apr√®s quoi le mat√©riel de la cl√© principale est d√©j√† crypt√© √† nouveau avec un nouveau mot de passe. <br><br><img src="https://habrastorage.org/webt/jj/7h/zr/jj7hzrqypjkdjwiaooxks9wcbj0.jpeg"><br><br>  Ayant les privil√®ges appropri√©s dans le domaine (le plus souvent administrateur), vous pouvez obtenir ces cl√©s RSA priv√©es du contr√¥leur de domaine via le m√©canisme de r√©plication et les utiliser pour d√©crypter davantage les cl√©s principales cr√©√©es sur les machines du domaine.  Cela peut √™tre fait en utilisant mimikatz ou DSInternals.  Vous pouvez en savoir plus √† ce sujet dans le wiki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mimikatz</a> ou le blog <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DSInternals</a> . <br><br><h3>  O√π sont stock√©es les cl√©s principales et quelles sont-elles? </h3><br>  La cl√© principale peut √™tre un utilisateur et un syst√®me, selon les secrets crypt√©s.  La cl√© principale utilisateur est stock√©e dans le profil utilisateur de la mani√®re suivante: <br><br> <code>Users\%USER%\AppData\Roaming\Microsoft\Protect\%SID%\</code> <br> <br>  Au cas o√π, le syst√®me stocke toutes les cl√©s principales jamais utilis√©es par l'utilisateur.  Apr√®s tout, elle ne sait pas √† l'avance quel ma√Ætre devra d√©chiffrer quelque chose avec une cl√©.  Le GUID de la cl√© actuelle utilis√©e est stock√© dans le fichier pr√©f√©r√©. <br><br><img src="https://habrastorage.org/webt/xf/vm/dr/xfvmdrhqgsspxyznypourrwceh8.jpeg"><br><br>  Les cl√©s principales du syst√®me sont stock√©es de la mani√®re suivante: <br> <code>windows\system32\Microsoft\Protect\S-1-5-18\</code> <br> <br>  De m√™me avec l'utilisateur - une cl√© principale est utilis√©e, dont le nom peut √™tre trouv√© dans le fichier pr√©f√©r√©, o√π toutes les cl√©s qui ont d√©j√† √©t√© utilis√©es sont stock√©es. <br><br><img src="https://habrastorage.org/webt/zt/xt/xj/ztxtxjcblhgk7ugrwxwgosbtmjw.jpeg"><br><br><h3>  Eh bien, que peut apporter ce DPAPI au Pentester? </h3><br>  Le DPAPI √©tant un m√©canisme l√©gal et simple, diverses applications tentent de l'utiliser.  Parce que c'est pratique et s√ªr.  Pour le moment, bien s√ªr. <br><br>  Par exemple, DPAPI est utilis√© pour crypter les cl√©s priv√©es des certificats clients et syst√®me, les cl√©s WIFI, Chrome (cookies, mots de passe), DropBox, Skype, RSA SecurID (une application logicielle qui g√©n√®re des cl√©s √† usage unique).  Et ce n'est en aucun cas une liste exhaustive. <br><br>  La t√¢che du pentester est de d√©crypter les blobs n√©cessaires et d'obtenir des mots de passe, des cookies, etc. <br><br>  Il existe plusieurs fa√ßons de proc√©der.  D'une mani√®re ou d'une autre, elles se r√©sument toutes √† deux transcriptions - en ligne et hors ligne.  Le d√©cryptage en ligne est lorsque sur la machine de l'utilisateur, nous appelons simplement les fonctions syst√®me pour d√©crypter les donn√©es et passer le blob DPAPI √† l'entr√©e, et le syst√®me fait tout par lui-m√™me - il recherche la cl√© principale avec laquelle le blob a √©t√© crypt√©, le d√©crypte en utilisant le SID de l'utilisateur et un hachage de mot de passe stock√© dans la m√©moire LSASS. <br><br>  La figure ci-dessous montre un exemple d'appel de fonctions DPAPI pour le chiffrement et le d√©chiffrement sur PowerShell. <br><br><img src="https://habrastorage.org/webt/nj/h3/ko/njh3koyjpr5f1yft8o6zllkpjfw.jpeg"><br><br>  Tout d'abord, nous chiffrons notre secret (dans ce cas, le mot ¬´mot de passe¬ª) en appelant la fonction [Security.Cryptography.ProtectedData] :: Protect ().  Et nous le faisons deux fois - dans le premier cas en utilisant la cl√© principale de l'utilisateur (param√®tre CurrentUser), et dans le second - la cl√© principale du syst√®me (param√®tre LocalMachine).  Ensuite, nous pouvons d√©crypter les blobs r√©sultants en appelant la fonction inverse - [Security.Cryptography.ProtectedData] :: UnProtect (). <br><br>  De plus, dans ce cas, la valeur du param√®tre CurrentUser ou LocalMachine n'a pas d'importance, car  le syst√®me lui-m√™me trouve une cl√© principale appropri√©e pour d√©coder le blob et fait tout ce qui est n√©cessaire.  Dans les deux cas, nous obtenons notre secret initial - le mot ¬´mot de passe¬ª (sa repr√©sentation octet par bit). <br><br>  Lors du d√©cryptage en ligne, il est important de comprendre dans quel contexte vous appelez la fonction UnProtect ().  Pour que le d√©chiffrement r√©ussisse, vous devez √™tre dans une session utilisateur ou vous connecter sous une nouvelle session.  La chose est le hachage de mot de passe, qui est stock√© dans la m√©moire LSASS.  Si vous effectuez un appel en dehors de la session de l'utilisateur (par exemple, vous vous √™tes connect√© au syst√®me via le r√©seau via psexec ou meterpreter), vous n'avez donc pas besoin d'un hachage de mot de passe pour d√©chiffrer la cl√© principale.  Il est, bien s√ªr, dans la prochaine session, mais LSASS ne vous le donnera pas, car  il s'agit d'une autre session, bien qu'elle ait √©t√© cr√©√©e sous le m√™me utilisateur.  Pour un d√©cryptage en ligne r√©ussi, vous devez soit migrer vers n'importe quel processus lanc√© par l'utilisateur connect√© via l'interface graphique, soit vous connecter compl√®tement au syst√®me, par exemple via RDP. <br><br>  Une alternative √† PowerShell pour le d√©chiffrement en ligne des objets blob DPAPI peut √™tre un appel √† mimiktaz :: blob avec le param√®tre / Unprotect.  En entr√©e, il re√ßoit un fichier binaire avec un blob DPAPI, et en sortie on obtient des donn√©es d√©crypt√©es.  Plus de cas utilisant mimikatz sont d√©crits <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le blog</a> HarmJ0y. <br><br><h3>  La bille blanche est tomb√©e.  Que faire de ma ferme avec vidyuhi? </h3><br>  √âtant donn√© que les cl√©s principales DPAPI sont chiffr√©es sur le mot de passe de l'utilisateur, vous pouvez essayer le processus inverse - forcer le mot de passe de l'utilisateur par sa cl√© principale.  Par exemple, nous avons re√ßu une connexion inverse de notre macro ou DDE du fichier docx envoy√©.  Nous pouvons prendre la cl√© principale de l'utilisateur et restaurer le mot de passe de l'utilisateur sans escalade de privil√®ges et lancement de mimikatz. <br><br>  Puis-je utiliser Hashcat ou JohnTheRipper pour le mot de passe bruteforce?  Mais avant cela, vous devez obtenir les param√®tres de force brute √† partir de la composition de John avec le script appropri√©: <br><br><pre> <code class="xml hljs">./DPAPImk2john.py ‚ÄìS <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sid</span></span></span><span class="hljs-tag">&gt;</span></span> -mk <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkey</span></span></span><span class="hljs-tag">&gt;</span></span> -c <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain|local</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Ensuite, nous pouvons d√©j√† envoyer le r√©sultat du script √† notre ferme avec des cartes vid√©o et esp√©rons que l'utilisateur a un mot de passe faible, car  la vitesse de la force brute de la cl√© principale est approximativement comparable √† la vitesse d'√©num√©ration WPA2, c'est-√†-dire  assez lentement. <br><br>  Il convient de noter ici que dans le cas o√π une cl√© principale est g√©n√©r√©e sur un domaine Windows 10, 10 000 autres cycles d'algorithme PBKDF2 sont ajout√©s √† la g√©n√©ration de Prekey.  Mais pire encore, ni Hashcat ni JohnTheRipper ne le savent (au moins au moment d'√©crire ces lignes), ce qui signifie qu'ils ne pourront pas supprimer le mot de passe d'une telle cl√© principale. <br><br><h3>  "Pour enlever tout ce qui est mauvais, puis pour le d√©couvrir ..." </h3><br>  Comme nous l'avons not√© pr√©c√©demment, l'ex√©cution d'actions suspectes sur la machine de l'utilisateur peut susciter un int√©r√™t suppl√©mentaire de la part de l'√©quipe Blueteam, et cela, en cons√©quence, est lourd du fait que tout RedTeam s'arr√™tera l√†.  Un exemple est le lancement de PowerShell sur l'ordinateur d'un comptable ou d'une secr√©taire, suivi d'une enqu√™te sur l'incident.  Afin de ne pas cr√©er de suspicion inutile, il est pr√©f√©rable d'utiliser des m√©thodes hors ligne pour d√©coder les blobs DPAPI.  Pour ce faire, vous devez d'abord r√©cup√©rer tout ce dont vous avez besoin sur la machine, √† savoir: <br><br><ul><li>  Cl√©s ma√Ætresses utilisateur </li><li>  Cl√©s principales du syst√®me </li><li>  Fichier CREDHIST (s'il ne s'agit pas d'une machine de domaine); </li><li>  Mot de passe utilisateur (ou son hachage sha1 / ntlm); </li><li>  SID de l'utilisateur; </li><li>  Blobs DPAPI que nous voulons d√©crypter. </li></ul><br>  Pour le d√©chiffrement en mode hors ligne, on ne peut pas se passer d'outils sp√©cialis√©s.  Ces outils peuvent √™tre: <br><br><ul><li>  Mimikatz; </li><li>  Impacket (√† partir de la 18e version, il dispose de la fonctionnalit√© DPAPI); </li><li>  Framework Dpapick. </li></ul><br>  Il s'agit du framework dpapick dont nous parlerons plus en d√©tail. <br><br>  Le framework python dpapick lui-m√™me a √©t√© r√©alis√© par le chercheur Jean-Michel Pikode en 2014 et est une impl√©mentation des m√©canismes DPAPI sur les crypto-biblioth√®ques Python.  L'utilisation de python, ainsi que la structure du framework, permettent de l'adapter facilement aux diff√©rents m√©canismes DPAPI.  Dans sa version d'origine, dpapick n'√©tait pas en mesure d'utiliser la cl√© de sauvegarde de domaine pour d√©chiffrer les cl√©s principales et il manquait des m√©canismes pour d√©chiffrer les cl√©s principales cr√©√©es sur Windows 10 en mode machine de domaine. <br><br>  Apr√®s avoir corrig√© ces lacunes et √©tendu la fonctionnalit√© de d√©cryptage des objets blob DPAPI, dpapick s'est transform√© en un tr√®s bon outil pour le d√©codage hors ligne de DPAPI.  Ci-dessous, √† titre d'exemples, nous montrerons les options d'utilisation de ce cadre pour d√©chiffrer les donn√©es utilisateur chiffr√©es via DPAPI. <br><br><h3>  Chrome - prenez et d√©chiffrez les cookies et les mots de passe </h3><br>  Les <code>%localappdata%\Google\Chrome\User Data\Default\Cookies</code> Chrome sont stock√©s dans le fichier <code>%localappdata%\Google\Chrome\User Data\Default\Cookies</code> <br>  Les donn√©es de connexion se <code>%localappdata%\Google\Chrome\User Data\Default\Login Data</code> dans le fichier <code>%localappdata%\Google\Chrome\User Data\Default\Login Data</code> <br><br>  Les deux fichiers sont des bases de donn√©es sqlite3 dans lesquelles des donn√©es sensibles sont stock√©es en tant qu'objets blob DPAPI.  Dans le cadre de dpapick, il existe un dissecteur (analyseur) pr√™t √† l'emploi de ces donn√©es (examples / chrome.py).  Pour un d√©cryptage r√©ussi, il doit sp√©cifier le r√©pertoire avec les cl√©s principales, le sid de l'utilisateur, son mot de passe ou l'emplacement de la cl√© priv√©e du contr√¥leur de domaine, ainsi que le fichier sqlite3 de Chrome (cookie ou donn√©es de connexion). <br><br>  D√©cryptage hors ligne du cookie Chrome avec mot de passe utilisateur <br><br><pre> <code class="xml hljs">./chrome.py --cookie <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cookiefile</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  D√©cryptage hors connexion d'un cookie Chrome √† l'aide d'un hachage √† partir du mot de passe d'un utilisateur <br><br><pre> <code class="xml hljs">./chrome.py --cookie <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cookiefile</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span> --hash <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  D√©cryptage hors ligne des mots de passe Chrome √† l'aide d'une cl√© priv√©e √† partir d'un contr√¥leur de domaine <br><br><pre> <code class="xml hljs">./chrome.py --chrome <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">login</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">&gt;</span></span> --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rsa-priv.pem</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  DPAPI pour les certificats clients </h3><br>  Les certificats clients sont beaucoup utilis√©s o√π - pour g√©n√©rer OTP, EFS ou l'authentification dans VPN, applications Web, etc. <br><br>  Les certificats de cl√© publique eux-m√™mes sont stock√©s dans le profil utilisateur: <br> <code>%APPDATA%\Microsoft\SystemCertificates\My\Certificates\</code> <br>  Et les cl√©s priv√©es, √† l'aide desquelles la signature est r√©ellement effectu√©e ou d'autres op√©rations cryptographiques sont crypt√©es via DPAPI et sont √©galement situ√©es dans le profil utilisateur le long du chemin: <br><br><pre> <code class="bash hljs">%APPDATA%\Roaming\Microsoft\Crypto\RSA\&lt;SID&gt;\</code> </pre> <br>  Afin de d√©chiffrer avec succ√®s les cl√©s de certificat priv√©es, puis de recr√©er les fichiers PFX, en plus des fichiers ci-dessus, nous avons √©galement besoin des cl√©s principales de l'utilisateur, ainsi que de son SID et de son mot de passe (ou d'une cl√© RSA priv√©e du contr√¥leur). <br><br>  En utilisant Dpapick et le mot de passe utilisateur, nous d√©cryptons ceci: <br><br><pre> <code class="xml hljs">./efs.py --certificates <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cert</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --rsakyes <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RSA</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/tx/kf/bp/txkfbp91hcb6pg_rq7wgh8w7v5u.jpeg"><br><br>  Le param√®tre facultatif rsaout dans la capture d'√©cran vous permet en outre d'exporter des cl√©s RSA d√©chiffr√©es au format PEM.  Le r√©sultat du script est un fichier PFX recr√©√© sans mot de passe, qui peut d√©j√† √™tre import√© pour vous-m√™me et utilis√© aux fins pr√©vues.  Si dans les r√©pertoires ci-dessus il y a plusieurs certificats et cl√©s priv√©es, alors dpapick essaiera de d√©crypter chacun d'eux et de cr√©er plusieurs fichiers pfx. <br><br>  Les m√™mes actions peuvent √™tre effectu√©es √† l'aide d'une cl√© priv√©e de domaine pour d√©chiffrer la cl√© principale en sp√©cifiant le param√®tre appropri√©: <br><br><pre> <code class="xml hljs">./efs.py --certificates <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cert</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --rsakyes <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RSA</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">masterkeydir</span></span></span><span class="hljs-tag">&gt;</span></span> --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bkp</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  Un peu plus sur les "puces" du domaine </h3><br>  En parlant du domaine Active Directory, il convient de mentionner une fonctionnalit√© aussi merveilleuse que l'itin√©rance des informations d'identification - une fonction de domaine lorsque les cl√©s principales, les mots de passe crypt√©s et les certificats ¬´voyagent¬ª pour l'utilisateur dans tout le domaine Active Directory.  Ils ne sont pas li√©s √† une machine sp√©cifique et ¬´arrivent¬ª √† l'ordinateur sur lequel l'utilisateur du domaine se connecte. <br><br>  Lorsque cette "fonctionnalit√©" est activ√©e, tous les certificats que l'utilisateur importe, ainsi que toutes ses cl√©s et mots de passe priv√©s, volent dans AD et sont stock√©s dans les attributs de compte correspondants: msPKIAccountCrdentailas et msPKIDPAPIMasterKeys. <br><br>  Vous pouvez voir √† quoi il ressemble dans AD, par exemple, via ldapsearch: <br><br><pre> <code class="xml hljs">ldapsearch -x -h dc1.lab.local -D ‚Äúuser1@lab.local" -s sub "samAccountname=user1" ldapsearch -x -h dc1.lab.local -D "admin@lab.local" -s sub "samAccountname=anyuser"</code> </pre> <br><img src="https://habrastorage.org/webt/vl/sh/01/vlsh019lykontfubtr-g5rx__dc.jpeg"><br><br>  Par d√©faut, un utilisateur ne peut recevoir que des attributs DPAPI pour son compte.  Mais avec des privil√®ges √©lev√©s, cela peut √™tre fait pour n'importe quel compte, y compris un compte d'ordinateur. <br><br>  L'itin√©rance des informations d'identification est une technologie tr√®s pratique non seulement pour les administrateurs, mais aussi pour les pentesters.  Apr√®s avoir acc√©d√© au contr√¥leur de domaine via ldap, vous pouvez fusionner tous les certificats utilisateur, ses cl√©s principales et mots de passe crypt√©s via DPAPI (par exemple, les mots de passe pour la connexion aux lecteurs r√©seau). <br><br>  Et pourquoi ne pas ajouter une telle fonctionnalit√© √† dpapick, nous avons pens√© - et lui avons appris √† extraire automatiquement les certificats d'un contr√¥leur de domaine via ldap, √† les d√©chiffrer et √† g√©n√©rer des fichiers pfx. <br><br><pre> <code class="xml hljs">./efs.py ‚Äìldap-server <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --ldap-connect admin:Passw0rd@lab.local --ldap-user user1 --password Password1 ./efs.py ‚Äìldap-server <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --ldap-connect admin:Passw0rd@lab.local --ldap-user user1 --pkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rsa-priv.pem</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><img src="https://habrastorage.org/webt/an/_p/bi/an_pbimm2jjr-iuapm945q43rzs.jpeg"><br><br>  Pour ex√©cuter le script, il est n√©cessaire de sp√©cifier le contr√¥leur de domaine en tant que serveur LDAP, les d√©tails de la connexion √† celui-ci, le nom du compte pour lequel nous recevons des certificats et un mot de passe pour d√©chiffrer la cl√© principale (ou une cl√© de sauvegarde priv√©e du contr√¥leur). <br><br><h3>  Dropbox  Parti en 60 secondes ... </h3><br>  Dropbox est un autre exemple d'utilisation de DPAPI pour stocker des secrets d'utilisateur.  Les jetons d'autorisation pour Dropbox sont stock√©s dans des fichiers: <br><br><pre> <code class="bash hljs">c:\users\&lt;username&gt;\Appdata\Local\Dropbox\instance1\config.dbx c:\users\&lt;username&gt;\Appdata\Local\Dropbox\instance_db\instanse.dbx</code> </pre> <br>  Ce sont des bases de donn√©es sqlite3 chiffr√©es contenant des donn√©es pour la connexion.  Pour le chiffrement, une cl√© sym√©trique est utilis√©e, qui √† son tour est chiffr√©e via DPAPI et stock√©e dans le registre: <br><br> <code>HKCU\SOFTWARE\Dropbox\ks <br> HKCU\SOFTWARE\Dropbox\ks1</code> <br> <br>  Ainsi, l'ordre g√©n√©ral de d√©tournement de dropbox est le suivant: <br><br><ol><li>  nous prenons deux fichiers de base de donn√©es de l'ordinateur; </li><li>  nous obtenons les cl√©s du registre et les d√©cryptons en utilisant dpapick; </li><li>  en utilisant DPAPI, nous chiffrons les cl√©s re√ßues sur notre machine et les mettons dans le registre; </li><li>  sur notre machine, nous rempla√ßons les fichiers de base de donn√©es et ex√©cutons Dropbox. </li></ol><br>  Vous devez savoir que des autorisations sp√©ciales sont d√©finies pour les branches de registre ci-dessus.  Ils ne peuvent √™tre lus que par l'utilisateur.  Ni l'administrateur ni le syst√®me ne peuvent les lire.  Ainsi, si vous acc√©dez au registre au nom d'un autre utilisateur (m√™me un administrateur), vous devez d'abord d√©finir les autorisations appropri√©es sur les branches de registre sp√©cifi√©es.  Par exemple, alors (PowerShell): <br><br><pre> <code class="xml hljs">$Sid="S-1-5-21-3463664321-2923530833-3546627382-1000"; $key=[Microsoft.Win32.Registry]::USERS.OpenSubKey("$sid\SOFTWARE\Dropbox\ks",[Microsoft.Win32.RegistryKeyPermissionCheck]::ReadWriteSubTree,[System.Security.AccessControl.RegistryRights]::ChangePermissions); $acl = $key.GetAccessControl(); $rule = New-Object System.Security.AccessControl.RegistryAccessRule ("administrator","FullControl","Allow"); $acl.SetAccessRule($rule); $key.SetAccessControl($acl); $key_path = "REGISTRY::HKEY_USERS\$Sid\SOFTWARE\Dropbox\ks"; (Get-ItemProperty -Path $key_path -Name Client).Client;</code> </pre> <br>  Les cl√©s ks et ks1 contiennent l'en-t√™te (8 octets) de la version dbx avant le blob DPAPI et le blob md5 HMAC DPAPI (16 derniers octets).  Le blob DPAPI lui-m√™me commence par le 9e octet 0x01000000D0 ... Ces octets doivent √™tre copi√©s au format base64 dans un fichier, qui est ensuite d√©chiffr√© via dpapick: <br><br><pre> <code class="xml hljs">./filegeneric.py --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --base64file <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Ensuite, sur votre machine, vous devez crypter les cl√©s re√ßues √† la derni√®re √©tape avec notre cl√© principale et mettre le r√©sultat dans les branches de registre appropri√©es. <br><br>  Pour le chiffrement, il est plus pratique d'utiliser PowerShell: <br><br><pre> <code class="xml hljs">$hdata="4efebbdf394d4003317fc5c357beac4b"; [Byte[]] $dv0_entropy = 0xd1,0x14,0xa5,0x52,0x12,0x65,0x5f,0x74,0xbd,0x77,0x2e,0x37,0xe6,0x4a,0xee,0x9b; $data = ($hdata -split "(?<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">=\G\w{2})(?=\w{2})"</span></span></span><span class="hljs-tag"> | %{ [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Convert</span></span></span><span class="hljs-tag">]</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">::ToByte</span></span></span><span class="hljs-tag">( $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">_</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">16</span></span></span><span class="hljs-tag"> ) }); </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Add-Type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-AssemblyName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">System.Security</span></span></span><span class="hljs-tag">; $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dk1</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">[system.security.cryptography.protecteddata]::Protect($data,$dv0_entropy,[System.Security.Cryptography.DataProtectionScope]::CurrentUser);</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pr</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">([System.BitConverter]::ToString($dk1));$pr</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OBJ_hmac</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">New-Object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">System.Security.Cryptography.HMACMD5</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hmac</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">$OBJ_hmac.ComputeHash($dk1)</span></span></span><span class="hljs-tag"> $</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pr</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">([System.BitConverter]::ToString($hmac));$pr</span></span></span></span></code> </pre> <br>  Dans ce cas, hdata est la cl√© re√ßue au stade du d√©chiffrement.  dv0_entropy est la constante d'entropie utilis√©e par DBOX dans DPAPI.  Au blob r√©sultant, vous devez attribuer un en-t√™te de 8 octets 0x00000000F6000000 √† l'avant et HMACMD5 + 0x00 √† l'arri√®re <br>  Apr√®s cela, vous pouvez √©crire des donn√©es dans les cl√©s de registre appropri√©es. <br><br><h3>  DPAPI et RSA SecurID </h3><br>  RSA SecurID est un programme client utilis√© pour g√©n√©rer un mot de passe √† usage unique, d√©velopp√© par RSA. <br><br>  Il est assez populaire pour les grandes entreprises et utilise √©galement le DPAPI, mais un peu plus compliqu√©.  Dans ce cas, les ing√©nieurs RSA ont d√©cid√© de devenir confus et ont appliqu√© des sch√©mas DPAPI plus complexes. <br><br>  Les donn√©es de jeton sont stock√©es dans le fichier <code>%LOCALAPPDATA%\RSA\SecurIDStorage</code> , qui est la base de donn√©es sqlite3.  Chaque jeton chiffr√© contient son EnTokenSid chiffr√© (param√®tres pour l'initialisation initiale de l'algorithme de g√©n√©ration de code).  EnTokenSid est g√©n√©r√© sur la base de DBKey, SID du jeton et SID utilisateur, et DBKey est d√©j√† g√©n√©r√© par le d√©cryptage DPAPI DBKeyEnc dans la s√©quence suivante: <br> <code>DBKeyEnc = DPAPI(CurrenUser, DPAPI(LocalSystem(DBKey))</code> <br> <br>  C'est-√†-dire  Tout d'abord, la cl√© DB est chiffr√©e avec la cl√© principale du syst√®me, puis le blob DPAPI r√©sultant est √† nouveau chiffr√© avec la cl√© principale de l'utilisateur. <br><br>  √âgalement dans la base de donn√©es, il y a CryptoCheckSum de CheckSum: <br>  CryptoCheckSum = blob DPAPI (CurrenUser) <br><br>  Ainsi, pour que le SecurIDStorage fusionn√© fonctionne sur votre machine, vous devez: <br><br><ol><li>  En raison du fait que le SID de l'utilisateur est impliqu√© dans la formation du EncTokenSid, il est n√©cessaire de d√©finir le SID de l'utilisateur actuel dans la machine virtuelle √† la m√™me valeur que le SID de l'utilisateur dont la base SecurIDStorage est prise.  L'utilitaire NewSid de SysInternals nous y aidera; </li><li>  D√©chiffrer DBKeyEnc en utilisant la cl√© principale et le mot de passe de l'utilisateur ou la cl√© priv√©e du domaine (dans le cas o√π la machine est un domaine); </li><li>  D√©chiffrez le r√©sultat du d√©chiffrement pr√©c√©dent √† l'aide de la cl√© principale du syst√®me et de la valeur du param√®tre DPAPI_SYSTEM; </li><li>  D√©chiffrer CryptoCheckSum √† l'aide de la cl√© principale de l'utilisateur </li><li>  Chiffrez les valeurs DBKey et CheckSum re√ßues dans l'ordre inverse d√©j√† sur votre machine virtuelle; </li><li>  Dans certaines versions de SecurID, vous devrez √©galement d√©finir la taille du disque dur de la machine virtuelle sur la m√™me taille que la taille du disque dur de la machine source, comme  le programme le v√©rifie au d√©marrage. </li></ol><br>  Comme mentionn√© ci-dessus, afin de d√©chiffrer DBKeyEnc, en plus de la cl√© principale de l'utilisateur, nous aurons √©galement besoin d'une cl√© principale du syst√®me, ainsi que de la valeur DPAPI_SYSTEM, avec laquelle les cl√©s principales du syst√®me sont d√©chiffr√©es.  DAPPI_SYSTEM est en fait un pr√©puce d√©j√† form√©, participant √† la formation des cl√©s principales du syst√®me.  Vous pouvez l'obtenir √† partir de la m√©moire LSASS (via mimikatz ou en analysant le vidage de processus) ou √† partir des branches de registre correspondantes (HKLM \ SYSTEM, HKLM \ SECURITY), en les vidant et en analysant le m√™me Impacket. <br><br>  Ensuite, nous pouvons utiliser le DPAPI_SYSTEM obtenu pour d√©chiffrer les blobs n√©cessaires √† l'aide de dpapick (l'analyseur est examples / filegeneric.py), comme indiqu√© dans les captures d'√©cran suivantes: <br><br>  1) Mise en ligne de DPAPI_SYSTEM via mimikatz <br><br><img src="https://habrastorage.org/webt/ww/xi/ov/wwxiovhm-6gdcbn7tmmpr7-qsim.jpeg"><br><br>  2) Obtenir DPAPI_SYSTEM via Impacket hors ligne <br><br><img src="https://habrastorage.org/webt/s7/9v/5g/s79v5gxvzjjccekaklg8gtefyfw.jpeg"><br><br>  3) D√©cryptage DPAPIck avec les cl√©s principales utilisateur et syst√®me <br><br><img src="https://habrastorage.org/webt/ip/th/qm/ipthqmqacvzvixntzgk_n1vsgvs.jpeg"><br><br><h3>  Feuille de triche </h3><br>  Afin de ne pas oublier la place de donn√©es sp√©cifiques, nous les placerons dans une section distincte: <br><br>  <b>Cl√©s principales personnalis√©es</b> <br><br><pre> <code class="bash hljs">%APPDATA%\Microsoft\Protect\&lt;SID&gt;\*</code> </pre> <br>  <b>Cl√©s principales du syst√®me</b> <br><br><pre> <code class="bash hljs">Windows\System32\Microsoft\Protect\*</code> </pre> <br>  <b>DPAPI_SYSTEM</b> <br><br><pre> <code class="bash hljs">LSASecrets ‚Äì online SYSTEM, SECURITY (reg save ‚Ä¶, system\backup, etc)</code> </pre> <br>  <b>Certificats utilisateur</b> <br><br><pre> <code class="bash hljs">%APPDATA%\Microsoft\SystemCertificates\My\Certificates\ %APPDATA%\Microsoft\Crypto\RSA\&lt;SID&gt;\</code> </pre> <br>  <b>Certificats syst√®me</b> <br><br><pre> <code class="bash hljs">HKLM:\SOFTWARE\Microsoft\SystemCertificates\MY\Certificates\* C:\Programdata\Microsoft\Crypto\RSA\MachineKeys\</code> </pre> <br>  <b>Chrome</b> <br><br><pre> <code class="bash hljs">%localappdata%\Google\Chrome\User Data\Default\Cookies %localappdata%\Google\Chrome\User Data\Default\Login Data</code> </pre> <br>  <b>Dropbox</b> <br><br><pre> <code class="bash hljs">HKCU\SOFTWARE\Dropbox\ks HKCU\SOFTWARE\Dropbox\ks1 %APPDATA%\Local\Dropbox\instance1\config.dbx %APPDATA%\Local\Dropbox\instance_db\instanse.dbx</code> </pre> <br>  <b>Rsa securid</b> <br><br><pre> <code class="bash hljs">%LOCALAPPDATA%\RSA\SecurIDStorage</code> </pre> <br><h3>  Petite conclusion </h3><br>  Le DPAPI est une chose magnifique - l'essentiel est de comprendre comment il peut √™tre utilis√© lors des pentests et des √©tudes RedTeam. <br><br>  Dans cet article, nous avons examin√© quelques exemples o√π le d√©chiffrement DPAPI peut √™tre appliqu√©.  En fait, la port√©e est beaucoup plus large.  Par exemple, nous n'avons pas consid√©r√© les cl√©s RDP (* .rdg), Icloud (fichier pList), Skype (*. Xml) pour la connexion au Wi-Fi.  Partout DPAPI est appliqu√© et les parseurs correspondants sont impl√©ment√©s dans le cadre du framework dpapick. <br><br>  Une version modifi√©e de dpapick est disponible sur notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> .  Nous vous invitons √† utiliser cet outil pour d√©crypter DPAPI et nous vous serons reconnaissants pour le d√©veloppement de dpapick. <br><br>  Et des informations int√©ressantes peuvent √™tre trouv√©es dans notre cha√Æne dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">t√©l√©grammes</a> .  Nous racontons IB √† travers les yeux de RedTeam. <br><br>  PS Merci aux organisateurs d'OFFZONE-2018 pour une conf√©rence sympa! <br><br>  PPS La deuxi√®me partie de l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434514/">https://habr.com/ru/post/fr434514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434504/index.html">20 ans de rapports rapides "Le produit a √©t√© cr√©√© en un souffle, juste haut ..."</a></li>
<li><a href="../fr434506/index.html">Exp√©rience de publication d'une application de montage vid√©o dans le Microsoft Store</a></li>
<li><a href="../fr434508/index.html">Le c√¥t√© obscur du marketing sur les moteurs de recherche: comment et pourquoi Google recueille nos informations personnelles</a></li>
<li><a href="../fr434510/index.html">En bref sur l'utilisation de RabbitMQ de Python</a></li>
<li><a href="../fr434512/index.html">Corporate corporate</a></li>
<li><a href="../fr434516/index.html">Un moyen simple de r√©pondre √† vos aspirations professionnelles.</a></li>
<li><a href="../fr434518/index.html">Applaudissements et acclamations: drame soigneusement contr√¥l√© dans les magasins Apple</a></li>
<li><a href="../fr434522/index.html">Mod√®les de justification des t√¢ches et antipatterns</a></li>
<li><a href="../fr434524/index.html">Kubernetes Ingress √† travers les yeux d'un d√©butant</a></li>
<li><a href="../fr434528/index.html">D√©cryptage de Ray Tracer au format carte postale</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>