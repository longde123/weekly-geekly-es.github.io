<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙇🏽 🧒🏾 😔 Meluruskan Perl dari tahun 1987 🌠 🏽 🚵🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setelah membaca berita " Kode penerjemah Perl secara resmi porting ke GitHub " di LINUX.ORG.RU, saya memutuskan untuk melihat repositori Perl 5, yang ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Meluruskan Perl dari tahun 1987</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473228/"> Setelah membaca berita " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Kode penerjemah Perl secara resmi porting ke GitHub, berita tentang sumber daya LINUX.ORG.RU">Kode penerjemah Perl secara resmi porting ke GitHub</a> " di LINUX.ORG.RU, saya memutuskan untuk melihat repositori Perl 5, yang sekarang sudah ada di GitHub. <br><br>  Sungguh menakjubkan bagaimana mereka gemetar dengan kekaguman dan kualitas, menjaga tidak hanya benar-benar seluruh sejarah 32 tahun proyek, tetapi juga laporan bug (masuk ke Masalah), tambalan (masuk ke PR), rilis dan cabang.  Tulisan " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="32 tahun yang lalu di file sumber Perl, repositori Perl 5 GitHub resmi.">32 tahun yang lalu</a> " di sebelah file menyebabkan senyum tanpa disengaja. <br><br>  Apa lagi yang harus dilakukan pada Jumat malam yang membosankan ini, ketika hujan dan salju gerimis tidak menyenangkan di jalan, dan semua jalan setapak terperosok dalam lumpur musim gugur?  Itu benar, mata merah!  Jadi demi percobaan dan minat, saya memutuskan untuk mengambil dan merakit Perl kuno pada mesin x86_64 modern dengan versi terbaru <strong>GCC 9.2.0</strong> sebagai kompiler.  Bisakah kode lama seperti itu melewati ujian waktu? <br><br><div style="text-align:center;"><img title="Demonstrasi twm, salah satu manajer jendela pertama untuk Sistem X Window, pada distribusi Arch Linux modern." src="https://habrastorage.org/webt/-0/d5/wt/-0d5wtkg6ylqdd-h5g1hbtdiypi.png"></div><br>  <i>Demonstrasi <strong>twm</strong> , salah satu manajer jendela pertama untuk Sistem X Window, pada distribusi Arch Linux modern.</i> <br><br>  Untuk sepenuhnya otentik dan nekromantnenko, saya menggunakan mesin virtual dengan bare X dan window manager <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="twm, halaman Wikipedia.">twm</a> , yang juga berasal dari tahun 1987.  Siapa tahu, mungkin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Larry Wall, halaman Wikipedia.">Larry Wall</a> menulis Perl menggunakan tepat <strong>twm</strong> , sehingga untuk berbicara <em>teknologi pendarahan</em> saat itu.  Distribusi yang digunakan adalah Arch Linux.  Hanya karena ada beberapa hal berguna dalam repositori yang berguna nanti.  Jadi ayo pergi! <br><a name="habracut"></a><br><a name="article-content"></a><h2>  Konten: </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">1. Persiapan lingkungan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">2. Mengkonfigurasi kode sumber</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">3. Kesalahan tata bahasa file Yacc</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">4. Kesalahan penyusunan kode pada "C"</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">5. Koreksi beberapa kesalahan Segmentasi kesalahan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">6. Untuk meringkas</a> <br><br><a name="environment"></a><h2>  1. Persiapan lingkungan </h2><br>  Pertama, kita menginstal pada sistem operasi yang dikerahkan dalam mesin virtual semua set utilitas dan kompiler yang diperlukan untuk merakit dan mengedit kode sumber: <strong>gcc</strong> , <strong>make</strong> , <strong>vim</strong> , <strong>git</strong> , <strong>gdb</strong> , dll. Beberapa dari mereka sudah diinstal, sementara yang lain tersedia dalam paket meta <strong>base-devel</strong> , itu harus diinstal jika tidak diinstal.  Setelah lingkungan siap beraksi, kami mendapatkan salinan kode sumber Perl yang berusia 32 tahun! <br><br><pre><code class="bash hljs">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/Perl/perl5/ --depth=1 -b perl-1.0</code> </pre> <br>  Berkat fitur Git, kami tidak perlu menyeret banyak file untuk sampai ke rilis pertama proyek: <br><br><pre> <code class="plaintext hljs">* commit 8d063cd8450e59ea1c611a2f4f5a21059a2804f1 (grafted, HEAD, tag: perl-1.0) Commit: Larry Wall &lt;lwall@jpl-devvax.jpl.nasa.gov&gt; CommitDate: Fri Dec 18 00:00:00 1987 +0000 a "replacement" for awk and sed</code> </pre><br>  Kami hanya mengunduh sejumlah kecil data dan sebagai hasilnya, repositori dengan kode sumber versi pertama Perl hanya membutuhkan 150 KB. <br><br>  Pada waktu yang gelap dan padat itu tidak ada hal mendasar seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="GNU Autotools, halaman Wikipedia.">autotool</a> ( <em>betapa berkahnya!</em> ), Namun, ada skrip <strong>Konfigurasi</strong> di root repositori.  Ada apa?  Tetapi kenyataannya adalah bahwa Larry Wall adalah penemu skrip semacam itu yang memungkinkan menghasilkan Makefile untuk mesin UNIX yang paling beraneka ragam pada waktu itu.  Seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Konfigurasikan skrip, Riwayat, halaman Wikipedia.">artikel</a> Wikipedia tentang skrip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Konfigurasikan skrip, Riwayat, halaman Wikipedia.">dengan nama yang sama</a> mengatakan, Larry Wall menyediakan file <strong>Configure</strong> dengan beberapa perangkat lunaknya, misalnya, pembaca berita, tiga tahun lagi sebelum menulis Perl.  Selanjutnya, Perl tidak terkecuali, dan skrip yang sudah berjalan pada banyak mesin digunakan untuk membangunnya.  Kemudian, pengembang lain, misalnya, programmer dari Trolltech, juga mengambil ide ini.  Mereka menggunakan skrip yang serupa untuk mengonfigurasi pembuatan kerangka Qt mereka, yang membingungkan banyak orang dengan <strong>konfigurasi</strong> dari <strong>autotools</strong> .  Itu adalah kebun binatang dari skrip semacam itu dari pengembang yang berbeda yang berfungsi sebagai dorongan untuk membuat alat untuk generasi mereka yang disederhanakan dan otomatis. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><em>&lt;&lt; Lompat ke konten</em></a> <br><br><a name="configure"></a><h2>  2. Mengkonfigurasi kode sumber </h2><br>  Skrip <strong>Konfigurasi</strong> "sekolah lama", yang sudah terbukti dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Shebang, Unix, halaman Wikipedia.">Shebang</a> ', yang memiliki spasi: <br><br><pre> <code class="bash hljs">$ cat Configure | head -5 <span class="hljs-comment"><span class="hljs-comment">#! /bin/sh # # If these # comments don't work, trim them. Don't worry about any other # shell scripts, Configure will trim # comments from them for you. #</span></span></code> </pre><br>  Menurut komentar, ternyata ada kerang di skrip yang tidak mungkin untuk meninggalkan komentar!  Situasi ruang terlihat tidak biasa, tetapi begitu ini adalah norma, lihat tautan untuk informasi lebih lanjut di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Apakah ruang diizinkan di antara #! dan / bin / bash di shebang? - Unix dan Linux Stack Exchange.">sini</a> .  Yang paling penting, tidak ada perbedaan bagi penafsir shell modern apakah ada ruang atau tidak. <br><br>  Cukup dengan liriknya, mari kita mulai bisnis!  Kami memulai skrip dan melihat asumsi yang menarik, yang ternyata tidak sepenuhnya benar: <br><br><pre> <code class="plaintext hljs">$ ./Configure (I see you are using the Korn shell. Some ksh's blow up on Configure, especially on exotic machines. If yours does, try the Bourne shell instead.) Beginning of configuration questions for perl kit. Checking echo to see how to suppress newlines... ...using -n. Type carriage return to continue. Your cursor should be here--&gt;</code> </pre><br>  Anehnya, skripnya interaktif dan berisi banyak sekali informasi latar belakang yang beragam.  Model interaksi pengguna dibangun di atas dialog, menganalisis jawaban di mana skrip mengubah parameternya, yang menurutnya selanjutnya akan menghasilkan Makefiles.  Saya pribadi tertarik untuk memeriksa apakah semua perintah shell sudah ada? <br><br><pre> <code class="plaintext hljs">Locating common programs... expr is in /bin/expr. sed is in /bin/sed. echo is in /bin/echo. cat is in /bin/cat. rm is in /bin/rm. mv is in /bin/mv. cp is in /bin/cp. tr is in /bin/tr. mkdir is in /bin/mkdir. sort is in /bin/sort. uniq is in /bin/uniq. grep is in /bin/grep. Don't worry if any of the following aren't found... test is in /bin/test. egrep is in /bin/egrep. I don't see Mcc out there, offhand.</code> </pre><br>  Rupanya sebelum ini jauh dari kasus.  Saya ingin tahu apa yang menjadi tanggung jawab utilitas <strong>PKS</strong> , yang tidak dapat ditemukan?  Yang lucu adalah bahwa skrip ini dalam tradisi hacker terbaik saat itu penuh dengan humor ramah.  Sekarang Anda hampir tidak akan melihat ini: <br><br><pre> <code class="plaintext hljs">Is your "test" built into sh? [n] (OK to guess) OK Checking compatibility between /bin/echo and builtin echo (if any)... They are compatible. In fact, they may be identical. Your C library is in /lib/libc.a. You're normal. Extracting names from /lib/libc.a for later perusal...done Hmm... Looks kind of like a USG system, but we'll see... Congratulations. You aren't running Eunice. It's not Xenix... Nor is it Venix... Checking your sh to see if it knows about # comments... Your sh handles # comments correctly. Okay, let's see if #! works on this system... It does. Checking out how to guarantee sh startup... Let's see if '#!/bin/sh' works... Yup, it does.</code> </pre><br>  Saya menjawab sebagian besar pertanyaan dengan nilai default, atau dengan apa yang ditawarkan skrip kepada saya.  Yang terutama senang dan terkejut adalah permintaan bendera untuk penyusun dan tautan: <br><br><pre> <code class="plaintext hljs">Any additional cc flags? [none] Any additional ld flags? [none]</code> </pre><br>  Di sana Anda dapat menulis sesuatu yang menarik, misalnya, <strong>-m32</strong> untuk membangun file yang dapat dieksekusi 32-bit atau perpustakaan, yang diperlukan selama menghubungkan.  Untuk pertanyaan skrip terakhir: <br><br><pre> <code class="plaintext hljs">Now you need to generate make dependencies by running "make depend". You might prefer to run it in background: "make depend &gt; makedepend.out &amp;" It can take a while, so you might not want to run it right now. Run make depend now? [n] y</code> </pre><br>  Saya menjawab dengan positif.  Dilihat oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="makedepend, History, halaman Wikipedia.">halaman</a> Wikipedia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="makedepend, History, halaman Wikipedia.">-nya</a> , utilitas kuno yang diciptakan diciptakan pada awal kehidupan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Proyek Athena, halaman Wikipedia.">proyek Athena</a> untuk memfasilitasi pekerjaan dengan Makefiles.  Proyek ini memberi kami Sistem X Window, Kerberos, Zephyr dan memengaruhi banyak hal lain yang akrab saat ini.  Semua ini luar biasa, tetapi dari mana datangnya utilitas ini di lingkungan Linux modern?  Sudah lama digunakan oleh siapa pun dan di mana saja.  Tetapi jika Anda melihat dengan dekat pada akar repositori, ternyata Larry Wall menulis versi skrip penggantinya, yang kami bungkus dengan hati-hati dan mengeksekusi skrip konfigurasi. <br><br>  <strong>Makedepend</strong> dilengkapi dengan beberapa kesalahan aneh: <br><br><pre> <code class="bash hljs">./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 82: unexpected EOF <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> looking <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> matching `<span class="hljs-string"><span class="hljs-string">''</span></span> ./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 83: syntax error: unexpected end of file ./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 82: unexpected EOF <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> looking <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> matching `<span class="hljs-string"><span class="hljs-string">''</span></span> ./makedepend: <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> substitution: line 83: syntax error: unexpected end of file</code> </pre><br>  Mungkin merekalah yang menyebabkan masalah karena Makefile yang dihasilkan sedikit dikunyah: <br><br><pre> <code class="bash hljs">$ make make: *** No rule to make target <span class="hljs-string"><span class="hljs-string">'&lt;built-in&gt;'</span></span>, needed by <span class="hljs-string"><span class="hljs-string">'arg.o'</span></span>. Stop.</code> </pre><br>  Saya benar-benar tidak ingin pergi ke hutan mie kerang yang rumit dari utilitas yang <strong>tergantung pada</strong> dan saya memutuskan untuk hati-hati melihat Makefiles, di mana pola aneh muncul: <br><br><pre> <code class="plaintext hljs">arg.o: arg.c arg.o: arg.h arg.o: array.h arg.o: &lt;built-in&gt; arg.o: cmd.h arg.o: &lt;command-line&gt; arg.o: config.h arg.o: EXTERN.h ... array.o: arg.h array.o: array.c array.o: array.h array.o: &lt;built-in&gt; array.o: cmd.h array.o: &lt;command-line&gt; array.o: config.h array.o: EXTERN.h ...</code> </pre><br>  Rupanya beberapa utilitas salah memasukkan argumennya ke knalpot.  Mengambil <strong>sed</strong> utilitas <s>kapak</s> <strong>,</strong> saya memutuskan untuk sedikit memperbaiki hal ini: <br><br><pre> <code class="bash hljs">$ sed -i <span class="hljs-string"><span class="hljs-string">'/built-in/d'</span></span> Makefile $ sed -i <span class="hljs-string"><span class="hljs-string">'/command-line/d'</span></span> Makefile</code> </pre><br>  Secara mengejutkan triknya berhasil dan Makefiles bekerja sebagaimana mestinya! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><em>&lt;&lt; Lompat ke konten</em></a> <br><br><a name="yacc"></a><h2>  3. Kesalahan tata bahasa file Yacc </h2><br>  Akan sulit dipercaya jika kode 32 tahun itu diambil dan dikumpulkan tanpa masalah.  Sayangnya, mukjizat tidak terjadi.  Mempelajari pohon sumber, saya menemukan file <strong>perl.y</strong> , yang merupakan deskripsi tata bahasa untuk utilitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="ya, halaman Wikipedia.">yacc</a> , yang telah lama digantikan oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="GNU Bison, halaman Wikipedia.">bison</a> dalam distribusi modern.  Script yang terletak di path <strong>/ usr / bin / yacc</strong> cukup memanggil <strong>bison</strong> dalam mode kompatibilitas dengan <strong>yacc</strong> .  Hanya saja kompatibilitas ini tidak lengkap dan ketika memproses file ini banyak sekali kesalahan yang terjadi, yang saya tidak tahu cara memperbaikinya dan tidak benar-benar ingin melakukannya, karena ada solusi alternatif yang saya pelajari baru-baru ini. <br><br>  Hanya satu atau dua tahun yang lalu, Helio Chissini de Castro, yang merupakan pengembang KDE, melakukan pekerjaan serupa dan mengadaptasi KDE 1, 2 dan Qt 1, 2 dengan lingkungan dan kompiler modern.  Saya menjadi tertarik pada karyanya, mengunduh kode sumber proyek, tetapi selama perakitan saya menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Qt 2 adaptasi modern oleh Helio Castro, Issues, GitHub repository.">perangkap yang</a> sama karena ketidakcocokan <strong>yacc</strong> dan <strong>bison</strong> , yang digunakan untuk membangun versi kuno dari metacompiler <strong>moc</strong> .  Selanjutnya, saya berhasil menemukan solusi untuk masalah ini dalam bentuk mengganti <strong>bison</strong> dengan utilitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Berkeley Yacc, halaman resmi.">byacc</a> (Berkeley Yacc), yang ternyata kompatibel dengan tata bahasa lama untuk <strong>yacc</strong> dan tersedia di banyak distribusi Linux. <br><br>  Penggantian sederhana <strong>yacc</strong> dengan <strong>byacc</strong> dalam sistem build membantu saya saat itu, meskipun tidak lama, karena sedikit kemudian dalam versi baru <strong>byacc mereka</strong> masih merusak kompatibilitas dengan <strong>yacc</strong> , menghentikan debugging yang terkait dengan entitas <strong>yydebug</strong> .  Karena itu, saya harus sedikit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Memperbaiki kesalahan referensi yang tidak terdefinisi, Permintaan Tarik, adaptasi modern Qt 2 oleh Helio Castro, repositori GitHub.">memperbaiki tata bahasa</a> utilitas. <br><br>  Jadi, strategi untuk memperbaiki kesalahan konstruksi dalam file <strong>perl.y</strong> diprediksi oleh pengalaman sebelumnya: instal utilitas <strong>byacc</strong> , ubah <strong>yacc</strong> menjadi <strong>byacc</strong> di semua Makefiles, lalu potong <strong>yydebug</strong> dari mana-mana.  Tindakan ini menyelesaikan semua masalah dengan file ini, kesalahannya hilang dan kompilasi berlanjut. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><em>&lt;&lt; Lompat ke konten</em></a> <br><br><a name="c-errors"></a><h2>  4. Kesalahan penyusunan kode pada "C" </h2><br>  Kode kuno Perl penuh dengan kengerian, seperti notasi fungsi yang sudah usang dan terlupakan dari tipe K&amp;R: <br><br><pre> <code class="cpp hljs">format(orec,fcmd) <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">outrec</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orec</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">register</span></span> FCMD *fcmd; { ... } <span class="hljs-function"><span class="hljs-function">STR * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hfetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tb,key)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">register</span></span></span><span class="hljs-function"> HASH *tb</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *key; { ... } <span class="hljs-comment"><span class="hljs-comment">/*VARARGS1*/</span></span> fatal(pat,a1,a2,a3,a4) <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *pat; { <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stderr</span></span>,pat,a1,a2,a3,a4); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br>  Fitur serupa ditemukan, misalnya, dalam kode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Menghibur arkeologi. Atau PVS-Studio memeriksa Microsoft Word 1.1a, Artikel tentang sumber Habr.">Microsoft Word 1.1a</a> , yang juga cukup kuno.  Standar pertama bahasa pemrograman "C", yang disebut "C89", hanya akan muncul dalam dua tahun.  Kompiler modern dapat bekerja dengan kode seperti itu, tetapi beberapa IDE tidak membuatnya mudah untuk mengurai definisi seperti itu dan menyorotnya sebagai kesalahan sintaksis, misalnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Qt Creator IDE, halaman Wikipedia.">Qt Creator</a> berdosa sebelumnya sebelum menguraikan kode di dalamnya ke perpustakaan <strong>libclang</strong> . <br><br>  Kompiler GCC 9.2.0, yang memuntahkan sejumlah besar peringatan, berupaya mengkompilasi kode kuno versi pertama Perl.  Lembar dari peringatan itu sangat besar sehingga untuk mendapatkan kesalahan, kami harus menggulir beberapa halaman knalpot ke atas.  Yang mengejutkan saya, sebagian besar kesalahan kompilasi adalah khas dan terutama terkait dengan definisi yang telah ditetapkan, yang memainkan peran bendera untuk perakitan. <br><br><div style="text-align:center;"><img title="Pekerjaan kompiler GCC 9.2.0 modern dan debugger GDB 8.3.1 di manajer jendela twm dan terminal emulator xterm." src="https://habrastorage.org/getpro/habr/post_images/3a9/b3c/004/3a9b3c0041c48a06e6805bd39883c6a4.png"></div><br>  <i>Pekerjaan kompiler GCC 9.2.0 modern dan debugger GDB 8.3.1 di manajer jendela <strong>twm</strong> dan emulator terminal <strong>xterm</strong> .</i> <br><br>  Di bawah STDSTDIO <strong>,</strong> Larry Wall bereksperimen dengan beberapa perpustakaan bahasa pemrograman kuno dan non-standar "C", dan di bawah DEBUGGING <strong>ada</strong> informasi debug dengan <strong>yydebug</strong> terkenal, yang saya sebutkan di atas.  Secara default, flag ini diaktifkan.  Dengan mematikannya di file <strong>perl.h</strong> dan menambahkan beberapa definisi yang terlupakan, saya dapat secara signifikan mengurangi jumlah kesalahan. <br><br>  Jenis kesalahan lain adalah mengesampingkan fungsi standar sekarang dari pustaka standar dan lapisan POSIX.  Proyek ini memiliki <strong>malloc ()</strong> , <strong>setenv ()</strong> dan entitas lain yang menciptakan konflik. <br><br>  Beberapa tempat mendefinisikan fungsi statis tanpa deklarasi.  Seiring waktu, penyusun mulai mengambil pendekatan yang lebih ketat untuk masalah ini dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Bagaimana mengatasi deklarasi statik mengikuti deklarasi non-statik dalam kode GCC C? - Stack Overflow.">mengubah peringatan menjadi kesalahan</a> .  Dan akhirnya, beberapa header yang terlupakan, ke mana Anda pergi tanpa mereka. <br><br>  Yang mengejutkan saya, tambalan untuk kode 32 tahun itu ternyata sangat kecil sehingga dapat sepenuhnya dikutip di sini: <br><br><pre> <code class="diff hljs">diff --git a/malloc.cb/malloc.c index 17c3b27..a1dfe9c 100644 --- a/malloc.c +++ b/malloc.c @@ -79,6 +79,9 @@ static u_int nmalloc[NBUCKETS]; #include &lt;stdio.h&gt; #endif +static findbucket(union overhead *freep, int srchlen); +static morecore(register bucket); + #ifdef debug #define ASSERT(p) if (!(p)) botch("p"); else static diff --git a/perl.hb/perl.h index 3ccff10..e98ded5 100644 --- a/perl.h +++ b/perl.h @@ -6,16 +6,16 @@ * */ -#define DEBUGGING -#define STDSTDIO /* eventually should be in config.h */ +//#define DEBUGGING +//#define STDSTDIO /* eventually should be in config.h */ #define VOIDUSED 1 #include "config.h" -#ifndef BCOPY -# define bcopy(s1,s2,l) memcpy(s2,s1,l); -# define bzero(s,l) memset(s,0,l); -#endif +//#ifndef BCOPY +//# define bcopy(s1,s2,l) memcpy(s2,s1,l); +//# define bzero(s,l) memset(s,0,l); +//#endif #include &lt;stdio.h&gt; #include &lt;ctype.h&gt; @@ -183,11 +183,11 @@ double atof(); long time(); struct tm *gmtime(), *localtime(); -#ifdef CHARSPRINTF - char *sprintf(); -#else - int sprintf(); -#endif +//#ifdef CHARSPRINTF +// char *sprintf(); +//#else +// int sprintf(); +//#endif #ifdef EUNICE #define UNLINK(f) while (unlink(f) &gt;= 0) diff --git a/perl.yb/perl.y index 16f8a9a..1ab769f 100644 --- a/perl.y +++ b/perl.y @@ -7,6 +7,7 @@ */ %{ +#include &lt;stdlib.h&gt; #include "handy.h" #include "EXTERN.h" #include "search.h" diff --git a/perly.cb/perly.c index bc32318..fe945eb 100644 --- a/perly.c +++ b/perly.c @@ -246,12 +246,14 @@ yylex() static bool firstline = TRUE; retry: +#ifdef DEBUGGING #ifdef YYDEBUG if (yydebug) if (index(s,'\n')) fprintf(stderr,"Tokener at %s",s); else fprintf(stderr,"Tokener at %s\n",s); +#endif #endif switch (*s) { default: diff --git a/stab.cb/stab.c index b9ef533..9757cfe 100644 --- a/stab.c +++ b/stab.c @@ -7,6 +7,7 @@ */ #include &lt;signal.h&gt; +#include &lt;errno.h&gt; #include "handy.h" #include "EXTERN.h" #include "search.h" diff --git a/util.hb/util.h index 4f92eeb..95cb9bf 100644 --- a/util.h +++ b/util.h @@ -28,7 +28,7 @@ void prexit(); char *get_a_line(); char *savestr(); int makedir(); -void setenv(); +//void setenv(); int envix(); void notincl(); char *getval();</code> </pre><br>  Hasil hebat untuk kode berusia 32 tahun!  <strong>Referensi yang tidak terdefinisi untuk</strong> bug penghubung <strong>`crypt '</strong> diperbaiki dengan menambahkan direktif <em>-lcrypt</em> ke Makefile dengan pustaka <strong>libcrypt yang</strong> sesuai, setelah itu saya akhirnya mendapatkan interpreter Perl yang diinginkan dapat dieksekusi: <br><br><pre> <code class="bash hljs">$ file perl perl: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=fd952ceae424613568530b3a2ca88ebd6477e0ae, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> GNU/Linux 3.2.0, not stripped</code> </pre><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><em>&lt;&lt; Lompat ke konten</em></a> <br><br><a name="segfaults"></a><h2>  5. Koreksi beberapa kesalahan Segmentasi kesalahan </h2><br>  Setelah kompilasi yang nyaris tanpa kerumitan, keberuntungan berbalik pada saya.  Segera setelah memulai interpreter Perl yang dirakit, saya mendapatkan beberapa kesalahan aneh dan kesalahan Segmentasi pada akhirnya: <br><br><pre> <code class="bash hljs">$ ./perl -e <span class="hljs-string"><span class="hljs-string">'print "Hello World!\n";'</span></span> Corrupt malloc ptr 0x2db36040 at 0x2db36000 Corrupt malloc ptr 0x2db36880 at 0x2db36800 Corrupt malloc ptr 0x2db36080 at 0x2db36040 Corrupt malloc ptr 0x2db37020 at 0x2db37000 Segmentation fault (core dumped)</code> </pre><br>  Setelah menggerogoti teks sumber untuk frasa <em>Corrupt malloc</em> , ternyata alih-alih sistem <strong>malloc ()</strong> semacam alokasi kustom dipanggil dari 1982.  Menariknya, <strong>Berkeley</strong> ditulis dalam salah satu string literal dalam kode sumbernya, dan <strong>Caltech</strong> dalam komentar di sebelahnya.  Kolaborasi antara universitas-universitas ini terbukti sangat kuat.  Secara umum, saya berkomentar pengalokasi hacker ini dan membangun kembali kode sumber.  Kesalahan kerusakan memori hilang, tetapi kesalahan Segmentasi tetap.  Jadi bukan itu intinya, dan sekarang kita perlu mengungkap debugger. <br><br>  Menjalankan program di bawah <strong>gdb,</strong> saya menemukan bahwa crash terjadi ketika fungsi untuk membuat file sementara <strong>mktemp ()</strong> dari libc disebut: <br><br><pre> <code class="plaintext hljs">$ gdb --args ./perl -e 'print "Hello, World!\n";' (gdb) r Starting program: /home/exl/perl5/perl -e print\ \"Hello\ World\!\\n\"\; Program received signal SIGSEGV, Segmentation fault. 0x00007ffff7cd20c7 in __gen_tempname () from /usr/lib/libc.so.6 (gdb) bt #0 0x00007ffff7cd20c7 in __gen_tempname () from /usr/lib/libc.so.6 #1 0x00007ffff7d71577 in mktemp () from /usr/lib/libc.so.6 #2 0x000055555556bb08 in main ()</code> </pre><br>  By the way, linker sebelumnya bersumpah pada fungsi ini.  Bukan kompiler, tapi tautan, yang mengejutkan saya: <br><br><pre> <code class="plaintext hljs">/usr/bin/ld: perl.o: in function `main': perl.c:(.text+0x978c): warning: the use of `mktemp' is dangerous, better use `mkstemp' or `mkdtemp'</code> </pre><br>  Pikiran pertama yang mungkin terlintas di pikiran Anda juga adalah mengganti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Perpustakaan GNU C, File Sementara, Dokumentasi Resmi GNU.">fungsi</a> <strong>mktemp () yang</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Perpustakaan GNU C, File Sementara, Dokumentasi Resmi GNU.">tidak aman</a> dengan <strong>mkstemp ()</strong> , yang saya lakukan.  Peringatan linker menghilang, tetapi kesalahan Segmentasi tetap di tempat ini, hanya saja sekarang berada di fungsi <strong>mkstemp ()</strong> . <br><br>  Oleh karena itu, sekarang Anda perlu melihat dengan sangat hati-hati pada potongan kode yang terkait dengan fungsi ini.  Di sana saya menemukan hal yang agak aneh yang disorot dalam cuplikan ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *e_tmpname = <span class="hljs-string"><span class="hljs-string">"/tmp/perl-eXXXXXX"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ mktemp(e_tmpname); e_fp = f_open(e_tmpname, <span class="hljs-string"><span class="hljs-string">"w"</span></span>); ... }</code> </pre><br>  Ternyata <strong>mktemp () sedang</strong> mencoba mengubah literal untuk topeng, yang terletak di bagian <strong>.rodata</strong> , yang jelas-jelas ditakdirkan untuk gagal.  Atau, setelah semua, 32 tahun yang lalu, ini dapat diterima, bertemu dalam kode, dan bahkan berhasil? <br><br>  Tentu saja, mengganti <strong>char * e_tmpname</strong> dengan <strong>char e_tmpname []</strong> memperbaiki kesalahan Segmentasi ini dan saya bisa mendapatkan apa yang saya bunuh sepanjang malam: <br><br><pre> <code class="bash hljs">$ ./perl -e <span class="hljs-string"><span class="hljs-string">'print "Hello World!\n";'</span></span> $ Hello, World! $ ./perl -e <span class="hljs-string"><span class="hljs-string">'$a = 5; $b = 6.3; $c = $a+$b; print $c."\n";'</span></span> $ 11.3000000000000007 $ ./perl -v <span class="hljs-variable"><span class="hljs-variable">$Header</span></span>: perly.c,v 1.0 87/12/18 15:53:31 root Exp $ Patch level: 0</code> </pre><br>  Kami memeriksa eksekusi dari baris perintah, tetapi bagaimana dengan file?  Saya mengunduh "Hello World" pertama untuk bahasa pemrograman Perl dari Internet: <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">################# test.pl #!/usr/bin/perl # # The traditional first program. # Strict and warnings are recommended. use strict; use warnings; # Print a message. print "Hello, World!\n";</span></span></code> </pre><br>  Kemudian saya mencoba menjalankannya, tetapi, sayangnya, kesalahan Segmentasi menunggu saya lagi.  Kali ini di tempat yang sama sekali berbeda: <br><br><pre> <code class="plaintext hljs">$ gdb --args ./perl test.pl (gdb) r Starting program: /home/exl/perl5/perl test.pl Program received signal SIGSEGV, Segmentation fault. 0x00007ffff7d1da75 in __strcpy_sse2_unaligned () from /usr/lib/libc.so.6 (gdb) bt #0 0x00007ffff7d1da75 in __strcpy_sse2_unaligned () from /usr/lib/libc.so.6 #1 0x00005555555629ea in yyerror () #2 0x0000555555568dd6 in yyparse () #3 0x000055555556bd4f in main ()</code> </pre><br>  Poin menarik berikut ditemukan dalam fungsi <strong>yyerror ()</strong> , saya kutip cuplikan asli: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// perl.y char *tokename[] = { "256", "word", "append", ... // perl.c yyerror(s) char *s; { char tmpbuf[128]; char *tname = tmpbuf; if (yychar &gt; 256) { tname = tokename[yychar-256]; // ??? if (strEQ(tname,"word")) strcpy(tname,tokenbuf); // Oops! else if (strEQ(tname,"register")) sprintf(tname,"$%s",tokenbuf); // Oops! ...</span></span></code> </pre><br>  Sekali lagi, situasinya mirip dengan yang saya tulis di atas.  Data di bagian <strong>.rodata dimodifikasi lagi</strong> .  Mungkin itu hanya kesalahan ketik karena Copy-Paste dan bukannya <strong>tname</strong> mereka ingin menulis <strong>tmpbuf</strong> ?  Atau benar-benar ada semacam makna tersembunyi di baliknya?  Bagaimanapun, mengganti <strong>char * tokename []</strong> dengan <strong>char tokename [] [32]</strong> menghapus kesalahan kesalahan Segmentasi dan Perl memberi tahu kami hal berikut: <br><br><pre> <code class="bash hljs">$ ./perl test.pl syntax error <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> file test.pl at line 7, next token <span class="hljs-string"><span class="hljs-string">"strict"</span></span> Execution aborted due to compilation errors.</code> </pre><br>  Ternyata dia tidak suka segala macam <strong>penggunaan</strong> bermodel <strong>ketat</strong> , itulah yang dia coba sampaikan kepada kita!  Jika Anda menghapus atau mengomentari baris-baris ini dalam file, program dimulai: <br><br><pre> <code class="bash hljs">$ ./perl test.pl Hello, World!</code> </pre><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><em>&lt;&lt; Lompat ke konten</em></a> <br><br><a name="theend"></a><h2>  6. Untuk meringkas </h2><br>  Bahkan, saya mencapai tujuan saya dan membuat kode kuno dari 1987 tidak hanya mengkompilasi, tetapi juga bekerja di lingkungan Linux modern.  Tidak diragukan lagi, masih ada banyak kesalahan Segmentasi kesalahan, mungkin terkait dengan ukuran pointer pada arsitektur 64-bit.  Semua ini dapat dibersihkan setelah duduk beberapa malam dengan debugger di siap.  Tapi ini bukan tugas yang sangat menyenangkan dan agak membosankan.  Lagipula, awalnya eksperimen ini direncanakan sebagai hiburan untuk malam yang membosankan, dan bukan sebagai pekerjaan penuh, yang akan diakhiri.  Apakah ada manfaat praktis dari tindakan yang diambil?  Mungkin suatu hari beberapa arkeolog digital akan menemukan artikel ini dan itu akan bermanfaat baginya.  Tetapi di dunia nyata, bahkan pengalaman yang ditarik dari penelitian seperti itu, menurut saya, tidak terlalu berharga. <br><br>  Jika ada yang tertarik, saya memposting satu set dua tambalan.  Yang pertama memperbaiki kesalahan kompilasi, dan yang kedua memperbaiki beberapa kesalahan kesalahan Segmentasi. <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Perbaiki patch kesalahan kompilasi, repositori EXLMOTODEV GitHub."><strong>Perl1987-Fix-compilation-errors.patch</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Perbaiki beberapa patch Segmentasi Faults, repositori GitHub EXLMOTODEV."><strong>Perl1987-Perbaiki-beberapa-Segmentasi-Faults.patch</strong></a> </li></ul><br>  PS Saya cepat-cepat membuat marah para penggemar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Program Perl Single Line, Artikel Lurkmore.">pemain lini tunggal yang merusak</a> , ini tidak bekerja di sini.  Mungkin versi Perl terlalu tua untuk hiburan seperti itu. <br>  PPS Semua baik dan selamat berakhir pekan.  Berkat <strong>kawaii_neko</strong> untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Perl langsung dari 1987, Mengomentari sumber daya LINUX.ORG.RU">perbaikan kecil</a> . <br><br>  <em>Pembaruan 28-Okt-2019:</em> Pengguna forum LINUX.ORG.RU, menggunakan nama panggilan <strong>utf8nowhere</strong> , memberikan tautan yang cukup menarik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Perl langsung dari 1987, Mengomentari sumber daya LINUX.ORG.RU">dalam komentarnya</a> pada artikel ini, informasi yang darinya tidak hanya mengklarifikasi situasi dengan string string yang dapat diubah, tetapi bahkan mempertimbangkan masalah penggunaan yang dijelaskan di atas fungsi <strong>mktemp ()</strong> !  Izinkan saya mengutip sumber-sumber ini, yang menggambarkan berbagai ketidakcocokan antara K&amp;R C yang tidak standar dan GNU C: <br><blockquote>  <strong>Ketidakcocokan GCC</strong> <br>  Ada beberapa ketidaksesuaian yang patut dicatat antara GNU C dan K&amp;R (non-ISO) versi C. <br><br>  GCC biasanya membuat konstanta string hanya-baca.  Jika beberapa konstanta string yang tampak identik digunakan, GCC hanya menyimpan satu salinan string. <br>  Salah satu konsekuensinya adalah Anda tidak dapat memanggil <strong>mktemp</strong> dengan argumen string konstan.  Fungsi <strong>mktemp</strong> selalu mengubah string yang ditunjukkan argumennya. <br><br>  Konsekuensi lain adalah bahwa <strong>sscanf</strong> tidak berfungsi pada beberapa sistem ketika melewati string konstan sebagai string kontrol atau input formatnya.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini karena </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sscanf</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> salah mencoba untuk menulis ke dalam konstanta string. </font><font style="vertical-align: inherit;">Demikian juga </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fscanf</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scanf</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solusi terbaik untuk masalah ini adalah mengubah program untuk menggunakan </font><font style="vertical-align: inherit;">variabel </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -array dengan string inisialisasi untuk keperluan ini alih-alih konstanta string. </font><font style="vertical-align: inherit;">Tetapi jika ini tidak memungkinkan, Anda dapat menggunakan </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flag -fwritable-string</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang mengarahkan GCC untuk menangani konstanta string dengan cara yang sama seperti kebanyakan kompiler C lakukan. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumber: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Menggunakan Manual Resmi GNU Compiler Collection (GCC 3.3)."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menggunakan Manual Resmi GNU Compiler Collection (GCC 3.3)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bendera compiler </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-fwritable-string</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tidak lagi digunakan dalam GCC 3.4 dan dihapus secara permanen di GCC 4.0.</font></font><br><blockquote> <strong>ANSI C rationale | String literals</strong> <br> String literals are specified to be unmodifiable. This specification allows implementations to share copies of strings with identical text, to place string literals in read-only memory, and perform certain optimizations. However, string literals do not have the type array of const char, in order to avoid the problems of pointer type checking, particularly with library functions, since assigning a pointer to const char to a plain pointer to char is not valid. Those members of the Committee who insisted that string literals should be modifiable were content to have this practice designated a common extension (see F.5.5). <br><br> Existing code which modifies string literals can be made strictly conforming by replacing the string literal with an initialized static character array. For instance, <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *p, *make_temp(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> p = make_temp(<span class="hljs-string"><span class="hljs-string">"tempXXX"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* make_temp overwrites the literal */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* with a unique name */</span></span></code> </pre><br> can be changed to: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *p, *make_temp(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>[ ] = <span class="hljs-string"><span class="hljs-string">"tempXXX"</span></span>; p = make_temp( <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> ); }</code> </pre><br> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Dasar Pemikiran untuk Standar Nasional Amerika untuk Sistem Informasi, Bahasa Pemrograman C, String literals.">Rationale for American National Standard for Information Systems, Programming Language C</a> . <br></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pengguna </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VarfolomeyKote4ka</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mengusulkan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Perl langsung dari 1987, Mengomentari sumber daya LINUX.ORG.RU"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peretasan kotor yang menarik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang memungkinkan Anda untuk memotong kesalahan Segmentasi ketika mencoba mengubah data di bagian </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.rodata</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dengan mengonversinya ke bagian </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.rwdata</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Belum lama ini, sebuah artikel yang sangat menarik muncul di Internet, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="Dari .rodata ke .rwdata - pengantar pemetaan memori dan skrip LD, Guy on BITS."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Dari .rodata ke .rwdata - pengantar pemetaan memori dan skrip LD"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oleh programmer </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">guye1296</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang menceritakan bagaimana melakukan trik ini. Untuk memfasilitasi mendapatkan hasil yang diinginkan, penulis artikel menyiapkan skrip yang agak tebal untuk tautan standar </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ld</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><a href="" title="skrip rwdata.ld untuk ld linker, guye1296, repositori GitHub."><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rwdata.ld</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cukup mengunduh skrip ini, letakkan di root direktori sumber Perl, perbaiki tanda </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDFLAGS</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sebagai berikut: </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDFLAGS = -T rwdata.ld</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lalu </font><strong><font style="vertical-align: inherit;">bangun</font></strong><font style="vertical-align: inherit;"> kembali proyek. </font><font style="vertical-align: inherit;">Sebagai hasilnya, kami memiliki yang berikut:</font></font><br><br><pre> <code class="bash hljs">$ make clean &amp;&amp; make -j1 $ mv perl perl_rodata $ curl -LOJ https://raw.githubusercontent.com/guye1296/ld_script_elf_blog_post/master/rwdata.ld $ sed -i <span class="hljs-string"><span class="hljs-string">'s/LDFLAGS =/LDFLAGS = -T rwdata.ld/'</span></span> Makefile $ make clean &amp;&amp; make -j1 $ mv perl perl_rwdata $ objdump -s -j .rodata perl_rodata | grep tmp -2 19da0 21233f5e 7e3d2d25 30313233 34353637 !<span class="hljs-comment"><span class="hljs-comment">#?^~=-%01234567 19db0 38392e2b 262a2829 2c5c2f5b 7c002400 89.+&amp;*(),\/[|.$. 19dc0 73746465 7272002f 746d702f 7065726c stderr./tmp/perl 19dd0 2d655858 58585858 00323536 00617070 -eXXXXXX.256.app 19de0 656e6400 6c6f6f70 63746c00 66756e63 end.loopctl.func $ objdump -s -j .rwdata perl_rodata | grep tmp -2 objdump: section '.rwdata' mentioned in a -j option, but not found in any input file $ objdump -s -j .rwdata perl_rwdata | grep tmp -2 41d9c0 21233f5e 7e3d2d25 30313233 34353637 !#?^~=-%01234567 41d9d0 38392e2b 262a2829 2c5c2f5b 7c002400 89.+&amp;*(),\/[|.$. 41d9e0 73746465 7272002f 746d702f 7065726c stderr./tmp/perl 41d9f0 2d655858 58585858 00323536 00617070 -eXXXXXX.256.app 41da00 656e6400 6c6f6f70 63746c00 66756e63 end.loopctl.func $ objdump -s -j .rodata perl_rwdata | grep tmp -2 objdump: section '.rodata' mentioned in a -j option, but not found in any input file $ ./perl_rodata -e 'print "Hello, World!\n";' Segmentation fault (core dumped) $ ./perl_rwdata -e 'print "Hello, World!\n";' Hello, World!</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ternyata berkat peretasan ini, hampir semua perubahan dari tambalan kedua dapat dihilangkan! </font><font style="vertical-align: inherit;">Meskipun, tentu saja, membawa kode ke tampilan yang tidak melanggar standar masih lebih disukai. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;&lt; Lompat ke konten</font></font></em></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id473228/">https://habr.com/ru/post/id473228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id473208/index.html">Bagaimana saya menyederhanakan proses pengerjaan proyek sumber terbuka</a></li>
<li><a href="../id473214/index.html">Yaga - Kisah Slavia dalam pengaturan seluler</a></li>
<li><a href="../id473220/index.html">Landasan penghancuran kode lambat dalam Bahasa Wolfram: mempercepat kode puluhan, ratusan dan ribuan kali</a></li>
<li><a href="../id473222/index.html">Aturan iptables khusus untuk buruh pelabuhan menggunakan zabbix sebagai contoh</a></li>
<li><a href="../id473224/index.html">Pendidikan tinggi vs kompetensi. Pendapat terpisah dari hakim Mahkamah Konstitusi Federasi Rusia tentang keadaan pendidikan tinggi</a></li>
<li><a href="../id473230/index.html">Apakah Internet Satelit sebuah Ruang Angkasa Baru?</a></li>
<li><a href="../id473232/index.html">Sistem kontrol versi apa yang Anda gunakan (dalam pekerjaan nyata, sebagian besar)?</a></li>
<li><a href="../id473234/index.html">Membuat API REST dengan Node.js dan Oracle Database</a></li>
<li><a href="../id473236/index.html">Bekerja di IT, manajemen proyek, regulasi dan pengembangan PD di cloud: megadigest dari 1cloud.ru</a></li>
<li><a href="../id473238/index.html">Bagaimana Netflix Bekerja</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>