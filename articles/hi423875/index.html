<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯТЩ ЁЯд╖ЁЯП╗ ЁЯЫ╕ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рд╕рдВрдЧреНрд░рд╣рдг ЁЯОб ЁЯзФЁЯП┐ ЁЯУ╖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЕрдЪреНрдЫрд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп, рд╣реЙрдХрд░реНрд╕! рдПрдХ рдбреЗрдЯрд┐рдВрдЧ рд╕рд╛рдЗрдЯ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд░ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝реЛрдЯреЛ рдХреЗ рднрдВрдбрд╛рд░рдг рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рдЧрдпрд╛ред рд╕рдВрджрд░реНрдн рдХреА рд╢...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рд╕рдВрдЧреНрд░рд╣рдг</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423875/"><img src="https://habrastorage.org/webt/ti/up/px/tiuppxliueu75a1ycliw537yw-k.jpeg" alt="рдЫрд╡рд┐"><br><br>  рдЕрдЪреНрдЫрд╛ рд╕реНрд╡рд╛рд╕реНрдереНрдп, рд╣реЙрдХрд░реНрд╕!  рдПрдХ рдбреЗрдЯрд┐рдВрдЧ рд╕рд╛рдЗрдЯ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд░ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝реЛрдЯреЛ рдХреЗ рднрдВрдбрд╛рд░рдг рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рдЧрдпрд╛ред  рд╕рдВрджрд░реНрдн рдХреА рд╢рд░реНрддреЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдкреНрд░рддрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдлрд╝реЛрдЯреЛ рдХреА рд╕рдВрдЦреНрдпрд╛ 10 рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рд╕реАрдорд┐рдд рд╣реИред  рд▓реЗрдХрд┐рди рджрд╕рд┐рдпреЛрдВ рд╣рдЬрд╝рд╛рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдпрд╣ рджреЗрдЦрддреЗ рд╣реБрдП рдХрд┐ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдЕрдкрдиреЗ рд╡рд░реНрддрдорд╛рди рд╕реНрд╡рд░реВрдк рдореЗрдВ "рд╢реВрдиреНрдп" рдХреА рд╢реБрд░реБрдЖрдд рд╕реЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдореМрдЬреВрдж рд╣реИред  рдпрд╣реА рд╣реИ, рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╣рдЬрд╛рд░реЛрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реИрдВред  рд▓рдЧрднрдЧ рдХрд┐рд╕реА рднреА рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо, рдЬрд╣рд╛рдВ рддрдХ тАЛтАЛрдореБрдЭреЗ рдкрддрд╛ рд╣реИ, рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдмрдЪреНрдЪреЗ рдХреЗ рдиреЛрдбреНрд╕ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдирдХрд╛рд░рд╛рддреНрдордХ рд░реВрдк рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИред  рдЕрдиреБрднрд╡ рд╕реЗ, рдореИрдВ рдХрд╣ рд╕рдХрддрд╛ рд╣реВрдВ рдХрд┐ рдореВрд▓ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ 1000-1500 рдлрд╝рд╛рдЗрд▓реЛрдВ / рдлрд╝реЛрд▓реНрдбрд░реЛрдВ рдХреЗ рдмрд╛рдж рд╕рдорд╕реНрдпрд╛рдПрдВ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИрдВред <br><a name="habracut"></a><br>  <i>рдЕрд╕реНрд╡реАрдХрд░рдгред</i>  <i>рдореИрдВрдиреЗ рд▓реЗрдЦ рд▓рд┐рдЦрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЧреБрдЧрд▓реА рдХреА рдФрд░ рдЪрд░реНрдЪрд╛ рдХреЗ рддрд╣рдд рдореБрджреНрджреЗ рдХреЗ рдХрдИ рд╕рдорд╛рдзрд╛рди рдкрд╛рдП (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ</a> рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдБ</a> )ред</i>  <i>рд▓реЗрдХрд┐рди рдореБрдЭреЗ рдПрдХ рднреА рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рдорд┐рд▓рд╛ рдЬреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдореЗрд░рд╛ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реЛред</i>  <i>рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдореИрдВ рдХреЗрд╡рд▓ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдореЗрдВ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдЕрдиреБрднрд╡ рд╕рд╛рдЭрд╛ рдХрд░рддрд╛ рд╣реВрдВред</i> <br><br><h3>  рд╕рд┐рджреНрдзрд╛рдВрдд </h3><br>  рднрдВрдбрд╛рд░рдг рдХрд╛рд░реНрдп рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕ рддрд░рд╣ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдХрд╛рдо рдХреЗ рдмрдпрд╛рди рдореЗрдВ рдПрдХ рд╢рд░реНрдд рднреА рдереА, рдЬрд┐рд╕рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдлрд╝реЛрдЯреЛ рдХреЗ рд▓рд┐рдП рдХреИрдкреНрд╢рди рдФрд░ рдХреИрдкреНрд╢рди рдХреЛ рдЫреЛрдбрд╝рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдерд╛ред  рдмреЗрд╢рдХ, рдЖрдк рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рдмрд┐рдирд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред  рдпрд╣реА рд╣реИ, рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рд╣рдо рдХрд░рддреЗ рд╣реИрдВ рд╡рд╣ рдПрдХ рдореЗрдЬ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдореЗрдЯрд╛-рдбреЗрдЯрд╛ рдореИрдкрд┐рдВрдЧ (рд╣рд╕реНрддрд╛рдХреНрд╖рд░, рд╢реАрд░реНрд╖рдХ, рдЖрджрд┐) рдбрд┐рд╕реНрдХ рдкрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде рд▓рд┐рдЦрддреЗ рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рд╛рдЗрд▓ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдПрдХ рдкрдВрдХреНрддрд┐ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреА рд╣реИред  рддрджрдиреБрд╕рд╛рд░, рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╣реЛрддрд╛ рд╣реИред <br><br>  рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рд╡рд┐рд╖рдпрд╛рдВрддрд░ред  рдСрдЯреЛ-рдЗрдВрдХреНрд░реАрдореЗрдВрдЯ рдХреА рдмрд╛рдд рдХрд░рддреЗ рд╣реИрдВред  рдПрдХ рдбреЗрдЯрд┐рдВрдЧ рд╕рд╛рдЗрдЯ рдореЗрдВ рдПрдХ рджрд░реНрдЬрди рдпрд╛ рджреЛ рд╣рдЬрд╛рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рд╕рд╡рд╛рд▓ рдпрд╣ рд╣реИ рдХрд┐ рдХрд┐рддрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдо рддреМрд░ рдкрд░ рдЕрдкрдиреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рдХреЗ рдкреВрд░реЗ рд╕рдордп рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕реЗ рдЧреБрдЬрд░рддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдбреЗрдЯрд┐рдВрдЧ-рдЖрд░рдпреВ рдХреЗ рд╕рдХреНрд░рд┐рдп рджрд░реНрд╢рдХ рдХрдИ рд╕реМ рд╣рдЬрд╛рд░ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕рд┐рд░реНрдл рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдЗрд╕ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рдЬреАрд╡рдирдХрд╛рд▓ рдХреЗ рджреМрд░рд╛рди рдХрд┐рддрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╢реЗрд╖ рд╣реИрдВ;  рдХрд┐рддрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдм рддрдХ рд╕рдХреНрд░рд┐рдп рдирд╣реАрдВ рд╣реИрдВред  рдЕрдм рд╣рдорд╛рд░реЗ рдХрд╛рдиреВрди рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ, рдЬреЛ рд╣рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рдЫрд╣ рдорд╣реАрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рдзреНрдп рдХрд░рддрд╛ рд╣реИ ... рдЬрд▓реНрдж рд╣реА рдпрд╛ рдмрд╛рдж рдореЗрдВ, 4 рдХреЗ рд╕рд╛рде <b>UNSIGNED INT</b> рдХрд╛ рдПрдХ рдкреИрд╕рд╛ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдЧрд╛ред  рдЗрд╕рд▓рд┐рдП, <b>BIGINT</b> рдХреЛ рдкреНрд░рд╛рдердорд┐рдХ рдХреБрдВрдЬреА рдХреЗ рд▓рд┐рдП рд▓реЗрдирд╛ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╣реИред <br><br>  рдЕрдм рдЖрдЗрдП рдХрдИ рдкреНрд░рдХрд╛рд░ рдХреЗ <b>BIGINT</b> рдХреА рдХрд▓реНрдкрдирд╛ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред  рдпрд╣ 8 рдмрд╛рдЗрдЯреНрд╕ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдмрд╛рдЗрдЯ 0 рд╕реЗ 255 рддрдХ рд╣реИред 255 рдмрдЪреНрдЪреЗ рдиреЛрдбреНрд╕ рдХрд┐рд╕реА рднреА рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рд╕рд╛рдорд╛рдиреНрдп рд╣реИрдВред  рдпрд╣реА рд╣реИ, рд╣рдо рдлрд╝рд╛рдЗрд▓ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЛ рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдореЗрдВ рд▓реЗрддреЗ рд╣реИрдВ, рд╣рдо рдЗрд╕реЗ рджреЛ рд╡рд░реНрдгреЛрдВ рдХреЗ рд╡рд┐рдЦрдВрдбрди рдореЗрдВ рддреЛрдбрд╝ рджреЗрддреЗ рд╣реИрдВред  рд╣рдо рдЗрди рдЪрдВрдХреНрд╕ рдХреЛ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдирд╛рдо рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдмрд╛рдж рдореЗрдВ рднреМрддрд┐рдХ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдирд╛рдо рдХреЗ рд░реВрдк рдореЗрдВред  рд▓рд╛рдн! <br><br> <code>0f/65/84/10/67/68/19/ff.file</code> <br> <br>  рд╕реБрд░реБрдЪрд┐рдкреВрд░реНрдг рдФрд░ рд╕рд░рд▓ред  рдлрд╝рд╛рдЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдпрд╣рд╛рдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИред  рд╡реИрд╕реЗ рднреА, рдлрд╝рд╛рдЗрд▓ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рджреА рдЬрд╛рдПрдЧреА рдЬреЛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ рдПрдХ рд╡рд┐рд╢реЗрд╖ MIME рдкреНрд░рдХрд╛рд░ рджреЗрдЧреА, рдЬрд┐рд╕реЗ рд╣рдо рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рднреА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВрдЧреЗред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдирд╛ рдЖрдкрдХреЛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ рд▓рд┐рдП рдкрде рдХреЛ рдлрд┐рд░ рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдХрд╣рддреЗ рд╣реИрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЬреЛ рдлрд╝рд╛рдЗрд▓ рд╣реИ рд╡рд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкрде / <code>/content/files/0f/65/84/10/67/68/19/ff.file</code> рд╕рд╛рде рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рд╕реНрдерд┐рдд рд╣реИред  рдФрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдЖрдк рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ URL рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <code>/content/users/678/files/somefile</code> ред  рдПрд╕рдИрдУ рд╢рд╛рдпрдж рдЕрднреА рдмрд╣реБрдд рдореБрд╕реНрдХреБрд░рд╛рдП рд╣реИрдВред  рдпрд╣ рд╕рдм рд╣рдореЗрдВ рдЪрд┐рдВрддрд╛ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдлрд╛рдЗрд▓ рдХреЛ рднреМрддрд┐рдХ рд░реВрдк рд╕реЗ рдХрд╣рд╛рдВ рд░рдЦрд╛ рдЬрд╛рдПред <br><br><h3>  рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рддрд╛рд▓рд┐рдХрд╛ </h3><br>  рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛, MIME рдкреНрд░рдХрд╛рд░, URL рдФрд░ рднреМрддрд┐рдХ рд╕реНрдерд╛рди рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рддреЛ рд╕рдорд╛рди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ md5 рдФрд░ sha1 рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВрдЧреЗред  рдмреЗрд╢рдХ, рд╣рдореЗрдВ рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЗрдХрд╛рдИ рд╕рдВрдмрдВрдзреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЖрдИрдбреА рдЬрд┐рд╕рдореЗрдВ рдлрд╛рдЗрд▓реЗрдВ рд╣реИрдВред  рдФрд░ рдЕрдЧрд░ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрд╣реБрдд рдмрдбрд╝реА рдирд╣реАрдВ рд╣реИ, рддреЛ рдЙрд╕реА рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рд╣рдо рд╕реНрдЯреЛрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдХрд╣ рд╕рдХрддреЗ рд╣реИрдВ, рдорд╛рд▓ рдХреА рддрд╕реНрд╡реАрд░реЗрдВред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЙрд╕ рдЗрдХрд╛рдИ рд╡рд░реНрдЧ рдХреЗ рдирд╛рдо рдХреЛ рднреА рд╕рдВрдЪрд┐рдд рдХрд░реЗрдВрдЧреЗ рдЬрд┐рд╕рдХрд╛ рд░рд┐рдХреЙрд░реНрдб рд╣реИред <br><br>  рдкрдХреНрд╖рд┐рдпреЛрдВ рдХреА рдмреЛрд▓реАред  рдпрджрд┐ рдЖрдк рдмрд╛рд╣рд░реА рдкрд╣реБрдБрдЪ рдХреЗ рд▓рд┐рдП .htaccess рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрд╝реЛрд▓реНрдбрд░ рдмрдВрдж рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдлрд╝рд╛рдЗрд▓ рдХреЗрд╡рд▓ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред  рдФрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдлрд╝рд╛рдЗрд▓ рддрдХ рдкрд╣реБрдВрдЪ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрдЧрд╛ред  рдереЛрдбрд╝рд╛ рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реБрдП, рдореИрдВ рдХрд╣рддрд╛ рд╣реВрдБ рдХрд┐ рдореЗрд░реЗ CMS рдореЗрдВ (рдЬрд╣рд╛рдБ рдЕрдм рдЙрдХреНрдд рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рджреЗрдЦрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ) рдкрд╣реБрдВрдЪ рдореВрд▓ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕рдореВрд╣реЛрдВ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдореЗрд░реЗ рдкрд╛рд╕ 8 рд╣реИрдВ - рдЕрддрд┐рдерд┐, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рдкреНрд░рдмрдВрдзрдХ, рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ, рдирд┐рд╖реНрдХреНрд░рд┐рдп, рдЕрд╡рд░реБрджреНрдз, рд╣рдЯрд╛рдП рдЧрдП рдФрд░ рд╕реБрдкрд░ рдкреНрд░рд╡реЗрд╢ред  рд╕реБрдкрд░-рдПрдбрдорд┐рди рдмрд┐рд▓реНрдХреБрд▓ рд╕рдм рдХреБрдЫ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкрд╣реБрдВрдЪ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рдиреЗ рдореЗрдВ рднрд╛рдЧ рдирд╣реАрдВ рд▓реЗрддрд╛ рд╣реИред  рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ рд╕реБрдкрд░-рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдзреНрд╡рдЬ рд╣реИ, рддреЛ рд╡рд╣ рд╕реБрдкрд░-рдПрдбрдорд┐рди рд╣реИред  рд╕рдм рдХреБрдЫ рд╕рд░рд▓ рд╣реИред  рдпрд╣реА рд╣реИ, рд╣рдо рд╢реЗрд╖ рд╕рд╛рдд рд╕рдореВрд╣реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░реЗрдВрдЧреЗред  рдкреНрд░рд╡реЗрд╢ рд╕рд░рд▓ рд╣реИ - рдпрд╛ рддреЛ рдлрд╝рд╛рдЗрд▓ рджреЗрдВ рдпрд╛ рди рджреЗрдВред  рдХреБрд▓ рдорд┐рд▓рд╛рдХрд░, рдЖрдк <b>TINYINT</b> рдХрд╛ рдПрдХ рдкреНрд░рдХрд╛рд░ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдФрд░ рдПрдХ рдмрд╛рддред  рд╣рдорд╛рд░реЗ рдХрд╛рдиреВрди рдХреЗ рдЕрдиреБрд╕рд╛рд░, рд╣рдореЗрдВ рд╢рд╛рд░реАрд░рд┐рдХ рд░реВрдк рд╕реЗ рдХрд╕реНрдЯрдо рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдпрд╣реА рд╣реИ, рд╣рдореЗрдВ рд╢рд╛рд░реАрд░рд┐рдХ рд░реВрдк рд╕реЗ рд╣рдЯрд╛рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдХрд┐рд╕реА рддрд░рд╣ рд╣рдЯрд╛рдП рдЧрдП рдЪрд┐рддреНрд░реЛрдВ рдХреЛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрди рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдмрд┐рдЯ рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдмрд╕реЗ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред  рдРрд╕реЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдореИрдВ рдЖрдорддреМрд░ рдкрд░ <b>INT рдХреЗ</b> рдПрдХ рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВред  рдЖрд░рдХреНрд╖рд┐рдд рдХрд░рдирд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдмреЛрд▓рдирд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдореЗрд░реЗ рдкрд╛рд╕ рдЕрдВрдд рд╕реЗ 5 рд╡реЗрдВ рдмрд┐рдЯ рдореЗрдВ <b>DELETED</b> рдзреНрд╡рдЬ рд░рдЦрдиреЗ рдХреА рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕реНрдерд╛рдкрд┐рдд рдкрд░рдВрдкрд░рд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдпрд╣ рдлрд┐рд░ рд╕реЗ рдлрд┐рд░ рд╕реЗ рдмрд╛рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред <br><br>  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдХреНрдпрд╛ рд╣реИ: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">`files`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> auto_increment, <span class="hljs-comment"><span class="hljs-comment">--   `entity_type` char(32) not null default '', --   `entity` bigint null, -- ID  `mime` char(32) not null default '', -- MIME- `md5` char(32) not null default '', -- MD5 `sha1` char(40) not null default '', -- SHA1 `file` char(64) not null default '', --   `url` varchar(250) not null default '', -- URL `meta` text null, -- -   JSON    `size` bigint not null default '0', --  `created` datetime not null, --   `updated` datetime null, --   `access` tinyint not null default '0', --   `flags` int not null default '0', --  primary key (`id`), index (`entity_type`), index (`entity`), index (`mime`), index (`md5`), index (`sha1`), index (`url`) ) engine = InnoDB;</span></span></code> </pre> <br><h3>  рдбрд┐рд╕реНрдкреИрдЪрд░ рдХреНрд▓рд╛рд╕ </h3><br>  рдЕрдм рд╣рдореЗрдВ рдПрдХ рд╡рд░реНрдЧ рдмрдирд╛рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рд╣рдо рдлрд╛рдЗрд▓реЗрдВ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВрдЧреЗред  рд╡рд░реНрдЧ рдХреЛ рдлрд╝рд╛рдЗрд▓реЗрдВ рдмрдирд╛рдиреЗ, рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдмрджрд▓рдиреЗ / рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ, рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рджреЛ рдмрд┐рдВрджреБрдУрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╣реИред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рд╕рд░реНрд╡рд░ рд╕реЗ рд╕рд░реНрд╡рд░ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рддреЛ рдХрдХреНрд╖рд╛ рдореЗрдВ рдЖрдкрдХреЛ рдПрдХ рд╕рдВрдкрддреНрддрд┐ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЬрдбрд╝ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реЛрддреА рд╣реИред  рджреВрд╕рд░реЗ, рдпрд╣ рдмрд╣реБрдд рдЕрдкреНрд░рд┐рдп рд╣реЛрдЧрд╛ рдпрджрд┐ рдХреЛрдИ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдПрдХ рдореЗрдЬ рдкрд░ рдзрдорд╛рдХрд╛ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдбреЗрдЯрд╛ рд░рд┐рдХрд╡рд░реА рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдкрд╣рд▓реЗ рдХреЗ рд╕рд╛рде, рд╕рдм рдХреБрдЫ рдЖрдо рддреМрд░ рдкрд░ рд╕реНрдкрд╖реНрдЯ рд╣реИред  рдбреЗрдЯрд╛ рдмреИрдХрдЕрдк рдХреЗ рд▓рд┐рдП, рд╣рдо рдХреЗрд╡рд▓ рд╡рд╣реА рдЖрд░рдХреНрд╖рд┐рдд рдХрд░реЗрдВрдЧреЗ рдЬреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br>  <b>рдЖрдИрдбреА</b> - рдлрд╝рд╛рдЗрд▓ рдХреЗ рднреМрддрд┐рдХ рд╕реНрдерд╛рди рд╕реЗ рдмрд╣рд╛рд▓ <br>  <b>Unit_type</b> - рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ <br>  <b>рдЗрдХрд╛рдИ</b> - рдмрд╣рд╛рд▓ рдирд╣реАрдВ <br>  <b>рдорд╛рдЗрдо</b> - рдлрд┐рдиреЛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╣рд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ <br>  <b>md5</b> - рдлрд╝рд╛рдЗрд▓ рд╕реЗ рд╣реА рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ <br>  <b>sha1</b> - рдлрд╝рд╛рдЗрд▓ рд╕реЗ рд╣реА рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ <br>  <b>рдлрд╝рд╛рдЗрд▓</b> - <b>рдлрд╝рд╛рдЗрд▓</b> рдХреЗ рднреМрддрд┐рдХ рд╕реНрдерд╛рди рд╕реЗ рдмрд╣рд╛рд▓ <br>  <b>url</b> - рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ <br>  <b>рдореЗрдЯрд╛</b> - рдмрд╣рд╛рд▓ рдирд╣реАрдВ рд╣реИ <br>  <b>рдЖрдХрд╛рд░</b> - рдлрд╝рд╛рдЗрд▓ рд╕реЗ рд╣реА рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ <br>  <b>рдмрдирд╛рдпрд╛</b> - рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ <br>  <b>рдЕрджреНрдпрддрди</b> - рдЖрдк рдПрдХ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ <br>  <b>рдкрд╣реБрдВрдЪ</b> - рдмрд╣рд╛рд▓ рдирд╣реАрдВ <br>  <b>рдЭрдВрдбреЗ</b> - рдмрд╣рд╛рд▓ рдирд╣реАрдВ <br><br>  рдЖрдк рдореЗрдЯрд╛ рд╕реВрдЪрдирд╛ рдХреЛ рддреБрд░рдВрдд рдЫреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рдкреНрд░рдгрд╛рд▓реА рдХреЗ рдХрд╛рдордХрд╛рдЬ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИред  рдФрд░ рддреЗрдЬреА рд╕реЗ рд╡рд╕реВрд▓реА рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдЕрднреА рднреА MIME рдкреНрд░рдХрд╛рд░ рдХреЛ рдмрдЪрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдХреБрд▓: рдЗрдХрд╛рдИ рдкреНрд░рдХрд╛рд░, рдЗрдХрд╛рдИ рдЖрдИрдбреА, MIME, URL, рдкрд╣реБрдВрдЪ рдФрд░ рдЭрдВрдбреЗред  рд╕рд┐рд╕реНрдЯрдо рдХреА рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рдЧрдВрддрд╡реНрдп рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рд▓рд┐рдП рдмреИрдХрдЕрдк рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдЕрд▓рдЧ рд╕реЗ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВрдЧреЗред <br><br><div class="spoiler">  <b class="spoiler_title">рдХрдХреНрд╖рд╛ рдХреЛрдб</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BigFiles</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FLAG_DELETED = <span class="hljs-number"><span class="hljs-number">0x08000000</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    "" /** @var mysqli $_db */ protected $_db = null; protected $_webRoot = ''; protected $_realRoot = ''; function __construct(mysqli $db = null) { $this-&gt;_db = $db; } /** * /   URL- * @param string $v  * @return string */ public function webRoot($v = null) { if (!is_null($v)) { $this-&gt;_webRoot = $v; } return $this-&gt;_webRoot; } /** * /    * @param string $v  * @return string */ public function realRoot($v = null) { if (!is_null($v)) { $this-&gt;_realRoot = $v; } return $this-&gt;_realRoot; } /** *   * @param array $data   * @param string $url URL   * @param string $eType   * @param int $eID ID  * @param mixed $meta - * @param int $access  * @param int $flags  * @param int $fileID ID   * @return bool * @throws Exception */ public function upload(array $data, $url, $eType = '', $eID = null, $meta = null, $access = 127, $flags = 0, $fileID = 0) { $meta = is_array($meta) ? serialize($meta) : $meta; if (empty($data['tmp_name']) || empty($data['name'])) { $fid = intval($fileID); if (empty($fid)) { return false; } $meta = empty($meta) ? 'null' : "'" . $this-&gt;_db-&gt;real_escape_string($meta) . "'"; $q = "`meta`={$meta},`updated`=now()"; $this-&gt;_db-&gt;query("UPDATE `files` SET {$q} WHERE (`id` = {$fid}) AND (`entity_type` = '{$eType}')"); return $fid; } // File data $meta = empty($meta) ? 'null' : "'" . $this-&gt;_db-&gt;real_escape_string($meta) . "'"; $finfo = finfo_open(FILEINFO_MIME_TYPE); $mime = finfo_file($finfo , $data['tmp_name']); finfo_close($finfo); // FID, file name if (empty($fileID)) { $eID = empty($eID) ? 'null' : intval($eID); $q = &lt;&lt;&lt;sql insert into `files` set `mime` = '{$mime}', `entity` = {$eID}, `entityType` = '{$eType}', `created` = now(), `access` = {$access}, `flags` = {$flags} sql; $this-&gt;_db-&gt;query($q); $fid = $this-&gt;_db-&gt;insert_id; list($ffs, $fhn) = self::fid($fid); $url = $this-&gt;_webRoot . $url . '/' . $fid; $fdir = $this-&gt;_realRoot . $ffs; self::validateDir($fdir); $index = self::getIndex($fdir); $index[$fhn] = array($fhn, $mime, $url, ($eID == 'null' ? 0 : $eID), $access, $flags); self::setIndex($fdir, $index); $fname = $ffs . '/' . $fhn . '.file'; } else { $fid = intval($fileID); $fname = $this-&gt;fileName($fid); } // Move file $fdir = $this-&gt;_realRoot . $fname; if (!move_uploaded_file($data['tmp_name'], $fdir)) { throw new Exception('Upload error'); } $q = '`md5`=\'' . md5_file($fdir) . '\',`sha1`=\'' . sha1_file($fdir) . '\',' . '`size`=' . filesize($fdir) . ',`meta`=' . $meta . ',' . (empty($fileID) ? "`url`='{$url}',`file`='{$fname}'" : '`updated`=now()'); $this-&gt;_db-&gt;query("UPDATE `files` SET {$q} WHERE (`id` = {$fid}) AND (`entity_type` = '{$eType}')"); return $fid; } /** *   * @param string $url URL * @param string $basicGroup    * @throws Exception */ public function read($url, $basicGroup = 'anonimous') { if (!ctype_alnum(str_replace(array('/', '.', '-', '_'), '', $url))) { header('HTTP/1.1 400 Bad Request'); exit; } $url = $this-&gt;_db-&gt;real_escape_string($url); $q = "SELECT * FROM `files` WHERE `url` = '{$url}' ORDER BY `created` ASC"; if ($result = $this-&gt;_db-&gt;query($q)) { $vars = array(); $ints = array('id', 'entity', 'size', 'access', 'flags'); while ($row = $result-&gt;fetch_assoc()) { foreach ($ints as $i) { $row[$i] = intval($row[$i]); } $fid = $row['id']; $vars[$fid] = $row; } if (empty($vars)) { header('HTTP/1.1 404 Not Found'); exit; } $deleted = false; $access = true; $found = ''; $mime = ''; foreach ($vars as $fdata) { $flags = intval($fdata['flags']); $deleted = ($flags &amp; self::FLAG_DELETED) != 0; $access = self::granted($basicGroup, $fdata['access']); if (!$access || $deleted) { continue; } $found = $fdata['file']; $mime = $fdata['mime']; } if (empty($found)) { if ($deleted) { header('HTTP/1.1 410 Gone'); exit; } elseif (!$access) { header('HTTP/1.1 403 Forbidden'); exit; } } else { header('Content-type: ' . $mime . '; charset=utf-8'); readfile($this-&gt;_realRoot . $found); exit; } } header('HTTP/1.1 404 Not Found'); exit; } /** *   ()   * @param mixed $fid () * @return bool * @throws Exception */ public function delete($fid) { $fid = is_array($fid) ? implode(',', $fid) : $fid; $q = "delete from `table` where `id` in ({$fid})"; $this-&gt;_db-&gt;query($q); $result = true; foreach ($fid as $fid_i) { list($ffs, $fhn) = self::fid($fid_i); $fdir = $this-&gt;_realRoot . $ffs; $index = self::getIndex($fdir); unset($index[$fhn]); self::setIndex($fdir, $index); $result &amp;= unlink($fdir . '/'. $fhn . '.file'); } return $result; } /** *  ()  "" * @param int $fid () * @param bool $value   * @return bool */ public function setDeleted($fid, $value=true) { $fid = is_array($fid) ? implode(',', $fid) : $fid; $o = $value ? ' | ' . self::FLAG_DELETED : ' &amp; ' . (~self::FLAG_DELETED); $this-&gt;_db-&gt;query("update `files` set `flags` = `flags` {$o} where `id` in ({$fid})"); return true; } /** *   * @param int $fid  * @return string * @throws Exception */ public function fileName($fid) { list($ffs, $fhn) = self::fid($fid); self::validateDir($this-&gt;_realRoot . $ffs); return $ffs . '/' . $fhn . '.file'; } /** *   . *           . * @param int $fid   * @return array */ public static function fid($fid) { $ffs = str_split(str_pad(dechex($fid), 16, '0', STR_PAD_LEFT), 2); $fhn = array_pop($ffs); $ffs = implode('/', $ffs); return array($ffs, $fhn); } /** *    * @param string $f     * @return bool * @throws Exception */ public static function validateDir($f) { if (!is_dir($f)) { if (!mkdir($f, 0700, true)) { throw new Exception('cannot make dir: ' . $f); } } return true; } /** *    * @param string $f       * @return array */ public static function getIndex($f) { $index = array(); if (file_exists($f . '/.index')) { $_ = file($f . '/.index'); foreach ($_ as $_i) { $row = trim($_i); $row = explode('|', $row); array_walk($row, 'trim'); $rid = $row[0]; $index[$rid] = $row; } } return $index; } /** *    * @param string $f       * @param array $index    * @return bool */ public static function setIndex($f, array $index) { $_ = array(); foreach ($index as $row) { $_[] = implode('|', $row); } return file_put_contents($f . '/.index', implode("\r\n", $_)); } /** *   * @param string $group   (. ) * @param int $value   * @return bool */ public static function granted($group, $value=0) { $groups = array('anonimous', 'user', 'manager', 'admin', 'inactive', 'blocked', 'deleted'); if ($group == 'root') { return true; } foreach ($groups as $groupID =&gt; $groupName) { if ($groupName == $group) { return (((1 &lt;&lt; $groupID) &amp; $value) != 0); } } return false; } }</span></span></code> </pre> <br></div></div><br>  рдХреБрдЫ рдмрд┐рдВрджреБрдУрдВ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ: <br><br>  - <b>realRoot</b> - рдлрд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд╕рд╛рде рдлрд╝реЛрд▓реНрдбрд░ рдХрд╛ рдкреВрд░рд╛ рдкрде рдПрдХ рд╕реНрд▓реИрд╢ рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред <br>  - <b>рд╡реЗрдмрд░реВрдЯ</b> - рдПрдХ рдкреНрд░рдореБрдЦ рд╕реНрд▓реИрд╢ рдХреЗ рдмрд┐рдирд╛ рд╕рд╛рдЗрдЯ рдХреА рдЬрдбрд╝ рд╕реЗ рдкрде (рдиреАрдЪреЗ рджреЗрдЦреЗрдВ рдХреНрдпреЛрдВ)ред <br>  - DBMS рдХреЗ рд░реВрдк рдореЗрдВ, рдореИрдВ <b>MySQLi</b> рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВред <br>  - рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, <b>$ _FILES</b> рд╕рд░рдгреА рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА <b>рдЕрдкрд▓реЛрдб</b> рд╡рд┐рдзрд┐ рдХреЗ рдкрд╣рд▓реЗ рддрд░реНрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд░рд┐рдд рдХреА рдЬрд╛рддреА рд╣реИред <br>  - рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рдореМрдЬреВрджрд╛ рдлрд╝рд╛рдЗрд▓ рдХреА рдЖрдИрдбреА рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <b>рдЕрдкрдбреЗрдЯ</b> рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕реЗ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдпрджрд┐ <b>tmp_name</b> рдореЗрдВ рдЗрдирдкреБрдЯ рд╕рд░рдгреА рдЦрд╛рд▓реА рдирд╣реАрдВ рд╣реИред <br>  - рдЖрдк рдПрдХ рдмрд╛рд░ рдореЗрдВ рдХрдИ рдмрд╛рд░ рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рдЭрдВрдбреЗ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдлрд╝рд╛рдЗрд▓ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЛ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рдЖрдкрдХреЛ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдпрд╛ рддреЛ рдПрдХ рд╕рд░рдгреА рдкрд╛рд╕ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП, рдпрд╛ рдЙрдирдХреЗ рд╕рд╛рде рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ, рдЕрд▓реНрдкрд╡рд┐рд░рд╛рдо рджреНрд╡рд╛рд░рд╛ рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><h3>  рдорд╛рд░реНрдЧ </h3><br>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рд╕рд╛рдЗрдЯ рдХреЗ рд░реВрдЯ рдореЗрдВ htaccess рдХреА рдХреБрдЫ рд▓рд╛рдЗрдиреЛрдВ рдХреЗ рдиреАрдЪреЗ рдЖрддрд╛ рд╣реИ (рдпрд╣ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ mod_rewrite рд╕рдХреНрд╖рдо рд╣реИ): <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteCond</span></span></span></span> <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_URI}</span></span> ^/content/(.*)$ RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{REQUEST_FILENAME}</span></span> !-f RewriteRule ^(.+)$ content/index.php?file=<span class="hljs-number"><span class="hljs-number">$1</span></span><span class="hljs-meta"><span class="hljs-meta"> [L,QSA]</span></span></code> </pre> <br>  "рд╕рд╛рдордЧреНрд░реА" рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рд╛рдЗрдЯ рдХреА рдЬрдбрд╝ рдореЗрдВ рдлрд╝реЛрд▓реНрдбрд░ рд╣реИред  рдмреЗрд╢рдХ рдЖрдк рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ рдЕрд▓рдЧ рдирд╛рдо рджреЗ рд╕рдХрддреЗ рд╣реИрдВред  рдФрд░ рдирд┐рд╢реНрдЪрд┐рдд рд╣реА index.php, рд╕рд╛рдордЧреНрд░реА рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $dbHost = <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>; $dbUser = <span class="hljs-string"><span class="hljs-string">'user'</span></span>; $dbPass = <span class="hljs-string"><span class="hljs-string">'****'</span></span>; $dbName = <span class="hljs-string"><span class="hljs-string">'database'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_REQUEST[<span class="hljs-string"><span class="hljs-string">'file'</span></span>])) { header(<span class="hljs-string"><span class="hljs-string">'HTTP/1.1 400 Bad Request'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; } $userG = <span class="hljs-string"><span class="hljs-string">'anonimous'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      ;      $files = new BigFiles(new mysqli($dbHost,$dbUser,$dbPass,$dbName)); $files-&gt;realRoot(dirname(__FILE__).'/files/'); $files-&gt;read($_REQUEST['file'],$userG); } catch (Exception $e) { header('HTTP/1.1 500 Internal Error'); header('Content-Type: text/plain; charset=utf-8'); echo $e-&gt;getMessage(); exit; }</span></span></code> </pre><br>  рдЦреИрд░, рдЕрдкрдиреЗ рдЖрдк рд╣реА, рд╣рдо рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдмрд╛рд╣рд░реА рдПрдХреНрд╕реЗрд╕ рд╕реЗ рд╣реА рдмрдВрдж рдХрд░ рджреЗрддреЗ рд╣реИрдВред  рдХреЗрд╡рд▓ рдПрдХ рдкрдВрдХреНрддрд┐ рдХреЗ рд╕рд╛рде <code>content/files</code> рдлрд╝реЛрд▓реНрдбрд░ <code>content/files</code> рдЬрдбрд╝ рдореЗрдВ <code>.htaccess</code> рдлрд╝рд╛рдЗрд▓ рд░рдЦреЗрдВ: <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">Deny</span></span></span></span> from <span class="hljs-literal"><span class="hljs-literal">all</span></span></code> </pre> <br><h3>  рдкрд░рд┐рдгрд╛рдо </h3><br>  рдпрд╣ рд╕рдорд╛рдзрд╛рди рдЖрдкрдХреЛ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рд╡реГрджреНрдзрд┐ рдХреЗ рдХрд╛рд░рдг рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рджрд░реНрд╢рди рдХреЗ рдиреБрдХрд╕рд╛рди рд╕реЗ рдмрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдПрдХ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╣рдЬрд╛рд░реЛрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рдкрд░реЗрд╢рд╛рдирд┐рдпреЛрдВ рд╕реЗ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдФрд░ рдЙрд╕реА рд╕рдордп, рд╣рдо рдорд╛рдирд╡-рдкрдврд╝рдиреЗ рдпреЛрдЧреНрдп рдкрддреЗ рдкрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдФрд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╕ рдХрд╛рдиреВрди рдХреЗ рд╕рд╛рде рд╕рд╛рде рдЕрдиреБрдкрд╛рд▓рдиред  рддреБрд░рдВрдд рдПрдХ рдЖрд░рдХреНрд╖рдг рдХрд░реЗрдВ, рдпрд╣ рд╕рдорд╛рдзрд╛рди рд╕рд╛рдордЧреНрд░реА рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреВрд░реНрдг рддрд░реАрдХрд╛ рдирд╣реАрдВ рд╣реИред  рдпрд╛рдж рд░рдЦреЗрдВ: рдпрджрд┐ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рдХреБрдЫ рдЪрд▓рддрд╛ рд╣реИ, рддреЛ рдЗрд╕реЗ рдореБрдлреНрдд рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi423875/">https://habr.com/ru/post/hi423875/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi423865/index.html">Roskomnadzor рдиреЗ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рд╕реВрдЪрдирд╛ рджреА</a></li>
<li><a href="../hi423867/index.html">3 рдбреА рдкреНрд░рд┐рдВрдЯрд┐рдВрдЧ рд╕реНрдЯреВрдбрд┐рдпреЛ рдХреЗ рд╕рдВрд╕реНрдерд╛рдкрдХ - рдЕрдкрдиреЗ рдХрд╛рдо рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ</a></li>
<li><a href="../hi423869/index.html">рдиреМрдХрд░рд┐рдпреЛрдВ рдХрд╛ рднрд╡рд┐рд╖реНрдпред рд╡рд┐рд╢реНрд╡ рдЖрд░реНрдерд┐рдХ рдордВрдЪ рдХреА рд░рд┐рдкреЛрд░реНрдЯ рд╕реЗ рдореБрдЦреНрдп рдмрд╛рдд</a></li>
<li><a href="../hi423871/index.html">рд╣рдо SQL рдореЗрдВ рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рддрд╛рд░реНрдХрд┐рдХ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рдорд╛рдзрд╛рди рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi423873/index.html">PICASO 3D рдбрд┐рдЬрд╝рд╛рдЗрдирд░ X 3D рдкреНрд░рд┐рдВрдЯрд░ рдУрд╡рд░рд╡реНрдпреВ</a></li>
<li><a href="../hi423877/index.html">29-31 рдЕрдХреНрдЯреВрдмрд░: рдЙрддреНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░</a></li>
<li><a href="../hi423879/index.html">рдХреНрдпрд╛ рдкреБрд░рд╛рдиреЗ рдврд╛рдВрдЪреЗ рдореЗрдВ рдирдИ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рдЖрд╕рд╛рди рд╣реИ? рд╕реЛрдмрд┐рдЬрд╛рдЗрдЬрд╝рд░ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдкрд░ рдкрд╕рдВрдж рдХрд╛ рдЖрдЯрд╛</a></li>
<li><a href="../hi423881/index.html">рдкреНрд░рдХрд╛рд╢рд┐рдХреА рдХреЗ рд▓рд┐рдП рд╡реЗрд▓реНрдбрд░ рдХреНрдпрд╛ рдереЗ (рднрд╛рдЧ рджреЛ)</a></li>
<li><a href="../hi423885/index.html">рдореЙрд╕реНрдХреЛ рдореЗрдВ рд▓рд╛рдЗрдЯ рд╕рд░реНрдХрд▓ рдХреЗ рднрд╡рд┐рд╖реНрдп рдХреЗ рд╕рд░реНрдХрд▓ рд╕реЗ рдПрдХ рд▓рд╛рдЗрдЯ рд╢реЛ рдФрд░ рдПрдХ рдЫреЛрдЯреЗ рд╕реЗ рдЕрдВрджрд░реВрдиреА рд╕реВрддреНрд░ рдХрд╛ рдирд┐рдордВрддреНрд░рдг</a></li>
<li><a href="../hi423889/index.html">рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдореЗрдВ рдореЗрд░реА рдирд┐рд░рд╛рд╢рд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>