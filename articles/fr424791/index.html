<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•Å ‚ûø üëèüèø Extension des capacit√©s r√©seau d'un relais programmable √† l'aide du WI-FI üë∏üèª ‚õπüèª üéÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comment tout a commenc√© 
 Tout a commenc√© avec le d√©veloppement d'algorithmes pour le relais programmable PR200, et a souvent n√©cessit√© la visualisati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Extension des capacit√©s r√©seau d'un relais programmable √† l'aide du WI-FI</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424791/"><h2>  Comment tout a commenc√© </h2><br>  Tout a commenc√© avec le d√©veloppement d'algorithmes pour le relais programmable PR200, et a souvent n√©cessit√© la visualisation ou la saisie d'informations √† partir d'un ordinateur, pour cela il est n√©cessaire d'utiliser des pupitres op√©rateurs ou des syst√®mes SCADA, mais ce n'est pas toujours pratique, et est-il n√©cessaire pour des syst√®mes simples.  La solution a √©t√© trouv√©e rapidement et au fil du temps, j'ai essay√© d'am√©liorer et de faciliter mon travail dans cette direction autant que possible, ce qui en est ressorti. <br>  Nous parlerons de la carte r√©seau WI-FI et de ses capacit√©s. <br><br><img src="https://habrastorage.org/webt/z7/0j/nn/z70jnnmuwed2qwcdyhbqjhni0-w.jpeg" alt="image"><br><a name="habracut"></a><br>  Comme cette carte est utilis√©e pour d√©boguer divers projets, l'interface d'interaction est constamment modifi√©e pour une configuration plus pratique et plus rapide.  La premi√®re modification a √©t√© un simple convertisseur RS-485 en TCP avec sortie en WEB, avec un firmware pr√™t √† l'emploi connu dans la communaut√© ESP8266.  Plus de 2 ans se sont √©coul√©s depuis, et il a fallu des archives pour analyser des processus longs, et comme je voulais combiner tout cela dans un seul appareil sans √©quipement suppl√©mentaire, il a √©t√© d√©cid√© d'int√©grer le support microSD, ce qui a grandement facilit√© l'analyse des processus avec la possibilit√© d'acc√©der rapidement archives.  La deuxi√®me modification de la carte avait un slot, avec la possibilit√© de retirer une carte microSD pour sauvegarder les fichiers enregistr√©s sur l'ordinateur.  Cela ne m'a pas sembl√© tr√®s pratique, et une version est apparue avec la possibilit√© de t√©l√©charger des fichiers via WI-FI.  Parfois, le t√©l√©chargement n'est pas termin√© et une op√©ration de t√©l√©chargement r√©p√©t√©e est n√©cessaire, mais √©tant donn√© qu'√† l'heure actuelle, l'√©quipement reste op√©rationnel et que l'archivage peut √©galement fonctionner, je pense que ce n'est pas un tr√®s gros probl√®me.  Version √©galement test√©e avec une puce m√©moire de 16 Mo au lieu d'une carte microSD.  T√©l√©chargement plus rapide, mais il n'y a aucun moyen de sauvegarder de nombreux fichiers, l'enregistrement est s√©quentiel jusqu'√† ce que toute la m√©moire soit pleine. <br><br><h2>  Objectif et caract√©ristiques de la carte d'interface </h2><br>  La carte est con√ßue pour √©tendre l'acc√®s aux variables internes de la logique du relais programmable PR200 et donne acc√®s aux variables de lecture et d'√©criture. <br><br>  Gr√¢ce √† l'interface WI-FI sans fil, l'acc√®s √† l'appareil est fourni sans avoir √† connecter d'√©quipement suppl√©mentaire.  Tout d'abord, la solution se concentre sur des projets domotiques simples dans des endroits avec des r√©seaux WI-FI.  Celles-ci incluent des solutions pour l'automatisation de l'√©clairage int√©rieur et ext√©rieur, le contr√¥le et la surveillance des stations de pompage, des serres, etc. En raison de la pr√©sence d'un serveur WEB int√©gr√© dans la carte, il n'est pas n√©cessaire d'acheter de l'√©quipement suppl√©mentaire pour les cas o√π l'acc√®s au syst√®me est n√©cessaire pas souvent.  La sortie d'entr√©e de base est effectu√©e √† l'aide d'un smartphone / tablette ou d'un PC situ√© sur le m√™me r√©seau. <br><br>  La carte d'interface peut fonctionner dans diff√©rents modes.  Lorsqu'il est connect√© √† un routeur avec acc√®s Internet, il vous permet de surveiller √† distance l'√©tat des variables dans la logique du PR200, ainsi que de contr√¥ler l'algorithme via des variables r√©seau dans des formats pris en charge par le PR200 en mode esclave. <br><br>  La communication avec l'algorithme programm√© dans l'appareil est effectu√©e via des variables de r√©seau, tandis que la carte d'interface peut agir comme ma√Ætre ou esclave.  Les vitesses et param√®tres standard de l'interface r√©seau PR200 sont pris en charge.  L'√©change via le protocole Modbus TCP est pris en charge; pour cela, une zone m√©moire de 100 cellules est allou√©e, accessible √† la fois depuis l'interface WEB et via le protocole Modbus RTU du c√¥t√© PR200. <br><br>  Le choix du mode de la carte r√©seau est similaire au choix lorsque l'on travaille avec des panneaux graphiques; travailler en mode ma√Ætre permet de contr√¥ler de mani√®re plus flexible l'√©change de variables; pour les registres dont la valeur doit √™tre obtenue plus souvent que les autres, il est possible de param√©trer moins la p√©riode d'interrogation.  Les commandes suivantes sont disponibles pour le protocole Modbus: <br><br>  03 (0x03) Lecture des registres d'attente Lecture. <br><br>  04 (0x04) Lecture des registres d'entr√©e Lecture <br><br>  06 (0x06) Enregistrement de registre unique pr√©d√©fini <br><br>  16 (0x10) Enregistrement de plusieurs registres pr√©d√©finis <br><br>  Les variables re√ßues du relais sont disponibles pour l'√©criture dans un fichier (archive), qui se trouve sur la carte micro SD, l'enregistrement est au format texte.  Apr√®s le t√©l√©chargement, vous pouvez le visualiser sur un ordinateur dans un simple √©diteur de texte.  Les valeurs enregistr√©es dans le fichier peuvent √™tre affich√©es sur le graphique historique.  En utilisant les options de mise √† l'√©chelle et de s√©lection d'une p√©riode sp√©cifique sur la chronologie, ainsi que l'affichage / masquage individuel des lignes du graphique, l'analyse des donn√©es d'archive est effectu√©e. <br><br>  Les fichiers cr√©√©s pendant le fonctionnement de l'archiveur restent sur la carte microSD et peuvent √™tre t√©l√©charg√©s sur un ordinateur, un seul fichier est disponible √† tout moment, il peut enregistrer des donn√©es d'archive, lire des informations pour cr√©er un graphique historique ou lire des informations pour les enregistrer sur un PC . <br><br>  Pour l'archivage, des variables sont disponibles √† partir de l'espace d'adressage de la carte r√©seau, dans lequel il est n√©cessaire d'√©crire les donn√©es re√ßues via Modbus RTU de PR200 ou Modbus TCP √† partir d'autres appareils prenant en charge le protocole Modbus TCP en mode ma√Ætre. <br><br>  La carte d'interface peut √™tre configur√©e √† la fois en mode point d'acc√®s (Access Point) et en mode client - station de travail (Station), et peut-√™tre dans les deux modes simultan√©ment.  Le plus souvent, le point d'acc√®s a acc√®s √† Internet et sert de pont entre l'appareil et le r√©seau. <br><br>  La connexion sans fil peut √™tre prot√©g√©e par mot de passe, il est √©galement possible de masquer le point d'acc√®s. <br><br>  Les variables obtenues via l'interface RS485 du PR200 peuvent √™tre analys√©es en les pr√©sentant sous forme graphique, dans ce mode les valeurs seront affich√©es en temps r√©el avec une p√©riode de ~ 1 seconde. <br><br>  10 variables sont disponibles pour tracer en entier, en virgule flottante ou en repr√©sentation 16/32 bits.  Le nombre, le type, les adresses des variables et le format de sortie sont issus des param√®tres d'archivage. <br><br>  Pour un fonctionnement rapide et pratique, il a √©t√© d√©cid√© de r√©p√©ter la forme de la carte r√©seau ¬´native¬ª de l'appareil. <br><br><img src="https://habrastorage.org/webt/qv/vg/4j/qvvg4jbi6kbwq0i700vlhi9ftne.jpeg" alt="image"><br>  <i>La carte est install√©e dans l'appareil.</i> <br><br><div class="spoiler">  <b class="spoiler_title">La carte r√©seau peut √™tre install√©e dans le premier ou le deuxi√®me emplacement</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j_/qy/pq/j_qypqdkzcf7j3a9jujeeqq5fza.jpeg" alt="image"><br></div></div><br>  La carte a deux commutateurs, l'un sert √† r√©initialiser la carte r√©seau (n'affecte pas le programme dans PR200), le deuxi√®me commutateur peut √™tre programm√© pour activer l'archivage (s√©lectionn√© via les param√®tres de l'interface WEB de la carte).  Il y a √©galement 2 LED d'information: <br><br>  1 bleu s'allume bri√®vement pendant l'√©change de donn√©es via l'interface RS-485 avec PR200 <br>  2-rouge s'allume bri√®vement au moment de l'√©criture des donn√©es sur la carte micro SD et est constamment allum√© s'il n'y a pas de carte ou s'il est impossible de lire les donn√©es sur la carte. <br><br>  Voici les menus principaux lorsque vous travaillez dans diff√©rents modes: <br><br><img src="https://habrastorage.org/webt/to/ny/-9/tony-98orqrhf1luvbjsjgunzum.png" alt="image"><br>  <i>Param√®tres r√©seau de base pour la connexion via WEB.</i> <br><br><img src="https://habrastorage.org/webt/mh/cm/f8/mhcmf8an5ct55x2o3xaoaatw6ps.png" alt="image"><br>  <i>Param√®tres de connexion √† l'interface r√©seau PR200 et param√®tres de connexion via Modbus TCP via WIFI</i> <br><br><img src="https://habrastorage.org/webt/_6/xm/cz/_6xmcznmcjb3mtvepazjeqwh75c.png" alt="image"><br>  <i>Carte des registres internes communs au Web, Modbus RTU et Modbus TCP</i> <br><br><div class="spoiler">  <b class="spoiler_title">Page WEB de test pour contr√¥ler et surveiller l'√©tat des E / S du PR200 avec le module d'extension PRM-1 connect√©.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nd/tu/fk/ndtufkepntezf8hbwxjdaxozxdi.png" alt="image"><br><br><img src="https://habrastorage.org/webt/qp/td/yx/qptdyx2xpp1ttfzucdh6iprrac4.png" alt="image"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Pages d'entr√©e / sortie des valeurs du PR200 et transmission des donn√©es aux sorties de contr√¥le de l'appareil.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sw/c8/yb/swc8ybmb1radp2jcf027mi_be0s.png" alt="image"></div></div><br>  Lors de la connexion d'une carte r√©seau √† un routeur avec acc√®s Internet et redirection de port, le travail √† distance avec la carte via un navigateur est possible. <br><br><h2>  Comment √ßa marche </h2><br>  Voici des captures d'√©cran lors de l'ex√©cution de PR200 sur un projet r√©el, avec archivage des donn√©es.  Un projet est charg√© dans le PR200, qui lit les valeurs des 4 canaux analogiques auxquels les capteurs NTC sont connect√©s et convertit ces valeurs en temp√©rature, √† l'aide de la deuxi√®me interface r√©seau configur√©e en mode ma√Ætre, le PR200 interroge le module MV110-8A auquel 2 DTC Pt1000 sont connect√©s.  Ainsi, des donn√©es sont collect√©es sur 4 valeurs de r√©sistance des entr√©es analogiques du PR200, 4 valeurs de temp√©rature obtenues √† l'aide de la macro NTC, ainsi que 2 valeurs de temp√©rature re√ßues du module MV110-8A via RS-485.  Les 10 registres au format flottant de la premi√®re interface r√©seau configur√©e en mode ma√Ætre sont lus pour √©criture dans l'archive et visualisation WEB. <br><br><img src="https://habrastorage.org/webt/ov/kb/ue/ovkbuegmxtn4pkqkubbbkmfnxxs.png" alt="image"><br>  <i>Le menu de travail avec la carte SD, lorsque l'archivage est d√©sactiv√©, affiche une liste des fichiers sur la carte, lorsque l'archivage est activ√©, affiche le journal de l'enregistrement sur la carte.</i> <i><br></i> <br><br><div class="spoiler">  <b class="spoiler_title">Menu de gestion des archives.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mx/jq/7y/mxjq7y7yqfezmgaflitikmg2qrg.png" alt="image"></div></div><br><img src="https://habrastorage.org/webt/w4/45/1j/w4451jdprj0bwuvdt6ytzfem27c.png" alt="image"><br>  Les horodatages pour l'archivage sont lus √† partir des registres d'horloge en temps r√©el du PR200; dans cet exemple, l'horloge n'est pas synchronis√©e avec le temps r√©el. <br><br><div class="spoiler">  <b class="spoiler_title">Fichier d'archive t√©l√©charg√© via WI-FI avec micro SD install√© sur la carte et ouvert avec un √©diteur de texte.</b>  <b class="spoiler_title">Pr√™t pour la repr√©sentation graphique.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vd/r8/zo/vdr8zoxuhegu_i0nu1cnqkepln4.png" alt="image"></div></div><br><div class="spoiler">  <b class="spoiler_title">La page s'est ouverte dans le navigateur pour construire un graphique √† partir du fichier t√©l√©charg√©.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9z/8z/s6/9z8zs6cxqt_ogdniz-qwc6evtqq.png" alt="image"></div></div><br><img src="https://habrastorage.org/webt/ml/84/2m/ml842mxpwvm1xnth6o54qhbbntq.png" alt="image"><br>  <i>Le planning g√©n√©r√© en fonction des donn√©es du fichier archive.</i> <br><br><img src="https://habrastorage.org/webt/vt/of/t3/vtoft3tx0zwvwgzzz3gzituvhhk.png" alt="image"><br>  <i>G√©rer la visibilit√© des graphiques √† travers une l√©gende</i> <br><br><img src="https://habrastorage.org/webt/gm/wz/9f/gmwz9fhbq3b8d7nqirlqsqaka2u.png" alt="image"><br>  <i>D√©tailler les sections n√©cessaires sur le graphique.</i> <br><br><h2>  Enregistrer l'acc√®s via Modbus TCP (WIFI) </h2><br>  Si les capacit√©s WEB ne suffisent pas pour cr√©er la visualisation, alors en utilisant l'acc√®s via Modbus TCP, vous pouvez organiser la communication avec les syst√®mes SCADA et cr√©er rapidement la visualisation n√©cessaire √† partir de blocs pr√™ts √† l'emploi.  √Ä l'aide de divers moniteurs r√©seau, il est possible de surveiller l'√©tat des registres internes de la carte r√©seau et des registres int√©gr√©s du PR200.  Exemple d'interrogation √† l'aide du logiciel Modbus Poll. <br><br><img src="https://habrastorage.org/webt/jn/vl/es/jnvlesf0u-zjwdw7ykpea0vlgn0.png" alt="image"><br>  <i>Connexion via le protocole ModBus TCP √† l'aide du logiciel Modbus Poll.</i> <br><br><img src="https://habrastorage.org/webt/vj/h1/nv/vjh1nvjwlnxmo8mxpzfmdf8d6n8.png" alt="image"><br>  <i>Lire les registres et les pr√©senter sous diff√©rents formats.</i> <br><br><h2>  Conclusions </h2><br>  Apr√®s avoir install√© la carte r√©seau dans l'appareil, des fonctionnalit√©s et des outils suppl√©mentaires apparaissent lors de l'utilisation du relais programmable PR200.  Diff√©rents sc√©narios d'utilisation sont possibles √† la fois individuellement et en mode combin√©. <br><br>  Par exemple, l'enregistrement d'√©v√©nements archiv√©s dans PR200, √† l'heure actuelle, diverses macros ont √©t√© cr√©√©es pour enregistrer des √©v√©nements archiv√©s dans l'appareil, mais elles occupent beaucoup de ressources dans l'appareil et ont des capacit√©s limit√©es √† la fois pour la sortie des informations et pour la profondeur de l'archivage, en utilisant un lecteur externe, il existe une possibilit√© plus flexible pour configurer et enregistrer les √©v√©nements n√©cessaires.  Pour faciliter l'analyse, un mode d'√©criture des registres en mode bit a √©t√© ajout√©, donc un nombre de 16 ou 32 bits d√©compos√© en bits entre dans l'archive.  Diff√©rents modes de d√©marrage de l'archivage sont pris en charge, via un interrupteur sur la carte, une interface WEB, un registre ModBus.  √Ä l'aide du registre ModBus, l'appareil d√©termine lui-m√™me le moment d'enregistrement en √©crivant un nombre autre que ¬´0¬ª dans la cellule, le param√®tre est d√©pass√©, nous √©crivons dans le registre ¬´1¬ª et les journaux sont √©crits jusqu'√† ce que la valeur soit √©crite dans le registre ¬´0¬ª, semblable au fonctionnement des signaux d'entr√©e.  S√©par√©ment, vous pouvez s√©lectionner un enregistrement avec une certaine p√©riode de diverses donn√©es sur la temp√©rature, la pression, l'humidit√© pour une analyse ult√©rieure dans une repr√©sentation graphique.  Pour convertir des donn√©es en vue graphique, une page Web est int√©gr√©e √† l'appareil. <br><br>  Le deuxi√®me sc√©nario est la t√©l√©commande ou la surveillance de l'√©tat des variables internes, la modification des modes de fonctionnement.  Cette option peut √™tre divis√©e en local, au sein du r√©seau interne et via Internet. <br><br>  Les options restantes sont auxiliaires, d√©bogage, affichage des variables d'int√©r√™t sur la visualisation actuelle, affichage des variables r√©seau, etc. <br><br>  Il est int√©ressant d'entendre l'opinion de la communaut√© sur ce sujet, qui r√©sout de quelle mani√®re des probl√®mes similaires? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr424791/">https://habr.com/ru/post/fr424791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr424777/index.html">Utilisation de Consul pour faire √©voluer les services avec √©tat</a></li>
<li><a href="../fr424779/index.html">SPA multi-page en Python</a></li>
<li><a href="../fr424781/index.html">Enseignement et test de r√©seaux de neurones sur PyTorch avec Ignite</a></li>
<li><a href="../fr424787/index.html">Entretien avec Aaron Patterson, pr√©sident de la conf√©rence RubyRussia 2018</a></li>
<li><a href="../fr424789/index.html">Comment d√©ployer une application Ruby on Rails avec HAProxy Ingress, unicorn / puma et des sockets Web</a></li>
<li><a href="../fr424793/index.html">Comment imprimer un moteur √©lectrique</a></li>
<li><a href="../fr424795/index.html">Quelle taille peut avoir un drone solaire?</a></li>
<li><a href="../fr424799/index.html">Analyses bidirectionnelles pour les widgets iframe affili√©s √† l'aide de Google Tag Manager</a></li>
<li><a href="../fr424801/index.html">Zeppelin OS - une autre √©tape vers des contrats intelligents s√©curis√©s</a></li>
<li><a href="../fr424803/index.html">Un pirate ta√Øwanais √©tait sur le point de pirater la page Facebook de Mark Zuckerberg en ligne, mais a ensuite abandonn√© ses menaces</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>