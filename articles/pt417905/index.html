<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò§ üë©üèª‚Äçüî¨ üßëüèø‚Äçü§ù‚Äçüßëüèº 11 maneiras (n√£o) de se tornar v√≠tima de hackers no Kubernetes üç¨ üïî üåÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nota perev. : O original deste artigo foi publicado no blog oficial da Kubernetes e escrito por Andrew Martin, um dos fundadores da jovem empresa brit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>11 maneiras (n√£o) de se tornar v√≠tima de hackers no Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/417905/">  <i><b>Nota</b></i>  <i><b>perev.</b></i>  <i>: O original deste artigo foi publicado no blog oficial da Kubernetes e escrito por Andrew Martin, um dos fundadores da jovem empresa brit√¢nica Control Plane, especializada em seguran√ßa para aplicativos nativos da nuvem em execu√ß√£o no K8s.</i> <br><br><img src="https://habrastorage.org/webt/em/sv/dw/emsvdwgvf4ym5fydg8ob7jxomcq.jpeg"><br><br>  A seguran√ßa em Kubernetes percorreu um longo caminho desde a chegada do projeto, mas ainda existem armadilhas.  Oferecemos uma lista de recomenda√ß√µes √∫teis sobre como proteger clusters e aumentar sua estabilidade em caso de hackers: come√ßaremos com o plano de controle, continuaremos com cargas de trabalho e seguran√ßa de rede e terminaremos com uma avalia√ß√£o da seguran√ßa futura. <a name="habracut"></a><br><br><h2>  Parte 1: Plano de Controle </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O plano de controle</a> √© o c√©rebro de Kubernetes.  Ele tem uma id√©ia geral de cada cont√™iner e pod em execu√ß√£o no cluster, pode planejar novos pods (que podem conter cont√™ineres com acesso root aos seus n√≥s pais) e pode ler todos os segredos armazenados no cluster.  Este √© um componente muito importante que precisa de prote√ß√£o constante contra vazamento acidental de dados e a√ß√µes maliciosas: tanto quando √© acessado, quando nada acontece, como quando os dados s√£o transmitidos pela rede. <br><br><h3>  1. TLS onipresente </h3><br>  <b>Para cada componente que suporta TLS, ele deve estar ativado - para impedir a detec√ß√£o de tr√°fego, a verifica√ß√£o de identidade do servidor e (no caso do Mutual TLS) a verifica√ß√£o de identidade do cliente.</b> <br><br><blockquote>  "Observe que alguns componentes e m√©todos de instala√ß√£o podem ativar portas locais para HTTP, portanto, os administradores precisam se familiarizar com as configura√ß√µes de cada componente para identificar poss√≠veis caminhos para tr√°fego inseguro". <br><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Da documenta√ß√£o do Kubernetes</a></i> </blockquote><br>  O diagrama de rede abaixo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lucas K√§ldstr√∂m</a> mostra onde o TLS √© idealmente necess√°rio: entre cada componente no assistente e entre o Kubelet e o servidor da API.  O cl√°ssico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kelsey Hightower</a> <a href="">Kubernetes The Hard Way</a> e a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o de seguran√ßa no etcd</a> oferecem instru√ß√µes detalhadas para alcan√ßar esses objetivos. <br><br><img src="https://habrastorage.org/webt/tl/z6/9p/tlz69p-_qgydpvdbkb8i0wkwjlm.png"><br><br>  Historicamente, o dimensionamento autom√°tico dos n√≥s do Kubernetes n√£o era f√°cil, pois cada n√≥ exigia uma chave TLS para conectar-se ao mestre e manter segredos em imagens b√°sicas √© uma pr√°tica recomendada.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O bootstrapping TLS do Kubelet</a> permite que o novo Kubelet crie uma solicita√ß√£o de assinatura de certificado para que os certificados sejam gerados no momento da inicializa√ß√£o: <br><br><img src="https://habrastorage.org/webt/js/7x/bw/js7xbwddp6cgld-bgcp20r657qy.png"><br><br><h3>  2. Privil√©gios m√≠nimos no RBAC, desativando o ABAC, monitorando o log </h3><br>  <b>O RBAC (Controle de Acesso Baseado em Fun√ß√£o) fornece gerenciamento de pol√≠tica refinado, pelo qual os usu√°rios acessam recursos como espa√ßos para nome.</b> <br><br><img src="https://habrastorage.org/webt/if/so/hz/ifsohz4fgeo5alqvpe4pbvimujq.png"><br><br>  O ABAC (Controle de Acesso Baseado em Atributos) no Kubernetes foi substitu√≠do pelo RBAC desde o K8s 1.6 e n√£o deve ser ativado no lado do servidor da API.  Use o RBAC: <code>--authorization-mode=RBAC</code> (ou este sinalizador para GKE: <code>--no-enable-legacy-authorization</code> ). <br><br>  Existem muitos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bons exemplos de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pol√≠ticas RBAC</a> para v√°rios servi√ßos em um cluster, al√©m de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> .  Mas n√£o pare por a√≠: configura√ß√µes competentes para pol√≠ticas RBAC podem ser obtidas usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">audit2rbac</a> nos logs de <code>audit</code> . <br><br>  Pol√≠ticas de RBAC incorretas ou excessivamente permissivas s√£o um risco de seguran√ßa se a lareira estiver comprometida.  Manter as regras do RBAC com privil√©gios m√≠nimos, auditando-as constantemente e melhorando-as deve fazer parte da ‚Äúhigiene t√©cnica da d√≠vida‚Äù que as equipes aplicam no ciclo de vida do desenvolvimento. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O log de auditoria</a> (beta no Kubernetes 1.10) oferece uma API de log personalizada para cargas de trabalho (como solicita√ß√£o e resposta) e no n√≠vel de metadados.  O n√≠vel de log pode ser configurado de acordo com a pol√≠tica de seguran√ßa da organiza√ß√£o - o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GKE</a> aplica valores padr√£o razo√°veis ‚Äã‚Äãpara aqueles que est√£o come√ßando a trabalhar com ele. <br><br>  Para solicita√ß√µes de leitura como <i>get</i> , <i>list</i> e <i>watch</i> , apenas o objeto solicitado √© armazenado nos logs de auditoria, sem um objeto de resposta.  Para consultas que envolvam dados confidenciais como <i>Secret</i> ou <i>ConfigMap</i> , apenas os metadados s√£o exportados.  Para todas as outras solicita√ß√µes, os dois objetos s√£o registrados nos logs de auditoria: a solicita√ß√£o e a resposta. <br><br>  N√£o se esque√ßa: armazenar esses logs dentro do cluster √© um risco de seguran√ßa em caso de comprometimento.  Esses logs, como quaisquer outros sens√≠veis √† seguran√ßa, devem ser colocados fora do cluster para evitar consequ√™ncias negativas em caso de vulnerabilidade. <br><br><h3>  3. Use autentica√ß√£o de terceiros para o API Server </h3><br>  <b>A centraliza√ß√£o da autentica√ß√£o e autoriza√ß√£o para toda a organiza√ß√£o (ou seja, Logon √önico) ajuda nos processos de aceita√ß√£o e sa√≠da de novos funcion√°rios, garantindo direitos de acesso consistentes.</b> <br><br>  A integra√ß√£o do Kubernetes com provedores de autentica√ß√£o de terceiros (como Google ou GitHub) fornece garantias de identidade de uma plataforma remota (com prote√ß√£o como autentica√ß√£o de dois fatores) e elimina a necessidade de administradores reconfigurar o servidor de API no Kubernetes para adicionar / remover usu√°rios. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dex</a> √© um provedor OIDC (OpenID Connect Identity) e OAuth 2.0 com plug-ins.  O Pusher foi ainda mais longe, fornecendo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ferramentas personaliz√°veis</a> , al√©m das quais existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">outros</a> auxiliares focados em outros aplicativos. <br><br><h3>  4. Separe e coloque seu cluster etcd atr√°s do firewall </h3><br>  <b>O etcd armazena informa√ß√µes sobre o status e os segredos do Kubernetes, √© um componente cr√≠tico dos K8s - deve ser protegido separadamente do resto do cluster.</b> <br><br>  O acesso de grava√ß√£o ao etcd no servidor da API √© equivalente √† emiss√£o de direitos de root para todo o cluster, e at√© o acesso de leitura pode ser facilmente usado para aumentar os privil√©gios. <br><br>  O planejador do Kubernetes no etcd procura defini√ß√µes de pod que n√£o possuem um n√≥.  Em seguida, ele envia todos os pods encontrados para o Kubelet dispon√≠vel para planejamento.  A valida√ß√£o desses pods √© feita pelo servidor da API antes de grav√°-los no etcd; portanto, os invasores que gravam diretamente no etcd podem ignorar muitos mecanismos de seguran√ßa - por exemplo, <code>PodSecurityPolicies</code> . <br><br>  O etcd deve ser configurado com <a href="">os certificados TLS</a> ( <i>cliente</i> e <i>par</i> ) e distribu√≠do para n√≥s dedicados.  Para reduzir o risco de roubo e uso de chaves privadas de n√≥s de trabalho, voc√™ tamb√©m pode limitar o firewall do cluster do API Server. <br><br><h3>  5. Rota√ß√£o das chaves de criptografia </h3><br>  <b>A rota√ß√£o regular de chaves e certificados de seguran√ßa √© a melhor pr√°tica de seguran√ßa que permite limitar o "raio de destrui√ß√£o" quando a chave √© comprometida.</b> <br><br>  O Kubernetes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">alternar√° automaticamente</a> alguns certificados (em particular, certificados de cliente e servidor Kubelet) criando novos CSRs depois que os atuais expirarem. <br><br>  No entanto, as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chaves sim√©tricas</a> usadas pelo servidor da API para criptografar valores etcd n√£o s√£o giradas automaticamente - isso deve ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">feito manualmente</a> .  Esta opera√ß√£o requer acesso mestre, portanto, servi√ßos gerenciados (como GKE e AKS) ocultam o problema do usu√°rio. <br><br><h2>  Parte 2: cargas de trabalho </h2><br>  Com seguran√ßa m√≠nima no n√≠vel do plano de controle, o cluster j√° pode funcionar com seguran√ßa.  No entanto, como em um navio com carga potencialmente perigosa, os cont√™ineres de tal navio devem proteger a carga em caso de acidente ou vazamento imprevisto.  O mesmo vale para as cargas de trabalho do Kubernetes ( <i>pods</i> , <i>implanta√ß√µes</i> , <i>tarefas</i> , <i>conjuntos</i> etc.) - elas podem ser confi√°veis ‚Äã‚Äãno momento da implanta√ß√£o, mas se forem acess√≠veis externamente, sempre haver√° o risco de serem exploradas posteriormente pelos [invasores].  Esse risco pode ser atenuado executando cargas de trabalho com privil√©gios m√≠nimos e sua configura√ß√£o segura. <br><br><h3>  6. Use os recursos de seguran√ßa do Linux e o PodSecurityPolicies </h3><br>  <b>O kernel do Linux possui muitas extens√µes de seguran√ßa parcialmente sobrepostas (recursos, SELinux, AppArmor, seccomp-bpf) que podem ser configuradas para conceder privil√©gios m√≠nimos aos aplicativos.</b> <br><br>  Utilit√°rios como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bane</a> o ajudar√£o a gerar perfis para o AppArmor, e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">docker-slim</a> o ajudar√° a gerar perfis seccomp, mas tenha cuidado: para identificar todos os efeitos colaterais da aplica√ß√£o dessas pol√≠ticas, voc√™ precisa de um conjunto de testes abrangente que verifique todo o c√≥digo do aplicativo. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PodSecurityPolicies</a> regem o uso dessas extens√µes de seguran√ßa, bem como outras diretivas de seguran√ßa do Kubernetes.  Eles s√£o respons√°veis ‚Äã‚Äãpelos requisitos m√≠nimos que devem ser atendidos para acessar o servidor da API, incluindo perfis de seguran√ßa, sinalizador de privil√©gios, rede host compartilhada, processos ou espa√ßos de nome para IPC. <br><br>  Essas diretivas s√£o importantes porque ajudam a impedir que processos em cont√™ineres escapem de seus limites isolados.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O exemplo do PodSecurityPolicy de Tim Allclair √©</a> muito vers√°til - voc√™ pode tom√°-lo como base e personaliz√°-lo para o seu caso. <br><br><h3>  7. Execute uma an√°lise est√°tica do YAML </h3><br>  <b>Se o PodSecurityPolicies restringir o acesso ao servidor da API, a an√°lise est√°tica tamb√©m poder√° ser usada no processo de desenvolvimento para modelar os requisitos regulat√≥rios da organiza√ß√£o e o apetite ao risco.</b> <br><br>  Informa√ß√µes confidenciais n√£o devem ser armazenadas em recursos YAML, como lares ( <i>pods</i> , <i>implanta√ß√µes</i> , <i>conjuntos</i> etc.), e <i>ConfigMaps</i> e <i>segredos</i> confidenciais devem ser criptografados com utilit√°rios como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vault</a> (com um operador do CoreOS), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">git-crypt</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">segredos selados</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nuvem KMS fornecedor</a> . <br><br>  A an√°lise est√°tica da configura√ß√£o YAML pode ser usada como base para seguran√ßa durante a inicializa√ß√£o.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O kubesec</a> gera avalia√ß√µes de risco para recursos: <br><br><pre> <code class="plaintext hljs">{ "score": -30, "scoring": { "critical": [{ "selector": "containers[] .securityContext .privileged == true", "reason": "Privileged containers can allow almost completely unrestricted host access" }], "advise": [{ "selector": "containers[] .securityContext .runAsNonRoot == true", "reason": "Force the running image to run as a non-root user to ensure least privilege" }, { "selector": "containers[] .securityContext .capabilities .drop", "reason": "Reducing kernel capabilities available to a container limits its attack surface", "href": "https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" }] } }</code> </pre> <br>  E o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">kubetest</a> √© uma estrutura para testar as configura√ß√µes do Kubernetes: <br><br><pre> <code class="go hljs">#<span class="hljs-comment"><span class="hljs-comment">// vim: set ft=python: def test_for_team_label(): if spec["kind"] == "Deployment": labels = spec["spec"]["template"]["metadata"]["labels"] assert_contains(labels, "team", "should indicate which team owns the deployment") test_for_team_label()</span></span></code> </pre> <br>  Esses utilit√°rios implementam a abordagem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">shift left</a> (ou seja, eles movem a valida√ß√£o e a verifica√ß√£o para os est√°gios iniciais do ciclo de desenvolvimento).  O teste de seguran√ßa no est√°gio de desenvolvimento fornece aos usu√°rios feedback r√°pido sobre o c√≥digo e a configura√ß√£o, que podem ser posteriormente rejeitados pela verifica√ß√£o manual ou automatizada, al√©m de facilitar a introdu√ß√£o de pr√°ticas de seguran√ßa adicionais. <br><br><h3>  8. Executar cont√™ineres n√£o raiz </h3><br>  <b>Os cont√™ineres executados como raiz geralmente t√™m muito mais direitos do que as cargas de trabalho exigem e, se comprometidos, ajudam os invasores a obter √≥timos recursos.</b> <br><br>  Os cont√™ineres ainda confiam no modelo de seguran√ßa tradicional do UNIX (chamado DAC, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">controle de acesso discricion√°rio</a> ) - tudo √© um arquivo e os direitos s√£o concedidos a usu√°rios e grupos. <br><br>  Os espa√ßos para nome do usu√°rio n√£o funcionam no Kubernetes.  Isso significa que a tabela de ID do usu√°rio no cont√™iner √© mapeada para a tabela de usu√°rios do host e iniciar o processo com privil√©gios de root dentro do cont√™iner faz com que seja executado com privil√©gios de root no host.  Embora mecanismos sejam adicionados a tudo isso para impedir a sa√≠da do cont√™iner, a execu√ß√£o como raiz dentro do cont√™iner n√£o √© recomendada. <br><br>  Muitas imagens de cont√™ineres usam o usu√°rio root para executar o PID 1: se esse processo for comprometido, o invasor se tornar√° root no cont√™iner e, com qualquer erro de configura√ß√£o, a opera√ß√£o do problema se tornar√° muito mais f√°cil. <br><br>  O Bitnami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fez um √≥timo trabalho</a> ao converter suas imagens de cont√™iner para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">usu√°rios regulares (n√£o raiz)</a> (que tamb√©m √© o requisito padr√£o do OpenShift), o que tamb√©m pode simplificar sua migra√ß√£o para imagens n√£o raiz. <br><br>  Este fragmento PodSecurityPolicy impede que os processos raiz sejam executados no cont√™iner e escalados para o root: <br><br><pre> <code class="plaintext hljs"># Required to prevent escalations to root. allowPrivilegeEscalation: false runAsUser: # Require the container to run without root privileges. rule: 'MustRunAsNonRoot'</code> </pre> <br>  Os cont√™ineres que n√£o usam raiz n√£o podem ocupar portas privilegiadas, ou seja,  at√© 1024 (o recurso correspondente no kernel do Linux - <code>CAP_NET_BIND_SERVICE</code> √© respons√°vel por isso), no entanto, o uso dos <i>Servi√ßos</i> ajuda a contornar essa limita√ß√£o.  Aqui est√° um exemplo para o aplicativo MyApp, que ocupa a porta 8443 no cont√™iner, mas o <i>Service</i> o disponibiliza na porta 443, solicitando proxy para <code>targetPort</code> : <br><br><pre> <code class="plaintext hljs">kind: Service apiVersion: v1 metadata: name: my-service spec: selector: app: MyApp ports: - protocol: TCP port: 443 targetPort: 8443</code> </pre> <br>  A necessidade de executar cargas de trabalho sem usar raiz permanecer√° at√© que o espa√ßo de nome do usu√°rio ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o tempo de opera√ß√£o</a> para iniciar cont√™ineres sem raiz sejam inclu√≠dos no tempo de execu√ß√£o do cont√™iner. <br><br><h3>  9. Use pol√≠ticas de rede </h3><br>  <b>Por padr√£o, a rede Kubernetes permite todo o tr√°fego entre os pods.</b>  <b>Essa configura√ß√£o pode ser limitada pela pol√≠tica de rede - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><i>NetworkPolicy</i></a> .</b> <br><br><img src="https://habrastorage.org/webt/kd/cv/xu/kdcvxufrkq2dm0jw13vk8hvowae.png"><br><br>  Os servi√ßos tradicionais s√£o limitados a firewalls que usam endere√ßos IP est√°ticos e intervalos de portas para cada servi√ßo.  Como esses endere√ßos IP mudam muito raramente, historicamente t√™m sido usados ‚Äã‚Äãcomo uma forma de autentica√ß√£o.  Os cont√™ineres raramente t√™m IPs est√°ticos - sua natureza implica a possibilidade de uma queda e recria√ß√£o r√°pidas, pois eles usam a descoberta de servi√ßos em vez de endere√ßos IP est√°ticos.  Esses recursos complicam bastante a configura√ß√£o e a verifica√ß√£o de firewalls. <br><br>  Como o Kubernetes armazena todos os dados sobre o estado do sistema no etcd, √© poss√≠vel configurar um firewall din√¢mico - se houver o suporte necess√°rio no plug-in da rede CNI.  Calico, Cilium, kube-router, Romana e Weave Net - todos esses plugins suportam pol√≠ticas de rede. <br><br>  √â importante observar que as pol√≠ticas funcionam com base no princ√≠pio de falha fechada, ou seja, a aus√™ncia de um <code>podSelector</code> aqui por padr√£o √© igual a todos os valores poss√≠veis (curinga): <br><br><pre> <code class="plaintext hljs">apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: default-deny spec: podSelector:</code> </pre> <br>  A seguir, √© apresentado um exemplo de <i>NetworkPolicy</i> , que pro√≠be tudo da sa√≠da, exceto o UDP 53 (DNS), que tamb√©m impede conex√µes de entrada para o aplicativo.  <i>NetworkPolicies</i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">s√£o</a> pol√≠ticas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">com estado</a> , portanto o aplicativo ainda receber√° respostas para conex√µes de sa√≠da. <br><br><pre> <code class="plaintext hljs">apiVersion: networking.k8s.io/v1 kind: NetworkPolicy metadata: name: myapp-deny-external-egress spec: podSelector: matchLabels: app: myapp policyTypes: - Egress egress: - ports: - port: 53 protocol: UDP - to: - namespaceSelector: {}</code> </pre> <br>  As diretivas de rede do Kubernetes n√£o podem ser aplicadas aos nomes DNS.  O motivo √© que o DNS suporta round-robin para v√°rios endere√ßos IP e respostas din√¢micas dependentes do IP de acesso; portanto, as pol√≠ticas de rede se aplicam apenas a endere√ßos IP fixos ou <code>podSelector</code> (para endere√ßos IP din√¢micos do Kubernetes). <br><br>  A melhor pr√°tica √© come√ßar banindo todo o tr√°fego para o espa√ßo para nome e adicionando passo a passo as rotas exigidas pelo aplicativo para passar no teste de aceita√ß√£o.  O processo pode ser dif√≠cil, ent√£o a ControlPlane desenvolveu o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">netassert</a> , um utilit√°rio para testar a seguran√ßa da rede em scripts DevSecOps com o nmap altamente paralelo: <br><br><pre> <code class="plaintext hljs">k8s: # used for Kubernetes pods deployment: # only deployments currently supported test-frontend: # pod name, defaults to `default` namespace test-microservice: 80 # `test-microservice` is the DNS name of the target service test-database: -80 # `test-frontend` should not be able to access test-database's port 80 169.254.169.254: -80, -443 # AWS metadata API metadata.google.internal: -80, -443 # GCP metadata API new-namespace:test-microservice: # `new-namespace` is the namespace name test-database.new-namespace: 80 # longer DNS names can be used for other namespaces test-frontend.default: 80 169.254.169.254: -80, -443 # AWS metadata API metadata.google.internal: -80, -443 # GCP metadata API</code> </pre> <br>  Uma API com metadados de um provedor de nuvem √© uma fonte constante de escalada em potencial (demonstrada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pela</a> recente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recompensa de bugs do Shopify</a> ); portanto, testes especiais que confirmam que a API est√° bloqueada na rede de cont√™ineres ajudam a proteger contra erros de configura√ß√£o. <br><br><h3>  10. Digitalize imagens e execute IDS </h3><br>  <b>Servidores da Web s√£o um trampolim para atacar as redes √†s quais est√£o conectados.</b>  <b>A verifica√ß√£o dos arquivos instalados nas imagens permite verificar se n√£o h√° vulnerabilidades conhecidas que um invasor possa usar para obter acesso remoto ao cont√™iner.</b>  <b>Os sistemas de detec√ß√£o de intrus√µes (IDS) registram esses eventos se eles ocorrerem.</b> <br><br>  O Kubernetes permite envios ao cluster por meio de um conjunto de verifica√ß√µes de controle (no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">controlador de admiss√£o</a> ), que se aplicam n√£o apenas aos pods, mas tamb√©m a outros recursos, como <i>implanta√ß√µes</i> .  Neles, cada sub pode ser validado para admiss√£o ou seu conte√∫do pode ser alterado, al√©m de quais webhooks no lado de back-end agora tamb√©m s√£o suportados. <br><br><img src="https://habrastorage.org/webt/0s/-h/fw/0s-hfwbv4xf-izil5ljtxjxdyjm.png"><br><br>  Esses webhooks podem ser usados ‚Äã‚Äãpelas ferramentas de varredura de imagem do cont√™iner para verificar as imagens antes de serem implantadas no cluster.  Imagens que falham na valida√ß√£o n√£o receber√£o a aprova√ß√£o do controlador. <br><br>  A verifica√ß√£o de imagens de cont√™iner em busca de vulnerabilidades conhecidas ajuda a reduzir o tempo que um invasor pode tirar proveito de um CVE aberto.  Para evitar o lan√ßamento de imagens com vulnerabilidades cr√≠ticas no pipeline de implanta√ß√£o, voc√™ pode usar utilit√°rios gratuitos como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Clair</a> do CoreOS e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Micro Scanner</a> do Aqua. <br><br>  Ferramentas como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grafeas</a> permitem armazenar metadados de imagem para verifica√ß√µes cont√≠nuas de conformidade e vulnerabilidade usando uma assinatura de cont√™iner exclusiva (ou hash de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">endere√ßamento de conte√∫do</a> especial).  A digitaliza√ß√£o de uma imagem de cont√™iner usando esse hash equivale √† digitaliza√ß√£o de imagens implantadas na produ√ß√£o e pode ser executada continuamente, sem a necessidade de acesso aos ambientes de produ√ß√£o. <br><br>  As vulnerabilidades desconhecidas do dia 0 sempre existir√£o, portanto o Kubernetes deve implantar um sistema de detec√ß√£o de intrus√µes como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Twistlock</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aqua</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sysdig Secure</a> .  O IDS detecta um comportamento incomum no cont√™iner e o interrompe ou mata.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Falco de Sysdig</a> √© um mecanismo de regras de c√≥digo aberto e o ponto de partida para esse ecossistema. <br><br><h2>  Parte 3: O Futuro </h2><br>  O pr√≥ximo est√°gio de seguran√ßa na ‚Äúevolu√ß√£o do nativo da nuvem‚Äù parece ser a malha de servi√ßo, embora sua ado√ß√£o n√£o ocorra imediatamente: essa migra√ß√£o exige a mudan√ßa da complexidade dos aplicativos para a infraestrutura de malha, e as organiza√ß√µes precisam realizar essa melhor pr√°tica. <br><br><img src="https://habrastorage.org/webt/rm/qu/_m/rmqu_mfve6uvnnlaidl_bkjutqm.png"><br><br><h3>  11. Inicie a malha de servi√ßo </h3><br>  <b>O Service Mesh √© uma rede de conex√µes criptografadas persistentes feitas entre "lado conectado" <i>(semelhante ao "sidecar")</i> , proxies de alto desempenho como Envoy e Linkerd.</b>  <b>Traz gerenciamento de tr√°fego, monitoramento e pol√≠ticas - tudo sem altera√ß√µes nos microsservi√ßos.</b> <br><br>  A transfer√™ncia de seguran√ßa e c√≥digo relacionado √† rede de microsservi√ßos para um conjunto de bibliotecas compartilhadas e testadas em batalha j√° era poss√≠vel com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Linkerd</a> , e o advento do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Istio</a> do Google, IBM e Lyft trouxe uma alternativa para esse espa√ßo.  Com a adi√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SPIFFE</a> para a identidade criptogr√°fica de cada pod e muitos outros recursos, o Istio pode simplificar a implanta√ß√£o da seguran√ßa de rede da pr√≥xima gera√ß√£o. <br><br>  Em redes de ‚Äúconfian√ßa zero‚Äù, pode n√£o haver necessidade de um firewall tradicional ou pol√≠ticas de rede Kubernetes, pois cada intera√ß√£o ocorre usando mTLS (TLS m√∫tuo), que n√£o apenas garante a seguran√ßa da intera√ß√£o, mas tamb√©m confirma a identidade de ambos os servi√ßos. . <br><br>  Essa mudan√ßa das abordagens de rede tradicionais para os princ√≠pios de seguran√ßa do mundo do Cloud Native n√£o ser√° f√°cil para quem tem uma mentalidade de seguran√ßa tradicional.  Como introdu√ß√£o a esse novo mundo, recomendamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o livro Zero Trust Networking</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Evan Gilman,</a> da SPIFFE. <br><br>  Atualmente, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Istio 0.8 LTS</a> est√° dispon√≠vel e o projeto est√° se aproximando rapidamente de seu lan√ßamento 1.0.  A vers√£o do projeto em termos de estabilidade √© realizada de maneira semelhante ao modelo Kubernetes: um kernel est√°vel com APIs separadas para as quais seu status alfa ou beta √© indicado usando espa√ßos de nomes.  Espere ver o Istio expandir nos pr√≥ximos meses. <br><br><h2>  Conclus√£o </h2><br>  Os aplicativos Cloud Native t√™m um conjunto mais detalhado de primitivas de seguran√ßa leves que ajudam a proteger cargas de trabalho e infraestrutura.  O poder e a flexibilidade dessas ferramentas s√£o uma b√™n√ß√£o e uma maldi√ß√£o: sem automa√ß√£o suficiente [para seu uso], a exposi√ß√£o de aplicativos n√£o seguros para ir al√©m do cont√™iner ou seu modelo de isolamento tornou-se ainda mais f√°cil. <br><br>  Os utilit√°rios de prote√ß√£o est√£o mais acess√≠veis do que nunca, no entanto, para reduzir o potencial de ataque e o potencial de configura√ß√µes incorretas, voc√™ deve us√°-los com cuidado. <br><br>  Se a seguran√ßa diminuir a velocidade da organiza√ß√£o na entrega de altera√ß√µes, nunca ser√° uma prioridade.  O uso dos princ√≠pios de Entrega Cont√≠nua em rela√ß√£o √† cadeia de suprimentos de software permite que a organiza√ß√£o alcance conformidade regulamentar, auditoria cont√≠nua e gerenciamento aprimorado, sem afetar o desempenho dos neg√≥cios. <br><br>  O aprimoramento r√°pido e incremental da seguran√ßa √© a maneira mais f√°cil com um conjunto de testes abrangente.    Continuous Security ‚Äî          pipeline', ,    ,     . <br><br><h2>  PS do tradutor </h2><br>  Leia tamb√©m em nosso blog: <br><br><ul><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OPA  SPIFFE ‚Äî     CNCF    </a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vulnerable Docker VM ‚Äî -  Docker  pentesting</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  service mesh      [    ]?</a>  "; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conduit ‚Äî  service mesh  Kubernetes</a> ¬ª; </li><li> ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">      Kubernetes</a> ¬ª; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Infraestrutura com o Kubernetes como um servi√ßo acess√≠vel</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt417905/">https://habr.com/ru/post/pt417905/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt417895/index.html">Reparo de impressoras 3D e m√°quinas-ferramentas: como funciona o servi√ßo Top 3D Shop em Moscou e S√£o Petersburgo</a></li>
<li><a href="../pt417897/index.html">PHP Digest No. 135 (9 a 23 de julho de 2018)</a></li>
<li><a href="../pt417899/index.html">Procure por n√≥s de varia√ß√£o de controle (como parar de fazer um trabalho burro e transferi-lo para outro)</a></li>
<li><a href="../pt417901/index.html">Como come√ßamos a fazer longas reuni√µes impressionantes e por que isso n√£o √© mais um mal universal</a></li>
<li><a href="../pt417903/index.html">Caso 1 de Revis√£o de C√≥digo</a></li>
<li><a href="../pt417909/index.html">Por que voc√™ precisa do Splunk? An√°lise de aplicativos</a></li>
<li><a href="../pt417911/index.html">Projeto cont√≠nuo em desenvolvimento: metodologia e princ√≠pio</a></li>
<li><a href="../pt417913/index.html">Otimiza√ß√£o da renderiza√ß√£o de uma cena do desenho animado da Disney "Moana". Parte 3</a></li>
<li><a href="../pt417915/index.html">Como jogar com um companheiro de quarto</a></li>
<li><a href="../pt417917/index.html">ASC'18: Persist√™ncia e treinamento regular como forma de atingir a meta</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>