<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚åõÔ∏è ‚èØÔ∏è ‚õ±Ô∏è Lo que est√° mal con GraphQL üôá üïµüèæ üë©üèº‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recientemente, GraphQL est√° ganando m√°s y m√°s popularidad. Agradable sintaxis de solicitudes, tipificaci√≥n y suscripciones. 


 Parece: "aqu√≠ est√°, ¬°h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lo que est√° mal con GraphQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425041/"><p>  Recientemente, GraphQL est√° ganando m√°s y m√°s popularidad.  Agradable sintaxis de solicitudes, tipificaci√≥n y suscripciones. </p><br><p>  Parece: <em>"aqu√≠ est√°, ¬°hemos encontrado el lenguaje ideal para el intercambio de datos!"</em>  ... </p><br><p>  Llevo m√°s de un a√±o desarrollando este lenguaje y les dir√©: todo est√° lejos de ser tan sencillo.  GraphQL tiene momentos inc√≥modos y problemas realmente fundamentales en el dise√±o del lenguaje en s√≠. </p><br><p>  Por otro lado, la mayor√≠a de estos "movimientos de dise√±o" se hicieron por una raz√≥n: esto se debi√≥ a varias consideraciones.  De hecho, GraphQL no es para todos, y puede que no sea la herramienta que necesita en absoluto.  Pero lo primero es lo primero. </p><a name="habracut"></a><br><blockquote>  Creo que vale la pena hacer un peque√±o comentario sobre d√≥nde uso este idioma.  Este es un panel de administraci√≥n de SPA bastante complicado, la mayor√≠a de las operaciones son CRUD (entidades complejas) bastante triviales.  Una parte importante de la argumentaci√≥n en este material est√° relacionada con la naturaleza de la aplicaci√≥n y la naturaleza de los datos procesados.  En aplicaciones de un tipo diferente (o con una naturaleza diferente de los datos), tales problemas pueden no surgir en principio. </blockquote><br><h2 id="1-non_null">  1. NON_NULL </h2><br><p>  Este no es un problema serio.  M√°s bien, esta es una serie completa de inconvenientes relacionados con la forma en que se organiza el trabajo con nulos en GraphQL. </p><br><p> Hay lenguajes de programaci√≥n funcionales (y no solo), tal paradigma es m√≥nadas.  Entonces, existe una m√≥nada tal <code>Maybe</code> (Haskel) u <code>Option</code> (Scala). La conclusi√≥n es que el valor contenido dentro de una m√≥nada puede existir o no (es decir, ser nulo).  Bueno, o puede implementarse a trav√©s de enum, como en Rust. </p><br><p>  De una forma u otra, y en la mayor√≠a de los idiomas, este valor, que "envuelve" el original, hace que nulo sea una opci√≥n adicional al principal.  Y sint√°cticamente, siempre es una adici√≥n al tipo principal.  Esto no siempre es solo una clase de tipo separada; en algunos idiomas, ¬øes solo una adici√≥n en forma de sufijo o prefijo <code>?</code>  . </p><br><p>  En GraqhQL, lo contrario es cierto.  Todos los tipos son anulables por defecto, y esto no es solo marcar el tipo como anulable, es la m√≥nada <code>Maybe</code> , por el contrario. </p><br><p>  Y si consideramos la secci√≥n de introspecci√≥n del campo de <code>name</code> para dicho esquema: </p><br><pre> <code class="nginx hljs"><span class="hljs-comment"><span class="hljs-comment">#       schema -  ,    schema { query: Query } type Query { #       NonNull name: String! }</span></span></code> </pre> <br><p>  encontramos: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/15f/0ff/4ad/15f0ff4adfc31acf387165ad4adf7b5e.png" alt="imagen"></p><br><p>  Tipo de <code>String</code> envuelta en <code>NON_NULL</code> </p><br><h3 id="11-output">  1.1.  SALIDA </h3><br><p>  Por qu√©  En resumen, est√° conectado con el dise√±o de lenguaje "tolerante" predeterminado (entre otras cosas, es amigable con la arquitectura de microservicios). </p><br><p>  Para comprender la esencia de esta "tolerancia", considere un ejemplo un poco m√°s complejo, en el que todos los valores devueltos est√°n estrictamente envueltos en NON_NULL: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> User { name: String! <span class="hljs-comment"><span class="hljs-comment">#  :       . friends: [User!]! } type Query { #  :       . users(ids: [ID!]!): [User!]! }</span></span></code> </pre> <br><p>  Supongamos que tenemos un servicio que devuelve una lista de usuarios y una "amistad" de microservicios separada que nos devuelve una coincidencia para los amigos del usuario.  Luego, en caso de falla del servicio de "amistad", no podremos enumerar a los usuarios en absoluto.  Necesito arreglar la situaci√≥n: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> User { name: String! <span class="hljs-comment"><span class="hljs-comment">#    -  null   . #    ""  -      ,    . friends: [User!] }</span></span></code> </pre> <br><p>  Esta es la tolerancia a los errores internos.  Un ejemplo, por supuesto, descabellado.  Pero espero que hayas captado la esencia. </p><br><p>  Adem√°s, puede hacer su vida un poco m√°s f√°cil en otras situaciones.  Supongamos que hay usuarios remotos, y los identificadores de amigos pueden almacenarse en alguna estructura externa no relacionada.  Podr√≠amos eliminar y devolver solo lo que tenemos, pero luego no podremos entender qu√© se elimin√≥ exactamente. </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Query { <span class="hljs-comment"><span class="hljs-comment">#  null   . #                . users(ids: [ID!]!): [User]! }</span></span></code> </pre> <br><p>  <em>Todo esta bien</em>  <em>¬øY cu√°l es el problema?</em> <br>  En general, no es un gran problema, por lo que el sabor.  Pero si tiene una aplicaci√≥n monol√≠tica con una base de datos relacional, los errores m√°s probables son realmente errores, y la API debe ser lo m√°s estricta posible.  ¬°Hola, signos de exclamaci√≥n!  Donde sea que puedas. </p><br><p>  Me gustar√≠a poder "invertir" este comportamiento y colocar signos de interrogaci√≥n en lugar de signos de exclamaci√≥n) Ser√≠a m√°s familiar de alguna manera. </p><br><h3 id="12-input">  1.2.  ENTRADA </h3><br><p>  Pero al entrar, anulable es una historia completamente diferente.  Este es un marco del nivel de la casilla de verificaci√≥n en HTML (creo que todos recuerdan esta falta de evidencia cuando el campo de una casilla de verificaci√≥n sin marcar simplemente no se env√≠a al reverso). </p><br><p>  Considere un ejemplo: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Post { id: ID! title: String! <span class="hljs-comment"><span class="hljs-comment">#  :     null description: String content: String! } input PostInput { title: String! #  :     ,   description: String content: String! } type Mutation { createPost(post: PostInput!): Post! }</span></span></code> </pre> <br><p>  Hasta ahora todo bien.  Agregar actualizaci√≥n: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Mutation { createPost(post: PostInput!): Post! updatePost(id: ID!, post: PostInput!): Post! }</code> </pre> <br><p>  Y ahora la pregunta es: ¬øqu√© podemos esperar del campo de descripci√≥n al actualizar la publicaci√≥n?  El campo puede ser nulo o puede estar ausente por completo. </p><br><p>  Si falta el campo, ¬øqu√© hay que hacer?  ¬øNo lo actualizas?  ¬øO ponerlo a nulo?  La conclusi√≥n es que permitir nulo y permitir la ausencia de un campo son dos cosas diferentes.  Sin embargo, GraphQL es lo mismo. </p><br><h2 id="2-razdelenie-vvoda-i-vyvoda">  2. Separaci√≥n de entrada y salida. </h2><br><p>  Esto es solo dolor.  En el modelo de trabajo CRUD, obtiene el objeto de la parte posterior "g√≠relo" y lo env√≠a de vuelta.  En t√©rminos generales, este es uno y el mismo objeto.  Pero solo tiene que describirlo dos veces, para entrada y salida.  Y no se puede hacer nada con esto, excepto escribir un generador de c√≥digo para este negocio.  Preferir√≠a separar en la "entrada y salida" no los objetos en s√≠, sino los campos del objeto.  Por ejemplo, modificadores: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Post { <span class="hljs-attribute"><span class="hljs-attribute">input</span></span> output text: String! output updatedAt(format: DateFormat = W3C): Date! }</code> </pre> <br><p>  o usando directivas: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Post { text: String! @<span class="hljs-attribute"><span class="hljs-attribute">input</span></span> <span class="hljs-variable"><span class="hljs-variable">@output</span></span> updatedAt(format: DateFormat = W3C): Date! <span class="hljs-variable"><span class="hljs-variable">@output</span></span> }</code> </pre> <br><h2 id="3-polimorfizm">  3. Polimorfismo </h2><br><p>  Los problemas de separar los tipos en entrada y salida no se limitan a una doble descripci√≥n.  Al mismo tiempo, para los tipos gen√©ricos puede definir interfaces generalizadas: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">interface</span></span> Commentable { comments: [Comment!]! } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Post implements Commentable { text: String! comments: [Comment!]! } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Photo implements Commentable { src: URL! comments: [Comment!]! }</code> </pre> <br><p>  o sindicatos </p><br><pre> <code class="plaintext hljs">type Person { firstName: String, lastName: String, } type Organiation { title: String } union Subject = Organiation | Person type Account { login: String subject: Subject }</code> </pre> <br><p>  No puede hacer lo mismo para los tipos de entrada.  Hay una serie de requisitos previos para esto, pero esto se debe en parte al hecho de que json se utiliza como formato de datos para el transporte.  Sin embargo, en la salida, el campo <code>__typename</code> se usa para especificar el tipo.  Por qu√© era imposible hacer lo mismo al entrar, no est√° muy claro.  Me parece que este problema podr√≠a resolverse de manera un poco m√°s elegante abandonando json durante el transporte e ingresando su propio formato.  Algo en el esp√≠ritu: </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">union</span></span> Subject = OrganiationInput | PersonInput input AccountInput { login: String! password: String! subject: Subject! }</code> </pre> <br><pre> <code class="nginx hljs"><span class="hljs-comment"><span class="hljs-comment">#     { account: AccountInput { login: "Acme", password: "***", subject: OrganiationInput { title: "Acme Inc" } } }</span></span></code> </pre> <br><pre> <code class="nginx hljs"><span class="hljs-comment"><span class="hljs-comment">#      { account: AccountInput { login: "Acme", password: "***", subject: PersonInput { firstName: "Vasya", lastName: "Pupkin", } } }</span></span></code> </pre> <br><p>  Pero esto har√≠a necesario escribir analizadores adicionales para este negocio. </p><br><h2 id="4-dzheneriki">  4. Gen√©ricos </h2><br><p>  ¬øQu√© hay de malo con GraphQL con gen√©ricos?  Y todo es simple, no lo son.  Tomemos una consulta de √≠ndice CRUD t√≠pica con una paginaci√≥n o cursor; no es importante.  Dar√© un ejemplo con paginaci√≥n. </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">input</span></span> Pagination { page: UInt, perPage: UInt, } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Query { users(pagination: Pagination): PageOfUsers! } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> PageOfUsers { total: <span class="hljs-attribute"><span class="hljs-attribute">UInt</span></span> items: [User!]! }</code> </pre> <br><p>  y ahora para organizaciones </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Query { organizations(pagination: Pagination): PageOfOrganizations! } <span class="hljs-attribute"><span class="hljs-attribute">type</span></span> PageOfOrganizations { total: <span class="hljs-attribute"><span class="hljs-attribute">UInt</span></span> items: [Organization!]! }</code> </pre> <br><p>  y as√≠ sucesivamente ... c√≥mo me gustar√≠a tener gen√©ricos para esto </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> PageOf&lt;T&gt; { total: <span class="hljs-attribute"><span class="hljs-attribute">UInt</span></span> items: [T!]! }</code> </pre> <br><p>  entonces solo escribir√≠a </p><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">type</span></span> Query { users(page: UInt, perPage: UInt): PageOf&lt;User&gt;! }</code> </pre> <br><p>  S√≠ toneladas de aplicaciones!  ¬øDeber√≠a contarte sobre los gen√©ricos? </p><br><h2 id="5-neymspeysy">  5. Espacios de nombres </h2><br><p>  Ellos tampoco est√°n all√≠.  Cuando el n√∫mero de tipos en el sistema supera el ciento y medio, la probabilidad de colisiones de nombres tiende al cien por ciento. </p><br><p>  Y aparecen todo tipo de <code>Service_GuideNDriving_Standard_Model_Input</code> .  No estoy hablando de espacios de nombres completos en diferentes puntos finales, como en SOAP (s√≠, s√≠, es terrible, pero los espacios de nombres est√°n hechos all√≠ perfectamente).  Y al menos varios esquemas en un punto final con la capacidad de "buscar" tipos entre esquemas. </p><br><h2 id="itogo">  Total </h2><br><p>  GraphQL es una buena herramienta.  Encaja perfectamente en una arquitectura de microservicio tolerante, que est√° orientada, en primer lugar, a la salida de informaci√≥n y a la entrada simple y determinista. </p><br><p>  Si tiene entidades polim√≥rficas para ingresar, puede tener problemas. <br>  La separaci√≥n de los tipos de entrada y salida, as√≠ como la falta de gen√©ricos, generan un mont√≥n de garabatos desde cero. </p><br><p>  Graphql no es realmente (y a veces <em>nada</em> ) sobre CRUD. </p><br><p>  Pero esto no significa que no puedas comerlo :) </p><br><p>  En el pr√≥ximo art√≠culo, quiero hablar sobre c√≥mo lucho (y a veces con √©xito) con algunos de los problemas descritos anteriormente. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es425041/">https://habr.com/ru/post/es425041/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es425027/index.html">Desarrollo de sombreadores GLSL en Kotlin</a></li>
<li><a href="../es425031/index.html">M√°s pr√°ctica! Ense√±emos Spring Framework y perfiles sin conferencias</a></li>
<li><a href="../es425033/index.html">Construyendo un Jetpack: JetPack Aviation 2017 Annual Report</a></li>
<li><a href="../es425037/index.html">Noticias de IT Geek Hub: c√≥mo hicimos una b√∫squeda de bicicletas en Praga y qu√© te espera en la pr√≥xima reuni√≥n</a></li>
<li><a href="../es425039/index.html">Semana de la seguridad 37: Facebook, Twitter y errores inflables</a></li>
<li><a href="../es425043/index.html">Introducci√≥n al desarrollo de una soluci√≥n t√≠pica de c√≥digo abierto.</a></li>
<li><a href="../es425047/index.html">C√≥mo funciona el robo-advising en inversiones. Spoiler: simple</a></li>
<li><a href="../es425051/index.html">Analisis del port√°til Dell XPS 13 9370: ligero, hermoso y r√°pido</a></li>
<li><a href="../es425053/index.html">SSR: cu√°ndo, por qu√© y para qu√©. En el ejemplo de Vue</a></li>
<li><a href="../es425055/index.html">B√∫squeda de Oculus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>