<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•¶ ‚ÑπÔ∏è ü¶ë Cloud Smart Home. Bagian 2: Layanan Cloud üç≥ üõµ ü§∞üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya melanjutkan serangkaian tiga artikel tentang cloud smart home. 

 Dalam artikel sebelumnya , peralatan untuk merasakan rumah pintar dipertimbangk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cloud Smart Home. Bagian 2: Layanan Cloud</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474700/"><img src="https://habrastorage.org/webt/iq/e3/kt/iqe3kte_k_di5dqmevpvprwojee.jpeg" alt="gambar"><br><br>  Saya melanjutkan serangkaian tiga artikel tentang cloud smart home. <br><br>  Dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya</a> , peralatan untuk merasakan rumah pintar dipertimbangkan, serta algoritma untuk mengubah data sensorik menjadi perintah kontrol untuk perangkat eksekutif.  Komponen utama dari rumah pintar adalah pengontrol, yang sebagian besar waktu bekerja secara mandiri sesuai dengan logika yang ditetapkan pada tahap pengaturan.  Berbagai perangkat (kamera IP, sensor, aktuator) terhubung ke pengontrol, yang mengirimkan data yang diterima dari perangkat ini ke cloud. <br><br>  Sekarang mari kita bicara tentang arsitektur layanan cloud untuk menyimpan dan memproses informasi dari sensor dan kamera. <br><a name="habracut"></a><br><h2>  Manfaat Layanan Cloud </h2><br>  Layanan cloud rumah pintar menawarkan cara sederhana, fleksibel, dan murah untuk menyimpan dan mengakses data yang diterima dari perangkat rumah pintar.  Pengguna layanan cloud tidak perlu khawatir tentang keamanan data mereka.  Kemampuan server media multiprosesor, dilengkapi dengan keranjang disk dengan array RAID dari beberapa drive 10 - 12 TB, jauh melebihi kapasitas kartu SD atau Flash di dalam pengontrol rumah pintar.  Selain itu, kartu memori tidak dapat diandalkan karena memiliki siklus penulisan ulang yang terbatas dan sering gagal.  Kedalaman penyimpanan data di cloud ditentukan oleh tarif pengguna dan mudah dikonfigurasi di akun pribadinya. <br><br>  Selain itu, untuk mengakses data tidak perlu "port forwarding" pada router pengguna ketika perangkat rumah pintar disembunyikan dari jaringan eksternal oleh NAT.  Di akun pribadi Anda, dapat diakses dari perangkat seluler, Anda dapat dengan mudah mengonfigurasi konfigurasi dan logika rumah pintar. <br><br>  Nyaman tidak hanya untuk menyimpan data di cloud, tetapi juga untuk memprosesnya, memberikan pengguna statistik untuk berbagai periode waktu.  Di bawah ini kami akan mempertimbangkan contoh penghitungan suhu kamar rata-rata per minggu berdasarkan pengukuran multisensor. <br><br><h2>  Arsitektur Layanan Cloud </h2><br>  Dalam artikel sebelumnya, kami berbicara tentang pengontrol rumah pintar yang diinstal di sisi pengguna dan berinteraksi dengan layanan cloud menggunakan beberapa protokol: <br><br><ul><li>  MQTT digunakan untuk bertukar pesan JSON antara pengontrol dan server logika bisnis; </li><li>  HTTP untuk mendapatkan alamat IP dari server media yang paling tidak dimuat dari load balancer dari cluster server media; </li><li>  RTMP untuk mentransfer aliran H.264 + AAC ke server media. </li></ul><br>  Sekarang kita akan mempertimbangkan layanan cloud rumah pintar - komponen utama yang terdiri darinya, dan bagaimana interaksi dengan pengendali rumah pintar. <br><br> <a href=""><img src="https://habrastorage.org/webt/os/bd/xi/osbdxiktvu-cla3sizuxjoaxbfu.png"></a> <br>  <font color="grey">(klik pada gambar untuk membuka dalam resolusi yang lebih tinggi)</font> <br><br>  <b>Server logika bisnis</b> adalah elemen kunci dalam seluruh skema pertukaran informasi dalam layanan cloud.  Tujuan utamanya adalah untuk mengelola berbagai subsistem server melalui antarmuka API RESTful.  Ini mengimplementasikan logika layanan cloud berdasarkan pada <b>model pengguna</b> : merekam arsip video dan pengukuran sensor tergantung pada tarif yang dipilih, interaksi antara pengguna dan pengontrol rumah pintar, dll. <br><br>  <b>Broker MQTT</b> diperlukan untuk bertukar pesan JSON antara pengontrol rumah pintar yang diinstal pada sisi klien dan server logika bisnis.  Klien berlangganan topik dalam broker yang berfungsi sebagai saluran pesan.  Sebagai broker MQTT, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Eclipse Mosquitto digunakan</a> . <br><br>  <b>Cluster server media</b> adalah sistem terdistribusi untuk menyimpan, memproses, mencari, dan memutar informasi video untuk kamera IP rumah pintar yang keruh.  Penyeimbang beban khusus mengumpulkan informasi tentang kinerja saat ini dari setiap server dalam gugus, menghitung yang paling sedikit dimuat dan melaporkan alamat IP-nya ke pengontrol rumah pintar, yang mentransfer video dari kamera ke sana. <br><br>  <b>Basis data cloud</b> diperlukan untuk menyimpan model pengguna layanan cloud, konfigurasi dan status peralatan saat ini, serta meta-informasi tentang entri arsip video.  Sebagai implementasi dari basis data cloud, DBMS MySQL digunakan. <br><br>  <b>Touch Database</b> adalah database NoSQL non-relasional.  Ini menyimpan acara dan pengukuran sensor rumah pintar, dipesan oleh waktu.  Penggunaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">InfluxDB</a> DBMS, yang dioptimalkan untuk bekerja dengan tipe data ini, secara signifikan meningkatkan kinerja layanan cloud. <br><br>  <b>Backend aplikasi klien</b> adalah aplikasi server yang fungsi utamanya adalah untuk menyediakan data yang diterima dari cloud dan menyentuh basis data dalam format yang nyaman untuk tampilan selanjutnya oleh aplikasi klien pada perangkat pengguna.  Backend juga menghasilkan perintah kontrol dalam format JSON untuk pengontrol rumah pintar.  Backend didasarkan pada kerangka PHP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Laravel</a> .  Ini akan dibahas secara lebih rinci di artikel selanjutnya tentang aplikasi klien untuk berinteraksi dengan cloud smart home. <br><br>  <b>Penyedia pemberitahuan push</b> mengirimkan pesan tentang peristiwa rumah pintar ke perangkat seluler pengguna sehingga ia dapat dengan cepat melakukan intervensi dalam situasi (misalnya, ketika kebocoran air atau asap muncul, hubungi layanan respons yang sesuai).  Layanan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OneSignal</a> dipilih sebagai penyedia pemberitahuan Push, yang memiliki antarmuka API yang nyaman dan fungsi identifikasi perangkat seluler, yang diperlukan untuk pengoperasian notifikasi yang benar di dalam akun pribadi pengguna. <br><br><h2>  Server logika bisnis </h2><br>  Seperti yang disebutkan sebelumnya, server logika bisnis adalah komponen kunci dari cloud smart home.  Berdasarkan <b>model pengguna</b> (deskripsi informasi tentang pengguna sistem, yang mencakup fitur sistem, personal, keuangan dan logis), ia mengelola berbagai layanan di dalam cloud yang memiliki implementasi dan fungsi yang berbeda dan berkomunikasi satu sama lain melalui antarmuka API yang tenang. <br><br><img src="https://habrastorage.org/webt/m0/vl/vj/m0vlvjztjnmvtrckqgvefi2ht80.png"><br><br>  Modul logika bisnis di dalam server bertanggung jawab untuk operasi berikut: <br><br><ol><li>  mengelola penyimpanan pengukuran sensor dan peristiwa detektor gerakan dari kamera IP rumah pintar di dalam basis data sentuh; </li><li>  mengelola perekaman aliran media dari siaran kamera IP oleh pengontrol rumah pintar dalam arsip server media (konstanta / dengan detektor gerakan); </li><li>  terjemahan perintah dari aplikasi klien ke pengontrol rumah pintar; </li><li>  menyiarkan konfigurasi pengontrol rumah pintar (perangkat yang terhubung, aturan logika produksi yang ditentukan oleh pengguna); </li><li>  mengirimkan pemberitahuan push tentang status pengontrol rumah pintar dan perangkat yang terhubung ke aplikasi klien. </li></ol><br>  Fitur server logika bisnis adalah komunikasi antar proses dengan aplikasi jarak jauh yang berjalan pada beberapa server di Internet.  Sebagian besar waktu, aplikasi server logika bisnis tidak dapat digunakan pada kunci I / O, sehingga dirancang berdasarkan arsitektur multi-utas dan terdiri dari serangkaian subtugas terbatas. <br><br>  Untuk memastikan efisiensi maksimum, implementasi internal server logika bisnis harus menjadi yang paling sederhana ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">prinsip KISS</a> ).  Karena model pengguna sepenuhnya deterministik dan tidak mengandung perubahan hubungan antar fitur, tidak perlu mekanisme inferensi yang fleksibel (seperti pada pengontrol rumah pintar, di mana logika pengguna dikonfigurasikan oleh pengguna).  Oleh karena itu, operasi modul logika bisnis di dalam server dapat dijelaskan oleh diagram blok algoritmik konvensional dengan transisi bersyarat. <br><br> <a href=""><img src="https://habrastorage.org/webt/fh/xf/70/fhxf703hqjqjjhzg9i_uuxv2qqo.png"></a> <br>  <font color="grey">(klik pada gambar untuk membuka dalam resolusi yang lebih tinggi)</font> <br><br>  Segera setelah memulai, server logika bisnis masuk ke status menunggu untuk pesan menggunakan protokol MQTT (dari pengontrol rumah pintar) dan HTTP (dari backend aplikasi klien).  Jika pesan tiba melalui HTTP, ini berarti bahwa pengguna berinteraksi dengan aplikasi klien dan mengirimkan perintah ke pengontrol rumah pintar atau memperbarui konfigurasinya.  Agar pesan dari klien jatuh ke dalam pengontrol rumah pintar, itu dikirim oleh server logika bisnis ke topik yang sesuai dari broker MQTT, di mana controller berlangganan (sub- <b>tugas SendGatewayMessage</b> ). <br><br>  Pada tahap inisialisasi, pengontrol rumah pintar menunggu pengguna untuk mendaftarkannya di akun pribadi mereka.  Oleh karena itu, subtugas <b>CheckGatewayExistance dilakukan</b> , yang memeriksa status terkait di database cloud MySQL.  Untuk mendaftar di akun pribadi Anda, controller mengirim konfigurasi penuhnya ke server business logic, dan pada gilirannya, menyiarkan backend-nya ke aplikasi klien ( <b>SendBackend</b> subtask), yang membuat dan memperbarui catatan konfigurasi di database cloud dan touch. <br><br>  Ketika pengontrol rumah pintar berhasil terdaftar di akun pribadi pengguna, server logika bisnis memuat model pengguna dari basis data cloud ke dalam RAM-nya dan mulai memproses pesan dari kamera IP dan sensor Z-Wave sesuai dengan algoritma logika bisnis berikut ini. <br><br>  Pesan JSON dari sensor Z-Wave dengan bidang informasi: <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"vendor"</span></span>: <span class="hljs-string"><span class="hljs-string">"*****"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"3.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestampMs"</span></span>: <span class="hljs-string"><span class="hljs-string">"1571754749561"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"clientType"</span></span>: <span class="hljs-string"><span class="hljs-string">"gateway"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>: <span class="hljs-string"><span class="hljs-string">"c8e8de37-d301-45f4-ba01-************"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"sensor"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"protocol"</span></span>: <span class="hljs-string"><span class="hljs-string">"zwave"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"messageType"</span></span>: <span class="hljs-string"><span class="hljs-string">"sensorData"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"homeId"</span></span>: <span class="hljs-string"><span class="hljs-string">"0xefa0cfa7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"nodeId"</span></span>: <span class="hljs-string"><span class="hljs-string">"19"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sensorType"</span></span>: <span class="hljs-string"><span class="hljs-string">"SENSOR MULTILEVEL"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"label"</span></span>: <span class="hljs-string"><span class="hljs-string">"Temperature"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sensorData"</span></span>: <span class="hljs-string"><span class="hljs-string">"26.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"units"</span></span>: <span class="hljs-string"><span class="hljs-string">"C"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"gatewayId"</span></span>: <span class="hljs-string"><span class="hljs-string">"6774f85a-0a5b-4059-9b68-************"</span></span> }</code> </pre> <br>  Ketika pesan dari sensor Z-Wave tiba melalui protokol MQTT, subtugas berikut dilakukan: <br><br><ul><li>  <b>StoreSensorDataMySQL</b> memperbarui (UPDATE) catatan yang ada di database cloud MySQL, di mana informasi tentang keadaan saat ini dan pengukuran dari sensor disimpan.  Ini diperlukan untuk aplikasi klien yang menampilkan keadaan rumah pintar saat ini untuk pengguna; </li><li>  <b>StoreSensorDataInfluxDB</b> menambahkan (INSERT) catatan baru ke basis data sentuh InfluxDB, di mana sejarah pengukuran dari sensor disimpan.  Informasi ini digunakan dalam perhitungan data statistik untuk berbagai periode waktu (misalnya, konsumsi energi per hari, bulan atau tahun) dan ditampilkan dalam aplikasi klien dalam bentuk grafik dan tabel; </li><li>  <b>SendPushNotification</b> menghasilkan pesan JSON yang berisi cap waktu, nama sensor, deskripsi teks acara, pengenal ponsel cerdas pengguna yang dengannya ia masuk ke akun pribadinya, pengenal internal aplikasi dalam sistem penyedia OneSignal.  Selanjutnya, pesan ini dikirim ke penyedia pemberitahuan push melalui RESTful API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://onesignal.com/api/v1/notifications</a> , yang mengirimkannya ke ponsel cerdas pengguna. </li></ul><br>  Contoh pesan JSON dari kamera IP dengan bidang informasi: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"vendor"</span></span>: <span class="hljs-string"><span class="hljs-string">"*****"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"3.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestampMs"</span></span>: <span class="hljs-string"><span class="hljs-string">"1571753150317"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"clientType"</span></span>: <span class="hljs-string"><span class="hljs-string">"gateway"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>: <span class="hljs-string"><span class="hljs-string">"1616453d-30cd-44b7-9bf0-************"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"camera"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"protocol"</span></span>: <span class="hljs-string"><span class="hljs-string">"onvif"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"messageType"</span></span>: <span class="hljs-string"><span class="hljs-string">"deviceState"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deviceState"</span></span>: <span class="hljs-string"><span class="hljs-string">"streamingOn"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"mediaserverIp"</span></span>: <span class="hljs-string"><span class="hljs-string">"***.***.***.***"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"applicationName"</span></span>: <span class="hljs-string"><span class="hljs-string">"rtp-live-iot"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"gatewayId"</span></span>: <span class="hljs-string"><span class="hljs-string">"6774f85a-0a5b-4059-9b68-************"</span></span> }</code> </pre><br>  Ketika pesan datang dari kamera IP menggunakan protokol MQTT, server logika bisnis mengekstrak tipenya dari bidang <b>messageType</b> .  Bergantung pada nilai bidang ini, tindakan berikut dilakukan: <br><br><ul><li>  <b>"MessageType": "deviceState"</b> - pesan berisi informasi tentang perubahan status kamera IP.  Subtugas <b>UpdateCameraState dilakukan</b> , memperbarui informasi dalam basis data cloud.  Jika bidang <b>deviceState</b> adalah <b>streamingOn</b> atau <b>streamingOff</b> (kamera IP mengirim / menghentikan aliran data ke server media), sub-tugas <b>RecordMediaStream dijalankan</b> , yang menghasilkan perintah untuk mengaktifkan / menonaktifkan mode perekaman arsip dan mengirimkannya ke server media, dengan mempertimbangkan model pengguna; </li><li>  <b>"MessageType": "sensorData"</b> - informasi tentang pengoperasian detektor gerakan pada kamera IP.  Jika dalam model pengguna mode perekaman arsip diatur ke "oleh detektor gerakan", maka subtugas <b>RecordMediaStream dijalankan</b> .  Selanjutnya, subtasks <b>StoreSensorDataInfluxDB</b> (menyimpan riwayat detektor dalam database sentuh) dan <b>SendPushNotification</b> (mengirim pemberitahuan push melalui penyedia) dilakukan; </li><li>  <b>"MessageType": "preview"</b> - pesan berisi bingkai gambar mini dari kamera IP, yang secara berkala dikirim ke cloud.  <b>Subtitel StorePreview</b> menyimpannya dalam basis data cloud.  Kemudian digunakan dalam aplikasi klien saat menampilkan daftar kamera; </li><li>  <b>"MessageType": "command"</b> - perintah yang dikirim oleh pengontrol rumah pintar ketika pengguna mengubah pengaturannya melalui antarmuka Web.  Sub-tugas <b>RecordMediaStream dilakukan</b> , yang, tergantung pada model pengguna, menghidupkan / mematikan mode perekaman pada server media. </li></ul><br> <a href=""><img src="https://habrastorage.org/webt/8o/_u/gy/8o_ugygyf5hm0nlyd6aw8zwge8s.png"></a> <br>  <font color="grey">(klik pada gambar untuk membuka dalam resolusi yang lebih tinggi)</font> <br><br>  Sebagai hasil dari pekerjaan modul logika bisnis, <b>antrian tugas</b> dibentuk - urutan bagian minimal dari kode yang dieksekusi secara independen satu sama lain.  Antrian tugas ditransfer ke <b>kumpulan utas</b> , yang mendistribusikan tugas di antara inti bebas prosesor pusat.  Ketika kunci I / O terjadi selama eksekusi, utas berhenti dan memasuki status siaga dan membebaskan inti dari prosesor pusat, yang memungkinkan kumpulan utas untuk memulai eksekusi segera tugas berikutnya dari antrian.  Pada saat kunci I / O dilepaskan, utas yang diblokir mengubah statusnya menjadi berfungsi dan melanjutkan eksekusi segera setelah salah satu inti dari prosesor pusat dibebaskan. <br><br>  Dengan demikian, dengan menguraikan tugas logika bisnis menjadi banyak sub tugas terpisah yang dijalankan secara bersamaan, kinerja server logika bisnis meningkat.  Penskalaan sistem dicapai dengan meningkatkan jumlah inti dari prosesor pusat dan meningkatkan jumlah server logika bisnis dalam sistem. <br><br>  Aplikasi server logika bisnis dikembangkan dalam C ++ dan berjalan sebagai layanan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">systemd</a> dari sistem operasi Linux Debian Sarge.  Untuk pemantauan kinerja tambahan, sistem pemantauan sumber daya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">monit</a> digunakan, yang memulai kembali layanan jika terjadi masalah kinerja. <br><br>  Saat ini, layanan cloud menjalankan satu server logika bisnis yang berjalan di mesin virtual Yandex. Cloud.  Parameter mesin virtual - 4 inti vCPU dengan pangsa dijamin 20%, 2 GB RAM, 100 GB HDD.  Menurut perhitungan, kinerja ini cukup untuk memproses pesan dari ~ 1000 pengontrol rumah pintar dengan 3 kamera IP dan 5 sensor Z-Wave masing-masing (perhitungan akan diklarifikasi selama pengoperasian sistem). <br><br><h2>  Server media </h2><br>  Server media adalah server khusus tempat perangkat lunak khusus diinstal untuk: <br><br><ul><li>  menerima aliran data video dan audio dari perangkat encoder menggunakan protokol jaringan khusus; </li><li>  menyimpan data dalam bentuk file arsip dalam sistem file-nya; </li><li>  Menyiarkan informasi dari file arsip dalam format streaming standar untuk pemutaran pada perangkat klien. </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Wowza Streaming Engine 4.7.2</a> dengan modul tambahan yang dikembangkan dalam bahasa Jawa digunakan sebagai server media dalam sistem cloud smart home untuk merekam data streaming ke arsip file dan untuk bekerja dengan basis data cloud. <br><br> <a href=""><img src="https://habrastorage.org/webt/va/du/c-/vaduc-wwi67k2367aoez0bnqx_s.png"></a> <br>  <font color="grey">(klik pada gambar untuk membuka dalam resolusi yang lebih tinggi)</font> <br><br>  Aliran media dari pengontrol rumah pintar dalam format RTMP memasuki server media dan disejajarkan dengan stempel waktu dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">buffer jitter</a> .  Ini diperlukan untuk mengkompensasi efek dari keterlambatan paket jaringan saat mentransmisikan aliran data melalui Internet. <br><br>  Untuk merekam streaming video ke sistem file server media sebagai file MP4, server logika bisnis mengirim perintah berikut ke server media melalui RESTful HTTP API: <br><br><pre> <code class="json hljs">http://&lt;mediaserverIp&gt;:&lt;port&gt;/v<span class="hljs-number"><span class="hljs-number">2</span></span>/servers/_defaultServer_/vhosts/_defaultVHost_/applications/rtp-live-iot/instances/_definst_/streamrecorders/<span class="hljs-number"><span class="hljs-number">1616453</span></span>d<span class="hljs-number"><span class="hljs-number">-30</span></span>cd<span class="hljs-number"><span class="hljs-number">-44</span></span>b<span class="hljs-number"><span class="hljs-number">7</span></span><span class="hljs-number"><span class="hljs-number">-9</span></span>bf<span class="hljs-number"><span class="hljs-number">0</span></span>-************ { <span class="hljs-attr"><span class="hljs-attr">"instanceName"</span></span>: <span class="hljs-string"><span class="hljs-string">"_definst_"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fileVersionDelegateName"</span></span>: <span class="hljs-string"><span class="hljs-string">"CustomFileVersionDelegate"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"serverName"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"recorderName"</span></span>: <span class="hljs-string"><span class="hljs-string">"1616453d-30cd-44b7-9bf0-************"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"segmentSchedule"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"outputPath"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currentFile"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"applicationName"</span></span>: <span class="hljs-string"><span class="hljs-string">"rtp-live-iot"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fileTemplate"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"segmentationType"</span></span>: <span class="hljs-string"><span class="hljs-string">"SegmentByDuration"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"fileFormat"</span></span>: <span class="hljs-string"><span class="hljs-string">"MP4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"recorderState"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"option"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currentSize"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"segmentSize"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"segmentDuration"</span></span>: <span class="hljs-string"><span class="hljs-string">"1800000"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"backBufferTime"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currentDuration"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"startOnKeyFrame"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"recordData"</span></span>: <span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"moveFirstVideoFrameToZero"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"defaultRecorder"</span></span>: <span class="hljs-string"><span class="hljs-string">"false"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"splitOnTcDiscontinuity"</span></span>: <span class="hljs-string"><span class="hljs-string">"false"</span></span> }</code> </pre><br>  Di bidang <b>recorderName</b> , nama aliran video (pengidentifikasi kamera IP pada pengontrol rumah pintar) <b>ditunjukkan</b> , dalam bidang <b>fileVersionDelegateName</b> , nama kelas yang diwarisi untuk menentukan jalur folder dan nama file.  Kode kelas Java ditunjukkan dalam daftar berikut: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Calendar; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.TimeZone; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.wowza.wms.livestreamrecord.manager.IStreamRecorder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.wowza.wms.livestreamrecord.manager.IStreamRecorderFileVersionDelegate; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.wowza.wms.logging.WMSLoggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomFileVersionDelegate</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IStreamRecorderFileVersionDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFilename</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IStreamRecorder recorder)</span></span></span><span class="hljs-function"> </span></span>{ String sDisk = GetDisk(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sDisk == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { WMSLoggerFactory.getLogger(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>).error(<span class="hljs-string"><span class="hljs-string">"CustomFileVersionDelegate::getFilename(): No drive chosen"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } String sStreamName = recorder.getStreamName(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nCameraId = Integer.parseUnsignedInt(ServiceQueries.GetCameraId(sStreamName)); TimeZone tz = TimeZone.getTimeZone(<span class="hljs-string"><span class="hljs-string">"Europe/Moscow"</span></span>); Calendar now = Calendar.getInstance(tz); String sDirPath = ServerParams.m_sServerContentPath + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + sDisk + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + Integer.toString(nCameraId / <span class="hljs-number"><span class="hljs-number">200</span></span>) + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + sStreamName + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + String.format(<span class="hljs-string"><span class="hljs-string">"%1$tY/%1$tm/%1$td"</span></span>, now); String sFullFilePath = sDirPath + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + sStreamName + <span class="hljs-string"><span class="hljs-string">"_"</span></span> + String.format(<span class="hljs-string"><span class="hljs-string">"%1$tH_%1$tM_%1$tS"</span></span>, now) + <span class="hljs-string"><span class="hljs-string">".mp4"</span></span>; File dirs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(sDirPath); dirs.setExecutable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); dirs.setWritable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); dirs.mkdirs(); WMSLoggerFactory.getLogger(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>).info( <span class="hljs-string"><span class="hljs-string">"CustomFileVersionDelegate::getFilename(): Filename created: "</span></span> + sFullFilePath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sFullFilePath; } }</code> </pre><br>  Di kelas <b>CustomFileVersionDelegate</b> , fungsi <b>getFilename</b> virtual dari kelas dasar <b>IStreamRecorderFileVersionDelegate</b> <b>kelebihan beban</b> , yang dipanggil oleh server media sebelum aliran mulai menulis ke file.  Fungsi membuat folder pada disk dengan path <b>sDirPath</b> dan mengembalikan path lengkap ke file <b>sFullFilePath</b> . <br><br>  Karena volume data media sangat besar, sistem file menyertakan beberapa disk fisik volume besar (8 - 12 TB) yang dipasang sebagai subdirektori.  Disk dengan jumlah ruang kosong terbesar dipilih sebagai disk tujuan selama perekaman.  Untuk operasi optimal dari sistem file ketika mengakses file, jalur ke folder target dibentuk sebagai berikut: <br><br><pre> <code class="plaintext hljs">/content/&lt;diskId&gt;/&lt;cameraIdDivideBy200&gt;/&lt;streamUuid&gt;/&lt;year&gt;/&lt;month&gt;/&lt;day&gt;/</code> </pre><br>  di mana <b>diskId</b> adalah pengidentifikasi disk (folder yang dipasang), <br>  <b>cameraIdDivideBy200</b> - hasil pembagian integer dari pengidentifikasi kamera sebesar 200, <br>  <b>streamUuid</b> - pengidentifikasi aliran media, <br>  <b>tahun, bulan, hari</b> - tahun, bulan dan hari pencatatan, masing-masing. <br><br>  Ini menghindari sejumlah besar subfolder dalam satu folder dan, karenanya, penurunan dramatis dalam kinerja seluruh sistem file dengan peningkatan jumlah kamera IP di rumah pintar yang keruh. <br><br>  Informasi tentang alamat IP server media, jalur ke file dengan data media, waktu mulai dan akhir penulisan ke file disimpan dalam basis data cloud dan kemudian digunakan oleh aplikasi klien untuk menampilkan garis waktu arsip tempat video dapat dipilih dan diputar. <br><br>  Untuk mendapatkan streaming video, ujung depan aplikasi klien mengakses server media, mengirimkan perintah berikut melalui protokol HTTP.  Untuk aliran video "langsung": <br><br><pre> <code class="plaintext hljs">https://&lt;mediaserverIp&gt;:&lt;port&gt;/rtp-live-iot/&lt;streamUuid&gt;/playlist.m3u8</code> </pre><br>  Untuk aliran video yang diarsipkan: <br><br><pre> <code class="plaintext hljs">https://&lt;mediaserverIp&gt;:&lt;port&gt;/vod/_definst_/mp4:&lt;diskId&gt;/&lt;cameraIdDivideBy200&gt;/&lt;streamUuid&gt;/&lt;year&gt;/&lt;month&gt;/&lt;day&gt;/&lt;fileName&gt;/playlist.m3u8?wowzaplaystart=&lt;offsetMs&gt;&amp;wowzaplayduration=&lt;durationMs&gt;</code> </pre><br>  di mana <b>fileName</b> adalah nama file arsip pada disk, <br>  <b>offsetMs</b> - pemutaran offset relatif terhadap awal file dalam milidetik, <br>  <b>durationMs</b> - durasi pemutaran dalam milidetik. <br><br>  Server media mengirimkan streaming dalam format <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">HLS</a> , yang memungkinkan Anda untuk menampilkan video H.264 + AAC di semua browser dan perangkat seluler modern dengan sistem operasi iOS dan Android.  Packageizer HLS mengkodekan aliran dalam bentuk potongan-potongan terpisah dan mengirimkannya melalui HTTP sebagai tanggapan terhadap permintaan dari aplikasi seluler. <br><br>  Untuk mengoptimalkan biaya penyimpanan dan akses ke file arsip, server cloud home cloud dikembangkan pada platform perangkat keras Supermicro CSE-825TQ, motherboard X8DT6, motherboard X8DT6, 2xCPU Intel Xeon E5645 2,4 GHz, RAM 32 GB, HDD 44 TB Adaptec AAC-RAID HDD.  Server media diinstal sebagai server khusus di situs hosting dan terhubung ke saluran Internet dengan lebar 400 Mbps yang dijamin.  Kinerja satu server media cukup untuk memproses stream media dari ~ 400 kamera IP dengan codec H.264, resolusi bingkai 720p dan bitrate 1 Mbps. <br><br><img src="https://habrastorage.org/webt/zr/-n/sy/zr-nsyuedb8wtbakou5rzfnsyo8.png"><br><br>  Oleh karena itu, untuk dapat memproses stream dari 1000 kamera IP, perlu menginstal 3 server media dan mendistribusikan beban secara merata di antara mereka.  Untuk ini, load balancer digunakan, yang terhubung ke server media Wowza Streaming Engine sebagai plugin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AddOn Load Balancing AddOn yang terpisah</a> .  Ini membedakan, pada kenyataannya, load balancer (atau <b>server asal</b> ), yang secara berkala menerima metrik kinerja dari server media akhir (atau <b>server tepi</b> ) dan, berdasarkan informasi ini, menemukan server yang paling tidak dimuat dalam gugus. <br><br>  Pengontrol rumah pintar mengakses penyeimbang melalui HTTP dan sebagai tanggapan menerima alamat IP dari server ini, di mana pengontrol mentransmisikan aliran media dari kamera IP melalui RTMP.  Metrik kinerja mencakup jumlah koneksi yang dibuat dengan sumber dan konsumen aliran media dan bandwidth saat ini dari saluran Internet di server.  Dalam pengaturan penyeimbang, Anda juga dapat menentukan pilihan server tepi, dengan mempertimbangkan posisi geospasialnya, yang memungkinkan Anda untuk meng-host server di berbagai kota dan negara untuk membuat jaringan terdistribusi untuk mengirimkan konten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CDN</a> . <br><br><h2>  Sentuh basis data </h2><br>  Seperti disebutkan sebelumnya dalam artikel sebelumnya, pembacaan sensor Z-Wave, serta status dan kejadian terkini dari kamera IP dikirim dalam format JSON oleh pengontrol rumah pintar ke cloud menggunakan protokol MQTT.  Server logika bisnis mendekode pesan-pesan ini dan menjalankan subtugas <b>StoreSensorDataInfluxDB</b> , yang mentransmisikan data ke database sentuh melalui HTTP. <br><br> <a href=""><img src="https://habrastorage.org/webt/14/lv/rv/14lvrvrra0js_mzifmrwszu9c68.png"></a> <br>  <font color="grey">(klik pada gambar untuk membuka dalam resolusi yang lebih tinggi)</font> <br><br>  Basis data cloud rumah pintar dikembangkan berdasarkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">InfluxDB 1.7.x</a> - sistem manajemen basis data sumber terbuka untuk bekerja dengan urutan waktu, yang digunakan di banyak proyek Internet of Things untuk menyimpan data dari sensor dan analitik.  Permintaan ke database sentuh dihasilkan dalam bahasa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">InfluxQL</a> yang mirip dengan SQL tradisional. <br><br>  Waktu penyimpanan data di cloud smart home ditentukan oleh tarif yang dipilih sesuai dengan model pengguna.  Karena perbedaan yang signifikan dalam jumlah data video dan data sensor, waktu penyimpanannya akan berbeda.  Ukuran arsip video diukur dalam hari (7, 14, 30 hari dengan kecepatan berbeda), dan ukuran arsip sensor diukur dalam tahun (3, 5, 7 tahun, masing-masing).  Oleh karena itu, untuk setiap pengontrol rumah pintar, ketika terdaftar di akun pribadi pengguna, 2 database terpisah dengan kebijakan penyimpanan berbeda dibuat di dalam basis data sentuh: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">"gateway_6774f85a_0a5b_4059_9b68_************_cameras"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DURATION</span></span> <span class="hljs-number"><span class="hljs-number">720</span></span>h SHARD <span class="hljs-keyword"><span class="hljs-keyword">DURATION</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>h; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">"gateway_6774f85a_0a5b_4059_9b68_************_sensors"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DURATION</span></span> <span class="hljs-number"><span class="hljs-number">61320</span></span>h SHARD <span class="hljs-keyword"><span class="hljs-keyword">DURATION</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>h;</code> </pre><br>  Backend dari aplikasi klien bertanggung jawab untuk membuat, mengedit, dan menghapus basis data di dalam basis data sentuh.  Misalnya, jika pengguna cloud rumah pintar mengubah tarif, backend mengirim perintah berikut untuk membuat perubahan pada kebijakan penyimpanan: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETENTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">POLICY</span></span> <span class="hljs-string"><span class="hljs-string">"autogen"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-string"><span class="hljs-string">"gateway_6774f85a_0a5b_4059_9b68_************_cameras"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DURATION</span></span> <span class="hljs-number"><span class="hljs-number">168</span></span>h SHARD <span class="hljs-keyword"><span class="hljs-keyword">DURATION</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>h;</code> </pre><br>  Saat menghapus pengontrol rumah pintar dari akun pribadi pengguna, backend menghapus database yang sesuai: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">"gateway_6774f85a_0a5b_4059_9b68_************_cameras"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">"gateway_6774f85a_0a5b_4059_9b68_************_sensors"</span></span>;</code> </pre><br>  Setelah menerima pesan informasi dari pengontrol rumah pintar, server logika bisnis melakukan permintaan untuk memasukkan data ke dalam database sentuh: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> device_20873eb0_dd5e_4213_a175_************,<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=METER,label=Energy,units=kWh value_float=<span class="hljs-number"><span class="hljs-number">0.05</span></span> <span class="hljs-number"><span class="hljs-number">1572194550125</span></span>;</code> </pre><br>  Contoh tabel dengan data dari sensor Z-Wave untuk satu pengontrol rumah pintar: <br><br><img src="https://habrastorage.org/webt/bc/ic/ht/bcicht3izpojrvpo2bsp2347p5w.png"><br><br>  Salah satu fitur paling berguna dari cloud house adalah perhitungan statistik berdasarkan data yang diterima.  Pengguna perlu mengetahui suhu rata-rata di dalam ruangan atau berapa banyak listrik yang ia habiskan per bulan. <br><br>  Bahasa InfluxQL memungkinkan Anda untuk melakukan kueri menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">fungsi analitik</a> .  Misalnya, untuk menghitung suhu rata-rata selama seminggu, Anda harus menjalankan kueri berikut: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> MEAN(<span class="hljs-string"><span class="hljs-string">"value_float"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> device_63c660da_f0e8_4eca_8d5f_************ <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> label = <span class="hljs-string"><span class="hljs-string">'Temperature'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> &gt;= <span class="hljs-string"><span class="hljs-string">'2019-10-21T00:00:00.000Z'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> &lt;= <span class="hljs-string"><span class="hljs-string">'2019-10-27T23:59:59.999Z'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>d) fill(<span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre><br>  Hasil kueri ini ditunjukkan pada tabel: <br><br><img src="https://habrastorage.org/webt/ze/ac/wb/zeacwb7cqvnei_raajemgoebauq.png"><br><br>  Artikel berikutnya, yang sepenuhnya dikhususkan untuk aplikasi klien, akan mempertimbangkan secara rinci perhitungan statistik untuk berbagai parameter dan pembangunan tabel dan grafik berdasarkan itu. <br><br>  Dalam sistem cloud smart home, InfluxDB DBMS digunakan pada mesin virtual Yandex. Cloud dengan parameter berikut: 4 vCPU core dengan pangsa terjamin sebesar 20%, 2 GB RAM, 100 GB HDD.  Menurut perhitungan konfigurasi ini, cukup untuk menyimpan data sensor dari 3.000 kamera IP dan 5.000 sensor Z-Wave selama 7 tahun. <br><br><h2>  Kesimpulan </h2><br>  Artikel tersebut meneliti arsitektur layanan cloud untuk rumah pintar, algoritma server logika bisnis, arsitektur server media untuk merekam, menyimpan, dan memutar aliran media dari kamera IP, serta arsitektur basis data sentuh untuk menyimpan dan menganalisis data dari sensor rumah pintar.  Sistem layanan cloud berfungsi baik pada server khusus maupun virtual, untuk stabilitas lebih besar yang terletak di situs hosting yang berbeda.  Sistem saat ini sedang menjalani operasi uji coba. <br><br>  Semakin tua data yang disimpan di cloud, semakin jarang pengguna mengaksesnya.  Dalam versi layanan cloud berikutnya, diusulkan untuk menggunakan mekanisme penipisan (atau oversampling) data menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">InfluxDB Continuous Queries</a> untuk mengurangi jumlah data yang disimpan menggunakan fungsi agregasi dan, dengan demikian, meningkatkan kapasitas database sentuh. <br><br><img src="https://habrastorage.org/webt/4x/s-/jl/4xs-jlindsjesrddtgfb8nbstxu.png"><br><br>  Juga, dalam versi berikutnya dari layanan cloud, sekelompok server logika bisnis akan diimplementasikan sesuai dengan prinsip sekelompok server media, yang dibahas dalam artikel ini.  Gambar tersebut menunjukkan arsitektur cluster seperti itu, di mana beberapa server tepi (masing-masing memiliki broker MQTT terpisah dan perangkat lunak server logika bisnis) mengirim metrik kinerja ke server asal, yang menghitung alamat IP dari server yang paling tidak dimuat.  Ini akan memungkinkan Anda untuk skala sistem ke tingkat yang lebih besar dan mengatasi batas 1000 rumah pintar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id474700/">https://habr.com/ru/post/id474700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id474690/index.html">Membuat konsol dengan tinggi variabel untuk pekerjaan yang lebih nyaman di komputer</a></li>
<li><a href="../id474692/index.html">Ulasan Skaffold untuk Pengembangan Kubernetes</a></li>
<li><a href="../id474694/index.html">Bagaimana kami memilih dan memutar kerangka kerja untuk pengujian kinerja</a></li>
<li><a href="../id474696/index.html">Tiket ke industri minyak atau Rosneft menyerukan Tantangan Seismik</a></li>
<li><a href="../id474698/index.html">Menggunakan modal windows di antarmuka pengguna</a></li>
<li><a href="../id474702/index.html">Pemrograman fungsional dari sudut pandang EcmaScript. Fungsi murni, lambda, kekebalan</a></li>
<li><a href="../id474704/index.html">Wawancara Playboy: Steve Jobs, Bagian 2</a></li>
<li><a href="../id474706/index.html">Algoritma Pencarian Fuzzy TextRadar - Pendekatan Dasar</a></li>
<li><a href="../id474708/index.html">Internet lebih terfragmentasi dari sebelumnya: di mana lebih dari satu juta pengguna baru ‚Äúdatang‚Äù setiap hari? Bagian 1</a></li>
<li><a href="../id474710/index.html">c.tech: Frontend Meetup # 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>