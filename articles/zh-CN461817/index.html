<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👸 🚵🏿 😪 CMake和C ++-永远的兄弟 ⛈️ ♏️ 👨🏽‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在开发过程中，我喜欢更改编译器，构建模式，依赖版本，执行静态分析，衡量性能，收集覆盖范围，生成文档等。 我真的很喜欢CMake，因为它可以让我做我想做的所有事情。 


 许多人批评CMake，而且常常是当之无愧的，但是如果您看一下，并不是一切都那么糟糕，而且最近情况还不错 ，并且发展方向是非常积极...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CMake和C ++-永远的兄弟</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461817/"><p><img src="https://habrastorage.org/webt/ac/a0/8-/aca08-xhl_t033obcrcqgxpmksk.png" alt="永远的友谊"></p><br><p> 在开发过程中，我喜欢更改编译器，构建模式，依赖版本，执行静态分析，衡量性能，收集覆盖范围，生成文档等。 我真的很喜欢CMake，因为它可以让我做我想做的所有事情。 </p><br><p> 许多人批评CMake，而且常常是当之无愧的，但是如果您看一下，并不是一切都那么糟糕，而且最近情况还<strong>不错</strong> ，并且发展方向是非常积极的。 </p><br><p> 在本文中，我想说明在CMake系统中组织C ++标头库来获得以下功能有多么简单： </p><br><ol><li> 组装； </li><li> 自动启动测试； </li><li> 测量代码覆盖率； </li><li> 安装； </li><li> 自动记录 </li><li> 在线沙箱生成； </li><li> 静态分析 </li></ol><br><blockquote> 谁已经了解专业人士和专业人士，谁都可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载项目模板</a>并开始使用它。 </blockquote><a name="habracut"></a><br><a name="contents"></a><br><h2> 目录内容 </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">由内而外的项目</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">项目结构</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">主CMake文件（./CMakeLists.txt）</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">项目信息</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">项目选项</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">编译选项</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">主要目标</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">安装方式</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">测验</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">该文件</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在线沙箱</a> </li></ol></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">测试脚本（test / CMakeLists.txt）</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">测试中</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">覆盖范围</a> </li></ol></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档脚本（doc / CMakeLists.txt）</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在线沙箱的脚本（online / CMakeLists.txt）</a> </li></ol></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">外部项目</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">组装方式</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">世代</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">组装方式</a> </li></ol></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">选件</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MYLIB_COVERAGE</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MYLIB_TESTING</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MYLIB_DOXYGEN_LANGUAGE</a> </li></ol></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">大会目标</a> <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">默认情况下</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">mylib单元测试</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">检查</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">覆盖范围</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">doc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">魔盒</a> </li></ol></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">例子</a> </li></ol></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">工具</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">静态分析</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">后记</a> </li></ol><br><a name="project-from-the-inside"></a><br><h2>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">由内而外的项目</a> </h2><br><a name="project-structure"></a><br><h3 id="struktura-proektacontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">项目结构</a> </h3><br><pre><code class="plaintext hljs">. ├── CMakeLists.txt ├── README.en.md ├── README.md ├── doc │  ├── CMakeLists.txt │  └── Doxyfile.in ├── include │  └── mylib │  └── myfeature.hpp ├── online │  ├── CMakeLists.txt │  ├── mylib-example.cpp │  └── wandbox.py └── test ├── CMakeLists.txt ├── mylib │  └── myfeature.cpp └── test_main.cpp</code> </pre> <br><p> 我们将主要讨论如何组织CMake脚本，因此将对其进行详细分析。 每个人都可以直接<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在project-template页面上</a>看到其余文件。 </p><br><a name="cmakeliststxt"></a><br><h3 id="glavnyy-cmake-fayl-cmakeliststxtcontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">主CMake文件（./CMakeLists.txt）</a> </h3><br><a name="project-information"></a><br><h4 id="informaciya-o-proektecontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">项目信息</a> </h4><br><p> 首先，您需要请求正确版本的CMake系统。  CMake在不断发展，团队签名，在不同条件下的行为正在发生变化。 为了使CMake能够立即了解我们对他的要求，我们需要立即确定对他的要求。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">3.13</span></span>)</code> </pre> <br><p> 然后，我们指定项目，其名称，版本，使用的语言等（请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code> project</code></a> ）。 </p><br><p> 在这种情况下，我们指定<code>CXX</code>语言（即C ++），以便CMake不会紧张，也不会寻找C语言编译器（默认情况下，CMake包含两种语言：C和C ++）。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">project</span></span>(Mylib VERSION <span class="hljs-number"><span class="hljs-number">1.0</span></span> LANGUAGES CXX)</code> </pre> <br><p> 在这里，您可以立即检查我们的项目是否作为子项目包含在另一个项目中。 这将在将来极大地帮助您。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">get_directory_property</span></span>(IS_SUBPROJECT PARENT_DIRECTORY)</code> </pre> <br><a name="project-options"></a><br><h4 id="opcii-proektacontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">项目选项</a> </h4><br><p> 我们提供两种选择。 </p><br><p> 第一个选项<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>MYLIB_TESTING</code></a>关闭单元测试。 如果我们确定一切都与测试保持一致，并且例如仅希望安装或打包我们的项目，则这可能是必要的。 或者我们的项目被包含为子项目-在这种情况下，我们项目的用户对运行我们的测试不感兴趣。 您不测试使用的依赖项吗？ </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">option</span></span>(MYLIB_TESTING <span class="hljs-string"><span class="hljs-string">"  "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>)</code> </pre> <br><p> 此外，我们将单独使用一个选项<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>MYLIB_COVERAGE</code></a>来测试测试的代码覆盖率，但是它将需要其他工具，因此您需要显式启用它。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">option</span></span>(MYLIB_COVERAGE <span class="hljs-string"><span class="hljs-string">"    "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>)</code> </pre> <br><a name="compile-options"></a><br><h4 id="opcii-kompilyaciicontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">编译选项</a> </h4><br><p> 当然，我们很酷，再加上程序员，所以我们希望编译器提供最大程度的编译时间诊断。 没有一只鼠标会滑过。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">add_compile_options</span></span>( -Werror -Wall -Wextra -Wpedantic -Wcast-align -Wcast-qual -Wconversion -Wctor-dtor-privacy -Wenum-compare -Wfloat-<span class="hljs-keyword"><span class="hljs-keyword">equal</span></span> -Wnon-virtual-dtor -Wold-style-cast -Woverloaded-virtual -Wredundant-decls -Wsign-conversion -Wsign-promo )</code> </pre> <br><p> 我们还将禁用扩展程序以完全符合C ++语言标准。 默认情况下，它们包含在CMake中。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> CMAKE_CXX_EXTENSIONS) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(CMAKE_CXX_EXTENSIONS <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>()</code> </pre> <br><a name="main-target"></a><br><h4 id="osnovnaya-celcontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">主要目标</a> </h4><br><p> 我们的库仅由头文件组成，这意味着我们没有任何静态或动态库形式的文件。 另一方面，要在外部使用我们的库，您需要安装它，需要能够在系统中找到它并将其连接到您的项目，同时这些相同的标头以及可能的其他一些标头属性。 </p><br><p> 为此，我们创建一个接口库。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">add_library</span></span>(mylib INTERFACE)</code> </pre> <br><p> 将标头绑定到我们的前端库。 </p><br><p>  CMake的现代，时尚，年轻化使用意味着标题，属性等。 通过一个单一目的传输。 因此，只要说<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>target_link_libraries(target PRIVATE dependency)</code></a>就足够了，并且与<code>dependency</code>目标相关联的所有标头都可用于属于目标<code>target</code>源。 并且不需要<code>[target_]include_directories</code> 。 下面将在分析<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CMake脚本进行单元测试</a>时对此进行演示。 </p><br><p> 所谓的也值得关注  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>-: $&lt;...&gt;</code></a> 。 </p><br><p> 此命令将所需的标头与前端库相关联，如果我们的库连接到同一CMake层次结构中的目标，则目录<code>${CMAKE_CURRENT_SOURCE_DIR}/include</code>标头将与之关联，如果我们的由于该库已安装在系统上，并使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>find_package</code></a>连接到另一个项目，因此<code>include</code>目录相对于安装目录的标头将与该库相关联。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">target_include_directories</span></span>(mylib INTERFACE $&lt;BUILD_INTERFACE:<span class="hljs-variable"><span class="hljs-variable">${CMAKE_CURRENT_SOURCE_DIR}</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>&gt; $&lt;INSTALL_INTERFACE:<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>&gt; )</code> </pre> <br><p> 设置语言标准。 当然，最后。 同时，我们不仅包含标准，而且还将其分发给将使用我们库的人员。 这是由于set属性具有<code>INTERFACE</code>类别（请参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">target_compile_features命令</a> ）而实现的。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">target_compile_features</span></span>(mylib INTERFACE cxx_std_17)</code> </pre> <br><p> 我们为我们的库创建一个别名。 此外，为了美观，他将处于特殊的“名称空间”中。 当不同的模块出现在我们的库中，并且我们彼此独立地连接时，这将很有用。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">例如，在Boost中</a> 。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">add_library</span></span>(Mylib::mylib ALIAS mylib)</code> </pre> <br><a name="installation"></a><br><h4 id="ustanovkacontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">安装方式</a> </h4><br><p> 在系统中安装标题。 这里的一切都很简单。 我们说带有所有标题的文件夹应位于相对于安装位置的<code>include</code>目录中。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">install</span></span>(DIRECTORY <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>/mylib DESTINATION <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>)</code> </pre> <br><p> 接下来，通知构建系统我们希望能够在第三方项目中调用<code>find_package(Mylib)</code>并获取目标<code>Mylib::mylib</code> 。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">install</span></span>(TARGETS mylib <span class="hljs-keyword"><span class="hljs-keyword">EXPORT</span></span> MylibConfig) <span class="hljs-keyword"><span class="hljs-keyword">install</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">EXPORT</span></span> MylibConfig NAMESPACE Mylib:: DESTINATION share/Mylib/cmake)</code> </pre> <br><p> 下一个咒语应理解如下。 当我们在第三方项目中调用<code>find_package(Mylib 1.2.3 REQUIRED)</code>时，在这种情况下，已安装库的实际版本将与<code>1.2.3</code>版本不兼容，CMake将自动生成错误。 也就是说，您无需手动遵循版本。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(CMakePackageConfigHelpers) write_basic_package_version_file(<span class="hljs-string"><span class="hljs-string">"${PROJECT_BINARY_DIR}/MylibConfigVersion.cmake"</span></span> VERSION <span class="hljs-variable"><span class="hljs-variable">${PROJECT_VERSION}</span></span> COMPATIBILITY AnyNewerVersion ) <span class="hljs-keyword"><span class="hljs-keyword">install</span></span>(FILES <span class="hljs-string"><span class="hljs-string">"${PROJECT_BINARY_DIR}/MylibConfigVersion.cmake"</span></span> DESTINATION share/Mylib/cmake)</code> </pre> <br><a name="tests"></a><br><h4 id="testycontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">测验</a> </h4><br><p> 如果使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">适当的选项</a>显式关闭了测试，或者如果我们的项目是子项目，即使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>add_subdirectory</code></a>连接到另一个CMake项目，则在层次结构中我们将走得更远，描述生成和运行测试的命令的脚本不会启动。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> MYLIB_TESTING) <span class="hljs-keyword"><span class="hljs-keyword">message</span></span>(STATUS <span class="hljs-string"><span class="hljs-string">"  Mylib "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span>(IS_SUBPROJECT) <span class="hljs-keyword"><span class="hljs-keyword">message</span></span>(STATUS <span class="hljs-string"><span class="hljs-string">"Mylib     "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">add_subdirectory</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>()</code> </pre> <br><a name="documentation"></a><br><h4 id="dokumentaciyacontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">该文件</a> </h4><br><p> 如果是子项目，也不会生成文档。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> IS_SUBPROJECT) <span class="hljs-keyword"><span class="hljs-keyword">add_subdirectory</span></span>(doc) <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>()</code> </pre> <br><a name="online-sandbox"></a><br><h4 id="onlayn-pesochnicacontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在线沙箱</a> </h4><br><p> 同样，该子项目也将没有在线沙箱。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> IS_SUBPROJECT) <span class="hljs-keyword"><span class="hljs-keyword">add_subdirectory</span></span>(online) <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>()</code> </pre> <br><a name="testcmakeliststxt"></a><br><h3 id="skript-dlya-testov-testcmakeliststxtcontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">测试脚本（test / CMakeLists.txt）</a> </h3><br><a name="testing"></a><br><h4 id="testirovaniecontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">测试中</a> </h4><br><p> 首先，我们找到具有所需测试框架的软件包（将其替换为您喜欢的软件包）。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">find_package</span></span>(doctest <span class="hljs-number"><span class="hljs-number">2.3</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span> REQUIRED)</code> </pre> <br><p> 我们使用测试创建可执行文件。 通常，我只将<code>main</code>功能直接位于其中的文件添加到可执行二进制文件中。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(mylib-unit-tests test_main.cpp)</code> </pre> <br><p> 稍后会添加描述测试本身的文件。 但这不是必需的。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">target_sources</span></span>(mylib-unit-tests PRIVATE mylib/myfeature.cpp)</code> </pre> <br><p> 我们连接依赖关系。 请注意，我们仅<code>target_include_directories</code>所需<code>target_include_directories</code> CMake目标<code>target_include_directories</code>到二进制文件，而未调用<code>target_include_directories</code>命令。 测试框架和<code>Mylib::mylib</code>的标头以及构建参数（在我们的情况下，这是C ++语言标准）与这些目标一起爬网。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">target_link_libraries</span></span>(mylib-unit-tests PRIVATE Mylib::mylib doctest::doctest )</code> </pre> <br><p> 最后，创建一个虚拟目标，其“程序集”等效于运行测试，并将该目标添加到默认程序集中（ <code>ALL</code>属性负责此操作）。 这意味着默认情况下，程序集会启动测试的启动，也就是说，我们将永远不会忘记运行它们。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">add_custom_target</span></span>(check ALL <span class="hljs-keyword"><span class="hljs-keyword">COMMAND</span></span> mylib-unit-tests)</code> </pre> <br><a name="code-coverage"></a><br><h4 id="pokrytiecontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">覆盖范围</a> </h4><br><p> 接下来，如果指定了相应选项，则启用代码覆盖率测量。 我不再赘述，因为它们与衡量覆盖率的工具比与CMake的联系更多。 唯一重要的是要注意，根据结果，将创建一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>coverage</code></a>目标，通过它可以方便地开始测量覆盖率。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">find_program</span></span>(GCOVR_EXECUTABLE gcovr) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(MYLIB_COVERAGE <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> GCOVR_EXECUTABLE) <span class="hljs-keyword"><span class="hljs-keyword">message</span></span>(STATUS <span class="hljs-string"><span class="hljs-string">"    "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">target_compile_options</span></span>(mylib-unit-tests PRIVATE --coverage) <span class="hljs-keyword"><span class="hljs-keyword">target_link_libraries</span></span>(mylib-unit-tests PRIVATE gcov) <span class="hljs-keyword"><span class="hljs-keyword">add_custom_target</span></span>(coverage <span class="hljs-keyword"><span class="hljs-keyword">COMMAND</span></span> <span class="hljs-variable"><span class="hljs-variable">${GCOVR_EXECUTABLE}</span></span> --root=<span class="hljs-variable"><span class="hljs-variable">${PROJECT_SOURCE_DIR}</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>/ --object-directory=<span class="hljs-variable"><span class="hljs-variable">${CMAKE_CURRENT_BINARY_DIR}</span></span> DEPENDS check ) <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span>(MYLIB_COVERAGE <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> GCOVR_EXECUTABLE) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(MYLIB_COVERAGE <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">message</span></span>(WARNING <span class="hljs-string"><span class="hljs-string">"       gcovr"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>()</code> </pre> <br><a name="doccmakeliststxt"></a><br><h3 id="skript-dlya-dokumentacii-doccmakeliststxtcontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档脚本（doc / CMakeLists.txt）</a> </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">发现Doxygen</a> 。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">find_package</span></span>(Doxygen)</code> </pre> <br><p> 接下来，我们检查用户是否设置了language变量。 如果是，那就不要碰，如果没有，那就用俄语。 然后配置Doxygen系统文件。 在配置过程中，所有必需的变量（包括语言）都到达了那里（请参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code> configure_file</code></a> ）。 </p><br><p> 然后，我们创建<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>doc</code></a>目标，这将开始生成文档。 由于生成文档并不是开发过程中的最大需求，因此默认情况下不会实现目标，因此必须明确启动它。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Doxygen_FOUND) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> MYLIB_DOXYGEN_LANGUAGE) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(MYLIB_DOXYGEN_LANGUAGE Russian) <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">message</span></span>(STATUS <span class="hljs-string"><span class="hljs-string">"Doxygen documentation will be generated in ${MYLIB_DOXYGEN_LANGUAGE}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">configure_file</span></span>(Doxyfile.in Doxyfile) <span class="hljs-keyword"><span class="hljs-keyword">add_custom_target</span></span>(doc <span class="hljs-keyword"><span class="hljs-keyword">COMMAND</span></span> <span class="hljs-variable"><span class="hljs-variable">${DOXYGEN_EXECUTABLE}</span></span> <span class="hljs-variable"><span class="hljs-variable">${CMAKE_CURRENT_BINARY_DIR}</span></span>/Doxyfile) <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span> ()</code> </pre> <br><a name="onlinecmakeliststxt"></a><br><h3 id="skript-dlya-onlayn-pesochnicy-onlinecmakeliststxtcontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在线沙箱的脚本（online / CMakeLists.txt）</a> </h3><br><p> 在这里，我们找到第三个Python并创建一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>wandbox</code></a>目标，该目标将生成一个与<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wandbox</a>服务API匹配的请求并将其发送。 作为响应，出现了指向完成的沙箱的链接。 </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">find_program</span></span>(PYTHON3_EXECUTABLE python3) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(PYTHON3_EXECUTABLE) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(WANDBOX_URL <span class="hljs-string"><span class="hljs-string">"https://wandbox.org/api/compile.json"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">add_custom_target</span></span>(wandbox <span class="hljs-keyword"><span class="hljs-keyword">COMMAND</span></span> <span class="hljs-variable"><span class="hljs-variable">${PYTHON3_EXECUTABLE}</span></span> wandbox.py mylib-example.cpp <span class="hljs-string"><span class="hljs-string">"${PROJECT_SOURCE_DIR}"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> | curl -H <span class="hljs-string"><span class="hljs-string">"Content-type: application/json"</span></span> -d @- <span class="hljs-variable"><span class="hljs-variable">${WANDBOX_URL}</span></span> WORKING_DIRECTORY <span class="hljs-variable"><span class="hljs-variable">${CMAKE_CURRENT_SOURCE_DIR}</span></span> DEPENDS mylib-unit-tests ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">message</span></span>(WARNING <span class="hljs-string"><span class="hljs-string">"  -    python 3- "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>()</code> </pre> <br><a name="project-from-the-outside"></a><br><h2>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">外部项目</a> </h2><br><p> 现在考虑如何使用这一切。 </p><br><a name="build"></a><br><h3 id="sborkacontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">组装方式</a> </h3><br><p> 与CMake装配系统上的任何其他项目一样，该项目的装配也包括两个阶段： </p><br><a name="generate"></a><br><h4 id="generaciyacontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">世代</a> </h4><br><pre> <code class="plaintext hljs">cmake -S // -B /// [ ...]</code> </pre> <br><blockquote> 如果以上命令由于CMake的旧版本而无法使用，请尝试省略<code>-S</code> ： <br><pre> <code class="plaintext hljs">cmake // -B /// [ ...]</code> </pre> <br></blockquote><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">有关选项的更多信息</a> 。 </p><br><a name="project-build"></a><br><h4 id="sborka-proektacontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">项目组装</a> </h4><br><pre> <code class="plaintext hljs">cmake --build /// [--target target]</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">阅读有关组装目标的更多信息</a> 。 </p><br><a name="options"></a><br><h3 id="opciicontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">选件</a> </h3><br><a name="MYLIB_COVERAGE"></a><br><h4 id="mylib_coveragecontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MYLIB_COVERAGE</a> </h4><br><pre> <code class="plaintext hljs">cmake -S ... -B ... -DMYLIB_COVERAGE=ON [  ...]</code> </pre> <br><p> 包括一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>coverage</code></a>目标，通过它可以开始通过测试衡量代码的覆盖率。 </p><br><a name="MYLIB_TESTING"></a><br><h4 id="mylib_testingcontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MYLIB_TESTING</a> </h4><br><pre> <code class="plaintext hljs">cmake -S ... -B ... -DMYLIB_TESTING=OFF [  ...]</code> </pre> <br><p> 提供关闭单元测试组件和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>check</code></a>目标的功能。 结果，测试的代码覆盖率测量<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>MYLIB_COVERAGE</code></a>关闭（请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>MYLIB_COVERAGE</code></a> ）。 </p><br><p> 另外，如果使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>add_subdirectory</code></a>将该项目作为子项目连接到另一个项目，则会自动禁用测试。 </p><br><a name="MYLIB_DOXYGEN_LANGUAGE"></a><br><h4 id="mylib_doxygen_languagecontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MYLIB_DOXYGEN_LANGUAGE</a> </h4><br><pre> <code class="plaintext hljs">cmake -S ... -B ... -DMYLIB_DOXYGEN_LANGUAGE=English [  ...]</code> </pre> <br><p> 将<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>doc</code></a>目标生成的文档语言切换为指定的语言。 有关可用语言的列表，请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Doxygen系统网站</a> 。 </p><br><p> 默认情况下，启用俄语。 </p><br><a name="build-targets"></a><br><h3 id="sborochnye-celicontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">大会目标</a> </h3><br><a name="default-target"></a><br><h4 id="po-umolchaniyucontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">默认情况下</a> </h4><br><pre> <code class="plaintext hljs">cmake --build path/to/build/directory cmake --build path/to/build/directory --target all</code> </pre> <br><p> 如果未指定目标（相当于<code>all</code>目标），则收集所有可能的内容，并调用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>check</code></a>目标。 </p><br><a name="mylib-unit-tests"></a><br><h4 id="mylib-unit-testscontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">mylib单元测试</a> </h4><br><pre> <code class="plaintext hljs">cmake --build path/to/build/directory --target mylib-unit-tests</code> </pre> <br><p> 编译单元测试。 默认启用。 </p><br><a name="check"></a><br><h4 id="checkcontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">检查</a> </h4><br><pre> <code class="plaintext hljs">cmake --build /// --target check</code> </pre> <br><p> 运行收集的（如果尚未收集的话）单元测试。 默认启用。 </p><br><p> 另请参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>mylib-unit-tests</code></a> 。 </p><br><a name="coverage"></a><br><h4 id="coveragecontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">覆盖范围</a> </h4><br><pre> <code class="plaintext hljs">cmake --build /// --target coverage</code> </pre> <br><p> 使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">gcovr</a>程序分析正在运行（如果尚未运行的话）的单元测试，以覆盖代码。 </p><br><p> 涂层废气看起来像这样： </p><br><pre> <code class="plaintext hljs">------------------------------------------------------------------------------ GCC Code Coverage Report Directory: /path/to/cmakecpptemplate/include/ ------------------------------------------------------------------------------ File Lines Exec Cover Missing ------------------------------------------------------------------------------ mylib/myfeature.hpp 2 2 100% ------------------------------------------------------------------------------ TOTAL 2 2 100% ------------------------------------------------------------------------------</code> </pre> <br><p> 仅当<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>MYLIB_COVERAGE</code></a>时，目标才可用。 </p><br><p> 另请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>check</code></a> 。 </p><br><a name="doc"></a><br><h4 id="doccontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">doc</a> </h4><br><pre> <code class="plaintext hljs">cmake --build /// --target doc</code> </pre> <br><p> 开始使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Doxygen</a>系统生成代码文档。 </p><br><a name="wandbox"></a><br><h4 id="wandboxcontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">魔盒</a> </h4><br><pre> <code class="plaintext hljs">cmake --build /// --target wandbox</code> </pre> <br><p> 服务的响应如下所示： </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"permlink"</span></span> : <span class="hljs-string"><span class="hljs-string">"QElvxuMzHgL9fqci"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span> : <span class="hljs-string"><span class="hljs-string">"https://wandbox.org/permlink/QElvxuMzHgL9fqci"</span></span> }</code> </pre> <br><p> 为此，请使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wandbox</a>服务。 我不知道它们有多少橡胶服务器，但我认为不应滥用这一机会。 </p><br><a name="examples"></a><br><h3 id="primerycontents">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">例子</a> </h3><br><h4 id="sborka-proekta-v-otladochnom-rezhime-s-zamerom-pokrytiya"> 调试模式下的项目组装，具有覆盖率测量 </h4><br><pre> <code class="plaintext hljs">cmake -S // -B /// -DCMAKE_BUILD_TYPE=Debug -DMYLIB_COVERAGE=ON cmake --build /// --target coverage --parallel 16</code> </pre> <br><h4 id="ustanovka-proekta-bez-predvaritelnoy-sborki-i-testirovaniya"> 项目安装无需预先组装和测试 </h4><br><pre> <code class="plaintext hljs">cmake -S // -B /// -DMYLIB_TESTING=OFF -DCMAKE_INSTALL_PREFIX=/// cmake --build /// --target install</code> </pre> <br><h4 id="sborka-v-vypusknom-rezhime-zadannym-kompilyatorom"> 由指定的编译器以发布模式构建 </h4><br><pre> <code class="plaintext hljs">cmake -S // -B /// -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_COMPILER=g++-8 -DCMAKE_PREFIX_PATH=///// cmake --build /// --parallel 4</code> </pre> <br><h4 id="generirovanie-dokumentacii-na-angliyskom"> 英文文件生成 </h4><br><pre> <code class="plaintext hljs">cmake -S // -B /// -DCMAKE_BUILD_TYPE=Release -DMYLIB_DOXYGEN_LANGUAGE=English cmake --build /// --target doc</code> </pre> <br><a name="tools"></a><br><h2>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">工具</a> </h2><br><ol><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CMake的</a> 3.13 </p><br><p> 实际上，仅需要CMake 3.13才能运行此帮助中描述的某些控制台命令。 从CMake脚本的语法角度来看，如果以其他方式调用生成，则3.8版就足够了。 </p><br></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Doctest</a>测试<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">库</a> </p><br><p> 可以禁用测试（请参阅<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code> MYLIB_TESTING</code></a> ）。 </p><br></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">氧气</a> </p><br><p> 要切换将用于生成文档的语言， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>MYLIB_DOXYGEN_LANGUAGE</code></a>了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>MYLIB_DOXYGEN_LANGUAGE</code></a>选项。 </p><br></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Python 3</a>解释器 </p><br><p> 自动生成<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在线沙箱</a> 。 </p><br></li></ol><br><a name="static-analysis"></a><br><h2>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">静态分析</a> </h2><br><p> 借助CMake和一些出色的工具，您可以以最少的身体移动提供静态分析。 </p><br><h4 id="cppcheck">  Cppcheck </h4><br><p>  CMake内置了对<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Cppcheck</a>静态分析<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">工具的支持</a> 。 </p><br><p> 为此，请使用选项<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>CMAKE_CXX_CPPCHECK</code></a> ： </p><br><pre> <code class="plaintext hljs">cmake -S // -B /// -DCMAKE_BUILD_TYPE=Debug -DCMAKE_CXX_CPPCHECK="cppcheck;--enable=all;-I///include"</code> </pre> <br><p> 之后，静态分析将在每次编译和重新编译源代码时自动启动。 您无需执行任何其他操作。 </p><br><h4 id="clang">  lang </h4><br><p> 使用出色的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>scan-build</code></a>工具，您还可以进行两次静态分析： </p><br><pre> <code class="plaintext hljs">scan-build cmake -S // -B /// -DCMAKE_BUILD_TYPE=Debug scan-build cmake --build ///</code> </pre> <br><p> 在这里，与Cppcheck的情况不同，您需要每次通过<code>scan-build</code>运行程序集。 </p><br><a name="afterword"></a><br><h2>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">后记</a> </h2><br><p>  CMake是一个功能强大且灵活的系统，可让您实现各种口味和颜色的功能。 并且，尽管有时语法尚待改进，但魔鬼仍然不如他被涂上的那么可怕。 使用CMake构建系统造福社会和健康。 </p><br><hr><br><p>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载项目模板</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN461817/">https://habr.com/ru/post/zh-CN461817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN461803/index.html">数据版本控制（DVC）：数据版本控制和实验可重复性</a></li>
<li><a href="../zh-CN461805/index.html">蒙特卡洛积分在渲染中的应用</a></li>
<li><a href="../zh-CN461807/index.html">Kubernetes的Pod优先级如何导致Grafana Labs停机</a></li>
<li><a href="../zh-CN461813/index.html">来自OpenStreetMap 470世界的新闻（07.16.2019-07.22.2019）</a></li>
<li><a href="../zh-CN461815/index.html">半个世纪前计算机电源设计的一场革命</a></li>
<li><a href="../zh-CN461819/index.html">为什么简单的网站设计在科学上更好</a></li>
<li><a href="../zh-CN461821/index.html">新的免疫疗法清除了转移性乳腺癌女性的所有肿瘤</a></li>
<li><a href="../zh-CN461823/index.html">增强的软件设计四个规则</a></li>
<li><a href="../zh-CN461827/index.html">使用RoadRunner进行PHP / Go混合应用程序开发</a></li>
<li><a href="../zh-CN461829/index.html">TCP与UDP或网络协议的未来</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>