<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ— ğŸ§ğŸ¿ ğŸ¥™ Sistem Akuisisi Data di ESP. Bagian II LifeOfFlowers ğŸ‘ŒğŸ¿ â« ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hari baik! Jadi sudah waktunya untuk artikel kedua tentang topik ESP. Saya akan memberi tahu Anda tentang perangkat yang memungkinkan Anda menerima in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sistem Akuisisi Data di ESP. Bagian II LifeOfFlowers</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/411537/"><img src="https://habrastorage.org/webt/qo/wp/op/qowpopqxtr-by19k-5rlx5qs7we.jpeg"><br><br>  Hari baik!  Jadi sudah waktunya untuk artikel kedua tentang topik ESP.  Saya akan memberi tahu Anda tentang perangkat yang memungkinkan Anda menerima informasi tentang iklim mikro di sekitar bunga Anda (jika, tentu saja, Anda memilikinya) dan menerima pemberitahuan bahwa ada sesuatu yang mengancam kehidupan mereka. <br><a name="habracut"></a><br>  <b>Untuk apa?</b> <br><br>  Istri saya menyirami bunga seminggu sekali.  Dia melihat tanah dalam pot, melihat atau merasakan bahwa sudah saatnya bunga menyegarkan diri dan air.  Bunga-bunga yang kita miliki berbeda, tetapi ternyata bunga-bunga itu mengering dalam waktu yang bersamaan.  Pot besar adalah bunga besar, pot kecil adalah bunga kecil, artinya jelas.  Semua akan baik-baik saja jika untuk musim panas saya tidak tinggal di rumah sendirian selama beberapa bulan dan tidak lupa menyirami bunga-bunga.  Setibanya di akhir Agustus, seorang istri dengan wajah sedih mengeluarkan setek kering dari beberapa pot. <br><br>  Itu sedikit penyimpangan, sekarang tentang keputusan.  Untuk satu ambang jendela, kita perlu 1-2 perangkat untuk melakukan pengukuran dalam pot dengan ukuran berbeda.  Hal pertama yang harus dikontrol adalah kelembaban tanah, yang merusak bunga kita (kita tidak akan berurusan dengan PH dan sisa floristry yang tidak bisa dipahami, kita tidak sanggup melakukannya).  Selain kelembaban, setelah beberapa musyawarah, kami memutuskan untuk mengukur iluminasi sehingga kami dapat melacak pengaruh siang hari pada tanaman, suhu dan kelembaban lingkungan - ini setelahnya. <br><br>  Tentu saja, insinyur dari Kerajaan Tengah telah mencoba dan membuat perangkat yang dapat mencicit dan menciak ketika bumi mengering dalam pot, tetapi saya masih ingin memiliki perangkat sendiri dengan roti sendiri, terutama karena biaya perangkat tidak begitu tinggi. <br><br>  <b>Implementasi perangkat keras dan deskripsi pekerjaan</b> <br><br>  Poin yang paling penting adalah otonomi perangkat dan umur panjang kerjanya (tentu saja, tidak merugikan kualitas pengukuran).  Berdasarkan ESP-12E yang sama, dengan satu saluran ADC terpasang.  Pengontrol (modul, jika Anda mau) memiliki beberapa mode operasi, dan, karenanya, konsumsi: <br><br>  Matikan - 0,5uA; <br>  Tidur nyenyak - 10uA; <br>  Tidur ringan - 0,5mA; <br>  Modem sleep - 15mA; <br>  Dalam mode transfer data hingga 170mA (data bervariasi di beberapa sumber bahkan hingga 215mA). <br><br>  Untuk kebutuhan kita, tiga mode akan diperlukan: Tidur nyenyak, mode tidur dan mode transmisi.  Karena semuanya sangat baik, kami akan menggunakan dua baterai AAA untuk daya. <br><br>  Penerangan diukur dengan fototransistor BPW17N, kelembaban dan suhu sekitar AM2302, kelembaban tanah dengan elektroda yang diencerkan khusus pada papan di bawah pernis.  Karena kami memiliki baterai, kami akan mengukur tegangannya.  Untuk melakukan ini semua dengan satu ADC, gunakan multiplexer CD74HC4051M96.  Pada ESP-12E ADC, Anda dapat memasok tegangan hingga 1V, masing-masing, kami menempatkan pembagi di mana-mana. <br><br>  Diagram di bawah ini, ada banyak hal untuk mock-up (masih belum ada transistor VT3 di papan solder, dan papan terakhir belum siap). <br><br><img src="https://habrastorage.org/webt/ve/eg/yv/veegyvyagiw2qld1y9xzkls5uh8.jpeg"><br>  <i>Diagram perangkat</i> <br><br>  Dua baterai menghasilkan tegangan 3-3.3V, multiplexer beroperasi dalam kisaran dari 2V hingga 6V.  AM2302 beroperasi di kisaran 3.3-5.5V.  ESP-12E membutuhkan tegangan 2.3V atau lebih.  Semua ini diverifikasi oleh tes dan diverifikasi dengan lembar data.  Menjadi jelas bahwa AM2302 akan berhenti bekerja segera, atau tidak akan bekerja sama sekali, jadi kami membuat "retas" dan meletakkan kapasitor Buck-Boost TPS60240DGKR.  Ini memecahkan masalah serius lainnya, karena ketika tegangan turun, parameter yang diukur mengambang (iluminasi dan kelembaban tanah) dan perlu untuk menyesuaikan nilai-nilai pengukuran ADC, dengan mempertimbangkan tegangan, dan ini menyebabkan kesalahan. <br><br>  Jadi, ternyata sesuatu seperti ini: multiplexer ini ditenagai dan dikendalikan dari kaki ESP (didukung langsung oleh baterai), AM2302, pembagi cahaya dan kelembaban tanah ditenagai dari 3.3V dengan Buck-Boost, yang, pada gilirannya, dikendalikan oleh kaki ESP.  Mengayunkan tegangan dari 1.8V ke 3.3V. <br><br>  <b>Pengukuran kelembaban tanah</b> <br><br>  Saya memutuskan untuk memberikan nilai ini subbagian yang terpisah.  Versi pertama perangkat memiliki elektroda telanjang (tidak dilapisi dengan pernis) dan semuanya sederhana di sana, berikan voltase ke satu elektroda - lepaskan dari yang kedua.  Semakin tinggi kelembaban, semakin besar tegangan pada ADC. <br><br><img src="https://habrastorage.org/webt/5n/i6/3d/5ni63dgxpdhfflvjxq6mbn_a1ww.jpeg"><br>  <i>Gambar 1. Versi elektroda di papan.</i> <br><br>  Semuanya akan baik-baik saja, tetapi bahkan elektroda kaleng rentan terhadap korosi, dan memang tidak terlihat estetis.  Oleh karena itu, sirkuit berikut lahir (tersusun): PWM dengan IO15 dipasok ke salah satu "elektroda", dan nilai "diluruskan" dan dihaluskan dibaca dari itu.  Ternyata semakin tinggi kelembaban tanah, semakin kecil sinyalnya mencapai ADC, begitu sinyalnya melemahkan. <br><br><img src="https://habrastorage.org/webt/-z/bc/lh/-zbclhcx1gen-s4waxp3igijzrc.png"><br>  <i>Gambar 2. Skema membaca kelembaban tanah.</i> <br><br>  <b>Menguji dan bekerja</b> <br><br>  Saya akan segera mengklarifikasi bahwa tes yang panjang berlanjut, dan yang cepat menunjukkan yang berikut: perangkat bekerja (jangan terburu-buru kecewa) selama empat hari.  Pengukuran dilakukan 1 kali per menit (!!!) dengan mengirimkan semua data ke server (sekitar 5700 pengukuran diperoleh).  Tidur nyenyak adalah 50-an dari menit ini.  Waktu pengoperasian dalam mode tidur Modem adalah beberapa detik (pengukuran diambil dari sensor), kemudian beberapa detik dalam mode transfer data (tes menunjukkan konsumsi sekitar 50mA).  Interval waktu masih dapat disesuaikan.  Informasi lebih lanjut tentang waktu operasi dalam mode yang berbeda dapat dibaca pada tautan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> dan, karenanya, lihat sumber di git di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Sementara kami berencana untuk melakukan pengukuran setiap 2 jam dengan sejumlah kecil pengukuran di malam hari, menurut perkiraan, lebih dari 1 tahun kerja diperoleh.  Perhitungan lebih diekstrapolasi dari hasil, tetapi seperti yang Anda tahu, debit baterai memiliki bentuk yang tidak linier, pengujian yang begitu lama akan menunjukkan apa dan bagaimana. <br><br><img src="https://habrastorage.org/webt/nf/_p/9-/nf_p9-97ycd-l7s4jdyvwqgr1le.jpeg"><br>  <i>Gambar 3. Grafik dari parameter yang dikirim.</i> <br><br>  Ada empat parameter pada satu bagan - tidak terlalu nyaman untuk ditonton, tetapi untuk itu informatif.  Kegagalan adalah penggantian baterai dan menyiram bunga.  Dua puncak adalah iluminasi.  Mengisi dengan warna biru adalah kelembaban tanah.  Sejauh ini tidak ada penghalusan dan filter telah diterapkan, karena pengujian belum selesai dan saya ingin melihat data mentah.  Pada grafik yang diperluas, Anda dapat melihat bagaimana tanah dibasahi, kemudian kelembabannya stabil dan pengeringan lambat terjadi.  Kami belum memutuskan apakah perlu mempertimbangkan limpahan pabrik atau menyerahkannya kepada "pengairan". <br><br><img src="https://habrastorage.org/webt/sr/kf/a0/srkfa0wjng1k3nrlt7izr7uwvoo.jpeg"><br>  <i>Gambar 4. Foto perangkat dalam pot.</i> <br><br><img src="https://habrastorage.org/webt/rl/w6/9v/rlw69vvwutein--y4dk0s_rivxw.jpeg"><br>  <i>Gbr. 5. Foto perangkat dari sisi baterai.</i> <br><br>  Pada tata letak, sekrup digunakan untuk mengencangkan kompartemen baterai dan sensor kelembaban, ketika semuanya debugged, kami akan memasang paku keling, seperti: <br><br><img src="https://habrastorage.org/webt/cb/h4/c0/cbh4c0pjnp54rhwlgiu9nhfovzi.jpeg"><br>  <i>Gambar 6. Foto paku keling.</i> <br><br>  <b>Perumahan</b> <br><br>  Semuanya sederhana - belum ada kasus, dan mungkin, pada prinsipnya, tidak akan.  Kami akan menutup dengan pernis khusus di atas dan pergi. <br><br>  <b>Biaya penjualan</b> <br><br>  ESP-12E - 120p; <br>  CD74HC4051M96 - 14p; <br>  TPS60240DGKR - 180r; <br>  BPW17N - 21p; <br>  AM2302 - 130 gosok; <br>  KLS5-818-B - 15p; <br>  BC817 - 3p; <br>  BAT54JFILM - 3p; <br>  Pasif dan tombol - 20r; <br><br>  LED, tweeter, dan transistor pada kontrolnya saat melempar. <br><br>  Tanpa memperhitungkan papan sirkuit dan perakitan tercetak, sekitar 500 rubel diperoleh. <br><br>  Jadi katakanlah dapat diterima.  Tentu saja, jika Anda membuat perangkat seperti itu 10 pcs, maka pencetakan dan perakitan memakan sebagian besar biaya dan perangkat akan menjadi mahal, tetapi sementara kami tidak mengejar harga, kami tidak membuat batch 100k, tetapi hanya menikmati prosesnya. <br><br>  <b>Paket</b> <br><br>  Seperti disebutkan sebelumnya, pada artikel pertama, direncanakan untuk membuat keluarga sensor yang terintegrasi oleh satu aplikasi.  Saat ini ada empat perangkat: <br><br>  1. OpenWindAir.  Sensor karbon dioksida. <br>  2. LifeOfFlowers.  Kelembaban tanah dan sensor iklim mikro untuk tanaman. <br>  3. WarningWater.  Sensor kebocoran. <br>  4. AirWick_ESP.  Configurator untuk penyegar udara AirWick.  Ini mungkin lebih untuk bersenang-senang, pikirku pada awalnya.  Kenapa tidak <br><br>  Saya belum menulis apa pun tentang perangkat ini.  Saya memiliki alat seperti itu di rumah: <br><br><img src="https://habrastorage.org/webt/zn/zq/l7/znzql72zs0uggyfr1yd_o0kdoye.jpeg"><br>  <i>Gambar 7. Foto AirWick.</i> <br><br>  Dan saya benar-benar ingin membuatnya bekerja sesuai jadwal yang saya sendiri dapat atur.  Di siang hari, misalnya, hanya ketika mengunjungi kamar kecil, di malam hari, untuk tidur sama sekali, kecuali saya "sombong" di pagi hari sebelum bangun.  Saya bahkan membuat papan pada STM32F100, tetapi sesuatu tidak berhasil.  Sementara semuanya debug, mengubah ambang batas dan frekuensi operasi, semuanya tetap dalam masa pertumbuhan.  Dan kemudian sebuah ide muncul, dan mengapa tidak mengatur parameter dari telepon, terutama jika antarmuka ini sudah di-debug: <br><br>  - jumlah operasi setelah mematikan lampu (tergantung pada waktu kunjungan); <br>  - jumlah operasi di malam hari (larangan operasi saat lampu menyala); <br>  - mematikan perangkat (misalnya, saat liburan); <br>  - Yah, tentu saja, hitung seberapa sering kita pergi ke toilet dan berapa banyak waktu yang kita habiskan di sana)))).  Ketika lampu menyala, radio menyala dan kunjungan mungkin tertunda. <br><br>  Ya - ini surplus, kata Anda, disetel sekali dan lupa, tetapi tangan kami bukan untuk kebosanan, dan karena itu bayaran dibuat, yang akan saya bicarakan nanti. <br><br>  Dalam aplikasi untuk perangkat yang berbeda, Anda dapat membuat tab dengan tampilan di bawahnya data dan grafik yang terkait dengan perangkat tertentu. <br><br><img src="https://habrastorage.org/webt/sa/qj/tz/saqjtzfval1qzjdnnnmctjnhqgg.jpeg"><br>  <i>Gambar 8. Foto aplikasi dengan beberapa tab.</i> <br><br>  PS: Tautan ke artikel dari topik yang sama: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sistem Akuisisi Data di ESP.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian I. CO2</a> <br><br>  Terima kasih atas perhatian anda! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id411537/">https://habr.com/ru/post/id411537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id411525/index.html">Bagaimana musik memengaruhi kecerdasan: mitos populer dan hipotesis ilmiah</a></li>
<li><a href="../id411527/index.html">Tanyakan Ethan: Kelebihan positron - apakah layak menghubungkan materi gelap dengan solusi semua misteri astrofisika?</a></li>
<li><a href="../id411529/index.html">Memahami humor Inggris: fitur dan contoh</a></li>
<li><a href="../id411531/index.html">Cina telah mengizinkan tes robomobiles di seluruh negeri</a></li>
<li><a href="../id411533/index.html">Dari badai ke bulan. Bagian 1. Komputer pertama</a></li>
<li><a href="../id411539/index.html">Messenger dari perusahaan milik negara "Crimean Technologies" meretas dalam tiga menit</a></li>
<li><a href="../id411541/index.html">Evolusi Menyelamatkan Hewan dari Bunuh Pemenang Bencana</a></li>
<li><a href="../id411545/index.html">E-book dan formatnya: DjVu - sejarah, pro, kontra, dan fitur-fiturnya</a></li>
<li><a href="../id411547/index.html">Sony Xperia XZ2 dan Xperia XZ2 Compact adalah pemimpin dalam daya tahan baterai</a></li>
<li><a href="../id411549/index.html">Hari ini NASA akan meluncurkan perangkat baru untuk mencari planet ekstrasurya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>