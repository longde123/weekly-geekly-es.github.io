<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüî¨ üòÄ üê® Viaje al centro ... imagen del acoplador. O c√≥mo descargar una imagen del registro sin docker ü§Ωüèæ üéÉ ü§üüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="3 d√≠as antes del a√±o nuevo hubo una tarea para transferir nuestro software al cliente a trav√©s del administrador, en una unidad flash. El software es ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Viaje al centro ... imagen del acoplador. O c√≥mo descargar una imagen del registro sin docker</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484374/"><p>  3 d√≠as antes del a√±o nuevo hubo una tarea para transferir nuestro software al cliente a trav√©s del administrador, en una unidad flash.  El software es una plataforma de microservicio con docenas de im√°genes acoplables con muchas configuraciones y un gr√°fico de tim√≥n de un kil√≥metro de largo.  Lo que tuvimos </p><br><ul><li>  Gerente en Mosc√∫ (no soy de all√≠) </li><li>  Ventanas </li><li>  No hay interacci√≥n directa (y si lo fuera, realmente no ayud√≥) </li><li>  acoplador no </li></ul><br><p>  Pff, pens√©!  Tomar√© Golang, escribir√© un programa, compilar√© para Windows. <br>  ... y 5 horas despu√©s me di cuenta de la rapidez de mis conclusiones.  En ese momento, la risa de Nelson se acord√≥ por primera vez.  HA HA  Lo que me persigui√≥ todo el tiempo que pas√© estudiando el tema. <a name="habracut"></a></p><br><p>  La mayor√≠a de los ejemplos que encontr√© requieren dockerd.  Dos scripts que no usan dockerd, que se encontraron despu√©s de una hora de b√∫squeda en Google, <a href="" rel="nofollow">uno</a> y <a href="https://github.com/NotGlop/docker-drag" rel="nofollow">dos</a> .  La primera opci√≥n me ayud√≥ a comprender el proceso de obtenci√≥n de todas las capas de im√°genes y archivos de configuraci√≥n, pero es imposible usarlo con Windows.  Y la segunda opci√≥n indic√≥ que no era solo que varios hashes parpadeaban en la pantalla, espec√≠ficamente este <a href="https://github.com/NotGlop/docker-drag/blob/69b2bae59c6c0a5cbdf224feb9c067e3edcc6068/docker_pull.py" rel="nofollow">FIXME</a> .  Uno podr√≠a, por supuesto, detenerse all√≠, ¬°funciona!  Transferir para ir no es dif√≠cil.  Pero, ¬øc√≥mo verificar que las im√°genes del administrador resultaron estar en la misma forma que en nuestro registro?  Pero de ninguna manera!  Por lo tanto, acabo de subir im√°genes al almacenamiento compartido, las descargu√© con el comando Docker save y compart√≠ el enlace.  Y se calm√≥ con esto. </p><br><p>  El cuarto d√≠a de las vacaciones, bastante cansado de ellos, la idea de descargar y armar la imagen de la ventana acoplable me super√≥ nuevamente, y me sumerg√≠ en el c√≥digo <a href="https://github.com/moby/moby" rel="nofollow">Moby</a> durante un par de horas. </p><br><p>  Lo que tuve esta vez: </p><br><ul><li>  Comprender c√≥mo obtener todas las capas </li></ul><br><p>  Tomando Python "en la mano" y en base a este <a href="https://github.com/NotGlop/docker-drag" rel="nofollow">script</a> , decid√≠ arreglarlo.  El segundo d√≠a, decid√≠ escribir un gui√≥n desde cero.  Recordando mis manualidades para la autorizaci√≥n oauth, simplemente copi√© parte del c√≥digo desde all√≠, m√°s los desarrollos que ya hice cuando edit√© el script.  No hubo problemas con la autorizaci√≥n y la descarga de estos datos, pero surgieron preguntas: </p><br><ul><li>  ¬øCu√°les son los hashes que se muestran cuando se ejecuta el comando de extracci√≥n de Docker? </li><li>  ¬øCu√°les son los hashes que se usan para nombrar directorios dentro del tarball de la imagen? </li><li>  ¬øC√≥mo construir un archivo tar para que la suma de verificaci√≥n coincida con la imagen original? </li></ul><br><p> Para estudiar, eleg√≠ una imagen de ubuntu: 18.04 <br>  sha256sum imagen guardada a trav√©s de la ventana <code>docker save</code> - 257cab9137419a53359d0ed76f680fe926ed3645238357bdcdb84070a8f26cd0. </p><br><pre> <code class="plaintext hljs">&gt; docker pull ubuntu:18.04 18.04: Pulling from library/ubuntu 2746a4a261c9: Downloading [==============&gt; ] 6.909MB/26.69MB 4c1d20cdee96: Download complete 0d3160e1d0de: Download complete c8e37668deea: Download complete Digest: sha256:250cc6f3f3ffc5cdaa9d8f4946ac79821aafb4d3afc93928f0de9336eba21aa4 Status: Downloaded newer image for ubuntu:18.04 docker.io/library/ubuntu:18.04</code> </pre> <br><p>  <strong>Contenido de tarball de imagen</strong> </p><br><pre> <code class="plaintext hljs">tar tvf ubuntu.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/ -rw-r--r-- 0 root root 3 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/VERSION -rw-r--r-- 0 root root 477 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/json -rw-r--r-- 0 root root 991232 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/layer.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/ -rw-r--r-- 0 root root 3 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/VERSION -rw-r--r-- 0 root root 477 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/json -rw-r--r-- 0 root root 15872 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/layer.tar -rw-r--r-- 0 root root 3411 Dec 19 11:21 549b9b86cb8d75a2b668c21c50ee092716d070f129fd1493f95ab7e43767eab8.json drwxr-xr-x 0 root root 0 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/ -rw-r--r-- 0 root root 3 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/VERSION -rw-r--r-- 0 root root 1264 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/json -rw-r--r-- 0 root root 3072 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/layer.tar drwxr-xr-x 0 root root 0 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/ -rw-r--r-- 0 root root 3 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/VERSION -rw-r--r-- 0 root root 401 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/json -rw-r--r-- 0 root root 65571328 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/layer.tar -rw-r--r-- 0 root root 432 Jan 1 1970 manifest.json -rw-r--r-- 0 root root 88 Jan 1 1970 repositories</code> </pre> <br><p>  <strong>Config de imagen</strong> </p><br><pre> <code class="json hljs">{ ... <span class="hljs-attr"><span class="hljs-attr">"rootfs"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"layers"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"diff_ids"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"sha256:2dc9f76fb25b31e0ae9d36adce713364c682ba0d2fa70756486e5cedfaf40012"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:9f3bfcc4a1a8a676da07287a1aa6f2dcc8e869ea6f054c337593481a5bb1345e"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:27dd43ea46a831c39d224e7426794145fba953cd7309feccf4d5ea628072f6a2"</span></span>, <span class="hljs-string"><span class="hljs-string">"sha256:918efb8f161b4cbfa560e00e8e0efb737d7a8b00bf91bb77976257cd0014b765"</span></span> ] } ... }</code> </pre> <br><p>  La primera pregunta se resolvi√≥ lo suficientemente r√°pido, la documentaci√≥n <a href="" rel="nofollow">https://github.com/opencontainers/image-spec/blob/master/config.md</a> ayud√≥.  Los hash que aparecen cuando ejecuta el comando docker pull son chainIDs calculados a partir de la lista diff_ids del manifiesto de configuraci√≥n de imagen, donde el primer chainID siempre es el primero de la lista diff_ids, y los siguientes son sumas hash de la cadena <code>(chain_id[i-1] + " " + diff_id[i])</code> .  C√≥digo para construir chainID chainID: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chain_ids</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ids: list)</span></span></span><span class="hljs-function"> -&gt; list:</span></span> chain = list() chain.append(ids[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(ids) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ids nxt = list() nxt.append(<span class="hljs-string"><span class="hljs-string">"sha256:"</span></span> + hashlib.sha256(<span class="hljs-string"><span class="hljs-string">f'</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ids[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{ids[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">1</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">'</span></span>.encode()).hexdigest()) nxt.extend(ids[<span class="hljs-number"><span class="hljs-number">2</span></span>:]) chain.extend(chain_ids(nxt)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> chain</code> </pre> <br><p>  Agregar un prefijo con el nombre del algoritmo, en este caso "sha256:", es obligatorio y est√° incluido en los requisitos del est√°ndar de contenedores abiertos, es decir  la cadena debe tener la forma "algoritmo: hash". </p><br><p>  Pas√≥ dos tardes en una pregunta sobre c√≥mo nombrar un directorio.  Durante bastante tiempo, mir√© el c√≥digo fuente de docker-daemon y ¬°Oh!  un milagro!  Logr√© encontrar el c√≥digo de generaci√≥n <a href="" rel="nofollow">aqu√≠</a> y <a href="" rel="nofollow">aqu√≠</a> .  Para generar el nombre del directorio, debe calcular el hash a partir de la configuraci√≥n de la capa json.  Docker tiene varias versiones de configuraci√≥n y antes de Docker Engine 1.9, se usaban las configuraciones de la versi√≥n v1.  Apenas dicho que hecho!  Y de nuevo, surge la silueta de Nelson.  Despu√©s de una breve depuraci√≥n me di cuenta de que el problema se estaba ocultando en la generaci√≥n de json.  En Python, el orden de los datos en un diccionario puede diferir del orden de los datos en json generados a partir de este diccionario.  El orden de los datos en json ser√° diferente y, en consecuencia, su hash tambi√©n ser√° diferente.  Tuve que ir a OrderedDict, registrar previamente el orden de datos deseado en ellos.  Esto aument√≥ el tama√±o del c√≥digo una vez y media. </p><br><p>  Parece que todo est√° corregido, ejecuto el script y ... en alg√∫n lugar profundo, ¬°aparece el notorio HA-HA!  El √∫ltimo hash no coincide.  Una vez m√°s estudio el c√≥digo y <a href="" rel="nofollow">veo</a> , y esta es otra configuraci√≥n v1 que contiene toda la informaci√≥n sobre la imagen, que se puede ver usando el <code>docker inspect</code> .  Agregue otro OrderDict espec√≠ficamente para √©l, complemente el c√≥digo y ... ¬°JA, JA! <br>  Ya eran las 5 de la ma√±ana y mi cabeza realmente no pensaba, as√≠ que despu√©s de dormir volv√≠ a ver el c√≥digo.  Mirando repetidamente el c√≥digo de generaci√≥n se encontr√≥ con una <a href="" rel="nofollow">l√≠nea</a> .  Qu√© contento estaba de ver eso.  Antes de verla, hab√≠a pensamientos de construir mi docker con <del>  Gato negro y </del>  registro de datos.  Enciendo depuraci√≥n, ejecuto el <code>docker save</code> y ... no es del todo rid√≠culo, en docker-desktop para mac os hay un l√≠mite en la longitud de l√≠nea en el registro de 947 caracteres y la configuraci√≥n generada se rompe a <code>\"</code> . Despu√©s de realizar todos estos pasos en Linux, logr√© obtener la configuraci√≥n capa de la primera versi√≥n, sobre la base de la cual escrib√≠ el c√≥digo, y logr√© obtener el hash deseado de la √∫ltima capa. Los hashes para todos los archivos son los mismos, los directorios se nombran de la misma manera que la imagen original. Es hora de recopilar el archivo tar ... ¬°JAJA! </p><br><p>  El tama√±o del archivo no coincide, lea <a href="" rel="nofollow">https://github.com/opencontainers/image-spec/blob/master/layer.md</a> y el formato de <a href="https://www.gnu.org/software/tar/manual/html_node/Standard.html" rel="nofollow">archivo tar</a> .  <a href="https://github.com/python/cpython/blob/f04750bb7af45cb6efab8d92d1ff063f0bf2833d/Lib/tarfile.py" rel="nofollow">El valor predeterminado es</a> 10240 bytes, y el tama√±o del archivo que he recopilado es 9216 bytes m√°s grande.  Al principio pens√© que era necesario reducir el tama√±o del bloque a 1024 bytes, lo que result√≥ ser incorrecto y, como resultado, el tama√±o del bloque de 512 bytes igual√≥ el tama√±o de los archivos. </p><br><pre> <code class="python hljs">tarfile.RECORDSIZE = <span class="hljs-number"><span class="hljs-number">512</span></span></code> </pre> <br><p>  La primera l√≠nea del archivo reci√©n creado contiene la carpeta ra√≠z "/".  Esta opci√≥n no es adecuada, por lo tanto, complemento el c√≥digo escaneando el contenido de la carpeta y lo agrego individualmente al archivo, habi√©ndolo ordenado previamente. </p><br><p>  Finalmente, logramos lograr el mismo tama√±o de archivo, una apariencia uniforme de directorios, pero esto no es todo.  Los archivos y directorios, con la excepci√≥n de manifest.json y los repositorios, en el archivo deben tener atributos st_atime, st_mtime igual a st_ctime.  Para los archivos manifest.json y respoitories, los atributos st_atime, st_mtime y st_ctime deben estar fechados al comienzo de la era <code>1970-01-01 00:00</code> .  Todas las fechas deben establecerse seg√∫n la zona horaria, respectivamente.  Como realic√© todo el trabajo en mac os, not√© una diferencia.  Al guardar la imagen en Linux, la lista de archivos en el archivo se ve√≠a as√≠: </p><br><pre> <code class="plaintext hljs">tar tvf ubuntu.tar drwxr-xr-x 0/0 0 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/ -rw-r--r-- 0/0 3 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/VERSION -rw-r--r-- 0/0 477 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/json -rw-r--r-- 0/0 991232 Dec 19 11:21 07adecfcb06a1142a69c3e769cb38f2d4ef9d772726ce1e65bc6dbd4448cccc9/layer.tar drwxr-xr-x 0/0 0 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/ -rw-r--r-- 0/0 3 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/VERSION -rw-r--r-- 0/0 477 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/json -rw-r--r-- 0/0 15872 Dec 19 11:21 3e1d90747aa9d2a7ec6e9693bdd490dff8528b9aec4a2fac2300824e4ba3a60e/layer.tar -rw-r--r-- 0/0 3411 Dec 19 11:21 549b9b86cb8d75a2b668c21c50ee092716d070f129fd1493f95ab7e43767eab8.json drwxr-xr-x 0/0 0 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/ -rw-r--r-- 0/0 3 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/VERSION -rw-r--r-- 0/0 1264 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/json -rw-r--r-- 0/0 3072 Dec 19 11:21 b0474230e27ddbba2f46397aac85d4d2fd748064ed9c0ff1e57fec4f063fcf6b/layer.tar drwxr-xr-x 0/0 0 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/ -rw-r--r-- 0/0 3 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/VERSION -rw-r--r-- 0/0 401 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/json -rw-r--r-- 0/0 65571328 Dec 19 11:21 c8ba25f7db9f70220ac92449b238a0697f9eb580ef4f905225a333fc0a5e8719/layer.tar -rw-r--r-- 0/0 432 Jan 1 1970 manifest.json -rw-r--r-- 0/0 88 Jan 1 1970 repositories</code> </pre> <br><p>  A diferencia de la lista al principio del art√≠culo, en Linux, el archivo se guarda con el indicador de solo num√©rico.  Hay dos variables en el objeto tarinfo responsables de esto, tarinfo.uname y tarinfo.gname.  Y el segundo problema con mac os es la falta de un grupo ra√≠z, se soluciona utilizando la variable tarinfo.gid en el mismo objeto tarinfo.  Bueno, todo parece estar creando un archivo ... </p><br><p><img src="https://habrastorage.org/webt/hp/p8/pl/hpp8plcgi09ybuarim4bb5awcga.jpeg"></p><br><p>  Para todos los archivos, el hash converge, los nombres de directorios y archivos son los mismos, los atributos st_atime, st_mtime y st_ctime convergen con el original, los derechos de los archivos son exactamente los mismos.  Abrir ambos archivos en un editor hexadecimal vio una ligera diferencia: </p><br><p><img src="https://habrastorage.org/webt/qc/j6/xm/qcj6xmv9ghzaesgeaaq5owvaxnm.png"><br>  La ventana superior es la original, el archivo inferior que he recopilado. </p><br><p>  Comprender el formato tar.  Despu√©s del nombre del directorio se encuentra el valor de los derechos del archivo (rect√°ngulo naranja).  La diferencia es que la informaci√≥n sobre el objeto que se agrega al archivo no se agrega a los derechos del directorio.  Un valor de 40755 indicado en los derechos indica que este es un directorio con permisos de 755, y 100644 es un archivo con permisos de 644. El rect√°ngulo rojo es magic-string y, a juzgar por el c√≥digo <code>ustar\000</code> , magic-string <code>ustar\000</code> , solo se usa en formatos PAX y USTAR.  El formato PAX no se ajusta en absoluto, utiliza un tipo especial de encabezado.  El rect√°ngulo azul es una suma de verificaci√≥n y difiere debido al uso de diferentes formatos para escribir derechos en un archivo y encabezado m√°gico. </p><br><p>  Cambio el formato de archivo a USTAR, pero no est√° claro qu√© hacer con los permisos de grabaci√≥n de archivos.  Aqu√≠ y <a href="https://github.com/python/cpython/blob/f04750bb7af45cb6efab8d92d1ff063f0bf2833d/Lib/tarfile.py" rel="nofollow">aqu√≠</a> est√° ocurriendo la magia para m√≠, nunca he trabajado con el sistema octal y no entiendo por qu√© se necesita el ampersand aqu√≠ (tal vez alguien en los comentarios compartir√° conocimientos).  Tuve que agregar varias impresiones para ver qu√© datos llegan con argumentos y qu√© datos se utilizan para formar el bloque de archivo.  Tomando un n√∫mero entero de la segunda posici√≥n del bloque de datos, era 16877, y llev√°ndolo al c√°lculo octal, result√≥ que este valor es <code>0o40755</code> , que es <code>0o40755</code> lo que necesito.  Simplemente anulando las funciones get_info y _create_header, eliminando <code>&amp; 0o7777</code> de ellas (no se me ocurri√≥ nada m√°s), logr√© recopilar un archivo tar con un hash sha256 que coincid√≠a con el original. </p><br><p>  PD Mientras escrib√≠a un art√≠culo, la imagen de ubuntu se actualiz√≥: 18.04 en hub.docker.com.  As√≠ que tuve que descargar la imagen en Digest.  Las cantidades de hash ya no coinciden con el original debido al hecho de que Digest se escribi√≥ en lugar de la etiqueta, de lo contrario, eran im√°genes id√©nticas. </p><br><p>  El segundo descubrimiento para m√≠ fue la ausencia de un archivo de repositorios en el archivo al guardar una imagen con una etiqueta faltante usando el <code>docker save</code> . </p><br><p>  C√≥digo de trabajo completo aqu√≠: <a href="https://github.com/myback/docker_pull" rel="nofollow">https://github.com/myback/docker_pull</a> </p><br><p>  Imagen de Nelson Manz, as√≠ como su risa "HA-HA" es propiedad de FOX :) </p></div></div><p>Source: <a href="https://habr.com/ru/post/484374/">https://habr.com/ru/post/484374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484358/index.html">Gesti√≥n de cartera en R</a></li>
<li><a href="../484364/index.html">A los 26 a√±os, Yana Harlan lidera el desarrollo de un motor espacial. El a√±o que viene planean lanzarlo.</a></li>
<li><a href="../484368/index.html">C√≥mo hice un motor de b√∫squeda para Telegram</a></li>
<li><a href="../484370/index.html">Slurm SRE: aprenda a garantizar la felicidad del usuario</a></li>
<li><a href="../484372/index.html">Casa inteligente con Xiaomi en el ejemplo de una sauna</a></li>
<li><a href="../484376/index.html">Samsung Moscow Center for Artificial Intelligence en historias de empleados</a></li>
<li><a href="../484378/index.html">SwayWM - UnixPorn usted mismo</a></li>
<li><a href="../484380/index.html">Mudanza - el siglo pasado! Alternativas a std :: mover en "C ++ del futuro"</a></li>
<li><a href="../484382/index.html">Algoritmo de Bellman-Ford</a></li>
<li><a href="../484386/index.html">AWS_Ru Meetup en Raiffeisenbank</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>