<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìõ üîπ üì∂ Problemas de padr√£o do coordenador e o que o RouteComposer tem a ver com isso üèáüèΩ ‚öõÔ∏è üë©‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuo a s√©rie de artigos sobre a biblioteca RouteComposer que usamos e hoje quero falar sobre o padr√£o do Coordenador. Fui solicitado a escrever es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Problemas de padr√£o do coordenador e o que o RouteComposer tem a ver com isso</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446550/"><p>  Continuo a s√©rie de artigos sobre a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RouteComposer</a> que usamos e hoje quero falar sobre o padr√£o do Coordenador.  Fui solicitado a escrever este artigo discutindo um dos artigos sobre o padr√£o, o coordenador aqui em Habr√©. </p><br><p>  O padr√£o Coordenador, apresentado h√° n√£o muito tempo, est√° ganhando cada vez mais popularidade entre os desenvolvedores de iOS e, em geral, √© claro o porqu√™.  Porque as ferramentas <strong>prontas para uso</strong> fornecidas pelo <strong>UIKit</strong> n√£o s√£o uma bagun√ßa universal. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/304/47d/bd8/30447dbd8d2a0a39a34f7f6946a02383.png" alt="imagem"></p><a name="habracut"></a><br><p>  Eu j√° levantei a quest√£o da fragmenta√ß√£o da maneira como componho a vis√£o dos controladores na pilha e, para evitar repeti√ß√µes, basta ler sobre isso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p> Sejamos honestos.  Em algum momento, Epole percebeu que, ao colocar os controladores no centro de desenvolvimento de aplicativos, ela n√£o ofereceu nenhuma maneira sensata de criar ou transferir dados entre eles e, depois de confiar a solu√ß√£o para esse problema aos desenvolvedores, ele foi preenchido automaticamente pelo Xcode e, talvez, pelos desenvolvedores do UISearchConnroller, em algum momento, introduziu storyboards e segues para n√≥s.  Ent√£o, Epolus percebeu que ela escrevia aplicativos que consistiam em apenas duas telas e, na itera√ß√£o seguinte, sugeriu a possibilidade de dividir os storyboards em v√°rios componentes, j√° que o Xcode come√ßou a falhar quando o storyboard atingiu um determinado tamanho.  Os segmentos mudaram junto com esse conceito, em v√°rias itera√ß√µes que n√£o s√£o muito compat√≠veis entre si.  O apoio deles √© fortemente costurado na enorme classe <code>UIViewController</code> e, no final, conseguimos o que conseguimos.  Aqui est√°: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> segue: UIStoryboardSegue, sender: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> segue.identifier == <span class="hljs-string"><span class="hljs-string">"showDetail"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> indexPath = tableView.indexPathForSelectedRow { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object = objects[indexPath.row] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">NSDate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> controller = (segue.destination <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span>).topViewController <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">DetailViewController</span></span> controller.detailItem = object controller.navigationItem.leftBarButtonItem = splitViewController?.displayModeButtonItem controller.navigationItem.leftItemsSupplementBackButton = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } }</code> </pre> <br><p>  O n√∫mero de transmiss√µes de for√ßa neste bloco de c√≥digo √© incr√≠vel, assim como as constantes de sequ√™ncia nos pr√≥prios storyboards, para rastrear quais Xcode n√£o oferece nenhum meio.  E o menor desejo de mudar alguma coisa no processo de navega√ß√£o permitir√° que voc√™ compile o projeto sem nenhum esfor√ßo e ele trava com um estrondo no tempo de execu√ß√£o sem o menor aviso do Xcode.  Aqui est√° um WYSIWYG no final, acabou.  O que voc√™ v√™ √© o que voc√™ recebe. </p><br><p>  Voc√™ pode discutir por um longo tempo sobre os encantos dessas setas cinza nos storyboards supostamente mostrando a algu√©m as conex√µes entre as telas, mas, como minha pr√°tica demonstrou, entrevistei intencionalmente v√°rios desenvolvedores familiares de empresas diferentes, assim que o projeto cresceu al√©m das 5-6 telas, as pessoas tentaram encontre uma solu√ß√£o mais confi√°vel e, finalmente, comecei a manter a estrutura da pilha de controladores de exibi√ß√£o em minha cabe√ßa.  E se o suporte ao iPad e outros modelos de navega√ß√£o ou o suporte a push fossem adicionados, tudo ficaria triste por l√°. </p><br><p>  Desde ent√£o, v√°rias tentativas foram feitas para resolver esse problema, algumas das quais resultaram em estruturas separadas, outras em padr√µes arquiteturais separados, desde que a cria√ß√£o de controladores de exibi√ß√£o dentro do controlador de exibi√ß√£o tornou esse c√≥digo maci√ßo e desajeitado ainda mais. </p><br><p>  Vamos voltar ao padr√£o Coordenador.  Por raz√µes √≥bvias, voc√™ n√£o encontrar√° sua descri√ß√£o na Wikipedia porque n√£o √© um padr√£o de programa√ß√£o / design padr√£o.  Em vez disso, √© um tipo de abstra√ß√£o, que sugere ocultar todo esse c√≥digo "feio" para criar e inserir uma nova tor√ß√£o do controlador na pilha, salvando links no cont√™iner do controlador e enviando dados entre os controladores.  O artigo mais adequado que descreve esse processo eu chamaria de artigo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">raywenderlich.com</a> .  Come√ßa a se tornar popular ap√≥s a confer√™ncia NSSpain de 2015, quando o p√∫blico em geral foi informado sobre isso.  Mais detalhadamente, o que foi dito pode ser encontrado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  Descreverei brevemente em que consiste antes de prosseguir. </p><br><p>  O padr√£o Coordenador em todas as interpreta√ß√µes se encaixa aproximadamente nesta figura: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/554/4bb/f95/5544bbf95415d233060a7e4d515ff58d.png"></p><br><p>  Ou seja, o coordenador √© um protocolo </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> }</code> </pre> <br><p>  E todo o c√≥digo feio deve estar oculto na fun√ß√£o <code>start</code> .  Al√©m disso, o coordenador pode ter links para coordenadores filhos, ou seja, eles t√™m alguma capacidade de composi√ß√£o e, por exemplo, voc√™ pode substituir uma implementa√ß√£o por outra.  Ou seja, parece muito elegante. </p><br><p>  No entanto, as inanidades come√ßam muito em breve: </p><br><ol><li>  Algumas implementa√ß√µes prop√µem transformar o Coordenador de um determinado padr√£o de gera√ß√£o em algo mais razo√°vel, observando a pilha de controladores e <em>torn√°-lo um delegado do cont√™iner</em> , por exemplo, <code>UINavigationController</code> , para processar clicando no bot√£o Voltar ou deslizar para tr√°s e excluir o coordenador filho.  Por raz√µes naturais, apenas um objeto pode ser um delegado, o que limita o controle do cont√™iner e leva ao fato de que essa l√≥gica fica com o coordenador ou cria a necessidade de delegar essa l√≥gica ainda mais a algu√©m mais abaixo na lista. </li><li>  Frequentemente, a l√≥gica para criar o pr√≥ximo controlador <em>depende da l√≥gica de neg√≥cios</em> .  Por exemplo, para ir para a pr√≥xima tela, o usu√°rio deve estar conectado ao sistema.  Claramente, este √© um processo ass√≠ncrono, que inclui a gera√ß√£o de uma tela intermedi√°ria com o formul√°rio de login, o pr√≥prio processo de login pode terminar com √™xito ou n√£o.  Para evitar a transforma√ß√£o do coordenador em um coordenador maci√ßo (semelhante ao controlador de visualiza√ß√£o maci√ßa), precisamos de decomposi√ß√£o.  Na verdade, voc√™ precisa criar um Coordenador Coordenador. </li><li>  Outro problema enfrentado pelos coordenadores √© que eles s√£o essencialmente inv√≥lucros para controladores de exibi√ß√£o de cont√™iner, como <code>UINavigationController</code> , <code>UITabBarController</code> e assim por diante.  E algu√©m deve fornecer <em>links para esses controladores</em> .  Se com os coordenadores filhos tudo fica ainda menos claro, com os coordenadores iniciais da cadeia, nem tudo √© t√£o simples.  Al√©m disso, ao alterar a navega√ß√£o, por exemplo, para o teste A / B, a refatora√ß√£o e adapta√ß√£o de tais coordenadores resulta em uma dor de cabe√ßa separada.  Especialmente se o tipo de cont√™iner mudar. </li><li>  Tudo isso se torna ainda mais complicado quando o aplicativo come√ßa a suportar <em>eventos externos</em> que geram controladores de exibi√ß√£o.  Como notifica√ß√µes por push ou links universais (o usu√°rio clica no link na carta e continua na tela do aplicativo correspondente).  Aqui surgem outras incertezas para as quais o padr√£o do Coordenador n√£o tem uma resposta exata.  Voc√™ precisa saber exatamente em qual tela o usu√°rio est√° atualmente para mostrar a ele a pr√≥xima tela solicitada por um evento externo. <br>  O exemplo mais simples √© um aplicativo de bate-papo composto por tr√™s telas - uma lista de bate-papo, o pr√≥prio bate-papo que √© empurrado para a navega√ß√£o do controlador da lista de bate-papo e a tela de configura√ß√µes exibida de forma modal.  O usu√°rio pode estar em uma dessas telas quando recebe uma notifica√ß√£o por push e toca nela.  E aqui come√ßa a incerteza, se ele estiver na lista de bate-papo, voc√™ precisar√° iniciar um bate-papo com esse usu√°rio espec√≠fico, se ele j√° estiver no bate-papo, ser√° necess√°rio troc√°-lo e, se ele j√° estiver no bate-papo com esse usu√°rio, n√£o fa√ßa nada e atualize, se o usu√°rio estiver ligado tela de configura√ß√µes - aparentemente, voc√™ precisa fechar e seguir as etapas anteriores.  Ou talvez n√£o feche e mostre apenas o bate-papo sobre as configura√ß√µes?  E se as configura√ß√µes est√£o em outra guia, e n√£o modal?  Esses <code>if/else</code> come√ßam a se espalhar pelos coordenadores ou a outro mega-coordenador na forma de um espaguete.  Al√©m disso, s√£o itera√ß√µes ativas na pilha de visualiza√ß√µes dos controladores e uma tentativa de determinar onde o usu√°rio est√° no momento, ou uma tentativa de criar algum tipo de aplicativo que monitora seu estado, mas essa n√£o √© uma tarefa f√°cil, apenas com base na natureza das pr√≥prias controladoras de exibi√ß√£o. </li><li>  E a cereja no bolo s√£o as <em>falhas do UIKit</em> .  Um exemplo trivial: um <code>UITabBarController</code> com um <code>UINavigationController</code> na segunda guia com algum outro <code>UIViewController</code> .  O usu√°rio na primeira guia causa um determinado evento que requer alternar a guia e <code>UINavigationController</code> outro controlador de exibi√ß√£o para o seu <code>UINavigationController</code> .  Tudo isso precisa ser feito exatamente nessa sequ√™ncia.  Se o usu√°rio nunca abriu a segunda guia antes disso e o <code>UINavigationController</code> n√£o <code>UINavigationController</code> chamado no <code>viewDidLoad</code> o m√©todo <code>push</code> n√£o funcionar√° deixando apenas uma mensagem indistinta no console.  Ou seja, os coordenadores n√£o podem simplesmente ser ouvintes de eventos neste exemplo; eles devem trabalhar em uma determinada sequ√™ncia.  Ent√£o eles devem ter conhecimento um do outro.  E isso j√° contradiz a primeira afirma√ß√£o do padr√£o Coordenador, de que os coordenadores n√£o sabem nada sobre os coordenadores geradores e est√£o conectados apenas aos filhos.  E tamb√©m limita sua permutabilidade. </li></ol><br><p>  Essa lista pode ser continuada, mas, em geral, √© claro que o padr√£o do Coordenador √© uma solu√ß√£o bastante limitada e pouco escal√°vel.  Se voc√™ olhar sem √≥culos cor de rosa, √© uma maneira de decompor parte da l√≥gica, que geralmente √© escrita dentro de <code>UIViewController</code> maci√ßos, em outra classe.  Todas as tentativas de torn√°-lo mais do que apenas uma f√°brica generativa e introduzir outra l√≥gica n√£o terminam bem. </p><br><p>  Vale ressaltar que existem bibliotecas baseadas nesse padr√£o que, de uma maneira ou de outra, permitem mitigar parcialmente as desvantagens acima.  Eu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mencionaria o XCoordinator</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RxFlow</a> . </p><br><h2 id="chto-sdelali-my">  O que fizemos? </h2><br><p>  Tendo participado do projeto que recebemos de outra equipe de suporte e desenvolvimento, com os coordenadores e seu <em>roteador</em> "bisav√≥" simplificado na abordagem arquitet√¥nica <em>VIPER</em> , voltamos √† abordagem que funcionou bem no grande projeto anterior de nossa empresa.  Essa abordagem n√£o tem um nome.  Est√° na superf√≠cie.  Quando t√≠nhamos tempo livre, ele foi compilado em uma biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RouteComposer</a> separada, que substituiu completamente os coordenadores e provou ser mais flex√≠vel. </p><br><p>  Qual √© essa abordagem?  Nisso, para confiar na pilha (√°rvore), tor√ßo os controladores como est√£o.  Para n√£o criar entidades desnecess√°rias que precisam ser monitoradas.  N√£o salve ou rastreie as condi√ß√µes. </p><br><p>  Vamos examinar <em>mais de</em> perto as entidades do <em>UIKit</em> e tentar descobrir o que temos na linha de fundo e com o que podemos trabalhar: </p><br><ol><li>  <strong>A pilha do controlador</strong> √© uma √°rvore.  H√° um controlador de exibi√ß√£o raiz que possui controladores de exibi√ß√£o filho.  Os controladores de exibi√ß√£o apresentados modalmente s√£o um caso especial de controladores de exibi√ß√£o filho, pois eles tamb√©m t√™m uma liga√ß√£o com o controlador de exibi√ß√£o gerado.  Est√° tudo dispon√≠vel imediatamente. </li><li>  Eu preciso criar entidades de controladores.  Todos eles t√™m construtores diferentes e podem ser criados usando arquivos Xib ou Storyboards.  Eles t√™m diferentes par√¢metros de entrada.  Mas eles est√£o unidos porque precisam ser criados.  Ent√£o, aqui podemos usar o padr√£o de <strong>f√°brica</strong> , que sabe como criar o controlador de exibi√ß√£o desejado.  Cada f√°brica √© f√°cil de cobrir com testes de unidade abrangentes e √© independente de outras. </li><li>  Dividimos os controladores de exibi√ß√£o em 2 classes: 1. Basta visualizar os controladores, 2. <strong>Controladores de exibi√ß√£o de cont√™iner (Controller View Controller)</strong> .  Os controladores de exibi√ß√£o de cont√™iner diferem dos comuns, pois podem conter controladores de exibi√ß√£o filho - tamb√©m cont√™ineres ou simples.  Esses controladores de exibi√ß√£o est√£o dispon√≠veis <code>UINavigationController</code> : <code>UINavigationController</code> , <code>UITabBarController</code> e assim por diante, mas tamb√©m podem ser criados pelo usu√°rio.  Se ignor√°-lo, podemos encontrar as seguintes propriedades em todos os cont√™ineres: 1. Eles t√™m uma lista de todos os controladores que eles cont√™m.  2. Um ou mais controladores est√£o atualmente vis√≠veis.  3. Eles podem ser solicitados a tornar um desses controladores vis√≠veis.  Isso √© tudo o que os controladores <em>UIKit</em> podem <em>fazer</em> .  Eles apenas t√™m m√©todos diferentes para isso.  Mas existem apenas 3 tarefas. </li><li>  Para incorporar um controlador de exibi√ß√£o criado de f√°brica, o m√©todo de exibi√ß√£o pai do controlador √© <code>UINavigationController.pushViewController(...)</code> , <code>UITabBarController.selectedViewController = ...</code> , <code>UIViewController.present(...)</code> e assim por diante.  Voc√™ pode observar que 2 controladores de exibi√ß√£o s√£o sempre necess√°rios, um j√° na pilha e um que precisa ser incorporado na pilha.  Enrole isso em um inv√≥lucro e chame-o de <strong>A√ß√£o (A√ß√£o)</strong> .  Cada a√ß√£o √© f√°cil de cobrir com testes de unidade abrangentes e cada um √© independente dos outros. </li><li>  Do exposto acima, verifica-se que, usando entidades preparadas, voc√™ pode construir uma cadeia de configura√ß√£o <em>F√°brica -&gt; A√ß√£o -&gt; F√°brica -&gt; A√ß√£o -&gt; F√°brica</em> e <em>,</em> ap√≥s concluir, pode criar uma √°rvore de visualiza√ß√£o de controladores de qualquer complexidade.  Voc√™ s√≥ precisa especificar o ponto de entrada.  Esses pontos de entrada geralmente s√£o o <em>rootViewController de</em> propriedade do <em>UIWindow</em> ou o atual controlador de exibi√ß√£o, que √© o ramo mais extremo da √°rvore.  Ou seja, essa configura√ß√£o est√° escrita corretamente como: <strong>Iniciando o ViewController -&gt; Action -&gt; Factory -&gt; ... -&gt; Factory</strong> . </li><li>  Al√©m da configura√ß√£o, voc√™ precisar√° de alguma entidade que saiba como iniciar e criar a configura√ß√£o fornecida.  Vamos cham√°-lo de <strong>roteador</strong> .  N√£o possui um estado, n√£o possui nenhum link.  Possui um m√©todo para o qual a configura√ß√£o √© passada e executa sequencialmente as etapas de configura√ß√£o. </li><li>  Adicione responsabilidade ao roteador adicionando classes <strong>Interceptors</strong> √† cadeia de configura√ß√£o.  √â poss√≠vel interceptar tr√™s tipos: 1. Lan√ßado antes de iniciar a navega√ß√£o.  Removemos as tarefas de autentica√ß√£o do usu√°rio no sistema e outras tarefas ass√≠ncronas neles.  2. Execute no momento da cria√ß√£o do controlador de exibi√ß√£o para definir os valores.  3. Realizado ap√≥s a navega√ß√£o e executando v√°rias tarefas anal√≠ticas.  Cada entidade √© facilmente coberta por testes de unidade e n√£o sabe como ser√° usada na configura√ß√£o.  Ela tem apenas uma responsabilidade e a cumpre.  Ou seja, a configura√ß√£o para navega√ß√£o complexa pode se parecer com <strong>[Tarefa de pr√©-navega√ß√£o ...] -&gt; Iniciando o ViewController -&gt; A√ß√£o -&gt; (Factory + [ContextTask ...]) -&gt; ... -&gt; (Factory + [ContextTask ...]) -&gt; [Post NavigationTask ...]</strong>  Ou seja, todas as tarefas ser√£o executadas pelo roteador sequencialmente, executando, por sua vez, entidades at√¥micas pequenas e de f√°cil leitura. </li><li>  A √∫ltima tarefa que n√£o pode ser resolvida pela configura√ß√£o permanece - este √© o estado do aplicativo no momento.  E se precisarmos construir n√£o toda a cadeia de configura√ß√£o, mas apenas parte dela, porque o usu√°rio a passou parcialmente?  Essa pergunta sempre pode ser respondida sem ambiguidade pelos controladores da √°rvore de vis√£o.  Porque se parte da cadeia j√° estiver constru√≠da, ela j√° estar√° na √°rvore.  Isso significa que, se cada f√°brica da cadeia puder responder √† quest√£o de ser constru√≠da ou n√£o, o roteador poder√° entender qual parte da cadeia precisa ser conclu√≠da.  Obviamente, essa n√£o √© uma tarefa da f√°brica; portanto, √© introduzida outra entidade at√¥mica - o <strong>Finder,</strong> e qualquer configura√ß√£o √© semelhante a esta: <strong>[Tarefa de pr√©-navega√ß√£o ...] -&gt; Iniciando o ViewController -&gt; A√ß√£o -&gt; (Finder / Factory + [ContextTask ...]) -&gt; ... -&gt; (Localizador / F√°brica + [ContextTask ...]) -&gt; [Post NavigationTask ...]</strong> .  Se o roteador come√ßar a l√™-lo a partir do final, um dos Localizadores dir√° que ele j√° foi constru√≠do, e o roteador a partir deste ponto come√ßar√° a reconstruir a cadeia.  Se nenhum deles se encontrar na √°rvore, ser√° necess√°rio construir a cadeia inteira a partir do controlador inicial. <br><img src="https://habrastorage.org/getpro/habr/post_images/f50/a64/213/f50a64213fa1654fbde33e53b31f4e43.gif" alt="imagem"></li><li>  A configura√ß√£o deve ser fortemente digitada.  Portanto, cada entidade trabalha com apenas um tipo de visualiza√ß√£o do controlador; um tipo de dados e configura√ß√£o depende inteiramente da capacidade do Swift de trabalhar com tipos <strong>associados</strong> .  Queremos confiar no compilador, n√£o no tempo de execu√ß√£o.  Um desenvolvedor pode intencionalmente enfraquecer a digita√ß√£o, mas n√£o o contr√°rio. </li></ol><br><p>  Um exemplo dessa configura√ß√£o: </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> productScreen = <span class="hljs-type"><span class="hljs-type">StepAssembly</span></span>(finder: <span class="hljs-type"><span class="hljs-type">ProductViewControllerFinder</span></span>(), factory: <span class="hljs-type"><span class="hljs-type">ProductViewControllerFactory</span></span>()) .add(<span class="hljs-type"><span class="hljs-type">LoginInterceptor</span></span>&lt;<span class="hljs-type"><span class="hljs-type">UUID</span></span>&gt;()) <span class="hljs-comment"><span class="hljs-comment">// Have to specify the context type till https://bugs.swift.org/browse/SR-8719 is fixed .add(ProductViewControllerContextTask()) .add(ProductViewControllerPostTask(analyticsManager: AnalyticsManager.sharedInstance)) .using(UINavigationController.push()) .from(NavigationControllerStep()) .using(GeneralActions.presentModally()) .from(GeneralStep.current()) .assemble()</span></span></code> </pre> <br><p>  Os itens descritos acima cobrem toda a biblioteca e descrevem a abordagem.  Tudo o que resta para n√≥s √© fornecer as configura√ß√µes de cadeia que o roteador executar√° quando o usu√°rio clicar em um bot√£o ou ocorrer um evento externo.  Se houver tipos diferentes de dispositivos, por exemplo, iPhone ou iPad, forneceremos diferentes configura√ß√µes de transi√ß√£o usando o polimorfismo.  Se tivermos testes A / B, a mesma coisa.  N√£o precisamos pensar no estado do aplicativo no momento de iniciar a navega√ß√£o, precisamos garantir que a configura√ß√£o seja escrita corretamente inicialmente e temos certeza de que o roteador a construir√° de alguma forma. </p><br><p>  A abordagem descrita √© mais complicada do que uma certa abstra√ß√£o ou padr√£o, mas ainda n√£o enfrentamos o problema em que n√£o seria suficiente.  Obviamente, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RouteComposer</a> requer algum estudo e entendimento de como funciona.  No entanto, isso √© muito mais f√°cil do que aprender o b√°sico do AutoLayout ou RunLoop.  Sem matem√°tica mais alta. </p><br><p>  A biblioteca, assim como a implementa√ß√£o do roteador fornecido, n√£o usa truques objetivos com o tempo de execu√ß√£o e segue totalmente todos os conceitos do Cocoa Touch, apenas ajudando a dividir o processo de composi√ß√£o em etapas e execut√°-los na sequ√™ncia especificada.  A biblioteca √© testada nas vers√µes 9 a 12 do iOS. </p><br><p>  Mais detalhes podem ser encontrados em artigos anteriores: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Composi√ß√£o dos controladores UIViewControllers e navega√ß√£o entre eles (e n√£o apenas) / revista geek</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Exemplos de configura√ß√£o de UIViewControllers usando o RouteComposer / geek magazine</a> </p><br><p>  Obrigado pela aten√ß√£o.  Ficarei feliz em responder perguntas nos coment√°rios. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt446550/">https://habr.com/ru/post/pt446550/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt446536/index.html">Filas e JMeter: Exchange com Publicador e Assinante</a></li>
<li><a href="../pt446538/index.html">O PhotoGuru mudou para o "lado sombrio" e o "mais s√°bio"</a></li>
<li><a href="../pt446544/index.html">Microsoft expande o Azure IP Advantage Program com novos benef√≠cios de IP para inovadores e startups de IoT do Azure</a></li>
<li><a href="../pt446546/index.html">A Microsoft estende a vantagem de IP do Azure com novos benef√≠cios de IP para inovadores e inicializa√ß√µes da IoT do Azure</a></li>
<li><a href="../pt446548/index.html">An√°lise de estat√≠sticas sobre campanhas publicit√°rias - crie uma nova m√©trica no DataFrame (python)</a></li>
<li><a href="../pt446552/index.html">Trabalhando com comandos APDU usando o exemplo EToken</a></li>
<li><a href="../pt446554/index.html">Programa residente Yandex ou Como um back-end experiente se tornar um engenheiro de ML</a></li>
<li><a href="../pt446558/index.html">Estruturas de dados ex√≥ticas: Merkle modificado Patricia Trie</a></li>
<li><a href="../pt446560/index.html">"Courtesy Exchange": a ess√™ncia do conflito entre as duas mais famosas empresas de streaming</a></li>
<li><a href="../pt446562/index.html">Assincronia na programa√ß√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>