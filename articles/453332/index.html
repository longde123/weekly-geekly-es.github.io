<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úåüèæ üïç üò≤ Sobre el extra√±o m√©todo de ahorrar espacio en el disco duro ü§ôüèª üë©‚Äçüöí ü§ûüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Otro usuario quiere escribir una nueva pieza de datos en el disco duro, pero no tiene suficiente espacio libre para esto. Tampoco quiero eliminar nada...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sobre el extra√±o m√©todo de ahorrar espacio en el disco duro</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453332/"><p>  Otro usuario quiere escribir una nueva pieza de datos en el disco duro, pero no tiene suficiente espacio libre para esto.  Tampoco quiero eliminar nada, ya que "todo es muy importante y necesario".  ¬øY qu√© haremos con √©l? </p><br><p>  No tiene tal problema.  Terabytes de informaci√≥n descansan en nuestros discos duros, y esta cantidad no tiende a disminuir.  ¬øPero qu√© tan √∫nico es?  Al final, despu√©s de todo, todos los archivos son solo conjuntos de bits de cierta longitud y, lo m√°s probable, el nuevo no es muy diferente del que ya est√° almacenado. </p><br><p> Est√° claro que buscar piezas de informaci√≥n ya almacenadas en el disco duro es una tarea, si no una falla, entonces al menos no una efectiva.  Por otro lado, porque si la diferencia es peque√±a, entonces puede caber un poco ... </p><br><p><img src="https://habrastorage.org/webt/sp/ho/gl/sphoglurqinhyzqmkyvbrgkox0y.jpeg" alt="Imagen de rematelier.ru"></p><br><p>  TL; DR: el segundo intento de hablar sobre un m√©todo extra√±o de optimizaci√≥n de datos utilizando archivos JPEG, ahora en una forma m√°s comprensible. </p><a name="habracut"></a><br><h2 id="o-bitah-i-raznice">  Sobre bits y diferencia </h2><br><p>  Si tomamos dos datos completamente al azar, entonces, en promedio, la mitad de los bits contenidos coinciden en ellos.  De hecho, entre los dise√±os posibles para cada par ('00, 01, 10, 11 '), exactamente la mitad tiene los mismos valores, todo es simple aqu√≠. </p><br><p>  Pero, por supuesto, si solo tomamos dos archivos y ajustamos uno debajo del segundo, perderemos uno de ellos.  Si mantenemos los cambios, simplemente reinventaremos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">codificaci√≥n delta</a> , que incluso sin nosotros existe perfectamente, aunque generalmente no se usa con el mismo prop√≥sito.  Puede intentar incrustar una secuencia m√°s peque√±a en una m√°s grande, pero aun as√≠, corremos el riesgo de perder segmentos de datos cr√≠ticos cuando se usan precipitadamente con todo. </p><br><p>  ¬øEntre qu√© y qu√© puede eliminarse la diferencia?  Bueno, es decir, un nuevo archivo grabado por el usuario es solo una secuencia de bits con los que no podemos hacer nada por s√≠ mismos.  Luego, solo necesita encontrar esos bits en el disco duro para que puedan cambiarse sin tener que almacenar la diferencia, para que pueda sobrevivir a su p√©rdida sin consecuencias graves.  S√≠, y tiene sentido cambiar no solo el archivo en s√≠ en el FS, sino tambi√©n alguna informaci√≥n menos confidencial dentro de √©l.  ¬øPero cu√°l y c√≥mo? </p><br><h3 id="metody-podgonki">  M√©todos de ajuste </h3><br><p>  Los archivos comprimidos con p√©rdida vienen al rescate.  Todos estos archivos JPEG, MP3 y otros, aunque son de compresi√≥n con p√©rdida, contienen un mont√≥n de bits disponibles para un cambio seguro.  Puede utilizar t√©cnicas avanzadas, modificando discretamente sus componentes en diferentes √°reas de codificaci√≥n.  Espera un momento  T√©cnicas avanzadas ... modificaci√≥n discreta ... algunos bits para otros ... s√≠, ¬°es casi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esteganograf√≠a</a> ! </p><br><p>  De hecho, incrustar una informaci√≥n en otra se parece a sus m√©todos sin importar qu√©.  Tambi√©n impresiona la invisibilidad de los cambios realizados en los sentidos humanos.  Ah√≠ es donde los caminos divergen: es un secreto: nuestra tarea es agregar informaci√≥n adicional al disco duro del usuario, solo lo da√±ar√°.  Olvida m√°s. </p><br><p>  Por lo tanto, aunque podemos usarlos, necesitamos hacer algunas modificaciones.  Y luego les contar√© y mostrar√© el ejemplo de uno de los m√©todos existentes y el formato de archivo com√∫n. </p><br><h2 id="o-shakalah">  Sobre los chacales </h2><br><p>  Si comprimes, entonces el m√°s compresible del mundo.  Estamos, por supuesto, hablando de archivos JPEG.  No solo hay un mont√≥n de herramientas y m√©todos existentes para incrustar datos en √©l, es el formato gr√°fico m√°s popular en este planeta. </p><br><p><img src="https://habrastorage.org/storage/a555b701/12995be3/c44b46cd/8787f59d.png" alt="JPEG !!!"></p><br><p>  Sin embargo, para no participar en la cr√≠a de perros, debe limitar su campo de actividad en archivos de este formato.  A nadie le gustan los cuadrados monocromos que surgen debido a una compresi√≥n excesiva, por lo que debe limitarse a trabajar con un archivo ya comprimido, <strong>evitando la transcodificaci√≥n</strong> .  M√°s espec√≠ficamente, con coeficientes enteros que quedan despu√©s de las operaciones responsables de la p√©rdida de datos: DCT y cuantizaci√≥n, que se muestra perfectamente en el esquema de codificaci√≥n (gracias a la wiki de la Biblioteca Nacional de Bauman): <br><img src="https://habrastorage.org/webt/jj/zi/j8/jjzij8i5sln2tlbnyk6yibzbcb8.jpeg" alt="Codificaci√≥n JPEG"></p><br><p>  Existen muchos m√©todos de optimizaci√≥n posibles para archivos jpeg.  Hay una optimizaci√≥n sin p√©rdidas (jpegtran), hay una optimizaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sin p√©rdidas</a> , que de hecho todav√≠a contribuyen, pero no nos molestan.  De hecho, si un usuario est√° listo para incrustar una informaci√≥n en otra en aras de aumentar el espacio libre en el disco, entonces o bien optimiz√≥ sus im√°genes durante mucho tiempo o no quiere hacerlo en absoluto por temor a la p√©rdida de calidad. </p><br><h2 id="f5">  F5 </h2><br><p>  En tales condiciones, es adecuada una familia completa de algoritmos, que se pueden encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en esta buena presentaci√≥n</a> .  El m√°s avanzado de ellos es el algoritmo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">F5</a> , creado por Andreas Westfeld, que trabaja con los coeficientes del componente de brillo, ya que el ojo humano es el menos sensible a sus cambios.  Adem√°s, utiliza una t√©cnica de incrustaci√≥n basada en la codificaci√≥n matricial, que le permite a uno hacer menos cambios al incrustar la misma cantidad de informaci√≥n, cuanto mayor sea el tama√±o del contenedor utilizado. </p><br><p>  Los cambios en s√≠ mismos se reducen a una disminuci√≥n en el valor absoluto de los coeficientes por unidad bajo ciertas condiciones (es decir, no siempre), lo que hace posible utilizar F5 para optimizar el almacenamiento de datos en el disco duro.  El hecho es que es probable que el coeficiente despu√©s de tal cambio ocupe un n√∫mero menor de bits despu√©s de la codificaci√≥n Huffman debido a la distribuci√≥n estad√≠stica de valores en JPEG, y los nuevos ceros se beneficiar√°n al codificarlos usando RLE. </p><br><p>  Las modificaciones necesarias se reducen a eliminar la parte responsable del secreto (permutaci√≥n de contrase√±a), que permite ahorrar recursos y tiempo de ejecuci√≥n, y agregar un mecanismo para trabajar con muchos archivos en lugar de uno a la vez.  Con m√°s detalle, es poco probable que el proceso de cambiar el lector sea interesante, por lo que pasamos a la descripci√≥n de la implementaci√≥n. </p><br><h2 id="vysokie-tehnologii">  Alta tecnolog√≠a </h2><br><p>  Para demostrar el trabajo de este enfoque, implement√© el m√©todo en C puro y realic√© varias optimizaciones tanto en t√©rminos de velocidad como de memoria (no puede imaginar cu√°nto pesan estas im√°genes sin compresi√≥n incluso antes de DCT).  El <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rendimiento</a> multiplataforma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se</a> logra utilizando una combinaci√≥n de las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bibliotecas</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">libjpeg</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcre</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tinydir</a> , por lo que les agradezco.  Todo esto se har√° por marca, por lo que los usuarios de Windows desean instalar algunos Cygwin para evaluaci√≥n, o tratar con Visual Studio y las bibliotecas por su cuenta. </p><br><p>  La implementaci√≥n est√° disponible en forma de una utilidad de consola y una biblioteca.  Puede encontrar m√°s informaci√≥n sobre el uso de este √∫ltimo en el archivo L√©ame en el repositorio en el github, un enlace al que adjuntar√© al final de la publicaci√≥n. </p><br><h3 id="kak-ispolzovat">  ¬øC√≥mo usarlo? </h3><br><p>  Con precauci√≥n  Las im√°genes utilizadas para empaquetar se seleccionan mediante b√∫squeda de expresi√≥n regular en el directorio ra√≠z especificado.  Al final del archivo, puede mover, renombrar y copiar seg√∫n lo desee dentro de √©l, cambiar el archivo y los sistemas operativos, etc. Sin embargo, debe tener mucho cuidado y no cambiar el contenido inmediato.  La p√©rdida del valor de incluso un bit puede conducir a la imposibilidad de restaurar la informaci√≥n. </p><br><p>  Al finalizar el trabajo, la utilidad deja un archivo de archivo especial que contiene toda la informaci√≥n necesaria para desempaquetar, incluidos los datos de las im√°genes utilizadas.  Por s√≠ solo, pesa del orden de un par de kilobytes y no tiene ning√∫n efecto significativo en el espacio en disco ocupado. </p><br><p>  Puede analizar la capacidad posible utilizando el indicador '-a': './f5ar -a [carpeta de b√∫squeda] [expresi√≥n regular compatible con Perl]'.  El embalaje se realiza con el comando './f5ar -p [carpeta de b√∫squeda] [expresi√≥n regular compatible con Perl] [archivo empaquetado] [nombre de archivo]', y desempaquetando con './f5ar -u [archivo de archivo] [nombre del archivo restaurado]' . </p><br><h3 id="demonstraciya-raboty">  Demostraci√≥n de trabajo </h3><br><p>  Para mostrar la efectividad del m√©todo, descargu√© una colecci√≥n de 225 fotos de perros absolutamente gratis del servicio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Unsplash</a> y desenterr√© un gran pdf de 45 metros en los documentos del segundo volumen del Knut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Programming Art</a> . </p><br><p>  La secuencia es bastante simple: </p><br><pre><code class="bash hljs">$ du -sh knuth.pdf dogs/ 44M knuth.pdf 633M dogs/ $ ./f5ar -p dogs/ .*jpg knuth.pdf dogs.f5ar Reading compressing file... ok Initializing the archive... ok Analysing library capacity... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 17.0s Detected somewhat guaranteed capacity of 48439359 bytes Detected possible capacity of upto 102618787 bytes Compressing... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 39.4s Saving the archive... ok $ ./f5ar -u dogs/dogs.f5ar knuth_unpacked.pdf Initializing the archive... ok Reading the archive file... ok Filling the archive with files... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 1.4s Decompressing... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 21.0s Writing extracted data... ok $ sha1sum knuth.pdf knuth_unpacked.pdf 5bd1f496d2e45e382f33959eae5ab15da12cd666 knuth.pdf 5bd1f496d2e45e382f33959eae5ab15da12cd666 knuth_unpacked.pdf $ du -sh dogs/ 551M dogs/</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Capturas de pantalla para fan√°ticos</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/-y/by/6h/-yby6h4ssyerd6uorenw23vfvu8.png" alt="Skrnsht"></p><br><p>  El archivo desempaquetado a√∫n es posible y debe leerse: </p><br><p><img src="https://habrastorage.org/webt/0m/qu/js/0mqujsqlcrzzq3pdc1mook5znqq.png"></p></div></div><br><p>  Como puede ver, a partir de los 633 + 36 == 669 megabytes de datos originales en el disco duro, llegamos a un 551. m√°s agradable. Esta diferencia radical se explica por la disminuci√≥n en los valores de los coeficientes, que afectan su compresi√≥n posterior sin p√©rdida: una disminuci√≥n de uno por uno puede con calma " cortar "un par de bytes del archivo resultante.  Sin embargo, esto sigue siendo una p√©rdida de datos, aunque extremadamente peque√±a, que tiene que soportar. </p><br><p>  Afortunadamente, no son completamente visibles a simple vista.  Bajo el spoiler (debido a que el almacenamiento no puede manejar archivos grandes), el lector puede evaluar la diferencia tanto por ojo como por su intensidad, obtenida restando los valores del componente modificado del original: el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">original</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">con la informaci√≥n dentro</a> , la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">diferencia</a> (cuanto m√°s oscuro es el color, menor es la diferencia en el bloque ) </p><br><h2 id="vmesto-zaklyucheniya">  En lugar de una conclusi√≥n </h2><br><p>  Analizar todas estas dificultades, comprar un disco duro o cargar todo a la nube puede parecer una soluci√≥n mucho m√°s simple al problema.  Pero a pesar de que ahora vivimos en un momento tan maravilloso, no hay garant√≠as de que ma√±ana todav√≠a sea posible conectarse y cargar en alg√∫n lugar todos sus datos adicionales.  O ven a la tienda y c√≥mprate otro disco duro de mil terabytes.  Pero siempre puedes usar casas que ya est√°n tumbadas. </p><br><p>  -&gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/453332/">https://habr.com/ru/post/453332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453322/index.html">Configure Nomad Cluster con Consul e integre con Gitlab</a></li>
<li><a href="../453324/index.html">Diodo como rectificador</a></li>
<li><a href="../453326/index.html">C√≥mo automatizar la gesti√≥n de la infraestructura de TI: discuta tres tendencias</a></li>
<li><a href="../453328/index.html">Diez a√±os en un sitio remoto</a></li>
<li><a href="../453330/index.html">Qu√© hacer si la RAM se bloquea. Anamnesis y m√©todos de tratamiento.</a></li>
<li><a href="../453334/index.html">Hablar sobre PAKE</a></li>
<li><a href="../453336/index.html">Gu√≠a de selecci√≥n de m√°quinas de quemado CNC</a></li>
<li><a href="../453338/index.html">Lanzamiento de Rust 1.35.0: implementaciones de rasgos funcionales y otras innovaciones</a></li>
<li><a href="../453340/index.html">Perl 5.30 lanzado</a></li>
<li><a href="../453342/index.html">Mitos sobre empleados remotos que nos destruimos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>