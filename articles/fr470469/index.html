<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌈 👨🏽‍🎤 🤽🏼 PVS-Studio passe aux nuages: CircleCI 🤙 📐 🤙</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous poursuivons la série d'articles sur l'utilisation de l'analyseur statique PVS-Studio dans les systèmes CI cloud. Aujourd'hui, nous envisageons un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio passe aux nuages: CircleCI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/470469/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/e54/c6a/97be54c6a44e36ab4503e4e94e67d1ad.png" alt="Image 2"></div><br>  Nous poursuivons la série d'articles sur l'utilisation de l'analyseur statique PVS-Studio dans les systèmes CI cloud.  Aujourd'hui, nous envisageons un autre service - CircleCI.  Cette fois, le lecteur multimédia Kodi agira comme un projet d'analyse, dans le code source duquel nous essaierons de trouver des endroits intéressants. <br><a name="habracut"></a><br>  <b>Remarque</b>  D'autres articles sur l'intégration de PVS-Studio dans les systèmes CI cloud peuvent être trouvés ici: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PVS-Studio passe aux nuages: Azure DevOps</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PVS-Studio passe aux nuages ​​- lancement de l'analyse sur Travis CI</a> </li></ul><br>  Avant de passer directement à la configuration et à l'analyse des avertissements de l'analyseur, disons quelques mots sur le logiciel utilisé et analysé. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CircleCI</a> est un service CI basé sur le cloud pour automatiser l'assemblage, les tests et la publication de logiciels.  Il prend en charge l'assemblage de projets à la fois dans des conteneurs et dans des machines virtuelles exécutant Windows, Linux et macOS. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kodi</a> est un lecteur multimédia multiplateforme gratuit et open source.  Vous permet de lire des fichiers audio et vidéo situés à la fois sur votre ordinateur personnel et sur un réseau local ou Internet.  Il prend en charge les thèmes et les fonctionnalités en installant des plugins.  Disponible pour Windows, Linux, macOS et Android. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PVS-Studio</a> est un analyseur de code statique pour rechercher les erreurs et les vulnérabilités potentielles dans le code écrit en C, C ++, C # et Java.  Fonctionne sous Windows, Linux et macOS. <br><br><h2>  Personnalisation </h2><br>  Accédez à la page d'accueil de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CircleCI</a> et cliquez sur le bouton «S'inscrire» <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee0/121/d75/ee0121d7543f1955b5d4284efa438eff.png" alt="Image 1"></div><br>  Sur la page suivante, nous serons invités à vous authentifier avec un compte GitHub ou Bitbucket.  Sélectionnez GitHub et accédez à la page d'autorisation de l'application CircleCI. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dae/985/d5a/dae985d5a2bff1cfef699d9f8a650360.png" alt="Image 3"></div><br>  Nous autorisons l'application (bouton vert «Autoriser circleci») et nous redirigeons vers la page d'accueil «Bienvenue sur CircleCI!» <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c46/7e9/5c8/c467e95c8d8a6e055667f8b934645e67.png" alt="Image 4"></div><br>  Sur cette page, nous pouvons configurer immédiatement quels projets seront assemblés dans CircleCI.  Nous marquons notre référentiel et cliquons sur «Suivre». <br><br>  Après avoir ajouté le référentiel, CircleCI démarrera automatiquement la construction, mais depuis  il n'y a pas encore de fichier de configuration dans le référentiel - la tâche de construction échouera. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad2/946/66d/ad294666d51018dd62cdbc91e331050d.png" alt="Image 5"></div><br>  Avant d'ajouter le fichier de configuration, nous ajouterons au projet des variables contenant des données de licence pour l'analyseur.  Pour ce faire, cliquez sur «Paramètres» dans le volet gauche, puis dans le groupe «ORGANISATION» sélectionnez l'élément «Projets» et cliquez sur l'engrenage à droite du projet dont nous avons besoin.  Une fenêtre de paramètres s'ouvre. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e15/9fa/42c/e159fa42c18e0dd7fb7f3783b5b97bb5.png" alt="Image 6"></div><br>  Nous sommes intéressés par la section "Variables d'environnement".  Nous y allons et créons les variables <i>PVS_USERNAME</i> et <i>PVS_KEY</i> contenant le nom d'utilisateur et la clé de licence pour l'analyseur. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74a/2ce/b69/74a2ceb69055932dae23b3e1843aa303.png" alt="Image 7"></div><br>  Lors du démarrage d'une génération de projet, CircleCI lit la configuration de la tâche à partir d'un fichier dans le référentiel le long du chemin .circleci / config.yml.  Ajoutez-le. <br><br>  Tout d'abord, nous indiquons l'image de la machine virtuelle où l'analyseur va démarrer.  Une liste complète des images est disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><pre><code class="cpp hljs">version: <span class="hljs-number"><span class="hljs-number">2</span></span> jobs: build: machine: image: ubuntu<span class="hljs-number"><span class="hljs-number">-1604</span></span>:<span class="hljs-number"><span class="hljs-number">201903</span></span><span class="hljs-number"><span class="hljs-number">-01</span></span></code> </pre> <br>  Ensuite, ajoutez les référentiels nécessaires à apt et installez les dépendances du projet: <br><br><pre> <code class="cpp hljs">steps: - checkout - run: sudo -- sh -c <span class="hljs-string"><span class="hljs-string">" add-apt-repository -y ppa:team-xbmc/xbmc-ppa-build-depends &amp;&amp; add-apt-repository -y ppa:wsnipex/vaapi &amp;&amp; add-apt-repository -y ppa:pulse-eight/libcec &amp;&amp; apt-get update"</span></span> - run: sudo apt-get install -y automake autopoint build-essential cmake curl <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-jre gawk gdb gdc gettext git-core gperf libasound2-dev libass-dev libbluray-dev libbz2-dev libcap-dev libcdio-dev libcec4-dev libcrossguid-dev libcurl3 libcurl4-openssl-dev libdbus<span class="hljs-number"><span class="hljs-number">-1</span></span>-dev libegl1-mesa-dev libfmt3-dev libfontconfig-dev libfreetype6-dev libfribidi-dev libfstrcmp-dev libgif-dev libgl1-mesa-dev libglu1-mesa-dev libiso9660-dev libjpeg-dev liblcms2-dev libltdl-dev liblzo2-dev libmicrohttpd-dev libmysqlclient-dev libnfs-dev libpcre3-dev libplist-dev libpng-dev libpulse-dev libsmbclient-dev libsqlite3-dev libssl-dev libtag1-dev libtinyxml-dev libtool libudev-dev libusb-dev libva-dev libvdpau-dev libxml2-dev libxmu-dev libxrandr-dev libxrender-dev libxslt1-dev libxt-dev mesa-utils nasm pmount python-dev python-imaging python-sqlite rapidjson-dev swig unzip uuid-dev yasm zip zlib1g-dev wget</code> </pre> <br>  Ajoutez le référentiel PVS-Studio et installez l'analyseur: <br><br><pre> <code class="cpp hljs">- run: wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - &amp;&amp; sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - run: sudo -- sh -c "apt-get update &amp;&amp; apt-get install pvs-studio -y"</span></span></code> </pre> <br>  Collectons les dépendances du projet: <br><br><pre> <code class="cpp hljs">- run: sudo make -C tools/depends/target/flatbuffers PREFIX=/usr/local</code> </pre> <br>  Générez des Makefiles dans le répertoire d'assembly: <br><br><pre> <code class="cpp hljs">- run: mkdir build &amp;&amp; cd build &amp;&amp; cmake -DCMAKE_BUILD_TYPE=Debug ..</code> </pre><br>  L'étape suivante consiste à configurer et exécuter une analyse statique de notre projet. <br><br>  Créez d'abord un fichier avec la licence de l'analyseur.  La deuxième commande démarre la compilation de la trace de l'assembly du projet. <br><br>  Après le traçage, nous commençons directement l'analyse statique.  Lors de l'utilisation d'une licence d'essai, l'analyseur doit être démarré avec le paramètre: <br><br>  <i>--disableLicenseExpirationCheck</i> . <br><br>  La dernière commande convertit le fichier de résultats de l'analyseur en un rapport html: <br><br><pre> <code class="cpp hljs">- run: pvs-studio-analyzer credentials -o PVS.lic ${PVS_USER} ${PVS_KEY} - run: pvs-studio-analyzer trace -- make -j2 -C build/ - run: pvs-studio-analyzer analyze -j2 -l PVS.lic -o PVS-Studio.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> --disableLicenseExpirationCheck - run: plog-converter -t html -o PVS-Studio.html PVS-Studio.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> </pre> <br>  Après avoir terminé les tests, enregistrez les rapports de l'analyseur: <br><br><pre> <code class="cpp hljs">- run: mkdir PVS_Result &amp;&amp; cp PVS-Studio.* ./PVS_Result/ - store_artifacts: path: ./PVS_Result</code> </pre> <br>  Texte complet du fichier .circleci / config.yml: <br><br><pre> <code class="cpp hljs">version: <span class="hljs-number"><span class="hljs-number">2.1</span></span> jobs: build: machine: image: ubuntu<span class="hljs-number"><span class="hljs-number">-1604</span></span>:<span class="hljs-number"><span class="hljs-number">201903</span></span><span class="hljs-number"><span class="hljs-number">-01</span></span> steps: - checkout - run: sudo -- sh -c <span class="hljs-string"><span class="hljs-string">" add-apt-repository -y ppa:team-xbmc/xbmc-ppa-build-depends &amp;&amp; add-apt-repository -y ppa:wsnipex/vaapi &amp;&amp; add-apt-repository -y ppa:pulse-eight/libcec &amp;&amp; apt-get update"</span></span> - run: sudo apt-get install -y automake autopoint build-essential cmake curl <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-jre gawk gdb gdc gettext git-core gperf libasound2-dev libass-dev libbluray-dev libbz2-dev libcap-dev libcdio-dev libcec4-dev libcrossguid-dev libcurl3 libcurl4-openssl-dev libdbus<span class="hljs-number"><span class="hljs-number">-1</span></span>-dev libegl1-mesa-dev libfmt3-dev libfontconfig-dev libfreetype6-dev libfribidi-dev libfstrcmp-dev libgif-dev libgl1-mesa-dev libglu1-mesa-dev libiso9660-dev libjpeg-dev liblcms2-dev libltdl-dev liblzo2-dev libmicrohttpd-dev libmysqlclient-dev libnfs-dev libpcre3-dev libplist-dev libpng-dev libpulse-dev libsmbclient-dev libsqlite3-dev libssl-dev libtag1-dev libtinyxml-dev libtool libudev-dev libusb-dev libva-dev libvdpau-dev libxml2-dev libxmu-dev libxrandr-dev libxrender-dev libxslt1-dev libxt-dev mesa-utils nasm pmount python-dev python-imaging python-sqlite rapidjson-dev swig unzip uuid-dev yasm zip zlib1g-dev wget - run: wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add – &amp;&amp; sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - run: sudo -- sh -c "apt-get update &amp;&amp; apt-get install pvs-studio -y" - run: sudo make -C tools/depends/target/flatbuffers PREFIX=/usr/local - run: mkdir build &amp;&amp; cd build &amp;&amp; cmake -DCMAKE_BUILD_TYPE=Debug .. - run: pvs-studio-analyzer credentials -o PVS.lic ${PVS_USER} ${PVS_KEY} - run: pvs-studio-analyzer trace -- make -j2 -C build/ - run: pvs-studio-analyzer analyze -j2 -l PVS.lic -o PVS-Studio.log --disableLicenseExpirationCheck - run: plog-converter -t html -o PVS-Studio.html PVS-Studio.log - run: mkdir PVS_Result &amp;&amp; cp PVS-Studio.* ./PVS_Result/ - store_artifacts: path: ./PVS_Result</span></span></code> </pre> <br>  Nous téléchargeons le fichier dans le référentiel et CircleCI commencera automatiquement l'assemblage du projet. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56d/a82/597/56da82597874166081473599a7c69e5f.png" alt="Image 12"></div><br>  Après la fin de la tâche, les fichiers avec les résultats de l'analyseur peuvent être téléchargés sur l'onglet «Artefacts». <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/90d/f7e/5a790df7eb8a3868d7266b05aeabff4e.png" alt="Image 11"></div><br><h2>  Résultats d'analyse </h2><br>  Eh bien, regardons maintenant quelques avertissements émis par l'analyseur pendant le travail. <br><br>  <b>Avertissement PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V504</a> Il est très probable que le point-virgule ';'  est manquant après le mot clé "return".  AdvancedSettings.cpp: 1476 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CAdvancedSettings::SetExtraArtwork(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TiXmlElement* arttypes, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;&amp; artworkMap) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!arttypes) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> artworkMap.clear(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TiXmlNode* arttype = arttypes-&gt;FirstChild(<span class="hljs-string"><span class="hljs-string">"arttype"</span></span>); .... }</code> </pre> <br>  À en juger par la mise en forme du code, la logique d'exécution suivante a été supposée: <br><br><ul><li>  si <i>arttypes</i> est un pointeur nul, terminez l'exécution de la méthode; </li><li>  si <i>arttypes</i> est un pointeur différent de zéro, effacez le vecteur artworkMap, puis effectuez d'autres actions. </li></ul><br>  Cependant, le caractère manquant ';'  fait des ajustements;  par conséquent, la logique d'exécution ne correspond pas du tout au formatage.  En conséquence, il devient le suivant: <br><br><ul><li>  si <i>arttypes</i> est un pointeur nul, le vecteur <i>artworkMap</i> est <i>effacé</i> et la méthode se termine; </li><li>  si <i>arttypes</i> est un pointeur non nul, d'autres actions sont effectuées, mais le vecteur <i>artworkMap</i> n'est pas nettoyé. </li></ul><br>  En général, il est très peu probable qu'il n'y ait pas d'erreur.  Et presque personne n'écrirait d'expressions dans l'esprit du <i>retour artworkMap.clear ();</i>  :). <br><br>  <b>Avertissements de PVS-Studio</b> : <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V547 L'</a> expression 'lastsector' est toujours fausse.  udf25.cpp: 636 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V547 L'</a> expression 'lastsector' est toujours fausse.  udf25.cpp: 644 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V571 Contrôle</a> récurrent.  La condition 'if (lastsector)' a déjà été vérifiée à la ligne 636. udf25.cpp: 644 </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> udf25::UDFGetAVDP( struct <span class="hljs-keyword"><span class="hljs-keyword">avdp_t</span></span> *avdp) { .... <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> lastsector; .... lastsector = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... for(;;) { .... if( lastsector ) { // &lt;= V547 lbnum = lastsector; terminate = 1; } else { //! @todo Find last sector of the disc (this is optional). if( lastsector ) // &lt;= V547 lbnum = lastsector - 256; else return 0; } } .... }</span></span></code> </pre><br>  Faites attention aux endroits marqués avec <i>// &lt;=</i> .  La valeur 0 est écrite dans la variable <i>lastsector</i> , puis elle est utilisée deux fois comme expression conditionnelle de l' <i>instruction if</i> .  Étant donné que la valeur de la variable ne change ni dans la boucle ni entre ces affectations, les branches des deux <i>instructions if</i> ne seront pas exécutées. <br><br>  Il se peut que la fonctionnalité nécessaire n'ait pas encore été implémentée (attention aux <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">tâches</a></i> ). <br><br>  Par ailleurs, comme vous pouvez le voir, l'analyseur a immédiatement émis 3 avertissements pour ce code.  Parfois, cependant, même quelques avertissements ne suffisent pas, et les utilisateurs continuent de croire que l'analyseur se trompe ... Un collègue a écrit plus à ce sujet dans l'article " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un jour à partir du support utilisateur de PVS-Studio</a> " :). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Avertissement</a> <b>PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V547 L'</a> expression 'values.size ()! = 2' est toujours fausse.  GUIControlSettings.cpp: 1174 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CGUIControlRangeSetting::OnClick() { .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;CVariant&gt; values; SettingConstPtr listDefintion = settingList-&gt;GetDefinition(); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (listDefintion-&gt;GetType()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SettingType::Integer: values.push_back(m_pSlider-&gt; GetIntValue(CGUISliderControl::RangeSelectorLower)); values.push_back(m_pSlider-&gt; GetIntValue(CGUISliderControl::RangeSelectorUpper)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SettingType::Number: values.push_back(m_pSlider-&gt; GetFloatValue(CGUISliderControl::RangeSelectorLower)); values.push_back(m_pSlider-&gt; GetFloatValue(CGUISliderControl::RangeSelectorUpper)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values.size() != <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; SetValid(CSettingUtils::SetList(settingList, values)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsValid(); }</code> </pre> <br>  Dans ce cas, la vérification de <i>values.size ()! = 2</i> est redondante, car le résultat de l'expression conditionnelle sera toujours <i>faux</i> .  En fait, si l'exécution va dans l'une des branches <i>case</i> de l' <i>instruction switch</i> , 2 éléments seront ajoutés au vecteur, et comme il était vide, alors sa taille deviendra égale à deux;  sinon (lors de l'exécution de la branche <i>par défaut</i> ), la méthode se fermera. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Avertissement</a> <b>PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'</a> expression <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V547</a> 'prio == 0x7fffffff' est toujours vraie.  DBusReserve.cpp: 57 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CDBusReserve::AcquireDevice(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&amp; device) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> prio = INT_MAX; .... res = dbus_bus_request_name( m_conn, service.c_str(), DBUS_NAME_FLAG_DO_NOT_QUEUE | (prio == INT_MAX ? <span class="hljs-number"><span class="hljs-number">0</span></span> : DBUS_NAME_FLAG_ALLOW_REPLACEMENT), <span class="hljs-comment"><span class="hljs-comment">// &lt;= error); .... }</span></span></code> </pre> <br>  La variable <i>prio est</i> initialisée avec la valeur <i>INT_MAX</i> , après quoi elle est également utilisée dans l'opérateur ternaire en comparaison <i>prio == INT_MAX</i> .  Cependant, entre le lieu d'initialisation et d'utilisation, sa valeur ne change pas, par conséquent, la valeur de l'expression <i>prio == INT_MAX</i> est <i>vraie</i> , et l'opérateur ternaire retournera toujours 0. <br><br>  <b>Avertissements de PVS-Studio</b> : <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V575</a> Le pointeur null potentiel est passé dans la fonction 'memcpy'.  Inspectez le premier argument.  Vérifiez les lignes: 39, 38. DVDOverlayImage.h: 39 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V575</a> Le pointeur null potentiel est passé dans la fonction 'memcpy'.  Inspectez le premier argument.  Vérifiez les lignes: 44, 43. DVDOverlayImage.h: 44 </li></ul><br><pre> <code class="cpp hljs">CDVDOverlayImage(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CDVDOverlayImage&amp; src) : CDVDOverlay(src) { Data = (<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>*)<span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(src.linesize * src.height); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(data, src.data, src.linesize * src.height); <span class="hljs-comment"><span class="hljs-comment">// &lt;= if(src.palette) { palette = (uint32_t*)malloc(src.palette_colors * 4); memcpy(palette, src.palette, src.palette_colors * 4); // &lt;= } .... }</span></span></code> </pre> <br>  Les deux avertissements ont le même modèle - le pointeur obtenu à la suite de l'appel de la fonction <i>malloc</i> est utilisé plus loin dans la fonction <i>memcpy</i> sans vérifier d'abord <i>NULL</i> . <br><br>  Quelqu'un peut vouloir s'opposer à ces avertissements dans la clé suivante: <i>malloc</i> ne retournera jamais un pointeur nul, et si c'est le cas, laissez l'application tomber mieux.  C'est un sujet pour une longue discussion, mais d'une manière ou d'une autre je propose de lire la note de mon collègue - " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pourquoi est-il important de vérifier que la fonction malloc est revenue</a> ". <br><br>  Si vous le souhaitez, vous pouvez configurer l'analyseur pour qu'il se comporte de telle manière qu'il ne considère pas que <i>malloc</i> peut renvoyer un pointeur nul - alors il n'y aura pas de tels avertissements.  En savoir plus à ce sujet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V522</a> Il pourrait y avoir un déréférencement d'une potentielle entrée de pointeur nul.  Vérifiez les lignes: 985, 981. emu_msvcrt.cpp: 985 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">struct dirent *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dll_readdir</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DIR *dirp)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dirent</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entry</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NULL</span></span></span><span class="hljs-class">;</span></span> entry = (dirent*) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(*entry)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dirData-&gt;curr_index &lt; dirData-&gt;items.Size() + <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dirData-&gt;curr_index == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">strncpy</span></span>(entry-&gt;d_name, <span class="hljs-string"><span class="hljs-string">".\0"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); .... }</code> </pre> <br>  La situation est similaire à celle décrite ci-dessus.  Le pointeur obtenu suite à l'appel de <i>malloc</i> est écrit dans la variable d' <i>entrée</i> , après quoi il est utilisé sans vérifier <i>NULL</i> ( <i>entrée-&gt; nom_d</i> ). <br><br>  <b>PVS-Studio Warning</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V773</a> La portée de visibilité du pointeur 'progressHandler' a été fermée sans libérer la mémoire.  Une fuite de mémoire est possible.  PVRGUIChannelIconUpdater.cpp: 94 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CPVRGUIChannelIconUpdater::SearchAndUpdateMissingChannelIcons() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... CPVRGUIProgressHandler* progressHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CPVRGUIProgressHandler(g_localizeStrings.Get(<span class="hljs-number"><span class="hljs-number">19286</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; group : m_groups) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;PVRChannelGroupMember&gt; members = group-&gt;GetMembers(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> channelIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; member : members) { progressHandler-&gt;UpdateProgress(member.channel-&gt;ChannelName(), channelIndex++, members.size()); .... } progressHandler-&gt;DestroyProgress(); }</code> </pre> <br>  Le pointeur <i>progressHandler</i> contient la valeur obtenue en appelant l' <i>opérateur new</i> .  Cependant, la <i>suppression d'opérateur n'est</i> pas appelée pour ce pointeur, ce qui provoque une fuite de mémoire. <br><br>  <b>Avertissement PVS-Studio</b> : le dépassement de la matrice <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V557</a> est possible.  L'index 'idx' pointe au-delà de la limite du tableau.  PlayerCoreFactory.cpp: 240 <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;CPlayerCoreConfig *&gt; m_vecPlayerConfigs; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CPlayerCoreFactory::PlaysVideo(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&amp; player) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-function"><span class="hljs-function">CSingleLock </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m_section)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> idx = GetPlayerIndex(player); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_vecPlayerConfigs.empty() || idx &gt; m_vecPlayerConfigs.size()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_vecPlayerConfigs[idx]-&gt;m_bPlaysVideo; }</code> </pre> <br>  L' <i>instruction if</i> impose des restrictions sur la taille du vecteur <i>m_vecPlayerConfigs en</i> raison de l'expression conditionnelle et quitte la méthode si elle est vraie.  Par conséquent, si l'exécution du code a atteint la dernière <i>instruction de retour</i> , la taille du vecteur <i>m_vecPlayerConfigs</i> est dans la plage spécifiée: [1;  idx].  Cependant, quelques lignes ci-dessous correspondent à l' <i>appel</i> <i>idx</i> : <i>m_vecPlayerConfigs [idx] -&gt; m_bPlaysVideo</i> .  Par conséquent, si <i>idx</i> est égal à la taille du vecteur, il dépassera la bordure de la plage autorisée. <br><br>  Et enfin, jetez un œil à quelques avertissements sur le code de la bibliothèque <b>Platinum</b> . <br><br>  <b>Avertissement PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V542</a> Envisagez d'inspecter une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conversion de</a> type impair: «bool» en «char *».  PltCtrlPoint.cpp: 1617 <br><br><pre> <code class="cpp hljs">NPT_Result PLT_CtrlPoint::ProcessSubscribeResponse(...) { .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> subscription = (request.GetMethod().ToUppercase() == <span class="hljs-string"><span class="hljs-string">"SUBSCRIBE"</span></span>); .... NPT_String prefix = NPT_String::Format(<span class="hljs-string"><span class="hljs-string">" PLT_CtrlPoint::ProcessSubscribeResponse %ubscribe for service \"%s\" (result = %d, status code = %d)"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)subscription?<span class="hljs-string"><span class="hljs-string">"S"</span></span>:<span class="hljs-string"><span class="hljs-string">"Uns"</span></span>, <span class="hljs-comment"><span class="hljs-comment">// &lt;= (const char*)service-&gt;GetServiceID(), res, response?response-&gt;GetStatusCode():0); .... }</span></span></code> </pre> <br>  Dans ce cas, la priorité des opérations est confuse.  <i>Const char *</i> n'est pas le résultat du calcul de l'opérateur ternaire ( <i>abonnement? "S": "Uns"</i> ), mais l' <i>abonnement</i> variable.  Au moins, ça a l'air bizarre. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Avertissement</a> <b>PVS-Studio</b> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V560</a> Une partie de l'expression conditionnelle est toujours fausse: c == '\ t'.  NptUtils.cpp: 863 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NPT_Result </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NPT_ParseMimeParameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NPT_MIME_PARAMETER_PARSER_STATE_NEED_EQUALS: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; <span class="hljs-string"><span class="hljs-string">' '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NPT_ERROR_INVALID_SYNTAX; <span class="hljs-comment"><span class="hljs-comment">// END or CTLs are invalid if (c == ' ' || c == '\t') continue; // ignore leading whitespace .... }</span></span></code> </pre> <br>  Le code d'espace est 0x20, le code de tabulation est 0x09.  Par conséquent, la sous-expression <i>c == '\ t'</i> sera toujours <i>fausse</i> , car ce cas est déjà couvert par l'expression <i>c &lt;''</i> (si vrai, la fonction sera fermée). <br><br><h2>  Conclusion </h2><br>  Comme vous pouvez le voir dans cet article, sur le prochain système CI (CircleCI), nous avons réussi à configurer la vérification de projet à l'aide de PVS-Studio.  Je vous suggère de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">télécharger et d'essayer l'</a> analyseur sur votre projet.  Si vous avez des questions sur la configuration ou l'utilisation de l'analyseur, n'hésitez pas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">à nous écrire</a> , nous serons heureux de vous aider. <br><br>  Et, bien sûr, le code de la négligence envers vous, mes amis.  :) <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a> </p><br><br>  Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Sergey Vasiliev, Ilya Gainulin.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PVS-Studio dans les nuages: CircleCI</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470469/">https://habr.com/ru/post/fr470469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470451/index.html">Comment le junior vert est entré dans l'informatique</a></li>
<li><a href="../fr470453/index.html">Vélos informatiques de vente au détail - comme il y a 12 ans</a></li>
<li><a href="../fr470455/index.html">QIWI Server Party 5.0</a></li>
<li><a href="../fr470457/index.html">Mouvement brownien fractionnaire</a></li>
<li><a href="../fr470465/index.html">PVS-Studio dans les nuages: CircleCI</a></li>
<li><a href="../fr470473/index.html">Import Chronicles: A Review of MyOffice</a></li>
<li><a href="../fr470475/index.html">Plus accessible: critiques audio à faible coût</a></li>
<li><a href="../fr470477/index.html">Transformers Universe Lakhta Center. Épisode 1: De haut en bas</a></li>
<li><a href="../fr470479/index.html">Pourquoi les cookies de suivi sont dangereux si vous n'avez vraiment rien à cacher</a></li>
<li><a href="../fr470483/index.html">Laboratoire de technologie Azure à Moscou</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>