<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëç „äóÔ∏è üì∏ Seluruh kebenaran tentang RTOS. Artikel # 22. Kotak Surat: Layanan Tambahan dan Struktur Data üëºüèº üò§ üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini melanjutkan ulasan kotak surat yang dimulai pada artikel sebelumnya di seri "The Truth About RTOS". 

 Artikel sebelumnya dalam seri: 

 A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Seluruh kebenaran tentang RTOS. Artikel # 22. Kotak Surat: Layanan Tambahan dan Struktur Data</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431118/"><img src="https://habrastorage.org/webt/j-/7m/ne/j-7mne20kyhq0wia5-mxp4lotsq.jpeg"><br><br>  Artikel ini melanjutkan ulasan kotak surat yang dimulai pada artikel sebelumnya di seri "The Truth About RTOS". <br><a name="habracut"></a><br>  Artikel sebelumnya dalam seri: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kotak Surat: Pengantar dan Layanan Dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Semaphores: Layanan Tambahan dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Semaphores: pengantar dan layanan dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grup Bendera Acara: Layanan Pembantu dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grup Bendera Acara: Pengantar dan Layanan Dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sinyal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Partisi Memori: Layanan dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian memori: pengantar dan layanan dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Struktur data tugas dan panggilan API yang tidak didukung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Layanan untuk bekerja dengan tugas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas: konfigurasi dan pengantar API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Penjadwal: fitur canggih dan pelestarian konteks</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Penjadwal: implementasi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nucleus SE: Desain dan Penyebaran Internal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nucleus SE: Pendahuluan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Layanan RTOS lainnya</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Interaksi tugas dan sinkronisasi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas, pengalihan konteks, dan interupsi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas dan Perencanaan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RTOS: Struktur dan mode waktu-nyata</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RTOS: pengantar.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><br></a> <br><br><h2>  Layanan Kotak Pesan Bantu </h2><br>  Nucleus RTOS memiliki empat panggilan API yang menyediakan fungsi tambahan yang terkait dengan kotak surat: membuang kotak surat, mengambil informasi tentang kotak surat, mengambil jumlah kotak surat dalam suatu aplikasi, dan mengambil penunjuk ke semua kotak surat dalam suatu aplikasi.  Tiga fitur pertama diimplementasikan dalam Nucleus SE. <br><br><h3>  Atur ulang kotak surat </h3><br>  Panggilan layanan API ini mengatur ulang kotak surat ke kondisi awal, yang tidak digunakan.  Pesan yang disimpan di kotak surat akan hilang.  Tugas apa pun yang ditangguhkan di kotak surat akan dilanjutkan dengan kode pengembalian <b>NUSE_MAILBOX_WAS_RESET</b> . <br><br>  <b><i>Panggil untuk mengatur ulang kotak surat di Nucleus RTOS</i></b> <br>  Prototipe panggilan layanan: <br>  <b>STATUS NU_Reset_Mailbox (NU_MAILBOX * kotak surat);</b> <br><br>  Parameter: <br>  <b>kotak surat</b> - penunjuk ke unit kontrol kotak surat. <br><br>  Nilai pengembalian: <br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_MAILBOX</b> - penunjuk kotak surat tidak valid. <br><br>  <b><i>Panggil untuk mengatur ulang kotak surat di Nucleus SE</i></b> <br>  Panggilan layanan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br>  <b>STATUS NUSE_Mailbox_Reset (NUSE_MAILBOX mailbox);</b> <br><br>  Parameter: <br>  <b>kotak surat</b> - indeks (ID) dari kotak surat yang dibuang. <br><br>  <b>Nilai pengembalian:</b> <br>  <b>NUSE_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NUSE_INVALID_MAILBOX</b> - indeks kotak surat tidak valid. <br><br>  <b><i>Menerapkan Reset Kotak Pesan di Nucleus SE</i></b> <br>  Kode opsi untuk fungsi <b>NUSE_Mailbox_Reset</b> (setelah memeriksa parameter) dipilih menggunakan kompilasi bersyarat, tergantung pada apakah dukungan untuk memblokir (menjeda) tugas diaktifkan atau tidak.  Kami akan mempertimbangkan kedua opsi ini. <br><br>  Jika kunci tidak diaktifkan, kode untuk fungsi API ini cukup sederhana.  Kotak surat ditandai sebagai tidak digunakan dengan mengatur parameter <b>NUSE_Mailbox_Status []</b> ke <b>FALSE</b> . <br><br>  Jika kunci diaktifkan, kode menjadi lebih kompleks: <br><br><pre><code class="plaintext hljs">while (NUSE_Mailbox_Blocking_Count[mailbox] != 0) { U8 index; /* check whether any tasks are blocked */ /* on this mailbox */ for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_MAILBOX_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == mailbox)) { NUSE_Task_Blocking_Return[index] = NUSE_MAILBOX_WAS_RESET; NUSE_Task_Status[index] = NUSE_READY; break; } } NUSE_Mailbox_Blocking_Count[mailbox]--; } #if NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER NUSE_Reschedule(NUSE_NO_TASK); #endif</code> </pre> <br>  Kotak surat diatur ulang ke status "Kosong". <br><br>  Setiap tugas yang ditangguhkan di kotak surat diberi status "Siap" dengan kode pengembalian <b>NUSE_MAILBOX_WAS_RESET</b> .  Setelah proses ini selesai, jika penjadwal Prioritas digunakan, panggilan layanan <b>NUSE_Reschedule () dibuat</b> , karena satu atau lebih tugas dengan prioritas yang lebih tinggi dapat menjadi siap dan menunggu izin untuk dieksekusi. <br><br><h3>  Mengambil Informasi Kotak Pesan </h3><br>  Panggilan layanan ini menyediakan satu set informasi kotak surat.  Implementasi panggilan ini dalam Nucleus SE berbeda dari Nucleus RTOS dalam hal ia mengembalikan lebih sedikit informasi, karena penamaan objek dan urutan jeda tidak didukung, dan tugas jeda dapat dinonaktifkan. <br><br>  <b><i>Panggil untuk Nucleus RTOS Information Mailbox</i></b> <br>  Panggilan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br>  <b>STATUS NU_Mailbox_Information (NU_MAILBOX * kotak surat, CHAR * nama, OPTION * suspend_type, DATA_ELEMENT * message_present, UNSIGNED * task_waiting, NU_TASK ** first_task);</b> <br><br>  Parameter: <br><br>  <b>kotak surat</b> - penunjuk ke unit kontrol kotak surat; <br>  <b>name</b> - pointer 8 karakter ke nama kotak surat.  Pengakhiran null byte juga termasuk dalam area ini; <br>  <b>suspend_type</b> - penunjuk ke variabel tempat jenis penangguhan tugas disimpan.  Itu dapat mengambil nilai <b>NU_FIFO</b> dan <b>NU_PRIORITY</b> ; <br>  <b>message_present</b> - pointer ke variabel yang akan mengambil nilai <b>NU_TRUE</b> atau <b>NU_FALSE</b> , tergantung pada apakah kotak surat penuh atau tidak; <br>  <b>task_waiting</b> - pointer ke variabel yang akan mengambil jumlah tugas yang ditangguhkan di kotak surat ini; <br>  <b>first_task</b> - penunjuk ke penunjuk tugas yang akan membawa penunjuk ke tugas yang dijeda pertama. <br><br>  Nilai pengembalian: <br><br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_MAILBOX</b> - penunjuk kotak surat tidak valid. <br><br>  <b><i>Panggilan untuk Nucleus SE Mailbox Information</i></b> <br>  Panggilan layanan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NUSE_Mailbox_Information (NUSE_MAILBOX mailbox, U8 * message_present, U8 * task_waiting, NUSE_TASK * first_task);</b> <br><br>  Parameter: <br><br>  <b>kotak surat</b> - indeks kotak surat tentang informasi mana yang diminta; <br>  <b>message_present</b> - pointer ke variabel yang mengambil nilai <b>TRUE</b> atau <b>FALSE</b> , tergantung pada apakah kotak surat penuh atau tidak; <br>  <b>task_waiting</b> - pointer ke variabel yang akan mengambil jumlah tugas yang ditangguhkan di kotak surat ini (tidak ada yang dikembalikan jika penangguhan tugas dinonaktifkan); <br>  <b>first_task</b> - pointer ke variabel dari tipe <b>NUSE_TASK</b> , yang akan mengambil indeks tugas yang ditangguhkan pertama (tidak ada yang dikembalikan jika penangguhan tugas dinonaktifkan). <br><br>  Nilai pengembalian: <br><br>  <b>NUSE_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NUSE_INVALID_MAILBOX</b> - indeks kotak surat tidak valid; <br>  <b>NUSE_INVALID_POINTER</b> - satu atau beberapa parameter pointer salah. <br><br>  <b><i>Menerapkan Informasi Kotak Pesan di Nucleus SE</i></b> <br><br>  Implementasi panggilan API ini cukup sederhana: <br><br><pre> <code class="plaintext hljs">*message_present = NUSE_Mailbox_Status[mailbox]; #if NUSE_BLOCKING_ENABLE *tasks_waiting = NUSE_Mailbox_Blocking_Count[mailbox]; if (NUSE_Mailbox_Blocking_Count[mailbox] != 0) { U8 index; for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_MAILBOX_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == mailbox)) { *first_task = index; break; } } } else { *first_task = 0; } #else *tasks_waiting = 0; *first_task = 0; #endif return NUSE_SUCCESS;</code> </pre><br>  Fungsi mengembalikan status kotak surat.  Kemudian, jika panggilan layanan untuk memblokir tugas diaktifkan, jumlah tugas yang ditangguhkan dan indeks yang pertama dikembalikan (jika tidak, parameter ini diatur ke 0). <br><br><h3>  Mendapatkan jumlah kotak surat </h3><br>  Panggilan utilitas ini mengembalikan jumlah kotak surat di aplikasi.  Sementara di Nucleus RTOS jumlah mereka dapat berubah dari waktu ke waktu, dan nilai kembali akan menunjukkan jumlah kotak surat saat ini, di Nucleus SE jumlah kotak surat diatur pada tahap pembuatan dan tidak dapat diubah. <br><br>  <b><i>Memanggil Penghitung Kotak Pesan di Nucleus RTOS</i></b> <br>  Panggilan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br>  <b>NU_Established_Mailboxes (VOID) UNSIGNED;</b> <br><br>  Parameter: <br>  Tidak ada. <br><br>  Nilai pengembalian: <br>  Jumlah kotak surat yang dibuat dalam aplikasi. <br><br>  <b><i>Memanggil Penghitung Kotak Pesan di Nucleus SE</i></b> <br>  Panggilan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br>  <b>U8 NUSE_Mailbox_Count (batal);</b> <br><br>  Parameter: <br>  Tidak ada. <br><br>  Nilai pengembalian: <br>  Jumlah kotak surat yang dikonfigurasi dalam aplikasi. <br><br>  <b><i>Menerapkan Penghitung Kotak Pesan di Nucleus SE</i></b> <br>  Pelaksanaan panggilan API ini sangat sederhana: nilai arahan <b>#define</b> <b>NUSE_MAILBOX_NUMBER dikembalikan</b> . <br><br><h2>  Struktur data </h2><br>  Kotak surat menggunakan dua atau tiga larik struktur data (yang semuanya terletak di RAM), yang, seperti objek Nucleus SE lainnya, adalah seperangkat tabel yang ukurannya tergantung pada jumlah kotak surat yang dikonfigurasi dan parameternya. <br><br>  Saya sangat merekomendasikan bahwa kode aplikasi tidak menggunakan akses langsung ke struktur data ini, tetapi merujuknya melalui fungsi API yang disediakan.  Ini menghindari ketidakcocokan dengan versi Nucleus SE di masa depan dan efek samping yang tidak diinginkan, dan juga menyederhanakan porting aplikasi ke Nucleus RTOS.  Berikut ini adalah ikhtisar terperinci dari struktur data untuk pemahaman yang lebih baik tentang cara kerja kode panggilan layanan dan untuk debugging. <br><br><h3>  Data RAM </h3><br>  Data ini memiliki struktur sebagai berikut: <br><br>  <b>NUSE_Mailbox_Data []</b> - larik jenis <b>ADDR</b> yang memiliki satu entri untuk setiap kotak surat yang dikonfigurasi, ia menyimpan data kotak surat. <br>  <b>NUSE_Mailbox_Status []</b> adalah larik <b>U8</b> yang memiliki satu entri untuk setiap kotak surat yang dikonfigurasi, ia memantau penggunaan kotak surat.  Nilai bukan nol ( <b>BENAR</b> ) menunjukkan bahwa kotak surat penuh. <br>  <b>NUSE_Mailbox_Blocking_Count []</b> - larik tipe <b>U8</b> , berisi konter tugas yang diblokir untuk setiap kotak surat.  Array ini hanya dibuat jika fungsionalitas pemblokiran panggilan API diaktifkan. <br><br>  Struktur data ini diinisialisasi dengan nol di fungsi <b>NUSE_Init_Mailbox ()</b> ketika Nucleus SE dimulai.  Ini logis, karena setiap kotak surat dibuat kosong (tidak digunakan). <br><br>  Berikut ini adalah definisi dari struktur data ini dari file <b>nuse_init.c</b> . <br><br><pre> <code class="plaintext hljs">RAM ADDR NUSE_Mailbox_Data[NUSE_MAILBOX_NUMBER]; RAM U8 NUSE_Mailbox_Status[NUSE_MAILBOX_NUMBER]; #if NUSE_BLOCKING_ENABLE RAM U8 NUSE_Mailbox_Blocking_Count[NUSE_MAILBOX_NUMBER]; #endif</code> </pre><br><h3>  Data ROM </h3><br>  Untuk implementasi kotak surat, data dalam ROM tidak digunakan. <br><br><h3>  Jumlah memori untuk kotak surat </h3><br>  Seperti semua objek kernel Nucleus SE, jumlah memori yang diperlukan untuk kotak surat sudah diketahui sebelumnya. <br><br>  Jumlah memori untuk data dalam ROM untuk semua kotak surat dalam aplikasi adalah 0. <br><br>  Jumlah data dalam RAM untuk semua kotak surat dalam aplikasi (dalam byte) dengan panggilan API yang diaktifkan untuk memblokir tugas dapat dihitung sebagai berikut: <br>  <b>NUSE_MAILBOX_NUMBER * (sizeof (ADDR) +2)</b> <br><br>  Jika tidak: <br>  <b>NUSE_MAILBOX_NUMBER * (sizeof (ADDR) +1)</b> <br><br><h2>  Panggilan API yang belum direalisasi </h2><br>  Keempat panggilan utilitas yang dapat ditemukan di Nucleus RTOS tidak diterapkan di Nucleus SE. <br><br><h3>  Buat Kotak Surat </h3><br>  Panggilan layanan API ini membuat kotak surat.  Nucleus SE tidak membutuhkannya, karena kotak surat dibuat secara statis. <br><br>  Prototipe panggilan layanan: <br>  <b>STATUS NU_Create_Mailbox (NU_MAILBOX * kotak surat, nama CHAR *, suspend_type OPS TIDAK TANDA TANDA);</b> <br><br>  Parameter: <br><br>  <b>kotak surat</b> - penunjuk ke unit kontrol kotak surat yang disediakan oleh pengguna;  Digunakan untuk mengelola kotak surat di panggilan API lainnya <br>  <b>name</b> - penunjuk ke nama 7-karakter kotak surat dengan nol terminasi byte; <br>  <b>suspend_type</b> - Menunjukkan prinsip penangguhan tugas di kotak surat.  Ini dapat mengambil nilai <b>NU_FIFO</b> dan <b>NU_PRIORITY</b> , yang berarti prinsip FIFO (First-In-First-Out) atau prinsip prioritas penangguhan tugas masing-masing. <br><br>  Nilai pengembalian: <br><br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_MAILBOX</b> - null pointer ke unit kontrol kotak surat ( <b>NULL</b> ), atau pointer sudah digunakan; <br>  <b>NU_INVALID_SUSPEND</b> - parameter <b>suspend_type</b> tidak valid. <br><br><h3>  Hapus kotak surat </h3><br>  Panggilan layanan API ini menghapus kotak surat yang dibuat sebelumnya.  Nucleus SE tidak memerlukan ini, karena kotak surat dibuat secara statis dan tidak dapat dihapus. <br><br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NU_Delete_Mailbox (NU_MAILBOX * kotak surat);</b> <br><br>  Parameter: <br><br>  <b>kotak surat</b> - penunjuk ke unit kontrol kotak surat. <br><br>  Nilai pengembalian: <br><br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_MAILBOX</b> - penunjuk kotak surat tidak valid. <br><br><h3>  Petunjuk Kotak Surat </h3><br>  Panggilan API ini membuat daftar pointer berurutan ke semua kotak surat di sistem.  Nucleus SE tidak membutuhkannya, karena kotak surat diidentifikasi oleh indeks sederhana, bukan pointer. <br><br>  Prototipe panggilan layanan: <br><br>  <b>NU_Mailbox_Pointers UNSIGNED (NU_MAILBOX ** pointer_list, maksimum_pointers UNSIGNED);</b> <br><br>  Parameter: <br><br>  <b>pointer_list</b> - pointer ke array pointer <b>NU_MAILBOX</b> ;  array ini akan diisi dengan pointer ke kotak surat yang dibuat dalam sistem; <br>  <b>maximum_pointers</b> - jumlah maksimum pointer dalam array. <br><br>  Nilai pengembalian: <br><br>  Jumlah pointer <b>NU_MAILBOX</b> dalam array. <br><br><h3>  Rekam pesan di kotak surat untuk pengiriman ke semua penerima </h3><br>  Panggilan layanan ini mengirim pesan ke semua tugas yang menunggu pesan dari kotak surat tertentu.  Dalam Nucleus SE, panggilan utilitas ini tidak diterapkan, karena akan menambah kompleksitas yang tidak perlu. <br><br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NU_Broadcast_To_Mailbox (NU_MAILBOX * kotak surat, pesan VOID *, ditangguhkan tanpa ditandatangani);</b> <br><br>  Parameter: <br><br>  <b>kotak surat</b> - penunjuk ke unit kontrol kotak surat; <br>  <b>message</b> - penunjuk ke pesan yang dikirimkan; <br>  <b>ditangguhkan</b> - menunjukkan apakah akan menangguhkan tugas panggilan jika kotak surat sudah berisi pesan;  dapat berupa <b>NU_NO_SUSPEND</b> , <b>NU_SUSPEND,</b> atau nilai batas waktu. <br><br>  Nilai pengembalian: <br><br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_MAILBOX</b> - pointer kotak surat tidak valid; <br>  <b>NU_INVALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NU_INVALID_SUSPEND</b> - upaya untuk menangguhkan dari utas yang tidak terkait tugas; <br>  <b>NU_MAILBOX_FULL</b> - kotak surat sudah berisi pesan; <br>  <b>NU_TIMEOUT</b> - setelah batas waktu habis, kotak surat masih penuh; <br>  <b>NU_MAILBOX_DELETED</b> - Kotak surat dihapus saat tugas ditangguhkan. <br>  <b>NU_MAILBOX_RESET</b> - kotak surat diatur ulang saat tugas ditangguhkan. <br><br><h2>  Kompatibel dengan RTOS Inti </h2><br>  Seperti semua objek Nucleus SE lainnya, tujuan saya adalah untuk memaksimalkan kompatibilitas kode aplikasi dengan Nucleus RTOS.  Kotak surat tidak terkecuali dan, dari sudut pandang pengguna, mereka diimplementasikan dengan cara yang sama seperti di Nucleus RTOS.  Ada juga ketidakcocokan tertentu, yang saya anggap dapat diterima mengingat bahwa, sebagai akibatnya, kode akan menjadi lebih mudah dimengerti dan lebih efisien dalam hal jumlah memori yang diperlukan.  Jika tidak, panggilan Nucleus RTOS API dapat langsung dipindahkan ke Nucleus SE. <br><br><h3>  Pengidentifikasi Objek </h3><br>  Dalam Nucleus RTOS, semua objek dijelaskan oleh struktur data (unit kontrol) dari tipe tertentu.  Penunjuk ke unit kontrol ini berfungsi sebagai pengidentifikasi untuk kotak surat.  Saya memutuskan bahwa dalam Nucleus SE, diperlukan pendekatan yang berbeda untuk penggunaan memori yang efisien: semua objek kernel dijelaskan oleh seperangkat tabel dalam RAM dan / atau ROM.  Ukuran tabel ini ditentukan oleh jumlah objek yang dikonfigurasi dari setiap jenis.  Pengidentifikasi objek tertentu adalah indeks dalam tabel ini.  Jadi saya mendefinisikan <b>NUSE_MAILBOX</b> sebagai setara dengan <b>U8</b> , variabel (bukan pointer) dari tipe ini berfungsi sebagai pengidentifikasi kotak surat.  Ketidakcocokan sedikit ini mudah ditangani jika kode porting dari Nucleus SE ke Nucleus RTOS dan sebaliknya.  Biasanya, tidak ada operasi yang dilakukan pada pengidentifikasi objek selain memindahkan dan menyimpan. <br><br>  Nucleus RTOS juga mendukung penamaan kotak surat.  Nama-nama ini hanya digunakan untuk debugging.  Saya mengecualikan mereka dari Nucleus SE untuk menghemat memori. <br><br><h3>  Ukuran dan jenis pesan </h3><br>  Dalam Nucleus RTOS, pesan kotak surat terdiri dari empat kata 32-bit.  Dalam Nucleus SE, saya memutuskan untuk mengurangi nilai ini menjadi satu variabel tipe <b>ADDR</b> .  Perubahan ini menghasilkan penghematan memori yang signifikan dan mengurangi waktu pelaksanaan tugas.  Ini juga menunjukkan bahwa penggunaan kotak surat yang biasa adalah untuk meneruskan informasi dari satu tugas ke tugas lainnya.  Ketidakcocokan ini tidak akan menyebabkan masalah besar saat porting aplikasi ke Nucleus RTOS.  Nucleus SE dapat dimodifikasi jika diperlukan format pesan yang berbeda. <br><br><h3>  Panggilan API yang belum direalisasi </h3><br>  Nucleus RTOS mendukung sembilan panggilan kantor kotak surat.  Dari jumlah tersebut, empat tidak diimplementasikan dalam Nucleus SE.  Rincian dari tantangan ini, serta alasan mengapa mereka dikeluarkan dari Nucleus SE, dijelaskan di atas. <br><br>  Artikel selanjutnya akan melihat antrian. <br><br>  <b>Tentang Pengarang:</b> Colin Walls telah bekerja di industri elektronik selama lebih dari tiga puluh tahun, mencurahkan sebagian besar waktunya untuk firmware.  Dia sekarang adalah seorang insinyur firmware di Mentor Embedded (sebuah divisi dari Mentor Graphics).  Colin Walls sering berbicara di konferensi dan seminar, penulis berbagai artikel teknis dan dua buku tentang firmware.  Tinggal di Inggris.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Blog</a> profesional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Colin</a> , email: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id431118/">https://habr.com/ru/post/id431118/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id431106/index.html">Berapa banyak uang yang dihabiskan orang Amerika Black Friday ini, dan apa hubungannya smartphone dengan itu?</a></li>
<li><a href="../id431108/index.html">Cara mengubah citra satelit menjadi peta. Visi komputer dalam Yandex</a></li>
<li><a href="../id431110/index.html">Berhenti memberi makan penerbit. UE sedang mengembangkan aturan untuk akses gratis wajib untuk penelitian</a></li>
<li><a href="../id431112/index.html">Cara menggunakan metode kuadrat terkecil untuk mengevaluasi sumber daya dan memonitor database Oracle</a></li>
<li><a href="../id431116/index.html">Ingin aneh: ulasan tentang konferensi DartUP mendatang di St. Petersburg</a></li>
<li><a href="../id431120/index.html">Penderitaan di tempat kerja tidak perlu</a></li>
<li><a href="../id431122/index.html">Grafana sebagai alat lain untuk pemantauan teknis produk perangkat lunak kami</a></li>
<li><a href="../id431124/index.html">"Ilmu Data, seperti matematika dan fisika, adalah cara lain untuk menjelajahi dunia di sekitar Anda."</a></li>
<li><a href="../id431126/index.html">Mengapa Anda tidak harus menghemat PM profesional</a></li>
<li><a href="../id431128/index.html">Meretas DDR3 SPD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>