<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🎓 👐🏾 🚹 Die Hintertür und der Buhtrap-Verschlüsseler wurden mit Yandex.Direct verteilt 🧑🏾‍🤝‍🧑🏻 🔲 🖤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Um einen Cyberangriff auf Buchhalter zu zielen, können Sie die Arbeitsdokumente verwenden, nach denen sie im Netzwerk suchen. So etwas war in den letz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die Hintertür und der Buhtrap-Verschlüsseler wurden mit Yandex.Direct verteilt</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/450126/"> Um einen Cyberangriff auf Buchhalter zu zielen, können Sie die Arbeitsdokumente verwenden, nach denen sie im Netzwerk suchen.  So etwas war in den letzten Monaten eine Cyber-Gruppe, die die bekannten Backdoors <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Buhtrap</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTM</a> sowie Verschlüsseler und Software zum Stehlen von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kryptowährungen</a> vertreibt.  Die meisten Ziele befinden sich in Russland.  Der Angriff wird durch Platzieren bösartiger Anzeigen in Yandex.Direct implementiert.  Potenzielle Opfer gingen zu einer Website, auf der sie aufgefordert wurden, eine als Dokumentvorlage getarnte schädliche Datei herunterzuladen.  Yandex hat nach unserer Warnung schädliche Anzeigen entfernt. <br><br>  Buhtrap-Quellcode wurde in der Vergangenheit in das Netzwerk integriert, sodass jeder ihn verwenden kann.  Wir haben keine Informationen zur Verfügbarkeit von RTM-Code. <br><br>  In einem Beitrag erfahren Sie, wie Angreifer Malware mithilfe von Yandex.Direct verbreitet und auf GitHub gehostet haben.  Die Stelle wird durch eine technische Analyse der Malvari ergänzt. <br><br><img src="https://habrastorage.org/webt/y3/h0/ly/y3h0lyhh0aq4jl6dwpvaia-vf2q.png"><br><br><a name="habracut"></a><h2>  Buhtrap und RTM wieder im Geschäft </h2><br><h4>  Verteilungsmechanismus und Opfer </h4><br>  Die verschiedenen Nutzlasten, die an die Opfer geliefert werden, werden durch einen gemeinsamen Verteilungsmechanismus vereint.  Alle von Cyberkriminellen erstellten schädlichen Dateien befanden sich in zwei verschiedenen GitHub-Repositorys. <br><br>  Normalerweise wurde im Repository eine schädliche Datei heruntergeladen, die sich häufig änderte.  Da Sie den Verlauf der Änderungen im Repository auf GitHub sehen können, können wir sehen, welche Art von Malware sich in einem bestimmten Zeitraum verbreitet hat.  Um das Opfer davon zu überzeugen, eine schädliche Datei herunterzuladen, wurde die in der obigen Abbildung gezeigte Site blanki-shabloni24 [.] Ru verwendet. <br><br>  Das Design der Website und alle Namen der schädlichen Dateien sind in einem einzigen Konzept konsistent - Formulare, Vorlagen, Verträge, Beispiele usw. Da Buhtrap- und RTM-Software in der Vergangenheit bei Angriffen auf Buchhalter verwendet wurden, gingen wir davon aus, dass die Strategie in der neuen Kampagne dieselbe ist.  Die Frage ist nur, wie das Opfer auf die Baustelle der Angreifer gelangt ist. <br><br><h4>  Infektion </h4><br>  Zumindest einige potenzielle Opfer auf dieser Website wurden von böswilliger Werbung angezogen.  Das Folgende ist eine Beispiel-URL: <br><br> <code>https://blanki-shabloni24.ru/?utm_source=yandex&amp;utm_medium=banner&amp;utm_campaign=cid|{blanki_rsya}|context&amp;utm_content=gid|3590756360|aid|6683792549|15114654950_&amp;utm_term=  &amp;pm_source=bb.f2.kz&amp;pm_block=none&amp;pm_position=0&amp;yclid=1029648968001296456</code> <br> <br>  Wie Sie dem Link entnehmen können, wurde das Banner im legitimen Buchhaltungsforum bb.f2 [.] Kz veröffentlicht.  Es ist wichtig zu beachten, dass Banner auf verschiedenen Websites angezeigt wurden, alle dieselbe Kampagnen-ID (blanki_rsya) hatten und sich hauptsächlich auf Buchhaltungs- oder Rechtshilfedienste bezogen.  Aus der URL geht hervor, dass das potenzielle Opfer das Anforderungsformular „Konto herunterladen“ verwendet hat, was unsere Hypothese über gezielte Angriffe bestätigt.  Nachfolgend sind die Websites aufgeführt, auf denen die Banner und die zugehörigen Suchanfragen angezeigt wurden. <br><br><ul><li>  Kontoformular herunterladen - bb.f2 [.] kz </li><li>  Mustervertrag - Ipopen [.] en </li><li>  Aussage Beschwerde Probe - 77metrov [.] ru </li><li>  Vertragsformular - blank-dogovor-kupli-prodazhi [.] en </li><li>  Petitionsbeispiel - zen.yandex [.] ru </li><li>  Beispielbeschwerde - yurday [.] en </li><li>  Mustervertragsformulare - Regforum [.] en </li><li>  Vertragsform - assistentus [.] en </li><li>  Musterwohnungsvereinbarung - napravah [.] com </li><li>  legale Vertragsproben - avito [.] ru </li></ul><br>  Die Stelle blanki-shabloni24 [.] Ru wurde möglicherweise für eine einfache visuelle Beurteilung eingerichtet.  Werbung, die zu einer professionell aussehenden Website mit einem Link zu GitHub führt, sieht in der Regel nicht nach etwas offensichtlich Schlechtem aus.  Darüber hinaus haben Angreifer schädliche Dateien nur für einen begrenzten Zeitraum, wahrscheinlich während der Kampagne, in das Repository hochgeladen.  Der größte Teil des Repositorys auf GitHub war ein leeres Zip-Archiv oder eine saubere Exe-Datei.  Auf diese Weise konnten Angreifer Werbung über Yandex.Direct auf Websites verbreiten, die höchstwahrscheinlich von Buchhaltern besucht wurden, die für bestimmte Suchanfragen kamen. <br><br>  Betrachten Sie als nächstes die verschiedenen Nutzlasten, die auf diese Weise verteilt werden. <br><br><h2>  Nutzlastanalyse </h2><br><h4>  Verteilungszeitleiste </h4><br>  Die Malware-Kampagne begann Ende Oktober 2018 und ist zum Zeitpunkt des Schreibens des Beitrags aktiv.  Da das gesamte Repository auf GitHub öffentlich verfügbar war, haben wir eine genaue Chronologie der Verteilung von sechs verschiedenen Malware-Familien zusammengestellt (siehe Abbildung unten).  Wir haben eine Linie hinzugefügt, die den Moment anzeigt, in dem eine Bannerverbindung gemäß ESET-Telemetrie erkannt wurde, um sie mit dem Git-Verlauf zu vergleichen.  Wie Sie sehen können, korreliert dies gut mit der Verfügbarkeit der Nutzdaten auf GitHub.  Die Diskrepanz Ende Februar kann durch das Fehlen eines Teils des Änderungsverlaufs erklärt werden, da das Repository aus GitHub gelöscht wurde, bevor wir es vollständig erhalten konnten. <br><br><img src="https://habrastorage.org/webt/sa/ua/1i/saua1i6vupxtv2pa-tvwawje8em.png"><br>  <i>Abbildung 1. Chronologie der Verteilung von Malvari.</i> <br><br><h4>  Zertifikatsignaturzertifikate </h4><br>  Die Kampagne verwendete viele Zertifikate.  Einige haben mehr als eine Malware-Familie signiert, was zusätzlich darauf hinweist, dass verschiedene Beispiele zur selben Kampagne gehören.  Trotz der Verfügbarkeit des privaten Schlüssels haben die Bediener die Binärdateien nicht systematisch signiert und den Schlüssel nicht für alle Beispiele verwendet.  Ende Februar 2019 begannen Angreifer, ungültige Signaturen mit einem Zertifikat von Google zu erstellen, für das sie keinen privaten Schlüssel haben. <br><br>  Alle an der Kampagne beteiligten Zertifikate und die von ihnen unterzeichneten Malvari-Familien sind in der folgenden Tabelle aufgeführt. <br><br><img src="https://habrastorage.org/webt/wg/q_/-8/wgq_-807r6mtilzeam28lhbbrvi.png"><br><br>  Wir haben diese Codesignaturzertifikate auch verwendet, um mit anderen Malware-Familien zu kommunizieren.  Bei den meisten Zertifikaten wurden keine Beispiele gefunden, die nicht über das GitHub-Repository verteilt würden.  Das TOV-Zertifikat „MARIYA“ wurde jedoch verwendet, um die Malvari zu signieren, die dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Botnetz</a> , der Adware und den Bergleuten von Wauchos gehört.  Es ist unwahrscheinlich, dass diese Malware mit dieser Kampagne in Verbindung gebracht wird.  Höchstwahrscheinlich wurde das Zertifikat im Darknet gekauft. <br><br><h4>  Win32 / Filecoder.Buhtrap </h4><br>  Die erste Komponente, die unsere Aufmerksamkeit auf sich zog, war die erste entdeckte Win32 / Filecoder.Buhtrap.  Dies ist eine Delphi-Binärdatei, die manchmal gepackt werden kann.  Es wurde hauptsächlich von Februar bis März 2019 vertrieben.  Es verhält sich wie ein Ransomware-Programm - es sucht nach lokalen Festplatten und Netzwerkordnern und verschlüsselt die erkannten Dateien.  Um Kompromisse einzugehen, benötigt er keine Internetverbindung, da er den Server nicht kontaktiert, um Verschlüsselungsschlüssel zu senden.  Stattdessen fügt er am Ende der Rückkaufnachricht ein „Token“ hinzu und schlägt vor, E-Mail oder Bitmessage für die Kommunikation mit den Betreibern zu verwenden. <br><br>  Um so viele wichtige Ressourcen wie möglich zu verschlüsseln, startet Filecoder.Buhtrap einen Stream zum Herunterfahren von Schlüsselsoftware, die möglicherweise offene Dateihandler mit wertvollen Informationen enthält, die die Verschlüsselung beeinträchtigen können.  Zielprozesse sind hauptsächlich Datenbankverwaltungssysteme (DBMS).  Darüber hinaus löscht Filecoder.Buhtrap Protokolldateien und Sicherungen, um die Datenwiederherstellung zu erschweren.  Dazu wird das folgende Batch-Skript ausgeführt. <br><br> <code>bcdedit /set {default} bootstatuspolicy ignoreallfailures <br> bcdedit /set {default} recoveryenabled no <br> wbadmin delete catalog -quiet <br> wbadmin delete systemstatebackup <br> wbadmin delete systemstatebackup -keepversions:0 <br> wbadmin delete backup <br> wmic shadowcopy delete <br> vssadmin delete shadows /all /quiet <br> reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default" /va /f <br> reg delete "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" /f <br> reg add "HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers" <br> attrib "%userprofile%\documents\Default.rdp" -s -h <br> del "%userprofile%\documents\Default.rdp" <br> wevtutil.exe clear-log Application <br> wevtutil.exe clear-log Security <br> wevtutil.exe clear-log System <br> sc config eventlog start=disabled</code> <br> <br>  Filecoder.Buhtrap verwendet den legitimen Onlinedienst IP Logger, der zum Sammeln von Informationen über Website-Besucher erstellt wurde.  Dies soll die Opfer des Encoders verfolgen, für den die Kommandozeile verantwortlich ist: <br><br> <code>mshta.exe "javascript:document.write('');"</code> <br> <br>  Dateien für die Verschlüsselung werden im Falle einer Nichtübereinstimmung in den drei Ausnahmelisten ausgewählt.  Erstens werden Dateien mit den folgenden Erweiterungen nicht verschlüsselt: .com, .cmd, .cpl, .dll, .exe, .hta, .lnk, .msc, .msi, .msp, .pif, .scr, .sys und .bat.  Zweitens werden alle Dateien ausgeschlossen, für die der vollständige Pfad Verzeichniszeilen aus der folgenden Liste enthält. <br><br> <code>\.{ED7BA470-8E54-465E-825C-99712043E01C}\ <br> \tor browser\ <br> \opera\ <br> \opera software\ <br> \mozilla\ <br> \mozilla firefox\ <br> \internet explorer\ <br> \google\chrome\ <br> \google\ <br> \boot\ <br> \application data\ <br> \apple computer\safari\ <br> \appdata\ <br> \all users\ <br> :\windows\ <br> :\system volume information\ <br> :\nvidia\ <br> :\intel\</code> <br> <br>  Drittens werden auch bestimmte Dateinamen von der Verschlüsselung ausgeschlossen, darunter der Name der Nachrichtendatei mit Lösegeldforderung.  Die Liste ist unten dargestellt.  Offensichtlich sind alle diese Ausnahmen darauf ausgelegt, die Fähigkeit zum Starten der Maschine zu erhalten, jedoch mit minimaler Verwendbarkeit. <br><br> <code>boot.ini <br> bootfont.bin <br> bootsect.bak <br> desktop.ini <br> iconcache.db <br> ntdetect.com <br> ntldr <br> ntuser.dat <br> ntuser.dat.log <br> ntuser.ini <br> thumbs.db <br> winupas.exe <br> your files are now encrypted.txt <br> windows update assistant.lnk <br> master.exe <br> unlock.exe <br> unlocker.exe</code> <br> <br><h4>  Dateiverschlüsselungsschema </h4><br>  Nach dem Start generiert die Malware ein Paar 512-Bit-RSA-Schlüssel.  Der private Exponent (d) und das Modul (n) werden dann mit einem fest codierten öffentlichen 2048-Bit-Schlüssel (öffentlicher Exponent und Modul) verschlüsselt, in zlib-Wrapped und in base64 codiert.  Der dafür verantwortliche Code ist in Abbildung 2 dargestellt. <br><br><img src="https://habrastorage.org/webt/c_/p_/g9/c_p_g9rfnoggxyffe9jedxgibrk.png"><br>  <i>Abbildung 2. Das Ergebnis der Hex-Rays-Dekompilierung des Prozesses zum Generieren eines 512-Bit-RSA-Schlüsselpaars.</i> <br><br>  Das Folgende ist ein Beispiel für einfachen Text mit einem generierten privaten Schlüssel, der ein Token ist, das an die Lösegeldnachricht angehängt ist. <br><br> <code>DF9228F4F3CA93314B7EE4BEFC440030665D5A2318111CC3FE91A43D781E3F91BD2F6383E4A0B4F503916D75C9C576D5C2F2F073ADD4B237F7A2B3BF129AE2F399197ECC0DD002D5E60C20CE3780AB9D1FE61A47D9735036907E3F0CF8BE09E3E7646F8388AAC75FF6A4F60E7F4C2F697BF6E47B2DBCDEC156EAD854CADE53A239</code> <br> <br>  Der öffentliche Schlüssel des Angreifers wird unten angezeigt. <br><br> <code>e = 0x72F750D7A93C2C88BFC87AD4FC0BF4CB45E3C55701FA03D3E75162EB5A97FDA7ACF8871B220A33BEDA546815A9AD9AA0C2F375686F5009C657BB3DF35145126C71E3C2EADF14201C8331699FD0592C957698916FA9FEA8F0B120E4296193AD7F3F3531206608E2A8F997307EE7D14A9326B77F1B34C4F1469B51665757AFD38E88F758B9EA1B95406E72B69172A7253F1DFAA0FA02B53A2CC3A7F0D708D1A8CAA30D954C1FEAB10AD089EFB041DD016DCAAE05847B550861E5CACC6A59B112277B60AC0E4E5D0EA89A5127E93C2182F77FDA16356F4EF5B7B4010BCCE1B1331FCABFFD808D7DAA86EA71DFD36D7E701BD0050235BD4D3F20A97AAEF301E785005 <br> n = 0x212ED167BAC2AEFF7C3FA76064B56240C5530A63AB098C9B9FA2DE18AF9F4E1962B467ABE2302C818860F9215E922FC2E0E28C0946A0FC746557722EBB35DF432481AC7D5DDF69468AF1E952465E61DDD06CDB3D924345A8833A7BC7D5D9B005585FE95856F5C44EA917306415B767B684CC85E7359C23231C1DCBBE714711C08848BEB06BD287781AEB53D94B7983EC9FC338D4320129EA4F568C410317895860D5A85438B2DA6BB3BAAE9D9CE65BCEA6760291D74035775F28DF4E6AB1A748F78C68AB07EA166A7309090202BB3F8FBFC19E44AC0B4D3D0A37C8AA5FA90221DA7DB178F89233E532FF90B55122B53AB821E1A3DB0F02524429DEB294B3A4EDD</code> <br> <br>  Dateien werden mit AES-128-CBC mit einem 256-Bit-Schlüssel verschlüsselt.  Für jede verschlüsselte Datei werden ein neuer Schlüssel und ein neuer Initialisierungsvektor generiert.  Wichtige Informationen werden am Ende der verschlüsselten Datei hinzugefügt.  Betrachten Sie das verschlüsselte Dateiformat. <br>  Verschlüsselte Dateien haben den folgenden Header: <br><br><img src="https://habrastorage.org/webt/lo/-e/7m/lo-e7mo1l2ta7ie0n2rlz0ybirs.png"><br><br>  Die Daten der Quelldatei mit dem zusätzlichen magischen VEGA-Wert werden bis zu den ersten 0x5000 Bytes verschlüsselt.  Alle Informationen zur Entschlüsselung werden an eine Datei mit folgender Struktur angehängt: <br><br><img src="https://habrastorage.org/webt/iw/hy/az/iwhyaz2vw5c45i6vk0s4hs_sadq.png"><br><br>  - Die Dateigrößenmarkierung enthält eine Beschriftung, die angibt, ob die Datei größer als 0x5000 Byte ist <br>  - AES-Schlüssel-Blob = ZlibCompress (RSAEncrypt (AES-Schlüssel + IV, öffentlicher Schlüssel des generierten RSA-Schlüsselpaars) <br>  - RSA-Schlüssel-Blob = ZlibCompress (RSAEncrypt (generierter privater RSA-Schlüssel, fest codierter öffentlicher RSA-Schlüssel)) <br><br><h4>  Win32 / ClipBanker </h4><br>  Win32 / ClipBanker ist eine Komponente, die von Ende Oktober bis Anfang Dezember 2018 zeitweise verteilt wurde.  Seine Aufgabe ist es, den Inhalt der Zwischenablage zu verfolgen, er sucht nach den Adressen von Kryptowährungs-Wallets.  Nachdem ClipBanker die Adresse der Zielbrieftasche ermittelt hat, ersetzt sie diese durch die Adresse, die angeblich den Betreibern gehört.  Die von uns untersuchten Proben waren weder verpackt noch verschleiert.  Der einzige Mechanismus zum Maskieren des Verhaltens ist die Zeichenfolgenverschlüsselung.  Die Adressen der Geldbörsen der Bediener werden mit RC4 verschlüsselt.  Ziel-Kryptowährungen - Bitcoin, Bitcoin-Bargeld, Dogecoin, Ethereum und Ripple. <br><br>  Während des Malware-Verteilungszeitraums wurde ein kleiner Betrag an das MTC an die Bitcoin-Brieftaschen des Angreifers gesendet, was den Erfolg der Kampagne in Frage stellt.  Darüber hinaus gibt es keinen Grund anzunehmen, dass diese Transaktionen im Allgemeinen mit ClipBanker zusammenhängen. <br><br><h4>  Win32 / RTM </h4><br>  Die Win32 / RTM-Komponente wurde Anfang März 2019 für mehrere Tage verteilt.  RTM ist ein in Delphi ansässiger Trojaner-Banker, der sich an Remote-Bankensysteme richtet.  Im Jahr 2017 veröffentlichten ESET-Forscher eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">detaillierte Analyse</a> dieses Programms, die Beschreibung ist immer noch relevant.  Im Januar 2019 veröffentlichte Palo Alto Networks auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Blogbeitrag über RTM</a> . <br><br><h4>  Buhtrap Downloader </h4><br>  Im Gegensatz zu früheren Buhtrap-Tools war auf GitHub für einige Zeit ein Downloader verfügbar.  Es geht für den nächsten Schritt zu <code>https://94.100.18[.]67/RSS.php?&lt;some_id&gt;</code> und lädt es direkt in den Speicher.  Es können zwei Verhaltensweisen des Codes der zweiten Stufe unterschieden werden.  In der ersten URL hat RSS.php die Buhtrap-Hintertür direkt passiert - diese Hintertür ist der nach dem Quellcode-Leck verfügbaren sehr ähnlich. <br><br>  Interessanterweise sehen wir mehrere Kampagnen mit einer Buhtrap-Hintertür, die vermutlich von verschiedenen Betreibern geleitet werden.  In diesem Fall besteht der Hauptunterschied darin, dass die Hintertür direkt in den Speicher geladen wird und nicht das übliche Schema für den DLL-Bereitstellungsprozess verwendet, über den wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zuvor</a> gesprochen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">haben</a> .  Darüber hinaus haben die Betreiber den RC4-Schlüssel geändert, mit dem der Netzwerkverkehr zum C &amp; C-Server verschlüsselt wird.  In den meisten Kampagnen, die wir gesehen haben, war es den Betreibern nicht wichtig, diesen Schlüssel zu ändern. <br><br>  Das zweite, komplexere Verhalten - die RSS.php-URL wurde von einem anderen Loader übergeben.  Es wurde eine Verschleierung implementiert, z. B. das Neuerstellen einer dynamischen Importtabelle.  Der Bootloader dient dazu, den C &amp; C-Server <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">msiofficeupd</a> [.] Com / api / F27F84EDA4D13B15 / 2 zu kontaktieren, Protokolle zu senden und auf eine Antwort zu warten.  Es verarbeitet die Antwort als Blob, lädt sie in den Speicher und führt sie aus.  Die Nutzlast, die wir beim Ausführen dieses Laders gesehen haben, war dieselbe Buhtrap-Hintertür, aber möglicherweise sind andere Komponenten vorhanden. <br><br><h4>  Android / Spy.Banker </h4><br>  Interessanterweise wurde auch eine Komponente für Android im GitHub-Repository gefunden.  Er war nur einen Tag in der Hauptniederlassung - am 1. November 2018.  ESET-Telemetrie wird nicht nur auf GitHub gehostet, sondern findet auch keine Hinweise auf die Verbreitung dieser Malware. <br><br>  Die Komponente wurde als Android Application Package (APK) gehostet.  Er ist sehr verschleiert.  Böswilliges Verhalten ist in der verschlüsselten JAR in der APK versteckt.  Es ist RC4-verschlüsselt mit diesem Schlüssel: <br><br> <code>key = [ <br> 0x87, 0xd6, 0x2e, 0x66, 0xc5, 0x8a, 0x26, 0x00, 0x72, 0x86, 0x72, 0x6f, <br> 0x0c, 0xc1, 0xdb, 0xcb, 0x14, 0xd2, 0xa8, 0x19, 0xeb, 0x85, 0x68, 0xe1, <br> 0x2f, 0xad, 0xbe, 0xe3, 0xb9, 0x60, 0x9b, 0xb9, 0xf4, 0xa0, 0xa2, 0x8b, 0x96 <br> ]</code> <br> <br>  Der gleiche Schlüssel und Algorithmus werden zum Verschlüsseln von Zeichenfolgen verwendet.  JAR befindet sich in <code>APK_ROOT + image/files</code> .  Die ersten 4 Bytes der Datei enthalten die Länge der verschlüsselten JAR, die unmittelbar nach dem Längenfeld beginnt. <br><br>  Nachdem wir die Datei entschlüsselt hatten, stellten wir fest, dass es sich um Anubis handelt - einen zuvor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dokumentierten</a> Banker für Android.  Schädliche Software hat folgende Funktionen: <br><br><ul><li>  Mikrofonaufnahme </li><li>  Screenshots machen </li><li>  GPS-Koordinaten erhalten </li><li>  Keylogger </li><li>  Gerätedatenverschlüsselung und Lösegeldforderung </li><li>  Spam </li></ul><br>  Interessanterweise nutzte der Banker Twitter als Backup-Kommunikationskanal, um einen weiteren C &amp; C-Server zu erhalten.  Die von uns analysierte Stichprobe verwendete das @ JohnsTrader-Konto, war jedoch zum Zeitpunkt der Analyse bereits gesperrt. <br><br>  Der Banker enthält eine Liste der Zielanwendungen auf einem Android-Gerät.  Es ist länger geworden als die Liste aus der Sophos-Studie.  Die Liste enthält viele Bankanwendungen, Online-Einkaufsprogramme wie Amazon und eBay sowie Kryptowährungsdienste. <br><br><h4>  MSIL / ClipBanker.IH </h4><br>  Die letzte Komponente, die im Rahmen dieser Kampagne verteilt wurde, war die ausführbare .NET Windows-Datei, die im März 2019 veröffentlicht wurde.  Die meisten der untersuchten Versionen wurden von ConfuserEx v1.0.0 gepackt.  Wie ClipBanker verwendet diese Komponente die Zwischenablage.  Ihr Ziel ist eine breite Palette von Kryptowährungen sowie Angebote auf Steam.  Darüber hinaus wird der IP-Logger-Dienst verwendet, um den privaten WIF-Schlüssel von Bitcoin zu stehlen. <br><br>  Schutzmechanismen <br>  Zusätzlich zu den Vorteilen, die ConfuserEx in Form von Debugging, Dumping und Manipulation bietet, kann die Komponente Antivirenprodukte und virtuelle Maschinen erkennen. <br><br>  Um den Start in einer virtuellen Maschine zu überprüfen, verwendet die Malware die in Windows integrierte WMI-Befehlszeile (WMIC), um Informationen zum BIOS anzufordern, nämlich: <br><br> <code>wmic bios</code> <br> <br>  Anschließend analysiert das Programm die Ausgabe des Befehls und sucht nach Schlüsselwörtern: VBOX, VirtualBox, XEN, qemu, bochs, VM. <br><br>  Um Antivirenprodukte zu erkennen, sendet Malware mithilfe der <code>ManagementObjectSearcher</code> API eine WMI-Anforderung (Windows Management Instrumentation) an das Windows-Sicherheitscenter.  Nach dem Dekodieren von base64 sieht der Aufruf folgendermaßen aus: <br><br> <code>ManagementObjectSearcher('root\\SecurityCenter2', 'SELECT * FROM AntivirusProduct')</code> <br> <br><img src="https://habrastorage.org/webt/wb/xv/tv/wbxvtvcwmxo9w45kjramkqmcy-s.png"><br>  <i>Abbildung 3. Der Prozess zur Bestimmung von Antivirenprodukten.</i> <br><br>  Darüber hinaus überprüft die Malware, ob <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CryptoClipWatcher</a> , ein Tool zum Schutz vor Angriffen in der Zwischenablage, ausgeführt wird. Wenn es ausgeführt wird, werden alle Threads dieses Prozesses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">angehalten</a> , wodurch der Schutz deaktiviert wird. <br><br><h4>  Ausdauer </h4><br>  Die von uns untersuchte Malware-Version kopiert sich selbst in <code>%APPDATA%\google\updater.exe</code> und setzt das Attribut "hidden" auf das Google-Verzeichnis.  Anschließend wird der Wert von <code>Software\Microsoft\Windows NT\CurrentVersion\Winlogon\shell</code> in der Windows-Registrierung <code>updater.exe</code> und der Pfad <code>updater.exe</code> .  Malware wird also jedes Mal ausgeführt, wenn sich ein Benutzer anmeldet. <br><br><h4>  Bösartiges Verhalten </h4><br>  Wie ClipBanker überwacht die Malware den Inhalt der Zwischenablage und sucht nach den Adressen von Kryptowährungs-Wallets. Wenn sie gefunden wird, ersetzt sie diese durch eine der Adressen des Bedieners.  Unten finden Sie eine Liste der Zieladressen basierend auf den Angaben im Code. <br><br> <code>BTC_P2PKH, BTC_P2SH, BTC_BECH32, BCH_P2PKH_CashAddr, BTC_GOLD, LTC_P2PKH, LTC_BECH32, LTC_P2SH_M, ETH_ERC20, XMR, DCR, XRP, DOGE, DASH, ZEC_T_ADDR, ZEC_Z_ADDR, STELLAR, NEO, ADA, IOTA, NANO_1, NANO_3, BANANO_1, BANANO_3, STRATIS, NIOBIO, LISK, QTUM, WMZ, WMX, WME, VERTCOIN, TRON, TEZOS, QIWI_ID, YANDEX_ID, NAMECOIN, B58_PRIVATEKEY, STEAM_URL</code> <br> <br>  Für jeden Adresstyp gibt es einen entsprechenden regulären Ausdruck.  Der Wert STEAM_URL wird verwendet, um das Steam-System anzugreifen, wie aus dem regulären Ausdruck ersichtlich ist, der zur Bestimmung im Puffer verwendet wird: <br><br> <code>\b(https:\/\/|http:\/\/|)steamcommunity\.com\/tradeoffer\/new\/\?partner=[0-9]+&amp;token=[a-zA-Z0-9]+\b</code> <br> <br><h4>  Exfiltrationskanal </h4><br>  Die Malware ersetzt nicht nur Adressen im Puffer, sondern richtet sich auch an private WIF-Schlüssel von Bitcoin-, Bitcoin Core- und Electrum Bitcoin-Geldbörsen.  Das Programm verwendet plogger.org als Exfiltrationskanal, um den privaten WIF-Schlüssel zu erhalten.  Zu diesem Zweck fügen die Operatoren die privaten Schlüsseldaten zum User-Agent-HTTP-Header hinzu, wie unten gezeigt. <br><br><img src="https://habrastorage.org/webt/fz/xc/us/fzxcusdwmjnv8irew2lhlnlg7ss.png"><br>  <i>Abbildung 4. IP Logger-Konsole mit Ausgabe.</i> <br><br>  Die Betreiber haben iplogger.org nicht zum Exfiltrieren von Brieftaschen verwendet.  Wahrscheinlich haben sie aufgrund der Beschränkung von 255 Zeichen im Feld <code>User-Agent</code> , das in der IP Logger-Weboberfläche angezeigt wird, auf eine andere Methode zurückgegriffen.  In den untersuchten Beispielen wurde ein anderer Server zur Ausgabe von Daten in der Umgebungsvariablen <code>DiscordWebHook</code> gespeichert.  Überraschenderweise wird diese Umgebungsvariable an keiner Stelle im Code zugewiesen.  Dies deutet darauf hin, dass sich die Malware noch in der Entwicklung befindet und die Variable auf dem Testcomputer des Bedieners zugewiesen ist. <br><br>  Es gibt ein weiteres Zeichen dafür, dass sich das Programm in der Entwicklung befindet.  Die Binärdatei enthält zwei iplogger.org-URLs, und beim Exfiltrieren der Daten wird eine Anforderung an beide gesendet.  Bei einer Anforderung an eine dieser URLs steht vor dem Wert im Feld Referer "DEV /".  Wir haben auch eine Version gefunden, die nicht mit ConfuserEx gepackt wurde. Der Empfänger für diese URL heißt DevFeedbackUrl.  Basierend auf dem Namen der Umgebungsvariablen glauben wir, dass Betreiber planen, den legitimen Discord-Dienst und sein Web-Interception-System zu verwenden, um Kryptowährungs-Wallets zu stehlen. <br><br><h2>  Fazit </h2><br>  Diese Kampagne ist ein Beispiel für die Verwendung legitimer Werbedienste bei Cyber-Angriffen.  Das Programm richtet sich an russische Organisationen, aber wir werden nicht überrascht sein, wenn ein solcher Angriff nichtrussische Dienste nutzt.  Um Kompromisse zu vermeiden, müssen Benutzer auf den Ruf der Quelle der heruntergeladenen Software vertrauen können. <br><br>  Eine vollständige Liste der MITRE ATT &amp; CK-Indikatoren für Kompromisse und Attribute finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450126/">https://habr.com/ru/post/de450126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450116/index.html">Betriebssysteme: Drei einfache Teile. Teil 5: Planung: Mehrstufige Feedback-Warteschlange (Übersetzung)</a></li>
<li><a href="../de450118/index.html">Streamen Sie den Bildschirm über das Netzwerk auf mehrere Geräte</a></li>
<li><a href="../de450120/index.html">Suchen Sie nach ähnlichen Bildern und analysieren Sie einen einzelnen Algorithmus</a></li>
<li><a href="../de450122/index.html">Startup Digest: Genetics (Januar - März 2019)</a></li>
<li><a href="../de450124/index.html">Konfigurieren von OsmAnd-Karten der Strava-Heatmap-Ebene</a></li>
<li><a href="../de450128/index.html">Verwendung der Minolta AF-Optik (Sony A-Mount) bei modernen spiegellosen Kameras von Sony</a></li>
<li><a href="../de450130/index.html">Überleben Teams nach dem Hackathon?</a></li>
<li><a href="../de450132/index.html">Monade kann nicht erklärt werden</a></li>
<li><a href="../de450134/index.html">Das zweite Leben von Ringen und Broschen: Wie man Schmuck mithilfe der 3D-Technologie schnell nachbaut</a></li>
<li><a href="../de450136/index.html">Wenn die Wände nicht genug sind. So schützen Sie Endpunkte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>