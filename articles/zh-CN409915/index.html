<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗼 👧 💚 创建家庭云的历史。 第2部分。创建服务器-在Debian中设置LAMP 👍🏽 🤦🏼 👋🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在创建自己的云服务的过程中，我们刚刚习惯了Debian系统 。 现在是下一步的时候了-创建和配置Web服务器，基于此服务器可以启动Nextcloud。 

 目录 
 第1部分。设置日常使用的Debian环境 
 第2部分。创建服务器-在Debian中设置LAMP 
 第3部分。创建个人云-安装和配...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>创建家庭云的历史。 第2部分。创建服务器-在Debian中设置LAMP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409915/"> 在创建自己的云服务的过程中，我们刚刚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">习惯了Debian系统</a> 。 现在是下一步的时候了-创建和配置Web服务器，基于此服务器可以启动Nextcloud。 <img src="https://habrastorage.org/webt/ke/r5/x8/ker5x8nlot-vrpcr5iuvyrauhvm.png"><a name="habracut"></a><br><hr><a name="chap0"></a><br><h3> 目录 </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">第1部分。设置日常使用的Debian环境</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">第2部分。创建服务器-在Debian中设置LAMP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">第3部分。创建个人云-安装和配置Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">第4部分。更新2018-Debian 9和Nextcloud 13</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第5部分。更新2019-PHP 7.2，MariaDB 10.4和Nextcloud 17</a> <br><br><hr><br><h3> 快速章节导航 </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">前言</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">软件安装</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">配置Apache2 Web服务器并通过HTTP和HTTPS协议访问它</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SQL调优</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PHP设置</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSH访问设置</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">访问保护</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Web服务器参考</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MySQL参考</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Fail2ban参考资料</a> <br><br><hr><a name="chap1"></a><br><h3> 前言 </h3><br> 这个故事的第一部分显示了设置Debian GUI的一种可能选择，以方便从Windows来Linux的人使用Debian GUI，以方便和熟悉（作者的主观观点）。 如果我仅使用主机系统来配置Debian虚拟机，那么我专门在该虚拟机中工作，在Internet上搜索信息，在Notepadqq或gedit中做笔记，通过Audacious收听音乐，通过LibreOffice等打开文件。 通过这种方式，您可以习惯并更深入地了解和欣赏使用操作系统及其环境，在标准的Debian软件包中该操作系统及其功能非常完整。 <br><br> 目前，我们的系统配置方式使得将来您只能将命令行与控制台文本编辑器（例如nano）一起使用，或者将Double Commander文件管理器与集成的Notepadqq编辑器一起使用。 可以将这两种方法结合起来，例如，通过在系统中导航并通过文件管理器编辑配置文件，以及通过控制台来编辑所有其他命令。 所有方法均等效于达到最终结果。 <br><br> 当前的目标是创建一个服务器，这部分将专门用于该服务器。 可以通过安装和使用图形界面来配置服务器，也可以不使用图形界面来配置服务器。 在第二种情况下，从上一部分开始，您可以简单地跳过有关为图形界面及其设置安装和配置软件，安装图形软件包和vmware-tools的部分。 <br><br> 我在创建服务器时使用图形界面没有任何问题：如果人们更熟悉，更方便，更舒适地在图形环境中构建第一台或第二台服务器，为什么呢？ 最后，我的带有图形界面的Web服务器工作了一年，并将根据需要工作许多年。 但是，您需要记住一些要点。 <br><br> 理想情况下，配置完成后，系统将必须在很长一段时间内无需我们干预即可运行。 我的服务器在“完成”版本中配置了两天，并且在没有干预的情况下工作了将近一年。 这意味着图形界面已用完服务器活动状态的0.05％（计算机只能工作半天），并且同时占用了以下资源：RAM，磁盘空间，处理器时间。 所有这些资源都可以更好地用于确保服务器本身的功能：例如，提高PHP的memory_limit或在硬盘驱动器上存储更多用户数据。 另外，在使用真正的远程服务器时，如果出现问题和故障，通常更容易使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">SSH访问</a> 。 在这种情况下，不希望使用图形界面，这就是为什么网络上的第二台服务器已经是没有图形环境的虚拟机，在图形环境中仅从图形软件安装了Midnight Commander，我用来浏览文件系统并通过其mcedit编辑器编辑配置文件。 因此，以下是通用说明：给定的命令着重于命令行的使用，但是，可以理解的是，用户第一次使用图形环境来配置机器，这是由于使用浏览器在本地检查所创建站点的可用性以及设置邮件程序的某些功能。 <br><br> 在创建服务器以及向其中添加新站点的过程中，我积累了一些背景知识，这些信息可能对新手用户有用。 我在安装和配置服务器的材料之后概述了它。 <br><br>  <b>注意事项</b> <br> 进一步阅读http：// 127.0.0.1（https：// 127.0.0.1）格式的构造后，进入浏览器地址栏时必须删除http：//（https：//）后面的空格。 发布本文时插入了一个空格，以防止引擎自动将文本转换为链接。 <br><br><hr><a name="chap2"></a><br><h3> 软件安装 </h3><br>  Apache和Nginx是一对开源Web服务器，全球约有55％的服务器构建在这些Web服务器上。  Apache是​​1995年以来最流行的Web服务器，我选择它是希望获得良好的文档记录和受欢迎程度，并且可以这么说，我想从头开始。 这并不意味着Nginx变得更糟：Nginx在消耗资源和负载下工作效率更高。 在俄罗斯的Internet领域，Nginx服务器约占65％，而Apache约占18％。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">集线器上张贴</a>了两台服务器的比较文章 <br><br> 安装Apache2 Web服务器： <br><br>  <b>＃apt-get install apache2 apache2-doc</b> <br><br> 仅此而已。 大约二十兆字节，并且已经安装了Web服务器。 无需重新启动或设置-服务器已经知道如何打开<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">HTML</a>页面。 但是，Internet上的现代网站不仅像二十年前一样是一组静态文件，样式，字体等。 一个现代站点包含用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">PHP</a>编写的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">脚本</a> ，动态信息（例如，文本内容，注释，用户个人资料）不是写在PHP文件旁边的文件中，而是写在一个特殊的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">SQL数据库中</a> 。 对于完整的服务器，您必须提供对这些技术的支持。 而且，这并不困难： <br><br>  <b>＃apt-get install mysql-server mysql-client phpmyadmin</b> <br>  <b>＃apt-get install php5 php5-mysql libapache2-mod-php5</b> <br><br> 在安装MySQL的过程中，将要求您设置mysql超级用户密码，并且需要选择apache2服务器以自动配置mysql的工作。 安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">phpmyadmin</a>软件包时，我同意自动配置该软件包，并在各处输入mysql根密码。 无需任何请求即可进行PHP安装。 <br><br> 我没有使用较快的PHP7或免费的MariaDB作为替代的开放SQL替代品，因此决定使用“古老的” LAMP = Linux + Apache + MySQL + PHP构建我的服务器，使用陈旧且久经考验的解决方案，以防出现问题时可以快速解决。并轻松地在Internet上找到信息。 <br><br> 三个团队（实际上可以减少到一个团队），我们在本地安装了功能完善的现代服务器。 很简单！ <br><br> 但是服务器设置所需的时间比安装其组件所需的时间长得多。 最初，在这一部分中，我想展示我的典型错误，对问题的错误解决方案以及所导致的结果，但是事实证明，一年中很多事情已经从我的记忆中删除了，我不得不从记录中恢复很多东西，因此下面仅列出了一条很小的工作说明评论，从而实现普遍的工作结果。 <br><br><hr><a name="chap3"></a><br><h3> 配置Apache2 Web服务器 </h3><br> 首先，您需要确保Web服务器正在运行。 为此，请打开浏览器并拨打地址http：// 127.0.0.1（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">localhost</a> ）。 应打开一个鼓舞人心的题词：“ Apache2 Debian默认页面。 可行！” 服务器确实可以正常工作。 如果您有2000年的一组站点文件，则可以将其放置在/ var / www / html目录中，并且该文件可能会在我们的服务器上打开。 <br><br><img src="https://habrastorage.org/webt/3t/q6/x-/3tq6x-2ahadvbbshmoxl2_3hfhc.png"><br><br> 所有基本的Web服务器设置都存储在/ etc / apache2路径中。 如果打开此目录，则可以看到主配置文件apache2.conf和目录conf-available，mod-available，sites-available。 这些目录包含带有设置的预配置文件（所谓的代码段），您可以在默认情况下简单地使用它们并进行自己的编辑，也可以将它们作为模板来创建自己的配置。 例如，在sites-available目录中是默认主机配置文件000-default.conf。 如果您打开它并进行研究，就会发现该文件只是设置了我们网站的打开路径，其地址为http：// 127.0.0.1：“ DocumentRoot / var / www / html”。 此外，“ &lt;VirtualHost *：80&gt;”行表示如果我在本地网络上释放我的计算机并在端口80（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">HTTP的</a>端口）上访问它，我将打开一个位于/ var / www路径的站点。 / html。 如何验证？ <br><br> 首先，您需要找出虚拟机在加载后分配给它的IP地址。 要查看网络适配器的配置，请执行： <br><br>  <b>＃ifconfig</b> <br><br> 在控制台上显示的信息中，很容易确定为eth0适配器设置了以下地址： <br><br> <code>inet addr:192.168.233.138</code> <br> <br> 现在在主机上，我在浏览器中打开浏览器地址http：// 192.168.233.138，并期望打开一个熟悉的页面。 但是...她没有打开。 一段时间后，我的浏览器写道：“连接超时。” 而且他写得正确。 确实，在第一部分中，我打开了防火墙，但是端口80没有打开！ 让我们解决这个问题： <br><br>  <b>＃ufw允许80</b> <br><br> 再次尝试打开地址http：// 192.168.233.138并确保打开预期的页面。 虚拟机中的虚拟主机从所有这些虚拟化的外部打开。 我们在构建自己的小型虚拟Internet方面迈出了一步。 <br><br> 除了-available目录之外，还有-enabled目录包含当前“包含”的目录。 如果查看它们，可以看到这些目录包含指向-available目录中文件的链接。 当前启用站点的目录中只有一个链接-文件/etc/apache2/sites-available/000-default.conf。 这非常方便-我们可以控制主机上或主机外的快捷方式，而无需编辑其配置文件。 另外，配置的来源是现在是否单独包含一个配置文件，当一个文件中的内容被更正而另一个文件中的内容被遗忘时，这可以防止错误。 要禁用我们的主机，您需要删除所需的快捷方式，并启用它，然后创建它。 为了不手动删除或创建快捷方式，使用特殊实用程序会更容易且更可靠。 <br><br> 禁用虚拟主机： <br><br>  <b>＃a2dissite 000-默认</b> <br><br> 打开虚拟主机： <br><br>  <b>＃a2enssite 000-默认</b> <br><br> 每次更改后，您需要重新启动主机配置或重新启动服务器： <br><br>  <b>＃服务apache2重新加载</b> <br><br> 或 <br><br>  <b>＃服务apache2重新启动</b> <br><br> 因此，现在可以获得对如何在apache中配置常规主机的基本了解，然后将显示一个示例，说明如何配置服务器以通过HTTP和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">HTTPS</a>协议工作。 <br><br> 您需要从以下事实开始：断开000默认的虚拟主机时，这样的断开不会发生。 即，该站点从虚拟机的内部和外部打开，并且无论其配置是否在启用站点的文件夹中都将打开。 这是出乎意料的，我花了相当长的时间来了解我是否做对或理解了一切。 直到最后，我仍然不明白这一点，这显然是由于以下事实：/ var / www / html路径被全局设置为DocumentRoot的默认目录。 由于我不想包含和访问不必要的内容，因此我决定放弃html目录本身，并且对于所有嵌套的/ var / www，默认情况下拒绝访问。 <br><br> 要配置默认虚拟主机，我编辑了其配置文件： <br><br>  <b>＃nano /etc/apache2/sites-available/000-default.conf</b> <br><br> 配置文件的内容如下： <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;VirtualHost *:80&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span></span></span> localhost ServerAdmin user@localhost DocumentRoot /var/www &lt;Directory /var/www&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> denied &lt;/Directory&gt; ErrorLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/error.log CustomLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/access.log combined &lt;/VirtualHost&gt;</code> </pre> <br> 使用此配置，我将默认目录重置为/ var / www，允许服务器遵循此目录中的符号链接，允许服务器执行在找到的.htaccess文件中声明的所有指令，并拒绝访问该目录。 这些操作的逻辑是，我可以控制对该目录的访问，而无需访问Web服务器的设置，也无需重新启动它。 现在，您需要检查此解决方案。 <br> 传输文件： <br><br>  <b>＃mv /var/www/html/index.html /var/www/index.html</b> <br><br> 并删除目录： <br><br>  <b>＃rm / var / www / html</b> <br><br> 我们重新启动服务器，以使新的虚拟主机默认设置生效： <br><br>  <b>＃服务apache2重新启动</b> <br><br> 创建一个文件： <br><br>  <b>＃nano /var/www/.htaccess</b> <br><br> 我们在其中写一行（不带引号）：“要求全部授予”。 <br><br> 总结一下。 现在没有路径/ var / www / html，但是默认情况下将主机重新配置为index.html文件所在的路径/ var / www，并且默认情况下，在Web服务器级别上，拒绝访问此目录，但允许本地内容在那里的.htaccess文件。 <br><br> 打开浏览器http：// 127.0.0.1，然后查看已经熟悉的页面“ Apache2 Debian Default Page”。 可行。” 现在，让我们检查“本地”访问控制的可操作性： <br> 删除.htaccess文件： <br><br>  <b>＃rm /var/www/.htaccess</b> <br><br> 然后，我们在浏览器中更新打开的页面-应该打开带有访问限制通知（禁止）的页面。 是的，所有这些工作正常，因此一切都正确完成。 <br><br> 原则上，这些简单的设置足以满足Web服务器的进一步无忧操作。 但是在我看来这还不够。 现在，我们的Web服务器只能使用HTTP协议工作。 但是HTTPS协议呢？ 毕竟，如果将来要将基于该Web服务器的项目带到Internet，那么至少需要使用该协议的能力。 我决定根据自签名<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">SSL</a>证书的创建来组织HTTPS支持。 <br><br> 首先，您需要获取将安装在我们服务器上的SSL证书。 我们没有任何域，也没有静态IP地址。 但这一切都没有关系，因为我将使用系统工具自行生成证书。 <br><br> 注意！ 以下说明假定服务器已安装在无名机器上。 如果存在真实的IP或域名，则必须在三个位置中进行指定：&lt;通用名称IP /域&gt;；  &lt;服务器名称IP /域&gt;;  &lt;重定向“ /”“ https：// IP /域/”&gt;-在适当的结构中，用IP地址或域名替换IP /域。 在下面的文本中，将使用本地主机代替IP /域。 <br><br> 生成SSL证书： <br><br>  <b>＃openssl req -x509 -nodes -days 3650 -newkey rsa：2048 -keyout /etc/ssl/private/apache-selfsigned.key -out /etc/ssl/certs/apache-selfsigned.crt</b> <br><br> 此命令将立即创建X.509标准的自签名证书，并使用密码短语跳过证书保护选项，此证书将使用十年-这是必要的，因此启动Apache服务器时无需用户干预即可读取文件，因为设置了密码，因此每次引导或重新引导后都必须输入该文件服务器。 与证书一起，将创建一个新的2048位RSA密钥，用它对证书进行签名。  –keyout和–out选项指示OpenSSL应生成密钥和证书的路径。 <br><br> 在创建证书的过程中，将询问一些问题，我向他们指出了以下数据： <br><br><blockquote> 国家/地区名称=兆瓦 <br> 州或省名称= Sun System <br> 地点名称=月球 <br> 组织名称= Hellium Inc. <br> 组织单位名称= 2 <br> 通用名称=本地主机 <br> 电子邮件地址=用户@本地主机 </blockquote><br> 接下来，创建Diffie-Hellman键以提供<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">PFS</a>支持： <br><br>  <b>＃openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048</b> <br><br> 点和加号将在终端中运行，并且在动画片结束之后，您可以创建ssl-params.conf文件，在其中定义服务器的SSL参数： <br><br>  <b>＃nano /etc/apache2/conf-available/ssl-params.conf</b> <br><br> 为了进行安全，最新的配置，我使用了生成<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">器中</a>生成的代码<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">来在mozilla.github.io上配置SSL</a> 。 在生成器中，我选择了Apache2服务器，现代配置文件，并正确设置了服务器和OpenSSL的版本，可以通过以下命令识别它们： <br><br>  <b>＃apache2 -v</b> <b><br></b>  <b>＃openssl版本</b> <br><br> 结果，我得到以下文本： <br><br><pre> <code class="apache hljs"><span class="hljs-comment"><span class="hljs-comment"># 14-01-2018 / for apache2 2.4.10 &amp; openssl 1.0.1t # from https://mozilla.github.io/server-side-tls/ssl-config-generator/ # parametrs help: https://raymii.org/s/tutorials/Strong_SSL_Security_On_Apache2.html # modern configuration, tweak to your needs SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1 SSLCipherSuite ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256 SSLHonorCipherOrder on SSLCompression off # OCSP Stapling, only in httpd 2.3.3 and later SSLUseStapling on SSLStaplingResponderTimeout 5 SSLStaplingReturnResponderErrors off SSLStaplingCache shmcb:/var/run/ocsp(128000)</span></span></code> </pre> <br> 现在为虚拟主机配置SSL支持： <br><br>  <b>＃nano /etc/apache2/sites-available/default-ssl.conf</b> <br><br> 我将此文件的文本转换为以下格式： <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;IfModule mod_ssl.c&gt;</span></span> <span class="hljs-section"><span class="hljs-section">&lt;VirtualHost _default_:443&gt;</span></span> <span class="hljs-attribute"><span class="hljs-attribute">ServerAdmin</span></span> user@localhost ServerName localhost DocumentRoot /var/www &lt;Directory /var/www&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> denied &lt;/Directory&gt; # HSTS (mod_headers is required) (15768000 seconds = 6 months) Header always set Strict-Transport-Security <span class="hljs-string"><span class="hljs-string">"max-age=15768000"</span></span> ErrorLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/error.log CustomLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/access.log combined SSLEngine <span class="hljs-literal"><span class="hljs-literal">on</span></span> SSLCertificateFile /etc/ssl/certs/apache-selfsigned.crt SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key &lt;FilesMatch <span class="hljs-string"><span class="hljs-string">"\.(cgi|shtml|phtml|php)$"</span></span>&gt; SSLOptions +StdEnvVars &lt;/FilesMatch&gt; &lt;Directory /usr/lib/cgi-bin&gt; SSLOptions +StdEnvVars &lt;/Directory&gt; BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [2-6]"</span></span> \ nokeepalive ssl-unclean-shutdown \ downgrade-1.0 force-response-1.0 BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [17-9]"</span></span> ssl-unclean-shutdown &lt;/VirtualHost&gt; &lt;/IfModule&gt;</code> </pre> <br> 从上面可以看出，我们也将/ var / www定义为DocumentRoot目录，对其访问的配置与之前的设置类似。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">启用了HSTS</a>机制，该机制有助于通过HTTPS协议强制连接。  SSL支持包括在所使用的证书和密钥中，以及在PHP和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">CGI</a>脚本中处理证书数据的支持。 最后一部分旨在提供与早期版本的Internet Explorer的兼容性，通常不需要。 <br><br> 现在，让我们完成画龙点睛。 <br><br> 让我们打开SSL端口： <br><br>  <b>＃ufw允许443</b> <br><br> 启用apache模块以支持SSL和HSTS： <br><br>  <b>＃a2enmod ssl</b> <b><br></b>  <b>＃a2enmod标头</b> <br><br> 启用S​​SL配置： <br><br>  <b>＃a2enconf ssl-params</b> <br><br> 启用启用SSL的虚拟主机： <br><br>  <b>＃a2ensite default-ssl</b> <br><br> 重新启动服务器以接受所有新设置： <br><br>  <b>＃服务apache2重新启动</b> <br><br> 因此，有趣的时刻到了-检查已配置系统新功能的可操作性。 <br><br> 创建一个文件： <br><br>  <b>＃nano /var/www/.htaccess</b> <br><br> 我们在其中规定一行：“要求所有被授予”。 <br><br> 在浏览器中打开https：// 127.0.0.1。 接受未知证书（单个或永久许可）后，应打开一个有关未知证书的页面，一个熟悉的页面将显示有关正在运行的Web服务器的通知。 <br><br> 删除.htaccess文件： <br><br>  <b>＃rm /var/www/.htaccess</b> <br><br> 然后，我们在浏览器中更新打开的页面-应该打开带有访问限制通知（禁止）的页面。 一切正常。 现在我们的站点可以通过HTTP和HTTPS访问。 <br><br>  HTTP访问可以保持启用，禁用或强制重定向到HTTPS。 <br><br> 对于启用HTTP的访问，不需要执行任何操作，因为服务器将单独处理对端口80和443的请求，并且/ var / www文件夹中的站点将同时通过HTTP和HTTPS打开。 <br><br> 要禁用HTTP访问，您只需禁用相应的虚拟主机并重新启动Web服务器： <br><br>  <b>＃a2dissite 000-默认</b> <b><br></b>  <b>＃服务apache2重新启动</b> <br><br> 现在，如果您在浏览器中打开http：// 127.0.0.1，则应打开一个页面，其中包含有关缺少页面的通知（未找到）。 <br><br> 最有趣的第三种选择。 在这种情况下，HTTP正式保持启用状态，但是将通过HTTPS强制重定向数据处理。 <br><br> 为此，首先启用重定向模块： <br><br>  <b>＃a2enmod重写</b> <br><br> 现在打开000-default.conf文件： <br><br>  <b>＃nano /etc/apache2/sites-available/000-default.conf</b> <br><br> 在结束标记之前，添加以下文本： <br><br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">On</span></span> RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{HTTPS}</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span> RewriteRule (.*) https://<span class="hljs-variable"><span class="hljs-variable">%{HTTP_HOST}</span></span><span class="hljs-variable"><span class="hljs-variable">%{REQUEST_URI}</span></span><span class="hljs-meta"><span class="hljs-meta"> [NC,R=301,L]</span></span></code> </pre> <br> 重新启动服务器： <br><br>  <b>＃服务apache2重新启动</b> <br><br> 创建一个文件： <br><br>  <b>＃nano /var/www/.htaccess</b> <br><br> 我们在其中规定一行：“要求所有被授予”。 <br><br> 现在，如果您在浏览器中打开http：// 127.0.0.1地址，我们将自动重定向到https：// 127.0.0.1，并带有有关未知证书的警告（如果该证书先前未添加到浏览器的排除列表中），则在接受后，将打开一个已经熟悉的证书Web服务器通知页面。 <br><br><hr><a name="chap4"></a><br><h3>  SQL调优 </h3><br> 对于mysql的初始设置，只需运行以下命令： <br><br>  <b>＃mysql_secure_installation</b> <br><br> 输入mysql超级用户密码后，我按以下顺序回答了问题： <br><br><ul><li> 拒绝更改root密码； </li><li> 确认已从数据库中删除匿名用户； </li><li> 确认为root阻止远程连接（出于安全原因，root仅在本地连接）； </li><li> 确认删除测试数据库； </li><li> 同意重新加载特权表。 </li></ul><br> 要验证mysql的运行状况，可以运行以下命令： <br><br>  <b>＃mysql -uroot -p</b> <br><br> 输入mysql超级用户密码后，我们会看到mysql提示符-这表示服务已启动并正在运行。 您可以通过输入exit命令退出mysql终端。 <br><br> 要检查phpmyadmin的性能，请在浏览器中打开地址http：// 127.0.0.1/phpmyadmin。 如果打开的页面显示输入phpmyadmin的邀请，则该服务已启动并正在运行。 <br><br><hr><a name="chap5"></a><br><h3>  PHP设置 </h3><br> 安装PHP之后，我打开了它的设置文件： <br><br>  <b>＃nano /etc/php5/apache2/php.ini</b> <br><br> 他将一些参数引入了以下形式： <br><br><ul><li>  memory_limit = 1024M </li><li>  default_charset =“ UTF-8” </li><li>  upload_max_filesize = 256M </li><li>  sendmail_path = /usr/bin/fake_sendmail.sh </li></ul><br> 使用PHP模块，可以在内存中提供数据缓存。 在服务器的数据负载很高的情况下，缓存非常有用，数据的生成需要大量资源，例如，对数据库的查询结果或站点模板的“繁重”部分的处理。 作为缓存服务器，我选择了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">memcached</a>模块。 <br><br> 安装内存缓存： <br><br>  <sup>[ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">本文是</a>由<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">AlexanderS</a>为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">geektimes.ru</a>网站<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">专门</a>写的。</sup> <sup><br></sup>  <sup>链接到源是可选的，但是非常希望获得它的引用！</sup>  <sup>]</sup> <br><br>  <b>＃apt-get install memcached php5-memcached</b> <br><br> 让我们看一下服务配置设置： <br><br>  <b>＃nano /etc/memcached.conf</b> <br><br> 在设置中，我增加了用于缓存的内存大小：-m 64-&gt; -m256。并且仅在本地区域-l 127.0.0.1中检查了操作模式的可用性。 <br><br> 我们重新启动缓存服务和Web服务器： <br><br>  <b>＃service memcached重新启动</b> <b><br></b>  <b>＃服务apache2重新启动</b> <br><br> 现在，您需要确保该服务正在运行。 为此，请创建一个文件： <br><br>  <b>＃nano /var/www/info.php</b> <br><br> 并添加以下文本： <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> phpinfo (); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br> 不要忘记检查/ var / www目录中是否存在带有相应许可内容的.htaccess文件，如果不存在，请创建它。 <br><br> 现在，您可以在浏览器中打开http：// 127.0.0.1/info.php-应该打开一个有关PHP信息的页面，您需要在其中检查其中的memcached部分。 如果该表出现-PHP正在运行。 <br><br> 您可以像这样检查正在运行的memcached服务： <br><br>  <b>$ ps -aux |</b>  <b>grep memcached</b> <br><br> 终端应返回一个包含memcached设置的字符串。 <br><br>  <b>为PHP创建邮件存根</b> <br><br> 在PHP设置中，将shell脚本指定为sendmail_path参数。 该脚本的功能是将通过标准php mail（）函数发送的字母保存在本地计算机上的某个方便文件夹中，而不是将它们发送到某个地方。 <br><br> 创建一个文件： <br><br>  <b>＃纳米/usr/bin/fake_semdmail.sh</b> <br><br> 具有以下内容： <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh prefix="/var/mail/sendmail/new" numPath="/var/mail/sendmail" if [ ! -f $numPath/num ]; then echo "0" &gt; $numPath/num fi num=`cat $numPath/num` num=$(($num + 1)) echo $num &gt; $numPath/num name="$prefix/letter_$num.txt" while read line do echo $line &gt;&gt; $name done chmod 777 $name /bin/true</span></span></code> </pre> <br> 使此文件可执行： <br><br>  <b>＃chmod + x /usr/bin/fake_semdmail.sh</b> <br><br> 如果通过邮件程序配置字母集合，则创建您可能需要的必要目录： <br><br>  <b>＃mkdir / var / mail / sendmail / var / mail / sendmail / cur / var / mail / sendmail / new / var / mail / sendmail / tmp</b> <br><br> 并且我们分配权限，以便服务器可以在此文件夹中写入文件： <br><br>  <b>＃chmod 777 -R / var /邮件/ sendmail</b> <br><br> 现在，所有外发邮件都将添加到/ var / mail / sendmail。 可以使用文本编辑器查看它们，也可以通过邮件程序收集它们。  Debian预装软件带有Evolution电子邮件客户端。 设置帐户时，选择“ Maildir格式的邮件目录”作为服务器类型，并指定邮件目录的路径（/ var / mail / sendmail），然后选择“ Sendmail”作为服务器。 <br><br> 仅此而已。 通常，我们完成了服务器的工作-获得了通用虚拟机，您可以在此基础上构建网络服务。 我同时保留了HTTP和HTTPS访问权限。 但是，在获得创建和配置服务器以及向其添加站点（见下文）的经验之后，我建议使用不带图形界面的服务器创建一个新的虚拟机，这是最佳的资源消耗。 <br><br><hr><a name="chap6"></a><br><h3>  SSH访问设置 </h3><br> 如果没有通过SSH的访问，则服务器将不是完整的服务器。 所谓的“外壳”使您可以使用例如小型腻子程序快速安全地连接到远程服务器-在本地计算机上，我们可以直接访问远程服务器的终端。 <br><br> 服务安装： <br><br>  <b>＃apt-get install ssh</b> <br><br> 让我们打开SSH的端口（实际上，默认端口应为22，但在下面我在SSH配置中重新定义了该端口）： <br><br>  <b>＃ufw允许106</b> <br><br> 要为我们的用户安排访问权限，请打开文件： <br><br>  <b>＃nano / etc / ssh / sshd_config</b> <br><br> 并将指令添加到文件末尾： <br><br><blockquote>  AllowUsers用户 </blockquote><br> 另外，出于安全原因，我对此文件进行了以下更改： <br><br><ul><li> 将端口从22更改为其他<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">端口</a> （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">端口列表</a> ）：端口22-&gt;端口106 </li><li> 禁用旧版协议：协议2.1-&gt;协议2 </li><li> 禁用对root的远程访问：PermitRootLogin yes（或不带密码的PermitRootLogin）-&gt; PermitRootLogin否 </li></ul><br> 然后重新启动服务： <br><br>  <b>＃service sshd restart</b> <br><br> 现在，我可以在主机上运行putty程序，并通过输入连接地址192.168.233.138，端口106和用户名user以控制台方式连接到服务器。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接时，您必须回答肯定才能接受键并输入用户用户的密码。</font><font style="vertical-align: inherit;">如果需要执行超级用户的命令，则可以使用已知的su命令。</font></font><br><br><hr><a name="chap7"></a><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 访问保护 </font></font></h3><br>      -  DDoS,  ,       VPS/VDS,     ,      «»  ,           .   Slow HTTP DDoS          ,       ,     IP . <br><br>  DDoS       - .   ,     ,   .    -     SSH,      ,     ,       SSH –  . <br><br>    ,    –   ,       SSH.     «»           IP     ,     ,       ,             SSH  FTP. ,        -,           ,          . <br><br>    ,     fail2ban: <br><br> <b># apt-get install fail2ban</b> <br><br>                        ,       .   fail2ban   –       ,   ,    . <br><br>     : <br><br> <b># nano /etc/fail2ban/jail.local</b> <br><br>      ,       .    : <br><br> <code>#   <br> [DEFAULT] <br> ignoreip = 127.0.0.1 <br> bantime = 2592000 <br> findtime = 43200 <br> maxretry = 6 <br> banaction = iptables-multiport <br> #      <br> destemail = user@localhost <br> sendername = Fail2Ban <br> mta = sendmail <br> action = %(action_mwl)s <br> <br> #  SSH <br> [ssh] <br> enabled = true <br> port = 106 <br> filter = sshd <br> logpath = /var/log/auth.log <br> <br> #      <br> [apache] <br> enabled = true <br> port = http,https <br> filter = apache-auth <br> logpath = /var/log/apache*/*error.log <br> <br> #        php  <br> [apache-noscript] <br> enabled = true <br> port = http,https <br> filter = apache-noscript <br> logpath = /var/log/apache*/*error.log <br> <br> #     <br> [apache-overflows] <br> enabled = true <br> port = http,https <br> filter = apache-overflows <br> logpath = /var/log/apache*/*error.log <br> maxretry = 2 <br> <br> #          <br> [apache-nohome] <br> enabled = true <br> port = http,https <br> filter = apache-nohome <br> logpath = /var/log/apache*/*error.log <br> maxretry = 2</code> <br> <br>        ,         12   IP  ,  iptables,  30 .        SSH,    ,     -. <br><br><hr><a name="chap8"></a><br><h3>    - </h3><br> ,    : <br><br> <b># service apache2 start <br> # service apache2 stop <br> # service apache2 restart</b> <br><br>   : <br><br> <b># service apache2 reload</b> <br><br>     test: <br><br> <b># a2ensite test <br> # a2dissite test</b> <br><br>     test: <br><br> <b># a2enconf test <br> # a2disconf test</b> <br><br>    ( : «Syntax OK»): <br><br> <b># apache2ctl configtest</b> <br><br> <b>      HTTP  HTTPS    </b> <br><br> ,       ,    site.com,   /home/user/www.    ,    user            . <br><br>      (  ): <br><br> <b># chmod 755 /home/user</b> <br><br>    : <br><br> <b>$ mkdir /home/user/www /home/user/www/site.com</b> <br><br>      : <br><br> <b># ln -s /home/user/www/site.com /var/www/site.com</b> <br><br>     HTTP  : <br><br> <b># nano /etc/apache2/sites-available/000-default.conf</b> <br><br>      HTTPS  : <br><br>  <b>＃nano /etc/apache2/sites-available/default-ssl.conf</b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将以下内容添加到打开的文件中，关闭/ VirtualHost标记之前：</font></font><br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;Directory /var/www/site.com&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">Options</span></span></span></span> FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt;</code> </pre> <br>  -: <br><br> <b># service apache2 restart</b> <br><br>      http:// 127.0.0.1/site.com  https:// 127.0.0.1/site.com (  — . ).   ,          .htaccess,        : «Require all granted». <br><br> <b>      HTTP  HTTPS             ,   IP</b> <br><br>   –  ,   : ,       ,    site.com,   /home/user/www.                . <br><br>      (  ): <br><br> <b># chmod 755 /home/user</b> <br><br>    : <br><br> <b>$ mkdir /home/user/www/site.com</b> <br><br>      : <br><br> <b># ln -s /home/user/www/site.com /var/www/site.com</b> <br><br>     HTTP  : <br><br> <b># nano /etc/apache2/sites-available/site.com.conf</b> <br><br>      : <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;VirtualHost *:80&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span></span></span> site.com ServerAlias www.site.com ServerAdmin user@localhost DocumentRoot /var/www/site.com &lt;Directory /var/www/site.com&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt; # Redirect HTTP-&gt;HTTPS #RewriteEngine <span class="hljs-literal"><span class="hljs-literal">On</span></span> #RewriteCond <span class="hljs-variable"><span class="hljs-variable">%{HTTPS}</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span> #RewriteRule (.*) https://<span class="hljs-variable"><span class="hljs-variable">%{HTTP_HOST}</span></span><span class="hljs-variable"><span class="hljs-variable">%{REQUEST_URI}</span></span><span class="hljs-meta"><span class="hljs-meta"> [NC,R=301,L] ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined &lt;/VirtualHost&gt;</span></span></code> </pre> <br>      HTTPS  : <br><br> <b># nano /etc/apache2/sites-available/site.com-ssl.conf</b> <br><br>      : <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;IfModule mod_ssl.c&gt;</span></span> <span class="hljs-section"><span class="hljs-section">&lt;VirtualHost _default_:443&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">ServerName</span></span></span></span> site.com ServerAlias www.site.com ServerAdmin user@localhost DocumentRoot /var/www/site.com &lt;Directory /var/www/site.com&gt; Options FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt; # HSTS (mod_headers is required) (15768000 seconds = 6 months) Header always set Strict-Transport-Security <span class="hljs-string"><span class="hljs-string">"max-age=15768000"</span></span> ErrorLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/error.log CustomLog <span class="hljs-variable"><span class="hljs-variable">${APACHE_LOG_DIR}</span></span>/access.log combined SSLEngine <span class="hljs-literal"><span class="hljs-literal">on</span></span> SSLCertificateFile /etc/ssl/certs/apache-selfsigned.crt SSLCertificateKeyFile /etc/ssl/private/apache-selfsigned.key &lt;FilesMatch <span class="hljs-string"><span class="hljs-string">"\.(cgi|shtml|phtml|php)$"</span></span>&gt; SSLOptions +StdEnvVars &lt;/FilesMatch&gt; &lt;Directory /usr/lib/cgi-bin&gt; SSLOptions +StdEnvVars &lt;/Directory&gt; BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [2-6]"</span></span> \ nokeepalive ssl-unclean-shutdown \ downgrade-1.0 force-response-1.0 BrowserMatch <span class="hljs-string"><span class="hljs-string">"MSIE [17-9]"</span></span> ssl-unclean-shutdown &lt;/VirtualHost&gt; &lt;/IfModule&gt;</code> </pre> <br>  /etc/hosts   «127.0.0.1 site.com»: <br><br> <b># echo &gt;&gt; /etc/hosts 127.0.0.1 site.com</b> <br><br>  HTTP : <br><br> <b># a2ensite site.com.conf</b> <br><br>   HTTPS : <br><br> <b># a2ensite site.com-ssl.conf</b> <br><br>  -: <br><br> <b># service apache2 restart</b> <br><br>      http:// site.com  https:// site.com (  – . ).   ,          .htaccess,        : «Require all granted». <br><br>       .    «»     . 这并不困难。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们知道来宾计算机的域名和IP地址。</font><font style="vertical-align: inherit;">如果主机系统是Windows，则需要打开文件c：\ Windows \ System32 \ drivers \ etc \ hosts，并在最后添加以下行：</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.168.233.138 site.com </font></font></blockquote><br>         . ,      site.com         . ,             . <br><br>  ,         HTTPS,        HTTP   : <br><br> —   /etc/apache2/sites-available/site.com.conf   ,     <br> —   /etc/apache2/sites-available/site.com.conf    RewriteEngine/RewriteCond/RewriteRule <br> —   site.com.conf,     <br> —  : # service apache2 restart <br><br> <b>   </b> <br><br>       —       index.html  - . <br><br>   index.html: <br><br> <b>$ nano /home/user/www/site.com/index.html</b> <br><br>      : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>TEST OK<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>TEST OK<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>           http:// 127.0.0.1/site.com (https:// 127.0.0.1/site.com)  http:// site.com (https:// site.com) —      «TEST OK». <br><br><hr><a name="chap9"></a><br><h3>    MySQL </h3><br>   user123   pass123    db123  . <br><br>   mysql,    mysql  : <br><br> <b># mysql -u root -p</b> <br><br>     ( «mysql&gt;»   ,      ): <br><br> <b>mysql&gt; CREATE DATABASE `db123`;</b> <br><br>   user123   pass123: <br><br> <b>mysql&gt; CREATE USER 'user123'@'localhost' IDENTIFIED BY 'pass123';</b> <br><br>      : <br><br> <b>mysql&gt; GRANT ALL PRIVILEGES ON `db123`.* TO 'user123'@'localhost';</b> <br><br>   : <br><br> <b>mysql&gt; FLUSH PRIVILEGES;</b> <br><br>   mysql: <br><br> <b>mysql&gt; exit</b> <br><br>     http:// 127.0.0.1/phpmyadmin      user123/ pass123.       db123. <br><br>    root mysql c pass123  pass456: <br><br> <b># mysqladmin -uroot -ppass123 password pass456</b> <br><br>    user123 c pass123  pass456: <br><br> <b># mysqladmin -uuser123 -ppass123 password pass456</b> <br><br>   user123: <br><br> <b>mysql&gt; DROP USER 'user123'@'localhost';</b> <br><br>   db123: <br><br> <b>mysql&gt; DROP DATABASE `db123`;</b> <br><br><hr><a name="chap10"></a><br><h3>    fail2ban </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新启动服务：</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃service fail2ban restart</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查运行规则：</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃fail2ban-client status</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sshd规则的详细统计信息：</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃fail2ban-client status ssh</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取消禁止：</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃fail2ban-client set ssh unbanip Banned_IP</font></font></b> <br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目录的开头</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><hr><br> 创建家庭云的历史。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2部分。创建服务器-在Debian中设置LAMP。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字版本：1.0.1。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首次发布日期：2018年1月30日。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上次编辑时间：2020年1月15日。</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新日志</font></font></b> <div class="spoiler_text"> 1.0.1 [15-01-2020] <br>  . <br><br> 1.0.0 [30-01-2018] <br>  . <br>     LAMP  Debian 8.7.x. <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN409915/">https://habr.com/ru/post/zh-CN409915/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN409901/index.html">您仍然可以两次进入同一条河</a></li>
<li><a href="../zh-CN409903/index.html">为什么最复杂的物理学方程式如此困难？</a></li>
<li><a href="../zh-CN409905/index.html">如何使用智能手机改善健康</a></li>
<li><a href="../zh-CN409907/index.html">俄罗斯轮盘赌Ecola</a></li>
<li><a href="../zh-CN409911/index.html">基于ESP8266的模块的新修订版无法在SPI Flash中写入</a></li>
<li><a href="../zh-CN409917/index.html">一项为期4年的珊瑚礁研究结果：塑料杀死珊瑚</a></li>
<li><a href="../zh-CN409919/index.html">问伊森：我们离万物理论有多近？</a></li>
<li><a href="../zh-CN409921/index.html">硬盘可靠性报告大火：2013年至2017年的统计数据</a></li>
<li><a href="../zh-CN409923/index.html">数学家已经在描述液体的著名方程中发现了一个问题</a></li>
<li><a href="../zh-CN409925/index.html">现场欺骗阿丽亚娜5号事故</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>