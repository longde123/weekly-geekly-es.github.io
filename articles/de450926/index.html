<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéµ üíÖüèª üòÉ 3D-Spiel auf three.js, nw.js. üë®üèº‚Äçüîß üî≠ üë®üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich habe beschlossen, eine neue Version meines alten Browsergames zu ver√∂ffentlichen, das seit einigen Jahren als Anwendung in sozialen Netzwerken erf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>3D-Spiel auf three.js, nw.js.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450926/"> Ich habe beschlossen, eine neue Version meines alten Browsergames zu ver√∂ffentlichen, das seit einigen Jahren als Anwendung in sozialen Netzwerken erfolgreich ist.  Dieses Mal wollte ich es auch als Anwendung f√ºr Windows (7-8-10) entwerfen und in verschiedenen Gesch√§ften platzieren.  Nat√ºrlich k√∂nnen Sie in Zukunft Assemblys f√ºr MacOS und Linux erstellen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1c/tj/vi/1ctjvijgbjodkdjhwszw4atwgvm.jpeg"></div><br>  Der Spielcode ist vollst√§ndig in reinem Javascript geschrieben.  Zum Anzeigen von 3D-Grafiken wird die Bibliothek three.js als Verkn√ºpfung zwischen dem Skript und WebGL verwendet.  Dies war jedoch in der alten Browserversion der Fall.  Das Wichtigste in diesem Projekt war f√ºr mich der Grund, parallel zum Spiel eine eigene Bibliothek hinzuzuf√ºgen, die three.js mit den Werkzeugen f√ºr die bequeme Arbeit mit Szenenobjekten, deren Animation und vielen anderen Funktionen erg√§nzt.  Ich habe es dann f√ºr eine lange Zeit aufgegeben.  Es ist Zeit, zu ihr zur√ºckzukehren. <br><a name="habracut"></a><br><br>  Meine Bibliothek enth√§lt praktische Werkzeuge zum Hinzuf√ºgen und Entfernen von Objekten zur Szene, zum √Ñndern der Eigenschaften einzelner Teile von Objekten (Netze), zur rahmenratenunabh√§ngigen Animation von 3D-Objekten, einen Sky-Shader mit einer Sternenhimmel-Textur bei Nacht und vieles mehr.  Ich werde Ihnen von einigen erz√§hlen.  In Bezug auf den Himmel habe ich seine Erstellung mit einer einzigen Funktion implementiert, die eine Reihe von Eingabeparametern verwendet, den Shader initialisiert, die Wolkentextur l√§dt (falls erforderlich) und mit der Aktualisierung des Himmels mit einer bestimmten Iteration beginnt. <br><br>  Dort ist jedoch alles etwas komplizierter - f√ºr periodische, aber selten aufgerufene Funktionen funktioniert tats√§chlich eine andere Konstruktion mit setInterval (), bei der Ereignisse in unterschiedlichen Intervallen ausgel√∂st werden k√∂nnen, und dies alles wird auf einen gemeinsamen Nenner reduziert und rechts berechnet Zeit ben√∂tigte Ereignisse auf der Liste.  Dort k√∂nnen Sie auch das Sky-Update-Intervall werfen.  Die Bewegung von 3D-Gaming-Objekten f√ºr mehr Gl√§tte wurde jedoch bereits durch requestAnimationFrame () implementiert ... <br><br>  Da wir also √ºber den Himmel sprechen, werden wir damit beginnen. <br><br><h3>  Himmel </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ge/xw/da/gexwday-od32dav2p4gb48p1nme.jpeg"></div><br>  Das Hinzuf√ºgen des Firmaments zur Szene ist wie folgt. <br><br>  Zuerst m√ºssen Sie der Szene das Standardlicht three.js mit seinen maximalen (anf√§nglichen) Helligkeitswerten hinzuf√ºgen.  Die gesamte Szene mit ihren Objekten, Licht und anderen Attributen wird im Apscene-Namespace gespeichert, um den globalen Raum nicht zu √ºberladen. <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  (AmbLight)   apscene.AmbLight=new THREE.AmbientLight(0xFFFFFF); apscene.scene.add(apscene.AmbLight); //  (AmbLightBk)   (      ) apscene.AmbLightBk=new THREE.AmbientLight(0xFFFFFF); apscene.sceneb.add(apscene.AmbLightBk); // (, )   var SFog=new THREE.FogExp2(0xaaaaaa, 0.0007); apscene.scene.fog=SFog; // (, )   var SFogBk=new THREE.FogExp2(0xa2a2aC, 0.0006); apscene.sceneb.fog=SFogBk; //  apscene.hemiLight=new THREE.HemisphereLight(0xFFFFFF, 0x999999, 1); apscene.scene.add(apscene.hemiLight); //        .       .        three.js   ,   ,     ,  ,   ... apscene.dirLight=new THREE.DirectionalLight(...) apscene.dirLightBk=new THREE.DirectionalLight(...)</span></span></code> </pre> <br>  Danach k√∂nnen Sie die Animation des Himmels bereits mit Shadern, Texturen (Blackjack und ... na gut, okay) √ºber eine meiner Funktionen ausf√ºhren: <br><br><pre> <code class="javascript hljs">m3d.graph.skydom.initWorld( <span class="hljs-comment"><span class="hljs-comment">//  ,  ,         {saveStart:false}, { //ltamb (light ambient,    ) -       ltamb:{a1:-2, a2:8, k1:0.2, k2:0.75, obj:[ {obj:apscene.AmbLight.color, key:['r','g','b']} ]}, //a1  a2 -      (altitude,      ),     ,   obj,     (k1..k2),   k1  k2 -         // ,    ltamb :     -2  8 (    ),    (apscene.AmbLight.color),    r, g  b,    0.2  0.75     ( ,    ,    0xFFFFFF). //key -    ,        three.js //        (apscene.AmbLightBk.color).    (  altitude)  -4  12          0.3 ... 0.99    .  -4 , ,    0.3  ,   12   0.99   ltambb:{a1:-4, a2:12, k1:0.3, k2:0.99, obj:[ {obj:apscene.AmbLightBk.color, key:['r','g','b']} ]}, //      : ltdir:{a1:-2, a2:8, k1:0.0, k2:1, obj:[ {obj:apscene.dirLight, key:['intensity']}, {obj:apscene.dirLightBk, key:['intensity']} ]}, //       (apscene.dirLightBk)   ,    ,       . // ,      three.js    - inensity ( , apscene.dirLight.intensity).  ,  ,       three.js    . //  .   ,     ( 0.15  )     12  8 (, ,    8  12), : lthem:{a1:8, a2:12, k1:0.15, k2:0.3, obj:[ {obj:apscene.hemiLight, key:['intensity']} ]}, //         .       . //    ()   : ltambfog:{a1:-2, a2:8, k1:0.4, k2:1, obj:[ {obj:apscene.scene.fog.color, key:['r','g','b']} ]}, //  : ltambbfog:{a1:-2, a2:12, k1:0.25, k2:1, obj:[ {obj:apscene.sceneb.fog.color, key:['r','g','b']} ]}, //     .  ,         ,  . ltambfogd:{a1:8, a2:12, k1:0.2, k2:0.35, obj:[ {obj:apscene.scene.fog, key:['density']} ]}, //  ltambbfogd:{a1:6, a2:12, k1:0.2, k2:0.28, obj:[ {obj:apscene.sceneb.fog, key:['density']} ]}, //  ,      ( ,   ),   ,     ,   , -¬´¬ª     ,      skyplane1..6: planeAmb:{a1:-5, a2:12, k1:0.5, k2:1.0, obj:[ {obj:apscene.user.skyplane1.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane2.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane3.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane4.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane5.material.color, key:['r','g','b']}, {obj:apscene.user.skyplane6.material.color, key:['r','g','b']} ]} //,     ,     ,  . };</span></span></code> </pre> <br>  Infolgedessen erscheint ein dynamischer Himmel auf der Szene mit einer sanften √Ñnderung der Sonnenh√∂he und dementsprechend einer √Ñnderung der Tageszeit. <br><br>  Es ist nicht notwendig, alle Arten von Beleuchtung auf der B√ºhne zu verwenden.  Und es ist nicht notwendig, alle Parameter abh√§ngig von der Tageszeit zu √§ndern.  Wenn Sie jedoch mit ihrer Helligkeit spielen, k√∂nnen Sie ein ziemlich realistisches Bild der Ver√§nderung von Tag und Nacht erstellen.  Sie k√∂nnen die Parameter beliebig benennen. Die Hauptsache besteht darin, die Schl√ºssel der darin enthaltenen Objekte so zu beobachten, wie sie in three.js angegeben sind. <br><br>  Wie es aussieht, k√∂nnen Sie das Video aus der Demoszene sehen: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/PoAPy3ByPRU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Dies ist ein anderes Spiel.  Es ist nur so, dass der Horizont nicht mit verschiedenen Objekten √ºberf√ºllt ist und daher die Arbeit dieses Skripts am deutlichsten sichtbar ist.  Aber in dem Spiel, √ºber das die Geschichte diskutiert wird, wird genau der gleiche Ansatz verwendet.  Die hohe Geschwindigkeit des Zeitablaufs wird hier nur zu Demonstrationszwecken eingestellt, und so flie√üt die Zeit nat√ºrlich langsamer, wobei derselbe Schritt der Iteration das Firmament aktualisiert.  An dieser Demo ist √ºbrigens ein Wasser-Shader beteiligt, auch mit variablen Parametern, abh√§ngig von der H√∂he der Sonne ... Aber ich habe es noch nicht fertiggestellt. <br><br><h3>  Leistung </h3><br>  All dies ist f√ºr Eisen sehr wenig anspruchsvoll.  Im Chrome-Browser wird der Xeon E5440 unter LGA775 (und mit 4 GB RAM) um 20% und der Kern der GT730-Grafikkarte um 45% geladen.  Dies liegt aber nur an der Animation des Wassers.  Wenn wir √ºber ein Spiel sprechen, bei dem es kein Wasser gibt, aber eine Stadt, dann dieses: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0i/_k/se/0i_ksepjxwtge9qffnonerlnkes.jpeg"></div><br>  Dann bewegt sich das Auto zu der Zeit durch die Stadt - Prozent 45%, Grafikkarte 50%.  Im Prinzip funktioniert es mit einem gewissen fps-Drawdown (bis zu 30 Bilder pro Sekunde) sogar auf Pentium4 3 GHz (1 Gbit RAM) und auf einem Tablet mit Intel Atom 1,3 GHz (2 Gbit RAM) ziemlich gut. <br><br>  All diese Hardware ist extrem schwach und andere √§hnliche Spiele auf WebGL und HTML5, sogar einige 2D-Spiele, verlangsamen mich gottlos, bis es unm√∂glich wird, sie zu spielen.  Wie sie sagen, schreibe das Spiel selbst, wie du es brauchst, und spiele. <br><br><h3>  Szene </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/zo/y1/jbzoy1gm1aomyfdgyp7udkziole.jpeg"></div><br>  Die 3D-Szene in three.js ist ein Szenenobjekt, und das untergeordnete Array besteht aus allen 3D-Modellen, die in die Szene geladen werden.  Um nicht f√ºr jedes Modell einen Bootloader-Aufruf zu registrieren, habe ich beschlossen, die gesamte Spielszene in Form einer bestimmten Konfiguration mit einem gro√üen assoziativen Array locd: {} (z. B. Standortdaten) festzulegen, das alle Einstellungen enth√§lt - Lichter, Pfade vorinstallierter Texturen und Bilder f√ºr die Benutzeroberfl√§che, Pfade zu allen Modellen, die auf die B√ºhne geladen werden sollen, und vieles mehr.  Im Allgemeinen ist dies die vollst√§ndige Konfiguration der Szene.  Es wird einmal in der js-Datei des Spiels gesetzt und meinem Szenenlader zugef√ºhrt. <br><br>  Und dieses locd: {} -Objekt enth√§lt insbesondere die Pfade zu den einzelnen 3D-Modellen, die geladen werden m√ºssen.  Der Nullpfad ist der gemeinsame Pfad und dann die relativen Pfade f√ºr jedes Objekt, z. <br><pre> <code class="javascript hljs">[<span class="hljs-string"><span class="hljs-string">'path/myObj'</span></span>, scale, y, x,z, r*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>]</code> </pre> <br>  Es versteht sich, dass alle Modelle aus dem 3D-Editor in das JSON-Format exportiert werden, dh Pfade wie path / myObj.json haben.  Darauf folgen die Skala (da der Editor mit einer f√ºr das Spiel nicht geeigneten Skala gespeichert werden kann), die Position des Objekts in der H√∂he (y) entlang der Achsen (x) und (z), dann der Drehwinkel ¬Æ des Modells in (y), eine Reihe optionaler Parameter und Der Name der Szene, in die das Modell geladen werden soll - in der Hauptszene (Szene) oder im Hintergrund (Szeneb). <br><br>  Ja, dies musste nicht in Form eines einfachen, sondern in Form eines assoziativen Arrays implementiert werden.  Die Reihenfolge der Parameter ist also auch ohne Dokumentation oder zumindest ohne die Art der Funktion, die diese Parameter √ºbernimmt, nicht nachvollziehbar. Sie werden es nicht verstehen.  Ich denke, in Zukunft werde ich diese Zeilen in assoziativen Arrays neu erstellen.  In der Zwischenzeit sieht es so aus: <br><pre> <code class="javascript hljs">landobj: [ [<span class="hljs-string"><span class="hljs-string">'gamePath/'</span></span>], [ [<span class="hljs-string"><span class="hljs-string">'landscape/ground'</span></span>, <span class="hljs-number"><span class="hljs-number">9.455</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], [<span class="hljs-string"><span class="hljs-string">'landscape/plants'</span></span>, <span class="hljs-number"><span class="hljs-number">9.455</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI,<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], [<span class="hljs-string"><span class="hljs-string">'landscape/buildings/house01'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-420</span></span>,<span class="hljs-number"><span class="hljs-number">420</span></span>, <span class="hljs-number"><span class="hljs-number">-0.75</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-string"><span class="hljs-string">'scene'</span></span>], ... ] ],</code> </pre> <br>  Diese Modelle werden auf die B√ºhne geladen und in den hier angegebenen Koordinaten im Raum platziert.  Grunds√§tzlich k√∂nnen alle Modelle als einzelnes Objekt geladen, dh als ganze Spielszene aus dem Editor exportiert und in Koordinaten (0; 0; 0) geladen werden.  Dann wird es nur eine Zeile geben: Landschaft / Boden - ich habe ground.json - dies ist der Hauptteil der Spielwelt.  In diesem Fall ist es jedoch schwierig, einzelne Objekte der Szene zu manipulieren, da Sie zuerst in die Browserkonsole schauen und sich merken m√ºssen, welches der Kinder dieses riesigen Gel√§ndes ist.  Und dann kontaktieren Sie sie √ºber Nummern.  Daher werden Roaming-Spielmodelle am besten mit separaten Objekten geladen.  Anschlie√üend kann √ºber das assoziative Array, das speziell f√ºr diesen Zweck automatisch erstellt wird, namentlich auf sie zugegriffen werden. <br><br>  Die vollst√§ndige Konfiguration des Spiels k√∂nnte beispielsweise so aussehen: <br><pre> <code class="javascript hljs">locd:{ <span class="hljs-comment"><span class="hljs-comment">// name: 'SeaBattle', type: 'game', menulabel: '', //    x:-420, y:70, z:-420, rot: -0.5, //    intsdistance: 200, // ambLtColor: 0xFFFFFF, ambLtColorBk: 0xFFFFFF, lightD: [0xDDDDDD,0.3,1000, 200000,0.3,-0.0003, -190,200000,-140,0,0,0, 200,-200,200,-200], lightDBk: [0xFFFFFF,0.3,10000, 40000,0.3,-0.0035, -190,1200,-140,0,0,0, 50000,-50000,50000,-50000], lightH: [0xFFFFFF,0x999999,1, 0,500,0], //      lightsP: [], //     lightsPDynamicAr: [ [0xffffff, 4, [0, -2000, 0], [50, 1.5] ] //[[distance], [decay]] ], //         (x,y,z) userPointLights: [ [0, -2000, 0] ], //   lightsS: [ [0xffffbb, 1.0, [0, 250, 180], [0, 0, 180], 0.5, 600,600,600, -0.0005] ], //  shadowMapCullFace:0, shadowsMode: 'all', //all,list,flag //  imagePaths: [ 'game/img/', 'interface.png', 'interface2.png' ], // 3D  landobj: [ ['game/models/'], [ ['landscape/land',1, 0, 0,0, 0.0*Math.PI,1,'','','',1,['','','',''],'scene'], ['landscape/sbp',1, 0, 0,180, 1.0*Math.PI,1,'','','',1,['','','',''],'scene'], ['landscape/sbu',1, 0, 0,1120, 1.0*Math.PI,1,'','','',1,['','','',''],'scene'] ] ], //        staffobj: [ ['game/models2/'], [ ] ], //  progobj: [ [ ] ] },</span></span></code> </pre> <br>  Ja, es ist besser, alle diese Subarrays in assoziative Arrays zu wiederholen, da sonst die Reihenfolge der darin enthaltenen Parameter nicht klar ist ... <br><br><h3>  3D-Modelle </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fz/fm/ql/fzfmqlr4yfw3_tkm79xjwlb_ccw.jpeg"></div><br>  Eine andere interessante Sache.  Modelle laden.  Meine Bibliothek akzeptiert 3D-Modelle mit Texturen und setzt abh√§ngig von den Namen automatisch einige Parameter auf ihre einzelnen Elemente (Netze).  Tatsache ist, dass, wenn das Modell beispielsweise so eingestellt ist, dass es einen Schatten wirft, es von jedem in seiner Zusammensetzung enthaltenen Netz geworfen wird.  Es ist nicht immer erforderlich, dass das gesamte Modell einen Schatten vollst√§ndig wirft oder andere Eigenschaften erh√§lt, die die Leistung stark beeintr√§chtigen.  Wenn Sie also ein bestimmtes Flag aktivieren, das signalisiert, dass jedes Netz separat betrachtet werden muss, k√∂nnen Sie beim Laden bestimmen, welches Netz diese oder jene Eigenschaft hat und welches nicht.  Nun, zum Beispiel ist es absolut nicht erforderlich, dass der Schatten durch das flache horizontale Dach des Hauses oder durch viele kleinere irrelevante Details des Modells vor einem gro√üen Hintergrund geworfen wird.  Trotzdem kann der Player diese Schatten nicht sehen, und die Leistung des Videoprozessors wird verwendet, um sie zu verarbeiten. <br><br>  Dazu k√∂nnen Sie im Grafikeditor (Blender, Max usw.) sofort die Namen der Netze (im Feld Objektname) nach einer bestimmten Regel angeben.  Es muss einen Unterstrich (_) geben.  Bedingte Steuerzeichen sollten sich auf der linken Seite befinden, zum Beispiel: d - Doppelseite (Netz ist in beide Richtungen, ansonsten - in eine Richtung), c (Schatten werfen) - wirft einen Schatten, r (Schatten empfangen) - nimmt Schatten auf.  Das hei√üt, der Name des Rohrnetzes im Haus kann beispielsweise cr_tube sein.  Viele andere Buchstaben werden ebenfalls verwendet.  Zum Beispiel ist ‚Äûl‚Äú ein Collider, dh die Wand des Hauses mit dem Namen crl_wall01 l√§sst den Spieler nicht durch sich selbst hindurch und wirft und wirft auch einen Schatten.  Es ist nicht erforderlich, Kollider wie ein Dach oder einen T√ºrgriff herzustellen, wodurch die Leistung beeintr√§chtigt wird.  Wie Sie bereits verstanden haben, analysiert meine Bibliothek beim Laden eines Modells die Namen von Netzen und gibt ihnen die entsprechenden Eigenschaften f√ºr die Szene.  Dazu m√ºssen jedoch alle Netze korrekt benannt werden, bevor das Modell aus dem 3D-Editor exportiert wird.  Dies spart erheblich Leistung. <br><br>  Alle Steuerflags f√ºr Netze innerhalb eines Objekts: <br><blockquote>  col_ ... ist der Collider.  Ein solches Netz wird einfach als transparenter, unsichtbarer Collider angezeigt.  Im Editor kann er wie alles aussehen, nur seine Form ist wichtig.  Zum Beispiel kann es sich um ein Parallelepiped um das gesamte Modell handeln, wenn der Spieler dieses Modell (Geb√§ude, gro√üer Stein usw.) nicht durchlaufen muss. <br><br>  l_ ... ist ein kollidierbares Objekt.  Geben Sie einem Netz eine Collider-Eigenschaft. <br><br>  i_ ... - Kreuzungen.  Das Netz wird der Schnittpunktliste hinzugef√ºgt, mit der Sie beispielsweise darauf klicken k√∂nnen, um dem Spiel Interaktivit√§t zu verleihen. <br><br>  j_ ... auch Kreuzungen.  Das gleiche wie oben, nur eine neuere Version - mit einem verbesserten Algorithmus zum Auffinden von Schnittpunkten im Spiel und weniger Ressourcenverbrauch. <br><br>  e_ ... - Kreuzungen f√ºr die T√ºren von H√§usern (Ein- / Ausgang).  Schlie√üt Schnittpunkte √ºber anderen Objektnetzen aus.  Es wird verwendet, wenn es in H√§usern zu einem bestimmten Zeitpunkt erforderlich ist, nur T√ºren interaktiv zu machen, ausgenommen alle anderen interaktiven Elemente.  Mit Fantasie k√∂nnen Sie sich diese und eine Menge anderer Anwendungen einfallen lassen. <br><br>  c_ ... - Schatten werfen.  Das Netz wirft einen Schatten. <br><br>  r_ ... - Schatten empfangen.  Ein Netz akzeptiert Schatten von allen anderen Netzen, die sie werfen. <br><br>  d_ ... - bilateral (doppelseitig).  Auf beiden Seiten sichtbar, √ºberlagert sich die Textur auf beiden Seiten. <br><br>  t_ ... - transparent (transparent), wenn das gesamte Objekt in three.js auf alphatest gesetzt ist. <br><br>  u_ ... - transparent (transparent) mit einer festen Dichte (0,4), wenn das gesamte Objekt nicht alphatest in three.js angibt. <br><br>  g_ ... - Glas.  Feste Transparenz ist eingestellt (0,2). <br><br>  h_ ... - unsichtbar (versteckt).  F√ºr Teile des Objekts (Netze), die beim Hinzuf√ºgen des Objekts zur Szene ausgeblendet werden sollen.  Eingetragen in die Liste der versteckten. <br><br>  v_ ... sichtbar.  Alle Objekte au√üer den mit "h" gekennzeichneten sind bereits sichtbar, aber mit dem Flag "v" werden sie in eine separate Liste eingetragen, die zur weiteren Verschleierung oder f√ºr andere Manipulationen sichtbar ist. </blockquote><br>  Infolgedessen kann der Name des Netzes ungef√§hr so ‚Äã‚Äãlauten: crltj_box1 (wirft, akzeptiert einen Schatten, Collider, transparent, interaktiv).  Und noch ein Netz als Teil desselben Modells: cr_box2 (wirft nur Schatten und nimmt Schatten). Nat√ºrlich k√∂nnen Steuerzeichen in beliebiger Reihenfolge festgelegt werden.  Auf diese Weise k√∂nnen Sie √ºber den Editor die zuk√ºnftige Anzeige von Teilen des Objekts im Spiel oder vielmehr einige ihrer Eigenschaften steuern und gleichzeitig Rechenleistung sparen. <br><br><h3>  Die Essenz des Spiels </h3><br>  Die Bedeutung des Spiels, um das es in der Geschichte geht, besteht darin, sich um den Umfang des quadratischen Feldes zu bewegen und Unternehmen zu kaufen.  Das Feld besteht aus 3D-Stra√üen.  Das Wirtschaftsmodell des Spiels unterscheidet sich erheblich von dem seiner Art.  Wenn in meinem Spiel jemand ein Unternehmen gr√ºndet, sinkt Ihr erwarteter Gewinn.  Und umgekehrt, wenn Sie etwas entdecken, nimmt es zu.  Alle Gewinn- und Verlustberechnungen werden in der Steueraufsicht im Feld Start durchgef√ºhrt.  Sie k√∂nnen auch einen Kredit bei einer Bank aufnehmen, mit Wertpapieren handeln und eine Reihe anderer Dinge tun.  Ich habe das KI-Verhalten im Vergleich zur alten Version verbessert.  Fast alle 3D-Modelle und Texturen des Spiels wurden √ºberarbeitet und die Leistung optimiert.  Mehr Einstellungen vorgenommen und vieles mehr. <br><br><h3>  Animation </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lw/7u/m_/lw7um_phbrcpp-yx78ec5ihw9jy.jpeg"></div><br>  Um die Bewegung von Spielobjekten zu animieren, wird die einfachste Engine verwendet, die bei einer bestimmten Bildrate (die auf die 60. begrenzt ist) alle numerischen Parameter f√ºr ein bestimmtes Zeitintervall √§ndert und Zwischenwerte an den Handler weitergibt.  Im Handler wird beispielsweise das Modell angezeigt. <br><br>  Z.B.  Wir m√ºssen das Objekt obj im Raum von der Position (10; 10; 50) zum Punkt (100; 300; 60) bewegen.  Wir setzen 3 Parameter, indem wir ihre Anfangs- und Endwerte angeben.  Die x-Koordinate variiert von 10 bis 100, y - von 10 bis 300 und z - von 50 bis 60. Und all dies sollte beispielsweise in 4 Sekunden geschehen. <br><pre> <code class="javascript hljs">m3d.lib.anim.add( <span class="hljs-string"><span class="hljs-string">'moveobj'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4000</span></span>, <span class="hljs-string"><span class="hljs-string">'and'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">userpar1</span></span>:<span class="hljs-number"><span class="hljs-number">111</span></span>, <span class="hljs-attr"><span class="hljs-attr">obj</span></span>:my3DObject}, [ {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">lim1</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">lim2</span></span>:<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">sstart</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">sfin</span></span>:<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-attr"><span class="hljs-attr">t</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>} ], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ myPeriodicFun(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ myFinishFun(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } ); m3d.lib.anim.play();</code> </pre> <br>  Die erste Zeile mit 5 Parametern: moveobj - Name der Animation (beliebig), 1 - Streamnummer (Sie k√∂nnen Objekte in einer unbegrenzten Anzahl von Streams parallel animieren), 4000 - Animationszeit von 4 Sekunden und - w√§hrend eines nicht verwendeten Parameters, der in Zukunft f√ºr die √úbergangslogik verantwortlich sein wird Zwischen Animationen innerhalb desselben Streams ist userpar ein beliebiges assoziatives Array, das als Parameter an den Handler √ºbergeben wird, z. B. mit einem berechneten Radius, Sinus, Cosinus und im Allgemeinen allen f√ºr diese Animation berechneten Werten, um nicht in berechnet zu werden  √ºber den Zeitpunkt jeder Iteration.  Oder in Bezug auf ein 3D-Objekt, das tats√§chlich animiert wird. <br><br>  Als n√§chstes folgt ein Array mit ver√§nderlichen Parametern.  Wir finden, dass der erste Parameter die √Ñnderung der x-Koordinate ist, der zweite ist y, der dritte ist z.  Wir schreiben f√ºr jedes in lim1 und lim2, von welcher und zu welcher Gr√∂√üe es sich √§ndern wird.  In sstart und sfin geben wir dieselben Werte an.  Hier k√∂nnen Sie beispielsweise einen Start von einem anderen Wert aus angeben, dann ‚Äûscrollt‚Äú der Parameter in einem Kreis von diesem zu ihm, umgeht lim2 und startet eine neue ‚ÄûUmdrehung‚Äú mit lim1.  Nun, dies ist zum Beispiel notwendig, wenn unsere Animation zwischen einigen Werten (lim1 und lim2) geloopt wird, aber wir m√ºssen sie nicht von vorne beginnen (dh nicht von lim1), sondern von einem Zwischenwert. <br><br>  t: 0 legt nur fest, dass die Animation f√ºr diesen Parameter 1 Mal entsprechend der Gesamtzeit (4000) ausgef√ºhrt wird, als ob sie darauf gestreckt w√§re.  Wenn wir eine andere Zahl als die Hauptzeit einstellen, wird dieser Parameter wiederholt und bis zur Zeit der Hauptanimation (4000) wiederholt.  Dies ist beispielsweise praktisch, um die Drehung des Objekts einzustellen, wenn der Winkel wiederholt die 360-Grad-Linie √ºberschreiten und auf 0 zur√ºckgesetzt werden muss. <br><br>  Als n√§chstes folgen 2 R√ºckrufe - der, der bei jeder Iteration ausgef√ºhrt wird, und der, der nach Abschluss der gesamten Animation einmal ausgef√ºhrt wird (Austrittspunkt). <br><br>  Der erste R√ºckruf von myPeriodicFun (this) kann beispielsweise folgenderma√üen aussehen: <br><pre> <code class="javascript hljs">myPeriodicFun:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">self</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state=self.par[<span class="hljs-number"><span class="hljs-number">0</span></span>].state, state_old=self.par[<span class="hljs-number"><span class="hljs-number">0</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state2=self.par[<span class="hljs-number"><span class="hljs-number">1</span></span>].state, state_old2=self.par[<span class="hljs-number"><span class="hljs-number">1</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> state3=self.par[<span class="hljs-number"><span class="hljs-number">2</span></span>].state, state_old3=self.par[<span class="hljs-number"><span class="hljs-number">2</span></span>].state_old; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((state!=state_old)||(state2!=state_old2)||(state3!=state_old3)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj=self.userpar.obj; obj.position.x=state; obj.position.y=state2; obj.position.z=state3; ap.cameraFollowObj(obj); }; },</code> </pre> <br>  Das hei√üt, bei jeder Iteration der Bewegung wird ein Parameter (self) in diese Funktion geworfen, der die berechneten Zwischenwerte f√ºr alle angegebenen Animationsparameter enth√§lt: self.par [0] .state, self.par [1] .state, self.par [2] .state.  Dies ist unser x, y und z zur aktuellen Zeit.  Wenn die Animation beispielsweise 4 Sekunden dauert, ist x nach 2 Sekunden gleich (100-10) / 2 = 45. Und so f√ºr alle Koordinaten.  Dementsprechend zeigen wir in myPeriodicFun unser Objekt einfach in diesen Koordinaten an.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Browser auf dieser Hardware verz√∂gert oder nur langsam ausgef√ºhrt wird, ist dies nicht be√§ngstigend: Die gesamte Animationszeit √§ndert sich nicht, nur die Bildrate sinkt und das Bild wird zu einer Diashow. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum also f ((state! = State_old) ... pr√ºfen, dh ob der neu berechnete Wert gleich dem alten ist (state_old merkt sich den berechneten Wert in der vorherigen Iteration), also zum Beispiel, wenn sich einige Parameter √§ndern kleiner als eins, dann zeichnen Sie nicht das gesamte Objekt neu und geben Sie nicht die Leistung des Systems daf√ºr aus, und die Animations-Engine erzeugt Ganzzahlen in state und state_old, die beispielsweise als Schritt gleich einem Pixel interpretiert werden k√∂nnen. Und wenn sich das Objekt nicht relativ zur vorherigen Position bewegt Selbst um 1 Pixel ist es nicht erforderlich, es neu zu zeichnen, da e Die Position auf dem Bildschirm √§ndert sich nicht.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Allgemeinen wird unter Animation eine einfache √Ñnderung einer beliebigen Anzahl von Parametern in einer bestimmten Zeit mit der √úbermittlung ihrer Zwischenwerte an eine R√ºckruffunktion verstanden. Sie k√∂nnen beispielsweise einen weiteren 4. Parameter hinzuf√ºgen, der f√ºr den Drehwinkel des Objekts verantwortlich ist. Und Sie k√∂nnen im Allgemeinen die Parameter vieler Objekte in einer Animation zusammenfassen, wenn sie sich irgendwie gleichm√§√üig bewegen. Sie k√∂nnen Animationen in verschiedene Streams einf√ºgen, die dann parallel verarbeitet werden. Sie k√∂nnen einem einzelnen Thread (m3d.lib.anim.add ()) eine ganze Folge von Animationen hinzuf√ºgen, die nacheinander ausgef√ºhrt werden. Dar√ºber hinaus hat jeder Thread seine eigene unabh√§ngige Sequenz. Die Hauptsache ist, dass das System genug Strom hat und nicht alles zu einer Diashow wird.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS. Streams werden hier einfach durch sequentielle Aufz√§hlung bei jeder Iteration aller parallelen Animationen und Berechnung von Zwischenwerten aller ihrer Parameter f√ºr jede von ihnen realisiert. </font><font style="vertical-align: inherit;">Das hei√üt, es gibt kein echtes Multithreading in Javascript. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieselbe ‚ÄûEngine‚Äú kann auch zum Animieren der Elemente der Schnittstelle verwendet werden, indem sie so eingestellt werden, dass sie 2 Koordinaten in der Bildschirmebene √§ndern und diese Elemente in R√ºckruffunktionen gem√§√ü den erhaltenen Zwischenwerten anzeigen. </font><font style="vertical-align: inherit;">Was in der Tat in meinem Spiel gemacht wird.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dynamische Schatten </font></font></h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fd/4c/1-/fd4c1-dofkcz8fsysds0pbi_-eo.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Anzeigen von Schatten in der gesamten Szene erwies sich als so verschwenderisch, dass beim Einschalten die FPS mehrmals abfielen. </font><font style="vertical-align: inherit;">Das ist nicht gut. </font><font style="vertical-align: inherit;">Wir werden die Schatten der Objekte in einem bestimmten kleinen Quadrat um den Spieler herum anzeigen. </font><font style="vertical-align: inherit;">Ich werde gleich sagen, dass eine solche Technik die Bildrate erheblich erh√∂ht.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier ist nichts kompliziert. Die Schatten von three.js werden in eine bestimmte Schattenkamera geworfen, die in der Box angegeben ist (shadowCameraLeft, shadowCameraRight, shadowCameraTop, shadowCameraBottom). Es kann auf die gesamte Szene ausgedehnt werden oder so gemacht werden, dass es der Hauptkamera folgt und nur Schatten um sie herum geworfen werden. Das einzige, was ich diesem System hinzugef√ºgt habe, ist der Schritt, durch den die Schatten aktualisiert werden. Es ist absolut nicht erforderlich, dieses Update jedes Mal durchzuf√ºhren, wenn der Player zuckt, da dies das System mit Berechnungen l√§dt. Lassen Sie ihn einen bestimmten Mindestabstand entlang einer der drei Achsen √ºberwinden, damit die Schatten aktualisiert werden.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In meiner Bibliothek wird beim Initialisieren der 3D-Welt ein Steuerobjekt erstellt, das jederzeit die Koordinaten der Kamera enth√§lt. Dort k√∂nnen Sie auch den Benutzerparameter contr.cameraForShadowStep einstellen, der den Schritt der Kameraposition enth√§lt, an der sich die Position der Schattenkamera √§ndert. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn beispielsweise das Parallelepiped der Schattenkamera die Abmessungen 700 x 700 x 700 hat, kann contr.cameraForShadowStep beispielsweise auf 20 eingestellt werden. Wenn sich der Spieler auf einer der Achsen um 20 bewegt, wird die Anfangsposition erneut gespeichert und die Schatten um den Spieler herum werden aktualisiert. Der Ma√üstab der 3D-Welt kann beliebig sein, abh√§ngig vom Ma√üstab, in dem alle Modelle im 3D-Editor erstellt wurden. Und es ist wahrscheinlich, dass Sie anstelle von 700x700x700 und 20 7000x7000x7000 und 200 verwenden m√ºssen. Dies √§ndert jedoch nichts an der Essenz.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úbrigens, wenn sich die Sonne am Himmel bewegt, werden die Schatten unabh√§ngig von diesem System aktualisiert, da sich dort die Richtung der Schatten √§ndern sollte. </font><font style="vertical-align: inherit;">Das hei√üt, sie werden aktualisiert, auch wenn der Spieler ohne Bewegung steht. </font><font style="vertical-align: inherit;">Dort wird die Funktion der Aktualisierung der Schatten entsprechend der Aktualisierungsperiode des Himmels dumm genannt.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Punktlichtsystem </font></font></h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kg/fa/be/kgfabepvwgn_zxwfctnyh2rce7g.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Vorhandensein von mehr als einem Dutzend Punktlichtquellen auf der B√ºhne ist in fps so stark wie dynamische Schatten. Und macht es sogar unm√∂glich, den alten "Hanf" zu spielen. Dar√ºber hinaus spielt es keine Rolle, ob sich diese Quellen im Sichtfeld des Spielers (die Reichweite des weltweiten Renderings kann eingestellt werden) oder in betr√§chtlicher Entfernung befinden. Wenn sie dumm auf der B√ºhne sind, funktioniert alles langsam. Daher habe ich im Einstellungsmen√º des Spiels, das vor dem Laden der 3D-Welt aufgerufen werden kann, Optionen f√ºr die Anzahl solcher Quellen (2, 4 oder 8) angegeben, die als "Licht der Laternen" bezeichnet werden.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mr/-g/sr/mr-gsrw4vfm6qjobtc5a36p432s.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher funktioniert es nachts nicht, alle Lichter gleichzeitig auf der B√ºhne einzuschalten. Oben habe ich in der Beschreibung des Weltinitialisierungsschemas Arrays von userPointLights undlightsPDynamicAr vorgestellt. In userPointLights werden die Koordinaten aller Lampenlampen auf der B√ºhne in einem Array festgelegt. UndlightsPDynamicAr enth√§lt die Lichteinstellungen f√ºr alle 8 Instanzen. Abh√§ngig von der Einstellung der Anzahl der Lichter nimmt die Bibliothek die erste davon und f√ºgt sie der Szene im Sichtfeld des Players hinzu.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√§hrend sich der Spieler bewegt, wird nach 2-8 Laternen gesucht, die dem Spieler durch das Koordinatenarray der userPointLights-Laternen am n√§chsten sind. </font><font style="vertical-align: inherit;">Und Punktlichtquellen bewegen sich unter ihnen. </font><font style="vertical-align: inherit;">Mit anderen Worten, 2-8 Beleuchtungslampen folgen dem Spieler und umgeben ihn. </font><font style="vertical-align: inherit;">Dar√ºber hinaus erfolgt dies auch nicht mit jedem Frame von fps, sondern mit einem bestimmten Schritt. </font><font style="vertical-align: inherit;">Es ist absolut nicht erforderlich, die Suchfunktion 60 Mal pro Sekunde zu starten, insbesondere wenn sich der Spieler nicht bewegt. Lassen Sie dann die bereits um ihn herum gefundenen Lichter brennen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So sieht es in Bewegung aus (Xeon E5440, GeForce GT730):</font></font><br><iframe width="560" height="315" src="https://www.youtube.com/embed/IPuJrH8EJ_E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Verteilungsaufbau </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da ich keine ausgefeilte Entwicklungsumgebung verwende (au√üer dem erweiterten Editor), habe ich eine Bat-Datei geschrieben, in der der Google Closure Compiler aufgerufen wird, um den Code jeder * .js-Datei zu verschleiern. </font><font style="vertical-align: inherit;">Und dann wird dort nwjc.exe aus dem nw.js-Bundle aufgerufen, um js in Bin√§rdateien (* .bin) zu kompilieren. </font><font style="vertical-align: inherit;">Ich werde ein Beispiel f√ºr eine der Dateien geben:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">java -jar D: \ webserver \ Closure \ compiler.jar --js D: \ webserver \ proj \ m3d \ www \ game \ bus \ bus.js --js_output_file D: \ webserver \ proj \ nwProjects \ bus \ game \ bus \ bus.js </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd D: \ "Programme" \ Web2Exe \ down \ nwjs-sdk-v0.35.5-win-ia32 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D: \ "Programme" \ Web2Exe \ down \ nwjs-sdk-v0.35.5-win -ia32 \ nwjc.exe D: \ Webserver \ proj \ nwProjects \ bus \ game \ bus \ bus.js D: \ webserver \ proj \ nwProjects \ bus \ game \ bus \ bus.bin </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">del D: \ webserver \ proj \ nwProjects \ bus \ game \ bus \ bus.js</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Als N√§chstes verwende ich das einfache Web2Executable-Dienstprogramm, um eine exe-Datei mit einer Assembly f√ºr Windows zu erstellen. Ich habe nw.js Version 0.35.5 gew√§hlt, obwohl auch neuere Versionen verf√ºgbar sind. Ich habe keine Auswirkungen von ihnen bemerkt, au√üer dass die Baugruppe vergr√∂√üert wurde.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hk/_2/ed/hk_2ed5imb6en8ffx6vtfx_7t-o.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Dienstprogramm kann die ausgew√§hlte Version von nw.js in den angegebenen Ordner selbst herunterladen. </font><font style="vertical-align: inherit;">Die Ausgabe ist eine Baugruppe. </font><font style="vertical-align: inherit;">Die ausf√ºhrbare Datei von 35 Megabyte enth√§lt tats√§chlich das Spiel selbst. </font><font style="vertical-align: inherit;">Alles andere ist Node-Webkit. </font><font style="vertical-align: inherit;">Der Gebietsschema-Ordner enth√§lt offensichtlich Dateien mit einigen Ressourcen in verschiedenen Sprachen. </font><font style="vertical-align: inherit;">Ich habe sie gel√∂scht und nur diejenigen hinterlassen, die mit Englisch zu tun haben. </font><font style="vertical-align: inherit;">Dies hat √ºbrigens den Start der russischsprachigen Version des Spiels nicht verhindert (im Spiel wechselt die Sprache zwischen Russisch und Englisch). </font><font style="vertical-align: inherit;">Warum all diese Dateien dann, wei√ü ich nicht. </font><font style="vertical-align: inherit;">Aber ohne Englisch f√§ngt nichts an. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die gesamte Montage dauerte schlie√ülich 167 MB.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jp/ev/qq/jpevqq5deupdq0zkm7naffok4fa.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dann habe ich alles mit einem der f√ºr diesen Zweck entwickelten kostenlosen Dienstprogramme in eine ausf√ºhrbare Verteilungsdatei gepackt, und die Ausgabe war 70,2 MB Businessman3DSetup.exe. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sf/xd/nn/sfxdnnsvu3fpp9ukkzsius2vqsm.jpeg"></div><br><br><h3>  Posting </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe die Baugruppe an verschiedene App Stores gesendet. Die meisten von ihnen sind noch dabei, mein Spiel zu moderieren. Im Moment hat es nur Juckreiz ver√∂ffentlicht. Ich warne Sie sofort, das Spiel ist bezahlt, der Preis betr√§gt 3 $. Es gibt noch keine Eink√§ufe, aber ich habe mich noch nicht mit der Werbung befasst. GOG weigerte sich zu ver√∂ffentlichen und verwies auf die Tatsache, dass das Spiel recht einfach und nisch ist. Ich stimme im Prinzip zu. Ich denke, Epic Store wird das Gleiche tun.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die ver√∂ffentlichte Version des Spiels ist Einzelbenutzer mit Bots in einer Menge von 1 bis 5. Sprache - Russisch und Englisch. Ich beabsichtige, die Netzwerkversion zu beenden. Es wird jedoch noch dar√ºber nachgedacht, es in Form derselben Anwendung oder in Form einer Webbrowser-Version zu ver√∂ffentlichen, die sofort unter Windows, Linux, iOs und MacOs verf√ºgbar ist und im Allgemeinen √ºberall dort, wo der Browser WebGL unterst√ºtzt. Tats√§chlich ist das Webkit ein Browser und das Spiel funktioniert gut darin, in Firefox, in Edge und sogar in IE11 unter Windows, obwohl es in letzterem sehr langsam ist.</font></font><br><br><h3>  Schlussfolgerungen </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kw/cf/wm/kwcfwmtwbwugbnnsb3gol4bshkk.jpeg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich bin wohl noch nicht bereit, meinen Motor f√ºr den allgemeinen Gebrauch auszulegen, da er noch nicht fertig ist. Ich werde zuerst ein anderes Spiel darauf schreiben, nur das aus dem Demo-Video √ºber Schiffe, denn in diesem Spiel k√∂nnen Sie die Arbeit mit dem Wasser-Shader ‚Äûdurchgehen‚Äú. Au√üerdem plane ich dort eine einfache Physik-Engine zu implementieren. Ja, und Sie m√ºssen noch alle anderen Funktionen ausf√ºhren, um alle Fehler zu beheben. Und es ist besser, dies bei zwei Spielen als bei einem zu tun, da einige Nuancen m√∂glich sind. In der Zwischenzeit ist meine Engine meiner Meinung nach f√ºr ein Spiel immer noch zu stark gesch√§rft.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au√üerdem bin ich mir nicht sicher, ob jemand das alles braucht. </font><font style="vertical-align: inherit;">Wenn Sie n√ºchtern aussehen, schreibt niemand Spiele in reinem Javascript. </font><font style="vertical-align: inherit;">Aber ich mag es, weil die Spiele f√ºr den Browser ziemlich einfach und schnell sind. </font><font style="vertical-align: inherit;">Sie werden schnell geladen, ben√∂tigen nicht viel RAM und arbeiten im Vergleich zu Mitbewerbern in HTML5 recht schnell, selbst im Vergleich zu 2D. </font><font style="vertical-align: inherit;">Ich denke, ich werde mehr als ein Browser-Spiel (und nicht nur) f√ºr all diese Entwicklungen ver√∂ffentlichen.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450926/">https://habr.com/ru/post/de450926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450914/index.html">Verhandlungen fehlgeschlagen: Wie Oracle Java EE get√∂tet hat</a></li>
<li><a href="../de450916/index.html">Vergleich der Qualit√§t von Fotos, die auf Telefonen mit unterschiedlichen Sensorkonfigurationen aufgenommen wurden</a></li>
<li><a href="../de450918/index.html">IT-Wissensmanagement: Die erste Konferenz und das Gesamtbild</a></li>
<li><a href="../de450922/index.html">B√ºro zu Fu√ü</a></li>
<li><a href="../de450924/index.html">Alles √ºber SVG-Animationen</a></li>
<li><a href="../de450928/index.html">Wie Rechenzentren Urlaub sparen</a></li>
<li><a href="../de450930/index.html">Wie wir # bigdataX5 entwickeln und wer in Big Data ben√∂tigt wird</a></li>
<li><a href="../de450938/index.html">Linux Install Fest 05.19 in Nischni Nowgorod 18. Mai 2019</a></li>
<li><a href="../de450940/index.html">Vivaldi 2.5 - Attraktiver Makrokosmos</a></li>
<li><a href="../de450942/index.html">Beiwagen f√ºr eine Code-Aufteilung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>