<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äç‚öñÔ∏è üßúüèΩ üîÅ Une lampe intelligente qui montre l'ambiance de votre ville üë≥üèø üèûÔ∏è üëåüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tout le monde conna√Æt ce sentiment quand il y a un d√©sir obsessionnel de faire quelque chose: acheter quelque chose, cr√©er quelque chose, √©crire quelq...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une lampe intelligente qui montre l'ambiance de votre ville</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419299/"><img src="https://habrastorage.org/webt/uh/vi/eq/uhvieqz4u17x6p6fzdp5lcmx5mi.jpeg"><br><br>  Tout le monde conna√Æt ce sentiment quand il y a un d√©sir obsessionnel de faire quelque chose: acheter quelque chose, cr√©er quelque chose, √©crire quelque chose, appeler quelqu'un ... J'ai donc eu envie de faire quelque chose de mes propres mains.  √Ä la recherche d'un projet appropri√© sur instructables.com, je suis tomb√© dessus et j'ai r√©alis√© - c'est ce dont vous avez besoin! <br><a name="habracut"></a><br>  Tout d'abord, j'ai adapt√© moi-m√™me cette conception de la lampe: <br><br><ul><li>  au lieu de l'humeur du monde entier, j'ai d√©cid√© de prendre l'humeur de ma ville </li><li>  au lieu de framboise pi, j'ai d√©cid√© d'utiliser Arduino (car il √©tait d√©j√† en stock) </li><li> conception de bo√Æte en plexiglas j'ai √©galement chang√© un peu √† ma discr√©tion </li><li>  la possibilit√© de configurer la lampe sans clignoter, via carte sd. </li></ul><br>  La premi√®re √©tape, j'ai d√©cid√© d'√©crire un programme sous arduino.  Le probl√®me √©tait que Arduino n'avait pas de wifi, mais la solution a √©t√© trouv√©e assez rapidement - esp8266.  ESP8266 est un microcontr√¥leur avec interface Wi-Fi.  En plus du Wi-Fi, le microcontr√¥leur se distingue par la possibilit√© d'ex√©cuter des programmes √† partir d'une m√©moire flash externe avec une interface SPI.  La programmation de l'ESP8266 se fait via un adaptateur s√©rie, qui peut √™tre utilis√© comme Arduino.  De plus, les programmes d'√©criture et de clignotement peuvent √©galement √™tre effectu√©s via l'IDE Arduino. <br><br><img src="https://habrastorage.org/webt/so/ns/jv/sonsjv6obvmpnmfjmulf1tqwfn0.jpeg"><br><br>  En travaillant avec la carte ESP-01, j'ai rapidement r√©alis√© que l'utilisation du bundle arduino uno + ESP-01 n'√©tait pas la meilleure solution.  Le fait est que pour programmer la carte, il fallait assembler un petit circuit de programmation.  Bien s√ªr, cela n'est pas difficile, mais tr√®s g√™nant: pour le firmware du module, vous devez connecter ESP-01 via le programmateur √† arduino uno, qui fonctionne en mode adaptateur s√©rie, et pour v√©rifier le fonctionnement du programme, vous avez d√ª reconnecter ESP-01 directement √† arduino uno en mode pantalon afin que les deux cartes puissent √©changer des informations via le port s√©rie. <br><br><img src="https://habrastorage.org/webt/cb/sc/1s/cbsc1sludsx1ty3r3gukccbqe-s.jpeg"><br><br>  Par cons√©quent, j'ai d√©cid√© d'utiliser la carte NodeMCU comme microcontr√¥leur, qui est quelque chose comme esp8266 et arduino mini sur une seule carte.  De plus, elle dispose d'une entr√©e micro usb, ce qui simplifie consid√©rablement la proc√©dure de travail avec elle. <br><br><img src="https://habrastorage.org/webt/zo/6c/ay/zo6cayg0goy_vby2v4wbfigwdic.jpeg"><br><br>  Le programme lui-m√™me s'est av√©r√© assez simple.  Tout d'abord, il se connecte √† un r√©seau wifi, dont le login et le mot de passe sont stock√©s sur la carte SD.  Apr√®s cela, json est t√©l√©charg√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ip-api.com/json</a> pour d√©terminer l'emplacement de la lampe (seuls le nom de la ville et les coordonn√©es g√©ographiques sont tir√©s de l'emballage).  Lorsque l'emplacement de la lampe est connu, le programme commence √† g√©n√©rer des demandes de twitter, en utilisant des mots cl√©s qui d√©crivent chaque ¬´humeur¬ª programm√©e.  Apr√®s avoir trait√© les demandes, le programme calcule le nombre total de tweets et d√©termine le pourcentage de chaque humeur du cycle en cours.  Pour rendre le calcul de l'humeur actuelle plus "vivant" - le programme compare l'humeur actuelle avec la pr√©c√©dente et calcule le pourcentage de variation.  Par exemple, si dans le premier cycle de travail la distribution de l'humeur √©tait de 0,4 pour le bonheur et de 0,05 pour la romance, et dans le deuxi√®me cycle, 0,5 et 0,1, respectivement, le programme choisira ¬´romance¬ª comme humeur actuelle (puisque l'augmentation du bonheur √©tait de 25% et la romance de 100 %).  Cette approche vous permet de r√©agir rapidement aux changements d'humeur soudains dans la ville, ainsi que de suivre les humeurs mixtes (si la fraction massique des deux humeurs est approximativement la m√™me, le programme basculera entre elles √† tour de r√¥le). <br><br>  La deuxi√®me √©tape a √©t√© l'assemblage du bo√Ætier de la lampe.  J'ai imm√©diatement d√©termin√© le mat√©riau - plexiglas opaque (transmission lumineuse √† 44%) de 2 mm d'√©paisseur.  Dans le m√™me temps, selon l'id√©e, l'√©tag√®re inf√©rieure - sur laquelle se trouvent tous les appareils √©lectroniques, √©tait en plexiglas transparent.  En m√™me temps, on a le sentiment que lorsque la lampe fonctionne, la lumi√®re semble s'√©couler par le bas et cr√©e l'illusion de l√©vitation de la lampe elle-m√™me. <br><br>  Je voulais coller les murs taill√©s dans du plexiglas avec de la colle chaude.  Mais une telle conception s'est av√©r√©e instable (probablement en raison de la faible largeur des murs) et s'est constamment effondr√©e.  J'ai alors d√©cid√© de fixer les murs √† l'aide de coins et de vis.  Cette option s'est av√©r√©e plus fiable (mais pas si mignonne), alors je me suis arr√™t√© dessus. <br><br>  Apr√®s avoir assembl√© le bo√Ætier, j'ai proc√©d√© √† la troisi√®me et derni√®re √©tape - l'installation de l'√©lectronique sur l'√©tag√®re inf√©rieure.  Tout √©tait assez simple ici, sauf qu'au lieu des 4 LED pr√©vues, j'en ai utilis√© 8 - 4 suppl√©mentaires sont dirig√©s vers le bas pour cr√©er un effet de l√©vitation.  Le fait est que j'ai rat√© la taille de la lampe et 30% de l'√©tag√®re a mang√© un compartiment pour 4 piles AA, bloquant la lumi√®re des LED. <br><br><img src="https://habrastorage.org/webt/o9/w9/kh/o9w9khoanlb2twipnbkef1g3cfm.jpeg"><br><br>  Et il a √©galement √©t√© d√©couvert que les LED que j'ai achet√©es affichent mal les couleurs complexes.  J'ai donc d√ª me limiter √† 7 simples: rouge, vert, bleu, rose (rouge + bleu), jaune (rouge + vert), turquoise (vert + bleu) et blanc. <br><br>  Le r√©sultat final du travail peut √™tre vu dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o</a> . <br><br>  Dans cette vid√©o, la lampe est en mode d√©monstration - elle commute rapidement toutes les combinaisons de couleurs c√¢bl√©es dans un ordre al√©atoire.  Dans le mode de fonctionnement "normal", la lampe interroge Twitter toutes les dix minutes pour calculer l'ambiance actuelle et change de couleur en fonction des r√©sultats du calcul. <br><br>  Le budget du projet s'√©levait √† un peu plus de 2 000 roubles.  De plus, les pi√®ces les plus ch√®res: 4x piles AA 700r, une feuille de plexiglas d√©poli 600r, nodemcu chinois 500r. <br><br>  Ce qui peut √™tre am√©lior√©: <br><br><ul><li>  Lors de l'assemblage du bo√Ætier, vous pouvez utiliser des coins transparents afin qu'ils ne se d√©tachent pas autant. </li><li>  Le co√ªt d'une bo√Æte en plexiglas peut √™tre consid√©rablement r√©duit si vous achetez une grande feuille de plexiglas et la coupez vous-m√™me. </li><li>  Vous pouvez utiliser des LED plus ch√®res, qui afficheront normalement des couleurs interm√©diaires comme l'orange, le violet, etc. </li><li>  Vous pouvez utiliser une autre source d'alimentation, comme une couronne.  Cela est principalement d√ª au fait que le compartiment des piles pour 4 piles AA est trop grand et bloque une grande quantit√© de lumi√®re provenant du bas de la lampe.  Certes, on ne sait pas combien de temps la lampe peut fonctionner √† partir d'une couronne. </li><li>  Vous pouvez cr√©er une interface Web simple pour r√©gler la lampe.  √âtant donn√© que la biblioth√®que pour travailler avec des cartes SD ne prend pas en charge la langue russe, il est impossible de d√©finir des mots cl√©s pour la recherche de cette mani√®re. </li></ul><br>  Le code du programme peut √™tre trouv√© sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> .  Si ce sera int√©ressant - je peux vous en dire plus sur le programme dans un article s√©par√©. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr419299/">https://habr.com/ru/post/fr419299/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr419283/index.html">Bezos jette de l'argent et des ing√©nieurs pour d√©velopper une fus√©e en lien avec l'acc√©l√©ration de la course √† l'espace</a></li>
<li><a href="../fr419289/index.html">√âcoutez et parlez: annonce de HolyJS 2018 √† Moscou</a></li>
<li><a href="../fr419291/index.html">Annonce de Heisenbug 2018 Moscou: r√©ponses √† toutes les questions</a></li>
<li><a href="../fr419295/index.html">Multimodularit√© et poignard 2. Conf√©rence Yandex</a></li>
<li><a href="../fr419297/index.html">Affichage des commentaires sur Habr√© dans l'ordre d'ajout</a></li>
<li><a href="../fr419303/index.html">Le rapport Tesla a montr√© des pertes et des revenus plus √©lev√©s que pr√©vu par les investisseurs</a></li>
<li><a href="../fr419305/index.html">Jouet espion ou trouvaille: machine √† √©crire Barbie ‚Ñ¢</a></li>
<li><a href="../fr419307/index.html">Roskomnadzor s'int√©resse aux relations d'affaires Facebook</a></li>
<li><a href="../fr419309/index.html">JavaScript Medium Color</a></li>
<li><a href="../fr419311/index.html">Luminaires industriels d'un fabricant domestique Effest avec un bon indice de rendu des couleurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>