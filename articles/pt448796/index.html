<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëâ üéÑ üë©‚Äçüîß Teste de Python com pytest. Configura√ß√£o, CAP√çTULO 6 ü§Ωüèø üë®üèø‚Äçüé§ üîü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voltar Pr√≥ximo 


 Neste cap√≠tulo, examinaremos os arquivos de configura√ß√£o que afetam o pytest, discutiremos como o pytest altera seu comportamento c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Teste de Python com pytest. Configura√ß√£o, CAP√çTULO 6</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448796/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Voltar</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pr√≥ximo</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>Neste cap√≠tulo, examinaremos os arquivos de configura√ß√£o que afetam o pytest, discutiremos como o pytest altera seu comportamento com base neles e faremos algumas altera√ß√µes nos arquivos de configura√ß√£o do projeto Tarefas.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  Os exemplos deste livro foram escritos usando Python 3.6 e pytest 3.2.  O pytest 3.2 suporta Python 2.6, 2.7 e Python 3.3+. </p><br><blockquote> O c√≥digo-fonte do projeto Tarefas, bem como todos os testes mostrados neste livro, est√£o dispon√≠veis no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">link</a> na p√°gina da Web do livro em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  Voc√™ n√£o precisa fazer o download do c√≥digo-fonte para entender o c√≥digo de teste;  o c√≥digo de teste √© apresentado de forma conveniente nos exemplos.  Mas, para acompanhar as tarefas do projeto ou adaptar exemplos de teste para testar seu pr√≥prio projeto (suas m√£os est√£o desamarradas!), Voc√™ deve acessar a p√°gina da Web do livro e fazer o download do trabalho.  L√°, na p√°gina do livro, h√° um link para mensagens de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" title="https://pragprog.com/titles/bopytest/errata">errata</a> e um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" title="https://forums.pragprog.com/forums/438">f√≥rum de discuss√£o</a> . </blockquote><p>  Sob o spoiler, h√° uma lista de artigos desta s√©rie. </p><br><div class="spoiler">  <b class="spoiler_title">Sum√°rio</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>1. Introdu√ß√£o</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>Cap√≠tulo 1: Introdu√ß√£o ao pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>Cap√≠tulo 2: Escrevendo fun√ß√µes de teste</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>Cap√≠tulo 3: Acess√≥rios Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>Cap√≠tulo 4: Acess√≥rios embutidos</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>Cap√≠tulo 5: Plugins</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>Cap√≠tulo 6: Configura√ß√£o</strong></a> (este artigo) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>Cap√≠tulo 7: Usando pytest com outras ferramentas</strong></a> </li></ul></div></div><br><h2 id="konfiguraciya">  Configura√ß√£o </h2><br><p>  At√© agora neste livro, falei sobre v√°rios arquivos que n√£o s√£o de teste que afetam o pytest principalmente de passagem, com a exce√ß√£o do conftest.py, que abordamos com mais detalhes no Cap√≠tulo 5, Plugins, na p√°gina 95. Neste cap√≠tulo, examinaremos os arquivos de configura√ß√£o, que afetam o pytest, discuta como o pytest altera seu comportamento com base neles e fa√ßa algumas altera√ß√µes nos arquivos de configura√ß√£o do projeto Tarefas. </p><br><h2 id="ponimanie-faylov-konfiguracii-pytest">  No√ß√µes b√°sicas sobre arquivos de configura√ß√£o pytest </h2><br><p>  Antes de dizer como voc√™ pode alterar o comportamento padr√£o no pytest, vamos examinar todos os arquivos que n√£o s√£o de teste no pytest e, em particular, quem deve cuidar deles. </p><br><p>  Voc√™ deve saber o seguinte: </p><br><ul><li> <em>pytest.ini</em> : este √© o principal arquivo de configura√ß√£o do Pytest que permite alterar o comportamento padr√£o.  Como voc√™ pode fazer algumas altera√ß√µes na configura√ß√£o, a maior parte deste cap√≠tulo √© dedicada √†s configura√ß√µes que voc√™ pode fazer no <code>pytest.ini</code> . </li><li>  <em>conftest.py</em> : Este √© um plug-in local que permite conectar fun√ß√µes e acess√≥rios de gancho ao diret√≥rio em que o arquivo <code>conftest.py</code> e a todos os seus subdiret√≥rios.  O arquivo <code>conftest.py</code> descrito no cap√≠tulo 5 ‚ÄúPlugins‚Äù na p√°gina 95. </li><li>  <em><code>__init__.py</code></em> : quando colocado em cada subdiret√≥rio de teste, esse arquivo permite que voc√™ tenha nomes de arquivos de teste id√™nticos em v√°rios diret√≥rios de teste.  Veremos um exemplo do que poderia dar errado sem os arquivos <code>__init__.py</code> nos diret√≥rios de teste no artigo ‚ÄúEvitando colis√µes de nomes de arquivos‚Äù na p√°gina 120. </li></ul><br><p>  Se voc√™ usa tox, estar√° interessado em: </p><br><ul><li>  <em>tox.ini</em> : esse arquivo √© semelhante ao <code>pytest.ini</code> , mas para o <code>tox</code> .  No entanto, voc√™ pode colocar sua configura√ß√£o <code>pytest</code> vez de ter o arquivo <code>tox.ini</code> e o arquivo <code>pytest.ini</code> , economizando um arquivo de configura√ß√£o.  O Tox √© discutido no cap√≠tulo 7, ‚ÄúUsando o pytest com outras ferramentas‚Äù, na p√°gina 125. </li></ul><br><p>  Se voc√™ deseja distribuir um pacote Python (por exemplo, Tarefas), este arquivo ser√° do seu interesse: </p><br><ul><li>  <em>setup.cfg</em> : tamb√©m √© um arquivo INI que afeta o comportamento do <code>setup.py</code> .  Voc√™ pode adicionar algumas linhas ao <code>setup.py</code> para executar o <code>python setup.py test</code> e executar todos os seus testes do pytest.  Se voc√™ estiver distribuindo o pacote, voc√™ j√° pode ter o arquivo <code>setup.cfg</code> e pode us√°-lo para armazenar a configura√ß√£o do Pytest.  Voc√™ ver√° como isso √© feito no Ap√™ndice 4, ‚ÄúEmpacotando e distribuindo projetos Python‚Äù na p√°gina 175. </li></ul><br><p>  N√£o importa em qual arquivo voc√™ colocou a configura√ß√£o pytest, o formato ser√° basicamente o mesmo. </p><br><p>  Para <code>pytest.ini</code> : </p><br><blockquote>  <strong>ch6 / format / pytest.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  Para <code>tox.ini</code> : </p><br><blockquote>  <strong>ch6 / formato / tox.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">... tox specific stuff ... [pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  Para <code>setup.cfg</code> : </p><br><blockquote>  <strong>ch6 / format / setup.cfg</strong> </blockquote><br><pre> <code class="plaintext hljs">... packaging specific stuff ... [tool:pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p>  A √∫nica diferen√ßa √© que o cabe√ßalho da se√ß√£o setup.cfg √© <code>[tool:pytest]</code> vez de <code>[pytest]</code> . </p><br><h3 id="list-the-valid-ini-file-options-with-pytest-help">  Listar as op√ß√µes v√°lidas de arquivo ini com pytest ‚Äìhelp </h3><br><p>  Voc√™ pode obter uma lista de todos os par√¢metros v√°lidos para <code>pytest.ini</code> em <code>pytest --help</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --help ... [pytest] ini-options in the first pytest.ini|tox.ini|setup.cfg file found: markers (linelist) markers for test functions empty_parameter_set_mark (string) default marker for empty parametersets norecursedirs (args) directory patterns to avoid for recursion testpaths (args) directories to search for tests when no files or directories are given in the command line. console_output_style (string) console output: classic or with additional progress information (classic|progress). usefixtures (args) list of default fixtures to be used with this project python_files (args) glob-style file patterns for Python test module discovery python_classes (args) prefixes or glob names for Python test class discovery python_functions (args) prefixes or glob names for Python test function and method discovery xfail_strict (bool) default for the strict parameter of xfail markers when not given explicitly (default: False) junit_suite_name (string) Test suite name for JUnit report junit_logging (string) Write captured log messages to JUnit report: one of no|system-out|system-err doctest_optionflags (args) option flags for doctests doctest_encoding (string) encoding used for doctest files cache_dir (string) cache directory path. filterwarnings (linelist) Each line specifies a pattern for warnings.filterwarnings. Processed after -W and --pythonwarnings. log_print (bool) default value for --no-print-logs log_level (string) default value for --log-level log_format (string) default value for --log-format log_date_format (string) default value for --log-date-format log_cli (bool) enable log display during test run (also known as "live logging"). log_cli_level (string) default value for --log-cli-level log_cli_format (string) default value for --log-cli-format log_cli_date_format (string) default value for --log-cli-date-format log_file (string) default value for --log-file log_file_level (string) default value for --log-file-level log_file_format (string) default value for --log-file-format log_file_date_format (string) default value for --log-file-date-format addopts (args) extra command line options minversion (string) minimally required pytest version xvfb_width (string) Width of the Xvfb display xvfb_height (string) Height of the Xvfb display xvfb_colordepth (string) Color depth of the Xvfb display xvfb_args (args) Additional arguments for Xvfb xvfb_xauth (bool) Generate an Xauthority token for Xvfb. Needs xauth. ...</code> </pre> <br><p>  Voc√™ ver√° todas essas configura√ß√µes neste cap√≠tulo, com exce√ß√£o dos <code>doctest_optionflags</code> , discutidos no Cap√≠tulo 7, ‚ÄúUsando o pytest com outras ferramentas‚Äù na p√°gina 125. </p><br><h3 id="plaginy-mogut-dobavlyat-opcii-ini-faylov">  Os plugins podem adicionar op√ß√µes de arquivo ini </h3><br><p>  A lista anterior de configura√ß√µes n√£o √© uma constante.  Para plugins (e arquivos conftest.py), √© poss√≠vel adicionar op√ß√µes de arquivos ini.  As op√ß√µes adicionadas tamb√©m ser√£o adicionadas √† sa√≠da do comando pytest --help. <br>  Agora, vejamos algumas mudan√ßas na configura√ß√£o que podemos fazer usando as configura√ß√µes internas do arquivo .ini dispon√≠veis no core pytest. </p><br><h3 id="izmenenie-parametrov-komandnoy-stroki-po-umolchaniyu">  Alterar op√ß√µes de linha de comando padr√£o </h3><br><p>  Voc√™ j√° usou algumas op√ß√µes de linha de comando para o <em>pytest</em> , como <code>-v/--verbose</code> para sa√≠da detalhada <code>-l/--showlocals</code> para visualizar vari√°veis ‚Äã‚Äãlocais com um rastreamento de pilha para testes com falha.  Voc√™ pode achar que sempre usa algumas dessas <code>options‚Äîor</code> prefere us√°- <code>them‚Äîfor a project</code> .  Se voc√™ instalar <code>addopts</code> no <code>pytest.ini</code> para os par√¢metros necess√°rios, n√£o precisar√° mais inseri-los.  Aqui est√° um conjunto que eu gosto: </p><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict</code> </pre> <br><p>  A <code>-rsxX</code> permite que o pytest relate os motivos de todos os testes <code>skipped</code> , <code>xfailed</code> ou <code>xpassed</code> .  A op√ß√£o <code>-l</code> permite ao pytest exibir um rastreamento de pilha para vari√°veis ‚Äã‚Äãlocais no caso de cada falha.  <code>--tb=short</code> remover√° a maior parte do rastreamento de pilha.  No entanto, ele deixar√° o arquivo e o n√∫mero da linha.  A <code>--strict</code> pro√≠be o uso de tokens se eles n√£o estiverem registrados no arquivo de configura√ß√£o.  Voc√™ ver√° como fazer isso na pr√≥xima se√ß√£o. </p><br><h3 id="registraciya-markerov-chtoby-izbezhat-opechatok-markera">  Registro de marcador para evitar erros de digita√ß√£o de marcadores </h3><br><p>  Marcadores personalizados, conforme descrito em ‚ÄúFun√ß√µes de teste de rotulagem‚Äù na p√°gina 31, s√£o √≥timos para permitir que voc√™ marque um subconjunto de testes para executar com um marcador espec√≠fico.  No entanto, √© muito f√°cil cometer um erro no marcador e, finalmente, alguns testes s√£o marcados com <code>@pytest.mark.smoke</code> e outros s√£o marcados com <code>@pytest.mark.somke</code> .  Por padr√£o, isso n√£o √© um erro.  O pytest apenas pensa que voc√™ criou dois marcadores.  No entanto, isso pode ser corrigido registrando tokens no pytest.ini, como por exemplo: </p><br><pre> <code class="plaintext hljs">[pytest] ... markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get() ...</code> </pre> <br><p>  Ao registrar esses marcadores, agora voc√™ tamb√©m pode v√™-los com <code>pytest --markers</code> com suas descri√ß√µes: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --markers @pytest.mark.smoke: Run the smoke test test functions @pytest.mark.get: Run the test functions that test tasks.get() @pytest.mark.skip(reason=None): skip the ... ...</code> </pre> <br><p>  Se os marcadores n√£o estiverem registrados, eles n√£o aparecer√£o na lista <code>--markers</code> .  Quando eles s√£o registrados, eles s√£o exibidos na lista e, se voc√™ usar <code>--strict</code> , todos os tokens com erros ou n√£o registrados ser√£o exibidos como erros.  A √∫nica diferen√ßa entre <code>ch6/a/tasks_proj</code> e <code>ch6/b/tasks_proj</code> √© o conte√∫do do arquivo pytest.ini.  Em <code>ch6/a</code> vazio.  Vamos tentar executar os testes sem registrar nenhum marcador: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/a/tasks_proj/tests $ pytest --strict --tb=line ============================= test session starts ============================= collected 45 items / 2 errors =================================== ERRORS ==================================== ______________________ ERROR collecting func/test_add.py ______________________ 'smoke' not a registered marker ________________ ERROR collecting func/test_api_exceptions.py _________________ 'smoke' not a registered marker !!!!!!!!!!!!!!!!!!! Interrupted: 2 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 2 error in 1.10 seconds ===========================</code> </pre> <br><p>  Se voc√™ usa marcadores no <code>pytest.ini</code> para registrar seus marcadores, voc√™ tamb√©m pode adicionar <code>--strict</code> aos seus <code>addopts</code> enquanto est√° nisso.  Voc√™ me agradecer√° mais tarde.  Vamos em frente e adicione um arquivo pytest.ini ao projeto de tarefas: </p><br><p>  Se voc√™ usar marcadores no <code>pytest.ini</code> para registrar seus marcadores, tamb√©m poder√° adicionar <code>--strict</code> aos seus <code>addopts</code> .  Voc√™ me agradecer√° mais tarde.  Vamos continuar e adicionar o arquivo pytest.ini ao projeto da tarefa: </p><br><p>  Se voc√™ usar tokens no <code>pytest.ini</code> para registrar tokens, tamb√©m poder√° adicionar <code>--strict</code> aos j√° existentes com <code>addopts</code> .  Legal ?!  <code>pytest.ini</code> agradecimentos e adicione o arquivo <code>pytest.ini</code> ao projeto de <code>tasks</code> : </p><br><blockquote>  ch6 / b / tasks_proj / tests / pytest.ini </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get()</code> </pre> <br><p>  Aqui est√° a combina√ß√£o de sinalizadores preferida por padr√£o: </p><br><ul><li>  <code>-rsxX</code> para <code>-rsxX</code> quais testes foram ignorados, xfailed ou xpassed, </li><li>  <code>--tb = short</code> de um rastreamento mais curto de falhas, </li><li>  <code>--strict</code> a permitir apenas tokens declarados. <br>  E uma lista de marcadores para o projeto. </li></ul><br><p>  Isso deve nos permitir realizar testes, incluindo testes de fuma√ßa: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --strict -m smoke ===================== test session starts ====================== collected 57 items func/test_add.py . func/test_api_exceptions.py .. ===================== 54 tests deselected ====================== =========== 3 passed, 54 deselected in 0.06 seconds ============</code> </pre> <br><h3 id="trebovanie-minimalnoy-versii-pytest">  Requisito m√≠nimo de Pytest </h3><br><p>  O par√¢metro <code>minversion</code> permite especificar a vers√£o m√≠nima do pytest esperada para os testes.  Por exemplo, pretendia usar <code>approx()</code> ao testar n√∫meros de ponto flutuante para determinar a igualdade "razoavelmente pr√≥xima" nos testes.  Mas essa fun√ß√£o n√£o foi introduzida no pytest at√© a vers√£o 3.0.  Para evitar confus√£o, adiciono o seguinte aos projetos que usam <code>approx()</code> : </p><br><pre> <code class="plaintext hljs">[pytest] minversion = 3.0</code> </pre> <br><p>  Portanto, se algu√©m tentar executar testes usando uma vers√£o mais antiga do pytest, uma mensagem de erro ser√° exibida. </p><br><h3 id="ostanovka-pytest-ot-poiska-v-nepravilnyh-mestah">  Pare de pytest de procurar nos lugares errados </h3><br><p>  Voc√™ sabia que uma das defini√ß√µes de "recurse" √© jurar duas vezes no seu pr√≥prio c√≥digo?  Bem, n√£o.  De fato, isso significa contabilizar subdiret√≥rios.  O pytest permitir√° a detec√ß√£o de testes examinando recursivamente v√°rios diret√≥rios.  Mas existem alguns diret√≥rios que voc√™ deseja excluir da exibi√ß√£o do pytest. </p><br><p>  O valor padr√£o para <code>norecurse</code> √© <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code>  <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> √â um bom motivo para nomear seu ambiente virtual como '.venv', porque todos os diret√≥rios que come√ßam com um ponto n√£o estar√£o vis√≠veis. </p><br><p>  No caso do projeto Tarefas, o <code>src</code> n√£o far√° mal em especificar, porque pesquisar em arquivos de teste usando pytest ser√° uma perda de tempo. </p><br><pre> <code class="plaintext hljs">[pytest] norecursedirs = .* venv src *.egg dist build</code> </pre> <br><p>  Ao substituir um par√¢metro que j√° possui um valor √∫til, como esse par√¢metro, √© √∫til saber quais s√£o os valores padr√£o e retornar os que voc√™ precisa, como fiz no c√≥digo anterior com a <code>*.egg dist build</code> . <br>  <code>norecursedirs</code> √© um tipo de consequ√™ncia para os caminhos de teste, ent√£o vamos dar uma olhada nisso mais tarde. </p><br><h3 id="specifikaciya-dereva-testovogo-kataloga">  especifica√ß√£o da √°rvore de diret√≥rios de teste </h3><br><p>  Enquanto <code>norecursedirs</code> diz ao pytest onde procurar, <code>testpaths</code> diz ao pytest onde procurar.  <code>testspaths</code> √© uma lista de diret√≥rios relativos ao diret√≥rio raiz para encontrar testes.  √â usado apenas se o diret√≥rio, arquivo ou <code>nodeid</code> n√£o <code>nodeid</code> especificado como argumento. </p><br><p>  Suponha que, para um projeto de <code>Tasks</code> , colocamos <code>pytest.ini</code> no diret√≥rio <code>tasks_proj</code> , em vez de testes: </p><br><pre> <code class="plaintext hljs">\code\tasks_proj&gt;tree/f . ‚îÇ pytest.ini ‚îÇ ‚îú‚îÄ‚îÄ‚îÄsrc ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtasks ‚îÇ api.py ‚îÇ ... ‚îÇ ‚îî‚îÄ‚îÄ‚îÄtests ‚îÇ conftest.py ‚îÇ pytest.ini ‚îÇ ‚îú‚îÄ‚îÄ‚îÄfunc ‚îÇ test_add.py ‚îÇ ... ‚îÇ ‚îú‚îÄ‚îÄ‚îÄunit ‚îÇ test_task.py ‚îÇ __init__.py ‚îÇ ...</code> </pre> <br><p>  Ent√£o, pode fazer sentido colocar os testes nos <code>testpaths</code> : </p><br><pre> <code class="plaintext hljs">[pytest] testpaths = tests</code> </pre> <br><p>  Agora, se voc√™ executar pytest a partir do diret√≥rio tasks_proj, o pytest pesquisar√° apenas em <code>tasks_proj/tests</code> .  O problema aqui √© que, durante o desenvolvimento e a depura√ß√£o de testes, eu frequentemente itero no diret√≥rio de teste, para que eu possa testar facilmente um subdiret√≥rio ou arquivo sem especificar o caminho inteiro.  Portanto, essa op√ß√£o me ajuda um pouco nos testes interativos. </p><br><p>  No entanto, √© √≥timo para testes em execu√ß√£o a partir de um servidor de integra√ß√£o cont√≠nua ou tox.  Nesses casos, voc√™ sabe que o diret√≥rio raiz ser√° corrigido e poder√° listar os diret√≥rios relativos a esse diret√≥rio raiz fixo.  Tamb√©m s√£o esses os casos em que voc√™ realmente deseja reduzir o tempo de teste, portanto, √© √≥timo se livrar da pesquisa de testes. </p><br><p>  √Ä primeira vista, pode parecer bobagem usar os caminhos de teste e os <code>norecursedirs</code> ao mesmo tempo.  No entanto, como voc√™ j√° viu, os caminhos de teste ajudam pouco nos testes interativos de diferentes partes do sistema de arquivos.  Nesses casos, os <code>norecursedirs</code> podem ajudar.  Al√©m disso, se voc√™ tiver diret√≥rios de teste que n√£o contenham testes, poder√° usar <code>norecursedirs</code> para evit√°-los.  Mas, na verdade, qual √© o sentido de colocar diret√≥rios extras em testes que n√£o t√™m testes? </p><br><h2 id="izmenenie-pravil-obnaruzheniya-testov">  Alterando regras de detec√ß√£o de teste </h2><br><p>  O pytest encontra testes para executar com base em regras espec√≠ficas de descoberta de testes.  Regras padr√£o de detec√ß√£o de teste: </p><br><p>  ‚Ä¢ Comece com um ou mais diret√≥rios.  Voc√™ pode especificar os nomes de arquivos ou diret√≥rios na linha de comando.  Se voc√™ n√£o especificou nada, o diret√≥rio atual √© usado. <br>  ‚Ä¢ Pesquise o cat√°logo e todos os seus subdiret√≥rios por m√≥dulos de teste. <br>  ‚Ä¢ Um m√≥dulo de teste √© um arquivo com um nome semelhante a <code>test_*.py</code> ou <code>*_test.py</code> . <br>  ‚Ä¢ Procure nos m√≥dulos de teste as fun√ß√µes que come√ßam com o teste <em>.</em> <em><br></em>  <em>Procure classes que come√ßam com Teste.</em>  <em>Procure m√©todos nas classes que come√ßam com `test</em> <code>,    </code> <strong>init`</strong> . </p><br><p>  Essas s√£o regras de detec√ß√£o padr√£o;  No entanto, voc√™ pode alter√°-los. </p><br><h3 id="python_classes">  python_classes </h3><br><p>  A regra usual para encontrar testes para pytest e classes √© considerar uma classe como uma classe de teste em potencial se iniciar com <code>Test*</code> .  A classe tamb√©m n√£o pode ter o m√©todo <code>__init__()</code> .  Mas e se quisermos nomear nossas classes de teste como <code>&lt;something&gt;Test</code> ou <code>&lt;something&gt;Suite</code> ?  √â aqui que o <code>python_classes</code> entra: </p><br><pre> <code class="plaintext hljs">[pytest] python_classes = *Test Test* *Suite</code> </pre> <br><p>  Isso nos permite nomear as classes assim: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeleteSuite</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... ....</code> </pre> <br><h3 id="python_files">  python_files </h3><br><p>  Como <code>pytest_classes</code> , <code>python_files</code> modifica a regra de detec√ß√£o de teste padr√£o, que consiste em encontrar arquivos que come√ßam com <code>test_*</code> ou possuem <code>*_test</code> no final. <br>  Suponha que voc√™ tenha uma estrutura de teste personalizada na qual nomeou todos os seus arquivos de teste como <code>check_&lt;something&gt;.py</code> .  Parece razo√°vel.  Em vez de renomear todos os seus arquivos, basta adicionar uma linha ao <code>pytest.ini</code> seguinte maneira: </p><br><pre> <code class="plaintext hljs">[pytest] python_files = test_* *_test check_*</code> </pre> <br><p>  Muito simples  Agora voc√™ pode transferir gradualmente a conven√ß√£o de nomenclatura, se desejar, ou simplesmente deix√°-la como <code>check_*</code> . </p><br><h3 id="python_functions">  python_functions </h3><br><p>  <code>python_functions</code> atua como as duas configura√ß√µes anteriores, mas para fun√ß√µes de teste e nomes de m√©todos.  O valor padr√£o √© <code>test_*</code> .  E para adicionar <code>check_*</code> adivinhou - fa√ßa o seguinte: </p><br><pre> <code class="plaintext hljs">[pytest] python_functions = test_* check_*</code> </pre> <br><p>  As <code>pytest</code> nomenclatura <code>pytest</code> n√£o parecem t√£o restritivas, n√£o √©?  Portanto, se voc√™ n√£o gosta da conven√ß√£o de nomenclatura padr√£o, basta alter√°-la.  No entanto, pe√ßo que voc√™ tenha uma raz√£o mais convincente para tais decis√µes.  Migrar centenas de arquivos de teste √© definitivamente um bom motivo. </p><br><h2 id="zapret-xpass">  Proibi√ß√£o XPASS </h2><br><p>  Definir <code>xfail_strict = true</code> significa que os testes marcados com <code>@pytest.mark.xfail</code> n√£o s√£o reconhecidos como causadores do erro.  Eu acho que essa configura√ß√£o sempre deve ser.  Para obter mais informa√ß√µes sobre o token <code>xfail</code> consulte ‚ÄúMarcando testes aguardando falha‚Äù na p√°gina 37. </p><br><h2 id="predotvraschenie-konfliktov-imen-faylov">  Evitar conflitos de nome de arquivo </h2><br><p>  A utilidade de ter o arquivo <code>__init__.py</code> em cada subdiret√≥rio de teste do projeto me confundiu bastante.  No entanto, a diferen√ßa entre t√™-los ou n√£o √© simples.  Se voc√™ tiver arquivos <code>__init__.py</code> em todos os seus subdiret√≥rios de teste, poder√° ter o mesmo nome de arquivo de teste em v√°rios diret√≥rios.  E se n√£o, ent√£o isso n√£o vai funcionar. </p><br><p>  Aqui est√° um exemplo.  Os diret√≥rios <code>b</code> t√™m o arquivo <code>test_foo.py</code> .  N√£o importa o que esses arquivos cont√™m, mas, para este exemplo, eles se parecem com isso: </p><br><blockquote>  <strong>ch6 / dups / a / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><br>  <strong>ch6 / dups / b / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br></blockquote><p>  Com esta estrutura de diret√≥rios: </p><br><pre> <code class="plaintext hljs">dups ‚îú‚îÄ‚îÄ a ‚îÇ ‚îî‚îÄ‚îÄ test_foo.py ‚îî‚îÄ‚îÄ b ‚îî‚îÄ‚îÄ test_foo.py</code> </pre> <br><p>  Esses arquivos nem t√™m o mesmo conte√∫do, mas os testes est√£o corrompidos.  Voc√™ poder√° execut√°-los separadamente, mas n√£o h√° como executar o <code>dups</code> diret√≥rio <code>dups</code> : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/dups $ pytest a ============================= test session starts ============================= collected 1 item a\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest b ============================= test session starts ============================= collected 1 item b\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest ============================= test session starts ============================= collected 1 item / 1 errors =================================== ERRORS ==================================== _______________________ ERROR collecting b/test_foo.py ________________________ import file mismatch: imported module 'test_foo' has this __file__ attribute: /path/to/code/ch6/dups/a/test_foo.py which is not the same as the test file we want to collect: /path/to/code/ch6/dups/b/test_foo.py HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules !!!!!!!!!!!!!!!!!!! Interrupted: 1 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 1 error in 0.34 seconds ===========================</code> </pre> <br><p>  Nada est√° claro! <br>  Esta mensagem de erro n√£o indica o que deu errado. </p><br><p>  Para corrigir esse teste, basta adicionar o arquivo <code>__init__.py</code> vazio aos subdiret√≥rios.  Aqui est√° um exemplo do diret√≥rio <code>dups_fixed</code> com os mesmos nomes de arquivos duplicados, mas com os arquivos <code>__init__.py</code> adicionados: </p><br><pre> <code class="plaintext hljs">dups_fixed/ ‚îú‚îÄ‚îÄ a ‚îÇ ‚îú‚îÄ‚îÄ __init__.py ‚îÇ ‚îî‚îÄ‚îÄ test_foo.py ‚îî‚îÄ‚îÄ b ‚îú‚îÄ‚îÄ __init__.py ‚îî‚îÄ‚îÄ test_foo.py</code> </pre> <br><p>  Agora vamos tentar novamente a partir do n√≠vel superior em <code>dups_fixed</code> : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/ch6/dups_fixed/ $ pytest ============================= test session starts ============================= collected 2 items a\test_foo.py . b\test_foo.py . ========================== 2 passed in 0.15 seconds ===========================</code> </pre> <br><p>  Ent√£o ser√° melhor. </p><br><p>  Obviamente, voc√™ pode se convencer de que nunca ter√° nomes de arquivos duplicados, o que n√£o importa.  Tudo, como, √© normal.  Mas os projetos est√£o crescendo e os cat√°logos de testes est√£o crescendo, e voc√™ definitivamente quer esperar que isso aconte√ßa antes de cuidar disso?  Eu digo, basta colocar esses arquivos l√°.  Crie um h√°bito e n√£o se preocupe com isso novamente. </p><br><h2 id="uprazhneniya">  Exerc√≠cios </h2><br><p>  No Cap√≠tulo 5, Plugins, na p√°gina 95, voc√™ criou um plugin chamado pytest-nice que inclu√≠a uma op√ß√£o de linha de comando --nice.  Vamos estender isso para incluir uma op√ß√£o pytest.ini chamada nice. </p><br><p>  No Cap√≠tulo 5, ‚ÄúPlugins‚Äù na p√°gina 95, voc√™ criou um plugin chamado <code>pytest-nice</code> que inclui a <code>--nice</code> linha de comando <code>--nice</code> .  Vamos expandir isso para incluir a op√ß√£o <code>pytest.ini</code> chamada <code>nice</code> . </p><br><ol><li>  Adicione a seguinte linha √† fun√ß√£o de gancho <code>pytest_addoption</code> <code>pytest_nice.py</code> : <code>parser.addini('nice', type='bool', help='Turn failures into opportunities.')</code> </li><li>  Os lugares no plugin que usam <code>getoption()</code> tamb√©m ter√£o que chamar <code>getini('nice')</code> .  Fa√ßa essas altera√ß√µes. </li><li>  Verifique isso manualmente adicionando <code>nice</code> ao arquivo <code>pytest.ini</code> . </li><li>  N√£o se esque√ßa dos testes de plugins.  Adicione um teste para verificar se o <code>nice</code> par√¢metro do <code>pytest.ini</code> funcionando corretamente. </li><li>  Adicione testes ao diret√≥rio do plug-in.  Voc√™ precisa encontrar alguns <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recursos adicionais do Pytester</a> . </li></ol><br><h2 id="chto-dalshe">  O que vem a seguir </h2><br><p>  Embora o pytest seja extremamente poderoso por si s√≥ - especialmente com plugins -, ele tamb√©m se integra bem a outras ferramentas de desenvolvimento e teste de software.  No pr√≥ximo cap√≠tulo, examinaremos o uso do pytest em conjunto com outras poderosas ferramentas de teste. </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Voltar</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pr√≥ximo</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt448796/">https://habr.com/ru/post/pt448796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt448774/index.html">SQL para CSV usando DBMS_SQL</a></li>
<li><a href="../pt448776/index.html">RxVMS - Uma Arquitetura Pr√°tica para Aplica√ß√µes de Flutter</a></li>
<li><a href="../pt448782/index.html">Teste de Python com pytest. Introdu√ß√£o ao pytest, Cap√≠tulo 1</a></li>
<li><a href="../pt448784/index.html">Novos recursos para autores de extens√£o no Visual Studio 2019 vers√£o 16.1</a></li>
<li><a href="../pt448792/index.html">Teste de Python com pytest. Acess√≥rios Internos, Cap√≠tulo 4</a></li>
<li><a href="../pt448798/index.html">Teste de Python com pytest. Usando pytest com outras ferramentas, CAP√çTULO 7</a></li>
<li><a href="../pt448802/index.html">Pensando em portais: criando portais no Unreal Engine 4</a></li>
<li><a href="../pt448804/index.html">Preparando-se para o tempo de execu√ß√£o e o not√°rio refor√ßados do macOS</a></li>
<li><a href="../pt448808/index.html">Sobre coisas simples, complicadas. "Dormindo a√ßo". Como lubrificar parafusos enferrujados ou n√£o WD-40 com um √∫nico ...</a></li>
<li><a href="../pt448810/index.html">Como eu peguei um hacker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>