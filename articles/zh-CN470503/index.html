<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ ğŸ‘° ğŸ‘“ Kubernetes RBACç”¨æˆ·å’Œæˆæƒ ğŸ™…ğŸ½ ğŸ”“ ğŸ•–</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æ³¨æ„äº‹é¡¹ ä½©é›·å¤« ï¼šç»§ç»­ä½¿ç”¨æœ€è¿‘è®¨è®ºçš„æœ‰å…³Kuberneteså°¤å…¶æ˜¯RBACçš„å®‰å…¨æ€§ä¸»é¢˜ï¼Œæˆ‘ä»¬æ­£åœ¨å‘å¸ƒAdaltaså¤§æ•°æ®å…¬å¸çš„ä¸€åæ³•å›½é¡¾é—®çš„ææ–™ç¿»è¯‘ã€‚ ä½œè€…è¯¦ç»†è¯´æ˜äº†å¦‚ä½•åˆ›å»ºç”¨æˆ·ï¼Œæˆäºˆç”¨æˆ·æƒé™å¹¶ç»§ç»­ä¸ºå…¶æä¾›æœåŠ¡ã€‚ 

 è®¾ç½®å’Œå¯åŠ¨Kubernetesé›†ç¾¤ä»…ä»…æ˜¯å¼€å§‹ï¼šå®ƒä¹Ÿéœ€è¦è¢«åˆ©ç”¨ã€‚ ä¸ºäº†ä¿æŠ¤å¯¹ç¾¤é›†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kubernetes RBACç”¨æˆ·å’Œæˆæƒ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/470503/">  <i><b>æ³¨æ„äº‹é¡¹</b></i>  <i><b>ä½©é›·å¤«</b></i>  <i>ï¼šç»§ç»­ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ€è¿‘è®¨è®º</a>çš„æœ‰å…³Kuberneteså°¤å…¶æ˜¯RBACçš„å®‰å…¨æ€§ä¸»é¢˜ï¼Œæˆ‘ä»¬æ­£åœ¨å‘å¸ƒAdaltaså¤§æ•°æ®å…¬å¸çš„ä¸€åæ³•å›½é¡¾é—®çš„ææ–™ç¿»è¯‘ã€‚</i>  <i>ä½œè€…è¯¦ç»†è¯´æ˜äº†å¦‚ä½•åˆ›å»ºç”¨æˆ·ï¼Œæˆäºˆç”¨æˆ·æƒé™å¹¶ç»§ç»­ä¸ºå…¶æä¾›æœåŠ¡ã€‚</i> <br><br> è®¾ç½®å’Œå¯åŠ¨Kubernetesé›†ç¾¤ä»…ä»…æ˜¯å¼€å§‹ï¼šå®ƒä¹Ÿéœ€è¦è¢«åˆ©ç”¨ã€‚ ä¸ºäº†ä¿æŠ¤å¯¹ç¾¤é›†çš„è®¿é—®ï¼Œæ‚¨éœ€è¦è®¾ç½®ç”¨æˆ·å‡­æ®å¹¶æ­£ç¡®ç®¡ç†èº«ä»½éªŒè¯å’Œæˆæƒè®¾ç½®ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m5/y9/az/m5y9azz-gbidcxue2_eesz-gvxo.png"></div>  <i>ï¼ˆæ’å›¾æ‘˜è‡ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CNCFåšå®¢</a> -å¤§çº¦ç¿»è¯‘ï¼‰ã€‚</i> <br><br> æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">X.509</a>å®¢æˆ·ç«¯è¯ä¹¦åˆ›å»ºç”¨æˆ·ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨Kubernetesä¸­çš„åŸºæœ¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RBAC</a> APIç®¡ç†æˆæƒã€‚ æˆ‘ä»¬è¿˜å°†è®¨è®ºä¸€äº›ç®€åŒ–é›†ç¾¤ç®¡ç†çš„å¼€æºé¡¹ç›®ï¼šrakkessï¼Œkubectl-who-canï¼Œrbac-lookupå’ŒRBAC Managerã€‚ <a name="habracut"></a><br><h2> å‰ææ¡ä»¶å’Œå‡è®¾ </h2><br> é¦–å…ˆï¼Œå¿…é¡»åšå‡ºå‡ ä¸ªå‡è®¾ï¼š <br><br><ul><li> è‡³å°‘æ‚¨å¯ä»¥æƒ³è±¡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetesæ˜¯å¦‚ä½•å·¥ä½œçš„</a> ã€‚ </li><li> æ‚¨æœ‰ä¸€ä¸ªå¯ç”¨çš„Kubernetesæˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Minikubeé›†ç¾¤</a> ã€‚ </li><li> æ‚¨å·²ç»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…</a>äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubectl CLIå®ç”¨ç¨‹åº</a> ã€‚ </li><li> æ‚¨å·²ç»å®‰è£…äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OpenSSL</a>è½¯ä»¶åŒ…ã€‚ </li></ul><cut></cut><br> å¦‚æœæ‚¨æ²¡æœ‰ç°æˆçš„Kubernetesé›†ç¾¤ï¼Œæˆ‘å»ºè®®æ‚¨å‚è€ƒåŒäº‹çš„æ–‡ç« ï¼ˆArthur BUSSERï¼‰ï¼Œä»–åœ¨å…¶ä¸­è°ˆè®ºä½¿ç”¨Vagrant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨CentOS 7ä¸Šå®‰è£…Kubernetes</a> ã€‚ <br><br> æˆ‘ä»¬é›†ç¾¤ä¸­æœ‰4ä¸ªèŠ‚ç‚¹ï¼š1ä¸ªä¸»èŠ‚ç‚¹å’Œ3ä¸ªå·¥äººã€‚ è¯¥å‘å¯¼è¿˜å°†ç”¨ä½œä¸ç¾¤é›†äº¤äº’çš„è¾¹ç¼˜èŠ‚ç‚¹ã€‚ <br><br><h2>  RBAC API </h2><br> åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰æ˜¯ä¸€ç§åŸºäºå…¬å¸ä¸­å„ä¸ªç”¨æˆ·çš„è§’è‰²æ¥æ§åˆ¶å¯¹è®¡ç®—æœºå’Œç½‘ç»œèµ„æºçš„è®¿é—®çš„æ–¹æ³•ã€‚  RBACå¯ä»¥ä¸æ‰€æœ‰æ”¯æŒCRUDï¼ˆåˆ›å»ºï¼Œè¯»å–ï¼Œæ›´æ–°ï¼Œåˆ é™¤ï¼‰çš„Kubernetesèµ„æºä¸€èµ·ä½¿ç”¨ã€‚ æ­¤ç±»èµ„æºçš„ç¤ºä¾‹ï¼š <br><br><ul><li> å‘½åç©ºé—´ </li><li> è±†èš </li><li> éƒ¨ç½² </li><li> æŒä¹…å·ï¼ˆPersistentVolumesï¼‰ï¼› </li><li>  ConfigMaps </li></ul><br> ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„æ“ä½œç¤ºä¾‹ï¼š <br><br><ul><li>  <code>create</code> ; </li><li>  <code>get</code> </li><li>  <code>delete</code> <i>ï¼ˆdeleteï¼‰</i> ; </li><li>  <code>list</code> <i>ï¼ˆ</i> <code>list</code> <i>è§†å›¾ï¼‰</i> ï¼› </li><li>  <code>update</code> ã€‚ </li></ul><br> ä¸ºäº†åœ¨Kubernetesä¸­ç®¡ç†RBACï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ï¼š <br><br><ul><li>  <b><code>Role</code>å’Œ<code>ClusterRole</code></b> ã€‚ è¿™äº›åªæ˜¯ä»£è¡¨ä¸€ç»„æƒé™çš„è§„åˆ™é›†ã€‚  <code>Role</code>åªèƒ½ç”¨äºæä¾›å¯¹åç§°ç©ºé—´å†…èµ„æºçš„è®¿é—®ã€‚  <code>ClusterRole</code>å¯ä»¥æä¾›ä¸<code>Role</code>ç›¸åŒçš„æƒé™ï¼Œè¿˜å¯ä»¥è®¿é—®æ•´ä¸ªé›†ç¾¤ä¸­çš„å¯ç”¨èµ„æºä»¥åŠæ‰€è°“çš„éèµ„æºç»ˆç»“ç‚¹<i>ï¼ˆä¾‹å¦‚<code>/healthz</code> ã€‚ï¼‰</i> ã€‚ </li><li>  <b><code>Subjects</code></b> ä¸»ä½“æ˜¯å°†åœ¨é›†ç¾¤ä¸­æ‰§è¡Œæ“ä½œçš„å®ä½“ã€‚ å®ƒå¯ä»¥æ˜¯ç”¨æˆ·ï¼ŒæœåŠ¡ç”šè‡³ç»„ã€‚ </li><li>  <b><code>RoleBinding</code>å’Œ<code>ClusterRoleBinding</code></b> ã€‚ é¡¾åæ€ä¹‰ï¼Œè¿™åªæ˜¯å¯¹è±¡ä¸Roleæˆ–ClusterRoleçš„ç»‘å®šã€‚ </li></ul><br>  Kuberneteså…·æœ‰ä»¥ä¸‹é»˜è®¤è§’è‰²ï¼š <br><br><ul><li>  <code>view</code> ï¼šåªè¯»è®¿é—®ï¼Œä¸åŒ…å«ç§˜å¯†ï¼› </li><li>  <code>edit</code> ï¼šä»¥ä¸Šå†…å®¹+ç¼–è¾‘å¤§å¤šæ•°èµ„æºçš„èƒ½åŠ›ï¼Œä¸åŒ…æ‹¬è§’è‰²å’Œè§’è‰²ç»‘å®šï¼› </li><li>  <code>admin</code> ï¼šå…·æœ‰ä»¥ä¸Šèƒ½åŠ›ä»¥åŠåœ¨åç§°ç©ºé—´çº§åˆ«ç®¡ç†è§’è‰²å’Œè§’è‰²æ˜ å°„çš„èƒ½åŠ›ï¼› </li><li>  <code>cluster-admin</code> ï¼šæ‰€æœ‰å¯èƒ½çš„ç‰¹æƒã€‚ </li></ul><br> å½“ç„¶ï¼Œæ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„<code>Roles</code>å’Œ<code>ClusterRoles</code> ï¼Œä½†æ˜¯æˆ‘ä»¬å»ºè®®æ‚¨åœ¨æƒ…å†µå…è®¸çš„æƒ…å†µä¸‹å°½å¯èƒ½å¤šåœ°ä½¿ç”¨é»˜è®¤è§’è‰²ã€‚ å¦åˆ™ï¼Œæ‚¨ä¼šå¾ˆå¿«å¯¹æ­¤æ„Ÿåˆ°å›°æƒ‘ã€‚ <br><br><h2> ä½¿ç”¨èŒƒä¾‹ </h2><br> æˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªåç§°ç©ºé—´ï¼š <code>my-project-dev</code>å’Œ<code>my-project-prod</code> ï¼Œä»¥åŠä¸¤ä¸ªç”¨æˆ·<code>jean</code>å’Œ<code>sarah</code>åœ¨è¿™äº›åç§°ç©ºé—´ä¸­å…·æœ‰ä¸åŒçš„è§’è‰²ï¼š <br><br><ul><li>  my-project-devï¼š <br><ul><li> å‰æ©ï¼šç¼–è¾‘ </li></ul></li><li> æˆ‘çš„é¡¹ç›®äº§å“ï¼š <br><ul><li> å‰æ©ï¼ˆJeanï¼‰ï¼šæŸ¥çœ‹ </li><li> èæ‹‰ï¼šç¼–è¾‘ </li></ul></li></ul><br><h3> ä½¿ç”¨X.509å®¢æˆ·ç«¯è¯ä¹¦åˆ›å»ºå’Œè®¤è¯ç”¨æˆ· </h3><br> é€šå¸¸ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„ç”¨æˆ·ï¼šç”±Kubernetesç®¡ç†çš„<i>æœåŠ¡å¸æˆ·</i>å’Œæ™®é€šç”¨æˆ·ã€‚ æˆ‘ä»¬å°†ä¸“æ³¨äºåè€…ã€‚ å®˜æ–¹æ–‡æ¡£ä¸­å¯¹å®ƒä»¬çš„æè¿°å¦‚ä¸‹ï¼š <br><br><blockquote> å‡å®šå¸¸è§„ç”¨æˆ·ç”±å¤–éƒ¨ç‹¬ç«‹æœåŠ¡ç®¡ç†ã€‚ è¯¥è§’è‰²å¯ä»¥ç”±ç®¡ç†å‘˜åˆ†å‘ç§é’¥ï¼Œç”¨æˆ·å­˜å‚¨åº“ï¼ˆä¾‹å¦‚Keystoneæˆ–Googleå¸æˆ·ï¼‰ï¼Œç”šè‡³æ˜¯åŒ…å«ç”¨æˆ·åå’Œå¯†ç åˆ—è¡¨çš„æ–‡ä»¶æ¥æ‰®æ¼”ã€‚ åœ¨è¿™æ–¹é¢ï¼ŒKubernetesæ²¡æœ‰ä»£è¡¨æ™®é€šç”¨æˆ·çš„å¯¹è±¡ã€‚ ä¸èƒ½é€šè¿‡APIè°ƒç”¨å°†æ™®é€šç”¨æˆ·æ·»åŠ åˆ°ç¾¤é›†ä¸­ã€‚ </blockquote><br> æœ‰å‡ ç§ç®¡ç†æ™®é€šç”¨æˆ·çš„æ–¹æ³•ï¼š <br><br><ul><li> åŸºæœ¬<i>èº«ä»½éªŒè¯</i> ï¼š <ul><li> ä½¿ç”¨ä»¥ä¸‹ï¼ˆæˆ–ç±»ä¼¼çš„ï¼‰å†…å®¹å°†é…ç½®è½¬ç§»åˆ°APIæœåŠ¡å™¨ï¼šå¯†ç ï¼Œç”¨æˆ·åï¼Œuidï¼Œç»„ï¼› </li></ul></li><li>  X.509å®¢æˆ·ç«¯è¯ä¹¦ï¼š <ul><li> åˆ›å»ºç”¨æˆ·çš„å¯†é’¥å’Œè¯ä¹¦ç­¾åè¯·æ±‚ï¼› </li><li> åœ¨è¯ä¹¦é¢å‘æœºæ„ï¼ˆKubernetes CAï¼‰ä¸­è¿›è¡Œè¯ä¹¦ä»¥è·å¾—ç”¨æˆ·è¯ä¹¦ï¼› </li></ul></li><li> æ‰¿è½½ä»¤ç‰Œï¼ˆJSON Webä»¤ç‰Œï¼ŒJWTï¼‰ï¼š <ul><li>  OpenIDè¿æ¥ </li><li>  OAuth 2.0ä¹‹ä¸Šçš„èº«ä»½éªŒè¯å±‚ï¼› </li><li> ç½‘ç»œæŒ‚é’© </li></ul></li></ul><br> åœ¨æœ¬æ–‡ä¸­ï¼Œç”±äºå…¶ç®€å•æ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨X.509å’ŒOpenSSLè¯ä¹¦ã€‚ åˆ›å»ºç”¨æˆ·çš„è¿‡ç¨‹åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µ-æˆ‘ä»¬å°†éå†æ‰€æœ‰é˜¶æ®µã€‚ åº”ä½¿ç”¨å…·æœ‰ç¾¤é›†ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·å¸æˆ·ï¼ˆcluster-adminï¼‰æ‰§è¡Œæ“ä½œã€‚ è¿™æ˜¯åˆ›å»ºç”¨æˆ·çš„æ‰€æœ‰æ­¥éª¤ï¼ˆä»¥<code>jean</code>ä¸ºä¾‹ï¼‰ï¼š <br><br><ul><li> åœ¨å‘å¯¼ä¸Šåˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åè½¬åˆ°å…¶ä¸»ç›®å½•ä»¥å®Œæˆå…¶ä½™æ­¥éª¤ï¼š <br><br><pre> <code class="bash hljs">useradd jean &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/jean</code> </pre> </li><li> åˆ›å»ºä¸€ä¸ªç§é’¥ï¼š <br><br><pre> <code class="bash hljs">openssl genrsa -out jean.key 2048</code> </pre> </li><li> åˆ›å»ºä¸€ä¸ªè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰ã€‚  <code>CN</code>æ˜¯ç”¨æˆ·åï¼Œ <code>O</code>æ˜¯ç»„ã€‚ æ‚¨å¯ä»¥æŒ‰ç»„è®¾ç½®æƒé™ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰è®¸å¤šå…·æœ‰ç›¸åŒæƒé™çš„ç”¨æˆ·ï¼Œè¿™å°†ç®€åŒ–å·¥ä½œï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   openssl req -new -key jean.key \ -out jean.csr \ -subj "/CN=jean" #     $group openssl req -new -key jean.key \ -out jean.csr \ -subj "/CN=jean/O=$group" #       openssl req -new -key jean.key \ -out jean.csr \ -subj "/CN=jean/O=$group1/O=$group2/O=$group3"</span></span></code> </pre> </li><li> åœ¨Kubernetes CAä¸­ç­¾ç½²CSRã€‚ æˆ‘ä»¬å¿…é¡»ä½¿ç”¨é€šå¸¸åœ¨<code>/etc/kubernetes/pki</code>æ‰¾åˆ°çš„CAè¯ä¹¦å’Œå¯†é’¥ã€‚ è¯¥è¯ä¹¦æœ‰æ•ˆæœŸä¸º500å¤©ï¼š <br><br><pre> <code class="bash hljs">openssl x509 -req -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> jean.csr \ -CA /etc/kubernetes/pki/ca.crt \ -CAkey /etc/kubernetes/pki/ca.key \ -CAcreateserial \ -out jean.crt -days 500</code> </pre> </li><li> åˆ›å»º<code>.certs</code>ç›®å½•ã€‚ æˆ‘ä»¬å°†åœ¨å…¶ä¸­å­˜å‚¨ç”¨æˆ·çš„å…¬é’¥å’Œç§é’¥ï¼š <br><br><pre> <code class="bash hljs">mkdir .certs &amp;&amp; mv jean.crt jean.key .certs</code> </pre> </li><li> åœ¨Kubernetesä¸­åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼š <br><br><pre> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-credentials jean \ --client-certificate=/home/jean/.certs/jean.crt \ --client-key=/home/jean/.certs/jean.key</code> </pre> </li><li> ä¸ºç”¨æˆ·è®¾ç½®ä¸Šä¸‹æ–‡ï¼š <br><br><pre> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-context jean-context \ --cluster=kubernetes --user=jean</code> </pre> </li><li> ç¼–è¾‘ç”¨æˆ·é…ç½®æ–‡ä»¶ã€‚ å®ƒåŒ…å«åœ¨é›†ç¾¤ä¸­è¿›è¡Œèº«ä»½éªŒè¯æ‰€éœ€çš„ä¿¡æ¯ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ç¾¤é›†é…ç½®æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é€šå¸¸ä½äº<code>/etc/kubernetes</code> ï¼š <code>certificate-authority-data</code>å’Œ<code>server</code>å˜é‡åº”ä¸ä¸Šè¿°æ–‡ä»¶ä¸­çš„ç›¸åŒï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: v1 clusters: - cluster: certificate-authority-data: {  } server: {  } name: kubernetes contexts: - context: cluster: kubernetes user: jean name: jean-context current-context: jean-context kind: Config preferences: {} users: - name: jean user: client-certificate: /home/jean/.certs/jean.cert client-key: /home/jean/.certs/jean.key</code> </pre> <br> ç°åœ¨ï¼Œæ‚¨éœ€è¦å°†ä¸Šé¢çš„é…ç½®å¤åˆ¶åˆ°<code>.kube</code>ç›®å½•ï¼š <br><br><pre> <code class="bash hljs">mkdir .kube &amp;&amp; vi .kube/config</code> </pre> </li><li> ä»ç„¶éœ€è¦ä½¿ç”¨æˆ·æˆä¸ºæ‰€æœ‰å·²åˆ›å»ºæ–‡ä»¶å’Œç›®å½•çš„æ‰€æœ‰è€…ï¼š <br><br><pre> <code class="bash hljs">chown -R jean: /home/jean/</code> </pre> </li></ul><br> ç”¨æˆ·<code>jean</code>æˆåŠŸåˆ›å»ºã€‚ æˆ‘ä»¬ä¹Ÿä¼šä¸º<code>sarah</code>åšåŒæ ·çš„äº‹æƒ…ã€‚ æœ‰å¾ˆå¤šæ­¥éª¤ï¼Œåˆ›å»ºå¤§é‡ç”¨æˆ·å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ã€‚ å› æ­¤ï¼Œæˆ‘ç¼–å†™äº†ä½¿è¯¥è¿‡ç¨‹è‡ªåŠ¨åŒ–çš„Bashè„šæœ¬ï¼šå¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨GitHub</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜å‚¨åº“ä¸­æ‰¾åˆ°å®ƒä»¬</a> ã€‚ <br><br>  <i><b>æ³¨æ„äº‹é¡¹</b></i>  <i><b>ä½©é›·å¤«</b></i>  <i>ï¼šæ­£å¦‚æˆ‘ä»¬åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ€è¿‘çš„æ–‡ç« ä¸­</a>æ‰€å†™ï¼Œå¯ä»¥é€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubeadmæ§åˆ¶å°å®ç”¨ç¨‹åº</a>ä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„</a>æ–°åŠŸèƒ½ï¼Œä»¥æ›´â€œåŸç”Ÿâ€çš„æ–¹å¼å¯¹Kubernetesç®€åŒ–æ­¤è¿‡ç¨‹ã€‚</i>  <i>ä½†æ˜¯ï¼Œè¯·è®°ä½ï¼Œåœ¨å‘å¸ƒæ­¤ç¿»è¯‘æ—¶ï¼Œå®ƒä»¬ä»¥alphaå½¢å¼æä¾›ã€‚</i>  <i>åˆ›å»ºç”¨æˆ·çš„å‘½ä»¤ç¤ºä¾‹æ˜¯<code>kubeadm alpha kubeconfig user</code> ã€‚</i> <br><br> ç°åœ¨æˆ‘ä»¬æœ‰äº†ç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­åˆ›å»ºä¸¤ä¸ªåç§°ç©ºé—´ï¼š <br><br><pre> <code class="bash hljs">kubectl create namespace my-project-dev kubectl create namespace my-project-prod</code> </pre> <br> ç”±äºæˆ‘ä»¬å°šæœªç¡®å®šç”¨æˆ·æˆæƒï¼Œå› æ­¤ä»–ä»¬ä¸åº”æœ‰æƒè®¿é—®ç¾¤é›†èµ„æºï¼š <br><br><pre> <code class="bash hljs">User: Jean kubectl get nodes Error from server (Forbidden): nodes is forbidden: User <span class="hljs-string"><span class="hljs-string">"jean"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"nodes"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> at the cluster scope kubectl get pods -n default Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"jean"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"default"</span></span> kubectl get pods -n my-project-prod Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"jean"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-prod"</span></span> kubectl get pods -n my-project-dev Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"jean"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-dev"</span></span></code> </pre> <br><pre> <code class="bash hljs">User: Sarah kubectl get nodes Error from server (Forbidden): nodes is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"nodes"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> at the cluster scope kubectl get pods -n default Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"default"</span></span> kubectl get pods -n my-project-prod Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-prod"</span></span> kubectl get pods -n my-project-dev Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-dev"</span></span></code> </pre> <br><h3> åˆ›å»ºè§’è‰²å’ŒClusterRole </h3><br> æˆ‘ä»¬å°†ä½¿ç”¨<code>ClusterRole</code> ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ç”¨ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜å°†å±•ç¤ºå¦‚ä½•åˆ›å»ºè‡ªå·±çš„<code>Role</code>å’Œ<code>ClusterRole</code> ã€‚ æœ¬è´¨ä¸Šï¼Œ <code>Role</code>å’Œ<code>ClusterRole</code>åªæ˜¯å…è®¸æŸäº›èµ„æºå’Œåç§°ç©ºé—´ä½¿ç”¨çš„ä¸€ç»„åŠ¨ä½œ<i>ï¼ˆç§°ä¸º<code>verbs</code> ï¼Œå³é€å­—åŠ¨è¯ï¼‰</i> ã€‚ è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹YAMLæ–‡ä»¶ï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1beta1 kind: Role metadata: name: list-deployments namespace: my-project-dev rules: - apiGroups: [ apps ] resources: [ deployments ] verbs: [ get, list ] --------------------------------- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRole metadata: name: list-deployments rules: - apiGroups: [ apps ] resources: [ deployments ] verbs: [ get, list ]</code> </pre> <br> è¦åˆ›å»ºå®ƒä»¬ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š <br><br><pre> <code class="bash hljs">kubectl create -f /path/to/your/yaml/file</code> </pre> <br><h3> å°†è§’è‰²æˆ–ClusterRoleç»‘å®šåˆ°ç”¨æˆ· </h3><br> ç°åœ¨ï¼Œå°†é»˜è®¤çš„<code>ClusterRole</code> ï¼ˆ <code>edit</code>å’Œ<code>view</code> ï¼‰ç»‘å®šåˆ°æˆ‘ä»¬çš„ç”¨æˆ·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><ul><li>  <code>jean</code> ï¼š <ul><li>  <code>edit</code> -åœ¨åç§°ç©ºé—´<code>my-project-dev</code> ï¼› </li><li> åœ¨å‘½åç©ºé—´<code>my-project-prod</code> <code>view</code> ï¼› </li></ul></li><li>  <code>sarah</code> ï¼š <ul><li>  <code>edit</code> -åœ¨<code>my-project-prod</code>å‘½åç©ºé—´ä¸­ã€‚ </li></ul></li></ul><br>  RoleBindingså¿…é¡»ç”±åç§°ç©ºé—´è€Œä¸æ˜¯ç”¨æˆ·æŒ‡å®šã€‚ æ¢å¥è¯è¯´ï¼Œè¦æˆæƒJeanï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªRoleBindingsã€‚ ä¸€ä¸ªYAMLæ–‡ä»¶çš„ç¤ºä¾‹ï¼Œè¯¥æ–‡ä»¶ä¸º<code>jean</code>å®šä¹‰äº†RoleBindingsï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: jean namespace: my-project-dev subjects: - kind: User name: jean apiGroup: rbac.authorization.k8s.io roleRef: kind: ClusterRole name: edit apiGroup: rbac.authorization.k8s.io --------------------------------- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: jean namespace: my-project-prod subjects: - kind: User name: jean apiGroup: rbac.authorization.k8s.io roleRef: kind: ClusterRole name: view apiGroup: rbac.authorization.k8s.io</code> </pre> <br> æˆ‘ä»¬å…è®¸<code>jean</code> <code>view</code> <code>my-project-prod</code>å¹¶ç¼–è¾‘<code>my-project-dev</code> ã€‚ æˆæƒ<code>sarah</code>ä¹Ÿéœ€è¦åšåŒæ ·çš„äº‹æƒ…ã€‚ è¦æ¿€æ´»å®ƒä»¬ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š <br><br><pre> <code class="bash hljs">kubectl apply -f /path/to/your/yaml/file</code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨äº†<code>kubectl apply</code>è€Œä¸æ˜¯<code>kubectl create</code> ã€‚ ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼Œ <code>create</code>åˆ›å»ºå¯¹è±¡ï¼Œä¸æ‰§è¡Œå…¶ä»–ä»»ä½•æ“ä½œï¼Œç„¶å<code>apply</code> -ä¸ä»…åˆ›å»ºå¯¹è±¡ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼Œè¿˜å¯ä»¥åœ¨å¿…è¦æ—¶è¿›è¡Œæ›´æ–°ã€‚ <br><br> è®©æˆ‘ä»¬æ£€æŸ¥æˆ‘ä»¬çš„ç”¨æˆ·æ˜¯å¦å·²æ”¶åˆ°å¿…è¦çš„æƒé™ã€‚ <br><br><ul><li> ç”¨æˆ·ï¼š <code>sarah</code> ï¼ˆåœ¨<code>my-project-prod</code> <code>edit</code> ï¼‰ <ul><li> <code>my-project-prod</code> <ul> <li> å¯ä»¥åˆ—å‡ºè±†èšï¼ˆ1ï¼‰; </li><li> å¯ä»¥åˆ›å»ºéƒ¨ç½²ï¼ˆ2ï¼‰ã€‚ </li></ul></li><li> <code>my-project-dev</code> <ul> <li> æ— æ³•åˆ—å‡ºè±†èšï¼ˆ4ï¼‰; </li><li> æ— æ³•åˆ›å»ºéƒ¨ç½²ï¼ˆ5ï¼‰ã€‚ </li></ul></li></ul></li></ul><br><pre> <code class="bash hljs">(1) kubectl get pods -n my-project-prod No resources found. (2) kubectl run nginx --image=nginx --replicas=1 -n my-project-prod deployment.apps/nginx created (3) kubectl get pods -n my-project-prod NAME READY STATUS RESTARTS AGE nginx-7db9fccd9b-t14qw 1/1 Running 0 4s (4) kubectl get pods -n my-project-dev Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-dev"</span></span> (5) kubectl run nginx --image=nginx --replicas=1 -n my-project-dev Error from server (Forbidden): deployments.apps is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot create resource <span class="hljs-string"><span class="hljs-string">"deployments"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">"apps"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-dev"</span></span></code> </pre> <br><ul><li> ç”¨æˆ·ï¼š <code>jean</code> ï¼ˆåœ¨<code>my-project-prod</code> <code>view</code>å¹¶åœ¨<code>my-project-dev</code> <code>edit</code> ï¼‰ <ul><li> <code>my-project-prod</code> <ul> <li> å¯ä»¥åˆ—å‡ºè±†èšï¼ˆ1ï¼‰; </li><li> å¯ä»¥åˆ—å‡ºéƒ¨ç½²'ovï¼ˆ2ï¼‰; </li><li> æ— æ³•åˆ é™¤éƒ¨ç½²ï¼ˆ3ï¼‰ã€‚ </li></ul></li><li>  my-project-devï¼š <ul><li> å¯ä»¥åˆ—å‡ºè±†èšï¼ˆ4ï¼‰; </li><li> å¯ä»¥åˆ›å»ºéƒ¨ç½²ï¼ˆ5ï¼‰ï¼› </li><li> å¯ä»¥åˆ—å‡ºéƒ¨ç½²'ovï¼ˆ6ï¼‰; </li><li> å¯ä»¥åˆ é™¤éƒ¨ç½²ï¼ˆ7ï¼‰ã€‚ </li></ul></li></ul></li></ul><br><pre> <code class="bash hljs">(1) kubectl get pods -n my-project-prod NAME READY STATUS RESTARTS AGE nginx-7db9fccd9b-t14qw 1/1 Running 0 101s (2) kubectl get deploy -n my-project-prod NAME READY UP-TO-DATE AVAILABLE AGE nginx 1/1 1 1 110s (3) kubectl delete deploy/nginx -n my-project-prod Error from server (Forbidden): deployments.extensions <span class="hljs-string"><span class="hljs-string">"nginx"</span></span> is forbidden: User <span class="hljs-string"><span class="hljs-string">"jean"</span></span> cannot delete resource <span class="hljs-string"><span class="hljs-string">"deployments"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">"extensions"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-prod"</span></span> (4) kubectl get pods -n my-project-dev No resources found. (5) kubectl run nginx --image=nginx --replicas=1 -n my-project-dev deployment.apps/nginx created (6) kubectl get deploy -n my-project-dev NAME READY UP-TO-DATE AVAILABLE AGE nginx 0/1 1 0 13s (7) kubectl delete deploy/nginx -n my-project-dev deployment.extensions <span class="hljs-string"><span class="hljs-string">"nginx"</span></span> deleted (8) kubectl get deploy -n my-project-dev No resources found.</code> </pre> <br><h2> ç”¨æˆ·ç®¡ç†å’Œæˆæƒ </h2><br> å› æ­¤ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸè®¾ç½®äº†å„ç§è§’è‰²å’Œç”¨æˆ·æˆæƒã€‚ é—®é¢˜å‡ºç°äº†ï¼šç°åœ¨å¦‚ä½•ç®¡ç†æ‰€æœ‰è¿™äº›ï¼Ÿ æˆ‘å¦‚ä½•çŸ¥é“ç‰¹å®šç”¨æˆ·çš„æƒé™è®¾ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ æˆ‘æ€ä¹ˆçŸ¥é“è°æœ‰æƒæ‰§è¡Œç‰¹å®šæ“ä½œï¼Ÿ å¦‚ä½•å¤§è‡´äº†è§£ç”¨æˆ·æƒé™ï¼Ÿ <br><br> æˆ‘ä»¬éœ€è¦æ‰€æœ‰è¿™äº›é—®é¢˜çš„ç­”æ¡ˆï¼Œä»¥ç¡®ä¿ç¾¤é›†å®‰å…¨ã€‚ ä½¿ç”¨<code>kubectl auth can-i</code>å‘½ä»¤<code>kubectl auth can-i</code>ç”¨æˆ·æ˜¯å¦å¯ä»¥æ‰§è¡Œç‰¹å®šæ“ä½œï¼š <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># kubectl auth can-i $action $resource --as $subject (1) kubectl auth can-i list pods (2) kubectl auth can-i list pods --as jean</span></span></code> </pre> <br> ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼ˆ1ï¼‰å…è®¸ç”¨æˆ·ç¡®å®šä»–æ˜¯å¦å¯ä»¥æ‰§è¡ŒæŸäº›æ“ä½œã€‚ ç¬¬äºŒä¸ªï¼ˆ2ï¼‰-å…è®¸ç®¡ç†å‘˜æ¨¡æ‹Ÿç”¨æˆ·ä»¥æŸ¥æ˜ä»–æ˜¯å¦å¯ä»¥æ‰§è¡Œç‰¹å®šæ“ä½œã€‚ ä»…å…·æœ‰ç¾¤é›†ç®¡ç†å‘˜ç‰¹æƒçš„ç”¨æˆ·æ‰èƒ½ä½¿ç”¨æ­¤â€œè½®å›â€ã€‚ <br><br> å‡ ä¹å¯ä»¥ä½¿ç”¨å†…ç½®å·¥å…·åŒ…å®Œæˆæ‰€æœ‰æ“ä½œã€‚ å› æ­¤ï¼Œæˆ‘å°†ä»‹ç»ä¸€äº›å¼€æºé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®å°†æ‰©å±•kubectl auth can-iå›¢é˜Ÿæä¾›çš„åŠŸèƒ½ã€‚ åœ¨ä»‹ç»å®ƒä»¬ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å»ºç«‹ä¾èµ–å…³ç³»ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Go</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Krew</a> ã€‚ <br><br><h2> å»å®‰è£… </h2><br>  Goæ˜¯ä¸€ç§å¼€æºç¼–ç¨‹è¯­è¨€ï¼Œå¯è®©æ‚¨åˆ›å»ºç®€å•ï¼Œå¯é å’Œé«˜æ•ˆçš„è½¯ä»¶ã€‚ å®ƒæ˜¯ç”±Googleåœ¨Cå’ŒPascalçš„å¯å‘ä¸‹æ ¹æ®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Robert Griesemer</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rob Pike</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ken Thompson</a>çš„åŸå§‹æ¦‚å¿µå¼€å‘çš„ã€‚ <br><br><pre> <code class="bash hljs">wget https://dl.google.com/go/go1.12.5.linux-amd64.tar.gz sudo tar -C /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> -xzf go1.12.5.linux-amd64.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span>:/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/go/bin</code> </pre> <br><h2> æœºç»„äººå‘˜å®‰è£… </h2><br>  Krewæ˜¯å¯ç®€åŒ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubectlæ’ä»¶</a>ä½¿ç”¨çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å·¥å…·</a> ã€‚  Krewå¸®åŠ©æ‚¨æŸ¥æ‰¾ï¼Œå®‰è£…å’Œç®¡ç†æ’ä»¶ã€‚ åœ¨åŠŸèƒ½ä¸Šï¼Œå®ƒç±»ä¼¼äºaptï¼Œdnfæˆ–brewç­‰å·¥å…·ã€‚  Krewä»…ä¸1.12åŠæ›´é«˜ç‰ˆæœ¬çš„kubectlå…¼å®¹ã€‚ <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -x; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(mktemp -d)</span></span></span><span class="hljs-string">"</span></span> &amp;&amp; curl -fsSLO <span class="hljs-string"><span class="hljs-string">"https://storage.googleapis.com/krew/v0.2.1/krew.{tar.gz,yaml}"</span></span> &amp;&amp; tar zxvf krew.tar.gz &amp;&amp; ./krew-<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(uname | tr '[:upper:]' '[:lower:]')</span></span></span><span class="hljs-string">_amd64"</span></span> install \ --manifest=krew.yaml --archive=krew.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${KREW_ROOT:-$HOME/.krew}</span></span></span><span class="hljs-string">/bin:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br><h2> ç‘å…‹æ–¯ </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯¥é¡¹ç›®</a>ä½¿æ‚¨å¯ä»¥æŸ¥çœ‹å·²æˆäºˆç”¨æˆ·çš„æ‰€æœ‰æƒé™ã€‚ ä¾‹å¦‚ï¼Œå®ƒæœ‰åŠ©äºå›ç­”<code>jean</code>èƒ½åšä»€ä¹ˆçš„é—®é¢˜ã€‚ é¦–å…ˆï¼Œè®©æˆ‘ä»¬å®‰è£…å®ƒï¼š <br><br><pre> <code class="bash hljs">kubectl krew install access-matrix</code> </pre> <br> é¡¹ç›®æ–‡æ¡£å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨GitHub</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜å‚¨åº“ä¸­æ‰¾åˆ°</a> ã€‚ è¿™æ˜¯ä»–çš„å·¥ä½œç¤ºä¾‹ï¼š <br><br><pre> <code class="bash hljs">kubectl access-matrix -n my-project-dev --as jean</code> </pre> <br><img src="https://habrastorage.org/webt/0g/sq/b6/0gsqb6cw-paqkn6yxbuozzccgpq.png"><br><br><h2> è°èƒ½ </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯¥é¡¹ç›®</a>ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ‰¾å‡ºå“ªäº›ç”¨æˆ·å¯ä»¥æ‰§è¡Œç‰¹å®šæ“ä½œã€‚ å®ƒæœ‰åŠ©äºå›ç­”ä»¥ä¸‹é—®é¢˜ï¼šâ€œè°å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿâ€ å®‰è£…æ–¹å¼ï¼š <br><br><pre> <code class="bash hljs">go get -v github.com/aquasecurity/kubectl-who-can</code> </pre> <br> è¯¥æ–‡æ¡£ä½äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubå­˜å‚¨åº“ä¸­</a> ã€‚ å·¥ä½œç¤ºä¾‹ï¼š <br><br><pre> <code class="bash hljs">kubectl-who-can list pods -n default No subjects found with permissions to list pods assigned through RoleBindings CLUSTERROLEBINDING SUBJECT TYPE SA-NAMESPACE cluster-admin system:masters Group rbac-manager rbac-manager ServiceAccount rbac-manager system:controller:attachdetach-controller attachdetach-controller ServiceAccount kube-system system:controller:clusterrole-aggregation-controller clusterrole-aggregation-controller ServiceAccount kube-system system:controller:cronjob-controller cronjob-controller ServiceAccount kube-system system:controller:daemon-set-controller daemon-set-controller ServiceAccount kube-system system:controller:deployment-controller deployment-controller ServiceAccount kube-system system:controller:endpoint-controller endpoint-controller ServiceAccount kube-system system:controller:generic-garbage-collector generic-garbage-collector ServiceAccount kube-system system:controller:horizontal-pod-autoscaler horizontal-pod-autoscaler ServiceAccount kube-system system:controller:job-controller job-controller ServiceAccount kube-system system:controller:namespace-controller namespace-controller ServiceAccount kube-system system:controller:node-controller node-controller ServiceAccount kube-system system:controller:persistent-volume-binder persistent-volume-binder ServiceAccount kube-system system:controller:pod-garbage-collector pod-garbage-collector ServiceAccount kube-system system:controller:pvc-protection-controller pvc-protection-controller ServiceAccount kube-system system:controller:replicaset-controller replicaset-controller ServiceAccount kube-system system:controller:replication-controller replication-controller ServiceAccount kube-system system:controller:resourcequota-controller resourcequota-controller ServiceAccount kube-system system:controller:statefulset-controller statefulset-controller ServiceAccount kube-system system:coredns coredns ServiceAccount kube-system system:kube-controller-manager system:kube-controller-manager User system:kube-scheduler system:kube-scheduler User</code> </pre> <br><h2> æŸ¥è¯¢ </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯¥é¡¹ç›®</a>æ¦‚è¿°äº†RBACè§„åˆ™ã€‚ å®ƒæœ‰åŠ©äºå›ç­”ä»¥ä¸‹é—®é¢˜ï¼šâ€œ <code>jean</code>å’Œ<code>sarah</code>å±äºå“ªä¸ªè§’è‰²ï¼Ÿâ€ï¼Œâ€œæ‰€æœ‰ç”¨æˆ·éƒ½å±äºå“ªä¸ªè§’è‰²ï¼Ÿâ€ï¼Œâ€œæ•´ä¸ªå›¢é˜Ÿå±äºå“ªä¸ªè§’è‰²ï¼Ÿâ€ã€‚ è¦å®‰è£…ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š <br><br><pre> <code class="bash hljs">kubectl krew install rbac-lookup</code> </pre> <br> è¯¥æ–‡æ¡£ä½äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubå­˜å‚¨åº“ä¸­</a> ã€‚ è¿™æ˜¯å·¥ä½œç¤ºä¾‹ï¼š <br><br><pre> <code class="bash hljs">kubectl-rbac_lookup jean SUBJECT SCOPE ROLE jean my-project-dev ClusterRole/edit jean my-project-prod ClusterRole/view kubectl-rbac_lookup sarah SUBJECT SCOPE ROLE sarah my-project-prod ClusterRole/edit kubectl-rbac_lookup --kind user SUBJECT SCOPE ROLE jean my-project-dev ClusterRole/edit jean my-project-prod ClusterRole/view sarah my-project-prod ClusterRole/edit system:anonymous kube-public Role/kubeadm:bootstrap-signer-clusterinfo system:kube-controller-manager kube-system Role/extension-apiserver-authentication-reader system:kube-controller-manager kube-system Role/system::leader-locking-kube-controller-manager system:kube-controller-manager cluster-wide ClusterRole/system:kube-controller-manager system:kube-proxy cluster-wide ClusterRole/system:node-proxier system:kube-scheduler kube-system Role/extension-apiserver-authentication-reader system:kube-scheduler kube-system Role/system::leader-locking-kube-scheduler system:kube-scheduler cluster-wide ClusterRole/system:kube-scheduler system:kube-scheduler cluster-wide ClusterRole/system:volume-scheduler kubectl-rbac_lookup --kind group SUBJECT SCOPE ROLE system:authenticated cluster-wide ClusterRole/system:basic-user system:authenticated cluster-wide ClusterRole/system:discovery system:authenticated cluster-wide ClusterRole/system:public-info-viewer system:bootstrappers:kubeadm:default-node-token cluster-wide ClusterRole/system:node-bootstrapper system:bootstrappers:kubeadm:default-node-token cluster-wide ClusterRole/system:certificates.k8s.io:certificatesigningrequests:nodeclient system:bootstrappers:kubeadm:default-node-token kube-system Role/kube-proxy system:bootstrappers:kubeadm:default-node-token kube-system Role/kubeadm:kubelet-config-1.14 system:bootstrappers:kubeadm:default-node-token kube-system Role/kubeadm:nodes-kubeadm-config system:masters cluster-wide ClusterRole/cluster-admin system:nodes kube-system Role/kubeadm:kubelet-config-1.14 system:nodes kube-system Role/kubeadm:nodes-kubeadm-config system:nodes cluster-wide ClusterRole/system:certificates.k8s.io:certificatesigningrequests:selfnodeclient system:unauthenticated cluster-wide ClusterRole/system:public-info-viewer</code> </pre> <br><h2>  RBACç»ç† </h2><br> æ­£å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯¥é¡¹ç›®</a>çš„åç§°æ‰€æš—ç¤ºçš„é‚£æ ·ï¼Œä»–æ˜¯RBACçš„ç»ç†ã€‚ å®ƒç®€åŒ–äº†è®¸å¤šå¿…è¦çš„æ“ä½œã€‚ ä¹Ÿè®¸æœ€é‡è¦çš„æ˜¯åˆ›å»ºRoleBindingsã€‚ å‰é¢æˆ‘ä»¬çœ‹åˆ°ï¼Œä¸ºç”¨æˆ·åˆ›å»ºä¸åŒçš„è§’è‰²æ—¶ï¼Œæœ‰å¿…è¦åˆ›å»ºä¸åŒçš„RoleBindingsã€‚  RBAC Manageré€šè¿‡å…è®¸æ‚¨ä¸€æ¬¡åˆ›å»ºä¸€ä¸ªå…·æœ‰æ‰€æœ‰æˆæƒçš„RoleBindingæ¥æä¾›å¸®åŠ©ã€‚ è¦å®‰è£…ï¼Œå¿…é¡»ä»GitHubä¸Šçš„å­˜å‚¨åº“ä¸‹è½½YAMLæ–‡ä»¶ï¼š <br><br><pre> <code class="bash hljs">kubectl apply -f /path/to/rbac/manager/yaml/file</code> </pre> <br> å®˜æ–¹æ–‡æ¡£ä½äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubå­˜å‚¨åº“ä¸­</a> ã€‚ å·¥ä½œç¤ºä¾‹ï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: rbacmanager.reactiveops.io/v1beta1 kind: RBACDefinition metadata: name: jose rbacBindings: - name: jose subjects: - kind: User name: jose roleBindings: - namespace: my-project-prod clusterRole: edit - namespace: my-project-dev clusterRole: edit</code> </pre> <br><h2> ç»“è®º </h2><br> æˆ‘ä»¬ä½¿ç”¨å¸¦æœ‰OpenSSLçš„Xâ€‹â€‹.509å®¢æˆ·ç«¯è¯ä¹¦åœ¨Kubernetesé›†ç¾¤ä¸­åˆ›å»ºäº†ç”¨æˆ·ï¼Œå¹¶æˆæƒäº†ä»–ä»¬ã€‚ ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·åˆ›å»ºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘åœ¨GitHubä¸Šçš„å­˜å‚¨åº“ä¸­</a>å¯ç”¨çš„è„šæœ¬<i>ï¼ˆæˆ–å®éªŒæ€§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubeadmå‘½ä»¤</a> -å¤§çº¦Translã€‚ï¼‰</i> ã€‚ å¯¹äºé›†ç¾¤ç®¡ç†ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æœ¬æ–‡ä»‹ç»çš„å¼€æ”¾æºä»£ç é¡¹ç›®ï¼š <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubectl auth can-i</a> ï¼šç¡®å®šç”¨æˆ·æ˜¯å¦å¯ä»¥æ‰§è¡ŒæŸäº›æ“ä½œï¼› </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">rakkess</a> ï¼šæ‰¾å‡ºç”¨æˆ·å¯ä»¥æ‰§è¡Œçš„æ‰€æœ‰åŠ¨ä½œï¼› </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubectl-who-can</a> ï¼šç¡®å®šå“ªäº›ç”¨æˆ·å¯ä»¥æ‰§è¡ŒæŸäº›æ“ä½œï¼› </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">rbac-lookup</a> ï¼šè·å¾—RBACçš„æ¦‚è¿°ï¼› </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RBAC Manager</a> ï¼šé€šè¿‡ç»„åˆæƒé™ç»‘å®šï¼Œè‡ªåŠ¨æ›´æ”¹RBACï¼Œä½¿ç”¨æ ‡ç­¾ä½œä¸ºé€‰æ‹©å™¨æ¥åˆ†é…æƒé™æ¥ç®€åŒ–é…ç½®ã€‚ </li></ul><br> åˆ›å»ºç”¨æˆ·å¯èƒ½ä¼šå˜æˆä¸€é¡¹éå¸¸è€—æ—¶çš„ä»»åŠ¡ï¼Œå°¤å…¶æ˜¯åœ¨æ‚¨éœ€è¦ä¸€æ¬¡è®¾ç½®å¤§é‡ç”¨æˆ·ï¼ˆæˆ–ç»å¸¸åˆ›å»ºç”¨æˆ·ï¼‰çš„æƒ…å†µä¸‹ã€‚ ä¸ºäº†ç¼“è§£è¿™ç§æƒ…å†µï¼Œå¯ä»¥å°†å…¬å¸LDAPè¿æ¥åˆ°Kubernetesé›†ç¾¤ã€‚ ä¸€äº›å¼€æºé¡¹ç›®ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kismatic</a> <i>[</i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯¹è±¡</a> <i>çœ‹èµ·æ¥åƒåºŸå¼ƒçš„</i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯¹è±¡</a> <i>]</i>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ObjectifLibre</a> ï¼‰æä¾›äº†Kubernetes Webhooksï¼Œå®ƒä»¬å…è®¸é€šè¿‡LDAPè¿›è¡Œç›´æ¥èº«ä»½éªŒè¯ã€‚ å¦ä¸€ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å…¬å¸LDAPä½œä¸ºåç«¯é…ç½®OpenIDæœåŠ¡å™¨ã€‚ <br><br><h2> è¯‘è€…çš„PS </h2><br> å¦è¯·å‚é˜…æˆ‘ä»¬çš„åšå®¢ï¼š <br><br><ul><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetesä¸­çš„å®‰å…¨åŸºç¡€çŸ¥è¯†ï¼šè®¤è¯ï¼Œæˆæƒï¼Œå®¡è®¡</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†è§£Kubernetesä¸Šçš„RBAC</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">33+ Kuberneteså®‰å…¨å·¥å…·</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">9ä¸ªKuberneteså®‰å…¨æœ€ä½³å®è·µ</a> ã€‚â€ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN470503/">https://habr.com/ru/post/zh-CN470503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN470489/index.html">å®‰å…¨å‘¨41ï¼šSIMå¡ä¸­çš„æ›´å¤šæ¼æ´ï¼ŒPDFè§£å¯†</a></li>
<li><a href="../zh-CN470491/index.html">ä»è†æ£˜åˆ°æ¢¦çš„æ¸¸æˆ-ç”Ÿç‰©çš„è¿›æ­¥ä¸è¿›åŒ–</a></li>
<li><a href="../zh-CN470497/index.html">å¦‚ä½•ä½¿ç”¨systemd-nspawnè¿˜åŸLinuxç³»ç»Ÿ</a></li>
<li><a href="../zh-CN470499/index.html">å¦‚ä½•å……åˆ†åˆ©ç”¨Unity Animatorä¸­çš„ä¸­æ–­</a></li>
<li><a href="../zh-CN470501/index.html">Monadâ€œ Readerâ€é€šè¿‡Cï¼ƒå¼‚æ­¥/ç­‰å¾…</a></li>
<li><a href="../zh-CN470513/index.html">æˆ‘å¦‚ä½•æ‰¾åˆ°ä»¥åƒµå°¸ç½‘ç»œä¸ºä¸»å¯¼çš„æ™ºèƒ½å®¶å±…</a></li>
<li><a href="../zh-CN470515/index.html">æµ‹è¯•äººå‘˜çš„ä¸€å°æ­¥ï¼šHeisenbug 2019 Piterçš„åå¤§æŠ¥å‘Š</a></li>
<li><a href="../zh-CN470517/index.html">æœ€å°çš„ä¿„ç½—æ–¯EP</a></li>
<li><a href="../zh-CN470519/index.html">å…·æœ‰æ„å»ºå…·æœ‰å•æ¿æ›´æ–°çš„Linuxç»„ä»¶çš„ç»éªŒï¼Œå¹¶æä¾›æ”¯æŒ</a></li>
<li><a href="../zh-CN470521/index.html">å‘å¸ƒäº†3CX V16 Update 3å’Œé€‚ç”¨äºAndroidçš„æ–°3CXç§»åŠ¨åº”ç”¨</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>