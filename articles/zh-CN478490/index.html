<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔶 👨🏽‍🤝‍👨🏼 🤺 Levenshtein距离和搜索控制器 🌁 🤷🏽 🙌🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="可能在白俄罗斯每个有无轨电车的城市中，都有Telegram上的VK组或聊天室，人们可以在其中跟踪控制器的位置。 这样做主要是为了不支付旅行费用和免费旅行，尽管对团体的描述几乎总是包含“旅行费用”的附言。 

 在VC中，通常如下所示： 



 一个典型的注释如下： 



 结构非常简单。 在注释...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Levenshtein距离和搜索控制器</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478490/"> 可能在白俄罗斯每个有无轨电车的城市中，都有Telegram上的VK组或聊天室，人们可以在其中跟踪控制器的位置。 这样做主要是为了不支付旅行费用和免费旅行，尽管对团体的描述几乎总是包含“旅行费用”的附言。 <br><a name="habracut"></a><br> 在VC中，通常如下所示： <br><br><img src="https://habrastorage.org/webt/ti/eh/cd/tiehcdyeskmccfofp3adt2ko_qe.png" alt="图片"><br><br> 一个典型的注释如下： <br><br><img src="https://habrastorage.org/webt/ki/kp/s0/kikps0wwqqptfwyro8hrf81rtzg.png" alt="图片"><br><br> 结构非常简单。 在注释中，有当前正在注意到控制器的站点的名称，还有它们站着的方向： <br><br><img src="https://habrastorage.org/webt/no/gy/2l/nogy2l1lrraa8gte90lcyuwsume.png" alt="图片"><br><br> 结果，注释是一个带有停止，时间和日期以及唯一标识的对象，通过它我们可以识别它。 这样，您可以计算出控制器现在最有可能的位置。 <br><br><h4> 准备工作 </h4><br> 首先，您需要确定目标公众，我们将从中解析数据。 该小组的评论中应该有很多活动，否则我们可能会获得太少的数据 <br><br> 就我而言，这是“ Control Gomel”组。 <br><br> 我们将使用官方的VKontakte API（适用于Python）解析注释 <br><br> 我们会使用用户的访问密钥进行身份验证，因为某些组可能已关闭，并且只有在您被接受到该组后才能访问他们的评论。 <br> 之后，您可以开始提取注释： <br><br><h4> 接收评论 </h4><br> 首先，我们获得组中最后一个可用的帖子，以通过vk.wall.getComments提取注释，并初始化DataFrame，将数据保存到其中。 <br><br> 每个评论文章都有题词：“祝您有美好的一天，付钱，不要受到控制”，因此请下载评论，检查文章内容并获取评论数组，您可以从中获取数据。 <br><br> 考虑到每天发布1个帖子（现在是11月底，学年从9月开始，并且主管很可能考虑到这一点并更改了他们的普通位置），所以我在过去3个月中对这些帖子进行了评论。 原则上，可以考虑其他符号，例如一年中的时间。 <br><br> 一些评论被诸如“在Barykin上有人吗？”之类的消息所阻塞。 如果您查看这些（不必要的）注释，则可以突出显示一些标志： <br><br><ul><li> 案文包含“干净”，“左”，“没人”等字样。 </li><li>  “告诉我”，“谁”，“什么”，“如何” </li><li> 诸如表情符号之类的符号 </li></ul><br> 之后，我们将通过一系列注释并从中提取唯一的ID，文本，时间，日期和星期几，并将它们放入已创建的DataFrame中。 <br><br><div class="spoiler">  <b class="spoiler_title">接收评论</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> check_correctness <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(lp.login, lp.password) vk_session.auth() vk = vk_session.get_api() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vk <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDataFromComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vk, groupID)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     posts = vk.wall.get(owner_id=groupID, offset=1, count=90) print("\n") data = pd.DataFrame(columns=['text', 'post_id', "date", "day_in_week", "hour","minute", "day_in_month"]) for post in posts.get("items"): # id     postID = post.get("id") if "  ,       " not in post.get("text"): continue #  commentary       comments = vk.wall.getComments(owner_id=groupID, post_id=postID, count=200) #           dataframe for comment in comments.get("items"): text = comment.get("text") text = re.sub(r"A-Za-z--0123456789 ", "", str(text)) commentaryIsNice = check_correctness.detection(text) if commentaryIsNice: print(text) date = comment.get("date") time_struct = time.gmtime(date) post_id = comment.get("post_id") data = data.append({"text": text, "post_id" : post_id, "date": date,"day_in_week" : time_struct.tm_wday, "hour": (time_struct.tm_hour+3), "minute": time_struct.tm_min, "day_in_month": time_struct.tm_mday}, ignore_index=True) # print(data[:10]) # print(data.info()) print("dataset is ready") return data</span></span></code> </pre> <br></div></div><br> 因此，我们收到了一个带有注释文本，其ID，星期几，小时和分钟的DataFrame，该注释是在其中编写的。 我们只需要星期几，写作时间和文字。 看起来像这样： <br><br><img src="https://habrastorage.org/webt/cd/hs/cy/cdhscyg3rx4f5kejgvjdguuscui.png" alt="图片"><br><br><h4> 数据清理 </h4><br> 现在我们需要清除数据。 在搜索Levenshtein距离时，有必要从注释中删除方向，以减少错误。 我们找到“在旁边”，“去”，“如何”，“附近”的表达方式，因为它们通常后面跟第二个停靠点的名称，我们将其删除以及后面的内容，并用常用的行距替换一些行话名称。 <br><br><div class="spoiler">  <b class="spoiler_title">清除资料</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> fuzzywuzzy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> process <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear_commentary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    -     """</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span> splitted = text.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, s <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(splitted): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(splitted) == <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> np.NaN <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> ( <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s)) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>): index = i <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> index &lt; len(splitted) - <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): splitted.remove(splitted[index]) string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = (string.lower()) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> index <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: splitted = splitted[:index] string = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted) text = string.lower() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = <span class="hljs-string"><span class="hljs-string">" "</span></span>.join(splitted).lower() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clean_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>].map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: clear_commentary(s)) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) print(<span class="hljs-string"><span class="hljs-string">"cleaned"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4> 使用Levenshtein距离进行转换 </h4><br> 我们直接进行到Levenshane距离。 有一点帮助：Levenshtein距离-插入一个字符，删除一个字符并用另一个替换一个字符的最少操作数，这是将一行变成另一行所必需的。 <br><br> 我们将使用<a href="https://github.com/seatgeek/fuzzywuzzy">Fuzzywuzzy</a>库找到它。 它可以帮助您快速轻松地计算Levenshtein距离。 为了加快工作速度，该库的作者还建议安装python-Levenshtein库。 <br><br> 为了获得评论的停止，我们需要一个停止列表。  GoTrans应用程序的开发人员Alexander Kozlov向我提供了它。 <br><br> 必须扩展列表，在其中添加一些不存在的站点，并更改部分名称，以便更好地定位它们。 <br><br><div class="spoiler">  <b class="spoiler_title">停止</b> <div class="spoiler_text">  Stops = ['supermarket'，'meadow'，'remybtekhnika'，'Leningrad'，'Yaroslavl'，'Polesskaya'， <br>  'Yaroslavl'，'timofeenko'，'March 8'， <br>  “ Rechitsky交易所”，“ Rechitsky大街”，“马戏团”，“百货商店”，“ Chongarskaya”， <br>  'chongarka'，'ggu'，'skorina'，'university'，'appliance'，'1000个小东西'，'maya'，'station'， <br>  “大学园区”，“贸易与经济”，“周年纪念”，“微区18”，“机场”，“即将来临”， <br>  'gomelgeodezcentr'，'crystal'，'lake lyubenskoye'，'davydovsky市场'，'davydovka'， <br>  '河流sozh'，'gomeldrev'， <br>  'Sevruki'，'gmu 1号'，'Rechitsky等'，'服装'，'传染病医院'，'鸥营'， <br> 沃洛托娃，珊瑚，戈梅尔特格马什，戈梅罗普里克特，温斯戈梅斯特罗伊，报纸， <br>  “ Kalenikova”，“ Eremino”，“蒸馏”，“特殊工业自动化”，“第二学校”，“ Barykina”， <br>  “机器单元”，“青年”，“铸造体”，“化学家”，“ golovatsky”，“ budenny”， <br>  'spu67'，'35th'，'gagarin'，'Gomselmash工厂50年'，'hill'，'radio factory'， <br>  “祖母”，“玻璃厂”，“栗子”，“启动引擎”，“宇航员”， <br>  'rtsrm initial'，'bykhovskaya'，'紧急情况部研究所'，'dk gomselmash'，'store'，'rechitsky'， <br>  'Sevruks'，'Osovtsy'，'游客'，'肉类工厂'，'Holy Trinity'，'medical town'，'October'， <br>  “油库”，“ gomelloblavtotrans”，“ milkavita”，“ bakunin”，“ zip”，“ oma”，“树脂”， <br>  “建筑市场ksk”，“道路建设者”，“现场”，“ kamenetskaya”，“ bolshevik”，“ jakubovka”， <br>  “ Borodina”，“河马大型超市”，“地下英雄”，“ 5月9日”，“栗子”，“假肢”， <br>  “ iput站”，“共产国际”，“音乐教育学院”，“农业公司”，“旁路”，“胜利”， <br>  “西方”，“珍珠”，“弗拉基米尔”，“干”，“药房”，“伊凡诺娃”， <br>  “机械制造”，“桦木”，“ 60年”，“动力工程师”，“中心石”， <br>  “肿瘤诊所”，“射击场”，“ golovintsy”，“珊瑚”，“南方”，“春天”， <br> 埃夫雷莫娃（Efremova），边境，贝尔古特（Belgut），戈梅斯特罗伊（Gomelstroy），鲍里森科（Borisenko），田径宫， <br>  'Michurinsky'，'solar'，'gastello'，'military'，'auto center'，'plumbing'，'uza'， <br>  “医学院”，“幼儿园11”，“布尔什维克”，“幼犬”，“达维多夫斯基”，“海洋”，“进步”， <br>  'Dobrushskaya'，'白色'，'GSK'，'davydovka'，'电气设备'，'友谊'， <br>  “ 70年”，“汽车维修”，“瑞典山”，“赛道”，“水渠”，“机器戈梅利”， <br> 沃洛托娃，先锋，皇家骑警，希姆托尔，第二草地巷，博希纳纳，浴场， <br>  “肿瘤诊所”，“广场”，“列宁”，“第一学校”，“南店”， <br>  “ gomelagrotrans”，“ millers”，“ lyubensky”，“军事征募办公室”，“医院”，“ uza”，“ rtsrm”， <br>  'lysyukovyh'，'shop iput'，'raton'，'gas station'，'randovsky'，'farmhouse'，'chestnut'，'ropovsky'， <br>  “ Romanovichi”，“ Ilyich”，“ rowing”，“建筑业”，“传染性”， <br>  “胖工厂”，“汽车服务”，“农业服务”，“粘性”，“ Nikolskaya”， <br>  “自走式收割机”，“泥瓦匠”，“建材”，“维修机械”，“管理”， <br>  “十月”，“森林童话”，“塔蒂亚娜”，“鲍里斯·察里科夫”，“扎尔科夫斯基”，“扎伊塞娃”， <br>  “搬迁”，“ Karpovich”，“房屋建筑工厂”，“城市电力运输”，“ zlin”， <br>  “体育场gomselmash”，“ ap 6”，“液压驱动”，“机务段”，“汽车市场osovtsy”， <br>  “新生活”，“朱科娃”，“军事部队”，“第三学校”，“森林”，“红色灯塔”， <br>  “区域”，“达维多夫斯卡亚”，“卡尔比雪娃”，“世界卫星”，“青年”，“体育场机车”， <br>  '太阳能'，'Ladaservice'，'μR21'，'Aresa'，'国际主义者'，'Kosareva'， <br>  “ Bogdanova”，“ Gomel铁混凝土”，“μr20a”，“μrRechitsky”，“医疗设备”，“ Juraeva”， <br>  “手工艺品学院”，“冰”，“ dk艺术节”，“购物中心”， <br>  'Kuibyshevsky'，'festival'，'garage koop 27'，'地震工程'，'milcha'，'tube医院'， <br>  “ ptu179”，“化工产品”，“消防部门”，“医院”，“公交仓库”， <br>  '报纸大楼'，'胜利'，'klenkovsky'，'钻石'，'引擎维修'，'mkr 19'] <br></div></div><br> 使用.map和Fuzzywuzzy.process.extractOne，我们在列表中找到最小Levenshtein距离的停靠点，然后用停靠点的名称替换注释文本，这使我们可以获取停靠点名称的数据集。 <br><br> 结果数据集如下所示： <br><br><img src="https://habrastorage.org/webt/gd/pd/c8/gdpdc8lwdppzpastghnasxbqsbi.png"><br><br><div class="spoiler">  <b class="spoiler_title">评论变成停止</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_from_comment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""              """</span></span> dict = process.extractOne(text.lower(), stops) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dict[<span class="hljs-number"><span class="hljs-number">1</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">75</span></span>: text = dict[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: text = np.nan print(<span class="hljs-string"><span class="hljs-string">"wait"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_category_dataset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      """</span></span> print(<span class="hljs-string"><span class="hljs-string">"remap started. wait"</span></span>) data.text = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> comment: get_category_from_comment(str(comment))) print(<span class="hljs-string"><span class="hljs-string">"remap ends"</span></span>) data.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) data[<span class="hljs-string"><span class="hljs-string">"text"</span></span>] = data.text.map(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> s: <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> s==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> s) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data</code> </pre> <br></div></div><br><h4> 数据输出 </h4><br> 现在我们可以假设控制器在给定的时间最有可能在哪里。 <br><br> 我们正在查找一周中特定时间和日期的结果数据记录。 例如，在星期二上午9点： <br><br><pre> <code class="python hljs">&lt;code&gt;data[(data[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == day) &amp; (data[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == hour)]&lt;/code&gt;</code> </pre> <br><img src="https://habrastorage.org/webt/t4/gg/dg/t4ggdgmwezje8lgllisorbqrqwa.png"><br>  <i>（这不是全部数据）</i> <br><br> 之后，我们找到唯一停靠点的数量，并仅显示停靠点及其数量： <br><br><pre> <code class="python hljs">df[(df[<span class="hljs-string"><span class="hljs-string">"day_in_week"</span></span>] == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp; (df[<span class="hljs-string"><span class="hljs-string">"hour"</span></span>] == <span class="hljs-number"><span class="hljs-number">9</span></span>)][<span class="hljs-string"><span class="hljs-string">"text"</span></span>].value_counts()</code> </pre> <br><img src="https://habrastorage.org/webt/yq/az/if/yqazifl3gkclyqw4ifykvemsrky.png"><br><br> 现在我们可以说，在星期二早上9点，管制人员很可能会在ul Myasokombinat的车站被发现。  Lugovaya，BelGUT，TD“奥马”。 <br><br> 这种方法的主要缺陷是缺乏数据。 并非每天都在高峰时段提供注释，因为人们使用公共交通的次数多于不那么受欢迎的时间，但是如果您添加数据（例如，不仅来自一组注释的数据，还会添加数据）来自替代组或电报聊天，以及条目的数量，一切将变得更加容易。 <br><br><h4> 使用VK LongPoll API进行Bot </h4><br> 为了有机会根据时间在不依赖计算机的情况下接收控制器位置的数据，我为VKontakte上的一个小组制作了一个机器人，该机器人通过发送记录中的停靠点数（给定当前时间和星期几）来响应任何消息。 <br><br><div class="spoiler">  <b class="spoiler_title">机器人代码</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> randint <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk_api <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> get_stops_from_data <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_stops_by_time <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_bot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data, token)</span></span></span><span class="hljs-function">:</span></span> vk_session = vk_api.VkApi(token=token) vk = vk_session.get_api() print(<span class="hljs-string"><span class="hljs-string">"bot started"</span></span>) longPoll = vk.groups.getLongPollServer(group_id=<span class="hljs-number"><span class="hljs-number">183524419</span></span>) server, key, ts = longPoll[<span class="hljs-string"><span class="hljs-string">'server'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'key'</span></span>], longPoll[<span class="hljs-string"><span class="hljs-string">'ts'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-comment"><span class="hljs-comment">#  :   ts longPoll = post('%s' % server, data={'act': 'a_check', 'key': key, 'ts': ts, 'wait': 25}).json() if longPoll['updates'] and len(longPoll['updates']) != 0: for update in longPoll['updates']: if update['type'] == 'message_new': #        vk.messages.markAsRead(peer_id=update['object']['user_id']) user = update['object']["user_id"] text = get_stops_by_time(data) if text is None or text == {}: message = "íåò çàïèñåé" vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) print(message) ts = longPoll['ts'] continue message = "   -     \n" \ "\n \n" for i in text.items(): message += i[0] + " " message += str(i[1]) message += "\n" #    vk.messages.send(user_id=user, random_id=randint(-2147483648, 2147483647), message=message) ts = longPoll['ts']</span></span></code> </pre> <br></div></div><br><h4> 结论 </h4><br> 在实践中，我多次验证了这些假设的质量，并且一切正常。 事实证明，尽管无法给出绝对正确的预测，并且控制成功的可能性不是100％，但控制员基本上处于相同的停止位置。  Levenshtein距离具有许多不同的应用，从纠正单词错误到比较基因，染色体和蛋白质，但它在此类应用问题中也具有潜力。 <br><br> 祝您有美好的一天，并支付车费。 <br><br> 所有的bot代码和数据操作均<a href="https://github.com/dingdongyouarewrong/vk_controllers_bot">在此处</a>发布。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN478490/">https://habr.com/ru/post/zh-CN478490/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN478472/index.html">Linux内核库：so或dll形式的Linux内核</a></li>
<li><a href="../zh-CN478474/index.html">兄弟Pablo Escobar也发布了一款灵活的智能手机</a></li>
<li><a href="../zh-CN478480/index.html">人工智能，ITSM，以及一般来说，LEAN在哪里？</a></li>
<li><a href="../zh-CN478482/index.html">开发人员为开发人员打开了一个酒吧，并在那里举行了有关Angular，布局，PHP的会议</a></li>
<li><a href="../zh-CN478486/index.html">10纳米芯片的时代-谁开发了这种处理器以及未来的行业前景</a></li>
<li><a href="../zh-CN478492/index.html">二氧化碳饮食中的大肠杆菌：抗击全球变暖的新工具吗？</a></li>
<li><a href="../zh-CN478494/index.html">Winnum TRP热处理解决方案：设置和使用</a></li>
<li><a href="../zh-CN478496/index.html">50年前，互联网诞生于3420号房间</a></li>
<li><a href="../zh-CN478498/index.html">1. Fortinet入门v 6.0。 引言</a></li>
<li><a href="../zh-CN478500/index.html">为什么夏天的会议这么少？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>