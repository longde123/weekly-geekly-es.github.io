<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐱 👩🏽‍🎤 🌸 修改了蓝牙堆栈，以改善没有AAC，aptX或LDAC编解码器的耳机上的音频质量 🚞 🤣 🚣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在阅读本文之前，建议您阅读上一篇： 蓝牙音频：有关配置文件，编解码器和设备的最详细信息， 

 一些无线耳机用户注意到，使用标准的蓝牙SBC编解码器时，声音质量较低且缺少高频，所有耳机和其他蓝牙音频设备均支持该编码。 获得更好音质的常见建议是购买支持aptX或LDAC编解码器的设备和耳机。 这些编解...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>修改了蓝牙堆栈，以改善没有AAC，aptX或LDAC编解码器的耳机上的音频质量</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456476/"> <i>在阅读本文之前，建议您阅读上一篇： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">蓝牙音频：有关配置文件，编解码器和设备的最详细信息，</a></i> <br><br> 一些无线耳机用户注意到，使用标准的蓝牙SBC编解码器时，声音质量较低且缺少高频，所有耳机和其他蓝牙音频设备均支持该编码。 获得更好音质的常见建议是购买支持aptX或LDAC编解码器的设备和耳机。 这些编解码器需要支付许可费用，这就是与它们一起使用的设备更昂贵的原因。 <br><br> 事实证明，SBC的质量低下是由目前所有蓝牙堆栈和耳机配置的人为限制引起的，而这种限制只能在任何经过​​软件修改的现有设备上才能克服。 <a name="habracut"></a><br><br><h2>  SBC编解码器 </h2>  SBC具有许多在连接建立阶段协商的不同参数： <br><br><ul><li> 音频通道类型和编号：联合立体声，立体声，双通道，单声道； </li><li> 频带数：4或8； </li><li> 一个数据包中的音频块数：4、8、12、16； </li><li> 量化比特分配算法：响度，SNR； </li><li> 量化过程中使用的最大和最小位池：通常为2-53。 </li></ul><br><br> 要求解码器支持这些参数的任何组合。 编码器可能仅实现其中的一部分。 <br> 现有的蓝牙协议栈通常会协商以下我称为“配置文件”的选项集：联合立体声，8频段，16块，响度，比特池2..53。 此配置文件以328 kbps的比特率编码44.1 kHz立体声音频。 <br> 比特池是改变编码比特率的参数：比特率越高，比特率越高，因此质量也越高。 但是确切的位池值仅在准确的配置文件内对应于准确的比特率。 <br> 比特率还受到其他参数的显着影响：音频通道类型，频带数，音频块数。 您可以通过协商非标准配置文件来间接提高比特率，而无需更改比特池。 <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>b</mi><mi>i</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>8</mn><mtext mathcolor=&quot;red&quot;>\&amp;#x6B21;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5E27;</mo></mrow><msub><mtext>&amp;#xA0;</mtext><mi>l</mi></msub><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mtext mathcolor=&quot;red&quot;>\&amp;#x6B21;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x91C7;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x6837;</mo></mrow><msub><mtext>&amp;#xA0;</mtext><mi>r</mi></msub><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5B50;</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5E26;</mo></mrow><mtext mathcolor=&quot;red&quot;>\&amp;#x6B21;</mtext><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x5757;</mo></mrow></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="48.867ex" height="2.66ex" viewBox="0 -832 21039.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-62" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-69" x="429" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-74" x="775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-72" x="1136" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-61" x="1588" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-74" x="2117" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-65" x="2479" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMAIN-3D" x="3223" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-66" x="4529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-72" x="5080" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-61" x="5531" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-63" x="6061" y="0"></use><g transform="translate(6494,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMAIN-38" x="0" y="0"></use><g fill="red" stroke="red" transform="translate(500,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">次</text></g></g><g transform="translate(1830,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">帧</text></g><g transform="translate(2660,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-6C" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-65" x="3222" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-6E" x="3688" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-67" x="4289" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-74" x="4769" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-68" x="5131" y="0"></use><g fill="red" stroke="red" transform="translate(5707,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">次</text></g></g><g transform="translate(7038,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">采</text></g><g transform="translate(7868,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">样</text></g><g transform="translate(8697,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-72" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-61" x="9367" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-74" x="9896" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMATHI-65" x="10258" y="0"></use></g><g transform="translate(17219,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">子</text><g transform="translate(829,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">带</text></g><g fill="red" stroke="red" transform="translate(1659,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/456476/&amp;usg=ALkJrhiy-HMziT1fZ2_6CK2QPV5n1K7qLQ#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">次</text></g></g><g transform="translate(2990,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">块</text></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>b</mi><mi>i</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mn>8</mn><mtext mathcolor="red">\次</mtext><mrow class="MJX-TeXAtom-ORD"><mo>帧</mo></mrow><msub><mtext>&nbsp;</mtext><mi>l</mi></msub><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mtext mathcolor="red">\次</mtext><mrow class="MJX-TeXAtom-ORD"><mo>采</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>样</mo></mrow><msub><mtext>&nbsp;</mtext><mi>r</mi></msub><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mo>子</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>带</mo></mrow><mtext mathcolor="red">\次</mtext><mrow class="MJX-TeXAtom-ORD"><mo>块</mo></mrow></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> bitrate = \ frac {8 \次帧\ _length \次采样\ _rate} {子带\次块} </script></p><br>  <i><font color="#666666">比特率计算公式</font></i> <br><br><br> 例如，与立体声或联合立体声不同，“双通道”模式对每个通道使用单独的位池分别对通道进行编码，而“立体声”或“联合立体声”对两个通道都使用位池。 强制设备使用双通道而不是联合立体声，将使我们获得几乎两倍的617 kbps比特率，而相同的比特池值为53。 <br> 在我看来，位池应该是一个内部变量。 我假定位池值未绑定到其他编解码器参数，而仅将其定义为独立的协商变量是A2DP规范设计错误。 <br><br> 固定比特池和比特率值源自高质量音频的推荐配置文件。 但建议不应成为设置这些参数限制的理由。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc5/5bf/c7d/cc55bfc7d4e0a7e9ca4aee331f6c9992.png" alt="蓝牙SBC配置文件表"><br><br>  A2DP规范v1.2（于2007年至2015年生效）要求所有解码器以最高512 kbps的比特率正常工作： <br><br><blockquote>  SNK的解码器应支持所有不会超过最大比特率的可能的比特池值。 此配置文件将可用最大比特率限制为单声道为320kb / s，双通道模式为512kb / s。 </blockquote><br><br> 在规范的新版本中没有规定比特率限制。 假定2015年后发布的具有EDR支持的现代耳机可以支持高达730 kbps的比特率。 <br><br> 由于某些原因，所有当前测试的蓝牙协议栈（Linux（PulseAudio），Android，Blackberry和macOS）都具有最大比特池参数的人为限制，这直接影响最大比特率。 但这不是最大的问题，几乎所有耳机都将最大位池值限制为53。 <br> 正如我在测试中已经看到的那样，大多数设备在修改后的蓝牙协议栈（比特率为551 kbps）下都可以正常工作，没有中断和and啪声。 但是，在正常情况下，使用现有的蓝牙堆栈无法协商这样的比特率。 <br><br><h2> 蓝牙堆栈修改 </h2> 每个兼容A2DP的蓝牙堆栈都应支持双通道模式，但是没有办法强制使用此模式。 <br><br> 让我们向用户界面添加一个开关！ 我为Android 8.1和Android 9制作了补丁程序，这些补丁程序在堆栈中和开发人员菜单中添加了对双通道的完全支持，并通过在双通道模式上添加一个勾号来作为附加的“高清音频”编解码器（如aptX，AAC或LDAC）来处理双通道模式。蓝牙设备设置如下所示： <br><br><img src="https://habrastorage.org/webt/xd/k_/nn/xdk_nnwukcz446jxexaes4pdscw.png" alt="图片"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android 9补丁</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Android 8.1补丁</a> <br><br> 此复选框切换双通道模式，该模式配置为对EDR 3 Mb / s设备使用<b>551 kbps，</b>对EDR 2 Mb / s设备使用<b>452 kbps</b> 。 <br><br> 此补丁集已合并到以下备用固件中： <br><ul><li>  <b>LineageOS 15.1</b> （自2019年3月31日起）和<b>16.0</b> （自2019年5月13日起） </li><li>  <b>复活混音</b> （自2019年5月14日起） </li><li>  <b>crDroid</b> （自2019年5月13日起） </li></ul><br><br><h2>  551和452 kbps来自哪里？ </h2> 蓝牙时分技术旨在有效传输大型固定大小的数据包。 数据传输发生在插槽中，一次传输中发送的插槽数量最多为5。还有一些传输模式使用1或3个插槽，但不使用2或4。您可以以连接速度在5个插槽中传输多达679个字节。最高2 Mbps，最高1021字节，速度3 Mbps。 在3个插槽中，最大数据量分别为367和552字节。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b86/6c9/653/b866c9653eeb255db44e7fd94a409a90.png" alt="图片"><br><br> 如果我们要传输的数据少于679或1021字节，但多于367或552字节，则传输仍将占用5个时隙，并且传输将占用相同的时间量，从而降低了传输效率。 <br><br><img src="https://habrastorage.org/webt/u_/9e/at/u_9eati7dqlaegfvhdkpmwxsnxq.png" alt="图片"><br><br> 在位通道= 38的双通道模式下使用SBC编码的44100 Hz音频，在一个帧中有16个块，8个频带，可产生164字节的音频帧，并具有452 kb / s的比特率。 <br> 音频有效负载应封装到L2CAP和AVDTP传输协议中，以从音频有效负载中减去16个字节的开销。 <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#x5F00;&amp;#x59CB;{align&amp;#xA0;*}&amp;#x5E27;&amp;#x957F;&amp;#xFF06;=&amp;#xA0;4&amp;#xA0;+&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{&amp;#x5B50;&amp;#x5E26;\&amp;#x6B21;&amp;#x901A;&amp;#x9053;}&amp;#xA0;{2}&amp;#xA0;+&amp;#xA0;\\&amp;#xFF06;\&amp;#x5F00;&amp;#x59CB;{cases}&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{&amp;#x5757;\&amp;#x6B21;&amp;#x901A;&amp;#x9053;\&amp;#x6B21;&amp;#x4F4D;&amp;#x6C60;}&amp;#xA0;{8}&amp;#xFF06;\&amp;#xA0;text&amp;#xA0;{&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x5355;&amp;#x901A;&amp;#x9053;&amp;#x6216;&amp;#x53CC;&amp;#x901A;&amp;#x9053;&amp;#x6A21;&amp;#x5F0F;&amp;#xFF0C;&amp;#x5219;\\&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{&amp;#x5B50;&amp;#x5E26;+&amp;#x5757;\&amp;#x6B21;&amp;#x6BD4;&amp;#x7279;&amp;#x6C60;}&amp;#xA0;{8}&amp;#xFF06;\&amp;#x6587;&amp;#x672C;{&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x8054;&amp;#x5408;&amp;#x7ACB;&amp;#x4F53;&amp;#x58F0;&amp;#x6A21;&amp;#x5F0F;}&amp;#xA0;\\&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{&amp;#x5757;\&amp;#x6B21;&amp;#x6BD4;&amp;#x7279;&amp;#x6C60;}&amp;#xA0;{8}&amp;#xFF06;\&amp;#x6587;&amp;#x672C;{&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#x7ACB;&amp;#x4F53;&amp;#x58F0;&amp;#x6A21;&amp;#x5F0F;}&amp;#xA0;\\&amp;#xA0;\&amp;#x7ED3;&amp;#x675F;{cases}&amp;#xA0;\&amp;#x7ED3;&amp;#x675F;{align&amp;#xA0;*}</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">\开始{align&nbsp;*}帧长＆=&nbsp;4&nbsp;+&nbsp;\&nbsp;frac&nbsp;{子带\次通道}&nbsp;{2}&nbsp;+&nbsp;\\＆\开始{cases}&nbsp;\&nbsp;frac&nbsp;{块\次通道\次位池}&nbsp;{8}＆\&nbsp;text&nbsp;{如果是单通道或双通道模式，则\\&nbsp;\&nbsp;frac&nbsp;{子带+块\次比特池}&nbsp;{8}＆\文本{如果是联合立体声模式}&nbsp;\\&nbsp;\&nbsp;frac&nbsp;{块\次比特池}&nbsp;{8}＆\文本{如果是立体声模式}&nbsp;\\&nbsp;\结束{cases}&nbsp;\结束{align&nbsp;*}</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>\开始{align&nbsp;*}帧长＆=&nbsp;4&nbsp;+&nbsp;\&nbsp;frac&nbsp;{子带\次通道}&nbsp;{2}&nbsp;+&nbsp;\\＆\开始{cases}&nbsp;\&nbsp;frac&nbsp;{块\次通道\次位池}&nbsp;{8}＆\&nbsp;text&nbsp;{如果是单通道或双通道模式，则\\&nbsp;\&nbsp;frac&nbsp;{子带+块\次比特池}&nbsp;{8}＆\文本{如果是联合立体声模式}&nbsp;\\&nbsp;\&nbsp;frac&nbsp;{块\次比特池}&nbsp;{8}＆\文本{如果是立体声模式}&nbsp;\\&nbsp;\结束{cases}&nbsp;\结束{align&nbsp;*}</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> \开始{align *}帧长＆= 4 + \ frac {子带\次通道} {2} + \\＆\开始{cases} \ frac {块\次通道\次位池} {8}＆\ text {如果是单通道或双通道模式，则\\ \ frac {子带+块\次比特池} {8}＆\文本{如果是联合立体声模式} \\ \ frac {块\次比特池} {8}＆\文本{如果是立体声模式} \\ \结束{cases} \结束{align *} </script></p><br><br><br><br> 一个5插槽音频传输最多可以包含4个音频帧： <br><pre><code class="plaintext hljs">679 (EDR 2 mbit/s DH5) - 4 (L2CAP) - 12 (AVDTP/RTP) - 1 (SBC header) - (164*4) = 6</code> </pre> <br> 单个数据包最多可传输11.7 ms的音频数据，这些数据将在3.75 ms内传输，并且数据包中还有6个未使用的字节。 <br> 如果稍微提高比特池，则无法再将4个音频帧打包到一个传输中。 您必须一次发送3帧，这会降低传输效率，减少在一个数据包中传输的音频量，并且会增加在恶劣无线电条件下出现音频卡顿的机会。 <br><br> 使用相同的原理选择EDR 3 Mbps的551 kbps比特率：对于Bitpool 47，每帧16个块，8个频段，帧大小为200字节，比特率为551 kbps。 单次传输最多可以捆绑5帧或14.6 ms的音乐。 <br><br> 计算所有SBC参数的算法非常复杂，如果尝试手动计算所有参数，您很容易犯错，所以我制作了一个交互式计算器来帮助有兴趣的人： <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">btcodecs.valdikss.org.ru/sbc-bitrate-calculator</a> <br><br><h2> 那是为了什么？ </h2> 与aptX声音质量的普遍看法相反，在某些情况下，它可以产生比标准328k比特率的SBC差的音频质量。 <br><br>  SBC以“从下到上”的方式为频段动态分配量化位。 如果整个比特率都用于较低和中频，则“最高频率”被“切断”（静音）。 <br>  aptX不断地量化具有相同位数的频带，这使其成为恒定的比特率编解码器：44.1 kHz为352 kbps，48 kHz为384 kbps。 它无法将“位”“转移”到最需要它们的频率。 与SBC不同，aptX不会“削减”频率，但会向其添加量化噪声，从而减小音频的动态范围，并有时会产生裂纹。 相反，SBC“吃细节”-丢弃最安静的区域。 <br> 平均而言，与SBC 328k相比，aptX在较宽频率范围的音乐中产生的失真较小，但在较窄频率范围和较宽动态范围的音乐中，SBC 328k有时会获胜。 <br><br> 让我们考虑一个特殊情况，钢琴录音。 这是一个频谱图： <br> <a href=""><img src="https://habrastorage.org/webt/i9/uh/z1/i9uhz1ewchvoprxywldrtfknlom.jpeg" alt="图片"></a> <br><br> 大部分能量位于0-4 kHz频率内，并持续高达10 kHz。 <br>  aptX文件的频谱图如下所示： <br> <a href=""><img src="https://habrastorage.org/webt/sx/3i/lw/sx3ilwm6riwrjelw-ofmljdd54m.jpeg" alt="图片"></a> <br><br> 这是SBC 328k： <br> <a href=""><img src="https://habrastorage.org/webt/ah/ob/br/ahobbramaxjmsr0htxagkiflomk.jpeg" alt="图片"></a> <br><br> 可以看出，SBC 328k定期完全切断16 kHz以上的范围，并对低于此值的频率范围使用了所有可用的比特率。 但是，aptX在人耳可听的频谱中引入了更多的失真，这可以从aptX频谱图减去原始音频频谱图中看到（失真越亮，失真越大）： <br> <a href=""><img src="https://habrastorage.org/webt/_e/vj/gv/_evjgvlrkbymm5ptv5ymkn2orya.jpeg" alt="图片"></a> <br><br>  SBC 328k在0到10 kHz范围内对信号引入的失真较小，并且剩余的频率已被削减： <br> <a href=""><img src="https://habrastorage.org/webt/-a/m6/23/-am623wsmq09jfcr80kmkjubp0u.jpeg" alt="图片"></a> <br><br>  485k比特率足以让SBC保存整个频率范围，而不会切断频段。 <br> <a href=""><img src="https://habrastorage.org/webt/xx/a0/pa/xxa0patcvltugsfjwxzmh_na_rm.jpeg" alt="图片"></a> <br><br> 在此样本上，SBC 485k在0-15 kHz范围内比aptX产生更好的结果，并且在15-22 kHz时，差异较小但仍然很明显（越暗，失真越小）： <br> <a href=""><img src="https://habrastorage.org/webt/yv/mi/7v/yvmi7vfj5-ot3ztrfv-gvx43yxy.jpeg" alt="图片"></a> <br><br>  <a href="">使用原始音频和SBC / aptX编码的文件进行存档</a> 。 <br><br> 通过切换到高比特率SBC，您可以在任何耳机上获得大部分时间优于aptX的声音。 在支持EDR 3 Mb / s的耳机上，551 kb / s SBC产生的声音非常接近aptX HD。 <br><br><h2> 我们可以走得更远吗？ </h2>  Android补丁集还有一个附加选项，可以进一步提高EDR 2 mbps设备的比特率。 您可以将比特率从452 kbps提高到595 kbps，以降低在无线电拥塞情况下传输的稳定性为代价。 <br> 只需将persist.bluetooth.sbc_hd_higher_bitrate变量设置为1： <br><pre> <code class="plaintext hljs"># setprop persist.bluetooth.sbc_hd_higher_bitrate 1</code> </pre> <br> 极限比特率补丁当前仅在LineageOS 15.1中合并，而在16.0中不合并。 <br><br><h2> 与设备的兼容性 </h2> 几乎所有耳机，扬声器和车载音响系统都支持SBC双通道。 这也就不足为奇了-该标准要求其在任何解码设备中都必须支持。 在少数设备上，此模式会导致问题，但是这种情况很少见。 <br> 有关兼容设备的更多详细信息，请访问<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">w3bsit3-dns.com</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">xda-developers</a> 。 <br><br><h2> 声音差异比较 </h2> 我制作了一个Web服务，可以在浏览器中实时将音频编码为SBC（以及aptX和aptX HD）。 您无需使用任何服务即可在任何有线耳机，扬声器和您喜欢的音乐上通过蓝牙实际传输音频的情况下，就可以比较不同SBC配置文件和其他编解码器的声音。 您也可以在音频播放期间直接更改编码参数。 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">btcodecs.valdikss.org.ru/sbc-encoder</a> <br><br><h2> 与Android开发人员联系 </h2> 我试图与Google的许多蓝牙堆栈开发人员联系，请他们考虑将我的补丁包括在主要的Android分支AOSP中，但没有得到一个答案。 我在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">适用于Android的Gerrit代码检查系统中的</a>补丁也没有收到开发人员的任何评论。 <br> 如果有人能告诉Google开发人员有关SBC HD for Android的实现，我将感到非常高兴。  gerrit补丁集已经过时（这是最早的修订版之一），但是如果开发人员对我的更改感兴趣，我将对其进行更新（更新起来不容易，因为我没有与Android Q兼容的设备） 。 <br><br><h2> 结论 </h2>  LineageOS，Resurrection Remix和crDroid固件的用户可以通过选中蓝牙设备设置中的复选框来增强蓝牙音频质量。  Linux用户还可以通过安装<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PaliRohár的补丁来</a>获得更高的SBC比特率，其中包括添加对<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">aptX</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">aptX</a> HD和FastStream编解码器的支持。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN456476/">https://habr.com/ru/post/zh-CN456476/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN456462/index.html">将角度组件库组装为Web组件</a></li>
<li><a href="../zh-CN456466/index.html">如今的PHP泛型（差不多）</a></li>
<li><a href="../zh-CN456470/index.html">WSUS Package Publisher的陷阱</a></li>
<li><a href="../zh-CN456472/index.html">介绍Go和Mggo框架</a></li>
<li><a href="../zh-CN456474/index.html">井字游戏第0部分：比较苗条和反应</a></li>
<li><a href="../zh-CN456486/index.html">界面与选择（2014）</a></li>
<li><a href="../zh-CN456490/index.html">关于大脑的讲座，第1部分。人脑的进化。 大脑在发育的每个阶段都起作用</a></li>
<li><a href="../zh-CN456492/index.html">巨魔军队</a></li>
<li><a href="../zh-CN456494/index.html">在美国，GOST也是如此。 YubiKey FIPS致命漏洞可以避免</a></li>
<li><a href="../zh-CN456500/index.html">如何教克服困难，同时写周期</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>