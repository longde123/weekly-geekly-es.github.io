<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üß¢ üîÆ üòâ Gera√ß√£o de c√≥digo no Uber ü§òüèø ü§¢ üåï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cada um de n√≥s faz uma tarefa. Todo mundo escreve o c√≥digo padr√£o. Porque N√£o √© melhor automatizar esse processo e trabalhar apenas em tarefas interes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gera√ß√£o de c√≥digo no Uber</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/e-Legion/blog/413603/">  Cada um de n√≥s faz uma tarefa.  Todo mundo escreve o c√≥digo padr√£o.  Porque  N√£o √© melhor automatizar esse processo e trabalhar apenas em tarefas interessantes?  Leia este artigo se desejar que o computador fa√ßa esse trabalho para voc√™. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/144/cb5/052/144cb5052ca1830f2aac609dc3cc93c0.jpg" alt="imagem"></a> <br><br>  <i>Este artigo √© baseado na transcri√ß√£o de um relat√≥rio de Zack Sweers, desenvolvedor de aplicativos m√≥veis do Uber, que falou na confer√™ncia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MBLT DEV</a> em 2017.</i> <i><br></i> <br><a name="habracut"></a>  O Uber tem cerca de 300 desenvolvedores de aplicativos m√≥veis.  Eu trabalho em uma equipe chamada "plataforma m√≥vel".  O trabalho da minha equipe √© simplificar e melhorar o processo de desenvolvimento de aplicativos m√≥veis, tanto quanto poss√≠vel.  Trabalhamos principalmente em estruturas internas, bibliotecas, arquiteturas etc.  Devido √† grande equipe, temos que fazer projetos em larga escala que nossos engenheiros precisar√£o no futuro.  Pode ser amanh√£, ou talvez no pr√≥ximo m√™s ou at√© um ano. <br><br><h3>  Gera√ß√£o de c√≥digo para automa√ß√£o </h3><br>  Gostaria de demonstrar o valor do processo de gera√ß√£o de c√≥digo, bem como considerar alguns exemplos pr√°ticos.  O processo em si √© algo como isto: <br><br><pre><code class="hljs python">FileSpec.builder(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"Presentation"</span></span>) .addComment(<span class="hljs-string"><span class="hljs-string">"Code generating your way to happiness."</span></span>) .addAnnotation(AnnotationSpec.builder(Author::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">) .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addMember</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-class"><span class="hljs-params"><span class="hljs-string">"name"</span></span></span></span><span class="hljs-class"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-class"><span class="hljs-params"><span class="hljs-string">"%S"</span></span></span></span><span class="hljs-class"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-class"><span class="hljs-params"><span class="hljs-string">"Zac Sweers"</span></span></span></span><span class="hljs-class"><span class="hljs-params">)</span></span></span><span class="hljs-class"> .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">useSiteTarget</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(FILE)</span></span></span><span class="hljs-class"> .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">) .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span></span></code> </pre> <br>  Este √© um exemplo do uso do Kotlin Poet.  O Kotlin Poet √© uma biblioteca com uma boa API que gera c√≥digo Kotlin.  Ent√£o, o que vemos aqui? <br><br><ol><li>  <b>FileSpec.builder</b> cria um arquivo chamado " <b>Apresenta√ß√£o</b> ". </li><li>  <b>.addComment ()</b> - adiciona um coment√°rio ao c√≥digo gerado. </li><li>  <b>.addAnnotation ()</b> - Adiciona uma anota√ß√£o do tipo <b>Autor</b> . </li><li>  <b>.addMember ()</b> - adiciona uma vari√°vel " <b>name</b> " com um par√¢metro, no nosso caso √© " <b>Zac Sweers</b> ".  <b>% S</b> - tipo de par√¢metro. </li><li>  <b>.useSiteTarget ()</b> - Instala o SiteTarget. </li><li>  <b>.build ()</b> - completa a descri√ß√£o do c√≥digo que ser√° gerado. </li></ol><br>  Ap√≥s a gera√ß√£o do c√≥digo, √© obtido o seguinte: <br><br><pre> <code class="hljs pgsql">Presentation.kt // Code generating your way <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> happiness. @file:Author(<span class="hljs-type"><span class="hljs-type">name</span></span> = "Zac Sweers")</code> </pre> <br>  O resultado da gera√ß√£o de c√≥digo √© um arquivo com o nome, coment√°rio, anota√ß√£o e nome do autor.  Surge imediatamente a pergunta: "Por que preciso gerar esse c√≥digo se posso faz√™-lo em algumas etapas simples?"  Sim, voc√™ est√° certo, mas e se eu precisar de milhares desses arquivos com diferentes op√ß√µes de configura√ß√£o?  O que acontece se come√ßarmos a alterar os valores nesse c√≥digo?  E se tivermos muitas apresenta√ß√µes?  E se tivermos muitas confer√™ncias? <br><br><pre> <code class="hljs pgsql">conferences .flatMap { it.presentations } .onEach { (presentationName, <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span>, author) -&gt; FileSpec.builder("", presentationName) .addComment(<span class="hljs-keyword"><span class="hljs-keyword">comment</span></span>) .addAnnotation(AnnotationSpec.builder(Author::<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>) .addMember("name", "%S", author) .useSiteTarget(FILE) .build()) .build() }</code> </pre><br>  Como resultado, chegaremos √† conclus√£o de que √© simplesmente imposs√≠vel manter esse n√∫mero de arquivos manualmente - √© necess√°rio automatizar.  Portanto, a primeira vantagem da gera√ß√£o de c√≥digo √© livrar-se do trabalho de rotina. <br><br><h3>  Gera√ß√£o de c√≥digo sem erros </h3><br>  A segunda vantagem importante da automa√ß√£o √© a opera√ß√£o sem erros.  Todas as pessoas cometem erros.  Isso acontece especialmente quando fazemos a mesma coisa.  Os computadores, pelo contr√°rio, fazem esse trabalho perfeitamente. <br><br>  Considere um exemplo simples.  Existe uma classe Person: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> firstName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lastName: String)</code> </pre><br>  Suponha que desejemos adicionar serializa√ß√£o a ele no JSON.  Faremos isso usando a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Moshi</b></a> , pois √© bastante simples e excelente para demonstra√ß√£o.  Crie um PersonJsonAdapter e herde do JsonAdapter com um par√¢metro do tipo Person: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> firstName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lastName: String) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonJsonAdapter</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">JsonAdapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Person</span></span></span><span class="hljs-class">&gt;</span></span>() { }</code> </pre><br>  Em seguida, implementamos o m√©todo fromJson.  Ele fornece um leitor para ler informa√ß√µes que finalmente ser√£o retornadas para Person.  Em seguida, preenchemos os campos com o nome e o sobrenome e obtemos o novo valor de Person: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> firstName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lastName: String) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonJsonAdapter</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">JsonAdapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Person</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromJson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">JsonReader</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Person? { <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstName: String <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastName: String <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Person(firstName, lastName) } }</code> </pre><br>  A seguir, examinamos os dados no formato JSON, verificamos e inserimos nos campos necess√°rios: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> firstName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lastName: String) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonJsonAdapter</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">JsonAdapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Person</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromJson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">JsonReader</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Person? { <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstName: String <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastName: String <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (reader.hasNext()) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (reader.nextName()) { <span class="hljs-string"><span class="hljs-string">"firstName"</span></span> -&gt; firstName = reader.nextString() <span class="hljs-string"><span class="hljs-string">"lastName"</span></span> -&gt; lastName = reader.nextString() } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Person(firstName, lastName) } }</code> </pre><br>  Isso vai funcionar?  Sim, mas h√° uma nuance: os objetos que lemos devem estar contidos no JSON.  Para filtrar dados em excesso que podem vir do servidor, adicione outra linha de c√≥digo: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> firstName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lastName: String) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonJsonAdapter</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">JsonAdapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Person</span></span></span><span class="hljs-class">&gt;</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromJson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">JsonReader</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Person? { <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstName: String <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastName: String <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (reader.hasNext()) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (reader.nextName()) { <span class="hljs-string"><span class="hljs-string">"firstName"</span></span> -&gt; firstName = reader.nextString() <span class="hljs-string"><span class="hljs-string">"lastName"</span></span> -&gt; lastName = reader.nextString() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; reader.skipValue() } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Person(firstName, lastName) } }</code> </pre><br>  Neste ponto, contornamos com √™xito a √°rea do c√≥digo de rotina.  Neste exemplo, apenas dois campos de valor.  No entanto, esse c√≥digo possui v√°rias se√ß√µes diferentes nas quais voc√™ pode travar repentinamente.  De repente, cometemos um erro no c√≥digo? <br><br>  Considere outro exemplo: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> firstName: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lastName: String) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">City</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> country: String) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vehicle</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> licensePlate: String) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Restaurant</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> address: Address) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Payment</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cardNumber: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: String) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TipAmount</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> value: <span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numStars: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Correctness</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> confidence: <span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>)</code> </pre><br>  Se voc√™ tiver pelo menos um problema a cada 10 modelos, isso significa que voc√™ definitivamente ter√° dificuldades nessa √°rea.  E este √© o caso em que a gera√ß√£o de c√≥digo pode realmente ajud√°-lo.  Se houver muitas classes, voc√™ n√£o poder√° trabalhar sem automa√ß√£o, porque todas as pessoas permitem erros de digita√ß√£o.  Com a ajuda da gera√ß√£o de c√≥digo, todas as tarefas ser√£o executadas automaticamente e sem erros. <br><br>  Existem outros benef√≠cios para a gera√ß√£o de c√≥digo.  Por exemplo, fornece informa√ß√µes sobre o c√≥digo ou informa se algo der errado.  A gera√ß√£o de c√≥digo ser√° √∫til durante a fase de teste.  Se voc√™ usar o c√≥digo gerado, poder√° ver como o c√≥digo de trabalho realmente ficar√°.  Voc√™ pode at√© executar a gera√ß√£o de c√≥digo durante os testes para simplificar seu trabalho. <br><br>  Conclus√£o: vale a pena considerar a gera√ß√£o de c√≥digo como uma poss√≠vel solu√ß√£o para se livrar dos erros. <br><br>  Agora vamos ver as ferramentas de software que ajudam na gera√ß√£o de c√≥digo. <br><br><h3>  As ferramentas </h3><br><ol><li>  As <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>bibliotecas JavaPoet</b></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>KotlinPoet</b></a> para Java e Kotlin, respectivamente.  Esses s√£o os padr√µes de gera√ß√£o de c√≥digo. </li><li>  Padroniza√ß√£o.  Um exemplo popular de modelagem para Java √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Apache Velocity</b></a> e para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>guid√£o do</b></a> iOS. </li><li>  <b>SPI</b> - Service Processor Interface.  Ele √© incorporado ao Java e permite criar e aplicar uma interface e, em seguida, declar√°-la em um JAR.  Quando o programa √© executado, voc√™ pode obter todas as implementa√ß√µes prontas da interface. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>O Compile Testing</b></a> √© uma biblioteca do Google que ajuda no teste de compila√ß√£o.  Em termos de gera√ß√£o de c√≥digo, isso significa: "Aqui est√° o que eu esperava, mas aqui est√° o que eu finalmente recebi".  A compila√ß√£o come√ßar√° na mem√≥ria e, em seguida, o sistema informar√° se esse processo foi conclu√≠do ou que erros ocorreram.  Se a compila√ß√£o tiver sido conclu√≠da, voc√™ ser√° solicitado a comparar o resultado com as suas expectativas.  A compara√ß√£o √© baseada no c√≥digo compilado; portanto, n√£o se preocupe com coisas como formata√ß√£o de c√≥digo ou qualquer outra coisa. </li></ol><br><h3>  Ferramentas de cria√ß√£o de c√≥digo </h3><br>  Existem duas ferramentas principais para criar c√≥digo: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Processamento de anota√ß√µes</b></a> - voc√™ pode escrever anota√ß√µes no c√≥digo e solicitar ao programa informa√ß√µes adicionais sobre elas.  O compilador fornecer√° informa√ß√µes mesmo antes de terminar de trabalhar com o c√≥digo-fonte. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Gradle</b></a> √© um sistema de montagem de aplicativos com muitos ganchos (intercepta√ß√£o de gancho de chamadas de fun√ß√£o) em seu ciclo de vida de montagem de c√≥digo.  √â amplamente utilizado no desenvolvimento do Android.  Tamb√©m permite aplicar a gera√ß√£o de c√≥digo ao c√≥digo-fonte, independente da fonte atual. </li></ol><br>  Agora considere alguns exemplos. <br><br><h3>  Faca de manteiga </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Butter Knife</b></a> √© uma biblioteca desenvolvida por Jake Wharton.  Ele √© uma figura bem conhecida na comunidade de desenvolvedores.  A biblioteca √© muito popular entre os desenvolvedores do Android porque ajuda a evitar a grande quantidade de trabalho rotineiro que quase todo mundo enfrenta. <br><br>  Normalmente, inicializamos a visualiza√ß√£o desta maneira: <br><br><pre> <code class="java hljs">TextView title; ImageView icon; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ title = findViewById(R.id.title); icon = findViewById(R.id.icon); }</code> </pre><br>  Com o Butterknife, ficar√° assim: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@BindView</span></span>(R.id.title) TextView title; <span class="hljs-meta"><span class="hljs-meta">@BindView</span></span>(R.id.icon) ImageView icon; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ ButterKnife.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre><br>  E podemos adicionar facilmente qualquer n√∫mero de visualiza√ß√µes, enquanto o m√©todo onCreate n√£o aumentar√° o c√≥digo padr√£o: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@BindView</span></span>(R.id.title) TextView title; <span class="hljs-meta"><span class="hljs-meta">@BindView</span></span>(R.id.text) TextView text; <span class="hljs-meta"><span class="hljs-meta">@BindView</span></span>(R.id.icon) ImageView icon; <span class="hljs-meta"><span class="hljs-meta">@BindView</span></span>(R.id.button) Button button; <span class="hljs-meta"><span class="hljs-meta">@BindView</span></span>(R.id.next) Button next; <span class="hljs-meta"><span class="hljs-meta">@BindView</span></span>(R.id.back) Button back; <span class="hljs-meta"><span class="hljs-meta">@BindView</span></span>(R.id.open) Button open; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ ButterKnife.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre><br>  Em vez de fazer manualmente essa liga√ß√£o a cada vez, basta adicionar anota√ß√µes do @BindView a esses campos, bem como identificadores (IDs) aos quais est√£o atribu√≠dos. <br><br>  O legal do Butter Knife √© que ele analisar√° o c√≥digo e gerar√° todas as se√ß√µes semelhantes a voc√™.  Tamb√©m possui excelente escalabilidade para novos dados.  Portanto, se novos dados aparecerem, n√£o h√° necessidade de aplicar o onCreate novamente ou rastrear algo manualmente.  Essa biblioteca tamb√©m √© √≥tima para excluir dados. <br><br>  Ent√£o, como √© esse sistema por dentro?  A visualiza√ß√£o √© pesquisada pelo reconhecimento de c√≥digo e esse processo √© executado no est√°gio de processamento da anota√ß√£o. <br><br>  N√≥s temos este campo: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@BindView</span></span>(R.id.title) TextView title;</code> </pre><br>  A julgar por esses dados, eles s√£o usados ‚Äã‚Äãem uma certa FooActivity: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// FooActivity @BindView(R.id.title) TextView title;</span></span></code> </pre><br>  Ela tem seu pr√≥prio significado (R.id.title), que atua como alvo.  Observe que, durante o processamento dos dados, esse objeto se torna um valor constante dentro do sistema: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// FooActivity @BindView(2131361859) TextView title;</span></span></code> </pre><br>  Isso √© normal.  √â a isso que o Butter Knife deve ter acesso de qualquer maneira.  H√° um componente TextView como um tipo.  O pr√≥prio campo √© chamado title.  Se, por exemplo, criamos uma classe de cont√™iner com esses dados, obtemos algo parecido com isto: <br><br><pre> <code class="java hljs">ViewBinding( target = <span class="hljs-string"><span class="hljs-string">"FooActivity"</span></span>, id = <span class="hljs-number"><span class="hljs-number">2131361859</span></span>, name = <span class="hljs-string"><span class="hljs-string">"title"</span></span>, type = <span class="hljs-string"><span class="hljs-string">"field"</span></span>, viewType = TextView.class )</code> </pre><br>  Portanto, todos esses dados podem ser facilmente obtidos durante o processamento.  Tamb√©m √© muito semelhante ao que o Butter Knife faz dentro do sistema. <br><br>  Como resultado, esta classe √© gerada aqui: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooActivity_ViewBinding</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unbinder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FooActivity target; <span class="hljs-meta"><span class="hljs-meta">@UiThread</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FooActivity_ViewBinding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FooActivity target, View source)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.target = target; target.title = Utils.findRequiredViewAsType(source, <span class="hljs-number"><span class="hljs-number">2131361859</span></span>, <span class="hljs-comment"><span class="hljs-comment">// R.id.title "field 'title'", TextView.class); } }</span></span></code> </pre><br>  Aqui vemos que todos esses dados s√£o reunidos.  Como resultado, temos a classe de destino ViewBinding da biblioteca java Underscore.  Por dentro, esse sistema √© organizado de tal maneira que toda vez que voc√™ cria uma inst√¢ncia da classe, ele executa imediatamente toda essa liga√ß√£o com as informa√ß√µes (c√≥digo) que voc√™ gerou.  E tudo isso √© gerado estaticamente anteriormente durante o processamento de anota√ß√µes, o que significa que √© tecnicamente correto. <br><br>  Vamos voltar ao nosso pipeline de software: <br><br><img src="https://habrastorage.org/webt/t3/d3/jv/t3d3jv5bxgx5q3occc3ldovxfjm.png"><br><br>  Durante o processamento da anota√ß√£o, o sistema l√™ essas anota√ß√µes e gera a classe ViewBinding.  E ent√£o, durante o m√©todo bind, realizamos uma pesquisa id√™ntica para a mesma classe de uma maneira simples: pegamos seu nome e anexamos o ViewBinding no final.  Por si s√≥, uma se√ß√£o com um ViewBinding durante o processamento √© substitu√≠da na √°rea especificada usando JavaPoet. <br><br><h3>  Rxbindings </h3><br>  RxBindings sozinho n√£o √© respons√°vel pela gera√ß√£o de c√≥digo.  Ele n√£o manipula anota√ß√µes e n√£o √© um plug-in Gradle.  Esta √© uma biblioteca comum.  Ele fornece f√°bricas est√°ticas com base no princ√≠pio de programa√ß√£o reativa para a API do Android.  Isso significa que, por exemplo, se voc√™ configurouOnClickListener, ser√° exibido um m√©todo click que retornar√° um fluxo de eventos (Observ√°veis).  Ele atua como uma ponte (padr√£o de design). <br><br>  Mas, na verdade, h√° gera√ß√£o de c√≥digo no RxBinding: <br><br><img src="https://habrastorage.org/webt/ju/ty/bv/jutybv1ayxqhcfrs9l4virsivb8.png"><br><br>  Nesse diret√≥rio chamado buildSrc, h√° uma tarefa Gradle chamada KotlinGenTask.  Isso significa que tudo isso √© realmente criado pela gera√ß√£o de c√≥digo.  O RxBinding possui implementa√ß√µes em Java.  Ela tamb√©m possui artefatos Kotlin que cont√™m fun√ß√µes de extens√£o para todos os tipos de destino.  E tudo isso est√° estritamente sujeito √†s regras.  Por exemplo, voc√™ pode gerar todas as fun√ß√µes de extens√£o Kotlin e n√£o precisa control√°-las individualmente. <br><br>  Como √© realmente isso? <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Observable&lt;Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clicks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewClickObservable(view); }</code> </pre><br>  Aqui est√° um m√©todo RxBinding completamente cl√°ssico.  Objetos observ√°veis ‚Äã‚Äãs√£o retornados aqui.  O m√©todo √© chamado de cliques.  O trabalho com eventos de clique ocorre "sob o cap√¥".  N√≥s omitimos os fragmentos de c√≥digo extras para manter a legibilidade do exemplo.  No Kotlin, fica assim: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> View.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clicks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Observable&lt;Object&gt; = RxView.clicks(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)</code> </pre><br>  Esta fun√ß√£o de extens√£o retorna objetos observ√°veis.  Na estrutura interna do programa, ele chama diretamente a interface Java usual para n√≥s.  No Kotlin, voc√™ deve alterar isso para Tipo de unidade: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> View.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clicks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Observable&lt;<span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>&gt; = RxView.clicks(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)</code> </pre><br>  Ou seja, em Java, fica assim: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Observable&lt;Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clicks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewClickObservable(view); }</code> </pre><br>  E tamb√©m √© o c√≥digo Kotlin: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> View.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clicks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Observable&lt;<span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>&gt; = RxView.clicks(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)</code> </pre><br>  Temos uma classe RxView que cont√©m esse m√©todo.  Podemos substituir as partes correspondentes dos dados no atributo target, no atributo name pelo nome do m√©todo e no tipo que estamos expandindo, bem como no tipo do valor de retorno.  Toda essa informa√ß√£o ser√° suficiente para come√ßar a escrever estes m√©todos: <br><br><pre> <code class="hljs pgsql">BindingMethod( target = "RxView", <span class="hljs-type"><span class="hljs-type">name</span></span> = "clicks", <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>, returnType = "Observable&lt;Unit&gt;" )</code> </pre><br>  Agora podemos substituir diretamente esses fragmentos no c√≥digo Kotlin gerado dentro do programa.  Aqui est√° o resultado: <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> View.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clicks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Observable&lt;<span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>&gt; = RxView.clicks(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)</code> </pre><br><h3>  Gera√ß√£o de servi√ßo </h3><br>  Estamos trabalhando no Service Gen da Uber.  Se voc√™ trabalha em uma empresa e lida com caracter√≠sticas gerais e uma interface de software comum para o back-end e o cliente, independentemente de estar desenvolvendo aplicativos Android, iOS ou Web, n√£o faz sentido criar modelos e servi√ßos manualmente para o trabalho em equipe. <br><br>  Usamos a biblioteca <a href=""><b>AutoValue</b></a> do Google para modelos de objetos.  Ele processa anota√ß√µes, analisa dados e gera um c√≥digo hash de duas linhas, o m√©todo equals () e outras implementa√ß√µes.  Ela tamb√©m √© respons√°vel pelo suporte a extens√µes. <br><br>  Temos um objeto do tipo Rider: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@AutoValue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uuid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firstName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> Address </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">address</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  Temos linhas com ID, nome, sobrenome e endere√ßo.  Para trabalhar com a rede, usamos as bibliotecas Retrofit e OkHttp e JSON como formato de dados.  Tamb√©m usamos RxJava para programa√ß√£o reativa.  √â assim que nosso servi√ßo de API gerado se parece: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UberService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GET(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/rider"</span></span></span><span class="hljs-meta">)</span></span> Rider getRider() }</code> </pre><br>  Podemos escrever tudo isso manualmente, se assim o desejarmos.  E por um longo per√≠odo de tempo, n√≥s fizemos.  Mas leva muito tempo.  No final, custa muito em termos de tempo e dinheiro. <br><br><h3>  O que e como o Uber faz hoje </h3><br>  A √∫ltima tarefa da minha equipe √© criar um editor de texto do zero.  Decidimos n√£o escrever mais manualmente o c√≥digo que posteriormente atinge a rede, por isso usamos o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Thrift</b></a> .  √â algo como uma linguagem de programa√ß√£o e um protocolo ao mesmo tempo.  O Uber usa o Thrift como idioma para especifica√ß√µes t√©cnicas. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">required</span></span> string uuid; <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">required</span></span> string firstName; <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">required</span></span> string lastName; <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> <span class="hljs-type"><span class="hljs-type">Address</span></span> address; }</code> </pre><br>  No Thrift, definimos contratos de API entre o back-end e o cliente e, em seguida, simplesmente geramos o c√≥digo apropriado.  Usamos a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>Thrifty</b></a> para analisar dados e o JavaPoet para gera√ß√£o de c√≥digo.  No final, geramos implementa√ß√µes usando o AutoValue: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@AutoValue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uuid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firstName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> Address </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">address</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  N√≥s fazemos todo o trabalho em JSON.  Existe uma extens√£o chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><b>AutoValue Moshi</b></a> , que pode ser adicionada √†s classes AutoValue usando o m√©todo est√°tico jsonAdapter: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@AutoValue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uuid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firstName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lastName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> Address </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">address</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> JsonAdapter&lt;Rider&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jsonAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Moshi moshi)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutoValue_Rider.JsonAdapter(moshi); } }</code> </pre> <br>  A Thrift tamb√©m ajuda no desenvolvimento de servi√ßos: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">service</span></span> UberService { <span class="hljs-attribute"><span class="hljs-attribute">Rider</span></span> getRider() }</code> </pre><br>  Tamb√©m precisamos adicionar alguns metadados aqui para nos informar qual resultado final queremos alcan√ßar: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">service</span></span> UberService { <span class="hljs-attribute"><span class="hljs-attribute">Rider</span></span> getRider() (path=<span class="hljs-string"><span class="hljs-string">"/rider"</span></span>) }</code> </pre><br>  Ap√≥s a gera√ß√£o do c√≥digo, receberemos nosso servi√ßo: <br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UberService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@GET</span></span>(<span class="hljs-string"><span class="hljs-string">"/rider"</span></span>) <span class="hljs-function"><span class="hljs-function">Single&lt;Rider&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  Mas este √© apenas um dos resultados poss√≠veis.  Um modelo.  Como sabemos por experi√™ncia, ningu√©m jamais usou apenas um modelo.  Temos muitos modelos que geram c√≥digo para nossos servi√ßos: <br><br><pre> <code class="hljs rust"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rider</span></span></span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">City</span></span></span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vehicle</span></span></span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Restaurant</span></span></span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Payment</span></span></span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TipAmount</span></span></span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">// And 6000 more</span></span></code> </pre><br>  No momento, temos cerca de 5-6 aplicativos.  E eles t√™m muitos servi√ßos.  E todo mundo passa pelo mesmo pipeline de software.  Escrever tudo isso √† m√£o seria uma loucura. <br><br>  Na serializa√ß√£o em JSON, o ‚Äúadaptador‚Äù n√£o precisa ser registrado no Moshi e, se voc√™ usa o JSON, n√£o precisa se registrar no JSON.  Tamb√©m √© duvidoso sugerir que os funcion√°rios realizem a desserializa√ß√£o reescrevendo o c√≥digo por meio de um gr√°fico de DI. <br><br>  Mas trabalhamos com Java, para que possamos usar o padr√£o Factory, que geramos atrav√©s da biblioteca <b>Fractory</b> .  Podemos gerar isso porque conhecemos esses tipos antes da compila√ß√£o.  Fractory gera um adaptador como este: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelsAdapterFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonAdapter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> JsonAdapter&lt;?&gt; create(Type type, Set&lt;? extends Annotation&gt; annotations, Moshi moshi) { Class&lt;?&gt; rawType = Types.getRawType(type); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rawType.isAssignableFrom(Rider.class)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Rider.adapter(moshi); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rawType.isAssignableFrom(City.class)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> City.adapter(moshi); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rawType.isAssignableFrom(Vehicle.class)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vehicle.adapter(moshi); } <span class="hljs-comment"><span class="hljs-comment">// Etc etc return null; } }</span></span></code> </pre><br>  O c√≥digo gerado n√£o parece muito bom.  Se machuca os olhos, pode ser reescrito manualmente. <br><br>  Aqui voc√™ pode ver os tipos mencionados anteriormente com os nomes dos servi√ßos.  O sistema determinar√° automaticamente quais adaptadores ser√£o selecionados e chamados.  Mas aqui estamos diante de outro problema.  Temos 6000 desses adaptadores.  Mesmo se voc√™ as dividir entre si no mesmo modelo, o modelo ‚ÄúCome‚Äù ou ‚ÄúConduz‚Äù se enquadra no modelo ‚ÄúCondutor‚Äù ou estar√° em sua aplica√ß√£o.  O c√≥digo ser√° estendido.  Ap√≥s um certo ponto, ele n√£o pode nem caber em um arquivo .dex.  Portanto, voc√™ precisa separar os adaptadores de alguma forma: <br><br><img src="https://habrastorage.org/webt/ds/ul/tg/dsultg8mrgkboye3dvwmfcepdou.png"><br><br>  Por fim, analisaremos o c√≥digo antecipadamente e criaremos um subprojeto de trabalho para ele, como em Gradle: <br><br><img src="https://habrastorage.org/webt/-4/pj/fz/-4pjfzwuq-cwmdl8lil_cia4-pi.png"><br><br>  Na estrutura interna, essas depend√™ncias se tornam depend√™ncias Gradle.  Os elementos que usam o aplicativo Rider agora dependem dele.  Com isso, eles formar√£o os modelos de que precisam.  Como resultado, nossa tarefa ser√° resolvida e tudo isso ser√° regulado pelo sistema de montagem de c√≥digo dentro do programa. <br><br>  Mas aqui estamos diante de outro problema: agora temos um n√∫mero n de modelos de f√°brica.  Todos eles s√£o compilados em v√°rios objetos: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> RiderModelFactory <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> GiftCardModelFactory <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> PricingModelFactory <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> DriverModelFactory <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> EATSModelFactory <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> PaymentsModelFactory</code> </pre><br>  No processo de processamento de anota√ß√µes, n√£o ser√° poss√≠vel ler apenas anota√ß√µes em depend√™ncias externas e gerar gera√ß√£o de c√≥digo adicional apenas nelas. <br><br>  Solu√ß√£o: temos algum suporte na biblioteca Fractory, o que nos ajuda de uma maneira complicada.  Est√° contido no processo de liga√ß√£o de dados.  Introduzimos metadados usando o par√¢metro classpath no arquivo Java para seu armazenamento adicional: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> RiderModelFactory // -&gt; <span class="hljs-type"><span class="hljs-type">json</span></span> // -&gt; ridermodelfactory-fractory.bin <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MyAppGlobalFactory // Delegates <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> discovered fractories</code> </pre><br>  Agora, toda vez que voc√™ precisar us√°-los no aplicativo, entramos no filtro do diret√≥rio classpath com esses arquivos e os extra√≠mos a partir da√≠ no formato JSON para descobrir quais depend√™ncias est√£o dispon√≠veis. <br><br><h3>  Como tudo se encaixa </h3><br><br><img src="https://habrastorage.org/webt/ih/nj/7i/ihnj7i5j631gcjbkgt-8u64h7l8.jpeg"><br><br>  Temos uma <b>economia</b> .  Os dados de l√° v√£o para a <b>Thrifty</b> e passam pela an√°lise.  Eles passam por um programa de gera√ß√£o de c√≥digo que chamamos de <b>Jenga</b> .  Produz arquivos no formato Java.  Tudo isso acontece mesmo antes da fase preliminar de processamento ou antes da compila√ß√£o.  E durante o processo de compila√ß√£o, as anota√ß√µes s√£o processadas.  √â <b>a</b> vez <b>do AutoValue</b> gerar uma implementa√ß√£o.  Tamb√©m chama o <b>AutoValue Moshi</b> para fornecer suporte a JSON.  <b>Fractory</b> tamb√©m <b>est√° envolvido</b> .  Tudo acontece durante o processo de compila√ß√£o.  O processo √© precedido por um componente para criar o pr√≥prio projeto, que gera principalmente subprojetos <b>Gradle</b> . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora que voc√™ v√™ a imagem completa, come√ßa a perceber as ferramentas mencionadas anteriormente. </font><font style="vertical-align: inherit;">Por exemplo, existe o Gradle, criando modelos, AutoValue, JavaPoet para gera√ß√£o de c√≥digo. </font><font style="vertical-align: inherit;">Todas as ferramentas s√£o √∫teis n√£o s√≥ por si pr√≥prias, mas tamb√©m em combina√ß√£o.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Contras da gera√ß√£o de c√≥digo </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â necess√°rio contar sobre armadilhas. </font><font style="vertical-align: inherit;">O menos √≥bvio √© inchar o c√≥digo e perder o controle dele. </font><font style="vertical-align: inherit;">Por exemplo, o Dagger ocupa aproximadamente 10% de todo o c√≥digo no aplicativo. </font><font style="vertical-align: inherit;">Os modelos ocupam uma parcela significativamente maior - cerca de 25%. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na Uber, tentamos resolver o problema jogando fora o c√≥digo desnecess√°rio. </font><font style="vertical-align: inherit;">Temos que realizar algumas an√°lises estat√≠sticas do c√≥digo e entender quais √°reas est√£o realmente envolvidas no trabalho. </font><font style="vertical-align: inherit;">Quando descobrimos, podemos fazer algumas transforma√ß√µes e ver o que acontece. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esperamos reduzir o n√∫mero de modelos gerados em cerca de 40%. </font><font style="vertical-align: inherit;">Isso ajudar√° a acelerar a instala√ß√£o e a opera√ß√£o de aplicativos, al√©m de economizar dinheiro.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como a gera√ß√£o de c√≥digo afeta os cronogramas de desenvolvimento do projeto </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A gera√ß√£o de c√≥digo, √© claro, acelera o desenvolvimento, mas o tempo depende das ferramentas que a equipe usa. </font><font style="vertical-align: inherit;">Por exemplo, se voc√™ estiver trabalhando em Gradle, provavelmente estar√° fazendo isso em um ritmo medido. </font><font style="vertical-align: inherit;">O fato √© que Gradle gera modelos uma vez por dia, e n√£o quando o desenvolvedor deseja.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Saiba mais sobre desenvolvimento no Uber e em outras empresas importantes. </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em 28 de setembro, a 5¬™ Confer√™ncia Internacional de Desenvolvedores M√≥veis </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MBLT DEV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> come√ßa em Moscou </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">800 participantes, palestrantes, question√°rios e quebra-cabe√ßas para quem estiver interessado no desenvolvimento do Android e iOS. </font><font style="vertical-align: inherit;">Os organizadores da confer√™ncia s√£o e-Legion e RAEC. </font><font style="vertical-align: inherit;">Voc√™ pode se tornar um participante ou parceiro do MBLT DEV 2018 </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">no site da confer√™ncia</font></a><font style="vertical-align: inherit;"> .</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=http://"><img src="https://habrastorage.org/webt/yr/u2/x0/yru2x0-bqpghfoa6zqfrkyluuhq.jpeg"></a> <br><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Denunciar v√≠deo </font></font></h3><br><iframe width="560" height="315" src="https://www.youtube.com/embed/GpMR_Zjnn_Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413603/">https://habr.com/ru/post/pt413603/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413591/index.html">Rob√≥tica Industrial - 57 anos! Lembre-se de onde vem a contagem</a></li>
<li><a href="../pt413593/index.html">Continuando a conquistar o fundo do mar. Microsoft e seu projeto de data center submarino Natick 2</a></li>
<li><a href="../pt413597/index.html">"√öltimo recurso" ou por que o Database First Design √© necess√°rio</a></li>
<li><a href="../pt413599/index.html">H√° S.L.O.N.a em partes. Introduzir ITAM e n√£o sufocar</a></li>
<li><a href="../pt413601/index.html">O data center da Microsoft aquece o mar ao redor</a></li>
<li><a href="../pt413605/index.html">Pergunte a Ethan: O que acontece quando uma estrela passa pelo sistema solar?</a></li>
<li><a href="../pt413607/index.html">Resumo da Fintech: as moedas digitais n√£o amea√ßam o sistema financeiro da Federa√ß√£o Russa; O PayPal descobriu quanto gastam os jogadores em jogos</a></li>
<li><a href="../pt413609/index.html">S√≠ndrome do impostor: o que √© e como se livrar dele</a></li>
<li><a href="../pt413611/index.html">Como o CCTV atacou o Positive Hack Days: CAMBreaker contest</a></li>
<li><a href="../pt413613/index.html">Esta nave espacial chegar√° mais perto do Sol do que qualquer coisa que veio antes dele e n√£o derreter√°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>