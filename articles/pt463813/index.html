<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëäüèª üêπ üëàüèø Multivan e roteamento no Mikrotik RouterOS üê≤ üéå üìÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Com corre√ß√µes e adi√ß√µes de 11/02/2020 
 1. Introdu√ß√£o 
 Al√©m da vaidade, a frequ√™ncia deprimente de perguntas sobre esse t√≥pico nos grupos relevantes ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Multivan e roteamento no Mikrotik RouterOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463813/">  Com corre√ß√µes e adi√ß√µes de 11/02/2020 <br><h4>  1. Introdu√ß√£o </h4><br>  Al√©m da vaidade, a frequ√™ncia deprimente de perguntas sobre esse t√≥pico nos grupos relevantes da comunidade de telegramas de l√≠ngua russa me levou a aceitar o artigo.  Este artigo √© destinado a administradores iniciantes do Mikrotik RouterOS (daqui em diante ROS).  Considera apenas uma multivan, com √™nfase no roteamento.  O b√¥nus inclui configura√ß√µes minimamente suficientes para garantir uma opera√ß√£o segura e conveniente.  Aqueles que buscam a divulga√ß√£o dessas filas, balanceamento de carga, vlan, pontes, an√°lises detalhadas em v√°rias etapas da condi√ß√£o do canal e similares - n√£o podem perder tempo e esfor√ßo lendo. <br><a name="habracut"></a><br><h4>  Dados de origem </h4><br>  Como assunto de teste, um roteador Mikrotik de cinco portas com o ROS vers√£o 6.45+ foi selecionado.  Ele encaminhar√° o tr√°fego entre duas redes locais (LAN1 e LAN2) e tr√™s provedores (ISP1, ISP2, ISP3).  O canal para o ISP1 possui um endere√ßo est√°tico "cinza", o ISP2 √© "branco" recebido via DHCP, o ISP3 √© "branco" com autentica√ß√£o PPPoE.  O diagrama de conex√£o √© mostrado na figura: <br><br><img src="https://habrastorage.org/webt/pd/di/mv/pddimv_vbwqmityow2oe2oxngam.jpeg"><br><br>  A tarefa √© configurar o roteador MTK com base no esquema para que: <br><br><ol><li>  Forne√ßa comuta√ß√£o autom√°tica para o provedor de backup.  O principal provedor √© o ISP2, a primeira reserva √© o ISP1, a segunda reserva √© o ISP3. </li><li>  Para organizar o acesso LAN1 √† Internet apenas atrav√©s do ISP1. </li><li>  Ofere√ßa a capacidade de rotear o tr√°fego das redes locais para a Internet atrav√©s do provedor selecionado com base na lista de endere√ßos. </li><li>  Fornecer a possibilidade de publicar servi√ßos de uma rede local na Internet (DSTNAT) </li><li>  Configure um filtro de firewall para fornecer a seguran√ßa m√≠nima suficiente da Internet. </li><li>  O roteador pode emitir seu pr√≥prio tr√°fego atrav√©s de qualquer um dos tr√™s provedores, dependendo do endere√ßo de origem selecionado. </li><li>  Forne√ßa roteamento de pacotes de resposta para o canal de onde eles vieram (incluindo LAN). </li></ol><br>  <i><b>Observa√ß√£o.</b></i>  <i>Vamos configurar o roteador "do zero" para garantir que n√£o haja surpresas ao iniciar as configura√ß√µes "prontas para uso", mudando de vers√£o para vers√£o.</i>  <i>O Winbox foi escolhido como a ferramenta de configura√ß√£o, onde as altera√ß√µes ser√£o exibidas visualmente.</i>  <i>As pr√≥prias configura√ß√µes ser√£o definidas por comandos no terminal Winbox.</i>  <i>A conex√£o f√≠sica para configura√ß√£o √© feita atrav√©s de uma conex√£o direta com a interface Ether5.</i> <br><br><h4>  Uma pequena discuss√£o sobre o que √© uma multivan, se √© um problema ou se as pessoas espertas e astutas tecem redes de conspira√ß√µes ao redor </h4><br>  Um administrador curioso e atencioso, montando esse ou aquele esquema por conta pr√≥pria, de repente percebe que est√° funcionando normalmente.  Sim, sim, sem essas tabelas de roteamento personalizadas e outras regras de rota, que est√£o cheias da maioria dos artigos sobre este t√≥pico.  Confira? <br><br>  Podemos configurar o endere√ßamento em interfaces e gateways padr√£o?  Sim: <br><br>  O endere√ßo e o gateway com a <b>dist√¢ncia = 2</b> e o <b>gateway de verifica√ß√£o = ping</b> foram registrados no ISP1 <b>.</b> <br>  No ISP2, a configura√ß√£o dhcp padr√£o para o cliente √©, portanto, a dist√¢ncia ser√° igual a um. <br>  No ISP3, nas configura√ß√µes pppoe do cliente com <b>add-default-route = yes,</b> defina <b>default-route-distance = 3</b> . <br><br>  N√£o se esque√ßa de registrar o NAT para a sa√≠da: <br><br>  <b>/ ip firewall nat add action = cadeia de disfarce = srcnat out-interface-list = WAN</b> <br><br>  Como resultado, os usu√°rios de LANs divertem os selos carregados atrav√©s do provedor principal do ISP2 e h√° uma reserva do canal usando o mecanismo de <b>gateway de verifica√ß√£o</b> <sup>.</sup> <br><br>  O ponto 1 da tarefa √© implementado.  Onde est√° a multivan com suas etiquetas?  N√£o ... <br><br>  Mais longe.  Voc√™ precisa liberar clientes espec√≠ficos da LAN atrav√©s do ISP1: <br><br>  <b>/ ip firewall mangle add action = cadeia de rotas = pr√©-roteamento dst-address-list =! BOGONS \</b> <b><br></b>  <b>passthrough = yes route-dst = 100.66.66.1 src-address-list = Via_ISP1</b> <b><br></b>  <b>/ ip firewall mangle add action = cadeia de rotas = pr√©-roteamento dst-address-list =! BOGONS \</b> <b><br></b>  <b>passagem = nenhuma rota-dst = 100.66.66.1 src-address = 192.168.88.0 / 24</b> <br><br>  Os itens 2 e 3 da tarefa s√£o implementados.  Etiquetas, carimbos, regras de rota, onde voc√™ est√° ?! <br><br>  Precisa dar acesso ao seu servidor OpenVPN favorito com o endere√ßo 172.17.17.17 para clientes da Internet?  Por favor: <br><br>  <b>/ ip cloud set ddns-enabled = yes</b> <br><br>  Damos o resultado da sa√≠da aos clientes como um banquete: ‚Äú <b>: put [ip cloud get dns-name]</b> ‚Äù <br><br>  Registramos o encaminhamento de porta da Internet: <br><br>  <b>/ ip firewall nat add action = cadeia dst-nat = dstnat dst-port = 1194 \</b> <b><br></b>  <b>in-interface-list = protocolo WAN = endere√ßos udp = 172.17.17.17</b> <br><br>  O ponto 4 est√° pronto. <br><br>  Configuramos um firewall e outra seguran√ßa para o ponto 5. Ao mesmo tempo, estamos felizes por tudo estar funcionando para os usu√°rios e chegar a um cont√™iner com uma bebida favorita ... <br>  Ah!  Os t√∫neis ainda est√£o esquecidos. <br><br>  O cliente l2tp configurado de acordo com o artigo pesquisado subiu para o amado VDS holand√™s?  Sim <br>  O servidor l2tp com IPsec aumentou e os clientes pelo nome DNS da nuvem IP (veja acima.) se apegam?  Sim <br>  Recostando-nos, tomando um gole da bebida, examinamos √† toa os itens 6 e 7 do problema.  N√≥s pensamos - precisamos disso?  Tudo est√° funcionando assim. Ent√£o, se n√£o for necess√°rio, √© tudo.  Multivan implementado. <br><br>  <b>O que √© uma multivan?</b>  <b>Esta √© a conex√£o de v√°rios canais da Internet a um roteador.</b> <br><br>  Voc√™ n√£o pode ler mais o artigo, porque o que pode haver al√©m de uma demonstra√ß√£o de aplicabilidade duvidosa? <br><br>  Com aqueles que permanecem interessados ‚Äã‚Äãnos pontos 6 e 7 da tarefa e tamb√©m sentem a coceira do perfeccionismo, mergulhamos mais fundo. <br><br>  A tarefa mais importante da implementa√ß√£o de multivans √© o roteamento correto do tr√°fego.  Nomeadamente: independentemente de qual (ou qual) <sup>Veja a Nota 3,</sup> o (s) canal (s) do provedor olha para a rota padr√£o em nosso roteador, ele deve retornar a resposta exatamente ao canal de onde o pacote veio.  A tarefa √© clara.  Onde est√° o problema?  De fato, em uma rede local simples, a tarefa √© a mesma, mas ningu√©m se incomoda com configura√ß√µes adicionais e n√£o sente problemas.  A diferen√ßa √© que qualquer n√≥ roteado na Internet √© acess√≠vel por cada um de nossos canais, e n√£o por um estritamente espec√≠fico, como em uma LAN simples.  Mas o "problema" √© que, se recebemos uma solicita√ß√£o para o endere√ßo IP do ISP3, no nosso caso, a resposta passar√° pelo canal ISP2, pois o gateway padr√£o √© direcionado para l√°.  Ele sair√° e ser√° descartado pelo provedor como incorreto.  Decidimos sobre o problema.  Como resolver isso? <br><br>  A solu√ß√£o √© dividida em tr√™s etapas: <br><br><ol><li>  <b>Pr√©-configura√ß√£o</b>  Nesse est√°gio, as configura√ß√µes b√°sicas do roteador ser√£o definidas: rede local, firewall, lista de endere√ßos, NAT hairpin, etc. </li><li>  <b>Multivan.</b>  Nesse est√°gio, as conex√µes necess√°rias ser√£o marcadas e classificadas de acordo com as tabelas de roteamento. </li><li>  <b>Conex√£o com o ISP.</b>  Nesta fase, as interfaces que fornecem conex√£o √† Internet ser√£o configuradas, o roteamento e o mecanismo de reserva de canais da Internet ser√£o envolvidos. </li></ol><br>  <i><b>Observa√ß√£o.</b></i>  <i>Tr√™s tipos diferentes de conex√£o com o ISP foram escolhidos especificamente para mostrar que n√£o h√° nada insol√∫vel na configura√ß√£o de multivans com endere√ßos din√¢micos e demonstrar uma das op√ß√µes da solu√ß√£o.</i> <br>  <u><b>Importante!</b></u>  Para mudar de canal de acordo com o algoritmo especificado usando o custo das rotas de <b>dist√¢ncia</b> , √© usado o mecanismo de <b>gateway de verifica√ß√£o.</b>  <sup>Ver nota 1</sup> <br>  Os scripts fornecidos no artigo n√£o t√™m nada a ver com reserva de canal. <br><br><h4>  1. Predefini√ß√£o </h4><br>  1.1  Limpamos a configura√ß√£o do roteador com o comando: <br><br><pre><code class="plaintext hljs">/system reset-configuration skip-backup=yes no-defaults=yes</code> </pre> <br>  concordo com ‚Äú <b>Perigoso!</b>  <b>Redefinir mesmo assim?</b>  <b>[y / N]:</b> ‚Äùe, ap√≥s a reinicializa√ß√£o, nos conectamos ao Winbox via MAC.  Nesta fase, a configura√ß√£o e a base de usu√°rios s√£o limpas. <br><br>  1.2  Crie um novo usu√°rio: <br><br><pre> <code class="plaintext hljs">/user add group=full name=knight password=ultrasecret comment="Not horse"</code> </pre> <br>  fa√ßa login e exclua o padr√£o: <br><br><pre> <code class="plaintext hljs">/user remove admin</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>√â a remo√ß√£o e n√£o a desconex√£o do usu√°rio padr√£o que o autor considera mais seguro e recomenda o uso.</i> <br><br>  1.3  Criamos listas b√°sicas de interface para a conveni√™ncia de operar em um firewall, configura√ß√µes de descoberta e outros servidores MAC: <br><br><pre> <code class="plaintext hljs">/interface list add name=WAN comment="For Internet" /interface list add name=LAN comment="For Local Area"</code> </pre> <br>  Assinamos interfaces com coment√°rios <br><br><pre> <code class="plaintext hljs">/interface ethernet set ether1 comment="to ISP1" /interface ethernet set ether2 comment="to ISP2" /interface ethernet set ether3 comment="to ISP3" /interface ethernet set ether4 comment="to LAN1" /interface ethernet set ether5 comment="to LAN2"</code> </pre> <br>  e preencha as listas de interface: <br><br><pre> <code class="plaintext hljs">/interface list member add interface=ether1 list=WAN comment=ISP1 /interface list member add interface=ether2 list=WAN comment=ISP2 /interface list member add interface=ether3 list=WAN comment="to ISP3" /interface list member add interface=ether4 list=LAN comment="LAN1" /interface list member add interface=ether5 list=LAN comment="LAN2"</code> </pre><br>  <i><b>Observa√ß√£o.</b></i>  <i>Escrever coment√°rios claros vale o tempo gasto com isso e facilita muito a solu√ß√£o de problemas e a compreens√£o da configura√ß√£o.</i> <i><br><br></i>  <i>O autor considera necess√°rio, por raz√µes de seguran√ßa, adicionar a interface ether3 √† lista de interfaces "WAN", apesar do protocolo IP n√£o passar por ela.</i> <i><br><br></i>  <i>N√£o esque√ßa que ap√≥s a interface PPP ter sido criada no ether3, ela tamb√©m precisar√° ser adicionada √† lista de interfaces "WAN"</i> <br><br>  1.4  Escondemos o roteador da detec√ß√£o e controle de proximidade das redes dos provedores pelo MAC: <br><br><pre> <code class="plaintext hljs">/ip neighbor discovery-settings set discover-interface-list=!WAN /tool mac-server set allowed-interface-list=LAN /tool mac-server mac-winbox set allowed-interface-list=LAN</code> </pre> <br>  1.5  Criamos um conjunto m√≠nimo suficiente de regras de filtro de firewall para proteger o roteador: <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=accept chain=input \ comment="Related Established Untracked Allow" \ connection-state=established,related,untracked</code> </pre> <br>  (a regra fornece permiss√£o para conex√µes estabelecidas e relacionadas que s√£o iniciadas a partir de redes conectadas e pelo pr√≥prio roteador) <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=accept chain=input \ comment="ICMP from ALL" protocol=icmp</code> </pre> <br>  (ping e n√£o apenas ping. √â permitido entrar todo o icmp. √â muito √∫til para encontrar problemas com o MTU) <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=drop chain=input comment="All other WAN Drop" \ in-interface-list=WAN</code> </pre> <br>  (a regra que fecha a cadeia de entrada pro√≠be tudo o que chega da Internet) <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=accept chain=forward \ comment="Established, Related, Untracked allow" \ connection-state=established,related,untracked</code> </pre> <br>  (a regra permite conex√µes estabelecidas e relacionadas que passam pelo roteador) <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=drop chain=forward comment="Invalid drop" \ connection-state=invalid</code> </pre> <br>  (a regra descarta conex√µes, com connection-state = invalid, passando pelo roteador. √â altamente recomendado pelo Mikrotik, mas em algumas situa√ß√µes raras pode bloquear o tr√°fego √∫til) <br><br><pre> <code class="plaintext hljs">/ip firewall filter add action=drop chain=forward \ comment="Drop all from WAN not DSTNATed" connection-nat-state=!dstnat \ connection-state=new in-interface-list=WAN</code> </pre> <br>  (a regra pro√≠be pacotes que saem da Internet e n√£o passaram pelo procedimento dstnat pelo roteador. Isso proteger√° as redes locais contra invasores que, estando no mesmo dom√≠nio de broadcast com nossas redes externas, registrem nossos IPs externos como gateway e, assim, tentam "Explore" nossas redes de √°rea local.) <br><br>  <i><b>Observa√ß√£o.</b></i>  <i>Vamos supor que LAN1 e LAN2 sejam redes confi√°veis ‚Äã‚Äãe o tr√°fego entre elas e a partir delas n√£o seja filtrado.</i> <br><br>  1.6  Crie uma lista com uma lista de redes n√£o rote√°veis: <br><br><pre> <code class="plaintext hljs">/ip firewall address-list add address=0.0.0.0/8 comment="\"This\" Network" list=BOGONS add address=10.0.0.0/8 comment="Private-Use Networks" list=BOGONS add address=100.64.0.0/10 comment="Shared Address Space. RFC 6598" list=BOGONS add address=127.0.0.0/8 comment=Loopback list=BOGONS add address=169.254.0.0/16 comment="Link Local" list=BOGONS add address=172.16.0.0/12 comment="Private-Use Networks" list=BOGONS add address=192.0.0.0/24 comment="IETF Protocol Assignments" list=BOGONS add address=192.0.2.0/24 comment=TEST-NET-1 list=BOGONS add address=192.168.0.0/16 comment="Private-Use Networks" list=BOGONS add address=198.18.0.0/15 comment="Network Interconnect Device Benchmark Testing"\ list=BOGONS add address=198.51.100.0/24 comment=TEST-NET-2 list=BOGONS add address=203.0.113.0/24 comment=TEST-NET-3 list=BOGONS add address=224.0.0.0/4 comment=Multicast list=BOGONS add address=192.88.99.0/24 comment="6to4 Relay Anycast" list=BOGONS add address=240.0.0.0/4 comment="Reserved for Future Use" list=BOGONS add address=255.255.255.255 comment="Limited Broadcast" list=BOGONS</code> </pre> <br>  (Esta √© uma lista de endere√ßos e redes que n√£o s√£o roteados para a Internet e, consequentemente, tamb√©m a seguiremos.) <br><br>  <i><b>Observa√ß√£o.</b></i>  <i>A lista pode mudar, por isso aconselho que voc√™ verifique periodicamente a relev√¢ncia.</i> <br><br>  1.7  Configure o DNS para o pr√≥prio roteador: <br><br><pre> <code class="plaintext hljs">/ip dns set servers=1.1.1.1,8.8.8.8</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>Na vers√£o atual do ROS, os servidores din√¢micos t√™m preced√™ncia sobre os definidos estaticamente.</i>  <i>Uma solicita√ß√£o de resolu√ß√£o de nome √© enviada ao primeiro servidor na ordem da lista.</i>  <i>A transi√ß√£o para o pr√≥ximo servidor ocorre quando o atual n√£o est√° dispon√≠vel.</i>  <i>Grande tempo limite - mais de 5 segundos.</i>  <i>Retornar quando o ‚Äúservidor ca√≠do‚Äù √© retomado n√£o acontece automaticamente.</i>  <i>Dado esse algoritmo e a presen√ßa de uma multivan, o autor recomenda n√£o usar servidores emitidos por provedores.</i> <br><br>  1.8  Configure a rede local. <br>  1.8.1  Configure endere√ßos IP est√°ticos nas interfaces da LAN: <br><br><pre> <code class="plaintext hljs">/ip address add interface=ether4 address=192.168.88.254/24 comment="LAN1 IP" /ip address add interface=ether5 address=172.16.1.0/23 comment="LAN2 IP"</code> </pre> <br>  1.8.2  Definimos as regras para rotas para nossas redes locais atrav√©s da tabela de roteamento principal: <br><br><pre> <code class="plaintext hljs">/ip route rule add dst-address=192.168.88.0/24 table=main comment="to LAN1" /ip route rule add dst-address=172.16.0.0/23 table=main comment="to LAN2"</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>Essa √© uma das maneiras mais f√°ceis e r√°pidas de acessar endere√ßos de rede local com endere√ßos IP externos de interfaces de roteador pelas quais a rota padr√£o n√£o passa.</i> <br><br>  1.8.3  Se necess√°rio, ative o Hairpin NAT para LAN1 e LAN2: <br><br><pre> <code class="plaintext hljs">/ip firewall nat add action=src-nat chain=srcnat comment="Hairpin to LAN1" \ out-interface=ether4 src-address=192.168.88.0/24 to-addresses=192.168.88.254 /ip firewall nat add action=src-nat chain=srcnat comment="Hairpin to LAN2" \ out-interface=ether5 src-address=172.16.0.0/23 to-addresses=172.16.1.0</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>Isso permite que os usu√°rios da LAN1 e LAN2 acessem atrav√©s de um IP externo (dstnat) a servidores localizados com usu√°rios no mesmo segmento de rede.</i> <br><br><h4>  2. Na verdade, a implementa√ß√£o das multivans corretas </h4><br>  Para resolver o problema de ‚Äúresponder de onde eles pediram‚Äù, usaremos duas ferramentas ROS: <b>marca de conex√£o</b> e <b>marca de roteamento</b> .  <b>A marca de conex√£o</b> permite marcar a conex√£o desejada e continuar a trabalhar com esta etiqueta como condi√ß√£o para a aplica√ß√£o da <b>marca de roteamento</b> .  E j√° com a <b>marca de roteamento</b> √© poss√≠vel trabalhar nas <b>regras de rota</b> e <b>rota IP</b> .  N√≥s descobrimos as ferramentas, agora precisamos decidir quais conex√µes marcar - uma, onde exatamente marcar - duas. <br><br>  Com o primeiro, tudo √© simples - precisamos marcar todas as conex√µes que chegam ao roteador da Internet atrav√©s do canal apropriado.  No nosso caso, ser√£o tr√™s r√≥tulos (de acordo com o n√∫mero de canais): ‚Äúconn_isp1‚Äù, ‚Äúconn_isp2‚Äù e ‚Äúconn_isp3‚Äù. <br><br>  A nuance da segunda √© que as conex√µes de entrada ser√£o de dois tipos: tr√¢nsito e aquelas destinadas ao pr√≥prio roteador.  O mecanismo da marca de conex√£o funciona na tabela <b>mangle</b> .  Considere o movimento do pacote em um diagrama simplificado, gentilmente coletado pelos especialistas do recurso mikrotik-trainings.com (sem publicidade): <br><br><img src="https://habrastorage.org/webt/gg/yc/u4/ggycu4_z4ps93z-crahvri9pshw.jpeg"><br><br>  Seguindo as setas, vemos que o pacote que chega √† ‚Äú <b>interface de entrada</b> ‚Äù passa pela cadeia ‚Äú <b>Pr√©-roteamento</b> ‚Äù e s√≥ ent√£o √© dividido em tr√¢nsito e local no bloco ‚Äú <b>Decis√£o de Roteamento</b> ‚Äù.  Portanto, para matar dois coelhos com uma cajadada, use a <b>marca de conex√£o</b> na tabela de <b>pr√©-roteamento Mangle</b> da cadeia de <b>pr√©</b> - <b>roteamento</b> . <br><br>  <i><b>Observa√ß√£o</b> .</i>  <i>No ROS, as marcas ‚ÄúRouting mark‚Äù s√£o indicadas na se√ß√£o Ip / Routes / Rules como ‚ÄúTable‚Äù e nas demais se√ß√µes como ‚ÄúRouting Mark‚Äù.</i>  <i>Isso pode causar alguma confus√£o no entendimento, mas, de fato, √© o mesmo e √© o an√°logo de rt_tables no iproute2 no linux.</i> <br><br>  2.1  Marcamos as conex√µes de entrada de cada um dos provedores: <br><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-connection chain=prerouting \ comment="Connmark in from ISP1" connection-mark=no-mark in-interface=ether1 \ new-connection-mark=conn_isp1 passthrough=no /ip firewall mangle add action=mark-connection chain=prerouting \ comment="Connmark in from ISP2" connection-mark=no-mark in-interface=ether2 \ new-connection-mark=conn_isp2 passthrough=no /ip firewall mangle add action=mark-connection chain=prerouting \ comment="Connmark in from ISP3" connection-mark=no-mark in-interface=pppoe-isp3 \ new-connection-mark=conn_isp3 passthrough=no</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i> <i><br></i>  <i>Os leitores que tentarem literalmente e na ordem de leitura repetir a configura√ß√£o sugerida no artigo, ao inserir o terceiro comando, encontrar√£o o erro: "a entrada n√£o corresponde a nenhum valor da interface".</i>  <i>Isso ocorre devido √† aus√™ncia da interface "pppoe-isp3", que ser√° configurada na Se√ß√£o 3.3.2.</i>  <i>Neste ponto, voc√™ pode inserir "ether3" em vez de "pppoe-isp3".</i>  <i>Depois de concluir o par√°grafo 3.3.2, voc√™ deve voltar e colocar o nome atual da interface.</i> <i><br><br></i>  <i>Para n√£o marcar conex√µes j√° marcadas, eu uso a condi√ß√£o connection-mark = no-mark em vez de connection-state = new.</i> <i><br><br></i>  <i>passthrough = no - porque neste m√©todo de implementa√ß√£o, a marca√ß√£o √© exclu√≠da e, para acelerar, voc√™ pode interromper a enumera√ß√£o de regras ap√≥s a primeira correspond√™ncia.</i> <br><br>  Deve-se ter em mente que ainda n√£o interferimos no roteamento.  Agora, existem apenas est√°gios de prepara√ß√£o.  O pr√≥ximo est√°gio da implementa√ß√£o ser√° o processamento do tr√°fego de tr√¢nsito, retornado por meio de uma conex√£o est√°vel do destinat√°rio na rede local.  I.e.  os pacotes que (veja o diagrama) passaram pelo roteador ao longo do caminho: <br><br>  <b>"Interface de entrada" =&gt; "Pr√©-roteamento" =&gt; "Decis√£o de roteamento" =&gt; "Encaminhar" =&gt; "P√≥s-roteamento" =&gt; "Interface de sa√≠da"</b> e chegaram ao seu destino na rede local. <br><br>  <u><b>Importante!</b></u>  No ROS, n√£o h√° divis√£o l√≥gica em interfaces externas e internas.  Se rastrearmos o caminho do pacote de resposta no diagrama abaixo, ele seguir√° o mesmo caminho l√≥gico da solicita√ß√£o: <br><br>  <b>‚ÄúInterface de entrada‚Äù =&gt; ‚ÄùPr√©-roteamento‚Äù =&gt; ‚ÄùDecis√£o de roteamento‚Äù =&gt; ‚ÄùEncaminhar‚Äù =&gt; ‚ÄùP√≥s-roteamento‚Äù =&gt; ‚ÄùInterface de sa√≠da‚Äù</b> apenas para a solicita√ß√£o ‚Äú <b>Interface de entrada</b> ‚Äù havia uma interface ISP e para a resposta - LAN <br><br>  2.2  Direcionamos o tr√°fego de tr√¢nsito de retorno para as tabelas de roteamento correspondentes: <br><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-routing chain=prerouting \ comment="Routemark transit out via ISP1" connection-mark=conn_isp1 \ dst-address-type=!local in-interface-list=!WAN new-routing-mark=to_isp1 passthrough=no /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Routemark transit out via ISP2" connection-mark=conn_isp2 \ dst-address-type=!local in-interface-list=!WAN new-routing-mark=to_isp2 passthrough=no /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Routemark transit out via ISP3" connection-mark=conn_isp3 \ dst-address-type=!local in-interface-list=!WAN new-routing-mark=to_isp3 passthrough=no</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i><b>in-interface-list =! WAN - trabalhamos apenas com tr√°fego da rede local e dst-address-type =! local sem o endere√ßo de destino dos endere√ßos de interface do pr√≥prio roteador.</b></i> <i><b><br></b></i> <br><br>  O mesmo para pacotes locais que chegaram ao roteador ao longo do caminho: <br><br>  <b>"Interface de entrada" =&gt; "Pr√©-roteamento" =&gt; "Decis√£o de roteamento" =&gt; "Entrada" =&gt; "Processo local"</b> <br><br>  <u><b>Importante!</b></u>  A resposta seguir√° o seguinte caminho: <br><br>  <b>"Processo local" =&gt; "Decis√£o de roteamento" =&gt; "Sa√≠da" =&gt; "P√≥s-roteamento" =&gt; "Interface de sa√≠da"</b> <b><br></b> <br>  2.3  Dirigimos o tr√°fego local de resposta para as tabelas de roteamento correspondentes: <br><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-routing chain=output \ comment="Routemark local out via ISP1" connection-mark=conn_isp1 \ dst-address-type=!local new-routing-mark=to_isp1 passthrough=no /ip firewall mangle add action=mark-routing chain=output \ comment="Routemark local out via ISP2" connection-mark=conn_isp2 \ dst-address-type=!local new-routing-mark=to_isp2 passthrough=no /ip firewall mangle add action=mark-routing chain=output \ comment="Routemark local out via ISP3" connection-mark=conn_isp3 \ dst-address-type=!local new-routing-mark=to_isp3 passthrough=no</code> </pre> <br>  Nesse est√°gio, a tarefa de preparar o envio de uma resposta ao canal da Internet a partir do qual a solicita√ß√£o veio pode ser considerada resolvida.  Tudo est√° marcado, marcado e pronto para rotear. <br>  Um excelente efeito "colateral" dessa configura√ß√£o √© a capacidade de encaminhar portas DSNAT de ambos os provedores (ISP2, ISP3) ao mesmo tempo.  De maneira alguma, porque no ISP1 n√£o temos um endere√ßo rote√°vel.  Esse efeito √© importante, por exemplo, para um servidor de correio com dois MXs que analisam diferentes canais da Internet. <br><br>  Para eliminar as nuances das redes locais de trabalho com roteadores IP externos, usamos as solu√ß√µes dos par√°grafos.  1.8.2 e 3.1.2.6. <br><br>  Al√©m disso, voc√™ pode usar a ferramenta com marca√ß√µes e resolver o par√°grafo 3 do problema.  N√≥s o implementamos assim: <br><br>  2.4  Direcionamos o tr√°fego de clientes locais das listas de roteamento para as tabelas correspondentes: <br><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=mark-routing chain=prerouting \ comment="Address List via ISP1" dst-address-list=!BOGONS new-routing-mark=to_isp1 \ passthrough=no src-address-list=Via_ISP1 /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Address List via ISP2" dst-address-list=!BOGONS new-routing-mark=to_isp2 \ passthrough=no src-address-list=Via_ISP2 /ip firewall mangle add action=mark-routing chain=prerouting \ comment="Address List via ISP3" dst-address-list=!BOGONS new-routing-mark=to_isp3 \ passthrough=no src-address-list=Via_ISP3</code> </pre> <br>  Como resultado, √© algo parecido com isto (a imagem √© clic√°vel): <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/jw/bt/of/jwbtofiohmdeunznqgpnamyuhrm.jpeg"></a> <br><br><h4>  3. Configure a conectividade do ISP e ative o roteamento baseado em marca </h4><br>  3.1  Configure a conex√£o com o ISP1: <br>  3.1.1  Configure um endere√ßo IP est√°tico: <br><br><pre> <code class="plaintext hljs">/ip address add interface=ether1 address=100.66.66.2/30 comment="ISP1 IP"</code> </pre> <br>  3.1.2  Configure o roteamento est√°tico: <br>  3.1.2.1  Adicione uma rota de emerg√™ncia padr√£o: <br><br><pre> <code class="plaintext hljs">/ip route add comment="Emergency route" distance=254 type=blackhole</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>Essa rota permite que o tr√°fego de processos locais passe pelo est√°gio Decis√£o de Rota, independentemente do estado dos canais de qualquer um dos provedores.</i>  <i>A nuance do tr√°fego local de sa√≠da √© que, para que o pacote se mova pelo menos em algum lugar, o roteamento ativo para o gateway padr√£o deve estar presente na tabela de roteamento principal.</i>  <i>Caso contr√°rio, o pacote ser√° simplesmente destru√≠do.</i> <br><br>  Como uma extens√£o da ferramenta de <b>gateway de verifica√ß√£o</b> para uma an√°lise mais profunda do status do canal, proponho o uso do m√©todo de rota recursiva.  A ess√™ncia do m√©todo √© que dizemos ao roteador para procurar o caminho para o gateway n√£o diretamente, mas atrav√©s de um gateway intermedi√°rio.  Como tais gateways de "teste", 4.2.2.1, 4.2.2.2 e 4.2.2.3 ser√£o selecionados para ISP1, ISP2 e ISP3, respectivamente. <br><br>  3.1.2.2  Rota para o endere√ßo de "verifica√ß√£o": <br><br><pre> <code class="plaintext hljs">/ip route add check-gateway=ping comment="For recursion via ISP1" \ distance=1 dst-address=4.2.2.1 gateway=100.66.66.1 scope=10</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>O valor do escopo √© reduzido para o padr√£o no escopo de destino do ROS, a fim de usar 4.2.2.1 adicional como um gateway recursivo.</i>  <i>Enfatizo: o escopo da rota para o endere√ßo de "verifica√ß√£o" deve ser menor ou igual ao escopo de destino da rota que far√° refer√™ncia √† verifica√ß√£o.</i> <br><br>  3.1.2.3  A rota recursiva padr√£o para tr√°fego sem uma marca de roteamento: <br><br><pre> <code class="plaintext hljs">/ip route add check-gateway=ping comment="Unmarked via ISP1" \ distance=2 gateway=4.2.2.1</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>O valor da dist√¢ncia = 2 √© usado porque o ISP1 √© declarado como o primeiro em espera nos termos da tarefa.</i> <br><br>  3.1.2.4  A rota recursiva padr√£o para o tr√°fego com a marca de roteamento "to_isp1": <br><br><pre> <code class="plaintext hljs">/ip route add comment="Marked via ISP1 Main" distance=1 gateway=4.2.2.1 \ routing-mark=to_isp1</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>Na verdade, aqui estamos finalmente come√ßando a usar os frutos do trabalho preparat√≥rio realizado no par√°grafo 2.</i> <i><br><br></i>  <i>Nesta rota, todo o tr√°fego que marcar a rota "to_isp1" ser√° direcionado para o gateway do primeiro provedor, independentemente de qual gateway padr√£o da tabela principal esteja ativo no momento.</i> <br><br>  3.1.2.5  A primeira rota recursiva padr√£o de fallback para o tr√°fego rotulado dos provedores ISP2 e ISP3: <br><br><pre> <code class="plaintext hljs">/ip route add comment="Marked via ISP2 Backup1" distance=2 gateway=4.2.2.1 \ routing-mark=to_isp2 /ip route add comment="Marked via ISP3 Backup1" distance=2 gateway=4.2.2.1 \ routing-mark=to_isp3</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>Essas rotas tamb√©m s√£o necess√°rias para reservar tr√°fego de redes locais, que s√£o membros da lista de endere√ßos ‚Äúto_isp *‚Äù '</i> <br><br>  3.1.2.6  Escrevemos a rota para o tr√°fego do roteador local para a Internet atrav√©s do ISP1: <br><br><pre> <code class="plaintext hljs">/ip route rule add comment="From ISP1 IP to Inet" src-address=100.66.66.2 table=to_isp1</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>Em combina√ß√£o com as regras da cl√°usula 1.8.2, √© fornecida uma sa√≠da para o canal desejado com uma determinada fonte.</i>  <i>Isso √© cr√≠tico para a constru√ß√£o de t√∫neis nos quais o endere√ßo IP do lado local (EoIP, IP-IP, GRE) √© especificado.</i>  <i>Como as regras nas regras de rota IP s√£o executadas de cima para baixo, at√© que as condi√ß√µes correspondam pela primeira vez, essa regra deve seguir as regras da cl√°usula 1.8.2.</i> <br><br>  3.1.3  Escrevemos a regra NAT para o tr√°fego de sa√≠da: <br><br><pre> <code class="plaintext hljs">/ip firewall nat add action=src-nat chain=srcnat comment="NAT via ISP1" \ ipsec-policy=out,none out-interface=ether1 to-addresses=100.66.66.2</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>O NAT √© tudo que existe, exceto pelo fato de cair nas pol√≠ticas IPsec.</i>  <i>Tento n√£o usar action = masquerade, a menos que seja absolutamente necess√°rio.</i>  <i>√â mais lento e consome mais recursos do que o src-nat porque calcula um endere√ßo para o NAT para cada nova conex√£o.</i> <br><br>  3.1.4  Enviamos clientes da lista que est√£o proibidos de sair atrav√©s de outros provedores diretamente para o gateway do provedor ISP1. <br><br><pre> <code class="plaintext hljs">/ip firewall mangle add action=route chain=prerouting \ comment="Address List via ISP1 only" dst-address-list=!BOGONS passthrough=no \ route-dst=100.66.66.1 src-address-list=Via_only_ISP1 place-before=0</code> </pre> <br>  <i><b>Observa√ß√£o.</b></i>  <i>action = route tem uma prioridade mais alta e √© aplicada antes de outras regras de roteamento.</i> <i><br><br></i>  <i>place-before = 0 - coloca nossa regra em primeiro lugar na lista.</i> <br><br>  3.2  N√≥s configuramos a conex√£o com o ISP2. <br><br>  Como o provedor ISP2 nos fornece as configura√ß√µes via DHCP, √© razo√°vel fazer as altera√ß√µes necess√°rias com um script iniciado quando o cliente DHCP √© acionado: <br><br><pre> <code class="plaintext hljs">/ip dhcp-client add add-default-route=no disabled=no interface=ether2 script=":if (\$bound=1) do={\r\ \n /ip route remove [ find gateway=\"4.2.2.2\" ]; /ip route remove \ [ find where dst-address ~\"4.2.2.2\" ]\r\ \n /ip route add check-gateway=ping comment=\"For recursion via ISP2\" \ distance=1 dst-address=4.2.2.2/32 gateway=\$\"gateway-address\" scope=10\r\ \n /ip route add check-gateway=ping comment=\"Unmarked via ISP2\" \ distance=1 gateway=4.2.2.2\r\ \n /ip route add comment=\"Marked via ISP2 Main\" distance=1 gateway=4.2.2.2 \ routing-mark=to_isp2\r\ \n /ip route add comment=\"Marked via ISP1 Backup1\" distance=2 \ gateway=4.2.2.2 routing-mark=to_isp1\r\ \n /ip route add comment=\"Marked via ISP3 Backup2\" distance=3 \ gateway=4.2.2.2 routing-mark=to_isp3\r\ \n /ip firewall nat add action=src-nat chain=srcnat ipsec-policy=out,none \ out-interface=\$\"interface\" to-addresses=\$\"lease-address\" \ comment=\"NAT via ISP2\"\r\ \n /ip route rule add comment=\"From ISP2 IP to Inet\" \ src-address=\$\"lease-address\" table=to_isp2 \r\ \n} else={\r\ \n /ip route remove [ find gateway=\"4.2.2.2\" ]; /ip route remove \ [ find where dst-address ~\"4.2.2.2\" ]\r\ \n /ip firewall nat remove [find comment=\"NAT via ISP2\"]\r\ \n /ip route rule remove [find comment=\"From ISP2 IP to Inet\"]\r\ \n}\r\ \n" use-peer-dns=no use-peer-ntp=no</code> </pre> <br>  O script em si na janela Winbox (clic√°vel): <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/dz/_f/hh/dz_fhhyltpdet5oush5wqwpud2e.jpeg"></a> <br>  <i><b>Observa√ß√£o.</b></i>  <i>A primeira parte do script √© acionada quando a concess√£o √© recebida com √™xito, a segunda - ap√≥s a libera√ß√£o da concess√£o.</i>  <sup>Ver nota 2</sup> <br><br>  3.3  N√≥s configuramos a conex√£o com o provedor ISP3. <br><br>  Como o provedor de configura√ß√£o nos d√° dinamismo, √© razo√°vel fazer as altera√ß√µes necess√°rias com scripts que iniciam ap√≥s o aumento e ap√≥s a queda da interface ppp. <br><br>  <i><b>Observa√ß√£o.</b></i>  <i>A interface ppp pode ser especificada como um gateway em vez de um endere√ßo IP.</i>  <i>No entanto, neste caso, a rota recursiva n√£o pode ser ativada.</i>  <i>Portanto, obtemos o endere√ßo IP do lado do provedor na vari√°vel e o usamos mais da mesma maneira que para os outros provedores</i> <br><br>  3.3.1  Primeiro, configure o perfil: <br><br><pre> <code class="plaintext hljs">/ppp profile add comment="for PPPoE to ISP3" interface-list=WAN name=isp3_client \ on-down="/ip route remove [ find gateway=\"4.2.2.3\" ]\r\ \n/ip route remove [ find where dst-address ~\"4.2.2.3\" ]\r\ \n/ip firewall nat remove [find comment=\"NAT via ISP3\"]\r\ \n/ip route rule remove [find comment=\"From ISP3 IP to Inet\"]" \ on-up="/ip route remove [ find gateway=\"4.2.2.3\" ]; /ip route remove \ [ find where dst-address ~\"4.2.2.3\" ]\r\ \n/ip route add check-gateway=ping comment=\"For recursion via ISP3\" distance=1 \ dst-address=4.2.2.3/32 gateway=\$\"remote-address\" scope=10\r\ \n/ip route add check-gateway=ping comment=\"Unmarked via ISP3\" distance=3 \ gateway=4.2.2.3\r\ \n/ip route add comment=\"Marked via ISP3 Main\" distance=1 gateway=4.2.2.3 \ routing-mark=to_isp3\r\ \n/ip route add comment=\"Marked via ISP1 Backup2\" distance=3 gateway=4.2.2.3 \ routing-mark=to_isp1\r\ \n/ip route add comment=\"Marked via ISP2 Backup2\" distance=3 gateway=4.2.2.3 \ routing-mark=to_isp2\r\ \n/ip firewall mangle set [find comment=\"Connmark in from ISP3\"] \ in-interface=\$\"interface\"\r\ \n/ip firewall nat add action=src-nat chain=srcnat ipsec-policy=out,none \ out-interface=\$\"interface\" to-addresses=\$\"local-address\" \ comment=\"NAT via ISP3\"\r\ \n/ip route rule add comment=\"From ISP3 IP to Inet\" \ src-address=\$\"local-address\" table=to_isp3 "</code> </pre><br>  O script em si na janela Winbox (clic√°vel): <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/oz/tz/it/oztzitzzxgl5jz0g9jxskvtf3us.jpeg"></a> <br>  <i><b>Observa√ß√£o.</b></i>  <i>String</i> <i><br></i>  <i><b>/ ip firewall mangle set [find comment = "Connmark in from ISP3"] na interface = $ "interface";</b></i> <i><br></i>  <i>Permite processar corretamente a renomea√ß√£o da interface, porque ela trabalha com seu c√≥digo e n√£o com o nome de exibi√ß√£o.</i> <br><br>  3.3.2  Agora, usando o perfil, crie uma conex√£o ppp: <br><br><pre> <code class="plaintext hljs">/interface pppoe-client add allow=mschap2 comment="to ISP3" disabled=no \ interface=ether3 name=pppoe-isp3 password=isp3_pass profile=isp3_client \ user=isp3_client</code> </pre> <br><br>  <i><b>Observa√ß√£o.</b></i>  <i>Alguns provedores "esquecem" de fornecer o par√¢metro "endere√ßo remoto".</i>  <i>Nesse caso, quando conectado, o script de configura√ß√£o n√£o funcionar√° corretamente e, no log, voc√™ ver√° o seguinte erro:</i> <i><br></i>  <i>pppoe, ppp, info pppoe-isp3: n√£o foi poss√≠vel determinar o endere√ßo remoto usando xxx.xxx.xxx.xxx</i> <i><br></i>  <i>Para resolver esse problema, voc√™ precisa definir manualmente o endere√ßo no perfil ppp (qualquer modelo):</i> <i><br></i> <pre> <i><code class="plaintext hljs">/ppp profile set isp3_client remote-address=169.254.69.96</code></i> </pre> <i><br></i>  <i>String</i> <i><br></i>  <i><b>/ ip firewall mangle set [find comment = "Connmark in from ISP3"] na interface = $ "interface";</b></i> <i><br></i>  <i>Permite processar corretamente a renomea√ß√£o da interface, porque ela trabalha com seu c√≥digo e n√£o com o nome de exibi√ß√£o.</i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Como toque final, acerte o rel√≥gio: </font></font><br><br><pre> <code class="plaintext hljs">/system ntp client set enabled=yes \ server-dns-names=0.pool.ntp.org,1.pool.ntp.org,2.pool.ntp.org</code> </pre> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para quem l√™ at√© o fim </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo proposto para implementar multivans √© a prefer√™ncia pessoal do autor e n√£o √© o √∫nico poss√≠vel. </font><font style="vertical-align: inherit;">O kit de ferramentas ROS √© extenso e flex√≠vel, o que, por um lado, causa dificuldades para iniciantes, por outro - o motivo da popularidade. </font><font style="vertical-align: inherit;">Explore, tente, descubra novas ferramentas e solu√ß√µes. </font><font style="vertical-align: inherit;">Por exemplo, como uma aplica√ß√£o do conhecimento adquirido, nesta implementa√ß√£o da </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">multivan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© poss√≠vel substituir a ferramenta de </font><b><font style="vertical-align: inherit;">gateway de verifica√ß√£o por</font></b><font style="vertical-align: inherit;"> rotas recursivas com o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netwatch</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anota√ß√µes </font></font></h4><br><ol><li> <i><b>Check-gateway</b> ‚Äî ,             .     10 ,   . ,       20-30 .       ‚Äî     <b>Netwatch</b> ,      . <br>  <b>Check-gateway</b>        . <br><br> <u><b>!</b></u>          ,    .     <b>check-gateway=ping</b>  .</i> </li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocorre que ocorre uma falha no mecanismo de opera√ß√£o DHP, que parece um cliente pendurado em um estado de renova√ß√£o. </font><font style="vertical-align: inherit;">Nesse caso, a segunda parte do script n√£o funcionar√°, mas n√£o prejudicar√° o tr√°fego de andar corretamente, pois o estado monitora a rota recursiva correspondente.</font></font></i> </li><li> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECMP (Caminho m√∫ltiplo de custo igual)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - O ROS pode especificar uma rota com v√°rios gateways e a mesma dist√¢ncia. </font><font style="vertical-align: inherit;">Nesse caso, as conex√µes ser√£o distribu√≠das pelos canais usando o algoritmo round robin, proporcionalmente ao n√∫mero de gateways especificados.</font></font></i> </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para que o √≠mpeto escreva o artigo, ajude a moldar sua estrutura e colocando √™nfase - agradecimentos pessoais a Eugene </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@jscar</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt463813/">https://habr.com/ru/post/pt463813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt463799/index.html">O que eu n√£o gosto no Windows 10</a></li>
<li><a href="../pt463801/index.html">3 qualidades-chave para um gerente de produto de sucesso: Anton Stozhko</a></li>
<li><a href="../pt463803/index.html">Meu quinto dia com o Haiku: vamos portar alguns programas</a></li>
<li><a href="../pt463805/index.html">Sete livros para quem quer se tornar um designer de jogos</a></li>
<li><a href="../pt463811/index.html">Preparando o aplicativo para Android Q. Parte 1</a></li>
<li><a href="../pt463815/index.html">Por que um banco estrangeiro est√° interessado na fonte de seus fundos?</a></li>
<li><a href="../pt463817/index.html">20 gerentes de produto e a estrutura matricial mais multidimensional de todos. Conversa com Skyeng</a></li>
<li><a href="../pt463819/index.html">Bloqueios do PostgreSQL: 2. Bloqueios de string</a></li>
<li><a href="../pt463821/index.html">AMO, Bitrix, 1C e outros: como escolher por onde come√ßar?</a></li>
<li><a href="../pt463823/index.html">Vers√£o Rust 1.37.0: Otimiza√ß√£o guiada por perfil, constantes sem nome e fornecedor de carga</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>