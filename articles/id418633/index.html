<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥝 👨‍👧‍👦 👨🏻‍🔬 Reaktivitas JavaScript: Contoh Sederhana dan Intuitif ♒️ 🕺🏽 👷🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Banyak kerangka kerja front-end JavaScript (seperti Angular, React, dan Vue) memiliki sistem reaktivitasnya sendiri. Memahami fitur-fitur sistem ini a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reaktivitas JavaScript: Contoh Sederhana dan Intuitif</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/418633/">  Banyak kerangka kerja front-end JavaScript (seperti Angular, React, dan Vue) memiliki sistem reaktivitasnya sendiri.  Memahami fitur-fitur sistem ini akan berguna bagi pengembang mana pun, akan membantunya lebih efisien menggunakan kerangka kerja JS modern. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/c_/k4/dp/c_k4dpwjifcbq6pvrg-gn7wydsu.jpeg"></a> <br><br>  Bahan, terjemahan yang kami terbitkan hari ini, menunjukkan contoh langkah-demi-langkah dari pengembangan sistem reaktivitas dalam JavaScript murni.  Sistem ini mengimplementasikan mekanisme yang sama yang digunakan dalam Vue. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Sistem reaktivitas</font> </h2><br>  Bagi seseorang yang pertama kali menemukan sistem reaktivitas Vue, itu mungkin tampak seperti kotak hitam misterius.  Pertimbangkan aplikasi Vue sederhana.  Ini markupnya: <br><br><pre><code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Price: $</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ price }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Total: $</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ price*quantity }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Taxes: $</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ totalPriceWithTax }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Berikut adalah kerangka perintah koneksi dan kode aplikasi. <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdn.jsdelivr.net/npm/vue"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">   </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> vm = </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">new</span></span></span><span class="actionscript"> Vue({       el: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'#app'</span></span></span><span class="actionscript">,       data: {           price: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">5.00</span></span></span><span class="actionscript">,           quantity: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">2</span></span></span><span class="actionscript">       },       computed: {           totalPriceWithTax() {               </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">return</span></span></span><span class="actionscript"> </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">this</span></span></span><span class="actionscript">.price * </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">this</span></span></span><span class="actionscript">.quantity * </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1.03</span></span></span><span class="actionscript">           }       }   }) </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Entah bagaimana, Vue mengetahui bahwa ketika <code>price</code> berubah, mesin perlu melakukan tiga hal: <br><br><ol><li>  Refresh nilai <code>price</code> di halaman web. </li><li>  Hitung ulang ekspresi di mana <code>price</code> dikalikan dengan <code>quantity</code> , dan tampilkan nilai yang dihasilkan pada halaman. </li><li>  Panggil fungsi <code>totalPriceWithTax</code> dan, sekali lagi, masukkan apa yang dikembalikan pada halaman. </li></ol><br>  Apa yang terjadi di sini ditunjukkan pada ilustrasi berikut. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/373/af5/15e/373af515eac946ce5c656df9fe2da573.jpg"></div><br>  <i><font color="#999999">Bagaimana Vue tahu apa yang harus dilakukan ketika harga properti berubah?</font></i> <br><br>  Sekarang kami memiliki pertanyaan tentang bagaimana Vue tahu apa yang sebenarnya perlu diperbarui ketika <code>price</code> berubah, dan bagaimana mesin melacak apa yang terjadi di halaman.  Apa yang dapat Anda amati di sini tidak terlihat seperti aplikasi JS biasa. <br><br>  Mungkin ini belum jelas, tetapi masalah utama yang perlu kita selesaikan di sini adalah bahwa program JS biasanya tidak berfungsi seperti itu.  Sebagai contoh, mari kita jalankan kode berikut: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> price = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quantity = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = price * quantity <span class="hljs-comment"><span class="hljs-comment">//  10 price = 20; console.log(`total is ${total}`)</span></span></code> </pre> <br>  Menurut Anda apa yang akan ditampilkan di konsol?  Karena tidak ada yang digunakan di sini kecuali JS biasa, <code>10</code> akan sampai ke konsol. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/030/992/c52/030992c52de473284847fa7f8f2f6785.png"></div><br>  <i><font color="#999999">Hasil program</font></i> <br><br>  Dan ketika menggunakan kemampuan Vue, dalam situasi yang sama, kita dapat menerapkan skenario di mana nilai <code>total</code> dihitung ketika variabel <code>price</code> atau <code>quantity</code> berubah.  Artinya, jika sistem reaktivitas digunakan dalam pelaksanaan kode di atas, maka bukan 10, tetapi 40 akan ditampilkan pada konsol: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/22c/c4e/6c7/22cc4e6c79914b1c9f2c4df6bf83c9e1.png"></div><br>  <i><font color="#999999">Output konsol dihasilkan oleh kode hipotetis menggunakan sistem reaktivitas</font></i> <br><br>  JavaScript adalah bahasa yang dapat berfungsi baik secara prosedural maupun berorientasi objek, tetapi tidak memiliki sistem reaktivitas bawaan, oleh karena itu kode yang kami pertimbangkan saat mengubah <code>price</code> tidak akan menampilkan angka 40 ke konsol.  Agar indikator <code>total</code> dihitung ulang ketika <code>price</code> atau <code>quantity</code> berubah, kita perlu membuat sistem reaktivitas sendiri dan dengan demikian mencapai perilaku yang kita butuhkan.  Kami akan memecah jalan menuju tujuan ini menjadi beberapa langkah kecil. <br><br><h2>  <font color="#3AC1EF">Tugas: penyimpanan aturan untuk menghitung indikator</font> </h2><br>  Kita memerlukan suatu tempat untuk menyimpan informasi tentang bagaimana indikator <code>total</code> dihitung, yang akan memungkinkan kita untuk menghitung ulang ketika mengubah nilai variabel <code>price</code> atau <code>quantity</code> . <br><br><h3>  <font color="#3AC1EF">OlSolusi</font> </h3><br>  Pertama, kita perlu memberi tahu aplikasi ini sebagai berikut: "Ini adalah kode yang akan saya jalankan, simpan, saya mungkin perlu menjalankannya lain kali."  Maka kita perlu menjalankan kode.  Kemudian, jika indikator <code>price</code> atau <code>quantity</code> telah berubah, Anda harus memanggil kode yang disimpan untuk menghitung ulang <code>total</code> .  Ini terlihat seperti ini: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7e8/de0/6ce/7e8de06ce6262d1989c13153884cd225.png"></div><br>  <i><font color="#999999">Kode perhitungan total perlu disimpan di suatu tempat agar dapat mengaksesnya nanti</font></i> <br><br>  Kode yang dapat Anda panggil dalam JavaScript untuk melakukan beberapa tindakan diformat sebagai fungsi.  Oleh karena itu, kami akan menulis fungsi yang berhubungan dengan perhitungan <code>total</code> , dan juga membuat mekanisme untuk menyimpan fungsi yang mungkin kita perlukan nanti. <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> price = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quantity = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> target = <span class="hljs-literal"><span class="hljs-literal">null</span></span> target = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   total = price * quantity } record() <span class="hljs-comment"><span class="hljs-comment">//       ,       target() //  </span></span></code> </pre> <br>  Perhatikan bahwa kami menyimpan fungsi anonim dalam variabel <code>target</code> , dan kemudian memanggil fungsi <code>record</code> .  Kami akan membicarakannya di bawah ini.  Saya juga ingin mencatat bahwa fungsi <code>target</code> , menggunakan sintaks fungsi panah ES6, dapat ditulis ulang sebagai berikut: <br><br><pre> <code class="hljs coffeescript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { total = price * quantity }</code> </pre> <br>  Berikut adalah deklarasi fungsi <code>record</code> dan struktur data yang digunakan untuk menyimpan fungsi: <br><br><pre> <code class="hljs powershell">let storage = [] //     target <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">record</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { // target = () =&gt; { total = price * quantity }   storage.push(target) }</code> </pre> <br>  Menggunakan fungsi <code>record</code> , kami menyimpan fungsi <code>target</code> (dalam kasus kami, <code>{ total = price * quantity }</code> ) dalam array <code>storage</code> , yang memungkinkan kami untuk memanggil fungsi ini nanti, mungkin menggunakan fungsi <code>replay</code> , kode yang ditunjukkan di bawah ini.  Ini akan memungkinkan kita untuk memanggil semua fungsi yang tersimpan dalam <code>storage</code> . <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replay</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   storage.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">run</span></span></span><span class="hljs-function"> =&gt;</span></span> run()) }</code> </pre> <br>  Di sini kita pergi melalui semua fungsi anonim yang disimpan dalam array <code>storage</code> dan menjalankan masing-masing. <br><br>  Kemudian dalam kode kita kita dapat melakukan hal berikut: <br><br><pre> <code class="hljs pgsql">price = <span class="hljs-number"><span class="hljs-number">20</span></span> console.log(total) // <span class="hljs-number"><span class="hljs-number">10</span></span> replay() console.log(total) // <span class="hljs-number"><span class="hljs-number">40</span></span></code> </pre> <br>  Tidak semua terlihat sulit, bukan?  Inilah keseluruhan kode, fragmen-fragmen yang telah kita bahas di atas, seandainya lebih nyaman bagi Anda untuk akhirnya menanganinya.  Ngomong-ngomong, kode ini tidak sengaja ditulis seperti itu. <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> price = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quantity = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> target = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> storage = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">record</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   storage.push(target) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replay</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   storage.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">run</span></span></span><span class="hljs-function"> =&gt;</span></span> run()) } target = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { total = price * quantity } record() target() price = <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(total) <span class="hljs-comment"><span class="hljs-comment">// 10 replay() console.log(total) // 40</span></span></code> </pre> <br>  Inilah yang akan ditampilkan di konsol browser setelah dimulai. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67c/18e/94b/67c18e94b8afde9e116e95bb4cf8f41b.png"></div><br>  <i><font color="#999999">Hasil kode</font></i> <br><br><h2>  <font color="#3AC1EF">Tantangan: solusi andal untuk menyimpan fungsi</font> </h2><br>  Kita dapat terus menuliskan fungsi yang kita butuhkan saat diperlukan, tetapi alangkah baiknya jika kita memiliki solusi yang lebih andal yang dapat ditingkatkan dengan aplikasi.  Mungkin itu akan menjadi kelas yang memelihara daftar fungsi yang awalnya ditulis untuk variabel <code>target</code> , dan yang menerima pemberitahuan jika kita perlu menjalankan kembali fungsi-fungsi ini. <br><br><h3>  <font color="#3AC1EF">▍Solusi: Kelas ketergantungan</font> </h3><br>  Salah satu pendekatan untuk memecahkan masalah di atas adalah merangkum perilaku yang kita butuhkan di kelas, yang dapat disebut Ketergantungan.  Kelas ini akan menerapkan pola pemrograman pengamat standar. <br><br>  Akibatnya, jika kita membuat kelas JS yang digunakan untuk mengelola dependensi kita (yang akan dekat dengan bagaimana mekanisme serupa diimplementasikan di Vue), mungkin terlihat seperti ini: <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dep</span></span></span><span class="hljs-class"> { // </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dep</span></span></span><span class="hljs-class"> -    </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dependency</span></span></span><span class="hljs-class">   constructor () {       this.subscribers = [] //  ,                               //    notify()   }   depend () { //   record       if (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class"> &amp;&amp; !</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscribers</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">includes</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">)){           //    target                //                this.subscribers.push(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">)       }   }   notify () { //   replay       this.subscribers.forEach(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub</span></span></span><span class="hljs-class">())       //  -     } }</span></span></code> </pre> <br>  Harap perhatikan bahwa alih-alih array <code>storage</code> , kami sekarang menyimpan fungsi anonim kami dalam array <code>subscribers</code> .  Alih-alih fungsi <code>record</code> , metode <code>depend</code> sekarang disebut.  Juga di sini, alih-alih fungsi <code>replay</code> , fungsi <code>notify</code> .  Berikut cara menjalankan kode kami menggunakan kelas <code>Dep</code> : <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dep = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dep() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> price = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quantity = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> target = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { total = price * quantity } dep.depend() <span class="hljs-comment"><span class="hljs-comment">//   target    target() //     total console.log(total) // 10 -   price = 20 console.log(total) // 10 -    ,    dep.notify() //   -  console.log(total) // 40 -   </span></span></code> </pre> <br>  Kode baru kami berfungsi sama seperti sebelumnya, tetapi sekarang dirancang lebih baik, dan rasanya lebih baik digunakan kembali. <br><br>  Satu-satunya hal yang tampak aneh di dalamnya sejauh ini adalah bekerja dengan fungsi yang disimpan dalam variabel <code>target</code> . <br><br><h2>  <font color="#3AC1EF">Tugas: mekanisme untuk membuat fungsi anonim</font> </h2><br>  Di masa depan, kita perlu membuat objek kelas <code>Dep</code> untuk setiap variabel.  Selain itu, akan lebih baik untuk merangkum perilaku membuat fungsi anonim di suatu tempat, yang harus dipanggil saat memperbarui data yang relevan.  Mungkin ini akan membantu kita dengan fungsi tambahan, yang akan kita sebut <code>watcher</code> .  Ini akan mengarah pada fakta bahwa kita dapat mengganti konstruksi ini dari contoh sebelumnya dengan fungsi baru: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> target = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { total = price * quantity } dep.depend() target()</code> </pre> <br>  Bahkan, panggilan ke fungsi <code>watcher</code> yang menggantikan kode ini akan terlihat seperti ini: <br><br><pre> <code class="hljs coffeescript">watcher(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   total = price * quantity })</code> </pre> <br><h3>  <font color="#3AC1EF">▍ Solusi: fungsi pengamat</font> </h3><br>  Di dalam fungsi <code>watcher</code> , kode yang disajikan di bawah ini, kita dapat melakukan beberapa tindakan sederhana: <br><br><pre> <code class="hljs cmake"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> watcher(myFunc) {   <span class="hljs-keyword"><span class="hljs-keyword">target</span></span> = myFunc //   <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>   myFunc   dep.depend() //  <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>      <span class="hljs-keyword"><span class="hljs-keyword">target</span></span>() //     <span class="hljs-keyword"><span class="hljs-keyword">target</span></span> = null //   <span class="hljs-keyword"><span class="hljs-keyword">target</span></span> }</code> </pre> <br>  Seperti yang Anda lihat, fungsi <code>watcher</code> mengambil, sebagai argumen, fungsi <code>myFunc</code> , menulisnya ke variabel <code>target</code> global, memanggil <code>dep.depend()</code> untuk menambahkan fungsi ini ke daftar pelanggan, memanggil fungsi ini dan mengatur ulang variabel <code>target</code> . <br>  Sekarang kita mendapatkan semua nilai yang sama 10 dan 40 jika kita menjalankan kode berikut: <br><br><pre> <code class="hljs pgsql">price = <span class="hljs-number"><span class="hljs-number">20</span></span> console.log(total) dep.<span class="hljs-keyword"><span class="hljs-keyword">notify</span></span>() console.log(total)</code> </pre> <br>  Mungkin Anda bertanya-tanya mengapa kami menerapkan <code>target</code> sebagai variabel global, alih-alih meneruskan variabel ini ke fungsi kami, jika perlu.  Kami punya alasan bagus untuk melakukan hal itu, nanti Anda akan mengerti. <br><br><h2>  <font color="#3AC1EF">Tugas: memiliki objek Dep untuk setiap variabel</font> </h2><br>  Kami memiliki objek tunggal dari kelas <code>Dep</code> .  Bagaimana jika kita membutuhkan masing-masing variabel kita untuk memiliki objek kelas <code>Dep</code> sendiri?  Sebelum kita melanjutkan, mari kita pindahkan data yang kita kerjakan ke properti objek: <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: 5, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">: 2 }</span></span></code> </pre> <br>  Bayangkan sejenak bahwa masing-masing properti kita ( <code>price</code> dan <code>quantity</code> ) memiliki objek kelas <code>Dep</code> internal sendiri. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d6/7a0/686/0d67a0686a5c87e6080994309197e6b4.png"></div><br>  <i><font color="#999999">Properti harga dan kuantitas</font></i> <br><br>  Sekarang kita dapat memanggil fungsi <code>watcher</code> seperti ini: <br><br><pre> <code class="hljs coffeescript">watcher(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   total = data.price * data.quantity })</code> </pre> <br>  Karena kita bekerja di sini dengan nilai properti <code>data.price</code> , kita memerlukan objek kelas <code>Dep</code> dari properti <code>price</code> untuk menempatkan fungsi anonim (disimpan dalam <code>target</code> ) dalam array pelanggannya (dengan memanggil <code>dep.depend()</code> ).  Selain itu, karena kami bekerja dengan <code>data.quantity</code> , kami memerlukan objek <code>Dep</code> dari properti <code>quantity</code> untuk menempatkan fungsi anonim (sekali lagi, disimpan dalam <code>target</code> ) dalam array pelanggannya. <br><br>  Jika Anda menggambarkan ini dalam bentuk diagram, Anda mendapatkan yang berikut ini. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90a/2c9/16d/90a2c916de1e45a044fb1074d64ba196.png"></div><br>  <i><font color="#999999">Fungsi jatuh ke dalam array pelanggan objek kelas Dep yang sesuai dengan properti yang berbeda</font></i> <br><br>  Jika kita memiliki satu lagi fungsi anonim di mana kita hanya bekerja dengan properti <code>data.price</code> , maka fungsi anonim yang sesuai hanya akan pergi ke Depot objek dari properti ini. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e9/ed1/040/8e9ed104054baab4bb24eeed338cc6a0.png"></div><br>  <i><font color="#999999">Pengamat tambahan dapat ditambahkan hanya ke salah satu properti yang tersedia.</font></i> <br><br>  Kapan Anda mungkin perlu menelepon <code>dep.notify()</code> untuk fungsi yang berlangganan perubahan <code>price</code> properti?  Ini akan diperlukan saat mengubah <code>price</code> .  Ini berarti bahwa ketika contoh kita sudah benar-benar siap, kode berikut harus bekerja untuk kita. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2df/2d9/7a0/2df2d97a0a995fbbdb63703ea76f8349.png"></div><br>  <i><font color="#999999">Di sini, saat mengubah harga, Anda perlu menelepon dep.notify () untuk semua fungsi yang berlangganan perubahan harga</font></i> <br><br>  Agar semuanya berfungsi dengan cara ini, kita perlu beberapa cara untuk mencegat acara akses properti (dalam kasus kami, itu adalah <code>price</code> atau <code>quantity</code> ).  Ini akan memungkinkan, ketika ini terjadi, untuk menyimpan fungsi <code>target</code> ke dalam array pelanggan, dan ketika variabel terkait berubah, untuk mengeksekusi fungsi yang disimpan dalam array ini. <br><br><h3>  <font color="#3AC1EF">▍Solusi: Object.defineProperty ()</font> </h3><br>  Sekarang kita perlu berkenalan dengan metode ES5 standar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Object.defineProperty ().</a>  Ini memungkinkan Anda untuk menetapkan getter dan setter ke properti objek.  Izinkan saya, sebelum kita beralih ke penggunaan praktisnya, untuk menunjukkan operasi mekanisme ini dengan contoh sederhana. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: 5, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">: 2 } </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.defineProperty(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price'</span></span></span><span class="hljs-class">, { //       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">() { //        </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">I</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">was</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">accessed</span></span></span><span class="hljs-class">`)   },   set(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">) { //        </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">I</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">was</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">changed</span></span></span><span class="hljs-class">`)   } }) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price //       </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price = 20 //     </span></span></code> </pre> <br>  Jika Anda menjalankan kode ini di konsol browser, itu akan menampilkan teks berikut. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed0/7a5/ec1/ed07a5ec1a3a8183516f908695d42c47.png"></div><br>  <i><font color="#999999">Hasil Getter dan Setter</font></i> <br><br>  Seperti yang Anda lihat, contoh kami hanya mencetak beberapa baris teks ke konsol.  Namun, itu tidak membaca atau menetapkan nilai, karena kami mendefinisikan ulang fungsionalitas standar getter dan setter.  Kami akan mengembalikan fungsionalitas metode ini.  Yaitu, diharapkan getter mengembalikan nilai metode yang sesuai, dan setter menyetelnya.  Oleh karena itu, kami akan menambahkan variabel baru, <code>internalValue</code> , ke kode, yang akan kami gunakan untuk menyimpan nilai <code>price</code> saat ini. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: 5, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">: 2 } let internalValue = </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price //   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.defineProperty(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price'</span></span></span><span class="hljs-class">, { //       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">() { //        </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Getting</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class">}`)       return internalValue   },   set(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">) {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Setting</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class">: ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">}`)       internalValue = newVal   } }) total = </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price * </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.quantity //       </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price = 20 //     </span></span></code> </pre> <br>  Sekarang setelah pengambil dan penyetel bekerja sebagaimana mestinya, apa yang menurut Anda akan masuk ke konsol ketika kode ini dieksekusi?  Lihatlah gambar berikut. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/050/0c1/6b1/0500c16b12301a46ee7a0db01ea3b823.png"></div><br>  <i><font color="#999999">Output data ke konsol</font></i> <br><br>  Jadi, sekarang kami memiliki mekanisme yang memungkinkan Anda menerima pemberitahuan saat membaca nilai properti dan ketika nilai baru dituliskan kepada mereka.  Sekarang, setelah mengerjakan ulang kode sedikit, kita dapat melengkapi getter dan setter dengan semua properti dari objek <code>data</code> .  Di sini kita akan menggunakan metode <code>Object.keys()</code> , yang mengembalikan array kunci dari objek yang diteruskan ke sana. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: 5, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">: 2 } </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.keys(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">).forEach(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class"> =&gt; { //        </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">]   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">defineProperty</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">, {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">() {           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Getting</span></span></span><span class="hljs-class"> ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">}: ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class">}`)           return internalValue       },       set(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">) {           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">console</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">(`</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Setting</span></span></span><span class="hljs-class"> ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">} to: ${</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">}`)           internalValue = newVal       }   }) }) let total = </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price * </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.quantity </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.price = 20</span></span></code> </pre> <br>  Sekarang semua properti objek <code>data</code> memiliki getter dan setter.  Inilah yang muncul di konsol setelah menjalankan kode ini. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc6/af0/6b1/bc6af06b16c72f0772634160add682ab.png"></div><br>  <i><font color="#999999">Output data ke konsol oleh getter dan setter</font></i> <br><br><h2>  <font color="#3AC1EF">Perakitan Sistem Reaktivitas</font> </h2><br>  Ketika sebuah fragmen kode seperti <code>total = data.price * data.quantity</code> dan nilai properti <code>price</code> diperoleh di dalamnya, kita perlu properti <code>price</code> untuk "mengingat" fungsi anonim yang sesuai ( <code>target</code> dalam kasus kami).  Akibatnya, jika properti <code>price</code> diubah, yaitu diatur ke nilai baru, ini akan menyebabkan panggilan ke fungsi ini untuk mengulang operasi yang dilakukan olehnya, karena ia tahu bahwa baris kode tertentu tergantung padanya.  Akibatnya, operasi yang dilakukan dalam getter dan setter dapat dibayangkan sebagai berikut: <br><br><ul><li>  Getter - Anda harus mengingat fungsi anonim, yang akan kami panggil lagi ketika nilainya berubah. </li><li>  Setter - perlu untuk menjalankan fungsi anonim yang disimpan, yang akan mengarah pada perubahan nilai hasil yang sesuai. </li></ul><br>  Jika Anda menggunakan kelas <code>Dep</code> sudah Anda kenal dalam deskripsi ini, Anda mendapatkan yang berikut ini: <br><br><ul><li>  Saat membaca nilai properti, <code>dep.depend()</code> dipanggil untuk menyimpan fungsi <code>target</code> saat ini. </li><li>  Ketika nilai ditulis ke properti, <code>dep.notify()</code> dipanggil untuk memulai kembali semua fungsi yang disimpan. </li></ul><br>  Sekarang kita akan menggabungkan kedua ide ini dan, akhirnya, kita akan sampai pada kode yang memungkinkan kita untuk mencapai tujuan kita. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">let</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class">: 5, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class">: 2 } let target = null //  -    ,     class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dep</span></span></span><span class="hljs-class"> {   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constructor</span></span></span><span class="hljs-class"> () {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscribers</span></span></span><span class="hljs-class"> = []   }   depend () {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class"> &amp;&amp; !</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscribers</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">includes</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">)){           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscribers</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">push</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">)       }   }   notify () {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subscribers</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">forEach</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sub</span></span></span><span class="hljs-class">())   } } //      ,  //      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.keys(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">).forEach(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class"> =&gt; {   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">]   //         //   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dep</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dep</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dep</span></span></span><span class="hljs-class">()   </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Object</span></span></span><span class="hljs-class">.defineProperty(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">, {       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">() {           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dep</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">depend</span></span></span><span class="hljs-class">() //    </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class">       },       set(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">) {           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">internalValue</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newVal</span></span></span><span class="hljs-class">           </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dep</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">notify</span></span></span><span class="hljs-class">() //           }   }) }) //   watcher   dep.depend(), //        function watcher(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">myFunc</span></span></span><span class="hljs-class">){   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">myFunc</span></span></span><span class="hljs-class">   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">()   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class"> } watcher(() =&gt; {   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">total</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class"> * </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quantity</span></span></span><span class="hljs-class"> })</span></span></code> </pre> <br>  Mari kita bereksperimen dengan kode ini di konsol browser. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2bc/47f/c10/2bc47fc1035298c26eb1dfd84d72e738.png"></div><br>  <i><font color="#999999">Eksperimen kode siap</font></i> <br><br>  Seperti yang Anda lihat, itu berfungsi persis seperti yang kita butuhkan!  Properti <code>price</code> dan <code>quantity</code> telah menjadi reaktif!  Semua kode yang bertanggung jawab untuk menghasilkan <code>total</code> ketika perubahan <code>price</code> atau <code>quantity</code> dieksekusi berulang kali. <br><br>  Sekarang, setelah kami menulis sistem reaktivitas kami sendiri, ilustrasi dari dokumentasi Vue ini akan terasa familier dan mudah dipahami oleh Anda. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f1e/a0d/193/f1ea0d19322cee657e9b130cbd491e65.png"></div><br>  <i><font color="#999999">Sistem reaktivitas Vue</font></i> <br><br>  Lihat lingkaran ungu cantik yang bertuliskan <code></code> mengandung getter dan setter?  Sekarang dia harus terbiasa dengan Anda.  Setiap instance dari komponen memiliki instance dari metode observer (lingkaran biru), yang mengumpulkan dependensi pada getter (garis merah).  Ketika, kemudian, setter dipanggil, ia memberitahukan metode pengamat, yang mengarah pada rendering ulang komponen.  Berikut adalah skema yang sama, dilengkapi dengan penjelasan yang menghubungkannya dengan pengembangan kami. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/276/fb4/6db/276fb46db5618c8a08428c5c1914e988.png"></div><br>  <i><font color="#999999">Diagram reaktivitas Vue dengan penjelasan</font></i> <br><br>  Kami percaya bahwa sekarang, setelah kami menulis sistem reaktivitas kami sendiri, skema ini tidak perlu penjelasan tambahan. <br><br>  Tentu saja, di Vue, semua ini lebih rumit, tetapi sekarang Anda harus memahami mekanisme yang mendasari sistem reaktivitas. <br><br><h2>  <font color="#3AC1EF">Ringkasan</font> </h2><br>  Setelah membaca materi ini, Anda mempelajari yang berikut: <br><br><ul><li>  Cara membuat kelas <code>Dep</code> yang mengumpulkan fungsi menggunakan metode <code>depend</code> , dan, jika perlu, memanggil mereka lagi menggunakan metode <code>notify</code> . </li><li>  Cara membuat fungsi <code>watcher</code> yang memungkinkan Anda untuk mengontrol kode yang kami jalankan (ini adalah fungsi <code>target</code> ), yang mungkin perlu Anda simpan di objek kelas <code>Dep</code> . </li><li>  Cara menggunakan metode <code>Object.defineProperty()</code> untuk membuat getter dan setter. </li></ul><br>  Semua ini, dikompilasi dalam satu contoh tunggal, mengarah pada penciptaan sistem responsif dalam JavaScript murni, dengan memahami yang mana Anda dapat memahami fitur-fitur fungsi sistem yang digunakan dalam kerangka web modern. <br><br>  <b>Pembaca yang budiman!</b>  Jika, sebelum membaca materi ini, Anda dengan buruk membayangkan fitur-fitur mekanisme sistem reaktivitas, katakan padaku, apakah Anda sekarang berhasil mengatasinya? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id418633/">https://habr.com/ru/post/id418633/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id418621/index.html">Mengapa merekayasa soft skill</a></li>
<li><a href="../id418625/index.html">Panggilan rahasia kepada Andy Grove yang membantu Apple membeli NeXT</a></li>
<li><a href="../id418627/index.html">Lebih lanjut tentang metode untuk memecahkan sistem persamaan aljabar linier</a></li>
<li><a href="../id418629/index.html">Cara memverifikasi secara independen apakah Anda dapat mematenkan produk Anda dan melakukan pencarian paten</a></li>
<li><a href="../id418631/index.html">7 pedoman kode javascript</a></li>
<li><a href="../id418635/index.html">Membuat mesin arcade emulator. Bagian 1</a></li>
<li><a href="../id418637/index.html">Kubernet kepada massa: Slurm dimulai pada 3 Agustus</a></li>
<li><a href="../id418639/index.html">Akka Streaming untuk manusia biasa</a></li>
<li><a href="../id418641/index.html">Kesalahan yang membuat desainer tidak berkembang</a></li>
<li><a href="../id418643/index.html">Sit vs stand: bagaimana cara kerjanya lebih baik?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>