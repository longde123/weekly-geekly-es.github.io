<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöå üßïüèæ üè´ Precarga de fuentes üé∫ „ÄΩÔ∏è üåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El autor del art√≠culo, cuya traducci√≥n publicamos hoy, quiere hablar sobre por qu√© precarga las fuentes incluso cuando no deber√≠a. 
  
 Cuando cre√≥ el...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Precarga de fuentes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/470870/">  El autor del art√≠culo, cuya traducci√≥n publicamos hoy, quiere hablar sobre por qu√© precarga las fuentes incluso cuando no deber√≠a. <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/2r/jy/xq/2rjyxqifqzb06x5rhh1zj-y28ao.png"></a> <br>  Cuando cre√≥ el sitio en el que se public√≥ el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">original de</a> este material, no iba a utilizar ninguna de sus propias fuentes en √©l.  Esto inevitablemente afectar√≠a el rendimiento del sitio, aunque no mucho.  El autor del art√≠culo dice que se esforz√≥ por hacer un sitio web r√°pido.  Sin embargo, al final, se decidi√≥ usar una fuente especial para los t√≠tulos de las p√°ginas y al mismo tiempo tratar de hacer que esta soluci√≥n afecte lo menos posible el rendimiento del proyecto. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Empezando</font> </h2><br>  Para comenzar, decid√≠ hacer el archivo de fuente lo m√°s peque√±o posible.  Entonces cre√© un subconjunto de esta fuente.  En otras palabras, seleccion√© de la fuente solo aquellos caracteres que son necesarios para las palabras en el t√≠tulo. <br><br>  Como resultado, obtuve un archivo muy compacto, cuyo tama√±o era inferior a 2 Kb.  Adem√°s, lo coloqu√© en el mismo lugar que todos los dem√°s materiales en el sitio, lo que me permiti√≥ deshacerme de las dependencias de terceros y el tiempo dedicado a conectarme a otro dominio. <br><br>  Y finalmente, el enlace al archivo de fuente se coloc√≥ en el c√≥digo CSS incrustado en la p√°gina, en la parte superior del c√≥digo HTML, y no en el archivo CSS externo. <br><br>  Esto significa que el navegador podr√≠a detectar y descargar el archivo de fuente sin tener que descargar una hoja de estilo externa.  Esto, por cierto, es una raz√≥n com√∫n por la que las fuentes se cargan m√°s tarde de lo necesario. <br><br><h2>  <font color="#3AC1EF">Sorpresa</font> </h2><br>  Como se necesitan fuentes especiales para mostrar texto, el navegador debe tratarlas como recursos de alta prioridad. <br><br>  Como resultado, esperaba que el archivo de fuente se cargara muy r√°pidamente.  Las p√°ginas de mi recurso eran, en cualquier caso, bastante "ligeras", por lo que pens√© que nada deber√≠a impedir la carga del archivo de fuente. <br><br>  Cuando analic√© el sitio, me sorprendi√≥ un poco. <br><br>  Entonces, al mirar el sitio usando las herramientas de desarrollador de Chrome y examinarlo en la prueba de la p√°gina web, descubr√≠ que la fuente de alta prioridad se carg√≥ despu√©s de las im√°genes, recursos de baja prioridad. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a9e/b69/42b/a9eb6942be47a8350a3419a54e7382ef.png"></div><br>  <i><font color="#999999">Las im√°genes se descargan antes de descargar la fuente</font></i> <br><br>  Me pareci√≥ una completa tonter√≠a. <br><br>  Sab√≠a con certeza que el navegador, antes de descargar la fuente, puede esperar hasta que descubra que la fuente es necesaria para mostrar la p√°gina.  Pero el elemento en el que se us√≥ mi fuente estaba ubicado en la parte superior de la p√°gina, dentro de la <code>&lt;header&gt;</code> , mucho m√°s arriba que las etiquetas con im√°genes que se cargaron antes de descargar la fuente.  El elemento correspondiente se encuentra no solo en el c√≥digo de la p√°gina, sino tambi√©n en el √°rbol DOM. <br><br><h2>  <font color="#3AC1EF">Precargar fuentes como una soluci√≥n al problema</font> </h2><br>  El atributo de <code>preload</code> le dice al navegador que necesita precargar el recurso correspondiente necesario para mostrar la p√°gina actual. <br><br>  El uso de este atributo es una buena manera de descargar de manera anticipada recursos importantes que de otro modo el navegador descubrir√≠a m√°s adelante. <br><br>  Los archivos de fuentes son un gran ejemplo del uso de este mecanismo.  Si el enlace al archivo de fuente se realiza en una hoja de estilo externa, el navegador no detectar√° la fuente hasta que cargue esta hoja de estilo. <br><br>  El uso del atributo de <code>preload</code> aplica a los archivos de fuentes le dice al navegador que necesitar√° las fuentes apropiadas cuando muestre la p√°gina. <br>  Adem√°s, este mecanismo es muy f√°cil de implementar utilizando el elemento <code>&lt;link&gt;</code> . <br><br><pre> <code class="plaintext hljs">&lt;link rel="preload" href="myfont.woff2" as="font" type="font/woff2" crossorigin&gt;</code> </pre> <br>  Alternativamente, puede agregar una directiva de precarga al encabezado de respuesta (aunque, a menos que se especifique lo contrario, algunos servidores o CDN pueden interpretar este dise√±o como una solicitud <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://www.cloudflare.com/website-optimization/">iniciada por el servidor</a> para transferir recursos al cliente). <br><br>  No esperaba que en este sitio tuviera que usar mecanismos de precarga de recursos.  Mi c√≥digo CSS es muy modesto, lo incrust√© en el c√≥digo HTML de la p√°gina, de modo que las p√°ginas se mostrar√≠an m√°s r√°pido por los navegadores en la primera visita al sitio.  Dado que mi fuente no depend√≠a de la carga de un archivo CSS externo, el navegador, en cualquier caso, deber√≠a haberlo detectado muy temprano y sin "pistas" sobre la precarga. <br><br>  Sin embargo, descubr√≠ que la carga previa de la fuente condujo a la restauraci√≥n de la justicia, al hecho de que el archivo de fuente ahora se carg√≥ antes de que se descargaran los archivos de imagen. <br><br>  Aqu√≠ est√° el diagrama de cascada de Webpagetest: resalt√© aquellos lugares donde se muestra el trabajo con el archivo de fuente.  En la parte superior de la figura, no se usa precarga.  En la parte inferior - usado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b8c/d2e/789/b8cd2e789c21ffe4d26175ef0bbd1711.png"></div><br>  <i><font color="#999999">Precargar y trabajar con el archivo de fuente.</font></i> <br><br>  Quiz√°s ser√≠a m√°s √∫til considerar el gui√≥n gr√°fico del proceso de carga de la p√°gina (aqu√≠, para mayor claridad, se us√≥ una imitaci√≥n de una conexi√≥n muy lenta). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/451/efc/532/451efc532263db4aa64740322d011bef.png"></div><br>  <i><font color="#999999">En el gui√≥n gr√°fico superior, no se usa la carga previa.</font></i>  <i><font color="#999999">En la parte inferior - usado</font></i> <br><br>  De paso, noto que utilic√© la <code>font-display: fallback</code> controlador de <code>font-display: fallback</code> .  Es decir, el t√≠tulo se mostr√≥ originalmente usando la fuente de respaldo en caso de que mi fuente se cargara lentamente.  Sin embargo, para esta prueba, desactiv√© esta funci√≥n, porque de lo contrario ser√≠a muy dif√≠cil distinguir entre los pasos para cargar la p√°gina. <br><br><h2>  <font color="#3AC1EF">¬øPor qu√© funcion√≥?</font> </h2><br>  Para mostrar una p√°gina web, el navegador necesita construir el √°rbol DOM y el √°rbol CSSOM, que luego se utilizan para construir el √°rbol de representaci√≥n. <br><br>  <code>preload</code> que el uso del elemento <code>&lt;link&gt;</code> con el atributo de <code>preload</code> para descargar la fuente permite al navegador comenzar a construir CSSOM antes de que se complete el DOM. <br><br>  Puede ver esto en las siguientes im√°genes, que muestran una exploraci√≥n del proceso de carga de la p√°gina utilizando las herramientas para desarrolladores de Chrome. <br><br>  As√≠ es como se ve trabajar con materiales de p√°gina sin usar precarga.  Primero, se crea el DOM y se carga la imagen, luego se crea CSSOM y se carga la fuente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70e/d87/be1/70ed87be14271c5d93563d18161eaba7.png"></div><br>  <i><font color="#999999">Trabaja con la p√°gina sin usar precarga</font></i> <br><br>  Y aqu√≠ es lo mismo, pero con el uso de precarga.  Aqu√≠, el navegador comienza a crear CSSOM, comienza a descargar la fuente y luego crea el DOM y comienza a descargar las im√°genes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c75/ea3/101/c75ea31011fe25c4527c7b6c64f86b2e.png"></div><br>  <i><font color="#999999">Trabajando con la p√°gina usando preload</font></i> <br><br><h2>  <font color="#3AC1EF">¬øHay alternativas a la precarga?</font> </h2><br>  Supongamos que no puedo usar el atributo de <code>preload</code> para aumentar la prioridad del archivo de fuente.  ¬øQu√© podr√≠a hacer entonces?  ¬øC√≥mo podr√≠as reducir la prioridad de las im√°genes? <br><br>  Por curiosidad, trat√© de implementar la idea anterior y agregu√© el atributo <code>loading="lazy"</code> a los elementos que describen las im√°genes.  En Chrome 76 (el √∫nico navegador que admit√≠a esto en el momento de la escritura), esto tendr√≠a que reducir la prioridad de las im√°genes fuera del √°rea visible original de la p√°gina. <br><br>  Probar esta idea con herramientas de desarrollador ha demostrado que esto lleva a que las fuentes se descarguen antes.  Quiz√°s vale la pena recordar esto, ya que el nivel de compatibilidad del navegador para los mecanismos de carga diferida est√° creciendo con el tiempo. <br><br><h2>  <font color="#3AC1EF">Los diferentes navegadores se comportan de manera diferente</font> </h2><br>  Prob√© el proyecto en varios navegadores diferentes y en varios dispositivos.  En las pruebas, descubr√≠ que iOS Safari (iPhone 8) muestra el mismo comportamiento que Chrome.  Es decir, las fuentes, por defecto, se cargan despu√©s de las im√°genes, pero el uso del atributo de <code>preload</code> permite solucionar la situaci√≥n. <br><br>  El problema de la carga tard√≠a de la fuente tambi√©n se produjo en Firefox, pero el atributo de <code>preload</code> a√∫n no es compatible con este navegador de forma predeterminada, por lo que el uso del atributo de <code>preload</code> al ver un sitio en Firefox no ha cambiado nada. <br><br>  En Edge, las fuentes tambi√©n se cargan m√°s tarde de lo deseado.  Hab√≠a una sensaci√≥n de que usar Webload Pagetest usando el atributo <code>preload</code> solo funcionaba parcialmente.  Es decir, me pareci√≥ que parec√≠a una descarga de doble fuente.  Una vez que se carg√≥ antes, la segunda vez m√°s tarde. <br><br>  En el p√°rrafo anterior, habl√© sobre el hecho de que "ten√≠a una sensaci√≥n" y que "parec√≠a".  El hecho es que cuando intent√© probar este comportamiento usando mi propia versi√≥n de Edge, las descargas "dobles" desaparecieron.  Ahora tengo la sensaci√≥n de que usar el atributo de <code>preload</code> no acelera la carga de la fuente.  Quiz√°s esta diferencia en el comportamiento de la p√°gina fue el resultado de corregir alg√∫n error en Edge, aunque de ser as√≠, el error se corrigi√≥ a costa de cambiar el mecanismo de precarga de recursos. <br><br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>  Aqu√≠ hablamos sobre por qu√© la precarga de fuentes no hace da√±o, incluso si los enlaces a sus archivos est√°n hechos en el c√≥digo CSS incrustado en la p√°gina. <br><br>  Los navegadores no siempre se comportan como queremos o como esperamos que lo hagan.  Pero tenemos herramientas que ayudan a influir en el comportamiento de los navegadores, ayudan a inclinarlos en la direcci√≥n que necesitamos. <br><br>  Sol√≠a ‚Äã‚Äãpensar que la precarga de fuentes en mi sitio es completamente in√∫til.  De todo lo que habl√©, aprend√≠ una lecci√≥n importante para m√≠.  Consiste en el hecho de que nunca debes asumir nada. <br><br>  Al final, puedo decir que la precarga de fuentes es una excelente manera de acelerar la salida de texto en las p√°ginas web. <br><br>  <b>Estimados lectores!</b>  ¬øUtiliza mecanismos de precarga de fuentes en sus proyectos web? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/470870/">https://habr.com/ru/post/470870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../470852/index.html">Procesando 40 TB de c√≥digo de 10 millones de proyectos en un servidor dedicado con Go por $ 100</a></li>
<li><a href="../470856/index.html">Telegram GRAM Wallet: t√©rminos de servicio</a></li>
<li><a href="../470858/index.html">Antig√ºedades: punto de referencia del 386 ¬∞ procesador y de los elegantes noventa</a></li>
<li><a href="../470864/index.html">Sobre las delicias de cambiar al panel y no solo</a></li>
<li><a href="../470868/index.html">Tiempo para el primer byte: qu√© es y por qu√© es importante</a></li>
<li><a href="../470872/index.html">M√©tricas de rendimiento para investigar aplicaciones web incre√≠blemente r√°pidas</a></li>
<li><a href="../470874/index.html">Optimizando la carga de JavaScript en Wikipedia</a></li>
<li><a href="../470876/index.html">Cree construcciones de sintaxis JavaScript personalizadas con Babel. Parte 1</a></li>
<li><a href="../470878/index.html">Cree construcciones de sintaxis JavaScript personalizadas con Babel. Parte 2</a></li>
<li><a href="../470880/index.html">Mec√°nica del juego. Aventura, el concepto de terapia del habla cero y convincente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>