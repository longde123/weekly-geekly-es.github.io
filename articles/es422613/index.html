<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>癸   El cibergrupo PowerPool domin贸 la vulnerabilidad de d铆a cero en la llamada de procedimiento local avanzado   娥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El 27 de agosto de 2018, un especialista en seguridad de la informaci贸n con el sobrenombre SandboxEscaper public贸 en Twitter informaci贸n sobre la vuln...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>El cibergrupo PowerPool domin贸 la vulnerabilidad de d铆a cero en la llamada de procedimiento local avanzado</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/422613/"> El 27 de agosto de 2018, un especialista en seguridad de la informaci贸n con el sobrenombre SandboxEscaper public贸 en Twitter informaci贸n sobre la vulnerabilidad de d铆a cero.  La vulnerabilidad afecta a las versiones de Microsoft Windows del 7 al 10, m谩s precisamente, la interfaz de Llamada a procedimiento local avanzado (ALPC) en el Programador de tareas de Windows.  Proporciona escalada de privilegios locales, lo que permite a un atacante aumentar los derechos de c贸digo malicioso desde el nivel de usuario a SYSTEM.  No estamos hablando de la divulgaci贸n coordinada de la vulnerabilidad: la cuenta de SandboxEscaper se elimin贸 pronto, no hubo parches de cierre. <br><br>  El enlace del tweet condujo al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio de GitHub</a> con el c贸digo de explotaci贸n de Prueba de concepto, no solo la versi贸n compilada, sino tambi茅n el c贸digo fuente.  Por lo tanto, cualquiera podr铆a modificar y recompilar el exploit para mejorarlo, evitar la detecci贸n o incluirlo en su propio c贸digo. <br><br>  En general, no es sorprendente que solo dos d铆as despu茅s, la haza帽a apareciera en estado salvaje en la campa帽a del cibergrupo PowerPool.  Seg煤n la telemetr铆a de ESET, los pa铆ses objetivo de los atacantes son Rusia, Ucrania, Polonia, Alemania, Reino Unido, Estados Unidos, India, Filipinas, Chile.  Hay relativamente pocas v铆ctimas, lo que puede indicar una campa帽a altamente dirigida. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mv/j9/jp/mvj9jpgpgqtisu48y3jazkb72ms.jpeg"></div><br><a name="habracut"></a><br><h3>  Kit de herramientas de PowerPool </h3><br>  ESET registr贸 un nuevo grupo relativamente recientemente, sin embargo, a disposici贸n de los hackers de PowerPool, una gama bastante amplia de herramientas.  A continuaci贸n, consideramos brevemente algunos de ellos. <br><br><h4>  Explotaci贸n de escalada de privilegios locales en ALPC </h4> <br>  Los desarrolladores de PowerPool no utilizaron el archivo binario publicado por SandboxEscaper; modificaron ligeramente el c贸digo fuente y lo volvieron a compilar.  El exploit tambi茅n ha sido observado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">por investigadores de seguridad</a> y equipos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CERT</a> . <br><br><img src="https://habrastorage.org/webt/0q/a5/8a/0qa58aieslsijwatki-cc9wbvae.png"><br>  <i>Figura 1. Descripci贸n del exploit de derechos de autor</i> <br><br>  La violaci贸n est谩 en la <code>SchRpcSetSecurity</code> API <code>SchRpcSetSecurity</code> , que no valida los derechos del usuario correctamente.  Por lo tanto, el usuario puede escribir cualquier archivo en <code>C:\Windows\Task</code> , independientemente de los permisos reales; si hay un permiso de lectura, es posible reemplazar el contenido de un archivo protegido contra escritura. <br><br>  Cualquier usuario puede escribir archivos en <code>C:\Windows\Task</code> , por lo que en esta carpeta puede crear un archivo que sea un enlace r铆gido a cualquier archivo de <i>destino</i> .  Luego, llamando a la funci贸n <code>SchRpcSetSecurity</code> , puede acceder al acceso de escritura a este archivo de destino.  Para proporcionar una escalada de privilegios local, el atacante debe seleccionar el archivo de destino que se sobrescribir谩; es importante que este archivo se ejecute autom谩ticamente con derechos de administrador.  Alternativamente, puede ser un archivo del sistema o una utilidad para actualizar el software instalado previamente, que se ejecuta regularmente.  El 煤ltimo paso es reemplazar el contenido del archivo de destino con c贸digo malicioso.  Por lo tanto, en la pr贸xima ejecuci贸n autom谩tica, el malware tendr谩 derechos de administrador, independientemente de los derechos originales. <br><br>  Los desarrolladores de PowerPool decidieron cambiar el contenido del archivo <code>C:\Program Files (x86)\Google\Update\GoogleUpdate.exe</code> .  Este es un actualizador leg铆timo para aplicaciones de Google, se ejecuta regularmente con derechos de administrador a trav茅s de la tarea de Microsoft Windows. <br><br><img src="https://habrastorage.org/webt/qe/ef/as/qeefastmi_y_som113u2cmyutwa.png"><br>  <i>Figura 2. Crear un enlace duro a Google Updater</i> <br><br><img src="https://habrastorage.org/webt/7d/th/ua/7dthua4tv-1sglb8uq6udcwb6na.png"><br>  <i>Figura 3. Uso de SchRpcCreateFolder para cambiar los permisos del ejecutable de Google Updater</i> <br><br>  La secuencia de operaciones en la figura anterior permite a los operadores de PowerPool obtener permisos de escritura para el archivo ejecutable <code>GoogleUpdate.exe</code> .  Luego lo sobrescriben, reemplaz谩ndolos con una copia de su malware de segunda etapa (lo describiremos a continuaci贸n) para obtener derechos de administrador la pr贸xima vez que se llame al actualizador. <br><br><h3>  Compromiso inicial </h3><br>  El equipo de PowerPool utiliza diferentes m茅todos para primero comprometer a la v铆ctima.  Uno de ellos es el env铆o de correo no deseado con malware de la primera etapa del archivo adjunto.  Es temprano para sacar conclusiones, pero hasta ahora hemos observado muy pocas muestras en los datos de telemetr铆a, por lo que suponemos que los destinatarios se seleccionan cuidadosamente y no estamos hablando de correos masivos. <br><br>  Por otro lado, sabemos que en el pasado PowerPool ya practicaba correos no deseados.  Seg煤n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">una publicaci贸n de blog de SANS</a> publicada en mayo de 2018, utilizaron un esquema con archivos de Enlace simb贸lico (.slk) para propagar malware.  Microsoft Excel puede cargar estos archivos que actualizan la celda y hacen que Excel ejecute el c贸digo de PowerShell.  Parece que estos archivos .slk tambi茅n se distribuyen en mensajes de spam.  Seg煤n el primer archivo mencionado en la publicaci贸n SANS (SHA-1: b2dc703d3af1d015f4d53b6dbbeb624f5ade5553), puede encontrar la muestra de spam correspondiente en VirusTotal (SHA-1: e0882e234cba94b5cf3df2c05949e2e228beddb) <br><br><img src="https://habrastorage.org/webt/vb/go/yc/vbgoycqhjfhtfptqv-24ob43i-8.png"><br>  <i>Figura 4. Spam de PowerPool</i> <br><br><h3>  Puertas traseras de Windows </h3><br>  El grupo PowerPool generalmente funciona con dos puertas traseras: la puerta trasera de la primera etapa se usa despu茅s del compromiso inicial, la puerta trasera de la segunda etapa se implementa solo en las m谩quinas de inter茅s. <br><br><h4>  Puerta trasera de la primera etapa </h4><br>  Este es el malware b谩sico utilizado para la inteligencia.  Consta de dos ejecutables de Windows. <br><br>  El primero de ellos es la puerta trasera principal, que proporciona persistencia a trav茅s del servicio.  Tambi茅n crea un mutex llamado <code>MyDemonMutex%d</code> , donde <code>%d</code> est谩 en el rango de 0 a 10. La puerta trasera recopila informaci贸n del proxy, la direcci贸n del servidor C&amp;C est谩 codificada en un archivo binario.  El malware puede ejecutar comandos y realizar inteligencia b谩sica en el sistema, transfiriendo datos al servidor de C&amp;C. <br><br><img src="https://habrastorage.org/webt/ps/km/ca/pskmcackoqhfcx_19gge_ryfvoa.png"><br>  <i>Figura 5. Recopilaci贸n de informaci贸n del proxy</i> <br><br>  El segundo de los archivos ejecutables tiene un prop贸sito.  Toma una captura de pantalla y la escribe en el archivo <code>MyScreen.jpg</code> , que luego se puede filtrar por la puerta trasera principal. <br><br><h4>  Segunda puerta trasera </h4><br>  Malvar se carga durante la primera etapa, presumiblemente si la m谩quina parece interesante para los operadores.  Sin embargo, el programa no es como una puerta trasera ART moderna. <br><br>  La direcci贸n del servidor C&amp;C est谩 codificada en formato binario, no existe un mecanismo para actualizar este importante elemento de configuraci贸n.  La puerta trasera busca comandos desde <code>http://[C&amp;C domain]/cmdpool</code> y descarga archivos adicionales desde <code>http://[C&amp;C domain]/upload</code> .  Los archivos adicionales son principalmente herramientas para el movimiento horizontal, mencionados a continuaci贸n. <br><br>  Comandos soportados: <br>  - ejecuta el comando <br>  - completa el proceso <br>  - enviar archivo <br>  - descargar archivo <br>  - ver el contenido de la carpeta <br><br>  Los comandos se env铆an en formato JSON.  Los siguientes ejemplos son solicitudes para ejecutar comandos y enumerar carpetas: <br><br><img src="https://habrastorage.org/webt/au/r1/nc/aur1ncfuer-g6aqayj0n7cjmkhy.png"><br>  <i>Figura 6. Ejemplos de comandos de puerta trasera</i> <br><br><h3>  Herramientas para movimiento horizontal. </h3><br>  Al proporcionar acceso constante al sistema utilizando la puerta trasera de la segunda etapa, los operadores de PowerPool utilizan varias herramientas de c贸digo abierto, escritas principalmente en PowerShell, para el movimiento horizontal en la red. <br><br>  - <a href="">PowerDump</a> : m贸dulo Metasploit que puede recuperar nombres de usuario y hashes del Administrador de cuentas de seguridad. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PowerSploit</a> : una colecci贸n de m贸dulos de PowerShell, a la Metasploit. <br>  - <a href="">SMBExec</a> : una herramienta de PowerShell para ejecutar ataques pass-the-hash utilizando el protocolo SMB. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Quarks PwDump</a> : un ejecutable de Windows que puede extraer credenciales. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FireMaster</a> : ejecutable de Windows que puede extraer contrase帽as guardadas de Outlook, navegadores web, etc. <br><br><h3>  Conclusi贸n </h3><br>  La divulgaci贸n de vulnerabilidades antes del lanzamiento de actualizaciones pone a los usuarios en riesgo.  En este caso, incluso la 煤ltima versi贸n de Windows puede verse comprometida.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CERT-CC ofrece una</a> soluci贸n para el problema, que, sin embargo, no ha sido oficialmente acordado por Microsoft. <br><br>  El ataque de PowerPool apunta a un n煤mero limitado de usuarios.  Sin embargo, el incidente muestra que los atacantes siempre est谩n actualizados e implementan r谩pidamente nuevos exploits. <br><br>  Los especialistas de ESET contin煤an monitoreando la explotaci贸n de la nueva vulnerabilidad.  Los indicadores de compromiso tambi茅n est谩n disponibles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en GitHub</a> . <br><br><h3>  Indicadores de compromiso </h3><br><h4>  Hashes </h4><br>  Stage One Backdoor (Win32 / Agent.SZS) 038f75dcf1e5277565c68d57fa1f4f7b3005f3f3 <br>  Stage One Backdoor (Win32 / Agent.TCH) 247b542af23ad9c63697428c7b77348681aadc9a <br>  Puerta trasera de segunda etapa (Win32 / Agent.TIA) 0423672fe9201c325e33f296595fb70dcd81bcd9 <br>  Puerta trasera de segunda etapa (Win32 / Agent.TIA) b4ec4837d07ff64e34947296e73732171d1c1586 <br>  LPPC explotar ALPC (Win64 / Exploit.Agent.H) 9dc173d4d4f74765b5fc1e1c9a2d188d5387beea <br><br><h4>  Detecci贸n de ESET </h4><br>  - Win32 / Agent.SZS <br>  - Win32 / Agent.TCH <br>  - Win32 / Agent.TEL <br>  - Win32 / Agent.THT <br>  - Win32 / Agent.TDK <br>  - Win32 / Agent.TIA <br>  - Win32 / Agent.TID <br><br><h4>  Servidores C&amp;C </h4><br>  - newsrental [.] Net <br>  - rosbusiness [.] Eu <br>  - afishaonline [.] Eu <br>  - coleccionistas deportivos [.] Com <br>  - 27.102.106 [.] 149 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es422613/">https://habr.com/ru/post/es422613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422601/index.html">Chrome 69 sale con un generador de contrase帽as aleatorias</a></li>
<li><a href="../es422603/index.html">Un poco m谩s cerca de la perfecci贸n</a></li>
<li><a href="../es422605/index.html">Cultivar una caja fuerte desde temprana edad: programa educativo de Rostelecom y MIPT</a></li>
<li><a href="../es422609/index.html">Barrera del lenguaje y PNL. 驴Por qu茅 los chatbots no nos entienden?</a></li>
<li><a href="../es422611/index.html">Controlador de errores est谩ndar en RxJava2 o por qu茅 RxJava provoca bloqueos de la aplicaci贸n incluso si se implementa onError</a></li>
<li><a href="../es422615/index.html">Toda la verdad sobre RTOS. Art铆culo # 9. Programador: implementaci贸n</a></li>
<li><a href="../es422617/index.html">Toda la verdad sobre RTOS. Art铆culo # 8. Nucleus SE: dise帽o interno y despliegue</a></li>
<li><a href="../es422623/index.html">C贸mo asegurar C</a></li>
<li><a href="../es422625/index.html">Hablamos con Troy Miles, el programador de "Neuromancer"</a></li>
<li><a href="../es422627/index.html">MongoDB y la investigaci贸n de mercado de trabajo de TI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>