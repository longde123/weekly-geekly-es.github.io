<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â„¢ï¸ ğŸ—ï¸ ğŸ˜¢ TroisiÃ¨me vulnÃ©rabilitÃ© du client Steam Windows, mais pas 0day ğŸ˜¹ ğŸŒ©ï¸ ğŸ”­</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans la sÃ©rie prÃ©cÃ©dente 
 Il n'y a pas si longtemps, j'ai parlÃ© de deux vulnÃ©rabilitÃ©s de Steam: CVE-2019-14743 et CVE-2019-15316 . Il y avait toute ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TroisiÃ¨me vulnÃ©rabilitÃ© du client Steam Windows, mais pas 0day</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pm/blog/469507/"><h2>  <font color="orange">Dans la sÃ©rie prÃ©cÃ©dente</font> </h2><br>  Il n'y a pas si longtemps, j'ai parlÃ© de deux vulnÃ©rabilitÃ©s de Steam: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2019-14743</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2019-15316</a> .  Il y avait toute une histoire sur la faÃ§on dont j'ai essayÃ© de les enregistrer, je n'y suis pas parvenu, j'ai Ã©tÃ© banni, et seulement aprÃ¨s la divulgation publique et l'aide de la communautÃ©, j'ai rÃ©ussi Ã  obtenir des rÃ©sultats.  Valve a fait semblant de s'excuser et de m'interdire sur HackerOne, j'ai donc dÃ©cidÃ© de transfÃ©rer la prochaine vulnÃ©rabilitÃ© via ce service.  La troisiÃ¨me fois ( <s>il devrait y avoir une blague Ã©vidente sur Half-Life 3</s> ), tout s'est plus ou moins bien passÃ©. <br><br><img src="https://habrastorage.org/webt/1a/s7/k1/1as7k1yoqcusy8ye8rgnhyoyizk.png"><br><a name="habracut"></a><br><h2>  <font color="orange">Description de la vulnÃ©rabilitÃ©</font> </h2><br>  La vulnÃ©rabilitÃ© permet la crÃ©ation de fichiers avec un contenu partiellement contrÃ´lÃ© (ou l'ajout de contenu partiellement contrÃ´lÃ© Ã  des fichiers existants).  La version du service vulnÃ©rable est 5.31.28.21 (donnÃ©es du fichier SteamService.exe).  Je dÃ©crirai d'abord comment exploiter la vulnÃ©rabilitÃ©, puis je dÃ©crirai les consÃ©quences possibles. <br><br><h3>  Ã‰tape 1. Environnement </h3><br>  Vous devez fermer l'application Steam et arrÃªter le service client Steam s'ils sont en cours d'exÃ©cution.  Le plus souvent, les utilisateurs sans droits d'administrateur ne peuvent dÃ©marrer et arrÃªter aucun service.  Mais spÃ©cifiquement pour ce service, Valve a dÃ©fini des droits qui permettent Ã  tous les utilisateurs de l'arrÃªter et de le dÃ©marrer. <br><br>  CrÃ©ez un dossier dans n'importe quel endroit accessible Ã  l'utilisateur (par exemple, Â«C: \ testÂ»).  Dans ce dossier, vous devez copier les fichiers Steam.exe et steamclient.dll Ã  partir du dossier source Steam (par dÃ©faut, il s'agit de Â«C: \ Program Files (x86) \ SteamÂ»).  CrÃ©ez un sous-dossier de journaux vide ("C: \ test \ logs"). <br><br>  Corrigeons maintenant le registre: dans la branche "HKLM \ Software \ wow6432node \ valve \ steam", changez la valeur du paramÃ¨tre "InstallPath" en "C: \ test \ 1 \ ..".  Habituellement, pour les utilisateurs non administrateurs, les branches de registre Ã  l'intÃ©rieur de HKLM ne sont pas accessibles en Ã©criture, mais pas dans ce cas.  Lors de l'installation de Valve, ils dÃ©finissent de tels droits sur leur branche dans HKLM que toutes les actions sont disponibles pour tous les utilisateurs (Â«ContrÃ´le totalÂ» pour le groupe Â«UtilisateursÂ»). <br><br><h3>  Ã‰tape 2. Faisons un petit test </h3><br>  Lancez le service client Steam.  AprÃ¨s son arrÃªt (cela se produira automatiquement aprÃ¨s quelques secondes), vÃ©rifiez le contenu du dossier Â«C: \ test \ logsÂ» - nous y trouvons le fichier Â«service_log.txtÂ».  Le contenu du journal ressemblera Ã  ceci: <br><br><pre><code class="plaintext hljs">08/27/19 13:45:01 : ERROR: SteamService: Invalid file signature C:\test\1\..\bin\SteamService.dll</code> </pre> <br>  Notez que le chemin d'accÃ¨s "C: \ test \ 1 \ .." est Ã©quivalent au chemin d'accÃ¨s "C: \ test", donc Windows a utilisÃ© le second pour fonctionner et le premier est entrÃ© dans le message.  Supprimez le fichier Â«service_log.txtÂ» et continuez. <br><br><h3>  Ã‰tape 3. Ajoutez plus de texte. </h3><br>  Un fait intÃ©ressant: lorsque Windows fonctionne avec des chemins contenant "\ ..", il simplifie automatiquement ces chemins.  Ne vÃ©rifie pas les dossiers intermÃ©diaires. <br><br>  Par exemple, le chemin Â«C: \ 1 \ &lt;test&gt; \ ..Â» sera converti en Â«C: \ 1Â» malgrÃ© le fait que les crochets ne peuvent pas Ãªtre utilisÃ©s dans le nom du dossier. <br><br>  Ã€ la premiÃ¨re Ã©tape, nous avons enregistrÃ© le chemin dans le registre, nous allons maintenant lui ajouter des sauts de ligne.  Cela peut Ãªtre fait en Ã©crivant du code simple, mais cela peut aussi Ãªtre fait Ã  partir de l'interface regedit.  Il suffit d'ouvrir la branche de registre "HKLM \ Software \ wow6432node \ valve \ steam" et de sÃ©lectionner "Modifier les donnÃ©es binaires .." dans le menu contextuel du paramÃ¨tre "InstallPath".  Quelque chose comme un Ã©diteur hexadÃ©cimal apparaÃ®tra oÃ¹ vous pourrez apporter les modifications nÃ©cessaires. <br><br><img src="https://habrastorage.org/webt/sb/kj/f3/sbkjf31p-dwiyfolecnedmbumw8.png"><br><br>  Nous procÃ©derons Ã  un nouveau test de lancement du service et vÃ©rifierons le rÃ©sultat de nos actions. <br><br><img src="https://habrastorage.org/webt/ea/mo/8l/eamo8lw5uvavwmd-inirlbthcnm.png"><br><br>  AprÃ¨s le test, vous devez Ã  nouveau supprimer le fichier "service_log.txt". <br><br><h3>  Ã‰tape 4. Redirigez le fichier crÃ©Ã© </h3><br>  Les utilisateurs sans droits d'administrateur ne peuvent pas crÃ©er de liens symboliques d'un fichier Ã  un autre.  Mais il y a un focus - vous pouvez combiner d'autres types de liens qui sont disponibles pour les utilisateurs sans droits d'administrateur pour obtenir un effet qui est proche d'un lien symbolique d'un fichier Ã  l'autre. <br><br>  CrÃ©ez d'abord un point d'analyse NTFS (un autre nom pour le point de montage NTFS) Ã  partir du dossier "C: \ test \ logs" vers "\ RPC Control \".  "\ RPC Control \" n'est pas un dossier ordinaire au sens habituel, il ne peut pas Ãªtre visualisÃ©, par exemple, dans l'explorateur.  Il s'agit d'un rÃ©pertoire d'objets systÃ¨me, Ã  l'intÃ©rieur duquel se trouvent, par exemple, des mutex nommÃ©s, des Ã©vÃ©nements et d'autres objets similaires.  Pourquoi la redirection via le point d'analyse NTFS fonctionne pour elle n'est pas claire, le plus probable, le point est d'utiliser les mÃªmes abstractions pour les dossiers dans le systÃ¨me de fichiers et les rÃ©pertoires d'objets.  Ã€ partir du rÃ©pertoire d'objets, vous pouvez crÃ©er un lien symbolique vers un fichier sans droits d'administrateur.  CrÃ©ez un lien symbolique de la forme "\ RPC Control \ service_log.txt" &lt;-&gt; "C: \ Path \ to \ file". <br><br>  Par consÃ©quent, tous les appels Ã  "C: \ test \ logs \ service_log.txt" seront redirigÃ©s vers le fichier "C: \ Path \ to \ file".  Pour crÃ©er une telle redirection, il existe deux exigences de base: le dossier Ã  partir duquel le point d'analyse NTFS est crÃ©Ã© doit Ãªtre vide et il doit Ã©galement Ãªtre accessible en Ã©criture Ã  l'utilisateur.  Pour remplir la premiÃ¨re condition, aprÃ¨s chaque test, nous avons supprimÃ© le fichier Â«service_logs.txtÂ», la deuxiÃ¨me condition est assurÃ©e par le fait que nous avons crÃ©Ã© le dossier source dans un endroit contrÃ´lÃ© par l'utilisateur. <br><br>  Il existe un utilitaire spÃ©cial qui crÃ©e de telles paires de liens symboliques - CreateSymlink et est disponible en tÃ©lÃ©chargement sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> .  Utilisation de l'utilitaire: <br><br><pre> <code class="plaintext hljs">CreateSymlink.exe &lt;&gt; &lt;&gt;</code> </pre> <br>  Dans notre cas, ce sera: <br><br><pre> <code class="plaintext hljs">CreateSymlink.exe "C:\test\logs\service_log.txt" "C:\\\"</code> </pre> <br>  En mettant tout cela ensemble, nous obtenons qu'au dÃ©marrage du service client Steam, un fichier sera crÃ©Ã© le long du chemin spÃ©cifiÃ© lors de la crÃ©ation du lien symbolique, et ce fichier contiendra du contenu que nous pouvons contrÃ´ler (enfin, Ã  l'exception de la premiÃ¨re et de la derniÃ¨re ligne).  Si nous spÃ©cifions le chemin d'accÃ¨s Ã  un fichier existant, le contenu sera ajoutÃ© Ã  la fin du fichier.  Tout cela sera fait au nom du service client Steam avec les privilÃ¨ges NT AUTHORITY \ SYSTEM. <br><br><h2>  <font color="orange">Impact</font> </h2><br>  Je vais maintenant Ã©numÃ©rer les effets possibles des moins importants et ascendants. <br><br><ol><li>  Dos <br><br>  Si le but du lien symbolique est Â«C: \ Windows \ System32 \ config \ SAMÂ» ou Â«C: \ Windows \ System32 \ config \ SECURITYÂ», il est peu probable que le systÃ¨me d'exploitation puisse dÃ©marrer aprÃ¨s un redÃ©marrage. </li><li>  Redirection d'utilisateurs sur Internet <br><br>  DÃ©finissez l'objectif du lien symbolique "C: \ Windows \ system32 \ drivers \ etc \ hosts" et ajoutez-y une ligne comme "127.0.0.1 google.com". <br><br>  RÃ©sultat: <br><br><img src="https://habrastorage.org/webt/pe/eq/3w/peeq3w9vi8hax9c8k1rxosyfiqa.png"></li><li>  EoP horizontal <br>  Une augmentation horizontale des privilÃ¨ges est un changement de droits dans lequel nous avons accÃ¨s non pas Ã  des droits plus Ã©levÃ©s, mais Ã  des droits du mÃªme niveau, mais par rapport Ã  d'autres objets, par exemple, aux droits d'autres utilisateurs. <br><br>  DÃ©finissez l'objectif du lien symbolique Â«C: \ ProgramData \ Microsoft \ Windows \ Menu DÃ©marrer \ Programmes \ StartUp \ run.batÂ» et ajoutez-y une ligne comme Â«dÃ©marrer C: \ test \ 1.exeÂ». <br>  Tous les fichiers du dossier C: \ ProgramData \ Microsoft \ Windows \ Start Menu \ Programs \ StartUp sont exÃ©cutÃ©s par les utilisateurs lorsqu'ils se connectent.  Ainsi, un utilisateur peut forcer un autre utilisateur Ã  exÃ©cuter du code.  A partir du fichier bat, toutes les lignes seront exÃ©cutÃ©es tour Ã  tour.  Le premier et le dernier ne feront tout simplement rien, mais la commande implÃ©mentÃ©e "start C: \ test \ 1.exe" fonctionnera. <br><br>  Avec l'introduction d'une telle commande, il y a une subtilitÃ© - les caractÃ¨res "\" seront pris en compte lors de la normalisation du chemin, donc pour un fonctionnement correct il faudra ajouter quelques "\ .." de plus au chemin dans le registre. </li><li>  EoP vertical <br>  L'escalade de privilÃ¨ges verticale est une escalade habituelle, par exemple, d'un utilisateur sans droits d'administrateur vers NT AUTHORITY \ SYSTEM. <br><br>  TrÃ¨s souvent, vous pouvez trouver des logiciels qui exÃ©cutent des scripts de texte avec des droits Ã©levÃ©s.  Nous pouvons ajouter des commandes Ã  ces scripts et exÃ©cuter notre code avec des autorisations Ã©levÃ©es.  Je n'ai pas trouvÃ© de tels scripts dans un systÃ¨me d'exploitation propre, vous ne pouvez donc pas simplement dÃ©montrer un tel exploit.  Mais Ã  titre d'exemple, je peux spÃ©cifier des fichiers bat crÃ©Ã©s par NVIDIA et VmWare ou des scripts de connexion pour le systÃ¨me d'exploitation du domaine. </li></ol><br>  De plus, pour amÃ©liorer, vous pouvez vÃ©rifier la possibilitÃ© de crÃ©er des fichiers xml, des fichiers ini avec un format cassÃ©.  Malheureusement, il existe trop d'options - crÃ©ation de tÃ¢ches pour TaskSheduler, utilisation de .manifest et d'autres tÃ©lÃ©chargements de bibliothÃ¨que, et bien d'autres.  Il me semble que les rÃ©sultats dÃ©crits ci-dessus sont dÃ©jÃ  suffisants pour comprendre les rÃ©sultats de la vulnÃ©rabilitÃ©. <br><br><h2>  <font color="orange">Chronologie</font> </h2><br>  Pour complÃ©ter l'image, je vais vous donner une chronologie ennuyeuse sur cette vulnÃ©rabilitÃ©. <br>  <b>26/08</b> - TrouvÃ© une vulnÃ©rabilitÃ©. <br>  <b>27 aoÃ»t</b> - annuler le premier semestre, a publiÃ© un rapport. <br>  <b>12.09 - une correction a Ã©tÃ© publiÃ©e</b> . <br><br><h2>  <font color="orange">Conclusions</font> </h2><br>  C'est lÃ  que je termine les articles de recherche Steam - 3 vulnÃ©rabilitÃ©s trouvÃ©es avec une analyse assez superficielle, ce n'est pas suffisant.  Pour aller plus loin, vous avez besoin de plus de temps et de dÃ©sir.  Malheureusement, lâ€™attitude de Valve et lâ€™incompÃ©tence des employÃ©s de HackerOne sont des barriÃ¨res trÃ¨s fortes. <br><br>  Je remercie encore une fois tous les lecteurs qui ont contribuÃ© Ã  rendre Steam plus sÃ»r.  Je remercie Valve d'avoir corrigÃ© les vulnÃ©rabilitÃ©s et rÃ©futÃ© mes thÃ©ories du complot.  Je remercie HackerOne d'avoir fourni la plateforme, malgrÃ© le fait qu'ils m'ont essentiellement empÃªchÃ© de communiquer les vulnÃ©rabilitÃ©s Ã  Valve. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cet article en anglais.</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr469507/">https://habr.com/ru/post/fr469507/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr469495/index.html">Nouvelles approches pour construire ACS en utilisant les technologies WEB</a></li>
<li><a href="../fr469497/index.html">CrÃ©ez des niveaux 2D isomÃ©triques avec le systÃ¨me Tilemap</a></li>
<li><a href="../fr469499/index.html">Comment nous avons conquis Parallels avec Apple</a></li>
<li><a href="../fr469503/index.html">CybersÃ©curitÃ©: nous protÃ©geons les donnÃ©es des abonnÃ©s contre les fuites en 2019</a></li>
<li><a href="../fr469505/index.html">3 faÃ§ons pratiques d'amener les entreprises sur les marchÃ©s Ã©trangers: approches et techniques de vraies entreprises</a></li>
<li><a href="../fr469509/index.html">SchÃ©mas angulaires, ou comment j'ai Ã©crit mon modÃ¨le pour cli angulaire</a></li>
<li><a href="../fr469515/index.html">PrÃ©paration de l'application pour Istio</a></li>
<li><a href="../fr469521/index.html">J'ai achetÃ© une moto pour rouler, pas pour tomber</a></li>
<li><a href="../fr469523/index.html">DÃ©pendance des performances du code sur le contexte de la dÃ©claration des variables en JavaScript</a></li>
<li><a href="../fr469525/index.html">SystÃ¨me de contrÃ´le automatisÃ© pour une pelle miniÃ¨re</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>