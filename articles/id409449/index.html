<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ½â€ğŸ¤â€ğŸ§‘ğŸ½ ğŸ”· ğŸ‚ğŸ¼ Membuat karangan bunga dengan seorang anak âœŒğŸ» ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ» ğŸ‘¨ğŸ¾â€âš•ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tingkat kesulitan: untuk pemula. 

 Gagasan muncul ketika karangan bunga tua pecah pada Malam Tahun Baru. Si anak memandangi strip LED RGB dan bertany...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Membuat karangan bunga dengan seorang anak</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409449/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ss/ib/x3/ssibx3la_tckdjeo6tb-owbomck.png" alt="gambar"></div><br>  Tingkat kesulitan: untuk pemula. <br><br>  Gagasan muncul ketika karangan bunga tua pecah pada Malam Tahun Baru.  Si anak memandangi strip LED RGB dan bertanya apakah mungkin untuk membuat karangan bunga dari sana.  Anda bisa - saya berkata, dan putranya mulai menggambarkan untuk waktu yang lama bagaimana seharusnya karangan bunga itu berkedip.  Saya tidak mengerti apa-apa, dan memutuskan untuk memastikan bahwa dia bisa melakukan apa yang dia mau sendiri.  Saya mulai dengan menganalisis keinginan saya sendiri untuk proyek: <br><br><ol><li>  Lingkungan pengembangan corak-awal </li><li>  pekerjaan offline - kemampuan untuk bekerja dengan perangkat dimatikan </li><li>  Bekerja melalui udara, tanpa menghubungkan kabel </li><li>  Keandalan - tidak ada program yang diunduh yang harus "menggantung" perangkat hingga reboot diperlukan </li></ol><br><a name="habracut"></a><br><h3>  Platform perangkat keras </h3><br><img src="https://habrastorage.org/webt/k4/e_/ly/k4e_lyysvyygvsb6lrfkd8w5x_g.jpeg" alt="transistor"><br><br>  Berdasarkan papan ESP8266 dengan NodeMCU ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">seperti yang ini</a> ), beberapa transistor dan resistor ditambahkan ke dalamnya.  Modul yang dipilih memiliki pengatur tegangan 3-20 volt, yang memungkinkannya diberi daya dari sumber yang sama dengan pita.  Output esp memberikan tegangan 3 volt dengan arus pembatas 12mA, jadi saya menggunakan transistor bipolar konvensional untuk mengontrol pita. <br><br><img src="https://habrastorage.org/webt/bg/i4/9i/bgi49ip_y-dbewej2sjad1x8rmm.gif" alt="gambar"><br><br>  Agar asap putih tidak keluar dari mikrokontroler, saya meletakkan resistor 220 Ohm antara output dan basis.  Esp memiliki perangkat lunak PWM, beberapa pin memiliki tujuan khusus, saya memilih secara eksperimental. <br><br><h3>  Firmware </h3><br>  Sebelum menggunakan, esp8266 perlu di-flash, saya menggunakan NodeMCU dengan lua, meskipun memiliki sedikit fitur lebih sedikit daripada Arduino dengan C ++.  Jadi, cara termudah untuk memulai adalah dengan firmware siap pakai dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nodemcu-build.com</a> .  Untuk proyek kami, kami perlu menambahkan modul PWM.  Setelah beberapa saat, tautan ke gambar akan masuk ke email.  Anda perlu mengambil yang dengan float. <br><br>  Anda dapat menginstalnya dengan programmer apa pun <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari sini</a> , dan saya menggunakan NodeMCU Flasher. <br><br>  NodeMCU memiliki sistem file, eksekusi dimulai dengan modul init.lua, saya menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ESPlorer</a> untuk mengunduh. <br><br><h3>  Diode berkedip </h3><br>  Saat berikutnya menyesatkan saya.  Penomoran internal (GPIO0-16) hanya digunakan dalam program asli (Arduino / C ++).  Dari lua, notasi dari papan digunakan.  Misalnya, untuk menggunakan GPIO16 / D0 (LED bawaan).  dari Lua, Anda perlu menulis gpio.write (0, gpio.HIGH).  Anda dapat mengedipkan dioda langsung dari konsol ESPlorer. <br><br><img src="https://habrastorage.org/webt/va/c2/iw/vac2iwfoz0zvdstigla_qnxtbbe.png" alt="gambar"><br><br>  Tidak seperti Arduino, nodemcu <b>tidak dapat</b> menggunakan delay dan busy-loop, konsol dan wifi menggunakan prosesor yang sama untuk bekerja.  Watchdog juga dibangun di papan, yang akan me-restart jika kode Anda berjalan lebih dari 500 ms.  Disarankan untuk tidak menempati prosesor lebih dari 2ms.  Untuk mengatasi masalah tersebut, ada fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">node.task.post</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tmr</a> <br><br><h3>  Memilih lingkungan pengembangan </h3><br>  Pada awalnya saya ingin menggunakan Scratch, tetapi itu tidak cocok untuk saya, karena itu tidak memungkinkan saya untuk bekerja secara offline - program ini berjalan pada komputer di lingkungan awal, dan semua papan untuk itu bekerja secara pasif.  Setelah mencari-cari di Internet, saya menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Google Blockly</a> .  Ini ternyata persis apa yang Anda butuhkan: mendukung pembuatan kode dalam lua, dan pembuatan blok sendiri.  Setelah bereksperimen, saya memutuskan untuk membuat proyek berbasis web saya, memilih nodejs sebagai server, dan Blockly sebagai frontend.  Itu benar-benar diperlukan untuk membuat 2 blok - pengaturan warna dan penundaan.  Blockly memiliki fungsi bawaan untuk bekerja dengan warna dalam format #ffffff, membuat fungsi untuk mengatur warna tidak menjadi masalah. <br><br><div class="spoiler">  <b class="spoiler_title">Judul spoiler</b> <div class="spoiler_text"><pre><code class="javascript hljs">Blockly.Lua[<span class="hljs-string"><span class="hljs-string">'set_color'</span></span>] = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">block</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parseColor = Blockly.Lua.provideFunction_( <span class="hljs-string"><span class="hljs-string">'set_colour_rgb'</span></span>, [<span class="hljs-string"><span class="hljs-string">'function '</span></span> + Blockly.Lua.FUNCTION_NAME_PLACEHOLDER_ + <span class="hljs-string"><span class="hljs-string">'(s)'</span></span>, <span class="hljs-string"><span class="hljs-string">' local rs,gs,bs = s.match(s, "#(..)(..)(..)");'</span></span>, <span class="hljs-string"><span class="hljs-string">' setColor(tonumber(rs, 16),tonumber(gs, 16),tonumber(bs, 16));'</span></span>, <span class="hljs-string"><span class="hljs-string">'end'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value_color = Blockly.Lua.valueToCode(block, <span class="hljs-string"><span class="hljs-string">'Color'</span></span>, Blockly.Lua.ORDER_ATOMIC); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = <span class="hljs-string"><span class="hljs-string">`set_colour_rgb(</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${value_color}</span></span></span><span class="hljs-string">)\n`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> code; };</code> </pre> <br></div></div><br>  Dengan demikian, 2 dari 3 persyaratan ditutup. <br><br><h3>  Fungsi tidur () </h3><br>  Di sini saya harus secara khusus memikirkan cara menggabungkan operasi OTA yang andal dengan eksekusi kode kustom.  Untungnya, lua memiliki perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">coroutine</a> <br><br>  Setelah berpikir dan membaca dokumentasi dengan seksama, saya menyadari bahwa semua kode klien harus dijalankan di coroutine, dan menggunakan hasil alih-alih tidur sehingga modul utama dapat mengatur timer. <br><br>  Juga, untuk melindungi papan dari loop tak terbatas, saya menambal kode setelah generator dengan memasukkan hasil (0) pada awal setiap iterasi setiap loop <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MCUPostProcessLua</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">code</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> code.replace(<span class="hljs-regexp"><span class="hljs-regexp">/ do[ ]?\n/</span></span>, <span class="hljs-string"><span class="hljs-string">' do \ncoroutine.yield(0);\n'</span></span>); }</code> </pre><br><h3>  Pengunduhan OTA </h3><br>  Saya memutuskan untuk menerapkan solusi paling sederhana untuk jaringan lokal, papan terhubung ke wifi rumah, terhubung ke server pada alamat tetap, mengirimkan pengidentifikasi unik (untuk memproses dengan benar penyambungan kembali), dan mengharapkan pembaruan program melalui soket ini. <br><br><h3>  Hasil </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/farafonoff/BlocklyESP8266</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/EftHAEMSmh0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Anda dapat menambahkan banyak, misalnya, beberapa jenis opsi otorisasi untuk bekerja melalui jaringan publik, konfigurator yang ramah pengguna dalam mode hostap, meningkatkan modularitas init.lua dan dukungan untuk pembaruan OTA-nya (sekarang hanya modul dengan program yang dimuat diperbarui). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id409449/">https://habr.com/ru/post/id409449/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id409439/index.html">CES 2018: siapa pameran utama?</a></li>
<li><a href="../id409441/index.html">Tiket ke Australia</a></li>
<li><a href="../id409443/index.html">Komputer diajarkan untuk memvisualisasikan gambar visual manusia</a></li>
<li><a href="../id409445/index.html">Crispr tidak cukup. Bersiaplah untuk Pengeditan Genetik 2.0</a></li>
<li><a href="../id409447/index.html">Waktu yang tepat telah tiba - wawancara dengan Aubrey de Gray - bab satu</a></li>
<li><a href="../id409453/index.html">Dari tahun baru mengancam kita. Garis waktu perjuangan berani pemerintah dan FCS dengan pembelian online asing</a></li>
<li><a href="../id409455/index.html">Perangkat lunak, perangkat keras, headphone, dan "latihan saja": 30 bahan dengan rekomendasi untuk "penggemar audio"</a></li>
<li><a href="../id409457/index.html">5 hal terpenting dengan CES 2018</a></li>
<li><a href="../id409459/index.html">Pohon Natal yang cerdas di ESP8266 dan ws2811</a></li>
<li><a href="../id409461/index.html">Game in association: mencari kata-kata yang mirip dalam bahasa Inggris dan Rusia untuk menghafal cepat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>