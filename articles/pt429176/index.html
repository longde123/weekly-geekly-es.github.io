<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÖ ü§ûüèº üë©üèø‚Äç‚úàÔ∏è An√°lise de fluxo: in√≠cio r√°pido com o SAS ESP üëµ üë©üèº‚Äçüîß üö∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O uso de algoritmos anal√≠ticos no fluxo de dados √© agora uma das tarefas mais urgentes no campo da constru√ß√£o de sistemas anal√≠ticos. Muitos modelos p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>An√°lise de fluxo: in√≠cio r√°pido com o SAS ESP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sas/blog/429176/">  O uso de algoritmos anal√≠ticos no fluxo de dados √© agora uma das tarefas mais urgentes no campo da constru√ß√£o de sistemas anal√≠ticos.  Muitos modelos preditivos de alta precis√£o, por exemplo, desenvolvidos com base em leituras de sensores de plantas industriais, est√£o prontos para evitar acidentes industriais s√©rios, mas para isso eles precisam ser executados em dispositivos finais ("dispositivos de borda"), onde as leituras dos sensores ocorrem em tempo real.  O produto SAS Event Stream Processing √© chamado para resolver esse problema e transferir a an√°lise para "online".  Nesta publica√ß√£o, gostaria de compartilhar a experi√™ncia de sua configura√ß√£o usando um exemplo de problema aplicado - an√°lise de imagens de c√¢meras de v√≠deo. <br><br><img src="https://habrastorage.org/webt/q3/v9/2k/q3v92kdx036qyngrxp-ndx7w7km.png"><br><a name="habracut"></a><br><h3>  Tecnologia </h3><br>  A SAS est√° presente na linha de produtos SAS h√° muitos anos e est√° desenvolvendo sua pr√≥pria solu√ß√£o de processamento de fluxo, SAS Event Stream Processing (doravante ESP).  A principal tarefa dos desenvolvedores era obter alto desempenho, ordens de magnitude superiores √†s solu√ß√µes existentes no mercado.  Para fazer isso, durante o desenvolvimento do ESP, eles abandonaram completamente o armazenamento de c√°lculos e √≠ndices intermedi√°rios em disco.  Todas as convers√µes de fluxo s√£o realizadas na RAM e a recontagem espec√≠fica de evento √© preservada. <br><br><img src="https://habrastorage.org/webt/_f/ry/6r/_fry6rq07g-c2mwytu_n0thqpp0.png"><br>  <i>Trabalhe com mem√≥ria no SAS ESP.</i>  <i>O reposit√≥rio de eventos na RAM armazena resultados intermedi√°rios e n√£o √© bloqueado no caso de acessos paralelos de processos internos ou externos devido a √≠ndices adicionais.</i> <br><br>  O mecanismo pode lidar com grandes fluxos de dados - em v√°rios milh√µes de eventos por segundo.  Ao mesmo tempo, mantendo baixa lat√™ncia, por causa do qual ele rapidamente assumiu seu lugar em solu√ß√µes de marketing on-line e no combate √† fraude banc√°ria.  L√°, √© um filtro inteligente de opera√ß√µes do cliente e detecta instantaneamente atividades n√£o padr√£o nas contas, isolando opera√ß√µes fraudulentas do fluxo de dados. <br><br>  Mas ainda assim, esse √© um recurso secund√°rio do ESP.  O mecanismo foi projetado como um mecanismo para o uso cont√≠nuo de modelos anal√≠ticos (SAS, C, Python e outros) no fluxo de dados. <br><br><img src="https://habrastorage.org/webt/2m/qg/st/2mqgstvtjf69ku-dd-9elmuooii.png"><br>  <i>O princ√≠pio do processamento de eventos de streaming.</i> <br><br>  Como exemplo ilustrativo, no f√≥rum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SAS Viya Business Breakfast</a> , n√≥s da SAS decidimos montar um estande de demonstra√ß√£o, tendo como base a tarefa de an√°lise de imagem.  E √© assim que configuramos e o que encontramos no processo. <br><br><h3>  An√°lise de v√≠deo em fluxo </h3><br>  T√≠nhamos √† nossa disposi√ß√£o um modelo anal√≠tico constru√≠do por colegas do departamento de an√°lise aprofundada na plataforma SAS Viya.  Sua ess√™ncia era que, ao receber uma imagem de entrada de um motorista no interior do carro, um algoritmo (neste caso, uma rede neural convolucional treinada) classificava o comportamento do motorista de acordo com as classes: "condu√ß√£o normal", "distra√≠do por uma conversa com um passageiro", "conversando sobre telefone "," escreve SMS "etc. <br><img src="https://habrastorage.org/webt/q3/v9/2k/q3v92kdx036qyngrxp-ndx7w7km.png" align="left">  <i>Um exemplo do modelo: a imagem de entrada √© classificada como "escreve SMS", com base na parte da imagem em que a m√£o com o telefone bate.</i> <br><br>  Surgiu a quest√£o de como executar esse algoritmo em tempo real para poder responder a comportamentos indesejados.  De acordo com o cen√°rio, as imagens da c√¢mera no modo online j√° ca√≠ram na forma de arquivos no diret√≥rio de rede do disco. <br><br>  Tudo o que restava era conectar-se aos dados, converter as imagens no formato desejado, aplicar o modelo e, com toda a probabilidade de pertencer a uma classe de comportamento, exibir avisos em tempo real nos pain√©is online.  E aconteceu que tudo isso pode ser configurado na SAS ESP GUI, sem uma √∫nica linha de c√≥digo de programa (!). <br><br><h3>  Processamento de Fluxo de Eventos SAS </h3><br><img src="https://habrastorage.org/webt/t4/3w/ca/t43wcat2jtk84v43qaztpzw6yfg.png" width="300" align="left">  <i>Projeto de detec√ß√£o de perigos na interface gr√°fica do SAS ESP Studio.</i> <br clear="left">  No editor gr√°fico do ESP, adicionamos as seguintes transforma√ß√µes de fluxo de dados: <br><br><ol><li> Como entrada, temos dois n√≥s do tipo source: model_source e input_image.  Em model_source, publicamos nosso modelo de classifica√ß√£o.  Para fazer isso, configure o conector do arquivo, que l√™ um comando de um arquivo de texto contendo tr√™s par√¢metros: o nome da opera√ß√£o, o tipo de formato do modelo e o caminho f√≠sico para o arquivo bin√°rio.  O ESP fica atr√°s de cada fonte de dados a capacidade de ser est√°tico e de fluxo cont√≠nuo; portanto, a qualquer momento, podemos publicar novos comandos para baixar modelos nesse n√≥, o que √© conveniente na opera√ß√£o industrial - n√£o precisamos interromper o projeto para atualizar a vers√£o dos algoritmos. <br><br><img src="https://habrastorage.org/webt/hk/lj/ys/hkljystucnei9_ctlsegjhp9o5o.png"><br>  <i>Configurando comandos de publica√ß√£o para model_source</i> <br><br>  O conte√∫do do arquivo do modelo de entrada: <br><br> <code>I,N,1,action,load <br> I,N,2,type,astore <br> I,N,3,reference,/opt/sas/demo/image_processing/d.astore</code> </li> <li>  A segunda fonte, input_image, s√£o imagens da c√¢mera.  Para publicar dados, usamos um adaptador padr√£o - um programa que publica dados de uma fonte no ESP.  Nesse caso, usamos um adaptador de arquivo, mas voc√™ tamb√©m pode conectar-se diretamente √† c√¢mera, por exemplo, atrav√©s do adaptador UVC que acompanha a solu√ß√£o. <br><br><img src="https://habrastorage.org/webt/ay/ql/hp/ayqlhpbfglnxdttpuv1ckoqdo9k.png"><br>  <i>Configurando um conector UVC para tipos comuns de filmadoras.</i> </li><li>  As imagens podem ter um formato diferente daquele em que o modelo foi treinado e isso pode afetar a qualidade da classifica√ß√£o.  Portanto, ap√≥s input_image, adicionamos imediatamente o n√≥ resize_image e prescrevemos o formato desejado em suas configura√ß√µes.  Nesse caso, pressione para um quadrado de 100/100 pixels. <br><br><img src="https://habrastorage.org/webt/jl/bp/th/jlbpthn46z31lehm1ulcb5oe6fy.png" align="left" width="250">  <i>Configura√ß√£o do processamento de imagem</i> <br clear="left"></li><li>  A execu√ß√£o do modelo est√° configurada em CNN_score_code.  A interface extrair√° automaticamente os atributos de sa√≠da da meta-descri√ß√£o do modelo - P__label_c0, P__label_c1, P__label_c2 e P__label_c9 - as probabilidades de cada classe de comportamento.  Em seguida, no n√≥ max_class, definiremos um novo campo calculado que selecionar√° a classe com probabilidade m√°xima. </li><li>  Agora, ao lan√ßar o projeto, poderemos obter classifica√ß√£o em tempo real para cada imagem de entrada.  Em nossa hist√≥ria, um motorista inescrupuloso √© periodicamente distra√≠do da estrada.  Mas √© importante separar esses casos quando ele se distraiu por um segundo dos casos de dire√ß√£o perigosa prolongada.  Para fazer isso, adicione 3 n√≥s: armazenamento de eventos no √∫ltimo minuto (c√≥pia_1_min), agrega√ß√£o por classes de comportamento (aggr_for_alert) e o filtro de fatos de "dire√ß√£o perigosa" (filter_alert). <br><br><img src="https://habrastorage.org/webt/zi/kk/tn/zikktnzlze0q_w1zvir7awy5gum.png" width="300" align="left">  <i>Definindo configura√ß√µes de armazenamento de eventos - em 1 √∫ltimo minuto.</i> <br clear="left"><img src="https://habrastorage.org/webt/65/bx/n7/65bxn7cssoq6r2g8tmv20uu-wbs.png" width="300" align="left"><br>  <i>Configurando a contagem de eventos para cada classe de comportamento.</i> <br clear="left"><img src="https://habrastorage.org/webt/8t/bt/sc/8tbtscxuouv-v3ab5xpykssttvk.png"><br>  <i>Definindo regras de filtragem.</i> <br></li></ol><br><h3>  √çndices </h3><br>  √â importante observar que cada transforma√ß√£o no ESP tem uma configura√ß√£o - "Estado".  Caracteriza se a transforma√ß√£o de dados est√° sendo transmitida, ou seja,  ao processar um evento de entrada, o resultado √© imediatamente transmitido ao longo do diagrama e √© exclu√≠do da mem√≥ria deste n√≥.  Ou podemos armazenar o resultado do processamento de cada evento e criar um √≠ndice para permitir o acesso a ele a qualquer momento.  Por exemplo, a janela de agrega√ß√£o sempre armazena o estado e √© continuamente recalculado por evento com base no fluxo de entrada. <br><br><h3>  Lan√ßamento </h3><br>  De volta ao projeto.  N√≥s apenas temos que execut√°-lo <img src="https://habrastorage.org/webt/uv/dy/le/uvdyleayvtubt4nmqhcd2jlcqjo.png" width="50">  . <br>  Para facilitar a visualiza√ß√£o de fluxos de dados, um designer de relat√≥rio online, SAS ESP Stream Viewer, √© fornecido com o ESP.  No modo de configura√ß√£o, vemos todos os projetos em execu√ß√£o nos servidores e podemos nos conectar a eles e escolher uma visualiza√ß√£o conveniente. <br><br><img src="https://habrastorage.org/webt/hc/jm/7f/hcjm7fhuisbkt_unw2m3poekrhc.gif"><br>  <i>Pain√©is online no SAS ESP Stream Viewer</i> <br><br>  Isso √© tudo.  Tivemos a oportunidade de automatizar a rea√ß√£o em tempo real a um sinal de v√≠deo.  Nesse caso, configuramos o monitoramento on-line, mas, usando os mesmos adaptadores / conectores, podemos enviar uma mensagem para cada caso de viola√ß√£o detectada ou formar uma a√ß√£o de controle para um sistema externo. <br><br><h3>  Ou Python? </h3><br>  Tecnicamente, o caso foi conclu√≠do, mas, com o objetivo de demonstrar no f√≥rum, parecia n√£o ser interativo o suficiente.  Era inconveniente e bastante inseguro (!) Mostrar em tempo real, para que as fotos fossem tiradas com anteced√™ncia e o carro estivesse no estacionamento. <br><br>  O SAS ESP suporta a execu√ß√£o de streaming de modelos feitos em Python.  Para confirma√ß√£o, configuramos a an√°lise de imagens, ou seja, a busca de objetos na imagem, usando bibliotecas OpenCV. <br><br><img src="https://habrastorage.org/webt/62/nr/gh/62nrghkxa8unlmf2m3fjy82knz0.png" width="300" align="left">  <i>Modelo ESP para encontrar um capacete em um fluxo de entrada de imagem</i> <br clear="left">  No diagrama do ESP, temos duas fontes de dados: quadros da c√¢mera on-line do laptop e uma fotografia do objeto que estamos procurando.  Nesse caso, determinamos se o trabalhador em potencial no canteiro de obras esqueceu as regras de seguran√ßa: existe algum capacete nele?  No n√≥ proc_detection, executamos o seguinte c√≥digo Python: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compute_total</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Image,image_template)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"Output: score_point"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> base64 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> imageio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> imread MIN_MATCH_COUNT = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">#       DIST_COEFF = 0.55 img_big = imread(io.BytesIO(base64.b64decode(image_template))) sift = cv2.xfeatures2d.SIFT_create() # Initiate SIFT detector matcher = cv2.BFMatcher() # BFMatcher with default params kp_big, des_big = sift.detectAndCompute(img_big,None) img_tpl = imread(io.BytesIO(base64.b64decode(Image))) kp_tpl, des_tpl = sift.detectAndCompute(img_tpl,None) matches = matcher.knnMatch(des_tpl,des_big,k=2) good = [] for m,n in matches: if m.distance &lt; n.distance * DIST_COEFF: good.append(m) score_point = len(good) return score_point</span></span></code> </pre><br><img src="https://habrastorage.org/webt/xb/ql/56/xbql56g_rpt7jzmxp6bdzjwab-a.gif" width="500"><br>  <i>Identifica√ß√£o da presen√ßa de um capacete na imagem da webcam no f√≥rum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SAS Viya Business Breakfast</a> (colega, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">maxxts est√°</a> testando o suporte)</i> <br><br><h3>  Aprendizado de m√°quina </h3><br>  Se falarmos sobre o desenvolvimento adicional do processamento de fluxo, a √™nfase provavelmente mudar√° para o treinamento de modelos anal√≠ticos no fluxo.  I.e.  Ao contr√°rio dos exemplos anteriores, os modelos n√£o apenas executam, mas tamb√©m treinam dentro do SAS ESP.  Isso exigir√° um fluxo de dados adicional no qual executar a opera√ß√£o de trem do algoritmo selecionado pelo evento (por exemplo, para iniciantes, clustering k-means simples).  Ent√£o o carro com o ESP a bordo ter√° a oportunidade de analisar a situa√ß√£o usando novos sensores que acabaram de ser conectados.  Isso tornar√° poss√≠vel ativar e automatizar rapidamente novos dispositivos no conceito da Ind√∫stria 4.0. <br><br>  Escreva nos coment√°rios quais as tarefas enfrentadas na an√°lise de streaming e, √© claro, terei o maior prazer em responder perguntas sobre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SAS Event Stream Processing</a> . <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429176/">https://habr.com/ru/post/pt429176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429162/index.html">‚ÄúPara fazer mudan√ßas, entender por que as pessoas resistem a isso‚Äù: Jim Holmes sobre o teste de cultura</a></li>
<li><a href="../pt429166/index.html">Multicristal: da hist√≥ria √† especula√ß√£o sobre o futuro</a></li>
<li><a href="../pt429168/index.html">Atrav√©s do fogo e da √°gua: a hist√≥ria da literatura cient√≠fica russa</a></li>
<li><a href="../pt429172/index.html">1C em Proxmox. Notas gerais</a></li>
<li><a href="../pt429174/index.html">BlueStacks 4: teste em hardware fraco + coment√°rios do desenvolvedor</a></li>
<li><a href="../pt429178/index.html">Microsoft encomendou um modelo de um novo campus em Minecraft</a></li>
<li><a href="../pt429180/index.html">Ir para Ir para</a></li>
<li><a href="../pt429182/index.html">A intelig√™ncia artificial se deparou com uma barreira de entendimento</a></li>
<li><a href="../pt429184/index.html">A m√≠dia on-line previsivelmente rompe a cadeia sobre estudiosos de Oumuamua e Harvard</a></li>
<li><a href="../pt429186/index.html">@Pythonetc outubro de 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>