<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüîß üöº üèùÔ∏è Partie 3: Chargement de Linux presque d'une carte SD vers RocketChip üìë ‚úäüèª üë©üèæ‚Äçü§ù‚Äçüë®üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans la partie pr√©c√©dente , un contr√¥leur de m√©moire plus ou moins fonctionnel a √©t√© impl√©ment√©, ou plut√¥t, un wrapper sur IP Core de Quartus, qui est...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Partie 3: Chargement de Linux presque d'une carte SD vers RocketChip</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458482/"><p><img src="https://habrastorage.org/webt/4j/fu/lu/4jfulumeapi32exqv7d6vnseaho.png" width="45%" align="left">  Dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partie pr√©c√©dente</a> , un contr√¥leur de m√©moire plus ou moins fonctionnel a √©t√© impl√©ment√©, ou plut√¥t, un wrapper sur IP Core de Quartus, qui est un adaptateur pour TileLink.  Aujourd'hui, sous la rubrique ¬´Nous portons RocketChip sur une carte m√®re chinoise peu connue avec un cyclone¬ª, vous verrez une console fonctionnelle.  Le processus a tra√Æn√© un peu: je pensais d√©j√† que je lancerais rapidement Linux et continuerais, mais il n‚Äô√©tait pas l√†.  Dans cette partie, je propose d'examiner le processus de d√©marrage de U-Boot, BBL et les tentatives timides du noyau Linux pour s'initialiser.  Mais il existe une console - U-Boot-ovsky, et assez avanc√©e, ayant une grande partie de ce que vous attendez d'une console √† part enti√®re. </p><br><p> Dans le mat√©riel, une carte SD connect√©e via SPI, ainsi que UART, sera ajout√©e.  Dans la partie logicielle, BootROM sera remplac√© de <code>xip</code> √† <code>sdboot</code> et, en fait, les √©tapes de d√©marrage suivantes (sur la carte SD) seront ajout√©es. </p><a name="habracut"></a><br><h2 id="dopilivanie-apparatnoy-chasti">  Dopage du mat√©riel </h2><br><p>  Donc, la t√¢che: vous devez basculer vers le "grand" noyau et connecter l'UART (de Raspberry) et l'adaptateur SD (une sorte de carte Catalex √† six broches a √©t√© utilis√©e: GND, VCC, MISO, MOSI, SCK, CS). </p><br><p>  En principe, tout √©tait assez simple.  Mais avant de r√©aliser cela, j'ai √©t√© un peu <code>HasPeripheryUART</code> : apr√®s la fois pr√©c√©dente, j'ai d√©cid√© qu'il fallait √† nouveau m√©langer quelque chose comme <code>HasPeripheryUART</code> dans le <code>System</code> (et l'impl√©mentation, respectivement), la m√™me chose pour la carte SD - et c'est tout sera pr√™t.  Ensuite, j'ai d√©cid√© de voir comment il √©tait mis en ≈ìuvre dans une conception ¬´s√©rieuse¬ª.  Alors qu'avons-nous retir√© de s√©rieux?  Arty, apparemment, ne convient pas - le monstre n'est pas <code>unleahshed.DevKitConfigs</code> .  Et soudain, il s'est av√©r√© qu'il y avait partout une sorte de superpositions qui √©taient ajout√©es par le biais des param√®tres par touches.  Je suppose que c'est probablement tr√®s flexible et configurable, mais je voudrais commencer quelque chose pour commencer ... <em>Mais vous n'avez pas la m√™me chose, juste des b√©quilles plus faciles? ..</em> Ensuite, je suis tomb√© sur <code>vera.iofpga.FPGAChip</code> pour FPGAs Microsemi et <del>  tout de suite tir√© entre guillemets </del>  J'ai essay√© de faire mon impl√©mentation par analogie, l'avantage ici est plus ou moins l'ensemble de la "disposition de la carte m√®re" dans un seul fichier. </p><br><p>  Il s'est av√©r√© que vous avez juste besoin d'ajouter des lignes √† <code>System.scala</code> </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">System</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RocketSubsystem</span></span></span><span class="hljs-class"> ... </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripherySPI</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryUART</span></span></span><span class="hljs-class"> ... </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tlclock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">FixedClockResource</span></span>(<span class="hljs-string"><span class="hljs-string">"tlclk"</span></span>, p(<span class="hljs-type"><span class="hljs-type">DevKitFPGAFrequencyKey</span></span>)) ... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SystemModule</span></span></span><span class="hljs-class">[+</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class"> &lt;: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">System</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_outer: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">L</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RocketSubsystemModuleImp</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_outer</span></span></span><span class="hljs-class">) ... </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryUARTModuleImp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryGPIOModuleImp</span></span></span><span class="hljs-class"> ...</span></span></code> </pre> <br><p>  Une ligne dans le corps de la classe <code>System</code> ajoute des informations sur la fr√©quence √† laquelle cette partie de notre SoC fonctionne dans le fichier dts.  Autant que je sache, DTS / DTB est un analogue statique de la technologie plug-and-play pour les appareils embarqu√©s: l'arborescence de description dts est compil√©e dans un fichier dtb binaire et transmise par le chargeur au noyau afin qu'il puisse configurer correctement le mat√©riel.  Fait int√©ressant, sans ligne avec <code>tlclock</code> tout est parfaitement synth√©tis√©, mais cela ne fonctionnera pas pour compiler BootROM (je vous rappelle maintenant que ce sera <code>sdboot</code> ) - pendant la compilation, il analyse le fichier dts et cr√©e un en-t√™te avec la macro <code>TL_CLK</code> , gr√¢ce √† laquelle il peut configurer correctement les diviseurs de fr√©quence pour interfaces externes. </p><br><p>  Vous devrez √©galement corriger l√©g√®rement le ¬´c√¢blage¬ª: </p><br><p>  <strong>Platform.scala:</strong> </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlatformIO</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit val p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">// UART io.uart_tx := sys.uart(0).txd sys.uart(0).rxd := RegNext(RegNext(io.uart_rx)) // SD card io.sd_cs := sys.spi(0).cs(0) io.sd_sck := sys.spi(0).sck io.sd_mosi := sys.spi(0).dq(0).o sys.spi(0).dq(0).i := false.B sys.spi(0).dq(1).i := RegNext(RegNext(io.sd_miso)) sys.spi(0).dq(2).i := false.B sys.spi(0).dq(3).i := false.B }</span></span></code> </pre> <br><p>  Franchement, les cha√Ænes de registres ont √©t√© ajout√©es simplement par analogie avec certains autres endroits du code source.  Tr√®s probablement, ils devraient prot√©ger contre la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©tastabilit√©</a> .  Peut-√™tre que <em>certains</em> blocs ont d√©j√† leur propre protection, mais je veux d'abord ex√©cuter au moins "√† un niveau √©lev√©".  Une question plus int√©ressante pour moi est pourquoi MISO et MOSI s'accrochent-ils √† un <code>dq</code> diff√©rent?  Je n'ai toujours pas trouv√© la r√©ponse, mais il semble que le reste du code compte sur une telle connexion. </p><br><p>  Physiquement, je viens d'attribuer les conclusions de conception aux contacts desserr√©s sur le bloc et de r√©organiser le cavalier de s√©lection de tension √† 3,3 V. </p><br><div class="spoiler">  <b class="spoiler_title">Adaptateur SD</b> <div class="spoiler_text"><p>  Vue de dessus: </p><br><img src="https://habrastorage.org/webt/su/zf/q4/suzfq4lwejcelmwt3rpk5w_min0.jpeg"><br><p>  Vue de dessous: </p><br><img src="https://habrastorage.org/webt/y0/__/qq/y0__qqavfhkikpsorvmzqhbamlw.jpeg"></div></div><br><h2 id="otladka-programmnoy-chasti-instrumenty">  D√©bogage de la partie logicielle: outils </h2><br><p>  Tout d'abord, parlons des outils de d√©bogage disponibles et de leurs limites. </p><br><h3 id="minicom">  Minicom </h3><br><p>  Tout d'abord, nous devrons en quelque sorte lire ce que le chargeur de d√©marrage et la sortie du noyau.  Pour ce faire, sous Linux (dans ce cas, celui sur RaspberryPi), nous avons besoin du programme Minicom.  De mani√®re g√©n√©rale, tout programme pour travailler avec un port s√©rie convient. </p><br><p>  Notez qu'au d√©marrage, le nom du p√©riph√©rique de port doit √™tre sp√©cifi√© sous la forme <code>-D /dev/ttyS0</code> - apr√®s l'option <code>-D</code> .  Eh bien, les informations principales: pour quitter, utilisez <code>Ctrl-A, X</code>  J'ai vraiment eu un cas o√π cette combinaison n'a pas fonctionn√© - alors vous pouvez simplement dire <code>killall -KILL minicom</code> d'une session SSH adjacente. </p><br><p>  Il y a une autre fonctionnalit√©.  Plus pr√©cis√©ment, il y a deux UART sur RaspberryPi, et les deux ports peuvent d√©j√† √™tre adapt√©s pour quelque chose: l'un pour Bluetooth, √† travers l'autre, la console du noyau est affich√©e par d√©faut.  Heureusement, ce comportement peut √™tre reconfigur√© <a href="">selon ce manuel</a> . </p><br><h3 id="perepisyvanie-pamyati">  R√©√©criture de la m√©moire </h3><br><p>  Lors du d√©bogage, pour tester l'hypoth√®se, j'ai parfois d√ª <em>charger le bootloader</em> (d√©sol√©) dans la RAM directement depuis l'h√¥te.  Peut-√™tre que cela peut √™tre fait directement √† partir de GDB, mais √† la fin j'ai fait le chemin le plus simple: j'ai copi√© le fichier n√©cessaire sur Raspberry, j'ai √©galement envoy√© le port 4444 (telnet depuis OpenOCD) via SSH et utilis√© la commande <code>load_image</code> .  Lorsque vous l'ex√©cutez, il semble que tout est fig√©, mais en r√©alit√© <em>¬´il ne dort pas, il clignote juste lentement¬ª</em> : il charge le fichier, il le fait juste √† une vitesse de quelques kilo-octets par seconde. </p><br><h3 id="osobennosti-ustanovki-breakpoint-ov">  Caract√©ristiques de l'installation des points d'arr√™t </h3><br><p>  Beaucoup n'ont probablement pas eu √† y penser lors du d√©bogage de programmes r√©guliers, mais les points d'arr√™t ne sont pas toujours d√©finis dans le mat√©riel.  Parfois, la d√©finition d'un point d'arr√™t implique l'√©criture temporaire d'une instruction sp√©ciale au bon endroit <strong>directement dans le code machine</strong> .  Par exemple, voici comment ma commande <code>b</code> standard dans GDB a fonctionn√©.  Voici ce qui en d√©coule: </p><br><ul><li>  vous ne pouvez pas mettre un point √† l'int√©rieur de BootROM, car la ROM </li><li>  Vous pouvez d√©finir un point d'arr√™t sur le code charg√© dans la RAM √† partir de la carte SD, mais vous devez attendre qu'il soit charg√©.  Sinon, nous ne r√©√©crirons pas un morceau de code, mais le chargeur r√©√©crira notre point d'arr√™t </li></ul><br><p>  Je suis s√ªr que vous pouvez explicitement demander √† utiliser des points d'arr√™t mat√©riels, mais il y en a de toute fa√ßon un nombre limit√©. </p><br><h3 id="bystraya-podmena-bootrom">  √âchange rapide BootROM </h3><br><p>  Au stade initial du d√©bogage, il y a souvent un d√©sir de r√©parer BootROM et de r√©essayer.  Mais il y a un probl√®me: BootROM fait partie de la conception charg√©e dans le FPGA, et sa synth√®se est une question de plusieurs minutes (et c'est apr√®s avoir compil√© presque instantan√©ment l'image BootROM elle-m√™me depuis C et Assembler ...).  Heureusement, en fait, tout est <strong>beaucoup plus rapide</strong> : la s√©quence d'actions est la suivante: </p><br><ul><li>  r√©g√©n√©rer bootrom.mif (je suis pass√© √† MIF au lieu de HEX, car avec HEX j'ai toujours eu quelques probl√®mes, et MIF est le format Alter natif) </li><li>  dans Quartus, dites <code>Processing -&gt; Update Memory Initialization File</code> </li><li>  sur Assembleur (dans la colonne de gauche de T√¢ches), recommencer la commande </li></ul><br><p>  Pour tout sur tout - quelques dizaines de secondes. </p><br><h2 id="podgotovka-sd-karty">  Pr√©paration de la carte SD </h2><br><p>  Tout est relativement simple ici, mais vous devez √™tre patient et disposer d'environ 14 Go d'espace disque: </p><br><pre> <code class="plaintext hljs">git clone https://github.com/sifive/freedom-u-sdk git submodule update --recursive --init make</code> </pre> <br><p>  Ensuite, vous devez ins√©rer une carte SD propre, ou plut√¥t, ne contenant rien dont vous avez besoin, et ex√©cuter </p><br><pre> <code class="plaintext hljs">sudo make DISK=/dev/sdX format-boot-loader</code> </pre> <br><p>  ... o√π <code>sdX</code> est le p√©riph√©rique affect√© √† la carte.  <strong>ATTENTION: les donn√©es de la carte seront supprim√©es, √©cras√©es et en g√©n√©ral!</strong>  Cela ne vaut gu√®re la peine de faire l'assembly entier sous <code>sudo</code> , car alors tous les artefacts d'assembly seront la propri√©t√© de <code>root</code> , et l'assemblage devra √™tre fait sous <code>sudo</code> temps. </p><br><p>  Le r√©sultat est une carte balis√©e en GPT avec quatre sections, dont l'une est FAT avec <code>uEnv.txt</code> et une image t√©l√©chargeable au format FIT (elle contient plusieurs sous-images, chacune avec sa propre adresse de t√©l√©chargement), l'autre section est vierge, elle est cens√©e √™tre format√©e en Ext4 pour Linux.  Deux autres sections sont <em>cryptiques</em> : U-Boot vit sur l'une (son d√©calage, si je comprends bien, est c√¢bl√© dans BootROM), sur l'autre, il semble que ses variables d'environnement vivent, mais je ne les utilise pas encore. </p><br><h2 id="uroven-pervyy-bootrom">  Niveau un, BootROM </h2><br><p>  La sagesse populaire dit: "Si dans la programmation il y a des danses avec un tambourin, alors dans l'√©lectronique - aussi avec un extincteur."  Ce n'est m√™me pas une fois que j'ai presque br√ªl√© la carte, d√©cidant que "Eh bien, GND est le m√™me bas niveau" <em>(apparemment, la r√©sistance ne ferait toujours pas de mal ...)</em> C'est plus sur le fait que si les mains ne poussent pas √† partir de l√†, puis l'√©lectronique ne cesse de surprendre: lorsque j'ai soud√© le connecteur sur la carte, je ne pouvais toujours pas dissoudre les contacts normalement - la vid√©o montre comment la soudure se propage directement tout au long de la connexion, il suffit de mettre le fer √† souder, c'est descendu sur moi de toute fa√ßon.  Eh bien, peut-√™tre que la soudure n'√©tait pas adapt√©e √† la temp√©rature du fer √† souder, peut-√™tre autre chose ... En g√©n√©ral, quand j'ai vu que j'avais d√©j√† une douzaine de contacts, j'ai crach√© et commenc√© √† d√©boguer.  Et puis une chose <em>myst√©rieuse a</em> commenc√©: j'ai connect√© RX / TX depuis UART, je charge le firmware - il √©crit </p><br><pre> <code class="plaintext hljs">INIT CMD0 ERROR</code> </pre> <br><p>  Eh bien, tout est logique - je n'ai pas connect√© le module de carte SD.  On corrige la situation, on charge le firmware ... Et le silence ... Ce que je viens de ne pas changer d'avis, et le coffret vient de s'ouvrir: une des sorties du module devait √™tre connect√©e au VCC.  Dans mon cas, le module prend en charge 5V pour l'alimentation, donc sans y r√©fl√©chir √† deux fois, j'ai coinc√© un fil qui s'√©tend du module vers le c√¥t√© oppos√© de la carte.  En cons√©quence, le connecteur soud√© de travers s'est tordu et le <strong>contact UART a simplement √©t√© perdu.</strong>  <em>facepalm.jpg</em> En g√©n√©ral, "une mauvaise t√™te ne donne pas de repos aux jambes", et des mains tordues - √† la t√™te ... </p><br><p>  Au final, j'ai vu le tant attendu chez Minicom </p><br><pre> <code class="plaintext hljs">INIT CMD0 CMD8 ACMD41 CMD58 CMD16 CMD18 LOADING /</code> </pre> <br><p>  De plus, <del>  √ßa bouge </del>  l'indicateur de chargement tourne.  Je me souviens directement des ann√©es scolaires et du d√©marrage tranquille de MinuetOS √† partir d'une disquette.  Sauf si le lecteur grince. </p><br><p>  Le probl√®me est que rien ne se passe apr√®s le message BOOT.  Il est donc temps de se connecter via OpenOCD sur Raspberry, GDB sur l'h√¥te et de voir ce que c'est. </p><br><p>  Premi√®rement, la connexion utilisant GDB a imm√©diatement montr√© que <code>$pc</code> (compteur de programme, adresse de l'instruction en cours) vole vers <code>0x0</code> - cela se produit probablement apr√®s une erreur multiple.  Par cons√©quent, imm√©diatement apr√®s l'√©mission du message <code>BOOT</code> , nous ajoutons une boucle infinie.  <em>Cela le retardera un court instant ...</em> </p><br><pre> <code class="diff hljs">diff --git a/bootrom/sdboot/sd.cb/bootrom/sdboot/sd.c index c6b5ede..bca1b7f 100644 --- a/bootrom/sdboot/sd.c +++ b/bootrom/sdboot/sd.c @@ -224,6 +224,8 @@ int main(void) kputs("BOOT"); + while(*(volatile char *)0x10000){} + __asm__ __volatile__ ("fence.i" : : : "memory"); return 0; }</code> </pre> <br><p>  Un code aussi d√©licat est utilis√© ¬´pour la fiabilit√©¬ª: j'ai entendu quelque part que, semble-t-il, une boucle infinie est un comportement ind√©fini, et ici le compilateur a peu de chances de deviner (je me souviens que BootROM est situ√© √† <code>0x10000</code> ). </p><br><p><img src="https://habrastorage.org/webt/wj/xw/a9/wjxwa9m9hqoghtvy79zsbysctr0.png" alt="Il y a un d√©bogueur, pas de source"></p><br><p>  Il semblerait, mais √† quoi d'autre s'attendre - un dur int√©gr√©, quel type de source est l√†.  Mais apr√®s tout, dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cet article, l'</a> auteur a d√©bogu√© le code ... Krex-fex-pex: </p><br><pre> <code class="plaintext hljs">(gdb) file builds/zeowaa-e115/sdboot.elf A program is being debugged already. Are you sure you want to change the file? (y or n) y Reading symbols from builds/zeowaa-e115/sdboot.elf...done.</code> </pre> <br><p><img src="https://habrastorage.org/webt/ya/08/zp/ya08zpufla55qz02j5fhwcoijy4.png" alt="Il y a des sources de codes!"></p><br><p>  Seulement, vous devez charger non pas le fichier MIF et non bin, mais la version originale au format ELF. </p><br><p>  Maintenant, avec la ni√®me tentative de deviner l'adresse o√π l'ex√©cution se poursuivra (c'est une autre raison pour laquelle le compilateur n'aurait pas d√ª deviner que la boucle est infinie).  L'√©quipe </p><br><pre> <code class="plaintext hljs">set variable $pc=0xADDR</code> </pre> <br><p>  vous permet de modifier la valeur du registre lors de vos d√©placements (dans ce cas, l'adresse de l'instruction en cours).  Avec son aide, vous pouvez modifier les valeurs enregistr√©es en m√©moire (et les registres mapp√©s en m√©moire). </p><br><p>  En fin de compte, je suis arriv√© √† la conclusion (je ne sais pas si c'est correct) que nous avons une ¬´image de carte SD du mauvais syst√®me¬ª, et nous devons aller non pas au tout d√©but des donn√©es t√©l√©charg√©es, mais √† <code>0x89800</code> octets plus loin: </p><br><pre> <code class="diff hljs">diff --git a/bootrom/sdboot/head.S b/bootrom/sdboot/head.S index 14fa740..2a6c944 100644 --- a/bootrom/sdboot/head.S +++ b/bootrom/sdboot/head.S @@ -13,7 +13,7 @@ _prog_start: smp_resume(s1, s2) csrr a0, mhartid la a1, dtb - li s1, PAYLOAD_DEST + li s1, (PAYLOAD_DEST + 0x89800) jr s1 .section .rodata</code> </pre> <br><p>  Peut-√™tre que cela √©tait √©galement affect√© par le fait que je n'avais pas de carte 4Gb inutile sous la main, je l'ai prise √† 2 Go et l'ai remplac√©e dans le Makefile par <code>DEMO_END=11718750</code> par <code>DEMO_END=3078900</code> (ne cherchez pas le sens dans une valeur sp√©cifique - elle n'existe pas, juste maintenant l'image est plac√©e √† la carte). </p><br><h2 id="uroven-vtoroy-u-boot">  Niveau deux, U-Boot </h2><br><p>  Maintenant, nous ¬´tombons¬ª encore, mais nous sommes d√©j√† √† l'adresse <code>0x0000000080089a84</code> .  Ici, je dois admettre: en fait, la pr√©sentation ne va pas ¬´avec tous les arr√™ts¬ª, mais est partiellement √©crite ¬´apr√®s¬ª, donc ici j'ai d√©j√† r√©ussi √† mettre le fichier dtb correct de notre SoC, ajustez la variable <code>CONFIG_SYS_TEXT_BASE=0x80089800</code> dans les <code>CONFIG_SYS_TEXT_BASE=0x80089800</code> <code>HiFive_U-Boot</code> (au lieu de <code>0x08000000</code> ) afin que l'adresse de t√©l√©chargement corresponde √† celle r√©elle.  T√©l√©chargez maintenant <del>  carte de niveau suivant </del>  une autre image: </p><br><pre> <code class="plaintext hljs">(gdb) file ../freedom-u-sdk/work/HiFive_U-Boot/u-boot (gdb) tui en</code> </pre> <br><p>  Et nous voyons: </p><br><pre> <code class="plaintext hljs"> ‚îÇ304 /* ‚îÇ ‚îÇ305 * trap entry ‚îÇ ‚îÇ306 */ ‚îÇ ‚îÇ307 trap_entry: ‚îÇ ‚îÇ308 addi sp, sp, -32*REGBYTES ‚îÇ &gt;‚îÇ309 SREG x1, 1*REGBYTES(sp) ‚îÇ ‚îÇ310 SREG x2, 2*REGBYTES(sp) ‚îÇ ‚îÇ311 SREG x3, 3*REGBYTES(sp) ‚îÇ</code> </pre> <br><p>  Et nous sautons entre les lignes 308 et 309. Et ce n'est pas surprenant, √©tant donn√© que <code>$sp</code> contient la valeur <code>0xfffffffe31cdc0a0</code> .  H√©las, il "s'enfuit" constamment en raison de la ligne 307. Par cons√©quent, nous allons essayer de d√©finir un point d'arr√™t sur <code>trap_entry</code> , puis basculer √† nouveau sur <code>0x80089800</code> (point d'entr√©e U-Boot), et nous esp√©rons qu'il ne n√©cessite pas le r√©glage correct des registres avant la transition ... Cela semble fonctionner: </p><br><pre> <code class="plaintext hljs">(gdb) b trap_entry Breakpoint 1 at 0x80089a80: file /hdd/trosinenko/fpga/freedom-u-sdk/HiFive_U-Boot/arch/riscv/cpu/HiFive/start.S, line 308. (gdb) set variable $pc=0x80089800 (gdb) c Continuing. Breakpoint 1, trap_entry () at /hdd/trosinenko/fpga/freedom-u-sdk/HiFive_U-Boot/arch/riscv/cpu/HiFive/start.S:308 (gdb) p/x $sp $4 = 0x81cf950</code> </pre> <br><p>  Pour ainsi dire, le pointeur de pile, disons carr√©ment: il pointe g√©n√©ralement au-del√† de la RAM (√† moins, bien s√ªr, que nous ayons encore la traduction d'adresse, mais esp√©rons une option simple). </p><br><p>  Essayons de remplacer le pointeur par <code>0x881cf950</code> .  En cons√©quence, nous arrivons au fait que <code>handle_trap</code> est appel√© et appel√©, tout en laissant dans <code>_exit_trap</code> avec l'argument <code>epc=2148315240</code> (en d√©cimal): </p><br><pre> <code class="plaintext hljs">(gdb) x/10i 2148315240 0x800cb068 &lt;strnlen+12&gt;: lbu a4,0(a5) 0x800cb06c &lt;strnlen+16&gt;: bnez a4,0x800cb078 &lt;strnlen+28&gt; 0x800cb070 &lt;strnlen+20&gt;: sub a0,a5,a0 0x800cb074 &lt;strnlen+24&gt;: ret 0x800cb078 &lt;strnlen+28&gt;: addi a5,a5,1 0x800cb07c &lt;strnlen+32&gt;: j 0x800cb064 &lt;strnlen+8&gt; 0x800cb080 &lt;strdup&gt;: addi sp,sp,-32 0x800cb084 &lt;strdup+4&gt;: sd s0,16(sp) 0x800cb088 &lt;strdup+8&gt;: sd ra,24(sp) 0x800cb08c &lt;strdup+12&gt;: li s0,0</code> </pre> <br><p>  Nous d√©finissons un point d'arr√™t sur <code>strnlen</code> , continuons et voyons: </p><br><pre> <code class="plaintext hljs">(gdb) bt #0 strnlen (s=s@entry=0x10060000 "", count=18446744073709551615) at lib/string.c:283 #1 0x00000000800cc14c in string (buf=buf@entry=0x881cbd4c "", end=end@entry=0x881cc15c "", s=0x10060000 "", field_width=&lt;optimized out&gt;, precision=&lt;optimized out&gt;, flags=&lt;optimized out&gt;) at lib/vsprintf.c:265 #2 0x00000000800cc63c in vsnprintf_internal (buf=buf@entry=0x881cbd38 "exception code: 5 , ", size=size@entry=1060, fmt=0x800d446e "s , epc %08x , ra %08lx\n", fmt@entry=0x800d4458 "exception code: %d , %s , epc %08x , ra %08lx\n", args=0x881cc1a0, args@entry=0x881cc188) at lib/vsprintf.c:619 #3 0x00000000800cca54 in vsnprintf (buf=buf@entry=0x881cbd38 "exception code: 5 , ", size=size@entry=1060, fmt=fmt@entry=0x800d4458 "exception code: %d , %s , epc %08x , ra %08lx\n", args=args@entry=0x881cc188) at lib/vsprintf.c:710 #4 0x00000000800cca68 in vscnprintf (buf=buf@entry=0x881cbd38 "exception code: 5 , ", size=size@entry=1060, fmt=fmt@entry=0x800d4458 "exception code: %d , %s , epc %08x , ra %08lx\n", args=args@entry=0x881cc188) at lib/vsprintf.c:717 #5 0x00000000800ccb50 in printf (fmt=fmt@entry=0x800d4458 "exception code: %d , %s , epc %08x , ra %08lx\n") at lib/vsprintf.c:792 #6 0x000000008008a9f0 in _exit_trap (regs=&lt;optimized out&gt;, epc=2148315240, code=&lt;optimized out&gt;) at arch/riscv/lib/interrupts.c:92 #7 handle_trap (mcause=&lt;optimized out&gt;, epc=&lt;optimized out&gt;, regs=&lt;optimized out&gt;) at arch/riscv/lib/interrupts.c:55 #8 0x0000000080089b10 in trap_entry () at /hdd/trosinenko/fpga/freedom-u-sdk/HiFive_U-Boot/arch/riscv/cpu/HiFive/start.S:343 Backtrace stopped: frame did not save the PC</code> </pre> <br><p>  Il semble que <code>_exit_trap</code> veuille fournir des informations de d√©bogage sur l'exception qui s'est produite, <em>mais il √©choue</em> .  Donc, quelque chose avec notre code source ne s'affiche plus.  <code>set directories ../freedom-u-sdk/HiFive_U-Boot/</code> Oh!  Maintenant affich√©! </p><br><p>  Eh bien, ex√©cutez-le √† nouveau et voyez sur la pile la cause du probl√®me d'origine √† l'origine de la premi√®re erreur ( <code>mcause == 5</code> ).  Si je comprends bien ce qui est √©crit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> √† la page 37, alors cette exception signifie <code>Load access fault</code> .  La raison, apparemment, est qu'ici </p><br><p>  <strong>arch / riscv / cpu / HiFive / start.S:</strong> </p><br><pre> <code class="plaintext hljs">call_board_init_f: li t0, -16 li t1, CONFIG_SYS_INIT_SP_ADDR and sp, t1, t0 /* force 16 byte alignment */ #ifdef CONFIG_DEBUG_UART jal debug_uart_init #endif call_board_init_f_0: mv a0, sp jal board_init_f_alloc_reserve mv sp, a0 jal board_init_f_init_reserve mv a0, zero /* a0 &lt;-- boot_flags = 0 */ la t5, board_init_f jr t5 /* jump to board_init_f() */</code> </pre><br><p>  <code>$sp</code> a la m√™me valeur incorrecte et une erreur se produit dans <code>board_init_f_init_reserve</code> .  Cela semble √™tre le coupable: une variable avec le nom explicite <code>CONFIG_SYS_INIT_SP_ADDR</code> .  Il est d√©fini dans le fichier <code>HiFive_U-Boot/include/configs/HiFive-U540.h</code> .  √Ä un moment donn√©, j'ai m√™me pens√©, ou peut-√™tre, enfin, terminer le chargeur de d√©marrage pour le processeur - peut-√™tre qu'il est plus facile de r√©parer l√©g√®rement le processeur?  Mais j'ai vu que cela ressemblait plus √† un artefact des param√®tres pas compl√®tement <code>#if 0</code> pour une configuration de m√©moire diff√©rente, et vous pouvez essayer de le faire: </p><br><pre> <code class="diff hljs">diff --git a/include/configs/HiFive-U540.hb/include/configs/HiFive-U540.h index ca89383..245542c 100644 --- a/include/configs/HiFive-U540.h +++ b/include/configs/HiFive-U540.h @@ -65,12 +65,9 @@ #define CONFIG_SYS_SDRAM_BASE PHYS_SDRAM_0 #endif #if 1 -/*#define CONFIG_NR_DRAM_BANKS 1*/ +#define CONFIG_NR_DRAM_BANKS 1 #define PHYS_SDRAM_0 0x80000000 /* SDRAM Bank #1 */ -#define PHYS_SDRAM_1 \ - (PHYS_SDRAM_0 + PHYS_SDRAM_0_SIZE) /* SDRAM Bank #2 */ -#define PHYS_SDRAM_0_SIZE 0x80000000 /* 2 GB */ -#define PHYS_SDRAM_1_SIZE 0x10000000 /* 256 MB */ +#define PHYS_SDRAM_0_SIZE 0x40000000 /* 1 GB */ #define CONFIG_SYS_SDRAM_BASE PHYS_SDRAM_0 #endif /* @@ -81,7 +78,7 @@ #define CONSOLE_ARG "console=ttyS0,115200\0" /* Init Stack Pointer */ -#define CONFIG_SYS_INIT_SP_ADDR (0x08000000 + 0x001D0000 - \ +#define CONFIG_SYS_INIT_SP_ADDR (0x80000000 + 0x001D0000 - \ GENERATED_GBL_DATA_SIZE) #define CONFIG_SYS_LOAD_ADDR 0xa0000000 /* partway up SDRAM */</code> </pre> <br><p>  √Ä un moment donn√©, la quantit√© <del>  b√©quilles </del>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les attaches technologiques ont</a> atteint un point critique.  Apr√®s un petit tourment, je suis venu √† la n√©cessit√© de faire le bon port sur ma carte.  Pour ce faire, vous devez copier et corriger un certain nombre de fichiers pour notre configuration. </p><br><div class="spoiler">  <b class="spoiler_title">Eh bien, environ, voici une petite table</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">trosinenko@trosinenko-pc:/hdd/trosinenko/fpga/freedom-u-sdk/HiFive_U-Boot$ git show --name-status commit 39cd67d59c16ac87b46b51ac1fb58f16f1eb1048 (HEAD -&gt; zeowaa-1gb) Author: Anatoly Trosinenko &lt;anatoly.trosinenko@gmail.com&gt; Date: Tue Jul 2 17:13:16 2019 +0300 Initial support for Zeowaa A-E115FB board M arch/riscv/Kconfig A arch/riscv/cpu/zeowaa-1gb/Makefile A arch/riscv/cpu/zeowaa-1gb/cpu.c A arch/riscv/cpu/zeowaa-1gb/start.S A arch/riscv/cpu/zeowaa-1gb/timer.c A arch/riscv/cpu/zeowaa-1gb/u-boot.lds M arch/riscv/dts/Makefile A arch/riscv/dts/zeowaa-1gb.dts A board/Zeowaa/zeowaa-1gb/Kconfig A board/Zeowaa/zeowaa-1gb/MAINTAINERS A board/Zeowaa/zeowaa-1gb/Makefile A board/Zeowaa/zeowaa-1gb/Zeowaa-A-E115FB.c A configs/zeowaa-1gb_defconfig A include/configs/zeowaa-1gb.h</code> </pre> <br><p>  Les d√©tails peuvent √™tre trouv√©s dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel</a> . </p></div></div><br><p>  Il s'est av√©r√© que sur cette carte SiFive, les registres de certains appareils ont des adresses diff√©rentes.  Il s'est √©galement av√©r√© que U-Boot est configur√© par le m√©canisme Kconfig, d√©j√† familier du noyau Linux - par exemple, vous pouvez commander <code>make menuconfig</code> , et vous verrez une interface de texte pratique avec des descriptions de param√®tres indiqu√©es dans <code>?</code>  etc.  En g√©n√©ral, apr√®s avoir masqu√© la description de la troisi√®me des descriptions de deux cartes, jetant toute reconfiguration de pathos PLL √† partir de l√† (apparemment, cela est en quelque sorte connect√© au contr√¥le PCIe de l'ordinateur h√¥te, mais ce n'est pas pr√©cis), j'ai obtenu un firmware, qui, si la m√©t√©o est bonne sur Mars Il m'a donn√© un message UART sur le hachage de validation √† partir duquel il a √©t√© collect√© et sur la quantit√© de DRAM dont je dispose (mais j'ai √©galement enregistr√© ces informations dans l'en-t√™te). </p><br><p>  Il est dommage qu'apr√®s cela, la carte cesse g√©n√©ralement de r√©pondre avec le processeur JTAG, et le d√©marrage √† partir de la carte SD n'est, h√©las, pas rapide dans ma configuration.  D'un autre c√¥t√©, BootROM affichait parfois un message indiquant que <code>ERROR</code> ne pouvait pas d√©marrer et U-Boot apparaissait imm√©diatement.  C'est alors qu'il m'est apparu: apparemment, apr√®s le red√©marrage du bitstream, la m√©moire n'est pas effiloch√©e dans le FPGA, elle n'a pas le temps de "se d√©chirer", etc.  En bref, vous pouvez simplement lorsque le message <code>LOADING /</code> appara√Æt, vous connecter avec un d√©bogueur et une <code>set variable $pc=0x80089800</code> commandes <code>set variable $pc=0x80089800</code> , contournant ainsi ce long t√©l√©chargement (bien s√ªr, en supposant qu'il s'est rompu pour la derni√®re fois assez t√¥t et n'a pas eu le temps en plus du code d'origine t√©l√©charger). </p><br><p>  Soit dit en passant, et il est g√©n√©ralement normal que le processeur se bloque compl√®tement et que le d√©bogueur JTAG avec des messages ne puisse pas s'y connecter </p><br><pre> <code class="plaintext hljs">Error: unable to halt hart 0 Error: dmcontrol=0x80000001 Error: dmstatus =0x00030c82</code> </pre> <br><p>  Alors attends!  Je l'ai d√©j√† vu! -     TileLink,      -   ‚Äî   ‚Ä¶ ,           : </p><br><pre> <code class="plaintext hljs">INIT CMD0 CMD8 ACMD41 CMD58 CMD16 CMD18 LOADING BOOT U-Boot 2018.09-g39cd67d-dirty (Jul 03 2019 - 13:50:33 +0300) DRAM: 1 GiB MMC: BEFORE LOAD ENVBEFORE FDTCONTROLADDRBEFORE LOADADDRIn: serial Out: serial Err: serial Hit any key to stop autoboot: 3</code> </pre> <br><p>      <code>In: serial</code>    ‚Äî       ,      environment.  , ¬´    ¬ª?          !  :  U-Boot      2^24   SD-, ,    <del>   </del>  ,      ,        ,   ELF-,    .  : ,       ,     . </p><br><p> ,    ? ,    -  ... </p><br><pre> <code class="plaintext hljs">(gdb) x/x 0x0200bff8 0x200bff8: 0x00000000</code> </pre> <br><p>  ,    ? </p><br><pre> <code class="plaintext hljs">(gdb) set variable *0x0200bff8=310000000 (gdb) c</code> </pre> <br><p> : </p><br><pre> <code class="plaintext hljs">Hit any key to stop autoboot: 0 MMC_SPI: 0 at 0:1 hz 20000000 mode 0</code> </pre> <br><p> :   . , -        : </p><br><p> <strong>HiFive_U-Boot/cmd/bootmenu.c:</strong> </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootmenu_loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct bootmenu_data *menu, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">enum</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bootmenu_key *key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *esc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!tstc()) { WATCHDOG_RESET(); mdelay(<span class="hljs-number"><span class="hljs-number">10</span></span>); } c = getc(); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (*esc) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* First char of ANSI escape sequence '\e' */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == <span class="hljs-string"><span class="hljs-string">'\e'</span></span>) { *esc = <span class="hljs-number"><span class="hljs-number">1</span></span>; *key = KEY_NONE; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* Second char of ANSI '[' */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == <span class="hljs-string"><span class="hljs-string">'['</span></span>) { ...</code> </pre> <br><p>  <abbr title="En fait non, du moins pas seulement dans ce domaine, voir plus loin">  </abbr> ,    :      : </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">DTSTimebase</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">BigInt</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><p> ‚Ä¶   ,      ¬´   ‚Äî  0¬ª.   <code>WithNBigCores</code>      1MHz (, ,      U-Boot).   , ,   :    ,  25MHz!     .   ¬´¬ª ... </p><br><pre> <code class="plaintext hljs">Hit any key to stop autoboot: 0 MMC_SPI: 0 at 0:1 hz 20000000 mode 0 ## Unknown partition table type 0 libfdt fdt_path_offset() returned FDT_ERR_NOTFOUND ** No partition table - mmc 0 ** ## Info: input data size = 34 = 0x22 Running uEnv.txt boot2... ## Error: "boot2" not defined HiFive-Unleashed #</code> </pre> <br><p>    ! ,  , , ,   <code>mmc_spi 1 10000000 0; mmc part</code> ,   SPI  20MHz  10MHz.  Pourquoi? ,       20MHz,      . ,   , ,    ,  :      (  ‚Äî  25MHz)  ,           .   ,    115200Hz UART-   ,  ,     25000000  20000000  1, ..     25MHz. ,   ,    , ,  -  (   )‚Ä¶  ,      ‚Äî  , , . 25MHz ‚Äî    Core i9. </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">HiFive-Unleashed # env edit mmcsetup edit: mmc_spi 1 10000000 0; mmc part HiFive-Unleashed # boot MMC_SPI: 1 at 0:1 hz 10000000 mode 0 Partition Map for MMC device 0 -- Partition Type: EFI Part Start LBA End LBA Name Attributes Type GUID Partition GUID 1 0x00000800 0x0000ffde "Vfat Boot" attrs: 0x0000000000000000 type: ebd0a0a2-b9e5-4433-87c0-68b6b72699c7 type: data guid: 76bd71fd-1694-4ff3-8197-bfa81699c2fb 2 0x00040800 0x002efaf4 "root" attrs: 0x0000000000000000 type: 0fc63daf-8483-4772-8e79-3d69d8477de4 type: linux guid: 9f3adcc5-440c-4772-b7b7-283124f38bf3 3 0x0000044c 0x000007e4 "uboot" attrs: 0x0000000000000000 type: 5b193300-fc78-40cd-8002-e86c45580b47 guid: bb349257-0694-4e0f-9932-c801b4d76fa3 4 0x00000400 0x0000044b "uboot-env" attrs: 0x0000000000000000 type: a09354ac-cd63-11e8-9aff-70b3d592f0fa guid: 4db442d0-2109-435f-b858-be69629e7dbf libfdt fdt_path_offset() returned FDT_ERR_NOTFOUND 2376 bytes read in 0 ms Running uEnv.txt boot2... 15332118 bytes read in 0 ms ## Loading kernel from FIT Image at 90000000 ... Using 'config-1' configuration Trying 'bbl' kernel subimage Description: BBL/SBI/riscv-pk Type: Kernel Image Compression: uncompressed Data Start: 0x900000d4 Data Size: 74266 Bytes = 72.5 KiB Architecture: RISC-V OS: Linux Load Address: 0x80000000 Entry Point: 0x80000000 Hash algo: sha256 Hash value: 28972571467c4ad0cf08a81d9cf92b9dffc5a7cb2e0cd12fdbb3216cf1f19cbd Verifying Hash Integrity ... sha256+ OK ## Loading fdt from FIT Image at 90000000 ... Using 'config-1' configuration Trying 'fdt' fdt subimage Description: unavailable Type: Flat Device Tree Compression: uncompressed Data Start: 0x90e9d31c Data Size: 6911 Bytes = 6.7 KiB Architecture: RISC-V Load Address: 0x81f00000 Hash algo: sha256 Hash value: 10b0244a5a9205357772ea1c4e135a4f882409262176d8c7191238cff65bb3a8 Verifying Hash Integrity ... sha256+ OK Loading fdt from 0x90e9d31c to 0x81f00000 Booting using the fdt blob at 0x81f00000 ## Loading loadables from FIT Image at 90000000 ... Trying 'kernel' loadables subimage Description: Linux kernel Type: Kernel Image Compression: uncompressed Data Start: 0x900123e8 Data Size: 10781356 Bytes = 10.3 MiB Architecture: RISC-V OS: Linux Load Address: 0x80200000 Entry Point: unavailable Hash algo: sha256 Hash value: 72a9847164f4efb2ac9bae736f86efe7e3772ab1f01ae275e427e2a5389c84f0 Verifying Hash Integrity ... sha256+ OK Loading loadables from 0x900123e8 to 0x80200000 ## Loading loadables from FIT Image at 90000000 ... Trying 'ramdisk' loadables subimage Description: buildroot initramfs Type: RAMDisk Image Compression: gzip compressed Data Start: 0x90a5a780 Data Size: 4467411 Bytes = 4.3 MiB Architecture: RISC-V OS: Linux Load Address: 0x82000000 Entry Point: unavailable Hash algo: sha256 Hash value: 883dfd33ca047e3ac10d5667ffdef7b8005cac58b95055c2c2beda44bec49bd0 Verifying Hash Integrity ... sha256+ OK Loading loadables from 0x90a5a780 to 0x82000000</code> </pre> </div></div><br><p> ,     ,     .      .  mcause ,      <code>$pc</code>   <code>si</code>   <code>trap_entry</code> .    U-Boot     mcause = 0..4,      .     ,  ,    ,  :    <code>conf/rvboot-fit.txt</code> : </p><br><pre> <code class="plaintext hljs">fitfile=image.fit # below much match what's in FIT (ugha)</code> </pre> <br><p>  ,     ,      ,   ,  <code>SIF0</code> ‚Äî  <abbr title="En fait non, comme il s'est av√©r√© ensuite"> -  PCIe</abbr> : </p><br><pre> <code class="diff hljs"><span class="hljs-deletion"><span class="hljs-deletion">-bootargs=console=ttySIF0,921600 debug +bootargs=console=ttyS0,125200 debug</span></span></code> </pre> <br><p>        SHA-256  MD5:     ( ,  ),    ,         MD5 ‚Äî  .  Quel est le r√©sultat?        (    ),   : </p><br><pre> <code class="plaintext hljs">... Verifying Hash Integrity ... md5+ OK Loading loadables from 0x90a5a758 to 0x82000000 libfdt fdt_check_header(): FDT_ERR_BADMAGIC chosen { linux,initrd-end = &lt;0x00000000 0x83000000&gt;; linux,initrd-start = &lt;0x00000000 0x82000000&gt;; riscv,kernel-end = &lt;0x00000000 0x80a00000&gt;; riscv,kernel-start = &lt;0x00000000 0x80200000&gt;; bootargs = "debug console=tty0 console=ttyS0,125200 root=/dev/mmcblk0p2 rootwait"; }; libfdt fdt_path_offset() returned FDT_ERR_NOTFOUND chosen { linux,initrd-end = &lt;0x00000000 0x83000000&gt;; linux,initrd-start = &lt;0x00000000 0x82000000&gt;; riscv,kernel-end = &lt;0x00000000 0x80a00000&gt;; riscv,kernel-start = &lt;0x00000000 0x80200000&gt;; bootargs = "debug console=tty0 console=ttyS0,125200 root=/dev/mmcblk0p2 rootwait"; }; Loading Kernel Image ... OK Booting kernel in 3</code> </pre> <br><p>     ... </p><br><pre> <code class="plaintext hljs">(gdb) x/x 0x0200bff8 0x200bff8: 0x00000000</code> </pre> <br><p> , ,     ,     ,  . , ,  ,         ,  : </p><br><pre> <code class="plaintext hljs">0x00000000bff6dbb0 in ?? () (gdb) set variable *0x0200bff8=1000000 (gdb) c Continuing. ^C Program received signal SIGINT, Interrupt. 0x00000000bff6dbb0 in ?? () (gdb) set variable *0x0200bff8=2000000 (gdb) c Continuing. ^C Program received signal SIGINT, Interrupt. 0x00000000bff6dbb0 in ?? () (gdb) set variable *0x0200bff8=3000000 (gdb) c Continuing.</code> </pre> <br><p>  ... </p><br><pre> <code class="plaintext hljs"> Loading Kernel Image ... OK Booting kernel in 3 2 1 0 ## Starting application at 0x80000000 ...</code> </pre> <br><p>  ,     ‚Äî  , ,     ! </p><br><p>        -  </p><br><pre> <code class="plaintext hljs">0000000080001c20 &lt;poweroff&gt;: 80001c20: 1141 addi sp,sp,-16 80001c22: e022 sd s0,0(sp) 80001c24: 842a mv s0,a0 80001c26: 00005517 auipc a0,0x5 80001c2a: 0ca50513 addi a0,a0,202 # 80006cf0 &lt;softfloat_countLeadingZeros8+0x558&gt; 80001c2e: e406 sd ra,8(sp) 80001c30: f7fff0ef jal ra,80001bae &lt;printm&gt; 80001c34: 8522 mv a0,s0 80001c36: 267000ef jal ra,8000269c &lt;finisher_exit&gt; 80001c3a: 00010797 auipc a5,0x10 80001c3e: 41e78793 addi a5,a5,1054 # 80012058 &lt;htif&gt; 80001c42: 639c ld a5,0(a5) 80001c44: c399 beqz a5,80001c4a &lt;poweroff+0x2a&gt; 80001c46: 72c000ef jal ra,80002372 &lt;htif_poweroff&gt; 80001c4a: 45a1 li a1,8 80001c4c: 4501 li a0,0 80001c4e: dc7ff0ef jal ra,80001a14 &lt;send_ipi_many&gt; 80001c52: 10500073 wfi 80001c56: bff5 j 80001c52 &lt;poweroff+0x32&gt;</code> </pre> <br><p>   Berkeley Boot Loader.       <code>htif</code> ‚Äî host interface,   tethered-  (      ARM), -  standalone. ,      ,  ,     : </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poweroff</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> code)</span></span></span><span class="hljs-function"> </span></span>{ printm(<span class="hljs-string"><span class="hljs-string">"Power off\r\n"</span></span>); finisher_exit(code); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (htif) { htif_poweroff(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { send_ipi_many(<span class="hljs-number"><span class="hljs-number">0</span></span>, IPI_HALT); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">asm</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">volatile</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"wfi\n"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; } } }</code> </pre> <br><h2 id="kvest-zapusti-chasy"> :   </h2><br><p>    CLINT    </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rtcTick = <span class="hljs-type"><span class="hljs-type">Bool</span></span>(<span class="hljs-type"><span class="hljs-type">INPUT</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> time = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, width = timeWidth)) when (io.rtcTick) { time := time + <span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) }</code> </pre> <br><p>    RTC,    MockAON,     : ¬´,     ? ? !¬ª      ,       ,       <code>System.scala</code> : </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rtcDivider = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//      16,   :) val mhzInt = p(DevKitFPGAFrequencyKey).toInt // ,      rtcDivider := Mux(rtcDivider === (mhzInt - 1).U, 0.U, rtcDivider + 1.U) outer.clintOpt.foreach { clint =&gt; clint.module.io.rtcTick := rtcDivider === 0.U }</span></span></code> </pre> <br><h2 id="probirayas-k-linux-kernel">   Linux kernel </h2><br><p>           ,    : </p><br><p> BBL   FDT   <code>0xF0000000</code> ,     !   ,  ‚Ä¶   <strong>HiFive_U-Boot/arch/riscv/lib/boot.c</strong> ,   <code>0x81F00000</code> ,     U-Boot. </p><br><p>  BBL ,   .      <code>mem_prop</code> ,   <strong>riscv-pk/machine/fdt.c</strong> :   ,     fdt ram  <code>device_type = "memory"</code> ‚Äî , ,     ,      ‚Äî       . </p><br><p>     (   ,   ): </p><br><pre> <code class="plaintext hljs">This is bbl's dummy_payload. To boot a real kernel, reconfigure bbl with the flag --with-payload=PATH, then rebuild bbl. Alternatively, bbl can be used in firmware-only mode by adding device-tree nodes for an external payload and use QEMU's -bios and -kernel options.</code> </pre> <br><p> ,      <code>riscv,kernel-start</code>  <code>riscv,kernel-end</code>  DTB,   .  <code>query_chosen</code> ,  BBL   32- ,     <code>&lt;0x0 0xADDR&gt;</code> ,   , ,  .    <code>chosen</code> </p><br><pre> <code class="plaintext hljs">chosen { #address-cells = &lt;1&gt;; #size-cells = &lt;0&gt;; ... }</code> </pre> <br><p>    : <abbr title="Mais il y a une meilleure solution">  <code>0x0</code>  </abbr> . </p><br><p>  100500       ,   : </p><br><div class="spoiler">  <b class="spoiler_title">Texte masqu√©</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> Verifying Hash Integrity ... md5+ OK Loading loadables from 0x90a5a758 to 0x82000000 libfdt fdt_check_header(): FDT_ERR_BADMAGIC chosen { linux,initrd-end = &lt;0x83000000&gt;; linux,initrd-start = &lt;0x82000000&gt;; riscv,kernel-end = &lt;0x80a00000&gt;; riscv,kernel-start = &lt;0x80200000&gt;; #address-cells = &lt;0x00000001&gt;; #size-cells = &lt;0x00000000&gt;; bootargs = "debug console=tty0 console=ttyS0,125200 root=/dev/mmcblk0p2 rootwait"; stdout-path = "uart0:38400n8"; }; libfdt fdt_path_offset() returned FDT_ERR_NOTFOUND chosen { linux,initrd-end = &lt;0x83000000&gt;; linux,initrd-start = &lt;0x82000000&gt;; riscv,kernel-end = &lt;0x80a00000&gt;; riscv,kernel-start = &lt;0x80200000&gt;; #address-cells = &lt;0x00000001&gt;; #size-cells = &lt;0x00000000&gt;; bootargs = "debug console=tty0 console=ttyS0,125200 root=/dev/mmcblk0p2 rootwait"; stdout-path = "uart0:38400n8"; }; Loading Kernel Image ... OK Booting kernel in 3 2 1 0 ## Starting application at 0x80000000 ... bbl loader SIFIVE, INC. 5555555555555555555555555 5555 5555 5555 5555 5555 5555 5555 5555555555555555555555 5555 555555555555555555555555 5555 5555 5555 5555 5555 5555 5555555555555555555555555555 55555 55555 555555555 55555 55555 55555 55555 55555 5 55555 55555 55555 55555 55555 55555 55555 55555 55555 55555 55555 555555555 55555 5 SiFive RISC-V Core IP [ 0.000000] OF: fdt: Ignoring memory range 0x80000000 - 0x80200000 [ 0.000000] Linux version 4.19.0-sifive-1+ (trosinenko@trosinenko-pc) (gcc version 8.3.0 (Buildroot 2019.02-07449-g4eddd28f99)) #1 SMP Wed Jul 3 21:29:21 MSK 2019 [ 0.000000] bootconsole [early0] enabled [ 0.000000] Initial ramdisk at: 0x(____ptrval____) (16777216 bytes) [ 0.000000] Zone ranges: [ 0.000000] DMA32 [mem 0x0000000080200000-0x00000000bfffffff] [ 0.000000] Normal [mem 0x00000000c0000000-0x00000bffffffffff] [ 0.000000] Movable zone start for each node [ 0.000000] Early memory node ranges [ 0.000000] node 0: [mem 0x0000000080200000-0x00000000bfffffff] [ 0.000000] Initmem setup node 0 [mem 0x0000000080200000-0x00000000bfffffff] [ 0.000000] On node 0 totalpages: 261632 [ 0.000000] DMA32 zone: 3577 pages used for memmap [ 0.000000] DMA32 zone: 0 pages reserved [ 0.000000] DMA32 zone: 261632 pages, LIFO batch:63 [ 0.000000] software IO TLB: mapped [mem 0xbb1fc000-0xbf1fc000] (64MB)</code> </pre> </div></div><br><p> (  BBL,       ‚Äî ). </p><br><p>  ,  ,  ,   RocketChip     JTAG   trap-   ‚Äî      . </p><br><pre> <code class="plaintext hljs">Program received signal SIGTRAP, Trace/breakpoint trap. 0xffffffe0000024ca in ?? () (gdb) bt #0 0xffffffe0000024ca in ?? () Backtrace stopped: previous frame identical to this frame (corrupt stack?) (gdb) file work/linux/vmlinux A program is being debugged already. Are you sure you want to change the file? (y or n) y Reading symbols from work/linux/vmlinux...done. (gdb) bt #0 0xffffffe0000024ca in setup_smp () at /hdd/trosinenko/fpga/freedom-u-sdk/linux/arch/riscv/kernel/smpboot.c:75 #1 0x0000000000000000 in ?? () Backtrace stopped: frame did not save the PC</code> </pre> <br><p> <strong>freedom-u-sdk/linux/arch/riscv/kernel/smpboot.c:</strong> </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __<span class="hljs-function"><span class="hljs-function">init </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup_smp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">device_node</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dn</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NULL</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hart; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> found_boot_cpu = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cpuid = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((dn = of_find_node_by_type(dn, <span class="hljs-string"><span class="hljs-string">"cpu"</span></span>))) { hart = riscv_of_processor_hartid(dn); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hart &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hart == cpuid_to_hartid_map(<span class="hljs-number"><span class="hljs-number">0</span></span>)) { BUG_ON(found_boot_cpu); found_boot_cpu = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } cpuid_to_hartid_map(cpuid) = hart; set_cpu_possible(cpuid, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); set_cpu_present(cpuid, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); cpuid++; } BUG_ON(!found_boot_cpu); <span class="hljs-comment"><span class="hljs-comment">// &lt;    }</span></span></code> </pre> <br><p>     , <em>CPU not found, running software emulation</em> .    running.     . </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* The lucky hart to first increment this variable will boot the other cores */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">atomic_t</span></span> hart_lottery; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> boot_cpu_hartid;</code> </pre> <br><p>    <strong>linux/arch/riscv/kernel/setup.c</strong> ‚Äî       .  ,   -  ,     ... </p><br><p>         . </p><br><p>  .       ,   ,      singlestep-. </p><br><p>    ( ): <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://asciinema.org/a/h22F5eCMXYF9n7n89CY6NJNEi.svg" alt="asciicast"></a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458482/">https://habr.com/ru/post/fr458482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458464/index.html">Liaison gigabit de 3 km sur des modems laser</a></li>
<li><a href="../fr458468/index.html">Comment organiser une impressionnante r√©union Kanban StandUp?</a></li>
<li><a href="../fr458470/index.html">Texturation, ou ce que vous devez savoir pour devenir un artiste de surface. Partie 2. Masques et textures</a></li>
<li><a href="../fr458472/index.html">Compilation d'une √©valuation des territoires par la m√©thode des potentiels thermiques √† l'aide de donn√©es ouvertes</a></li>
<li><a href="../fr458474/index.html">Meilleurs rapports avec HighLoad ++ 2018</a></li>
<li><a href="../fr458488/index.html">Data Science Digest (juillet 2019)</a></li>
<li><a href="../fr458490/index.html">Tenez fermement le volant ... Notre projet de surveillance de la condition des conducteurs</a></li>
<li><a href="../fr458492/index.html">¬´Nous avons toujours cru √† la concurrence et au droit de choisir un utilisateur¬ª ¬© Yandex</a></li>
<li><a href="../fr458494/index.html">Un exemple pratique d'utilisation des fonctions de rendu de Vue: cr√©ation d'une grille typographique pour un syst√®me de conception</a></li>
<li><a href="../fr458496/index.html">Lignes directrices pratiques pour le d√©veloppement d'applications React √† grande √©chelle. Planification, actions, sources de donn√©es et API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>