<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úîÔ∏è ‚úãüèΩ üòö ESET pr√©pare des logiciels espions InvisiMole depuis 2013 üë©üèø‚Äçü§ù‚Äçüë©üèæ ü§µüèΩ ü§û</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gardez une trace des victimes de haut rang en restant √† l'ombre. C'est le principe de fonctionnement de deux composants malveillants d'InvisiMole. Ils...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ESET pr√©pare des logiciels espions InvisiMole depuis 2013</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/414419/">  Gardez une trace des victimes de haut rang en restant √† l'ombre.  C'est le principe de fonctionnement de deux composants malveillants d'InvisiMole.  Ils transforment l'ordinateur infect√© en une cam√©ra vid√©o des attaquants, ce qui vous permet de voir et d'entendre tout ce qui se passe au bureau ou dans tout autre endroit o√π se trouve l'appareil.  Les op√©rateurs InvisiMole se connectent facilement au syst√®me, surveillent les actions de la victime et lui volent ses secrets. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qz/z_/0f/qzz_0fx62wvi_detfemzuckk0zs.jpeg"></div><br>  Selon la t√©l√©m√©trie ESET, les attaquants derri√®re ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">logiciel espion</a> sont actifs depuis au moins 2013.  Cependant, cet outil de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cyberespionnage</a> n'a pas seulement √©t√© √©tudi√©, mais n'a pas √©t√© d√©tect√© jusqu'√† ce qu'il soit d√©tect√© par les produits ESET sur des ordinateurs infect√©s en Russie et en Ukraine. <br><br>  La campagne est tr√®s cibl√©e, ce qui explique le faible niveau d'infection - seulement quelques dizaines d'ordinateurs. <br><a name="habracut"></a><br>  InvisiMole a une architecture modulaire, commence son voyage avec une DLL wrapper (DLL wrapper), puis deux modules sont int√©gr√©s √† ses ressources.  Les deux modules sont des portes d√©rob√©es multifonctionnelles, permettant au Malvari de collecter un maximum d'informations sur la cible. <br><br>  Pour d√©tourner l'attention de l'utilisateur de la machine infect√©e, des mesures suppl√©mentaires sont appliqu√©es.  Cela permet au programme malveillant de rester longtemps sur le syst√®me.  Nous n'avons pas encore √©tabli le vecteur de l'infection - actuellement, toutes les options sont possibles, y compris l'installation manuelle avec acc√®s physique √† la machine. <br><br><h3>  Installation et persistance </h3><br>  La premi√®re partie du malvari √† l'√©tude est un wrapper DLL compil√© √† l'aide du compilateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Free Pascal</a> .  Selon nos donn√©es de t√©l√©m√©trie, la DLL est plac√©e dans le dossier Windows et d√©guis√©e en un <code>mpr.dll</code> biblioth√®que <code>mpr.dll</code> l√©gitime avec de fausses informations de version. <br><br><img src="https://habrastorage.org/webt/63/po/le/63polemyrko5n7gdyrzmenhgeva.png"><br>  <i>Figure 1. Encapsuleur DLL d√©guis√© en fichier de biblioth√®que mpr.dll l√©gitime, copiant les informations de nom et de version</i> <br><br>  Nous n'avons pas vu d'exemples avec d'autres noms d'encapsuleur, bien que le code DLL indique que le fichier peut √©galement √™tre appel√© <code>fxsst.dll</code> ou <code>winmm.dll</code> . <br><br>  La premi√®re fa√ßon de lancer malvari est la technique de remplacement des DLL (d√©tournement de DLL).  L'encapsuleur DLL est plac√© dans le m√™me dossier que <code>explorer.exe</code> et charg√© au d√©marrage de Windows avec le processus de l'Explorateur Windows au lieu de la biblioth√®que l√©gitime situ√©e dans le <code>%windir%\system32</code> . <br><br>  Nous avons trouv√© des versions 32 et 64 bits de Malvari, qui assurent la persistance dans les deux architectures. <br><br>  Comme alternative √† l'usurpation de DLL, d'autres m√©thodes de chargement et de persistance sont possibles.  La DLL d'encapsuleur exporte la fonction <code>GetDataLength</code> .  Lors de l'appel de cette fonction, la DLL v√©rifie si elle a √©t√© charg√©e par le processus <code>rundll32.exe</code> en utilisant <code>explorer.exe</code> ou <code>svchost.exe</code> tant que processus parent, puis lance uniquement la charge utile.  Cela sugg√®re d'autres m√©thodes possibles pour assurer la persistance - ajouter des t√¢ches au planificateur (le processus parent est <code>svchost.exe</code> ) ou √©crire dans la cl√© d' <code>svchost.exe</code> automatique dans le registre (le processus parent est <code>explorer.exe</code> ). <br><br>  Quelle que soit la mani√®re dont la persistance est maintenue, le comportement du logiciel malveillant et de la charge utile elle-m√™me est le m√™me dans tous les cas.  L'encapsuleur DLL charge le module stock√© dans les ressources sous les noms <code>RC2FM</code> et <code>RC2CL</code> et (si la substitution DLL est utilis√©e) une biblioth√®que l√©gitime dans le processus <code>explorer.exe</code> afin de ne pas interrompre le fonctionnement normal de l'application et de passer inaper√ßu. <br><br><img src="https://habrastorage.org/webt/tf/-0/eh/tf-0ehnfccoxblcwcetgc7zcgq8.png"><br>  <i>Figure 2. Fonctions wrapper export√©es</i> <br><br><h2>  Analyse technique </h2><br>  La date exacte de la compilation du malware est inconnue - les derniers √©chantillons de wrapper DLL ont √©t√© modifi√©s par les auteurs, les horodatages PE ont √©t√© remis √† z√©ro manuellement.  Cependant, au cours de l'√©tude, nous avons trouv√© une version ant√©rieure dat√©e du 13 octobre 2013, afin que les nouvelles versions soient clairement compil√©es plus tard. <br><br><img src="https://habrastorage.org/webt/rg/ke/pn/rgkepn1sgdnddzbzmrfdij84cbu.png"><br>  <i>Figure 3. Dans tous les exemples ult√©rieurs, les horodatages sont d√©finis sur z√©ro</i> <br><br><h3>  Chiffrement et d√©chiffrement </h3><br>  Pour se d√©guiser des analystes de virus et des administrateurs syst√®me, les auteurs du programme malveillant utilisent le cryptage des cha√Ænes, des fichiers internes, des donn√©es de configuration et des communications r√©seau.  Alors que le module <code>RC2FM</code> utilise des chiffrements personnalis√©s, l'encapsuleur DLL et le module <code>RC2CL</code> utilisent une proc√©dure sp√©cifique √† toutes fins, y compris le d√©cryptage d'autres modules malveillants int√©gr√©s √† l'encapsuleur DLL. <br><br>  Le script avec lequel vous pouvez extraire les <code>RC2CL</code> <code>RC2FM</code> et <code>RC2CL</code> du wrapper DLL est disponible dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le r√©f√©rentiel ESET sur GitHub</a> . <br><br><img src="https://habrastorage.org/webt/wx/qz/dm/wxqzdmpwpxazkzgym0u3n-zghmw.png"><br>  <i>Figure 4. Proc√©dure de d√©cryptage dans divers exemples (d√©compil√©s et d√©sassembl√©s)</i> <br><br><h3>  Module RC2FM </h3><br>  Le premier module <code>RC2FM</code> , plus petit, contient une porte d√©rob√©e qui prend en charge 15 commandes.  Ils sont ex√©cut√©s sur l'ordinateur infect√© selon les instructions de l'attaquant.  Le module peut apporter diverses modifications au syst√®me, et comprend √©galement des outils de cyberespionnage. <br><br>  Les fichiers ont la possibilit√© de se connecter, mais le nom du journal syst√®me n'est pas sp√©cifi√© dans l'exemple.  Cela sugg√®re que la fonction n'a √©t√© utilis√©e qu'au stade de d√©veloppement. <br><br><h4>  Communication r√©seau </h4><br>  Ce module communique avec les serveurs C&amp;C, qui sont soit cod√©s en dur dans l'exemple, soit ajout√©s ult√©rieurement par des attaquants. <br><br>  De plus, le module peut acc√©der au serveur C&amp;C m√™me avec le proxy configur√© sur la machine infect√©e.  Si une connexion directe n'a pas pu √™tre √©tablie, le module tente de se connecter √† l'un de ses serveurs C&amp;C √† l'aide de proxys configur√©s localement ou de proxys configur√©s pour diff√©rents navigateurs (Firefox, Pale Moon et Opera). <br>  RC2FM peut m√™me v√©rifier la liste des applications r√©cemment utilis√©es et essayer de trouver des ex√©cutables de navigateur portables: <br><br>  FirefoxPortable.exe <br>  OperaPortable.exe <br>  Ex√©cutez waterfox.exe <br>  OperaAC.exe <br>  Palemoon-Portable.exe <br><br>  Si la victime utilise l'un de ces navigateurs portables <i>avec le serveur proxy configur√©</i> , le malware peut le d√©tecter dans les param√®tres utilisateur et l'utiliser pour communiquer avec ses serveurs C&amp;C. <br><br>  La communication avec le serveur C &amp; C est une s√©rie de demandes HTTP GET et POST, comme illustr√© dans la figure 5. La demande chiffr√©e contient l'ID du PC et l'horodatage, ainsi que d'autres informations (facultatif).  Il est important de noter que le module <code>RC2FM</code> utilise plusieurs m√©thodes de cryptage (variantes du cryptage XOR simple), contrairement aux autres composants InvisiMole. <br><br><img src="https://habrastorage.org/webt/ml/ev/kx/mlevkxds5qah0qvlkocfgxsfplk.png"><br>  <i>Figure 5. Exemple d'une demande envoy√©e √† un serveur C&amp;C par le module RC2FM</i> <br><br>  Apr√®s l'enregistrement r√©ussi de la victime sur le serveur C&amp;C, des informations suppl√©mentaires sont charg√©es dans le syst√®me, qui seront interpr√©t√©es par la commande de porte d√©rob√©e. <br><br><h4>  Fonctionnalit√© </h4><br>  <code>RC2FM</code> prend en charge des commandes pour r√©pertorier les informations de base du syst√®me et apporter des modifications simples au syst√®me, ainsi que plusieurs fonctionnalit√©s de logiciels espions.  √Ä la demande des attaquants, le module peut allumer le microphone √† distance sur un ordinateur compromis et enregistrer de l'audio.  L'enregistrement est cod√© au format MP3 √† l'aide de la biblioth√®que l√©gitime <code>lame.dll</code> , qui est t√©l√©charg√©e et utilis√©e par des logiciels malveillants. <br><br>  Un autre outil pour voler des donn√©es est des captures d'√©cran.  L'une des commandes de porte d√©rob√©e est con√ßue pour prendre des captures d'√©cran. <br><br>  Un programme malveillant surveille tous les disques internes et externes affich√©s sur le syst√®me local.  Lorsqu'un nouveau lecteur est connect√©, il cr√©e une liste avec tous les fichiers et le stocke sous forme crypt√©e. <br><br>  Les informations collect√©es seront transmises √† l'attaquant apr√®s l'envoi de la commande appropri√©e. <br><br><h4>  √âquipes de porte d√©rob√©e </h4><br>  Voici les ID et les descriptions des commandes prises en charge.  La visualisation de la fonction de porte d√©rob√©e dans l'interpr√©teur est illustr√©e √† la figure 6. <br><br>  0 - Faites des listes des disques affich√©s, des fichiers dans un dossier, des partages r√©seau <br>  2 - Cr√©er, d√©placer, renommer, ex√©cuter ou supprimer un fichier, supprimer un r√©pertoire en utilisant le chemin sp√©cifi√© <br>  4 - Ouvrez le fichier, placez le pointeur au d√©but du fichier <br>  5 - Fermer un fichier pr√©c√©demment ouvert <br>  6 - √âcrire des donn√©es dans un fichier pr√©c√©demment ouvert <br>  7 - Modifier les attributs de fichier de l'heure / supprimer le fichier <br>  8 - Ouvrez le fichier, placez le pointeur √† la fin du fichier <br>  10 - Modifier les attributs de fichier de l'heure / supprimer le fichier <br>  12 - Rechercher des fichiers par le masque de fichier sp√©cifi√© dans le r√©pertoire sp√©cifi√© <br>  13 - Prendre une capture d'√©cran <br>  14 - T√©l√©charger ou modifier des fichiers √† l'aide de donn√©es internes <br>  15 - Enregistrez du son √† l'aide d'appareils audio connect√©s, faites une liste des appareils disponibles, envoyez un enregistrement, modifiez la configuration <br>  16 - Rechercher les fichiers ouverts dans le module <br>  17 - Rafra√Æchir la liste des serveurs C&amp;C <br>  19 - Cr√©er, installer, copier, r√©pertorier ou supprimer des cl√©s ou des valeurs de registre sp√©cifi√©es <br><br><img src="https://habrastorage.org/webt/41/kf/7v/41kf7vzsczihmuttbyyjrbtcybe.png"><br>  <i>Figure 6. La fonction de porte d√©rob√©e dans l'interpr√©teur (d'origine et apr√®s notre analyse, modifi√©e √† l'aide de la fonction Group Nodes dans IDA Pro pour plus de lisibilit√©)</i> <br><br><h3>  Module RC2CL </h3><br>  Le module <code>RC2CL</code> est √©galement une porte d√©rob√©e avec une large gamme d'outils d'espionnage.  Il est lanc√© par un wrapper DLL en m√™me temps que le module <code>RC2FM</code> .  Il s'agit d'un module plus complexe, ses fonctions visent plus √† la collecte maximale d'informations qu'√† apporter des modifications au syst√®me. <br><br>  Fait int√©ressant, le module <code>RC2CL</code> a la possibilit√© de d√©sactiver la fonctionnalit√© de porte d√©rob√©e et de travailler en tant que proxy.  Dans ce cas, le malware arr√™te le pare-feu Windows et cr√©e un serveur qui prend en charge la communication entre le client et le serveur C&amp;C ou deux clients. <br><br><h4>  Communication r√©seau </h4><br>  Les logiciels malveillants communiquent avec les serveurs C&amp;C via un socket TCP.  Les messages envoy√©s par le client sont masqu√©s sous le protocole HTTP, mais vous devez faire attention √† la m√©thode HTTP non valide "HIDE" dans l'exemple de la figure 7. <br><br>  Les demandes contiennent l'identifiant du logiciel compromis, le type de demande et les informations chiffr√©es qui doivent √™tre envoy√©es par les attaquants, c'est-√†-dire le r√©sultat de l'ex√©cution de commandes de porte d√©rob√©e ou une demande de nouvelles instructions. <br><br><img src="https://habrastorage.org/webt/jf/og/gu/jfoggu3qvtsjumjvxt6etxex9mw.png"><br>  <i>Figure 7. Exemple de requ√™te envoy√©e au serveur de commandes par le module RC2CL</i> <br><br><h4>  Fonctionnalit√© </h4><br>  Selon la commande re√ßue, la porte d√©rob√©e peut effectuer diverses op√©rations sur le syst√®me infect√©.  Les portes d√©rob√©es r√©guli√®res effectuent des manipulations avec le syst√®me de fichiers et les cl√©s de registre, prennent en charge l'ex√©cution des fichiers et l'activation du shell √† distance.  Ce spivar prend en charge toutes ces √©quipes et plus encore - 84 √©quipes permettent aux attaquants de collecter des informations compl√®tes sur la victime. <br><br>  Un programme malveillant analyse un ordinateur infect√© et transf√®re diverses donn√©es aux attaquants: informations syst√®me (liste des processus actifs, services en cours d'ex√©cution, pilotes charg√©s ou disques disponibles), informations r√©seau (table d'adresses IP, vitesse de connexion Internet). <br><br>  InvisiMole peut analyser les r√©seaux sans fil disponibles sur un syst√®me compromis.  Spivar enregistre des informations telles que les adresses SSID et MAC des points d'acc√®s Wi-Fi d√©tect√©s.  Ces donn√©es peuvent ensuite √™tre v√©rifi√©es avec des bases de donn√©es publiques, ce qui permet aux attaquants de suivre la g√©olocalisation de la victime. <br><br>  D'autres commandes fournissent des informations sur les utilisateurs de la machine compromise, leurs comptes et les sessions pr√©c√©dentes. <br><br>  Le logiciel install√© sur une machine compromise pr√©sente un int√©r√™t particulier.  Quels programmes sont install√©s dans le syst√®me?  Lequel d'entre eux d√©marre automatiquement au d√©marrage du syst√®me ou lors de la connexion de l'utilisateur?  Quels programmes un utilisateur particulier utilise-t-il?  Si les attaquants sont int√©ress√©s par quelque chose, entrez simplement une commande pour obtenir les donn√©es n√©cessaires. <br><br>  Les logiciels malveillants peuvent obtenir une commande pour rechercher des documents r√©cemment ouverts et d'autres fichiers int√©ressants.  Il peut afficher des r√©pertoires sp√©cifiques et des p√©riph√©riques externes, signaler les modifications et extraire les fichiers s√©lectionn√©s par les attaquants. <br><br>  Les logiciels malveillants peuvent activer ou d√©sactiver le syst√®me de gestion de compte (UAC), ou le contourner et travailler avec des fichiers dans des r√©pertoires prot√©g√©s sans droits d'administrateur (plus sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> ).  Si le malware s'ex√©cute sous le processus <code>explorer.exe</code> , qui obtient automatiquement des droits √©lev√©s, il peut cr√©er un objet COM et l'utiliser pour supprimer et d√©placer des fichiers dans des zones qui n√©cessitent des droits d'administrateur. <br><br>  De plus, InvisiMole peut allumer √† distance la webcam et le microphone de la victime, espionner en prenant des photos ou en enregistrant du son.  Les attaquants peuvent surveiller l'activit√© sur l'appareil en prenant des captures d'√©cran.  Ce qui est particuli√®rement int√©ressant, InvisiMole vous permet de prendre des captures d'√©cran non seulement de tout l'√©cran, mais aussi de toutes les fen√™tres ouvertes.  Cela permet aux attaquants de collecter des informations m√™me lorsque les fen√™tres se ferment. <br><br>  L'une des commandes de porte d√©rob√©e vous permet de remplacer le contenu des pilotes par les noms suivants: <br><br> <code>blbdrive.sys <br> compbatt.sys <br> secdrv.sys</code> <br> <br>  Nous n'avons pas observ√© l'utilisation de cette commande par des attaquants, mais nous pouvons supposer qu'elle est utilis√©e pour fournir une persistance suppl√©mentaire sur les syst√®mes 32 bits. <br><br>  La porte d√©rob√©e est capable d'interf√©rer avec le syst√®me (par exemple, se connecter en tant qu'utilisateur, terminer le processus ou √©teindre le syst√®me), mais fournit principalement des op√©rations passives.  Le programme essaie de cacher son activit√© autant que possible. <br><br>  Ainsi, spivar explore des endroits int√©ressants du syst√®me, √©tudie les documents r√©cemment ouverts ou modifie certains fichiers.  Ces actions laissent des traces et peuvent causer des soup√ßons √† la victime, car apr√®s chaque op√©ration, l'heure de la derni√®re modification du fichier et / ou l'acc√®s √† celui-ci change.  Pour emp√™cher la d√©tection, le malware r√©cup√®re la date de la pr√©c√©dente modification ou ouverture du fichier pour cacher ses manipulations √† l'utilisateur. <br><br>  Un autre exemple de la fa√ßon dont les auteurs de spayvari essaient d'√©viter la d√©tection est de travailler avec des traces laiss√©es sur le disque.  Un programme malveillant collecte une grande quantit√© de donn√©es confidentielles qui sont stock√©es dans des fichiers pendant un certain temps et supprim√©es apr√®s un t√©l√©chargement r√©ussi sur les serveurs C&amp;C.  Le probl√®me est qu'un administrateur syst√®me exp√©riment√© peut r√©cup√©rer des fichiers supprim√©s, ce qui aidera √† enqu√™ter sur l'attaque apr√®s que la victime aura d√©couvert le compromis.  Cela est possible car certaines informations restent sur le disque m√™me apr√®s la suppression du fichier.  Pour √©viter cela, InvisiMole a la possibilit√© de supprimer en toute s√©curit√© tous les fichiers.  Cela signifie que les donn√©es sont d'abord √©cras√©es avec z√©ro ou des octets al√©atoires, et ce n'est qu'apr√®s que le fichier est supprim√©. <br><br><h4>  M√©moire int√©gr√©e </h4><br>  La configuration de la porte d√©rob√©e et les donn√©es collect√©es sont stock√©es √† deux adresses - il s'agit du r√©pertoire de travail et des cl√©s de registre.  Une partie importante des commandes de porte d√©rob√©e est con√ßue pour manipuler ces emplacements de stockage de donn√©es et leur contenu. <br><br>  L'emplacement du r√©pertoire de travail est d√©termin√© √† l'aide de commandes provenant d'un serveur distant.  Le r√©pertoire est utilis√© comme stockage temporaire de fichiers contenant des informations collect√©es √† partir d'un ordinateur compromis.  Ces fichiers ont une m√©thode de d√©nomination, un algorithme et une structure de chiffrement communs.  Ils sont crypt√©s avec une version simple du chiffrement XOR, qui est utilis√© dans les composants de malvari.  Le type de fichier peut √™tre obtenu √† partir de la s√©quence de contr√¥le de 4 octets situ√©e au d√©but du fichier. <br><br>  En plus de stocker les donn√©es collect√©es, le r√©pertoire est utilis√© comme r√©pertoire de base pour une copie de l'application WinRAR.exe l√©gitime.  Malvar le copie et l'utilise pour archiver des donn√©es vol√©es. <br><br>  Le registre stocke les donn√©es de configuration, ainsi qu'une liste de fichiers dans le r√©pertoire de travail.  Les donn√©es sont compress√©es en utilisant la proc√©dure Zlib impl√©ment√©e dans le fichier binaire malvari, et crypt√©es en utilisant le m√™me chiffre que les fichiers internes. <br><br><img src="https://habrastorage.org/webt/ih/al/gw/ihalgw7xzb35fahkfx9rcmr3_l0.png"><br><br><h4>  √âquipes de porte d√©rob√©e </h4><br>  Plus de quatre-vingts commandes de porte d√©rob√©e utilisent le r√©pertoire de travail et les cl√©s de registre pour stocker les r√©sultats interm√©diaires et les donn√©es de configuration.  Le graphique avec la porte d√©rob√©e dans l'interpr√©teur est illustr√© √† la figure 8. <br><br>  Environ un tiers de toutes les commandes concernent la lecture et la mise √† jour des donn√©es de configuration stock√©es dans le registre.  Les ID et descriptions des commandes restantes sont r√©pertori√©s ci-dessous. <br><br>  4 - Faites une liste des informations sur les fichiers dans le r√©pertoire <br>  6 - T√©l√©charger le fichier <br>  20 - Liste des processus actifs <br>  22 - Terminer le processus par ID <br>  24 - Ex√©cuter le fichier <br>  26 - Supprimer le fichier <br>  28 - Obtenir la table de transfert IP <br>  30 - √âcrire des donn√©es dans un fichier <br>  31 - L'inaction <br>  38 - Faire une liste de comptes <br>  40 - Faire une liste des services dans le syst√®me <br>  42 - Faites une liste des pilotes charg√©s <br>  43 - Collecte des informations syst√®me de base (nom de l'ordinateur, version du syst√®me d'exploitation, √©tat de la m√©moire, heure locale, informations sur le disque, informations sur les proxys configur√©s, politique actuelle de pr√©vention de l'ex√©cution des donn√©es pour le syst√®me et les processus, etc.) <br>  44 - Faire une liste des logiciels install√©s <br>  46 - Liste des utilisateurs locaux et des informations de session <br>  48 - Faire une liste des applications utilis√©es par les utilisateurs <br>  52 - Cr√©er une structure de r√©pertoires <br>  78 - Cr√©er un shell distant <br>  81 - Ex√©cutez la commande via le shell distant <br>  91 - Activer / d√©sactiver le contr√¥le des comptes d'utilisateurs <br>  93 - Session utilisateur final / arr√™t / red√©marrage du syst√®me <br>  101 - Suivre et enregistrer les modifications apport√©es aux r√©pertoires sp√©cifi√©s <br>  103 - Supprimer le r√©pertoire <br>  109 - Allumer / √©teindre le moniteur / activer la veille <br>  120 - Prendre une capture d'√©cran de la fen√™tre d'affichage / active <br>  126 - Prendre une capture d'√©cran de la fen√™tre d'affichage / active et mettre √† jour les donn√©es de configuration <br>  130 - Liste des informations sur les ressources sur les disques non allou√©s <br>  132 - Renommez / d√©placez le fichier, changez l'heure de cr√©ation / ouverture / √©criture du fichier en sp√©cifiant <br>  134 - Liste des fichiers r√©cemment ouverts <br>  152 - D√©connectez les disques amovibles (pr√©c√©demment connect√©s) <br>  155 - Cr√©er / supprimer une cl√© de registre, d√©finir / supprimer des valeurs de cl√© de registre ou r√©pertorier les valeurs / cl√©s / donn√©es de registre <br>  159, 161 - D√©sactiver le routage / pare-feu, cr√©er un serveur proxy sur un port sp√©cifique <br>  172 - R√©p√©tez la bo√Æte de dialogue demandant de red√©marrer l'ordinateur <br>  175 - Contourner le contr√¥le du compte utilisateur pour la manipulation de fichiers <br>  177 - Cr√©er et √©crire un fichier, d√©finir des donn√©es sur l'heure de cr√©ation / ouverture / modification <br>  181 - Supprimer tous les points de restauration du syst√®me <br>  183 - R√©initialiser le composant (l√©gitime) d'une application WinRAR <br>  185 - Ajouter des fichiers √† l'archive prot√©g√©e par mot de passe (mot de passe = "12KsNh92Dwd") <br>  187 - D√©chiffrer, d√©compresser et charger la DLL, charger les fichiers exe √† partir des ressources RC2CL, RC2FM <br>  189 - Cr√©er un point de restauration syst√®me <br>  191 - Extraire l'archive prot√©g√©e par mot de passe (12KsNh92Dwd) <br>  193 - Changer le fichier crypt√© <br>  195 - Red√©marrer apr√®s l'ach√®vement du processus principal <br>  197 - Envoyer 198 octets de donn√©es cod√©es en dur dans un mod√®le <br>  199 - Renommer / d√©placer un fichier <br>  206 - D√©chiffrer, d√©compresser et t√©l√©charger la DLL, charger les fichiers exe √† partir des ressources RC2CL, RC2FM <br>  211 - T√©l√©charger les informations collect√©es (captures d'√©cran, enregistrements audio, etc.) <br>  213 - Faire une liste des fen√™tres actives <br>  218 - API pour l'enregistrement audio √† partir de p√©riph√©riques d'entr√©e <br>  220 - API pour prendre des photos √† partir d'une webcam <br>  224 - Faire une liste des fichiers ex√©cut√©s √† chaque d√©marrage du syst√®me <br>  226 - Faites une liste des r√©seaux sans fil activ√©s (adresse MAC, SSID, intervalle de signalisation) <br>  228 - R√©initialiser le paquet Zlib compress√© <br><br><img src="https://habrastorage.org/webt/jf/og/gu/jfoggu3qvtsjumjvxt6etxex9mw.png"><br>  <i>Figure 8. La fonction de porte d√©rob√©e dans l'interpr√©teur (d'origine et modifi√©e √† l'aide de la fonction Group Nodes dans IDA Pro pour plus de lisibilit√©)</i> <br><br><h2>  Conclusion </h2><br>  InvisiMole est un logiciel espion complet qui offre des fonctionnalit√©s √©tendues qui peuvent rivaliser avec d'autres outils de cyber-espionnage bien connus. <br><br>  On ne peut que deviner pourquoi les auteurs utilisent deux modules avec des fonctions en double.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On pourrait supposer que le plus petit module, est </font></font><code>RC2FM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilis√© dans la premi√®re phase de reconnaissance, et le plus grand, </font></font><code>RC2CL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne fonctionne que sur des machines qui int√©ressent les op√©rateurs. </font><font style="vertical-align: inherit;">Mais ce n'est pas le cas - deux modules sont lanc√©s simultan√©ment. </font><font style="vertical-align: inherit;">Deuxi√®me explication possible: les modules sont assembl√©s par diff√©rents auteurs puis combin√©s pour fournir aux op√©rateurs un maximum d'outils. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InvisiMole utilise seulement quelques techniques pour √©viter la d√©tection et l'analyse. </font><font style="vertical-align: inherit;">Cependant, comme des logiciels espions ont √©t√© utilis√©s pour attaquer un petit nombre de cibles de haut rang, elle a r√©ussi √† √©viter la d√©tection pendant au moins cinq ans.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Indicateurs de compromis (IoC) </font></font></h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> D√©tection ESET </font></font></h3><br> <code>Win32/InvisiMole.A trojan <br> Win32/InvisiMole.B trojan <br> Win32/InvisiMole.C trojan <br> Win32/InvisiMole.D trojan <br> Win64/InvisiMole.B trojan <br> Win64/InvisiMole.C trojan <br> Win64/InvisiMole.D trojan</code> <br> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hachage SHA-1 </font></font></h3><br> <code>5EE6E0410052029EAFA10D1669AE3AA04B508BF9 <br> 2FCC87AB226F4A1CC713B13A12421468C82CD586 <br> B6BA65A48FFEB800C29822265190B8EAEA3935B1 <br> C8C4B6BCB4B583BA69663EC3AED8E1E01F310F9F <br> A5A20BC333F22FD89C34A532680173CBCD287FF8</code> <br> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Noms de domaine du serveur C&amp;C </font></font></h3><br> <code>activationstate.sytes[.]net <br> advstatecheck.sytes[.]net <br> akamai.sytes[.]net <br> statbfnl.sytes[.]net <br> updchecking.sytes[.]net</code> <br> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adresses IP des serveurs C&amp;C et p√©riode d'activit√© </font></font></h3><br> <code>2013-2014 - 46.165.231.85 <br> 2013-2014 - 213.239.220.41 <br> 2014-2017 - 46.165.241.129 <br> 2014-2016 - 46.165.241.153 <br> 2014-2018 - 78.46.35.74 <br> 2016-2016 - 95.215.111.109 <br> 2016-2018 - 185.118.66.163 <br> 2017-2017 - 185.118.67.233 <br> 2017-2018 - 185.156.173.92 <br> 2018-2018 - 46.165.230.241 <br> 2018-2018 - 194.187.249.157</code> <br> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cl√©s et valeurs de registre </font></font></h3><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RC2FM </font></font></h4><br> <code>[HKEY_CURRENT_USER\Software\Microsoft\IE\Cache] <br> "Index"</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RC2CL </font></font></h4><br> <code>[HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Console] <br> or [HKEY_CURRENT_USER\Software\Microsoft\Direct3D] <br> "Settings" <br> "Type" <br> [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\OLE] <br> or [HKEY_CURRENT_USER\Software\Microsoft\Direct3D] <br> "Common" <br> "Current" <br> "ENC" <br> "FFLT" <br> "Flag1" <br> "FlagLF" <br> "FlagLF2" <br> "IfData" <br> "INFO" <br> "InstallA" <br> "InstallB" <br> "LegacyImpersonationNumber" <br> "LM" <br> "MachineAccessStateData" <br> "MachineState 0" <br> "RPT" <br> "SP2" <br> "SP3" <br> "SettingsMC" <br> "SettingsSR1" <br> "SettingsSR2"</code> <br> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fichiers et dossiers </font></font></h3><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RC2FM </font></font></h4><br> <code>%APPDATA%\Microsoft\Internet Explorer\Cache\AMB6HER8\ <br> %volumeSerialNumber%.dat <br> content.dat <br> cache.dat <br> index.dat <br> %APPDATA%\Microsoft\Internet Explorer\Cache\MX0ROSB1\ <br> content.dat <br> index.dat <br> %random%.%ext% <br> %APPDATA%\Microsoft\Internet Explorer\Cache\index0.dat</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RC2CL </font></font></h4><br> <code>Winrar\ <br> comment.txt <br> descript.ion <br> Default.SFX <br> WinRAR.exe <br> main.ico <br> fl_%timestamp%\strcn%num%\ <br> fdata.dat <br> index.dat <br> ~mrc_%random%.tmp <br> ~src_%random%.tmp <br> ~wbc_%random%.tmp <br> sc\~sc%random%.tmp <br> ~zlp\zdf_%random%.data <br> ~lcf\tfl_%random%</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414419/">https://habr.com/ru/post/fr414419/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414405/index.html">Installer le certificat sur le serveur HTTP Apache</a></li>
<li><a href="../fr414411/index.html">Wiren Board 6: de nouveau sur Habr√© avec la nouvelle version du contr√¥leur d'automatisation</a></li>
<li><a href="../fr414413/index.html">Synopsis et vid√©o de l'histoire du r√©seautage dans l'industrie du jeu avec le gamedev du festival</a></li>
<li><a href="../fr414415/index.html">Conf√©rence Tarantool 21 juin - non seulement sur Tarantool, mais en g√©n√©ral sur l'informatique en m√©moire</a></li>
<li><a href="../fr414417/index.html">√âv√©nements num√©riques √† Moscou du 18 au 24 juin</a></li>
<li><a href="../fr414423/index.html">Ce jour-l√†, nous nous sommes rapproch√©s le plus possible ... Une nouvelle version de SBM 11.4 est sortie</a></li>
<li><a href="../fr414425/index.html">Algorithme de reconnaissance de mod√®le d'apprentissage √† un coup</a></li>
<li><a href="../fr414427/index.html">Que peut faire une imprimante 3D? Rapport de l'exposition Maker Faire Bay Area 2018</a></li>
<li><a href="../fr414429/index.html">Comment apprendre une langue √©trang√®re sans professeur. Partie 1. ¬´Mon exp√©rience¬ª</a></li>
<li><a href="../fr414431/index.html">Mitap JavaJam. D√©bat Javista, rafting, exp√©riences et microservices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>