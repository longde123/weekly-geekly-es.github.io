<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺 🧔🏾 🖖🏾 Template khusus di GTM: contoh 🤴🏿 🎵 📓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada akhir Mei, Google memperkenalkan fitur baru di Google Tag Manager (GTM): Template Kustom atau template khusus. Mari kita lihat mengapa diperlukan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Template khusus di GTM: contoh</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458788/">  Pada akhir Mei, Google memperkenalkan fitur baru di Google Tag Manager (GTM): Template Kustom atau template khusus.  Mari kita lihat mengapa diperlukan, bagaimana cara menggunakannya, apa perbedaan dari tag HTML dan variabel JavaScript. <br><br>  Sebagai contoh, pertimbangkan untuk membuat Template Kustom untuk penargetan ulang piksel dinamis VKontakte dan selanjutnya menyesuaikan tag GTM melaluinya. <br><br><img src="https://habrastorage.org/webt/c-/62/zr/c-62zrfxks1t6c2gfsv0kn2brjm.png"><br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kata-kata Sederhana Tentang Template Kustom</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Membuat Template Kustom</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">• Tab Info</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">• tab Bidang</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">• tab Kode</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">• tab Izin</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kustomisasi dan pengujian tag pada Template Kustom yang dibuat</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">• Tampilan halaman</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">• AddToCart</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">• Uji penambangan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kesimpulan</a> <br><br><a name="1"></a><h2>  Kata-kata Sederhana Tentang Template Kustom </h2><br>  Template Kustom adalah template yang digunakan pengguna untuk membuat tag atau variabel baru.  GTM memiliki template yang sudah jadi (di bagian Featured atau Recommended), misalnya, tag Google Analytics, Google Optimize, dan lainnya.  Sekarang kita bisa melengkapinya dengan templat kita.  Setelah dibuat, mereka akan muncul di tab Kustom: <br><br><img src="https://habrastorage.org/webt/nx/q_/mu/nxq_mu_uxl6tyiumnl8xbzt6o2c.png"><br><br>  Perbedaan utama dari tag HTML dan variabel JS adalah bahwa ketika pengguna membuat tag atau variabel sesuai dengan templat yang sudah jadi, ia tidak berinteraksi dengan kode JS. <br><br>  Kode untuk templat pengguna ditulis oleh pengembang atau analis web pada tahap pembuatannya.  Kemudian, saat membuat tag atau variabel sesuai dengan templat pengguna, semua interaksi dilakukan melalui antarmuka (yang juga dikonfigurasi saat membuat templat pengguna): <br><br><img src="https://habrastorage.org/webt/pe/e2/te/pee2tevqbahm_nplbfgj0btis34.png"><br><br>  Karenanya, dibandingkan dengan menulis tag HTML atau variabel JS, menyesuaikan tag atau variabel sesuai templat pengguna menjadi lebih mudah, karena ini tidak memerlukan pengetahuan dan keterampilan dalam bekerja dengan JavaScript. <br><br>  Kelebihan besar templat kustom lainnya adalah kemungkinan "menempatkan" situs dikurangi oleh urutan besarnya karena kesalahan dalam kode JS tag. <br><br>  Dalam contoh kami, untuk mengonfigurasi tag penargetan ulang dinamis "VKontakte" Anda tidak perlu lagi menghubungi pengembang - semuanya dapat diatur secara independen, bahkan transfer data tentang barang (dengan Google e-commerce lanjutan yang dikonfigurasikan di situs), hanya memiliki pengalaman dengan GTM. <br><br><a name="2"></a><h2>  Membuat Template Kustom </h2><br>  Karena kita membuat tag templat, kita perlu pergi ke bagian Templat dan klik tombol Baru di bagian Templat Tag. <br><br><img src="https://habrastorage.org/webt/ca/bt/sa/cabtsaamxy-zoglccqgvt1v_tra.png"><br><br>  Setelah itu, Editor Template terbuka: <br><br><img src="https://habrastorage.org/webt/bf/c3/jf/bfc3jf2xgpkasmc3qvik2tp4wxy.png"><br><br>  Di sisi kiri editor ada jendela pengaturan, di sisi kanan ada jendela pratinjau dan konsol.  Ada empat tab di jendela pengaturan yang diperlukan untuk membuat dan bekerja dengan templat. <br><br><a name="3"></a><h3>  Tab info </h3><br>  Informasi pada tag diisi pada tab ini: nama, deskripsi, ikon.  Ini adalah informasi yang akan kita lihat ketika membuat tag baru di daftar template: <br><br><img src="https://habrastorage.org/webt/dd/nm/9f/ddnm9fvcygh2ob6jzkliccqgi1o.png"><br><br>  Ada persyaratan untuk ikon tag: format PNG, JPEG atau GIF, resolusi minimal 64x64 piksel dan ukuran tidak lebih dari 50 KB. <br><br><a name="4"></a><h3>  Fields Tab </h3><br>  Bagian ini menciptakan antarmuka templat kami.  Antarmuka terdiri dari berbagai bidang dan bentuk yang digunakan pengguna untuk berinteraksi pada tahap pembuatan tag atau variabel baru. <br><br>  Di masa depan, informasi yang dimasukkan pengguna saat membuat tag menggunakan antarmuka digunakan dalam kode templat. <br><br>  Untuk menambahkan elemen baru, klik tombol Tambah Bidang.  Jendela untuk memilih jenis elemen muncul: <br><br><img src="https://habrastorage.org/webt/g5/ko/d7/g5kod7ox7dal761180kpdfhojto.png"><br><br>  GTM memungkinkan Anda memilih jenis elemen antarmuka berikut: <br><br><ul><li>  <b>kotak teks</b> </li><li>  <b>menu tarik-turun</b> </li><li>  <b>kotak centang</b> ; </li><li>  <b>sakelar</b> </li><li>  <b>tabel sederhana</b> , di sini Anda dapat mengedit setiap sel. </li><li>  <b>tabel diperpanjang</b> , Anda hanya dapat mengedit baris, jenis tabel ini nyaman digunakan untuk membuat kamus dari pasangan nilai kunci; </li><li>  <b>grup elemen</b> , memungkinkan Anda untuk mengelompokkan beberapa jenis menjadi grup; </li><li>  <b>pintasan</b> digunakan untuk menambahkan teks ke antarmuka, itu tidak mengharuskan pengguna untuk memasukkan data apa pun. </li></ul><br>  Setelah menambahkan elemen, Anda harus memberikannya nama yang ramah, yang kemudian akan digunakan dalam kode.  Ini adalah semacam nama variabel - itu harus dapat dimengerti dan mengungkapkan esensi dari elemen antarmuka yang dibuat.  Misalnya, nama "ID" tidak berarti sesuatu yang spesifik, tetapi nama "pixelIDs" sudah menunjukkan bahwa ID piksel yang dimasukkan oleh pengguna disimpan dalam elemen ini: <br><br><img src="https://habrastorage.org/webt/fv/1h/ht/fv1hht_iaatbuhi1ejovajkehhc.png"><br><br>  Selanjutnya, buka pengaturan masing-masing elemen dan aktifkan properti yang diperlukan. <br>  Dalam situasi yang berbeda, properti yang berbeda dari elemen antarmuka diperlukan, jadi secara default semuanya tersembunyi dan kita perlu mengaktifkan yang diperlukan sekarang: <br><br><img src="https://habrastorage.org/webt/ah/jx/o1/ahjxo1oz0w8fp6pntytshfs1y_o.png"><br><br>  Untuk berbagai jenis elemen, properti yang tersedia berbeda, saya akan menunjukkan yang paling sering digunakan, yang hampir semua elemen: <br><br>  <b>1. Nama tampilan</b> .  Ini adalah nama yang akan dilihat pengguna di antarmuka saat membuat tag: <br><br><img src="https://habrastorage.org/webt/jf/lk/-g/jflk-glzt0dahft6vpdx9qrzy8q.png"><br><br>  <b>2. Nilai contoh</b> .  Ini adalah petunjuk kepada pengguna tentang nilai apa yang harus dimasukkan di bidang: <br><br><img src="https://habrastorage.org/webt/b6/zz/sc/b6zzscielm1pjho74x22rk88c0c.png"><br><br>  <b>3. Teks bantuan</b> .  Ini adalah teks yang akan dilihat pengguna jika mereka mengarahkan kursor ke ikon bantuan elemen: <br><br><img src="https://habrastorage.org/webt/nv/wo/qr/nvwoqraide7hp-qrbdjaomwvg3e.png"><br><br>  <b>4. Aturan untuk verifikasi data</b> .  Di properti ini, Anda bisa menetapkan aturan tertentu untuk memeriksa data yang dimasukkan oleh pengguna di bidang, dan jika perlu, teks kesalahan yang muncul saat Anda mencoba menyimpan tag dengan data yang tidak lulus tes. <br><br>  Misalnya, Anda dapat menentukan bahwa bidang tersebut harus diisi.  Contoh kedua: Anda perlu mendapatkan alamat email dari pengguna, maka Anda dapat memverifikasi bahwa data yang dimasukkan oleh pengguna harus sesuai dengan ekspresi reguler <b>. * @. * * .. *</b> . <br><br><img src="https://habrastorage.org/webt/3s/ma/pb/3smapbl1aorsc4fsvhwpd-1oy4m.png"><br><br>  Untuk menentukan teks kesalahan yang muncul jika data yang dimasukkan tidak mematuhi aturan verifikasi, Anda harus mengaktifkan pengaturan aturan lanjutan: <br><br><img src="https://habrastorage.org/webt/kb/zw/qr/kbzwqr32irigkreu9bbht9fxf1m.png"><br><br><img src="https://habrastorage.org/webt/ek/xh/hg/ekxhhgobsta59wpr6uxsbaqzdwg.png"><br><br>  Selain itu, dalam pengaturan lanjutan, Anda dapat menentukan kondisi di mana aturan ini diaktifkan (bidang Aktifkan Kondisi). <br><br>  <b>5. Ketentuan pencantuman</b> .  Ini adalah kondisi di mana pengguna akan memiliki elemen antarmuka ini. <br><br>  Misalnya, agar tidak membebani template dengan elemen antarmuka, Anda dapat membuat tampilan elemen yang diperlukan ketika kotak centang dipilih.  Yaitu, anggaplah jika pengguna ingin mengonfigurasi transfer data produk dalam piksel (ini dimungkinkan dengan situs e-commerce Google lanjutan yang dikonfigurasikan di situs), lalu ia memilih kotak centang "Gunakan dataLayer untuk mentransfer data produk", dan setelah memeriksa kotak itu, elemen muncul di antarmuka tag diperlukan untuk mengkonfigurasi transfer semacam itu.  Jika kotak tidak dicentang, maka tidak ada elemen di antarmuka. <br><br><img src="https://habrastorage.org/webt/rp/ui/x_/rpuix__y-ya--_uat8taekcwpa0.png"><br><br>  Saya perhatikan bahwa di sini perlu untuk menunjukkan nama elemen, yang harus ditugaskan kepadanya segera setelah menambahkan. <br><br>  Saat Anda menambahkan pengaturan dan membuat antarmuka, semua perubahan dapat segera dilihat dan diuji di jendela pratinjau: <br><br><img src="https://habrastorage.org/webt/df/bl/l9/dfbll9mc0qvpwcxnbzzx-fbg71g.png"><br><br><a name="5"></a><h3>  Tab Kode </h3><br>  Tab ini adalah editor kode. <br><br>  Kode Template Kustom GTM ditulis dalam striped down JavaScript ES6 dan berjalan di lingkungan yang terisolasi di mana semua komunikasi dengan data global (yaitu, langsung dengan halaman) dilakukan melalui API.  Tidak ada objek global, seperti jendela atau dokumen, di dalamnya, masing-masing, metode biasa juga.  Misalnya, konstruktor (Objek baru dan sejenisnya), setTimeout, parseInt, hapus, dll.  - semua ini tidak akan berfungsi di Template Khusus. <br><br>  Tetapi ada API untuk semua ini.  Dan oleh karena itu, penulisan kode untuk Templat Kustom harus dimulai dengan fakta bahwa kami mendefinisikan API yang akan kami gunakan dalam kode kami: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// API //     const copyFromWindow = require('copyFromWindow'); //     const setInWindow = require('setInWindow'); //      const injectScript = require('injectScript'); //    const callInWindow = require('callInWindow'); //  ,     ,    const makeTableMap = require('makeTableMap'); //   URL  const getUrl = require('getUrl'); //    const getQueryParameters = require('getQueryParameters'); //     const makeInteger = require('makeInteger'); //    const makeString = require('makeString'); //  setTimeout const callLater = require('callLater'); //  console.log const logToConsole = require('logToConsole');</span></span></code> </pre> <br>  Lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bantuan Pengembang Google untuk</a> daftar lengkap API dengan dokumentasi terperinci. <br><br>  Saya akan menunjukkan kepada Anda contoh cara bekerja dengan API: <br><div class="scrollable-table"><table><tbody><tr><th>  Deskripsi tindakan </th><th>  Js klasik </th><th>  API Template Kustom </th></tr><tr><td>  Output Konsol </td><td>  console.log ('Hai'); </td><td>  logToConsole ('Hai'); </td></tr><tr><td>  Atur timer </td><td>  setTimeout (fungsi, 100); </td><td>  callLater (fungsi); </td></tr><tr><td>  Konversi ke string </td><td>  String (1234); </td><td>  makeString (1234); </td></tr><tr><td>  Konversi ke integer </td><td>  parseInt ('1234', 10); </td><td>  makeInteger ('1234'); </td></tr><tr><td>  Host halaman </td><td>  window.location.hostname </td><td>  getUrl ('host'); </td></tr></tbody></table></div><br>  Seperti yang dapat Anda lihat dari tabel contoh, setelah mendefinisikan API, Anda harus menggunakannya daripada konstruksi JS standar. <br><br>  Setelah kami mendefinisikan API, diinginkan untuk mendefinisikan objek dengan pengaturan yang dimasukkan pengguna.  Ini juga dapat dilakukan setelah, misalnya, selama kode yang dapat dieksekusi, meminta data yang diperlukan dari pengaturan pengguna.  Tetapi jika kita mendefinisikan objek pengaturan dari awal, maka bekerja dengan kode menjadi lebih mudah dan lebih dimengerti, karena semua pengaturan pengguna disimpan dalam objek yang terpisah. <br><br>  Untuk mendapatkan data dari elemen antarmuka, Anda harus menggunakan konstruk data. <br><br>  {{nama elemen}}: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    const settings = { //  event: data.event, //ID  () pixelIDs: data.pixelIDs, //ID - (  1 -) priceListId: data.priceListId, //   -? fewPriceLists: data.fewPriceLists, //ID - (    ) priceListIds: data.priceListIds === undefined ? data.priceListIds : makeTableMap(data.priceListIds,'hostname','priceListId'), //  ecommerce   ? ecommerceUse: data.ecommerceUse, // ecommerce   eventEcommerce: data.eventEcommerce, //     siteSearchQueryParam: data.siteSearchQueryParam };</span></span></code> </pre><br>  Catatan: jika Anda meneruskan undefined ke metode makeTableMap, itu akan menyebabkan kesalahan skrip, jadi saya menggunakan konstruk dengan operator ternary (disingkat if-else construct) untuk menyaring skrip tersebut. <br><br><div class="spoiler">  <b class="spoiler_title">Tentang metode makeTableMap.</b> <div class="spoiler_text">  Jika antarmuka menggunakan tabel yang diperluas, maka data di dalamnya disimpan dalam bentuk ini: <br><br><pre> <code class="javascript hljs">[ <span class="hljs-string"><span class="hljs-string">'key'</span></span>: <span class="hljs-string"><span class="hljs-string">'k1'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'v1'</span></span>}, <span class="hljs-string"><span class="hljs-string">'key'</span></span>: <span class="hljs-string"><span class="hljs-string">'k2'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'v2'</span></span>} ]</code> </pre><br>  Setelah diproses dengan metode makeTableMap, data menjadi objek biasa dengan pasangan nilai kunci: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">'k1'</span></span>: <span class="hljs-string"><span class="hljs-string">'v1'</span></span>, <span class="hljs-string"><span class="hljs-string">'k2'</span></span>: <span class="hljs-string"><span class="hljs-string">'v2'</span></span> }</code> </pre><br></div></div><br>  Persyaratan lain untuk kode Templat Kustom: jika tag berhasil dijalankan, Anda harus memanggil metode data.gtmOnSuccess (), dan jika terjadi kesalahan, panggil metode data.gtmOnFailure (). <br><br>  Misalnya, dalam kode saya, metode data.gtmOnSuccess () dipanggil setelah permintaan berhasil dikirim, dan metode data.gtmOnFailure () dipanggil jika unduhan gagal pada halaman skrip eksternal VK openapi.js. <br><br>  Setelah mendefinisikan API dan mendefinisikan objek dengan pengaturan, Anda dapat mulai menulis algoritme untuk mengetahui pikselnya. <br><br>  Hal utama yang perlu diingat di sini adalah: <br><br>  • Jika Anda perlu mendapatkan variabel global - gunakan metode copyFromWindow API. <br><br><pre> <code class="javascript hljs">copyFromWindow(<span class="hljs-string"><span class="hljs-string">'VK'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//VK -   ,    </span></span></code> </pre><br>  • Jika Anda perlu mengatur variabel global, kami menggunakan metode API setInWindow. <br><br><pre> <code class="javascript hljs">setInWindow(<span class="hljs-string"><span class="hljs-string">'openapiInject'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//openapiInject -   ,    //1 - ,    .</span></span></code> </pre><br>  • Jika Anda perlu menjalankan fungsi global, kami menggunakan metode API panggilanInWindow. <br><br><pre> <code class="javascript hljs">callInWindow(<span class="hljs-string"><span class="hljs-string">'VK.Retargeting.Init'</span></span>, p); <span class="hljs-comment"><span class="hljs-comment">//VK.Retargeting.Init -   ,    //p - ,     </span></span></code> </pre><br>  • Jika Anda perlu menambahkan skrip eksternal ke halaman - gunakan metode API injectScript. <br><br><pre> <code class="javascript hljs">injectScript(<span class="hljs-string"><span class="hljs-string">'https://vk.com/js/api/openapi.js?159'</span></span>, pixel.setVkAsyncInit(), data.gtmOnFailure, <span class="hljs-string"><span class="hljs-string">'vkPixel'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//https://vk.com/js/api/openapi.js?159 -  ,      //pixel.setVkAsyncInit() - ,        //data.gtmOnFailure - ,        //vkPixel -  ,  ,   URL  .    ,   JavaScript      </span></span></code> </pre><br>  • Jika Anda perlu mendapatkan URL (atau bagian dari URL itu) - gunakan metode getUrl API. <br><br><pre> <code class="javascript hljs">getUrl(<span class="hljs-string"><span class="hljs-string">'host'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//host -  URL,  .  ,  host: protocol, port, path, extension, fragment, query.</span></span></code> </pre><br>  Seperti yang saya tulis di atas, Template Kustom mendukung JS ES6.  Dianjurkan untuk menggunakan sintaks ini, karena lebih pendek kode dan membuatnya lebih mudah dibaca, dan karya JS lebih mudah diprediksi dan mirip dengan bahasa pemrograman lainnya. <br><br><div class="spoiler">  <b class="spoiler_title">Lebih lanjut tentang Sintaks JS ES6</b> <div class="spoiler_text">  Hal utama yang diinginkan untuk digunakan adalah fungsi panah dan deklarasi const dan biarkan variabel bukan var. <br><br>  Variabel yang dideklarasikan melalui const adalah konstanta yang nilainya tidak dapat diubah. <br><br>  Variabel yang dideklarasikan melalui let berbeda dari variabel yang dideklarasikan melalui var sebagai berikut: <br><br><ul><li>  biarkan tidak ditambahkan ke objek jendela global; </li><li>  mari visibilitas terbatas pada blok deklarasi; </li><li>  variabel yang dideklarasikan melalui let tidak dapat dideklarasikan ulang. </li></ul><br>  Fungsi panah adalah singkatan dari fungsi biasa: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//1.   const func1 = function() { return 'test'; } //    const func1 = () =&gt; 'test'; //2.   const func2 = function(arg) { if (arg &gt; 0) return 'plus'; else return 'minus'; } //    const func2 = arg =&gt; { if (arg &gt; 0) return 'plus'; else return 'minus'; } //3.   const func3 = function(arg1, arg2){ if (arg1 &gt; arg2) return arg1; else return arg2; } //    const func3 = (arg1, arg2) =&gt; { if (arg1 &gt; arg2) return arg1; else return arg2; }</span></span></code> </pre><br></div></div><br>  Sekarang setelah kami memahami cara menggunakan API Templat Kustom, kami dapat menulis kode operasi tag menggunakan sintaksis JavaScript ES6. <br><br>  Kode saya berisi metode untuk meluncurkan piksel, memasang VK openapi.js, mengambil data produk dari dataLayer (dengan situs perdagangan elektronik canggih Google dikonfigurasi), memproses data ini untuk membawanya ke dalam bentuk yang diperlukan untuk mengirim ke piksel penargetan ulang VKontakte , dan metode pengiriman acara. <br><br>  Metode pemicu piksel mendukung tiga skenario: <br><br><ol><li>  Pixel berjalan pada halaman di mana openapi.js hilang. </li><li>  Pixel berjalan pada halaman di mana ada openapi.js, tetapi belum dimuat. </li><li>  Pixel diluncurkan pada halaman dengan openapi.js dimuat. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Kode lengkap templat GTM khusus saya untuk VKontakte piksel penargetan ulang dinamis</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//api const copyFromWindow = require('copyFromWindow'); const setInWindow = require('setInWindow'); const injectScript = require('injectScript'); const callInWindow = require('callInWindow'); const makeTableMap = require('makeTableMap'); const getUrl = require('getUrl'); const getQueryParameters = require('getQueryParameters'); const makeInteger = require('makeInteger'); const makeString = require('makeString'); const callLater = require('callLater'); //    const settings = { event: data.event, pixelIDs: data.pixelIDs, priceListId: data.priceListId, fewPriceLists: data.fewPriceLists, priceListIds: data.priceListIds === undefined ? data.priceListIds : makeTableMap(data.priceListIds,'hostname','priceListId'), ecommerceUse: data.ecommerceUse, eventEcommerce: data.eventEcommerce, siteSearchQueryParam: data.siteSearchQueryParam }; //       const pixel = { //    getPageHostname: () =&gt; getUrl('host'), //    VK getVK: () =&gt; copyFromWindow('VK'), //    VK setVkAsyncInit: () =&gt; { setInWindow('vkAsyncInit', pixel.sendEvent); }, //       getSiteSearchPhrase: () =&gt; { if (settings.event === 'view_search') return getQueryParameters(settings.siteSearchQueryParam); else return undefined; }, //      getEventParams: (products, currencyCode, revenue) =&gt; { let eventParamsClean= {}; let eventParams = { products: eventProducts.getProductParams(products), category_ids: eventProducts.getCategoryString(products), currency_code: currencyCode, total_price: eventProducts.getTotalPrice(products, revenue), search_string: pixel.getSiteSearchPhrase() }; if (eventParams.products !== undefined) eventParamsClean.products = eventParams.products; if (eventParams.category_ids !== undefined) eventParamsClean.category_ids = eventParams.category_ids; if (eventParams.currency_code !== undefined) eventParamsClean.currency_code = eventParams.currency_code; if (eventParams.total_price !== undefined) eventParamsClean.total_price = eventParams.total_price; if (eventParams.search_string !== undefined) eventParamsClean.search_string = eventParams.search_string; return eventParamsClean; }, //  - getPriceListId: hostname =&gt; { if (settings.fewPriceLists) return settings.priceListIds[hostname]; else return settings.priceListId; }, //  openapi.js openapiInit: () =&gt; { injectScript('https://vk.com/js/api/openapi.js?159', pixel.setVkAsyncInit(), data.gtmOnFailure, 'vkPixel'); setInWindow('openapiInject', 1); }, //   sendEvent: () =&gt; { if (settings.event === 'hit') { settings.pixelIDs.split(',').forEach(p =&gt; { callInWindow('VK.Retargeting.Init',p); callInWindow('VK.Retargeting.Hit'); }); } else { const pricelist = pixel.getPriceListId(pixel.getPageHostname()); const name = settings.event; let products = []; if(settings.ecommerceUse) products = name === 'view_home' || name === 'view_category' || name === 'view_search' || name === 'view_other' ? settings.eventEcommerce : settings.eventEcommerce.products; else products = undefined; const currencyCode = settings.ecommerceUse ? settings.eventEcommerce.currencyCode : undefined; const revenue = (settings.ecommerceUse &amp;&amp; name === 'purchase') ? settings.eventEcommerce.actionField.revenue : undefined; const eventParams = settings.ecommerceUse ? pixel.getEventParams(products, currencyCode, revenue) : undefined; settings.pixelIDs.split(',').forEach(p =&gt; { callInWindow('VK.Retargeting.Init',p); callInWindow('VK.Retargeting.ProductEvent', pricelist, name, eventParams); }); }, //   start: () =&gt; { if (pixel.getVK() === undefined &amp;&amp; copyFromWindow('openapiInject') !== 1) { pixel.openapiInit(); data.gtmOnSuccess(); } else if (pixel.getVK() === undefined &amp;&amp; copyFromWindow('openapiInject') === 1) { if (pixel.count &lt; 50) { callLater(pixel.start); pixel.count++; } else return; } else { pixel.sendEvent(); data.gtmOnSuccess(); }, //   count: 0 }; //       const eventProducts = { //    products   getProductParams: products =&gt; { let arr = []; products.forEach(i =&gt; { let productParamsClean = {}; let productParams = { id: makeString(i.id), group_id: makeString(i.brand), price: makeInteger(i.price * 100) / 100 }; if (productParams.id !== 'undefined') productParamsClean.id = productParams.id; if (productParams.group_id !== 'undefined') productParamsClean.group_id = productParams.group_id; if (productParams.price !== 0) productParamsClean.price = productParams.price; arr.push(productParamsClean); }); return arr; }, //       'a,b,c'       getCategoryString: products =&gt; { let categoryId = ''; let check = []; products.forEach(i =&gt; { if(check.indexOf(i.category) === -1) { check.push(i.category); categoryId += ',' + i.category; }); return categoryId.slice(1); }, //     getTotalPrice: (products, revenue) =&gt; { let sumPrice = 0; if (revenue !== undefined ) return makeInteger(revenue * 100) / 100; else { products.forEach(i =&gt; { if (i.hasOwnProperty('quantity')) sumPrice += (makeInteger(i.price * 100) / 100) * makeInteger(i.quantity); else sumPrice += makeInteger(i.price * 100) / 100; }); return sumPrice; }; //  pixel.start();</span></span></code> </pre> <br></div></div><br><a name="6"></a><h2>  Tab Izin </h2><br>  Setelah menulis kode tag, tahap terakhir tetap - untuk mengeluarkan izin untuk berinteraksi dengan data global halaman.  Ini dilakukan hanya pada tab Izin. <br><br>  Karena kode dieksekusi dalam lingkungan yang terisolasi, dan interaksi dengan data global terjadi melalui API, untuk setiap metode API (jika perlu) kita perlu secara manual menentukan izin untuk tindakan tertentu. <br><br>  Hal ini dilakukan untuk mendekati pekerjaan dengan data halaman global sebanyak mungkin, dan dengan demikian meminimalkan kemungkinan "menempatkan" situs dalam kesalahan dalam kode templat kami. <br><br>  Untuk metode API yang digunakan dalam kode saya, tiga jenis izin harus dikeluarkan: <br><br><img src="https://habrastorage.org/webt/29/og/lw/29oglwyra6zkhac7_2lr4jpqq5a.png"><br><br>  <b>1. Mengakses Variabel Global</b> - baca, tulis, jalankan akses ke variabel global yang digunakan dalam kode kita.  Variabel harus ditambahkan secara manual dan untuk masing-masing menunjukkan apa yang kami izinkan untuk dilakukan. <br><br><img src="https://habrastorage.org/webt/f3/qb/6b/f3qb6b9sj6rn1v4q55t_z9f362e.png"><br><br>  Misalnya, variabel VK hanya dapat dibaca, vkAsyncInit dapat dibaca dan didefinisikan ulang, dan metode VK.Retargeting.Hit hanya dapat dieksekusi. <br><br>  <b>2. Membaca URL</b> .  Di sini Anda harus menentukan bagian URL yang diizinkan untuk diterima.  Saya mengizinkan bagian URL diterima: <br><br><img src="https://habrastorage.org/webt/do/um/li/doumlixqd-rw2cppm4ordw1svae.png"><br><br>  Tetapi jika Anda ingin, Anda dapat menentukan spesifik: <br><br><img src="https://habrastorage.org/webt/sj/d3/ne/sjd3nefe52_foeat88kifeodi-w.png"><br><br>  <b>3. Menyuntikkan Script</b> .  Di sini perlu mendaftarkan alamat dari mana Anda dapat mengunduh skrip eksternal.  Dalam kode saya, hanya satu skrip dengan VK openapi.js yang dimuat, saya tentukan alamatnya: <br><br><img src="https://habrastorage.org/webt/xt/oy/hd/xtoyhd-yprd2sn_eu41mbquh2s0.png"><br><br>  Itu saja, pengaturan Template Kustom selesai, Anda dapat menyimpan template dan melanjutkan ke pengujian. <br><br><a name="7"></a><h2>  Kustomisasi dan pengujian tag pada Template Kustom yang dibuat </h2><br>  Sebagai contoh, kami akan membuat dua tag penargetan ulang dinamis "VKontakte" menggunakan Template Khusus yang dibuat: tampilan halaman dan addToCart. <br><br><a name="8"></a><h3>  Tampilan halaman </h3><br>  Kami akan masuk ke wadah GTM yang diperlukan, membuat tag baru, pilih jenis tag VK Pixel di bagian Kustom: <br><br><img src="https://habrastorage.org/webt/gd/s-/fi/gds-fi0tqxxcmfkkccsi8trowq4.png"><br><br>  Kami mengisi nama tag, pilih acara yang akan dilacak, pilih Hit (ini adalah tampilan halaman standar), di bidang "ID Piksel", tunjukkan ID dua piksel yang akan dikirim datanya, dipisahkan dengan koma dan atur pemicu Semua Halaman: <br><br><img src="https://habrastorage.org/webt/vr/op/-0/vrop-0cjfqndkh35qnbtdsoxpc4.png"><br><br>  Simpan tag yang dibuat. <br><br><a name="9"></a><h3>  AddToCart </h3><br>  Membuat tag untuk acara yang menambahkan produk ke troli akan sedikit lebih rumit daripada tag Hit. <br><br>  Pertama, Anda perlu mentransfer barang yang ditambahkan ke keranjang.  Seperti yang saya tulis di atas, ini dimungkinkan dengan e-commerce canggih Google yang dikonfigurasi di situs.  Dalam hal ini, data produk diambil dari dataLayer. <br><br>  Untuk melakukan ini, kita perlu membuat variabel dataLayer di GTM, yang akan menyimpan objek e-niaga untuk acara addToCart.  Pengaturan variabel terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/ko/r5/gu/kor5gumudjjzs9groemuo7nepco.png"><br><br>  Kedua, Anda perlu membuat pemicu yang akan mengaktifkan tag ketika acara addToCart e-niaga terjadi (pemicu akan mengaktifkan tag saat mendorong dataLayer dengan acara addToCart): <br><br><img src="https://habrastorage.org/webt/og/xl/lt/ogxlltp_4_spurvq8fesqg3uy0m.png"><br><br>  Setelah membuat variabel dengan objek e-niaga dan pemicu, Anda dapat mulai membuat tag: <br><br><img src="https://habrastorage.org/webt/dp/qg/zq/dpqgzqb27rcdydnjeen5fftp6ba.png"><br><br>  Dalam rangka: <br><br><ol><li>  Sebagai acara yang dilacak, pilih Tambahkan Ke Troli. </li><li>  Kami mengisi ID yang dipisahkan oleh koma dua piksel tempat data harus ditransfer. </li><li>  Tetapkan kotak centang "Gunakan beberapa daftar harga": untuk Moskow dan St. Petersburg, dalam contoh kami, perlu menggunakan daftar harga yang berbeda. </li><li>  Isi tabel dengan daftar harga. </li><li>  Setel kotak centang "Gunakan e-niaga untuk mentransfer produk dan parameter". </li><li>  Di objek e-niaga acara ini, tentukan variabel yang dibuat sebelumnya. </li><li>  Kami mengatur pemicu untuk acara yang dipantau, dalam hal ini - AddToCart. </li><li>  Simpan. </li></ol><br><a name="10"></a><h3>  Tes penambangan </h3><br>  Untuk memeriksa cara kerja piksel penargetan ulang dinamis di VKontakte, Anda perlu mengaktifkan mode Pratinjau di GTM, buka situs web kami dan buka bagian Jaringan di konsol browser dan masukkan 'rtrg' di bidang Filter: <br><img src="https://habrastorage.org/webt/ci/m9/z8/cim9z824mbc9dfvdz-4425fe02w.png"><br><br>  Setelah itu, kami me-refresh halaman, dan kami harus memiliki dua permintaan - acara Hit dikirim dalam dua piksel: <br><br><img src="https://habrastorage.org/webt/o0/5x/80/o05x80jeypiwcogusca_zgsnaju.png"><br><br>  Status 200 berarti permintaan berhasil dikirim dan diterima oleh server. <br><br>  Juga di jendela Pratinjau GTM, kami melihat bahwa tag yang kami buat bekerja dengan benar untuk acara Tampilan Halaman. <br><br>  Untuk memeriksa acara Tambahkan Ke Keranjang, tambahkan produk ke keranjang, dan di konsol kami memiliki dua permintaan lagi: <br><br><img src="https://habrastorage.org/webt/wt/jm/-k/wtjm-k50mmapqa1xtyva_yd3wcc.png"><br><br>  Di jendela Pratinjau GTM, kita melihat bahwa tag kedua berhasil.  Data produk dari dataLayer ditarik dan diproses dengan benar, daftar harga yang benar juga diganti. <br><br>  Untuk host kedua, daftar harga juga diganti dengan benar: <br><br><img src="https://habrastorage.org/webt/n3/de/h3/n3deh30jep61h2kv9zefwruu8cy.png"><br><br>  Tag untuk acara lain dikonfigurasikan dan diperiksa dengan cara yang sama. <br><br><a name="11"></a><h2>  Kesimpulan </h2><br>  Template khusus mengubah paradigma yang umum digunakan dalam GTM.  Semua orang terbiasa dengan tag HTML dan variabel JS, tetapi sekarang ada alternatif yang bagus. <br><br>  Cukup untuk membuat templat kustom berkualitas tinggi sekali, dan siapa pun yang terbiasa dengan GTM dapat menggunakannya. <br><br>  Mengingat kemampuan untuk berbagi templat yang dibuat, saya pikir mereka harus mendapatkan popularitas di kalangan pengguna. <br><br>  Anda dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengunduh template</a> piksel penargetan ulang dinamis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kustom</a> VKontakte, yang kami periksa di artikel ini. <br><br>  Untuk mengimpor template, Anda perlu membuat Template Kustom baru dan pilih Impor dari menu: <br><br><img src="https://habrastorage.org/webt/mx/nn/jc/mxnnjc0419poxmshokabjcgeoye.png"><br><br>  <i>Materi yang disiapkan oleh saya untuk ppc.world</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458788/">https://habr.com/ru/post/id458788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id458774/index.html">DBMS fungsional</a></li>
<li><a href="../id458778/index.html">Satellite 6.5 Engine Reporting: Apa dan Mengapa</a></li>
<li><a href="../id458782/index.html">Adaptasi program untuk ZX Spectrum ke TR-DOS dengan cara modern. Bagian 3</a></li>
<li><a href="../id458784/index.html">Menyiarkan proyek dan perpustakaan dari Altium Designer ke PADS Professional</a></li>
<li><a href="../id458786/index.html">Penjaga video game menjaga budaya game langkah demi langkah</a></li>
<li><a href="../id458790/index.html">Pengantar CatBoost. Laporan Yandex</a></li>
<li><a href="../id458792/index.html">Karyawan "Terbakar": apakah ada jalan keluar?</a></li>
<li><a href="../id458794/index.html">Rapat Analis Bisnis di Redmadrobot 18 Juli</a></li>
<li><a href="../id458796/index.html">Cara menyiapkan situs Anda untuk beban kerja yang berat: 5 tips praktis dan alat yang berguna</a></li>
<li><a href="../id458798/index.html">Bot Nutrient atau cara saya ingin mengambil roti dari pelatih kebugaran</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>